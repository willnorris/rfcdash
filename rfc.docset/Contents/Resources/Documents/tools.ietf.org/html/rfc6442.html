<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.106" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Relation.Replaces" content="draft-ietf-sip-location-conveyance" />
<meta name="DC.Identifier" content="urn:ietf:rfc:6442" />
<meta name="DC.Date.Issued" content="December, 2011" />
<meta name="DC.Creator" content="Peterson, Jon" />
<meta name="DC.Creator" content="Rosen, Brian" />
<meta name="DC.Creator" content="Polk, James" />
<meta name="DC.Description.Abstract" content="This document defines an extension to the Session Initiation Protocol\n(SIP) to convey geographic location information from one SIP entity to\nanother SIP entity. The SIP extension covers end-to-end conveyance as\nwell as location-based routing, where SIP intermediaries make routing\ndecisions based upon the location of the Location Target. [STANDARDS-\nTRACK]" />
<meta name="DC.Title" content="Location Conveyance for the Session Initiation Protocol" />

    <link rel="icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 6442 - Location Conveyance for the Session Initiation Protocol</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgblue"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc6442.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc6442" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-sipcore-location-conveyance" title="draft-ietf-sipcore-location-conveyance">draft-ietf-sipcor...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6442" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc6442" title="Side-by-side diff">Diff2</a>]                 </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Internet Engineering Task Force (IETF)                           J. Polk
Request for Comments: 6442                                 Cisco Systems
Category: Standards Track                                       B. Rosen
ISSN: 2070-1721                                              J. Peterson
                                                                 NeuStar
                                                           December 2011

        <span class="h1">Location Conveyance for the Session Initiation Protocol</span>

Abstract

   This document defines an extension to the Session Initiation Protocol
   (SIP) to convey geographic location information from one SIP entity
   to another SIP entity.  The SIP extension covers end-to-end
   conveyance as well as location-based routing, where SIP
   intermediaries make routing decisions based upon the location of the
   Location Target.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6442">http://www.rfc-editor.org/info/rfc6442</a>.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





<span class="grey">Polk, et al.                 Standards Track                    [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions and Terminology Used in This Document ...............<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Overview of SIP Location Conveyance .............................<a href="#page-4">4</a>
      <a href="#section-3.1">3.1</a>. Location Conveyed by Value .................................<a href="#page-4">4</a>
      <a href="#section-3.2">3.2</a>. Location Conveyed as a Location URI ........................<a href="#page-5">5</a>
      <a href="#section-3.3">3.3</a>. Location Conveyed though a SIP Intermediary ................<a href="#page-6">6</a>
      <a href="#section-3.4">3.4</a>. SIP Intermediary Replacing Bad Location ....................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. SIP Extensions for Geolocation Conveyance .......................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. The Geolocation Header Field ...............................<a href="#page-8">8</a>
      <a href="#section-4.2">4.2</a>. The Geolocation-Routing Header Field ......................<a href="#page-11">11</a>
           4.2.1. Explaining Geolocation-Routing Header-Value
                  States .............................................<a href="#page-12">12</a>
      <a href="#section-4.3">4.3</a>. 424 (Bad Location Information) Response Code ..............<a href="#page-14">14</a>
      <a href="#section-4.4">4.4</a>. The Geolocation-Error Header Field ........................<a href="#page-15">15</a>
      <a href="#section-4.5">4.5</a>. Location URIs in Message Bodies ...........................<a href="#page-19">19</a>
      <a href="#section-4.6">4.6</a>. Location Profile Negotiation ..............................<a href="#page-19">19</a>
   <a href="#section-5">5</a>. Geolocation Examples ...........................................<a href="#page-20">20</a>
      <a href="#section-5.1">5.1</a>. Location-by-Value (in Coordinate Format) ..................<a href="#page-20">20</a>
      <a href="#section-5.2">5.2</a>. Two Locations Composed in Same Location Object Example ....<a href="#page-21">21</a>
   <a href="#section-6">6</a>. Geopriv Privacy Considerations .................................<a href="#page-23">23</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-24">24</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-26">26</a>
      <a href="#section-8.1">8.1</a>. IANA Registration for the SIP Geolocation Header Field ....<a href="#page-26">26</a>
      8.2. IANA Registration for the SIP Geolocation-Routing
           Header Field ..............................................<a href="#page-26">26</a>
      <a href="#section-8.3">8.3</a>. IANA Registration for Location Profiles ...................<a href="#page-27">27</a>
      <a href="#section-8.4">8.4</a>. IANA Registration for 424 Response Code ...................<a href="#page-27">27</a>
      <a href="#section-8.5">8.5</a>. IANA Registration of New Geolocation-Error Header Field ...<a href="#page-28">28</a>
      <a href="#section-8.6">8.6</a>. IANA Registration for the SIP Geolocation-Error Codes .....<a href="#page-28">28</a>
   <a href="#section-9">9</a>. Acknowledgements ...............................................<a href="#page-29">29</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-29">29</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-29">29</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-31">31</a>
   <a href="#appendix-A">Appendix A</a>. Requirements for SIP Location Conveyance ..............<a href="#page-32">32</a>



<span class="grey">Polk, et al.                 Standards Track                    [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   Session Initiation Protocol (SIP) [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>] creates, modifies and
   terminates multimedia sessions.  SIP carries certain information
   related to a session while establishing or maintaining calls.  This
   document defines how SIP conveys geographic location information of a
   Target to a Location Recipient (LR).  SIP acts as a Using Protocol of
   location information, as defined in <a href="rfc3693.html">RFC 3693</a>.

   In order to convey location information, this document specifies
   three new SIP header fields, Geolocation, Geolocation-Routing, and
   Geolocation-Error, which carry a reference to a Location Object (LO),
   grant permission to route a SIP request based on the location-value
   and provide error notifications specific to location errors,
   respectively.  The Location Object (LO) may appear in a MIME body
   attached to the SIP request, or it may be a remote resource in the
   network.

   A Target is an entity whose location is being conveyed, per <a href="rfc3693.html">RFC 3693</a>.
   Thus, a Target could be a SIP user agent (UA), some other IP device
   (a router or a PC) that does not have a SIP stack, a non-IP device (a
   person or a black phone), or even a non-communications device (a
   building or store front).  In no way does this document assume that
   the SIP user agent client that sends a request containing a location
   object is necessarily the Target.  The location of a Target conveyed
   within SIP typically corresponds to that of a device controlled by
   the Target, for example, a mobile phone, but such devices can be
   separated from their owners, and moreover, in some cases, the user
   agent may not know its own location.

   In the SIP context, a location recipient will most likely be a SIP
   UA, but due to the mediated nature of SIP architectures, location
   information conveyed by a single SIP request may have multiple
   recipients, as any SIP proxy server in the signaling path that
   inspects the location of the Target must also be considered a
   Location Recipient.  In presence-like architectures, an intermediary
   that receives publications of location information and distributes
   them to watchers acts as a Location Server per <a href="rfc3693.html">RFC 3693</a>.  This
   location conveyance mechanism can also be used to deliver URIs
   pointing to such Location Servers where prospective Location
   Recipients can request Location Objects.










<span class="grey">Polk, et al.                 Standards Track                    [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Conventions and Terminology Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].
   Furthermore, this document uses numerous terms defined in [<a href="rfc3693.html" title="&quot;Geopriv Requirements&quot;">RFC3693</a>],
   including: Location Object, Location Recipient, Location Server,
   Target, Rule Maker, and Using Protocol.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Overview of SIP Location Conveyance</span>

   An operational overview of SIP location conveyance can be shown in
   four basic diagrams, with most applications falling under one of the
   following basic use cases.  Each is separated into its own subsection
   here in <a href="#section-3">Section 3</a>.

   Each diagram has Alice and Bob as UAs.  Alice is the Target, and Bob
   is an LR.  A SIP intermediary appears in some of the diagrams.  Any
   SIP entity that receives and inspects location information is an LR;
   therefore, in any of the diagrams, the SIP intermediary that receives
   a SIP request is potentially an LR -- though that does not mean such
   an intermediary necessarily has to route the SIP request based on the
   location information.  In some use cases, location information passes
   through the LS on the right of each diagram.

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Location Conveyed by Value</span>

   We start with the simplest diagram of Location Conveyance, Alice to
   Bob, where no other Layer 7 entities are involved.

      Alice          SIP Intermediary       Bob               LS
        |                |                   |                 |
        |       Request w/Location           |                 |
        |-----------------------------------&gt;|                 |
        |                                    |                 |
        |             Response               |                 |
        |&lt;-----------------------------------|                 |
        |                |                   |                 |

        Figure 1.  Location Conveyed by Value

   In Figure 1, Alice is both the Target and the LS that is conveying
   her location directly to Bob, who acts as an LR.  This conveyance is
   point-to-point: it does not pass through any SIP-layer intermediary.
   A Location Object appears by-value in the initial SIP request as a
   MIME body, and Bob responds to that SIP request as appropriate.
   There is a 'Bad Location Information' response code introduced within
   this document to specifically inform Alice if she conveys bad



<span class="grey">Polk, et al.                 Standards Track                    [Page 4]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   location to Bob (e.g., Bob "cannot parse the location provided", or
   "there is not enough location information to determine where Alice
   is").

<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>.  Location Conveyed as a Location URI</span>

   Here we make Figure 1 a little more complicated by showing a diagram
   of indirect Location Conveyance from Alice to Bob, where Bob's entity
   has to retrieve the location object from a third party server.

      Alice          SIP Intermediary       Bob               LS
        |                |                   |                 |
        |      Request w/Location URI        |                 |
        |-----------------------------------&gt;|                 |
        |                                    |    Dereference  |
        |                                    |        Request  |
        |                                   (To: Location URI) |
        |                                    |----------------&gt;|
        |                                    |                 |
        |                                    |    Dereference  |
        |                                    |       Response  |
        |                           (includes Location Object) |
        |                                    |&lt;----------------|
        |             Response               |                 |
        |&lt;-----------------------------------|                 |
        |                |                   |                 |

        Figure 2.  Location Conveyed as a Location URI

   In Figure 2, location is conveyed indirectly, via a Location URI
   carried in the SIP request (more of those details later).  If Alice
   sends Bob this Location URI, Bob will need to dereference the URI --
   analogous to Content Indirection [<a href="rfc4483.html" title="&quot;A Mechanism for Content Indirection in Session Initiation Protocol (SIP) Messages&quot;">RFC4483</a>] -- in order to request the
   location information.  In general, the LS provides the location value
   to Bob instead of Alice directly for conveyance to Bob.  From a user
   interface perspective, Bob the user won't know that this information
   was gathered from an LS indirectly rather than culled from the SIP
   request; practically, this does not impact the operation of location-
   based applications.

   The example given in this section is only illustrative, not
   normative.  In particular, applications can choose to dereference a
   location URI at any time, possibly several times, or potentially not
   at all.  Applications receiving a Location URI in a SIP transaction
   need to be mindful of timers used by different transactions.  In
   particular, if the means of dereferencing the Location URI might take
   longer than the SIP transaction timeout (Timer C for INVITE




<span class="grey">Polk, et al.                 Standards Track                    [Page 5]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   transactions, Timer F for non-INVITE transactions), then it needs to
   rely on mechanisms other than the transaction's response code to
   convey location errors, if returning such errors are necessary.

<span class="h3"><a class="selflink" name="section-3.3" href="#section-3.3">3.3</a>.  Location Conveyed though a SIP Intermediary</span>

   In Figure 3, we introduce the idea of a SIP intermediary into the
   example to illustrate the role of proxying in the location
   architecture.  This intermediary can be a SIP proxy or it can be a
   back-to-back user agent (B2BUA).  In this message flow, the SIP
   intermediary could act as an LR, in addition to Bob.  The primary use
   case for intermediaries consuming location information is location-
   based routing.  In this case, the intermediary chooses a next hop for
   the SIP request by consulting a specialized location service that
   selects forwarding destinations based on the geographical location
   information contained in the SIP request.

      Alice          SIP Intermediary       Bob               LS
        |                |                   |                 |
        |   Request      |                   |                 |
        |    w/Location  |                   |                 |
        |---------------&gt;|                   |                 |
        |                |  Request          |                 |
        |                |   w/Location      |                 |
        |                |------------------&gt;|                 |
        |                |                   |                 |
        |                |   Response        |                 |
        |                |&lt;------------------|                 |
        |     Response   |                   |                 |
        |&lt;---------------|                   |                 |
        |                |                   |                 |

        Figure 3.  Location Conveyed though a SIP Intermediary

   However, the most common case will be one in which the SIP
   intermediary receives a request with location information (conveyed
   either by-value or by-reference) and does not know or care about
   Alice's location, or support this extension, and merely passes it on
   to Bob.  In this case, the intermediary does not act as a Location
   Recipient.  When the intermediary is not an LR, this use case is the
   same as the one described in <a href="#section-3.1">Section 3.1</a>.

   Note that an intermediary does not have to perform location-based
   routing in order to be a Location Recipient.  It could be the case
   that a SIP intermediary that does not perform location-based routing
   does care when Alice includes her location; for example, it could
   care that the location information is complete or that it correctly
   identifies where Alice is.  The best example of this is



<span class="grey">Polk, et al.                 Standards Track                    [Page 6]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   intermediaries that verify location information for emergency
   calling, but it could also be for any location based routing, e.g.,
   contacting your favorite local pizza delivery service, making sure
   that organization has Alice's proper location in the initial SIP
   request.

   There is another scenario in which the SIP intermediary cares about
   location and is not an LR, one in which the intermediary inserts
   another location of the Target, Alice in this case, into the request,
   and forwards it.  This secondary insertion is generally not advisable
   because downstream SIP entities will not be given any guidance about
   which location to believe is better, more reliable, less prone to
   error, more granular, worse than the other location or just plain
   wrong.

   This document takes a "you break it, you bought it" approach to
   dealing with second locations placed into a SIP request by an
   intermediary entity.  That entity becomes completely responsible for
   all location within that SIP request (more on this in <a href="#section-4">Section 4</a>).

<span class="h3"><a class="selflink" name="section-3.4" href="#section-3.4">3.4</a>.  SIP Intermediary Replacing Bad Location</span>

   If the SIP intermediary rejects the message due to unsuitable
   location information, the SIP response will indicate there was 'Bad
   Location Information' in the SIP request and provide a location-
   specific error code indicating what Alice needs to do to send an
   acceptable request (see Figure 4 for this scenario).

      Alice          SIP Intermediary       Bob               LS
        |                |                   |                 |
        |   Request      |                   |                 |
        |    w/Location  |                   |                 |
        |---------------&gt;|                   |                 |
        |                |                   |                 |
        |   Rejected     |                   |                 |
        | w/New Location |                   |                 |
        |&lt;---------------|                   |                 |
        |                |                   |                 |
        |   Request      |                   |                 |
        | w/New Location |                   |                 |
        |---------------&gt;|                   |                 |
        |                |    Request        |                 |
        |                |  w/New Location   |                 |
        |                |------------------&gt;|                 |
        |                |                   |                 |

        Figure 4.  SIP Intermediary Replacing Bad Location




<span class="grey">Polk, et al.                 Standards Track                    [Page 7]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   In this last use case, the SIP intermediary wishes to include a
   Location Object indicating where it understands Alice to be.  Thus,
   it needs to inform her user agent of what location it will include in
   any subsequent SIP request that contains her location.  In this case,
   the intermediary can reject Alice's request and, through the SIP
   response, convey to her the best way to repair the request in order
   for the intermediary to accept it.

   Overriding location information provided by the user requires a
   deployment where an intermediary necessarily knows better than an end
   user -- after all, it could be that Alice has an on-board GPS, and
   the SIP intermediary only knows her nearest cell tower.  Which is
   more accurate location information? Currently, there is no way to
   tell which entity is more accurate or which is wrong, for that
   matter.  This document will not specify how to indicate which
   location is more accurate than another.

   As an aside, it is not envisioned that any SIP-based emergency
   services request (i.e., IP-911 or 112 type of call attempt) will
   receive a corrective 'Bad Location Information' response from an
   intermediary.  Most likely, in that scenario, the SIP intermediary
   would act as a B2BUA and insert into the request by-value any
   appropriate location information for the benefit of Public Safety
   Answering Point (PSAP) call centers to expedite call reception by the
   emergency services personnel; thereby, minimizing any delay in call
   establishment time.  The implementation of these specialized
   deployments is, however, outside the scope of this document.

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  SIP Extensions for Geolocation Conveyance</span>

   The following sections detail the extensions to SIP for location
   conveyance.

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  The Geolocation Header Field</span>

   This document defines "Geolocation" as a new SIP header field
   registered by IANA, with the following ABNF [<a href="rfc5234.html" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>]:

   message-header    =/ Geolocation-header
                        ; (message-header from <a href="rfc3261.html">RFC 3261</a>)
   Geolocation-header = "Geolocation" HCOLON locationValue
                        *( COMMA locationValue )
   locationValue      = LAQUOT locationURI RAQUOT
                        *(SEMI geoloc-param)
   locationURI        = sip-URI / sips-URI / pres-URI
                          / http-URI / https-URI
                          / cid-url ; (from <a href="rfc2392.html">RFC 2392</a>)
                          / absoluteURI ; (from <a href="rfc3261.html">RFC 3261</a>)



<span class="grey">Polk, et al.                 Standards Track                    [Page 8]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   geoloc-param       = generic-param ; (from <a href="rfc3261.html">RFC 3261</a>)

   HCOLON, COMMA, LAQUOT, RAQUOT, and SEMI are defined in [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>].

   sip-URI, sips-URI, and absoluteURI are defined according to
   [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>].

   The pres-URI is defined in [<a href="rfc3859.html" title="&quot;Common Profile for Presence (CPP)&quot;">RFC3859</a>].

   http-URI and https-URI are defined according to [<a href="rfc2616.html" title="&quot;Hypertext Transfer Protocol -- HTTP/1.1&quot;">RFC2616</a>] and
   [<a href="rfc2818.html" title="&quot;HTTP Over TLS&quot;">RFC2818</a>], respectively.

   The cid-url is defined in [<a href="rfc2392.html" title="&quot;Content-ID and Message-ID Uniform Resource Locators&quot;">RFC2392</a>] to locate message body parts.
   This URI type is present in a SIP request when location is conveyed
   as a MIME body in the SIP message.

   GEO-URIs [<a href="rfc5870.html" title="&quot;A Uniform Resource Identifier for Geographic Locations ('geo' URI)&quot;">RFC5870</a>] are not appropriate for usage in the SIP
   Geolocation header because it does not include retention and
   re-transmission flags as part of the location information.  Other URI
   schemes used in the location URI MUST be reviewed against the
   criteria in [<a href="rfc3693.html" title="&quot;Geopriv Requirements&quot;">RFC3693</a>] for a Using Protocol.  <a href="#section-4.6">Section 4.6</a> discusses
   how URI schemes are communicated using this SIP extension and what to
   do if a URI scheme is received that cannot be supported.

   The generic-param in the definition of locationValue is included as a
   mechanism for future extensions that might require parameters.  This
   document defines no parameters for use with locationValue.  If a
   Geolocation header field is received that contains generic-params,
   each parameter SHOULD be ignored, and SHOULD NOT be removed when
   forwarding the locationValue.  If a need arises to define parameters
   for use with locationValue, a revision/extension to this document is
   required.

   The Geolocation header field MUST have at least one locationValue.  A
   SIP intermediary SHOULD NOT add location to a SIP request that
   already contains location.  This will quite often lead to confusion
   within LRs.  However, if a SIP intermediary adds location, even if
   location was not previously present in a SIP request, that SIP
   intermediary is fully responsible for addressing the concerns of any
   424 (Bad Location Information) SIP response it receives about this
   location addition and MUST NOT pass on (upstream) the 424 response.
   A SIP intermediary that adds a locationValue MUST position the new
   locationValue as the last locationValue within the Geolocation header
   field of the SIP request.







<span class="grey">Polk, et al.                 Standards Track                    [Page 9]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   This document defines the Geolocation header field as valid in the
   following SIP requests:

      INVITE [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>]             REGISTER [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>]
      OPTIONS [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>]            BYE [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>]
      UPDATE [<a href="rfc3311.html" title="&quot;The Session Initiation Protocol (SIP) UPDATE Method&quot;">RFC3311</a>]             INFO [<a href="rfc6086.html" title="&quot;Session Initiation Protocol (SIP) INFO Method and Package Framework&quot;">RFC6086</a>]
      MESSAGE [<a href="rfc3428.html" title="&quot;Session Initiation Protocol (SIP) Extension for Instant Messaging&quot;">RFC3428</a>]            REFER [<a href="rfc3515.html" title="&quot;The Session Initiation Protocol (SIP) Refer Method&quot;">RFC3515</a>]
      SUBSCRIBE [<a href="rfc3265.html" title="&quot;Session Initiation Protocol (SIP)-Specific Event Notification&quot;">RFC3265</a>]          NOTIFY [<a href="rfc3265.html" title="&quot;Session Initiation Protocol (SIP)-Specific Event Notification&quot;">RFC3265</a>]
      PUBLISH [<a href="rfc3903.html" title="&quot;Session Initiation Protocol (SIP) Extension for Event State Publication&quot;">RFC3903</a>]

   The Geolocation header field MAY be included in any one of the above
   listed requests by a UA and a 424 response to any one of the requests
   sent above.  Fully appreciating the caveats/warnings mentioned above,
   a SIP intermediary MAY add the Geolocation header field.

   A SIP intermediary MAY add a Geolocation header field if one is not
   present -- for example, when a user agent does not support the
   Geolocation mechanism but their outbound proxy does and knows the
   Target's location, or any of a number of other use cases (see <a href="#section-3">Section</a>
   <a href="#section-3">3</a>).

   The Geolocation header field MAY be present in a SIP request or
   response without the presence of a Geolocation-Routing header
   (defined in <a href="#section-4.2">Section 4.2</a>).  As stated in <a href="#section-4.2">Section 4.2</a>, the default
   value of Geolocation-Routing header-value is "no", meaning SIP
   intermediaries MUST NOT view (i.e., process, inspect, or actively
   dereference) any direct or indirect location within this SIP message.
   This is for at least two fundamental reasons:

      1) to make the possibility of retention of the Target's location
         moot (because it was not viewed in the first place); and

      2) to prevent a different treatment of this SIP request based on
         the contents of the Location Information in the SIP request.

   Any locationValue MUST be related to the original Target.  This is
   equally true for the location information in a SIP response, i.e.,
   from a SIP intermediary back to the Target as explained in <a href="#section-3.4">Section</a>
   <a href="#section-3.4">3.4</a>.  SIP intermediaries SHOULD NOT modify or delete any existing
   locationValue(s).  A use case in which this would not apply would be
   where the SIP intermediary is an anonymizer.  The problem with this
   scenario is that the geolocation included by the Target then becomes
   useless for the purpose or service for which they wanted to use
   (include) it.  For example, 911/emergency calling or finding the
   nearest (towing company/pizza delivery/dry cleaning) service(s) will
   not yield intended results if the Location Information were to be
   modified or deleted from the SIP request.




<span class="grey">Polk, et al.                 Standards Track                   [Page 10]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  The Geolocation-Routing Header Field</span>

   This document defines "Geolocation-Routing" as a new SIP header field
   registered by IANA, with the following ABNF [<a href="rfc5234.html" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>]:

   message-header    =/ Georouting-header
                        ; (message-header from <a href="rfc3261.html">RFC 3261</a>)
   Georouting-header  = "Geolocation-Routing" HCOLON
                        ( "yes" / "no" / generic-value )
   generic-value      = generic-param;  (from <a href="rfc3261.html">RFC 3261</a>)

   HCOLON is defined in [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>].

   The only defined values for the Geolocation-Routing header field are
   "yes" or "no".  When the value is "yes", the locationValue can be
   used for routing decisions along the downstream signaling path by
   intermediaries.  Values other than "yes" or "no" are permitted for
   future extensions.  Implementations not aware of an extension MUST
   treat any other received value the same as "no".

   If no Geolocation-Routing header field is present in a SIP request, a
   SIP intermediary MAY insert this header.  Without knowledge from a
   Rule Maker, the SIP intermediary inserting this header-value SHOULD
   NOT set the value to "yes", as this may be more permissive than the
   originating party intends.  An easy way around this is to have the
   Target always insert this header-value as "no".

   When this Geolocation-Routing header-value is set to "no", this means
   no locationValue (inserted by the originating User Agent Client (UAC)
   or any intermediary along the signaling path) can be used by any SIP
   intermediary to make routing decisions.  Intermediaries that attempt
   to use the location information for routing purposes in spite of this
   counter indication could end up routing the request improperly as a
   result.  <a href="#section-4.4">Section 4.4</a> gives the details on what a routing intermediary
   does if it determines it needs to use the location in the SIP request
   in order to process the message further.  The practical implication
   is that when the Geolocation-Routing header-value is set to "no", if
   a cid:url is present in the SIP request, intermediaries MUST NOT view
   the location (because it is not for intermediaries to consider when
   processing the request); if a location URI is present, intermediaries
   MUST NOT dereference it.  UAs are allowed to view location in the SIP
   request even when the Geolocation-Routing header-value is set to
   "no".  An LR MUST by default consider the Geolocation-Routing header-
   value as set to "no", with no exceptions, unless the header field
   value is set to "yes".






<span class="grey">Polk, et al.                 Standards Track                   [Page 11]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   A Geolocation-Routing header-value that is set to "no" has no special
   security properties.  At most, it is a request for behavior within
   SIP intermediaries.  That said, if the Geolocation-Routing header-
   value is set to "no", SIP intermediaries are still to process the SIP
   request and send it further downstream within the signaling path if
   there are no errors present in this SIP request.

   The Geolocation-Routing header field satisfies the recommendations
   made in <a href="rfc5606.html#section-3.5">Section&nbsp;3.5 of RFC 5606</a> [<a href="rfc5606.html" title="&quot;Implications of 'retransmission-allowed' for SIP Location Conveyance&quot;">RFC5606</a>] regarding indication of
   permission to use location-based routing in SIP.

   SIP implementations are advised to pay special attention to the
   policy elements for location retransmission and retention described
   in <a href="rfc4119.html">RFC 4119</a>.

   The Geolocation-Routing header field cannot appear without a header-
   value in a SIP request or response (i.e., a null value is not
   allowed).  The absence of a Geolocation-Routing header-value in a SIP
   request is always the same as the following header field:

      Geolocation-Routing: no

   The Geolocation-Routing header field MAY be present without a
   Geolocation header field in the same SIP request.  This concept is
   further explored in <a href="#section-4.2.1">Section 4.2.1</a>.

<span class="h4"><a class="selflink" name="section-4.2.1" href="#section-4.2.1">4.2.1</a>.  Explaining Geolocation-Routing Header-Value States</span>

   The Geolocation header field contains a Target's location, and it
   MUST NOT be present if there is no location information in this SIP
   request.  The location information is contained in one or more
   locationValues.  These locationValues MAY be contained in a single
   Geolocation header field or distributed among multiple Geolocation
   header fields.  (See <a href="rfc3261.html#section-7.3.1">Section&nbsp;7.3.1 of RFC 3261</a>.)

   The Geolocation-Routing header field indicates whether or not SIP
   intermediaries can view and then route this SIP request based on the
   included (directly or indirectly) location information.  The
   Geolocation-Routing header field MUST NOT appear more than once in
   any SIP request, and MUST NOT lack a header-value.  The default or
   implied policy of a SIP request that does not have a Geolocation-
   Routing header field is the same as if one were present and the
   header-value were set to "no".








<span class="grey">Polk, et al.                 Standards Track                   [Page 12]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   There are only three possible states regarding the Geolocation-
   Routing header field:

   - "no"
   - "yes"
   - no header-field present in this SIP request

   The expected results in each state are as follows:

   If the Geolocation-Routing    Only possible interpretations:
   --------------------------    -----------------------------
   "no"                          SIP intermediaries MUST NOT process
                                 included geolocation information
                                 within this SIP request.

                                 SIP intermediaries inserting a
                                 locationValue into a Geolocation
                                 header field (whether adding to an
                                 existing header-value or inserting the
                                 Geolocation header field for the first
                                 time) MUST NOT modify or delete the
                                 received "no" header-value.

   "yes"                         SIP intermediaries can process
                                 included geolocation information
                                 within this SIP request and can
                                 change the policy to "no" for
                                 intermediaries further downstream.

   Geolocation-Routing absent    If a Geolocation header field exists
                                 (meaning a locationValue is already
                                 present), a SIP intermediary MUST
                                 interpret the lack of a
                                 Geolocation-Routing header field as if
                                 there were one present and the
                                 header-value is set to "no".

                                 If there is no Geolocation header
                                 field in this SIP request, the default
                                 Geolocation-Routing is open and can be
                                 set by a SIP intermediary or not at
                                 all.









<span class="grey">Polk, et al.                 Standards Track                   [Page 13]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  424 (Bad Location Information) Response Code</span>

   This SIP extension creates a new location-specific response code,
   defined as follows:

      424 (Bad Location Information)

   The 424 (Bad Location Information) response code is a rejection of
   the request due to its location contents, indicating location
   information that was malformed or not satisfactory for the
   recipient's purpose or could not be dereferenced.

   A SIP intermediary can also reject a location it receives from a
   Target when it understands the Target to be in a different location.
   The proper handling of this scenario, described in <a href="#section-3.4">Section 3.4</a>, is
   for the SIP intermediary to include the proper location in the 424
   response.  This SHOULD be included in the response as a MIME message
   body (i.e., a location value) rather than as a URI; however, in cases
   where the intermediary is willing to share location with recipients
   but not with a user agent, a reference might be necessary.

   As mentioned in <a href="#section-3.4">Section 3.4</a>, it might be the case that the
   intermediary does not want to chance providing less accurate location
   information than the user agent; thus, it will compose its
   understanding of where the user agent is in a separate &lt;geopriv&gt;
   element of the same Presence Information Data Format Location Object
   (PIDF-LO) [<a href="rfc4119.html" title="&quot;A Presence-based GEOPRIV Location Object Format&quot;">RFC4119</a>] message body in the SIP response (which also
   contains the Target's version of where it is).  Therefore, both
   locations are included -- each with different &lt;method&gt; elements.  The
   proper reaction of the user agent is to generate a new SIP request
   that includes this composed location object, and send it towards the
   original LR.  SIP intermediaries can verify that subsequent requests
   properly insert the suggested location information before forwarding
   said requests.

   SIP intermediaries that are forwarding (as opposed to generating) a
   424 response MUST NOT add, modify, or delete any location appearing
   in that response.  This specifically applies to intermediaries that
   are between the 424 response generator and the original UAC.
   Geolocation and Geolocation-Error header fields and PIDF-LO body
   parts MUST remain unchanged, never added to or deleted.

   <a href="#section-4.4">Section 4.4</a> describes a Geolocation-Error header field to provide
   more detail about what was wrong with the location information in the
   request.  This header field MUST be included in the 424 response.






<span class="grey">Polk, et al.                 Standards Track                   [Page 14]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   It is only appropriate to generate a 424 response when the responding
   entity needs a locationValue and there are no values in the request
   that are usable by the responder, or when the responder has
   additional location information to provide.  The latter case is shown
   in Figure 4 of <a href="#section-3.4">Section 3.4</a>.  There, a SIP intermediary is informing
   the upstream UA which location to include in the next SIP request.

   A 424 response MUST NOT be sent in response to a request that lacks a
   Geolocation header entirely, as the user agent in that case may not
   support this extension at all.  If a SIP intermediary inserted a
   locationValue into a SIP request where one was not previously
   present, it MUST take any and all responsibility for the corrective
   action if it receives a 424 response to a SIP request it sent.

   A 424 (Bad Location Information) response is a final response within
   a transaction and MUST NOT terminate an existing dialog.

<span class="h3"><a class="selflink" name="section-4.4" href="#section-4.4">4.4</a>.  The Geolocation-Error Header Field</span>

   As discussed in <a href="#section-4.3">Section 4.3</a>, more granular error notifications
   specific to location errors within a received request are required if
   the location inserting entity is to know what was wrong within the
   original request.  The Geolocation-Error header field is used for
   this purpose.

   The Geolocation-Error header field is used to convey location-
   specific errors within a response.  The Geolocation-Error header
   field has the following ABNF [<a href="rfc5234.html" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>]:

   message-header           =/ Geolocation-Error
                               ; (message-header from <a href="rfc3261.html">RFC 3261</a>)
   Geolocation-Error        =  "Geolocation-Error" HCOLON
                               locationErrorValue
   locationErrorValue       =  location-error-code
                                *(SEMI location-error-params)
   location-error-code      =  1*3DIGIT
   location-error-params    =  location-error-code-text
                               / generic-param ; from <a href="rfc3261.html">RFC 3261</a>
   location-error-code-text =  "code" EQUAL quoted-string
                               ; from <a href="rfc3261.html">RFC 3261</a>

   HCOLON, SEMI, and EQUAL are defined in [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>].  DIGIT is defined
   in [<a href="rfc5234.html" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>].

   The Geolocation-Error header field MUST contain only one
   locationErrorValue to indicate what was wrong with the locationValue
   the Location Recipient determined was bad.  The locationErrorValue
   contains a 3-digit error code indicating what was wrong with the



<span class="grey">Polk, et al.                 Standards Track                   [Page 15]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   location in the request.  This error code has a corresponding quoted
   error text string that is human understandable.  The text string is
   OPTIONAL, but RECOMMENDED for human readability, similar to the
   string phrase used for SIP response codes.  That said, the strings
   are complete enough for rendering to the user, if so desired.  The
   strings in this document are recommendations, and are not
   standardized -- meaning an operator can change the strings -- but
   MUST NOT change the meaning of the error code.  Similar to how <a href="rfc3261.html">RFC</a>
   <a href="rfc3261.html">3261</a> specifies, there MUST NOT be more than one string per error
   code.

   The Geolocation-Error header field MAY be included in any response to
   one of the SIP Methods mentioned in <a href="#section-4.1">Section 4.1</a>, so long as a
   locationValue was in the request part of the same transaction.  For
   example, Alice includes her location in an INVITE to Bob.  Bob can
   accept this INVITE, thus creating a dialog, even though his UA
   determined the location contained in the INVITE was bad.  Bob merely
   includes a Geolocation-Error header value in the 200 OK response to
   the INVITE informing Alice the INVITE was accepted but the location
   provided was bad.

   If, on the other hand, Bob cannot accept Alice's INVITE without a
   suitable location, a 424 (Bad Location Information) response is sent.
   This message flow is shown in Figures 1, 2, or 3 in Sections <a href="#section-3.1">3.1</a>,
   3.2, and 3.3, respectively.

   If Alice is deliberately leaving location information out of the LO
   because she does not want Bob to have this additional information,
   implementations should be aware that Bob could repeatedly error in
   order to receive more location information about Alice in a
   subsequent SIP request.  Implementations MUST be on guard for this,
   by not allowing continually more information to be revealed unless it
   is clear that any LR is permitted by Alice to know all that Alice
   knows about her location.  A limit on the number of such rejections
   to learn more location information SHOULD be configurable, with a
   RECOMMENDED maximum of three times for each related transaction.

   A SIP intermediary that requires Alice's location in order to
   properly process Alice's INVITE also sends a 424 response with a
   Geolocation-Error code.  This message flow is shown in Figure 4 of
   <a href="#section-3.4">Section 3.4</a>.

   If more than one locationValue is present in a SIP request and at
   least one locationValue is determined to be valid by the LR, the
   location in that SIP request MUST be considered good as far as
   location is concerned, and no Geolocation-Error is to be sent.





<span class="grey">Polk, et al.                 Standards Track                   [Page 16]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   Here is an initial list of location-based error code ranges for any
   SIP response, including provisional responses (other than 100 Trying)
   and the new 424 (Bad Location Information) response.  These error
   codes are divided into three categories, based on how the response
   receiver should react to these errors.  There MUST be no more than
   one Geolocation-Error code in a SIP response, regardless of how many
   locationValues there are in the correlating SIP request.  When more
   than one locationValue is present in a SIP request, this mechanism
   provides no indication to which one the Geolocation-Error code
   corresponds.  If multiple errors are present, the LR applies local
   policy to select one.

   o  1XX errors mean the LR cannot process the location within the
      request:

      A non-exclusive list of reasons for returning a 1XX is as follows:

      - the location was not present or could not be found in the SIP
        request,

      - there was not enough location information to determine where the
        Target was,

      - the location information was corrupted or known to be
        inaccurate.

   o  2XX errors mean some specific permission is necessary to process
      the included location information.

   o  3XX errors mean there was trouble dereferencing the Location URI
      sent.

   Dereference attempts to the same request SHOULD be limited to 10
   attempts within a few minutes.  This number SHOULD be configurable,
   but result in a Geolocation-Error: 300 error once reached.

   It should be noted that for non-INVITE transactions, the SIP response
   will likely be sent before the dereference response has been
   received.  This document does not alter that SIP protocol reality.
   This means the receiver of any non-INVITE response to a request
   containing location SHOULD NOT consider a 200 OK response to mean the
   act of dereferencing has concluded and the dereferencer  (i.e., the
   LR) has successfully received and parsed the PIDF-LO for errors and
   found none.  The end of <a href="#section-3.2">Section 3.2</a> discusses how transaction timing
   considerations lead to this requirement.






<span class="grey">Polk, et al.                 Standards Track                   [Page 17]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-18" id="page-18" href="#page-18" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   Additionally, if an LR cannot or chooses not to process location from
   a SIP request, a 500 (Server Internal Error) SHOULD be used with or
   without a configurable Retry-After header field.  There is no special
   location error code for what already exists within SIP today.

   Within each of these ranges, there is a top-level error as follows:

   Geolocation-Error: 100 ; code="Cannot Process Location"

   Geolocation-Error: 200 ; code="Permission To Use Location
                                  Information"

   Geolocation-Error: 300 ; code="Dereference Failure"

   If an error recipient cannot process a specific error code (such as
   the 201 or 202 below), perhaps because it does not understand that
   specific error code, the error recipient SHOULD process the error
   code as if it originally were a top-level error code where the X in
   X00 matches the specific error code.  If the error recipient cannot
   process a non-100 error code, for whatever reason, then the error
   code 100 MUST be processed.

   There are two specific Geolocation-Error codes necessary to include
   in this document, both have to do with permissions necessary to
   process the SIP request; they are

   Geolocation-Error: 201 ; code="Permission To Retransmit Location
                                  Information to a Third Party"

   This location error is specific to having the PIDF-LO [<a href="rfc4119.html" title="&quot;A Presence-based GEOPRIV Location Object Format&quot;">RFC4119</a>]
   &lt;retransmission-allowed&gt; element set to "no".  This location error is
   stating it requires permission (i.e., PIDF-LO &lt;retransmission-
   allowed&gt; element set to "yes") to process this SIP request further.
   If the LS sending the location information does not want to give this
   permission, it will not change this permission in a new request.  If
   the LS wants this message processed with the &lt;retransmission-allowed&gt;
   element set to "yes", it MUST choose another logical path (if one
   exists) for this SIP request.

   Geolocation-Error: 202 ; code="Permission to Route based on Location
                                  Information"

   This location error is specific to having the Geolocation-Routing
   header value set to "no".  This location error is stating it requires
   permission (i.e., the Geolocation-Routing header value set to "yes")
   to process this SIP request further.  If the LS sending the location
   information does not want to give this permission, it will not change
   this permission in a new request.  If the LS wants this message



<span class="grey">Polk, et al.                 Standards Track                   [Page 18]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-19" id="page-19" href="#page-19" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   processed with the &lt;retransmission-allowed&gt; element set to "yes", it
   MUST choose another logical path (if one exists) for this SIP
   request.

<span class="h3"><a class="selflink" name="section-4.5" href="#section-4.5">4.5</a>.  Location URIs in Message Bodies</span>

   In the case where an LR sends a 424 response and wishes to
   communicate suitable location-by-reference rather than location-by-
   value, the 424 response MUST include a content-indirection body per
   <a href="rfc4483.html">RFC 4483</a>.

<span class="h3"><a class="selflink" name="section-4.6" href="#section-4.6">4.6</a>.  Location Profile Negotiation</span>

   The following is part of the discussion started in <a href="#section-3">Section 3</a>, Figure
   2, which introduced the concept of sending location indirectly.

   If a location URI is included in a SIP request, the sending user
   agent MUST also include a Supported header field indicating which
   location profiles it supports.  Two option tags for location profiles
   are defined by this document: "geolocation-sip" and "geolocation-
   http".  Future specifications MAY define further location profiles
   per the IANA policy described in <a href="#section-8.3">Section 8.3</a>.

   The "geolocation-sip" option tag signals support for acquiring
   location information via the presence event package of SIP [<a href="rfc3856.html" title="&quot;A Presence Event Package for the Session Initiation Protocol (SIP)&quot;">RFC3856</a>].
   A location recipient who supports this option can send a SUBSCRIBE
   request and parse a resulting NOTIFY containing a PIDF-LO object.
   The URI schemes supported by this option include "sip", "sips", and
   "pres".

   The "geolocation-http" option tag signals support for acquiring
   location information via HTTP [<a href="rfc2616.html" title="&quot;Hypertext Transfer Protocol -- HTTP/1.1&quot;">RFC2616</a>].  A location recipient who
   supports this option can request location with an HTTP GET and parse
   a resulting 200 response containing a PIDF-LO object.  The URI
   schemes supported by this option include "http" and "https".  A
   failure to parse the 200 response, for whatever reason, will return a
   "Dereference Failure" indication to the original location sending
   user agent to inform it that location was not delivered as intended.

   If the location URI receiver does not understand the URI scheme sent
   to it, it will return an Unsupported header value of the option tag
   from the SIP request, and include the option tag of the preferred URI
   scheme in the response's Supported header field.

   See [<a href="#ref-GEO-FILTERS">GEO-FILTERS</a>] or [<a href="#ref-HELD-DEREF">HELD-DEREF</a>] for more details on dereferencing
   location information.





<span class="grey">Polk, et al.                 Standards Track                   [Page 19]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-20" id="page-20" href="#page-20" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Geolocation Examples</span>

<span class="h3"><a class="selflink" name="section-5.1" href="#section-5.1">5.1</a>.  Location-by-Value (in Coordinate Format)</span>

   This example shows an INVITE message with a coordinate location.  In
   this example, the SIP request uses a sips-URI [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>], meaning this
   message is protected using Transport Layer Security (TLS) on a hop-
   by-hop basis.

   INVITE sips:bob@biloxi.example.com SIP/2.0
   Via: SIPS/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bK74bf9
   Max-Forwards: 70
   To: Bob &lt;sips:bob@biloxi.example.com&gt;
   From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   Geolocation: &lt;cid:target123@atlanta.example.com&gt;
   Geolocation-Routing: no
   Accept: application/sdp, application/pidf+xml
   CSeq: 31862 INVITE
   Contact: &lt;sips:alice@atlanta.example.com&gt;
   Content-Type: multipart/mixed; boundary=boundary1
   Content-Length: ...

   --boundary1

   Content-Type: application/sdp

   ...Session Description Protocol (SDP) goes here

   --boundary1

   Content-Type: application/pidf+xml
   Content-ID: &lt;target123@atlanta.example.com&gt;
   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
       &lt;presence
          xmlns="urn:ietf:params:xml:ns:pidf"
          xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10"
          xmlns:gbp="urn:ietf:params:xml:ns:pidf:geopriv10:basicPolicy"
          xmlns:cl="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr"
          xmlns:gml="http://www.opengis.net/gml"
          xmlns:dm="urn:ietf:params:xml:ns:pidf:data-model"
          entity="pres:alice@atlanta.example.com"&gt;
        &lt;dm:device id="target123-1"&gt;
          &lt;gp:geopriv&gt;
            &lt;gp:location-info&gt;
              &lt;gml:location&gt;
                &lt;gml:Point srsName="urn:ogc:def:crs:EPSG::4326"&gt;
                  &lt;gml:pos&gt;32.86726 -97.16054&lt;/gml:pos&gt;



<span class="grey">Polk, et al.                 Standards Track                   [Page 20]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-21" id="page-21" href="#page-21" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


                &lt;/gml:Point&gt;
             &lt;/gml:location&gt;
            &lt;/gp:location-info&gt;
            &lt;gp:usage-rules&gt;
              &lt;gbp:retransmission-allowed&gt;false
              &lt;/gbp:retransmission-allowed&gt;
              &lt;gbp:retention-expiry&gt;2010-11-14T20:00:00Z
              &lt;/gbp:retention-expiry&gt;
            &lt;/gp:usage-rules&gt;
            &lt;gp:method&gt;802.11&lt;/gp:method&gt;
          &lt;/gp:geopriv&gt;
          &lt;dm:deviceID&gt;mac:1234567890ab&lt;/dm:deviceID&gt;
          &lt;dm:timestamp&gt;2010-11-04T20:57:29Z&lt;/dm:timestamp&gt;
        &lt;/dm:device&gt;
      &lt;/presence&gt;
   --boundary1--

   The Geolocation header field from the above INVITE:

      Geolocation: &lt;cid:target123@atlanta.example.com&gt;

   ... indicates the content-ID location [<a href="rfc2392.html" title="&quot;Content-ID and Message-ID Uniform Resource Locators&quot;">RFC2392</a>] within the multipart
   message body of where location information is.  The other message
   body part is SDP.  The "cid:" eases message body parsing and
   disambiguates multiple parts of the same type.

   If the Geolocation header field did not contain a "cid:" scheme, for
   example, it could look like this location URI:

      Geolocation: &lt;sips:target123@server5.atlanta.example.com&gt;

   ...  the existence of a non-"cid:" scheme indicates this is a
   location URI, to be dereferenced to learn the Target's location.  Any
   node wanting to know where the target is located would subscribe to
   the SIP presence event package [<a href="rfc3856.html" title="&quot;A Presence Event Package for the Session Initiation Protocol (SIP)&quot;">RFC3856</a>] at:

      sips:target123@server5.atlanta.example.com

   (see Figure 2 in <a href="#section-3.2">Section 3.2</a> for this message flow).

<span class="h3"><a class="selflink" name="section-5.2" href="#section-5.2">5.2</a>.  Two Locations Composed in Same Location Object Example</span>

   This example shows the INVITE message after a SIP intermediary
   rejected the original INVITE (say, the one in <a href="#section-5.1">Section 5.1</a>).  This
   INVITE contains the composed LO sent by the SIP intermediary that
   includes where the intermediary understands Alice to be.  The rules
   of <a href="rfc5491.html">RFC 5491</a> [<a href="rfc5491.html" title="&quot;GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations&quot;">RFC5491</a>] are followed in this construction.




<span class="grey">Polk, et al.                 Standards Track                   [Page 21]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-22" id="page-22" href="#page-22" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   This example is here, but ought not be taken as occurring very often.
   In fact, this example is believed to be a corner case of location
   conveyance applicability.

   INVITE sips:bob@biloxi.example.com SIP/2.0
   Via: SIPS/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bK74bf0
   Max-Forwards: 70
   To: Bob &lt;sips:bob@biloxi.example.com&gt;
   From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=9fxced76sl
   Call-ID: 3848276298220188512@atlanta.example.com
   Geolocation: &lt;cid:target123@atlanta.example.com&gt;
   Geolocation-Routing: no
   Accept: application/sdp, application/pidf+xml
   CSeq: 31863 INVITE
   Contact: &lt;sips:alice@atlanta.example.com&gt;
   Content-Type: multipart/mixed; boundary=boundary1
   Content-Length: ...

   --boundary1

   Content-Type: application/sdp

   ...SDP goes here

   --boundary1

   Content-Type: application/pidf+xml
   Content-ID: &lt;target123@atlanta.example.com&gt;
   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
       &lt;presence
          xmlns="urn:ietf:params:xml:ns:pidf"
          xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10"
          xmlns:gbp="urn:ietf:params:xml:ns:pidf:geopriv10:basicPolicy"
          xmlns:dm="urn:ietf:params:xml:ns:pidf:data-model"
          xmlns:cl="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr"
          xmlns:gml="http://www.opengis.net/gml"
          entity="pres:alice@atlanta.example.com"&gt;
        &lt;dm:device id="target123-1"&gt;
          &lt;gp:geopriv&gt;
            &lt;gp:location-info&gt;
              &lt;gml:location&gt;
                &lt;gml:Point srsName="urn:ogc:def:crs:EPSG::4326"&gt;
                  &lt;gml:pos&gt;32.86726 -97.16054&lt;/gml:pos&gt;
                &lt;/gml:Point&gt;
              &lt;/gml:location&gt;
            &lt;/gp:location-info&gt;
            &lt;gp:usage-rules&gt;
              &lt;gbp:retransmission-allowed&gt;false



<span class="grey">Polk, et al.                 Standards Track                   [Page 22]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-23" id="page-23" href="#page-23" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


              &lt;/gbp:retransmission-allowed&gt;
             &lt;gbp:retention-expiry&gt;2010-11-14T20:00:00Z
              &lt;/gbp:retention-expiry&gt;
            &lt;/gp:usage-rules&gt;
            &lt;gp:method&gt;802.11&lt;/gp:method&gt;
          &lt;/gp:geopriv&gt;
          &lt;dm:deviceID&gt;mac:1234567890ab&lt;/dm:deviceID&gt;
          &lt;dm:timestamp&gt;2010-11-04T20:57:29Z&lt;/dm:timestamp&gt;
        &lt;/dm:device&gt;
        &lt;dm:person id="target123"&gt;
          &lt;gp:geopriv&gt;
            &lt;gp:location-info&gt;
              &lt;cl:civicAddress&gt;
                &lt;cl:country&gt;US&lt;/cl:country&gt;
                &lt;cl:A1&gt;Texas&lt;/cl:A1&gt;
                &lt;cl:A3&gt;Colleyville&lt;/cl:A3&gt;
                &lt;cl:RD&gt;Treemont&lt;/cl:RD&gt;
                &lt;cl:STS&gt;Circle&lt;/cl:STS&gt;
                &lt;cl:HNO&gt;3913&lt;/cl:HNO&gt;
                &lt;cl:FLR&gt;1&lt;/cl:FLR&gt;
                &lt;cl:NAM&gt;Haley's Place&lt;/cl:NAM&gt;
                &lt;cl:PC&gt;76034&lt;/cl:PC&gt;
              &lt;/cl:civicAddress&gt;
            &lt;/gp:location-info&gt;
            &lt;gp:usage-rules&gt;
              &lt;gbp:retransmission-allowed&gt;false
              &lt;/gbp:retransmission-allowed&gt;
              &lt;gbp:retention-expiry&gt;2010-11-14T20:00:00Z
              &lt;/gbp:retention-expiry&gt;
            &lt;/gp:usage-rules&gt;
            &lt;gp:method&gt;triangulation&lt;/gp:method&gt;
          &lt;/gp:geopriv&gt;
          &lt;dm:timestamp&gt;2010-11-04T12:28:04Z&lt;/dm:timestamp&gt;
        &lt;/dm:person&gt;
      &lt;/presence&gt;
   --boundary1--

<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Geopriv Privacy Considerations</span>

   Location information is considered by most to be highly sensitive
   information, requiring protection from eavesdropping and altering in
   transit.  [<a href="rfc3693.html" title="&quot;Geopriv Requirements&quot;">RFC3693</a>] originally articulated rules to be followed by
   any protocol wishing to be considered a "Using Protocol", specifying
   how a transport protocol meets those rules.  [<a href="rfc6280.html" title="&quot;An Architecture for Location and Location Privacy in Internet Applications&quot;">RFC6280</a>] updates the
   guidance in <a href="rfc3693.html">RFC 3693</a> to include subsequently introduced entities and
   concepts in the geolocation architecture.





<span class="grey">Polk, et al.                 Standards Track                   [Page 23]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-24" id="page-24" href="#page-24" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   <a href="rfc5606.html">RFC 5606</a> explores the difficulties inherent in mapping the GEOPRIV
   architecture onto SIP elements.  In particular, the difficulties of
   defining and identifying recipients of location information are given
   in that document, along with guidance in <a href="#section-3.3.2">Section 3.3.2</a> on the use of
   location-by-reference mechanisms to preserve confidentiality of
   location information from unauthorized recipients.

   In a SIP deployment, location information may be added by any of
   several elements, including the originating user agent or a proxy
   server.  In all cases, the Rule Maker associated with that location
   information decides which entity adds location information and what
   access control rules apply.  For example, a SIP user agent that does
   not support the Geolocation header may rely on a proxy server under
   the direction of the Rule Maker adding a Geolocation header with a
   reference to location information.  The manner in which the Rule
   Maker operates on these devices is outside the scope of this
   document.

   The manner in which SIP implementations honor the Rule Maker's
   stipulations for access control rules (including retention and
   retransmission) is application specific and not within the scope of
   SIP protocol operations.  Entities in SIP networks that fulfill the
   architectural roles of the Location Server or Location Recipient
   treat the privacy rules associated with location information per the
   guidance in <a href="rfc6280.html#section-4.2.1">[RFC6280], Section&nbsp;4.2.1</a>.  In particular, <a href="rfc4119.html">RFC 4119</a>
   (especially <a href="#section-2.2.2">Section 2.2.2</a>) gives guidance for handling access control
   rules; SIP implementations should furthermore consult the
   recommendations in <a href="rfc5606.html">RFC 5606</a>.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Security Considerations</span>

   Conveyance of physical location of a UA raises privacy concerns, and
   depending on use, there probably will be authentication and integrity
   concerns.  This document calls for conveyance to be accomplished
   through secure mechanisms, like Secure/Multipurpose Internet Mail
   Extensions (S/MIME) encrypting message bodies (although this is not
   widely deployed), TLS protecting the overall signaling or conveyance
   location-by-reference and requiring all entities that dereference
   location to authenticate themselves.  In location-based routing
   cases, encrypting the location payload with an end-to-end mechanism
   such as S/MIME is problematic because one or more proxies on the path
   need the ability to read the location information to retarget the
   message to the appropriate new destination User Agent Server (UAS).
   Data can only be encrypted to a particular, anticipated target, and
   thus if multiple recipients need to inspect a piece of data, and
   those recipients cannot be predicted by the sender of data,
   encryption is not a very feasible choice.  Securing the location hop-
   by-hop, using TLS, protects the message from eavesdropping and



<span class="grey">Polk, et al.                 Standards Track                   [Page 24]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-25" id="page-25" href="#page-25" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   modification in transit, but exposes the information to all proxies
   on the path as well as the endpoint.  In most cases, the UA has no
   trust relationship with the proxy or proxies providing location-based
   routing services, so such end-to-middle solutions might not be
   appropriate either.

   When location information is conveyed by reference, however, one can
   properly authenticate and authorize each entity that wishes to
   inspect location information.  This does not require that the sender
   of data anticipate who will receive data, and it does permit multiple
   entities to receive it securely; however, it does not obviate the
   need for pre-association between the sender of data and any
   prospective recipients.  Obviously, in some contexts, this pre-
   association cannot be presumed; when it is not, effectively
   unauthenticated access to location information MUST be permitted.  In
   this case, choosing pseudorandom URIs for location-by-reference,
   coupled with path encryption like Session Initiation Protocol Secure
   (SIPS), can help to ensure that only entities on the SIP signaling
   path learn the URI, and thus restores rough parity with sending
   location-by-value.

   Location information is especially sensitive when the identity of its
   Target is obvious.  Note that there is the ability, according to
   [<a href="rfc3693.html" title="&quot;Geopriv Requirements&quot;">RFC3693</a>], to have an anonymous identity for the Target's location.
   This is accomplished by the use of an unlinkable pseudonym in the
   "entity=" attribute of the &lt;presence&gt; element [<a href="rfc4479.html" title="&quot;A Data Model for Presence&quot;">RFC4479</a>].  Though,
   this can be problematic for routing messages based on location
   (covered in [<a href="rfc4479.html" title="&quot;A Data Model for Presence&quot;">RFC4479</a>]).  Moreover, anyone fishing for information
   would correlate the identity at the SIP layer with that of the
   location information referenced by SIP signaling.

   When a UA inserts location, the UA sets the policy on whether to
   reveal its location along the signaling path -- as discussed in
   <a href="#section-4">Section 4</a>, as well as flags in the PIDF-LO [<a href="rfc4119.html" title="&quot;A Presence-based GEOPRIV Location Object Format&quot;">RFC4119</a>].  UAC
   implementations MUST make such capabilities conditional on explicit
   user permission, and MUST alert the user that location is being
   conveyed.

   This SIP extension offers the default ability to require permission
   to process location while the SIP request is in transit.  The default
   for this is set to "no".  There is an error explicitly describing how
   an intermediary asks for permission to view the Target's location,
   plus a rule stating the user has to be made aware of this permission
   request.







<span class="grey">Polk, et al.                 Standards Track                   [Page 25]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-26" id="page-26" href="#page-26" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   There is no end-to-end integrity on any locationValue or
   locationErrorValue header field parameter (or middle-to-end if the
   value was inserted by a intermediary), so recipients of either header
   field need to implicitly trust the header field contents, and take
   whatever precautions each entity deems appropriate given this
   situation.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  IANA Considerations</span>

   The following are the IANA considerations made by this SIP extension.
   Modifications and additions to all these registrations require a
   Standards Track RFC (Standards Action).

<span class="h3"><a class="selflink" name="section-8.1" href="#section-8.1">8.1</a>.  IANA Registration for the SIP Geolocation Header Field</span>

   The SIP Geolocation header field is created by this document, with
   its definition and rules in <a href="#section-4.1">Section 4.1</a> of this document, and it has
   been added to the IANA sip-parameters registry as follows:

   The Header Fields registry has been updated with:

     Header Name        Compact    Reference
     -----------------  -------    ---------
     Geolocation                   [<a href="rfc6442.html">RFC6442</a>]

<span class="h3"><a class="selflink" name="section-8.2" href="#section-8.2">8.2</a>.  IANA Registration for the SIP Geolocation-Routing Header Field</span>

   The SIP Geolocation-Routing header field is created by this document,
   with its definition and rules in <a href="#section-4.2">Section 4.2</a> of this document, and it
   has been added to the IANA sip-parameters registry as follows.

   The Header Fields registry has been updated with:

     Header Name          Compact    Reference
     -----------------    -------    ---------
     Geolocation-Routing             [<a href="rfc6442.html">RFC6442</a>]















<span class="grey">Polk, et al.                 Standards Track                   [Page 26]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-27" id="page-27" href="#page-27" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h3"><a class="selflink" name="section-8.3" href="#section-8.3">8.3</a>.  IANA Registration for Location Profiles</span>

   This document defines two new SIP option tags: "geolocation-sip" and
   "geolocation-http" that have been added to the IANA sip-parameters
   Options Tags registry as follows.

Name             Description                                 Reference
-----------      ------------------------------------------  ---------
geolocation-sip  The "geolocation-sip" option tag signals    [<a href="rfc6442.html">RFC6442</a>]
                 support for acquiring location information
                 via the presence event package of SIP
                 (<a href="rfc3856.html">RFC 3856</a>).  A location recipient who
                 supports this option can send a SUBSCRIBE
                 request and parse a resulting NOTIFY
                 containing a PIDF-LO object.  The URI
                 schemes supported by this option include
                 "sip", "sips", and "pres".

geolocation-http The "geolocation-http" option tag signals   [<a href="rfc6442.html">RFC6442</a>]
                 support for acquiring location information
                 via HTTP (<a href="rfc2616.html">RFC 2616</a>).  A location
                 recipient who supports this option can
                 request location with an HTTP GET and
                 parse a resulting 200 response containing
                 a PIDF-LO object.  The URI schemes
                 supported by this option include "http"
                 and "https".

   The names of profiles are SIP option tags, and the guidance in this
   document does not supersede the option tag assignment guidance in
   [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>] (which requires a Standards Action for the assignment of a
   new option tag).  However, this document does stipulate that option
   tags included to convey the name of a location profile per this
   definition MUST begin with the string "geolocation" followed by a
   dash.  All such option tags should describe protocols used to acquire
   location by reference: these tags have no relevance to location
   carried in SIP requests by value, which use standard MIME typing and
   negotiation.

<span class="h3"><a class="selflink" name="section-8.4" href="#section-8.4">8.4</a>.  IANA Registration for 424 Response Code</span>

   In the SIP Response Codes registry, the following is added

   Reference: <a href="rfc6442.html">RFC 6442</a>
   Response code: 424 (recommended number to assign)
   Default reason phrase: Bad Location Information





<span class="grey">Polk, et al.                 Standards Track                   [Page 27]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-28" id="page-28" href="#page-28" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   Registry:
     Response Code                               Reference
     ------------------------------------------  ---------
     Request Failure 4xx
       424 Bad Location Information              [<a href="rfc6442.html">RFC6442</a>]

   This SIP Response code is defined in <a href="#section-4.3">Section 4.3</a> of this document.

<span class="h3"><a class="selflink" name="section-8.5" href="#section-8.5">8.5</a>.  IANA Registration of New Geolocation-Error Header Field</span>

   The SIP Geolocation-Error header field is created by this document,
   with its definition and rules in <a href="#section-4.4">Section 4.4</a> of this document, to be
   added to the IANA sip-parameters registry with two actions

   1.  Update the Header Fields registry with:

   Registry:
     Header Name        Compact    Reference
     -----------------  -------    ---------
     Geolocation-Error             [<a href="rfc6442.html">RFC6442</a>]

   2.  In the portion titled "Header Field Parameters and Parameter
       Values", add:
                                            Predefined
   Header Field        Parameter Name       Values      Reference
   -----------------   -------------------  ----------  ---------
   Geolocation-Error   code                 yes         [<a href="rfc6442.html">RFC6442</a>]

<span class="h3"><a class="selflink" name="section-8.6" href="#section-8.6">8.6</a>.  IANA Registration for the SIP Geolocation-Error Codes</span>

   This document creates a new registry for SIP, called "Geolocation-
   Error Codes".  Geolocation-Error codes provide reason for the error
   discovered by Location Recipients, categorized by action to be taken
   by error recipient.  The initial values for this registry are shown
   below.

   Registry Name: Geolocation-Error Codes
   Reference: [<a href="rfc6442.html">RFC6442</a>]
   Registration Procedures: Specification Required

   Code Default Reason Phrase                                Reference
   ---- ---------------------------------------------------  ---------
   100  "Cannot Process Location"                            [<a href="rfc6442.html">RFC6442</a>]

   200  "Permission To Use Location Information"             [<a href="rfc6442.html">RFC6442</a>]

   201  "Permission To Retransmit Location Information
         to a Third Party"                                   [<a href="rfc6442.html">RFC6442</a>]



<span class="grey">Polk, et al.                 Standards Track                   [Page 28]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-29" id="page-29" href="#page-29" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   202  "Permission to Route based on Location Information"  [<a href="rfc6442.html">RFC6442</a>]

   300  "Dereference Failure"                                [<a href="rfc6442.html">RFC6442</a>]

   Details of these error codes are in <a href="#section-4.4">Section 4.4</a> of this document.

<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  Acknowledgements</span>

   To Dave Oran for helping to shape this idea.

   To Dean Willis for guidance of the effort.

   To Allison Mankin, Dick Knight, Hannes Tschofenig, Henning
   Schulzrinne, James Winterbottom, Jeroen van Bemmel, Jean-Francois
   Mule, Jonathan Rosenberg, Keith Drage, Marc Linsner, Martin Thomson,
   Mike Hammer, Ted Hardie, Shida Shubert, Umesh Sharma, Richard Barnes,
   Dan Wing, Matt Lepinski, John Elwell, Thomas Stach, Jacqueline Lee,
   and Adam Roach for constructive feedback and nit checking.

   Special thanks to Paul Kyzivat for his help with the ABNF in this
   document and to Robert Sparks for many helpful comments and the
   proper construction of the Geolocation-Error header field.

   And finally, to Spencer Dawkins for giving this document a good
   scrubbing to make it more readable.

<span class="h2"><a class="selflink" name="section-10" href="#section-10">10</a>.  References</span>

<span class="h3"><a class="selflink" name="section-10.1" href="#section-10.1">10.1</a>.  Normative References</span>

   [<a name="ref-RFC3261" id="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

   [<a name="ref-RFC4119" id="ref-RFC4119">RFC4119</a>]  Peterson, J., "A Presence-based GEOPRIV Location Object
              Format", <a href="rfc4119.html">RFC 4119</a>, December 2005.

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-RFC2392" id="ref-RFC2392">RFC2392</a>]  Levinson, E., "Content-ID and Message-ID Uniform Resource
              Locators", <a href="rfc2392.html">RFC 2392</a>, August 1998.

   [<a name="ref-RFC3856" id="ref-RFC3856">RFC3856</a>]  Rosenberg, J., "A Presence Event Package for the Session
              Initiation Protocol (SIP)", <a href="rfc3856.html">RFC 3856</a>, August 2004.





<span class="grey">Polk, et al.                 Standards Track                   [Page 29]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-30" id="page-30" href="#page-30" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


   [<a name="ref-RFC3859" id="ref-RFC3859">RFC3859</a>]  Peterson, J., "Common Profile for Presence (CPP)", <a href="rfc3859.html">RFC</a>
              <a href="rfc3859.html">3859</a>, August 2004.

   [<a name="ref-RFC3428" id="ref-RFC3428">RFC3428</a>]  Campbell, B., Ed., Rosenberg, J., Schulzrinne, H.,
              Huitema, C., and D. Gurle, "Session Initiation Protocol
              (SIP) Extension for Instant Messaging", <a href="rfc3428.html">RFC 3428</a>, December
              2002.

   [<a name="ref-RFC3311" id="ref-RFC3311">RFC3311</a>]  Rosenberg, J., "The Session Initiation Protocol (SIP)
              UPDATE Method", <a href="rfc3311.html">RFC 3311</a>, October 2002.

   [<a name="ref-RFC3265" id="ref-RFC3265">RFC3265</a>]  Roach, A., "Session Initiation Protocol (SIP)-Specific
              Event Notification", <a href="rfc3265.html">RFC 3265</a>, June 2002.

   [<a name="ref-RFC6086" id="ref-RFC6086">RFC6086</a>]  Holmberg, C., Burger, E., and H. Kaplan, "Session
              Initiation Protocol (SIP) INFO Method and Package
              Framework", <a href="rfc6086.html">RFC 6086</a>, January 2011.

   [<a name="ref-RFC3515" id="ref-RFC3515">RFC3515</a>]  Sparks, R., "The Session Initiation Protocol (SIP) Refer
              Method", <a href="rfc3515.html">RFC 3515</a>, April 2003.

   [<a name="ref-RFC3903" id="ref-RFC3903">RFC3903</a>]  Niemi, A., Ed., "Session Initiation Protocol (SIP)
              Extension for Event State Publication", <a href="rfc3903.html">RFC 3903</a>, October
              2004.

   [<a name="ref-RFC5234" id="ref-RFC5234">RFC5234</a>]  Crocker, D., Ed., and P. Overell, "Augmented BNF for
              Syntax Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>, January
              2008.

   [<a name="ref-RFC4479" id="ref-RFC4479">RFC4479</a>]  Rosenberg, J., "A Data Model for Presence", <a href="rfc4479.html">RFC 4479</a>, July
              2006.

   [<a name="ref-RFC4483" id="ref-RFC4483">RFC4483</a>]  Burger, E., Ed., "A Mechanism for Content Indirection in
              Session Initiation Protocol (SIP) Messages", <a href="rfc4483.html">RFC 4483</a>, May
              2006.

   [<a name="ref-RFC5491" id="ref-RFC5491">RFC5491</a>]  Winterbottom, J., Thomson, M., and H. Tschofenig, "GEOPRIV
              Presence Information Data Format Location Object (PIDF-LO)
              Usage Clarification, Considerations, and Recommendations",
              <a href="rfc5491.html">RFC 5491</a>, March 2009.

   [<a name="ref-RFC5870" id="ref-RFC5870">RFC5870</a>]  Mayrhofer, A. and C. Spanring, "A Uniform Resource
              Identifier for Geographic Locations ('geo' URI)", <a href="rfc5870.html">RFC</a>
              <a href="rfc5870.html">5870</a>, June 2010.

   [<a name="ref-RFC2616" id="ref-RFC2616">RFC2616</a>]  Fielding, R., Gettys, J., Mogul, J., Frystyk, H.,
              Masinter, L., Leach, P., and T. Berners-Lee, "Hypertext
              Transfer Protocol -- HTTP/1.1", <a href="rfc2616.html">RFC 2616</a>, June 1999.



<span class="grey">Polk, et al.                 Standards Track                   [Page 30]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-31" id="page-31" href="#page-31" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h3"><a class="selflink" name="section-10.2" href="#section-10.2">10.2</a>.  Informative References</span>

   [<a name="ref-RFC3693" id="ref-RFC3693">RFC3693</a>]  Cuellar, J., Morris, J., Mulligan, D., Peterson, J., and
              J. Polk, "Geopriv Requirements", <a href="rfc3693.html">RFC 3693</a>, February 2004.

   [<a name="ref-RFC2818" id="ref-RFC2818">RFC2818</a>]  Rescorla, E., "HTTP Over TLS", <a href="rfc2818.html">RFC 2818</a>, May 2000.


   [<a name="ref-RFC5606" id="ref-RFC5606">RFC5606</a>]  Peterson, J., Hardie, T., and J. Morris, "Implications of
              'retransmission-allowed' for SIP Location Conveyance", <a href="rfc5606.html">RFC</a>
              <a href="rfc5606.html">5606</a>, August 2009.

   [<a name="ref-GEO-FILTERS" id="ref-GEO-FILTERS">GEO-FILTERS</a>]
              Mahy, R., Rosen, B., and H. Tschofenig, "Filtering
              Location Notifications in SIP", Work in Progress, March
              2010.

   [<a name="ref-HELD-DEREF" id="ref-HELD-DEREF">HELD-DEREF</a>]
              Winterbottom, J., Tschofenig, H., Schulzrinne, H.,
              Thomson, M., and M. Dawson, "A Location Dereferencing
              Protocol Using HELD", Work in Progress, October 2011.

   [<a name="ref-RFC6280" id="ref-RFC6280">RFC6280</a>]  Barnes, R., Lepinski, M., Cooper, A., Morris, J.,
              Tschofenig, H., and H. Schulzrinne, "An Architecture for
              Location and Location Privacy in Internet Applications",
              <a href="http://tools.ietf.org/html/bcp160">BCP 160</a>, <a href="rfc6280.html">RFC 6280</a>, July 2011.

























<span class="grey">Polk, et al.                 Standards Track                   [Page 31]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-32" id="page-32" href="#page-32" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h2"><a class="selflink" name="appendix-A" href="#appendix-A">Appendix A</a>.  Requirements for SIP Location Conveyance</span>

   The following subsections address the requirements placed on the UAC,
   the UAS, as well as SIP proxies when conveying location.  This text
   is from a draft version of the location conveyance requirements that
   has since evolved into this document (<a href="rfc6442.html">RFC 6442</a>).  It has been kept
   for historical reasons.

   If a requirement is not obvious in intent, a motivational statement
   is included below it.

<span class="h1"><a class="selflink" name="appendix-A.1" href="#appendix-A.1">A.1</a>.  Requirements for a UAC Conveying Location</span>

   UAC-1  The SIP INVITE Method [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>] must support location
          conveyance.

   UAC-2  The SIP MESSAGE method [<a href="rfc3428.html" title="&quot;Session Initiation Protocol (SIP) Extension for Instant Messaging&quot;">RFC3428</a>] must support location
          conveyance.

   UAC-3  SIP Requests within a dialog should support location
          conveyance.

   UAC-4  Other SIP Requests may support location conveyance.

   UAC-5  There must be one, mandatory-to-implement means of
          transmitting location confidentially.

          Motivation:
          To guarantee interoperability.

   UAC-6  It must be possible for a UAC to update location conveyed at
          any time in a dialog, including during dialog establishment.

          Motivation:
          If a UAC has moved prior to the establishment of a dialog
          between UAs, the UAC must be able to send location
          information.  If location has been conveyed, and the UA moves,
          the UAC must be able to update the location previously
          conveyed to other parties.

   UAC-7  The privacy and security rules established within [<a href="rfc3693.html" title="&quot;Geopriv Requirements&quot;">RFC3693</a>]
          that would categorize SIP as a 'Using Protocol' MUST be met.

   UAC-8  The PIDF-LO [<a href="rfc4119.html" title="&quot;A Presence-based GEOPRIV Location Object Format&quot;">RFC4119</a>] is a mandatory-to-implement format for
          location conveyance within SIP.






<span class="grey">Polk, et al.                 Standards Track                   [Page 32]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-33" id="page-33" href="#page-33" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


          Motivation:
          Interoperability with other IETF location protocols and
          Mechanisms.

   UAC-9  There must be a mechanism for the UAC to request the UAS send
          its location.

          UAC-9 has been DEPRECATED by the SIP WG, due to the many
          problems this requirement would have caused if implemented.
          The solution is for the above UAS to send a new request to the
          original UAC with the UAS's location.

   UAC-10 There must be a mechanism to differentiate the ability of the
          UAC to convey location from the UACs lack of knowledge of its
          location.

          Motivation:
          Failure to receive location when it is expected can happen
          because the UAC does not implement this extension, or because
          the UAC implements the extension, but does not know where the
          Target is.  This may be, for example, due to the failure of
          the access network to provide a location acquisition mechanism
          the UAC supports.  These cases must be differentiated.

   UAC-11  It must be possible to convey location to proxy servers along
          the path.

          Motivation:
          Location-based routing.

<span class="h1"><a class="selflink" name="appendix-A.2" href="#appendix-A.2">A.2</a>.  Requirements for a UAS Receiving Location</span>

   The following are the requirements for location conveyance by a UAS:

   UAS-1  SIP Responses must support location conveyance.

          The SIPCORE WG reached consensus that this be allowed, but not
          to communicate the UAS's location; rather for a SIP
          intermediary to inform the UAC which location to include in
          its next SIP request (as a matter of correcting what was
          originally sent by the UAC).

   UAS-2  There must be a unique 4XX response informing the UAC it did
          not provide applicable location information.

   In addition, requirements UAC-5, 6, 7, and 8 also apply to the UAS.





<span class="grey">Polk, et al.                 Standards Track                   [Page 33]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-34" id="page-34" href="#page-34" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


<span class="h1"><a class="selflink" name="appendix-A.3" href="#appendix-A.3">A.3</a>.  Requirements for SIP Proxies and Intermediaries</span>

   The following are the requirements for location conveyance by a SIP
   proxies and intermediaries:

   Proxy-1  Proxy servers must be capable of adding a Location header
            field during processing of SIP requests.

            Motivation:
            Provide network assertion of location when UACs are unable
            to do so, or when network assertion is more reliable than
            UAC assertion of location

   Note:    Because UACs connected to SIP signaling networks can have
            widely varying access network arrangements, including VPN
            tunnels and roaming mechanisms, it can be difficult for a
            network to reliably know the location of the endpoint.
            Proxies SHOULD NOT assert location of an endpoint unless the
            SIP signaling network has reliable knowledge of the actual
            location of the Targets.

   Proxy-2  There must be a unique 4XX response informing the UAC it did
            not provide applicable location information.




























<span class="grey">Polk, et al.                 Standards Track                   [Page 34]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-35" id="page-35" href="#page-35" class="invisible"> </a>
<span class="grey"><a href="rfc6442.html">RFC 6442</a>               Location Conveyance in SIP          December 2011</span>


Authors' Addresses

   James Polk
   Cisco Systems
   3913 Treemont Circle
   Colleyville, Texas  76034

   33.00111N
   96.68142W

   Phone: +1-817-271-3552
   EMail: jmpolk@cisco.com


   Brian Rosen
   NeuStar, Inc.
   470 Conrad Dr.
   Mars, PA  16046

   40.70497N
   80.01252W

   Phone: +1 724 382 1051
   EMail: br@brianrosen.net


   Jon Peterson
   NeuStar, Inc.

   EMail: jon.peterson@neustar.biz





















Polk, et al.                 Standards Track                   [Page 35]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.106, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body>
<!-- Mirrored from tools.ietf.org/html/rfc6442 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:33:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
