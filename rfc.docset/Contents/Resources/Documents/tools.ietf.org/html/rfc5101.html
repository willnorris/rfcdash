<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5101 by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 07 Jun 2014 20:18:44 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.107" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:5101" name="DC.Identifier"/>
<meta content="This document specifies the IP Flow Information Export (IPFIX)\nprotocol that serves for transmitting IP Traffic Flow information over\nthe network. In order to transmit IP Traffic Flow information from an\nExporting Process to an information Collecting Process, a common\nrepresentation of flow data and a standard means of communicating them\nis required. This document describes how the IPFIX Data and Template\nRecords are carried over a number of transport protocols from an IPFIX\nExporting Process to an IPFIX Collecting Process. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Benoit Claise &lt;bclaise@cisco.com&gt;" name="DC.Creator"/>
<meta content="January, 2008" name="DC.Date.Issued"/>
<meta content="Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information" name="DC.Title"/>

    <link href="http://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="http://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5101 - Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc5101.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc5101" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-ipfix-protocol" title="draft-ietf-ipfix-protocol">draft-ietf-ipfix-...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5101" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc5101" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?option=rfc_search&amp;rfc_search=5101" title="IPR disclosures related to this document">IPR</a>] [<a href="http://www.rfc-editor.org/errata_search.php?rfc=5101">Errata</a>]  </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc7011.html">7011</a>                                     PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                     B. Claise, Ed.
Request for Comments: 5101                           Cisco Systems, Inc.
Category: Standards Track                                   January 2008


   <span class="h1">Specification of the IP Flow Information Export (IPFIX) Protocol</span>
            <span class="h1">for the Exchange of IP Traffic Flow Information</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Abstract

   This document specifies the IP Flow Information Export (IPFIX)
   protocol that serves for transmitting IP Traffic Flow information
   over the network.  In order to transmit IP Traffic Flow information
   from an Exporting Process to an information Collecting Process, a
   common representation of flow data and a standard means of
   communicating them is required.  This document describes how the
   IPFIX Data and Template Records are carried over a number of
   transport protocols from an IPFIX Exporting Process to an IPFIX
   Collecting Process.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. IPFIX Documents Overview ...................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
      <a href="#section-2.1">2.1</a>. Terminology Summary Table ..................................<a href="#page-9">9</a>
   <a href="#section-3">3</a>. IPFIX Message Format ...........................................<a href="#page-10">10</a>
      <a href="#section-3.1">3.1</a>. Message Header Format .....................................<a href="#page-11">11</a>
      <a href="#section-3.2">3.2</a>. Field Specifier Format ....................................<a href="#page-13">13</a>
      <a href="#section-3.3">3.3</a>. Set and Set Header Format .................................<a href="#page-14">14</a>
           <a href="#section-3.3.1">3.3.1</a>. Set Format .........................................<a href="#page-14">14</a>
           <a href="#section-3.3.2">3.3.2</a>. Set Header Format ..................................<a href="#page-15">15</a>
      <a href="#section-3.4">3.4</a>. Record Format .............................................<a href="#page-16">16</a>
           <a href="#section-3.4.1">3.4.1</a>. Template Record Format .............................<a href="#page-16">16</a>
           <a href="#section-3.4.2">3.4.2</a>. Options Template Record Format .....................<a href="#page-18">18</a>
                  <a href="#section-3.4.2.1">3.4.2.1</a>. Scope .....................................<a href="#page-19">19</a>
                  <a href="#section-3.4.2.2">3.4.2.2</a>. Options Template Record Format ............<a href="#page-20">20</a>
           <a href="#section-3.4.3">3.4.3</a>. Data Record Format .................................<a href="#page-22">22</a>
   <a href="#section-4">4</a>. Specific Reporting Requirements ................................<a href="#page-23">23</a>
      <a href="#section-4.1">4.1</a>. The Metering Process Statistics Option Template ...........<a href="#page-23">23</a>



<span class="grey">Claise, et al.              Standards Track                     [Page 1]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


      4.2. The Metering Process Reliability Statistics Option
           Template ..................................................<a href="#page-24">24</a>
      4.3. The Exporting Process Reliability Statistics
           Option Template ...........................................<a href="#page-25">25</a>
      <a href="#section-4.4">4.4</a>. The Flow Keys Option Template .............................<a href="#page-26">26</a>
   <a href="#section-5">5</a>. IPFIX Message Header "Export Time" and Flow Record Time ........<a href="#page-27">27</a>
   <a href="#section-6">6</a>. Linkage with the Information Model .............................<a href="#page-28">28</a>
      <a href="#section-6.1">6.1</a>. Encoding of IPFIX Data Types ..............................<a href="#page-28">28</a>
           <a href="#section-6.1.1">6.1.1</a>. Integral Data Types ................................<a href="#page-28">28</a>
           <a href="#section-6.1.2">6.1.2</a>. Address Types ......................................<a href="#page-28">28</a>
           <a href="#section-6.1.3">6.1.3</a>. float32 ............................................<a href="#page-28">28</a>
           <a href="#section-6.1.4">6.1.4</a>. float64 ............................................<a href="#page-28">28</a>
           <a href="#section-6.1.5">6.1.5</a>. boolean ............................................<a href="#page-28">28</a>
           <a href="#section-6.1.6">6.1.6</a>. string and octetarray ..............................<a href="#page-28">28</a>
           <a href="#section-6.1.7">6.1.7</a>. dateTimeSeconds ....................................<a href="#page-29">29</a>
           <a href="#section-6.1.8">6.1.8</a>. dateTimeMilliseconds ...............................<a href="#page-29">29</a>
           <a href="#section-6.1.9">6.1.9</a>. dateTimeMicroseconds ...............................<a href="#page-29">29</a>
           6.1.10.dateTimeNanoseconds.................................<a href="#page-29">29</a>
      <a href="#section-6.2">6.2</a>. Reduced Size Encoding of Integer and Float Types ..........<a href="#page-29">29</a>
   <a href="#section-7">7</a>. Variable-Length Information Element ............................<a href="#page-30">30</a>
   <a href="#section-8">8</a>. Template Management ............................................<a href="#page-31">31</a>
   <a href="#section-9">9</a>. The Collecting Process's Side ..................................<a href="#page-34">34</a>
   <a href="#section-10">10</a>. Transport Protocol ............................................<a href="#page-36">36</a>
      <a href="#section-10.1">10.1</a>. Transport Compliance and Transport Usage .................<a href="#page-36">36</a>
      <a href="#section-10.2">10.2</a>. SCTP .....................................................<a href="#page-37">37</a>
           <a href="#section-10.2.1">10.2.1</a>. Congestion Avoidance ..............................<a href="#page-37">37</a>
           <a href="#section-10.2.2">10.2.2</a>. Reliability .......................................<a href="#page-37">37</a>
           <a href="#section-10.2.3">10.2.3</a>. MTU ...............................................<a href="#page-37">37</a>
           <a href="#section-10.2.4">10.2.4</a>. Exporting Process .................................<a href="#page-38">38</a>
                  <a href="#section-10.2.4.1">10.2.4.1</a>. Association Establishment ................<a href="#page-38">38</a>
                  <a href="#section-10.2.4.2">10.2.4.2</a>. Association Shutdown .....................<a href="#page-38">38</a>
                  <a href="#section-10.2.4.3">10.2.4.3</a>. Stream ...................................<a href="#page-38">38</a>
                  <a href="#section-10.2.4.4">10.2.4.4</a>. Template Management ......................<a href="#page-39">39</a>
           <a href="#section-10.2.5">10.2.5</a>. Collecting Process ................................<a href="#page-39">39</a>
           <a href="#section-10.2.6">10.2.6</a>. Failover ..........................................<a href="#page-39">39</a>
      <a href="#section-10.3">10.3</a>. UDP ......................................................<a href="#page-39">39</a>
           <a href="#section-10.3.1">10.3.1</a>. Congestion Avoidance ..............................<a href="#page-39">39</a>
           <a href="#section-10.3.2">10.3.2</a>. Reliability .......................................<a href="#page-40">40</a>
           <a href="#section-10.3.3">10.3.3</a>. MTU ...............................................<a href="#page-40">40</a>
           <a href="#section-10.3.4">10.3.4</a>. Port Numbers ......................................<a href="#page-40">40</a>
           <a href="#section-10.3.5">10.3.5</a>. Exporting Process .................................<a href="#page-40">40</a>
           <a href="#section-10.3.6">10.3.6</a>. Template Management ...............................<a href="#page-40">40</a>
           <a href="#section-10.3.7">10.3.7</a>. Collecting Process ................................<a href="#page-41">41</a>
           <a href="#section-10.3.8">10.3.8</a>. Failover ..........................................<a href="#page-42">42</a>
      <a href="#section-10.4">10.4</a>. TCP ......................................................<a href="#page-42">42</a>
           <a href="#section-10.4.1">10.4.1</a>. Connection Management .............................<a href="#page-42">42</a>
                  <a href="#section-10.4.1.1">10.4.1.1</a>. Connection Establishment .................<a href="#page-42">42</a>
                  <a href="#section-10.4.1.2">10.4.1.2</a>. Graceful Connection Release ..............<a href="#page-43">43</a>



<span class="grey">Claise, et al.              Standards Track                     [Page 2]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


                  <a href="#section-10.4.1.3">10.4.1.3</a>. Restarting Interrupted Connections .......<a href="#page-43">43</a>
                  <a href="#section-10.4.1.4">10.4.1.4</a>. Failover .................................<a href="#page-43">43</a>
           <a href="#section-10.4.2">10.4.2</a>. Data Transmission .................................<a href="#page-43">43</a>
                  <a href="#section-10.4.2.1">10.4.2.1</a>. IPFIX Message Encoding ...................<a href="#page-43">43</a>
                  <a href="#section-10.4.2.2">10.4.2.2</a>. Template Management ......................<a href="#page-44">44</a>
                  <a href="#section-10.4.2.3">10.4.2.3</a>. Congestion Handling and Reliability ......<a href="#page-44">44</a>
           <a href="#section-10.4.3">10.4.3</a>. Collecting Process ................................<a href="#page-45">45</a>
   <a href="#section-11">11</a>. Security Considerations .......................................<a href="#page-46">46</a>
      <a href="#section-11.1">11.1</a>. Applicability of TLS and DTLS ............................<a href="#page-47">47</a>
      <a href="#section-11.2">11.2</a>. Usage ....................................................<a href="#page-48">48</a>
      <a href="#section-11.3">11.3</a>. Authentication ...........................................<a href="#page-48">48</a>
      <a href="#section-11.4">11.4</a>. Protection against DoS Attacks ...........................<a href="#page-48">48</a>
      <a href="#section-11.5">11.5</a>. When DTLS or TLS Is Not an Option ........................<a href="#page-50">50</a>
      <a href="#section-11.6">11.6</a>. Logging an IPFIX Attack ..................................<a href="#page-50">50</a>
      <a href="#section-11.7">11.7</a>. Securing the Collector ...................................<a href="#page-51">51</a>
   <a href="#section-12">12</a>. IANA Considerations ...........................................<a href="#page-51">51</a>
   <a href="#appendix-A">Appendix A</a>. IPFIX Encoding Examples ...............................<a href="#page-52">52</a>
      <a href="#appendix-A.1">A.1</a>. Message Header Example.....................................<a href="#page-52">52</a>
      <a href="#appendix-A.2">A.2</a>. Template Set Examples......................................<a href="#page-53">53</a>
           A.2.1. Template Set Using IETF-Specified Information
                  Elements ...........................................<a href="#page-53">53</a>
           A.2.2. Template Set Using Enterprise-Specific Information
                  Elements ...........................................<a href="#page-53">53</a>
      <a href="#appendix-A.3">A.3</a>. Data Set Example ..........................................<a href="#page-55">55</a>
      <a href="#appendix-A.4">A.4</a>. Options Template Set Examples .............................<a href="#page-56">56</a>
           A.4.1. Options Template Set Using IETF-Specified
                  Information Elements ...............................<a href="#page-56">56</a>
           A.4.2. Options Template Set Using Enterprise-Specific
                  Information Elements ...............................<a href="#page-56">56</a>
           A.4.3. Options Template Set Using an Enterprise-Specific
                  Scope ..............................................<a href="#page-57">57</a>
           <a href="#appendix-A.4.4">A.4.4</a>. Data Set Using an Enterprise-Specific Scope ........<a href="#page-58">58</a>
      <a href="#appendix-A.5">A.5</a>. Variable-Length Information Element Examples ..............<a href="#page-59">59</a>
           A.5.1. Example of Variable-Length Information Element
                  with Length Inferior to 255 Octets .................<a href="#page-59">59</a>
           A.5.2. Example of Variable-Length Information Element
                  with Length 255 to 65535 Octets ....................<a href="#page-59">59</a>
   References ........................................................<a href="#page-59">59</a>
      Normative References ...........................................<a href="#page-59">59</a>
      Informative References .........................................<a href="#page-60">60</a>
   Acknowledgments ...................................................<a href="#page-61">61</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   A data network with IP traffic primarily consists of IP flows passing
   through the network elements.  It is often interesting, useful, or
   even required to have access to information about these flows that
   pass through the network elements for administrative or other



<span class="grey">Claise, et al.              Standards Track                     [Page 3]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   purposes.  The IPFIX Collecting Process should be able to receive the
   flow information passing through multiple network elements within the
   data network.  This requires uniformity in the method of representing
   the flow information and the means of communicating the flows from
   the network elements to the collection point.  This document
   specifies the protocol to achieve these aforementioned requirements.
   This document specifies in detail the representation of different
   flows, the additional data required for flow interpretation, packet
   format, transport mechanisms used, security concerns, etc.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20IPFIX%20Documents%20Overview"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  IPFIX Documents Overview</span>

   The IPFIX protocol provides network administrators with access to IP
   flow information.  The architecture for the export of measured IP
   flow information out of an IPFIX Exporting Process to a Collecting
   Process is defined in [<a href="#ref-IPFIX-ARCH" title='"Architecture Model for IP Flow Information Export"'>IPFIX-ARCH</a>], per the requirements defined in
   [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].  This document specifies how IPFIX data records and
   templates are carried via a number of transport protocols from IPFIX
   Exporting Processes to IPFIX Collecting Processes.  IPFIX has a
   formal description of IPFIX Information Elements, their name, type
   and additional semantic information, as specified in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].
   Finally, [<a href="#ref-IPFIX-AS" title='"IPFIX Applicability"'>IPFIX-AS</a>] describes what type of applications can use the
   IPFIX protocol and how they can use the information provided.  It
   furthermore shows how the IPFIX framework relates to other
   architectures and frameworks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The definitions of the basic terms like IP Traffic Flow, Exporting
   Process, Collecting Process, Observation Points, etc.  are
   semantically identical to those found in the IPFIX requirements
   document [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].  Some of the terms have been expanded for more
   clarity when defining the protocol.  Additional terms required for
   the protocol have also been defined.  Definitions in this document
   and in [<a href="#ref-IPFIX-ARCH" title='"Architecture Model for IP Flow Information Export"'>IPFIX-ARCH</a>] are equivalent, except that definitions that are
   only relevant to the IPFIX protocol only appear here.

   The terminology summary table in <a href="#section-2.1">Section 2.1</a> gives a quick overview
   of the relationships between some of the different terms defined.








<span class="grey">Claise, et al.              Standards Track                     [Page 4]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Observation Point

      An Observation Point is a location in the network where IP packets
      can be observed.  Examples include: a line to which a probe is
      attached, a shared medium, such as an Ethernet-based LAN, a single
      port of a router, or a set of interfaces (physical or logical) of
      a router.

      Note that every Observation Point is associated with an
      Observation Domain (defined below), and that one Observation Point
      may be a superset of several other Observation Points.  For
      example, one Observation Point can be an entire line card.  That
      would be the superset of the individual Observation Points at the
      line card's interfaces.

   Observation Domain

      An Observation Domain is the largest set of Observation Points for
      which Flow information can be aggregated by a Metering Process.
      For example, a router line card may be an Observation Domain if it
      is composed of several interfaces, each of which is an Observation
      Point.  In the IPFIX Message it generates, the Observation Domain
      includes its Observation Domain ID, which is unique per Exporting
      Process.  That way, the Collecting Process can identify the
      specific Observation Domain from the Exporter that sends the IPFIX
      Messages.  Every Observation Point is associated with an
      Observation Domain.  It is RECOMMENDED that Observation Domain IDs
      also be unique per IPFIX Device.

   IP Traffic Flow or Flow

      There are several definitions of the term 'flow' being used by the
      Internet community.  Within the context of IPFIX we use the
      following definition:

      A Flow is defined as a set of IP packets passing an Observation
      Point in the network during a certain time interval.  All packets
      belonging to a particular Flow have a set of common properties.
      Each property is defined as the result of applying a function to
      the values of:

         1. one or more packet header fields (e.g., destination IP
            address), transport header fields (e.g., destination port
            number), or application header fields (e.g., RTP header
            fields [<a href="rfc3550.html" title='"RTP: A Transport Protocol for Real-Time Applications"'>RFC3550</a>]).

         2. one or more characteristics of the packet itself (e.g.,
            number of MPLS labels, etc...).



<span class="grey">Claise, et al.              Standards Track                     [Page 5]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


         3. one or more of fields derived from packet treatment (e.g.,
            next hop IP address, the output interface, etc...).

      A packet is defined as belonging to a Flow if it completely
      satisfies all the defined properties of the Flow.

      This definition covers the range from a Flow containing all
      packets observed at a network interface to a Flow consisting of
      just a single packet between two applications.  It includes
      packets selected by a sampling mechanism.

   Flow Key

      Each of the fields that:

      1.  belong to the packet header (e.g., destination IP address),

      2.  are a property of the packet itself (e.g., packet length),

      3.  are derived from packet treatment (e.g., Autonomous System
          (AS) number),

      and that are used to define a Flow are termed Flow Keys.

   Flow Record

      A Flow Record contains information about a specific Flow that was
      observed at an Observation Point.  A Flow Record contains measured
      properties of the Flow (e.g., the total number of bytes for all
      the Flow's packets) and usually characteristic properties of the
      Flow (e.g., source IP address).

   Metering Process

      The Metering Process generates Flow Records.  Inputs to the
      process are packet headers and characteristics observed at an
      Observation Point, and packet treatment at the Observation Point
      (for example, the selected output interface).

      The Metering Process consists of a set of functions that includes
      packet header capturing, timestamping, sampling, classifying, and
      maintaining Flow Records.

      The maintenance of Flow Records may include creating new records,
      updating existing ones, computing Flow statistics, deriving
      further Flow properties, detecting Flow expiration, passing Flow
      Records to the Exporting Process, and deleting Flow Records.




<span class="grey">Claise, et al.              Standards Track                     [Page 6]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Exporting Process

      The Exporting Process sends Flow Records to one or more Collecting
      Processes.  The Flow Records are generated by one or more Metering
      Processes.

   Exporter

      A device that hosts one or more Exporting Processes is termed an
      Exporter.

   IPFIX Device

      An IPFIX Device hosts at least one Exporting Process.  It may host
      further Exporting Processes and arbitrary numbers of Observation
      Points and Metering Processes.

   Collecting Process

      A Collecting Process receives Flow Records from one or more
      Exporting Processes.  The Collecting Process might process or
      store received Flow Records, but such actions are out of scope for
      this document.

   Collector

      A device that hosts one or more Collecting Processes is termed a
      Collector.

   Template

      A Template is an ordered sequence of &lt;type, length&gt; pairs used to
      completely specify the structure and semantics of a particular set
      of information that needs to be communicated from an IPFIX Device
      to a Collector.  Each Template is uniquely identifiable by means
      of a Template ID.

   IPFIX Message

      An IPFIX Message is a message originating at the Exporting Process
      that carries the IPFIX records of this Exporting Process and whose
      destination is a Collecting Process.  An IPFIX Message is
      encapsulated at the transport layer.








<span class="grey">Claise, et al.              Standards Track                     [Page 7]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Message Header

      The Message Header is the first part of an IPFIX Message, which
      provides basic information about the message, such as the IPFIX
      version, length of the message, message sequence number, etc.

   Template Record

      A Template Record defines the structure and interpretation of
      fields in a Data Record.

   Data Record

      A Data Record is a record that contains values of the parameters
      corresponding to a Template Record.

   Options Template Record

      An Options Template Record is a Template Record that defines the
      structure and interpretation of fields in a Data Record, including
      defining how to scope the applicability of the Data Record.

   Set

      Set is a generic term for a collection of records that have a
      similar structure.  In an IPFIX Message, one or more Sets follow
      the Message Header.

      There are three different types of Sets: Template Set, Options
      Template Set, and Data Set.

   Template Set

      A Template Set is a collection of one or more Template Records
      that have been grouped together in an IPFIX Message.

   Options Template Set

      An Options Template Set is a collection of one or more Options
      Template Records that have been grouped together in an IPFIX
      Message.

   Data Set

      A Data Set is one or more Data Records, of the same type, that are
      grouped together in an IPFIX Message.  Each Data Record is
      previously defined by a Template Record or an Options Template
      Record.



<span class="grey">Claise, et al.              Standards Track                     [Page 8]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Information Element

      An Information Element is a protocol and encoding-independent
      description of an attribute that may appear in an IPFIX Record.
      The IPFIX information model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] defines the base set of
      Information Elements for IPFIX.  The type associated with an
      Information Element indicates constraints on what it may contain
      and also determines the valid encoding mechanisms for use in
      IPFIX.

   Transport Session

      In Stream Control Transmission Protocol (SCTP), the transport
      session is known as the SCTP association, which is uniquely
      identified by the SCTP endpoints [<a href="rfc4960.html" title='"Stream Control Transmission Protocol"'>RFC4960</a>]; in TCP, the transport
      session is known as the TCP connection, which is uniquely
      identified by the combination of IP addresses and TCP ports used.
      In UDP, the transport session is known as the UDP session, which
      is uniquely identified by the combination of IP addresses and UDP
      ports used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Terminology%20Summary%20Table"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Terminology Summary Table</span>

   +------------------+---------------------------------------------+
   |                  |                 contents                    |
   |                  +--------------------+------------------------+
   |       Set        |      Template      |         record         |
   +------------------+--------------------+------------------------+
   |     Data Set     |          /         |     Data Record(s)     |
   +------------------+--------------------+------------------------+
   |   Template Set   | Template Record(s) |           /            |
   +------------------+--------------------+------------------------+
   | Options Template | Options Template   |           /            |
   |       Set        | Record(s)          |                        |
   +------------------+--------------------+------------------------+

   Figure A: Terminology Summary Table

   A Data Set is composed of Data Record(s).  No Template Record is
   included.  A Template Record or an Options Template Record defines
   the Data Record.

   A Template Set contains only Template Record(s).

   An Options Template Set contains only Options Template Record(s).






<span class="grey">Claise, et al.              Standards Track                     [Page 9]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20IPFIX%20Message%20Format"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  IPFIX Message Format</span>

   An IPFIX Message consists of a Message Header, followed by one or
   more Sets.  The Sets can be any of the possible three types: Data
   Set, Template Set, or Options Template Set.

   The format of the IPFIX Message is shown in Figure B.

   +----------------------------------------------------+
   | Message Header                                     |
   +----------------------------------------------------+
   | Set                                                |
   +----------------------------------------------------+
   | Set                                                |
   +----------------------------------------------------+
     ...
   +----------------------------------------------------+
   | Set                                                |
   +----------------------------------------------------+

   Figure B: IPFIX Message Format

   The Exporter MUST code all binary integers of the Message Header and
   the different Sets in network-byte order (also known as the
   big-endian byte ordering).

   Following are some examples of IPFIX Messages:

   1. An IPFIX Message consisting of interleaved Template, Data, and
      Options Template Sets -- A newly created Template is exported as
      soon as possible.  So, if there is already an IPFIX Message with a
      Data Set that is being prepared for export, the Template and
      Option Template Sets are interleaved with this information,
      subject to availability of space.

   +--------+--------------------------------------------------------+
   |        | +----------+ +---------+     +-----------+ +---------+ |
   |Message | | Template | | Data    |     | Options   | | Data    | |
   | Header | | Set      | | Set     | ... | Template  | | Set     | |
   |        | |          | |         |     | Set       | |         | |
   |        | +----------+ +---------+     +-----------+ +---------+ |
   +--------+--------------------------------------------------------+

   Figure C: IPFIX Message, Example 1







<span class="grey">Claise, et al.              Standards Track                    [Page 10]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   2. An IPFIX Message consisting entirely of Data Sets -- After the
      appropriate Template Records have been defined and transmitted to
      the Collecting Process, the majority of IPFIX Messages consist
      solely of Data Sets.

   +--------+----------------------------------------------+
   |        | +---------+     +---------+      +---------+ |
   |Message | | Data    |     | Data    |      | Data    | |
   | Header | | Set     | ... | Set     | ...  | Set     | |
   |        | +---------+     +---------+      +---------+ |
   +--------+----------------------------------------------+

   Figure D: IPFIX Message, Example 2

   3. An IPFIX Message consisting entirely of Template and Options
      Template Sets.

   +--------+-------------------------------------------------+
   |        | +----------+     +----------+      +----------+ |
   |Message | | Template |     | Template |      | Options  | |
   | Header | | Set      | ... | Set      | ...  | Template | |
   |        | |          |     |          |      | Set      | |
   |        | +----------+     +----------+      +----------+ |
   +--------+-------------------------------------------------+

   Figure E: IPFIX Message, Example 3

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Message%20Header%20Format"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Message Header Format</span>

   The format of the IPFIX Message Header is shown in Figure F.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Version Number          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Export Time                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Sequence Number                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Observation Domain ID                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure F: IPFIX Message Header Format







<span class="grey">Claise, et al.              Standards Track                    [Page 11]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Message Header Field Descriptions:

   Version

      Version of Flow Record format exported in this message.  The value
      of this field is 0x000a for the current version, incrementing by
      one the version used in the NetFlow services export version 9
      [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>].

   Length

      Total length of the IPFIX Message, measured in octets, including
      Message Header and Set(s).

   Export Time

      Time, in seconds, since 0000 UTC Jan 1, 1970, at which the IPFIX
      Message Header leaves the Exporter.

   Sequence Number

      Incremental sequence counter modulo 2^32 of all IPFIX Data Records
      sent on this PR-SCTP stream from the current Observation Domain by
      the Exporting Process.  Check the specific meaning of this field
      in the subsections of <a href="#section-10">Section 10</a> when UDP or TCP is selected as
      the transport protocol.  This value SHOULD be used by the
      Collecting Process to identify whether any IPFIX Data Records have
      been missed.  Template and Options Template Records do not
      increase the Sequence Number.

   Observation Domain ID

      A 32-bit identifier of the Observation Domain that is locally
      unique to the Exporting Process.  The Exporting Process uses the
      Observation Domain ID to uniquely identify to the Collecting
      Process the Observation Domain that metered the Flows.  It is
      RECOMMENDED that this identifier also be unique per IPFIX Device.
      Collecting Processes SHOULD use the Transport Session and the
      Observation Domain ID field to separate different export streams
      originating from the same Exporting Process.  The Observation
      Domain ID SHOULD be 0 when no specific Observation Domain ID is
      relevant for the entire IPFIX Message, for example, when exporting
      the Exporting Process Statistics, or in case of a hierarchy of
      Collectors when aggregated Data Records are exported.







<span class="grey">Claise, et al.              Standards Track                    [Page 12]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Field%20Specifier%20Format"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Field Specifier Format</span>

   Vendors need the ability to define proprietary Information Elements,
   because, for example, they are delivering a pre-standards product, or
   the Information Element is, in some way, commercially sensitive.
   This section describes the Field Specifier format for both
   IETF-specified Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] and enterprise-specific
   Information Elements.

   The Information Elements are identified by the Information Element
   identifier.  When the Enterprise bit is set to 0, the corresponding
   Information Element identifier will report an IETF-specified
   Information Element, and the Enterprise Number MUST NOT be present.
   When the Enterprise bit is set to 1, the corresponding Information
   Element identifier will report an enterprise-specific Information
   Element; the Enterprise Number MUST be present.  An example of this
   is shown in Section A.4.2.

   The Field Specifier format is shown in Figure G.

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |E|  Information Element ident. |        Field Length           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Enterprise Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure G: Field Specifier Format

   Where:

   E

      Enterprise bit.  This is the first bit of the Field Specifier.  If
      this bit is zero, the Information Element Identifier identifies an
      IETF-specified Information Element, and the four-octet Enterprise
      Number field MUST NOT be present.  If this bit is one, the
      Information Element identifier identifies an enterprise-specific
      Information Element, and the Enterprise Number filed MUST be
      present.

   Information Element identifier

      A numeric value that represents the type of Information Element.
      Refer to [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].





<span class="grey">Claise, et al.              Standards Track                    [Page 13]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Field Length

      The length of the corresponding encoded Information Element, in
      octets.  Refer to [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  The field length may be smaller than
      the definition in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] if the reduced size encoding is used
      (see <a href="#section-6.2">Section 6.2</a>).  The value 65535 is reserved for variable-
      length Information Elements (see <a href="#section-7">Section 7</a>).

   Enterprise Number

      IANA enterprise number [<a href="#ref-PEN">PEN</a>] of the authority defining the
      Information Element identifier in this Template Record.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Set%20and%20Set%20Header%20Format"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Set and Set Header Format</span>

   A Set is a generic term for a collection of records that have a
   similar structure.  There are three different types of Sets: Template
   Sets, Options Template Sets, and Data Sets.  Each of these Sets
   consists of a Set Header and one or more records.  The Set Format and
   the Set Header Format are defined in the following sections.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20%20Set%20Format"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>.  Set Format</span>

   A Set has the format shown in Figure H.  The record types can be
   either Template Records, Options Template Records, or Data Records.
   The record types MUST NOT be mixed within a Set.

   +--------------------------------------------------+
   | Set Header                                       |
   +--------------------------------------------------+
   | record                                           |
   +--------------------------------------------------+
   | record                                           |
   +--------------------------------------------------+
    ...
   +--------------------------------------------------+
   | record                                           |
   +--------------------------------------------------+
   | Padding (opt.)                                   |
   +--------------------------------------------------+

   Figure H: Set Format

   The Set Field Definitions are as follows:

   Set Header

      The Set Header Format is defined in <a href="#section-3.3.2">Section 3.3.2</a>.



<span class="grey">Claise, et al.              Standards Track                    [Page 14]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Record

      One of the record Formats: Template Record, Options Template
      Record, or Data Record Format.

   Padding

      The Exporting Process MAY insert some padding octets, so that the
      subsequent Set starts at an aligned boundary.  For security
      reasons, the padding octet(s) MUST be composed of zero (0) valued
      octets.  The padding length MUST be shorter than any allowable
      record in this Set.  If padding of the IPFIX Message is desired in
      combination with very short records, then the padding Information
      Element 'paddingOctets' [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] can be used for padding records
      such that their length is increased to a multiple of 4 or 8
      octets.  Because Template Sets are always 4-octet aligned by
      definition, padding is only needed in case of other alignments
      e.g., on 8-octet boundaries.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20%20Set%20Header%20Format"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>.  Set Header Format</span>

   Every Set contains a common header.  This header is defined in Figure
   I.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Set ID               |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure I: Set Header Format

   The Set Header Field Definitions are as follows:

   Set ID

      Set ID value identifies the Set.  A value of 2 is reserved for the
      Template Set.  A value of 3 is reserved for the Option Template
      Set.  All other values from 4 to 255 are reserved for future use.
      Values above 255 are used for Data Sets.  The Set ID values of 0
      and 1 are not used for historical reasons [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>].

   Length

      Total length of the Set, in octets, including the Set Header, all
      records, and the optional padding.  Because an individual Set MAY
      contain multiple records, the Length value MUST be used to
      determine the position of the next Set.



<span class="grey">Claise, et al.              Standards Track                    [Page 15]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20%20Record%20Format"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.   Record Format</span>

   IPFIX defines three record formats, defined in the next sections: the
   Template Record Format, the Options Template Record Format, and the
   Data Record Format.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.1.%20%20Template%20Record%20Format"></a><a class="selflink" href="#section-3.4.1" name="section-3.4.1">3.4.1</a>.  Template Record Format</span>

   One of the essential elements in the IPFIX record format is the
   Template Record.  Templates greatly enhance the flexibility of the
   record format because they allow the Collecting Process to process
   IPFIX Messages without necessarily knowing the interpretation of all
   Data Records.  A Template Record contains any combination of
   IANA-assigned and/or enterprise-specific Information Elements
   identifiers.

   The format of the Template Record is shown in Figure J.  It consists
   of a Template Record Header and one or more Field Specifiers.  The
   definition of the Field Specifiers is given in Figure G above.

   +--------------------------------------------------+
   | Template Record Header                           |
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+
    ...
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+

   Figure J: Template Record Format

   The format of the Template Record Header is shown in Figure K.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Template ID (&gt; 255)      |         Field Count           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure K: Template Record Header Format








<span class="grey">Claise, et al.              Standards Track                    [Page 16]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   The Template Record Header Field Definitions are as follows:

   Template ID

      Each of the newly generated Template Records is given a unique
      Template ID.  This uniqueness is local to the Transport Session
      and Observation Domain that generated the Template ID.  Template
      IDs 0-255 are reserved for Template Sets, Options Template Sets,
      and other reserved Sets yet to be created.  Template IDs of Data
      Sets are numbered from 256 to 65535.  There are no constraints
      regarding the order of the Template ID allocation.

   Field Count

      Number of fields in this Template Record.

   The example in Figure L shows a Template Set with mixed standard and
   enterprise-specific Information Elements.  It consists of a Set
   Header, a Template Header, and several Field Specifiers.
































<span class="grey">Claise, et al.              Standards Track                    [Page 17]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Set ID = 2           |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Template ID = 256        |         Field Count = N       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1| Information Element id. 1.1 |        Field Length 1.1       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Enterprise Number  1.1                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0| Information Element id. 1.2 |        Field Length 1.2       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1| Information Element id. 1.N |        Field Length 1.N       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Enterprise Number  1.N                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Template ID = 257        |         Field Count = M       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0| Information Element id. 2.1 |        Field Length 2.1       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1| Information Element id. 2.2 |        Field Length 2.2       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Enterprise Number  2.2                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1| Information Element id. 2.M |        Field Length 2.M       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Enterprise Number  2.M                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Padding (opt)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure L: Template Set Example

   Information Element Identifiers 1.2 and 2.1 are defined by the IETF
   (Enterprise bit = 0) and, therefore, do not need an Enterprise Number
   to identify them.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.2.%20%20Options%20Template%20Record%20Format"></a><a class="selflink" href="#section-3.4.2" name="section-3.4.2">3.4.2</a>.  Options Template Record Format</span>

   Thanks to the notion of scope, The Options Template Record gives the
   Exporter the ability to provide additional information to the
   Collector that would not be possible with Flow Records alone.




<span class="grey">Claise, et al.              Standards Track                    [Page 18]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   One Options Template Record example is the "Flow Keys", which reports
   the Flow Keys for a Template, which is defined as the scope.  Another
   example is the "Template configuration", which reports the
   configuration sampling parameter(s) for the Template, which is
   defined as the scope.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.4.2.1.%20%20Scope"></a><a class="selflink" href="#section-3.4.2.1" name="section-3.4.2.1">3.4.2.1</a>.  Scope</span>

   The scope, which is only available in the Options Template Set, gives
   the context of the reported Information Elements in the Data Records.
   Note that the IPFIX Message Header already contains the Observation
   Domain ID (the identifier of the Observation Domain).  If not zero,
   this Observation Domain ID can be considered as an implicit scope for
   the Data Records in the IPFIX Message.  The Observation Domain ID
   MUST be zero when the IPFIX Message contains Data Records with
   different Observation Domain ID values defined as scopes.

   Multiple Scope Fields MAY be present in the Options Template Record,
   in which case, the composite scope is the combination of the scopes.
   For example, if the two scopes are defined as "metering process" and
   "template", the combined scope is this Template for this Metering
   Process.  The order of the Scope Fields, as defined in the Options
   Template Record, is irrelevant in this case.  However, if the order
   of the Scope Fields in the Options Template Record is relevant, the
   order of the Scope Fields MUST be used.  For example, if the first
   scope defines the filtering function, while the second scope defines
   the sampling function, the order of the scope is important.  Applying
   the sampling function first, followed by the filtering function,
   would lead to potentially different Data Records than applying the
   filtering function first, followed by the sampling function.  In this
   case, the Collector deduces the function order by looking at the
   order of the scope in the Options Template Record.

   The scope is an Information Element specified in the IPFIX
   Information Model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  An IPFIX-compliant implementation of
   the Collecting Process SHOULD support this minimum set of Information
   Elements as scope: LineCardId, TemplateId, exporterIPv4Address,
   exporterIPv6Address, and ingressInterface.  Note that other
   Information Elements, such as meteringProcessId, exportingProcessId,
   observationDomainId, etc. are also valid scopes.  The IPFIX protocol
   doesn't prevent the use of any Information Elements for scope.
   However, some Information Element types don't make sense if specified
   as scope; for example, the counter Information Elements.

   Finally, note that the Scope Field Count MUST NOT be zero.






<span class="grey">Claise, et al.              Standards Track                    [Page 19]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.4.2.2.%20%20Options%20Template%20Record%20Format"></a><a class="selflink" href="#section-3.4.2.2" name="section-3.4.2.2">3.4.2.2</a>.  Options Template Record Format</span>

   An Options Template Record contains any combination of IANA-assigned
   and/or enterprise-specific Information Elements identifiers.

   The format of the Options Template Record is shown in Figure M.  It
   consists of an Options Template Record Header and one or more Field
   Specifiers.  The definition of the Field Specifiers is given in
   Figure G above.

   +--------------------------------------------------+
   | Options Template Record Header                   |
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+
    ...
   +--------------------------------------------------+
   | Field Specifier                                  |
   +--------------------------------------------------+

   Figure M: Options Template Record Format

   The format of the Options Template Record Header is shown in Figure
   N.

    0                  1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Template ID (&gt; 255)   |         Field Count           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Scope Field Count        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure N: Options Template Record Header Format

   The Options Template Record Header Field Definitions are as follows:

   Template ID

   Template ID of this Options Template Record.  This value is greater
   than 255.








<span class="grey">Claise, et al.              Standards Track                    [Page 20]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Field Count

   Number of all fields in this Options Template Record, including the
   Scope Fields.

   Scope Field Count

   Number of scope fields in this Options Template Record.  The Scope
   Fields are normal Fields except that they are interpreted as scope at
   the Collector.  The Scope Field Count MUST NOT be zero.

   The example in Figure O shows an Option Template Set with mixed IETF
   and enterprise-specific Information Elements.  It consists of a Set
   Header, an Option Template Header, and several Field Specifiers.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Set ID = 3           |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Template ID = 258     |         Field Count = N + M   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope Field Count = N     |0|  Scope 1 Infor. Element Id. |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope 1 Field Length      |0|  Scope 2 Infor. Element Id. |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope 2 Field Length      |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            ...                |1|  Scope N Infor. Element Id. |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope N Field Length      |   Scope N Enterprise Number ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ...  Scope N Enterprise Number   |1| Option 1 Infor. Element Id. |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Option 1 Field Length      |  Option 1 Enterprise Number ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ... Option 1 Enterprise Number   |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |0| Option M Infor. Element Id. |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Option M Field Length     |      Padding (optional)       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure O: Option Template Set Example







<span class="grey">Claise, et al.              Standards Track                    [Page 21]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.3.%20%20Data%20Record%20Format"></a><a class="selflink" href="#section-3.4.3" name="section-3.4.3">3.4.3</a>.  Data Record Format</span>

   The Data Records are sent in Data Sets.  The format of the Data
   Record is shown in Figure P.  It consists only of one or more Field
   Values.  The Template ID to which the Field Values belong is encoded
   in the Set Header field "Set ID", i.e., "Set ID" = "Template ID".

   +--------------------------------------------------+
   | Field Value                                      |
   +--------------------------------------------------+
   | Field Value                                      |
   +--------------------------------------------------+
    ...
   +--------------------------------------------------+
   | Field Value                                      |
   +--------------------------------------------------+

   Figure P: Data Record Format

   Note that Field Values do not necessarily have a length of 16 bits.
   Field Values are encoded according to their data type specified in
   [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].

   Interpretation of the Data Record format can be done only if the
   Template Record corresponding to the Template ID is available at the
   Collecting Process.

   The example in Figure Q shows a Data Set. It consists of a Set Header
   and several Field Values.






















<span class="grey">Claise, et al.              Standards Track                    [Page 22]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Set ID = Template ID        |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 1 - Field Value 1    |   Record 1 - Field Value 2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 1 - Field Value 3    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 2 - Field Value 1    |   Record 2 - Field Value 2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 2 - Field Value 3    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 3 - Field Value 1    |   Record 3 - Field Value 2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 3 - Field Value 3    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              ...              |      Padding (optional)       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure Q: Data Set, Containing Data Records

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Specific%20Reporting%20Requirements"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Specific Reporting Requirements</span>

   Some specific Options Templates and Options Template Records are
   necessary to provide extra information about the Flow Records and
   about the Metering Process.

   The Option Template and Options Template Records defined in these
   subsections, which impose some constraints on the Metering Process
   and Exporting Process implementations, MAY be implemented.  If
   implemented, the specific Option Templates SHOULD be implemented as
   specified in these subsections.

   The minimum set of Information Elements is always specified in these
   Specific IPFIX Options Templates.  Nevertheless, extra Information
   Elements may be used in these specific Options Templates.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20The%20Metering%20Process%20Statistics%20Option%20Template"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  The Metering Process Statistics Option Template</span>

   The Metering Process Statistics Option Template specifies the
   structure of a Data Record for reporting Metering Process statistics.
   It SHOULD contain the following Information Elements that are defined
   in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]:







<span class="grey">Claise, et al.              Standards Track                    [Page 23]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   observationDomainId
                           An identifier of an Observation Domain that
                           is locally unique to the Exporting Process.
                           This Information Element MUST be defined as a
                           Scope Field.

   exportedMessageTotalCount
                           The total number of IPFIX Messages that the
                           Exporting Process successfully sent to the
                           Collecting Process since the Exporting
                           Process re-initialization.

   exportedFlowTotalCount
                           The total number of Flow Records that the
                           Exporting Process successfully sent to the
                           Collecting Process since the Exporting
                           Process re-initialization.

   exportedOctetTotalCount
                           The total number of octets that the Exporting
                           Process successfully sent to the Collecting
                           Process since the Exporting Process re-
                           initialization.

   The Exporting Process SHOULD export the Data Record specified by the
   Metering Process Statistics Option Template on a regular basis or
   based on some export policy.  This periodicity or export policy
   SHOULD be configurable.

   Note that if several Metering Processes are available on the Exporter
   Observation Domain, the Information Element meteringProcessId MUST be
   specified as an additional Scope Field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20The%20Metering%20Process%20Reliability%20Statistics%20Option%20Template"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  The Metering Process Reliability Statistics Option Template</span>

   The Metering Process Reliability Option Template specifies the
   structure of a Data Record for reporting lack of reliability in the
   Metering Process.  It SHOULD contain the following Information
   Elements that are defined in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]:

   observationDomainId
                           An identifier of an Observation Domain that
                           is locally unique to the Exporting Process.
                           This Information Element MUST be defined as a
                           Scope Field.






<span class="grey">Claise, et al.              Standards Track                    [Page 24]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   ignoredPacketTotalCount
                           The total number of IP packets that the
                           Metering Process did not process.

   ignoredOctetTotalCount
                           The total number of octets in observed IP
                           packets that the Metering Process did not
                           process.

   time first ignored
                           The timestamp of the first IP packet that was
                           ignored by the Metering Process.  For this
                           timestamp, any of the "flowStart" timestamp
                           Information Elements flowStartMilliseconds,
                           flowStartMicroseconds, flowStartNanoseconds,
                           and flowStartDeltaMicroseconds can be used.

   time last ignored
                           The timestamp of the last IP packet that was
                           ignored by the Metering Process.  For this
                           timestamp, any of the "flowEnd" timestamp
                           Information Elements flowEndMilliseconds,
                           flowEndMicroseconds, flowEndNanoseconds, and
                           flowEndDeltaMicroseconds can be used.

   The Exporting Process SHOULD export the Data Record specified by the
   Metering Process Reliability Statistics Option Template on a regular
   basis or based on some export policy.  This periodicity or export
   policy SHOULD be configurable.

   Note that if several Metering Processes are available on the Exporter
   Observation Domain, the Information Element meteringProcessId MUST be
   specified as an additional Scope Field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20The%20Exporting%20Process%20Reliability%20Statistics%20Option%20Template"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  The Exporting Process Reliability Statistics Option Template</span>

   The Exporting Process Reliability Option Template specifies the
   structure of a Data Record for reporting lack of reliability in the
   Exporting process.  It SHOULD contain the following Information
   Elements that are defined in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]:

   Exporting Process ID
                        The identifier of the Exporting Process for
                        which lack of reliability is reported.  There
                        are three Information Elements specified in
                        [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] that can be used for this purpose:
                        exporterIPv4Address, exporterIPv6Address, or




<span class="grey">Claise, et al.              Standards Track                    [Page 25]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


                        exportingProcessId.  This Information Element
                        MUST be defined as a Scope Field.

   notSentFlowTotalCount
                        The total number of Flows that were generated by
                        the Metering Process and dropped by the Metering
                        Process or by the Exporting Process instead of
                        being sent to the Collecting Process.

   notSentPacketTotalCount
                        The total number of packets in Flow Records that
                        were generated by the Metering Process and
                        dropped by the Metering Process or by the
                        Exporting Process instead of being sent to the
                        Collecting Process.

   notSentOctetTotalCount
                        The total number of octets in packets in Flow
                        Records that were generated by the Metering
                        Process and dropped by the Metering Process or
                        by the Exporting Process instead of being sent
                        to the Collecting Process.

   time first flow dropped
                        The timestamp of the first Flow was dropped by
                        the Metering Process.  For this timestamp, any
                        of the "flowStart" timestamp Information
                        Elements flowStartMilliseconds,
                        flowStartMicroseconds, flowStartNanoseconds, and
                        flowStartDeltaMicroseconds can be used.

   time last flow dropped
                        The timestamp of the last IP packet that was
                        ignored by the Metering Process.  For this
                        timestamp, any of the "flowEnd" timestamp
                        Information Elements flowEndMilliseconds,
                        flowEndMicroseconds, flowEndNanoseconds, and
                        flowEndDeltaMicroseconds can be used.

   The Exporting Process SHOULD export the Data Record specified by the
   Exporting Process Reliability Statistics Option Template on a regular
   basis or based on some export policy.  This periodicity or export
   policy SHOULD be configurable.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20The%20Flow%20Keys%20Option%20Template"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  The Flow Keys Option Template</span>

   The Flow Keys Option Template specifies the structure of a Data
   Record for reporting the Flow Keys of reported Flows.  A Flow Keys



<span class="grey">Claise, et al.              Standards Track                    [Page 26]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Data Record extends a particular Template Record that is referenced
   by its templateId identifier.  The Template Record is extended by
   specifying which of the Information Elements contained in the
   corresponding Data Records describe Flow properties that serve as
   Flow Keys of the reported Flow.

   The Flow Keys Option Template SHOULD contain the following
   Information Elements that are defined in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]:

   templateId              An identifier of a Template.  This
                           Information Element MUST be defined as a
                           Scope Field.

   flowKeyIndicator        Bitmap with the positions of the Flow Keys in
                           the Data Records.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20IPFIX%20Message%20Header%20%22Export%20Time%22%20and%20Flow%20Record%20Time"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  IPFIX Message Header "Export Time" and Flow Record Time</span>

   The IPFIX Message Header "Export Time" field is the time in seconds
   since 0000 UTC Jan 1, 1970, at which the IPFIX Message Header leaves
   the Exporter.  The time-related Information Elements specified in
   [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] MAY use this "Export Time" as base time and specify an
   offset relative to it, instead of using a common base time, such as
   0000 UTC Jan 1, 1970.  All Information Elements that do not have
   their base time defined by their data type MUST have the base time
   clearly specified in their description.

   For example, Data Records requiring a microsecond precision can
   export the flow start and end times with the flowStartMicroseconds
   and flowEndMicroseconds Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], containing
   the time since 0000 UTC Jan 1, 1970.  An alternate solution is to
   export the flowStartDeltaMicroseconds and flowEndDeltaMicroseconds
   Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] in the Data Record, which respectively
   report the flow start and end time offsets compared to the IPFIX
   Message Header "Export Time".  The latter solution lowers the export
   bandwidth requirement while it increases the load on the Exporter, as
   the Exporting Process must calculate the flowStartDeltaMicroseconds
   and flowEndDeltaMicroseconds of every single Data Record before
   exporting the IPFIX Message.

   It must be noted that using time-related Information Elements with
   offset times, compared to the IPFIX Message Header "Export Time",
   imposes some time constraints on the Data Records contained in the
   IPFIX Message.  In the example of flowStartDeltaMicroseconds and
   flowEndDeltaMicroseconds Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], the Data
   Record must be exported within a maximum of 71 minutes after its
   creation.  Otherwise, the 32-bit counter would not be sufficient to
   contain the flow start time offset.



<span class="grey">Claise, et al.              Standards Track                    [Page 27]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Linkage%20with%20the%20Information%20Model"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Linkage with the Information Model</span>

   The Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] MUST be sent in canonical format
   in network-byte order (also known as the big-endian byte ordering).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Encoding%20of%20IPFIX%20Data%20Types"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Encoding of IPFIX Data Types</span>

   The following sections will define the encoding of the data types
   specified in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.%20%20Integral%20Data%20Types"></a><a class="selflink" href="#section-6.1.1" name="section-6.1.1">6.1.1</a>.  Integral Data Types</span>

   Integral data types -- octet, signed8, unsigned16, signed16,
   unsigned32, signed32, signed64, and unsigned64 -- MUST be encoded
   using the default canonical format in network-byte order.  Signed
   Integral data types are represented in two's complement notation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.2.%20%20Address%20Types"></a><a class="selflink" href="#section-6.1.2" name="section-6.1.2">6.1.2</a>.  Address Types</span>

   Address types -- macAddress, ipv4Address, and ipv6Address -- MUST be
   encoded the same way as the integral data types.  The macAddress is
   treated as a 6-octet integer, the ipv4Address as a 4-octet integer,
   and the ipv6Address as a 16-octet integer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.3.%20%20float32"></a><a class="selflink" href="#section-6.1.3" name="section-6.1.3">6.1.3</a>.  float32</span>

   The float32 data type MUST be encoded as an IEEE single-precision
   32-bit floating point-type, as specified in [<a href="#ref-IEEE.754.1985" title='"Standard for Binary Floating-Point Arithmetic"'>IEEE.754.1985</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.4.%20%20float64"></a><a class="selflink" href="#section-6.1.4" name="section-6.1.4">6.1.4</a>.  float64</span>

   The float64 data type MUST be encoded as an IEEE double-precision
   64-bit floating point-type, as specified in [<a href="#ref-IEEE.754.1985" title='"Standard for Binary Floating-Point Arithmetic"'>IEEE.754.1985</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.5.%20%20boolean"></a><a class="selflink" href="#section-6.1.5" name="section-6.1.5">6.1.5</a>.  boolean</span>

   The boolean data type is specified according to the TruthValue in
   [<a href="rfc2579.html" title='"Textual Conventions for SMIv2"'>RFC2579</a>]: it is an integer with the value 1 for true and a value 2
   for false.  Every other value is undefined.  The boolean data type
   MUST be encoded in a single octet.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.6.%20%20string%20and%20octetarray"></a><a class="selflink" href="#section-6.1.6" name="section-6.1.6">6.1.6</a>.  string and octetarray</span>

   The data type string represents a finite length string of valid
   characters of the Unicode character encoding set.  The string data
   type MUST be encoded in UTF-8 format.  The string is sent as an array
   of octets using an Information Element of fixed or variable length.




<span class="grey">Claise, et al.              Standards Track                    [Page 28]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   The length of the Information Element specifies the length of the
   octetarray.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.7.%20%20dateTimeSeconds"></a><a class="selflink" href="#section-6.1.7" name="section-6.1.7">6.1.7</a>.  dateTimeSeconds</span>

   The data type dateTimeseconds represents a time value in units of
   seconds normalized to the GMT timezone.  It MUST be encoded in a
   32-bit integer containing the number of seconds since 0000 UTC Jan 1,
   1970.  The 32-bit integer allows the time encoding up to 136 years.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.8.%20%20dateTimeMilliseconds"></a><a class="selflink" href="#section-6.1.8" name="section-6.1.8">6.1.8</a>.  dateTimeMilliseconds</span>

   The data type dateTimeMilliseconds represents a time value in units
   of milliseconds normalized to the GMT timezone.  It MUST be encoded
   in a 64-bit integer containing the number of milliseconds since 0000
   UTC Jan 1, 1970.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.9.%20%20dateTimeMicroseconds"></a><a class="selflink" href="#section-6.1.9" name="section-6.1.9">6.1.9</a>.  dateTimeMicroseconds</span>

   The data type dateTimeMicroseconds represents a time value in units
   of microseconds normalized to the GMT timezone.  It MUST be encoded
   in a 64-bit integer, according to the NTP format given in [<a href="rfc1305.html" title='"Network Time Protocol (Version 3) Specification, Implementation and Analysis"'>RFC1305</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.10.%20%20dateTimeNanoseconds"></a><a class="selflink" href="#section-6.1.10" name="section-6.1.10">6.1.10</a>.  dateTimeNanoseconds</span>

   The data type of dateTimeNanoseconds represents a time value in units
   of nanoseconds normalized to the GMT time zone.  It MUST be encoded
   in a 64-bit integer, according to the NTP format given in [<a href="rfc1305.html" title='"Network Time Protocol (Version 3) Specification, Implementation and Analysis"'>RFC1305</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Reduced%20Size%20Encoding%20of%20Integer%20and%20Float%20Types"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Reduced Size Encoding of Integer and Float Types</span>

   Information Elements containing integer, string, float, and
   octetarray types in the information model MAY be encoded using fewer
   octets than those implied by their type in the information model
   definition [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], based on the assumption that the smaller size
   is sufficient to carry any value the Exporter may need to deliver.
   This reduces the network bandwidth requirement between the Exporter
   and the Collector.  Note that the Information Element definitions
   [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] will always define the maximum encoding size.

   For instance, the information model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] defines byteCount as an
   unsigned64 type, which would require 64 bits.  However, if the
   Exporter will never locally encounter the need to send a value larger
   than 4294967295, it may chose to send the value instead as an
   unsigned32.  For example, a core router would require an unsigned64
   byteCount, while an unsigned32 might be sufficient for an access
   router.




<span class="grey">Claise, et al.              Standards Track                    [Page 29]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   This behavior is indicated by the Exporter by specifying a type size
   with a smaller length than that associated with the assigned type of
   the Information Element.  In the example above, the Exporter would
   place a length of 4 versus 8 in the Template.

   If reduced sizing is used, it MUST only be applied to the following
   integer types: unsigned64, signed64, unsigned32, signed32,
   unsigned16, and signed16.  The signed versus unsigned property of the
   reported value MUST be preserved.  The reduction in size can be to
   any number of octets smaller than the original type if the data value
   still fits, i.e., so that only leading zeroes are dropped.  For
   example, an unsigned64 can be reduced in size to 7, 6, 5, 4, 3, 2, or
   1 octet(s).

   Reduced sizing can also be used to reduce float64 to float32.  The
   float32 not only has a reduced number range, but due to the smaller
   mantissa, is also less precise.

   The reduced size encoding MUST NOT be applied to dateTimeMicroseconds
   or to dateTimeNanoseconds because these represent an inherent
   structure that would be destroyed by using less than the original
   number of bytes.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Variable-Length%20Information%20Element"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Variable-Length Information Element</span>

   The IPFIX Template mechanism is optimized for fixed-length
   Information Elements [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  Where an Information Element has a
   variable length, the following mechanism MUST be used to carry the
   length information for both the IETF and proprietary Information
   Elements.

   In the Template Set, the Information Element Field Length is recorded
   as 65535.  This reserved length value notifies the Collecting Process
   that length of the Information Element will be carried in the
   Information Element content itself.

   In most cases, the length of the Information Element will be less
   than 255 octets.  The following length-encoding mechanism optimizes
   the overhead of carrying the Information Element length in this
   majority case.  The length is carried in the octet before the
   Information Element, as shown in Figure R.










<span class="grey">Claise, et al.              Standards Track                    [Page 30]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Length (&lt; 255)|          Information Element                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      ... continuing as needed                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure R: Variable-Length Information Element (length &lt; 255 octets)

   If the length of the Information Element is greater than or equal to
   255 octets, the length is encoded into 3 octets before the
   Information Element.  The first octet is 255, and the length is
   carried in the second and third octets, as shown in Figure S.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      255      |      Length (0 to 65535)      |       IE      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      ... continuing as needed                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure S: Variable-Length Information Element (length 0 to 65535
   octets)

   The octets carrying the length (either the first or the first three
   octets) MUST NOT be included in the length of the Information
   Element.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Template%20Management"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Template Management</span>

   This section describes Template Management when using SCTP and
   PR-SCTP as the transport protocol.  Any necessary changes to Template
   Management specifically related to TCP or UDP transport protocols are
   specified in <a href="#section-10">Section 10</a>.

   The Exporting Process assigns and maintains the Template IDs per SCTP
   association for the Exporter's Observation Domains.  A newly created
   Template Record is assigned an unused Template ID by the Exporting
   Process.

   If a specific Information Element is required by a Template, but is
   not available in observed packets, the Exporting Process MAY choose
   to export Flow Records without this Information Element in a Data
   Record defined by a new Template.





<span class="grey">Claise, et al.              Standards Track                    [Page 31]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   If an Information Element is required more than once in a Template,
   the different occurrences of this Information Element SHOULD follow
   the logical order of their treatments by the Metering Process.  For
   example, if a selected packet goes through two hash functions, and if
   the two hash values are sent within a single Template, the first
   occurrence of the hash value should belong to the first hash function
   in the Metering Process.  For example, when exporting the two source
   IP addresses of an IPv4 in IPv4 packets, the first sourceIPv4Address
   Information Element occurrence should be the IPv4 address of the
   outer header, while the second occurrence should be the inner header
   one.

   Template Sets and Options Template Sets may be sent on any SCTP
   stream.  Template Sets and Options Template Sets MUST be sent
   reliably, using SCTP-ordered delivery.  As such, the Collecting
   Process MUST store the Template Record information for the duration
   of the SCTP association so that it can interpret the corresponding
   Data Records that are received in subsequent Data Sets.

   The Exporting Process SHOULD transmit the Template Set and Options
   Template Set in advance of any Data Sets that use that (Options)
   Template ID, to help ensure that the Collector has the Template
   Record before receiving the first Data Record.  Data Records that
   correspond to a Template Record MAY appear in the same and/or
   subsequent IPFIX Message(s).

   Different Observation Domains from the same SCTP association may use
   the same Template ID value to refer to different Templates.

   The Templates that are not used anymore SHOULD be deleted.  Before
   reusing a Template ID, the Template MUST be deleted.  In order to
   delete an allocated Template, the Template is withdrawn through the
   use of a Template Withdrawal Message.

   The Template Withdrawal Message MUST NOT be sent until sufficient
   time has elapsed to allow the Collecting Process to receive and
   process the last Data Record using this Template information.  This
   time MUST be configurable.  A suitable default value is 5 seconds
   after the last Data Record has been sent.

   The Template ID from a withdrawn Template MUST NOT be reused until
   sufficient time has elapsed to allow for the Collecting Process to
   receive and process the Template Withdrawal Message.

   A Template Withdrawal Message is a Template Record for that Template
   ID with a Field Count of 0.  The format of the Template Withdrawal
   Message is shown in Figure T.




<span class="grey">Claise, et al.              Standards Track                    [Page 32]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Set ID = (2 or 3)       |          Length = 16          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Template ID N        |        Field Count = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Template ID ...      |        Field Count = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Template ID M        |        Field Count = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure T: Template Withdrawal Message Format

   The Set ID field MUST contain the value 2 for Template Set Withdrawal
   and the value 3 for Options Template Set Withdrawal.  Multiple
   Template IDs MAY be withdrawn with a single Template Withdrawal
   Message, in that case, padding MAY be used.

   The Template Withdrawal Message withdraws the Template IDs for the
   Observation Domain ID specified in the IPFIX Message Header.

   The Template Withdrawal Message may be sent on any SCTP stream.  The
   Template Withdrawal Message MUST be sent reliably, using SCTP-ordered
   delivery.

   The Template Withdrawal Message MUST NOT contain new Template or
   Options Template Records.

   If the measurement parameters change such that a new Template is
   required, the Template MUST be withdrawn (using a Template Withdraw
   Message and a new Template definition) or an unused Template ID MUST
   be used.  Examples of the measurement changes are: a new sampling
   rate, a new Flow expiration process, a new filtering definition, etc.

   When the SCTP association shuts down or the Exporting Process
   restarts, all Template assignments are lost and Template IDs MUST be
   reassigned.

   If the Metering Process restarts, the Exporting Process MUST either
   reuse the previously assigned Template ID for each Template, or it
   MUST withdraw the previously issued Template IDs by sending Template
   Withdraw Message(s) before reusing them.

   A Template Withdrawal Message to withdraw all Templates for the
   Observation Domain ID specified in the IPFIX Message Header MAY be
   used.  Its format is shown in Figure U.




<span class="grey">Claise, et al.              Standards Track                    [Page 33]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Set ID = 2        |          Length = 8           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Template ID = 2       |        Field Count = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure U: All Data Templates Withdrawal Message Format

   A Template Withdrawal Message to withdraw all Options Templates for
   the Observation Domain ID specified in the IPFIX Message Header MAY
   be used.  Its format is shown in Figure V.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Set ID = 3        |          Length = 8           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Template ID = 3       |        Field Count = 0        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure V: All Options Templates Withdrawal Message Format

   When the SCTP association restarts, the Exporting Process MUST resend
   all the Template Records.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20The%20Collecting%20Process%27s%20Side"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  The Collecting Process's Side</span>

   This section describes the Collecting Process when using SCTP and
   PR-SCTP as the transport protocol.  Any necessary changes to the
   Collecting Process specifically related to TCP or UDP transport
   protocols are specified in <a href="#section-10">Section 10</a>.

   The Collecting Process SHOULD listen for a new association request
   from the Exporting Process.  The Exporting Process will request a
   number of streams to use for export.  An Exporting Process MAY
   request and support more than one stream per SCTP association.

   If the Collecting Process receives a malformed IPFIX Message, it MUST
   reset the SCTP association, discard the IPFIX Message, and SHOULD log
   the error.  Note that non-zero Set padding does not constitute a
   malformed IPFIX Message.

   Template Sets and Option Template Sets are only sent once.  The
   Collecting Process MUST store the Template Record information for the
   duration of the association so that it can interpret the
   corresponding Data Records that are received in subsequent Data Sets.



<span class="grey">Claise, et al.              Standards Track                    [Page 34]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Template IDs are unique per SCTP association and per Observation
   Domain.  If the Collecting Process receives a Template that has
   already been received but that has not previously been withdrawn
   (i.e., a Template Record from the same Exporter Observation Domain
   with the same Template ID received on the SCTP association), then the
   Collecting Process MUST shut down the association.

   When an SCTP association is closed, the Collecting Process MUST
   discard all Templates received over that association and stop
   decoding IPFIX Messages that use those Templates.

   The Collecting Process normally receives Template Records from the
   Exporting Process before receiving Data Records.  The Data Records
   are then decoded and stored by the Collector.  If the Template
   Records have not been received at the time Data Records are received,
   the Collecting Process MAY store the Data Records for a short period
   of time and decode them after the Template Records are received.  A
   Collecting Process MUST NOT assume that the Data Set and the
   associated Template Set (or Options Template Set) are exported in the
   same IPFIX Message.

   The Collecting Process MUST note the Information Element identifier
   of any Information Element that it does not understand and MAY
   discard that Information Element from the Flow Record.

   The Collector MUST accept padding in Data Records and Template
   Records.  The padding size is the Set Length minus the size of the
   Set Header (4 octets for the Set ID and the Set Length), modulo the
   Record size deduced from the Template Record.

   The IPFIX protocol has a Sequence Number field in the Export header
   that increases with the number of IPFIX Data Records in the IPFIX
   Message.  A Collector may detect out-of-sequence, dropped, or
   duplicate IPFIX Messages by tracking the Sequence Number.  A
   Collector SHOULD provide a logging mechanism for tracking
   out-of-sequence IPFIX Messages.  Such out-of-sequence IPFIX Messages
   may be due to Exporter resource exhaustion where it cannot transmit
   messages at their creation rate, an Exporting Process reset,
   congestion on the network link between the Exporter and Collector,
   Collector resource exhaustion where it cannot process the IPFIX
   Messages at their arrival rate, out-of-order packet reception,
   duplicate packet reception, or an attacker injecting false messages.

   If a Collecting Process receives a Template Withdrawal Message, the
   Collecting Process MUST delete the corresponding Template Records
   associated with the specific SCTP association and specific
   Observation Domain, and stop decoding IPFIX Messages that use the
   withdrawn Templates.



<span class="grey">Claise, et al.              Standards Track                    [Page 35]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   If the Collecting Process receives a Template Withdraw message for a
   Template Record it has not received before on this SCTP association,
   it MUST reset the SCTP association, discard the IPFIX Message, and
   SHOULD log the error as it does for malformed IPFIX Messages.

   A Collecting Process that receives IPFIX Messages from several
   Observation Domains on the same Transport Session MUST be aware that
   the uniqueness of the Template ID is not guaranteed across
   Observation Domains.

   The Collector MUST support the use of Templates containing multiple
   occurrences of the similar Information Elements.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Transport%20Protocol"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Transport Protocol</span>

   The IPFIX Protocol Specification has been designed to be transport
   protocol independent.  Note that the Exporter can export to multiple
   Collecting Processes using independent transport protocols.

   The IPFIX Message Header 16-bit Length field limits the length of an
   IPFIX Message to 65535 octets, including the header.  A Collecting
   Process MUST be able to handle IPFIX Message lengths of up to 65535
   octets.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Transport%20Compliance%20and%20Transport%20Usage"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Transport Compliance and Transport Usage</span>

   We need to differentiate between what must be implemented (so that
   operators can interoperably deploy compliant implementations from
   different vendors) and what should or could be used in various
   operational environments.  We must also make sure that ALL
   implementations can operate in a congestion-aware and
   congestion-avoidance mode.

   SCTP [<a href="rfc4960.html" title='"Stream Control Transmission Protocol"'>RFC4960</a>] using the PR-SCTP extension specified in [<a href="rfc3758.html" title='"Stream Control Transmission Protocol (SCTP) Partial Reliability Extension"'>RFC3758</a>]
   MUST be implemented by all compliant implementations.  UDP [<a href="#ref-UDP" title='"User Datagram Protocol"'>UDP</a>] MAY
   also be implemented by compliant implementations.  TCP [<a href="#ref-TCP" title='"Transmission Control Protocol"'>TCP</a>] MAY also
   be implemented by compliant implementations.

   PR-SCTP SHOULD be used in deployments where Exporters and Collectors
   are communicating over links that are susceptible to congestion.
   PR-SCTP is capable of providing any required degree of reliability.

   TCP MAY be used in deployments where Exporters and Collectors
   communicate over links that are susceptible to congestion, but
   PR-SCTP is preferred due to its ability to limit back pressure on
   Exporters and its message versus stream orientation.





<span class="grey">Claise, et al.              Standards Track                    [Page 36]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   UDP MAY be used, although it is not a congestion-aware protocol.
   However, the IPFIX traffic between Exporter and Collector MUST run in
   an environment where IPFIX traffic has been provisioned for, or is
   contained through some other means.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20SCTP"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  SCTP</span>

   This section describes how IPFIX can be transported over SCTP
   [<a href="rfc4960.html" title='"Stream Control Transmission Protocol"'>RFC4960</a>] using the PR-SCTP [<a href="rfc3758.html" title='"Stream Control Transmission Protocol (SCTP) Partial Reliability Extension"'>RFC3758</a>] extension.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.1.%20%20Congestion%20Avoidance"></a><a class="selflink" href="#section-10.2.1" name="section-10.2.1">10.2.1</a>.  Congestion Avoidance</span>

   The SCTP transport protocol provides the required level of congestion
   avoidance by design.

   SCTP will detect congestion in the end-to-end path between the IPFIX
   Exporting Process and the IPFIX Collecting Process, and limit the
   transfer rate accordingly.  When an IPFIX Exporting Process has
   records to export, but detects that transmission by SCTP is
   temporarily impossible, it can either wait until sending is possible
   again, or it can decide to drop the record.  In the latter case, the
   dropped export data MUST be accounted for, so that the amount of
   dropped export data can be reported.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.2.%20%20Reliability"></a><a class="selflink" href="#section-10.2.2" name="section-10.2.2">10.2.2</a>.  Reliability</span>

   The SCTP transport protocol is by default reliable, but has the
   capability to deliver messages with partial reliability  [<a href="rfc3758.html" title='"Stream Control Transmission Protocol (SCTP) Partial Reliability Extension"'>RFC3758</a>].

   Using reliable SCTP messages for the IPFIX export is not in itself a
   guarantee that all Data Records will be delivered.  If there is
   congestion on the link from the Exporting Process to the Collecting
   Process, or if a significant number of retransmissions are required,
   the send queues on the Exporting Process may fill up; the Exporting
   Process MAY either suspend, export, or discard the IPFIX Messages.
   If Data Records are discarded the IPFIX Sequence Numbers used for
   export MUST reflect the loss of data.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.3.%20%20MTU"></a><a class="selflink" href="#section-10.2.3" name="section-10.2.3">10.2.3</a>.  MTU</span>

   SCTP provides the required IPFIX Message fragmentation service based
   on path MTU discovery.









<span class="grey">Claise, et al.              Standards Track                    [Page 37]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.4.%20%20Exporting%20Process"></a><a class="selflink" href="#section-10.2.4" name="section-10.2.4">10.2.4</a>.  Exporting Process</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.2.4.1.%20%20Association%20Establishment"></a><a class="selflink" href="#section-10.2.4.1" name="section-10.2.4.1">10.2.4.1</a>.  Association Establishment</span>

   The IPFIX Exporting Process SHOULD initiate an SCTP association with
   the IPFIX Collecting Process.  By default, the Collecting Process
   listens for connections on SCTP port 4739.  By default, the
   Collecting Process listens for secure connections on SCTP port 4740
   (refer to the Security Considerations section).  By default, the
   Exporting Process tries to connect to one of these ports.  It MUST be
   possible to configure both the Exporting and Collecting Processes to
   use a different SCTP port.

   The Exporting Process MAY establish more than one association
   (connection "bundle" in SCTP terminology) to the Collecting Process.

   An Exporting Process MAY support more than one active association to
   different Collecting Processes (including the case of different
   Collecting Processes on the same host).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.2.4.2.%20%20%20Association%20Shutdown"></a><a class="selflink" href="#section-10.2.4.2" name="section-10.2.4.2">10.2.4.2</a>.   Association Shutdown</span>

   When an Exporting Process is shut down, it SHOULD shut down the SCTP
   association.

   When a Collecting Process no longer wants to receive IPFIX Messages,
   it SHOULD shut down its end of the association.  The Collecting
   Process SHOULD continue to receive and process IPFIX Messages until
   the Exporting Process has closed its end of the association.

   When a Collecting Process detects that the SCTP association has been
   abnormally terminated, it MUST continue to listen for a new
   association establishment.

   When an Exporting Process detects that the SCTP association to the
   Collecting Process is abnormally terminated, it SHOULD try to
   re-establish the association.

   Association timeouts SHOULD be configurable.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.2.4.3.%20%20Stream"></a><a class="selflink" href="#section-10.2.4.3" name="section-10.2.4.3">10.2.4.3</a>.  Stream</span>

   An Exporting Process MAY request more than one SCTP stream per
   association.  Each of these streams may be used for the transmission
   of IPFIX Messages containing Data Sets, Template Sets, and/or Options
   Template Sets.





<span class="grey">Claise, et al.              Standards Track                    [Page 38]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Depending on the requirements of the application, the Exporting
   Process may send Data Sets with full or partial reliability, using
   ordered or out-of-order delivery, over any SCTP stream established
   during SCTP Association setup.

   An IPFIX Exporting Process MAY use any PR-SCTP Service Definition as
   per <a href="#section-4">Section 4</a> of the PR-SCTP [<a href="rfc3758.html" title='"Stream Control Transmission Protocol (SCTP) Partial Reliability Extension"'>RFC3758</a>] specification when using
   partial reliability to transmit IPFIX Messages containing only Data
   Sets.

   However, Exporting Processes SHOULD mark such IPFIX Messages for
   retransmission for as long as resource or other constraints allow.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.2.4.4.%20%20Template%20Management"></a><a class="selflink" href="#section-10.2.4.4" name="section-10.2.4.4">10.2.4.4</a>.  Template Management</span>

   When the transport protocol is SCTP, the default Template Management
   described in <a href="#section-8">Section 8</a> is used.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.5.%20%20Collecting%20Process"></a><a class="selflink" href="#section-10.2.5" name="section-10.2.5">10.2.5</a>.  Collecting Process</span>

   When the transport protocol is SCTP, the default Collector processing
   described in <a href="#section-9">Section 9</a> is used.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.2.6.%20%20Failover"></a><a class="selflink" href="#section-10.2.6" name="section-10.2.6">10.2.6</a>.  Failover</span>

   If the Collecting Process does not acknowledge the attempt by the
   Exporting Process to establish an association, the Exporting Process
   should retry using the SCTP exponential backoff feature.  The
   Exporter MAY log an alarm if the time to establish the association
   exceeds a specified threshold, configurable on the Exporter.

   If Collecting Process failover is supported by the Exporting Process,
   a second SCTP association MAY be opened in advance.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.3.%20%20UDP"></a><a class="selflink" href="#section-10.3" name="section-10.3">10.3</a>.  UDP</span>

   This section describes how IPFIX can be transported over UDP [<a href="#ref-UDP" title='"User Datagram Protocol"'>UDP</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.1.%20%20Congestion%20Avoidance"></a><a class="selflink" href="#section-10.3.1" name="section-10.3.1">10.3.1</a>.  Congestion Avoidance</span>

   UDP has no integral congestion-avoidance mechanism.  Its use over
   congestion-sensitive network paths is therefore not recommended.  UDP
   MAY be used in deployments where Exporters and Collectors always
   communicate over dedicated links that are not susceptible to
   congestion, i.e., over provisioned links compared to the maximum
   export rate from the Exporters.





<span class="grey">Claise, et al.              Standards Track                    [Page 39]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.2.%20%20Reliability"></a><a class="selflink" href="#section-10.3.2" name="section-10.3.2">10.3.2</a>.  Reliability</span>

   UDP is not a reliable transport protocol, and cannot guarantee
   delivery of messages.  IPFIX Messages sent from the Exporting Process
   to the Collecting Process using UDP may therefore be lost.  UDP MUST
   NOT be used unless the application can tolerate some loss of IPFIX
   Messages.

   The Collecting Process SHOULD deduce the loss and reordering of IPFIX
   Data Records by looking at the discontinuities in the IPFIX Sequence
   Number.  In the case of UDP, the IPFIX Sequence Number contains the
   total number of IPFIX Data Records sent for the UDP Transport Session
   prior to the receipt of this IPFIX Message, modulo 2^32.  A Collector
   SHOULD detect out-of-sequence, dropped, or duplicate IPFIX Messages
   by tracking the Sequence Number.  Templates sent from the Exporting
   Process to the Collecting Process using UDP as a transport MUST be
   re-sent at regular intervals, in case previous copies were lost.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.3.%20%20MTU"></a><a class="selflink" href="#section-10.3.3" name="section-10.3.3">10.3.3</a>.  MTU</span>

   The maximum size of exported messages MUST be configured such that
   the total packet size does not exceed the path MTU.  If the path MTU
   is unknown, a maximum packet size of 512 octets SHOULD be used.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.4.%20%20Port%20Numbers"></a><a class="selflink" href="#section-10.3.4" name="section-10.3.4">10.3.4</a>.  Port Numbers</span>

   By default, the Collecting Process listens on the UDP port 4739.  By
   default, the Collecting Process listens for secure connections on UDP
   port 4740 (refer to the "Security Considerations" section).  By
   default, the Exporting Process tries to connect to one of these
   ports.  It MUST be possible to configure both the Exporting and
   Collecting Processes to use a different UDP port.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.5.%20%20Exporting%20Process"></a><a class="selflink" href="#section-10.3.5" name="section-10.3.5">10.3.5</a>.  Exporting Process</span>

   The Exporting Process MAY duplicate the IPFIX Message to the several
   Collecting Processes.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.6.%20%20Template%20Management"></a><a class="selflink" href="#section-10.3.6" name="section-10.3.6">10.3.6</a>.  Template Management</span>

   When IPFIX uses UDP as the transport protocol, Template Sets and
   Option Template Sets MUST be re-sent at regular intervals.  The
   frequency of the (Options) Template transmission MUST be
   configurable.  The default value for the frequency of the (Options)
   Template transmission is 10 minutes.  The Exporting Process SHOULD
   transmit the Template Set and Options Template Set in advance of any
   Data Sets that use that (Options) Template ID to help ensure that the




<span class="grey">Claise, et al.              Standards Track                    [Page 40]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Collector has the Template Record before receiving the first Data
   Record.

   In the event of configuration changes, the Exporting Process SHOULD
   send multiple copies of the new Template definitions, in different
   IPFIX Messages, at an accelerated rate.  In such a case, it SHOULD
   transmit the changed Template Record(s) and Options Template
   Record(s), without any data, in advance to help ensure that the
   Collector will have the correct Template information before receiving
   the first data.

   If the Option Template scope is defined in another Template, then
   both Templates SHOULD be sent in the same IPFIX Message.  For
   example, if a Flow Key Option Template (see <a href="#section-4.4">Section 4.4</a>) is sent in
   an Option Template, then the associated Template SHOULD be sent in
   the same IPFIX Message.

   Following a configuration change that can modify the interpretation
   of the Data Records (for example, a sampling rate change) a new
   Template ID MUST be used, and the old Template ID MUST NOT be reused
   until its lifetime (see <a href="#section-10.3.7">Section 10.3.7</a>) has expired.

   If UDP is selected as the transport protocol, the Template Withdraw
   Messages MUST NOT be used, as this method is inefficient due to the
   unreliable nature of UDP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.7.%20%20Collecting%20Process"></a><a class="selflink" href="#section-10.3.7" name="section-10.3.7">10.3.7</a>.  Collecting Process</span>

   The Collecting Process MUST associate a lifetime with each Template
   (or another definition of an identifier considered unique within the
   Transport Session) received via UDP.  Templates (and similar
   definitions) not refreshed by the Exporting Process within the
   lifetime are expired at the Collecting Process.  If the Template (or
   other definition) is not refreshed before that lifetime has expired,
   the Collecting Process MUST discard that definition and any current
   and future associated Data Records.  In which case, an alarm MUST be
   logged.  The Collecting Process MUST NOT decode any further Data
   Records that are associated with the expired Template.  If a Template
   is refreshed with a Template Record that differs from the previously
   received Template Record, the Collecting Process SHOULD log a warning
   and replace the previously received Template Record with the new one.
   The Template lifetime at the Collecting Process MUST be at least 3
   times higher than the Template refresh timeout configured on the
   Exporting Process.

   Template IDs are unique per UDP session and per Observation Domain.
   At any given time, the Collecting Process SHOULD maintain the
   following for all the current Template Records and Options Template



<span class="grey">Claise, et al.              Standards Track                    [Page 41]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Records: &lt;IPFIX Device, Exporter source UDP port, Observation Domain
   ID, Template ID, Template Definition, Last Received&gt;.

   The Collecting Process SHOULD accept Data Records without the
   associated Template Record (or other definitions) required to decode
   the Data Record.  If the Template Records (or other definitions such
   as Common Properties) have not been received at the time Data Records
   are received, the Collecting Process SHOULD store the Data Records
   for a short period of time and decode them after the Template Records
   (or other definitions) are received.  The short period of time MUST
   be lower than the lifetime of definitions associated with identifiers
   considered unique within the UDP session.

   If the Collecting Process receives a malformed IPFIX Message, it MUST
   discard the IPFIX Message and SHOULD log the error.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.8.%20%20Failover"></a><a class="selflink" href="#section-10.3.8" name="section-10.3.8">10.3.8</a>.  Failover</span>

   Because UDP is not a connection-oriented protocol, the Exporting
   Process is unable to determine from the transport protocol that the
   Collecting Process is no longer able to receive the IPFIX Messages.
   Therefore, it cannot invoke a failover mechanism.  However, the
   Exporting Process MAY duplicate the IPFIX Message to several
   Collecting Processes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.4.%20%20TCP"></a><a class="selflink" href="#section-10.4" name="section-10.4">10.4</a>.  TCP</span>

   This section describes how IPFIX can be transported over TCP [<a href="#ref-TCP" title='"Transmission Control Protocol"'>TCP</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.4.1.%20%20Connection%20Management"></a><a class="selflink" href="#section-10.4.1" name="section-10.4.1">10.4.1</a>.  Connection Management</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.1.1.%20%20Connection%20Establishment"></a><a class="selflink" href="#section-10.4.1.1" name="section-10.4.1.1">10.4.1.1</a>.  Connection Establishment</span>

   The IPFIX Exporting Process initiates a TCP connection to the
   Collecting Process.  By default, the Collecting Process listens for
   connections on TCP port 4739.  By default, the Collecting Process
   listens for secure connections on TCP port 4740 (refer to the
   Security Considerations section).  By default, the Exporting Process
   tries to connect to one of these ports.  It MUST be possible to
   configure both the Exporting Process and the Collecting Process to
   use a different TCP port.

   An Exporting Process MAY support more than one active connection to
   different Collecting Processes (including the case of different
   Collecting Processes on the same host).

   The Exporter MAY log an alarm if the time to establish the connection
   exceeds a specified threshold, configurable on the Exporter.



<span class="grey">Claise, et al.              Standards Track                    [Page 42]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.1.2.%20%20Graceful%20Connection%20Release"></a><a class="selflink" href="#section-10.4.1.2" name="section-10.4.1.2">10.4.1.2</a>.  Graceful Connection Release</span>

   When an Exporting Process is shut down, it SHOULD shut down the TCP
   connection.

   When a Collecting Process no longer wants to receive IPFIX Messages,
   it SHOULD close its end of the connection.  The Collecting Process
   SHOULD continue to read IPFIX Messages until the Exporting Process
   has closed its end.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.1.3.%20%20Restarting%20Interrupted%20Connections"></a><a class="selflink" href="#section-10.4.1.3" name="section-10.4.1.3">10.4.1.3</a>.  Restarting Interrupted Connections</span>

   When a Collecting Process detects that the TCP connection to the
   Exporting Process has terminated abnormally, it MUST continue to
   listen for a new connection.

   When an Exporting Process detects that the TCP connection to the
   Collecting Process has terminated abnormally, it SHOULD try to
   re-establish the connection.  Connection timeouts and retry schedules
   SHOULD be configurable.  In the default configuration, an Exporting
   Process MUST NOT attempt to establish a connection more frequently
   than once per minute.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.1.4.%20%20Failover"></a><a class="selflink" href="#section-10.4.1.4" name="section-10.4.1.4">10.4.1.4</a>.  Failover</span>

   If the Collecting Process does not acknowledge the attempt by the
   Exporting Process to establish a connection, it will retry using the
   TCP exponential backoff feature.

   If Collecting Process failover is supported by the Exporting Process,
   a second TCP connection MAY be opened in advance.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.4.2.%20%20Data%20Transmission"></a><a class="selflink" href="#section-10.4.2" name="section-10.4.2">10.4.2</a>.  Data Transmission</span>

   Once a TCP connection is established, the Exporting Process starts
   sending IPFIX Messages to the Collecting Process.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.2.1.%20%20IPFIX%20Message%20Encoding"></a><a class="selflink" href="#section-10.4.2.1" name="section-10.4.2.1">10.4.2.1</a>.  IPFIX Message Encoding</span>

   IPFIX Messages are sent over the TCP connection without any special
   encoding.  The Length field in the IPFIX Message Header defines the
   end of each IPFIX Message and thus the start of the next IPFIX
   Message.  This means that IPFIX Messages cannot be interleaved.

   In the case of TCP, the IPFIX Sequence Number contains the total
   number of IPFIX Data Records sent from this TCP connection, from the
   current Observation Domain by the Exporting Process, prior to the
   receipt of this IPFIX Message, modulo 2^32.



<span class="grey">Claise, et al.              Standards Track                    [Page 43]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   If an Exporting Process exports data from multiple Observation
   Domains, it should be careful to choose IPFIX Message lengths
   appropriately to minimize head-of-line blocking between different
   Observation Domains.  Multiple TCP connections MAY be used to avoid
   head-of-line between different Observation Domains.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.2.2.%20%20Template%20Management"></a><a class="selflink" href="#section-10.4.2.2" name="section-10.4.2.2">10.4.2.2</a>.  Template Management</span>

   For each Template, the Exporting Process MUST send the Template
   Record before exporting Data Records that refer to that Template.

   Template IDs are unique per TCP connection and per Observation
   Domain.  A Collecting Process MUST record all Template and Options
   Template Records for the duration of the connection, as an Exporting
   Process is not required to re-export Template Records.

   When the TCP connection restarts, the Exporting Process MUST resend
   all the Template Records.

   When a TCP connection is closed, the Collecting Process MUST discard
   all Templates received over that connection and stop decoding IPFIX
   Messages that use those Templates.

   The Templates that are not used anymore SHOULD be deleted.  Before
   reusing a Template ID, the Template MUST be deleted.  In order to
   delete an allocated Template, the Template is withdrawn through the
   use of a Template Withdrawal Message over the TCP connection.

   If the Collecting Process receives a malformed IPFIX Message, it MUST
   reset the TCP connection, discard the IPFIX Message, and SHOULD log
   the error.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/10.4.2.3.%20%20Congestion%20Handling%20and%20Reliability"></a><a class="selflink" href="#section-10.4.2.3" name="section-10.4.2.3">10.4.2.3</a>.  Congestion Handling and Reliability</span>

   TCP ensures reliable delivery of data from the Exporting Process to
   the Collecting Process.  TCP also controls the rate at which data can
   be sent from the Exporting Process to the Collecting Process, using a
   mechanism that takes into account both congestion in the network and
   the capabilities of the receiver.

   Therefore, an IPFIX Exporting Process may not be able to send IPFIX
   Messages at the rate that the Metering Process generates it, either
   because of congestion in the network or because the Collecting
   Process cannot handle IPFIX Messages fast enough.  As long as
   congestion is transient, the Exporting Process can buffer IPFIX
   Messages for transmission.  But such buffering is necessarily
   limited, both because of resource limitations and because of




<span class="grey">Claise, et al.              Standards Track                    [Page 44]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   timeliness requirements, so ongoing and/or severe congestion may lead
   to a situation where the Exporting Process is blocked.

   When an Exporting Process has Data Records to export but the
   transmission buffer is full, and it wants to avoid blocking, it can
   decide to drop some Data Records.  The dropped Data Records MUST be
   accounted for, so that the amount can later be exported.

   When an Exporting Process finds that the rate at which records should
   be exported is consistently higher than the rate at which TCP sending
   permits, it should provide back pressure to the Metering Processes.
   The Metering Process could then adapt by temporarily reducing the
   amount of data it generates, for example, using sampling or
   aggregation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.4.3.%20%20Collecting%20Process"></a><a class="selflink" href="#section-10.4.3" name="section-10.4.3">10.4.3</a>.  Collecting Process</span>

   The Collecting Process SHOULD listen for a new TCP connection from
   the Exporting Process.

   If the Collecting Process receives a malformed IPFIX Message, it MUST
   reset the TCP connection, discard the IPFIX Message, and SHOULD log
   the error.  Note that non-zero Set padding does not constitute a
   malformed IPFIX Message.

   Template Sets and Option Template Sets are only sent once.  The
   Collecting Process MUST store the Template Record information for the
   duration of the connection so that it can interpret the corresponding
   Data Records that are received in subsequent Data Sets.

   Template IDs are unique per TCP connection and per Observation
   Domain.  If the Collecting Process receives a Template that has
   already been received but that has not previously been withdrawn
   (i.e., a Template Record from the same Exporter Observation Domain
   with the same Template ID received on the TCP connection), then the
   Collecting Process MUST shut down the connection.

   When a TCP connection is closed, the Collecting Process MUST discard
   all Templates received over that connection and stop decoding IPFIX
   Messages that use those Templates.

   If a Collecting Process receives a Template Withdrawal Message, the
   Collecting Process MUST delete the corresponding Template Records
   associated with the specific TCP connection and specific Observation
   Domain, and stop decoding IPFIX Messages that use the withdrawn
   Templates.





<span class="grey">Claise, et al.              Standards Track                    [Page 45]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   If the Collecting Process receives a Template Withdrawal Message for
   a Template Record it has not received before on this TCP connection,
   it MUST reset the TCP association, discard the IPFIX Message, and
   SHOULD log the error as it does for malformed IPFIX Messages.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Security%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Security Considerations</span>

   The security considerations for the IPFIX protocol have been derived
   from an analysis of potential security threats, as discussed in the
   "Security Considerations" section of IPFIX requirements [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].
   The requirements for IPFIX security are as follows:

   1. IPFIX must provide a mechanism to ensure the confidentiality of
      IPFIX data transferred from an Exporting Process to a Collecting
      Process, in order to prevent disclosure of Flow Records
      transported via IPFIX.

   2. IPFIX must provide a mechanism to ensure the integrity of IPFIX
      data transferred from an Exporting Process to a Collecting
      Process, in order to prevent the injection of incorrect data or
      control information (e.g., Templates) into an IPFIX Message
      stream.

   3. IPFIX must provide a mechanism to authenticate IPFIX Collecting
      and Exporting Processes, to prevent the collection of data from an
      unauthorized Exporting Process or the export of data to an
      unauthorized Collecting Process.

   Because IPFIX can be used to collect information for network
   forensics and billing purposes, attacks designed to confuse, disable,
   or take information from an IPFIX collection system may be seen as a
   prime objective during a sophisticated network attack.

   An attacker in a position to inject false messages into an IPFIX
   Message stream can either affect the application using IPFIX (by
   falsifying data), or the IPFIX Collecting Process itself (by
   modifying or revoking Templates, or changing options); for this
   reason, IPFIX Message integrity is important.

   The IPFIX Messages themselves may also contain information of value
   to an attacker, including information about the configuration of the
   network as well as end-user traffic and payload data, so care must be
   taken to confine their visibility to authorized users.  When an
   Information Element containing end-user payload information is
   exported, it SHOULD be transmitted to the Collecting Process using a
   means that secures its contents against eavesdropping.  Suitable
   mechanisms include the use of either a direct point-to-point
   connection or the use of an encryption mechanism.  It is the



<span class="grey">Claise, et al.              Standards Track                    [Page 46]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   responsibility of the Collecting Process to provide a satisfactory
   degree of security for this collected data, including, if necessary,
   anonymization of any reported data.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Applicability%20of%20TLS%20and%20DTLS"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Applicability of TLS and DTLS</span>

   Transport Layer Security (TLS) [<a href="rfc4346.html" title='"The Transport Layer Security (TLS) Protocol Version 1.1"'>RFC4346</a>] and Datagram Transport Layer
   Security (DTLS) [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] were designed to provide the
   confidentiality, integrity, and authentication assurances required by
   the IPFIX protocol, without the need for pre-shared keys.

   With the mandatory SCTP and PR-SCTP transport protocols for IPFIX,
   DTLS [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] MUST be implemented.  If UDP is selected as the IPFIX
   transport protocol, DTLS [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] MUST be implemented.  If TCP is
   selected as the IPFIX transport protocol, TLS [<a href="rfc4346.html" title='"The Transport Layer Security (TLS) Protocol Version 1.1"'>RFC4346</a>] MUST be
   implemented.

   Note that DTLS is selected as the security mechanism for SCTP and
   PR-SCTP.  Though TLS bindings to SCTP are defined in [<a href="rfc3436.html" title='"Transport Layer Security over Stream Control Transmission Protocol"'>RFC3436</a>], they
   require all communication to be over reliable, bidirectional streams,
   and require one TLS connection per stream.  This arrangement is not
   compatible with the rationale behind the choice of SCTP as an IPFIX
   transport protocol.

   Note that using DTLS [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] has a vulnerability, i.e., a true man
   in the middle may attempt to take data out of an association and fool
   the sender into thinking that the data was actually received by the
   peer.  In generic TLS for SCTP (and/or TCP), this is not possible.
   This means that the removal of a message may become hidden from the
   sender or receiver.  Another vulnerability of using PR-SCTP with DTLS
   is that someone could inject SCTP control information to shut down
   the SCTP association, effectively generating a loss of IPFIX Messages
   if those are buffered outside of the SCTP association.  In the
   future, techniques such as [<a href="#ref-dtls-for-sctp" title='"Datagram Transport Layer Security for Stream Control Transmission Protocol"'>dtls-for-sctp</a>] could be used to overcome
   these vulnerabilities.

   When using DTLS over SCTP, the Exporting Process MUST ensure that
   each IPFIX Message is sent over the same SCTP stream that would be
   used when sending the same IPFIX Message directly over SCTP.  Note
   that DTLS may send its own control messages on stream 0 with full
   reliability; however, this will not interfere with the processing of
   stream 0 IPFIX Messages at the Collecting Process, because DTLS
   consumes its own control messages before passing IPFIX Messages up to
   the application layer.







<span class="grey">Claise, et al.              Standards Track                    [Page 47]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Usage"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Usage</span>

   The IPFIX Exporting Process initiates the communication to the IPFIX
   Collecting Process, and acts as a TLS or DTLS client according to
   [<a href="rfc4346.html" title='"The Transport Layer Security (TLS) Protocol Version 1.1"'>RFC4346</a>] and [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>], while the IPFIX Collecting Process acts as a
   TLS or DTLS server.  The DTLS client opens a secure connection on the
   SCTP port 4740 of the DTLS server if SCTP or PR-SCTP is selected as
   the transport protocol.  The TLS client opens a secure connection on
   the TCP port 4740 of the TLS server if TCP is selected as the
   transport protocol.  The DTLS client opens a secure connection on the
   UDP port 4740 of the DTLS server if UDP is selected as the transport
   protocol.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.3.%20%20Authentication"></a><a class="selflink" href="#section-11.3" name="section-11.3">11.3</a>.  Authentication</span>

   IPFIX Exporting Processes and IPFIX Collecting Processes are
   identified by the fully qualified domain name of the interface on
   which IPFIX Messages are sent or received, for purposes of X.509
   client and server certificates as in [<a href="rfc3280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC3280</a>].

   To prevent man-in-the-middle attacks from impostor Exporting or
   Collecting Processes, the acceptance of data from an unauthorized
   Exporting Process, or the export of data to an unauthorized
   Collecting Process, strong mutual authentication via asymmetric keys
   MUST be used for both TLS and DTLS.  Each of the IPFIX Exporting and
   Collecting Processes MUST verify the identity of its peer against its
   authorized certificates, and MUST verify that the peer's certificate
   matches its fully qualified domain name, or, in the case of SCTP, the
   fully qualified domain name of one of its endpoints.

   The fully qualified domain name used to identify an IPFIX Collecting
   Process or Exporting Process may be stored either in a subjectAltName
   extension of type dNSName, or in the most specific Common Name field
   of the Subject field of the X.509 certificate.  If both are present,
   the subjectAltName extension is given preference.

   Internationalized domain names (IDN) in either the subjectAltName
   extension of type dNSName or the most specific Common Name field of
   the Subject field of the X.509 certificate MUST be encoded using
   Punycode [<a href="rfc3492.html" title='"Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)"'>RFC3492</a>] as described in <a href="rfc3490.html#section-4">Section4 of [RFC3490]</a>,
   "Conversion Operations".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.4.%20%20Protection%20against%20DoS%20Attacks"></a><a class="selflink" href="#section-11.4" name="section-11.4">11.4</a>.  Protection against DoS Attacks</span>

   An attacker may mount a denial-of-service (DoS) attack against an
   IPFIX collection system either directly, by sending large amounts of
   traffic to a Collecting Process, or indirectly, by generating large
   amounts of traffic to be measured by a Metering Process.



<span class="grey">Claise, et al.              Standards Track                    [Page 48]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-49" id="page-49" name="page-49"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   Direct denial-of-service attacks can also involve state exhaustion,
   whether at the transport layer (e.g., by creating a large number of
   pending connections), or within the IPFIX Collecting Process itself
   (e.g., by sending Flow Records pending Template or scope information,
   a large amount of Options Template Records, etc.).

   SCTP mandates a cookie-exchange mechanism designed to defend against
   SCTP state exhaustion denial-of-service attacks.  Similarly, TCP
   provides the "SYN cookie" mechanism to mitigate state exhaustion; SYN
   cookies SHOULD be used by any Collecting Process accepting TCP
   connections.  DTLS also provides cookie exchange to protect against
   DTLS server state exhaustion.

   The reader should note that there is no way to prevent fake IPFIX
   Message processing (and state creation) for UDP &amp; SCTP communication.
   The use of TLS and DTLS can obviously prevent the creation of fake
   states, but they are themselves prone to state exhaustion attacks.
   Therefore, Collector rate limiting SHOULD be used to protect TLS &amp;
   DTLS (like limiting the number of new TLS or DTLS session per second
   to a sensible number).

   IPFIX state exhaustion attacks can be mitigated by limiting the rate
   at which new connections or associations will be opened by the
   Collecting Process, the rate at which IPFIX Messages will be accepted
   by the Collecting Process, and adaptively limiting the amount of
   state kept, particularly records waiting on Templates.  These rate
   and state limits MAY be provided by a Collecting Process; if
   provided, the limits SHOULD be user configurable.

   Additionally, an IPFIX Collecting Process can eliminate the risk of
   state exhaustion attacks from untrusted nodes by requiring TLS or
   DTLS mutual authentication, causing the Collecting Process to accept
   IPFIX Messages only from trusted sources.

   With respect to indirect denial of service, the behavior of IPFIX
   under overload conditions depends on the transport protocol in use.
   For IPFIX over TCP, TCP congestion control would cause the flow of
   IPFIX Messages to back off and eventually stall, blinding the IPFIX
   system.  PR-SCTP improves upon this situation somewhat, as some IPFIX
   Messages would continue to be received by the Collecting Process due
   to the avoidance of head-of-line blocking by SCTP's multiple streams
   and partial reliability features, possibly affording some visibility
   of the attack.  The situation is similar with UDP, as some datagrams
   may continue to be received at the Collecting Process, effectively
   applying sampling to the IPFIX Message stream, implying that some
   forensics may be left.





<span class="grey">Claise, et al.              Standards Track                    [Page 49]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-50" id="page-50" name="page-50"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   To minimize IPFIX Message loss under overload conditions, some
   mechanism for service differentiation could be used to prioritize
   IPFIX traffic over other traffic on the same link.  Alternatively,
   IPFIX Messages can be transported over a dedicated network.  In this
   case, care must be taken to ensure that the dedicated network can
   handle the expected peak IPFIX Message traffic.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.5.%20%20When%20DTLS%20or%20TLS%20Is%20Not%20an%20Option"></a><a class="selflink" href="#section-11.5" name="section-11.5">11.5</a>.  When DTLS or TLS Is Not an Option</span>

   The use of DTLS or TLS might not be possible in some cases due to
   performance issues or other operational concerns.

   Without TLS or DTLS mutual authentication, IPFIX Exporting Processes
   and Collecting Processes can fall back on using IP source addresses
   to authenticate their peers.  A policy of allocating Exporting
   Process and Collecting Process IP addresses from specified address
   ranges, and using ingress filtering to prevent spoofing, can improve
   the usefulness of this approach.  Again, completely segregating IPFIX
   traffic on a dedicated network, where possible, can improve security
   even further.  In any case, the use of open Collecting Processes
   (those that will accept IPFIX Messages from any Exporting Process
   regardless of IP address or identity) is discouraged.

   Modern TCP and SCTP implementations are resistant to blind insertion
   attacks (see [<a href="rfc1948.html" title='"Defending Against Sequence Number Attacks"'>RFC1948</a>], [<a href="rfc4960.html" title='"Stream Control Transmission Protocol"'>RFC4960</a>]); however, UDP offers no such
   protection.  For this reason, IPFIX Message traffic transported via
   UDP and not secured via DTLS SHOULD be protected via segregation to a
   dedicated network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.6.%20%20Logging%20an%20IPFIX%20Attack"></a><a class="selflink" href="#section-11.6" name="section-11.6">11.6</a>.  Logging an IPFIX Attack</span>

   IPFIX Collecting Processes MUST detect potential IPFIX Message
   insertion or loss conditions by tracking the IPFIX Sequence Number,
   and SHOULD provide a logging mechanism for reporting out-of-sequence
   messages.  Note that an attacker may be able to exploit the handling
   of out-of-sequence messages at the Collecting Process, so care should
   be taken in handling these conditions.  For example, a Collecting
   Process that simply resets the expected Sequence Number upon receipt
   of a later Sequence Number could be temporarily blinded by deliberate
   injection of later Sequence Numbers.

   IPFIX Exporting and Collecting Processes SHOULD log any connection
   attempt that fails due to authentication failure, whether due to
   being presented an unauthorized or mismatched certificate during TLS
   or DTLS mutual authentication, or due to a connection attempt from an
   unauthorized IP address when TLS or DTLS is not in use.





<span class="grey">Claise, et al.              Standards Track                    [Page 50]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-51" id="page-51" name="page-51"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   IPFIX Exporting and Collecting Processes SHOULD detect and log any
   SCTP association reset or TCP connection reset.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.7.%20%20Securing%20the%20Collector"></a><a class="selflink" href="#section-11.7" name="section-11.7">11.7</a>.  Securing the Collector</span>

   The security of the Collector and its implementation is important to
   achieve overall security.  However, it is outside the scope of this
   document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  IANA Considerations</span>

   IPFIX Messages use two fields with assigned values.  These are the
   IPFIX Version Number, indicating which version of the IPFIX Protocol
   was used to export an IPFIX Message, and the IPFIX Set ID, indicating
   the type for each set of information within an IPFIX Message.

   The IPFIX Version Number value of 10 is reserved for the IPFIX
   protocol specified in this document.  Set ID values of 0 and 1 are
   not used for historical reasons [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>].  The Set ID value of 2 is
   reserved for the Template Set.  The Set ID value of 3 is reserved for
   the Option Template Set.  All other Set ID values from 4 to 255 are
   reserved for future use.  Set ID values above 255 are used for Data
   Sets.

   New assignments in either IPFIX Version Number or IPFIX Set ID
   assignments require a Standards Action [<a href="rfc2434.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC2434</a>], i.e., they are to
   be made via Standards Track RFCs approved by the IESG.
























<span class="grey">Claise, et al.              Standards Track                    [Page 51]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-52" id="page-52" name="page-52"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20IPFIX%20Encoding%20Examples"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  IPFIX Encoding Examples</span>

   This appendix, which is a not a normative reference, contains IPFIX
   encoding examples.

   Let's consider the example of an IPFIX Message composed of a Template
   Set, a Data Set (which contains three Data Records), an Options
   Template Set and a Data Set (which contains 2 Data Records related to
   the previous Options Template Record).

   IPFIX Message:

   +--------+------------------------------------------. . .
   |        | +--------------+ +------------------+
   |Message | | Template     | | Data             |
   | Header | | Set          | | Set              |   . . .
   |        | | (1 Template) | | (3 Data Records) |
   |        | +--------------+ +------------------+
   +--------+------------------------------------------. . .

        . . .-------------------------------------------+
              +------------------+ +------------------+ |
              | Options          | | Data             | |
       . . .  | Template Set     | | Set              | |
              | (1 Template)     | | (2 Data Records) | |
              +------------------+ +------------------+ |
        . . .-------------------------------------------+

<span class="h1"><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Message Header Example</span>

   The Message Header is composed of:
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Version = 0x000a          |         Length = 152          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Export Time                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Observation Domain ID                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+









<span class="grey">Claise, et al.              Standards Track                    [Page 52]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-53" id="page-53" name="page-53"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h1"><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Template Set Examples</span>

<span class="h1"><a class="selflink" href="#appendix-A.2.1" name="appendix-A.2.1">A.2.1</a>.  Template Set Using IETF-Specified Information Elements</span>


   We want to report the following Information Elements:

   - The IPv4 source IP address: sourceIPv4Address in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
     with a length of 4 octets

   - The IPv4 destination IP address: destinationIPv4Address in
     [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets

   - The next-hop IP address (IPv4): ipNextHopIPv4Address in
     [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets

   - The number of packets of the Flow: inPacketDeltaCount in
     [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets

   - The number of octets of the Flow: inOctetDeltaCount in
     [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets

   Therefore, the Template Set will be composed of the following:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 2            |      Length = 28 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 256         |       Field Count = 5         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|    sourceIPv4Address = 8    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0| destinationIPv4Address = 12 |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|  ipNextHopIPv4Address = 15  |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|   inPacketDeltaCount = 2    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|   inOctetDeltaCount =  1    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h1"><a class="selflink" href="#appendix-A.2.2" name="appendix-A.2.2">A.2.2</a>.  Template Set Using Enterprise-Specific Information Elements</span>

   We want to report the following Information Elements:

   - The IPv4 source IP address: sourceIPv4Address in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a
     length of 4 octets



<span class="grey">Claise, et al.              Standards Track                    [Page 53]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-54" id="page-54" name="page-54"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   - The IPv4 destination IP address: destinationIPv4Address in
     [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets

   - An enterprise-specific Information Element representing proprietary
     information, with a type of 15 and a length of 4

   - The number of packets of the Flow: inPacketDeltaCount in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
     with a length of 4 octets

   - The number of octets of the Flow: inOctetDeltaCount in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
     with a length of 4 octets

   Therefore, the Template Set will be composed of the following:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 2            |      Length = 32 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 257         |       Field Count = 5         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|    sourceIPv4Address = 8    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0| destinationIPv4Address = 12 |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1| Information Element Id. = 15|       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Enterprise number                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|   inPacketDeltaCount = 2    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|   inOctetDeltaCount = 1     |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


















<span class="grey">Claise, et al.              Standards Track                    [Page 54]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-55" id="page-55" name="page-55"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h1"><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Data Set Example</span>

   In this example, we report the following three Flow Records:

   Src IP addr. | Dst IP addr.  | Next Hop addr. | Packet | Octets
                |               |                | Number | Number
   ------------------------------------------------------------------
   192.0.2.12   | 192.0.2.254   | 192.0.2.1      | 5009   | 5344385
   192.0.2.27   | 192.0.2.23    | 192.0.2.2      | 748    | 388934
   192.0.2.56   | 192.0.2.65    | 192.0.2.3      | 5      | 6534

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Set ID = 256         |          Length = 64          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.12                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.254                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.1                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             5009                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            5344385                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.27                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.23                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.2                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              748                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             388934                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.56                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.65                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.0.2.3                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               5                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              6534                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Note that padding is not necessary in this example.



<span class="grey">Claise, et al.              Standards Track                    [Page 55]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-56" id="page-56" name="page-56"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h1"><a class="selflink" href="#appendix-A.4" name="appendix-A.4">A.4</a>.  Options Template Set Examples</span>

<span class="h1"><a class="selflink" href="#appendix-A.4.1" name="appendix-A.4.1">A.4.1</a>.  Options Template Set Using IETF-Specified Information Elements</span>

   Per line card (the router being composed of two line cards), we want
   to report the following Information Elements:

   - Total number of IPFIX Messages: exportedPacketCount [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with
     a length of 2 octets

   - Total number of exported Flows: exportedFlowCount [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a
     length of 2 octets

   The line card, which is represented by the lineCardId Information
   Element [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], is used as the Scope Field.

   Therefore, the Options Template Set will be:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 3            |          Length = 24          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 258         |        Field Count = 3        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope Field Count = 1     |0|     lineCardId = 141        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Scope 1 Field Length = 4    |0|  exportedPacketCount = 41   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Field Length = 2        |0|   exportedFlowCount = 42    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Field Length = 2        |           Padding             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h1"><a class="selflink" href="#appendix-A.4.2" name="appendix-A.4.2">A.4.2</a>.  Options Template Set Using Enterprise-Specific Information</span>
        Elements

   Per line card (the router being composed of two line cards), we want
   to report the following Information Elements:

      - Total number of IPFIX Messages: exportedPacketCount [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
        with a length of 2 octets

      - An enterprise-specific number of exported Flows, with a type of
        42 and a length of 4 octets

   The line card, which is represented by the lineCardId Information
   Element [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], is used as the Scope Field.



<span class="grey">Claise, et al.              Standards Track                    [Page 56]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-57" id="page-57" name="page-57"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   The format of the Options Template Set is as follows:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         Set ID = 3            |          Length = 28          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Template ID 259         |        Field Count = 3        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Scope Field Count = 1     |0|     lineCardId = 141        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Scope 1 Field Length = 4    |0|  exportedPacketCount = 41   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Field Length = 2        |1|Information Element Id. = 42 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Field Length = 4        |       Enterprise number     ...
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ...      Enterprise number      |           Padding             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h1"><a class="selflink" href="#appendix-A.4.3" name="appendix-A.4.3">A.4.3</a>.  Options Template Set Using an Enterprise-Specific Scope</span>

   In this example, we want to export the same information as in the
   example in Section A.4.1:

      - Total number of IPFIX Messages: exportedPacketCount [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
        with a length of 2 octets

      - Total number of exported Flows: exportedFlowCount [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
        with a length of 2 octets

   But this time, the information pertains to a proprietary scope,
   identified by enterprise-specific Information Element number 123.


















<span class="grey">Claise, et al.              Standards Track                    [Page 57]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-58" id="page-58" name="page-58"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   The format of the Options Template Set is now as follows:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         Set ID = 3            |          Length = 28          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Template ID 260         |        Field Count = 3        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Scope Field Count = 1     |1|Scope 1 Infor. El. Id. = 123 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Scope 1 Field Length = 4   |       Enterprise Number      ...
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ...       Enterprise Number      |0|  exportedPacketCount = 41   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Field Length = 2        |0|   exportedFlowCount = 42    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Field Length = 2        |           Padding             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h1"><a class="selflink" href="#appendix-A.4.4" name="appendix-A.4.4">A.4.4</a>.  Data Set Using an Enterprise-Specific Scope</span>

   In this example, we report the following two Data Records:

   Line Card ID               | IPFIX Message  | Exported Flow Records
   -------------------------------------------------------------------
   Line Card 1 (lineCardId=1) | 345            | 10201
   Line Card 2 (lineCardId=2) | 690            | 20402

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Set ID = 260             |         Length = 20           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               1                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             345               |            10201              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               2                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             690               |            20402              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+









<span class="grey">Claise, et al.              Standards Track                    [Page 58]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-59" id="page-59" name="page-59"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


<span class="h1"><a class="selflink" href="#appendix-A.5" name="appendix-A.5">A.5</a>.  Variable-Length Information Element Examples</span>

<span class="h1"><a class="selflink" href="#appendix-A.5.1" name="appendix-A.5.1">A.5.1</a>.  Example of Variable-Length Information Element with Length</span>
        Inferior to 255 Octets

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       5       |          5 octet Information Element          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h1"><a class="selflink" href="#appendix-A.5.2" name="appendix-A.5.2">A.5.2</a>.  Example of Variable-Length Information Element with Length 255</span>
        to 65535 Octets

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      255      |             1000              |    IE ...     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                1000 octet Information Element                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   :                              ...                              :
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             ... IE            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

References

Normative References

   [<a id="ref-RFC1305" name="ref-RFC1305">RFC1305</a>]       Mills, D., "Network Time Protocol (Version 3)
                   Specification, Implementation and Analysis", <a href="rfc1305.html">RFC</a>
                   <a href="rfc1305.html">1305</a>, March 1992.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]       Bradner, S., "Key words for use in RFCs to Indicate
                   Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2434" name="ref-RFC2434">RFC2434</a>]       Narten, T. and H. Alvestrand, "Guidelines for Writing
                   an IANA Considerations Section in RFCs", <a href="http://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc2434.html">RFC</a>
                   <a href="rfc2434.html">2434</a>, October 1998.

   [<a id="ref-RFC3280" name="ref-RFC3280">RFC3280</a>]       Housley, R., Polk, W., Ford, W., and D. Solo,
                   "Internet X.509 Public Key Infrastructure Certificate
                   and Certificate Revocation List (CRL) Profile", <a href="rfc3280.html">RFC</a>
                   <a href="rfc3280.html">3280</a>, April 2002.




<span class="grey">Claise, et al.              Standards Track                    [Page 59]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-60" id="page-60" name="page-60"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   [<a id="ref-RFC3436" name="ref-RFC3436">RFC3436</a>]       Jungmaier, A., Rescorla, E., and M. Tuexen,
                   "Transport Layer Security over Stream Control
                   Transmission Protocol", <a href="rfc3436.html">RFC 3436</a>, December 2002.

   [<a id="ref-RFC3758" name="ref-RFC3758">RFC3758</a>]       Stewart, R., Ramalho, M., Xie, Q., Tuexen, M., and P.
                   Conrad, "Stream Control Transmission Protocol (SCTP)
                   Partial Reliability Extension", <a href="rfc3758.html">RFC 3758</a>, May 2004.

   [<a id="ref-RFC4346" name="ref-RFC4346">RFC4346</a>]       Dierks, T. and E. Rescorla, "The Transport Layer
                   Security (TLS) Protocol Version 1.1", <a href="rfc4346.html">RFC 4346</a>, April
                   2006.

   [<a id="ref-RFC4347" name="ref-RFC4347">RFC4347</a>]       Rescorla, E. and N. Modadugu, "Datagram Transport
                   Layer Security", <a href="rfc4347.html">RFC 4347</a>, April 2006.

   [<a id="ref-RFC3490" name="ref-RFC3490">RFC3490</a>]       Faltstrom, P., Hoffman, P., and A. Costello,
                   "Internationalizing Domain Names in Applications
                   (IDNA)", <a href="rfc3490.html">RFC 3490</a>, March 2003.

   [<a id="ref-RFC3492" name="ref-RFC3492">RFC3492</a>]       Costello, A., "Punycode: A Bootstring encoding of
                   Unicode for Internationalized Domain Names in
                   Applications (IDNA)", <a href="rfc3492.html">RFC 3492</a>, March 2003.

   [<a id="ref-RFC4960" name="ref-RFC4960">RFC4960</a>]       Stewart, R., Ed., "Stream Control Transmission
                   Protocol", <a href="rfc4960.html">RFC 4960</a>, September 2007.

   [<a id="ref-RFC5102" name="ref-RFC5102">RFC5102</a>]       Quittek, J., Bryant S., Claise, B., Aitken, P., and
                   J. Meyer, "Information Model for IP Flow Information
                   Export", <a href="rfc5102.html">RFC 5102</a>, January 2008.

   [<a id="ref-TCP" name="ref-TCP">TCP</a>]           Postel, J., "Transmission Control Protocol", STD 7,
                   <a href="rfc793.html">RFC 793</a>, September 1981.

   [<a id="ref-UDP" name="ref-UDP">UDP</a>]           Postel, J., "User Datagram Protocol", STD 6, <a href="rfc768.html">RFC 768</a>,
                   August 1980.

Informative References

   [<a id="ref-IPFIX-ARCH" name="ref-IPFIX-ARCH">IPFIX-ARCH</a>]    Sadasivan, G., Brownlee, N., Claise, B., and J.
                   Quittek, "Architecture Model for IP Flow Information
                   Export", Work in Progress, September 2006.

   [<a id="ref-IPFIX-AS" name="ref-IPFIX-AS">IPFIX-AS</a>]      Zseby, T., Boschi, E., Brownlee, N., and B. Claise,
                   "IPFIX Applicability", Work in Progress, June 2007.

   [<a id="ref-PEN" name="ref-PEN">PEN</a>]           IANA Private Enterprise Numbers registry
                   <a href="http://www.iana.org/assignments/enterprise-numbers">http://www.iana.org/assignments/enterprise-numbers</a>.




<span class="grey">Claise, et al.              Standards Track                    [Page 60]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-61" id="page-61" name="page-61"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


   [<a id="ref-RFC1948" name="ref-RFC1948">RFC1948</a>]       Bellovin, S., "Defending Against Sequence Number
                   Attacks", <a href="rfc1948.html">RFC 1948</a>, May 1996.

   [<a id="ref-RFC2579" name="ref-RFC2579">RFC2579</a>]       McCloghrie, K., Perkins, D., and J. Schoenwaelder,
                   "Textual Conventions for SMIv2", STD 58, <a href="rfc2579.html">RFC 2579</a>,
                   April 1999.

   [<a id="ref-RFC3917" name="ref-RFC3917">RFC3917</a>]       Quittek, J., Zseby, T., Claise, B., and S. Zander,
                   "Requirements for IP Flow Information Export
                   (IPFIX)", <a href="rfc3917.html">RFC 3917</a>, October 2004.

   [<a id="ref-RFC3550" name="ref-RFC3550">RFC3550</a>]       Schulzrinne, H., Casner, S., Frederick, R., and V.
                   Jacobson, "RTP: A Transport Protocol for Real-Time
                   Applications", STD 64, <a href="rfc3550.html">RFC 3550</a>, July 2003.

   [<a id="ref-RFC3954" name="ref-RFC3954">RFC3954</a>]       Claise, B., Ed., "Cisco Systems NetFlow Services
                   Export Version 9", <a href="rfc3954.html">RFC 3954</a>, October 2004.

   [<a id="ref-IEEE.754.1985" name="ref-IEEE.754.1985">IEEE.754.1985</a>] Institute of Electrical and Electronics Engineers,
                   "Standard for Binary Floating-Point Arithmetic", IEEE
                   Standard 754, August 1985.

   [<a id="ref-dtls-for-sctp" name="ref-dtls-for-sctp">dtls-for-sctp</a>] Tuexen, M. and E. Rescola, "Datagram Transport Layer
                   Security for Stream Control Transmission Protocol",
                   Work in Progress, November 2007.

Acknowledgments

   We would like to thank the following persons: Ganesh Sadasivan for
   his significant contribution during the initial phases of the
   protocol specification; Juergen Quittek for the coordination job
   within IPFIX and PSAMP; Nevil Brownlee, Dave Plonka, Paul Aitken, and
   Andrew Johnson for the thorough reviews; Randall Stewart and Peter
   Lei for their SCTP expertise and contributions; Martin Djernaes for
   the first essay on the SCTP section; Michael Behringer and Eric
   Vyncke for their advice and knowledge in security; Michael Tuexen for
   his help regarding the DTLS section; Elisa Boschi for her
   contribution regarding the improvement of SCTP sections; Mark
   Fullmer, Sebastian Zander, Jeff Meyer, Maurizio Molina, Carter
   Bullard, Tal Givoly, Lutz Mark, David Moore, Robert Lowe, Paul
   Calato, and many more, for the technical reviews and feedback.










<span class="grey">Claise, et al.              Standards Track                    [Page 61]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-62" id="page-62" name="page-62"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


Authors' Addresses

   Benoit Claise
   Cisco Systems
   De Kleetlaan 6a b1
   1831 Diegem
   Belgium
   Phone: +32 2 704 5622
   EMail: bclaise@cisco.com

   Stewart Bryant
   Cisco Systems, Inc.
   250, Longwater,
   Green Park,
   Reading, RG2 6GB,
   United Kingdom
   Phone: +44 (0)20 8824-8828
   EMail: stbryant@cisco.com

   Simon Leinen
   SWITCH
   Werdstrasse 2
   P.O. Box
   CH-8021 Zurich
   Switzerland
   Phone: +41 44 268 1536
   EMail: simon.leinen@switch.ch

   Thomas Dietz
   NEC Europe Ltd.
   NEC Laboratories Europe
   Network Research Division
   Kurfuersten-Anlage 36
   69115 Heidelberg
   Germany
   Phone: +49 6221 4342-128
   EMail: Thomas.Dietz@nw.neclab.eu

   Brian H. Trammell
   CERT Network Situational Awareness
   Software Engineering Institute
   4500 Fifth Avenue
   Pittsburgh, PA 15213
   United States
   Phone: +1 412 268 9748
   EMail: bht@cert.org





<span class="grey">Claise, et al.              Standards Track                    [Page 62]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-63" id="page-63" name="page-63"> </a>
<span class="grey"><a href="rfc5101.html">RFC 5101</a>              IPFIX Protocol Specification          January 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="http://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="http://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Claise, et al.              Standards Track                    [Page 63]

</pre><br/>
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.107, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>



</body><!-- Mirrored from tools.ietf.org/html/rfc5101 by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 07 Jun 2014 20:18:44 GMT --></html>