<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.106" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:rfc:3247" />
<meta name="DC.Description.Abstract" content="This document is intended to supplement [6]. Its primary motivation is\nproviding additional explanation to the revised EF definition and its\nproperties. The document also provides additional implementation\nexamples and gives some guidance for computation of the numerical\nparameters of the new definition for several well known schedulers and\nrouter architectures.   Contents" />
<meta name="DC.Creator" content="Bennett, Jon" />
<meta name="DC.Creator" content="Chiu, Angela" />
<meta name="DC.Creator" content="Davari, Shahram" />
<meta name="DC.Creator" content="Center, Tellabs Research" />
<meta name="DC.Creator" content="Firoiu, Victor" />
<meta name="DC.Creator" content="Charny, Anna" />
<meta name="DC.Creator" content="Boudec, Jean-Yves Le" />
<meta name="DC.Creator" content="Davie, Bruce" />
<meta name="DC.Creator" content="Courtney, William" />
<meta name="DC.Creator" content="Baker, Fred" />
<meta name="DC.Date.Issued" content="March, 2002" />
<meta name="DC.Title" content="Fred Baker Cisco Systems" />

    <link rel="icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 3247 - Fred Baker Cisco Systems</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgorange"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc3247.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc3247" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-diffserv-ef-supplemental" title="draft-ietf-diffserv-ef-supplemental">draft-ietf-diffse...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3247" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc3247" title="Side-by-side diff">Diff2</a>] [<a href="http://www.rfc-editor.org/errata_search.php?rfc=3247">Errata</a>]        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br />
<span class="pre noprint docinfo">                                                            <span style='color: #C00;'>Errata Exist</span></span><br />
<pre>
Network Working Group                                          A. Charny
Request for Comments: 3247                           Cisco Systems, Inc.
Category: Informational                                   J.C.R. Bennett
                                                                Motorola
                                                               K. Benson
                                                                 Tellabs
                                                          J.Y. Le Boudec
                                                                    EPFL
                                                                 A. Chiu
                                                         Celion Networks
                                                             W. Courtney
                                                                     TRW
                                                               S. Davari
                                                              PMC-Sierra
                                                               V. Firoiu
                                                         Nortel Networks
                                                             C. Kalmanek
                                                           AT&amp;T Research
                                                       K.K. Ramakrishnan
                                                      TeraOptic Networks
                                                              March 2002


            <span class="h1">Supplemental Information for the New Definition</span>
         <span class="h1">of the EF PHB (Expedited Forwarding Per-Hop Behavior)</span>

Status of this Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2001).  All Rights Reserved.

Abstract

   This document was written during the process of clarification of
   <a href="rfc2598.html">RFC2598</a> "An Expedited Forwarding PHB" that led to the publication of
   revised specification of EF "An Expedited Forwarding PHB".  Its
   primary motivation is providing additional explanation to the revised
   EF definition and its properties.  The document also provides
   additional implementation examples and gives some guidance for
   computation of the numerical parameters of the new definition for
   several well known schedulers and router architectures.





<span class="grey">Charny, et. al.              Informational                      [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


Table of Contents

   <a href="#section-1">1</a>      Introduction  ...........................................   <a href="#page-2">2</a>
   <a href="#section-2">2</a>      Definition of EF PHB  ...................................   <a href="#page-3">3</a>
   <a href="#section-2.1">2.1</a>    The formal definition  ..................................   <a href="#page-3">3</a>
   <a href="#section-2.2">2.2</a>    Relation to Packet Scale Rate Guarantee  ................   <a href="#page-6">6</a>
   <a href="#section-2.3">2.3</a>    The need for dual characterization of EF PHB  ...........   <a href="#page-7">7</a>
   <a href="#section-3">3</a>      Per Packet delay  .......................................   <a href="#page-9">9</a>
   <a href="#section-3.1">3.1</a>    Single hop delay bound  .................................   <a href="#page-9">9</a>
   <a href="#section-3.2">3.2</a>    Multi-hop worst case delay  .............................  <a href="#page-10">10</a>
   <a href="#section-4">4</a>      Packet loss  ............................................  <a href="#page-10">10</a>
   <a href="#section-5">5</a>      Implementation considerations  ..........................  <a href="#page-11">11</a>
   5.1    The output buffered model with EF FIFO at the output.  ..  <a href="#page-12">12</a>
   <a href="#section-5.1.1">5.1.1</a>  Strict Non-preemptive Priority Queue  ...................  <a href="#page-12">12</a>
   <a href="#section-5.1.2">5.1.2</a>  WF2Q  ...................................................  <a href="#page-13">13</a>
   <a href="#section-5.1.3">5.1.3</a>  Deficit Round Robin (DRR)  ..............................  <a href="#page-13">13</a>
   <a href="#section-5.1.4">5.1.4</a>  Start-Time Fair Queuing and Self-Clocked Fair Queuing  ..  <a href="#page-13">13</a>
   <a href="#section-5.2">5.2</a>    Router with Internal Delay and EF FIFO at the output  ...  <a href="#page-13">13</a>
   <a href="#section-6">6</a>      Security Considerations  ................................  <a href="#page-14">14</a>
   <a href="#section-7">7</a>      References  .............................................  <a href="#page-14">14</a>
   <a href="#appendix-A">Appendix A</a>. Difficulties with the <a href="rfc2598.html">RFC 2598</a> EF PHB Definition  ..  <a href="#page-16">16</a>
   <a href="#appendix-B">Appendix B</a>. Alternative Characterization of Packet Scale Rate
               Guarantee  .........................................  <a href="#page-20">20</a>
   Acknowledgements  ..............................................  <a href="#page-22">22</a>
   Authors' Addresses  ............................................  <a href="#page-22">22</a>
   Full Copyright Statement  ......................................  <a href="#page-24">24</a>

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>. Introduction</span>

   The Expedited Forwarding (EF) Per-Hop Behavior (PHB) was designed to
   be used to build a low-loss, low-latency, low-jitter, assured
   bandwidth service.  The potential benefits of this service, and
   therefore the EF PHB, are enormous.  Because of the great value of
   this PHB, it is critical that the forwarding behavior required of and
   delivered by an EF-compliant node be specific, quantifiable, and
   unambiguous.

   Unfortunately, the definition of EF PHB in the original <a href="rfc2598.html">RFC2598</a> [<a href="#ref-10" title="&quot;An Expedited Forwarding PHB&quot;">10</a>]
   was not sufficiently precise (see <a href="#appendix-A">Appendix A</a> and [<a href="#ref-4" title="&quot;Delay Jitter Bounds and Packet Scale Rate Guarantee for Expedited Forwarding&quot;">4</a>]).  A more
   precise definition is given in [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>].  This document is intended to aid
   in the understanding of the properties of the new definition and
   provide supplemental information not included in the text of [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>] for
   sake of brevity.

   This document is outlined as follows.  In <a href="#section-2">section 2</a>, we briefly
   restate the definition for EF PHB of [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>].  We then provide some
   additional discussion of this definition and describe some of its
   properties.  We discuss the issues associated with per-packet delay



<span class="grey">Charny, et. al.              Informational                      [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   and loss in sections <a href="#section-3">3</a> and <a href="#section-4">4</a>.  In <a href="#section-5">section 5</a> we discuss the impact of
   known scheduling architectures on the critical parameters of the new
   definition.  We also discuss the impact of deviation of real devices
   from the ideal output-buffered model on the magnitude of the critical
   parameters in the definition.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>. Definition of EF PHB</span>

<span class="h3"><a class="selflink" name="section-2.1" href="#section-2.1">2.1</a>. The formal definition</span>

   An intuitive explanation of the new EF definition is described in
   [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>].  Here we restate the formal definition from [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>] verbatim.

   A node that supports EF on an interface I at some configured rate R
   MUST satisfy the following equations:

      d_j &lt;= f_j + E_a for all j&gt;0                                (eq_1)

   where f_j is defined iteratively by

      f_0 = 0, d_0 = 0

      f_j = max(a_j, min(d_j-1, f_j-1)) + l_j/R,  for all j &gt; 0   (eq_2)

   In this definition:

      -  d_j is the time that the last bit of the j-th EF packet to
         depart actually leaves the node from the interface I.

      -  f_j is the target departure time for the j-th EF packet to
         depart from I, the "ideal" time at or before which the last bit
         of that packet should leave the node.

      -  a_j is the time that the last bit of the j-th EF packet
         destined to the output I actually arrives at the node.

      -  l_j is the size (bits) of the j-th EF packet to depart from I.
         l_j is measured on the IP datagram (IP header plus payload) and
         does not include any lower layer (e.g. MAC layer) overhead.

      -  R is the EF configured rate at output I (in bits/second).

      -  E_a is the error term for the treatment of the EF aggregate.
         Note that E_a represents the worst case deviation between
         actual departure time of an EF packet and ideal departure time
         of the same packet, i.e. E_a provides an upper bound on (d_j -
         f_j) for all j.




<span class="grey">Charny, et. al.              Informational                      [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


      -  d_0 and f_0 do not refer to a real packet departure but are
         used purely for the purposes of the recursion.  The time origin
         should be chosen such that no EF packets are in the system at
         time 0.

      -  for the definitions of a_j and d_j, the "last bit" of the
         packet includes the layer 2 trailer if present, because a
         packet cannot generally be considered available for forwarding
         until such a trailer has been received.

   An EF-compliant node MUST be able to be characterized by the range of
   possible R values that it can support on each of its interfaces while
   conforming to these equations, and the value of E_a that can be met
   on each interface.  R may be line rate or less.  E_a MAY be specified
   as a worst-case value for all possible R values or MAY be expressed
   as a function of R.

   Note also that, since a node may have multiple inputs and complex
   internal scheduling, the j-th EF packet to arrive at the node
   destined for a certain interface may not be the j-th EF packet to
   depart from that interface.  It is in this sense that eq_1 and eq_2
   are unaware of packet identity.

   In addition, a node that supports EF on an interface I at some
   configured rate R MUST satisfy the following equations:

      D_j &lt;= F_j + E_p for all j&gt;0                                (eq_3)

   where F_j is defined iteratively by

      F_0 = 0, D_0 = 0

      F_j = max(A_j, min(D_j-1, F_j-1)) + L_j/R,  for all j &gt; 0   (eq_4)

   In this definition:

      -  D_j is the actual departure time of the individual EF packet
         that arrived at the node destined for interface I at time A_j,
         i.e., given a packet which was the j-th EF packet destined for
         I to arrive at the node via any input, D_j is the time at which
         the last bit of that individual packet actually leaves the node
         from the interface I.

      -  F_j is the target departure time for the individual EF packet
         that arrived at the node destined for interface I at time A_j.






<span class="grey">Charny, et. al.              Informational                      [Page 4]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


      -  A_j is the time that the last bit of the j-th EF packet
         destined to the output I to arrive actually arrives at the
         node.

      -  L_j is the size (bits) of the j-th EF packet to arrive at the
         node that is destined to output I. L_j is measured on the IP
         datagram (IP header plus payload) and does not include any
         lower layer (e.g. MAC layer) overhead.

      -  R is the EF configured rate at output I (in bits/second).

      -  E_p is the error term for the treatment of individual EF
         packets.  Note that E_p represents the worst case deviation
         between the actual departure time of an EF packet and the ideal
         departure time of the same packet, i.e. E_p provides an upper
         bound on (D_j - F_j) for all j.

      -  D_0 and F_0 do not refer to a real packet departure but are
         used purely for the purposes of the recursion.  The time origin
         should be chosen such that no EF packets are in the system at
         time 0.

      -  for the definitions of A_j and D_j, the "last bit" of the
         packet includes the layer 2 trailer if present, because a
         packet cannot generally be considered available for forwarding
         until such a trailer has been received.

   It is the fact that D_j and F_j refer to departure times for the j-th
   packet to arrive that makes eq_3 and eq_4 aware of packet identity.
   This is the critical distinction between the last two equations and
   the first two.

   An EF-compliant node SHOULD be able to be characterized by the range
   of possible R values that it can support on each of its interfaces
   while conforming to these equations, and the value of E_p that can be
   met on each interface.  E_p MAY be specified as a worst-case value
   for all possible R values or MAY be expressed as a function of R. An
   E_p value of "undefined" MAY be specified.

   Finally, there is an additional recommendation in [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>] that an EF
   compliant node SHOULD NOT reorder packets within a micorflow.

   The definitions described in this section are referred to as
   aggregate and packet-identity-aware packet scale rate guarantee
   [<a href="#ref-4" title="&quot;Delay Jitter Bounds and Packet Scale Rate Guarantee for Expedited Forwarding&quot;">4</a>],[<a href="#ref-2" title="&quot;Network Calculus&quot;">2</a>].  An alternative mathematical characterization of packet
   scale rate guarantee is given in <a href="#appendix-B">Appendix B</a>.





<span class="grey">Charny, et. al.              Informational                      [Page 5]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


<span class="h3"><a class="selflink" name="section-2.2" href="#section-2.2">2.2</a>. Relation to Packet Scale Rate Guarantee</span>

   Consider the case of an ideal output-buffered device with an EF FIFO
   at the output.  For such a device, the i-th packet to arrive to the
   device is also the i-th packet to depart from the device.  Therefore,
   in this ideal model the aggregate behavior and packet-identity-aware
   characteristics are identical, and E_a = E_p.  In this section we
   therefore omit the subscript and refer to the latency term simply as
   E.

   It could be shown that for such an ideal device the definition of
   <a href="#section-2.1">section 2.1</a> is stronger than the well-known rate-latency curve [<a href="#ref-2" title="&quot;Network Calculus&quot;">2</a>] in
   the sense that if a scheduler satisfies the EF definition it also
   satisfies the rate-latency curve.  As a result, all the properties
   known for the rate-latency curve also apply to the modified EF
   definition.  However, we argue below that the definition of <a href="#section-2.1">section</a>
   <a href="#section-2.1">2.1</a> is more suitable to reflect the intent of EF PHB than the rate-
   latency curve.

   It is shown in [<a href="#ref-2" title="&quot;Network Calculus&quot;">2</a>] that the rate-latency curve is equivalent to the
   following definition:

   Definition of Rate Latency Curve (RLC):

      D(j) &lt;= F'(j) + E                                           (eq_5)

   where

      F'(0)=0, F'(j)=max(a(j), F'(j-1))+ L(j)/R for all j&gt;0       (eq_6)

   It can be easily verified that the EF definition of <a href="#section-2.1">section 2.1</a> is
   stronger than RLC by noticing that for all j, F'(j) &gt;= F(j).

   It is easy to see that F'(j) in the definition of RLC corresponds to
   the time the j-th departure should have occurred should the EF
   aggregate be constantly served exactly at its configured rate R.
   Following the common convention, we refer to F'(j) as the "fluid
   finish time" of the j-th packet to depart.

   The intuitive meaning of the rate-latency curve of RLC is that any
   packet is served at most time E later than this packet would finish
   service in the fluid model.

   For RLC (and hence for the stronger EF definition) it holds that in
   any interval (0,t) the EF aggregate gets close to the desired service
   rate R (as long as there is enough traffic to sustain this rate).
   The discrepancy between the ideal and the actual service in this
   interval depends on the latency term E, which in turn depends on the



<span class="grey">Charny, et. al.              Informational                      [Page 6]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   scheduling implementation.  The smaller E, the smaller the difference
   between the configured rate and the actual rate achieved by the
   scheduler.

   While RLC guarantees the desired rate to the EF aggregate in all
   intervals (0,t) to within a specified error, it may nevertheless
   result in large gaps in service.  For example, suppose that (a large
   number) N of identical EF packets of length L arrived from different
   interfaces to the EF queue in the absence of any non-EF traffic.
   Then any work-conserving scheduler will serve all N packets at link
   speed.  When the last packet is sent at time NL/C, where C is the
   capacity of output link, F'(N) will be equal to NL/R.  That is, the
   scheduler is running ahead of ideal, since NL/C &lt; NL/R for R &lt; C.
   Suppose now that at time NL/C a large number of non-EF packets
   arrive, followed by a single EF packet.  Then the scheduler can
   legitimately delay starting to send the EF packet until time
   F'(N+1)=(N+1)L/R + E - L/C.  This means that the EF aggregate will
   have no service at all in the interval (NL/C, (N+1)L/R + E - L/C).
   This interval can be quite large if R is substantially smaller than
   C.  In essence, the EF aggregate can be "punished" by a gap in
   service for receiving faster service than its configured rate at the
   beginning.

   The new EF definition alleviates this problem by introducing the term
   min(D(j-1), F(j-1)) in the recursion.  Essentially, this means that
   the fluid finishing time is "reset" if that packet is sent before its
   "ideal" departure time.  As a consequence of that, for the case where
   the EF aggregate is served in the FIFO order, suppose a packet
   arrives at time t to a server satisfying the EF definition.  The
   packet will be transmitted no later than time t + Q(t)/R + E, where
   Q(t) is the EF queue size at time t (including the packet under
   discussion)[<a href="#ref-4" title="&quot;Delay Jitter Bounds and Packet Scale Rate Guarantee for Expedited Forwarding&quot;">4</a>].

<span class="h3"><a class="selflink" name="section-2.3" href="#section-2.3">2.3</a>. The need for dual characterization of EF PHB</span>

   In a more general case, where either the output scheduler does not
   serve the EF packets in a FIFO order, or the variable internal delay
   in the device reorders packets while delivering them to the output
   (or both), the i-th packet destined to a given output interface to
   arrive to the device may no longer be the i-th packet to depart from
   that interface.  In that case the packet-identity-aware and the
   aggregate definitions are no longer identical.

   The aggregate behavior definition can be viewed as a truly aggregate
   characteristic of the service provided to EF packets.  For an
   analogy, consider a dark reservoir to which all arriving packets are
   placed.  A scheduler is allowed to pick a packet from the reservoir
   in a random order, without any knowledge of the order of packet



<span class="grey">Charny, et. al.              Informational                      [Page 7]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   arrivals.  The aggregate part of the definition measures the accuracy
   of the output rate provided to the EF aggregate as a whole.  The
   smaller E_a, the more accurate is the assurance that the reservoir is
   drained at least at the configured rate.

   Note that in this reservoir analogy packets of EF aggregate may be
   arbitrarily reordered.  However, the definition of EF PHB given in
   [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>] explicitly requires that no packet reordering occur within a
   microflow.  This requirement restricts the scheduling
   implementations, or, in the reservoir analogy, the order of pulling
   packets out of the reservoir to make sure that packets within a
   microflow are not reordered, but it still allows reordering at the
   aggregate level.

   Note that reordering within the aggregate, as long as there is no
   flow-level reordering, does not necessarily reflect a "bad" service.
   Consider for example a scheduler that arbitrates among 10 different
   EF "flows" with diverse rates.  A scheduler that is aware of the rate
   requirements may choose to send a packet of the faster flow before a
   packet of the slower flow to maintain lower jitter at the flow level.
   In particular, an ideal "flow"-aware WFQ scheduler will cause
   reordering within the aggregate, while maintaining packet ordering
   and small jitter at the flow level.

   It is intuitively clear that for such a scheduler, as well as for a
   simpler FIFO scheduler, the "accuracy" of the service rate is crucial
   for minimizing "flow"-level jitter.  The packet-identity-aware
   definition quantifies this accuracy of the service rate.

   However, the small value of E_a does not give any assurances about
   the absolute value of per-packet delay.  In fact, if the input rate
   exceeds the configured rate, the aggregate behavior definition may
   result in arbitrarily large delay of a subset of packets.  This is
   the primary motivation for the packet-identity-aware definition.

   The primary goal of the packet-aware characterization of the EF
   implementation is that, unlike the aggregate behavior
   characterization, it provides a way to find a per-packet delay bound
   as a function of input traffic parameters.

   While the aggregate behavior definition characterizes the accuracy of
   the service rate of the entire EF aggregate, the packet-identity-
   aware part of the definition characterizes the deviation of the
   device from an ideal server that serves the EF aggregate in FIFO
   order at least at the configured rate.

   The value of E_p in the packet-identity-aware definition is therefore
   affected by two factors: the accuracy of the aggregate rate service



<span class="grey">Charny, et. al.              Informational                      [Page 8]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   and the degree of packet reordering within the EF aggregate (under
   the constraint that packets within the same microflow are not
   reordered).  Therefore, a sub-aggregate aware device that provides an
   ideal service rate to the aggregate, and also provides an ideal rate
   service for each of the sub-aggregates, may nevertheless have a very
   large value of E_p (in this case E_p must be at least equal to the
   ratio of the maximum packet size divided by the smallest rate of any
   sub aggregate).  As a result, a large value of E_p does not
   necessarily mean that the service provided to EF aggregate is bad -
   rather it may be an indication that the service is good, but non-
   FIFO.  On the other hand, a large value of E_p may also mean that the
   aggregate service is very inaccurate (bursty), and hence in this case
   the large value of E_p reflects a poor quality of implementation.

   As a result, a large number of E_p does not necessarily provide any
   guidance on the quality of the EF implementation.  However, a small
   value of E_p does indicate a high quality FIFO implementation.

   Since E_p and E_a relate to different aspects of the EF
   implementation, they should be considered together to determine the
   quality of the implementation.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>. Per Packet delay</span>

   The primary motivation for the packet-identity-aware definition is
   that it allows quantification of the per-packet delay bound.  This
   section discusses the issues with computing per-packet delay.

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>. Single hop delay bound</span>

   If the total traffic arriving to an output port I from all inputs is
   constrained by a leaky bucket with parameters (R, B), where R is the
   configured rate at I, and B is the bucket depth (burst), then the
   delay of any packet departing from I is bounded by D_p, given by

      D_p = B/R + E_p                                             (eq_7)

   (see <a href="#appendix-B">appendix B</a>).

   Because the delay bound depends on the configured rate R and the
   input burstiness B, it is desirable for both of these parameters to
   be visible to a user of the device.  A PDB desiring a particular
   delay bound may need to limit the range of configured rates and
   allowed burstiness that it can support in order to deliver such
   bound.  Equation (eq_7) provides a means for determining an
   acceptable operating region for the device with a given E_p.  It may
   also be useful to limit the total offered load to a given output to
   some rate R_1 &lt; R (e.g. to obtain end-to-end delay bounds [<a href="#ref-5" title="&quot;Delay Bounds in a Network with Aggregate Scheduling&quot;">5</a>]).  It



<span class="grey">Charny, et. al.              Informational                      [Page 9]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   is important to realize that, while R_1 may also be a configurable
   parameter of the device, the delay bound in (eq_7) does not depend on
   it.  It may be possible to get better bounds explicitly using the
   bound on the input rate, but the bound (eq_7) does not take advantage
   of this information.

<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>. Multi-hop worst case delay</span>

   Although the PHB defines inherently local behavior, in this section
   we briefly discuss the issue of per-packet delay as the packet
   traverses several hops implementing EF PHB.  Given a delay bound
   (eq_7) at a single hop, it is tempting to conclude that per-packet
   bound across h hops is simply h times the bound (eq_7).  However,
   this is not necessarily the case, unless B represents the worst case
   input burstiness across all nodes in the network.

   Unfortunately, obtaining such a worst case value of B is not trivial.
   If EF PHB is implemented using aggregate class-based scheduling where
   all EF packets share a single FIFO, the effect of jitter accumulation
   may result in an increase in burstiness from hop to hop.  In
   particular, it can be shown that unless severe restrictions on EF
   utilization are imposed, even if all EF flows are ideally shaped at
   the ingress, then for any value of delay D it is possible to
   construct a network where EF utilization on any link is bounded not
   to exceed a given factor, no flow traverses more than a specified
   number of hops, but there exists a packet that experiences a delay
   more than D [<a href="#ref-5" title="&quot;Delay Bounds in a Network with Aggregate Scheduling&quot;">5</a>].  This result implies that the ability to limit the
   worst case burstiness and the resulting end-to-end delay across
   several hops may require not only limiting EF utilization on all
   links, but also constraining the global network topology.  Such
   topology constraints would need to be specified in the definition of
   any PDB built on top of EF PHB, if such PDB requires a strict worst
   case delay bound.

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>. Packet loss</span>

   Any device with finite buffering may need to drop packets if the
   input burstiness becomes sufficiently high.  To meet the low loss
   objective of EF, a node may be characterized by the operating region
   in which loss of EF due to  congestion will not occur.  This may be
   specified as a token bucket of  rate r &lt;= R and burst size B that can
   be offered from all inputs to a  given output interface without loss.

   However, as discussed in the previous section, the phenomenon of
   jitter accumulation makes it generally difficult to guarantee that
   the input burstiness never exceeds the specified operating region for
   nodes internal to the DiffServ domain.  A no-loss guarantee across
   multiple hops may require specification of constraints on network



<span class="grey">Charny, et. al.              Informational                     [Page 10]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   topology which are outside the scope of inherently local definition
   of a PHB.  Thus, it must be possible to establish whether a device
   conforms to the EF definition even when some packets are lost.

   This can be done by performing an "off-line" test of conformance to
   equations (eq_1)- (eq_4).  After observing a sequence of packets
   entering and leaving the node, the packets which did not leave are
   assumed lost and are notionally removed from the input stream.  The
   remaining packets now constitute the arrival stream and the packets
   which left the node constitute the departure stream.  Conformance to
   the equations can thus be verified by considering only those packets
   that successfully passed through the node.

   Note that specification of which packets are lost in the case when
   loss does occur is beyond the scope of the definition of EF PHB.
   However, those packets that were not lost must conform to the
   equations definition of EF PHB in <a href="#section-2.1">section 2.1</a>.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>. Implementation considerations</span>

   A packet passing through a router will experience delay for a number
   of reasons.  Two familiar components of this delay are the time the
   packet spends in a buffer at an outgoing link waiting for the
   scheduler to select it and the time it takes to actually transmit the
   packet on the outgoing line.

   There may be other components of a packet's delay through a router,
   however.  A router might have to do some amount of header processing
   before the packet can be given to the correct output scheduler, for
   example.  In another case a router may have a FIFO buffer (called a
   transmission queue in [<a href="#ref-7" title="&quot;A Measurement-Based Analysis of Expedited Forwarding PHB Mechanisms,&quot;">7</a>]) where the packet sits after being selected
   by the output scheduler but before it is transmitted.  In cases such
   as these, the extra delay a packet may experience can be accounted
   for by absorbing it into the latency terms E_a and E_p.

   Implementing EF on a router with a multi-stage switch fabric requires
   special attention.  A packet may experience additional delays due to
   the fact that it must compete with other traffic for forwarding
   resources at multiple contention points in the switch core.  The
   delay an EF packet may experience before it even reaches the output-
   link scheduler should be included in the latency term.  Input-
   buffered and input/output-buffered routers based on crossbar design
   may also require modification of their latency terms.  The factors
   such as the speedup factor and the choice of crossbar arbitration
   algorithms may affect the latency terms substantially.






<span class="grey">Charny, et. al.              Informational                     [Page 11]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   Delay in the switch core comes from two sources, both of which must
   be considered.  The first part of this delay is the fixed delay a
   packet experiences regardless of the other traffic.  This component
   of the delay includes the time it takes for things such as packet
   segmentation and reassembly in cell based cores, enqueueing and
   dequeuing at each stage, and transmission between stages.  The second
   part of the switch core delay is variable and depends on the type and
   amount of other traffic traversing the core.  This delay comes about
   if the stages in the core mix traffic flowing between different
   input/output port pairs.  Thus, EF packets must compete against other
   traffic for forwarding resources in the core.  Some of this
   competing traffic may even be traffic from other, non-EF aggregates.
   This introduces extra delay, that can also be absorbed by the latency
   term in the definition.

   To capture these considerations, in this section we will consider two
   simplified implementation examples.  The first is an ideal output
   buffered node where packets entering the device from an input
   interface are immediately delivered to the output scheduler.  In this
   model the properties of the output scheduler fully define the values
   of the parameters E_a and E_p.  We will consider the case where the
   output scheduler implements aggregate class-based queuing, so that
   all EF packets share a single queue.  We will discuss the values of
   E_a and E_p for a variety of class-based schedulers widely
   considered.

   The second example will consider a router modeled as a black box with
   a known bound on the variable delay a packet can experience from the
   time it arrives to an input to the time it is delivered to its
   destination output.  The output scheduler in isolation is assumed to
   be an aggregate scheduler where all EF packets share a single FIFO
   queue, with a known value of E_a(S)=E_p(S)=E(S).  This model provides
   a reasonable abstraction to a large class of router implementations.

<span class="h3"><a class="selflink" name="section-5.1" href="#section-5.1">5.1</a>. The output buffered model with EF FIFO at the output.</span>

   As has been mentioned earlier, in this model E_a = E_p, so we shall
   omit the subscript and refer to both terms as latency E.  The
   remainder of this subsection discusses E for a number of scheduling
   implementations.

<span class="h4"><a class="selflink" name="section-5.1.1" href="#section-5.1.1">5.1.1</a>. Strict Non-preemptive Priority Queue</span>

   A Strict Priority scheduler in which all EF packets share a single
   FIFO queue which is served at strict non-preemptive priority over
   other queues satisfies the EF definition with the latency term E =
   MTU/C where MTU is the maximum packet size and C is the speed of the
   output link.



<span class="grey">Charny, et. al.              Informational                     [Page 12]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


<span class="h4"><a class="selflink" name="section-5.1.2" href="#section-5.1.2">5.1.2</a>. WF2Q</span>

   Another scheduler that satisfies the EF definition with a small
   latency term is WF2Q described in [<a href="#ref-1" title="&quot;WF2Q: Worst-case Fair Weighted Fair Queuing&quot;">1</a>].  A class-based WF2Q scheduler,
   in which all EF traffic shares a single queue with the weight
   corresponding to the configured rate of the EF aggregate satisfies
   the EF definition with the latency term E = MTU/C+MTU/R.

<span class="h4"><a class="selflink" name="section-5.1.3" href="#section-5.1.3">5.1.3</a>. Deficit Round Robin (DRR)</span>

   For DRR [<a href="#ref-12" title="&quot;Efficient Fair Queuing Using Deficit Round Robin&quot;">12</a>], E can be shown to grow linearly with
   N*(r_max/r_min)*MTU, where r_min and r_max denote the smallest and
   the largest rate among the rate assignments of all queues in the
   scheduler, and N is the number of queues in the scheduler.

<span class="h4"><a class="selflink" name="section-5.1.4" href="#section-5.1.4">5.1.4</a>. Start-Time Fair Queuing and Self-Clocked Fair Queuing</span>

   For Start-Time Fair Queuing (SFQ) [<a href="#ref-9" title="&quot;Start-time Fair Queuing: A Scheduling Algorithm for Integrated Services&quot;">9</a>] and Self-Clocked Fair Queuing
   (SCFQ) [<a href="#ref-8" title="&quot;A Self-clocked Fair Queuing Scheme for Broad- band Applications&quot;">8</a>] E can be shown to grow linearly with the number of queues
   in the scheduler.

<span class="h3"><a class="selflink" name="section-5.2" href="#section-5.2">5.2</a>. Router with Internal Delay and EF FIFO at the output</span>

   In this section we consider a router which is modeled as follows.  A
   packet entering the router may experience a variable delay D_v with a
   known upper bound D. That is, 0&lt;=D_v&lt;=D.  At the output all EF
   packets share a single class queue.  Class queues are scheduled by a
   scheduler with a known value E_p(S)=E(S) (where E(S) corresponds to
   the model where this scheduler is implemented in an ideal output
   buffered device).

   The computation of E_p is more complicated in this case.  For such
   device, it can be shown that E_p = E(S)+2D+2B/R (see [<a href="#ref-13" title="&quot;Packet Scale Rate Guarantee for non-FIFO Nodes&quot;">13</a>]).

   Recall from the discussion of <a href="#section-3">section 3</a> that bounding input
   burstiness B may not be easy in a general topology.  In the absence
   of the knowledge of a bound on B one can bound E_p as E_p = E(S) +
   D*C_inp/R (see [<a href="#ref-13" title="&quot;Packet Scale Rate Guarantee for non-FIFO Nodes&quot;">13</a>]).

   Note also that the bounds in this section are derived using only the
   bound on the variable portion of the interval delay and the error
   bound of the output scheduler.  If more details about the
   architecture of a device are available, it may be possible to compute
   better bounds.







<span class="grey">Charny, et. al.              Informational                     [Page 13]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>. Security Considerations</span>

   This informational document provides additional information to aid in
   understanding of the EF PHB described in [<a href="#ref-6" title="&quot;An Expedited Forwarding PHB (Per-Hop Behavior)&quot;">6</a>].  It adds no new
   functions to it.  As a result, it adds no security issues to those
   described in that specification.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>. References</span>

   [<a name="ref-1" id="ref-1">1</a>]   J.C.R. Bennett and H. Zhang, "WF2Q: Worst-case Fair Weighted
         Fair Queuing", INFOCOM'96, March 1996.

   [<a name="ref-2" id="ref-2">2</a>]   J.-Y. Le Boudec, P. Thiran, "Network Calculus", Springer Verlag
         Lecture Notes in Computer Science volume 2050, June 2001
         (available online at <a href="http://lcawww.epfl.ch/">http://lcawww.epfl.ch</a>).

   [<a name="ref-3" id="ref-3">3</a>]   Bradner, S., "Key Words for Use in RFCs to Indicate Requirement
         Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-4" id="ref-4">4</a>]   J.C.R. Bennett, K. Benson, A. Charny, W. Courtney, J.Y. Le
         Boudec, "Delay Jitter Bounds and Packet Scale Rate Guarantee
         for Expedited Forwarding", Proc. Infocom 2001, April 2001.

   [<a name="ref-5" id="ref-5">5</a>]   A. Charny, J.-Y. Le Boudec "Delay Bounds in a Network with
         Aggregate Scheduling".  Proc. of QoFIS'2000, September 25-26,
         2000, Berlin, Germany.

   [<a name="ref-6" id="ref-6">6</a>]   Davie, B., Charny, A., Baker, F., Bennett, J.C.R., Benson, K.,
         Boudec, J., Chiu, A., Courtney, W., Davari, S., Firoiu, V.,
         Kalmanek, C., Ramakrishnan, K.K. and D. Stiliadis, "An
         Expedited Forwarding PHB (Per-Hop Behavior)", <a href="rfc3246.html">RFC 3246</a>, March
         2002.

   [<a name="ref-7" id="ref-7">7</a>]   T. Ferrari and P. F. Chimento, "A Measurement-Based Analysis of
         Expedited Forwarding PHB Mechanisms," Eighth International
         Workshop on Quality of Service, Pittsburgh, PA, June 2000.

   [<a name="ref-8" id="ref-8">8</a>]   S.J. Golestani. "A Self-clocked Fair Queuing Scheme for Broad-
         band Applications".  In Proceedings of IEEE INFOCOM'94, pages
         636-646, Toronto, CA, April 1994.

   [<a name="ref-9" id="ref-9">9</a>]   P. Goyal, H.M. Vin, and H. Chen. "Start-time Fair Queuing: A
         Scheduling Algorithm for Integrated Services".  In Proceedings
         of the ACM-SIGCOMM 96, pages 157-168, Palo Alto, CA, August
         1996.

   [<a name="ref-10" id="ref-10">10</a>]  Jacobson, V., Nichols, K. and K. Poduri, "An Expedited
         Forwarding PHB", <a href="rfc2598.html">RFC 2598</a>, June 1999.



<span class="grey">Charny, et. al.              Informational                     [Page 14]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   [<a name="ref-11" id="ref-11">11</a>]  Jacobson, V., Nichols, K. and K. Poduri, "The 'Virtual Wire'
         Behavior Aggregate", Work in Progress.

   [<a name="ref-12" id="ref-12">12</a>]  M. Shreedhar and G. Varghese. "Efficient Fair Queuing Using
         Deficit Round Robin".  In Proceedings of SIGCOMM'95, pages
         231-243, Boston, MA, September 1995.

   [<a name="ref-13" id="ref-13">13</a>]  Le Boudec, J.-Y., Charny, A. "Packet Scale Rate Guarantee for
         non-FIFO Nodes", Infocom 2002, New York, June 2002.










































<span class="grey">Charny, et. al.              Informational                     [Page 15]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


<span class="h2"><a class="selflink" name="appendix-A" href="#appendix-A">Appendix A</a>. Difficulties with the <a href="rfc2598.html">RFC 2598</a> EF PHB Definition</span>

   The definition of the EF PHB as given in [<a href="#ref-10" title="&quot;An Expedited Forwarding PHB&quot;">10</a>] states:

   "The EF PHB is defined as a forwarding treatment for a particular
   diffserv aggregate where the departure rate of the aggregate's
   packets from any diffserv node must equal or exceed a configurable
   rate.  The EF traffic SHOULD receive this rate independent of the
   intensity of any other traffic attempting to transit the node.  It
   [the EF PHB departure rate] SHOULD average at least the configured
   rate when measured over any time interval equal to or longer than the
   time it takes to send an output link MTU sized packet at the
   configured rate."

   A literal interpretation of the definition would consider the
   behaviors given in the next two subsections as non-compliant.  The
   definition also unnecessarily constrains the maximum configurable
   rate of an EF aggregate.

<span class="h1"><a class="selflink" name="appendix-A.1" href="#appendix-A.1">A.1</a> Perfectly-Clocked Forwarding</span>

   Consider the following stream forwarded from a router with EF-
   configured rate R=C/2, where C is the output line rate.  In the
   illustration, E is an MTU-sized EF packet while x is a non-EF packet
   or unused capacity, also of size MTU.

      E x E x E x E x E x E x...
       |-----|

   The interval between the vertical bars is 3*MTU/C, which is greater
   than MTU/(C/2), and so is subject to the EF PHB definition.  During
   this interval, 3*MTU/2 bits of the EF aggregate should be forwarded,
   but only MTU bits are forwarded.  Therefore, while this forwarding
   pattern should be considered compliant under any reasonable
   interpretation of the EF PHB, it actually does not formally comply
   with the definition of <a href="rfc2598.html">RFC 2598</a>.

   Note that this forwarding pattern can occur in any work-conserving
   scheduler in an ideal output-buffered architecture where EF packets
   arrive in a perfectly clocked manner according to the above pattern
   and are forwarded according to exactly the same pattern in the
   absence of any non-EF traffic.

   Trivial as this example may be, it reveals the lack of mathematical
   precision in the formal definition.  The fact that no work-conserving
   scheduler can formally comply with the definition is unfortunate, and
   appears to warrant some changes to the definition that would correct
   this problem.



<span class="grey">Charny, et. al.              Informational                     [Page 16]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   The underlying reason for the problem described here is quite simple
   - one can only expect that the EF aggregate is served at configured
   rate in some interval where there is enough backlog of EF packets to
   sustain that rate.  In the example above the packets come in exactly
   at the rate at which they are served, and so there is no persistent
   backlog.  Certainly, if the input rate is even smaller than the
   configured rate of the EF aggregate, there will be no backlog as
   well, and a similar formal difficulty will occur.

   A seemingly simple solution to this difficulty might be to require
   that the EF aggregate is served at its configured rate only when the
   queue is backlogged.  However, as we show in the remainder of this
   section, this solution does not suffice.

<span class="h1"><a class="selflink" name="appendix-A.2" href="#appendix-A.2">A.2</a> Router Internal Delay</span>

   We now argue that the example considered in the previous section is
   not as trivial as it may seem at first glance.

   Consider a router with EF configured rate R = C/2 as in the previous
   example, but with an internal delay of 3T (where T = MTU/C) between
   the time that a packet arrives at the router and the time that it is
   first eligible for forwarding at the output link.  Such things as
   header processing, route look-up, and delay in switching through a
   multi-layer fabric could cause this delay.  Now suppose that EF
   traffic arrives regularly at a rate of (2/3)R = C/3.  The router will
   perform as shown below.

      EF Packet Number 1 2 3 4 5 6 ...

      Arrival (at router) 0 3T 6T 9T 12T 15T ...

      Arrival (at scheduler) 3T 6T 9T 12T 15T 18T ...

      Departure 4T 7T 10T 13T 16T 19T ...

   Again, the output does not satisfy the <a href="rfc2598.html">RFC 2598</a> definition of EF PHB.
   As in the previous example, the underlying reason for this problem is
   that the scheduler cannot forward EF traffic faster than it arrives.
   However, it can be easily seen that the existence of internal delay
   causes one packet to be inside the router at all times.  An external
   observer will rightfully conclude that the number of EF packets that
   arrived to the router is always at least one greater than the number
   of EF packets that left the router, and therefore the EF aggregate is
   constantly backlogged.  However, while the EF aggregate is
   continuously backlogged, the observed output rate is nevertheless
   strictly less that the configured rate.




<span class="grey">Charny, et. al.              Informational                     [Page 17]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-18" id="page-18" href="#page-18" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   This example indicates that the simple addition of the condition that
   EF aggregate must receive its configured rate only when the EF
   aggregate is backlogged does not suffice in this case.

   Yet, the problem described here is of fundamental importance in
   practice.  Most routers have a certain amount of internal delay.  A
   vendor declaring EF compliance is not expected to simultaneously
   declare the details of the internals of the router.  Therefore, the
   existence of internal delay may cause a perfectly reasonable EF
   implementation to display seemingly non-conformant behavior, which is
   clearly undesirable.

<span class="h1"><a class="selflink" name="appendix-A.3" href="#appendix-A.3">A.3</a> Maximum Configurable Rate and Provisioning Efficiency</span>

   It is well understood that with any non-preemptive scheduler, the
   <a href="rfc2598.html">RFC-2598</a>-compliant configurable rate for an EF aggregate cannot
   exceed C/2 [<a href="#ref-11" title="&quot;The 'Virtual Wire' Behavior Aggregate&quot;">11</a>].  This is because an MTU-sized EF packet may arrive
   to an empty queue at time t just as an MTU-sized non-EF packet begins
   service.  The maximum number of EF bits that could be forwarded
   during the interval [t, t + 2*MTU/C] is MTU.  But if configured rate
   R &gt; C/2, then this interval would be of length greater than MTU/R,
   and more than MTU EF bits would have to be served during this
   interval for the router to be compliant.  Thus, R must be no greater
   than C/2.

   It can be shown that for schedulers other than PQ, such as various
   implementations of WFQ, the maximum compliant configured rate may be
   much smaller than 50%.  For example, for SCFQ [<a href="#ref-8" title="&quot;A Self-clocked Fair Queuing Scheme for Broad- band Applications&quot;">8</a>] the maximum
   configured rate cannot exceed C/N, where N is the number of queues in
   the scheduler.  For WRR, mentioned as compliant in section 2.2 of <a href="rfc2598.html">RFC</a>
   <a href="rfc2598.html">2598</a>, this limitation is even more severe.  This is because in these
   schedulers a packet arriving to an empty EF queue may be forced to
   wait until one packet from each other queue (in the case of SCFQ) or
   until several packets from each other queue (in the case of WRR) are
   served before it will finally be forwarded.

   While it is frequently assumed that the configured rate of EF traffic
   will be substantially smaller than the link bandwidth, the
   requirement that this rate should never exceed 50% of the link
   bandwidth appears unnecessarily limiting.  For example, in a fully
   connected mesh network, where any flow traverses a single link on its
   way from source to its destination there seems no compelling reason
   to limit the amount of EF traffic to 50% (or an even smaller
   percentage for some schedulers) of the link bandwidth.

   Another, perhaps even more striking example is the fact that even a
   TDM circuit with dedicated slots cannot be configured to forward EF
   packets at more than 50% of the link speed without violating <a href="rfc2598.html">RFC 2598</a>



<span class="grey">Charny, et. al.              Informational                     [Page 18]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-19" id="page-19" href="#page-19" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   (unless the entire link is configured for EF).  If the configured
   rate of EF traffic is greater than 50% (but less than the link
   speed), there will always exist an interval longer than MTU/R in
   which less than the configured rate is achieved.  For example,
   suppose the configured rate of the EF aggregate is 2C/3.  Then the
   forwarding pattern of the TDM circuit might be

   E E x E E x E E x ...
      |---|

   where only one packet is served in the marked interval of length 2T =
   2MTU/C.  But at least 4/3 MTU would have to be served during this
   interval by a router in compliance with the definition in <a href="rfc2598.html">RFC 2598</a>.
   The fact that even a TDM line cannot be booked over 50% by EF traffic
   indicates that the restriction is artificial and unnecessary.

<span class="h1"><a class="selflink" name="appendix-A.4" href="#appendix-A.4">A.4</a> The Non-trivial Nature of the Difficulties</span>

   One possibility to correct the problems discussed in the previous
   sections might be to attempt to clarify the definition of the
   intervals to which the definition applied or by averaging over
   multiple intervals.  However, an attempt to do so meets with
   considerable analytical and implementation difficulties.  For
   example, attempting to align interval start times with some epochs of
   the forwarded stream appears to require a certain degree of global
   clock synchronization and is fraught with the risk of
   misinterpretation and mistake in practice.

   Another approach might be to allow averaging of the rates over some
   larger time scale.  However, it is unclear exactly what finite time
   scale would suffice in all reasonable cases.  Furthermore, this
   approach would compromise the notion of very short-term time scale
   guarantees that are the essence of EF PHB.

   We also explored a combination of two simple fixes.  The first is the
   addition of the condition that the only intervals subject to the
   definition are those that fall inside a period during which the EF
   aggregate is continuously backlogged in the router (i.e., when an EF
   packet is in the router).  The second is the addition of an error
   (latency) term that could serve as a figure-of-merit in the
   advertising of EF services.

   With the addition of these two changes the candidate definition
   becomes as follows:







<span class="grey">Charny, et. al.              Informational                     [Page 19]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-20" id="page-20" href="#page-20" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   In any interval of time (t1, t2) in which EF traffic is continuously
   backlogged, at least R(t2 - t1 - E) bits of EF traffic must be
   served, where R is the configured rate for the EF aggregate and E is
   an implementation-specific latency term.

   The "continuously backlogged" condition eliminates the insufficient-
   packets-to-forward difficulty while the addition of the latency term
   of size MTU/C resolves the perfectly-clocked forwarding example
   (section A.1), and also removes the limitation on EF configured rate.

   However, neither fix (nor the two of them together) resolves the
   example of section A.2. To see this, recall that in the example of
   section A.2 the EF aggregate is continuously backlogged, but the
   service rate of the EF aggregate is consistently smaller than the
   configured rate, and therefore no finite latency term will suffice to
   bring the example into conformance.

<span class="h2"><a class="selflink" name="appendix-B" href="#appendix-B">Appendix B</a>. Alternative Characterization of Packet Scale Rate Guarantee</span>

   The proofs of several bounds in this document can be found in [<a href="#ref-13" title="&quot;Packet Scale Rate Guarantee for non-FIFO Nodes&quot;">13</a>].
   These proofs use an algebraic characterization of the aggregate
   definition given by (eq_1), (eq_2), and packet identity aware
   definition given by (eq_3), (eq_4).  Since this characterization is
   of interest on its own, we present it in this section.

Theorem B1.  Characterization of the aggregate definition without
             f_n.

   Consider a system where packets are numbered 1, 2, ... in order of
   arrival.  As in the aggregate definition, call a_n the n-th arrival
   time, d_n - the n-th departure time, and l_n the size of the n-th
   packet to depart.  Define by convention d_0=0.  The aggregate
   definition with rate R and latency E_a is equivalent to saying that
   for all n and all 0&lt;=j&lt;= n-1:

      d_n &lt;= E_a + d_j + (l_(j+1) + ... + l_n)/R                 (eq_b1)

   or

   there exists some j+1 &lt;= k &lt;= n  such that

      d_n  &lt;= E_a + a_k + (l_k + ... + l_n)/R                    (eq_b2)









<span class="grey">Charny, et. al.              Informational                     [Page 20]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-21" id="page-21" href="#page-21" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


Theorem B2.  Characterization of packet-identity-aware definition
             without F_n.

   Consider a system where packets are numbered 1, 2, ... in order of
   arrival.  As in the packet-identity-aware definition, call A_n, D_n
   the arrival and departure times for the n-th packet, and L_n the size
   of this packet.  Define by convention D_0=0.  The packet identity
   aware definition with rate R and latency E_p is equivalent to saying
   that for all n and all 0&lt;=j&lt;= n-1:

      D_n &lt;= E_p + D_j + (L_{j+1} + ... + L_n)/R                 (eq_b3)

   or

   there exists some j+1 &lt;= k &lt;= n  such that

      D_n  &lt;= E_p + A_k + (L_k + ... + L_n)/R                    (eq_b4)

   For the proofs of both Theorems, see [<a href="#ref-13" title="&quot;Packet Scale Rate Guarantee for non-FIFO Nodes&quot;">13</a>].
































<span class="grey">Charny, et. al.              Informational                     [Page 21]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-22" id="page-22" href="#page-22" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


Acknowledgements

   This document could not have been written without Fred Baker, Bruce
   Davie and Dimitrios Stiliadis.  Their time, support and insightful
   comments were invaluable.

Authors' Addresses

   Anna Charny
   Cisco Systems
   300 Apollo Drive
   Chelmsford, MA 01824

   EMail: acharny@cisco.com

   Jon Bennett
   Motorola
   3 Highwood Drive East
   Tewksbury, MA 01876

   EMail: jcrb@motorola.com

   Kent Benson
   Tellabs Research Center
   3740 Edison Lake Parkway #101
   Mishawaka, IN  46545

   EMail: Kent.Benson@tellabs.com

   Jean-Yves Le Boudec
   ICA-EPFL, INN
   Ecublens, CH-1015
   Lausanne-EPFL, Switzerland

   EMail: jean-yves.leboudec@epfl.ch

   Angela Chiu
   Celion Networks
   1 Sheila Drive, Suite 2
   Tinton Falls, NJ 07724

   EMail: angela.chiu@celion.com









<span class="grey">Charny, et. al.              Informational                     [Page 22]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-23" id="page-23" href="#page-23" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


   Bill Courtney
   TRW
   Bldg. 201/3702
   One Space Park
   Redondo Beach, CA 90278

   EMail: bill.courtney@trw.com

   Shahram Davari
   PMC-Sierra Inc
   411 Legget Drive
   Ottawa, ON K2K 3C9, Canada

   EMail: shahram_davari@pmc-sierra.com

   Victor Firoiu
   Nortel Networks
   600 Tech Park
   Billerica, MA 01821

   EMail: vfiroiu@nortelnetworks.com

   Charles Kalmanek
   AT&amp;T Labs-Research
   180 Park Avenue, Room A113,
   Florham Park NJ

   EMail: crk@research.att.com

   K.K. Ramakrishnan
   TeraOptic Networks, Inc.
   686 W. Maude Ave
   Sunnyvale, CA 94086

   EMail: kk@teraoptic.com
















<span class="grey">Charny, et. al.              Informational                     [Page 23]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-24" id="page-24" href="#page-24" class="invisible"> </a>
<span class="grey"><a href="rfc3247.html">RFC 3247</a>                Supplemental Information              March 2002</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2001).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Charny, et. al.              Informational                     [Page 24]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.106, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body>
<!-- Mirrored from tools.ietf.org/html/rfc3247 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:44:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
