<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6011 by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 07 Jun 2014 20:18:41 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.107" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6011" name="DC.Identifier"/>
<meta content="This document defines procedures for how a SIP User Agent should\nlocate, retrieve, and maintain current configuration information from\na Configuration Service. This document is not an Internet Standards\nTrack specification; it is published for informational purposes." name="DC.Description.Abstract"/>
<meta content="Lawrence, Scott" name="DC.Creator"/>
<meta content="Elwell, John" name="DC.Creator"/>
<meta content="October, 2010" name="DC.Date.Issued"/>
<meta content="Session Initiation Protocol (SIP) User Agent Configuration" name="DC.Title"/>

    <link href="http://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="http://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6011 - Session Initiation Protocol (SIP) User Agent Configuration</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc6011.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc6011" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-lawrence-sipforum-user-agent-config" title="draft-lawrence-sipforum-user-agent-config">draft-lawrence-si...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6011" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc6011" title="Side-by-side diff">Diff2</a>] [<a href="http://www.rfc-editor.org/errata_search.php?rfc=6011">Errata</a>]        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Internet Engineering Task Force (IETF)                  S. Lawrence, Ed.
Request for Comments: 6011                         Linden Research, Inc.
Category: Informational                                        J. Elwell
ISSN: 2070-1721                        Siemens Enterprise Communications
                                                            October 2010


       <span class="h1">Session Initiation Protocol (SIP) User Agent Configuration</span>

Abstract

   This document defines procedures for how a SIP User Agent should
   locate, retrieve, and maintain current configuration information from
   a Configuration Service.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6011">http://www.rfc-editor.org/info/rfc6011</a>.

Copyright Notice

   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.






<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 1]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Scope ......................................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Terminology ................................................<a href="#page-3">3</a>
      <a href="#section-1.3">1.3</a>. User Agent Installation Examples ...........................<a href="#page-4">4</a>
           <a href="#section-1.3.1">1.3.1</a>. Hosted IP Service Provider Example ..................<a href="#page-5">5</a>
           <a href="#section-1.3.2">1.3.2</a>. IP-PBX Example ......................................<a href="#page-5">5</a>
           1.3.3. Special Considerations for High Security
                  Deployments .........................................<a href="#page-6">6</a>
   <a href="#section-2">2</a>. Obtaining User Agent Configuration ..............................<a href="#page-6">6</a>
      <a href="#section-2.1">2.1</a>. Network Discovery ..........................................<a href="#page-6">6</a>
           <a href="#section-2.1.1">2.1.1</a>. Link Layer Provisioning .............................<a href="#page-7">7</a>
           <a href="#section-2.1.2">2.1.2</a>. Network Layer Provisioning ..........................<a href="#page-7">7</a>
      <a href="#section-2.2">2.2</a>. Obtaining the Configuration Service Domain .................<a href="#page-8">8</a>
           <a href="#section-2.2.1">2.2.1</a>. The Local Network Domain ............................<a href="#page-8">8</a>
           <a href="#section-2.2.2">2.2.2</a>. Manual Domain Name Entry ............................<a href="#page-8">8</a>
      <a href="#section-2.3">2.3</a>. Constructing the Configuration Request URL .................<a href="#page-8">8</a>
           <a href="#section-2.3.1">2.3.1</a>. Obtaining a Configuration Service Base URL ..........<a href="#page-9">9</a>
           <a href="#section-2.3.2">2.3.2</a>. Adding Configuration Request Parameters ............<a href="#page-10">10</a>
           <a href="#section-2.3.3">2.3.3</a>. Configuration Request URI Example ..................<a href="#page-12">12</a>
      <a href="#section-2.4">2.4</a>. Obtaining Configuration from the Configuration Service ....<a href="#page-13">13</a>
           <a href="#section-2.4.1">2.4.1</a>. Configuration Data Request Authentication ..........<a href="#page-13">13</a>
           <a href="#section-2.4.2">2.4.2</a>. Configuration Data Request Failure .................<a href="#page-14">14</a>
      <a href="#section-2.5">2.5</a>. Configuration Changes .....................................<a href="#page-15">15</a>
           <a href="#section-2.5.1">2.5.1</a>. Configuration Change Subscriptions .................<a href="#page-16">16</a>
           <a href="#section-2.5.2">2.5.2</a>. Configuration Change Polling .......................<a href="#page-18">18</a>
      <a href="#section-2.6">2.6</a>. Validity of Stored Configuration Data .....................<a href="#page-19">19</a>
           <a href="#section-2.6.1">2.6.1</a>. Re-Validating Configuration Data ...................<a href="#page-19">19</a>
      <a href="#section-2.7">2.7</a>. Retry Backoff Procedure ...................................<a href="#page-20">20</a>
   <a href="#section-3">3</a>. Configuration Data .............................................<a href="#page-20">20</a>
      <a href="#section-3.1">3.1</a>. Configuration Data Items ..................................<a href="#page-20">20</a>
           <a href="#section-3.1.1">3.1.1</a>. Address-of-Record ..................................<a href="#page-21">21</a>
           <a href="#section-3.1.2">3.1.2</a>. Realm ..............................................<a href="#page-21">21</a>
           <a href="#section-3.1.3">3.1.3</a>. Username ...........................................<a href="#page-21">21</a>
           <a href="#section-3.1.4">3.1.4</a>. Digest .............................................<a href="#page-21">21</a>
           <a href="#section-3.1.5">3.1.5</a>. OutboundProxy ......................................<a href="#page-21">21</a>
      <a href="#section-3.2">3.2</a>. Reset User Agent to Default Configuration .................<a href="#page-21">21</a>
   <a href="#section-4">4</a>. IANA Considerations ............................................<a href="#page-21">21</a>
      <a href="#section-4.1">4.1</a>. DHCP SIP User Agent Configuration Service Domains Option ..<a href="#page-21">21</a>
      4.2. DHCPv6 SIP User Agent Configuration Service
           Domains Option ............................................<a href="#page-22">22</a>
      <a href="#section-4.3">4.3</a>. U-NAPTR Registration ......................................<a href="#page-23">23</a>
      <a href="#section-4.4">4.4</a>. SIP Forum User Agent Configuration Parameter Registry .....<a href="#page-23">23</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-24">24</a>
   <a href="#section-6">6</a>. Acknowledgements ...............................................<a href="#page-26">26</a>
   <a href="#section-7">7</a>. Normative References ...........................................<a href="#page-27">27</a>




<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 2]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   A user gets a new SIP User Agent (UA); it may be a hardware device or
   software.  Some User Agents have a user interface that can accept a
   username, password, and domain name.  Other devices, like Analog
   Telephony Adapters (ATAs), have no user interface other than that
   provided by an attached analog phone.  How does a non-technical user
   minimally configure it so that when it is started, something useful
   happens?

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Scope"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Scope</span>

   This document specifies a procedure for how a SIP User Agent locates,
   retrieves, and maintains current configuration information for a
   given SIP Service Provider.  As such, it specifies requirements to be
   met by both the User Agent, the Configuration Service at the SIP
   Service Provider, and the network infrastructure services that allow
   them to communicate.

   Nothing in this specification prohibits a User Agent from obtaining
   configuration information by any means in addition to the mechanisms
   specified herein.

   The intent of this specification is to provide mechanisms sufficient
   for User Agents to discover an appropriate source of configuration
   and maintain the currency of that configuration.  A User Agent
   implementation compliant with this specification MAY also implement
   additional mechanisms necessary in particular environments or when
   the services specified here are not available.

   The form and content of configuration data to be downloaded are
   outside the scope of this specification, although <a href="#section-3.1">Section 3.1</a>,
   "Configuration Data Items" suggests a minimum set of data items
   likely to be required by all types of UAs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terminology</span>

   The following terms are used in this document:

   User Agent, UA

      As defined in <a href="rfc3261.html">RFC 3261</a> [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  Note that this includes any
      implementation of a User Agent.  A SIP phone is a User Agent, but
      the term also encompasses any other entity that uses SIP (for
      example, for a text chat, for sharing a whiteboard, or for a fax).






<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 3]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   Soft User Agent, Soft UA

      A User Agent that runs as an application within some larger system
      that has responsibility for some of the steps described in this
      specification.  In those cases, the Soft UA must be able to obtain
      the information from the platform.  In all cases, the term User
      Agent also encompasses a Soft User Agent.

   SIP Service Provider, Service Provider

      An entity that provides services to User Agents using the SIP
      protocol.  This specification requires that a Service Provider
      make configuration data and certain other information available in
      order to configure User Agents.

   Configuration

      The set of information that establishes operational parameters for
      a particular User Agent.

   Configuration Service, CS

      The source of Configuration for User Agents.

   Configuration Service Domain

      The DNS name for the service from which a Configuration is
      requested.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20User%20Agent%20Installation%20Examples"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  User Agent Installation Examples</span>

   This section is non-normative; it is a set of "user stories" --
   narrative descriptions of the user experience in different
   environments.  These are "black box" descriptions meant to include
   the actions to be taken by the human participants (including
   administrators and system operators as well as the "user" of the UA),
   but not how the network elements communicate or operate internally.
   The intent is that these narratives provide context for the
   subsequent technical specifications.








<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 4]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.1.%20%20Hosted%20IP%20Service%20Provider%20Example"></a><a class="selflink" href="#section-1.3.1" name="section-1.3.1">1.3.1</a>.  Hosted IP Service Provider Example</span>

   Configuring a new UA to use a hosted IP telephony service will
   typically proceed as follows: the customer makes a request to their
   Service Provider to add one or more new users to their service.  The
   customer may supply further details such as a preferred username,
   type of endpoint and any requests for specific functionality,
   depending on what information the Service Provider considers useful,
   but no additional information is required from the customer.

   The Service Provider performs any necessary provisioning actions on
   their equipment, and returns to the customer provisioning
   information, which may include a domain name or a numeric domain
   identifier for the provider, a user identifier, and a password.
   Typically, a Service Provider will supply provisioning information
   for each device to be provisioned, but may choose to supply
   information that can be used with multiple devices, or for a limited
   duration or with other benefits and restrictions.

   The customer enters the provisioning information into the UA to be
   configured, whereupon the UA uses this information to locate the
   configuration service, securely fetch the configuration information,
   and configure itself for operation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.2.%20%20IP-PBX%20Example"></a><a class="selflink" href="#section-1.3.2" name="section-1.3.2">1.3.2</a>.  IP-PBX Example</span>

   Configuring a new UA in a typical business begins by provisioning a
   user identity in the Private Branch Exchange (PBX) (add user "John
   Smith"), and assigning a phone number to the user.  That number must
   then be assigned to a line on a specific UA; this is usually done by
   selecting a UA and provisioning it in the PBX by its serial number
   (usually a Media Access Control (MAC) address), and then assigning
   the identity or phone number to a 'line' on that UA in the PBX
   configuration system.

   Once provisioning in the PBX is complete, the new user goes to his or
   her workplace and connects the UA to the network.  When connected and
   powered up, the UA is provided with the user identity, phone number,
   and any other configuration data with no local user interaction --
   just connecting it to the network loads the configuration from the
   PBX and the UA is operational.










<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 5]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.3.3.%20%20Special%20Considerations%20for%20High%20Security%20Deployments"></a><a class="selflink" href="#section-1.3.3" name="section-1.3.3">1.3.3</a>.  Special Considerations for High Security Deployments</span>

   To deploy a new UA in a high security scenario requires some special
   consideration.  A security-conscious deployment will most likely
   require that the SIP and other management interfaces, including the
   interface to the configuration service, be secured before the device
   is put into service.

   In order to achieve any level of security, the device will need to be
   pre-configured with some security-related information in the form of
   certificates.  This may be achieved in a number of ways.  Some
   examples include:

   1.  An administrator who configures the device in a secure
       environment before making the device available to the user.

   2.  Some certificates may be built into the device during the
       manufacturing process enabling the configuration service to
       certify information such as the manufacturer, UA type, and MAC
       address.  The configuration service may then be used to provision
       the device with other certificates as required.

   3.  The device may have a facility for the user to provide the
       security information in the form of a security card or dongle.

   All these mechanism are likely to restrict the user to a limited set
   of devices approved for use in a particular deployment.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Obtaining%20User%20Agent%20Configuration"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Obtaining User Agent Configuration</span>

   This section specifies how a User Agent connects to the network,
   determines for which domain to request configuration, obtains
   configuration from that domain, and is notified by that domain when
   the configuration changes.

   The User Agent MAY obtain configuration information by any means in
   addition to those specified here, and MAY use such information in
   preference to any of the steps specified below, but MUST be capable
   of using these procedures alone in order to be compliant with this
   specification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Network%20Discovery"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Network Discovery</span>

   A UA needs a minimum set of parameters to allow it to communicate on
   the network.  Some networks allow the UA to automatically discover
   these parameters, while other networks require some or all of these
   parameters to be manually provisioned on the UA.




<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 6]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.1.1.%20%20Link%20Layer%20Provisioning"></a><a class="selflink" href="#section-2.1.1" name="section-2.1.1">2.1.1</a>.  Link Layer Provisioning</span>

   The UA SHOULD attempt to use Link Layer Discovery Protocol - Media
   Endpoint Discovery (LLDP-MED; see [<a href="#ref-ANSI.TIA-1057-2006">ANSI.TIA-1057-2006</a>]) for automatic
   provisioning of link layer parameters.

   In some deployments, failure to properly provision the link layer may
   result in the UA having incorrect Layer 2 priority, degrading the
   quality of service, or being on the wrong virtual LAN (VLAN),
   possibly resulting in complete loss of service.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.1.2.%20%20Network%20Layer%20Provisioning"></a><a class="selflink" href="#section-2.1.2" name="section-2.1.2">2.1.2</a>.  Network Layer Provisioning</span>

   In order to communicate using IP, the UA needs the following minimal
   IP configuration parameters:

   IP Network Parameters

   o  UA IP Address

   o  Subnet Mask

   o  Gateway IP address

   o  DNS Server IP address(es)

   With the exception of a Soft UA that relies on its platform to obtain
   the IP Network Parameters:

   o  If the User Agent is using IP version 4 on a network technology
      for which the Dynamic Host Configuration Protocol (DHCP) [<a href="rfc2131.html" title='"Dynamic Host Configuration Protocol"'>RFC2131</a>]
      is defined, the UA MUST attempt to obtain the IP Network
      Parameters using DHCP and MUST request DHCP options 141 (see
      <a href="#section-4.1">Section 4.1</a>) and 15 [<a href="rfc2132.html" title='"DHCP Options and BOOTP Vendor Extensions"'>RFC2132</a>].  If the DHCP service provides a
      value for option 141, the domain name(s) it provides MUST be saved
      as candidates for use as the Local Network Domain (see
      <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration Service Domain").  If
      and only if no values are returned for option 141, the UA MUST
      save any values returned for option 15 for use as the Local
      Network Domain.

   o  If the User Agent is using IP version 6 on a network technology
      for which the Dynamic Host Configuration Protocol version 6
      (DHCPv6) [<a href="rfc3315.html" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] is defined, the UA MAY use any standard IPv6
      mechanism to determine the IP Network Parameters, but MUST request
      DHCPv6 options 58 (see <a href="#section-4.2">Section 4.2</a>) and 21 [<a href="rfc3319.html" title='"Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers"'>RFC3319</a>].  If the
      DHCPv6 service provides a value for option 58, those domain names
      MUST be saved as candidates for use as the Local Network Domain



<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 7]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


      (see <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration Service Domain").
      If and only if no values are returned for option 58, the UA MUST
      save any values returned for option 21 for use as the Local
      Network Domain.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Obtaining%20the%20Configuration%20Service%20Domain"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Obtaining the Configuration Service Domain</span>

   To obtain a configuration, the UA needs to know what domain to
   request it from.  This domain is the Configuration Service Domain;
   its value is a DNS name (see [<a href="rfc1034.html" title='"Domain names - concepts and facilities"'>RFC1034</a>]).

   User control or prior configuration MAY establish a value for the
   Configuration Service Domain that takes precedence over the discovery
   procedure defined below.  In the absence of user control or prior
   configuration, candidate values for the Configuration Service Domain
   are obtained as specified in <a href="#section-2.2.1">Section 2.2.1</a>, "The Local Network
   Domain", or if that is unsuccessful, by the manual mechanism
   specified in <a href="#section-2.2.2">Section 2.2.2</a>, "Manual Domain Name Entry".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.1.%20%20The%20Local%20Network%20Domain"></a><a class="selflink" href="#section-2.2.1" name="section-2.2.1">2.2.1</a>.  The Local Network Domain</span>

   The UA MUST attempt to use each value obtained for the Local Network
   Domain name (see <a href="#section-2.1.2">Section 2.1.2</a>, "Network Layer Provisioning") as the
   Configuration Service Domain.  If multiple names are provided by DHCP
   and/or DHCPv6 (multiple names may be returned by these services if
   both are in use, if the UA has multiple network interfaces, or if the
   option responses have multiple values), the UA MUST attempt to use
   each of the names provided until a configuration is successfully
   obtained.  The order in which values obtained in different responses
   are used is not defined by this specification -- the UA MAY use any
   order; multiple values returned within a single response MUST be
   tried in the order they were provided in that response.

   If the DHCP service does not provide any local domain name values,
   the UA SHOULD use the manual mechanism defined in <a href="#section-2.2.2">Section 2.2.2</a>,
   "Manual Domain Name Entry".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.2.%20%20Manual%20Domain%20Name%20Entry"></a><a class="selflink" href="#section-2.2.2" name="section-2.2.2">2.2.2</a>.  Manual Domain Name Entry</span>

   A UA MAY provide an interface by which a DNS name is supplied
   directly by the user for the Configuration Service Name.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Constructing%20the%20Configuration%20Request%20URL"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Constructing the Configuration Request URL</span>

   Using the Configuration Service Domain name obtained in <a href="#section-2.2">Section 2.2</a>,
   "Obtaining the Configuration Service Domain", the UA MUST construct
   an HTTPS URL [<a href="rfc2818.html" title='"HTTP Over TLS"'>RFC2818</a>] with which to request configuration.
   Constructing this URL consists of two parts:



<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 8]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   o  <a href="#section-2.3.1">Section 2.3.1</a>, "Obtaining a Configuration Service Base URL"

   o  <a href="#section-2.3.2">Section 2.3.2</a>, "Adding Configuration Request Parameters"

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.1.%20%20Obtaining%20a%20Configuration%20Service%20Base%20URL"></a><a class="selflink" href="#section-2.3.1" name="section-2.3.1">2.3.1</a>.  Obtaining a Configuration Service Base URL</span>

   The Configuration Service Domain is resolved to one or more URLs
   using the URI-enabled Naming Authority Pointer (U-NAPTR) DDDS
   application defined in "Domain-Based Application Service Location
   Using URIs and the Dynamic Delegation Discovery Service (DDDS)"
   [<a href="rfc4848.html" title='"Domain-Based Application Service Location Using URIs and the Dynamic Delegation Discovery Service (DDDS)"'>RFC4848</a>].

   The lookup key for the U-NAPTR request is the Configuration Service
   Domain name determined in <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration
   Service Domain".  The UA MUST make a DNS request for NAPTR records
   for that domain name.  From the returned records, the UA MUST select
   those whose Service field value is "SFUA.CFG"; from those records,
   the UA MUST extract the HTTPS URL of the Configuration Service from
   the Regular Expression field (see next paragraph for the construction
   of that field value).

   The NAPTR records for the Configuration Service Domain name whose
   Service field value is "SFUA.CFG" MUST be configured with the Flag
   field set to "U", an empty Substitution field, and a Regular
   Expression field value of the following syntax (i.e., a regular
   expression to replace the domain name with an https URI):

             u-naptr-regexp = "!.*!" &lt;URI&gt; "!"

   where &lt;URI&gt; is as defined in STD 66 [<a href="rfc3986.html" title='"Uniform Resource Identifier (URI): Generic Syntax"'>RFC3986</a>], the URI syntax
   specification, and where the scheme of the URI is "https".

   Note that the UA does not need to implement a general regular
   expression evaluator in order to process the record above correctly.
   The URI value can be extracted by stripping the fixed value "!^.*!"
   from the beginning of the value, and "!" from the end of the value to
   obtain the base URL.  See <a href="#section-2.3.3">Section 2.3.3</a>, "Configuration Request URI
   Example".

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.3.1.1.%20%20Configuration%20Service%20Redundancy"></a><a class="selflink" href="#section-2.3.1.1" name="section-2.3.1.1">2.3.1.1</a>.  Configuration Service Redundancy</span>

   Multiple Configuration Servers can be used to provide redundancy and
   additional capacity for provisioning User Agents.  If the DNS NAPTR
   request for the Configuration Service Domain name returns multiple
   records with the 'SFUA.CFG' service tag, then the UA should treat the
   resulting URLs as alternatives, ordered according to the rules for
   the priority and weight as specified for NAPTR records.




<span class="grey">Lawrence &amp; Elwell             Informational                     [Page 9]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   In addition to redundancy provided by multiple NAPTR records,
   resolution of the host part of the HTTPS URL can produce multiple
   results.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.3.1.2.%20%20Configuration%20Service%20Name%20to%20Base%20URL%20Resolution%20Failure"></a><a class="selflink" href="#section-2.3.1.2" name="section-2.3.1.2">2.3.1.2</a>.  Configuration Service Name to Base URL Resolution Failure</span>

   If the DNS request to resolve the Configuration Service Domain name
   to a request URL does not receive any response, the UA should follow
   standard DNS retry procedures.

   If the DNS request to resolve the Configuration Service Domain name
   to a host name returns a response that indicates that no matching
   result is available (NXDOMAIN), the UA SHOULD attempt to obtain
   another Configuration Service Domain name using the procedures in
   <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration Service Domain".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.2.%20%20Adding%20Configuration%20Request%20Parameters"></a><a class="selflink" href="#section-2.3.2" name="section-2.3.2">2.3.2</a>.  Adding Configuration Request Parameters</span>

   To construct the full configuration request URL, the UA adds one or
   more parameters to the base URLs to specify what configuration the UA
   is requesting.

   1.  The UA MUST add all parameters from those defined in the
       Configuration Request Parameters list below for which the UA has
       a value.  Any parameter from that set for which the UA does not
       have a value MUST be omitted.

   2.  The query parameter names defined by this specification all begin
       with the prefix 'sfua-'.  All names beginning with the prefix
       'sfua-' are reserved for this specification and future revisions.
       The UA MUST NOT include any request parameter whose name begins
       with the prefix 'sfua-' that is not defined by this specification
       (including any future revisions).

   3.  Any parameter not defined by the specification is allowed, but
       MUST be ignored by any Configuration Service that does not
       recognize it.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.3.2.1.%20%20Configuration%20Request%20Parameters"></a><a class="selflink" href="#section-2.3.2.1" name="section-2.3.2.1">2.3.2.1</a>.  Configuration Request Parameters</span>

      The following parameters are defined for the configuration
      request.  <a href="#section-4.4">Section 4.4</a> creates an IANA registry for these and any
      parameters defined in the future.








<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 10]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   sfua-id

      The URN identifying the User Agent, constructed as specified in
      <a href="rfc5626.html#section-4.1">Section 4.1 of [RFC5626]</a> "Managing Client-Initiated Connections in
      the Session Initiation Protocol (SIP)".

      Since the procedure defined by [<a href="rfc5626.html" title='"Managing Client- Initiated Connections in the Session Initiation Protocol (SIP)"'>RFC5626</a>] allows any UA to
      construct a value for this parameter, the sfua-id parameter MUST
      always be included.

      If the UA implements [<a href="rfc5626.html" title='"Managing Client- Initiated Connections in the Session Initiation Protocol (SIP)"'>RFC5626</a>], and includes the '+sip.instance'
      Contact header field parameter in any request, when requesting
      configuration it MUST use the same value for the sfua-id
      parameter.

   sfua-user

      An identifier for a user associated with the configuration.  Note
      that this might be different than any SIP 'user' in the UA
      configuration: it could, for example, be the login name of an
      account on the service provider web site.  The syntax of this
      parameter is that of the 'userid' [<a href="rfc2617.html" title='"HTTP Authentication: Basic and Digest Access Authentication"'>RFC2617</a>].

      See <a href="#section-2.4.1">Section 2.4.1</a>, "Configuration Data Request Authentication" for
      how this parameter relates to authentication of the configuration
      data request.

   sfua-vendor

      An identifier that specifies the vendor of the User Agent.  The
      syntax of the value of this parameter is that of a DNS domain.
      The domain value MUST be that of a domain owned by the vendor.

   sfua-model

      An identifier that further specifies the User Agent from among
      those produced by the vendor.  The syntax of the value of this
      parameter is the same as the 'token' [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  Values for this
      parameter are selected by the vendor.

   sfua-revision

      An identifier that further specifies the User Agent from among
      those produced by the vendor.  The syntax of the value of this
      parameter is the same as the 'token' [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  Values for this
      parameter are selected by the vendor.





<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 11]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.3.%20%20Configuration%20Request%20URI%20Example"></a><a class="selflink" href="#section-2.3.3" name="section-2.3.3">2.3.3</a>.  Configuration Request URI Example</span>

   Using the rules in <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration Service
   Domain", the UA has determined that the Configuration Service Domain
   value is "example.net".  To obtain the base URL, the UA constructs
   the DNS NAPTR request for "example.net.", which returns the DNS
   records:

   NAPTR  10 10 "u" "SFUA.CFG" "!^.*$!https://p1.example.net/cfg!" ""
   NAPTR 100 10 "u" "SFUA.CFG" "!^.*$!https://p2.example.net/cfg!" ""
   NAPTR  90 50 "s" "SIP+D2T"  ""  _sip._tcp.example.net.
   NAPTR 100 50 "s" "SIP+D2U"  ""  _sip._udp.example.net.

        Figure 1: Example Configuration Service NAPTR Query Results

   The records with the service-field "SFUA.CFG" each provide a base URL
   value for SIP UA configuration requests.

   Our hypothetical example communications device is a 'HypoComm'
   version 2.1, made by ExampleCorp, and has the link layer MAC address
   of 00:11:22:33:44:55.  It does not have any prior knowledge of a user
   identity for which to request configuration, so it constructs query
   parameters using the values it does have, combining each with the
   base URL to create these request URLs (lines wrapped for
   readability):

   https://p1.example.net/cfg
      ?sfua-id=urn:uuid:00000000-0000-1000-8000-001122334455
      &amp;sfua-vendor=examplecorp.com
      &amp;sfua-model=HypoComm
      &amp;sfua-revision=2.1
   https://p2.example.net/cfg
      ?sfua-id=urn:uuid:00000000-0000-1000-8000-001122334455
      &amp;sfua-vendor=examplecorp.com
      &amp;sfua-model=HypoComm
      &amp;sfua-revision=2.1

               Figure 2: Example Configuration Request URLs













<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 12]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Obtaining%20Configuration%20from%20the%20Configuration%20Service"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Obtaining Configuration from the Configuration Service</span>

   To request configuration using a URL constructed as specified in
   <a href="#section-2.3">Section 2.3</a>, "Constructing the Configuration Request URL" the User
   Agent MUST do an HTTPS GET request to each of the URLs until a
   configuration that the UA can use is returned in response to one of
   the requests.

   A successful final response from the Configuration Service to a GET
   request for configuration data MUST contain configuration data for
   the UA in the HTTP response body.  Note that the full capabilities of
   HTTP as specified in [<a href="rfc2616.html" title='"Hypertext Transfer Protocol -- HTTP/1.1"'>RFC2616</a>] are available to the CS, so responses
   such as redirection can be used by the CS as a part of the process of
   providing configuration data.

   Configuration data returned in a successful response is subject to
   change by the CS.  The HTTP cache control metadata (the max-age
   directive value from any Cache-Control header, and the Etag and Last-
   Modified header values) returned in the response that provides
   configuration data is used to determine when a configuration change
   has occurred (<a href="#section-2.5.1.3">Section 2.5.1.3</a>, "Configuration Change Notices") and to
   validate any stored configuration data (<a href="#section-2.6">Section 2.6</a>, "Validity of
   Stored Configuration Data").

   o  An HTTP response from the CS that provides configuration data MUST
      include cache control metadata sufficient to ensure that when a
      new configuration is available, the cache control information for
      that new data is different.

   o  The UA MUST retain all of the HTTP cache control metadata from any
      response that provides configuration data.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.%20%20Configuration%20Data%20Request%20Authentication"></a><a class="selflink" href="#section-2.4.1" name="section-2.4.1">2.4.1</a>.  Configuration Data Request Authentication</span>

   Since the Configuration Request URL scheme is HTTPS, the UA MUST
   always use Transport Layer Security (TLS) [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] to establish a
   connection with the Configuration Service.

   The UA MUST provide a server_name extension in the TLS Client Hello
   message as defined in [<a href="rfc4366.html" title='"Transport Layer Security (TLS) Extensions"'>RFC4366</a>] "Transport Layer Security (TLS)
   Extensions", whose value is the Configuration Service Domain name
   (note that this might not be the same as the host part of the CS base
   URL).  This allows the CS to identify and provide a server
   certificate containing the desired identity (allowing for a single
   server to serve multiple domain names).






<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 13]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   A UA MUST attempt to validate the server certificate provided by the
   CS, in accordance with the rules defined in <a href="rfc2818.html#section-3.1">Section 3.1 of [RFC2818]</a>.
   Unfortunately, the validation attempt might fail (e.g., because the
   UA might not have in firmware a trusted root CA cert to which the CS
   certificate chain can be connected or because the root CA cert has
   expired since the UA firmware was last updated).  If the UA is unable
   to validate the server certificate provided by the CS, the UA SHOULD
   store the server certificate and alert the user if that CS host
   provides a different certificate in the future.  Although this 'trust
   on first use' model is not as secure as certificate validation, it
   does give some protection against man-in-the-middle (MITM) attacks in
   the future.

   If it has one, the UA MUST provide a client certificate.  The CS MUST
   validate the UA client's certificate, if one is provided.  If the CS
   is unable to authenticate the certificate provided by the UA (for
   example, the UA is using a self-signed certificate), then the CS MAY
   choose to cache the certificate, provided that the UA successfully
   authenticates using HTTP authentication (see next paragraph).  This
   allows a CS to treat the digest authentication credentials as a
   single-use password to authenticate the client certificate.  This
   'trust on first use' model provides protection against future MITM
   attacks, provided that the initial communication is not compromised.

   If the CS requires HTTP authentication of the configuration data
   request, the HTTP 'username' parameter used MUST be the same value as
   the sfua-user value provided in the configuration data request
   parameters.  The UA MUST implement both Basic and Digest
   authentication as specified by [<a href="rfc2617.html" title='"HTTP Authentication: Basic and Digest Access Authentication"'>RFC2617</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.2.%20%20Configuration%20Data%20Request%20Failure"></a><a class="selflink" href="#section-2.4.2" name="section-2.4.2">2.4.2</a>.  Configuration Data Request Failure</span>

   The HTTP configuration data request can fail in a number of ways; the
   error handling for each is defined below:

   o  If a DNS request to resolve the host name in the request URL
      returns a response that indicates that no matching result is
      available (NXDOMAIN), the UA MUST remove that request URL from the
      list of alternatives for the Configuration Service Domain.

   o  If the attempt to open a TCP connection to the host in the request
      URL fails, the UA MAY attempt requests to any alternative URLs for
      the same configuration service without waiting between
      alternatives, but any requests to the same host MUST wait between
      requests according to the procedure defined in <a href="#section-2.7">Section 2.7</a>, "Retry
      Backoff Procedure".





<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 14]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   o  If the TCP connection succeeds but the TLS handshake fails,
      including failure of the UA to validate the certificate provided
      by the Configuration Service host (if the UA is capable of
      validation), the UA MUST remove the failed URL from the list of
      alternative URLs for this Configuration Service Domain.

   o  If the request returns a permanent HTTP failure response (response
      code &gt;= 400, and does not contain a Retry-After header field), the
      UA MUST remove the failed URL from the list of alternatives for
      this Configuration Service Domain.

   o  If the list of alternatives for this Configuration Service Domain
      becomes empty, the UA MUST attempt to obtain another Configuration
      Service Domain name using the procedures in <a href="#section-2.2">Section 2.2</a>,
      "Obtaining the Configuration Service Domain".

   o  If the UA has reached its chosen maximum number of retries (this
      specification does not specify a maximum number of retries, but
      any retries to the same host MUST follow the procedure defined in
      <a href="#section-2.7">Section 2.7</a>, "Retry Backoff Procedure"), the UA MAY attempt to
      obtain another Configuration Domain name using the procedures in
      <a href="#section-2.2">Section 2.2</a>, "Obtaining the Configuration Service Domain".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5.%20%20Configuration%20Changes"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a>.  Configuration Changes</span>

   The configuration data provided by the CS is subject to change.  This
   specification provides for two mechanisms by which the UA discovers
   that a configuration change is available:

   o  SIP subscription by the UA to the CS for notification of changes
      to the configuration data.

   o  HTTP polling by the UA of the configuration data URL at the CS.

   The choice of mechanism is made by the Configuration Service and
   signaled to the UA in each HTTP response that provides configuration
   data.  In such a response, the CS MUST either:

   o  Indicate that the UA is to subscribe for change notifications by
      including a Link header in the response with the link relation
      'monitor' and SIP URI.  This choice is specified in <a href="#section-2.5.1">Section 2.5.1</a>,
      "Configuration Change Subscriptions".

   o  Indicate that the UA is to poll for updates using HTTP by not
      including a Link header with the link relation 'monitor'.  This
      choice is specified in <a href="#section-2.5.2">Section 2.5.2</a>, "Configuration Change
      Polling".




<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 15]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   A User Agent MUST support both mechanisms, and use the mechanism
   indicated by the Configuration Service.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.1.%20%20Configuration%20Change%20Subscriptions"></a><a class="selflink" href="#section-2.5.1" name="section-2.5.1">2.5.1</a>.  Configuration Change Subscriptions</span>

   If the CS chooses to use the SIP subscription mechanism, it MUST
   include a Link header in the HTTP configuration data response as
   specified by [<a href="rfc5989.html" title='"A SIP Event Package for Subscribing to Changes to an HTTP Resource"'>RFC5989</a>]; the URI value in the Link header MUST be a
   SIP URI, and the link relation ('rel' attribute) value MUST be
   'monitor'.  The 'monitor-group' relation MUST NOT be used -- see
   below for rules regarding monitoring of multiple configuration data
   resources.  The SIP URI returned in the Link header is the
   'configuration change subscription URI'.

   A UA that receives a successful configuration data response with a
   Link header that specifies a 'monitor' relation MUST attempt to
   maintain a subscription to the SIP URI from the Link header in that
   response for the http-monitor event package.  This subscription is
   referred to herein as a "configuration change subscription".

   The CS MUST accept properly authenticated SUBSCRIBE requests from the
   UA for the http-monitor event package at the URI it provided in the
   Link header of a configuration data response.  Authentication of the
   SUBSCRIBE request uses any standard SIP authentication mechanism with
   credentials supplied to the UA in the configuration data.

   Configuration data MAY include references in the form of additional
   URLs at the CS that the UA MUST use to obtain additional data.  Any
   response to requests for these additional URLs that provide
   configuration data MUST provide cache control data and a
   configuration change subscription URI.  The CS MAY return a unique
   configuration change subscription URI for each configuration data
   request, or MAY return the same SIP URI for different requests, so
   long as a change to the configuration data returned in any of these
   request results in notification on all subscriptions to the
   associated subscription URI.

   If the CS returns a unique configuration change subscription URI in
   the Link header of different configuration data requests:

   o  The UA MUST maintain multiple subscriptions; one to each URI
      associated with configuration data the UA is using.

   If the CS returns the same configuration change subscription URI in
   the Link header of different configuration data requests:

   o  The UA is not required to create multiple subscriptions to the
      same URI.



<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 16]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   o  The UA MUST associate the URI with each of the configuration data
      requests for which it was returned, and any NOTIFY or other change
      in the status of that subscription affects the validity of all of
      the associated configuration data.

   o  The CS MUST send a NOTIFY message on the configuration change
      subscription when there is a change to any of the different
      configuration data resources for which the subscription URI was
      returned.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.5.1.1.%20%20Change%20Subscription%20Failure"></a><a class="selflink" href="#section-2.5.1.1" name="section-2.5.1.1">2.5.1.1</a>.  Change Subscription Failure</span>

   If a configuration change SUBSCRIBE request (either the initial
   request or any attempt to refresh the subscription) is permanently
   rejected by the Configuration Service (the CS returns a failure
   response that is not an authentication challenge or redirection and
   does not specify a Retry-After header), the UA MUST consider the
   associated configuration data to be not valid and attempt to
   revalidate it as specified in <a href="#section-2.6.1">Section 2.6.1</a>, "Re-Validating
   Configuration Data".  Since the CS is not allowed to reject a
   properly authenticated request, this indicates a problem either with
   the configuration data or the CS.

   If a configuration change SUBSCRIBE request (either the initial
   request or any attempt to refresh the subscription) fails other than
   by being permanently rejected, the UA MUST consider the associated
   configuration data to be of unknown validity, and MUST retry the
   SUBSCRIBE request as specified in <a href="#section-2.7">Section 2.7</a>, "Retry Backoff
   Procedure"; the maximum time between retries MUST NOT be more than 30
   minutes, and the retries MUST continue as long as the configuration
   is used.  The UA MAY at any time return to any earlier step in the
   process of obtaining configuration data.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.5.1.2.%20%20Change%20Subscription%20Termination"></a><a class="selflink" href="#section-2.5.1.2" name="section-2.5.1.2">2.5.1.2</a>.  Change Subscription Termination</span>

   If the CS explicitly terminates the configuration change (http-
   monitor) subscription by sending a NOTIFY message with a
   Subscription-State header value of 'terminated', the UA MUST consider
   the configuration data to be of unknown validity.  If the rules for
   interpreting and acting on the 'reason' code parameter as specified
   in <a href="rfc3265.html#section-3.2.4">Section 3.2.4 of [RFC3265]</a> allow, the UA MUST attempt to re-
   establish the subscription.  If those rules do not allow the UA to
   re-subscribe, then the UA MUST consider the data to be not valid and
   attempt to revalidate it as specified in <a href="#section-2.6.1">Section 2.6.1</a>, "Re-
   Validating Configuration Data".  The UA MAY at any time return to any
   earlier step in the process of obtaining configuration data.





<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 17]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.5.1.3.%20%20Configuration%20Change%20Notices"></a><a class="selflink" href="#section-2.5.1.3" name="section-2.5.1.3">2.5.1.3</a>.  Configuration Change Notices</span>

   To inform the UA of a configuration data change, the CS MUST send a
   NOTIFY message to the UA in the configuration change subscription
   established by the UA as detailed in <a href="#section-2.5.1">Section 2.5.1</a>, "Configuration
   Change Subscriptions".

   The CS MUST NOT send unsolicited (out-of-dialog) NOTIFY messages.

   As specified in [<a href="rfc5989.html" title='"A SIP Event Package for Subscribing to Changes to an HTTP Resource"'>RFC5989</a>], the body of a NOTIFY message in the http-
   monitor event package is the HTTP headers that would have been
   returned in response to an HTTP HEAD request (a HEAD request returns
   the headers that would have been returned for a GET request to the
   same URI, but with no body).

   When a NOTIFY message is received by the UA in the configuration
   change subscription, the UA MUST compare the cache control data it
   retained when the configuration data was received with the HTTP
   header values in the NOTIFY message body.  If any of the cache
   control data in the HTTP header values differs from those in the
   original configuration data response, the UA MUST consider the stored
   configuration data to be no longer valid.  As soon as reasonably
   possible after the UA discovers that configuration data is no longer
   valid, the UA MUST attempt a GET request to the HTTPS configuration
   request URL which provided the configuration data to obtain the
   changed configuration data.

   If this HTTPS request to the URL that previously provided the
   configuration data fails, the UA MUST attempt to obtain a new URL as
   specified in <a href="#section-2.3">Section 2.3</a>, "Constructing the Configuration Request
   URL".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.2.%20%20Configuration%20Change%20Polling"></a><a class="selflink" href="#section-2.5.2" name="section-2.5.2">2.5.2</a>.  Configuration Change Polling</span>

   If the CS chooses to use the HTTP polling mechanism, it MUST NOT
   include a Link header with the relation 'monitor' in the HTTP
   configuration data response, and MUST include a Cache-Control header
   that specifies the max-age directive.  The max-age cache control
   directive in HTTP specifies the maximum number of seconds for which
   the returned data may be cached; this specification defines this time
   as being the maximum time the configuration data is considered valid.

   A short time before the validity time has passed, the UA SHOULD poll
   to revalidate the configuration data as described in <a href="#section-2.6.1">Section 2.6.1</a>,
   "Re-Validating Configuration Data".






<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 18]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.6.%20%20Validity%20of%20Stored%20Configuration%20Data"></a><a class="selflink" href="#section-2.6" name="section-2.6">2.6</a>.  Validity of Stored Configuration Data</span>

   Configuration data stored by a UA is considered valid:

   o  If the CS chose to use the subscription mechanism to deliver
      change notices, and the UA has a subscription to the CS as
      described in <a href="#section-2.5.1">Section 2.5.1</a>, "Configuration Change Subscriptions"
      on which no NOTIFY message from the CS indicating that the
      configuration data has changed has been received.

   o  If the CS chose to use the HTTP polling method, and the number of
      seconds since the configuration data response was received is less
      than the time specified by the Cache-Control max-age directive in
      that response.

   When a UA initializes itself at any time other than immediately after
   receiving new configuration data, it MUST consider any stored
   configuration data to be of unknown validity.

   The UA MAY use configuration data that is of unknown validity, or
   configuration data that is known to be no longer valid, while
   attempting to revalidate that data or obtain new data.  There is no
   assurance that such configuration data is still useful, but the UA
   MAY choose to retain the data and to continue to use it.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.6.1.%20%20Re-Validating%20Configuration%20Data"></a><a class="selflink" href="#section-2.6.1" name="section-2.6.1">2.6.1</a>.  Re-Validating Configuration Data</span>

   To revalidate stored configuration data of unknown validity, the UA
   MUST repeat the HTTPS GET request it used to obtain the stored
   configuration data, with the appropriate HTTP headers to make the
   request a conditional request using the cache control data returned
   in the response that provided the configuration data.  This allows
   the CS to respond either with a new configuration data response or a
   304 (Not Modified) response to indicate that the configuration data
   has not changed.

   If the CS responds with a 304 response, and the original response
   included a Link header with the 'monitor' relation, the SIP UA MUST
   assume that the value of that Link header is also still correct (in
   effect, the HTTP cache control values and the subscription URL are a
   part of the configuration data), and so the UA MUST attempt to create
   and maintain a subscription to that URL as when the configuration
   data was first obtained (<a href="#section-2.5.1">Section 2.5.1</a>, "Configuration Change
   Subscriptions").







<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 19]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   If the CS chooses to use the HTTP polling method, then any 304
   response MUST include a Cache-Control header containing a max-age
   directive, and the UA MUST use this new value as the maximum validity
   time for the associated configuration data.

   If the HTTP request to revalidate the configuration fails, the UA
   MUST follow the procedures defined for a failure of the initial HTTP
   configuration data request as specified in <a href="#section-2.4.2">Section 2.4.2</a>,
   "Configuration Data Request Failure".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.7.%20%20Retry%20Backoff%20Procedure"></a><a class="selflink" href="#section-2.7" name="section-2.7">2.7</a>.  Retry Backoff Procedure</span>

   In case of certain possible failures as described above, the
   appropriate response is to retry the failed operation.  In all of
   these retry cases, the following rules apply:

   o  The UA SHOULD retry at least 5 times before abandoning the failed
      step (except as allowed for in specific error handling rules
      above).

   o  Following the first instance of a given failure, the UA MUST
      select an initial backoff timer value randomly between 2 and 8,
      inclusive, and wait this number of seconds before retrying the
      failed request.

   o  Following any subsequent instance of a given failure, the UA MUST
      increase the backoff timer value by 2 raised to the power of the
      number of preceding failures (2^N where N is the number of
      previous failures), and wait this increased number of seconds or
      the maximum interval specified by specific error handling
      procedures, whichever is less, before retrying the failed request.

   For example, after an initial failure, the UA randomly chooses an
   initial backoff timer value of 4 seconds, followed by retries at the
   following times: 6 seconds (4 + 2^1), 10 seconds (6 + 2^2), 18
   seconds (10 + 2^3), 34 seconds (18 + 2^4), and 66 seconds (34 + 2^5).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Configuration%20Data"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Configuration Data</span>

   This document does not specify the form or content of configuration
   data.  As such, the contents of this section are non-normative.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Configuration%20Data%20Items"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Configuration Data Items</span>

   The configuration data for a SIP UA should, at minimum, include items
   with the following semantics.





<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 20]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20%20Address-of-Record"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>.  Address-of-Record</span>

   The Address-of-Record (AOR) is a SIP or SIPS URI that identifies the
   user of the device as specified in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.%20%20Realm"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a>.  Realm</span>

   The realm is used to populate the realm parameter in the SIP Proxy-
   Authorization header as specified in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] when the UA receives
   an authentication challenge.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.3.%20%20Username"></a><a class="selflink" href="#section-3.1.3" name="section-3.1.3">3.1.3</a>.  Username</span>

   The username is used to populate the username parameter in the SIP
   Proxy-Authorization header as specified in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] when the UA
   receives an authentication challenge.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.4.%20%20Digest"></a><a class="selflink" href="#section-3.1.4" name="section-3.1.4">3.1.4</a>.  Digest</span>

   The digest is a string containing the digest of the username, realm,
   and password as specified in [<a href="rfc2617.html" title='"HTTP Authentication: Basic and Digest Access Authentication"'>RFC2617</a>] and is used to generate a
   response to an authentication challenge as specified in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.5.%20%20OutboundProxy"></a><a class="selflink" href="#section-3.1.5" name="section-3.1.5">3.1.5</a>.  OutboundProxy</span>

   The OutboundProxy if defined contains the default outbound proxy
   through which SIP requests, not explicitly routed, are routed as
   specified in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Reset%20User%20Agent%20to%20Default%20Configuration"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Reset User Agent to Default Configuration</span>

   The earlier sections of this document define methods by which the UA
   can be automatically provisioned.  Some User Agents allow certain
   user specific settings (e.g., Contact Directory, specialized ring-
   tones, etc.) to be set by a user, and possibly stored locally in the
   User Agent.  Since it may be necessary to later re-assign a UA,
   designers of configuration data formats may want to provide for
   explicit controls for any such locally configured settings, including
   the ability to explicitly delete them to return the UA to a
   completely unconfigured state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20DHCP%20SIP%20User%20Agent%20Configuration%20Service%20Domains%20Option"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  DHCP SIP User Agent Configuration Service Domains Option</span>

   This specification defines DHCP option code 141, the "SIP UA
   Configuration Service Domains" for inclusion in the IANA registry
   "BOOTP Vendor Extensions and DHCP Options" defined by [<a href="rfc2939.html" title='"Procedures and IANA Guidelines for Definition of New DHCP Options and Message Types"'>RFC2939</a>].



<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 21]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      141      |     Len       |         Searchstring...       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Searchstring...                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   In the above diagram, Searchstring is a string specifying the
   searchlist.  If the length of the searchlist exceeds the maximum
   permissible within a single option (255 octets), then multiple
   options MAY be used, as described in [<a href="rfc3396.html" title='"Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)"'>RFC3396</a>] "Encoding Long DHCP
   Options in the Dynamic Host Configuration Protocol (DHCPv4)".

   To enable the searchlist to be encoded compactly, searchstrings in
   the searchlist MUST be concatenated and encoded using the technique
   described in <a href="rfc1035.html#section-4.1.4">Section 4.1.4 of [RFC1035]</a>, "Domain Names -
   Implementation and Specification".  In this scheme, an entire domain
   name or a list of labels at the end of a domain name is replaced with
   a pointer to a prior occurrence of the same name.  Despite its
   complexity, this technique is valuable since the space available for
   encoding DHCP options is limited, and it is likely that a domain
   searchstring will contain repeated instances of the same domain name.
   Thus, the DNS name compression is both useful and likely to be
   effective.

   For use in this specification, the pointer refers to the offset
   within the data portion of the DHCP option (not including the
   preceding DHCP option code byte or DHCP option length byte).

   If multiple SIP UA Configuration Service Domains options are present,
   then the data portions of all the SIP UA Configuration Service
   Domains options are concatenated together as specified in <a href="rfc3396.html">RFC 3396</a>,
   and the pointer indicates an offset within the complete aggregate
   block of data.

   For examples of encoding this option, see <a href="rfc3397.html#section-3">Section 3 of [RFC3397]</a>,
   "Dynamic Host Configuration Protocol (DHCP) Domain Search Option",
   which uses the same encoding for option 119.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20DHCPv6%20SIP%20User%20Agent%20Configuration%20Service%20Domains%20Option"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  DHCPv6 SIP User Agent Configuration Service Domains Option</span>

   This specification defines DHCPv6 option code 58,
   OPTION_SIP_UA_CS_LIST, for inclusion in the IANA registry "Dynamic
   Host Configuration Protocol for IPv6 (DHCPv6), DHCP Option Codes"
   defined by <a href="rfc3315.html">RFC 3315</a>.





<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 22]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   The format of the SIP User Agent Configuration Service Domains option
   is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     OPTION_SIP_UA_CS_LIST     |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          searchlist                           |
      |                              ...                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   option-code OPTION_SIP_UA_CS_LIST (58)

   option-len  Length of the 'searchlist' field in octets

   searchlist  The specification of the list of domain names in the SIP
               User Agent Configuration Service Domains

   The list of domain names in the 'searchlist' MUST be encoded as
   specified in <a href="#section-8">Section 8</a>, "Representation and Use of Domain Names" of
   <a href="rfc3315.html">RFC 3315</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20U-NAPTR%20Registration"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  U-NAPTR Registration</span>

   This document registers the following U-NAPTR application service tag
   in the registry defined by [<a href="rfc3958.html" title='"Domain-Based Application Service Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS)"'>RFC3958</a>], "Domain-Based Application
   Service Location Using SRV RRs and the Dynamic Delegation Discovery
   Service (DDDS)":

                  +-------------------------+----------+
                  | Application Service Tag | SFUA.CFG |
                  +-------------------------+----------+

   This tag is used to obtain the base URL of the Configuration Service
   from the DNS name of a SIP domain as specified in <a href="#section-2.3.1">Section 2.3.1</a>,
   "Obtaining a Configuration Service Base URL".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20SIP%20Forum%20User%20Agent%20Configuration%20Parameter%20Registry"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  SIP Forum User Agent Configuration Parameter Registry</span>

   IANA has established a registry for "SIP Forum User Agent
   Configuration Parameters".  This registry records the HTTPS request
   parameters for the initial configuration data request sent by a User
   Agent to a Configuration Service as described in <a href="#section-2.3.2">Section 2.3.2</a>,
   "Adding Configuration Request Parameters".






<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 23]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   Each entry in the registry must include the Parameter Name and a
   Description that specifies the value syntax and usage of the
   parameter:

   Parameter Name  The name of the parameter, which MUST match the ABNF
                   production for 'token' from [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

   Value Syntax  The syntax of the value, if any (a parameter may just
                 be a name with no associated value).

   Usage       The purpose served by the parameter, including any
               default method the UA should use to construct it if
               applicable.

   The initial values for the registry are the parameters described in
   <a href="#section-2.3.2.1">Section 2.3.2.1</a>, "Configuration Request Parameters".  The policy for
   future additions to this registry depends on the parameter name
   value:

      If the name of the parameter begins with the characters 'sfua-' in
      any case, then the policy for addition to this registry is "RFC
      Required" as described by [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

      Any other parameter entry may be added to this registry using a
      "First Come First Served" policy as described by [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   Initial discovery of the Configuration Service Domain name relies on
   a number of operations that are normally unsecured: a DHCP response
   could be provided by an attacker to replace the values of any of the
   IP Network Parameters (<a href="#section-2.1.2">Section 2.1.2</a>, "Network Layer Provisioning")
   including the Local Network Domain which is the default choice for
   the Configuration Service Domain name.  Confirmation by the human
   user of the Configuration Service Domain name, especially when it
   differs from a previously used value, could be used to mitigate this
   (perhaps unintentional) potential reconfiguration.  Note that
   previously loaded configuration MAY constrain which parts of the
   discovery and location procedures are used: for example, the
   Configuration Service Domain name might be fixed so that it cannot be
   modified by discovery.

   The connection to the Configuration Service is made over TLS.  As the
   TLS server, the CS always provides a server certificate during the
   TLS handshake; if possible, the UA should validate that certificate
   and confirm that it contains as a subject the Configuration Service
   Domain name or at least the host name from the Configuration Service
   Base URL (see [<a href="rfc2818.html" title='"HTTP Over TLS"'>RFC2818</a>]).  While it may not be possible to have the



<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 24]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   information needed to perform a full validation of the CS server
   certificate prior to the first configuration (for example, the UA may
   not have a current CA certificate for the CA that signs the CS server
   certificate), implementors are advised to provide that information in
   configuration data so that it can be used for subsequent
   reconfigurations; this narrows the window of vulnerability to the
   first configuration attempt.

   To secure initial configuration attempts, the CS can deny requests
   from unknown devices and/or could implement other measures such as
   restricting the time window during which it will accept an initial
   configuration request from a given device.  A more secure approach
   would be to provide the user with a password, perhaps a one-time
   password valid only for the initial access.  In high security
   environments, the Configuration Service could require that the User
   Agent provide a client certificate for authentication in the TLS
   connection for configuration data requests.  This would necessitate
   some prior manual configuration of the User Agent, and possibly the
   Configuration Service, and that configuration should also include
   sufficient information for the UA to fully validate the CS
   certificate.

   The values of some or all of the request parameters sent by the UA on
   the initial request for configuration data (see <a href="#section-2.3.2">Section 2.3.2</a>,
   "Adding Configuration Request Parameters") may be sensitive
   information.  Since the configuration data request is made over a TLS
   connection, the confidentiality of that information is protected on
   the network.  Configuration Service implementations should take all
   necessary measures to ensure that the request parameter data is
   appropriately protected within the CS itself.

   The Configuration Change Request Subscription (<a href="#section-2.5.1">Section 2.5.1</a>,
   "Configuration Change Subscriptions") is established only after the
   configuration data has been loaded by the User Agent, so all security
   mechanisms available in SIP (including request digest authentication
   and the use of TLS) can be configured and required by either the CS
   or the UA.  Note that a configuration change notice does not actually
   provide any new configuration data, nor can it change where the UA
   sends a request for the new configuration data.  This means that an
   attacker cannot reconfigure a UA by subverting only the change notice
   subscription; the most the attacker can do is trigger checks for new
   data.  In order to actually modify the configuration data itself, the
   attacker must subvert the CS or the steps leading to the CS discovery
   (subject to the checks described above).

   Implementations of TLS typically support multiple versions of the
   Transport Layer Security protocol as well as the older Secure Sockets
   Layer (SSL) protocol.  Because of known security vulnerabilities, SIP



<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 25]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   UAs, SIP Service Provider, and the Configuration Service Host MUST
   NOT request, offer, or use SSL 2.0.  See <a href="rfc5246.html#appendix-E.2">Appendix E.2 of [RFC5246]</a>
   for further details.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Acknowledgements"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Acknowledgements</span>

   Contributing Members of the SIP Forum User Agent Configuration
   Working Group:

      Francois Audet, Nortel Networks, Inc.

      Eric Burger, SIP Forum

      Sumanth Channabasappa, Cable Television Laboratories, Inc.
      (CableLabs)

      Martin Dolly, AT&amp;T Labs

      John Elwell, Siemens Enterprise Communications

      Marek Dutkiewicz, Polycom, Inc.

      Andy Hutton, Siemens Enterprise Communications

      Lincoln Lavoie, University of New Hampshire

      Scott Lawrence, Avaya, Inc.

      Paul Mossman, Avaya, Inc.

      Michael Procter, VoIP.co.uk

      Marc Robins, SIP Forum

      Henning Schulzrinne, Columbia University

      Rifaat Shekh-Yusef, Avaya, Inc.

      Robert Sparks, Tekelec

      Simo Veikkolainen, Nokia

   The Editor would like to also acknowledge valuable contributions by
   Leslie Daigle and Margaret Wasserman.







<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 26]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Normative%20References"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Normative References</span>

   [<a id="ref-RFC1034" name="ref-RFC1034">RFC1034</a>]  Mockapetris, P., "Domain names - concepts and facilities",
              STD 13, <a href="rfc1034.html">RFC 1034</a>, November 1987.

   [<a id="ref-RFC1035" name="ref-RFC1035">RFC1035</a>]  Mockapetris, P., "Domain names - implementation and
              specification", STD 13, <a href="rfc1035.html">RFC 1035</a>, November 1987.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2131" name="ref-RFC2131">RFC2131</a>]  Droms, R., "Dynamic Host Configuration Protocol",
              <a href="rfc2131.html">RFC 2131</a>, March 1997.

   [<a id="ref-RFC2132" name="ref-RFC2132">RFC2132</a>]  Alexander, S. and R. Droms, "DHCP Options and BOOTP Vendor
              Extensions", <a href="rfc2132.html">RFC 2132</a>, March 1997.

   [<a id="ref-RFC2616" name="ref-RFC2616">RFC2616</a>]  Fielding, R., Gettys, J., Mogul, J., Frystyk, H.,
              Masinter, L., Leach, P., and T. Berners-Lee, "Hypertext
              Transfer Protocol -- HTTP/1.1", <a href="rfc2616.html">RFC 2616</a>, June 1999.

   [<a id="ref-RFC2617" name="ref-RFC2617">RFC2617</a>]  Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S.,
              Leach, P., Luotonen, A., and L. Stewart, "HTTP
              Authentication: Basic and Digest Access Authentication",
              <a href="rfc2617.html">RFC 2617</a>, June 1999.

   [<a id="ref-RFC2818" name="ref-RFC2818">RFC2818</a>]  Rescorla, E., "HTTP Over TLS", <a href="rfc2818.html">RFC 2818</a>, May 2000.

   [<a id="ref-RFC2939" name="ref-RFC2939">RFC2939</a>]  Droms, R., "Procedures and IANA Guidelines for Definition
              of New DHCP Options and Message Types", <a href="http://tools.ietf.org/html/bcp43">BCP 43</a>, <a href="rfc2939.html">RFC 2939</a>,
              September 2000.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

   [<a id="ref-RFC3265" name="ref-RFC3265">RFC3265</a>]  Roach, A., "Session Initiation Protocol (SIP)-Specific
              Event Notification", <a href="rfc3265.html">RFC 3265</a>, June 2002.

   [<a id="ref-RFC3315" name="ref-RFC3315">RFC3315</a>]  Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C.,
              and M. Carney, "Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6)", <a href="rfc3315.html">RFC 3315</a>, July 2003.

   [<a id="ref-RFC3319" name="ref-RFC3319">RFC3319</a>]  Schulzrinne, H. and B. Volz, "Dynamic Host Configuration
              Protocol (DHCPv6) Options for Session Initiation Protocol
              (SIP) Servers", <a href="rfc3319.html">RFC 3319</a>, July 2003.




<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 27]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


   [<a id="ref-RFC3396" name="ref-RFC3396">RFC3396</a>]  Lemon, T. and S. Cheshire, "Encoding Long Options in the
              Dynamic Host Configuration Protocol (DHCPv4)", <a href="rfc3396.html">RFC 3396</a>,
              November 2002.

   [<a id="ref-RFC3397" name="ref-RFC3397">RFC3397</a>]  Aboba, B. and S. Cheshire, "Dynamic Host Configuration
              Protocol (DHCP) Domain Search Option", <a href="rfc3397.html">RFC 3397</a>,
              November 2002.

   [<a id="ref-RFC3958" name="ref-RFC3958">RFC3958</a>]  Daigle, L. and A. Newton, "Domain-Based Application
              Service Location Using SRV RRs and the Dynamic Delegation
              Discovery Service (DDDS)", <a href="rfc3958.html">RFC 3958</a>, January 2005.

   [<a id="ref-RFC3986" name="ref-RFC3986">RFC3986</a>]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              <a href="rfc3986.html">RFC 3986</a>, January 2005.

   [<a id="ref-RFC4366" name="ref-RFC4366">RFC4366</a>]  Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J.,
              and T. Wright, "Transport Layer Security (TLS)
              Extensions", <a href="rfc4366.html">RFC 4366</a>, April 2006.

   [<a id="ref-RFC4848" name="ref-RFC4848">RFC4848</a>]  Daigle, L., "Domain-Based Application Service Location
              Using URIs and the Dynamic Delegation Discovery Service
              (DDDS)", <a href="rfc4848.html">RFC 4848</a>, April 2007.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="http://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              May 2008.

   [<a id="ref-RFC5626" name="ref-RFC5626">RFC5626</a>]  Jennings, C., Mahy, R., and F. Audet, "Managing Client-
              Initiated Connections in the Session Initiation Protocol
              (SIP)", <a href="rfc5626.html">RFC 5626</a>, October 2009.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>, August 2008.

   [<a id="ref-RFC5989" name="ref-RFC5989">RFC5989</a>]  Roach, A., "A SIP Event Package for Subscribing to Changes
              to an HTTP Resource", October 2010.

   [<a id="ref-ANSI.TIA-1057-2006" name="ref-ANSI.TIA-1057-2006">ANSI.TIA-1057-2006</a>]
              American National Standards Institute, "Telecommunications
              IP Telephony Infrastructure Link Layer Discovery Protocol
              for Media Endpoint Devices", April 1993.









<span class="grey">Lawrence &amp; Elwell             Informational                    [Page 28]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6011.html">RFC 6011</a>                  SIP UA Configuration              October 2010</span>


Authors' Addresses

   Scott Lawrence (editor)
   Linden Research, Inc.

   EMail: scott-ietf@skrb.org


   John Elwell
   Siemens Enterprise Communications

   Phone: +44 1908 817801
   EMail: john.elwell@siemens-enterprise.com






































Lawrence &amp; Elwell             Informational                    [Page 29]

</pre><br/>
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.107, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>



</body><!-- Mirrored from tools.ietf.org/html/rfc6011 by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 07 Jun 2014 20:18:41 GMT --></html>