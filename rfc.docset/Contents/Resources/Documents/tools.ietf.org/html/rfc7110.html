<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.107" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-chen-mpls-return-path-specified-lsp-ping" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7110" name="DC.Identifier"/>
<meta content="January, 2014" name="DC.Date.Issued"/>
<meta content="Chen, Mach" name="DC.Creator"/>
<meta content="Cao, Wei" name="DC.Creator"/>
<meta content="Ning, So" name="DC.Creator"/>
<meta content='This document defines extensions to the data-plane failure-detection\nprotocol for Multiprotocol Label Switching (MPLS) Label Switched Paths\n(LSPs) known as "LSP ping". These extensions allow a selection of the\nLSP to be used for the echo reply return path. Enforcing a specific\nreturn path can be used to verify bidirectional connectivity and also\nincrease LSP ping robustness.' name="DC.Description.Abstract"/>
<meta content="Return Path Specified Label Switched Path (LSP) Ping" name="DC.Title"/>

    <link href="http://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="http://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7110 - Return Path Specified Label Switched Path (LSP) Ping</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc7110.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc7110" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-mpls-return-path-specified-lsp-ping" title="draft-ietf-mpls-return-path-specified-lsp-ping">draft-ietf-mpls-r...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7110" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc7110" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?option=rfc_search&amp;rfc_search=7110" title="IPR disclosures related to this document">IPR</a>]           </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                           M. Chen
Request for Comments: 7110                                        W. Cao
Category: Standards Track                   Huawei Technologies Co., Ltd
ISSN: 2070-1721                                                  S. Ning
                                                     Tata Communications
                                                               F. Jounay
                                                               Orange CH
                                                               S. Delord
                                                            January 2014


          <span class="h1">Return Path Specified Label Switched Path (LSP) Ping</span>

Abstract

   This document defines extensions to the data-plane failure-detection
   protocol for Multiprotocol Label Switching (MPLS) Label Switched
   Paths (LSPs) known as "LSP ping".  These extensions allow a selection
   of the LSP to be used for the echo reply return path.  Enforcing a
   specific return path can be used to verify bidirectional connectivity
   and also increase LSP ping robustness.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7110">http://www.rfc-editor.org/info/rfc7110</a>.
















<span class="grey">Chen, et al.                 Standards Track                    [Page 1]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Requirements Language ...........................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Problem Statements and Solution Overview ........................<a href="#page-3">3</a>
      <a href="#section-3.1">3.1</a>. Limitations of Existing Mechanisms for Bidirectional LSPs ..<a href="#page-4">4</a>
      3.2. Limitations of Existing Mechanisms for Handling
           Unreliable Return Paths ....................................<a href="#page-4">4</a>
   <a href="#section-4">4</a>. Extensions ......................................................<a href="#page-5">5</a>
      <a href="#section-4.1">4.1</a>. Reply via Specified Path Mode ..............................<a href="#page-6">6</a>
      <a href="#section-4.2">4.2</a>. Reply Path (RP) TLV ........................................<a href="#page-6">6</a>
      <a href="#section-4.3">4.3</a>. Tunnel Sub-TLVs ............................................<a href="#page-8">8</a>
           <a href="#section-4.3.1">4.3.1</a>. IPv4 RSVP Tunnel Sub-TLV ...........................<a href="#page-10">10</a>
           <a href="#section-4.3.2">4.3.2</a>. IPv6 RSVP Tunnel Sub-TLV ...........................<a href="#page-11">11</a>
           <a href="#section-4.3.3">4.3.3</a>. Static Tunnel Sub-TLV ..............................<a href="#page-12">12</a>
      <a href="#section-4.4">4.4</a>. Reply TC TLV ..............................................<a href="#page-12">12</a>
   <a href="#section-5">5</a>. Theory of Operation ............................................<a href="#page-13">13</a>
      <a href="#section-5.1">5.1</a>. Sending an Echo Request ...................................<a href="#page-14">14</a>
      <a href="#section-5.2">5.2</a>. Receiving an Echo Request .................................<a href="#page-14">14</a>
      <a href="#section-5.3">5.3</a>. Sending an Echo Reply .....................................<a href="#page-15">15</a>
      <a href="#section-5.4">5.4</a>. Receiving an Echo Reply ...................................<a href="#page-16">16</a>
      <a href="#section-5.5">5.5</a>. Non-IP Encapsulation for MPLS-TP LSPs .....................<a href="#page-16">16</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-16">16</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-17">17</a>
      <a href="#section-7.1">7.1</a>. TLVs ......................................................<a href="#page-17">17</a>
      <a href="#section-7.2">7.2</a>. New Target FEC Stack Sub-TLVs .............................<a href="#page-17">17</a>
      <a href="#section-7.3">7.3</a>. New Reply Mode ............................................<a href="#page-17">17</a>
      <a href="#section-7.4">7.4</a>. Reply Path Return Code ....................................<a href="#page-18">18</a>
   <a href="#section-8">8</a>. Contributors ...................................................<a href="#page-19">19</a>
   <a href="#section-9">9</a>. Acknowledgements ...............................................<a href="#page-19">19</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-19">19</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-19">19</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-20">20</a>



<span class="grey">Chen, et al.                 Standards Track                    [Page 2]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This document defines extensions to the data-plane failure-detection
   protocol for Multiprotocol Label Switching (MPLS) Label Switched
   Paths (LSPs) known as "LSP ping" [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] that can be used to
   specify the return paths for the echo reply message, increasing the
   robustness of LSP ping, reducing the opportunity for error, and
   improving the reliability of the echo reply message.  A new Reply
   Mode, which is referred to as "Reply via Specified Path", is added
   and a new Type-Length-Value (TLV), which is referred to as "Reply
   Path (RP) TLV", is defined in this memo.  The procedures defined in
   this document currently only apply to "ping" mode.  The "traceroute"
   mode is out of scope for this document.

   In this document, the term bidirectional LSP includes the co-routed
   bidirectional LSP defined in [<a href="rfc3945.html" title='"Generalized Multi-Protocol Label Switching (GMPLS) Architecture"'>RFC3945</a>] and the associated
   bidirectional LSP that is constructed from a pair of unidirectional
   LSPs (one for each direction) that are associated with one another at
   the LSP's ingress/egress points [<a href="rfc5654.html" title='"Requirements of an MPLS Transport Profile"'>RFC5654</a>].  The mechanisms defined in
   this document can apply to both IP/MPLS and MPLS Transport Profile
   (MPLS-TP) scenarios.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Requirements%20Language"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Problem%20Statements%20and%20Solution%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Problem Statements and Solution Overview</span>

   MPLS LSP ping is defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  It can be used to detect
   data-path failures in all MPLS LSPs.

   LSPs are increasingly being deployed to provide bidirectional
   services.  The co-routed bidirectional LSP is defined in [<a href="rfc3945.html" title='"Generalized Multi-Protocol Label Switching (GMPLS) Architecture"'>RFC3945</a>],
   and the associated bidirectional LSP is defined in [<a href="rfc5654.html" title='"Requirements of an MPLS Transport Profile"'>RFC5654</a>].  With
   the deployment of such services, operators have a desire to test both
   directions of a bidirectional LSP in a single operation.

   Additionally, when testing a single direction of an LSP (either a
   unidirectional LSP or a single direction of a bidirectional LSP)
   using LSP ping, the validity of the result may be affected by the
   success of delivering the echo reply message.  Failure to exchange
   these messages between the egress Label Switching Router (LSR) and
   the ingress LSR can lead to false negatives where the LSP under test
   is reported as "down" even though it is functioning correctly.





<span class="grey">Chen, et al.                 Standards Track                    [Page 3]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Limitations%20of%20Existing%20Mechanisms%20for%20Bidirectional%20LSPs"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Limitations of Existing Mechanisms for Bidirectional LSPs</span>

   With the existing LSP ping mechanisms, as defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>],
   operators have to enable LSP detection on each of the two ends of a
   bidirectional LSP independently.  This not only doubles the workload
   for the operators but may also bring additional difficulties when
   checking the backward direction of the LSP under the following
   condition:

      The LSR that the operator logged on to perform the checking
      operations might not have out-of-band connectivity to the LSR at
      the far end of the LSP.  That can mean it is not possible to check
      the return direction of a bidirectional LSP in a single operation
      -- the operator must log on to the LSR at the other end of the LSP
      to test the return direction.

   Associated bidirectional LSPs have the same issues as those listed
   for co-routed bidirectional LSPs.

   This document defines a mechanism to allow the operator to request
   that both directions of a bidirectional LSP be tested by a single LSP
   ping message exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Limitations%20of%20Existing%20Mechanisms%20for%20Handling%20Unreliable%20Return"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Limitations of Existing Mechanisms for Handling Unreliable Return</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/Paths"></a>      Paths</span>

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>] defines four Reply Modes:

   1. Do not reply
   2. Reply via an IPv4/IPv6 UDP packet
   3. Reply via an IPv4/IPv6 UDP packet with Router Alert
   4. Reply via application level control channel


   Obviously, the issue of the reliability of the return path for an
   echo reply message does not apply in the first of these cases.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>] states that the third mode may be used when the IP return
   path is deemed unreliable.  This mode of operation requires that all
   intermediate nodes support the Router Alert option and understand how
   to forward MPLS echo replies.  This is a rigorous requirement in
   deployed IP/MPLS networks, especially since the return path may be
   through legacy IP-only routers.








<span class="grey">Chen, et al.                 Standards Track                    [Page 4]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   In any case, the use of Reply Modes 2 or 3 cannot guarantee the
   delivery of echo responses through an IP network that is
   fundamentally unreliable.  The failure to deliver echo response
   messages can lead to false negatives, making it appear that the LSP
   has failed.

   Allowing the ingress LSR to control the path used for echo reply
   messages enables an operator to apply an extra level of deterministic
   process to the LSP ping test.  For example, when testing an LSP,
   Reply Mode 2 is used at the beginning but no echo reply is received.
   When failure of the return path is suspected, the operator can
   initiate another LSP ping with the Reply Mode defined in this
   document and specify a different return path that is deemed workable
   to complete the test.

   This document defines extensions to LSP ping that can be used to
   specify the return paths of the echo reply message in an echo request
   message.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Extensions"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Extensions</span>

   LSP ping, defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], is carried out by sending an echo
   request message.  It carries the Forwarding Equivalence Class (FEC)
   information of the LSP being tested.  The FEC information indicates
   which MPLS path is being verified along the same data path as other
   normal data packets belonging to the FEC.

   LSP ping [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] defines four Reply Modes that are used to direct
   the egress LSR in how to send back an echo reply.  This document
   defines a new Reply Mode, the "Reply via Specified Path" mode.  This
   new mode is used to direct the egress LSR of the tested LSP to send
   the echo reply message back along the path specified in the echo
   request message.

   In addition, two new TLVs, the "Reply Path (RP) TLV" and "Reply
   Traffic Class (TC) TLV" [<a href="rfc5462.html" title='"Multiprotocol Label Switching (MPLS) Label Stack Entry: "'>RFC5462</a>], are defined in this document.  The
   Reply Path TLV contains one or more nested sub-TLVs that can be used
   to carry the specified return path information to be used by the echo
   reply message.












<span class="grey">Chen, et al.                 Standards Track                    [Page 5]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Reply%20via%20Specified%20Path%20Mode"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Reply via Specified Path Mode</span>

   A new Reply Mode is defined to be carried in the Reply Mode field of
   the echo request message.

   The value of the Reply via Specified Path mode is 5 (This has been
   allocated by IANA using early allocation and is to be confirmed by
   IANA).

       Value    Meaning
       -----    -------
           5     Reply via Specified Path

   The Reply via Specified Path mode is used to request that the remote
   LSR receiving the echo request message sends back the echo reply
   message along the specified paths carried in the Reply Path TLV.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Reply%20Path%20%28RP%29%20TLV"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Reply Path (RP) TLV</span>

   The Reply Path (RP) TLV is an optional TLV within the LSP ping
   protocol.  However, if the Reply via Specified Path mode requested,
   as described in <a href="#section-4.1">Section 4.1</a>, the Reply Path (RP) TLV MUST be included
   in an echo request message, and its absence is treated as a malformed
   echo request, as described in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  Furthermore, if a Reply
   Path (RP) TLV is included in an echo request message, a Reply Path
   (RP) TLV MUST be included in the corresponding echo reply message
   sent by an implementation that is conformant to this specification.

   The Reply Path (RP) TLV carries the specified return path that the
   echo reply message is required to follow.  The format of Reply Path
   TLV is as follows:

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     Reply Path TLV Type       |          Length               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |    Reply Path return code     |           Flags               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                          Reply Path                           |
       ~                                                               ~
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                           Figure 1: Reply Path TLV






<span class="grey">Chen, et al.                 Standards Track                    [Page 6]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   Reply Path TLV Type:  It is 2 octets in length, and the type value is
      21.

   Length:  It is 2 octets in length.  It defines the length in octets
      of the Reply Path return code, Flags, and Reply Path fields.

   Reply Path return code:  The Reply Path return code field is 2 octets
      in length.  It is defined for the egress LSR of the forward LSP to
      report the results of Reply Path TLV processing and return path
      selection.  This field MUST be set to zero in a Reply Path TLV
      carried on an echo request message and MUST be ignored on receipt.
      This document defines the following Reply Path return codes for
      inclusion in a Reply Path TLV carried on an echo reply:

   Value         Meaning
   ------        ----------------------
   0x0000        Reserved, MUST NOT be used
   0x0001        Malformed Reply Path TLV was received
   0x0002        One or more of the sub-TLVs in the Reply Path TLV
                 were not understood
   0x0003        The echo reply was sent successfully using the
                 specified Reply Path
   0x0004        The specified Reply Path was not found, the echo
                 reply was sent via another LSP
   0x0005        The specified Reply Path was not found, the echo
                 reply was sent via pure IP forwarding (non-MPLS)
                 path
   0x0006-0xfffb Unassigned
   0xfffc-0xffff Experimental Use






















<span class="grey">Chen, et al.                 Standards Track                    [Page 7]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   Flags:  It is also 2 octets in length, it is used to notify the
      egress how to process the Reply Paths field when performing return
      path selection.  The Flags field is a bit vector and has following
      format:

           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
           |      MUST be zero         |A|B|
           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                    Figure 2:  Flags

         A (Alternative path): the egress LSR MUST select a non-default
         path as the return path.  This is very useful when reverse
         default path problems are suspected that can be confirmed when
         the echo reply is forced to follow a non-default return path.
         Here, the default path refers to the path that the egress LSR
         will use to send the echo reply when Reply Mode 2 or 3 is used.
         If A bit is set, there is no need to carry any specific reply
         path sub-TLVs, and when received, the sub-TLVs SHOULD be
         ignored.

         B (Bidirectional): the return path is required to follow the
         reverse direction of the tested bidirectional LSP.  If B bit is
         set, there is no need to carry any specific reply path sub-
         TLVs, and when received, the sub-TLVs SHOULD be ignored.

         The A flag and B flag MUST NOT both be set, otherwise, an echo
         reply with the RP return code set to "Malformed Reply Path TLV
         was received" MUST be returned.

   Reply Path:  It is used to describe the return path that an echo
      reply will be send along.  It is variable in length and can
      contain zero, one or more Target FEC sub-TLVs [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  In an
      echo request, it carries sub-TLVs that describe the specified path
      that the echo reply message is required to follow.  In an echo
      reply, the sub-TLVs describe the FEC Stack information of the
      return path (when the return path is an MPLS path) that the echo
      reply will be sent along.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Tunnel%20Sub-TLVs"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Tunnel Sub-TLVs</span>

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>] has already defined several Target FEC sub-TLVs, the Target
   FEC sub-TLVs provide a good way to identify a specific return path.
   The Reply Path TLV can carry any (existing and future defined) sub-
   TLV defined for use in the Target FEC Stack TLV to specify the return
   path.






<span class="grey">Chen, et al.                 Standards Track                    [Page 8]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   This document defines three new Target FEC sub-TLVs: IPv4 RSVP Tunnel
   sub-TLV, IPv6 RSVP Tunnel sub-TLV, and Static Tunnel sub-TLV.  One
   usage of these generic RSVP Tunnel sub-TLVs is when LSP ping is used
   to periodically verify the control plane against the data plane
   [<a href="rfc5884.html" title='"Bidirectional Forwarding Detection (BFD) for MPLS Label Switched Paths (LSPs)"'>RFC5884</a>], using a Tunnel other than a particular LSP can avoid the
   impact of an LSP identifier changing when Make-Before-Break (MBB) is
   deployed.  These sub-TLVs also can be used in the Reply Path TLV to
   allow the operator to specify a more generic tunnel FEC other than a
   particular LSP as the return path.

   No assignments of sub-TLVs are made directly for TLV Type 21, the
   sub-TLV space and assignments for TLV Type 21 will be the same as
   that for TLV Type 1.  Sub-types for TLV Type 1 and TLV Type 21 MUST
   be kept the same.  Any new sub-type added to TLV Type 1 MUST apply to
   the TLV Type 21 as well.

   With the Return Path TLV flags and the sub-TLVs defined for the
   Target FEC Stack TLV and in this document, it could provide the
   following options for return paths specifying:

   1.  a particular LSP as return path

          - use those sub-TLVs defined for the Target FEC Stack TLV

   2.  a more generic tunnel FEC as return path
          - use the IPv4/IPv6 RSVP and Static Tunnel sub-TLVs defined in
            Sections <a href="#section-4.3.1">Section 4.3.1</a>, <a href="#section-4.3.2">Section 4.3.2</a>, and <a href="#section-4.3.3">Section 4.3.3</a> of
            this document

   3.  the reverse path of the bidirectional LSP as return path

          - use B bit defined in <a href="#section-4.2">Section 4.2</a> of this document.

   4.  Force return path to non-default path

          - use A bit defined in <a href="#section-4.2">Section 4.2</a> of this document.















<span class="grey">Chen, et al.                 Standards Track                    [Page 9]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20IPv4%20RSVP%20Tunnel%20Sub-TLV"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  IPv4 RSVP Tunnel Sub-TLV</span>

   The format of the IPv4 RSVP Tunnel sub-TLV is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | IPv4 RSVP Tunnel sub-TLV Type |        Length                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 IPv4 tunnel end point address                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Flags            |     Tunnel ID                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Extended Tunnel ID                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   IPv4 tunnel sender address                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 3: IPv4 RSVP Tunnel Sub-TLV

   The IPv4 RSVP Tunnel sub-TLV is derived from the RSVP IPv4 FEC TLV
   that is defined in <a href="rfc4379.html#section-3.2.3">Section 3.2.3 of [RFC4379]</a>.  All fields have the
   same semantics as defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] except that the LSP-ID field
   is omitted and a new Flags field is defined.

   The IPv4 RSVP Tunnel sub-TLV Type field is 2 octets in length, and
   the recommended type value is 26.

   The Flags field is 2 octets in length, it is used to notify the
   egress LSR how to choose the return path.  The Flags field is a bit
   vector and has following format:

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         MUST be zero      |S|P|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Figure 4: Tunnel Flags

   P (Primary): the return path MUST be chosen from the LSPs that belong
   to the specified Tunnel and the LSP MUST be the primary LSP.

   S (Secondary): the return path MUST be chosen from the LSPs that
   belong to the specified Tunnel and the LSP MUST be the secondary LSP.
   Primary and secondary LSPs are defined in [<a href="rfc4872.html" title='"RSVP-TE Extensions in Support of End-to-End Generalized Multi- Protocol Label Switching (GMPLS) Recovery"'>RFC4872</a>].







<span class="grey">Chen, et al.                 Standards Track                   [Page 10]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   P bit and S bit MUST NOT both be set, otherwise, an echo reply with
   the RP return code set to "Malformed Reply Path TLV was received"
   SHOULD be returned.  If P bit and S bit are both not set, the return
   path could be any one of the LSPs from the same Tunnel.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20IPv6%20RSVP%20Tunnel%20Sub-TLV"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  IPv6 RSVP Tunnel Sub-TLV</span>

   The format of the IPv6 RSVP Tunnel sub-TLV is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | IPv6 RSVP Tunnel sub-TLV Type |        Length                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 IPv6 tunnel end point address                 |
   |                                                               |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Flags            |     Tunnel ID                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Extended Tunnel ID                      |
   |                                                               |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   IPv6 tunnel sender address                  |
   |                                                               |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 5: IPv6 RSVP Tunnel Sub-TLV

   The IPv6 RSVP Tunnel sub-TLV is derived from the RSVP IPv6 FEC TLV
   that is defined in <a href="rfc4379.html#section-3.2.4">Section 3.2.4 of [RFC4379]</a>.  All fields have the
   same semantics as defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] except that the LSP-ID field
   is omitted and a new Flags field is defined.

   The IPv6 RSVP Tunnel sub-TLV Type field is 2 octets in length, and
   the type value is 27.

   The Flags field is 2 octets in length and is identical to that
   described in <a href="#section-4.3.1">Section 4.3.1</a>.







<span class="grey">Chen, et al.                 Standards Track                   [Page 11]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.3.%20%20Static%20Tunnel%20Sub-TLV"></a><a class="selflink" href="#section-4.3.3" name="section-4.3.3">4.3.3</a>.  Static Tunnel Sub-TLV</span>

   The format of the Static RSVP Tunnel sub-TLV is as follows.  The
   value fields are taken from the definitions in [<a href="rfc6370.html" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>].

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Static Tunnel sub-TLV Type |        Length                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Global ID                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Node ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Destination Global ID                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Destination Node ID                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Source Tunnel Num       |     Destination Tunnel Num    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Flags            |     Must Be Zero              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                     Figure 6: Static Tunnel Sub-TLV

   The Flags field is 2 octets in length and is identical to that
   described in <a href="#section-4.3.1">Section 4.3.1</a>.

   The sub-TLV type value is 28.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Reply%20TC%20TLV"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Reply TC TLV</span>

   Reply TOS Byte TLV [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] is used by the originator of the echo
   request to request that an echo reply be sent with the IP header TOS
   byte set to the value specified in the TLV.  Similarly, in this
   document, a new TLV, Reply TC TLV, is defined and MAY be used by the
   originator of the echo request to request that an echo reply be sent
   with the TC bits of the return path LSP set to the value specified in
   this TLV.  The Reply TC TLV is not limited to the Reply Mode
   specified in this document (Reply via Specified Path) but may be used
   in all the other Reply Modes as well.  The format of Reply TC TLV is
   as follows:









<span class="grey">Chen, et al.                 Standards Track                   [Page 12]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Reply TC TLV type        |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | TC  |                    MUST be zero                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 7: Reply TC TLV

   The Reply TC TLV Type field is 2 octets in length, and the type value
   is 22.

   The Length field is 2 octets in length, the value of length field is
   fixed 4 octets.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Theory%20of%20Operation"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Theory of Operation</span>

   The procedures defined in this document currently only apply to
   "ping" mode.  The "traceroute" mode is out of scope for this
   document.

   In [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], the echo reply is used to report the LSP checking
   result to the LSP ping initiator.  This document defines a new Reply
   Mode and a new TLV (Reply Path TLV) that enable the LSP ping
   initiator to specify or constrain the return path of the echo reply.
   Similarly, the behavior of echo reply is extended to detect the
   requested return path by looking at a specified path FEC TLV.  This
   enables LSP ping to detect failures in both directions of a path with
   a single operation; of course, this cuts in half the operational
   steps required to verify the end-to-end bidirectional connectivity
   and integrity of an LSP.

   When the return path is an MPLS path, the echo reply MUST carry the
   FEC Stack information in a Reply Path TLV to test the return MPLS LSP
   path.  The destination IP address of the echo reply message MUST
   never be used in a forwarding decision.  To avoid this possibility
   the destination IP address of the echo reply message that is
   transmitted along the specified return path MUST be set to numbers
   from the range 127/8 for IPv4 or 0:0:0:0:0:FFFF:127.0.0.0/104 for
   IPv6, and the IP Time to Live (TTL) MUST be set 1, and the TTL in the
   outermost label MUST be set to 255.

   When the return path is a pure IP forwarding path, the procedures
   defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] (the destination IP address is copied from the
   source IP address) apply unchanged.





<span class="grey">Chen, et al.                 Standards Track                   [Page 13]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Sending%20an%20Echo%20Request"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Sending an Echo Request</span>

   When sending an echo request, in addition to the rules and procedures
   defined in <a href="rfc4379.html#section-4.3">Section 4.3 of [RFC4379]</a>, the Reply Mode of the echo
   request MUST be set to "Reply via Specified Path", and a Reply Path
   TLV MUST be carried in the echo request message correspondingly.  The
   Reply Path TLV includes one or several reply path sub-TLV(s) to
   identify the return path(s) the egress LSR should use for its reply.

   For a bidirectional LSP, since the ingress LSR and egress LSR of a
   bidirectional LSP are aware of the relationship between the forward
   and backward direction LSPs, only the B bit SHOULD be set in the
   Reply Path TLV.  If the operator wants the echo reply to be sent
   along a path other than the reverse direction of the bidirectional
   LSP, the A bit SHOULD be set or another FEC sub-TLV SHOULD be carried
   in the Reply Path TLV instead, and the B bit MUST be clear.

   In some cases, operators may want to treat two unidirectional LSPs
   (one for each direction) as a pair.  There may not be any binding
   relationship between the two LSPs.  Using the mechanism defined in
   this document, operators can run LSP ping one time from one end to
   complete the failure detection on both unidirectional LSPs.  To
   accomplish this, the echo request message MUST carry (in the Reply
   Path TLV) a FEC sub-TLV that belongs to the backward LSP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Receiving%20an%20Echo%20Request"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Receiving an Echo Request</span>

   "Ping" mode processing, as defined in <a href="rfc4379.html#section-4.4">Section 4.4 of [RFC4379]</a>,
   applies in this document.  In addition, when an echo request is
   received, if the egress LSR does not know the Reply Mode defined in
   this document, an echo reply with the return code set to "Malformed
   echo request received" and the Subcode set to zero will be send back
   to the ingress LSR according to the rules of [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  If the
   egress LSR knows the Reply Mode, according to the Reply Path TLV, it
   SHOULD find and select the desired return path.  If there is a
   matched path, an echo reply with a Reply Path TLV that identifies the
   return path SHOULD be sent back to the ingress LSR, the Reply Path
   return code SHOULD be set to "The echo reply was sent successfully
   using the specified Reply Path".  If there is no such path, an echo
   reply with the Reply Path TLV SHOULD be sent back to the ingress LSR,
   the Reply Path return code SHOULD be set to the relevant code
   (defined in <a href="#section-4.2">Section 4.2</a>) for the real situation to reflect the result
   of Reply Path TLV processing and return path selection.  For example,
   if the specified LSP is not found, the egress then chooses another
   LSP as the return path to send the echo reply, the Reply Path return
   code SHOULD be set to "The specified reply path was not found, the
   echo reply was sent via another LSP", and if the egress chooses an IP
   path to send the echo reply, the Reply Path return code SHOULD be set



<span class="grey">Chen, et al.                 Standards Track                   [Page 14]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   to "The specified Reply Path was not found, the echo reply was sent
   via pure IP forwarding (non-MPLS) path".  If there is an unknown sub-
   TLV in the received Reply Path TLV, the Reply Path return code SHOULD
   be set to "One or more of the sub-TLVs in the Reply Path TLV were not
   understood".

   If the A bit of the Reply Path TLV in a received echo request message
   is set, the egress LSR SHOULD send the echo reply along a non-default
   return path.

   If the B bit of the Reply Path TLV in a received echo request message
   is set, the egress LSR SHOULD send the echo reply along the reverse
   direction of the bidirectional LSP.

   In addition, the FEC validate results of the forward path LSP SHOULD
   NOT affect the egress LSR continue to test return path LSP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Sending%20an%20Echo%20Reply"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Sending an Echo Reply</span>

   As described in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], the echo reply message is a UDP packet,
   and it MUST be sent only in response to an MPLS echo request.  The
   source IP address is a valid IP address of the replier, the source
   UDP port is the well-know UDP port for LSP ping.

   When the return path is an MPLS LSP, the destination IP address of
   the echo reply message is copied from the destination IP address of
   the echo request, and the destination UDP port is copied from the
   source UDP port of the echo request.  The IP TTL MUST be set to 1,
   the TTL in the outermost label MUST be set to 255.

   When the return path is a pure IP forwarding path, the same as
   defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], the destination IP address and UDP port are
   copied from the source IP address and source UDP port of the echo
   request.

   When sending the echo reply, a Reply Path TLV that identifies the
   return path MUST be carried, the Reply Path return code SHOULD be set
   to relevant code that reflects results about how the egress processes
   the Reply Path TLV in a previous received echo request message and
   return path selection.  By carrying the Reply Path TLV in an echo
   reply, it gives the ingress LSR enough information about the reverse
   direction of the tested path to verify the consistency of the data
   plane against control plane.  Thus, a single LSP ping could achieve
   both directions of a path test.  If the return path is pure IP path,
   no sub-TLVs are carried in the Reply Path TLV.






<span class="grey">Chen, et al.                 Standards Track                   [Page 15]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20Receiving%20an%20Echo%20Reply"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  Receiving an Echo Reply</span>

   The rules and process defined in <a href="rfc4379.html#section-4.6">Section 4.6 of [RFC4379]</a> apply here.
   When an echo reply is received, if the Reply Mode is "Reply via
   Specified Path" and the Reply Path return code is "The echo reply was
   sent successfully using the specified Reply Path", and if the return
   path is an MPLS LSP.  The ingress LSR MUST perform FEC validation
   (based on the FEC Stack information of the return path carried in the
   Reply Path TLV) as an egress LSR does when receiving an echo request,
   the FEC validation process (relevant to "ping" mode) defined in
   <a href="rfc4379.html#section-4.4.1">Section 4.4.1 of [RFC4379]</a> applies here.

   When an echo reply is received with return code set to "Malformed
   echo request received" and the Subcode set to zero.  It is possible
   that the egress LSR may not know the "Reply via Specified Path" Reply
   Mode, the operator may choose to re-perform another LSP ping by using
   one of the four Reply Modes defined [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].

   On receipt of an echo reply with Reply Path return code in the Reply
   Path TLV set to "The specified reply path was not found, ...", it
   means that the egress LSR could not find a matched return path as
   specified.  Operators may choose to specify another LSP as the return
   path or use other methods to detect the path further.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.5.%20%20Non-IP%20Encapsulation%20for%20MPLS-TP%20LSPs"></a><a class="selflink" href="#section-5.5" name="section-5.5">5.5</a>.  Non-IP Encapsulation for MPLS-TP LSPs</span>

   In some MPLS-TP deployment scenarios, IP addressing might not be
   available or the use of some form of non-IP encapsulation might be
   preferred.  In such scenarios, the Non-IP encapsulation defined in
   [<a href="rfc6426.html" title='"MPLS On-Demand Connectivity Verification and Route Tracing"'>RFC6426</a>] applies here.  The LSP Ping Reply Mode in the echo request
   and echo reply is set to 5.  The return path of the echo reply is as
   specified in the Reply Path TLV.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   Security considerations discussed in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] apply to this
   document.

   In addition, the extensions defined in this document may be used for
   potential "proxying" attacks.  For example, an echo request initiator
   may specify a return path that has a destination different from that
   of the initiator.  But normally, such attacks will not happen in an
   MPLS domain where the initiators and receivers belong to the same
   domain.  Even this, in order to prevent using the extension defined
   in this document for proxying any possible attacks, the return path
   LSP should have destination to the same node where the forward path
   is from.  The receiver may drop the echo request when it cannot
   determine whether the return path LSP has the destination to the



<span class="grey">Chen, et al.                 Standards Track                   [Page 16]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


   initiator.  That means, when sending echo request, the initiator
   should choose a proper source address according the specified return
   path LSP to help the receiver to make the decision.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20TLVs"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  TLVs</span>

   IANA has assigned the value 21 for the Reply Path TLV and assigned
   the value 22 for Reply TC TLV from the "Multiprotocol Label Switching
   Architecture (MPLS) Label Switched Paths (LSPs) Ping Parameters"
   registry, "TLVs" subregistry.

   Value   Meaning                           Reference
   -----   -------                           ---------
   21      Reply Path TLV                    this document (<a href="#section-4.2">Section 4.2</a>)
   22      Reply TC TLV                      this document (<a href="#section-4.4">Section 4.4</a>)

   The sub-TLV space and assignments for the Reply Path TLV will be the
   same as that for the Target FEC Stack TLV.  Sub-types for the Target
   FEC Stack TLV and the Reply Path TLV MUST be kept the same.  Any new
   sub-type added to the Target FEC Stack TLV MUST apply to the Reply
   Path TLV as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20New%20Target%20FEC%20Stack%20Sub-TLVs"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  New Target FEC Stack Sub-TLVs</span>

   IANA has assigned three new sub-TLV types from the "Multiprotocol
   Label Switching Architecture (MPLS) Label Switched Paths (LSPs) Ping
   Parameters - TLVs" registry, "Sub-TLVs for TLV Types 1, 16, and 21"
   subregistry.

   Sub-Type      Sub-TLV Name             Reference
   -------       -----------             ---------
   26          IPv4 RSVP Tunnel        this document (<a href="#section-4.3.1">Section 4.3.1</a>)
   27          IPv6 RSVP Tunnel        this document (<a href="#section-4.3.2">Section 4.3.2</a>)
   28          Static Tunnel           this document (<a href="#section-4.3.3">Section 4.3.3</a>)


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20New%20Reply%20Mode"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  New Reply Mode</span>

   IANA has allocated (5 - Reply via Specified Path) from the "Multi-
   Protocol Label Switching (MPLS) Label Switched Paths (LSPs) Ping
   Parameters" registry, the "Reply Modes" subregistry.

   Value    Meaning                      Reference
   -----    -------                      ----------
   5        Reply via Specified Path     this document (<a href="#section-4.1">Section 4.1</a>)




<span class="grey">Chen, et al.                 Standards Track                   [Page 17]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.4.%20%20Reply%20Path%20Return%20Code"></a><a class="selflink" href="#section-7.4" name="section-7.4">7.4</a>.  Reply Path Return Code</span>

   IANA has created a new subregistry for the "Multi-Protocol Label
   Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters" for
   Reply Path return codes.

   This document (<a href="#section-4.2">Section 4.2</a>) defines the following return codes:

   Value         Meaning
   ------        ----------------------
   0x0000        No return code
   0x0001        Malformed Reply Path TLV was received
   0x0002        One or more of the sub-TLVs in the Reply Path TLV
                 were not understood
   0x0003        The echo reply was sent successfully using the
                 specified Reply Path
   0x0004        The specified Reply Path was not found, the echo
                 reply was sent via another LSP
   0x0005        The specified Reply Path was not found, the echo
                 reply was sent via pure IP forwarding (non-MPLS)
                 path
   0x0006-0xfffb Unassigned
   0xfffc-0xffff Reserved for Experimental Use

   The range of 0x0006-0xfffb is not allocated and reserved for future
   extensions and is allocated via Standard Action; the range of 0xfffc-
   0xffff is for Experimental Use.
























<span class="grey">Chen, et al.                 Standards Track                   [Page 18]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Contributors"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Contributors</span>

   The following individuals also contributed to this document:

   Ehud Doron
   Orckit-Corrigent
   EMail: ehudd@orckit.com

   Ronen Solomon
   Orckit-Corrigent
   EMail: RonenS@orckit.com

   Ville Hallivuori
   Tellabs
   Sinimaentie 6 C
   FI-02630 Espoo, Finland
   EMail: ville.hallivuori@tellabs.com

   Xinchun Guo
   EMail: guoxinchun@huawei.com

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Acknowledgements"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Acknowledgements</span>

   The authors would like to thank Adrian Farrel, Peter Ashwood-Smith,
   Sriganesh Kini, Gregory Mirsky, Eric Gray, Loa Andersson, Carlos
   Pignataro, and Tom Petch for their reviews, suggestions, and
   comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]  Kompella, K. and G. Swallow, "Detecting Multi-Protocol
              Label Switched (MPLS) Data Plane Failures", <a href="rfc4379.html">RFC 4379</a>,
              February 2006.

   [<a id="ref-RFC6370" name="ref-RFC6370">RFC6370</a>]  Bocci, M., Swallow, G., and E. Gray, "MPLS Transport
              Profile (MPLS-TP) Identifiers", <a href="rfc6370.html">RFC 6370</a>, September 2011.










<span class="grey">Chen, et al.                 Standards Track                   [Page 19]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-RFC3945" name="ref-RFC3945">RFC3945</a>]  Mannie, E., "Generalized Multi-Protocol Label Switching
              (GMPLS) Architecture", <a href="rfc3945.html">RFC 3945</a>, October 2004.

   [<a id="ref-RFC4872" name="ref-RFC4872">RFC4872</a>]  Lang, J., Rekhter, Y., and D. Papadimitriou, "RSVP-TE
              Extensions in Support of End-to-End Generalized Multi-
              Protocol Label Switching (GMPLS) Recovery", <a href="rfc4872.html">RFC 4872</a>, May
              2007.

   [<a id="ref-RFC5462" name="ref-RFC5462">RFC5462</a>]  Andersson, L. and R. Asati, "Multiprotocol Label Switching
              (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic
              Class" Field", <a href="rfc5462.html">RFC 5462</a>, February 2009.

   [<a id="ref-RFC5654" name="ref-RFC5654">RFC5654</a>]  Niven-Jenkins, B., Brungard, D., Betts, M., Sprecher, N.,
              and S. Ueno, "Requirements of an MPLS Transport Profile",
              <a href="rfc5654.html">RFC 5654</a>, September 2009.

   [<a id="ref-RFC5884" name="ref-RFC5884">RFC5884</a>]  Aggarwal, R., Kompella, K., Nadeau, T., and G. Swallow,
              "Bidirectional Forwarding Detection (BFD) for MPLS Label
              Switched Paths (LSPs)", <a href="rfc5884.html">RFC 5884</a>, June 2010.

   [<a id="ref-RFC6426" name="ref-RFC6426">RFC6426</a>]  Gray, E., Bahadur, N., Boutros, S., and R. Aggarwal, "MPLS
              On-Demand Connectivity Verification and Route Tracing",
              <a href="rfc6426.html">RFC 6426</a>, November 2011.


























<span class="grey">Chen, et al.                 Standards Track                   [Page 20]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7110.html">RFC 7110</a>             Return Path Specified LSP Ping         January 2014</span>


Authors' Addresses

   Mach(Guoyi) Chen
   Huawei Technologies Co., Ltd
   Q14 Huawei Campus, No. 156 Beiqing Road, Hai-dian District
   Beijing  100095
   China

   EMail: mach.chen@huawei.com


   Wei Cao
   Huawei Technologies Co., Ltd
   Q14 Huawei Campus, No. 156 Beiqing Road, Hai-dian District
   Beijing  100095
   China

   EMail: wayne.caowei@huawei.com


   So Ning
   Tata Communications

   EMail: ning.so@tatacommunications.com


   Frederic Jounay
   Orange CH
   4 rue caudray 1020 Renens
   Switzerland

   EMail: frederic.jounay@orange.ch


   Simon Delord

   EMail: Simon.delord@team.telstra.com














Chen, et al.                 Standards Track                   [Page 21]

</pre><br/>
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.107, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>


<meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

</body><!-- Mirrored from tools.ietf.org/html/rfc7110 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:31:48 GMT --><!-- Added by HTTrack --></html>