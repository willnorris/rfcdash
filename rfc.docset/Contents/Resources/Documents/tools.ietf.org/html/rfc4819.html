<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.107" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Relation.Replaces" content="draft-galb-secsh-publickey-subsystem" />
<meta name="DC.Identifier" content="urn:ietf:rfc:4819" />
<meta name="DC.Date.Issued" content="March, 2007" />
<meta name="DC.Creator" content="Dyke, Jeff P. Van" />
<meta name="DC.Creator" content="Galbraith, Joseph" />
<meta name="DC.Creator" content="Bright, Jon" />
<meta name="DC.Description.Abstract" content="Secure Shell defines a user authentication mechanism that is based on\npublic keys, but does not define any mechanism for key distribution.\nNo common key management solution exists in current implementations.\nThis document describes a protocol that can be used to configure\npublic keys in an implementation-independent fashion, allowing client\nsoftware to take on the burden of this configuration.  The Public Key\nSubsystem provides a server-independent mechanism for clients to add\npublic keys, remove public keys, and list the current public keys\nknown by the server. Rights to manage public keys are specific and\nlimited to the authenticated user.  A public key may also be\nassociated with various restrictions, including a mandatory command or\nsubsystem. [STANDARDS-TRACK]" />
<meta name="DC.Title" content="Secure Shell Public Key Subsystem" />

    <link rel="icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 4819 - Secure Shell Public Key Subsystem</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgblue"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc4819.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc4819" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-secsh-publickey-subsystem" title="draft-ietf-secsh-publickey-subsystem">draft-ietf-secsh-...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4819" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc4819" title="Side-by-side diff">Diff2</a>]                 </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Network Working Group                                       J. Galbraith
Request for Comments: 4819                                   J. Van Dyke
Category: Standards Track                               VanDyke Software
                                                               J. Bright
                                                          Silicon Circus
                                                              March 2007


                   <span class="h1">Secure Shell Public Key Subsystem</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   Secure Shell defines a user authentication mechanism that is based on
   public keys, but does not define any mechanism for key distribution.
   No common key management solution exists in current implementations.
   This document describes a protocol that can be used to configure
   public keys in an implementation-independent fashion, allowing client
   software to take on the burden of this configuration.

   The Public Key Subsystem provides a server-independent mechanism for
   clients to add public keys, remove public keys, and list the current
   public keys known by the server.  Rights to manage public keys are
   specific and limited to the authenticated user.

   A public key may also be associated with various restrictions,
   including a mandatory command or subsystem.













<span class="grey">Galbraith, et al.           Standards Track                     [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Public Key Subsystem Overview  . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-3.1">3.1</a>.  Opening the Public Key Subsystem . . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-3.2">3.2</a>.  Requests and Responses . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-3.3">3.3</a>.  The Status Message . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-3.3.1">3.3.1</a>.  Status Codes . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-3.4">3.4</a>.  The Version Packet . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Public Key Subsystem Operations  . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-4.1">4.1</a>.  Adding a Public Key  . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-4.2">4.2</a>.  Removing a Public Key  . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-4.3">4.3</a>.  Listing Public Keys  . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-4.4">4.4</a>.  Listing Server Capabilities  . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-5">5</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-6.1">6.1</a>.  Registrations  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-6.2">6.2</a>.  Names  . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-6.2.1">6.2.1</a>.  Conventions for Names  . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-6.2.2">6.2.2</a>.  Future Assignments of Names  . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-6.3">6.3</a>.  Public Key Subsystem Request Names . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-6.4">6.4</a>.  Public Key Subsystem Response Names  . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-6.5">6.5</a>.  Public Key Subsystem Attribute Names . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-6.6">6.6</a>.  Public Key Subsystem Status Codes  . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-6.6.1">6.6.1</a>.  Conventions  . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-6.6.2">6.6.2</a>.  Initial Assignments  . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-6.6.3">6.6.3</a>.  Future Assignments . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-7">7</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
     <a href="#section-7.1">7.1</a>.  Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
     <a href="#section-7.2">7.2</a>.  Informative References . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-8">8</a>.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>



















<span class="grey">Galbraith, et al.           Standards Track                     [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   Secure Shell (SSH) is a protocol for secure remote login and other
   secure network services over an insecure network.  Secure Shell
   defines a user authentication mechanism that is based on public keys,
   but does not define any mechanism for key distribution.  Common
   practice is to authenticate once with password authentication and
   transfer the public key to the server.  However, to date no two
   implementations use the same mechanism to configure a public key for
   use.

   This document describes a subsystem that can be used to configure
   public keys in an implementation-independent fashion.  This approach
   allows client software to take on the burden of this configuration.
   The Public Key Subsystem protocol is designed for extreme simplicity
   in implementation.  It is not intended as a Public Key Infrastructure
   for X.509 Certificates (PKIX) replacement.

   The Secure Shell Public Key Subsystem has been designed to run on top
   of the Secure Shell transport layer [<a href="#ref-2" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">2</a>] and user authentication
   protocols [<a href="#ref-3" title="&quot;The Secure Shell (SSH) Authentication Protocol&quot;">3</a>].  It provides a simple mechanism for the client to
   manage public keys on the server.

   This document should be read only after reading the Secure Shell
   architecture [<a href="#ref-1" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">1</a>] and Secure Shell connection [<a href="#ref-4" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">4</a>] documents.

   This protocol is intended to be used from the Secure Shell Connection
   Protocol [<a href="#ref-4" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">4</a>] as a subsystem, as described in the section "Starting a
   Shell or a Command".  The subsystem name used with this protocol is
   "publickey".

   This protocol requires that the user be able to authenticate in some
   fashion before it can be used.  If password authentication is used,
   servers SHOULD provide a configuration option to disable the use of
   password authentication after the first public key is added.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="#ref-5" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">5</a>].

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Public Key Subsystem Overview</span>

   The Public Key Subsystem provides a server-independent mechanism for
   clients to add public keys, remove public keys, and list the current
   public keys known by the server.  The subsystem name is "publickey".




<span class="grey">Galbraith, et al.           Standards Track                     [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   The public keys added, removed, and listed using this protocol are
   specific and limited to those of the authenticated user.

   The operations to add, remove, and list the authenticated user's
   public keys are performed as request packets sent to the server.  The
   server sends response packets that indicate success or failure as
   well as provide specific response data.

   The format of public key blobs are detailed in <a href="#section-6.6">Section 6.6</a>, "Public
   Key Algorithms" of the SSH Transport Protocol document [<a href="#ref-2" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">2</a>].

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Opening the Public Key Subsystem</span>

   The Public Key Subsystem is started by a client sending an
   SSH_MSG_CHANNEL_REQUEST over an existing session's channel.

   The details of how a session is opened are described in the SSH
   Connection Protocol document [<a href="#ref-4" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">4</a>] in the section "Opening a Session".

   To open the Public Key Subsystem, the client sends:

        byte      SSH_MSG_CHANNEL_REQUEST
        uint32    recipient channel
        string    "subsystem"
        boolean   want reply
        string    "publickey"

   Client implementations SHOULD reject this request; it is normally
   sent only by the client.

   If want reply is TRUE, the server MUST respond with
   SSH_MSG_CHANNEL_SUCCESS if the Public Key Subsystem was successfully
   started, or SSH_MSG_CHANNEL_FAILURE if the server failed to start or
   does not support the Public Key Subsystem.

   The server SHOULD respond with SSH_MSG_CHANNEL_FAILURE if the user is
   not allowed access to the Public Key Subsystem (for example, because
   the user authenticated with a restricted public key).

   It is RECOMMENDED that clients request and check the reply for this
   request.










<span class="grey">Galbraith, et al.           Standards Track                     [Page 4]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>.  Requests and Responses</span>

   All Public Key Subsystem requests and responses are sent in the
   following form:

        uint32    length
        string    name
        ... request/response specific data follows

   The length field describes the length of the name field and of the
   request/response-specific data, but does not include the length of
   the length field itself.  The client MUST receive acknowledgement of
   each request prior to sending a new request.

   The version packet, as well as all requests and responses described
   in <a href="#section-4">Section 4</a>, are a description of the 'name' field and the data part
   of the packet.

<span class="h3"><a class="selflink" name="section-3.3" href="#section-3.3">3.3</a>.  The Status Message</span>

   A request is acknowledged by sending a status packet.  If there is
   data in response to the request, the status packet is sent after all
   data has been sent.

        string    "status"
        uint32    status code
        string    description [<a href="#ref-7" title="&quot;UTF-8, a transformation format of ISO 10646&quot;">7</a>]
        string    language tag [<a href="#ref-6" title="&quot;Tags for Identifying Languages&quot;">6</a>]

   A status message MUST be sent for any unrecognized packets, and the
   request SHOULD NOT close the subsystem.

<span class="h4"><a class="selflink" name="section-3.3.1" href="#section-3.3.1">3.3.1</a>.  Status Codes</span>

   The status code gives the status in a more machine-readable format
   (suitable for localization), and can have the following values:

        SSH_PUBLICKEY_SUCCESS                      0
        SSH_PUBLICKEY_ACCESS_DENIED                1
        SSH_PUBLICKEY_STORAGE_EXCEEDED             2
        SSH_PUBLICKEY_VERSION_NOT_SUPPORTED        3
        SSH_PUBLICKEY_KEY_NOT_FOUND                4
        SSH_PUBLICKEY_KEY_NOT_SUPPORTED            5
        SSH_PUBLICKEY_KEY_ALREADY_PRESENT          6
        SSH_PUBLICKEY_GENERAL_FAILURE              7
        SSH_PUBLICKEY_REQUEST_NOT_SUPPORTED        8
        SSH_PUBLICKEY_ATTRIBUTE_NOT_SUPPORTED      9




<span class="grey">Galbraith, et al.           Standards Track                     [Page 5]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   If a request completed successfully, the server MUST send the status
   code SSH_PUBLICKEY_SUCCESS.  The meaning of the failure codes is as
   implied by their names.

<span class="h3"><a class="selflink" name="section-3.4" href="#section-3.4">3.4</a>.  The Version Packet</span>

   Both sides MUST start a connection by sending a version packet that
   indicates the version of the protocol they are using.

        string "version"
        uint32 protocol-version-number

   This document describes version 2 of the protocol.  Version 1 was
   used by an early draft of this document.  The version number was
   incremented after changes in the handling of status packets.

   Both sides send the highest version that they implement.  The lower
   of the version numbers is the version of the protocol to use.  If
   either side can't support the lower version, it should close the
   subsystem and notify the other side by sending an
   SSH_MSG_CHANNEL_CLOSE message.  Before closing the subsystem, a
   status message with the status SSH_PUBLICKEY_VERSION_NOT_SUPPORTED
   SHOULD be sent.  Note that, normally, status messages are only sent
   by the server (in response to requests from the client).  This is the
   only occasion on which the client sends a status message.

   Both sides MUST wait to receive this version before continuing.  The
   "version" packet MUST NOT be sent again after this initial exchange.
   The SSH_PUBLICKEY_VERSION_NOT_SUPPORTED status code must not be sent
   in response to any other request.

   Implementations MAY use the first 15 bytes of the version packet as a
   "magic cookie" to avoid processing spurious output from the user's
   shell (as described in Section 6.5 of [<a href="#ref-4" title="&quot;The Secure Shell (SSH) Connection Protocol&quot;">4</a>]).  These bytes will always
   be:

   0x00 0x00 0x00 0x0F 0x00 0x00 0x00 0x07 0x76 0x65 0x72 0x73 0x69 0x6F
   0x6E













<span class="grey">Galbraith, et al.           Standards Track                     [Page 6]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Public Key Subsystem Operations</span>

   The Public Key Subsystem currently defines four operations: add,
   remove, list, and listattributes.

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  Adding a Public Key</span>

   If the client wishes to add a public key, the client sends:

        string    "add"
        string    public key algorithm name
        string    public key blob
        boolean   overwrite
        uint32    attribute-count
         string    attrib-name
         string    attrib-value
         bool      critical
        repeated attribute-count times

   The server MUST attempt to store the public key for the user in the
   appropriate location so the public key can be used for subsequent
   public key authentications.  If the overwrite field is false and the
   specified key already exists, the server MUST return
   SSH_PUBLICKEY_KEY_ALREADY_PRESENT.  If the server returns this, the
   client SHOULD provide an option to the user to overwrite the key.  If
   the overwrite field is true and the specified key already exists, but
   cannot be overwritten, the server MUST return
   SSH_PUBLICKEY_ACCESS_DENIED.

   Attribute names are defined following the same scheme laid out for
   algorithm names in [<a href="#ref-1" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">1</a>].  If the server does not implement a critical
   attribute, it MUST fail the add, with the status code
   SSH_PUBLICKEY_ATTRIBUTE_NOT_SUPPORTED.  For the purposes of a
   critical attribute, mere storage of the attribute is not sufficient
   -- rather, the server must understand and implement the intent of the
   attribute.

   The following attributes are currently defined:

   "comment"

   The value of the comment attribute contains user-specified text about
   the public key.  The server SHOULD make every effort to preserve this
   value and return it with the key during any subsequent list
   operation.  The server MUST NOT attempt to interpret or act upon the
   content of the comment field in any way.  The comment attribute must
   be specified in UTF-8 format [<a href="#ref-7" title="&quot;UTF-8, a transformation format of ISO 10646&quot;">7</a>].




<span class="grey">Galbraith, et al.           Standards Track                     [Page 7]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   The comment field is useful so the user can identify the key without
   resorting to comparing its fingerprint.  This attribute SHOULD NOT be
   critical.

   "comment-language"

   If this attribute is specified, it MUST immediately follow a
   "comment" attribute and specify the language for that attribute [<a href="#ref-6" title="&quot;Tags for Identifying Languages&quot;">6</a>].
   The client MAY specify more than one comment if it additionally
   specifies a different language for each of those comments.  The
   server SHOULD attempt to store each comment with its language
   attribute.  This attribute SHOULD NOT be critical.

   "command-override"

   "command-override" specifies a command to be executed when this key
   is in use.  The command should be executed by the server when it
   receives an "exec" or "shell" request from the client, in place of
   the command or shell which would otherwise have been executed as a
   result of that request.  If the command string is empty, both "exec"
   and "shell" requests should be denied.  If no "command-override"
   attribute is specified, all "exec" and "shell" requests should be
   permitted (as long as they satisfy other security or authorization
   checks the server may perform).  This attribute SHOULD be critical.

   "subsystem"

   "subsystem" specifies a comma-separated list of subsystems that may
   be started (using a "subsystem" request) when this key is in use.
   This attribute SHOULD be critical.  If the value is empty, no
   subsystems may be started.  If the "subsystem" attribute is not
   specified, no restrictions are placed on which subsystems may be
   started when authenticated using this key.

   "x11"

   "x11" specifies that X11 forwarding may not be performed when this
   key is in use.  The attribute-value field SHOULD be empty for this
   attribute.  This attribute SHOULD be critical.

   "shell"

   "shell" specifies that session channel "shell" requests should be
   denied when this key is in use.  The attribute-value field SHOULD be
   empty for this attribute.  This attribute SHOULD be critical.






<span class="grey">Galbraith, et al.           Standards Track                     [Page 8]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   "exec"

   "exec" specifies that session channel "exec" requests should be
   denied when this key is in use.  The attribute-value field SHOULD be
   empty for this attribute.  This attribute SHOULD be critical.

   "agent"

   "agent" specifies that session channel "auth-agent-req" requests
   should be denied when this key is in use.  The attribute-value field
   SHOULD be empty for this attribute.  This attribute SHOULD be
   critical.

   "env"

   "env" specifies that session channel "env" requests should be denied
   when this key is in use.  The attribute-value field SHOULD be empty
   for this attribute.  This attribute SHOULD be critical.

   "from"

   "from" specifies a comma-separated list of hosts from which the key
   may be used.  If a host not in this list attempts to use this key for
   authorization purposes, the authorization attempt MUST be denied.
   The server SHOULD make a log entry regarding this.  The server MAY
   provide a method for administrators to disallow the appearance of a
   host in this list.  The server should use whatever method is
   appropriate for its platform to identify the host -- e.g., for IP-
   based networks, checking the IP address or performing a reverse DNS
   lookup.  For IP-based networks, it is anticipated that each element
   of the "from" parameter will take the form of a specific IP address
   or hostname.

   "port-forward"

   "port-forward" specifies that no "direct-tcpip" requests should be
   accepted, except those to hosts specified in the comma-separated list
   supplied as a value to this attribute.  If the value of this
   attribute is empty, all "direct-tcpip" requests should be refused
   when using this key.  This attribute SHOULD be critical.

   "reverse-forward"

   "reverse-forward" specifies that no "tcpip-forward" requests should
   be accepted, except for the port numbers in the comma-separated list
   supplied as a value to this attribute.  If the value of this
   attribute is empty, all "tcpip-forward" requests should be refused
   when using this key.  This attribute SHOULD be critical.



<span class="grey">Galbraith, et al.           Standards Track                     [Page 9]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   In addition to the attributes specified by the client, the server MAY
   provide a method for administrators to enforce certain attributes
   compulsorily.

<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  Removing a Public Key</span>

   If the client wishes to remove a public key, the client sends:

        string    "remove"
        string    public key algorithm name
        string    public key blob

   The server MUST attempt to remove the public key for the user from
   the appropriate location, so that the public key cannot be used for
   subsequent authentications.

<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  Listing Public Keys</span>

   If the client wishes to list the known public keys, the client sends:

        string    "list"

   The server will respond with zero or more of the following responses:

        string    "publickey"
        string    public key algorithm name
        string    public key blob
        uint32    attribute-count
         string    attrib-name
         string    attrib-value
        repeated attribute-count times

   There is no requirement that the responses be in any particular
   order.  Whilst some server implementations may send the responses in
   some order, client implementations should not rely on responses being
   in any order.

   Following the last "publickey" response, a status packet MUST be
   sent.

   Implementations SHOULD support this request.

<span class="h3"><a class="selflink" name="section-4.4" href="#section-4.4">4.4</a>.  Listing Server Capabilities</span>

   If the client wishes to know which key attributes the server
   supports, it sends:

        string    "listattributes"



<span class="grey">Galbraith, et al.           Standards Track                    [Page 10]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


   The server will respond with zero or more of the following responses:

        string    "attribute"
        string    attribute name
        boolean   compulsory

   The "compulsory" field indicates whether this attribute will be
   compulsorily applied to any added keys (irrespective of whether the
   attribute has been specified by the client) due to administrative
   settings on the server.  If the server does not support
   administrative settings of this nature, it MUST return false in the
   compulsory field.  An example of use of the "compulsory" attribute
   would be a server with a configuration file specifying that the user
   is not permitted shell access.  Given this, the server would return
   the "shell" attribute, with "compulsory" marked true.  Whatever
   attributes the user subsequently asked the server to apply to their
   key, the server would also apply the "shell" attribute, rendering it
   impossible for the user to use a shell.

   Following the last "attribute" response, a status packet MUST be
   sent.

   An implementation MAY choose not to support this request.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Security Considerations</span>

   This protocol assumes that it is run over a secure channel and that
   the endpoints of the channel have been authenticated.  Thus, this
   protocol assumes that it is externally protected from network-level
   attacks.

   This protocol provides a mechanism that allows client authentication
   data to be uploaded and manipulated.  It is the responsibility of the
   server implementation to enforce any access controls that may be
   required to limit the access allowed for any particular user (the
   user being authenticated externally to this protocol, typically using
   the SSH User Authentication Protocol [<a href="#ref-3" title="&quot;The Secure Shell (SSH) Authentication Protocol&quot;">3</a>]).  In particular, it is
   possible for users to overwrite an existing key on the server with
   this protocol, whilst at the same time specifying fewer restrictions
   for the new key than were previously present.  Servers should take
   care that when doing this, clients are not able to override presets
   from the server's administrator.

   This protocol requires the client to assume that the server will
   correctly implement and observe attributes applied to keys.
   Implementation errors in the server could cause clients to authorize
   keys for access they were not intended to have, or to apply fewer
   restrictions than were intended.



<span class="grey">Galbraith, et al.           Standards Track                    [Page 11]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  IANA Considerations</span>

   This section contains conventions used in naming the namespaces, the
   initial state of the registry, and instructions for future
   assignments.

<span class="h3"><a class="selflink" name="section-6.1" href="#section-6.1">6.1</a>.  Registrations</span>

   Consistent with Section 4.9.5 of [<a href="#ref-8" title="&quot;The Secure Shell (SSH) Protocol Assigned Numbers&quot;">8</a>], this document makes the
   following registration:

   The subsystem name "publickey".

<span class="h3"><a class="selflink" name="section-6.2" href="#section-6.2">6.2</a>.  Names</span>

   In the following sections, the values for the namespaces are textual.
   The conventions and instructions to the IANA for future assignments
   are given in this section.  The initial assignments are given in
   their respective sections.

<span class="h4"><a class="selflink" name="section-6.2.1" href="#section-6.2.1">6.2.1</a>.  Conventions for Names</span>

   All names registered by the IANA in the following sections MUST be
   printable US-ASCII strings, and MUST NOT contain the characters
   at-sign ("@"), comma (","), or whitespace or control characters
   (ASCII codes 32 or less).  Names are case-sensitive, and MUST NOT be
   longer than 64 characters.

   A provision is made here for locally extensible names.  The IANA will
   not register and will not control names with the at-sign in them.
   Names with the at-sign in them will have the format of
   "name@domainname" (without the double quotes) where the part
   preceding the at-sign is the name.  The format of the part preceding
   the at-sign is not specified; however, these names MUST be printable
   US-ASCII strings, and MUST NOT contain the comma character (","), or
   whitespace, or control characters (ASCII codes 32 or less).  The part
   following the at-sign MUST be a valid, fully qualified Internet
   domain name [<a href="#ref-10" title="&quot;Domain names - concepts and facilities&quot;">10</a>] controlled by the person or organization defining
   the name.  Names are case-sensitive, and MUST NOT be longer than 64
   characters.  It is up to each domain how it manages its local
   namespace.  It has been noted that these names resemble STD 11 [<a href="#ref-9" title="&quot;Standard for the format of ARPA Internet text messages&quot;">9</a>]
   email addresses.  This is purely coincidental and actually has
   nothing to do with STD 11 [<a href="#ref-9" title="&quot;Standard for the format of ARPA Internet text messages&quot;">9</a>].  An example of a locally defined name
   is "our-attribute@example.com" (without the double quotes).







<span class="grey">Galbraith, et al.           Standards Track                    [Page 12]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h4"><a class="selflink" name="section-6.2.2" href="#section-6.2.2">6.2.2</a>.  Future Assignments of Names</span>

   Requests for assignments of new Names MUST be done through the IETF
   Consensus method as described in [<a href="#ref-11" title="&quot;Guidelines for Writing an IANA Considerations Section in RFCs&quot;">11</a>].

<span class="h3"><a class="selflink" name="section-6.3" href="#section-6.3">6.3</a>.  Public Key Subsystem Request Names</span>

   The following table lists the initial assignments of Public Key
   Subsystem Request names.

           Request Name
           -------------
           version
           add
           remove
           list
           listattributes

<span class="h3"><a class="selflink" name="section-6.4" href="#section-6.4">6.4</a>.  Public Key Subsystem Response Names</span>

   The following table lists the initial assignments of Public Key
   Subsystem Response names.

           Response Name
           --------------
           version
           status
           publickey
           attribute

<span class="h3"><a class="selflink" name="section-6.5" href="#section-6.5">6.5</a>.  Public Key Subsystem Attribute Names</span>

   Attributes are used to define properties or restrictions for public
   keys.  The following table lists the initial assignments of Public
   Key Subsystem Attribute names.
















<span class="grey">Galbraith, et al.           Standards Track                    [Page 13]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


           Attribute Name
           ---------------
           comment
           comment-language
           command-override
           subsystem
           x11
           shell
           exec
           agent
           env
           from
           port-forward
           reverse-forward

<span class="h3"><a class="selflink" name="section-6.6" href="#section-6.6">6.6</a>.  Public Key Subsystem Status Codes</span>

   The status code is a byte value, describing the status of a request.

<span class="h4"><a class="selflink" name="section-6.6.1" href="#section-6.6.1">6.6.1</a>.  Conventions</span>

   Status responses have status codes in the range 0 to 255.  These
   numbers are allocated as follows.  Of these, the range 192 to 255 is
   reserved for use by local, private extensions.

<span class="h4"><a class="selflink" name="section-6.6.2" href="#section-6.6.2">6.6.2</a>.  Initial Assignments</span>

   The following table identifies the initial assignments of the Public
   Key Subsystem status code values.

           Status code                           Value    Reference
           ------------                          -----    ---------
           SSH_PUBLICKEY_SUCCESS                   0
           SSH_PUBLICKEY_ACCESS_DENIED             1
           SSH_PUBLICKEY_STORAGE_EXCEEDED          2
           SSH_PUBLICKEY_VERSION_NOT_SUPPORTED     3
           SSH_PUBLICKEY_KEY_NOT_FOUND             4
           SSH_PUBLICKEY_KEY_NOT_SUPPORTED         5
           SSH_PUBLICKEY_KEY_ALREADY_PRESENT       6
           SSH_PUBLICKEY_GENERAL_FAILURE           7
           SSH_PUBLICKEY_REQUEST_NOT_SUPPORTED     8
           SSH_PUBLICKEY_ATTRIBUTE_NOT_SUPPORTED   9









<span class="grey">Galbraith, et al.           Standards Track                    [Page 14]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h4"><a class="selflink" name="section-6.6.3" href="#section-6.6.3">6.6.3</a>.  Future Assignments</span>

   Requests for assignments of new status codes in the range of 0 to 191
   MUST be done through the Standards Action method as described in
   [<a href="#ref-11" title="&quot;Guidelines for Writing an IANA Considerations Section in RFCs&quot;">11</a>].

   The IANA will not control the status code range of 192 through 255.
   This range is for private use.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" name="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a name="ref-1" id="ref-1">1</a>]   Ylonen, T. and C. Lonvick, "The Secure Shell (SSH) Protocol
         Architecture", <a href="rfc4251.html">RFC 4251</a>, January 2006.

   [<a name="ref-2" id="ref-2">2</a>]   Ylonen, T. and C. Lonvick, "The Secure Shell (SSH) Transport
         Layer Protocol", <a href="rfc4253.html">RFC 4253</a>, January 2006.

   [<a name="ref-3" id="ref-3">3</a>]   Ylonen, T. and C. Lonvick, "The Secure Shell (SSH)
         Authentication Protocol", <a href="rfc4252.html">RFC 4252</a>, January 2006.

   [<a name="ref-4" id="ref-4">4</a>]   Ylonen, T. and C. Lonvick, "The Secure Shell (SSH) Connection
         Protocol", <a href="rfc4254.html">RFC 4254</a>, January 2006.

   [<a name="ref-5" id="ref-5">5</a>]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-6" id="ref-6">6</a>]   Phillips, A. and M. Davis, "Tags for Identifying Languages",
         <a href="http://tools.ietf.org/html/bcp47">BCP 47</a>, <a href="rfc4646.html">RFC 4646</a>, September 2006.

   [<a name="ref-7" id="ref-7">7</a>]   Yergeau, F., "UTF-8, a transformation format of ISO 10646",
         STD 63, <a href="rfc3629.html">RFC 3629</a>, November 2003.

<span class="h3"><a class="selflink" name="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a name="ref-8" id="ref-8">8</a>]   Lehtinen, S. and C. Lonvick, "The Secure Shell (SSH) Protocol
         Assigned Numbers", <a href="rfc4250.html">RFC 4250</a>, January 2006.

   [<a name="ref-9" id="ref-9">9</a>]   Crocker, D., "Standard for the format of ARPA Internet text
         messages", STD 11, <a href="rfc822.html">RFC 822</a>, August 1982.

   [<a name="ref-10" id="ref-10">10</a>]  Mockapetris, P., "Domain names - concepts and facilities",
         STD 13, <a href="rfc1034.html">RFC 1034</a>, November 1987.

   [<a name="ref-11" id="ref-11">11</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an IANA
         Considerations Section in RFCs", <a href="http://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc2434.html">RFC 2434</a>,
         October 1998.



<span class="grey">Galbraith, et al.           Standards Track                    [Page 15]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  Acknowledgements</span>

   Brent McClure contributed to the writing of this document.

Authors' Addresses

   Joseph Galbraith
   VanDyke Software
   4848 Tramway Ridge Blvd
   Suite 101
   Albuquerque, NM  87111
   US

   Phone: +1 505 332 5700
   EMail: galb@vandyke.com


   Jeff P. Van Dyke
   VanDyke Software
   4848 Tramway Ridge Blvd
   Suite 101
   Albuquerque, NM  87111
   US

   Phone: +1 505 332 5700
   EMail: jpv@vandyke.com


   Jon Bright
   Silicon Circus
   24 Jubilee Road
   Chichester, West Sussex  PO19 7XB
   UK

   Phone: +49 172 524 0521
   EMail: jon@siliconcircus.com















<span class="grey">Galbraith, et al.           Standards Track                    [Page 16]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey"><a href="rfc4819.html">RFC 4819</a>           Secure Shell Public Key Subsystem          March 2007</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="http://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="http://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







Galbraith, et al.           Standards Track                    [Page 17]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.107, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body>
<!-- Mirrored from tools.ietf.org/html/rfc4819 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:38:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
