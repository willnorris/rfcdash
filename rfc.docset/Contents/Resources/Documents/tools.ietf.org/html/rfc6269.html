<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.106" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-ford-shared-addressing-issues" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:6269" name="DC.Identifier"/>
<meta content="June, 2011" name="DC.Date.Issued"/>
<meta content="Boucadair, Mohammed" name="DC.Creator"/>
<meta content="Ford, Mat" name="DC.Creator"/>
<meta content="Roberts, Phil" name="DC.Creator"/>
<meta content="Durand, Alain" name="DC.Creator"/>
<meta content="Levis, Pierre" name="DC.Creator"/>
<meta content="The completion of IPv4 address allocations from IANA and the Regional\nInternet Registries (RIRs) is causing service providers around the\nworld to question how they will continue providing IPv4 connectivity\nservice to their subscribers when there are no longer sufficient IPv4\naddresses to allocate them one per subscriber. Several possible\nsolutions to this problem are now emerging based around the idea of\nshared IPv4 addressing. These solutions give rise to a number of\nissues, and this memo identifies those common to all such address\nsharing approaches. Such issues include application failures,\nadditional service monitoring complexity, new security\nvulnerabilities, and so on. Solution-specific discussions are out of\nscope.  Deploying IPv6 is the only perennial way to ease pressure on\nthe public IPv4 address pool without the need for address sharing\nmechanisms that give rise to the issues identified herein. This\ndocument is not an Internet Standards Track specification; it is\npublished for informational purposes." name="DC.Description.Abstract"/>
<meta content="Issues with IP Address Sharing" name="DC.Title"/>

    <link href="http://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="http://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6269 - Issues with IP Address Sharing</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc6269.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc6269" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-ietf-intarea-shared-addressing-issues" title="draft-ietf-intarea-shared-addressing-issues">draft-ietf-intare...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6269" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc6269" title="Side-by-side diff">Diff2</a>]                 </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                      M. Ford, Ed.
Request for Comments: 6269                              Internet Society
Category: Informational                                     M. Boucadair
ISSN: 2070-1721                                           France Telecom
                                                               A. Durand
                                                        Juniper Networks
                                                                P. Levis
                                                          France Telecom
                                                              P. Roberts
                                                        Internet Society
                                                               June 2011


                     <span class="h1">Issues with IP Address Sharing</span>

Abstract

   The completion of IPv4 address allocations from IANA and the Regional
   Internet Registries (RIRs) is causing service providers around the
   world to question how they will continue providing IPv4 connectivity
   service to their subscribers when there are no longer sufficient IPv4
   addresses to allocate them one per subscriber.  Several possible
   solutions to this problem are now emerging based around the idea of
   shared IPv4 addressing.  These solutions give rise to a number of
   issues, and this memo identifies those common to all such address
   sharing approaches.  Such issues include application failures,
   additional service monitoring complexity, new security
   vulnerabilities, and so on.  Solution-specific discussions are out of
   scope.

   Deploying IPv6 is the only perennial way to ease pressure on the
   public IPv4 address pool without the need for address sharing
   mechanisms that give rise to the issues identified herein.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">SectionÂ 2 of RFC 5741</a>.






<span class="grey">Ford, et al.                  Informational                     [Page 1]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6269">http://www.rfc-editor.org/info/rfc6269</a>.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

































<span class="grey">Ford, et al.                  Informational                     [Page 2]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Shared Addressing Solutions  . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   3.  Analysis of Issues as They Relate to First and Third
       Parties  . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Content Provider Example . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-5">5</a>.  Port Allocation  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-5.1">5.1</a>.  Outgoing Ports . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
     <a href="#section-5.2">5.2</a>.  Incoming Ports . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#section-5.2.1">5.2.1</a>.  Port Negotiation . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#section-5.2.2">5.2.2</a>.  Connection to a Well-Known Port Number . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-5.2.3">5.2.3</a>.  Port Discovery Mechanisms  . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-6">6</a>.  Impact on Applications . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-7">7</a>.  Geo-location and Geo-proximity . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
   <a href="#section-8">8</a>.  Tracking Service Usage . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-9">9</a>.  ICMP . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-10">10</a>. MTU  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-11">11</a>. Fragmentation  . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-12">12</a>. Traceability . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-13">13</a>. Security . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-13.1">13.1</a>. Abuse Logging and Penalty Boxes  . . . . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-13.2">13.2</a>. Authentication . . . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-13.3">13.3</a>. Spam . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-13.4">13.4</a>. Port Randomization . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-13.5">13.5</a>. IPsec  . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-13.6">13.6</a>. Policing Forwarding Behavior . . . . . . . . . . . . . . . <a href="#page-20">20</a>
   <a href="#section-14">14</a>. Transport Issues . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-14.1">14.1</a>. Parallel Connections . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-14.2">14.2</a>. Serial Connections . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-14.3">14.3</a>. TCP Control Block Sharing  . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
   <a href="#section-15">15</a>. Reverse DNS  . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
   <a href="#section-16">16</a>. Load Balancing . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
   <a href="#section-17">17</a>. IPv6 Transition Issues . . . . . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
   <a href="#section-18">18</a>. Introduction of Single Points of Failure . . . . . . . . . . . <a href="#page-22">22</a>
   <a href="#section-19">19</a>. State Maintenance Reduces Battery Life . . . . . . . . . . . . <a href="#page-22">22</a>
   <a href="#section-20">20</a>. Support of Multicast . . . . . . . . . . . . . . . . . . . . . <a href="#page-22">22</a>
   <a href="#section-21">21</a>. Support of Mobile-IP . . . . . . . . . . . . . . . . . . . . . <a href="#page-22">22</a>
   <a href="#section-22">22</a>. Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#section-23">23</a>. Contributors . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#section-24">24</a>. Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#section-25">25</a>. Informative References . . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#appendix-A">Appendix A</a>.  Classes of Address Sharing Solution . . . . . . . . . <a href="#page-27">27</a>
   <a href="#appendix-B">Appendix B</a>.  Address Space Multiplicative Factor . . . . . . . . . <a href="#page-27">27</a>







<span class="grey">Ford, et al.                  Informational                     [Page 3]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Allocations of IPv4 addresses from the Internet Assigned Numbers
   Authority (IANA) were completed on February 3, 2011 [<a href="#ref-IPv4_Pool">IPv4_Pool</a>].
   Allocations from Regional Internet Registries (RIRs) are anticipated
   to be complete around a year later, although the exact date will vary
   from registry to registry.  This is causing service providers around
   the world to start to question how they will continue providing IPv4
   connectivity service to their subscribers when there are no longer
   sufficient IPv4 addresses to allocate them one per subscriber.
   Several possible solutions to this problem are now emerging based
   around the idea of shared IPv4 addressing.  These solutions give rise
   to a number of issues, and this memo identifies those common to all
   such address sharing approaches and collects them in a single
   document.

   Deploying IPv6 is the only perennial way to ease pressure on the
   public IPv4 address pool without the need for address sharing
   mechanisms that give rise to the issues identified herein.  In the
   short term, maintaining growth of IPv4 services in the presence of
   IPv4 address depletion will require address sharing.  Address sharing
   will cause issues for end-users, service providers, and third parties
   such as law enforcement agencies and content providers.  This memo is
   intended to highlight and briefly discuss these issues.

   Increased IPv6 deployment should reduce the burden being placed on an
   address sharing solution, and should reduce the costs of operating
   that solution.  Increasing IPv6 deployment should cause a reduction
   in the number of concurrent IPv4 sessions per subscriber.  If the
   percentage of end-to-end IPv6 traffic significantly increases, so
   that the volume of IPv4 traffic begins decreasing, then the number of
   IPv4 sessions will decrease.  The smaller the number of concurrent
   IPv4 sessions per subscriber, the higher the number of subscribers
   able to share the same IPv4 public address, and consequently, the
   lower the number of IPv4 public addresses required.  However, this
   effect will only occur for subscribers who have both an IPv6 access
   and a shared IPv4 access.  This motivates a strategy to
   systematically bind a shared IPv4 access to an IPv6 access.  It is
   difficult to foresee to what extent growing IPv6 traffic will reduce
   the number of concurrent IPv4 sessions, but in any event, IPv6
   deployment and use should reduce the pressure on the available public
   IPv4 address pool.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Shared%20Addressing%20Solutions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Shared Addressing Solutions</span>

   In many networks today, a subscriber is provided with a single public
   IPv4 address at their home or small business.  For instance, in fixed
   broadband access, an IPv4 public address is assigned to each CPE



<span class="grey">Ford, et al.                  Informational                     [Page 4]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   (Customer Premises Equipment).  CPEs embed a NAT function that is
   responsible for translating private IPv4 addresses ([<a href="rfc1918.html" title='"Address Allocation for Private Internets"'>RFC1918</a>]
   addresses) assigned to hosts within the local network, to the public
   IPv4 address assigned by the service provider (and vice versa).
   Therefore, devices located with the LAN share the single public IPv4
   address and they are all associated with a single subscriber account
   and a single network operator.

   A number of proposals currently under consideration in the IETF rely
   upon the mechanism of multiplexing multiple subscribers' connections
   over a smaller number of shared IPv4 addresses.  This is a
   significant change.  These proposals include Carrier Grade NAT (CGN
   a.k.a. LSN for Large Scale NAT) [<a href="#ref-LSN-REQS" title='"Common requirements for IP address sharing schemes"'>LSN-REQS</a>], Dual-Stack Lite
   [<a href="#ref-DS-Lite" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>DS-Lite</a>], NAT64 [<a href="rfc6145.html" title='"IP/ICMP Translation Algorithm"'>RFC6145</a>] [<a href="rfc6146.html" title='"Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers"'>RFC6146</a>], Address+Port (A+P) proposals
   [A+P] [<a href="#ref-PORT-RANGE">PORT-RANGE</a>], and Stateless Address Mapping [<a href="#ref-SAM" title='"Scalable Multihoming across IPv6 Local- Address Routing Zones Global-Prefix/Local-Address Stateless Address Mapping (SAM)"'>SAM</a>].  <a href="#appendix-A">Appendix A</a>
   and <a href="#appendix-B">Appendix B</a> provide a classification of these different types of
   solutions and discuss some of the design considerations to be borne
   in mind when deploying large-scale address sharing.  Whether we're
   talking about DS-Lite, A+P, NAT64, or CGN isn't especially important
   -- it's the view from the outside that matters, and given that, most
   of the issues identified below apply regardless of the specific
   address sharing scenario in question.

   In these new proposals, a single public IPv4 address would be shared
   by multiple homes or small businesses (i.e., multiple subscribers),
   so the operational paradigm described above would no longer apply.
   In this document, we refer to this new paradigm as large-scale
   address sharing.  All these proposals extend the address space by
   adding port information; they differ in the way they manage the port
   value.

   Security issues associated with NAT have long been documented (see
   [<a href="rfc2663.html" title='"IP Network Address Translator (NAT) Terminology and Considerations"'>RFC2663</a>] and [<a href="rfc2993.html" title='"Architectural Implications of NAT"'>RFC2993</a>]).  However, sharing IPv4 addresses across
   multiple subscribers by any means, either moving the NAT
   functionality from the home gateway to the core of the service
   provider network or restricting the port choice in the subscriber's
   NAT, creates additional issues for subscribers, content providers,
   and network operators.  Many of these issues are created today by
   public Wi-Fi hotspot deployments.  As such large-scale address
   sharing solutions become more widespread in the face of IPv4 address
   depletion, these issues will become both more severe and more
   commonly felt.  NAT issues in the past typically only applied to a
   single legal entity; as large-scale address sharing becomes more
   prevalent, these issues will increasingly span across multiple legal
   entities simultaneously.






<span class="grey">Ford, et al.                  Informational                     [Page 5]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   All large-scale address sharing proposals share technical and
   operational issues, and these are addressed in the sections that
   follow.  These issues are common to any service-provider NAT,
   enterprise NAT, and also non-NAT solutions that share individual IPv4
   addresses across multiple subscribers.  This document is intended to
   bring all of these issues together in one place.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Analysis%20of%20Issues%20as%20They%20Relate%20to%20First%20and%20Third%20Parties"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Analysis of Issues as They Relate to First and Third Parties</span>

   In this section, we present an analysis of whether the issues
   identified in the remainder of this document are applicable to the
   organization deploying the shared addressing mechanism (and by
   extension their subscribers) and/or whether these issues impact third
   parties (e.g., content providers, law enforcement agencies, etc.).
   In this analysis, issues that affect end-users are deemed to affect
   first parties, as end-users can be expected to complain to their
   service provider when problems arise.  Where issues can expect to be
   foreseen and addressed by the party deploying the shared addressing
   solution, they are not attributed.

   In Figure 1, we have also tried to indicate (with 'xx') where issues
   are newly created in addition to what could be expected from the
   introduction of a traditional NAT device.  Issues marked with a
   single 'x' are already present today in the case of typical CPE NAT;
   however, they can be expected to be more severe and widespread in the
   case of large-scale address sharing.

   +------------------------------------------------+--------+---------+
   |                   Issue                        |   1st  |   3rd   |
   |                                                |  party | parties |
   +------------------------------------------------+--------+---------+
   | Restricted allocations of outgoing             |    x   |         |
   | ports will impact performance for end-users    |        |         |
   |                                                |        |         |
   | Incoming port negotiation mechanisms may fail  |    xx  |         |
   |                                                |        |         |
   | Incoming connections to Assigned Ports will    |    x   |         |
   | not work                                       |        |         |
   |                                                |        |         |
   | Port discovery mechanisms will not work        |    x   |         |
   |                                                |        |         |
   | Some applications will fail to operate         |    x   |    x    |
   |                                                |        |         |
   | Assumptions about parallel/serial connections  |    x   |    x    |
   | may fail                                       |        |         |
   |                                                |        |         |
   +------------------------------------------------+--------+---------+




<span class="grey">Ford, et al.                  Informational                     [Page 6]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   +------------------------------------------------+--------+---------+
   |                   Issue                        |   1st  |   3rd   |
   |                                                |  party | parties |
   +------------------------------------------------+--------+---------+
   | TCP control block sharing will be affected     |    x   |    x    |
   |                                                |        |         |
   | Reverse DNS will be affected                   |    x   |    x    |
   |                                                |        |         |
   | Inbound ICMP will fail in many cases           |    x   |    x    |
   |                                                |        |         |
   | Amplification of security issues will occur    |    xx  |    xx   |
   |                                                |        |         |
   | Fragmentation will require special handling    |    x   |         |
   |                                                |        |         |
   | Single points of failure and increased         |    x   |         |
   | network instability may occur                  |        |         |
   |                                                |        |         |
   | Port randomization will be affected            |    x   |         |
   |                                                |        |         |
   | Service usage monitoring and abuse logging     |    xx  |    xx   |
   | will be impacted for all elements in the chain |        |         |
   | between service provider and content provider  |        |         |
   |                                                |        |         |
   | Penalty boxes will no longer work              |    xx  |    xx   |
   |                                                |        |         |
   | Spam blacklisting will be affected             |    xx  |    xx   |
   |                                                |        |         |
   | Geo-location services will be impacted         |    xx  |    xx   |
   |                                                |        |         |
   | Geo-proximity mechanisms will be impacted      |    xx  |    xx   |
   |                                                |        |         |
   | Load balancing algorithms may be impacted      |        |    xx   |
   |                                                |        |         |
   | Authentication mechanisms may be impacted      |        |    x    |
   |                                                |        |         |
   | Traceability of network usage and abusage will |        |    xx   |
   | be affected                                    |        |         |
   |                                                |        |         |
   | IPv6 transition mechanisms will be affected    |    xx  |         |
   |                                                |        |         |
   | Frequent keep-alives will reduce battery life  |    x   |         |
   |                                                |        |         |
   +------------------------------------------------+--------+---------+

      Figure 1: Shared addressing issues for first and third parties






<span class="grey">Ford, et al.                  Informational                     [Page 7]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   As can be seen from Figure 1, deployment of large-scale address
   sharing will create almost as many problems for third parties as it
   does for the service provider deploying the address sharing
   mechanism.  Several of these issues are specific to the introduction
   of large-scale address sharing as well.  All of these issues are
   discussed in further detail below.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Content%20Provider%20Example"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Content Provider Example</span>

   Taking a content provider as an example of a third party, and
   focusing on the issues that are created specifically by the presence
   of large-scale address sharing, we identify the following issues as
   being of particular concern:

   o  Degraded geo-location for targeted advertising and licensed
      content restrictions (see <a href="#section-7">Section 7</a>).

   o  Additional latency due to indirect routing and degraded geo-
      proximity (see <a href="#section-7">Section 7</a>).

   o  Exposure to new amplification attacks (see <a href="#section-13">Section 13</a>).

   o  Service usage monitoring is made more complicated (see <a href="#section-8">Section 8</a>).

   o  Incoming port negotiation mechanisms may fail (see <a href="#section-5.2.1">Section 5.2.1</a>).

   o  IP blocking for abuse/spam will cause collateral damage (see
      <a href="#section-13">Section 13</a>).

   o  Load balancing algorithms may be impacted (see <a href="#section-16">Section 16</a>).

   o  Traceability of network usage and abuse will be impacted (see
      <a href="#section-12">Section 12</a>).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Port%20Allocation"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Port Allocation</span>

   When we talk about port numbers, we need to make a distinction
   between outgoing connections and incoming connections.  For outgoing
   connections, the actual source port number used is usually
   irrelevant.  (While this is true today, in a port-range solution, it
   is necessary for the source port to be within the allocated range.)
   But for incoming connections, the specific port numbers allocated to
   subscribers matter because they are part of external referrals (used
   by third parties to contact services run by the subscribers).

   The total number of subscribers able to share a single IPv4 address
   will depend upon assumptions about the average number of ports
   required per active subscriber, and the average number of



<span class="grey">Ford, et al.                  Informational                     [Page 8]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   simultaneously active subscribers.  It is important to realize that
   the TCP design makes it undesirable for clients to re-use ports while
   they remain in the TIME-WAIT state (typically 4 minutes after the
   connection has concluded).  TIME-WAIT state removes the hazard of old
   duplicates for "fast" or "long" connections, in which clock-driven
   Initial Sequence Number selection is unable to prevent overlap of the
   old and new sequence spaces.  The TIME-WAIT delay allows all old
   duplicate segments time enough to die in the Internet before the
   connection is reopened [<a href="rfc1337.html" title='"TIME-WAIT Assassination Hazards in TCP"'>RFC1337</a>].  Therefore, ports in this state
   must be included in calculations concerning port usage per
   subscriber.

   Most of the time the source port selected by a client application
   will be translated (unless there is direct knowledge of a port-range
   restriction in the client's stack), either by a NAT in the
   subscriber's device, or by a CPE NAT, or by a CPE NAT and a CGN.

   [<a id="ref-RFC1700" name="ref-RFC1700">RFC1700</a>] (which was replaced by an online database, as described by
   [<a href="rfc3232.html" title='"Assigned Numbers: RFC 1700 is Replaced by an On-line Database"'>RFC3232</a>]) defines the Assigned Ports (both System and User).  IANA
   has further classified the whole port space into three categories, as
   defined in [<a href="#ref-IANA_Ports">IANA_Ports</a>]:

   o  The Well-Known Ports are those from 0 through 1023.

   o  The Registered Ports are those from 1024 through 49151.

   o  The Dynamic and/or Private Ports are those from 49152 through
      65535.

   [<a id="ref-RFC4787" name="ref-RFC4787">RFC4787</a>] notes that current NATs have different policies with regard
   to this classification; some NATs restrict their translations to the
   use of dynamic ports, some also include registered ports, some
   preserve the port if it is in the well-known range.  [<a href="rfc4787.html" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>] makes
   it clear that the use of port space (1024-65535) is safe: "mapping a
   source port to a source port that is already registered is unlikely
   to have any bad effects".  Therefore, for all address sharing
   solutions, there is no reason to only consider a subset of the port
   space (1024-65535) for outgoing source ports.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Outgoing%20Ports"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Outgoing Ports</span>

   According to measurements, the average number of outgoing ports
   consumed per active subscriber is much, much smaller than the maximum
   number of ports a subscriber can use at any given time.  However, the
   distribution is heavy-tailed, so there are typically a small number
   of subscribers who use a very high number of ports [<a href="#ref-CGN_Viability">CGN_Viability</a>].
   This means that an algorithm that dynamically allocates outgoing port
   numbers from a central pool will typically allow more subscribers to



<span class="grey">Ford, et al.                  Informational                     [Page 9]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   share a single IPv4 address than algorithms that statically divide
   the resource by pre-allocating a fixed number of ports to each
   subscriber.  Similarly, such an algorithm should be more able to
   accommodate subscribers wishing to use a relatively high number of
   ports.

   It is important to note here that the desire to dynamically allocate
   outgoing port numbers will make a service provider's job of
   maintaining records of subscriber port number allocations
   considerably more onerous (see <a href="#section-12">Section 12</a>).  The number of records
   per subscriber will increase from 1 in a scheme where ports are
   statically allocated, to a much larger number equivalent to the total
   number of outgoing ports consumed by that subscriber during the time
   period for which detailed logs must be kept.

   A potential problem with dynamic allocation occurs when one of the
   subscriber devices behind such a port-shared IPv4 address becomes
   infected with a worm, which then quickly sets about opening many
   outbound connections in order to propagate itself.  Such an infection
   could rapidly exhaust the shared resource of the single IPv4 address
   for all connected subscribers.  It is therefore necessary to impose
   limits on the total number of ports available to an individual
   subscriber to ensure that the shared resource (the IPv4 address)
   remains available in some capacity to all the subscribers using it.
   However, static schemes for ports assignment may introduce security
   issues [<a href="rfc6056.html" title='"Recommendations for Transport- Protocol Port Randomization"'>RFC6056</a>] when small contiguous port ranges are statically
   assigned to subscribers.  Another way to mitigate this issue is to
   kill off (randomly) established connections when the port space runs
   out.  A user with many connections will be proportionally more likely
   to get impacted.

   Session failure due to NAT state overflow or timeout (when the NAT
   discards session state because it's run out of resource) can be
   experienced when the configured quota per user is reached or if the
   NAT is out of resources.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Incoming%20Ports"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Incoming Ports</span>

   It is desirable to ensure that incoming ports remain stable over
   time.  This is challenging as the network doesn't know anything in
   particular about the applications that it is supporting, and
   therefore has no real notion of how long an application/service
   session is still ongoing and therefore requiring port stability.

   Early measurements [<a href="#ref-CGN_Viability">CGN_Viability</a>] also seem to indicate that, on
   average, only very few ports are used by subscribers for incoming
   connections.  However, a majority of subscribers accept at least one
   inbound connection.



<span class="grey">Ford, et al.                  Informational                    [Page 10]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   This means that it is not necessary to pre-allocate a large number of
   incoming ports to each subscriber.  It is possible to either pre-
   allocate a small number of ports for incoming connections or do port
   allocation on demand when the application wishing to receive a
   connection is initiated.  The bulk of incoming ports can be reserved
   as a centralized resource shared by all subscribers using a given
   public IPv4 address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20Port%20Negotiation"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  Port Negotiation</span>

   In current deployments, one important and widely used feature of many
   CPE devices is the ability to open incoming ports (port forwarding)
   either manually, or with a protocol such as the Universal Plug and
   Play Internet Gateway Device (UPnP IGD) [<a href="#ref-UPnP-IGD" title='"Universal Plug and Play (UPnP) Internet Gateway Device (IGD) V 2.0"'>UPnP-IGD</a>].  If a CGN is
   present, the port must also be opened in the CGN.  CGN makes
   subscribers dependent on their service provider for this
   functionality.

   CPE and CGN will need to cooperate in order for port forwarding
   functionality to work.  UPnP, or NAT-PMP proxy could be a solution if
   there is a direct link (or tunnel) between the CPE and the CGN.  An
   alternative solution is a web interface to configure the incoming
   port mapping on the CGN.  Protocol development is underway in the
   IETF to provide a generalized, automated solution via the Port
   Control Protocol [<a href="#ref-PCP" title='"Port Control Protocol (PCP)"'>PCP</a>].

   Note that such an interface effectively makes public what was
   previously a private management interface and this raises security
   concerns that must be addressed.

   For port-range solutions, port forwarding capabilities may still be
   present at the CPE, with the limitation that the open incoming port
   must be within the allocated port range (for instance, it is not
   possible to open port 5002 for incoming connections if port 5002 is
   not within the allocated port range).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.1.%20%20Universal%20Plug%20and%20Play%20%28UPnP%29"></a><a class="selflink" href="#section-5.2.1.1" name="section-5.2.1.1">5.2.1.1</a>.  Universal Plug and Play (UPnP)</span>

   Using the UPnP semantic, an application asks "I want to use port
   number X, is that OK?", and the answer is yes or no.  If the answer
   is no, the application will typically try the next port in sequence,
   until it either finds one that works or gives up after a limited
   number of attempts.  UPnP IGD 1.0 has no way to redirect the
   application to use another port number.  UPnP IGD 2.0 improves this
   situation and allows for allocation of any available port.






<span class="grey">Ford, et al.                  Informational                    [Page 11]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.2.%20%20NAT%20Port%20Mapping%20Protocol%20%28NAT-PMP%29"></a><a class="selflink" href="#section-5.2.1.2" name="section-5.2.1.2">5.2.1.2</a>.  NAT Port Mapping Protocol (NAT-PMP)</span>

   NAT-PMP enables the NAT to redirect the requesting application to a
   port deemed to be available for use by the NAT state mapping table.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20Connection%20to%20a%20Well-Known%20Port%20Number"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  Connection to a Well-Known Port Number</span>

   Once an IPv4-address sharing mechanism is in place, inbound
   connections to well-known port numbers will not work in the general
   case.  Any application that is not port-agile cannot be expected to
   work.  Some workaround (e.g., redirects to a port-specific URI) could
   be deployed given sufficient incentives.  There exist several
   proposals for 'application service location' protocols that would
   provide a means of addressing this problem, but historically these
   proposals have not gained much deployment traction.

   For example, the use of DNS SRV records [<a href="rfc2782.html" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC2782</a>] provides a
   potential solution for subscribers wishing to host services in the
   presence of a shared-addressing scheme.  SRV records make it possible
   to specify a port value related to a service, thereby making services
   accessible on ports other than the well-known ports.  It is worth
   noting that this mechanism is not applicable to HTTP and many other
   protocols.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.3.%20%20Port%20Discovery%20Mechanisms"></a><a class="selflink" href="#section-5.2.3" name="section-5.2.3">5.2.3</a>.  Port Discovery Mechanisms</span>

   Port discovery using a UDP port to discover a service available on a
   corresponding TCP port, either through broadcast, multicast, or
   unicast, is a commonly deployed mechanism.  Unsolicited inbound UDP
   will be dropped by address sharing mechanisms as they have no live
   mapping to enable them to forward the packet to the appropriate host.
   Address sharing thereby breaks this service discovery technique.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Impact%20on%20Applications"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Impact on Applications</span>

   Address sharing solutions will have an impact on the following types
   of applications:

   o  Applications that establish inbound communications - These
      applications will have to ensure that ports selected for inbound
      communications are either within the allocated range (for port-
      range solutions) or are forwarded appropriately by the CGN (for
      CGN-based solutions).  See <a href="#section-5.2">Section 5.2</a> for more discussion.

   o  Applications that carry address and/or port information in their
      payload - Where translation of port and/or address information is
      performed at the IP and transport layers by the address sharing
      solution, an ALG will also be required to ensure application-layer



<span class="grey">Ford, et al.                  Informational                    [Page 12]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


      data is appropriately modified.  Note that ALGs are required in
      some cases, and in many other cases end-to-end protocol mechanisms
      have developed to work around a lack of ALGs in address
      translators, to the point of it being preferable to avoid any
      support in the NAT.

   o  Applications that use fixed ports - See <a href="#section-5.2.2">Section 5.2.2</a> for more
      discussion.

   o  Applications that do not use any port (e.g., ICMP echo) - Such
      applications will require special handling -- see <a href="#section-9">Section 9</a> for
      more discussion.

   o  Applications that assume the uniqueness of source addresses (e.g.,
      IP address as identifier) - Such applications will fail to operate
      correctly in the presence of multiple, discrete, simultaneous
      connections from the same source IP address.

   o  Applications that explicitly prohibit concurrent connections from
      the same address - Such applications will fail when multiple
      subscribers sharing an IP address attempt to use them
      simultaneously.

   o  Applications that do not use TCP or UDP for transport - All IP-
      address sharing mechanisms proposed to date are limited to TCP,
      UDP, and ICMP, thereby preventing end-users from fully utilizing
      the Internet (e.g., SCTP, DCCP, RSVP, protocol 41 (IPv6-over-
      IPv4), protocol 50 (IPsec ESP)).

   Applications already frequently implement mechanisms in order to
   circumvent the presence of NATs (typically CPE NATs):

   o  Application Layer Gateways (ALGs): Many CPE devices today embed
      ALGs that allow applications to behave correctly despite the
      presence of NAT on the CPE.  When the NAT belongs to the
      subscriber, the subscriber has flexibility to tailor the device to
      his or her needs.  For CGNs, subscribers will be dependent on the
      set of ALGs that their service provider makes available.  For
      port-range solutions, ALGs will require modification to deal with
      the port-range restriction, but will otherwise have the same
      capabilities as today.  Note that ALGs are required in some cases,
      and in many other cases end-to-end protocol mechanisms have
      developed to work around a lack of ALGs, to the point of it being
      preferable to avoid any support in the NAT.

   o  NAT Traversal Techniques: There are several commonly deployed
      mechanisms that support operating servers behind a NAT by
      forwarding specific TCP or UDP ports to specific internal hosts



<span class="grey">Ford, et al.                  Informational                    [Page 13]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


      ([<a href="#ref-UPnP-IGD" title='"Universal Plug and Play (UPnP) Internet Gateway Device (IGD) V 2.0"'>UPnP-IGD</a>], [<a href="#ref-NAT-PMP" title='"NAT Port Mapping Protocol (NAT-PMP)"'>NAT-PMP</a>], and manual configuration).  All of these
      mechanisms assume the NAT's WAN address is a publicly routable IP
      address, and fail to work normally when that assumption is wrong.
      There have been attempts to avoid that problem by automatically
      disabling the NAT function and bridging traffic instead upon
      assignment of a private IP address to the WAN interface (as is
      required for [<a href="#ref-Windows-Logo">Windows-Logo</a>] certification).  Bridging (rather than
      NATting) has other side effects (DHCP requests are served by an
      upstream DHCP server that can increase complexity of in-home
      networking).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Geo-location%20and%20Geo-proximity"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Geo-location and Geo-proximity</span>

   IP addresses are frequently used to indicate, with some level of
   granularity and some level of confidence, where a host is physically
   located.  Using IP addresses in this fashion is a heuristic at best,
   and is already challenged today by other deployed capabilities, e.g.,
   tunnels.  Geo-location services are used by content providers to
   allow them to conform with regional content licensing restrictions,
   to target advertising at specific geographic areas, or to provide
   customized content.  Geo-location services are also necessary for
   emergency services provision.  In some deployment contexts (e.g.,
   centralized CGN), shared addressing will reduce the level of
   confidence and level of location granularity that IP-based geo-
   location services can provide.  Viewed from the content provider, a
   subscriber behind a CGN geo-locates to wherever the prefix of the CGN
   appears to be; very often that will be in a different city than the
   subscriber.

   IP addresses are also used as input to geo-location services that
   resolve an IP address to a physical location using information from
   the network infrastructure.  Current systems rely on resources such
   as RADIUS databases and DHCP lease tables.  The use of address
   sharing will prevent these systems from resolving the location of a
   host based on IP address alone.  It will be necessary for users of
   such systems to provide more information (e.g., TCP or UDP port
   numbers), and for the systems to use this information to query
   additional network resources (e.g., Network Address Translation -
   Protocol Translation (NAT-PT) binding tables).  Since these new data
   elements tend to be more ephemeral than those currently used for geo-
   location, their use by geo-location systems may require them to be
   cached for some period of time.

   Other forms of geo-location will still work as usual.

   A slightly different use of an IP address is to calculate the
   proximity of a connecting host to a particular service delivery
   point.  This use of IP address information impacts the efficient



<span class="grey">Ford, et al.                  Informational                    [Page 14]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   delivery of content to an end-user.  If a CGN is introduced in
   communications and it is far from an end-user connected to it,
   application performance may be degraded insofar as IP-based geo-
   proximity is a factor.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Tracking%20Service%20Usage"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Tracking Service Usage</span>

   As large-scale address sharing becomes more commonplace, monitoring
   the number of unique users of a service will become more complex than
   simply counting the number of connections from unique IP addresses.
   While this is a somewhat inexact methodology today due to the
   widespread use of CPE NAT, it will become a much less useful approach
   in the presence of widespread large-scale address sharing solutions.
   In general, all elements that monitor usage or abusage in the chain
   between a service provider that has deployed address sharing and a
   content provider will need to be upgraded to take account of the port
   value in addition to IP addresses.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20ICMP"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  ICMP</span>

   ICMP does not include a port field and is consequently problematic
   for address sharing mechanisms.  Some ICMP message types include a
   fragment of the datagram that triggered the signal to be sent, which
   is assumed to include port numbers.  For some ICMP message types, the
   Identifier field has to be used as a de-multiplexing token.  Sourcing
   ICMP echo messages from hosts behind an address sharing solution does
   not pose problems, although responses to outgoing ICMP echo messages
   will require special handling, such as making use of the ICMP
   Identifier value to route the response appropriately.

   For inbound ICMP there are two cases.  The first case is that of ICMP
   sourced from outside the network of the address sharing solution
   provider.  Where ICMP messages include a fragment of an outgoing
   packet including port numbers, it may be possible to forward the
   packet appropriately.  In addition to these network signaling
   messages, several applications (e.g., peer-to-peer applications) make
   use of ICMP echo messages that include no hints that could be used to
   route the packet correctly.  Measurements derived by such
   applications in the presence of an address sharing solution will be
   erroneous or fail altogether.  The second case is that of ICMP
   sourced from within the network of the address sharing solution
   provider (e.g., for network management, signaling, and diagnostic
   purposes).  In this case, ICMP can be routed normally for CGN-based
   solutions owing to the presence of locally unique private IP
   addresses for each CPE device.  For port-range solutions, ICMP echo
   messages will not be routable without special handling, e.g., placing
   a port number in the ICMP Identifier field, and having port-range
   routers make routing decisions based upon that field.



<span class="grey">Ford, et al.                  Informational                    [Page 15]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   Considerations related to ICMP message handling in NAT-based
   environments are specified in [<a href="rfc5508.html" title='"NAT Behavioral Requirements for ICMP"'>RFC5508</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20MTU"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  MTU</span>

   In applications where the end hosts are attempting to use path MTU
   Discovery [<a href="rfc1191.html" title='"Path MTU discovery"'>RFC1191</a>] to optimize transmitted packet size with
   underlying network MTU, shared addressing has a number of items that
   must be considered.  As covered in <a href="#section-9">Section 9</a>, ICMP "Packet Too Big"
   messages must be properly translated through the address sharing
   solution in both directions.  However, even when this is done
   correctly, MTU can be a concern.  Many end hosts cache information
   that was received via Path MTU Discovery (PMTUD) for a certain period
   of time.  If the MTU behind the address sharing solution is
   inconsistent, the public end host may have the incorrect MTU value
   cached.  This may cause it to send packets that are too large,
   causing them to be dropped if the DF (Don't Fragment) bit is set, or
   causing them to be fragmented by the network, increasing load and
   overhead.  Because the host eventually will reduce MTU to the lowest
   common value for all hosts behind a given public address, it may also
   send packets that are below optimal size for the specific connection,
   increasing overhead and reducing throughput.

   This issue also generates a potential attack vector -- a malevolent
   user could send an ICMP "Packet Too Big" (Type 3, Code 4) message
   indicating a Next-Hop MTU of anything down to 68 octets.  This value
   will be cached by the off-net server for all subscribers sharing the
   address of the malevolent user.  This could lead to a denial of
   service (DoS) against both the remote server and the large-scale NAT
   device itself (as they will both have to handle many more packets per
   second).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Fragmentation"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Fragmentation</span>

   When a packet is fragmented, transport-layer port information (either
   UDP or TCP) is only present in the first fragment.  Subsequent
   fragments will not carry the port information and so will require
   special handling.  In addition, the IP Identifier may no longer be
   unique as required by the receiver to aid in assembling the fragments
   of a datagram.











<span class="grey">Ford, et al.                  Informational                    [Page 16]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Traceability"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Traceability</span>

   In many jurisdictions, service providers are legally obliged to
   provide the identity of a subscriber upon request to the appropriate
   authorities.  Such legal requests have traditionally included the
   source IPv4 address and date (and usually the time), which is
   sufficient information when subscribers are assigned IPv4 addresses
   for a long duration.

   However, where one public IPv4 address is shared between several
   subscribers, the IPv4 address no longer uniquely identifies a
   subscriber.  There are two solutions to this problem:

   o  The first solution is for servers to additionally log the source
      port of incoming connections and for the legal request to include
      the source port.  The legal request should include the
      information: [Source IP address, Source Port, Timestamp] (and
      possibly other information).  Accurate time-keeping (e.g., use of
      NTP or Simple NTP) is vital because port assignments are dynamic.
      A densely populated CGN could mean even very small amounts of
      clock skew between a third party's server and the CGN operator
      will result in ambiguity about which customer was using a specific
      port at a given time.

   o  The second solution considers it unrealistic to expect all servers
      to log the source port number of incoming connections.  To deal
      with this, service providers using IPv4 address sharing may need
      to log IP destination addresses.

   Destination logging is imperfect if multiple subscribers are
   accessing the same (popular) server at nearly the same time; it can
   be impossible to disambiguate which subscriber accessed the server,
   especially with protocols that involve several connections (e.g.,
   HTTP).  Thus, logging the destination address on the NAT is inferior
   to logging the source port at the server.

   If neither solution is used (that is, the server is not logging
   source port numbers and the NAT is not logging destination IP
   addresses), the service provider cannot trace a particular activity
   to a specific subscriber.  In this circumstance, the service provider
   would need to disclose the identity of all subscribers who had active
   sessions on the NAT during the time period in question.  This may be
   a large number of subscribers.

   Address sharing solutions must record and store all mappings
   (typically during 6-12 months, depending on the local jurisdiction)
   that they create.  If we consider one mapping per session, a service
   provider should record and retain traces of all sessions created by



<span class="grey">Ford, et al.                  Informational                    [Page 17]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   all subscribers during one year (if the legal storage duration is one
   year).  This may be challenging due to the volume of data requiring
   storage, the volume of data to repeatedly transfer to the storage
   location, and the volume of data to search in response to a query.

   Address sharing solutions may mitigate these issues to some extent by
   pre-allocating groups of ports.  Then only the allocation of the
   group needs to be recorded, and not the creation of every session
   binding within that group.  There are trade-offs to be made between
   the sizes of these port groups, the ratio of public addresses to
   subscribers, whether or not these groups timeout, and the impact on
   logging requirements and port randomization security [<a href="rfc6056.html" title='"Recommendations for Transport- Protocol Port Randomization"'>RFC6056</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Security"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Security</span>

   Before noting some specific security-related issues caused by large-
   scale address sharing, it is perhaps worth noting that, in general,
   address sharing creates a vector for attack amplification in numerous
   ways.  See <a href="#section-10">Section 10</a> for one example.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.1.%20%20Abuse%20Logging%20and%20Penalty%20Boxes"></a><a class="selflink" href="#section-13.1" name="section-13.1">13.1</a>.  Abuse Logging and Penalty Boxes</span>

   When an abuse is reported today, it is usually done in the form: IPv4
   address X has done something bad at time T0.  This is not enough
   information to uniquely identify the subscriber responsible for the
   abuse when that IPv4 address is shared by more than one subscriber.
   Law enforcement authorities may be particularly impacted because of
   this.  This particular issue can be fixed by logging port numbers,
   although this will increase logging data storage requirements.

   A number of services on the network today log the IPv4 source
   addresses used in connection attempts to protect themselves from
   certain attacks.  For example, if a server sees too many requests
   from the same IPv4 address in a short period of time, it may decide
   to put that address in a penalty box for a certain time during which
   requests are denied, or it may require completion of a CAPTCHA
   (Completely Automated Public Turing test to tell Computers and Humans
   Apart) for future requests.  If an IPv4 address is shared by multiple
   subscribers, this would have unintended consequences in a couple of
   ways.  First it may become the natural behavior to see many login
   attempts from the same address because it is now shared across a
   potentially large number of subscribers.  Second and more likely is
   that one user who fails a number of login attempts may block out
   other users who have not made any previous attempts but who will now
   fail on their first attempt.  In the presence of widespread large-
   scale address sharing, penalty box solutions to service abuse simply
   will not work.




<span class="grey">Ford, et al.                  Informational                    [Page 18]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   In addition, there are web tie-ins into different blacklists that web
   administrators subscribe to in order to redirect users with infected
   machines (e.g., detect the presence of a worm) to a URL that says
   "Hey, your machine is infected!".  With address sharing, someone
   else's worm can interfere with the ability to access the service for
   other subscribers sharing the same IP address.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.2.%20%20Authentication"></a><a class="selflink" href="#section-13.2" name="section-13.2">13.2</a>.  Authentication</span>

   Simple address-based identification mechanisms that are used to
   populate access control lists will fail when an IP address is no
   longer sufficient to identify a particular subscriber.  Including
   port numbers in access control list definitions may be possible at
   the cost of extra complexity, and may also require the service
   provider to make static port assignments, which conflicts with the
   requirement for dynamic assignments discussed in <a href="#section-5.1">Section 5.1</a>.

   Address or DNS-name-based signatures (e.g., some X.509 signatures)
   may also be affected by address sharing as the address itself is now
   a shared token, and the name to address mapping may not be current.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.3.%20%20Spam"></a><a class="selflink" href="#section-13.3" name="section-13.3">13.3</a>.  Spam</span>

   Another case of identifying abusers has to do with spam blacklisting.
   When a spammer is behind a CGN or using a port-shared address,
   blacklisting of their IP address will result in all other subscribers
   sharing that address having their ability to source SMTP packets
   restricted to some extent.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.4.%20%20Port%20Randomization"></a><a class="selflink" href="#section-13.4" name="section-13.4">13.4</a>.  Port Randomization</span>

   A blind attack that can be performed against TCP relies on the
   attacker's ability to guess the 5-tuple (Protocol, Source Address,
   Destination Address, Source Port, Destination Port) that identifies
   the transport protocol instance to be attacked.  [<a href="rfc6056.html" title='"Recommendations for Transport- Protocol Port Randomization"'>RFC6056</a>] describes
   a number of methods for the random selection of the source port
   number, such that the ability of an attacker to correctly guess the
   5-tuple is reduced.  With shared IPv4 addresses, the port selection
   space is reduced.  Preserving port randomization is important and may
   be more or less difficult depending on the address sharing solution
   and the size of the port space that is being manipulated.  Allocation
   of non-contiguous port ranges could help to mitigate this issue.

   It should be noted that guessing the port information may not be
   sufficient to carry out a successful blind attack.  An in-window TCP
   Sequence Number (SN) should also be known or guessed.  A TCP segment
   is processed only if all previous segments have been received, except
   for some Reset segment implementations that immediately process the



<span class="grey">Ford, et al.                  Informational                    [Page 19]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   Reset as long as it is within the Window.  If SN is randomly chosen,
   it will be difficult to guess it (SN is 32 bits long); port
   randomization is one protection among others against blind attacks.
   There is more detailed discussion of improving TCP's robustness to
   Blind In-Window Attacks in [<a href="rfc5961.html" title="&quot;Improving TCP's Robustness to Blind In-Window Attacks&quot;">RFC5961</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.5.%20%20IPsec"></a><a class="selflink" href="#section-13.5" name="section-13.5">13.5</a>.  IPsec</span>

   The impact of large-scale IP address sharing for IPsec operation
   should be evaluated and assessed.  [<a href="rfc3947.html" title='"Negotiation of NAT-Traversal in the IKE"'>RFC3947</a>] proposes a solution to
   solve issues documented in [<a href="rfc3715.html" title='"IPsec-Network Address Translation (NAT) Compatibility Requirements"'>RFC3715</a>].  [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>] specifies Internet
   Key Exchange (IKE) Protocol Version 2, which includes NAT traversal
   mechanisms that are now widely used to enable IPsec to work in the
   presence of NATs in many cases.  Nevertheless, service providers may
   wish to ensure that CGN deployments do not inadvertently block NAT
   traversal for security protocols such as IKE (refer to [<a href="#ref-NAT-SEC" title='"Security implications of Network Address Translators (NATs)"'>NAT-SEC</a>] for
   more information).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.6.%20%20Policing%20Forwarding%20Behavior"></a><a class="selflink" href="#section-13.6" name="section-13.6">13.6</a>.  Policing Forwarding Behavior</span>

   [<a id="ref-RFC2827" name="ref-RFC2827">RFC2827</a>] motivates and discusses a simple, effective, and
   straightforward method for using ingress traffic filtering to
   prohibit DoS attacks that use forged IP addresses.  Following this
   recommendation, service providers operating shared-addressing
   mechanisms should ensure that source addresses, or source ports in
   the case of port-range schemes, are set correctly in outgoing packets
   from their subscribers or they should drop the packets.

   If some form of IPv6 ingress filtering is deployed in the broadband
   network and DS-Lite service is restricted to those subscribers, then
   tunnels terminating at the CGN and coming from registered subscriber
   IPv6 addresses cannot be spoofed.  Thus, a simple access control list
   on the tunnel transport source address is all that is required to
   accept traffic on the internal interface of a CGN.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Transport%20Issues"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Transport Issues</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.1.%20%20Parallel%20Connections"></a><a class="selflink" href="#section-14.1" name="section-14.1">14.1</a>.  Parallel Connections</span>

   One issue is systems that assume that multiple simultaneous
   connections to a single IP address implies connectivity to a single
   host -- such systems may experience unexpected results.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.2.%20%20Serial%20Connections"></a><a class="selflink" href="#section-14.2" name="section-14.2">14.2</a>.  Serial Connections</span>

   Another issue is systems that assume that returning to a given IP
   address means returning to the same physical host, as with stateful
   transactions.  This may also affect cookie-based systems.



<span class="grey">Ford, et al.                  Informational                    [Page 20]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.3.%20%20TCP%20Control%20Block%20Sharing"></a><a class="selflink" href="#section-14.3" name="section-14.3">14.3</a>.  TCP Control Block Sharing</span>

   [<a id="ref-RFC2140" name="ref-RFC2140">RFC2140</a>] defines a performance optimization for TCP based on sharing
   state between TCP control blocks that pertain to connections to the
   same host, as opposed to maintaining state for each discrete
   connection.  This optimization assumes that an address says something
   about the properties of the path between two hosts, which is clearly
   not the case if the address in question is shared by multiple hosts
   at different physical network locations.  While CPE NAT today causes
   problems for sharing TCP control block state across multiple
   connections to a given IP address, large-scale address sharing will
   make these issues more severe and more widespread.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20Reverse%20DNS"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  Reverse DNS</span>

   Many service providers populate forward and reverse DNS zones for the
   public IPv4 addresses that they allocate to their subscribers.  In
   the case where public addresses are shared across multiple
   subscribers, such strings are, by definition, no longer sufficient to
   identify an individual subscriber without additional information.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16.%20%20Load%20Balancing"></a><a class="selflink" href="#section-16" name="section-16">16</a>.  Load Balancing</span>

   Algorithms used to balance traffic load for popular destinations may
   be affected by the introduction of address sharing.  Where balancing
   is achieved by deterministically routing traffic from specific source
   IP addresses to specific servers, imbalances in load may be
   experienced as address sharing is enabled for some of those source IP
   addresses.  This will require re-evaluation of the algorithms used in
   the load-balancing design.  In general, as the scale of address
   sharing grows, load-balancing designs will need to be re-evaluated
   and any assumptions about average load per source IP address
   revisited.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/17.%20%20IPv6%20Transition%20Issues"></a><a class="selflink" href="#section-17" name="section-17">17</a>.  IPv6 Transition Issues</span>

   IPv4 address sharing solutions may interfere with existing IPv4 to
   IPv6 transition mechanisms, which were not designed with IPv4
   shortage considerations in mind.  With port-range solutions, for
   instance, incoming 6to4 packets should be able to find their way from
   a 6to4 relay to the appropriate 6to4 CPE router, despite the lack of
   direct port-range information (UDP/TCP initial source port did not
   pass through the CPE port range translation process).  One solution
   would be for a 6to4 IPv6 address to embed not only an IPv4 address
   but also a port range value.






<span class="grey">Ford, et al.                  Informational                    [Page 21]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   Subscribers allocated with private addresses will not be able to
   utilize 6to4 [<a href="rfc3056.html" title='"Connection of IPv6 Domains via IPv4 Clouds"'>RFC3056</a>] to access IPv6, but may be able to utilize
   Teredo [<a href="rfc4380.html" title='"Teredo: Tunneling IPv6 over UDP through Network Address Translations (NATs)"'>RFC4380</a>].

   Some routers enable 6to4 on their WAN link. 6to4 requires a publicly
   routable IPv4 address.  Enabling 6to4 when the apparently public IPv4
   WAN address is in fact behind a NAT creates a disconnected IPv6
   island.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/18.%20%20Introduction%20of%20Single%20Points%20of%20Failure"></a><a class="selflink" href="#section-18" name="section-18">18</a>.  Introduction of Single Points of Failure</span>

   In common with all deployments of new network functionality, the
   introduction of new nodes or functions to handle the multiplexing of
   multiple subscribers across shared IPv4 addresses could create single
   points of failure in the network.  Any IP address sharing solution
   should consider the opportunity to add redundancy features in order
   to alleviate the impact on the robustness of the offered IP
   connectivity service.  The ability of the solution to allow hot
   swapping from one machine to another should be considered.  This is
   especially important where the address sharing solution in question
   requires the creation of per-flow state in the network.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/19.%20%20State%20Maintenance%20Reduces%20Battery%20Life"></a><a class="selflink" href="#section-19" name="section-19">19</a>.  State Maintenance Reduces Battery Life</span>

   In order for hosts to maintain network state in the presence of NAT,
   keep-alive messages have to be sent at frequent intervals.  For
   battery-powered devices, sending these keep-alive messages can result
   in significantly reduced battery performance than would otherwise be
   the case [<a href="#ref-Mobile_Energy_Consumption">Mobile_Energy_Consumption</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/20.%20%20Support%20of%20Multicast"></a><a class="selflink" href="#section-20" name="section-20">20</a>.  Support of Multicast</span>

   [<a id="ref-RFC5135" name="ref-RFC5135">RFC5135</a>] specifies requirements for a NAT that supports Any Source
   IP Multicast or Source-Specific IP Multicast.  Port-range routers
   that form part of port-range solutions will need to support similar
   requirements if multicast support is required.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/21.%20%20Support%20of%20Mobile-IP"></a><a class="selflink" href="#section-21" name="section-21">21</a>.  Support of Mobile-IP</span>

   IP address sharing within the context of Mobile IP deployments (in
   the home network and/or in the visited network) will require Home
   Agents and/or Foreign Agents to be updated so as to take into account
   the relevant port information.  There may also be issues raised when
   an additional layer of encapsulation is required thereby causing, or
   increasing the need for, fragmentation and reassembly.

   Issues for Mobile-IP in the presence of NAT are discussed in
   [<a href="#ref-NAT64-MOBILITY">NAT64-MOBILITY</a>].



<span class="grey">Ford, et al.                  Informational                    [Page 22]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/22.%20%20Security%20Considerations"></a><a class="selflink" href="#section-22" name="section-22">22</a>.  Security Considerations</span>

   This memo does not define any protocol and therefore creates no new
   security issues.  <a href="#section-13">Section 13</a> discusses some of the security and
   identity-related implications of IP address sharing.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/23.%20%20Contributors"></a><a class="selflink" href="#section-23" name="section-23">23</a>.  Contributors</span>

   This document is based on sources co-authored by J.L. Grimault and A.
   Villefranque of France Telecom.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/24.%20%20Acknowledgments"></a><a class="selflink" href="#section-24" name="section-24">24</a>.  Acknowledgments</span>

   This memo was partly inspired by conversations that took place as
   part of Internet Society (ISOC) hosted roundtable events for
   operators and content providers deploying IPv6.  Participants in
   those discussions included John Brzozowski, Leslie Daigle, Tom
   Klieber, Yiu Lee, Kurtis Lindqvist, Wes George, Lorenzo Colliti, Erik
   Kline, Igor Gashinsky, Jason Fesler, Rick Reed, Adam Bechtel, Larry
   Campbell, Tom Coffeen, David Temkin, Pete Gelbman, Mark Winter, Will
   Charnock, Martin Levy, Greg Wood, and Christian Jacquenet.

   The authors are also grateful to Christian Jacquenet, Iain Calder,
   Joel Halpern, Brian Carpenter, Gregory Lebovitz, Bob Briscoe, Marcelo
   Bagnulo, Dan Wing, and Wes George for their helpful comments and
   suggestions for improving the document.

   This memo was created using the xml2rfc tool.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/25.%20%20Informative%20References"></a><a class="selflink" href="#section-25" name="section-25">25</a>.  Informative References</span>

   [A+P]      Bush, R., "The A+P Approach to the IPv4 Address Shortage",
              Work in Progress, February 2011.

   [<a id="ref-CGN_Viability" name="ref-CGN_Viability">CGN_Viability</a>]
              Alcock, S., "Research into the Viability of Service-
              Provider NAT", 2008, &lt;<a href="http://www.wand.net.nz/~salcock/someisp/flow_counting/result_page.html">http://www.wand.net.nz/~salcock/</a>
              <a href="http://www.wand.net.nz/~salcock/someisp/flow_counting/result_page.html">someisp/flow_counting/result_page.html</a>&gt;.

   [<a id="ref-DS-Lite" name="ref-DS-Lite">DS-Lite</a>]  Durand, A., Droms, R., Woodyatt, J., and Y. Lee, "Dual-
              Stack Lite Broadband Deployments Following IPv4
              Exhaustion", Work in Progress, May 2011.

   [<a id="ref-IANA_Ports" name="ref-IANA_Ports">IANA_Ports</a>]
              IANA, "Port Numbers", &lt;<a href="http://www.iana.org/">http://www.iana.org</a>&gt;.






<span class="grey">Ford, et al.                  Informational                    [Page 23]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   [<a id="ref-IPv4_Pool" name="ref-IPv4_Pool">IPv4_Pool</a>]
              ICANN, "Available Pool of Unallocated IPv4 Internet
              Addresses Now Completely Emptied", February 2011,
              &lt;<a href="http://icann.org/en/news/releases/release-03feb11-en.pdf">http://icann.org/en/news/releases/</a>
              <a href="http://icann.org/en/news/releases/release-03feb11-en.pdf">release-03feb11-en.pdf</a>&gt;.

   [<a id="ref-LSN-REQS" name="ref-LSN-REQS">LSN-REQS</a>] Perreault, S., Yamagata, I., Miyakawa, S., Nakagawa, A.,
              and H. Ashida, "Common requirements for IP address sharing
              schemes", Work in Progress, March 2011.

   [<a id="ref-Mobile_Energy_Consumption" name="ref-Mobile_Energy_Consumption">Mobile_Energy_Consumption</a>]
              Haverinen, H., Siren, J., and P. Eronen, "Energy
              Consumption of Always-On Applications in WCDMA Networks",
              April 2007, &lt;<a href="http://research.nokia.com/node/5597">http://research.nokia.com/node/5597</a>&gt;.

   [<a id="ref-NAT-PMP" name="ref-NAT-PMP">NAT-PMP</a>]  Cheshire, S., <a href="http://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22NAT+Port+Mapping+Protocol+%28NAT-PMP%29%22" style="text-decoration: none">"NAT Port Mapping Protocol (NAT-PMP)"</a>, Work
              in Progress, April 2008.

   [<a id="ref-NAT-SEC" name="ref-NAT-SEC">NAT-SEC</a>]  Gont, F. and P. Srisuresh, "Security implications of
              Network Address Translators (NATs)", Work in Progress,
              October 2009.

   [<a id="ref-NAT444" name="ref-NAT444">NAT444</a>]   Yamagata, I., Shirasaki, Y., Nakagawa, A., Yamaguchi, J.,
              and H. Ashida, "NAT444", January 2011.

   [<a id="ref-NAT64-MOBILITY" name="ref-NAT64-MOBILITY">NAT64-MOBILITY</a>]
              Haddad, W. and C. Perkins, "A Note on NAT64 Interaction
              with Mobile IPv6", Work in Progress, March 2011.

   [<a id="ref-PCP" name="ref-PCP">PCP</a>]      Wing, D., Ed., Cheshire, S., Boucadair, M., Penno, R., and
              P. Selkirk, "Port Control Protocol (PCP)", Work
              in Progress, May 2011.

   [<a id="ref-PORT-RANGE" name="ref-PORT-RANGE">PORT-RANGE</a>]
              Boucadair, M., Levis, P., Bajko, G., and T. Savolainen,
              "IPv4 Connectivity Access in the Context of IPv4 Address
              Exhaustion: Port Range based IP Architecture", Work
              in Progress, July 2009.

   [<a id="ref-RFC1191" name="ref-RFC1191">RFC1191</a>]  Mogul, J. and S. Deering, "Path MTU discovery", <a href="rfc1191.html">RFC 1191</a>,
              November 1990.

   [<a id="ref-RFC1337" name="ref-RFC1337">RFC1337</a>]  Braden, B., "TIME-WAIT Assassination Hazards in TCP",
              <a href="rfc1337.html">RFC 1337</a>, May 1992.

   [<a id="ref-RFC1700" name="ref-RFC1700">RFC1700</a>]  Reynolds, J. and J. Postel, "Assigned Numbers", <a href="rfc1700.html">RFC 1700</a>,
              October 1994.




<span class="grey">Ford, et al.                  Informational                    [Page 24]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   [<a id="ref-RFC1918" name="ref-RFC1918">RFC1918</a>]  Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and
              E. Lear, "Address Allocation for Private Internets",
              <a href="http://tools.ietf.org/html/bcp5">BCP 5</a>, <a href="rfc1918.html">RFC 1918</a>, February 1996.

   [<a id="ref-RFC2140" name="ref-RFC2140">RFC2140</a>]  Touch, J., "TCP Control Block Interdependence", <a href="rfc2140.html">RFC 2140</a>,
              April 1997.

   [<a id="ref-RFC2663" name="ref-RFC2663">RFC2663</a>]  Srisuresh, P. and M. Holdrege, "IP Network Address
              Translator (NAT) Terminology and Considerations",
              <a href="rfc2663.html">RFC 2663</a>, August 1999.

   [<a id="ref-RFC2782" name="ref-RFC2782">RFC2782</a>]  Gulbrandsen, A., Vixie, P., and L. Esibov, "A DNS RR for
              specifying the location of services (DNS SRV)", <a href="rfc2782.html">RFC 2782</a>,
              February 2000.

   [<a id="ref-RFC2827" name="ref-RFC2827">RFC2827</a>]  Ferguson, P. and D. Senie, "Network Ingress Filtering:
              Defeating Denial of Service Attacks which employ IP Source
              Address Spoofing", <a href="http://tools.ietf.org/html/bcp38">BCP 38</a>, <a href="rfc2827.html">RFC 2827</a>, May 2000.

   [<a id="ref-RFC2993" name="ref-RFC2993">RFC2993</a>]  Hain, T., "Architectural Implications of NAT", <a href="rfc2993.html">RFC 2993</a>,
              November 2000.

   [<a id="ref-RFC3056" name="ref-RFC3056">RFC3056</a>]  Carpenter, B. and K. Moore, "Connection of IPv6 Domains
              via IPv4 Clouds", <a href="rfc3056.html">RFC 3056</a>, February 2001.

   [<a id="ref-RFC3232" name="ref-RFC3232">RFC3232</a>]  Reynolds, J., "Assigned Numbers: <a href="rfc1700.html">RFC 1700</a> is Replaced by
              an On-line Database", <a href="rfc3232.html">RFC 3232</a>, January 2002.

   [<a id="ref-RFC3715" name="ref-RFC3715">RFC3715</a>]  Aboba, B. and W. Dixon, "IPsec-Network Address Translation
              (NAT) Compatibility Requirements", <a href="rfc3715.html">RFC 3715</a>, March 2004.

   [<a id="ref-RFC3947" name="ref-RFC3947">RFC3947</a>]  Kivinen, T., Swander, B., Huttunen, A., and V. Volpe,
              "Negotiation of NAT-Traversal in the IKE", <a href="rfc3947.html">RFC 3947</a>,
              January 2005.

   [<a id="ref-RFC4380" name="ref-RFC4380">RFC4380</a>]  Huitema, C., "Teredo: Tunneling IPv6 over UDP through
              Network Address Translations (NATs)", <a href="rfc4380.html">RFC 4380</a>,
              February 2006.

   [<a id="ref-RFC4787" name="ref-RFC4787">RFC4787</a>]  Audet, F. and C. Jennings, "Network Address Translation
              (NAT) Behavioral Requirements for Unicast UDP", <a href="http://tools.ietf.org/html/bcp127">BCP 127</a>,
              <a href="rfc4787.html">RFC 4787</a>, January 2007.

   [<a id="ref-RFC5135" name="ref-RFC5135">RFC5135</a>]  Wing, D. and T. Eckert, "IP Multicast Requirements for a
              Network Address Translator (NAT) and a Network Address
              Port Translator (NAPT)", <a href="http://tools.ietf.org/html/bcp135">BCP 135</a>, <a href="rfc5135.html">RFC 5135</a>, February 2008.





<span class="grey">Ford, et al.                  Informational                    [Page 25]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   [<a id="ref-RFC5508" name="ref-RFC5508">RFC5508</a>]  Srisuresh, P., Ford, B., Sivakumar, S., and S. Guha, "NAT
              Behavioral Requirements for ICMP", <a href="http://tools.ietf.org/html/bcp148">BCP 148</a>, <a href="rfc5508.html">RFC 5508</a>,
              April 2009.

   [<a id="ref-RFC5961" name="ref-RFC5961">RFC5961</a>]  Ramaiah, A., Stewart, R., and M. Dalal, "Improving TCP's
              Robustness to Blind In-Window Attacks", <a href="rfc5961.html">RFC 5961</a>,
              August 2010.

   [<a id="ref-RFC5996" name="ref-RFC5996">RFC5996</a>]  Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen,
              "Internet Key Exchange Protocol Version 2 (IKEv2)",
              <a href="rfc5996.html">RFC 5996</a>, September 2010.

   [<a id="ref-RFC6056" name="ref-RFC6056">RFC6056</a>]  Larsen, M. and F. Gont, "Recommendations for Transport-
              Protocol Port Randomization", <a href="http://tools.ietf.org/html/bcp156">BCP 156</a>, <a href="rfc6056.html">RFC 6056</a>,
              January 2011.

   [<a id="ref-RFC6145" name="ref-RFC6145">RFC6145</a>]  Li, X., Bao, C., and F. Baker, "IP/ICMP Translation
              Algorithm", <a href="rfc6145.html">RFC 6145</a>, April 2011.

   [<a id="ref-RFC6146" name="ref-RFC6146">RFC6146</a>]  Bagnulo, M., Matthews, P., and I. van Beijnum, "Stateful
              NAT64: Network Address and Protocol Translation from IPv6
              Clients to IPv4 Servers", <a href="rfc6146.html">RFC 6146</a>, April 2011.

   [<a id="ref-SAM" name="ref-SAM">SAM</a>]      Despres, R., "Scalable Multihoming across IPv6 Local-
              Address Routing Zones Global-Prefix/Local-Address
              Stateless Address Mapping (SAM)", July 2009.

   [<a id="ref-UPnP-IGD" name="ref-UPnP-IGD">UPnP-IGD</a>] UPnP Forum, "Universal Plug and Play (UPnP) Internet
              Gateway Device (IGD) V 2.0", December 2010,
              &lt;<a href="http://upnp.org/specs/gw/igd2/">http://upnp.org/specs/gw/igd2/</a>&gt;.

   [<a id="ref-Windows-Logo" name="ref-Windows-Logo">Windows-Logo</a>]
              Microsoft, "Windows Logo Program Requirements and
              Policies", 2006, &lt;<a href="http://www.microsoft.com/whdc/winlogo/hwrequirements/default.mspx">http://www.microsoft.com/whdc/winlogo/</a>
              <a href="http://www.microsoft.com/whdc/winlogo/hwrequirements/default.mspx">hwrequirements/default.mspx</a>&gt;.
















<span class="grey">Ford, et al.                  Informational                    [Page 26]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Classes%20of%20Address%20Sharing%20Solution"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Classes of Address Sharing Solution</span>

   IP address sharing solutions fall into two classes.  Either a
   service-provider-operated NAT function is introduced and subscribers
   are allocated addresses from [<a href="rfc1918.html" title='"Address Allocation for Private Internets"'>RFC1918</a>] space, or public IPv4
   addresses are shared across multiple subscribers by restricting the
   range of ports available to each subscriber.  These classes of
   solution are described in a bit more detail below.

   o  CGN-based solutions: These solutions propose the introduction of a
      NAPT function in the service provider's network, denoted also as
      Carrier Grade NAT (CGN), or Large Scale NAT (LSN) [<a href="#ref-LSN-REQS" title='"Common requirements for IP address sharing schemes"'>LSN-REQS</a>], or
      Provider NAT.  The CGN is responsible for translating private
      addresses to publicly routable addresses.  Private addresses are
      assigned to subscribers, a pool of public addresses is assigned to
      the CGN, and the number of public addresses is smaller than the
      number of subscribers.  A public IPv4 address in the CGN pool is
      shared by several subscribers at the same time.  Solutions making
      use of a service provider-based NAT include [<a href="#ref-NAT444" title='"NAT444"'>NAT444</a>] (two layers
      of NAT) and [<a href="#ref-DS-Lite" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>DS-Lite</a>] (a single layer of NAT).

   o  Port-range solutions: These solutions avoid the presence of a CGN
      function.  A single public IPv4 address is assigned to several
      subscribers at the same time.  A restricted port range is also
      assigned to each subscriber so that two subscribers with the same
      IPv4 address have two different port ranges that do not overlap.
      These solutions are called Address+Port [A+P], or Port Range
      [<a href="#ref-PORT-RANGE">PORT-RANGE</a>], or Stateless Address Mapping [<a href="#ref-SAM" title='"Scalable Multihoming across IPv6 Local- Address Routing Zones Global-Prefix/Local-Address Stateless Address Mapping (SAM)"'>SAM</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Address%20Space%20Multiplicative%20Factor"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Address Space Multiplicative Factor</span>

   The purpose of sharing public IPv4 addresses is to increase the
   addressing space.  A key parameter is the factor by which service
   providers want or need to multiply their IPv4 public address space,
   and the consequence is the number of subscribers sharing the same
   public IPv4 address.  We refer to this parameter as the address space
   multiplicative factor; the inverse is called the compression ratio.

   The multiplicative factor can only be applied to the subset of
   subscribers that are eligible for a shared address.  The reasons a
   subscriber cannot have a shared address can be:

   o  It would not be compatible with the service to which they are
      currently subscribed (for example, business subscriber).







<span class="grey">Ford, et al.                  Informational                    [Page 27]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


   o  Subscriber CPE is not compatible with the address sharing solution
      selected by the service provider (for example, it does not handle
      port restriction for port-range solutions or it does not allow
      IPv4 in IPv6 encapsulation for the DS-Lite solution), and its
      replacement is not easy.

   Different service providers may have very different needs.  A long-
   lived service provider, whose number of subscribers is rather stable,
   may have an existing address pool that will only need a small
   extension to cope with the next few years, assuming that this address
   pool can be re-purposed for an address sharing solution (small
   multiplicative factor, less than 10).  A new entrant or a new line of
   business will need a much bigger multiplicative factor (e.g., 1000).
   A mobile operator may see its addressing needs grow dramatically as
   the IP-enabled mobile handset market grows.

   When the multiplicative factor is large, the average number of ports
   per subscriber is small.  Given the large measured disparity between
   average and peak port consumption [<a href="#ref-CGN_Viability">CGN_Viability</a>], this will create
   service problems in the event that ports are allocated statically.
   In this case, it is essential for port allocation to map to need as
   closely as possible, and to avoid allocating ports for longer than
   necessary.  Therefore, the larger the multiplicative factor, the more
   dynamic the port assignment has to be.



























<span class="grey">Ford, et al.                  Informational                    [Page 28]</span>
</pre><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6269.html">RFC 6269</a>             Issues with IP Address Sharing            June 2011</span>


Authors' Addresses

   Mat Ford (editor)
   Internet Society
   Geneva
   Switzerland

   EMail: ford@isoc.org


   Mohamed Boucadair
   France Telecom
   Rennes  35000
   France

   EMail: mohamed.boucadair@orange-ftgroup.com


   Alain Durand
   Juniper Networks

   EMail: adurand@juniper.net


   Pierre Levis
   France Telecom
   42 rue des Coutures
   BP 6243
   Caen Cedex 4  14066
   France

   EMail: pierre.levis@orange-ftgroup.com


   Phil Roberts
   Internet Society
   Reston, VA
   USA

   EMail: roberts@isoc.org











Ford, et al.                  Informational                    [Page 29]

</pre><br/>
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.106, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>


<meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

</body><!-- Mirrored from tools.ietf.org/html/rfc6269 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:34:42 GMT --><!-- Added by HTTrack --></html>