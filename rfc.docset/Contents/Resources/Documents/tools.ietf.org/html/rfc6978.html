<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.107" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:rfc:6978" />
<meta name="DC.Description.Abstract" content="This document describes an extension to the TCP Authentication Option\n(TCP-AO) to support its use over connections that pass through Network\nAddress Translators and/or Network Address and Port Translators\n(NATs/NAPTs). This extension changes the data used to compute traffic\nkeys, but it does not alter TCP-AO\x27s packet processing or key\ngeneration algorithms." />
<meta name="DC.Creator" content="Joseph Touch &lt;touch@isi.edu&gt;" />
<meta name="DC.Date.Issued" content="July, 2013" />
<meta name="DC.Title" content="A TCP Authentication Option Extension for NAT Traversal" />

    <link rel="icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="http://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 6978 - A TCP Authentication Option Extension for NAT Traversal</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgyellow"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="http://tools.ietf.org/rfc/rfc6978.txt" title="Plaintext version of this document">txt</a>|<a href="http://tools.ietf.org/pdf/rfc6978" title="PDF version of this document">pdf</a>] [<a href="http://tools.ietf.org/html/draft-touch-tcp-ao-nat" title="draft-touch-tcp-ao-nat">draft-touch-tcp-a...</a>] [<a href="http://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6978" title="Inline diff (wdiff)">Diff1</a>] [<a href="http://tools.ietf.org/rfcdiff?url2=rfc6978" title="Side-by-side diff">Diff2</a>]                 </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                            EXPERIMENTAL</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Independent Submission                                          J. Touch
Request for Comments: 6978                                       USC/ISI
Category: Experimental                                         July 2013
ISSN: 2070-1721


        <span class="h1">A TCP Authentication Option Extension for NAT Traversal</span>

Abstract

   This document describes an extension to the TCP Authentication Option
   (TCP-AO) to support its use over connections that pass through
   Network Address Translators and/or Network Address and Port
   Translators (NATs/NAPTs).  This extension changes the data used to
   compute traffic keys, but it does not alter TCP-AO's packet
   processing or key generation algorithms.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for examination, experimental implementation, and
   evaluation.

   This document defines an Experimental Protocol for the Internet
   community.  This is a contribution to the RFC Series, independently
   of any other RFC stream.  The RFC Editor has chosen to publish this
   document at its discretion and makes no statement about its value for
   implementation or deployment.  Documents approved for publication by
   the RFC Editor are not a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6978">http://www.rfc-editor.org/info/rfc6978</a>.

Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.





<span class="grey">Touch                         Experimental                      [Page 1]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc6978.html">RFC 6978</a>                  TCP-AO NAT Extension                 July 2013</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
   <a href="#section-2">2</a>. Conventions Used in This Document ...............................<a href="#page-2">2</a>
   <a href="#section-3">3</a>. Background ......................................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. Extension to Allow NAT Traversal ................................<a href="#page-3">3</a>
   <a href="#section-5">5</a>. Intended Use ....................................................<a href="#page-4">4</a>
   <a href="#section-6">6</a>. Security Considerations .........................................<a href="#page-5">5</a>
   <a href="#section-7">7</a>. References ......................................................<a href="#page-5">5</a>
      <a href="#section-7.1">7.1</a>. Normative References .......................................<a href="#page-5">5</a>
      <a href="#section-7.2">7.2</a>. Informative References .....................................<a href="#page-5">5</a>
   <a href="#section-8">8</a>. Acknowledgments .................................................<a href="#page-6">6</a>

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   This document describes an extension to the TCP Authentication Option
   (TCP-AO) [<a href="rfc5925.html" title="&quot;The TCP Authentication Option&quot;">RFC5925</a>] called TCP-AO-NAT to support its use in the
   presence of Network Address Translators and/or Network Address and
   Port Translators (NATs/NAPTs) [<a href="rfc2663.html" title="&quot;IP Network Address Translator (NAT) Terminology and Considerations&quot;">RFC2663</a>].  These devices translate the
   source address and/or the source port number of a TCP connection.
   TCP-AO without TCP-AO-NAT extensions would be sensitive to these
   modifications and would discard authenticated segments.

   At least one potential application of TCP-AO-NAT is to support the
   experimental multipath TCP protocol [<a href="rfc6824.html" title="&quot;TCP Extensions for Multipath Operation with Multiple Addresses&quot;">RFC6824</a>], which uses multiple IP
   addresses to support a single TCP transfer.

   This document assumes detailed familiarity with TCP-AO [<a href="rfc5925.html" title="&quot;The TCP Authentication Option&quot;">RFC5925</a>].  As
   a preview, this document focuses on how TCP-AO generates traffic
   keys, and it does not otherwise alter the TCP-AO mechanism or that of
   its key generation [<a href="rfc5926.html" title="&quot;Cryptographic Algorithms for the TCP Authentication Option (TCP-AO)&quot;">RFC5926</a>].

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].
   When used in lower case, these words have their conventional meaning
   and do not convey the interpretations in <a href="rfc2119.html">RFC 2119</a>.












<span class="grey">Touch                         Experimental                      [Page 2]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc6978.html">RFC 6978</a>                  TCP-AO NAT Extension                 July 2013</span>


<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Background</span>

   TCP-AO generates traffic keys that are specific to a socket pair
   [<a href="rfc5925.html" title="&quot;The TCP Authentication Option&quot;">RFC5925</a>].  The following information is used to create a
   connection's traffic keys.  (Note that 'local' and 'remote' are
   interpreted as in TCP-AO [<a href="rfc5925.html" title="&quot;The TCP Authentication Option&quot;">RFC5925</a>].)

   o  IP local address

   o  IP remote address

   o  TCP local port

   o  TCP remote port

   o  TCP local Initial Sequence Number (ISN)

   o  TCP remote Initial Sequence Number (ISN)

   Of these fields, the remote ISN is not known for SYN segments and is
   excluded from the traffic key used to authenticate them.  Otherwise,
   all fields are used in the traffic keys of all other segments.

   NATs and NAPTs (both referred to herein as "NATs", even if port
   translation is included) would interfere with these uses, because
   they alter the IP address and TCP port of the endpoint behind the NAT
   [<a href="rfc2663.html" title="&quot;IP Network Address Translator (NAT) Terminology and Considerations&quot;">RFC2663</a>].

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Extension to Allow NAT Traversal</span>

   The premise of TCP-AO-NAT is that it might be useful to allow TCP-AO
   use in the presence of NATs, e.g., to protect client/server
   communication where clients are behind NATs.

   This document describes TCP-AO-NAT, an extension to TCP-AO that
   enables its use in the presence of NATs.  This extension requires no
   modification to the TCP-AO header or packet processing, and it
   requires no modification to the algorithms used to generate traffic
   keys [<a href="rfc5926.html" title="&quot;Cryptographic Algorithms for the TCP Authentication Option (TCP-AO)&quot;">RFC5926</a>].  The change is limited to the data used to generate
   traffic keys only.

   In TCP-AO, "a Master Key Tuple (MKT) describes the TCP-AO properties
   to be associated with one or more connections" [<a href="rfc5925.html" title="&quot;The TCP Authentication Option&quot;">RFC5925</a>].  This
   includes the TCP connection identifier, the TCP option flag
   (indicating whether TCP options other than TCP-AO are included in the






<span class="grey">Touch                         Experimental                      [Page 3]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc6978.html">RFC 6978</a>                  TCP-AO NAT Extension                 July 2013</span>


   Message Authentication Code (MAC) calculation), keying information,
   and other parameters.  TCP-AO-NAT augments the MKT with two
   additional flags:

   o  localNAT

   o  remoteNAT

   TCP-AO implementations supporting TCP-AO-NAT MUST support both
   localNAT and remoteNAT flags.

   These flags indicate whether a segment's local or remote
   (respectively) IP address and TCP port are zeroed before MAC
   calculation, either for creating the MAC to insert (for outgoing
   segments) or for calculating a MAC to validate against the value in
   the option.  These flags modify TCP-AO processing rules as follows:

   o  In TCP-AO-NAT, traffic keys are computed by zeroing the
      local/remote IP address and TCP port as indicated by the localNAT
      or remoteNAT flags.

   o  In TCP-AO-NAT, MAC values are computed by zeroing the local/remote
      IP address and TCP port as indicated by the localNAT or remoteNAT
      flags.

   The use of these flags needs to match on both ends of the connection,
   just as with all other MKT parameters.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Intended Use</span>

   A host MAY use TCP-AO-NAT when it is behind a NAT, as determined
   using NAT discovery techniques, or when TCP-AO protection is desired
   but conventional TCP-AO fails to establish connections.

   A client behind a NAT MAY set localNAT=TRUE for MKTs supporting
   TCP-AO-NAT for outgoing connections.  A server MAY set remoteNAT=TRUE
   for MKTs supporting TCP-AO-NAT for incoming connections.  Peer-to-
   peer applications with dual NAT support, e.g., those traversing
   so-called 'symmetric NATs' [<a href="rfc5389.html" title="&quot;Session Traversal Utilities for NAT (STUN)&quot;">RFC5389</a>], MAY set both localNAT=TRUE and
   remoteNAT=TRUE for MKTs supporting TCP-AO-NAT bidirectionally.  Once
   these flags are set in an MKT, they affect all connections that match
   that MKT.

   TCP-AO-NAT is intended for use only where coordinated between
   endpoints for connections that match the shared MKT parameters, as
   with all other MKT parameters.





<span class="grey">Touch                         Experimental                      [Page 4]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc6978.html">RFC 6978</a>                  TCP-AO NAT Extension                 July 2013</span>


   Note that TCP-AO-NAT is not intended for use with services transiting
   Application Layer Gateways (ALGs), i.e., NATs that also translate
   in-band addresses, such as used in FTP or SIP.  TCP-AO-NAT protects
   the contents of the TCP segments from modification and would
   (correctly) interpret such alterations as an attack on those
   contents.

<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Security Considerations</span>

   TCP-AO-NAT does not affect the security of connections that do not
   set either the localNAT or remoteNAT flags.  Such connections are not
   affected themselves and are not affected by segments in other
   connections that set those flags.

   Setting either the localNAT or remoteNAT flags reduces the randomness
   of the input to the Key Derivation Function (KDF) used to generate
   the traffic keys.  The largest impact occurs when using IPv4, which
   reduces the randomness from 2 IPv4 addresses, 2 ISNs, and both ports
   down to just the two ISNs when both flags are set.  The amount of
   randomness in the IPv4 addresses and service port is likely to be
   small, and the randomness of the dynamic port is under debate and
   should not be considered substantial [<a href="rfc6056.html" title="&quot;Recommendations for Transport- Protocol Port Randomization&quot;">RFC6056</a>].  The KDF input
   randomness is thus expected to be dominated by that of the ISNs, so
   reducing it by either or both of the IPv4 addresses and ports is not
   expected to have a significant impact.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  References</span>

<span class="h3"><a class="selflink" name="section-7.1" href="#section-7.1">7.1</a>.  Normative References</span>

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="http://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-RFC5925" id="ref-RFC5925">RFC5925</a>]  Touch, J., Mankin, A., and R. Bonica, "The TCP
              Authentication Option", <a href="rfc5925.html">RFC 5925</a>, June 2010.

<span class="h3"><a class="selflink" name="section-7.2" href="#section-7.2">7.2</a>.  Informative References</span>

   [<a name="ref-RFC2663" id="ref-RFC2663">RFC2663</a>]  Srisuresh, P. and M. Holdrege, "IP Network Address
              Translator (NAT) Terminology and Considerations",
              <a href="rfc2663.html">RFC 2663</a>, August 1999.

   [<a name="ref-RFC5389" id="ref-RFC5389">RFC5389</a>]  Rosenberg, J., Mahy, R., Matthews, P., and D. Wing,
              "Session Traversal Utilities for NAT (STUN)", <a href="rfc5389.html">RFC 5389</a>,
              October 2008.






<span class="grey">Touch                         Experimental                      [Page 5]</span>
</pre><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc6978.html">RFC 6978</a>                  TCP-AO NAT Extension                 July 2013</span>


   [<a name="ref-RFC5926" id="ref-RFC5926">RFC5926</a>]  Lebovitz, G. and E. Rescorla, "Cryptographic Algorithms
              for the TCP Authentication Option (TCP-AO)", <a href="rfc5926.html">RFC 5926</a>,
              June 2010.

   [<a name="ref-RFC6056" id="ref-RFC6056">RFC6056</a>]  Larsen, M. and F. Gont, "Recommendations for Transport-
              Protocol Port Randomization", <a href="http://tools.ietf.org/html/bcp156">BCP 156</a>, <a href="rfc6056.html">RFC 6056</a>,
              January 2011.

   [<a name="ref-RFC6824" id="ref-RFC6824">RFC6824</a>]  Ford, A., Raiciu, C., Handley, M., and O. Bonaventure,
              "TCP Extensions for Multipath Operation with Multiple
              Addresses", <a href="rfc6824.html">RFC 6824</a>, January 2013.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  Acknowledgments</span>

   This extension was inspired by discussions with Dan Wing.

   This document was initially prepared using 2-Word-v2.0.template.dot.

Author's Address

   Joe Touch
   USC/ISI
   4676 Admiralty Way
   Marina del Rey, CA 90292
   USA

   Phone: +1 (310) 448-9151
   EMail: touch@isi.edu























Touch                         Experimental                      [Page 6]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.107, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body>
<!-- Mirrored from tools.ietf.org/html/rfc6978 by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 19 Mar 2014 18:32:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
