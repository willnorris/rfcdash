<html><head></head><body><pre>Internet Engineering Task Force (IETF)                            J. Yao
Request for Comments: 6531                                        W. Mao
Obsoletes: <a href="./rfc5336">5336</a>                                                    CNNIC
Category: Standards Track                                  February 2012
ISSN: 2070-1721


               <span class="h1">SMTP Extension for Internationalized Email</span>

Abstract

   This document specifies an SMTP extension for transport and delivery
   of email messages with internationalized email addresses or header
   information.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6531">http://www.rfc-editor.org/info/rfc6531</a>.

Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow



<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.2">1.2</a>.  Changes Made to Other Specifications . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Overview of Operation  . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Mail Transport-Level Protocol  . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-3.1">3.1</a>.  Framework for the Internationalization Extension . . . . .  <a href="#page-4">4</a>
     <a href="#section-3.2">3.2</a>.  The SMTPUTF8 Extension . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-3.3">3.3</a>.  Extended Mailbox Address Syntax  . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-3.4">3.4</a>.  MAIL Command Parameter Usage . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-3.5">3.5</a>.  Non-ASCII Addresses and Reply-Codes  . . . . . . . . . . .  <a href="#page-9">9</a>
     <a href="#section-3.6">3.6</a>.  Body Parts and SMTP Extensions . . . . . . . . . . . . . .  <a href="#page-9">9</a>
     <a href="#section-3.7">3.7</a>.  Additional ESMTP Changes and Clarifications  . . . . . . . <a href="#page-10">10</a>
       <a href="#section-3.7.1">3.7.1</a>.  The Initial SMTP Exchange  . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#section-3.7.2">3.7.2</a>.  Mail eXchangers  . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#section-3.7.3">3.7.3</a>.  Trace Information  . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#section-3.7.4">3.7.4</a>.  UTF-8 Strings in Replies . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-4">4</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-4.1">4.1</a>.  SMTP Service Extensions Registry . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-4.2">4.2</a>.  SMTP Enhanced Status Code Registry . . . . . . . . . . . . <a href="#page-13">13</a>
     4.3.  WITH Protocol Types Sub-Registry of the Mail
           Transmission Types Registry  . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-5">5</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-6">6</a>.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-7">7</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-7.1">7.1</a>.  Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-7.2">7.2</a>.  Informative References . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>















<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   The document defines a Simple Mail Transfer Protocol [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>]
   extension so servers can advertise the ability to accept and process
   internationalized email addresses (see <a href="#section-1.1">Section 1.1</a>) and
   internationalized email headers [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>].

   An extended overview of the extension model for internationalized
   email addresses and the email header appears in <a href="./rfc6530">RFC 6530</a> [<a href="./rfc6530" title='"Overview and Framework for Internationalized Email"'>RFC6530</a>],
   referred to as "the framework document" in this specification.  A
   thorough understanding of the information in that document and in the
   base Internet email specifications [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>] [<a href="./rfc5322" title='"Internet Message Format"'>RFC5322</a>] is necessary
   to understand and implement this specification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="./rfc2119">RFC 2119</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The terms "UTF-8 string" or "UTF-8 character" are used to refer to
   Unicode characters, which may or may not be members of the ASCII
   subset, in UTF-8 [<a href="./rfc3629" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>], a standard Unicode Encoding Form.  All
   other specialized terms used in this specification are defined in the
   framework document or in the base Internet email specifications.  In
   particular, the terms "ASCII address", "internationalized email
   address", "non-ASCII address", "SMTPUTF8", "internationalized
   message", and "message" are used in this document according to the
   definitions in the framework document [<a href="./rfc6530" title='"Overview and Framework for Internationalized Email"'>RFC6530</a>].

   Strings referred to in this document, including ASCII strings, MUST
   be expressed in UTF-8.

   This specification uses Augmented BNF (ABNF) rules [<a href="./rfc5234" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>].  Some
   basic rules in this document are identified in <a href="#section-3.3">Section 3.3</a> as being
   defined (under the same names) in <a href="./rfc5234">RFC 5234</a> [<a href="./rfc5234" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>], <a href="./rfc5321">RFC 5321</a>
   [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>], <a href="./rfc5890">RFC 5890</a> [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>], or <a href="./rfc6532">RFC 6532</a> [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20Changes%20Made%20to%20Other%20Specifications"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Changes Made to Other Specifications</span>

   This specification extends some syntax rules defined in <a href="./rfc5321">RFC 5321</a> and
   permits internationalized email addresses in the envelope and in
   trace fields, but it does not modify <a href="./rfc5321">RFC 5321</a>.  It permits data
   formats defined in <a href="./rfc6532">RFC 6532</a> [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>], but it does not modify <a href="./rfc5322">RFC</a>
   <a href="./rfc5322">5322</a>.  It does require that the 8BITMIME extension [<a href="./rfc6152" title='"SMTP Service Extension for 8-bit MIME Transport"'>RFC6152</a>] be
   announced by the SMTPUTF8-aware SMTP server and used with
   "BODY=8BITMIME" by the SMTPUTF8-aware SMTP client, but it does not
   modify the 8BITMIME specification in any way.



<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   This specification replaces an earlier, experimental, approach to the
   same problem [<a href="./rfc5336" title='"SMTP Extension for Internationalized Email Addresses"'>RFC5336</a>].  <a href="./rfc6530#section-6">Section 6 of RFC 6530</a> [<a href="./rfc6530" title='"Overview and Framework for Internationalized Email"'>RFC6530</a>] describes
   the changes in approach between <a href="./rfc5336">RFC 5336</a> [<a href="./rfc5336" title='"SMTP Extension for Internationalized Email Addresses"'>RFC5336</a>] and this
   specification.  Anyone trying to convert an implementation from the
   experimental specification to the specification in this document will
   need to review those changes carefully.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Overview%20of%20Operation"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Overview of Operation</span>

   This document specifies an element of the email internationalization
   work, specifically the definition of an SMTP extension for
   internationalized email.  The extension is identified with the token
   "SMTPUTF8".

   The internationalized email headers specification [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>] provides
   the details of email header features enabled by this extension.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Mail%20Transport-Level%20Protocol"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Mail Transport-Level Protocol</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20Framework%20for%20the%20Internationalization%20Extension"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Framework for the Internationalization Extension</span>

   The following service extension is defined:

   1.   The name of the SMTP service extension is "Internationalized
        Email".

   2.   The EHLO keyword value associated with this extension is
        "SMTPUTF8".

   3.   No parameter values are defined for this EHLO keyword value.  In
        order to permit future (although unanticipated) extensions, the
        EHLO response MUST NOT contain any parameters for this keyword.
        The SMTPUTF8-aware SMTP client MUST ignore any parameters if
        they appear for this keyword; that is, the SMTPUTF8-aware SMTP
        client MUST behave as if the parameters do not appear.  If an
        SMTP server includes SMTPUTF8 in its EHLO response, it MUST be
        fully compliant with this version of this specification.

   4.   One OPTIONAL parameter, SMTPUTF8, is added to the MAIL command.
        The parameter does not accept a value.  If this parameter is set
        in the MAIL command, it indicates that the SMTP client is
        SMTPUTF8-aware.  Its presence also asserts that the envelope
        includes the non-ASCII address, the message being sent is an
        internationalized message, or the message being sent needs the
        SMTPUTF8 support.






<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   5.   The maximum length of a MAIL command line is increased by 10
        characters to accommodate the possible addition of the SMTPUTF8
        parameter.

   6.   One OPTIONAL parameter, SMTPUTF8, is added to the VERIFY (VRFY)
        and EXPAND (EXPN) commands.  The SMTPUTF8 parameter does not
        accept a value.  The parameter indicates that the SMTP client
        can accept Unicode characters in UTF-8 encoding in replies from
        the VRFY and EXPN commands.

   7.   No additional SMTP verbs are defined by this extension.

   8.   Servers offering this extension MUST provide support for, and
        announce, the 8BITMIME extension [<a href="./rfc6152" title='"SMTP Service Extension for 8-bit MIME Transport"'>RFC6152</a>].

   9.   The reverse-path and forward-path of the SMTP MAIL and RCPT
        commands are extended to allow Unicode characters encoded in
        UTF-8 in mailbox names (addresses).

   10.  The mail message body is extended as specified in <a href="./rfc6532">RFC 6532</a>
        [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>].

   11.  The SMTPUTF8 extension is valid on the submission port
        [<a href="./rfc6409" title='"Message Submission for Mail"'>RFC6409</a>].  It may also be used with the Local Mail Transfer
        Protocol (LMTP) [<a href="./rfc2033" title='"Local Mail Transfer Protocol"'>RFC2033</a>].  When these protocols are used, their
        use should be reflected in the trace field WITH keywords as
        appropriate [<a href="./rfc3848" title='"ESMTP and LMTP Transmission Types Registration"'>RFC3848</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20The%20SMTPUTF8%20Extension"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  The SMTPUTF8 Extension</span>

   An SMTP server that announces the SMTPUTF8 extension MUST be prepared
   to accept a UTF-8 string [<a href="./rfc3629" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] in any position in which <a href="./rfc5321">RFC 5321</a>
   specifies that a &lt;mailbox&gt; can appear.  Although the characters in
   the &lt;local-part&gt; are permitted to contain non-ASCII characters, the
   actual parsing of the &lt;local-part&gt; and the delimiters used are
   unchanged from the base email specification [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>].  Any domain
   name to be looked up in the DNS MUST conform to and be processed as
   specified for Internationalizing Domain Names in Applications (IDNA)
   [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>].  When doing lookups, the SMTPUTF8-aware SMTP client or
   server MUST either use a Unicode-aware DNS library, or transform the
   internationalized domain name to A-label form (i.e., a fully-
   qualified domain name that contains one or more A-labels but no
   U-labels) as specified in <a href="./rfc5890">RFC 5890</a> [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>].

   An SMTP client that receives the SMTPUTF8 extension keyword in
   response to the EHLO command MAY transmit mailbox names within SMTP
   commands as internationalized strings in UTF-8 form.  It MAY send a
   UTF-8 header [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>] (which may also include mailbox names in



<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   UTF-8).  It MAY transmit the domain parts of mailbox names within
   SMTP commands or the message header as A-labels or U-labels
   [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>].  The presence of the SMTPUTF8 extension does not change
   the server-relaying behaviors described in <a href="./rfc5321">RFC 5321</a>.

   If the SMTPUTF8 SMTP extension is not offered by the SMTP server, the
   SMTPUTF8-aware SMTP client MUST NOT transmit an internationalized
   email address and MUST NOT transmit a mail message containing
   internationalized mail headers as described in <a href="./rfc6532">RFC 6532</a> [<a href="./rfc6532" title='"Internationalized Email Headers"'>RFC6532</a>] at
   any level within its MIME structure [<a href="./rfc2045" title='"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"'>RFC2045</a>].  (For this paragraph,
   the internationalized domain name in A-label form as specified in
   IDNA definitions [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>] is not considered to be
   "internationalized".)  Instead, if an SMTPUTF8-aware SMTP client
   (sender) attempts to transfer an internationalized message and
   encounters an SMTP server that does not support the extension, the
   best action for it to take depends on other conditions.  In
   particular:

   o  If it is a Message Submission Agent (MSA) [<a href="./rfc6409" title='"Message Submission for Mail"'>RFC6409</a>] [<a href="./rfc5598" title='"Internet Mail Architecture"'>RFC5598</a>], it
      MAY choose its own way to deal with this scenario using the wide
      discretion for changing addresses or otherwise fixing up and
      transforming messages allowed by <a href="./rfc6409">RFC 6409</a>.  As long as the
      resulting message conforms to the requirements of <a href="./rfc5321">RFC 5321</a> (i.e.,
      without the SMTPUTF8 extension), the details of that
      transformation are outside the scope of this document.

   o  If it is not an MSA or is an MSA and does not choose to transform
      the message to one that does not require the SMTPUTF8 extension,
      it SHOULD reject the message.  As usual, this can be done either
      by generating an appropriate reply during the SMTP transaction or
      by accepting the message and then generating and transmitting a
      non-delivery notification.  If the latter choice is made, the
      notification process MUST conform to the requirements of <a href="./rfc5321">RFC 5321</a>,
      <a href="./rfc3464">RFC 3464</a> [<a href="./rfc3464" title='"An Extensible Message Format for Delivery Status Notifications"'>RFC3464</a>], and <a href="./rfc6533">RFC 6533</a> [<a href="./rfc6533" title='"Internationalized Delivery Status and Disposition Notifications"'>RFC6533</a>].

   o  As specified in <a href="./rfc5321#section-2.2.3">Section 2.2.3 of RFC 5321</a>, an SMTP client with
      additional information and/or knowledge of special circumstances
      MAY choose to requeue the message and try later and/or try an
      alternate MX host as specified in that section.

   This document applies when an SMTPUTF8-aware SMTP client or server
   supports the SMTPUTF8 extension.  For all other cases, and for
   addresses and messages that do not require an SMTPUTF8 extension,
   SMTPUTF8-aware SMTP clients and servers do not change the behavior
   specified in <a href="./rfc5321">RFC 5321</a> [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>].






<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   If an SMTPUTF8-aware SMTP server advertises the Delivery Status
   Notification (DSN) [<a href="./rfc3461" title='"Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)"'>RFC3461</a>] extension, it MUST implement <a href="./rfc6533">RFC 6533</a>
   [<a href="./rfc6533" title='"Internationalized Delivery Status and Disposition Notifications"'>RFC6533</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.3.%20%20Extended%20Mailbox%20Address%20Syntax"></a><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Extended Mailbox Address Syntax</span>

   <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>, defines the syntax of a &lt;Mailbox&gt; entirely
   in terms of ASCII characters.  This document extends &lt;Mailbox&gt; to add
   support of non-ASCII characters.

   The key changes made by this specification include:

   o  The &lt;Mailbox&gt; ABNF rule is imported from <a href="./rfc5321">RFC 5321</a> and updated in
      order to support the internationalized email address.  Other
      related rules are imported from <a href="./rfc5321">RFC 5321</a>, <a href="./rfc5234">RFC 5234</a>, <a href="./rfc5890">RFC 5890</a>, and
      <a href="./rfc6532">RFC 6532</a>, or are extended in this document.

   o  The definition of &lt;sub-domain&gt; is extended to permit both the <a href="./rfc5321">RFC</a>
      <a href="./rfc5321">5321</a> definition and a UTF-8 string in a DNS label that conforms
      with IDNA definitions [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>].

   o  The definition of &lt;atext&gt; is extended to permit both the <a href="./rfc5321">RFC 5321</a>
      definition and a UTF-8 string.  That string MUST NOT contain any
      of the ASCII graphics or control characters.

   The following ABNF rules imported from <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>, are
   updated directly or indirectly by this document:

   o  &lt;Mailbox&gt;

   o  &lt;Local-part&gt;

   o  &lt;Dot-string&gt;

   o  &lt;Quoted-string&gt;

   o  &lt;QcontentSMTP&gt;

   o  &lt;Domain&gt;

   o  &lt;Atom&gt;

   The following ABNF rule will be imported from <a href="./rfc6532#section-3.1">RFC 6532, Section 3.1</a>,
   directly:

   o  &lt;UTF8-non-ascii&gt;





<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   The following ABNF rule will be imported from <a href="./rfc5234#appendix-B.1">RFC 5234, Appendix B.1</a>,
   directly:

   o  &lt;DQUOTE&gt;

   The following ABNF rule will be imported from <a href="./rfc5890#section-2.3.2.1">RFC 5890, Section </a>
   <a href="#section-2.3.2.1">2.3.2.1</a>, directly:

   o  &lt;U-label&gt;

   The following rules are extended in ABNF [<a href="./rfc5234" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] as follows.

   sub-domain   =/  U-label
    ; extend the definition of sub-domain in <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>

   atext   =/  UTF8-non-ascii
    ; extend the implicit definition of atext in
    ; <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>, which ultimately points to
    ; the actual definition in <a href="./rfc5322#section-3.2.3">RFC 5322, Section 3.2.3</a>

   qtextSMTP  =/ UTF8-non-ascii
    ; extend the definition of qtextSMTP in <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>

   esmtp-value  =/ UTF8-non-ascii
    ; extend the definition of esmtp-value in <a href="./rfc5321#section-4.1.2">RFC 5321, Section 4.1.2</a>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.%20%20MAIL%20Command%20Parameter%20Usage"></a><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  MAIL Command Parameter Usage</span>

   If the envelope or message being sent requires the capabilities of
   the SMTPUTF8 extension, the SMTPUTF8-aware SMTP client MUST supply
   the SMTPUTF8 parameter with the MAIL command.  If this parameter is
   provided, it MUST not accept a value.  If the SMTPUTF8-aware SMTP
   client is aware that neither the envelope nor the message being sent
   requires any of the SMTPUTF8 extension capabilities, it SHOULD NOT
   supply the SMTPUTF8 parameter with the MAIL command.

   Because there is no guarantee that a next-hop SMTP server will
   support the SMTPUTF8 extension, use of the SMTPUTF8 extension always
   carries a risk of transmission failure.  In fact, during the early
   stages of deployment for the SMTPUTF8 extension, the risk will be
   quite high.  Hence, there is a distinct near-term advantage for
   ASCII-only messages to be sent without using this extension.  The
   long-term advantage of casting ASCII [<a href="#ref-ASCII" title='"USA Code for Information Interchange"'>ASCII</a>] characters (0x7f and
   below) as UTF-8 form is that it permits pure-Unicode environments.







<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.5.%20%20Non-ASCII%20Addresses%20and%20Reply-Codes"></a><a class="selflink" href="#section-3.5" id="section-3.5">3.5</a>.  Non-ASCII Addresses and Reply-Codes</span>

   An SMTPUTF8-aware SMTP client MUST NOT send an internationalized
   message to an SMTP server that does not support SMTPUTF8.  If the
   SMTP server does not support this option, then the SMTPUTF8-aware
   SMTP client has three choices according to <a href="#section-3.2">Section 3.2</a> of this
   specification.

   The three-digit reply-codes used in this section are based on their
   meanings as defined in <a href="./rfc5321">RFC 5321</a>.

   When messages are rejected because the RCPT command requires an ASCII
   address, the reply-code 553 is returned with the meaning "mailbox
   name not allowed".  When messages are rejected because the MAIL
   command requires an ASCII address, the reply-code 550 is returned
   with the meaning "mailbox unavailable".  When the SMTPUTF8-aware SMTP
   server supports enhanced mail system status codes [<a href="./rfc3463" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], reply-
   code "X.6.7" [<a href="./rfc5248" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>] (see <a href="#section-4">Section 4</a>) is used, meaning "Non-ASCII
   addresses not permitted for that sender/recipient".

   When messages are rejected for other reasons, the server follows the
   model of the base email specification in <a href="./rfc5321">RFC 5321</a>; this extension
   does not change those circumstances or reply messages.

   If a message is rejected after the final "." of the DATA command
   because one or more recipients are unable to accept and process a
   message with internationalized email headers, the reply-code "554" is
   used with the meaning "Transaction failed".  If the SMTPUTF8-aware
   SMTP server supports enhanced mail system status codes [<a href="./rfc3463" title='"Enhanced Mail System Status Codes"'>RFC3463</a>],
   reply code "X.6.9" [<a href="./rfc5248" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>] (see <a href="#section-4">Section 4</a>) is used to indicate this
   condition, meaning "UTF-8 header message cannot be transmitted to one
   or more recipients, so the message must be rejected".

   The SMTPUTF8-aware SMTP servers are encouraged to detect that
   recipients cannot accept internationalized messages and generate an
   error after the RCPT command rather than waiting until after the DATA
   command to issue an error.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.6.%20%20Body%20Parts%20and%20SMTP%20Extensions"></a><a class="selflink" href="#section-3.6" id="section-3.6">3.6</a>.  Body Parts and SMTP Extensions</span>

   The MAIL command parameter SMTPUTF8 asserts that a message is an
   internationalized message or the message being sent needs the
   SMTPUTF8 support.  There is still a chance that a message being sent
   via the MAIL command with the SMTPUTF8 parameter is not an
   internationalized message.  An SMTPUTF8-aware SMTP client or server
   that requires accurate knowledge of whether a message is
   internationalized needs to parse all message header fields and MIME




<span class="grey">Yao &amp; Mao                    Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   header fields [<a href="./rfc2045" title='"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"'>RFC2045</a>] in the message body.  However, this
   specification does not require that the SMTPUTF8-aware SMTP client or
   server inspects the message.

   Although this specification requires that SMTPUTF8-aware SMTP servers
   support the 8BITMIME extension [<a href="./rfc6152" title='"SMTP Service Extension for 8-bit MIME Transport"'>RFC6152</a>] to ensure that servers have
   adequate handling capability for 8-bit data, it does not require non-
   ASCII body parts in the MIME message as specified in <a href="./rfc2045">RFC 2045</a>.  The
   SMTPUTF8 extension MAY be used as follows (assuming it is appropriate
   given the body content):

   -  with the BODY=8BITMIME parameter [<a href="./rfc6152" title='"SMTP Service Extension for 8-bit MIME Transport"'>RFC6152</a>], or

   -  with the BODY=BINARYMIME parameter, if the SMTP server advertises
      BINARYMIME [<a href="./rfc3030" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>RFC3030</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.%20%20Additional%20ESMTP%20Changes%20and%20Clarifications"></a><a class="selflink" href="#section-3.7" id="section-3.7">3.7</a>.  Additional ESMTP Changes and Clarifications</span>

   The information carried in the mail transport process involves
   addresses ("mailboxes") and domain names in various contexts in
   addition to the MAIL and RCPT commands and extended alternatives to
   them.  In general, the rule is that, when <a href="./rfc5321">RFC 5321</a> specifies a
   mailbox, this SMTP extension requires UTF-8 form to be used for the
   entire string.  When <a href="./rfc5321">RFC 5321</a> specifies a domain name, the
   internationalized domain name SHOULD be in U-label form if the
   SMTPUTF8 extension is supported; otherwise, it SHOULD be in A-label
   form.

   The following subsections list and discuss all of the relevant cases.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.1.%20%20The%20Initial%20SMTP%20Exchange"></a><a class="selflink" href="#section-3.7.1" id="section-3.7.1">3.7.1</a>.  The Initial SMTP Exchange</span>

   When an SMTP connection is opened, the SMTP server sends a "greeting"
   response consisting of the 220 reply-code and some information.  The
   SMTP client then sends the EHLO command.  Since the SMTP client
   cannot know whether the SMTP server supports SMTPUTF8 until after it
   receives the response to the EHLO, the SMTPUTF8-aware SMTP client
   MUST send only ASCII (LDH label or A-label [<a href="./rfc5890" title='"Internationalizing Domain Names in Applications (IDNA definitions)"'>RFC5890</a>]) domains in the
   EHLO command.  If the SMTPUTF8-aware SMTP server provides domain
   names in the EHLO response, they MUST be in the form of LDH labels or
   A-labels.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.2.%20%20Mail%20eXchangers"></a><a class="selflink" href="#section-3.7.2" id="section-3.7.2">3.7.2</a>.  Mail eXchangers</span>

   If multiple DNS MX records are used to specify multiple servers for a
   domain (as described in <a href="./rfc5321#section-5">Section 5 of RFC 5321</a> [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>]), it is
   strongly advised that all or none of them SHOULD support the SMTPUTF8




<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   extension.  Otherwise, unexpected rejections can happen during
   temporary or permanent failures, which users might perceive as
   serious reliability issues.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.3.%20%20Trace%20Information"></a><a class="selflink" href="#section-3.7.3" id="section-3.7.3">3.7.3</a>.  Trace Information</span>

   The trace information &lt;Return-path-line&gt;, &lt;Time-stamp-line&gt;, and
   their related rules are defined in <a href="./rfc5321#section-4.4">Section 4.4 of RFC 5321</a> [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>].
   This document updates &lt;Mailbox&gt; and &lt;Domain&gt; to support non-ASCII
   characters.  When the SMTPUTF8 extension is used, the 'Reverse-path'
   clause of the Return-path-line may include an internationalized
   domain name that uses the U-label form.  Also, the 'Stamp' clause of
   the Time-stamp-line may include an internationalized domain name that
   uses the U-label form.

   If the messages that include trace fields are sent by an SMTPUTF8-
   aware SMTP client or relay server without the SMTPUTF8 parameter
   included in the MAIL commands, trace field values must conform to <a href="./rfc5321">RFC</a>
   <a href="./rfc5321">5321</a> regardless of the SMTP server's capability.

   When an SMTPUTF8-aware SMTP server adds a trace field to a message
   that was or will be transmitted with the SMTPUTF8 parameter included
   in the MAIL commands, that server SHOULD use the U-label form for
   internationalized domain names in the new trace field.

   The protocol value of the 'WITH' clause when this extension is used
   is one of the SMTPUTF8 values specified in the "IANA Considerations"
   section of this document.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.4.%20%20UTF-8%20Strings%20in%20Replies"></a><a class="selflink" href="#section-3.7.4" id="section-3.7.4">3.7.4</a>.  UTF-8 Strings in Replies</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.4.1.%20%20MAIL%20Command"></a><a class="selflink" href="#section-3.7.4.1" id="section-3.7.4.1">3.7.4.1</a>.  MAIL Command</span>

   If an SMTP client follows this specification and sends any MAIL
   commands containing the SMTPUTF8 parameter, the SMTPUTF8-aware SMTP
   server is permitted to use UTF-8 characters in the email address
   associated with 251 and 551 reply-codes, and the SMTP client MUST be
   able to accept and process them.  If a given MAIL command does not
   include the SMTPUTF8 parameter, the SMTPUTF8-aware SMTP server MUST
   NOT return a 251 or 551 response containing a non-ASCII mailbox.
   Instead, it MUST transform such responses into 250 or 550 responses
   that do not contain non-ASCII addresses.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.4.2.%20%20VRFY%20and%20EXPN%20Commands%20and%20the%20SMTPUTF8%20Parameter"></a><a class="selflink" href="#section-3.7.4.2" id="section-3.7.4.2">3.7.4.2</a>.  VRFY and EXPN Commands and the SMTPUTF8 Parameter</span>

   If the SMTPUTF8 parameter is transmitted with the VRFY and EXPN
   commands, it indicates that the SMTP client can accept UTF-8 strings
   in replies to those commands.  The parameter with the VRFY and EXPN



<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   commands SHOULD only be used after the SMTP client sees the EHLO
   response with the SMTPUTF8 keyword.  This allows an SMTPUTF8-aware
   SMTP server to use UTF-8 strings in mailbox names and full names that
   occur in replies, without concern that the SMTP client might be
   confused by them.  An SMTP client that conforms to this specification
   MUST accept and correctly process replies to the VRFY and EXPN
   commands that contain UTF-8 strings.  However, an SMTPUTF8-aware SMTP
   server MUST NOT use UTF-8 strings in replies if the SMTP client does
   not specifically allow such replies by transmitting this parameter
   with the VRFY and EXPN commands.

   Most replies do not require that a mailbox name be included in the
   returned text, and therefore a UTF-8 string is not needed in them.
   Some replies, notably those resulting from successful execution of
   the VRFY and EXPN commands, do include the mailbox.

   VERIFY (VRFY) and EXPAND (EXPN) command syntaxes are changed to:

   vrfy = "VRFY" SP String
     [ SP "SMTPUTF8" ] CRLF
    ; String may include Non-ASCII characters

   expn = "EXPN" SP String
     [ SP "SMTPUTF8" ] CRLF
    ; String may include Non-ASCII characters

   The SMTPUTF8 parameter does not accept a value.  If the reply to a
   VRFY or EXPN command requires a UTF-8 string, but the SMTP client did
   not use the SMTPUTF8 parameter, then the SMTPUTF8-aware SMTP server
   MUST use either the reply-code 252 or 550.  Reply-code 252, defined
   in <a href="./rfc5321">RFC 5321</a> [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>], means "Cannot VRFY user, but will accept the
   message and attempt the delivery".  Reply-code 550, also defined in
   <a href="./rfc5321">RFC 5321</a> [<a href="./rfc5321" title='"Simple Mail Transfer Protocol"'>RFC5321</a>], means "Requested action not taken: mailbox
   unavailable".  When the SMTPUTF8-aware SMTP server supports enhanced
   mail system status codes [<a href="./rfc3463" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], the enhanced reply-code as
   specified below is used.  Using the SMTPUTF8 parameter with a VRFY or
   EXPN command enables UTF-8 replies for that command only.

   If a normal success response (i.e., 250) is returned, the response
   MAY include the full name of the user and MUST include the mailbox of
   the user.  It MUST be in either of the following forms:

   User Name &lt;Mailbox&gt;
    ; Mailbox is defined in <a href="#section-3.3">Section 3.3</a> of this document.
    ; User Name can contain non-ASCII characters.

   Mailbox
    ; Mailbox is defined in <a href="#section-3.3">Section 3.3</a> of this document.



<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   If the SMTP reply requires UTF-8 strings, but a UTF-8 string is not
   allowed in the reply, and the SMTPUTF8-aware SMTP server supports
   enhanced mail system status codes [<a href="./rfc3463" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], the enhanced reply-code
   is "X.6.8" [<a href="./rfc5248" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>] (see <a href="#section-4">Section 4</a>), meaning "A reply containing a
   UTF-8 string is required to show the mailbox name, but that form of
   response is not permitted by the SMTP client".

   If the SMTP client does not support the SMTPUTF8 extension, but
   receives a UTF-8 string in a reply, it may not be able to properly
   report the reply to the user, and some clients might mishandle that
   reply.  Internationalized messages in replies are only allowed in the
   commands under the situations described above.

   Although UTF-8 strings are needed to represent email addresses in
   responses under the rules specified in this section, this extension
   does not permit the use of UTF-8 strings for any other purposes.
   SMTPUTF8-aware SMTP servers MUST NOT include non-ASCII characters in
   replies except in the limited cases specifically permitted in this
   section.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20SMTP%20Service%20Extensions%20Registry"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  SMTP Service Extensions Registry</span>

   IANA has added a new value "SMTPUTF8" to the "SMTP Service Extension"
   registry of the "Mail Parameters" registry, according to the
   following data:

        +----------+---------------------------------+-----------+
        | Keywords | Description                     | Reference |
        +----------+---------------------------------+-----------+
        | SMTPUTF8 | Internationalized email address | [<a href="./rfc6531">RFC6531</a>] |
        +----------+---------------------------------+-----------+

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20SMTP%20Enhanced%20Status%20Code%20Registry"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  SMTP Enhanced Status Code Registry</span>

   The code definitions in this document replace those specified in <a href="./rfc5336">RFC</a>
   <a href="./rfc5336">5336</a>, following the guidance in Sections <a href="#section-3.5">3.5</a> and <a href="#section-3.7.4.2">3.7.4.2</a> of this
   document, and based on <a href="./rfc5248">RFC 5248</a> [<a href="./rfc5248" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>].  IANA has updated the
   "Simple Mail Transfer Protocol (SMTP) Enhanced Status Code Registry"
   with the following data:










<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


    Code:        X.6.7
    Sample Text: Non-ASCII addresses not permitted for that
                 sender/recipient
    Associated basic status code: 550, 553
    Description: This indicates the reception of a MAIL or RCPT command
                 that non-ASCII addresses are not permitted.
    Defined:     <a href="./rfc6531">RFC 6531</a> (Standards Track)
    Submitter:   Jiankang YAO
    Change controller: ima@ietf.org


    Code:        X.6.8
    Sample Text: UTF-8 string reply is required, but not permitted by
                 the SMTP client
    Associated basic status code: 252, 550, 553
    Description: This indicates that a reply containing a UTF-8 string
                 is required to show the mailbox name, but that form of
                 response is not permitted by the SMTP client.
    Defined:     <a href="./rfc6531">RFC 6531</a> (Standards Track)
    Submitter:   Jiankang YAO
    Change controller: ima@ietf.org


    Code:        X.6.9
    Sample Text: UTF-8 header message cannot be transferred to one or
                 more recipients, so the message must be rejected
    Associated basic status code: 550
    Description: This indicates that transaction failed after the
                 final "." of the DATA command.
    Defined:     <a href="./rfc6531">RFC 6531</a> (Standards Track)
    Submitter:   Jiankang YAO
    Change controller: ima@ietf.org


    Code:        X.6.10
    Description: This is a duplicate of X.6.8 and is thus deprecated.















<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20WITH%20Protocol%20Types%20Sub-Registry%20of%20the%20Mail%20Transmission%20Types"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  WITH Protocol Types Sub-Registry of the Mail Transmission Types</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/Registry"></a>      Registry</span>

   IANA has modified or added the following entries in the "WITH
   protocol types" sub-registry under the "Mail Transmission Types"
   registry.

   +--------------+------------------------------+---------------------+
   | WITH         | Description                  | Reference           |
   | protocol     |                              |                     |
   | types        |                              |                     |
   +--------------+------------------------------+---------------------+
   | UTF8SMTP     | ESMTP with SMTPUTF8          | [<a href="./rfc6531">RFC6531</a>]           |
   | UTF8SMTPA    | ESMTP with SMTPUTF8 and AUTH | [<a href="./rfc4954" title='"SMTP Service Extension for Authentication"'>RFC4954</a>] [<a href="./rfc6531">RFC6531</a>] |
   | UTF8SMTPS    | ESMTP with SMTPUTF8 and      | [<a href="./rfc3207" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="./rfc6531">RFC6531</a>] |
   |              | STARTTLS                     |                     |
   | UTF8SMTPSA   | ESMTP with SMTPUTF8 and both | [<a href="./rfc3207" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="./rfc4954" title='"SMTP Service Extension for Authentication"'>RFC4954</a>] |
   |              | STARTTLS and AUTH            | [<a href="./rfc6531">RFC6531</a>]           |
   | UTF8LMTP     | LMTP with SMTPUTF8           | [<a href="./rfc6531">RFC6531</a>]           |
   | UTF8LMTPA    | LMTP with SMTPUTF8 and AUTH  | [<a href="./rfc4954" title='"SMTP Service Extension for Authentication"'>RFC4954</a>] [<a href="./rfc6531">RFC6531</a>] |
   | UTF8LMTPS    | LMTP with SMTPUTF8 and       | [<a href="./rfc3207" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="./rfc6531">RFC6531</a>] |
   |              | STARTTLS                     |                     |
   | UTF8LMTPSA   | LMTP with SMTPUTF8 and both  | [<a href="./rfc3207" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="./rfc4954" title='"SMTP Service Extension for Authentication"'>RFC4954</a>] |
   |              | STARTTLS and AUTH            | [<a href="./rfc6531">RFC6531</a>]           |
   +--------------+------------------------------+---------------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Security Considerations</span>

   The extended security considerations discussion in the framework
   document [<a href="./rfc6530" title='"Overview and Framework for Internationalized Email"'>RFC6530</a>] applies here.

   More security considerations are discussed below:

   Beyond the use inside the email global system (in SMTP envelopes and
   message headers), internationalized email addresses will also show up
   inside other cases, in particular:

   o  the logging systems of SMTP transactions and other logs to monitor
      the email systems;

   o  the trouble ticket systems used by security teams to manage
      security incidents, when an email address is involved;

   In order to avoid problems that could cause loss of data, this will
   likely require extending these systems to support full UTF-8, or
   require providing an adequate mechanism for mapping non-ASCII strings
   to ASCII.




<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   Another security aspect to be considered is related to the ability by
   security team members to quickly understand, read, and identify email
   addresses from the logs, when they are tracking an incident.
   Mechanisms to automatically and quickly provide the origin or
   ownership of an internationalized email address SHALL be implemented
   for use by log readers that cannot easily read non-ASCII information.

   The SMTP commands VRFY and EXPN are sometimes used in SMTP
   transactions where there is no message to transfer (by tools used to
   take automated actions in case potential spam messages are
   identified).  Sections <a href="#section-3.5">3.5</a> and <a href="#section-7.3">7.3</a> of <a href="./rfc5321">RFC 5321</a> give detailed
   descriptions of use and possible behaviors.  Implementation of
   internationalized addresses can also affect logs and actions by these
   tools.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Acknowledgements"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Acknowledgements</span>

   This document revises <a href="./rfc5336">RFC 5336</a> [<a href="./rfc5336" title='"SMTP Extension for Internationalized Email Addresses"'>RFC5336</a>] based on the result of the
   Email Address Internationalization (EAI) working group's discussion.
   Many EAI working group members did tests and implementations to move
   this document to the Standards Track.  Significant comments and
   suggestions were received from Xiaodong LEE, Nai-Wen HSU, Yangwoo KO,
   Yoshiro YONEYA, and other members of JET and were incorporated into
   the specification.  Additional important comments and suggestions,
   and often specific text, were contributed by many members of the
   working group and design team.  Those contributions include material
   from John C. Klensin, Charles Lindsey, Dave Crocker, Harald Tveit
   Alvestrand, Marcos Sanz, Chris Newman, Martin Duerst, Edmon Chung,
   Tony Finch, Kari Hurtta, Randall Gellens, Frank Ellermann, Alexey
   Melnikov, Pete Resnick, S. Moonesamy, Soobok Lee, Shawn Steele,
   Alfred Hoenes, Miguel Garcia, Magnus Westerlund, Joseph Yee, and Lars
   Eggert.  Of course, none of the individuals are necessarily
   responsible for the combination of ideas represented here.

   Thanks a lot to Dave Crocker for his comments and helping with ABNF
   refinement.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20References"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Normative%20References"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-ASCII">ASCII</a>]    American National Standards Institute  (formerly United
              States of America Standards Institute), "USA Code for
              Information Interchange", ANSI X3.4-1968, 1968.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.




<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


   [<a id="ref-RFC3461">RFC3461</a>]  Moore, K., "Simple Mail Transfer Protocol (SMTP) Service
              Extension for Delivery Status Notifications (DSNs)",
              <a href="./rfc3461">RFC 3461</a>, January 2003.

   [<a id="ref-RFC3463">RFC3463</a>]  Vaudreuil, G., "Enhanced Mail System Status Codes",
              <a href="./rfc3463">RFC 3463</a>, January 2003.

   [<a id="ref-RFC3464">RFC3464</a>]  Moore, K. and G. Vaudreuil, "An Extensible Message Format
              for Delivery Status Notifications", <a href="./rfc3464">RFC 3464</a>,
              January 2003.

   [<a id="ref-RFC3629">RFC3629</a>]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", <a href="./rfc3629">RFC 3629</a>, November 2003.

   [<a id="ref-RFC3848">RFC3848</a>]  Newman, C., "ESMTP and LMTP Transmission Types
              Registration", <a href="./rfc3848">RFC 3848</a>, July 2004.

   [<a id="ref-RFC5234">RFC5234</a>]  Crocker, D. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, <a href="./rfc5234">RFC 5234</a>, January 2008.

   [<a id="ref-RFC5248">RFC5248</a>]  Hansen, T. and J. Klensin, "A Registry for SMTP Enhanced
              Mail System Status Codes", <a href="./rfc5248">RFC 5248</a>, June 2008.

   [<a id="ref-RFC5321">RFC5321</a>]  Klensin, J., "Simple Mail Transfer Protocol", <a href="./rfc5321">RFC 5321</a>,
              October 2008.

   [<a id="ref-RFC5322">RFC5322</a>]  Resnick, P., Ed., "Internet Message Format", <a href="./rfc5322">RFC 5322</a>,
              October 2008.

   [<a id="ref-RFC5890">RFC5890</a>]  Klensin, J., "Internationalizing Domain Names in
              Applications (IDNA definitions)", <a href="./rfc5890">RFC 5890</a>, June 2010.

   [<a id="ref-RFC6152">RFC6152</a>]  Klensin, J., Freed, N., Rose, M., and D. Crocker, "SMTP
              Service Extension for 8-bit MIME Transport", STD 71,
              <a href="./rfc6152">RFC 6152</a>, March 2011.

   [<a id="ref-RFC6409">RFC6409</a>]  Gellens, R. and J. Klensin, "Message Submission for Mail",
              STD 72, <a href="./rfc6409">RFC 6409</a>, November 2011.

   [<a id="ref-RFC6530">RFC6530</a>]  Klensin, J. and Y. Ko, "Overview and Framework for
              Internationalized Email", <a href="./rfc6530">RFC 6530</a>, February 2012.

   [<a id="ref-RFC6532">RFC6532</a>]  Yang, A., Steele, S., and N. Freed, "Internationalized
              Email Headers", <a href="./rfc6532">RFC 6532</a>, February 2012.

   [<a id="ref-RFC6533">RFC6533</a>]  Hansen, T., Ed., Newman, C., and A. Melnikov, Ed.,
              "Internationalized Delivery Status and Disposition
              Notifications", RFC <a href="./rfc6533">RFC6533</a>, February 2012.



<span class="grey">Yao &amp; Mao                    Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc6531">RFC 6531</a>               SMTP Extension for SMTPUTF8         February 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20Informative%20References"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC2033">RFC2033</a>]  Myers, J., "Local Mail Transfer Protocol", <a href="./rfc2033">RFC 2033</a>,
              October 1996.

   [<a id="ref-RFC2045">RFC2045</a>]  Freed, N. and N. Borenstein, "Multipurpose Internet Mail
              Extensions (MIME) Part One: Format of Internet Message
              Bodies", <a href="./rfc2045">RFC 2045</a>, November 1996.

   [<a id="ref-RFC3030">RFC3030</a>]  Vaudreuil, G., "SMTP Service Extensions for Transmission
              of Large and Binary MIME Messages", <a href="./rfc3030">RFC 3030</a>,
              December 2000.

   [<a id="ref-RFC3207">RFC3207</a>]  Hoffman, P., "SMTP Service Extension for Secure SMTP over
              Transport Layer Security", <a href="./rfc3207">RFC 3207</a>, February 2002.

   [<a id="ref-RFC4954">RFC4954</a>]  Siemborski, R. and A. Melnikov, "SMTP Service Extension
              for Authentication", <a href="./rfc4954">RFC 4954</a>, July 2007.

   [<a id="ref-RFC5336">RFC5336</a>]  Yao, J. and W. Mao, "SMTP Extension for Internationalized
              Email Addresses", <a href="./rfc5336">RFC 5336</a>, September 2008.

   [<a id="ref-RFC5598">RFC5598</a>]  Crocker, D., "Internet Mail Architecture", <a href="./rfc5598">RFC 5598</a>,
              July 2009.

Authors' Addresses

   Jiankang YAO
   CNNIC
   No.4 South 4th Street, Zhongguancun
   Beijing
   China

   Phone: +86 10 58813007
   EMail: yaojk@cnnic.cn


   Wei MAO
   CNNIC
   No.4 South 4th Street, Zhongguancun
   Beijing
   China

   Phone: +86 10 58812230
   EMail: maowei_ietf@cnnic.cn






Yao &amp; Mao                    Standards Track                   [Page 18]
</pre>
</body></html>