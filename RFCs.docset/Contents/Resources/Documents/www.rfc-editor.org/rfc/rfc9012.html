<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9012: The BGP Tunnel Encapsulation Attribute</title>
<meta content="Keyur Patel" name="author"/>
<meta content="Gunter Van de Velde" name="author"/>
<meta content="Srihari R. Sangli" name="author"/>
<meta content="John Scudder" name="author"/>
<meta content='
       
 This document defines a BGP path attribute known as the
 "Tunnel Encapsulation attribute", which can be used with 
 BGP UPDATEs of various Subsequent Address Family Identifiers (SAFIs) to provide information needed 
 to create tunnels and their corresponding encapsulation 
 headers. It provides encodings for a number of tunnel types,
 along with procedures for choosing between alternate tunnels
 and routing packets into tunnels. 
       This document obsoletes RFC 5512, which provided an earlier
 definition of the Tunnel Encapsulation attribute. RFC 5512 was never
 deployed in production. Since RFC 5566 relies on RFC 5512, it is
 likewise obsoleted. This document updates RFC 5640 by indicating
 that the Load-Balancing Block sub-TLV may be included in any Tunnel
 Encapsulation attribute where load balancing is desired. 
    ' name="description"/>
<meta content="xml2rfc 3.7.0" name="generator"/>
<meta content="BGP" name="keyword"/>
<meta content="9012" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.7.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.3.5
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.19.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 40.6.2
    six 1.14.0
    WeasyPrint 51
-->
<link href="rfc9012.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9012" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-idr-tunnel-encaps-22" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9012</td>
<td class="center">Tunnel Encapsulation Attribute</td>
<td class="right">April 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Patel, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9012">9012</a></dd>
<dt class="label-obsoletes">Obsoletes:</dt>
<dd class="obsoletes">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc5512">5512</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc5566">5566</a> </dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc5640">5640</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2021-04">April 2021</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">K. Patel</div>
<div class="org">Arrcus, Inc</div>
</div>
<div class="author">
      <div class="author-name">G. Van de Velde</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Sangli</div>
<div class="org">Juniper Networks</div>
</div>
<div class="author">
      <div class="author-name">J. Scudder</div>
<div class="org">Juniper Networks</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9012</h1>
<h1 id="title">The BGP Tunnel Encapsulation Attribute</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">
 This document defines a BGP path attribute known as the
 "Tunnel Encapsulation attribute", which can be used with 
 BGP UPDATEs of various Subsequent Address Family Identifiers (SAFIs) to provide information needed 
 to create tunnels and their corresponding encapsulation 
 headers. It provides encodings for a number of tunnel types,
 along with procedures for choosing between alternate tunnels
 and routing packets into tunnels.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
<p id="section-abstract-2">This document obsoletes RFC 5512, which provided an earlier
 definition of the Tunnel Encapsulation attribute. RFC 5512 was never
 deployed in production. Since RFC 5566 relies on RFC 5512, it is
 likewise obsoleted. This document updates RFC 5640 by indicating
 that the Load-Balancing Block sub-TLV may be included in any Tunnel
 Encapsulation attribute where load balancing is desired.<a class="pilcrow" href="#section-abstract-2">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9012">https://www.rfc-editor.org/info/rfc9012</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="xref" href="#section-1.1">1.1</a>.  <a class="xref" href="#name-brief-summary-of-rfc-5512">Brief Summary of RFC 5512</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.1.2.2">
                <p class="keepWithNext" id="section-toc.1-1.1.2.2.1"><a class="xref" href="#section-1.2">1.2</a>.  <a class="xref" href="#name-deficiencies-in-rfc-5512">Deficiencies in RFC 5512</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.1.2.3">
                <p class="keepWithNext" id="section-toc.1-1.1.2.3.1"><a class="xref" href="#section-1.3">1.3</a>.  <a class="xref" href="#name-use-case-for-the-tunnel-enc">Use Case for the Tunnel Encapsulation Attribute</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a class="xref" href="#section-1.4">1.4</a>.  <a class="xref" href="#name-brief-summary-of-changes-fr">Brief Summary of Changes from RFC 5512</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a class="xref" href="#section-1.5">1.5</a>.  <a class="xref" href="#name-update-to-rfc-5640">Update to RFC 5640</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.1.2.6">
                <p id="section-toc.1-1.1.2.6.1"><a class="xref" href="#section-1.6">1.6</a>.  <a class="xref" href="#name-effects-of-obsoleting-rfc-5">Effects of Obsoleting RFC 5566</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-the-tunnel-encapsulation-at">The Tunnel Encapsulation Attribute</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-tunnel-encapsulation-attrib">Tunnel Encapsulation Attribute Sub-TLVs</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="xref" href="#section-3.1">3.1</a>.  <a class="xref" href="#name-the-tunnel-egress-endpoint-">The Tunnel Egress Endpoint Sub-TLV (Type Code 6)</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a class="xref" href="#section-3.1.1">3.1.1</a>.  <a class="xref" href="#name-validating-the-address-subf">Validating the Address Subfield</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="xref" href="#section-3.2">3.2</a>.  <a class="xref" href="#name-encapsulation-sub-tlvs-for-">Encapsulation Sub-TLVs for Particular Tunnel Types (Type Code 1)</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a class="xref" href="#section-3.2.1">3.2.1</a>.  <a class="xref" href="#name-vxlan-tunnel-type-8">VXLAN (Tunnel Type 8)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a class="xref" href="#section-3.2.2">3.2.2</a>.  <a class="xref" href="#name-nvgre-tunnel-type-9">NVGRE (Tunnel Type 9)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a class="xref" href="#section-3.2.3">3.2.3</a>.  <a class="xref" href="#name-l2tpv3-tunnel-type-1">L2TPv3 (Tunnel Type 1)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a class="xref" href="#section-3.2.4">3.2.4</a>.  <a class="xref" href="#name-gre-tunnel-type-2">GRE (Tunnel Type 2)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a class="xref" href="#section-3.2.5">3.2.5</a>.  <a class="xref" href="#name-mpls-in-gre-tunnel-type-11">MPLS-in-GRE (Tunnel Type 11)</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a class="xref" href="#section-3.3">3.3</a>.  <a class="xref" href="#name-outer-encapsulation-sub-tlv">Outer Encapsulation Sub-TLVs</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a class="xref" href="#section-3.3.1">3.3.1</a>.  <a class="xref" href="#name-ds-field-type-code-7">DS Field (Type Code 7)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a class="xref" href="#section-3.3.2">3.3.2</a>.  <a class="xref" href="#name-udp-destination-port-type-c">UDP Destination Port (Type Code 8)</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a class="xref" href="#section-3.4">3.4</a>.  <a class="xref" href="#name-sub-tlvs-for-aiding-tunnel-">Sub-TLVs for Aiding Tunnel Selection</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a class="xref" href="#section-3.4.1">3.4.1</a>.  <a class="xref" href="#name-protocol-type-sub-tlv-type-">Protocol Type Sub-TLV (Type Code 2)</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a class="xref" href="#section-3.4.2">3.4.2</a>.  <a class="xref" href="#name-color-sub-tlv-type-code-4">Color Sub-TLV (Type Code 4)</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a class="xref" href="#section-3.5">3.5</a>.  <a class="xref" href="#name-embedded-label-handling-sub">Embedded Label Handling Sub-TLV (Type Code 9)</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a class="xref" href="#section-3.6">3.6</a>.  <a class="xref" href="#name-mpls-label-stack-sub-tlv-ty">MPLS Label Stack Sub-TLV (Type Code 10)</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a class="xref" href="#section-3.7">3.7</a>.  <a class="xref" href="#name-prefix-sid-sub-tlv-type-cod">Prefix-SID Sub-TLV (Type Code 11)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-extended-communities-relate">Extended Communities Related to the Tunnel Encapsulation Attribute</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="xref" href="#section-4.1">4.1</a>.  <a class="xref" href="#name-encapsulation-extended-comm">Encapsulation Extended Community</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="xref" href="#section-4.2">4.2</a>.  <a class="xref" href="#name-routers-mac-extended-commun">Router's MAC Extended Community</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="xref" href="#section-4.3">4.3</a>.  <a class="xref" href="#name-color-extended-community">Color Extended Community</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-special-considerations-for-">Special Considerations for IP-in-IP Tunnels</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-semantics-and-usage-of-the-">Semantics and Usage of the Tunnel Encapsulation Attribute</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-routing-considerations">Routing Considerations</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="xref" href="#section-7.1">7.1</a>.  <a class="xref" href="#name-impact-on-the-bgp-decision-">Impact on the BGP Decision Process</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="xref" href="#section-7.2">7.2</a>.  <a class="xref" href="#name-looping-mutual-recursion-et">Looping, Mutual Recursion, Etc.</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#section-8">8</a>.  <a class="xref" href="#name-recursive-next-hop-resoluti">Recursive Next-Hop Resolution</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#section-9">9</a>.  <a class="xref" href="#name-use-of-virtual-network-iden">Use of Virtual Network Identifiers and Embedded Labels When Imposing a Tunnel Encapsulation</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="xref" href="#section-9.1">9.1</a>.  <a class="xref" href="#name-tunnel-types-without-a-virt">Tunnel Types without a Virtual Network Identifier Field</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="xref" href="#section-9.2">9.2</a>.  <a class="xref" href="#name-tunnel-types-with-a-virtual">Tunnel Types with a Virtual Network Identifier Field</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.9.2.2.2.1">
                    <p id="section-toc.1-1.9.2.2.2.1.1"><a class="xref" href="#section-9.2.1">9.2.1</a>.  <a class="xref" href="#name-unlabeled-address-families">Unlabeled Address Families</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.9.2.2.2.2">
                    <p id="section-toc.1-1.9.2.2.2.2.1"><a class="xref" href="#section-9.2.2">9.2.2</a>.  <a class="xref" href="#name-labeled-address-families">Labeled Address Families</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#section-10">10</a>. <a class="xref" href="#name-applicability-restrictions">Applicability Restrictions</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="xref" href="#section-11">11</a>. <a class="xref" href="#name-scoping">Scoping</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="xref" href="#section-12">12</a>. <a class="xref" href="#name-operational-considerations">Operational Considerations</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="xref" href="#section-13">13</a>. <a class="xref" href="#name-validation-and-error-handli">Validation and Error Handling</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a class="xref" href="#section-14">14</a>. <a class="xref" href="#name-iana-considerations">IANA Considerations</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a class="xref" href="#section-14.1">14.1</a>.  <a class="xref" href="#name-obsoleting-rfc-5512">Obsoleting RFC 5512</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a class="xref" href="#section-14.2">14.2</a>.  <a class="xref" href="#name-obsoleting-code-points-assi">Obsoleting Code Points Assigned by RFC 5566</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a class="xref" href="#section-14.3">14.3</a>.  <a class="xref" href="#name-border-gateway-protocol-bgp">Border Gateway Protocol (BGP) Tunnel Encapsulation Grouping</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a class="xref" href="#section-14.4">14.4</a>.  <a class="xref" href="#name-bgp-tunnel-encapsulation-at">BGP Tunnel Encapsulation Attribute Tunnel Types</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.5">
                <p id="section-toc.1-1.14.2.5.1"><a class="xref" href="#section-14.5">14.5</a>.  <a class="xref" href="#name-subsequent-address-family-i">Subsequent Address Family Identifiers</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.6">
                <p id="section-toc.1-1.14.2.6.1"><a class="xref" href="#section-14.6">14.6</a>.  <a class="xref" href="#name-bgp-tunnel-encapsulation-att">BGP Tunnel Encapsulation Attribute Sub-TLVs</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.7">
                <p id="section-toc.1-1.14.2.7.1"><a class="xref" href="#section-14.7">14.7</a>.  <a class="xref" href="#name-flags-field-of-vxlan-encaps">Flags Field of VXLAN Encapsulation Sub-TLV</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.8">
                <p id="section-toc.1-1.14.2.8.1"><a class="xref" href="#section-14.8">14.8</a>.  <a class="xref" href="#name-flags-field-of-nvgre-encaps">Flags Field of NVGRE Encapsulation Sub-TLV</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.9">
                <p id="section-toc.1-1.14.2.9.1"><a class="xref" href="#section-14.9">14.9</a>.  <a class="xref" href="#name-embedded-label-handling-sub-t">Embedded Label Handling Sub-TLV</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.14.2.10">
                <p id="section-toc.1-1.14.2.10.1"><a class="xref" href="#section-14.10">14.10</a>. <a class="xref" href="#name-color-extended-community-fl">Color Extended Community Flags</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a class="xref" href="#section-15">15</a>. <a class="xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a class="xref" href="#section-16">16</a>. <a class="xref" href="#name-references">References</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a class="xref" href="#section-16.1">16.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a class="xref" href="#section-16.2">16.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a class="xref" href="#section-appendix.a">Appendix A</a>.  <a class="xref" href="#name-impact-on-rfc-8365">Impact on RFC 8365</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a class="xref" href="#section-appendix.b"></a><a class="xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a class="xref" href="#section-appendix.c"></a><a class="xref" href="#name-contributors">Contributors</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a class="xref" href="#section-appendix.d"></a><a class="xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">
   This document obsoletes <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>.  The deficiencies of <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>, and
   a summary of the changes made, are discussed in Sections <a class="xref" href="#summary">1.1</a>-<a class="xref" href="#use-case">1.3</a>.
   The material from <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> that is retained has been incorporated
   into this document.  Since <span>[<a class="xref" href="#RFC5566">RFC5566</a>]</span>
   relies on <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>, it is likewise obsoleted.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-1-2">¶</a></p>
<div id="summary">
<section id="section-1.1">
        <h3 id="name-brief-summary-of-rfc-5512">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-brief-summary-of-rfc-5512">Brief Summary of RFC 5512</a>
        </h3>
<p id="section-1.1-1">
   <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> defines a BGP path attribute known as the Tunnel
   Encapsulation attribute.  This attribute consists of one or more
   TLVs.  Each TLV identifies a particular type of tunnel.  Each TLV
   also contains one or more sub-TLVs.  Some of the sub-TLVs, for example, the
   Encapsulation sub-TLV, contain information that may be used to form
   the encapsulation header for the specified tunnel type.  Other sub-TLVs, for example, the "color sub-TLV" and the "protocol sub-TLV", contain
   information that aids in determining whether particular packets
   should be sent through the tunnel that the TLV identifies.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
<p id="section-1.1-2">
   <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> only allows the Tunnel Encapsulation attribute to be
   attached to BGP UPDATE messages of the Encapsulation Address Family.
   These UPDATE messages have an Address Family Identifier (AFI) of 1 or
   2, and a SAFI of 7.  In an UPDATE of the Encapsulation SAFI, the
   Network Layer Reachability Information (NLRI) is an address of the BGP
   speaker originating the UPDATE.  Consider the following scenario:<a class="pilcrow" href="#section-1.1-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">BGP speaker R1 has received and selected UPDATE U for local use;<a class="pilcrow" href="#section-1.1-3.1">¶</a>
</li>
          <li class="normal" id="section-1.1-3.2">UPDATE U's SAFI is the Encapsulation SAFI;<a class="pilcrow" href="#section-1.1-3.2">¶</a>
</li>
          <li class="normal" id="section-1.1-3.3">UPDATE U has the address R2 as its NLRI;<a class="pilcrow" href="#section-1.1-3.3">¶</a>
</li>
          <li class="normal" id="section-1.1-3.4">UPDATE U has a Tunnel Encapsulation attribute.<a class="pilcrow" href="#section-1.1-3.4">¶</a>
</li>
          <li class="normal" id="section-1.1-3.5">R1 has a packet, P, to transmit to destination D; and<a class="pilcrow" href="#section-1.1-3.5">¶</a>
</li>
          <li class="normal" id="section-1.1-3.6">R1's best route to D is a BGP route that has R2 as its next hop.<a class="pilcrow" href="#section-1.1-3.6">¶</a>
</li>
        </ul>
<p id="section-1.1-4">
   In this scenario, when R1 transmits packet P, it should transmit it
   to R2 through one of the tunnels specified in U's Tunnel
   Encapsulation attribute.  The IP address of the tunnel egress endpoint of
   each such tunnel is R2.  Packet P is known as the tunnel's "payload".<a class="pilcrow" href="#section-1.1-4">¶</a></p>
</section>
</div>
<div id="deficiencies">
<section id="section-1.2">
        <h3 id="name-deficiencies-in-rfc-5512">
<a class="section-number selfRef" href="#section-1.2">1.2. </a><a class="section-name selfRef" href="#name-deficiencies-in-rfc-5512">Deficiencies in RFC 5512</a>
        </h3>
<p id="section-1.2-1">
   While the ability to specify tunnel information in a BGP UPDATE is
   useful, the procedures of <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> have certain limitations:<a class="pilcrow" href="#section-1.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">The requirement to use the Encapsulation SAFI presents an
      unfortunate operational cost, as each BGP session that may need to
      carry tunnel encapsulation information needs to be reconfigured to
      support the Encapsulation SAFI.  The Encapsulation SAFI has never
      been used, and this requirement has served only to discourage the
      use of the Tunnel Encapsulation attribute.<a class="pilcrow" href="#section-1.2-2.1">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">There is no way to use the Tunnel Encapsulation attribute to
      specify the tunnel egress endpoint address of a given tunnel; <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>
      assumes that the tunnel egress endpoint of each tunnel is specified as
      the NLRI of an UPDATE of the Encapsulation SAFI.<a class="pilcrow" href="#section-1.2-2.2">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">If the respective best routes to two different address prefixes
      have the same next hop, <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> does not provide a
      straightforward method to associate each prefix with a different
      tunnel.<a class="pilcrow" href="#section-1.2-2.3">¶</a>
</li>
          <li class="normal" id="section-1.2-2.4">If a particular tunnel type requires an outer IP or UDP
      encapsulation, there is no way to signal the values of any of the
      fields of the outer encapsulation.<a class="pilcrow" href="#section-1.2-2.4">¶</a>
</li>
          <li class="normal" id="section-1.2-2.5">In the specification of the sub-TLVs in <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>, each sub-TLV has a
      one-octet Length field.  In some cases, where a sub-TLV may require more than
      255 octets for its encoding, a two-octet Length field
      may be needed.<a class="pilcrow" href="#section-1.2-2.5">¶</a>
</li>
        </ul>
</section>
</div>
<div id="use-case">
<section id="section-1.3">
        <h3 id="name-use-case-for-the-tunnel-enc">
<a class="section-number selfRef" href="#section-1.3">1.3. </a><a class="section-name selfRef" href="#name-use-case-for-the-tunnel-enc">Use Case for the Tunnel Encapsulation Attribute</a>
        </h3>
<p id="section-1.3-1">
     Consider the case of a router R1 forwarding an IP packet P.  Let D be
     P's IP destination address.  R1 must look up D in its forwarding
     table.  Suppose that the "best match" route for D is route Q, where Q
     is a BGP-distributed route whose "BGP next hop" is router R2.  And
     suppose further that the routers along the path from R1 to R2 have
     entries for R2 in their forwarding tables but do NOT have entries
     for D in their forwarding tables.  For example, the path from R1 to
     R2 may be part of a "BGP-free core", where there are no BGP-distributed routes at all in the core.  Or, as in <span>[<a class="xref" href="#RFC5565">RFC5565</a>]</span>, D may be an
     IPv4 address while the intermediate routers along the path from R1 to
     R2 may support only IPv6.<a class="pilcrow" href="#section-1.3-1">¶</a></p>
<p id="section-1.3-2">
     In cases such as this, in order for R1 to properly forward packet P,
     it must encapsulate P and send P "through a tunnel" to R2.  For
     example, R1 may encapsulate P using GRE, Layer 2 Tunneling
   Protocol version 3 (L2TPv3), IP in IP, etc.,
     where the destination IP address of the encapsulation header is the
     address of R2.<a class="pilcrow" href="#section-1.3-2">¶</a></p>
<p id="section-1.3-3">
     In order for R1 to encapsulate P for transport to R2, R1 must know
     what encapsulation protocol to use for transporting different sorts
     of packets to R2.  R1 must also know how to fill in the various
     fields of the encapsulation header.  With certain encapsulation
     types, this knowledge may be acquired by default or through manual
     configuration.  Other encapsulation protocols have fields such as
     session id, key, or cookie that must be filled in.  It would not be
     desirable to require every BGP speaker to be manually configured with
     the encapsulation information for every one of its BGP next hops.<a class="pilcrow" href="#section-1.3-3">¶</a></p>
<p id="section-1.3-4">
     This document specifies a way in which BGP itself can be used by
     a given BGP speaker to tell other BGP speakers, "If you need to
     encapsulate packets to be sent to me, here's the information you need
     to properly form the encapsulation header".  A BGP speaker signals
     this information to other BGP speakers by using a new BGP attribute type
     value -- the BGP Tunnel Encapsulation attribute.  This attribute
   specifies the encapsulation protocols that may be used, as well as
   whatever additional information (if any) is needed in order to
   properly use those protocols.  Other attributes, for example, communities or
   extended communities, may also be included.<a class="pilcrow" href="#section-1.3-4">¶</a></p>
</section>
</div>
<section id="section-1.4">
        <h3 id="name-brief-summary-of-changes-fr">
<a class="section-number selfRef" href="#section-1.4">1.4. </a><a class="section-name selfRef" href="#name-brief-summary-of-changes-fr">Brief Summary of Changes from RFC 5512</a>
        </h3>
<p id="section-1.4-1">
   This document addresses the deficiencies identified in <a class="xref" href="#deficiencies">Section 1.2</a> by:<a class="pilcrow" href="#section-1.4-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-2.1">Deprecating the Encapsulation SAFI.<a class="pilcrow" href="#section-1.4-2.1">¶</a>
</li>
          <li class="normal" id="section-1.4-2.2">Defining a new "Tunnel Egress Endpoint sub-TLV" (<a class="xref" href="#tunnel-egress-endpoint">Section 3.1</a>) that can be
      included in any of the TLVs contained in the Tunnel Encapsulation
      attribute.  This sub-TLV can be used to specify the remote
      endpoint address of a particular tunnel.<a class="pilcrow" href="#section-1.4-2.2">¶</a>
</li>
          <li class="normal" id="section-1.4-2.3">Allowing the Tunnel Encapsulation attribute to be carried by BGP
      UPDATEs of additional AFI/SAFIs.  Appropriate semantics are
      provided for this way of using the attribute.<a class="pilcrow" href="#section-1.4-2.3">¶</a>
</li>
          <li class="normal" id="section-1.4-2.4">Defining a number of new sub-TLVs that provide additional
      information that is useful when forming the encapsulation header
      used to send a packet through a particular tunnel.<a class="pilcrow" href="#section-1.4-2.4">¶</a>
</li>
          <li class="normal" id="section-1.4-2.5">Defining the Sub-TLV Type field so that a sub-TLV whose type is in
      the range from 0 to 127 (inclusive) has a one-octet Length field,
      but a sub-TLV whose type is in the range from 128 to 255 (inclusive)
      has a two-octet Length field.<a class="pilcrow" href="#section-1.4-2.5">¶</a>
</li>
        </ul>
<p id="section-1.4-3">
   One of the sub-TLVs defined in <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> is the "Encapsulation sub-TLV".  For a given tunnel, the Encapsulation sub-TLV specifies some
   of the information needed to construct the encapsulation header used
   when sending packets through that tunnel.  This document defines
   Encapsulation sub-TLVs for a number of tunnel types not discussed in
   <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>: Virtual eXtensible Local Area Network (VXLAN) <span>[<a class="xref" href="#RFC7348">RFC7348</a>]</span>, Network Virtualization Using Generic Routing Encapsulation (NVGRE)
   <span>[<a class="xref" href="#RFC7637">RFC7637</a>]</span>, and MPLS in Generic Routing Encapsulation (MPLS-in-GRE) <span>[<a class="xref" href="#RFC4023">RFC4023</a>]</span>.  MPLS-in-UDP <span>[<a class="xref" href="#RFC7510">RFC7510</a>]</span> is also
   supported, but an Encapsulation sub-TLV for it is not needed since there are
   no additional parameters to be signaled.<a class="pilcrow" href="#section-1.4-3">¶</a></p>
<p id="section-1.4-4">
   Some of the encapsulations mentioned in the previous paragraph need
   to be further encapsulated inside UDP and/or IP.  <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> provides
   no way to specify that certain information is to appear in these
   outer IP and/or UDP encapsulations.  This document provides a
   framework for including such information in the TLVs of the Tunnel
   Encapsulation attribute.<a class="pilcrow" href="#section-1.4-4">¶</a></p>
<p id="section-1.4-5">
   When the Tunnel Encapsulation attribute is attached to a BGP UPDATE
   whose AFI/SAFI identifies one of the labeled address families, it is
   not always obvious whether the label embedded in the NLRI is to
   appear somewhere in the tunnel encapsulation header (and if so,
   where), whether it is to appear in the payload, or whether it can
   be omitted altogether.  This is especially true if the tunnel
   encapsulation header itself contains a "virtual network identifier".
   This document provides a mechanism that allows one to signal (by
   using sub-TLVs of the Tunnel Encapsulation attribute) how one wants
   to use the embedded label when the tunnel encapsulation has its own
   Virtual Network Identifier field.<a class="pilcrow" href="#section-1.4-5">¶</a></p>
<p id="section-1.4-6">

    <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span> defines an Encapsulation Extended
    Community that can be used instead of the Tunnel Encapsulation
    attribute under certain circumstances.  This document describes
     how the Encapsulation Extended
    Community can be used in a backwards-compatible fashion (see <a class="xref" href="#encapsulation-extcomm">Section 4.1</a>). It is
    possible to combine Encapsulation Extended Communities and
    Tunnel Encapsulation attributes in the same BGP UPDATE in this
    manner.<a class="pilcrow" href="#section-1.4-6">¶</a></p>
</section>
<section id="section-1.5">
        <h3 id="name-update-to-rfc-5640">
<a class="section-number selfRef" href="#section-1.5">1.5. </a><a class="section-name selfRef" href="#name-update-to-rfc-5640">Update to RFC 5640</a>
        </h3>
<p id="section-1.5-1">
 This document updates <span>[<a class="xref" href="#RFC5640">RFC5640</a>]</span> by indicating that the Load-Balancing Block
  sub-TLV <span class="bcp14">MAY</span> be included in any Tunnel Encapsulation attribute where
   load balancing is desired.<a class="pilcrow" href="#section-1.5-1">¶</a></p>
</section>
<section id="section-1.6">
        <h3 id="name-effects-of-obsoleting-rfc-5">
<a class="section-number selfRef" href="#section-1.6">1.6. </a><a class="section-name selfRef" href="#name-effects-of-obsoleting-rfc-5">Effects of Obsoleting RFC 5566</a>
        </h3>
<p id="section-1.6-1">
 This specification obsoletes RFC 5566. This has the effect of,
 in turn, deprecating a number of code points defined in that document.
 In the "BGP Tunnel Encapsulation Attribute Tunnel Types" registry <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>, the following code points have been marked as deprecated:
 "Transmit tunnel endpoint" (type code 3), "IPsec in Tunnel-mode" (type
 code 4), "IP in IP tunnel with IPsec Transport Mode" (type code 5), and
 "MPLS-in-IP tunnel with IPsec Transport Mode" (type code 6).
 In the "BGP Tunnel Encapsulation Attribute Sub-TLVs" registry <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>,
 "IPsec Tunnel Authenticator" (type code 3) has been marked as deprecated. 
 See <a class="xref" href="#obsoleting-5566-and-5640">Section 14.2</a>.<a class="pilcrow" href="#section-1.6-1">¶</a></p>
</section>
</section>
<div id="encaps-attr">
<section id="section-2">
      <h2 id="name-the-tunnel-encapsulation-at">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-the-tunnel-encapsulation-at">The Tunnel Encapsulation Attribute</a>
      </h2>
<p id="section-2-1">
   The Tunnel Encapsulation attribute is an optional transitive BGP path

   attribute.  IANA has assigned the value 23 as the type code of the
   attribute in the "BGP Path Attributes" registry <span>[<a class="xref" href="#IANA-BGP-PARAMS">IANA-BGP-PARAMS</a>]</span>.  The attribute is composed of a set of Type-Length-Value
   (TLV) encodings.  Each TLV contains information corresponding to a
   particular tunnel type.  A Tunnel Encapsulation TLV, also known as Tunnel TLV,
   is structured as shown in <a class="xref" href="#ref-tunnel-tlv-value-field">Figure 1</a>.<a class="pilcrow" href="#section-2-1">¶</a></p>
<span id="name-tunnel-encapsulation-tlv"></span><div id="ref-tunnel-tlv-value-field">
<figure id="figure-1">
        <div class="artwork art-text alignLeft" id="section-2-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    Tunnel Type (2 octets)     |        Length (2 octets)      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                        Value (variable)                       |
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-tunnel-encapsulation-tlv">Tunnel Encapsulation TLV</a>
        </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-2-3">
        <dt id="section-2-3.1">Tunnel Type (2 octets):</dt>
        <dd id="section-2-3.2" style="margin-left: 1.5em">Identifies a type of tunnel.  The field
      contains values from the IANA registry
"BGP Tunnel Encapsulation Attribute Tunnel Types" <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>.
      See <a class="xref" href="#protocol-type">Section 3.4.1</a> for discussion of special treatment of tunnel types with names of the form "X-in-Y".<a class="pilcrow" href="#section-2-3.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">Length (2 octets):</dt>
        <dd id="section-2-3.4" style="margin-left: 1.5em">The total number of octets of the Value field.<a class="pilcrow" href="#section-2-3.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.5">Value (variable):</dt>
        <dd id="section-2-3.6" style="margin-left: 1.5em">Comprised of multiple sub-TLVs.<a class="pilcrow" href="#section-2-3.6">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-2-4">
   Each sub-TLV consists of three fields: A 1-octet type, a 1-octet or
   2-octet length (depending on the type), and zero or more octets
   of value.  A sub-TLV is structured as shown in <a class="xref" href="#ref-tunnel-encapsulation-sub-tlv-value-field">Figure 2</a>.<a class="pilcrow" href="#section-2-4">¶</a></p>
<span id="name-encapsulation-sub-tlv"></span><div id="ref-tunnel-encapsulation-sub-tlv-value-field">
<figure id="figure-2">
        <div class="artwork art-text alignLeft" id="section-2-5.1">
<pre>                    +--------------------------------+
                    | Sub-TLV Type (1 octet)         |
                    +--------------------------------+
                    | Sub-TLV Length (1 or 2 octets) |
                    +--------------------------------+
                    | Sub-TLV Value (variable)       |
                    +--------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-encapsulation-sub-tlv">Encapsulation Sub-TLV</a>
        </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-2-6">
        <dt id="section-2-6.1">Sub-TLV Type (1 octet):</dt>
        <dd id="section-2-6.2" style="margin-left: 1.5em">Each sub-TLV type defines a certain
      property about the Tunnel TLV that contains this sub-TLV.
      The field contains values from the IANA registry 
"BGP Tunnel Encapsulation Attribute Sub-TLVs" <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>.<a class="pilcrow" href="#section-2-6.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.3">Sub-TLV Length (1 or 2 octets):</dt>
        <dd id="section-2-6.4" style="margin-left: 1.5em">The total number of octets of the
      Sub-TLV Value field.  The Sub-TLV Length field contains 1 octet if
      the Sub-TLV Type field contains a value in the range from 0-127.
      The Sub-TLV Length field contains two octets if the Sub-TLV Type
      field contains a value in the range from 128-255.<a class="pilcrow" href="#section-2-6.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.5">Sub-TLV Value (variable):</dt>
        <dd id="section-2-6.6" style="margin-left: 1.5em">Encodings of the Value field depend on
      the sub-TLV type.  The following subsections
      define the encoding in detail.<a class="pilcrow" href="#section-2-6.6">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<section id="section-3">
      <h2 id="name-tunnel-encapsulation-attrib">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-tunnel-encapsulation-attrib">Tunnel Encapsulation Attribute Sub-TLVs</a>
      </h2>
<p id="section-3-1">
 This section specifies a number of sub-TLVs.  These sub-TLVs can
      be included in a TLV of the Tunnel Encapsulation attribute.<a class="pilcrow" href="#section-3-1">¶</a></p>
<div id="tunnel-egress-endpoint">
<section id="section-3.1">
        <h3 id="name-the-tunnel-egress-endpoint-">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-the-tunnel-egress-endpoint-">The Tunnel Egress Endpoint Sub-TLV (Type Code 6)</a>
        </h3>
<p id="section-3.1-1">
   The Tunnel Egress Endpoint
   sub-TLV specifies the address of the egress endpoint of the tunnel, that
   is, the address of the router that will decapsulate the payload. Its 
   Value field contains three subfields:<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<ol class="normal type-1" id="section-3.1-2" start="1" type="1">
<li id="section-3.1-2.1">a Reserved subfield<a class="pilcrow" href="#section-3.1-2.1">¶</a>
</li>
          <li id="section-3.1-2.2">a two-octet Address Family subfield<a class="pilcrow" href="#section-3.1-2.2">¶</a>
</li>
          <li id="section-3.1-2.3">an Address subfield, whose length depends upon the Address
       Family.<a class="pilcrow" href="#section-3.1-2.3">¶</a>
</li>
        </ol>
<span id="name-tunnel-egress-endpoint-sub-"></span><div id="ref-tunnel-endpoint-sub-tlv-value-field">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-3.1-3.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                       Reserved (4 octets)                     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   Address Family (2 octets)   |           Address             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+          (variable)           +
  ~                                                               ~
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-tunnel-egress-endpoint-sub-">Tunnel Egress Endpoint Sub-TLV Value Field</a>
          </figcaption></figure>
</div>
<p id="section-3.1-4">
   The Reserved subfield <span class="bcp14">SHOULD</span> be originated as zero. It <span class="bcp14">MUST</span> be
   disregarded on receipt, and it <span class="bcp14">MUST</span> be propagated unchanged.<a class="pilcrow" href="#section-3.1-4">¶</a></p>
<p id="section-3.1-5">
   The Address Family subfield contains a value from IANA's
"Address Family Numbers" registry <span>[<a class="xref" href="#IANA-ADDRESS-FAM">IANA-ADDRESS-FAM</a>]</span>.  
   This document assumes that the
   Address Family is either IPv4 or IPv6; use of other address families
   is outside the scope of this document.<a class="pilcrow" href="#section-3.1-5">¶</a></p>
<p id="section-3.1-6">
   If the Address Family subfield contains the value for IPv4, the
   Address subfield <span class="bcp14">MUST</span> contain an IPv4 address (a /32 IPv4 prefix).<a class="pilcrow" href="#section-3.1-6">¶</a></p>
<p id="section-3.1-7">
   If the Address Family subfield contains the value for IPv6, the
   Address subfield <span class="bcp14">MUST</span> contain an IPv6 address (a /128 IPv6 prefix).<a class="pilcrow" href="#section-3.1-7">¶</a></p>
<p id="section-3.1-8">
   In a given BGP UPDATE, the address family (IPv4 or IPv6) of a Tunnel
   Egress Endpoint sub-TLV is independent of the address family of the UPDATE
   itself. For example, an UPDATE whose NLRI is an IPv4 address may
   have a Tunnel Encapsulation attribute containing Tunnel Egress Endpoint 
   sub-TLVs that contain IPv6 addresses.  Also, different tunnels
   represented in the Tunnel Encapsulation attribute may have tunnel egress
   endpoints of different address families.<a class="pilcrow" href="#section-3.1-8">¶</a></p>
<p id="section-3.1-9">
   There is one special case: the Tunnel Egress Endpoint sub-TLV <span class="bcp14">MAY</span> have a
   Value field whose Address Family subfield contains 0.  This means
   that the tunnel's egress endpoint is the address of the next hop.  If
   the Address Family subfield contains 0, the Address subfield is
   omitted. In this case,
   the Length field of Tunnel Egress Endpoint sub-TLV <span class="bcp14">MUST</span> contain the
   value 6 (0x06).<a class="pilcrow" href="#section-3.1-9">¶</a></p>
<p id="section-3.1-10">
          When the Tunnel Encapsulation attribute is carried in an UPDATE message
          of one of the AFI/SAFIs specified in this document (see the first 
          paragraph of <a class="xref" href="#usage">Section 6</a>), each TLV <span class="bcp14">MUST</span> have one, and only one, Tunnel Egress Endpoint sub-TLV. If a TLV does not have a Tunnel Egress Endpoint sub-TLV, that TLV should be treated as if it had a malformed Tunnel
          Egress Endpoint sub-TLV (see below).<a class="pilcrow" href="#section-3.1-10">¶</a></p>
<p id="section-3.1-11">

   In the context of this specification, if the Address Family subfield
   has any value other than IPv4, IPv6, or the special value 0, the
   Tunnel Egress Endpoint sub-TLV is considered "unrecognized" (see
   <a class="xref" href="#validation-and-error">Section 13</a>).
    
   If any of the following conditions hold, the Tunnel Egress Endpoint sub-TLV
   is considered to be "malformed":<a class="pilcrow" href="#section-3.1-11">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-12.1">
            <p id="section-3.1-12.1.1">The length of the sub-TLV's Value field is other than 6 added to
   the defined length for the address family given in its Address
   Family subfield. Therefore, for address family behaviors defined
   in this document, the permitted values are:<a class="pilcrow" href="#section-3.1-12.1.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-12.1.2.1">10, if the Address Family subfield contains the value for IPv4.<a class="pilcrow" href="#section-3.1-12.1.2.1">¶</a>
</li>
              <li class="normal" id="section-3.1-12.1.2.2">22, if the Address Family subfield contains the value for IPv6.<a class="pilcrow" href="#section-3.1-12.1.2.2">¶</a>
</li>
              <li class="normal" id="section-3.1-12.1.2.3">6, if the Address Family subfield contains the value zero.<a class="pilcrow" href="#section-3.1-12.1.2.3">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.1-12.2">The IP address in the sub-TLV's Address subfield lies within a
   block listed in the relevant Special-Purpose IP Address registry
   <span>[<a class="xref" href="#RFC6890">RFC6890</a>]</span> with either a "destination" attribute 
   value or a "forwardable" attribute value of "false". (Such routes
   are sometimes colloquially known as "Martians".) This restriction 
   <span class="bcp14">MAY</span> be relaxed by explicit configuration.<a class="pilcrow" href="#section-3.1-12.2">¶</a>
</li>
          <li class="normal" id="section-3.1-12.3">It can be determined that the IP address in the sub-TLV's Address
      subfield does not belong to the Autonomous System (AS) that originated
      the route that contains the attribute.  <a class="xref" href="#address-validation">Section 3.1.1</a> 
      describes an optional procedure to make this determination.<a class="pilcrow" href="#section-3.1-12.3">¶</a>
</li>
        </ul>
<p id="section-3.1-13">
   Error handling is specified in <a class="xref" href="#validation-and-error">Section 13</a>.<a class="pilcrow" href="#section-3.1-13">¶</a></p>
<p id="section-3.1-14">
   If the Tunnel Egress Endpoint sub-TLV contains an IPv4 or IPv6 address that
   is valid but not reachable, the sub-TLV is not considered to be
   malformed.<a class="pilcrow" href="#section-3.1-14">¶</a></p>
<div id="address-validation">
<section id="section-3.1.1">
          <h4 id="name-validating-the-address-subf">
<a class="section-number selfRef" href="#section-3.1.1">3.1.1. </a><a class="section-name selfRef" href="#name-validating-the-address-subf">Validating the Address Subfield</a>
          </h4>
<p id="section-3.1.1-1"> 
   This section provides a procedure that <span class="bcp14">MAY</span> be applied to 
   validate that the IP address in the sub-TLV's Address subfield 
   belongs to the AS that originated the route that contains the
   attribute. (The notion of "belonging to" an AS is expanded on below.)
   Doing this is thought to increase confidence that when 
   traffic is sent to the IP address depicted in the
   Address subfield, it will go to the same AS as it would go to if the
   Tunnel Encapsulation attribute were not present, although of course
   it cannot guarantee it. See <a class="xref" href="#security">Section 15</a> for discussion of the limitations of this
   procedure. The principal applicability of this procedure is in deployments
   that are not strictly scoped. In deployments with strict scope, and especially
   those scoped to a single AS, these procedures may not add substantial
   benefit beyond those discussed in <a class="xref" href="#scoping">Section 11</a>.<a class="pilcrow" href="#section-3.1.1-1">¶</a></p>
<p id="section-3.1.1-2">
   The Route Origin Autonomous System Number (ASN) of a BGP route that
   includes a Tunnel Encapsulation attribute can be determined by
   inspection of the AS_PATH attribute, according to the procedure
   specified in <span>[<a class="xref" href="#RFC6811">RFC6811</a>], <a class="relref" href="https://www.rfc-editor.org/rfc/rfc6811#section-2">Section 2</a></span>. Call this value
   Route_AS.<a class="pilcrow" href="#section-3.1.1-2">¶</a></p>
<p id="section-3.1.1-3">
   In order to determine the Route Origin ASN of the address depicted in
   the Address subfield of the Tunnel Egress Endpoint sub-TLV, it is
   necessary to consider the forwarding route -- that is, the route that
   will be used to forward traffic toward that address. This route is
   determined by a recursive route-lookup operation for that address, as
   discussed in <span>[<a class="xref" href="#RFC4271">RFC4271</a>], <a class="relref" href="https://www.rfc-editor.org/rfc/rfc4271#section-5.1.3">Section 5.1.3</a></span>. The relevant AS
   path to consider is the last one encountered while performing the
   recursive lookup; the procedures of <span>[<a class="xref" href="#RFC6811">RFC6811</a>], <a class="relref" href="https://www.rfc-editor.org/rfc/rfc6811#section-2">Section 2</a></span> are applied to
   that AS path to determine the Route Origin ASN. If no AS path is
   encountered at all, for example, if that route's source is a protocol
   other than BGP, the Route Origin ASN is the BGP speaker's own AS
   number. Call this value Egress_AS.<a class="pilcrow" href="#section-3.1.1-3">¶</a></p>
<p id="section-3.1.1-4">
   If Route_AS does not equal Egress_AS, then the Tunnel Egress Endpoint
   sub-TLV is considered not to be valid. In some cases, a network operator
   who controls a set of ASes might wish to allow a tunnel
   egress endpoint to reside in an AS other than Route_AS; configuration
   <span class="bcp14">MAY</span> allow for such a case, in which case the check becomes: if 
   Egress_AS is not within the configured set of permitted AS numbers, then the 
   Tunnel Egress Endpoint sub-TLV is considered to be "malformed".<a class="pilcrow" href="#section-3.1.1-4">¶</a></p>
<p id="section-3.1.1-5">
   Note that if the forwarding route changes, this procedure <span class="bcp14">MUST</span> be 
   reapplied. As a result, a sub-TLV that was formerly considered valid
   might become not valid, or vice versa.<a class="pilcrow" href="#section-3.1.1-5">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-3.2">
        <h3 id="name-encapsulation-sub-tlvs-for-">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-encapsulation-sub-tlvs-for-">Encapsulation Sub-TLVs for Particular Tunnel Types (Type Code 1)</a>
        </h3>
<p id="section-3.2-1">
   This section defines Encapsulation sub-TLVs for the following
   tunnel types: VXLAN <span>[<a class="xref" href="#RFC7348">RFC7348</a>]</span>, NVGRE
   <span>[<a class="xref" href="#RFC7637">RFC7637</a>]</span>, MPLS-in-GRE <span>[<a class="xref" href="#RFC4023">RFC4023</a>]</span>, L2TPv3
   <span>[<a class="xref" href="#RFC3931">RFC3931</a>]</span>, and GRE <span>[<a class="xref" href="#RFC2784">RFC2784</a>]</span>.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2">
   Rules for forming the encapsulation based on the information in a
   given TLV are given in Sections <a class="xref" href="#usage">6</a> and <a class="xref" href="#use-of-vni">9</a>.<a class="pilcrow" href="#section-3.2-2">¶</a></p>
<p id="section-3.2-3">
   Recall that the tunnel type itself is identified by the Tunnel Type
   field in the attribute header (<a class="xref" href="#encaps-attr">Section 2</a>); the
   Encapsulation sub-TLV's structure is inferred from this. Regardless
   of the tunnel type, the sub-TLV type of the Encapsulation sub-TLV is
   1. There are also tunnel types for which it is not necessary to
   define an Encapsulation sub-TLV, because there are no fields in the
   encapsulation header whose values need to be signaled from the tunnel
   egress endpoint.<a class="pilcrow" href="#section-3.2-3">¶</a></p>
<section id="section-3.2.1">
          <h4 id="name-vxlan-tunnel-type-8">
<a class="section-number selfRef" href="#section-3.2.1">3.2.1. </a><a class="section-name selfRef" href="#name-vxlan-tunnel-type-8">VXLAN (Tunnel Type 8)</a>
          </h4>
<p id="section-3.2.1-1">
   This document defines an Encapsulation sub-TLV for <span><a class="xref" href="#RFC7348">VXLAN</a> [<a class="xref" href="#RFC7348">RFC7348</a>]</span> tunnels.
   When the tunnel type is VXLAN, the length of the sub-TLV is 12 octets. The structure of the Value field in the Encapsulation sub-TLV is shown in <a class="xref" href="#ref-vxlan-encapsulation-sub-tlv">Figure 4</a>.<a class="pilcrow" href="#section-3.2.1-1">¶</a></p>
<span id="name-vxlan-encapsulation-sub-tlv"></span><div id="ref-vxlan-encapsulation-sub-tlv">
<figure id="figure-4">
            <div class="artwork art-text alignLeft" id="section-3.2.1-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |V|M|R|R|R|R|R|R|          VN-ID (3 octets)                     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                 MAC Address (4 octets)                        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |  MAC Address (2 octets)       |      Reserved (2 octets)      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-vxlan-encapsulation-sub-tlv">VXLAN Encapsulation Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-3">
            <dt id="section-3.2.1-3.1">V:</dt>
            <dd id="section-3.2.1-3.2" style="margin-left: 1.5em">
      This bit is set to 1 to indicate that a Virtual
      Network Identifier (VN-ID) is present in the Encapsulation sub-TLV.
      If set to 0, the VN-ID field is disregarded.
      Please see <a class="xref" href="#use-of-vni">Section 9</a>.<a class="pilcrow" href="#section-3.2.1-3.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-3.3">M:</dt>
            <dd id="section-3.2.1-3.4" style="margin-left: 1.5em">
      This bit is set to 1 to indicate that a Media Access Control (MAC) Address is
      present in the Encapsulation sub-TLV. If set to 0, the MAC
      Address field is disregarded.<a class="pilcrow" href="#section-3.2.1-3.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-3.5">R:</dt>
            <dd id="section-3.2.1-3.6" style="margin-left: 1.5em">
      The remaining bits in the 8-bit Flags field are reserved for
      further use.  They <span class="bcp14">MUST</span> always be set to 0 by the originator of
      the sub-TLV. Intermediate routers <span class="bcp14">MUST</span> propagate them without
      modification. Any receiving routers <span class="bcp14">MUST</span> ignore
      these bits upon receipt.<a class="pilcrow" href="#section-3.2.1-3.6">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-3.7">VN-ID:</dt>
            <dd id="section-3.2.1-3.8" style="margin-left: 1.5em">
      If the V bit is set to 1, the VN-ID field contains a 3-octet VN-ID value.  If the V bit is set to 0, the VN-ID field <span class="bcp14">MUST</span> be set
      to zero on transmission and disregarded on receipt.<a class="pilcrow" href="#section-3.2.1-3.8">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-3.9">MAC Address:</dt>
            <dd id="section-3.2.1-3.10" style="margin-left: 1.5em">
      If the M bit is set to 1, this field contains a 6-octet
      Ethernet MAC address.  If the M bit is set to 0, this field <span class="bcp14">MUST</span>
      be set to all zeroes on transmission and disregarded on receipt.<a class="pilcrow" href="#section-3.2.1-3.10">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-3.11">Reserved:</dt>
            <dd id="section-3.2.1-3.12" style="margin-left: 1.5em">
              <span class="bcp14">MUST</span> be set to zero on transmission and disregarded
      on receipt.<a class="pilcrow" href="#section-3.2.1-3.12">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.2.1-4">
   When forming the VXLAN encapsulation header:<a class="pilcrow" href="#section-3.2.1-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2.1-5.1">The values of the V, M, and R bits are NOT copied into the Flags
      field of the VXLAN header.  The Flags field of the VXLAN header is
      set as per <span>[<a class="xref" href="#RFC7348">RFC7348</a>]</span>.<a class="pilcrow" href="#section-3.2.1-5.1">¶</a>
</li>
            <li class="normal" id="section-3.2.1-5.2">
              <p id="section-3.2.1-5.2.1">If the M bit is set to 1, the MAC Address is copied into the Inner
      Destination MAC Address field of the Inner Ethernet Header (see
      <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7348#section-5">Section 5</a> of [<a class="xref" href="#RFC7348">RFC7348</a>]</span>).<a class="pilcrow" href="#section-3.2.1-5.2.1">¶</a></p>
<p id="section-3.2.1-5.2.2">
 If the M bit is set to 0, and the payload being sent through the
      VXLAN tunnel is an Ethernet frame, the Destination MAC Address
      field of the Inner Ethernet Header is just the Destination MAC
      Address field of the payload's Ethernet header.<a class="pilcrow" href="#section-3.2.1-5.2.2">¶</a></p>
<p id="section-3.2.1-5.2.3">
 If the M bit is set to 0, and the payload being sent through the
      VXLAN tunnel is an IP or MPLS packet, the Inner Destination MAC
      Address field is set to a configured value; if there is no
      configured value, the VXLAN tunnel cannot be used.<a class="pilcrow" href="#section-3.2.1-5.2.3">¶</a></p>
</li>
            <li class="normal" id="section-3.2.1-5.3"> If the V bit is set to 0, and the BGP UPDATE message has an
   AFI/SAFI other than Ethernet VPNs (SAFI 70, "BGP EVPNs"), then the 
   VXLAN tunnel cannot be used.<a class="pilcrow" href="#section-3.2.1-5.3">¶</a>
</li>
            <li class="normal" id="section-3.2.1-5.4">
              <a class="xref" href="#use-of-vni">Section 9</a> describes how the VNI (VXLAN Network Identifier) field of the VXLAN encapsulation header is set.<a class="pilcrow" href="#section-3.2.1-5.4">¶</a>
</li>
          </ul>
<p id="section-3.2.1-6">
   Note that in order to send an IP packet or an MPLS packet through a
   VXLAN tunnel, the packet must first be encapsulated in an Ethernet
   header, which becomes the "Inner Ethernet Header" described in
   <span>[<a class="xref" href="#RFC7348">RFC7348</a>]</span>.  The VXLAN Encapsulation sub-TLV may contain information
   (for example, the MAC address) that is used to form this Ethernet header.<a class="pilcrow" href="#section-3.2.1-6">¶</a></p>
</section>
<section id="section-3.2.2">
          <h4 id="name-nvgre-tunnel-type-9">
<a class="section-number selfRef" href="#section-3.2.2">3.2.2. </a><a class="section-name selfRef" href="#name-nvgre-tunnel-type-9">NVGRE (Tunnel Type 9)</a>
          </h4>
<p id="section-3.2.2-1">
   This document defines an Encapsulation sub-TLV for <span><a class="xref" href="#RFC7637">NVGRE</a> [<a class="xref" href="#RFC7637">RFC7637</a>]</span> tunnels.
   When the tunnel type is NVGRE, the length of the sub-TLV is 12 octets. The structure of the Value field in the Encapsulation sub-TLV is shown in <a class="xref" href="#ref-nvgre-encapsulation-sub-tlv">Figure 5</a>.<a class="pilcrow" href="#section-3.2.2-1">¶</a></p>
<span id="name-nvgre-encapsulation-sub-tlv"></span><div id="ref-nvgre-encapsulation-sub-tlv">
<figure id="figure-5">
            <div class="artwork art-text alignLeft" id="section-3.2.2-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |V|M|R|R|R|R|R|R|          VN-ID (3 octets)                     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                 MAC Address (4 octets)                        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |  MAC Address (2 octets)       |      Reserved (2 octets)      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-nvgre-encapsulation-sub-tlv">NVGRE Encapsulation Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.2-3">
            <dt id="section-3.2.2-3.1">V:</dt>
            <dd id="section-3.2.2-3.2" style="margin-left: 1.5em">
      This bit is set to 1 to indicate that a VN-ID is
      present in the Encapsulation sub-TLV.  If set to 0,
      the VN-ID field is disregarded. Please see <a class="xref" href="#use-of-vni">Section 9</a>.<a class="pilcrow" href="#section-3.2.2-3.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.3">M:</dt>
            <dd id="section-3.2.2-3.4" style="margin-left: 1.5em">
      This bit is set to 1 to indicate that a MAC Address is
      present in the Encapsulation sub-TLV. If set to 0,
      the MAC Address field is disregarded.<a class="pilcrow" href="#section-3.2.2-3.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.5">R:</dt>
            <dd id="section-3.2.2-3.6" style="margin-left: 1.5em">
      The remaining bits in the 8-bit Flags field are reserved for
      further use. They <span class="bcp14">MUST</span> always be set to 0 by the originator of
      the sub-TLV. Intermediate routers <span class="bcp14">MUST</span> propagate them without
      modification. Any receiving routers <span class="bcp14">MUST</span> ignore
      these bits upon receipt.<a class="pilcrow" href="#section-3.2.2-3.6">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.7">VN-ID:</dt>
            <dd id="section-3.2.2-3.8" style="margin-left: 1.5em">
      If the V bit is set to 1, the VN-ID field contains a 3-octet VN-ID value, used to set the NVGRE Virtual Subnet Identifier (VSID; see <a class="xref" href="#use-of-vni">Section 9</a>).  If the V bit is set to 0, the VN-ID field <span class="bcp14">MUST</span> be set
      to zero on transmission and disregarded on receipt.<a class="pilcrow" href="#section-3.2.2-3.8">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.9">MAC Address:</dt>
            <dd id="section-3.2.2-3.10" style="margin-left: 1.5em">
      If the M bit is set to 1, this field contains a 6-octet
      Ethernet MAC address.  If the M bit is set to 0, this field <span class="bcp14">MUST</span>
      be set to all zeroes on transmission and disregarded on receipt.<a class="pilcrow" href="#section-3.2.2-3.10">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.11">Reserved:</dt>
            <dd id="section-3.2.2-3.12" style="margin-left: 1.5em">
              <span class="bcp14">MUST</span> be set to zero on transmission and disregarded
      on receipt.<a class="pilcrow" href="#section-3.2.2-3.12">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.2.2-4">
   When forming the NVGRE encapsulation header:<a class="pilcrow" href="#section-3.2.2-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2.2-5.1">The values of the V, M, and R bits are NOT copied into the Flags
      field of the NVGRE header.  The Flags field of the NVGRE header is
      set as per <span>[<a class="xref" href="#RFC7637">RFC7637</a>]</span>.<a class="pilcrow" href="#section-3.2.2-5.1">¶</a>
</li>
            <li class="normal" id="section-3.2.2-5.2">
              <p id="section-3.2.2-5.2.1">If the M bit is set to 1, the MAC Address is copied into the Inner
      Destination MAC Address field of the Inner Ethernet Header (see
      <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7637#section-3.2">Section 3.2</a> of [<a class="xref" href="#RFC7637">RFC7637</a>]</span>).<a class="pilcrow" href="#section-3.2.2-5.2.1">¶</a></p>
<p id="section-3.2.2-5.2.2">
 If the M bit is set to 0, and the payload being sent through the
      NVGRE tunnel is an Ethernet frame, the Destination MAC Address
      field of the Inner Ethernet Header is just the Destination MAC
      Address field of the payload's Ethernet header.<a class="pilcrow" href="#section-3.2.2-5.2.2">¶</a></p>
<p id="section-3.2.2-5.2.3">
 If the M bit is set to 0, and the payload being sent through the
      NVGRE tunnel is an IP or MPLS packet, the Inner Destination MAC
      Address field is set to a configured value; if there is no
      configured value, the NVGRE tunnel cannot be used.<a class="pilcrow" href="#section-3.2.2-5.2.3">¶</a></p>
</li>
            <li class="normal" id="section-3.2.2-5.3"> If the V bit is set to 0, and the BGP UPDATE message has an
   AFI/SAFI other than Ethernet VPNs (EVPNs), then the 
   NVGRE tunnel cannot be used.<a class="pilcrow" href="#section-3.2.2-5.3">¶</a>
</li>
            <li class="normal" id="section-3.2.2-5.4">
              <a class="xref" href="#use-of-vni">Section 9</a> describes how the VSID field of the
      NVGRE encapsulation header is set.<a class="pilcrow" href="#section-3.2.2-5.4">¶</a>
</li>
          </ul>
</section>
<section id="section-3.2.3">
          <h4 id="name-l2tpv3-tunnel-type-1">
<a class="section-number selfRef" href="#section-3.2.3">3.2.3. </a><a class="section-name selfRef" href="#name-l2tpv3-tunnel-type-1">L2TPv3 (Tunnel Type 1)</a>
          </h4>
<p id="section-3.2.3-1">
   When the tunnel type of the TLV is <span><a class="xref" href="#RFC3931">L2TPv3 over IP</a> [<a class="xref" href="#RFC3931">RFC3931</a>]</span>, the length of the sub-TLV is 
   between 4 and 12
   octets, depending on the length of the cookie. 
   The structure of the Value field of the Encapsulation sub-TLV is shown in <a class="xref" href="#ref-l2tpv3-encapsulation-sub-tlv">Figure 6</a>.<a class="pilcrow" href="#section-3.2.3-1">¶</a></p>
<span id="name-l2tpv3-encapsulation-sub-tl"></span><div id="ref-l2tpv3-encapsulation-sub-tlv">
<figure id="figure-6">
            <div class="artwork art-text alignLeft" id="section-3.2.3-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                      Session ID (4 octets)                    |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  |                        Cookie (variable)                      |
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-l2tpv3-encapsulation-sub-tl">L2TPv3 Encapsulation Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.3-3">
            <dt id="section-3.2.3-3.1">Session ID:</dt>
            <dd id="section-3.2.3-3.2" style="margin-left: 1.5em">
      A non-zero 4-octet value locally assigned by the
      advertising router that serves as a lookup key for the incoming
      packet's context.<a class="pilcrow" href="#section-3.2.3-3.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.3-3.3">Cookie:</dt>
            <dd id="section-3.2.3-3.4" style="margin-left: 1.5em">
              <p id="section-3.2.3-3.4.1">
      An optional, variable-length (encoded in 0 to 8
      octets) value used by L2TPv3 to check the association of a
      received data message with the session identified by the Session
      ID.  Generation and usage of the cookie value is as specified in
      <span>[<a class="xref" href="#RFC3931">RFC3931</a>]</span>.<a class="pilcrow" href="#section-3.2.3-3.4.1">¶</a></p>
<p id="section-3.2.3-3.4.2">
      The length of the cookie is not encoded explicitly but can be
      calculated as (sub-TLV length - 4).<a class="pilcrow" href="#section-3.2.3-3.4.2">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
<div id="gre">
<section id="section-3.2.4">
          <h4 id="name-gre-tunnel-type-2">
<a class="section-number selfRef" href="#section-3.2.4">3.2.4. </a><a class="section-name selfRef" href="#name-gre-tunnel-type-2">GRE (Tunnel Type 2)</a>
          </h4>
<p id="section-3.2.4-1">
   When the tunnel type of the TLV is <span><a class="xref" href="#RFC2784">GRE</a> [<a class="xref" href="#RFC2784">RFC2784</a>]</span>, the length of the sub-TLV is 4 octets. The structure of the Value field of the Encapsulation sub-TLV is shown in <a class="xref" href="#ref-gre-encapsulation-sub-tlv">Figure 7</a>.<a class="pilcrow" href="#section-3.2.4-1">¶</a></p>
<span id="name-gre-encapsulation-sub-tlv-v"></span><div id="ref-gre-encapsulation-sub-tlv">
<figure id="figure-7">
            <div class="artwork art-text alignLeft" id="section-3.2.4-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                      GRE Key (4 octets)                       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-gre-encapsulation-sub-tlv-v">GRE Encapsulation Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.4-3">
            <dt id="section-3.2.4-3.1">GRE Key:</dt>
            <dd id="section-3.2.4-3.2" style="margin-left: 1.5em">
      4-octet field <span>[<a class="xref" href="#RFC2890">RFC2890</a>]</span> that is generated by the
      advertising router. Note that the key is optional.  Unless a key value is being
      advertised, the GRE Encapsulation sub-TLV <span class="bcp14">MUST NOT</span> be present.<a class="pilcrow" href="#section-3.2.4-3.2">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<section id="section-3.2.5">
          <h4 id="name-mpls-in-gre-tunnel-type-11">
<a class="section-number selfRef" href="#section-3.2.5">3.2.5. </a><a class="section-name selfRef" href="#name-mpls-in-gre-tunnel-type-11">MPLS-in-GRE (Tunnel Type 11)</a>
          </h4>
<p id="section-3.2.5-1">
   When the tunnel type is <span><a class="xref" href="#RFC4023">MPLS-in-GRE</a> [<a class="xref" href="#RFC4023">RFC4023</a>]</span>, the length of the sub-TLV is 4 octets. The structure of the Value field of the Encapsulation sub-TLV is shown in <a class="xref" href="#ref-mpls-in-gre-encapsulation-sub-tlv">Figure 8</a>.<a class="pilcrow" href="#section-3.2.5-1">¶</a></p>
<span id="name-mpls-in-gre-encapsulation-s"></span><div id="ref-mpls-in-gre-encapsulation-sub-tlv">
<figure id="figure-8">
            <div class="artwork art-text alignLeft" id="section-3.2.5-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                       GRE Key (4 octets)                      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-mpls-in-gre-encapsulation-s">MPLS-in-GRE Encapsulation Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.5-3">
            <dt id="section-3.2.5-3.1">GRE Key:</dt>
            <dd id="section-3.2.5-3.2" style="margin-left: 1.5em">
      4-octet field <span>[<a class="xref" href="#RFC2890">RFC2890</a>]</span> that is generated by the
      advertising router.  Note that the key is optional.  Unless a key
      value is being advertised, the MPLS-in-GRE Encapsulation sub-TLV
      <span class="bcp14">MUST NOT</span> be present.<a class="pilcrow" href="#section-3.2.5-3.2">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.2.5-4">
   Note that the GRE tunnel type defined in <a class="xref" href="#gre">Section 3.2.4</a> can be used
   instead of the MPLS-in-GRE tunnel type when it is necessary to
   encapsulate MPLS in GRE.  Including a TLV of the MPLS-in-GRE tunnel
   type is equivalent to including a TLV of the GRE tunnel type that
   also includes a Protocol Type sub-TLV (<a class="xref" href="#protocol-type">Section 3.4.1</a>) specifying MPLS
   as the protocol to be encapsulated.<a class="pilcrow" href="#section-3.2.5-4">¶</a></p>
<p id="section-3.2.5-5">
   Although the MPLS-in-GRE tunnel type is just a special case of the GRE
   tunnel type and thus is not strictly necessary, it is included for reasons
   of backwards compatibility with, for example, implementations of <span>[<a class="xref" href="#RFC8365">RFC8365</a>]</span>.<a class="pilcrow" href="#section-3.2.5-5">¶</a></p>
</section>
</section>
<section id="section-3.3">
        <h3 id="name-outer-encapsulation-sub-tlv">
<a class="section-number selfRef" href="#section-3.3">3.3. </a><a class="section-name selfRef" href="#name-outer-encapsulation-sub-tlv">Outer Encapsulation Sub-TLVs</a>
        </h3>
<p id="section-3.3-1">
   The Encapsulation sub-TLV for a particular tunnel type allows one to
   specify the values that are to be placed in certain fields of the
   encapsulation header for that tunnel type.  However, some tunnel
   types require an outer IP encapsulation, and some also require an
   outer UDP encapsulation.  The Encapsulation sub-TLV for a given
   tunnel type does not usually provide a way to specify values for
   fields of the outer IP and/or UDP encapsulations.  If it is necessary
   to specify values for fields of the outer encapsulation, additional
   sub-TLVs must be used.  This document defines two such sub-TLVs.<a class="pilcrow" href="#section-3.3-1">¶</a></p>
<p id="section-3.3-2">
   If an outer Encapsulation sub-TLV occurs in a TLV for a tunnel type
   that does not use the corresponding outer encapsulation, the sub-TLV
   <span class="bcp14">MUST</span> be treated as if it were an unrecognized type of sub-TLV.<a class="pilcrow" href="#section-3.3-2">¶</a></p>
<section id="section-3.3.1">
          <h4 id="name-ds-field-type-code-7">
<a class="section-number selfRef" href="#section-3.3.1">3.3.1. </a><a class="section-name selfRef" href="#name-ds-field-type-code-7">DS Field (Type Code 7)</a>
          </h4>
<p id="section-3.3.1-1">
   Most of the tunnel types that can be specified in the Tunnel
   Encapsulation attribute require an outer IP encapsulation.  The
   Differentiated Services (DS) Field sub-TLV can be carried in the TLV
   of any such tunnel type.  It specifies the setting of the one-octet
   Differentiated Services field in the outer IPv4 or IPv6 encapsulation (see
   <span>[<a class="xref" href="#RFC2474">RFC2474</a>]</span>).  Any one-octet value can be transported; the semantics
   of the DSCP (Differentiated Services Code Point) field is beyond the scope of this document.  The Value field is always a single octet.<a class="pilcrow" href="#section-3.3.1-1">¶</a></p>
<span id="name-ds-field-sub-tlv-value-fiel"></span><div id="ref-ds-field">
<figure id="figure-9">
            <div class="artwork art-text alignLeft" id="section-3.3.1-2.1">
<pre>   0 1 2 3 4 5 6 7
  +-+-+-+-+-+-+-+-+
  |    DS value   |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-ds-field-sub-tlv-value-fiel">DS Field Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<p id="section-3.3.1-3">
   Because the interpretation of the DSCP field at the recipient may be 
   different from its interpretation at the originator, an implementation
   <span class="bcp14">MAY</span> provide a facility to use policy to filter or modify the DS field.<a class="pilcrow" href="#section-3.3.1-3">¶</a></p>
</section>
<section id="section-3.3.2">
          <h4 id="name-udp-destination-port-type-c">
<a class="section-number selfRef" href="#section-3.3.2">3.3.2. </a><a class="section-name selfRef" href="#name-udp-destination-port-type-c">UDP Destination Port (Type Code 8)</a>
          </h4>
<p id="section-3.3.2-1">
   Some of the tunnel types that can be specified in the Tunnel
   Encapsulation attribute require an outer UDP encapsulation.
   Generally, there is a standard UDP destination port value for a
   particular tunnel type.  However, sometimes it is useful to be able
   to use a nonstandard UDP destination port.  If a particular tunnel
   type requires an outer UDP encapsulation, and it is desired to use a
   UDP destination port other than the standard one, the port to be used
   can be specified by including a UDP Destination Port sub-TLV.  The
   Value field of this sub-TLV is always a two-octet field, containing
   the port value.  Any two-octet value other than zero can be transported.
   If the reserved value zero is received, the sub-TLV <span class="bcp14">MUST</span> be treated 
   as malformed, according to the rules of <a class="xref" href="#validation-and-error">Section 13</a>.<a class="pilcrow" href="#section-3.3.2-1">¶</a></p>
<span id="name-udp-destination-port-sub-tl"></span><div id="ref-udp-dest-port">
<figure id="figure-10">
            <div class="artwork art-text alignLeft" id="section-3.3.2-2.1">
<pre>   0                   1
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |       UDP Port (2 octets)     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-10">Figure 10</a>:
<a class="selfRef" href="#name-udp-destination-port-sub-tl">UDP Destination Port Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
</section>
</section>
<section id="section-3.4">
        <h3 id="name-sub-tlvs-for-aiding-tunnel-">
<a class="section-number selfRef" href="#section-3.4">3.4. </a><a class="section-name selfRef" href="#name-sub-tlvs-for-aiding-tunnel-">Sub-TLVs for Aiding Tunnel Selection</a>
        </h3>
<div id="protocol-type">
<section id="section-3.4.1">
          <h4 id="name-protocol-type-sub-tlv-type-">
<a class="section-number selfRef" href="#section-3.4.1">3.4.1. </a><a class="section-name selfRef" href="#name-protocol-type-sub-tlv-type-">Protocol Type Sub-TLV (Type Code 2)</a>
          </h4>
<p id="section-3.4.1-1">
   The Protocol Type sub-TLV <span class="bcp14">MAY</span> be included in a given TLV to indicate
   the type of the payload packets that are allowed to be encapsulated with the
   tunnel parameters that are being signaled in the TLV.  Packets with other
   payload types <span class="bcp14">MUST NOT</span> be encapsulated in the relevant tunnel. The Value
   field of the sub-TLV contains a 2-octet value from IANA's
"ETHER TYPES"
   registry <span>[<a class="xref" href="#IANA-ETHERTYPES">IANA-ETHERTYPES</a>]</span>. If the reserved value 0xFFFF is 
   received, the sub-TLV <span class="bcp14">MUST</span> be treated 
   as malformed according to the rules of <a class="xref" href="#validation-and-error">Section 13</a>.<a class="pilcrow" href="#section-3.4.1-1">¶</a></p>
<span id="name-protocol-type-sub-tlv-value"></span><div id="ref-proto-type">
<figure id="figure-11">
            <div class="artwork art-text alignLeft" id="section-3.4.1-2.1">
<pre>   0                   1
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |      Ethertype (2 octets)     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-11">Figure 11</a>:
<a class="selfRef" href="#name-protocol-type-sub-tlv-value">Protocol Type Sub-TLV Value Field</a>
            </figcaption></figure>
</div>
<p id="section-3.4.1-3">
   For example, if there are three L2TPv3 sessions, one carrying
   IPv4 packets, one carrying IPv6 packets, and one carrying MPLS
   packets, the egress router will include three TLVs of L2TPv3
   encapsulation type, each specifying a different Session ID and a
   different payload type.  The Protocol Type sub-TLV for these will be
   IPv4 (protocol type = 0x0800), IPv6 (protocol type = 0x86dd), and
   MPLS (protocol type = 0x8847), respectively.  This informs the
   ingress routers of the appropriate encapsulation information to use
   with each of the given protocol types.  Insertion of the specified
   Session ID at the ingress routers allows the egress to process the
   incoming packets correctly, according to their protocol type.<a class="pilcrow" href="#section-3.4.1-3">¶</a></p>
<p id="section-3.4.1-4">
   Note that for tunnel types whose names are of the form "X-in-Y"
   (for example, MPLS-in-GRE), only packets of the specified payload type "X"
   are to be carried through the tunnel of type "Y".  This is the
   equivalent of specifying a tunnel type "Y" and including in its TLV a
   Protocol Type sub-TLV (see <a class="xref" href="#protocol-type">Section 3.4.1</a>) specifying
   protocol "X".  If the tunnel type is "X-in-Y", it is unnecessary,
   though harmless, to explicitly include a Protocol Type sub-TLV
   specifying "X". Also, for "X-in-Y" type tunnels, a Protocol Type
   sub-TLV specifying anything other than "X" <span class="bcp14">MUST</span> be ignored; this is
   discussed further in <a class="xref" href="#validation-and-error">Section 13</a>.<a class="pilcrow" href="#section-3.4.1-4">¶</a></p>
</section>
</div>
<div id="color">
<section id="section-3.4.2">
          <h4 id="name-color-sub-tlv-type-code-4">
<a class="section-number selfRef" href="#section-3.4.2">3.4.2. </a><a class="section-name selfRef" href="#name-color-sub-tlv-type-code-4">Color Sub-TLV (Type Code 4)</a>
          </h4>
<p id="section-3.4.2-1">
   The Color sub-TLV <span class="bcp14">MAY</span> be used as a way to "color" the
   corresponding Tunnel TLV.  The Value field of the sub-TLV is eight
   octets long and consists of a Color Extended Community, as defined
   in <a class="xref" href="#color-extcomm">Section 4.3</a>.  For the use of this sub-TLV and extended community,
   please see <a class="xref" href="#recursive-nh-resolution">Section 8</a>.<a class="pilcrow" href="#section-3.4.2-1">¶</a></p>
<p id="section-3.4.2-2">The format of the Value field is depicted in 
   <a class="xref" href="#ref-color-extended-community">Figure 15</a>.<a class="pilcrow" href="#section-3.4.2-2">¶</a></p>
<p id="section-3.4.2-3">
   If the Length field of a Color sub-TLV has a value other than 8, or the first two
   octets of its Value field are not 0x030b, the sub-TLV <span class="bcp14">MUST</span> be
   treated as if it were an unrecognized sub-TLV (see <a class="xref" href="#validation-and-error">Section 13</a>).<a class="pilcrow" href="#section-3.4.2-3">¶</a></p>
</section>
</div>
</section>
<section id="section-3.5">
        <h3 id="name-embedded-label-handling-sub">
<a class="section-number selfRef" href="#section-3.5">3.5. </a><a class="section-name selfRef" href="#name-embedded-label-handling-sub">Embedded Label Handling Sub-TLV (Type Code 9)</a>
        </h3>
<p id="section-3.5-1">
   Certain BGP address families (corresponding to particular AFI/SAFI
   pairs, for example, 1/4, 2/4, 1/128, 2/128) have MPLS labels embedded in
   their NLRIs.  The term "embedded label" is used to refer to the
   MPLS label that is embedded in an NLRI, and the term "labeled address family" 
   to refer to any AFI/SAFI that has embedded labels.<a class="pilcrow" href="#section-3.5-1">¶</a></p>
<p id="section-3.5-2">
   Some of the tunnel types (for example, VXLAN and NVGRE) that can
   be specified in the Tunnel Encapsulation attribute have an
   encapsulation header containing a virtual network identifier of some
   sort.  The Encapsulation sub-TLVs for these tunnel types may
   optionally specify a value for the virtual network identifier.<a class="pilcrow" href="#section-3.5-2">¶</a></p>
<p id="section-3.5-3">
   Suppose a Tunnel Encapsulation attribute is attached to an UPDATE of
   a labeled address family, and it is decided to use a particular
   tunnel (specified in one of the attribute's TLVs) for transmitting a
   packet that is being forwarded according to that UPDATE.  When
   forming the encapsulation header for that packet, different
   deployment scenarios require different handling of the embedded label
   and/or the virtual network identifier.  The Embedded Label Handling
   sub-TLV can be used to control the placement of the embedded label
   and/or the virtual network identifier in the encapsulation.<a class="pilcrow" href="#section-3.5-3">¶</a></p>
<p id="section-3.5-4">
   The Embedded Label Handling sub-TLV may be included in any TLV of the
   Tunnel Encapsulation attribute.  If the Tunnel Encapsulation
   attribute is attached to an UPDATE of a non-labeled address family,
   then the sub-TLV <span class="bcp14">MUST</span> be disregarded.  If the sub-TLV is contained in a
   TLV whose tunnel type does not have a virtual network identifier in
   its encapsulation header, the sub-TLV <span class="bcp14">MUST</span> be disregarded.  In
   those cases where the sub-TLV is ignored, it <span class="bcp14">MUST NOT</span> be
   stripped from the TLV before the route is propagated.<a class="pilcrow" href="#section-3.5-4">¶</a></p>
<p id="section-3.5-5">
   The sub-TLV's Length field always contains the value 1, and its Value
   field consists of a single octet.  The following values are defined:<a class="pilcrow" href="#section-3.5-5">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.5-6">
          <dt id="section-3.5-6.1">1:</dt>
          <dd id="section-3.5-6.2" style="margin-left: 2.0em">The payload will be an MPLS packet with the embedded label at the top of its label stack.<a class="pilcrow" href="#section-3.5-6.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.5-6.3">2:</dt>
          <dd id="section-3.5-6.4" style="margin-left: 2.0em">
            <p id="section-3.5-6.4.1">The embedded label is not carried in the payload but is either carried
 in the Virtual Network Identifier field of the
 encapsulation header or else ignored entirely.<a class="pilcrow" href="#section-3.5-6.4.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.5-7">If any value other than 1 or 2 is carried, the sub-TLV <span class="bcp14">MUST</span> be 
 considered malformed, according to the procedures of <a class="xref" href="#validation-and-error">Section 13</a>.<a class="pilcrow" href="#section-3.5-7">¶</a></p>
<p id="section-3.5-8">
   Please see <a class="xref" href="#use-of-vni">Section 9</a> for the details of how this sub-TLV is used when
   it is carried by an UPDATE of a labeled address family.<a class="pilcrow" href="#section-3.5-8">¶</a></p>
<span id="name-embedded-label-handling-sub-"></span><div id="ref-embedded-label">
<figure id="figure-12">
          <div class="artwork art-text alignLeft" id="section-3.5-9.1">
<pre>   0 1 2 3 4 5 6 7
  +-+-+-+-+-+-+-+-+
  |     1 or 2    |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-12">Figure 12</a>:
<a class="selfRef" href="#name-embedded-label-handling-sub-">Embedded Label Handling Sub-TLV Value Field</a>
          </figcaption></figure>
</div>
</section>
<div id="label-stack">
<section id="section-3.6">
        <h3 id="name-mpls-label-stack-sub-tlv-ty">
<a class="section-number selfRef" href="#section-3.6">3.6. </a><a class="section-name selfRef" href="#name-mpls-label-stack-sub-tlv-ty">MPLS Label Stack Sub-TLV (Type Code 10)</a>
        </h3>
<p id="section-3.6-1">
   This sub-TLV allows an MPLS label stack <span>[<a class="xref" href="#RFC3032">RFC3032</a>]</span> to be associated
   with a particular tunnel.<a class="pilcrow" href="#section-3.6-1">¶</a></p>
<p id="section-3.6-2">
   The length of the sub-TLV is a multiple of 4 octets, and the Value field of this sub-TLV 
   is a sequence of MPLS label stack entries.  The first entry in the sequence is the 
   "topmost" label, and the final entry in the sequence is the "bottommost" label.  When this
   label stack is pushed onto a packet, this ordering <span class="bcp14">MUST</span> be preserved.<a class="pilcrow" href="#section-3.6-2">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.6-3">
          <dt id="section-3.6-3.1">Each label stack entry has the format shown in <a class="xref" href="#ref-mpls-label-stack-sub-tlv">Figure 13</a>.</dt>
          <dd id="section-3.6-3.2" style="margin-left: 1.5em"></dd>
        <dd class="break"></dd>
</dl>
<span id="name-mpls-label-stack-sub-tlv-va"></span><div id="ref-mpls-label-stack-sub-tlv">
<figure id="figure-13">
          <div class="artwork art-text alignLeft" id="section-3.6-4.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Label                  |  TC |S|      TTL      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-13">Figure 13</a>:
<a class="selfRef" href="#name-mpls-label-stack-sub-tlv-va">MPLS Label Stack Sub-TLV Value Field</a>
          </figcaption></figure>
</div>
<p id="section-3.6-5">
   The fields are as defined in <span>[<a class="xref" href="#RFC3032">RFC3032</a>]</span> and <span>[<a class="xref" href="#RFC5462">RFC5462</a>]</span>.<a class="pilcrow" href="#section-3.6-5">¶</a></p>
<p id="section-3.6-6">
   If a packet is to be sent through the tunnel identified in a
   particular TLV, and if that TLV contains an MPLS Label Stack sub-TLV,
   then the label stack appearing in the sub-TLV <span class="bcp14">MUST</span> be pushed onto the
   packet before any
   other labels are pushed onto the packet. (See <a class="xref" href="#usage">Section 6</a>
   for further discussion.)<a class="pilcrow" href="#section-3.6-6">¶</a></p>
<p id="section-3.6-7">
   In particular, if the Tunnel Encapsulation attribute is attached to a
   BGP UPDATE of a labeled address family, the contents of the MPLS
   Label Stack sub-TLV <span class="bcp14">MUST</span> be pushed onto the packet before the label
   embedded in the NLRI is pushed onto the packet.<a class="pilcrow" href="#section-3.6-7">¶</a></p>
<p id="section-3.6-8">
   If the MPLS Label Stack sub-TLV is included in a TLV identifying a
   tunnel type that uses virtual network identifiers (see <a class="xref" href="#use-of-vni">Section 9</a>),
   the contents of the MPLS Label Stack sub-TLV <span class="bcp14">MUST</span> be pushed onto the
   packet before the procedures of <a class="xref" href="#use-of-vni">Section 9</a> are applied.<a class="pilcrow" href="#section-3.6-8">¶</a></p>
<p id="section-3.6-9">
   The number of label stack entries in the sub-TLV <span class="bcp14">MUST</span> be determined
   from the Sub-TLV Length field.  Thus, it is not necessary to set the S
   bit in any of the label stack entries of the sub-TLV, and the setting
   of the S bit is ignored when parsing the sub-TLV.  When the label stack entries are pushed onto a packet that already has a label
   stack, the S bits of all the entries being pushed <span class="bcp14">MUST</span> be cleared.  When the label stack entries are pushed onto a packet that does not already have a
   label stack, the S bit of the bottommost label stack entry <span class="bcp14">MUST</span> be
   set, and the S bit of all the other label stack entries <span class="bcp14">MUST</span> be
   cleared.<a class="pilcrow" href="#section-3.6-9">¶</a></p>
<p id="section-3.6-10">
   The Traffic Class (TC) field <span>[<a class="xref" href="#RFC3270">RFC3270</a>]</span><span>[<a class="xref" href="#RFC5129">RFC5129</a>]</span> of each label stack entry <span class="bcp14">SHOULD</span> be set to 0,
   unless changed by policy at the originator of the sub-TLV.  When
   pushing the label stack onto a packet, the TC of each label stack
   <span class="bcp14">SHOULD</span> be preserved, unless local policy results in a modification.<a class="pilcrow" href="#section-3.6-10">¶</a></p>
<p id="section-3.6-11">
   The TTL (Time to Live) field of each label stack entry <span class="bcp14">SHOULD</span> be set
   to 255, unless changed to some other non-zero value by policy at the
   originator of the sub-TLV. When pushing the label stack onto a
   packet, the TTL of each label stack entry <span class="bcp14">SHOULD</span> be preserved, unless
   local policy results in a modification to some other non-zero value. 
   If any label stack entry in the sub-TLV has a TTL value of zero, the
   router that is pushing the stack onto a packet <span class="bcp14">MUST</span> change the value to
   a non-zero value, either 255 or some other value as determined by
   policy as discussed above.<a class="pilcrow" href="#section-3.6-11">¶</a></p>
<p id="section-3.6-12">
   Note that this sub-TLV can appear within a TLV identifying any
   type of tunnel, not just within a TLV identifying an MPLS tunnel.
   However, if this sub-TLV appears within a TLV identifying an MPLS
   tunnel (or an MPLS-in-X tunnel), this sub-TLV plays the same role
   that would be played by an MPLS Encapsulation sub-TLV.  Therefore, an
   MPLS Encapsulation sub-TLV is not defined.<a class="pilcrow" href="#section-3.6-12">¶</a></p>
<p id="section-3.6-13">
   Although this specification does not supply detailed instructions
   for validating the received label stack, implementations might 
   impose restrictions on the label stack they can support. If an
   invalid or unsupported label stack is received, the tunnel <span class="bcp14">MAY</span> be treated as not feasible, according to the 
   procedures of <a class="xref" href="#usage">Section 6</a>.<a class="pilcrow" href="#section-3.6-13">¶</a></p>
</section>
</div>
<div id="prefix-sid">
<section id="section-3.7">
        <h3 id="name-prefix-sid-sub-tlv-type-cod">
<a class="section-number selfRef" href="#section-3.7">3.7. </a><a class="section-name selfRef" href="#name-prefix-sid-sub-tlv-type-cod">Prefix-SID Sub-TLV (Type Code 11)</a>
        </h3>
<p id="section-3.7-1">
   <span>[<a class="xref" href="#RFC8669">RFC8669</a>]</span> defines a BGP path
   attribute known as the "BGP Prefix-SID attribute".  This attribute is
   defined to contain a sequence of one or more TLVs, where each TLV is
   either a Label-Index TLV or an Originator SRGB (Source Routing
   Global Block) TLV.<a class="pilcrow" href="#section-3.7-1">¶</a></p>
<p id="section-3.7-2">
   This document defines a Prefix-SID (Prefix Segment Identifier) sub-TLV.
   The Value field of the Prefix-SID sub-TLV can be set to any permitted
   value of the Value field of a BGP Prefix-SID attribute <span>[<a class="xref" href="#RFC8669">RFC8669</a>]</span>.<a class="pilcrow" href="#section-3.7-2">¶</a></p>
<p id="section-3.7-3">
   <span>[<a class="xref" href="#RFC8669">RFC8669</a>]</span> only defines behavior when the BGP Prefix-SID
   attribute is attached to routes of type IPv4/IPv6 Labeled Unicast
   <span>[<a class="xref" href="#RFC4760">RFC4760</a>]</span><span>[<a class="xref" href="#RFC8277">RFC8277</a>]</span>, and it only
   defines values of the BGP Prefix-SID attribute for those cases. Therefore, 
   similar limitations exist for the Prefix-SID sub-TLV: it <span class="bcp14">SHOULD</span> only
   be included in a BGP UPDATE message for one of the address families
   for which <span>[<a class="xref" href="#RFC8669">RFC8669</a>]</span> has a defined behavior, namely BGP IPv4/IPv6 Labeled Unicast <span>[<a class="xref" href="#RFC4760">RFC4760</a>]</span> <span>[<a class="xref" href="#RFC8277">RFC8277</a>]</span>. If included in a BGP UPDATE for
   any other address family, it <span class="bcp14">MUST</span> be ignored.<a class="pilcrow" href="#section-3.7-3">¶</a></p>
<p id="section-3.7-4">
   The Prefix-SID sub-TLV can occur in a TLV identifying any type of
   tunnel.  If an Originator SRGB is specified in the sub-TLV, that SRGB
   <span class="bcp14">MUST</span> be interpreted to be the SRGB used by the tunnel's
   egress endpoint.  The Label-Index, if present, is the Segment Routing SID
   that the tunnel's egress endpoint uses to represent the prefix
   appearing in the NLRI field of the BGP UPDATE to which the Tunnel
   Encapsulation attribute is attached.<a class="pilcrow" href="#section-3.7-4">¶</a></p>
<p id="section-3.7-5">
   If a Label-Index is present in the Prefix-SID sub-TLV, then when a
   packet is sent through the tunnel identified by the TLV, if that tunnel
   is from a labeled address family, the
   corresponding MPLS label <span class="bcp14">MUST</span> be pushed on the packet's label stack.
   The corresponding MPLS label is computed from the Label-Index value
   and the SRGB of the route's originator, as specified in 
   <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8669#section-4.1">Section 4.1</a> of [<a class="xref" href="#RFC8669">RFC8669</a>]</span>.<a class="pilcrow" href="#section-3.7-5">¶</a></p>
<p id="section-3.7-6">
   The corresponding MPLS label is pushed on after the processing of the
   MPLS Label Stack sub-TLV, if present, as specified in <a class="xref" href="#label-stack">Section 3.6</a>.
   It is pushed on before any other labels (for example, a label embedded in an
   UPDATE's NLRI or a label determined by the procedures of <a class="xref" href="#use-of-vni">Section 9</a>) are pushed on the stack.<a class="pilcrow" href="#section-3.7-6">¶</a></p>
<p id="section-3.7-7">
   The Prefix-SID sub-TLV has slightly different semantics than the
   BGP Prefix-SID attribute.  When the BGP Prefix-SID attribute is attached to a
   given route, the BGP speaker that originally attached the attribute
   is expected to be in the same Segment Routing domain as the BGP
   speakers who receive the route with the attached attribute.  The
   Label-Index tells the receiving BGP speakers what the Prefix-SID is
   for the advertised prefix in that Segment Routing domain.  When the
   Prefix-SID sub-TLV is used, there is no implication that the
   Prefix-SID for the advertised prefix is the same in the Segment
   Routing domains of the BGP speaker that originated the sub-TLV and
   the BGP speaker that received it.<a class="pilcrow" href="#section-3.7-7">¶</a></p>
</section>
</div>
</section>
<section id="section-4">
      <h2 id="name-extended-communities-relate">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-extended-communities-relate">Extended Communities Related to the Tunnel Encapsulation Attribute</a>
      </h2>
<div id="encapsulation-extcomm">
<section id="section-4.1">
        <h3 id="name-encapsulation-extended-comm">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-encapsulation-extended-comm">Encapsulation Extended Community</a>
        </h3>
<p id="section-4.1-1">
   The Encapsulation Extended Community is a Transitive Opaque Extended
   Community.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2"> The Encapsulation Extended Community encoding is as shown in <a class="xref" href="#ref-Encapsulation-extended-community">Figure 14</a>.<a class="pilcrow" href="#section-4.1-2">¶</a></p>
<span id="name-encapsulation-extended-commu"></span><div id="ref-Encapsulation-extended-community">
<figure id="figure-14">
          <div class="artwork art-text alignLeft" id="section-4.1-3.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | 0x03 (1 octet)| 0x0c (1 octet)|       Reserved (2 octets)     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |     Reserved (2 octets)       |    Tunnel Type (2 octets)     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-14">Figure 14</a>:
<a class="selfRef" href="#name-encapsulation-extended-commu">Encapsulation Extended Community</a>
          </figcaption></figure>
</div>
<p id="section-4.1-4">The value of the high-order octet of the extended Type field is 0x03,
   which indicates it's transitive.  The value of the low-order octet of
   the extended Type field is 0x0c.<a class="pilcrow" href="#section-4.1-4">¶</a></p>
<p id="section-4.1-5">The last two octets of the Value field encode a tunnel type.<a class="pilcrow" href="#section-4.1-5">¶</a></p>
<p id="section-4.1-6">This extended community may be attached to a route of any
   AFI/SAFI to which the Tunnel Encapsulation attribute may be attached.
   Each such extended community identifies a particular tunnel type; its 
   semantics are the same as semantics of a Tunnel TLV in a Tunnel Encapsulation attribute,
    for which the following three conditions all hold:<a class="pilcrow" href="#section-4.1-6">¶</a></p>
<ol class="normal type-1" id="section-4.1-7" start="1" type="1">
   <li id="section-4.1-7.1">It identifies the same tunnel type.<a class="pilcrow" href="#section-4.1-7.1">¶</a>
</li>
          <li id="section-4.1-7.2">
            <p id="section-4.1-7.2.1">It has a Tunnel Egress Endpoint sub-TLV for which one of the following
       two conditions holds:<a class="pilcrow" href="#section-4.1-7.2.1">¶</a></p>
<ol class="normal type-a" id="section-4.1-7.2.2" start="1" type="a">
       <li id="section-4.1-7.2.2.1">Its Address Family subfield contains zero, or<a class="pilcrow" href="#section-4.1-7.2.2.1">¶</a>
</li>
              <li id="section-4.1-7.2.2.2">Its Address subfield contains the address of the Next Hop field of 
           the route to which the Tunnel Encapsulation attribute is attached.<a class="pilcrow" href="#section-4.1-7.2.2.2">¶</a>
</li>
            </ol>
</li>
          <li id="section-4.1-7.3">It has no other sub-TLVs.<a class="pilcrow" href="#section-4.1-7.3">¶</a>
</li>
        </ol>
<p id="section-4.1-8">
   Such a Tunnel TLV is called a "barebones" Tunnel TLV.<a class="pilcrow" href="#section-4.1-8">¶</a></p>
<p id="section-4.1-9">
   The Encapsulation Extended Community was first defined in <span>[<a class="xref" href="#RFC5512">RFC5512</a>]</span>.
   While it provides only a small subset of the functionality of the
   Tunnel Encapsulation attribute, it is used in a number of deployed
   applications and is still needed for backwards compatibility.
   In situations where a tunnel could be encoded using
   a barebones TLV, it <span class="bcp14">MUST</span> be encoded using the corresponding 
   Encapsulation Extended Community.  Notwithstanding, an implementation 
   <span class="bcp14">MUST</span> be prepared to process a tunnel received encoded as a barebones 
   TLV.<a class="pilcrow" href="#section-4.1-9">¶</a></p>
<p id="section-4.1-10">
   Note that for tunnel types of the form "X-in-Y" (for example, MPLS-in-GRE),
   the Encapsulation Extended Community implies that only packets of the
   specified payload type "X" are to be carried through the tunnel of
   type "Y". Packets with other payload types <span class="bcp14">MUST NOT</span> be carried through
   such tunnels. See also <a class="xref" href="#encaps-attr">Section 2</a>.<a class="pilcrow" href="#section-4.1-10">¶</a></p>
<p id="section-4.1-11">
   In the remainder of this specification, when a route is referred to as
   containing a Tunnel Encapsulation attribute with a TLV identifying a
   particular tunnel type, it implicitly includes the case where
   the route contains an Encapsulation Extended Community
   identifying that tunnel type.<a class="pilcrow" href="#section-4.1-11">¶</a></p>
</section>
</div>
<section id="section-4.2">
        <h3 id="name-routers-mac-extended-commun">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-routers-mac-extended-commun">Router's MAC Extended Community</a>
        </h3>
<p id="section-4.2-1">
   <span>[<a class="xref" href="#I-D.ietf-bess-evpn-inter-subnet-forwarding">EVPN-INTER-SUBNET</a>]</span> defines a router's MAC 
   Extended Community. This extended community, as its name implies,
   carries the MAC address of the advertising router. Since the VXLAN
   and NVGRE Encapsulation sub-TLVs can also optionally carry a router's
   MAC, a conflict can arise if both the Router's MAC Extended Community
   and such an Encapsulation sub-TLV are present at the same time but
   have different values. In
   case of such a conflict, the information in the Router's MAC Extended Community
   <span class="bcp14">MUST</span> be used.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
</section>
<div id="color-extcomm">
<section id="section-4.3">
        <h3 id="name-color-extended-community">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-color-extended-community">Color Extended Community</a>
        </h3>
<p id="section-4.3-1">
   The Color Extended Community is a Transitive Opaque Extended
   Community with the encoding shown in <a class="xref" href="#ref-color-extended-community">Figure 15</a>.<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<span id="name-color-extended-community-2"></span><div id="ref-color-extended-community">
<figure id="figure-15">
          <div class="artwork art-text alignLeft" id="section-4.3-2.1">
<pre>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | 0x03 (1 octet)| 0x0b (1 octet)|        Flags (2 octets)       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                      Color Value (4 octets)                   |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-15">Figure 15</a>:
<a class="selfRef" href="#name-color-extended-community-2">Color Extended Community</a>
          </figcaption></figure>
</div>
<p id="section-4.3-3">
   The value of the high-order octet of the extended Type field is 0x03, which 
   indicates it is transitive.  The value of the low-order octet of the extended 
   Type field for this community is 0x0b.  The color value is user defined and 
   configured locally. No flags are defined in this document; this field <span class="bcp14">MUST</span> be set to 
   zero by the originator and ignored by the receiver; the value <span class="bcp14">MUST NOT</span> be 
   changed when propagating this extended community. The Color Value field is 
   encoded as a 4-octet value by the administrator and is outside the scope
   of this document. For the use of this extended community, please see 
  <a class="xref" href="#recursive-nh-resolution">Section 8</a>.<a class="pilcrow" href="#section-4.3-3">¶</a></p>
</section>
</div>
</section>
<div id="ipip-considerations">
<section id="section-5">
      <h2 id="name-special-considerations-for-">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-special-considerations-for-">Special Considerations for IP-in-IP Tunnels</a>
      </h2>
<p id="section-5-1">
   In certain situations with an IP fabric underlay, one could have a tunnel overlay
   with the tunnel type IP-in-IP. The egress BGP speaker can advertise the
   IP-in-IP tunnel endpoint address in the Tunnel Egress Endpoint sub-TLV. When
   the tunnel type of the TLV is IP-in-IP, it will not have a virtual network
   identifier. However, the tunnel egress endpoint address can be used in identifying 
   the forwarding table to use for making the forwarding decisions to forward 
   the payload.<a class="pilcrow" href="#section-5-1">¶</a></p>
</section>
</div>
<div id="usage">
<section id="section-6">
      <h2 id="name-semantics-and-usage-of-the-">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-semantics-and-usage-of-the-">Semantics and Usage of the Tunnel Encapsulation Attribute</a>
      </h2>
<p id="section-6-1">
   The BGP Tunnel Encapsulation attribute <span class="bcp14">MAY</span> be carried in any BGP
   UPDATE message whose AFI/SAFI is 1/1 (IPv4 Unicast), 2/1 (IPv6
   Unicast), 1/4 (IPv4 Labeled Unicast), 2/4 (IPv6 Labeled Unicast),
   1/128 (VPN-IPv4 Labeled Unicast), 2/128 (VPN-IPv6 Labeled Unicast),
   or 25/70 (Ethernet VPN, usually known as EVPN).  Use of the Tunnel
   Encapsulation attribute in BGP UPDATE messages of other AFI/SAFIs is
   outside the scope of this document.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">
   There is no significance to the order in which the TLVs occur within
   the Tunnel Encapsulation attribute.  Multiple TLVs may occur for a
   given tunnel type; each such TLV is regarded as describing a
   different tunnel. (This also applies if the Encapsulation 
   Extended Community encoding is used.)<a class="pilcrow" href="#section-6-2">¶</a></p>
<p id="section-6-3">
   The decision to attach a Tunnel Encapsulation attribute to a given
   BGP UPDATE is determined by policy.  The set of TLVs and sub-TLVs
   contained in the attribute is also determined by policy.<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">
   Suppose that:<a class="pilcrow" href="#section-6-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-5.1">a given packet P must be forwarded by router R;<a class="pilcrow" href="#section-6-5.1">¶</a>
</li>
        <li class="normal" id="section-6-5.2">the path along which P is to be forwarded is determined by BGP
      UPDATE U;<a class="pilcrow" href="#section-6-5.2">¶</a>
</li>
        <li class="normal" id="section-6-5.3">
          <p id="section-6-5.3.1">UPDATE U has a Tunnel Encapsulation attribute, containing at least
      one TLV that identifies a "feasible tunnel" for packet P.  A
      tunnel is considered feasible if it has the following four
      properties:<a class="pilcrow" href="#section-6-5.3.1">¶</a></p>
<ol class="normal type-1" id="section-6-5.3.2" start="1" type="1">
            <li id="section-6-5.3.2.1">The tunnel type is supported (that is, router R knows how to set up tunnels of that type, how to create the encapsulation header for tunnels of that type, etc.).<a class="pilcrow" href="#section-6-5.3.2.1">¶</a>
</li>
            <li id="section-6-5.3.2.2">The tunnel is of a type that can be used to carry packet P (for example, an MPLS-in-UDP tunnel would not be a feasible tunnel for
         carrying an IP packet, unless the IP packet can first be
         encapsulated in a MPLS packet).<a class="pilcrow" href="#section-6-5.3.2.2">¶</a>
</li>
            <li id="section-6-5.3.2.3">The tunnel is specified in a TLV whose Tunnel Egress Endpoint sub-TLV
  identifies an IP address that is reachable. The reachability condition
  is evaluated as per <span>[<a class="xref" href="#RFC4271">RFC4271</a>]</span>.  If the IP address is 
  reachable via more than one forwarding table, local policy is used 
  to determine which table to use.<a class="pilcrow" href="#section-6-5.3.2.3">¶</a>
</li>
            <li id="section-6-5.3.2.4">There is no local policy that prevents the use of the tunnel.<a class="pilcrow" href="#section-6-5.3.2.4">¶</a>
</li>
          </ol>
</li>
      </ul>
<p id="section-6-6">
   Then router R <span class="bcp14">MUST</span> send packet P through one of the feasible
   tunnels identified in the Tunnel Encapsulation attribute of UPDATE U.<a class="pilcrow" href="#section-6-6">¶</a></p>
<p id="section-6-7">
   If the Tunnel Encapsulation attribute contains several TLVs (that is, if
   it specifies several feasible tunnels), router R may choose any one of those
   tunnels, based upon local policy.  If any Tunnel TLV contains
   one or more Color sub-TLVs (<a class="xref" href="#color">Section 3.4.2</a>) and/or the Protocol Type sub-TLV (<a class="xref" href="#protocol-type">Section 3.4.1</a>), the choice of tunnel may be influenced by these 
   sub-TLVs. Many other factors, for example, minimization of encapsulation-header 
   overhead, could also be used to influence selection.<a class="pilcrow" href="#section-6-7">¶</a></p>
<p id="section-6-8">
   The reachability to the address of the egress endpoint of the tunnel may change over 
   time, directly impacting the feasibility of the tunnel. A tunnel that is not 
   feasible at some moment may become feasible at a later time when its egress endpoint 
   address is reachable. The router may start using the newly feasible tunnel
   instead of an existing one. How this decision is made is outside the scope
   of this document.<a class="pilcrow" href="#section-6-8">¶</a></p>
<p id="section-6-9">
   Once it is determined to send a packet through the tunnel specified
   in a particular Tunnel TLV of a particular Tunnel Encapsulation attribute,
   then the tunnel's egress endpoint address is the IP address contained
   in the Tunnel Egress Endpoint sub-TLV.  If the Tunnel TLV contains a Tunnel Egress Endpoint sub-TLV 
   whose Value field is all zeroes, then the tunnel's egress endpoint is the
   address of the next hop of the BGP UPDATE containing the Tunnel Encapsulation 
   attribute (that is, the Network Address of Next Hop field of the 
   MP_REACH_NLRI attribute if the encoding of [RFC4760] is in use or
   the NEXT_HOP attribute otherwise).  The address of the tunnel egress endpoint generally appears in a 
   Destination Address field of the encapsulation.<a class="pilcrow" href="#section-6-9">¶</a></p>
<p id="section-6-10">
   The full set of procedures for sending a packet through a particular
   tunnel type to a particular tunnel egress endpoint depends upon the tunnel
   type and is outside the scope of this document.  Note that some
   tunnel types may require the execution of an explicit tunnel setup
   protocol before they can be used for carrying data.  Other tunnel
   types may not require any tunnel setup protocol.<a class="pilcrow" href="#section-6-10">¶</a></p>
<p id="section-6-11">
   Sending a packet through a tunnel always requires that the packet be
   encapsulated, with an encapsulation header that is appropriate for
   the tunnel type.  The contents of the tunnel encapsulation header may
   be influenced by the Encapsulation sub-TLV.  If there is no
   Encapsulation sub-TLV present, the router transmitting the packet
   through the tunnel must have a priori knowledge (for example, by
   provisioning) of how to fill in the various fields in the
   encapsulation header.<a class="pilcrow" href="#section-6-11">¶</a></p>
<p id="section-6-12">
   A Tunnel Encapsulation attribute may contain several TLVs that all
   specify the same tunnel type.  Each TLV should be considered as
   specifying a different tunnel.  Two tunnels of the same type may have
   different Tunnel Egress Endpoint sub-TLVs, different Encapsulation sub-TLVs,
   etc.  Choosing between two such tunnels is a matter of local policy.<a class="pilcrow" href="#section-6-12">¶</a></p>
<p id="section-6-13">
   Once router R has decided to send packet P through a particular
   tunnel, it encapsulates packet P appropriately and then forwards it
   according to the route that leads to the tunnel's egress endpoint.
   This route may itself be a BGP route with a Tunnel Encapsulation
   attribute.  If so, the encapsulated packet is treated as the payload
   and encapsulated according to the Tunnel Encapsulation attribute
   of that route.  That is, tunnels may be "stacked".<a class="pilcrow" href="#section-6-13">¶</a></p>
<p id="section-6-14">
   Notwithstanding anything said in this document, a BGP speaker <span class="bcp14">MAY</span>
   have local policy that influences the choice of tunnel and the way
   the encapsulation is formed.  A BGP speaker <span class="bcp14">MAY</span> also have a local
   policy that tells it to ignore the Tunnel Encapsulation attribute
   entirely or in part.  Of course, interoperability issues must be
   considered when such policies are put into place.<a class="pilcrow" href="#section-6-14">¶</a></p>
<p id="section-6-15">
    See also <a class="xref" href="#validation-and-error">Section 13</a>, which provides further 
    specification regarding validation and exception cases.<a class="pilcrow" href="#section-6-15">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-routing-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-routing-considerations">Routing Considerations</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-impact-on-the-bgp-decision-">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-impact-on-the-bgp-decision-">Impact on the BGP Decision Process</a>
        </h3>
<p id="section-7.1-1">
       The presence of the Tunnel Encapsulation attribute affects
       the BGP best route-selection algorithm. If a route includes 
       the Tunnel Encapsulation attribute, and if that attribute 
       includes no tunnel that is feasible, then that route <span class="bcp14">MUST NOT</span> be considered resolvable for the purposes of the route resolvability 
       condition (<span>[<a class="xref" href="#RFC4271">RFC4271</a>], <a class="relref" href="https://www.rfc-editor.org/rfc/rfc4271#section-9.1.2.1">Section 9.1.2.1</a></span>).<a class="pilcrow" href="#section-7.1-1">¶</a></p>
</section>
<section id="section-7.2">
        <h3 id="name-looping-mutual-recursion-et">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-looping-mutual-recursion-et">Looping, Mutual Recursion, Etc.</a>
        </h3>
<p id="section-7.2-1">
   Consider a packet destined for address X.  Suppose a BGP UPDATE for
   address prefix X carries a Tunnel Encapsulation attribute that
   specifies a tunnel egress endpoint of Y, and suppose that a BGP
   UPDATE for address prefix Y carries a Tunnel Encapsulation attribute
   that specifies a tunnel egress endpoint of X.  It is easy to see that this
   can have no good outcome. <span>[<a class="xref" href="#RFC4271">RFC4271</a>]</span> describes an analogous case
   as mutually recursive routes.<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<p id="section-7.2-2">
   This could happen as a result of misconfiguration, either accidental
   or intentional.  It could also happen if the Tunnel Encapsulation
   attribute were altered by a malicious agent.  Implementations should
   be aware that such an attack will result in unresolvable BGP routes due to the 
   mutually recursive relationship. This document does not specify a maximum number of
   recursions; that is an implementation-specific matter.<a class="pilcrow" href="#section-7.2-2">¶</a></p>
<p id="section-7.2-3">
   Improper setting (or malicious altering) of the Tunnel Encapsulation
   attribute could also cause data packets to loop.  Suppose a BGP
   UPDATE for address prefix X carries a Tunnel Encapsulation attribute
   that specifies a tunnel egress endpoint of Y.  Suppose router R
   receives and processes the advertisement. When router R receives a packet
   destined for X, it will apply the encapsulation and send the
   encapsulated packet to Y.  Y will decapsulate the packet and forward
   it further.  If Y is further away from X than is router R, it is
   possible that the path from Y to X will traverse R.  This would cause
   a long-lasting routing loop.  The control plane itself cannot detect
   this situation, though a TTL field in the payload packets would
   prevent any given packet from looping infinitely.<a class="pilcrow" href="#section-7.2-3">¶</a></p>
<p id="section-7.2-4">
   During the deployment of techniques described
   in this document, operators are encouraged to avoid mutually
   recursive route and/or tunnel dependencies. There is greater
   potential for such scenarios to arise when the tunnel egress endpoint for a
   given prefix differs from the address of the next hop for that
   prefix.<a class="pilcrow" href="#section-7.2-4">¶</a></p>
</section>
</section>
<div id="recursive-nh-resolution">
<section id="section-8">
      <h2 id="name-recursive-next-hop-resoluti">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-recursive-next-hop-resoluti">Recursive Next-Hop Resolution</a>
      </h2>
<p id="section-8-1">
   Suppose that:<a class="pilcrow" href="#section-8-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-2.1">a given packet P must be forwarded by router R1;<a class="pilcrow" href="#section-8-2.1">¶</a>
</li>
        <li class="normal" id="section-8-2.2">the path along which P is to be forwarded is determined by BGP
      UPDATE U1;<a class="pilcrow" href="#section-8-2.2">¶</a>
</li>
        <li class="normal" id="section-8-2.3">UPDATE U1 does not have a Tunnel Encapsulation attribute;<a class="pilcrow" href="#section-8-2.3">¶</a>
</li>
        <li class="normal" id="section-8-2.4">the address of the next hop of UPDATE U1 is router R2;<a class="pilcrow" href="#section-8-2.4">¶</a>
</li>
        <li class="normal" id="section-8-2.5">the best route to router R2 is a BGP route that was advertised in
      UPDATE U2; and<a class="pilcrow" href="#section-8-2.5">¶</a>
</li>
        <li class="normal" id="section-8-2.6">UPDATE U2 has a Tunnel Encapsulation attribute.<a class="pilcrow" href="#section-8-2.6">¶</a>
</li>
      </ul>
<p id="section-8-3">
   Then packet P <span class="bcp14">MUST</span> be sent through one of the tunnels identified in
   the Tunnel Encapsulation attribute of UPDATE U2.  See <a class="xref" href="#usage">Section 6</a> for
   further details.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4">
   However, suppose that one of the TLVs in U2's Tunnel Encapsulation
   attribute contains one or more Color sub-TLVs.  In that case, packet P <span class="bcp14">MUST NOT</span> be sent through the tunnel contained in that TLV, unless U1 is
   carrying a Color Extended Community that is identified in one of U2's
   Color sub-TLVs.<a class="pilcrow" href="#section-8-4">¶</a></p>
<p id="section-8-5">
   The procedures in this section presuppose that U1's address of the next hop 
   resolves to a BGP route, and that U2's next hop resolves (perhaps after
   further recursion) to a non-BGP route.<a class="pilcrow" href="#section-8-5">¶</a></p>
</section>
</div>
<div id="use-of-vni">
<section id="section-9">
      <h2 id="name-use-of-virtual-network-iden">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-use-of-virtual-network-iden">Use of Virtual Network Identifiers and Embedded Labels When Imposing a Tunnel Encapsulation</a>
      </h2>
<p id="section-9-1">
   If the TLV specifying a tunnel contains an MPLS Label Stack sub-TLV,
   then when sending a packet through that tunnel, the procedures of
   <a class="xref" href="#label-stack">Section 3.6</a> are applied before the procedures of this section.<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">
   If the TLV specifying a tunnel contains a Prefix-SID sub-TLV, the
   procedures of <a class="xref" href="#prefix-sid">Section 3.7</a> are applied before the procedures of this
   section.  If the TLV also contains an MPLS Label Stack sub-TLV, the
   procedures of <a class="xref" href="#label-stack">Section 3.6</a> are applied before the procedures of
   <a class="xref" href="#prefix-sid">Section 3.7</a>.<a class="pilcrow" href="#section-9-2">¶</a></p>
<section id="section-9.1">
        <h3 id="name-tunnel-types-without-a-virt">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-tunnel-types-without-a-virt">Tunnel Types without a Virtual Network Identifier Field</a>
        </h3>
<p id="section-9.1-1">
 If a Tunnel Encapsulation attribute is attached to an UPDATE of a
 labeled address family, there will be one or more labels specified in
 the UPDATE's NLRI.  When a packet is sent through a tunnel specified
 in one of the attribute's TLVs, and that tunnel type does not contain
 a Virtual Network Identifier field, the label or labels from the NLRI
 are pushed on the packet's label stack.  The resulting MPLS packet is
 then further encapsulated, as specified by the TLV.<a class="pilcrow" href="#section-9.1-1">¶</a></p>
</section>
<section id="section-9.2">
        <h3 id="name-tunnel-types-with-a-virtual">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-tunnel-types-with-a-virtual">Tunnel Types with a Virtual Network Identifier Field</a>
        </h3>
<p id="section-9.2-1">
   Two of the tunnel types that can be specified in a Tunnel
   Encapsulation TLV have Virtual Network Identifier fields in their
   encapsulation headers.  In the VXLAN encapsulation,
   this field is called the VNI (VXLAN Network Identifier) field; in
   the NVGRE encapsulation, this field is called the VSID (Virtual
   Subnet Identifier) field.<a class="pilcrow" href="#section-9.2-1">¶</a></p>
<p id="section-9.2-2">
   When one of these tunnel encapsulations is imposed on a packet, the
   setting of the Virtual Network Identifier field in the encapsulation
   header depends upon the contents of the Encapsulation sub-TLV (if one
   is present).  When the Tunnel Encapsulation attribute is being
   carried in a BGP UPDATE of a labeled address family, the setting of
   the Virtual Network Identifier field also depends upon the contents
   of the Embedded Label Handling sub-TLV (if present).<a class="pilcrow" href="#section-9.2-2">¶</a></p>
<p id="section-9.2-3">
   This section specifies the procedures for choosing the value to set
   in the Virtual Network Identifier field of the encapsulation header.
   These procedures apply only when the tunnel type is VXLAN
   or NVGRE.<a class="pilcrow" href="#section-9.2-3">¶</a></p>
<section id="section-9.2.1">
          <h4 id="name-unlabeled-address-families">
<a class="section-number selfRef" href="#section-9.2.1">9.2.1. </a><a class="section-name selfRef" href="#name-unlabeled-address-families">Unlabeled Address Families</a>
          </h4>
<p id="section-9.2.1-1">
   This subsection applies when:<a class="pilcrow" href="#section-9.2.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.1-2.1">the Tunnel Encapsulation attribute is carried in a BGP UPDATE of
      an unlabeled address family,<a class="pilcrow" href="#section-9.2.1-2.1">¶</a>
</li>
            <li class="normal" id="section-9.2.1-2.2">at least one of the attribute's TLVs identifies a tunnel type that
      uses a virtual network identifier, and<a class="pilcrow" href="#section-9.2.1-2.2">¶</a>
</li>
            <li class="normal" id="section-9.2.1-2.3">it has been determined to send a packet through one of those
      tunnels.<a class="pilcrow" href="#section-9.2.1-2.3">¶</a>
</li>
          </ul>
<p id="section-9.2.1-3">
   If the TLV identifying the tunnel contains an Encapsulation sub-TLV
   whose V bit is set to 1, the Virtual Network Identifier field of the
   encapsulation header is set to the value of the Virtual Network
   Identifier field of the Encapsulation sub-TLV.<a class="pilcrow" href="#section-9.2.1-3">¶</a></p>
<p id="section-9.2.1-4">
   Otherwise, the Virtual Network Identifier field of the encapsulation
   header is set to a configured value; if there is no configured value,
   the tunnel cannot be used.<a class="pilcrow" href="#section-9.2.1-4">¶</a></p>
</section>
<section id="section-9.2.2">
          <h4 id="name-labeled-address-families">
<a class="section-number selfRef" href="#section-9.2.2">9.2.2. </a><a class="section-name selfRef" href="#name-labeled-address-families">Labeled Address Families</a>
          </h4>
<p id="section-9.2.2-1">
   This subsection applies when:<a class="pilcrow" href="#section-9.2.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.2-2.1">the Tunnel Encapsulation attribute is carried in a BGP UPDATE of a
      labeled address family,<a class="pilcrow" href="#section-9.2.2-2.1">¶</a>
</li>
            <li class="normal" id="section-9.2.2-2.2">at least one of the attribute's TLVs identifies a tunnel type that
      uses a virtual network identifier, and<a class="pilcrow" href="#section-9.2.2-2.2">¶</a>
</li>
            <li class="normal" id="section-9.2.2-2.3">it has been determined to send a packet through one of those
      tunnels.<a class="pilcrow" href="#section-9.2.2-2.3">¶</a>
</li>
          </ul>
<div id="valid-vni">
<section id="section-9.2.2.1">
            <h5 id="name-when-a-valid-vni-has-been-s">
<a class="section-number selfRef" href="#section-9.2.2.1">9.2.2.1. </a><a class="section-name selfRef" href="#name-when-a-valid-vni-has-been-s">When a Valid VNI Has Been Signaled</a>
            </h5>
<p id="section-9.2.2.1-1">
   If the TLV identifying the tunnel contains an Encapsulation sub-TLV
   whose V bit is set to 1, the Virtual Network Identifier field of the
   encapsulation header is set to the value of the Virtual Network Identifier
   field of the Encapsulation sub-TLV. However, the Embedded Label Handling
   sub-TLV will determine label processing as described below.<a class="pilcrow" href="#section-9.2.2.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.2.1-2.1">If the TLV contains an Embedded Label 
      Handling sub-TLV whose value is 1, the embedded label (from the NLRI 
      of the route that is carrying the Tunnel Encapsulation attribute) 
      appears at the top of the MPLS label stack in the encapsulation payload.<a class="pilcrow" href="#section-9.2.2.1-2.1">¶</a>
</li>
              <li class="normal" id="section-9.2.2.1-2.2">If the TLV does not contain an Embedded Label Handling sub-TLV, or
      it contains an Embedded Label Handling sub-TLV whose value is 2,
      the embedded label is ignored entirely.<a class="pilcrow" href="#section-9.2.2.1-2.2">¶</a>
</li>
            </ul>
</section>
</div>
<div id="no-valid-vni">
<section id="section-9.2.2.2">
            <h5 id="name-when-a-valid-vni-has-not-be">
<a class="section-number selfRef" href="#section-9.2.2.2">9.2.2.2. </a><a class="section-name selfRef" href="#name-when-a-valid-vni-has-not-be">When a Valid VNI Has Not Been Signaled</a>
            </h5>
<p id="section-9.2.2.2-1">
   If the TLV identifying the tunnel does not contain an Encapsulation
   sub-TLV whose V bit is set to 1, the Virtual Network Identifier field of
   the encapsulation header is set as follows:<a class="pilcrow" href="#section-9.2.2.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.2.2.2-2.1">
                <p id="section-9.2.2.2-2.1.1">If the TLV contains an Embedded Label Handling sub-TLV whose value
      is 1, then the Virtual Network Identifier field of the
      encapsulation header is set to a configured value.<a class="pilcrow" href="#section-9.2.2.2-2.1.1">¶</a></p>
<p id="section-9.2.2.2-2.1.2">
 If there is no configured value, the tunnel cannot be used.<a class="pilcrow" href="#section-9.2.2.2-2.1.2">¶</a></p>
<p id="section-9.2.2.2-2.1.3">
 The embedded label (from the NLRI of the route that is carrying
      the Tunnel Encapsulation attribute) appears at the top of the MPLS
      label stack in the encapsulation payload.<a class="pilcrow" href="#section-9.2.2.2-2.1.3">¶</a></p>
</li>
              <li class="normal" id="section-9.2.2.2-2.2">
                <p id="section-9.2.2.2-2.2.1">If the TLV does not contain an Embedded Label Handling sub-TLV, or
      if it contains an Embedded Label Handling sub-TLV whose value is
      2, the embedded label is copied into the lower 3 octets of the Virtual 
      Network Identifier field of the encapsulation header.<a class="pilcrow" href="#section-9.2.2.2-2.2.1">¶</a></p>
<p id="section-9.2.2.2-2.2.2">
 In this case, the payload may or may not contain an MPLS label
      stack, depending upon other factors.  If the payload does contain
      an MPLS label stack, the embedded label does not appear in that
      stack.<a class="pilcrow" href="#section-9.2.2.2-2.2.2">¶</a></p>
</li>
            </ul>
</section>
</div>
</section>
</section>
</section>
</div>
<div id="applicability">
<section id="section-10">
      <h2 id="name-applicability-restrictions">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-applicability-restrictions">Applicability Restrictions</a>
      </h2>
<p id="section-10-1">
   In a given UPDATE of a labeled address family, the label embedded in
   the NLRI is generally a label that is meaningful only to the router
   represented by the address of the next hop.  Certain of the procedures of Sections
   <a class="xref" href="#valid-vni">9.2.2.1</a> or <a class="xref" href="#no-valid-vni">9.2.2.2</a> cause the embedded label to be
   carried by a data packet to the router whose address appears in the
   Tunnel Egress Endpoint sub-TLV.  If the Tunnel Egress Endpoint sub-TLV does not
   identify the same router represented by the address of the next hop, sending the 
   packet through the tunnel may cause the label to be misinterpreted at the
   tunnel's egress endpoint.  This may cause misdelivery of the packet.
   Avoidance of this unfortunate outcome is a matter of network planning
   and design and is outside the scope of this document.<a class="pilcrow" href="#section-10-1">¶</a></p>
<p id="section-10-2">
   Note that if the Tunnel Encapsulation attribute is attached to a VPN-
   IP route <span>[<a class="xref" href="#RFC4364">RFC4364</a>]</span>, if Inter-AS "option b" (see
   <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc4364#section-10">Section 10</a> of [<a class="xref" href="#RFC4364">RFC4364</a>]</span>) is being used, and if the Tunnel Egress Endpoint sub-TLV contains
   an IP address that is not in the same AS as the router receiving the
   route, it is very likely that the embedded label has been changed.
   Therefore, use of the Tunnel Encapsulation attribute in an "Inter-AS option b" scenario is 
   not recommended.<a class="pilcrow" href="#section-10-2">¶</a></p>
<p id="section-10-3">
   Other documents may define other ways to signal tunnel information in
   BGP. For example, <span>[<a class="xref" href="#RFC6514">RFC6514</a>]</span> defines the "P-Multicast
   Service Interface Tunnel" (PMSI Tunnel) attribute. In this
   specification, we do not consider the effects of advertising the
   Tunnel Encapsulation attribute in conjunction with other forms of
   signaling tunnels. Any document specifying such joint use <span class="bcp14">MUST</span> 
   provide details as to how interactions should be handled.<a class="pilcrow" href="#section-10-3">¶</a></p>
</section>
</div>
<div id="scoping">
<section id="section-11">
      <h2 id="name-scoping">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-scoping">Scoping</a>
      </h2>
<p id="section-11-1">
   The Tunnel Encapsulation attribute is defined as a transitive
   attribute, so that it may be passed along by BGP speakers that do not
   recognize it.  However, the Tunnel Encapsulation
   attribute <span class="bcp14">MUST</span> be used only within a well-defined scope, for example, within a
   set of ASes that belong to a single administrative
   entity.  If the attribute is distributed beyond its intended scope,
   packets may be sent through tunnels in a manner that is not intended.<a class="pilcrow" href="#section-11-1">¶</a></p>
<p id="section-11-2">
   To prevent the Tunnel Encapsulation attribute from being distributed
   beyond its intended scope, any BGP speaker that understands the
   attribute <span class="bcp14">MUST</span> be able to filter the attribute from incoming BGP
   UPDATE messages.  When the attribute is filtered from an incoming
   UPDATE, the attribute is neither processed nor distributed.  This
   filtering <span class="bcp14">SHOULD</span> be possible on a per-BGP-session basis; finer
   granularities (for example, per route and/or per attribute TLV) <span class="bcp14">MAY</span> be 
   supported.  For each external BGP (EBGP) session, filtering of the attribute on 
   incoming UPDATEs <span class="bcp14">MUST</span> be enabled by default.<a class="pilcrow" href="#section-11-2">¶</a></p>
<p id="section-11-3">
   In addition, any BGP speaker that understands the attribute <span class="bcp14">MUST</span> be
   able to filter the attribute from outgoing BGP UPDATE messages.  This
   filtering <span class="bcp14">SHOULD</span> be possible on a per-BGP-session basis.  For each EBGP
   session, filtering of the attribute on outgoing UPDATEs <span class="bcp14">MUST</span> be
   enabled by default.<a class="pilcrow" href="#section-11-3">¶</a></p>
<p id="section-11-4">
   Since the Encapsulation Extended Community provides a subset
   of the functionality of the Tunnel Encapsulation attribute, these
   considerations apply equally in its case:<a class="pilcrow" href="#section-11-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-5.1">Any BGP speaker that
   understands it <span class="bcp14">MUST</span> be able to filter it from incoming BGP UPDATE
   messages.<a class="pilcrow" href="#section-11-5.1">¶</a>
</li>
        <li class="normal" id="section-11-5.2">It <span class="bcp14">MUST</span> be possible to filter the Encapsulation
   Extended Community from outgoing messages.<a class="pilcrow" href="#section-11-5.2">¶</a>
</li>
        <li class="normal" id="section-11-5.3">In both cases, this
   filtering <span class="bcp14">MUST</span> be enabled by default for EBGP sessions.<a class="pilcrow" href="#section-11-5.3">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-12">
      <h2 id="name-operational-considerations">
<a class="section-number selfRef" href="#section-12">12. </a><a class="section-name selfRef" href="#name-operational-considerations">Operational Considerations</a>
      </h2>
<p id="section-12-1">
 A potential operational difficulty arises when tunnels are used, if the
 size of packets entering the tunnel exceeds the 
 maximum transmission unit (MTU) the tunnel is capable of supporting. This
 difficulty can be exacerbated by stacking multiple tunnels, since each 
 stacked tunnel header further reduces the supportable MTU. This issue is
 long-standing and well-known. The tunnel
 signaling provided in this specification does nothing to address this 
 issue, nor to aggravate it (except insofar as it may further increase the
 popularity of tunneling).<a class="pilcrow" href="#section-12-1">¶</a></p>
</section>
<div id="validation-and-error">
<section id="section-13">
      <h2 id="name-validation-and-error-handli">
<a class="section-number selfRef" href="#section-13">13. </a><a class="section-name selfRef" href="#name-validation-and-error-handli">Validation and Error Handling</a>
      </h2>
<p id="section-13-1">
   The Tunnel Encapsulation attribute is a sequence of TLVs, each of
   which is a sequence of sub-TLVs.  The final octet of a TLV is
   determined by its Length field.  Similarly, the final octet of a sub-
   TLV is determined by its Length field.  The final octet of a TLV <span class="bcp14">MUST</span>
   also be the final octet of its final sub-TLV.  If this is not the
   case, the TLV <span class="bcp14">MUST</span> be considered to be malformed,  
   and the "Treat-as-withdraw" procedure of 
   <span>[<a class="xref" href="#RFC7606">RFC7606</a>]</span> is applied.<a class="pilcrow" href="#section-13-1">¶</a></p>
<p id="section-13-2">
   If a Tunnel Encapsulation attribute does not have any valid TLVs, or
   it does not have the transitive bit set, the "Treat-as-withdraw"
   procedure of <span>[<a class="xref" href="#RFC7606">RFC7606</a>]</span> is applied.<a class="pilcrow" href="#section-13-2">¶</a></p>
<p id="section-13-3">
   If a Tunnel Encapsulation attribute can be parsed correctly but
   contains a TLV whose tunnel type is not recognized by a particular
   BGP speaker, that BGP speaker <span class="bcp14">MUST NOT</span> consider the attribute to be
   malformed.  Rather, it <span class="bcp14">MUST</span>
   interpret the attribute as if that
   TLV had not been present.  If the route carrying the Tunnel
   Encapsulation attribute is propagated with the attribute, the
   unrecognized TLV <span class="bcp14">MUST</span> remain in the attribute.<a class="pilcrow" href="#section-13-3">¶</a></p>
<p id="section-13-4">
   The following sub-TLVs defined in this document <span class="bcp14">MUST NOT</span> occur more
   than once in a given Tunnel TLV: Tunnel Egress Endpoint (discussed below),
   Encapsulation, DS, UDP Destination Port, Embedded Label
   Handling, MPLS Label Stack, and Prefix-SID.  If a Tunnel TLV has more
   than one of any of these sub-TLVs, all but the first occurrence of
   each such sub-TLV type <span class="bcp14">MUST</span> be disregarded.  However, the
   Tunnel TLV containing them <span class="bcp14">MUST NOT</span> be considered to be malformed,
   and all the sub-TLVs <span class="bcp14">MUST</span> be propagated if the route carrying the
   Tunnel Encapsulation attribute is propagated.<a class="pilcrow" href="#section-13-4">¶</a></p>
<p id="section-13-5">
   The following sub-TLVs defined in this document may appear zero or
   more times in a given Tunnel TLV: Protocol Type and Color.  Each
   occurrence of such sub-TLVs is meaningful.  For example, the Color
   sub-TLV may appear multiple times to assign multiple colors to a
   tunnel.<a class="pilcrow" href="#section-13-5">¶</a></p>
<p id="section-13-6">
   If a TLV of a Tunnel Encapsulation attribute contains a sub-TLV that
   is not recognized by a particular BGP speaker, the BGP speaker <span class="bcp14">MUST</span>
   process that TLV as if the unrecognized sub-TLV had not been present.
   If the route carrying the Tunnel Encapsulation attribute is
   propagated with the attribute, the unrecognized sub-TLV <span class="bcp14">MUST</span> remain in
   the attribute.<a class="pilcrow" href="#section-13-6">¶</a></p>
<p id="section-13-7">
   In general, if a TLV contains a sub-TLV that is malformed,
   the sub-TLV <span class="bcp14">MUST</span> be treated as if it were an unrecognized sub-TLV.
   There is one exception to this rule: if a TLV
   contains a malformed Tunnel Egress Endpoint sub-TLV (as defined in
   <a class="xref" href="#tunnel-egress-endpoint">Section 3.1</a>), the entire TLV <span class="bcp14">MUST</span> be ignored and <span class="bcp14">MUST</span> be removed from the Tunnel Encapsulation attribute before the
   route carrying that attribute is distributed.<a class="pilcrow" href="#section-13-7">¶</a></p>
<p id="section-13-8">
   Within a Tunnel Encapsulation attribute that is carried by a BGP
   UPDATE whose AFI/SAFI is one of those explicitly listed in the first
   paragraph of <a class="xref" href="#usage">Section 6</a>, a TLV that does not contain exactly one
   Tunnel Egress Endpoint sub-TLV <span class="bcp14">MUST</span> be treated as if it contained a
   malformed Tunnel Egress Endpoint sub-TLV.<a class="pilcrow" href="#section-13-8">¶</a></p>
<p id="section-13-9">
   A TLV identifying a particular tunnel type may contain a sub-TLV that
   is meaningless for that tunnel type.  For example, perhaps the TLV
   contains a  UDP Destination Port  sub-TLV, but the identified tunnel
   type does not use UDP encapsulation at all, or a tunnel of the form
   "X-in-Y" contains a Protocol Type sub-TLV that specifies something
   other than "X". Sub-TLVs of this sort <span class="bcp14">MUST</span> be disregarded.  That is,
   they <span class="bcp14">MUST NOT</span> affect the creation of the encapsulation header. 
   However, the sub-TLV <span class="bcp14">MUST NOT</span> be considered to be malformed and <span class="bcp14">MUST NOT</span> be removed from the TLV before the route carrying the Tunnel
   Encapsulation attribute is distributed. An implementation <span class="bcp14">MAY</span> log a
   message when it encounters such a sub-TLV.<a class="pilcrow" href="#section-13-9">¶</a></p>
</section>
</div>
<section id="section-14">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-14">14. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-14-1">
 IANA has made the updates described in the following subsections. 
All registration
 procedures listed are per their definitions in 
 <span>[<a class="xref" href="#RFC8126">RFC8126</a>]</span>.<a class="pilcrow" href="#section-14-1">¶</a></p>
<section id="section-14.1">
        <h3 id="name-obsoleting-rfc-5512">
<a class="section-number selfRef" href="#section-14.1">14.1. </a><a class="section-name selfRef" href="#name-obsoleting-rfc-5512">Obsoleting RFC 5512</a>
        </h3>
<p id="section-14.1-1"> 
   Because this document obsoletes RFC 5512, IANA has updated
   references to RFC 5512 to point to this document in the following registries:<a class="pilcrow" href="#section-14.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.1-2.1">"Border Gateway Protocol (BGP) Extended Communities" registry <span>[<a class="xref" href="#IANA-BGP-EXT-COMM">IANA-BGP-EXT-COMM</a>]</span><a class="pilcrow" href="#section-14.1-2.1">¶</a>
</li>
          <li class="normal" id="section-14.1-2.2">"Border Gateway Protocol (BGP) Parameters" registry <span>[<a class="xref" href="#IANA-BGP-PARAMS">IANA-BGP-PARAMS</a>]</span><a class="pilcrow" href="#section-14.1-2.2">¶</a>
</li>
          <li class="normal" id="section-14.1-2.3">"Border Gateway Protocol (BGP) Tunnel Encapsulation" registry <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span><a class="pilcrow" href="#section-14.1-2.3">¶</a>
</li>
          <li class="normal" id="section-14.1-2.4">"Subsequent Address Family Identifiers (SAFI) Parameters" registry <span>[<a class="xref" href="#IANA-SAFI">IANA-SAFI</a>]</span><a class="pilcrow" href="#section-14.1-2.4">¶</a>
</li>
        </ul>
</section>
<div id="obsoleting-5566-and-5640">
<section id="section-14.2">
        <h3 id="name-obsoleting-code-points-assi">
<a class="section-number selfRef" href="#section-14.2">14.2. </a><a class="section-name selfRef" href="#name-obsoleting-code-points-assi">Obsoleting Code Points Assigned by RFC 5566</a>
        </h3>
<p id="section-14.2-1">
 Since this document obsoletes RFC 5566, the code points 
 assigned by that RFC are similarly obsoleted. Specifically, the 
 following code points have been marked as deprecated.<a class="pilcrow" href="#section-14.2-1">¶</a></p>
<p id="section-14.2-2">
 In the
"BGP Tunnel Encapsulation Attribute Tunnel Types" registry <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>:<a class="pilcrow" href="#section-14.2-2">¶</a></p>
<table class="center" id="table-1">
          <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">3</td>
              <td class="text-left" colspan="1" rowspan="1">Transmit tunnel endpoint (DEPRECATED)</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">4</td>
              <td class="text-left" colspan="1" rowspan="1">IPsec in Tunnel-mode (DEPRECATED)</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">5</td>
              <td class="text-left" colspan="1" rowspan="1">IP in IP tunnel with IPsec Transport Mode (DEPRECATED)</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">6</td>
              <td class="text-left" colspan="1" rowspan="1">MPLS-in-IP tunnel with IPsec Transport Mode (DEPRECATED)</td>
            </tr>
          </tbody>
        </table>
<p id="section-14.2-4">
 And in the "BGP Tunnel Encapsulation Attribute Sub-TLVs" registry <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>:<a class="pilcrow" href="#section-14.2-4">¶</a></p>
<table class="center" id="table-2">
          <caption><a class="selfRef" href="#table-2">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">3</td>
              <td class="text-left" colspan="1" rowspan="1">IPsec Tunnel Authenticator (DEPRECATED)</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<section id="section-14.3">
        <h3 id="name-border-gateway-protocol-bgp">
<a class="section-number selfRef" href="#section-14.3">14.3. </a><a class="section-name selfRef" href="#name-border-gateway-protocol-bgp">Border Gateway Protocol (BGP) Tunnel Encapsulation Grouping</a>
        </h3>
<p id="section-14.3-1">
   IANA has created a new registry grouping named
   "Border Gateway Protocol (BGP) Tunnel Encapsulation" <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>.<a class="pilcrow" href="#section-14.3-1">¶</a></p>
</section>
<section id="section-14.4">
        <h3 id="name-bgp-tunnel-encapsulation-at">
<a class="section-number selfRef" href="#section-14.4">14.4. </a><a class="section-name selfRef" href="#name-bgp-tunnel-encapsulation-at">BGP Tunnel Encapsulation Attribute Tunnel Types</a>
        </h3>
<p id="section-14.4-1">
   IANA has relocated the "BGP Tunnel Encapsulation Attribute Tunnel Types" registry to be 
   under the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>.<a class="pilcrow" href="#section-14.4-1">¶</a></p>
</section>
<section id="section-14.5">
        <h3 id="name-subsequent-address-family-i">
<a class="section-number selfRef" href="#section-14.5">14.5. </a><a class="section-name selfRef" href="#name-subsequent-address-family-i">Subsequent Address Family Identifiers</a>
        </h3>
<p id="section-14.5-1">
   IANA has modified the "SAFI Values" registry <span>[<a class="xref" href="#IANA-SAFI">IANA-SAFI</a>]</span> to 
   indicate that the Encapsulation SAFI (value 7) has been
   obsoleted.  This document is listed as the reference for this change.<a class="pilcrow" href="#section-14.5-1">¶</a></p>
</section>
<section id="section-14.6">
        <h3 id="name-bgp-tunnel-encapsulation-att">
<a class="section-number selfRef" href="#section-14.6">14.6. </a><a class="section-name selfRef" href="#name-bgp-tunnel-encapsulation-att">BGP Tunnel Encapsulation Attribute Sub-TLVs</a>
        </h3>
<p id="section-14.6-1">
   IANA has relocated the "BGP Tunnel Encapsulation Attribute Sub-TLVs" registry to be under 
   the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>.<a class="pilcrow" href="#section-14.6-1">¶</a></p>
<p id="section-14.6-2">
   IANA has included the following note to the registry:<a class="pilcrow" href="#section-14.6-2">¶</a></p>
<blockquote id="section-14.6-3">
      If the Sub-TLV Type is in the range from 0 to 127 (inclusive), the
      Sub-TLV Length field contains one octet.  If the Sub-TLV Type is
      in the range from 128 to 255 (inclusive), the Sub-TLV Length field
      contains two octets.<a class="pilcrow" href="#section-14.6-3">¶</a>
</blockquote>
<p id="section-14.6-4">
   IANA has updated the registration procedures of the  
   registry to the following:<a class="pilcrow" href="#section-14.6-4">¶</a></p>
<table class="center" id="table-3">
          <caption><a class="selfRef" href="#table-3">Table 3</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Range</th>
              <th class="text-left" colspan="1" rowspan="1">Registration Procedures</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">1-63</td>
              <td class="text-left" colspan="1" rowspan="1">Standards Action</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">64-125</td>
              <td class="text-left" colspan="1" rowspan="1">First Come First Served</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">126-127</td>
              <td class="text-left" colspan="1" rowspan="1">Experimental Use</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">128-191</td>
              <td class="text-left" colspan="1" rowspan="1">Standards Action</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">192-252</td>
              <td class="text-left" colspan="1" rowspan="1">First Come First Served</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">253-254</td>
              <td class="text-left" colspan="1" rowspan="1">Experimental Use</td>
            </tr>
          </tbody>
        </table>
<p id="section-14.6-6">IANA has added the following entries to this registry:<a class="pilcrow" href="#section-14.6-6">¶</a></p>
<table class="center" id="table-4">
          <caption><a class="selfRef" href="#table-4">Table 4</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Description</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">0</td>
              <td class="text-left" colspan="1" rowspan="1">Reserved</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">6</td>
              <td class="text-left" colspan="1" rowspan="1">Tunnel Egress Endpoint</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">7</td>
              <td class="text-left" colspan="1" rowspan="1">DS Field</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">8</td>
              <td class="text-left" colspan="1" rowspan="1">UDP Destination Port</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">9</td>
              <td class="text-left" colspan="1" rowspan="1">Embedded Label Handling</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">10</td>
              <td class="text-left" colspan="1" rowspan="1">MPLS Label Stack</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">11</td>
              <td class="text-left" colspan="1" rowspan="1">Prefix-SID</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">255</td>
              <td class="text-left" colspan="1" rowspan="1">Reserved</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
          </tbody>
        </table>
</section>
<section id="section-14.7">
        <h3 id="name-flags-field-of-vxlan-encaps">
<a class="section-number selfRef" href="#section-14.7">14.7. </a><a class="section-name selfRef" href="#name-flags-field-of-vxlan-encaps">Flags Field of VXLAN Encapsulation Sub-TLV</a>
        </h3>
<p id="section-14.7-1">IANA has created a registry named "Flags Field of VXLAN Encapsulation Sub-TLVs" under 
   the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>. The registration policy for
   this registry is "Standards Action". The minimum possible value is 0, and the 
   maximum is 7.<a class="pilcrow" href="#section-14.7-1">¶</a></p>
<p id="section-14.7-2">The initial values for this new registry are indicated in <a class="xref" href="#flags-vxlan">Table 5</a>.<a class="pilcrow" href="#section-14.7-2">¶</a></p>
<div id="flags-vxlan">
<table class="center" id="table-5">
          <caption><a class="selfRef" href="#table-5">Table 5</a></caption>
<thead>
            <tr>
              <th class="text-center" colspan="1" rowspan="1">Bit Position</th>
              <th class="text-left" colspan="1" rowspan="1">Description</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">0</td>
              <td class="text-left" colspan="1" rowspan="1">V (VN-ID)</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1</td>
              <td class="text-left" colspan="1" rowspan="1">M (MAC Address)</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
<section id="section-14.8">
        <h3 id="name-flags-field-of-nvgre-encaps">
<a class="section-number selfRef" href="#section-14.8">14.8. </a><a class="section-name selfRef" href="#name-flags-field-of-nvgre-encaps">Flags Field of NVGRE Encapsulation Sub-TLV</a>
        </h3>
<p id="section-14.8-1">IANA has created a registry named "Flags Field of NVGRE Encapsulation Sub-TLVs" under 
   the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>. The registration policy for
   this registry is "Standards Action". The minimum possible value is 0, and the 
   maximum is 7.<a class="pilcrow" href="#section-14.8-1">¶</a></p>
<p id="section-14.8-2">The initial values for this new registry are indicated in <a class="xref" href="#flags-nvgre">Table 6</a>.<a class="pilcrow" href="#section-14.8-2">¶</a></p>
<div id="flags-nvgre">
<table class="center" id="table-6">
          <caption><a class="selfRef" href="#table-6">Table 6</a></caption>
<thead>
            <tr>
              <th class="text-center" colspan="1" rowspan="1">Bit Position</th>
              <th class="text-left" colspan="1" rowspan="1">Description</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">0</td>
              <td class="text-left" colspan="1" rowspan="1">V (VN-ID)</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1</td>
              <td class="text-left" colspan="1" rowspan="1">M (MAC Address)</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
<section id="section-14.9">
        <h3 id="name-embedded-label-handling-sub-t">
<a class="section-number selfRef" href="#section-14.9">14.9. </a><a class="section-name selfRef" href="#name-embedded-label-handling-sub-t">Embedded Label Handling Sub-TLV</a>
        </h3>
<p id="section-14.9-1">IANA has created a registry named "Embedded Label Handling Sub-TLVs" under 
   the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>. The registration policy for
   this registry is "Standards Action". The minimum possible value is 0, and the 
   maximum is 255.<a class="pilcrow" href="#section-14.9-1">¶</a></p>
<p id="section-14.9-2">The initial values for this new registry are indicated in <a class="xref" href="#embedded-label">Table 7</a>.<a class="pilcrow" href="#section-14.9-2">¶</a></p>
<div id="embedded-label">
<table class="center" id="table-7">
          <caption><a class="selfRef" href="#table-7">Table 7</a></caption>
<thead>
            <tr>
              <th class="text-center" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Description</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">0</td>
              <td class="text-left" colspan="1" rowspan="1">Reserved</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1</td>
              <td class="text-left" colspan="1" rowspan="1">Payload of MPLS with embedded label</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">2</td>
              <td class="text-left" colspan="1" rowspan="1">No embedded label in payload</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9012</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
<div id="color-extcomm-flags">
<section id="section-14.10">
        <h3 id="name-color-extended-community-fl">
<a class="section-number selfRef" href="#section-14.10">14.10. </a><a class="section-name selfRef" href="#name-color-extended-community-fl">Color Extended Community Flags</a>
        </h3>
<p id="section-14.10-1">IANA has created a registry named "Color Extended Community Flags" under 
   the "Border Gateway Protocol (BGP) Tunnel Encapsulation" grouping <span>[<a class="xref" href="#IANA-BGP-TUNNEL-ENCAP">IANA-BGP-TUNNEL-ENCAP</a>]</span>. The registration policy for
   this registry is "Standards Action". The minimum possible value is 0, and the 
   maximum is 15.<a class="pilcrow" href="#section-14.10-1">¶</a></p>
<p id="section-14.10-2">   This new registry contains columns for "Bit Position", "Description", and
   "Reference". No values have currently been registered.<a class="pilcrow" href="#section-14.10-2">¶</a></p>
</section>
</div>
</section>
<div id="security">
<section id="section-15">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-15">15. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-15-1">
   As <a class="xref" href="#scoping">Section 11</a> discusses, it is intended that the
   Tunnel Encapsulation attribute be used only within a well-defined
   scope, for example, within a set of ASes that belong to a
   single administrative entity. As long as the filtering mechanisms
   discussed in that section are applied diligently, an attacker outside
   the scope would not be able to use the Tunnel Encapsulation attribute
   in an attack. This leaves open the questions of attackers within the
   scope (for example, a compromised router) and failures in filtering
   that allow an external attack to succeed.<a class="pilcrow" href="#section-15-1">¶</a></p>
<p id="section-15-2">
   As <span>[<a class="xref" href="#RFC4272">RFC4272</a>]</span> discusses, BGP is vulnerable to traffic-diversion attacks. The Tunnel Encapsulation attribute adds a new
   means by which an attacker could cause traffic to be diverted from
   its normal path, especially when the Tunnel Egress Endpoint sub-TLV
   is used. Such an attack would differ from pre-existing
   vulnerabilities in that traffic could be tunneled to a distant target
   across intervening network infrastructure, allowing an attack to
   potentially succeed more easily, since less infrastructure would have
   to be subverted. Potential consequences include "hijacking" of
   traffic (insertion of an undesired node in the path, which allows for
   inspection or modification of traffic, or avoidance of security
   controls) or denial of service (directing traffic to a node that
   doesn't desire to receive it).<a class="pilcrow" href="#section-15-2">¶</a></p>
<p id="section-15-3">
   In order to further mitigate the risk of diversion of traffic from
   its intended destination, <a class="xref" href="#address-validation">Section 3.1.1</a>
   provides an optional procedure to check that the destination given in
   a Tunnel Egress Endpoint sub-TLV is within the AS that was the source
   of the route. One then has some level of assurance that the tunneled
   traffic is going to the same destination AS that it would have gone
   to had the Tunnel Encapsulation attribute not been present. As RFC
   4272 discusses, it's possible for an attacker to announce an
   inaccurate AS_PATH; therefore, an attacker with the ability to inject
   a Tunnel Egress Endpoint sub-TLV could equally craft an AS_PATH that would
   pass the validation procedures of <a class="xref" href="#address-validation">Section 3.1.1</a>. BGP origin validation <span>[<a class="xref" href="#RFC6811">RFC6811</a>]</span> and BGPsec <span>[<a class="xref" href="#RFC8205">RFC8205</a>]</span> provide means to increase assurance that the origins being validated have not been
   falsified.<a class="pilcrow" href="#section-15-3">¶</a></p>
<p id="section-15-4">
   Many tunnels carry traffic that embeds a destination address that comes
   from a non-global namespace. One example is MPLS VPNs. If a tunnel 
   crosses from one namespace to another, without the necessary translation
   being performed for the embedded address(es), there exists a risk of 
   misdelivery of traffic. If the traffic contains confidential data that's
   not otherwise protected (for example, by end-to-end encryption), then 
   confidential information could be revealed. The restriction of applicability
   of the Tunnel Encapsulation attribute to a well-defined scope limits the
   likelihood of this occurring. See the discussion of "option b" in 
   <a class="xref" href="#applicability">Section 10</a> for further discussion of one such 
   scenario.<a class="pilcrow" href="#section-15-4">¶</a></p>
<p id="section-15-5">
   RFC 8402 specifies that "SR domain boundary routers <span class="bcp14">MUST</span> filter any
   external traffic" (<span>[<a class="xref" href="#RFC8402">RFC8402</a>], <a class="relref" href="https://www.rfc-editor.org/rfc/rfc8402#section-8.1">Section 8.1</a></span>). For these
   purposes, traffic introduced into an SR domain using the Prefix-SID
   sub-TLV lies within the SR domain, even though the Prefix-SIDs used
   by the routers at the two ends of the tunnel may be different, as
   discussed in <a class="xref" href="#prefix-sid">Section 3.7</a>. This implies that the duty
   to filter external traffic extends to all routers participating in
   such tunnels.<a class="pilcrow" href="#section-15-5">¶</a></p>
</section>
</div>
<section id="section-16">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-16">16. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-16.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-16.1">16.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2474">[RFC2474]</dt>
        <dd>
<span class="refAuthor">Nichols, K.</span>, <span class="refAuthor">Blake, S.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"</span>, <span class="seriesInfo">RFC 2474</span>, <span class="seriesInfo">DOI 10.17487/RFC2474</span>, <time class="refDate" datetime="1998-12">December 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2474">https://www.rfc-editor.org/info/rfc2474</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2784">[RFC2784]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Li, T.</span>, <span class="refAuthor">Hanks, S.</span>, <span class="refAuthor">Meyer, D.</span>, and <span class="refAuthor">P. Traina</span>, <span class="refTitle">"Generic Routing Encapsulation (GRE)"</span>, <span class="seriesInfo">RFC 2784</span>, <span class="seriesInfo">DOI 10.17487/RFC2784</span>, <time class="refDate" datetime="2000-03">March 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2784">https://www.rfc-editor.org/info/rfc2784</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2890">[RFC2890]</dt>
        <dd>
<span class="refAuthor">Dommety, G.</span>, <span class="refTitle">"Key and Sequence Number Extensions to GRE"</span>, <span class="seriesInfo">RFC 2890</span>, <span class="seriesInfo">DOI 10.17487/RFC2890</span>, <time class="refDate" datetime="2000-09">September 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2890">https://www.rfc-editor.org/info/rfc2890</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3032">[RFC3032]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Tappan, D.</span>, <span class="refAuthor">Fedorkow, G.</span>, <span class="refAuthor">Rekhter, Y.</span>, <span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Li, T.</span>, and <span class="refAuthor">A. Conta</span>, <span class="refTitle">"MPLS Label Stack Encoding"</span>, <span class="seriesInfo">RFC 3032</span>, <span class="seriesInfo">DOI 10.17487/RFC3032</span>, <time class="refDate" datetime="2001-01">January 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3032">https://www.rfc-editor.org/info/rfc3032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3270">[RFC3270]</dt>
        <dd>
<span class="refAuthor">Le Faucheur, F.</span>, <span class="refAuthor">Wu, L.</span>, <span class="refAuthor">Davie, B.</span>, <span class="refAuthor">Davari, S.</span>, <span class="refAuthor">Vaananen, P.</span>, <span class="refAuthor">Krishnan, R.</span>, <span class="refAuthor">Cheval, P.</span>, and <span class="refAuthor">J. Heinanen</span>, <span class="refTitle">"Multi-Protocol Label Switching (MPLS) Support of Differentiated Services"</span>, <span class="seriesInfo">RFC 3270</span>, <span class="seriesInfo">DOI 10.17487/RFC3270</span>, <time class="refDate" datetime="2002-05">May 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3270">https://www.rfc-editor.org/info/rfc3270</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3931">[RFC3931]</dt>
        <dd>
<span class="refAuthor">Lau, J., Ed.</span>, <span class="refAuthor">Townsley, M., Ed.</span>, and <span class="refAuthor">I. Goyret, Ed.</span>, <span class="refTitle">"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"</span>, <span class="seriesInfo">RFC 3931</span>, <span class="seriesInfo">DOI 10.17487/RFC3931</span>, <time class="refDate" datetime="2005-03">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3931">https://www.rfc-editor.org/info/rfc3931</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4023">[RFC4023]</dt>
        <dd>
<span class="refAuthor">Worster, T.</span>, <span class="refAuthor">Rekhter, Y.</span>, and <span class="refAuthor">E. Rosen, Ed.</span>, <span class="refTitle">"Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)"</span>, <span class="seriesInfo">RFC 4023</span>, <span class="seriesInfo">DOI 10.17487/RFC4023</span>, <time class="refDate" datetime="2005-03">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4023">https://www.rfc-editor.org/info/rfc4023</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4271">[RFC4271]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y., Ed.</span>, <span class="refAuthor">Li, T., Ed.</span>, and <span class="refAuthor">S. Hares, Ed.</span>, <span class="refTitle">"A Border Gateway Protocol 4 (BGP-4)"</span>, <span class="seriesInfo">RFC 4271</span>, <span class="seriesInfo">DOI 10.17487/RFC4271</span>, <time class="refDate" datetime="2006-01">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4271">https://www.rfc-editor.org/info/rfc4271</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4760">[RFC4760]</dt>
        <dd>
<span class="refAuthor">Bates, T.</span>, <span class="refAuthor">Chandra, R.</span>, <span class="refAuthor">Katz, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"Multiprotocol Extensions for BGP-4"</span>, <span class="seriesInfo">RFC 4760</span>, <span class="seriesInfo">DOI 10.17487/RFC4760</span>, <time class="refDate" datetime="2007-01">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4760">https://www.rfc-editor.org/info/rfc4760</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5129">[RFC5129]</dt>
        <dd>
<span class="refAuthor">Davie, B.</span>, <span class="refAuthor">Briscoe, B.</span>, and <span class="refAuthor">J. Tay</span>, <span class="refTitle">"Explicit Congestion Marking in MPLS"</span>, <span class="seriesInfo">RFC 5129</span>, <span class="seriesInfo">DOI 10.17487/RFC5129</span>, <time class="refDate" datetime="2008-01">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5129">https://www.rfc-editor.org/info/rfc5129</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5462">[RFC5462]</dt>
        <dd>
<span class="refAuthor">Andersson, L.</span> and <span class="refAuthor">R. Asati</span>, <span class="refTitle">"Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field"</span>, <span class="seriesInfo">RFC 5462</span>, <span class="seriesInfo">DOI 10.17487/RFC5462</span>, <time class="refDate" datetime="2009-02">February 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5462">https://www.rfc-editor.org/info/rfc5462</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6811">[RFC6811]</dt>
        <dd>
<span class="refAuthor">Mohapatra, P.</span>, <span class="refAuthor">Scudder, J.</span>, <span class="refAuthor">Ward, D.</span>, <span class="refAuthor">Bush, R.</span>, and <span class="refAuthor">R. Austein</span>, <span class="refTitle">"BGP Prefix Origin Validation"</span>, <span class="seriesInfo">RFC 6811</span>, <span class="seriesInfo">DOI 10.17487/RFC6811</span>, <time class="refDate" datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6811">https://www.rfc-editor.org/info/rfc6811</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6890">[RFC6890]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Vegoda, L.</span>, <span class="refAuthor">Bonica, R., Ed.</span>, and <span class="refAuthor">B. Haberman</span>, <span class="refTitle">"Special-Purpose IP Address Registries"</span>, <span class="seriesInfo">BCP 153</span>, <span class="seriesInfo">RFC 6890</span>, <span class="seriesInfo">DOI 10.17487/RFC6890</span>, <time class="refDate" datetime="2013-04">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6890">https://www.rfc-editor.org/info/rfc6890</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7348">[RFC7348]</dt>
        <dd>
<span class="refAuthor">Mahalingam, M.</span>, <span class="refAuthor">Dutt, D.</span>, <span class="refAuthor">Duda, K.</span>, <span class="refAuthor">Agarwal, P.</span>, <span class="refAuthor">Kreeger, L.</span>, <span class="refAuthor">Sridhar, T.</span>, <span class="refAuthor">Bursell, M.</span>, and <span class="refAuthor">C. Wright</span>, <span class="refTitle">"Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks"</span>, <span class="seriesInfo">RFC 7348</span>, <span class="seriesInfo">DOI 10.17487/RFC7348</span>, <time class="refDate" datetime="2014-08">August 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7348">https://www.rfc-editor.org/info/rfc7348</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7606">[RFC7606]</dt>
        <dd>
<span class="refAuthor">Chen, E., Ed.</span>, <span class="refAuthor">Scudder, J., Ed.</span>, <span class="refAuthor">Mohapatra, P.</span>, and <span class="refAuthor">K. Patel</span>, <span class="refTitle">"Revised Error Handling for BGP UPDATE Messages"</span>, <span class="seriesInfo">RFC 7606</span>, <span class="seriesInfo">DOI 10.17487/RFC7606</span>, <time class="refDate" datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7606">https://www.rfc-editor.org/info/rfc7606</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7637">[RFC7637]</dt>
        <dd>
<span class="refAuthor">Garg, P., Ed.</span> and <span class="refAuthor">Y. Wang, Ed.</span>, <span class="refTitle">"NVGRE: Network Virtualization Using Generic Routing Encapsulation"</span>, <span class="seriesInfo">RFC 7637</span>, <span class="seriesInfo">DOI 10.17487/RFC7637</span>, <time class="refDate" datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7637">https://www.rfc-editor.org/info/rfc7637</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time class="refDate" datetime="2017-06">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8669">[RFC8669]</dt>
      <dd>
<span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Lindem, A., Ed.</span>, <span class="refAuthor">Sreekantiah, A.</span>, and <span class="refAuthor">H. Gredler</span>, <span class="refTitle">"Segment Routing Prefix Segment Identifier Extensions for BGP"</span>, <span class="seriesInfo">RFC 8669</span>, <span class="seriesInfo">DOI 10.17487/RFC8669</span>, <time class="refDate" datetime="2019-12">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8669">https://www.rfc-editor.org/info/rfc8669</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-16.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-16.2">16.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-bess-evpn-inter-subnet-forwarding">[EVPN-INTER-SUBNET]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Drake, J. E.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Integrated Routing and Bridging in EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-inter-subnet-forwarding-13</span>, <time class="refDate" datetime="2021-02-10">10 February 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-inter-subnet-forwarding-13">https://tools.ietf.org/html/draft-ietf-bess-evpn-inter-subnet-forwarding-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-ADDRESS-FAM">[IANA-ADDRESS-FAM]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Address Family Numbers"</span>, <span>&lt;<a href="https://www.iana.org/assignments/address-family-numbers/">https://www.iana.org/assignments/address-family-numbers/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-BGP-EXT-COMM">[IANA-BGP-EXT-COMM]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Border Gateway Protocol (BGP) Extended Communities"</span>, <span>&lt;<a href="https://www.iana.org/assignments/bgp-extended-communities/">https://www.iana.org/assignments/bgp-extended-communities/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-BGP-PARAMS">[IANA-BGP-PARAMS]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Border Gateway Protocol (BGP) Parameters"</span>, <span>&lt;<a href="https://www.iana.org/assignments/bgp-parameters/">https://www.iana.org/assignments/bgp-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-BGP-TUNNEL-ENCAP">[IANA-BGP-TUNNEL-ENCAP]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Border Gateway Protocol (BGP) Tunnel Encapsulation"</span>, <span>&lt;<a href="https://www.iana.org/assignments/bgp-tunnel-encapsulation/">https://www.iana.org/assignments/bgp-tunnel-encapsulation/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-ETHERTYPES">[IANA-ETHERTYPES]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"IEEE 802 Numbers: ETHER TYPES"</span>, <span>&lt;<a href="https://www.iana.org/assignments/ieee-802-numbers/">https://www.iana.org/assignments/ieee-802-numbers/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-SAFI">[IANA-SAFI]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Subsequent Address Family Identifiers (SAFI) Parameters"</span>, <span>&lt;<a href="https://www.iana.org/assignments/safi-namespace/">https://www.iana.org/assignments/safi-namespace/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4272">[RFC4272]</dt>
        <dd>
<span class="refAuthor">Murphy, S.</span>, <span class="refTitle">"BGP Security Vulnerabilities Analysis"</span>, <span class="seriesInfo">RFC 4272</span>, <span class="seriesInfo">DOI 10.17487/RFC4272</span>, <time class="refDate" datetime="2006-01">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4272">https://www.rfc-editor.org/info/rfc4272</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4364">[RFC4364]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP/MPLS IP Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4364</span>, <span class="seriesInfo">DOI 10.17487/RFC4364</span>, <time class="refDate" datetime="2006-02">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4364">https://www.rfc-editor.org/info/rfc4364</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5512">[RFC5512]</dt>
        <dd>
<span class="refAuthor">Mohapatra, P.</span> and <span class="refAuthor">E. Rosen</span>, <span class="refTitle">"The BGP Encapsulation Subsequent Address Family Identifier (SAFI) and the BGP Tunnel Encapsulation Attribute"</span>, <span class="seriesInfo">RFC 5512</span>, <span class="seriesInfo">DOI 10.17487/RFC5512</span>, <time class="refDate" datetime="2009-04">April 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5512">https://www.rfc-editor.org/info/rfc5512</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5565">[RFC5565]</dt>
        <dd>
<span class="refAuthor">Wu, J.</span>, <span class="refAuthor">Cui, Y.</span>, <span class="refAuthor">Metz, C.</span>, and <span class="refAuthor">E. Rosen</span>, <span class="refTitle">"Softwire Mesh Framework"</span>, <span class="seriesInfo">RFC 5565</span>, <span class="seriesInfo">DOI 10.17487/RFC5565</span>, <time class="refDate" datetime="2009-06">June 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5565">https://www.rfc-editor.org/info/rfc5565</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5566">[RFC5566]</dt>
        <dd>
<span class="refAuthor">Berger, L.</span>, <span class="refAuthor">White, R.</span>, and <span class="refAuthor">E. Rosen</span>, <span class="refTitle">"BGP IPsec Tunnel Encapsulation Attribute"</span>, <span class="seriesInfo">RFC 5566</span>, <span class="seriesInfo">DOI 10.17487/RFC5566</span>, <time class="refDate" datetime="2009-06">June 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5566">https://www.rfc-editor.org/info/rfc5566</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5640">[RFC5640]</dt>
        <dd>
<span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Mohapatra, P.</span>, and <span class="refAuthor">C. Pignataro</span>, <span class="refTitle">"Load-Balancing for Mesh Softwires"</span>, <span class="seriesInfo">RFC 5640</span>, <span class="seriesInfo">DOI 10.17487/RFC5640</span>, <time class="refDate" datetime="2009-08">August 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5640">https://www.rfc-editor.org/info/rfc5640</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6514">[RFC6514]</dt>
        <dd>
<span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Morin, T.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6514</span>, <span class="seriesInfo">DOI 10.17487/RFC6514</span>, <time class="refDate" datetime="2012-02">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6514">https://www.rfc-editor.org/info/rfc6514</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7510">[RFC7510]</dt>
        <dd>
<span class="refAuthor">Xu, X.</span>, <span class="refAuthor">Sheth, N.</span>, <span class="refAuthor">Yong, L.</span>, <span class="refAuthor">Callon, R.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Encapsulating MPLS in UDP"</span>, <span class="seriesInfo">RFC 7510</span>, <span class="seriesInfo">DOI 10.17487/RFC7510</span>, <time class="refDate" datetime="2015-04">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7510">https://www.rfc-editor.org/info/rfc7510</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8205">[RFC8205]</dt>
        <dd>
<span class="refAuthor">Lepinski, M., Ed.</span> and <span class="refAuthor">K. Sriram, Ed.</span>, <span class="refTitle">"BGPsec Protocol Specification"</span>, <span class="seriesInfo">RFC 8205</span>, <span class="seriesInfo">DOI 10.17487/RFC8205</span>, <time class="refDate" datetime="2017-09">September 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8205">https://www.rfc-editor.org/info/rfc8205</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8277">[RFC8277]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span>, <span class="refTitle">"Using BGP to Bind MPLS Labels to Address Prefixes"</span>, <span class="seriesInfo">RFC 8277</span>, <span class="seriesInfo">DOI 10.17487/RFC8277</span>, <time class="refDate" datetime="2017-10">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8277">https://www.rfc-editor.org/info/rfc8277</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8365">[RFC8365]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Drake, J., Ed.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Shekhar, R.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 8365</span>, <span class="seriesInfo">DOI 10.17487/RFC8365</span>, <time class="refDate" datetime="2018-03">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8365">https://www.rfc-editor.org/info/rfc8365</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8402">[RFC8402]</dt>
      <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S., Ed.</span>, <span class="refAuthor">Ginsberg, L.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing Architecture"</span>, <span class="seriesInfo">RFC 8402</span>, <span class="seriesInfo">DOI 10.17487/RFC8402</span>, <time class="refDate" datetime="2018-07">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8402">https://www.rfc-editor.org/info/rfc8402</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="impact-on-8365">
<section id="section-appendix.a">
      <h2 id="name-impact-on-rfc-8365">
<a class="section-number selfRef" href="#section-appendix.a">Appendix A. </a><a class="section-name selfRef" href="#name-impact-on-rfc-8365">Impact on RFC 8365</a>
      </h2>
<p id="section-appendix.a-1">
 <span>[<a class="xref" href="#RFC8365">RFC8365</a>]</span> references RFC 5512 for its definition of 
 the BGP Encapsulation Extended Community. That extended community is
 now defined in this document, in a way consistent with its previous
 definition.<a class="pilcrow" href="#section-appendix.a-1">¶</a></p>
<p id="section-appendix.a-2">
 <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8365#section-6">Section 6</a> of [<a class="xref" href="#RFC8365">RFC8365</a>]</span> talks about the use of the Encapsulation Extended
 Community to allow Network Virtualization Edge (NVE) devices to 
 signal their supported encapsulations. We
 note that with the introduction of this specification, the Tunnel 
 Encapsulation attribute can also be used for this purpose. For purposes
 where RFC 8365 talks about "advertising supported encapsulations" (for
 example, in the second paragraph of Section <a class="relref" href="https://www.rfc-editor.org/rfc/rfc8365#section-6">6</a>), encapsulations advertised
 using the Tunnel Encapsulation attribute should be considered equally with
 those advertised using the Encapsulation Extended Community.<a class="pilcrow" href="#section-appendix.a-2">¶</a></p>
<p id="section-appendix.a-3">
 In particular, a review of <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8365#section-8.3.1">Section 8.3.1</a> of [<a class="xref" href="#RFC8365">RFC8365</a>]</span> is called for, to 
 consider whether the introduction of the Tunnel Encapsulation attribute
 creates a need for any revisions to the split-horizon procedures.<a class="pilcrow" href="#section-appendix.a-3">¶</a></p>
<p id="section-appendix.a-4">
 <span>[<a class="xref" href="#RFC8365">RFC8365</a>]</span> also refers to a draft version of this specification in
 the final paragraph of Section <a class="relref" href="https://www.rfc-editor.org/rfc/rfc8365#section-5.1.3">5.1.3</a>. That paragraph references 
 Section 8.2.2.2 of the draft. In this document, the correct reference
 would be <a class="xref" href="#no-valid-vni">Section 9.2.2.2</a>. There are no substantive 
 differences between the section in the referenced draft version and that in
 this document.<a class="pilcrow" href="#section-appendix.a-4">¶</a></p>
</section>
</div>
<section id="section-appendix.b">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="section-appendix.b-1">
   This document contains text from RFC 5512, authored by <span class="contact-name">Pradosh Mohapatra</span> and <span class="contact-name">Eric Rosen</span>.  The authors of the current document wish to thank 
   them for their contribution.  RFC 5512 itself built upon prior work by <span class="contact-name">Gargi Nalawade</span>, <span class="contact-name">Ruchi Kapoor</span>, <span class="contact-name">Dan Tappan</span>, <span class="contact-name">David Ward</span>, <span class="contact-name">Scott Wainner</span>, <span class="contact-name">Simon Barber</span>, <span class="contact-name">Lili Wang</span>, and <span class="contact-name">Chris Metz</span>, whom the authors also thank for their 
   contributions. <span class="contact-name">Eric Rosen</span> was the principal author of earlier versions
   of this document.<a class="pilcrow" href="#section-appendix.b-1">¶</a></p>
<p id="section-appendix.b-2">
   The authors wish to thank <span class="contact-name">Lou Berger</span>, <span class="contact-name">Ron Bonica</span>, <span class="contact-name">Martin Djernaes</span>,
   <span class="contact-name">John Drake</span>, <span class="contact-name">Susan Hares</span>, <span class="contact-name">Satoru Matsushima</span>, <span class="contact-name">Thomas Morin</span>, <span class="contact-name">Dhananjaya Rao</span>, <span class="contact-name">Ravi Singh</span>, <span class="contact-name">Harish Sitaraman</span>, <span class="contact-name">Brian Trammell</span>, <span class="contact-name">Xiaohu Xu</span>, and <span class="contact-name">Zhaohui Zhang</span> for their review, comments, and/or helpful discussions. <span class="contact-name">Alvaro Retana</span> provided an
   especially comprehensive review.<a class="pilcrow" href="#section-appendix.b-2">¶</a></p>
</section>
<section id="section-appendix.c">
      <h2 id="name-contributors">
<a class="section-name selfRef" href="#name-contributors">Contributors</a>
      </h2>
<p id="section-appendix.c-1">
   Below is a list of other contributing authors in alphabetical order:<a class="pilcrow" href="#section-appendix.c-1">¶</a></p>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Randy Bush</span></div>
<div class="left" dir="auto"><span class="org">Internet Initiative Japan</span></div>
<div class="left" dir="auto"><span class="street-address">5147 Crystal Springs</span></div>
<div class="left" dir="auto">
<span class="locality">Bainbridge Island</span>, <span class="region">WA</span> <span class="postal-code">98110</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:randy@psg.com">randy@psg.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Robert Raszuk</span></div>
<div class="left" dir="auto"><span class="org">Bloomberg LP</span></div>
<div class="left" dir="auto"><span class="street-address">731 Lexington Ave</span></div>
<div class="left" dir="auto">
<span class="locality">New York City</span>, <span class="region">NY</span> <span class="postal-code">10022</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:robert@raszuk.net">robert@raszuk.net</a>
</div>
</address>
<address class="vcard">
<div class="left" dir="auto"><span class="fn nameRole">Eric C. Rosen</span></div>
</address>
</section>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Keyur Patel</span></div>
<div class="left" dir="auto"><span class="org">Arrcus, Inc</span></div>
<div class="left" dir="auto"><span class="street-address">2077 Gateway Pl</span></div>
<div class="left" dir="auto">
<span class="locality">San Jose</span>, <span class="region">CA</span> <span class="postal-code">95110</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:keyur@arrcus.com">keyur@arrcus.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Gunter Van de Velde</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
<div class="left" dir="auto"><span class="street-address">Copernicuslaan 50</span></div>
<div class="left" dir="auto">
<span class="postal-code">2018</span> <span class="locality">Antwerpen</span>
</div>
<div class="left" dir="auto"><span class="country-name">Belgium</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:gunter.van_de_velde@nokia.com">gunter.van_de_velde@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Srihari R. Sangli</span></div>
<div class="left" dir="auto"><span class="org">Juniper Networks</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ssangli@juniper.net">ssangli@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">John Scudder</span></div>
<div class="left" dir="auto"><span class="org">Juniper Networks</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:jgs@juniper.net">jgs@juniper.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>