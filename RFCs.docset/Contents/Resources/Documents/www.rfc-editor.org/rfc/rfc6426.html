<html><head></head><body><pre>Internet Engineering Task Force (IETF)                           E. Gray
Request for Comments: 6426                                      Ericsson
Updates: <a href="./rfc4379">4379</a>                                                 N. Bahadur
Category: Standards Track                         Juniper Networks, Inc.
ISSN: 2070-1721                                               S. Boutros
                                                     Cisco Systems, Inc.
                                                             R. Aggarwal
                                                           November 2011


       <span class="h1">MPLS On-Demand Connectivity Verification and Route Tracing</span>

Abstract

   Label Switched Path Ping (LSP ping) is an existing and widely
   deployed Operations, Administration, and Maintenance (OAM) mechanism
   for Multi-Protocol Label Switching (MPLS) Label Switched Paths
   (LSPs).  This document describes extensions to LSP ping so that LSP
   ping can be used for on-demand connectivity verification of MPLS
   Transport Profile (MPLS-TP) LSPs and pseudowires.  This document also
   clarifies procedures to be used for processing the related OAM
   packets.  Further, it describes procedures for using LSP ping to
   perform connectivity verification and route tracing functions in
   MPLS-TP networks.  Finally, this document updates <a href="./rfc4379">RFC 4379</a> by adding
   a new address type and creating an IANA registry.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6426">http://www.rfc-editor.org/info/rfc6426</a>.












<span class="grey">Gray, et al.                 Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Conventions Used in This Document  . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.2">1.2</a>.  On-Demand CV for MPLS-TP LSPs Using IP Encapsulation . . .  <a href="#page-4">4</a>
     1.3.  On-Demand CV for MPLS-TP LSPs Using Non-IP
           Encapsulation  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  LSP Ping Extensions  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-2.1">2.1</a>.  New Address Type for Downstream Mapping TLV  . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-2.1.1">2.1.1</a>.  DSMAP/DDMAP Non-IP Address Information . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-2.2">2.2</a>.  Source/Destination Identifier TLV  . . . . . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-2.2.1">2.2.1</a>.  Source/Destination Identifier TLV Format . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-2.2.2">2.2.2</a>.  Source Identifier TLV  . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-2.2.3">2.2.3</a>.  Destination Identifier TLV . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-2.3">2.3</a>.  Identifying Statically Provisioned LSPs and PWs  . . . . .  <a href="#page-8">8</a>
       <a href="#section-2.3.1">2.3.1</a>.  Static LSP Sub-TLV . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
       <a href="#section-2.3.2">2.3.2</a>.  Static Pseudowire Sub-TLV  . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-3">3</a>.  Performing On-Demand CV over MPLS-TP LSPs  . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-3.1">3.1</a>.  LSP Ping with IP Encapsulation . . . . . . . . . . . . . . <a href="#page-11">11</a>
     <a href="#section-3.2">3.2</a>.  On-Demand CV with IP Encapsulation, over ACH . . . . . . . <a href="#page-11">11</a>
     <a href="#section-3.3">3.3</a>.  Non-IP-Based On-Demand CV, Using ACH . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-3.4">3.4</a>.  Reverse-Path Connectivity Verification . . . . . . . . . . <a href="#page-13">13</a>
       <a href="#section-3.4.1">3.4.1</a>.  Requesting Reverse-Path Connectivity Verification  . . <a href="#page-13">13</a>
       <a href="#section-3.4.2">3.4.2</a>.  Responder Procedures . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
       <a href="#section-3.4.3">3.4.3</a>.  Requester Procedures . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
     <a href="#section-3.5">3.5</a>.  P2MP Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
     3.6.  Management Considerations for Operation with Static
           MPLS-TP  . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
     <a href="#section-3.7">3.7</a>.  Generic Associated Channel Label (GAL) Processing  . . . . <a href="#page-14">14</a>
   <a href="#section-4">4</a>.  Performing On-Demand Route Tracing over MPLS-TP LSPs . . . . . <a href="#page-15">15</a>
     <a href="#section-4.1">4.1</a>.  On-Demand LSP Route Tracing with IP Encapsulation  . . . . <a href="#page-15">15</a>





<span class="grey">Gray, et al.                 Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


     <a href="#section-4.2">4.2</a>.  Non-IP-Based On-Demand LSP Route Tracing, Using ACH  . . . <a href="#page-15">15</a>
       4.2.1.  Requester Procedure for Sending Echo Request
               Packets  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
       4.2.2.  Requester Procedure for Receiving Echo Response
               Packets  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
       <a href="#section-4.2.3">4.2.3</a>.  Responder Procedure  . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-4.3">4.3</a>.  P2MP Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-4.4">4.4</a>.  ECMP Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-5">5</a>.  Applicability  . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-6">6</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-7">7</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-7.1">7.1</a>.  New Source and Destination Identifier TLVs . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-7.2">7.2</a>.  New Target FEC Stack Sub-TLVs  . . . . . . . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-7.3">7.3</a>.  New Reverse-Path Target FEC Stack TLV  . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-7.4">7.4</a>.  New Pseudowire Associated Channel Type . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-7.5">7.5</a>.  New Downstream Mapping Address Type Registry . . . . . . . <a href="#page-18">18</a>
   <a href="#section-8">8</a>.  Contributing Authors and Acknowledgements  . . . . . . . . . . <a href="#page-19">19</a>
   <a href="#section-9">9</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-9.1">9.1</a>.  Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#section-9.2">9.2</a>.  Informative References . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Label Switched Path Ping (LSP ping) [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] is an Operations,
   Administration, and Maintenance (OAM) mechanism for Multi-Protocol
   Label Switching (MPLS) Label Switched Paths (LSPs).  This document
   describes extensions to LSP ping so that LSP ping can be used for
   on-demand monitoring of MPLS Transport Profile (MPLS-TP) LSPs and
   pseudowires.  It also clarifies the procedures to be used for
   processing the related OAM packets.  This document describes how LSP
   ping can be used for on-demand connectivity verification (<a href="#section-3">Section 3</a>)
   and route tracing (<a href="#section-4">Section 4</a>) functions required in [<a href="./rfc5860" title='"Requirements for Operations, Administration, and Maintenance (OAM) in MPLS Transport Networks"'>RFC5860</a>] and
   specified in [<a href="./rfc6371" title='"Operations, Administration, and Maintenance Framework for MPLS-Based Transport Networks"'>RFC6371</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   There is considerable opportunity for confusion in use of the terms
   "on-demand connectivity verification" (CV), "on-demand route tracing"
   and "LSP ping."  In this document, we try to use the terms
   consistently as follows:

   o  LSP ping: refers to the mechanism - particularly as defined and
      used in referenced material;



<span class="grey">Gray, et al.                 Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   o  On-demand CV: refers to on-demand connectivity verification and --
      where both apply equally -- on-demand route tracing, as
      implemented using the LSP ping mechanism extended for support of
      MPLS-TP;

   o  On-demand route tracing: used in those cases where the LSP ping
      mechanism (as extended) is used exclusively for route tracing.

   From the perspective of on-demand CV and route tracing, we use the
   concepts of "Requester" and "Responder" as follows:

   o  Requester: Originator of an OAM Request message,

   o  Responder: Entity responding to an OAM Request message.

   Since, in this document, all messages are assumed to be carried in an
   LSP, all Request messages would be injected at the ingress to an LSP.
   A Responder might or might not be at the egress of this same LSP,
   given that it could receive Request messages as a result of time-to-
   live (TTL) expiry.  If a Reply is to be delivered via a reverse-path
   LSP, the message would again be inserted at the ingress of that LSP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20On-Demand%20CV%20for%20MPLS-TP%20LSPs%20Using%20IP%20Encapsulation"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  On-Demand CV for MPLS-TP LSPs Using IP Encapsulation</span>

   LSP ping requires IP addressing on responding Label Switching Routers
   (LSRs) for performing OAM on MPLS-signaled LSPs and pseudowires.  In
   particular, in these cases, LSP ping packets generated by a Requester
   are encapsulated in an IP/UDP header with the destination address
   from the 127/8 range and then encapsulated in the MPLS label stack
   ([<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] , [<a href="./rfc5884" title='"Bidirectional Forwarding Detection (BFD) for MPLS Label Switched Paths (LSPs)"'>RFC5884</a>]).  A Responder uses the presence of the 127/8
   destination address to identify OAM packets and relies further on the
   UDP port number to determine whether the packet is an LSP ping
   packet.  It is to be noted that this determination does not require
   IP forwarding capabilities.  It requires the presence of an IP host
   stack, which enables responding LSRs to process packets with a
   destination address from the 127/8 range.  [<a href="./rfc1122" title='"Requirements for Internet Hosts - Communication Layers"'>RFC1122</a>] allocates the
   127/8 range as "Internal host loopback address" and [<a href="./rfc1812" title='"Requirements for IP Version 4 Routers"'>RFC1812</a>] states
   that "a router SHOULD NOT forward, except over a loopback interface,
   any packet that has a destination address on network 127".

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.3.%20%20On-Demand%20CV%20for%20MPLS-TP%20LSPs%20Using%20Non-IP%20Encapsulation"></a><a class="selflink" href="#section-1.3" id="section-1.3">1.3</a>.  On-Demand CV for MPLS-TP LSPs Using Non-IP Encapsulation</span>

   In certain MPLS-TP deployment scenarios, IP addressing might not be
   available or use some form of non-IP encapsulation might be preferred
   for on-demand CV, route tracing, and BFD packets.  In such scenarios,
   on-demand CV and/or route tracing SHOULD be run without IP
   addressing, using the Associated Channel (ACH) channel type specified
   in <a href="#section-3">Section 3</a>.



<span class="grey">Gray, et al.                 Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   <a href="#section-3.3">Section 3.3</a> and <a href="#section-4.2">Section 4.2</a> describe the theory of operation for
   performing on-demand CV over MPLS-TP LSPs with any non-IP
   encapsulation.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20LSP%20Ping%20Extensions"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  LSP Ping Extensions</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20New%20Address%20Type%20for%20Downstream%20Mapping%20TLV"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  New Address Type for Downstream Mapping TLV</span>

   [<a id="ref-RFC4379">RFC4379</a>] defines the Downstream Mapping (DSMAP) TLV.  [<a href="./rfc6424" title='"Mechanism for Performing Label Switched Path Ping (LSP Ping) over MPLS Tunnels"'>RFC6424</a>]
   further defines the Downstream Detailed Mapping (DDMAP) TLV.  This
   document defines the following new address type, which MAY be used in
   any DSMAP or DDMAP TLV included in an on-demand CV message:

               Type #        Address Type           K Octets
               ------        --------------         --------
                   5         Non IP                       12

               Figure 1: New Downstream Mapping Address Type

   The new address type indicates that no address is present in the
   DSMAP or DDMAP TLV.  However, IF_Num information (see definition of
   "IF_Num" in [<a href="./rfc6370" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>]) for both ingress and egress interfaces, as
   well as Multipath Information, is included in the format and MAY be
   present.

   IF_Num values of zero indicate that no IF_Num applies in the field in
   which this value appears.

   The Multipath Type SHOULD be set to zero (no multipath) when using
   this address type.

   When this address type is used, on receipt of an LSP ping echo
   request, interface verification MUST be bypassed.  Thus, the
   receiving node SHOULD only perform MPLS label control-plane/
   data-plane consistency checks.  Note that these consistency checks
   include checking the included identifier information.

   The new address type is also applicable to the Detailed Downstream
   Mapping (DDMAP) TLV defined in [<a href="./rfc6424" title='"Mechanism for Performing Label Switched Path Ping (LSP Ping) over MPLS Tunnels"'>RFC6424</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.1.%20%20DSMAP%2FDDMAP%20Non-IP%20Address%20Information"></a><a class="selflink" href="#section-2.1.1" id="section-2.1.1">2.1.1</a>.  DSMAP/DDMAP Non-IP Address Information</span>

   If the DSMAP (or DDMAP) TLV is included when sending on-demand CV
   packets using ACH, without IP encapsulation, the following
   information MUST be included in any DSMAP or DDMAP TLV that is
   included in the packet.  This information forms the address portion
   of the DSMAP TLV (as defined in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>]) or DDMAP TLV (as defined
   in [<a href="./rfc6424" title='"Mechanism for Performing Label Switched Path Ping (LSP Ping) over MPLS Tunnels"'>RFC6424</a>] using one of the address information fields defined in



<span class="grey">Gray, et al.                 Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   [<a id="ref-RFC4379">RFC4379</a>] and extended to include non-IP identifier types in this
   document).

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               MTU             | Address Type  |    DS Flags   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               Ingress IF_Num (4 octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                Egress IF_Num (4 octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Multipath Type| Depth Limit   |        Multipath Length       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 2: New DSMAP/DDMAP Address Format

   Address Type will be 5 (as shown in <a href="#section-2.1">Section 2.1</a> above).

   Ingress IF_Num identifies the ingress interface on the target node.
   A value of zero indicates that the interface is not part of the
   identifier.

   Egress IF_Num identifies the egress interface on the target node.  A
   value of zero indicates that the interface is not part of the
   identifier.

   The Multipath Type SHOULD be set to zero (no multipath) when using
   this address type.

   Including this TLV, with one or the other IF_Num (but not both) set
   to a non-zero value, in a request message that also includes a
   Destination Identifier TLV (as described in <a href="#section-2.2">Section 2.2</a>), is
   sufficient to identify the "per-interface" MIP in <a href="./rfc6370#section-7.3">Section 7.3 of
   [RFC6370]</a>.

   Inclusion of this TLV with both IF_Num fields set to zero would be
   interpreted as specifying neither an ingress, nor an egress,
   interface.  Note that this is the same as not including the TLV;
   hence, including this TLV with both IF_Num values set to zero is NOT
   RECOMMENDED.

   Including this TLV with both IF_NUM fields set to a non-zero value
   will result in the responder sending a Return Code of 5 ("Downstream
   Mapping Mis-match") if either IF_Num is incorrect for this LSP or PW.






<span class="grey">Gray, et al.                 Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.%20%20Source%2FDestination%20Identifier%20TLV"></a><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Source/Destination Identifier TLV</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.1.%20%20Source%2FDestination%20Identifier%20TLV%20Format"></a><a class="selflink" href="#section-2.2.1" id="section-2.2.1">2.2.1</a>.  Source/Destination Identifier TLV Format</span>

   The format for the identifier TLV is the same for both Source and
   Destination Identifier TLVs (only the type is different).  The format
   is as specified in the figure below.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Type              | Length = 8                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  Global_ID   (4 Octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Node_ID   (4 Octets)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 3: New Source/Destination Identifier Format

   Type will be one of either 13 or 14, depending on whether the TLV in
   question is a Source or Destination Identifier TLV.

   Global_ID is as defined in [<a href="./rfc6370" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>].

   Node_ID is as defined in [<a href="./rfc6370" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.2.%20%20Source%20Identifier%20TLV"></a><a class="selflink" href="#section-2.2.2" id="section-2.2.2">2.2.2</a>.  Source Identifier TLV</span>

   When sending on-demand CV packets using ACH, without IP
   encapsulation, there MAY be a need to identify the source of the
   packet.  This source identifier (Source ID) will be specified via the
   Source Identifier TLV, using the Identifier TLV defined in
   <a href="#section-2.2.1">Section 2.2.1</a>, containing the information specified above.

   An on-demand CV packet MUST NOT include more than one Source
   Identifier TLV.  The Source Identifier TLV MUST specify the
   identifier of the originator of the packet.  If more than one such
   TLV is present in an on-demand CV request packet, then error 1
   (Malformed echo request received; see <a href="./rfc4379#section-3.1">Section 3.1 of [RFC4379]</a>) MUST
   be returned, if it is possible to unambiguously identify the source
   of the packet.









<span class="grey">Gray, et al.                 Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.3.%20%20Destination%20Identifier%20TLV"></a><a class="selflink" href="#section-2.2.3" id="section-2.2.3">2.2.3</a>.  Destination Identifier TLV</span>

   When sending on-demand CV packets using ACH, without IP
   encapsulation, there MAY be a need to identify the destination of the
   packet.  This destination identifier (Destination ID) will be
   specified via the Destination Identifier TLV, using the Identifier
   TLV defined in <a href="#section-2.2.1">Section 2.2.1</a>, containing the information specified
   above.

   An on-demand CV packet MUST NOT include more than one Destination
   Identifier TLV.  The Destination Identifier TLV MUST specify the
   destination node for the packet.  If more than 1 such TLV is present
   in an on-demand CV Request packet, then error 1 (Malformed echo
   request received; see <a href="./rfc4379#section-3.1">Section 3.1 of [RFC4379]</a>) MUST be returned, if
   it is possible to unambiguously identify the source of the packet.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.3.%20%20Identifying%20Statically%20Provisioned%20LSPs%20and%20PWs"></a><a class="selflink" href="#section-2.3" id="section-2.3">2.3</a>.  Identifying Statically Provisioned LSPs and PWs</span>

   [<a id="ref-RFC4379">RFC4379</a>] specifies how an MPLS LSP under test is identified in an
   echo request.  A Target FEC Stack TLV is used to identify the LSP.
   In order to identify a statically provisioned LSP and PW, new target
   FEC Stack sub-TLVs are being defined.  The new sub-TLVs are assigned
   sub-type identifiers as follows and are described in the following
   sections.

         Type #   Sub-Type #       Length        Value Field
         ------   ----------       ------        -----------
           1         22              24          Static LSP
           1         23              32          Static Pseudowire

                    Figure 4: New Target FEC Sub-Types




















<span class="grey">Gray, et al.                 Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.3.1.%20%20Static%20LSP%20Sub-TLV"></a><a class="selflink" href="#section-2.3.1" id="section-2.3.1">2.3.1</a>.  Static LSP Sub-TLV</span>

   The format of the Static LSP sub-TLV value field is specified in the
   following figure.  The value fields are taken from the definitions in
   [<a href="./rfc6370" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>].

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Global ID                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Node ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Source Tunnel Number      |        LSP Number             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Global ID                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Destination Node ID                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Destination Tunnel Number   |        Must be Zero           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                     Figure 5: Static LSP FEC Sub-TLV

   The Source Global ID and Destination Global ID MAY be set to zero.
   When set to zero, the field is not applicable.

























<span class="grey">Gray, et al.                 Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.3.2.%20%20Static%20Pseudowire%20Sub-TLV"></a><a class="selflink" href="#section-2.3.2" id="section-2.3.2">2.3.2</a>.  Static Pseudowire Sub-TLV</span>

   The format of the Static PW sub-TLV value field is specified in the
   following figure.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                      Service Identifier                       +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Global ID                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source Node ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Source AC-ID                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Global ID                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Destination Node ID                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Destination AC-ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 6: Static PW FEC Sub-TLV

   The Service Identifier is a 64-bit unsigned integer that is included
   in the first two words, as shown.  The Service Identifier identifies
   the service associated with the transport path under test.  The value
   MAY, for example, be an Attachment Group Identifier (AGI), type 0x01,
   as defined in [<a href="./rfc4446" title='"IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)"'>RFC4446</a>].

   The Source Global ID and Destination Global ID MAY be set to zero.
   When either of these fields is set to zero, the corresponding Global
   ID is not applicable.  This might be done in a scenario where local
   scope is sufficient for uniquely identifying services.

   The Global ID and Node ID fields are defined in [<a href="./rfc6370" title='"MPLS Transport Profile (MPLS-TP) Identifiers"'>RFC6370</a>].  The AC-ID
   fields are defined in [<a href="./rfc5003" title='"Attachment Individual Identifier (AII) Types for Aggregation"'>RFC5003</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Performing%20On-Demand%20CV%20over%20MPLS-TP%20LSPs"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Performing On-Demand CV over MPLS-TP LSPs</span>

   This section specifies how on-demand CV can be used in the context of
   MPLS-TP LSPs.  The on-demand CV function meets the on-demand
   connectivity verification requirements specified in <a href="./rfc5860#section-2.2.3">[RFC5860],
   Section 2.2.3</a>.  This function SHOULD NOT be performed except in the
   on-demand mode.  This function SHOULD be performed between



<span class="grey">Gray, et al.                 Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   Maintenance Entity Group End Points (MEPs) and Maintenance Entity
   Group Intermediate Points (MIPs) of PWs and LSPs, and between End
   Points of PWs, LSPs, and Sections.  In order for the on-demand CV
   packet to be processed at the desired MIP, the TTL of the MPLS label
   MUST be set such that it expires at the MIP to be probed.

   [<a id="ref-RFC5586">RFC5586</a>] defines an ACH mechanism for MPLS LSPs.  The mechanism is a
   generalization of the Associated Channel mechanism that [<a href="./rfc4385" title='"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"'>RFC4385</a>]
   defined for use with pseudowires.  As a result, it is possible to use
   a single Associated Channel Type for either an LSP or pseudowire.

   A new Pseudowire Associated Channel Type (0x0025) is defined for use
   in performing on-demand connectivity verification.  Its use is
   described in the following sections.

   ACH TLVs SHALL NOT be associated with this channel type.

   Except as specifically stated in the sections below, message and TLV
   construction procedures for on-demand CV messages are as defined in
   [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20LSP%20Ping%20with%20IP%20Encapsulation"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  LSP Ping with IP Encapsulation</span>

   LSP ping packets, as specified in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], are sent over the MPLS
   LSP for which OAM is being performed and contain an IP/UDP packet
   within them.  The IP header is not used for forwarding (since LSP
   forwarding is done using MPLS).  The IP header is used mainly for
   addressing and can be used in the context of MPLS-TP LSPs.  This form
   of on-demand CV OAM MUST be supported for MPLS-TP LSPs when IP
   addressing is in use.

   The on-demand CV echo response message MUST be sent on the reverse
   path of the LSP.  The reply MUST contain IP/UDP headers followed by
   the on-demand CV payload.  The destination address in the IP header
   MUST be set to that of the sender of the echo request message.  The
   source address in the IP header MUST be set to a valid address of the
   replying node.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20On-Demand%20CV%20with%20IP%20Encapsulation%2C%20over%20ACH"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  On-Demand CV with IP Encapsulation, over ACH</span>

   IP encapsulated on-demand CV packets MAY be sent over the MPLS LSP
   using the control channel (ACH).  The IP ACH type specified in
   [<a href="./rfc4385" title='"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"'>RFC4385</a>] MUST be used in such a case.  The IP header is used mainly
   for addressing and can be used in the context of MPLS-TP LSPs.

   Note that the application-level control channel in this case is the
   reverse path of the LSP (or Pseudowire) using ACH.




<span class="grey">Gray, et al.                 Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   The on-demand CV echo response message MUST be sent on the reverse
   path of the LSP.  The response in this case SHOULD use ACH and SHOULD
   be IP encapsulated.

   If IP encapsulated, the destination address in the IP header MUST be
   set to that of the sender of the echo request message, and the source
   address in the IP header MUST be set to a valid address of the
   replying node.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.3.%20%20Non-IP-Based%20On-Demand%20CV%2C%20Using%20ACH"></a><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Non-IP-Based On-Demand CV, Using ACH</span>

   The OAM procedures defined in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] require the use of IP
   addressing, and in some cases IP routing, to perform OAM functions.

   When the ACH header is used, IP addressing and routing is not needed.
   This section describes procedures for performing on-demand CV without
   a dependency on IP addressing and routing.

   In the non-IP case, when using on-demand CV via LSP ping with the ACH
   header, the on-demand CV request payload MUST directly follow the ACH
   header, and the LSP ping Reply mode [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] in the LSP ping echo
   request SHOULD be set to 4 (Reply via application level control
   channel).

   Note that the application-level control channel in this case is the
   reverse path of the LSP (or pseudowire) using ACH.

   The requesting node MAY attach a Source Identifier TLV (<a href="#section-2.2">Section 2.2</a>)
   to identify the node originating the request.

   If the Reply mode indicated in an on-demand CV Request is 4 (Reply
   via application level control channel), the on-demand CV reply
   message MUST be sent on the reverse path of the LSP using ACH.  The
   on-demand CV payload MUST directly follow the ACH header, and IP
   and/or UDP headers MUST NOT be attached.  The responding node MAY
   attach a Source Identifier TLV to identify the node sending the
   response.

   If a node receives an MPLS echo request packet over ACH, without IP/
   UDP headers, with a reply mode of 4, and if that node does not have a
   return MPLS LSP path to the echo request source, then the node SHOULD
   drop the echo request packet and not attempt to send a response.

   If a node receives an MPLS echo request with a reply mode other than
   4 (Reply via application level control channel), and if the node
   supports that reply mode, then it MAY respond using that reply mode.
   If the node does not support the reply mode requested, or is unable
   to reply using the requested reply mode in any specific instance, the



<span class="grey">Gray, et al.                 Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   node MUST drop the echo request packet and not attempt to send a
   response.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.%20%20Reverse-Path%20Connectivity%20Verification"></a><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  Reverse-Path Connectivity Verification</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.1.%20%20Requesting%20Reverse-Path%20Connectivity%20Verification"></a><a class="selflink" href="#section-3.4.1" id="section-3.4.1">3.4.1</a>.  Requesting Reverse-Path Connectivity Verification</span>

   A new Global flag, Validate Reverse Path (R), is being defined in the
   LSP ping packet header.  When this flag is set in the echo request,
   the Responder SHOULD return reverse-path FEC information, as
   described in <a href="#section-3.4.2">Section 3.4.2</a>.

   The R flag MUST NOT be set in the echo response.

   The Global Flags field is now a bit vector with the following format:

                       0                   1
                       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |             MBZ         |R|T|V|
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                       Figure 7: Global Flags Field

   The V flag is defined in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  The T flag is defined in
   [<a href="./rfc6425" title='"Detecting Data-Plane Failures in Point-to-Multipoint MPLS - Extensions to LSP Ping"'>RFC6425</a>].  The R flag is defined in this document.

   The Validate FEC Stack (V) flag MAY be set in the echo response when
   reverse-path connectivity verification is being performed.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.2.%20%20Responder%20Procedures"></a><a class="selflink" href="#section-3.4.2" id="section-3.4.2">3.4.2</a>.  Responder Procedures</span>

   When the R flag is set in the echo request, the responding node
   SHOULD attach a Reverse-path Target FEC Stack TLV in the echo
   response.  The requesting node (on receipt of the response) can use
   the Reverse-path Target FEC Stack TLV to perform reverse-path
   connectivity verification.  For co-routed bidirectional LSPs, the
   Reverse-path Target FEC Stack used for the on-demand CV will be the
   same in both the forward and reverse path of the LSP.  For associated
   bidirectional LSPs, the Target FEC Stack MAY be different for the
   reverse path.

   The format of the Reverse-path Target FEC Stack TLV is the same as
   that of the Target FEC Stack TLV defined in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  The rules for
   creating a Target FEC Stack TLV also apply to the Reverse-path Target
   FEC Stack TLV.





<span class="grey">Gray, et al.                 Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


             Type         Meaning
             --------     ------------------------------------
                16        Reverse-path Target FEC Stack

             Figure 8: Reverse-Path Target FEC Stack TLV Type

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.3.%20%20Requester%20Procedures"></a><a class="selflink" href="#section-3.4.3" id="section-3.4.3">3.4.3</a>.  Requester Procedures</span>

   On receipt of the echo response, the requesting node MUST perform the
   following checks:

   1.  Perform interface and label-stack validation to ensure that the
       packet is received on the reverse path of the bidirectional LSP.

   2.  If the Reverse-path Target FEC Stack TLV is present in the echo
       response, then perform FEC validation.

   The verification in this case is performed as described for the
   Target FEC Stack in <a href="./rfc4379#section-3.6">Section 3.6 of [RFC4379]</a>.

   If any of the validations fail, then the requesting node MUST drop
   the echo response and SHOULD log and/or report an error.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.5.%20%20P2MP%20Considerations"></a><a class="selflink" href="#section-3.5" id="section-3.5">3.5</a>.  P2MP Considerations</span>

   [<a id="ref-RFC6425">RFC6425</a>] describes how LSP ping can be used for OAM on P2MP LSPs
   with IP encapsulation.  This MUST be supported for MPLS-TP P2MP LSPs
   when IP addressing is used.  When IP addressing is not used, then the
   procedures described in <a href="#section-3.3">Section 3.3</a> can be applied to P2MP MPLS-TP
   LSPs as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.6.%20%20Management%20Considerations%20for%20Operation%20with%20Static%20MPLS-TP"></a><a class="selflink" href="#section-3.6" id="section-3.6">3.6</a>.  Management Considerations for Operation with Static MPLS-TP</span>

   Support for on-demand CV on a static MPLS-TP LSP or pseudowire MAY
   require manageable objects to allow, for instance, configuring
   operating parameters such as identifiers associated with the
   statically configured LSP or PW.

   The specifics of this manageability requirement are out-of-scope in
   this document and SHOULD be addressed in appropriate management
   specifications.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.%20%20Generic%20Associated%20Channel%20Label%20%28GAL%29%20Processing"></a><a class="selflink" href="#section-3.7" id="section-3.7">3.7</a>.  Generic Associated Channel Label (GAL) Processing</span>

   At the Requester, when encapsulating the LSP echo request (LSP ping)
   packet (with the IP ACH, or the Non IP ACH, codepoint), a GAL MUST be
   added before adding the MPLS LSP label, and sending the LSP Ping echo
   request packet in-band in the MPLS LSP.



<span class="grey">Gray, et al.                 Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   The GAL MUST NOT be considered as part of the MPLS label stack that
   requires verification by the Responder.  For this reason, a Nil FEC
   TLV MUST NOT be added or associated with the GAL.

   The GAL MUST NOT be included in DSMAP or DDMAP TLVs.

   Interface and Label Stack TLVs MUST include the whole label stack
   including the GAL.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Performing%20On-Demand%20Route%20Tracing%20over%20MPLS-TP%20LSPs"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Performing On-Demand Route Tracing over MPLS-TP LSPs</span>

   This section specifies how on-demand CV route tracing can be used in
   the context of MPLS-TP LSPs.  The on-demand CV route tracing function
   meets the route tracing requirement specified in [<a href="./rfc5860" title='"Requirements for Operations, Administration, and Maintenance (OAM) in MPLS Transport Networks"'>RFC5860</a>], <a href="#section-2.2.3">Section</a>
   <a href="#section-2.2.3">2.2.3</a>.

   This function SHOULD be performed on-demand.  This function SHOULD be
   performed between End Points and Intermediate Points of PWs and LSPs,
   and between End Points of PWs, LSPs and Sections.

   When performing on-demand CV route tracing, the requesting node
   inserts a Downstream Mapping TLV to get the downstream node
   information and to enable LSP verification along the transit nodes.
   The Downstream Mapping TLV can be used as is for performing route
   tracing.  If IP addressing is not in use, then the Address Type field
   in the Downstream Mapping TLV can be set to "Non IP" (<a href="#section-2.1">Section 2.1</a>).
   The Downstream Mapping TLV address type field can be extended to
   include other address types as needed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20On-Demand%20LSP%20Route%20Tracing%20with%20IP%20Encapsulation"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  On-Demand LSP Route Tracing with IP Encapsulation</span>

   The mechanics of on-demand CV route tracing are similar to those
   described for ping in <a href="#section-3.1">Section 3.1</a>.  On-demand route tracing packets
   sent by the Requester MUST follow procedures described in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].
   This form of on-demand CV OAM MUST be supported for MPLS-TP LSPs,
   when IP addressing is used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Non-IP-Based%20On-Demand%20LSP%20Route%20Tracing%2C%20Using%20ACH"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Non-IP-Based On-Demand LSP Route Tracing, Using ACH</span>

   This section describes procedures for performing LSP route tracing
   when using LSP ping with the ACH header and without any dependency on
   IP addressing.  The procedures specified in <a href="#section-3.3">Section 3.3</a> with regards
   to the Source Identifier TLV apply to LSP route tracing as well.








<span class="grey">Gray, et al.                 Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.1.%20%20Requester%20Procedure%20for%20Sending%20Echo%20Request%20Packets"></a><a class="selflink" href="#section-4.2.1" id="section-4.2.1">4.2.1</a>.  Requester Procedure for Sending Echo Request Packets</span>

   On-demand route tracing packets sent by the Requester MUST adhere to
   the format described in <a href="#section-3.3">Section 3.3</a>.  MPLS-TTL expiry (as described
   in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>]) will be used to direct the packets to specific nodes
   along the LSP path.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.2.%20%20Requester%20Procedure%20for%20Receiving%20Echo%20Response%20Packets"></a><a class="selflink" href="#section-4.2.2" id="section-4.2.2">4.2.2</a>.  Requester Procedure for Receiving Echo Response Packets</span>

   The on-demand CV route tracing responses will be received on the LSP
   itself, and the presence of an ACH header with channel type of on-
   demand CV is an indicator that the packet contains an on-demand CV
   payload.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.3.%20%20Responder%20Procedure"></a><a class="selflink" href="#section-4.2.3" id="section-4.2.3">4.2.3</a>.  Responder Procedure</span>

   When an echo request reaches the Responder, the presence of the ACH
   channel type of on-demand CV will indicate that the packet contains
   on-demand CV data.  The on-demand CV data, the label stack, and the
   destination identifier are sufficient to identify the LSP associated
   with the echo request packet.  If there is an error and the node is
   unable to identify the LSP on which the echo response would be sent,
   the node MUST drop the echo request packet and not send any response
   back.  All responses MUST always be sent on an LSP path using the ACH
   header and ACH channel type of on-demand CV.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20P2MP%20Considerations"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  P2MP Considerations</span>

   [<a id="ref-RFC6425">RFC6425</a>] describes how LSP ping can be used for OAM on P2MP LSPs.
   This MUST be supported for MPLS-TP P2MP LSPs when IP addressing is
   used.  When IP addressing is not used, then the procedures described
   in <a href="#section-4.2">Section 4.2</a> can be applied to P2MP MPLS-TP LSPs as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.4.%20%20ECMP%20Considerations"></a><a class="selflink" href="#section-4.4" id="section-4.4">4.4</a>.  ECMP Considerations</span>

   On-demand CV using ACH SHOULD NOT be used when there is ECMP (Equal
   Cost Multi-Path) for a given LSP.  The inclusion of the additional
   ACH header can modify the hashing behavior for OAM packets that could
   result in incorrect monitoring of the path taken by data traffic.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Applicability"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Applicability</span>

   The procedures specified in this document for non-IP encapsulation
   apply to MPLS-TP transport paths.  This includes LSPs and PWs when IP
   encapsulation is not desired.  However, when IP addressing is used,
   as in non MPLS-TP LSPs, procedures specified in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] MUST be
   used.




<span class="grey">Gray, et al.                 Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Security Considerations</span>

   This document does not itself introduce any new security
   considerations.  Those discussed in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] are applicable to this
   document.

   Unlike typical deployment scenarios identified in [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], however,
   likely deployments of on-demand CV for transport paths involves a
   strong possibility that the techniques in this document may be used
   across MPLS administrative boundaries.  Where this may occur, it is
   RECOMMENDED that on-demand OAM is configured as necessary to ensure
   that Source Identifier TLVs are included in on-demand CV messages.
   This will allow implementations to filter OAM messages arriving from
   an unexpected or unknown source.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20New%20Source%20and%20Destination%20Identifier%20TLVs"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  New Source and Destination Identifier TLVs</span>

   IANA has assigned the following TLV types from the "Multi-Protocol
   Label Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters"
   registry, "TLVs and sub-TLVs" sub-registry (from the "Standards
   Action" TLV type range):

                                   Length
       Type #   TLV Name           Octets   Reference
       ------   -----------------  ------   ---------------------------
           13   Source ID            8      this document (<a href="#section-2.2">Section 2.2</a>)
           14   Destination ID       8      this document (<a href="#section-2.2">Section 2.2</a>)

         Figure 9: New Source and Destination Identifier TLV Types

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20New%20Target%20FEC%20Stack%20Sub-TLVs"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  New Target FEC Stack Sub-TLVs</span>

   <a href="#section-2.3">Section 2.3</a> defines 2 new sub-TLV types for inclusion within the LSP
   ping [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] Target FEC Stack TLV (1).

   IANA has assigned sub-type values to the following sub-TLVs from the
   "Multi-Protocol Label Switching Architecture (MPLS) Label Switched
   Paths (LSPs) Ping Parameters" registry, "TLVs and sub-TLVs" sub-
   registry.

   Value    Meaning                 Reference
   -----    -------------------     -----------------------------
   22       Static LSP              this document (<a href="#section-2.4.1">Section 2.4.1</a>)
   23       Static Pseudowire       this document (<a href="#section-2.4.2">Section 2.4.2</a>)





<span class="grey">Gray, et al.                 Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.3.%20%20New%20Reverse-Path%20Target%20FEC%20Stack%20TLV"></a><a class="selflink" href="#section-7.3" id="section-7.3">7.3</a>.  New Reverse-Path Target FEC Stack TLV</span>

   <a href="#section-3.4.2">Section 3.4.2</a> defines a new TLV type for inclusion in the LSP ping
   packet.

   IANA has assigned a type value to the TLV from the "Multi-Protocol
   Label Switching Architecture (MPLS) Label Switched Paths (LSPs) Ping
   Parameters" registry, "TLVs and sub-TLVs" sub-registry.

   Type     Meaning                        Reference
   -----    --------------------------     ---------------------------
      16    Reverse-path Target FEC        this document (<a href="#section-3.4">Section 3.4</a>)
            Stack TLV

   The sub-TLV space and assignments for this TLV will be the same as
   that for the Target FEC Stack TLV.  Sub-types for the Target FEC
   Stack TLV and the Reverse-path Target FEC Stack TLV MUST be kept the
   same.  Any new sub-type added to the Target FEC Stack TLV MUST apply
   to the Reverse-path Target FEC Stack TLV as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.4.%20%20New%20Pseudowire%20Associated%20Channel%20Type"></a><a class="selflink" href="#section-7.4" id="section-7.4">7.4</a>.  New Pseudowire Associated Channel Type</span>

   On-demand connectivity verification requires a unique Associated
   Channel Type.  IANA has assigned a PW ACH Type from the "Pseudowire
   Associated Channel Types" registry as described below:

     Value     Description     TLV Follows  Reference
     ------    -------------   -----------  -------------------------
     0x0025    On-Demand CV         No      this document (<a href="#section-3">Section 3</a>)

   ACH TLVs SHALL NOT be associated with this channel type.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.5.%20%20New%20Downstream%20Mapping%20Address%20Type%20Registry"></a><a class="selflink" href="#section-7.5" id="section-7.5">7.5</a>.  New Downstream Mapping Address Type Registry</span>

   [<a id="ref-RFC4379">RFC4379</a>] defined several registries.  It also defined some value
   assignments without explicitly asking for IANA to create a registry
   to support additional value assignments.  One such case is in
   defining address types associated with the Downstream Mapping (DSMAP)
   TLV.

   This document extends <a href="./rfc4379">RFC 4379</a> by defining a new address type for use
   with the Downstream Mapping and Downstream Detailed Mapping TLVs.

   Recognizing that the absence of a registry makes it possible to have
   collisions of "address-type" usages, IANA has established a new
   registry -- associated with both [<a href="./rfc4379" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] and this document -- that
   initially allocates the following assignments:




<span class="grey">Gray, et al.                 Standards Track                   [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   Type #     Address Type      K Octets    Reference
   ------     ------------      --------    --------------------------
        1     IPv4 Numbered           16    <a href="./rfc4379">RFC 4379</a>
        2     IPv4 Unnumbered         16    <a href="./rfc4379">RFC 4379</a>
        3     IPv6 Numbered           40    <a href="./rfc4379">RFC 4379</a>
        4     IPv6 Unnumbered         28    <a href="./rfc4379">RFC 4379</a>
        5     Non IP                  12    this document (Sect. 2.1.1)

                 Downstream Mapping Address Type Registry

   Because the field in this case is an 8-bit field, the allocation
   policy for this registry is "Standards Action."

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Contributing%20Authors%20and%20Acknowledgements"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Contributing Authors and Acknowledgements</span>

   The following individuals contributed materially to this document:

   o  Thomas D. Nadeau, CA Technologies

   o  Nurit Sprecher, Nokia Siemens Networks

   o  Yaacov Weingarten, Nokia Siemens Networks

   In addition, we would like to thank the following individuals for
   their efforts in reviewing and commenting on the document:

   o  Adrian Farrel

   o  Alexander Vaishtein

   o  David Sinicrope (Routing Directorate)

   o  Greg Mirsky

   o  Hideki Endo

   o  Huub van Helvoort

   o  Joel Halpern (Routing Directorate)

   o  Loa Andersson

   o  Mach Chen

   o  Mahesh Akula

   o  Sam Aldrin




<span class="grey">Gray, et al.                 Standards Track                   [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   o  Sandra Murphy (Security Directorate)

   o  Yaacov Weingarten

   o  Yoshinori Koike

   o  Zhenlong Cui

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20References"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4379">RFC4379</a>]  Kompella, K. and G. Swallow, "Detecting Multi-Protocol
              Label Switched (MPLS) Data Plane Failures", <a href="./rfc4379">RFC 4379</a>,
              February 2006.

   [<a id="ref-RFC4385">RFC4385</a>]  Bryant, S., Swallow, G., Martini, L., and D. McPherson,
              "Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for
              Use over an MPLS PSN", <a href="./rfc4385">RFC 4385</a>, February 2006.

   [<a id="ref-RFC5586">RFC5586</a>]  Bocci, M., Vigoureux, M., and S. Bryant, "MPLS Generic
              Associated Channel", <a href="./rfc5586">RFC 5586</a>, June 2009.

   [<a id="ref-RFC6370">RFC6370</a>]  Bocci, M., Swallow, G., and E. Gray, "MPLS Transport
              Profile (MPLS-TP) Identifiers", <a href="./rfc6370">RFC 6370</a>, September 2011.

   [<a id="ref-RFC6424">RFC6424</a>]  Bahadur, N., Kompella, K., and G. Swallow, "Mechanism for
              Performing Label Switched Path Ping (LSP Ping) over MPLS
              Tunnels", <a href="./rfc6424">RFC 6424</a>, November 2011.

   [<a id="ref-RFC6425">RFC6425</a>]  Saxena, S., Swallow, G., Ali, Z., Farrel, A., Yasukawa,
              S., and T. Nadeau, "Detecting Data-Plane Failures in
              Point-to-Multipoint MPLS - Extensions to LSP Ping",
              <a href="./rfc6425">RFC 6425</a>, November 2011.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-RFC1122">RFC1122</a>]  Braden, R., "Requirements for Internet Hosts -
              Communication Layers", STD 3, <a href="./rfc1122">RFC 1122</a>, October 1989.

   [<a id="ref-RFC1812">RFC1812</a>]  Baker, F., "Requirements for IP Version 4 Routers",
              <a href="./rfc1812">RFC 1812</a>, June 1995.

   [<a id="ref-RFC4446">RFC4446</a>]  Martini, L., "IANA Allocations for Pseudowire Edge to Edge
              Emulation (PWE3)", <a href="https://www.rfc-editor.org/bcp/bcp116">BCP 116</a>, <a href="./rfc4446">RFC 4446</a>, April 2006.



<span class="grey">Gray, et al.                 Standards Track                   [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


   [<a id="ref-RFC5003">RFC5003</a>]  Metz, C., Martini, L., Balus, F., and J. Sugimoto,
              "Attachment Individual Identifier (AII) Types for
              Aggregation", <a href="./rfc5003">RFC 5003</a>, September 2007.

   [<a id="ref-RFC5860">RFC5860</a>]  Vigoureux, M., Ward, D., and M. Betts, "Requirements for
              Operations, Administration, and Maintenance (OAM) in MPLS
              Transport Networks", <a href="./rfc5860">RFC 5860</a>, May 2010.

   [<a id="ref-RFC5884">RFC5884</a>]  Aggarwal, R., Kompella, K., Nadeau, T., and G. Swallow,
              "Bidirectional Forwarding Detection (BFD) for MPLS Label
              Switched Paths (LSPs)", <a href="./rfc5884">RFC 5884</a>, June 2010.

   [<a id="ref-RFC6371">RFC6371</a>]  Busi, I. and D. Allan, "Operations, Administration, and
              Maintenance Framework for MPLS-Based Transport Networks",
              <a href="./rfc6371">RFC 6371</a>, September 2011.




































<span class="grey">Gray, et al.                 Standards Track                   [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc6426">RFC 6426</a>        MPLS On-Demand Connectivity Verification   November 2011</span>


Authors' Addresses

   Eric Gray
   Ericsson
   900 Chelmsford Street
   Lowell, MA  01851
   US

   Phone: +1 978 275 7470
   EMail: eric.gray@ericsson.com


   Nitin Bahadur
   Juniper Networks, Inc.
   1194 N. Mathilda Avenue
   Sunnyvale, CA  94089
   US

   Phone: +1 408 745 2000
   EMail: nitinb@juniper.net
   URI:   www.juniper.net


   Sami Boutros
   Cisco Systems, Inc.
   3750 Cisco Way
   San Jose, CA  95134
   US

   EMail: sboutros@cisco.com


   Rahul Aggarwal

   EMail: raggarwa_1@yahoo.com
















Gray, et al.                 Standards Track                   [Page 22]
</pre>
</body></html>