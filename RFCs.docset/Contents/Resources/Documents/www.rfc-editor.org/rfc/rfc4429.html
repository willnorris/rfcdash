<html><head></head><body><pre>Network Working Group                                           N. Moore
Request for Comments: 4429                        Monash University CTIE
Category: Standards Track                                     April 2006


         <span class="h1">Optimistic Duplicate Address Detection (DAD) for IPv6</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2006).

Abstract

   Optimistic Duplicate Address Detection is an interoperable
   modification of the existing IPv6 Neighbor Discovery (<a href="./rfc2461">RFC 2461</a>) and
   Stateless Address Autoconfiguration (<a href="./rfc2462">RFC 2462</a>) processes.  The
   intention is to minimize address configuration delays in the
   successful case, to reduce disruption as far as possible in the
   failure case, and to remain interoperable with unmodified hosts and
   routers.























<span class="grey">Moore                       Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Problem Statement ..........................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Definitions ................................................<a href="#page-4">4</a>
      <a href="#section-1.3">1.3</a>. Address Types ..............................................<a href="#page-4">4</a>
      <a href="#section-1.4">1.4</a>. Abbreviations ..............................................<a href="#page-5">5</a>
   <a href="#section-2">2</a>. Optimistic DAD Behaviors ........................................<a href="#page-6">6</a>
      <a href="#section-2.1">2.1</a>. Optimistic Addresses .......................................<a href="#page-6">6</a>
      <a href="#section-2.2">2.2</a>. Avoiding Disruption ........................................<a href="#page-6">6</a>
      <a href="#section-2.3">2.3</a>. Router Redirection .........................................<a href="#page-7">7</a>
      <a href="#section-2.4">2.4</a>. Contacting the Router ......................................<a href="#page-7">7</a>
   <a href="#section-3">3</a>. Modifications to RFC-Mandated Behavior ..........................<a href="#page-8">8</a>
      <a href="#section-3.1">3.1</a>. General ....................................................<a href="#page-8">8</a>
      <a href="#section-3.2">3.2</a>. Modifications to <a href="./rfc2461">RFC 2461</a> Neighbor Discovery ...............<a href="#page-8">8</a>
      3.3. Modifications to <a href="./rfc2462">RFC 2462</a> Stateless Address
           Autoconfiguration ..........................................<a href="#page-9">9</a>
   <a href="#section-4">4</a>. Protocol Operation .............................................<a href="#page-10">10</a>
      <a href="#section-4.1">4.1</a>. Simple Case ...............................................<a href="#page-10">10</a>
      <a href="#section-4.2">4.2</a>. Collision Case ............................................<a href="#page-10">10</a>
      <a href="#section-4.3">4.3</a>. Interoperation Cases ......................................<a href="#page-11">11</a>
      <a href="#section-4.4">4.4</a>. Pathological Cases ........................................<a href="#page-11">11</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>. Probability of Collision ..............................<a href="#page-13">13</a>
      <a href="#appendix-A.1">A.1</a>. The Birthday Paradox ......................................<a href="#page-13">13</a>
      <a href="#appendix-A.2">A.2</a>. Individual Moving Nodes ...................................<a href="#page-14">14</a>
   Normative References ..............................................<a href="#page-15">15</a>
   Informative References ............................................<a href="#page-15">15</a>
   Acknowledgements ..................................................<a href="#page-16">16</a>






















<span class="grey">Moore                       Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Optimistic Duplicate Address Detection (DAD) is a modification of the
   existing IPv6 Neighbor Discovery (ND) [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>] and Stateless Address
   Autoconfiguration (SLAAC) [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>] processes.  The intention is to
   minimize address configuration delays in the successful case, and to
   reduce disruption as far as possible in the failure case.

   Optimistic DAD is a useful optimization because in most cases DAD is
   far more likely to succeed than fail.  This is discussed further in
   <a href="#appendix-A">Appendix A</a>.  Disruption is minimized by limiting nodes' participation
   in Neighbor Discovery while their addresses are still Optimistic.

   It is not the intention of this memo to improve the security,
   reliability, or robustness of DAD beyond that of existing standards,
   but merely to provide a method to make it faster.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Problem%20Statement"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Problem Statement</span>

   The existing IPv6 address configuration mechanisms provide adequate
   collision detection mechanisms for the fixed hosts they were designed
   for.  However, a growing population of nodes need to maintain
   continuous network access despite frequently changing their network
   attachment.  Optimizations to the DAD process are required to provide
   these nodes with sufficiently fast address configuration.

   An optimized DAD method needs to:

   * provide interoperability with nodes using the current standards.

   * remove the RetransTimer delay during address configuration.

   * ensure that the probability of address collision is not increased.

   * improve the resolution mechanisms for address collisions.

   * minimize disruption in the case of a collision.

   It is not sufficient to merely reduce RetransTimer in order to reduce
   the handover delay, as values of RetransTimer long enough to
   guarantee detection of a collision are too long to avoid disruption
   of time-critical services.









<span class="grey">Moore                       Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20Definitions"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Definitions</span>

   Definitions of requirements keywords ('MUST NOT', 'SHOULD NOT',
   'MAY', 'SHOULD', 'MUST') are in accordance with the IETF Best Current
   Practice, <a href="./rfc2119">RFC 2119</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>]

   Address Resolution - Process defined by <a href="./rfc2461#section-7.2">[RFC2461], section 7.2</a>.

   Neighbor Unreachability Detection (NUD) - Process defined by
        <a href="./rfc2461#section-7.3">[RFC2461], section 7.3</a>.

   Standard Node - A Standard Node is one that is compliant with
        [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>] and [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>].

   Optimistic Node (ON) - An Optimistic Node is one that is compliant
        with the rules specified in this memo.

   Link - A communication facility or medium over which nodes can
        communicate at the link layer.

   Neighbors - Nodes on the same link, which may therefore be competing
        for the same IP addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.3.%20%20Address%20Types"></a><a class="selflink" href="#section-1.3" id="section-1.3">1.3</a>.  Address Types</span>

   Tentative address (as per [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>]) - an address whose uniqueness on
        a link is being verified, prior to its assignment to an
        interface.  A Tentative address is not considered assigned to an
        interface in the usual sense.  An interface discards received
        packets addressed to a Tentative address, but accepts Neighbor
        Discovery packets related to Duplicate Address Detection for the
        Tentative address.

   Optimistic address - an address that is assigned to an interface and
        available for use, subject to restrictions, while its uniqueness
        on a link is being verified.  This memo introduces the
        Optimistic state and defines its behaviors and restrictions.

   Preferred address (as per [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>]) - an address assigned to an
        interface whose use by upper-layer protocols is unrestricted.
        Preferred addresses may be used as the source (or destination)
        address of packets sent from (or to) the interface.









<span class="grey">Moore                       Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


   Deprecated address (as per [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>]) - An address assigned to an
        interface whose use is discouraged, but not forbidden.  A
        Deprecated address should no longer be used as a source address
        in new communications, but packets sent from or to Deprecated
        addresses are delivered as expected.  A Deprecated address may
        continue to be used as a source address in communications where
        switching to a Preferred address causes hardship to a specific
        upper-layer activity (e.g., an existing TCP connection).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.4.%20%20Abbreviations"></a><a class="selflink" href="#section-1.4" id="section-1.4">1.4</a>.  Abbreviations</span>

   DAD - Duplicate Address Detection.  Technique used for SLAAC.  See
        <a href="./rfc2462#section-5.4">[RFC2462], section 5.4</a>.

   ICMP Redirect - See <a href="./rfc2461#section-4.5">[RFC2461], section 4.5</a>.

   NA - Neighbor Advertisement.  See [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>], sections <a href="#section-4.4">4.4</a> and <a href="#section-7">7</a>.

   NC - Neighbor Cache.  See [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>], sections <a href="#section-5.1">5.1</a> and <a href="#section-7.3">7.3</a>.

   ND - Neighbor Discovery.  The process described in [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>].

   NS - Neighbor Solicitation.  See [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>], sections <a href="#section-4.3">4.3</a> and <a href="#section-7">7</a>.

   RA - Router Advertisement.  See [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>], sections <a href="#section-4.2">4.2</a> and <a href="#section-6">6</a>.

   RS - Router Solicitation.  See [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>], sections <a href="#section-4.1">4.1</a> and <a href="#section-6">6</a>.

   SLAAC - StateLess Address AutoConfiguration.  The process described
        in [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>].

   SLLAO - Source Link-Layer Address Option - an option to NS, RA, and
        RS messages, which gives the link-layer address of the source of
        the message.  See <a href="./rfc2461#section-4.6.1">[RFC2461], section 4.6.1</a>.

   TLLAO - Target Link-Layer Address Option - an option to ICMP Redirect
        messages and Neighbor Advertisements.  See [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>], sections
        4.4, 4.5, and 4.6.1.













<span class="grey">Moore                       Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Optimistic%20DAD%20Behaviors"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Optimistic DAD Behaviors</span>

   This non-normative section discusses Optimistic DAD behaviors.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20Optimistic%20Addresses"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Optimistic Addresses</span>

   [<a id="ref-RFC2462">RFC2462</a>] introduces the concept of Tentative (in 5.4) and Deprecated
   (in 5.5.4) addresses.  Addresses that are neither are said to be
   Preferred.  Tentative addresses may not be used for communication,
   and Deprecated addresses should not be used for new communications.
   These address states may also be used by other standards documents,
   for example, Default Address Selection [<a href="./rfc3484" title='"Default Address Selection for Internet Protocol version 6 (IPv6)"'>RFC3484</a>].

   This memo introduces a new address state, 'Optimistic', that is used
   to mark an address that is available for use but that has not
   completed DAD.

   Unless noted otherwise, components of the IPv6 protocol stack should
   treat addresses in the Optimistic state equivalently to those in the
   Deprecated state, indicating that the address is available for use
   but should not be used if another suitable address is available.  For
   example, Default Address Selection [<a href="./rfc3484" title='"Default Address Selection for Internet Protocol version 6 (IPv6)"'>RFC3484</a>] uses the address state
   to decide which source address to use for an outgoing packet.
   Implementations should treat an address in state Optimistic as if it
   were in state Deprecated.  If address states are recorded as
   individual flags, this can easily be achieved by also setting
   'Deprecated' when 'Optimistic' is set.

   It is important to note that the address lifetime rules of [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>]
   still apply, and so an address may be Deprecated as well as
   Optimistic.  When DAD completes without incident, the address becomes
   either a Preferred or a Deprecated address, as per [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.%20%20Avoiding%20Disruption"></a><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Avoiding Disruption</span>

   In order to avoid interference, it is important that an Optimistic
   Node does not send any messages from an Optimistic Address that will
   override its neighbors' Neighbor Cache (NC) entries for the address
   it is trying to configure: doing so would disrupt the rightful owner
   of the address in the case of a collision.

   This is achieved by:

   * Clearing the 'Override' flag in Neighbor Advertisements for
        Optimistic Addresses, which prevents neighbors from overriding
        their existing NC entries.  The 'Override' flag is already
        defined [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>] and used for Proxy Neighbor Advertisement.




<span class="grey">Moore                       Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


   * Never sending Neighbor Solicitations from an Optimistic Address.
        NSes include a Source Link-Layer Address Option (SLLAO), which
        may cause Neighbor Cache disruption.  NSes sent as part of DAD
        are sent from the unspecified address, without a SLLAO.

   * Never using an Optimistic Address as the source address of a Router
        Solicitation with a SLLAO.  Another address, or the unspecified
        address, may be used, or the RS may be sent without a SLLAO.

   An address collision with a router may cause a neighboring router's
   IsRouter flags for that address to be cleared.  However, routers do
   not appear to use the IsRouter flag for anything, and the NA sent in
   response to the collision will reassert the IsRouter flag.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.3.%20%20Router%20Redirection"></a><a class="selflink" href="#section-2.3" id="section-2.3">2.3</a>.  Router Redirection</span>

   Neighbor Solicitations cannot be sent from Optimistic Addresses, and
   so an ON cannot directly contact a neighbor that is not already in
   its Neighbor Cache.  Instead, the ON forwards packets via its default
   router, relying on the router to forward the packets to their
   destination.  In accordance with <a href="./rfc2461">RFC 2461</a>, the router should then
   provide the ON with an ICMP Redirect, which may include a Target
   Link-Layer Address Option (TLLAO).  If it does, this will update the
   ON's NC, and direct communication can begin.  If it does not, packets
   continue to be forwarded via the router until the ON has a non-
   Optimistic address from which to send an NS.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.4.%20%20Contacting%20the%20Router"></a><a class="selflink" href="#section-2.4" id="section-2.4">2.4</a>.  Contacting the Router</span>

   Generally, an RA will include a SLLAO, however this "MAY be omitted
   to facilitate in-bound load balancing over replicated interfaces"
   [<a href="./rfc2461" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>].  A node with only Optimistic Addresses is unable to
   determine the router's Link-Layer Address as it can neither send an
   RS to request a unicast RA, nor send an NS to request an NA.  In this
   case, the ON will be unable to communicate with the router until at
   least one of its addresses is no longer Optimistic.















<span class="grey">Moore                       Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Modifications%20to%20RFC-Mandated%20Behavior"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Modifications to RFC-Mandated Behavior</span>

   All normative text in this memo is contained in this section.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20General"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  General</span>

   * Optimistic DAD SHOULD only be used when the implementation is aware
        that the address is based on a most likely unique interface
        identifier (such as in [<a href="./rfc2464" title='"Transmission of IPv6 Packets over Ethernet Networks"'>RFC2464</a>]), generated randomly [<a href="./rfc3041" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC3041</a>],
        or by a well-distributed hash function [<a href="./rfc3972" title='"Cryptographically Generated Addresses (CGA)"'>RFC3972</a>] or assigned by
        Dynamic Host Configuration Protocol for IPv6 (DHCPv6) [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>].
        Optimistic DAD SHOULD NOT be used for manually entered
        addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20Modifications%20to%20RFC%202461%20Neighbor%20Discovery"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Modifications to <a href="./rfc2461">RFC 2461</a> Neighbor Discovery</span>

   * (modifies <a href="#section-6.3.7">section 6.3.7</a>)  A node MUST NOT send a Router
        Solicitation with a SLLAO from an Optimistic Address.  Router
        Solicitations SHOULD be sent from a non-Optimistic or the
        Unspecified Address; however, they MAY be sent from an
        Optimistic Address as long as the SLLAO is not included.

   * (modifies <a href="#section-7.2.2">section 7.2.2</a>)  A node MUST NOT use an Optimistic Address
        as the source address of a Neighbor Solicitation.

   * If the ON isn't told the SLLAO of the router in an RA, and it
        cannot determine this information without breaching the rules
        above, it MUST leave the address Tentative until DAD completes
        despite being unable to send any packets to the router.

   * (modifies <a href="#section-7.2.2">section 7.2.2</a>)  When a node has a unicast packet to send
        from an Optimistic Address to a neighbor, but does not know the
        neighbor's link-layer address, it MUST NOT perform Address
        Resolution.  It SHOULD forward the packet to a default router on
        the link in the hope that the packet will be redirected.
        Otherwise, it SHOULD buffer the packet until DAD is complete.















<span class="grey">Moore                       Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.3%20Modifications%20to%20RFC%202462%20Stateless%20Address%20Autoconfiguration"></a><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a> Modifications to <a href="./rfc2462">RFC 2462</a> Stateless Address Autoconfiguration</span>

   * (modifies <a href="#section-5.5">section 5.5</a>) A host MAY choose to configure a new address
        as an Optimistic Address.  A host that does not know the SLLAO
        of its router SHOULD NOT configure a new address as Optimistic.
        A router SHOULD NOT configure an Optimistic Address.

   * (modifies <a href="#section-5.4.2">section 5.4.2</a>) The host MUST join the all-nodes multicast
        address and the solicited-node multicast address of the
        Tentative address.  The host SHOULD NOT delay before sending
        Neighbor Solicitation messages.

   * (modifies <a href="#section-5.4">section 5.4</a>) The Optimistic Address is configured and
        available for use on the interface immediately.  The address
        MUST be flagged as 'Optimistic'.

   * When DAD completes for an Optimistic Address, the address is no
        longer Optimistic and it becomes Preferred or Deprecated
        according to the rules of <a href="./rfc2462">RFC 2462</a>.

   * (modifies <a href="#section-5.4.3">section 5.4.3</a>) The node MUST NOT reply to a Neighbor
        Solicitation for an Optimistic Address from the unspecified
        address.  Receipt of such an NS indicates that the address is a
        duplicate, and it MUST be deconfigured as per the behaviour
        specified in <a href="./rfc2462">RFC 2462</a> for Tentative addresses.

   * (modifies <a href="#section-5.4.3">section 5.4.3</a>) The node MUST reply to a Neighbor
        Solicitation for an Optimistic Address from a unicast address,
        but the reply MUST have the Override flag cleared (O=0).






















<span class="grey">Moore                       Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Protocol%20Operation"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Protocol Operation</span>

   This non-normative section provides clarification of the interactions
   between Optimistic Nodes, and between Optimistic Nodes and Standard
   Nodes.

   The following cases all consider an Optimistic Node (ON) receiving a
   Router Advertisement containing a new prefix and deciding to
   autoconfigure a new Optimistic Address on that prefix.

   The ON will immediately send out a Neighbor Solicitation to determine
   if its new Optimistic Address is already in use.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Simple%20Case"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Simple Case</span>

   In the non-collision case, the Optimistic Address being configured by
   the new node is unused and not present in the Neighbor Caches of any
   of its neighbors.

   There will be no response to its NS (sent from ::), and this NS will
   not modify the state of neighbors' Neighbor Caches.

   The ON already has the link-layer address of the router (from the
   RA), and the router can determine the link-layer address of the ON
   through standard Address Resolution.  Communications can begin as
   soon as the router and the ON have each other's link-layer addresses.

   After the appropriate DAD delay has completed, the address is no
   longer Optimistic, and becomes either Preferred or Deprecated as per
   <a href="./rfc2462">RFC 2462</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Collision%20Case"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Collision Case</span>

   In the collision case, the Optimistic Address being configured by the
   new node is already in use by another node, and present in the
   Neighbor Caches (NCs) of neighbors that are communicating with this
   node.

   The NS sent by the ON has the unspecified source address, ::, and no
   SLLAO.  This NS will not cause changes to the NC entries of
   neighboring hosts.

   The ON will hopefully already know all it needs to about the router
   from the initial RA.  However, if it needs to it can still send an RS
   to ask for more information, but it may not include a SLLAO.  This
   forces an all-nodes multicast response from the router, but will not
   disrupt other nodes' NCs.




<span class="grey">Moore                       Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


   In the course of establishing connections, the ON might have sent NAs
   in response to received NSes.  Since NAs sent from Optimistic
   Addresses have O=0, they will not have overridden existing NC
   entries, although they may have resulted in a colliding entry being
   changed to state STALE.  This change is recoverable through standard
   NUD.

   When an NA is received from the collidee defending the address, the
   ON immediately stops using the address and deconfigures it.

   Of course, in the meantime the ON may have sent packets that identify
   it as the owner of its new Optimistic Address (for example, Binding
   Updates in Mobile IPv6 [<a href="./rfc3775" title='"Mobility Support in IPv6"'>RFC3775</a>]).  This may incur some penalty to
   the ON, in the form of broken connections, and some penalty to the
   rightful owner of the address, since it will receive (and potentially
   reply to) the misdirected packets.  It is for this reason that
   Optimistic DAD should be used only where the probability of collision
   is very low.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20Interoperation%20Cases"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  Interoperation Cases</span>

   Once the Optimistic Address has completed DAD, it acts exactly like a
   normal address, and so interoperation cases only arise while the
   address is Optimistic.

   If an ON attempts to configure an address currently Tentatively
   assigned to a Standard Node, the Standard Node will see the Neighbor
   Solicitation and deconfigure the address.

   If a node attempts to configure an ON's Optimistic Address, the ON
   will see the NS and deconfigure the address.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.4.%20%20Pathological%20Cases"></a><a class="selflink" href="#section-4.4" id="section-4.4">4.4</a>.  Pathological Cases</span>

   Optimistic DAD suffers from similar problems to Standard DAD; for
   example, duplicates are not guaranteed to be detected if packets are
   lost.

   These problems exist, and are not gracefully recoverable, in Standard
   DAD.  Their probability in both Optimistic and Standard DAD can be
   reduced by increasing the <a href="./rfc2462">RFC 2462</a> DupAddrDetectTransmits variable to
   greater than 1.

   This version of Optimistic DAD is dependent on the details of the
   router behavior, e.g., that the router includes SLLAOs in RAs and
   that the router is willing to redirect traffic for the ON.  Where the
   router does not behave in this way, the behavior of Optimistic DAD
   inherently reverts to that of Standard DAD.



<span class="grey">Moore                       Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Security Considerations</span>

   There are existing security concerns with Neighbor Discovery and
   Stateless Address Autoconfiguration, and this memo does not purport
   to fix them.  However, this memo does not significantly increase
   security concerns either.

   Secure Neighbor Discovery (SEND) [<a href="./rfc3971" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>] provides protection
   against the threats to Neighbor Discovery described in [<a href="./rfc3756" title='"IPv6 Neighbor Discovery (ND) Trust Models and Threats"'>RFC3756</a>].
   Optimistic Duplicate Address Detection does not introduce any
   additional threats to Neighbor Discovery if SEND is used.

   Optimistic DAD takes steps to ensure that if another node is already
   using an address, the proper link-layer address in existing Neighbor
   Cache entries is not replaced with the link-layer address of the
   Optimistic Node.  However, there are still scenarios where incorrect
   entries may be created, if only temporarily.  For example, if a
   router (while forwarding a packet) sends out a Neighbor Solicitation
   for an address, the Optimistic Node may respond first, and if the
   router has no pre-existing link-layer address for that IP address, it
   will accept the response and (incorrectly) forward any queued packets
   to the Optimistic Node.  The Optimistic Node may then respond in an
   incorrect manner (e.g., sending a TCP RST in response to an unknown
   TCP connection).  Such transient conditions should be short-lived, in
   most cases.

   Likewise, an Optimistic Node can still inject IP packets into the
   Internet that will in effect be "spoofed" packets appearing to come
   from the legitimate node.  In some cases, those packets may lead to
   errors or other operational problems, though one would expect that
   upper-layer protocols would generally treat such packets robustly, in
   the same way they must treat old and other duplicate packets.



















<span class="grey">Moore                       Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Probability%20of%20Collision"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Probability of Collision</span>

   In assessing the usefulness of Duplicate Address Detection, the
   probability of collision must be considered.  Various mechanisms such
   as SLAAC [<a href="./rfc2462" title='"IPv6 Stateless Address Autoconfiguration"'>RFC2462</a>] and DHCPv6 [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] attempt to guarantee the
   uniqueness of the address.  The uniqueness of SLAAC depends on the
   reliability of the manufacturing process (so that duplicate L2
   addresses are not assigned) and human factors if L2 addresses can be
   manually assigned.  The uniqueness of DHCPv6-assigned addresses
   relies on the correctness of implementation to ensure that no two
   nodes can be given the same address.

   "Privacy Extensions to SLAAC" [<a href="./rfc3041" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC3041</a>] avoids these potential error
   cases by picking an Interface Identifier (IID) at random from 2^62
   possible 64-bit IIDs (allowing for the reserved U and G bits).  No
   attempt is made to guarantee uniqueness, but the probability can be
   easily estimated, and as the following discussion shows, probability
   of collision is exceedingly small.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.1.%20%20The%20Birthday%20Paradox"></a><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  The Birthday Paradox</span>

   When considering collision probability, the Birthday Paradox is
   generally mentioned.  When randomly selecting k values from n
   possibilities, the probability of two values being the same is:

           Pb(n,k) = 1-( n! / [ (n-k)! . n^k] )

   Calculating the probability of collision with this method is
   difficult, however, as one of the terms is n!, and (2^62)! is an
   unwieldy number.  We can, however, calculate an upper bound for the
   probability of collision:

           Pb(n,k) &lt;= 1-( [(n-k+1)/n] ^ [k-1] )

   which lets us calculate that even for large networks the probability
   of any two nodes colliding is very small indeed:

           Pb(2^62,    500) &lt;= 5.4e-14
           Pb(2^62,   5000) &lt;= 5.4e-12
           Pb(2^62,  50000) &lt;= 5.4e-10
           Pb(2^62, 500000) &lt;= 5.4e-08

   The upper-bound formula used above was taken from "Random Generation
   of Interface Identifiers", by M. Bagnulo, I. Soto, A. Garcia-
   Martinez, and A. Azcorra, and is used with the kind permission of the
   authors.





<span class="grey">Moore                       Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.%20%20Individual%20Nodes"></a><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  Individual Nodes</span>

   When considering the effect of collisions on an individual node, we
   do not need to consider the Birthday Paradox.  When a node moves into
   a network with K existing nodes, the probability that it will not
   collide with any of the distinct addresses in use is simply 1-K/N.
   If it moves to such networks M times, the probability that it will
   not cause a collision on any of those moves is (1-K/N)^M; thus, the
   probability of it causing at least one collision is:

           Pc(n,k,m) = 1-[(1-k/n)^m]

   Even considering a very large number of moves (m = 600000, slightly
   more than one move per minute for one year) and rather crowded
   networks (k=50000 nodes per network), the odds of collision for a
   given node are vanishingly small:

           Pc(2^62,  5000,   600000)     = 6.66e-10
           Pc(2^62, 50000,   600000)     = 6.53e-09

   Each such collision affects two nodes, so the probability of being
   affected by a collision is twice this.  Even if the node moves into
   networks of 50000 nodes once per minute for 100 years, the
   probability of it causing or suffering a collision at any point are a
   little over 1 in a million.

           Pc(2^62, 50000, 60000000) * 2 = 1.3e-06
























<span class="grey">Moore                       Standards Track                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


Normative References

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2461">RFC2461</a>]  Narten, T., Nordmark, E., and W. Simpson, "Neighbor
              Discovery for IP Version 6 (IPv6)", <a href="./rfc2461">RFC 2461</a>, December
              1998.

   [<a id="ref-RFC2462">RFC2462</a>]  Thomson, S. and T. Narten, "IPv6 Stateless Address
              Autoconfiguration", <a href="./rfc2462">RFC 2462</a>, December 1998.

Informative References

   [<a id="ref-RFC2464">RFC2464</a>]  Crawford, M., "Transmission of IPv6 Packets over Ethernet
              Networks", <a href="./rfc2464">RFC 2464</a>, December 1998.

   [<a id="ref-RFC3041">RFC3041</a>]  Narten, T. and R. Draves, "Privacy Extensions for
              Stateless Address Autoconfiguration in IPv6", <a href="./rfc3041">RFC 3041</a>,
              January 2001.

   [<a id="ref-RFC3315">RFC3315</a>]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", <a href="./rfc3315">RFC 3315</a>, July 2003.

   [<a id="ref-RFC3484">RFC3484</a>]  Draves, R., "Default Address Selection for Internet
              Protocol version 6 (IPv6)", <a href="./rfc3484">RFC 3484</a>, February 2003.

   [<a id="ref-RFC3756">RFC3756</a>]  Nikander, P., Kempf, J., and E. Nordmark, "IPv6 Neighbor
              Discovery (ND) Trust Models and Threats", <a href="./rfc3756">RFC 3756</a>, May
              2004.

   [<a id="ref-RFC3775">RFC3775</a>]  Johnson, D., Perkins, C., and J. Arkko, "Mobility Support
              in IPv6", <a href="./rfc3775">RFC 3775</a>, June 2004.

   [<a id="ref-RFC3971">RFC3971</a>]  Arkko, J., Ed., Kempf, J., Zill, B., and P. Nikander,
              "SEcure Neighbor Discovery (SEND)", <a href="./rfc3971">RFC 3971</a>, March 2005.

   [<a id="ref-RFC3972">RFC3972</a>]  Aura, T., "Cryptographically Generated Addresses (CGA)",
              <a href="./rfc3972">RFC 3972</a>, March 2005.











<span class="grey">Moore                       Standards Track                    [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


Acknowledgements

   There is some precedent for this work in expired Internet-Drafts and
   in discussions in the MobileIP WG mailing list and at IETF-54.  A
   similar concept occurs in the 'Optimistic' bit used by R. Koodli and
   C. Perkins in the now expired, "Fast Handovers in Mobile IPv6".

   Thanks to Greg Daley, Richard Nelson, Brett Pentland and Ahmet
   Sekercioglu at Monash University CTIE for their feedback and
   encouragement.  More information is available at:

         &lt;<a href="http://www.ctie.monash.edu.au/ipv6/fastho/">http://www.ctie.monash.edu.au/ipv6/fastho/</a>&gt;

   Thanks to all the MobileIP and IPng/IPv6 WG members who have
   contributed to the debate, especially and alphabetically: Jari Arkko,
   Marcelo Bagnulo, JinHyeock Choi, Youn-Hee Han, James Kempf, Thomas
   Narten, Pekka Nikander, Erik Nordmark, Soohong 'Daniel' Park, Mohan
   Parthasarathy, Ed Remmel, Pekka Savola, Hesham Soliman, Ignatious
   Souvatzis, Jinmei Tatuya, Dave Thaler, Pascal Thubert, Christian
   Vogt, Vladislav Yasevich, and Alper Yegin.

   This work has been supported by the Australian Telecommunications
   Cooperative Research Centre (ATcrc):

         &lt;<a href="http://www.telecommunications.crc.org.au/">http://www.telecommunications.crc.org.au/</a>&gt;

Author's Address

   Nick 'Sharkey' Moore
   Centre for Telecommunications and Information Engineering
   Monash University 3800
   Victoria, Australia

   Comments should be sent to &lt;sharkey@zoic.org&gt; and/or the IPv6 Working
   Group mailing list.  Please include '<a href="./rfc4429">RFC4429</a>' in the Subject line.
















<span class="grey">Moore                       Standards Track                    [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc4429">RFC 4429</a>                     Optimistic DAD                   April 2006</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2006).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and <a href="https://www.rfc-editor.org/bcp/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).







Moore                       Standards Track                    [Page 17]
</pre>
</body></html>