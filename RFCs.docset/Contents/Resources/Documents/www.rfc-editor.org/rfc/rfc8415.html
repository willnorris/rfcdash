<html><head></head><body><pre>Internet Engineering Task Force (IETF)                      T. Mrugalski
Request for Comments: 8415                                  M. Siodelski
Obsoletes: <a href="./rfc3315">3315</a>, <a href="./rfc3633">3633</a>, <a href="./rfc3736">3736</a>, <a href="./rfc4242">4242</a>, <a href="./rfc7083">7083</a>,                             ISC
           <a href="./rfc7283">7283</a>, <a href="./rfc7550">7550</a>                                            B. Volz
Category: Standards Track                                 A. Yourtchenko
ISSN: 2070-1721                                                    Cisco
                                                           M. Richardson
                                                                     SSW
                                                                S. Jiang
                                                                  Huawei
                                                                T. Lemon
                                                     Nibbhaya Consulting
                                                              T. Winters
                                                                 UNH-IOL
                                                           November 2018


         <span class="h1">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</span>

Abstract

   This document describes the Dynamic Host Configuration Protocol for
   IPv6 (DHCPv6): an extensible mechanism for configuring nodes with
   network configuration parameters, IP addresses, and prefixes.
   Parameters can be provided statelessly, or in combination with
   stateful assignment of one or more IPv6 addresses and/or IPv6
   prefixes.  DHCPv6 can operate either in place of or in addition to
   stateless address autoconfiguration (SLAAC).

   This document updates the text from <a href="./rfc3315">RFC 3315</a> (the original DHCPv6
   specification) and incorporates prefix delegation (<a href="./rfc3633">RFC 3633</a>),
   stateless DHCPv6 (<a href="./rfc3736">RFC 3736</a>), an option to specify an upper bound for
   how long a client should wait before refreshing information (<a href="./rfc4242">RFC</a>
   <a href="./rfc4242">4242</a>), a mechanism for throttling DHCPv6 clients when DHCPv6 service
   is not available (<a href="./rfc7083">RFC 7083</a>), and relay agent handling of unknown
   messages (<a href="./rfc7283">RFC 7283</a>).  In addition, this document clarifies the
   interactions between models of operation (<a href="./rfc7550">RFC 7550</a>).  As such, this
   document obsoletes <a href="./rfc3315">RFC 3315</a>, <a href="./rfc3633">RFC 3633</a>, <a href="./rfc3736">RFC 3736</a>, <a href="./rfc4242">RFC 4242</a>, <a href="./rfc7083">RFC 7083</a>,
   <a href="./rfc7283">RFC 7283</a>, and <a href="./rfc7550">RFC 7550</a>.












<span class="grey">Mrugalski, et al.            Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc7841#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8415">https://www.rfc-editor.org/info/rfc8415</a>.

Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.











<span class="grey">Mrugalski, et al.            Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-6">6</a>
      <a href="#section-1.1">1.1</a>. Relationship to Previous DHCPv6 Standards ..................<a href="#page-7">7</a>
      <a href="#section-1.2">1.2</a>. Relationship to DHCPv4 .....................................<a href="#page-8">8</a>
   <a href="#section-2">2</a>. Requirements ....................................................<a href="#page-8">8</a>
   <a href="#section-3">3</a>. Background ......................................................<a href="#page-8">8</a>
   <a href="#section-4">4</a>. Terminology .....................................................<a href="#page-9">9</a>
      <a href="#section-4.1">4.1</a>. IPv6 Terminology ...........................................<a href="#page-9">9</a>
      <a href="#section-4.2">4.2</a>. DHCP Terminology ..........................................<a href="#page-11">11</a>
   <a href="#section-5">5</a>. Client/Server Exchanges ........................................<a href="#page-16">16</a>
      <a href="#section-5.1">5.1</a>. Client/Server Exchanges Involving Two Messages ............<a href="#page-16">16</a>
      <a href="#section-5.2">5.2</a>. Client/Server Exchanges Involving Four Messages ...........<a href="#page-17">17</a>
      <a href="#section-5.3">5.3</a>. Server/Client Exchanges ...................................<a href="#page-18">18</a>
   <a href="#section-6">6</a>. Operational Models .............................................<a href="#page-18">18</a>
      <a href="#section-6.1">6.1</a>. Stateless DHCP ............................................<a href="#page-18">18</a>
      <a href="#section-6.2">6.2</a>. DHCP for Non-temporary Address Assignment .................<a href="#page-19">19</a>
      <a href="#section-6.3">6.3</a>. DHCP for Prefix Delegation ................................<a href="#page-19">19</a>
      <a href="#section-6.4">6.4</a>. DHCP for Customer Edge Routers ............................<a href="#page-22">22</a>
      <a href="#section-6.5">6.5</a>. DHCP for Temporary Addresses ..............................<a href="#page-22">22</a>
      <a href="#section-6.6">6.6</a>. Multiple Addresses and Prefixes ...........................<a href="#page-22">22</a>
   <a href="#section-7">7</a>. DHCP Constants .................................................<a href="#page-23">23</a>
      <a href="#section-7.1">7.1</a>. Multicast Addresses .......................................<a href="#page-23">23</a>
      <a href="#section-7.2">7.2</a>. UDP Ports .................................................<a href="#page-24">24</a>
      <a href="#section-7.3">7.3</a>. DHCP Message Types ........................................<a href="#page-24">24</a>
      <a href="#section-7.4">7.4</a>. DHCP Option Codes .........................................<a href="#page-26">26</a>
      <a href="#section-7.5">7.5</a>. Status Codes ..............................................<a href="#page-26">26</a>
      <a href="#section-7.6">7.6</a>. Transmission and Retransmission Parameters ................<a href="#page-27">27</a>
      7.7. Representation of Time Values and "Infinity" as a
           Time Value ................................................<a href="#page-28">28</a>
   <a href="#section-8">8</a>. Client/Server Message Formats ..................................<a href="#page-29">29</a>
   <a href="#section-9">9</a>. Relay Agent/Server Message Formats .............................<a href="#page-30">30</a>
      <a href="#section-9.1">9.1</a>. Relay-forward Message .....................................<a href="#page-31">31</a>
      <a href="#section-9.2">9.2</a>. Relay-reply Message .......................................<a href="#page-31">31</a>
   <a href="#section-10">10</a>. Representation and Use of Domain Names ........................<a href="#page-32">32</a>
   <a href="#section-11">11</a>. DHCP Unique Identifier (DUID) .................................<a href="#page-32">32</a>
      <a href="#section-11.1">11.1</a>. DUID Contents ............................................<a href="#page-33">33</a>
      <a href="#section-11.2">11.2</a>. DUID Based on Link-Layer Address Plus Time (DUID-LLT) ....<a href="#page-33">33</a>
      11.3. DUID Assigned by Vendor Based on Enterprise
            Number (DUID-EN) .........................................<a href="#page-35">35</a>
      <a href="#section-11.4">11.4</a>. DUID Based on Link-Layer Address (DUID-LL) ...............<a href="#page-36">36</a>
      <a href="#section-11.5">11.5</a>. DUID Based on Universally Unique Identifier (DUID-UUID) ..37
   <a href="#section-12">12</a>. Identity Association ..........................................<a href="#page-37">37</a>
      <a href="#section-12.1">12.1</a>. Identity Associations for Address Assignment .............<a href="#page-38">38</a>
      <a href="#section-12.2">12.2</a>. Identity Associations for Prefix Delegation ..............<a href="#page-38">38</a>






<span class="grey">Mrugalski, et al.            Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   <a href="#section-13">13</a>. Assignment to an IA ...........................................<a href="#page-39">39</a>
      <a href="#section-13.1">13.1</a>. Selecting Addresses for Assignment to an IA_NA ...........<a href="#page-39">39</a>
      <a href="#section-13.2">13.2</a>. Assignment of Temporary Addresses ........................<a href="#page-40">40</a>
      <a href="#section-13.3">13.3</a>. Assignment of Prefixes for IA_PD .........................<a href="#page-41">41</a>
   <a href="#section-14">14</a>. Transmission of Messages by a Client ..........................<a href="#page-41">41</a>
      <a href="#section-14.1">14.1</a>. Rate Limiting ............................................<a href="#page-41">41</a>
      <a href="#section-14.2">14.2</a>. Client Behavior when T1 and/or T2 Are 0 ..................<a href="#page-42">42</a>
   <a href="#section-15">15</a>. Reliability of Client-Initiated Message Exchanges .............<a href="#page-43">43</a>
   <a href="#section-16">16</a>. Message Validation ............................................<a href="#page-45">45</a>
      <a href="#section-16.1">16.1</a>. Use of Transaction IDs ...................................<a href="#page-45">45</a>
      <a href="#section-16.2">16.2</a>. Solicit Message ..........................................<a href="#page-46">46</a>
      <a href="#section-16.3">16.3</a>. Advertise Message ........................................<a href="#page-46">46</a>
      <a href="#section-16.4">16.4</a>. Request Message ..........................................<a href="#page-46">46</a>
      <a href="#section-16.5">16.5</a>. Confirm Message ..........................................<a href="#page-47">47</a>
      <a href="#section-16.6">16.6</a>. Renew Message ............................................<a href="#page-47">47</a>
      <a href="#section-16.7">16.7</a>. Rebind Message ...........................................<a href="#page-47">47</a>
      <a href="#section-16.8">16.8</a>. Decline Message ..........................................<a href="#page-47">47</a>
      <a href="#section-16.9">16.9</a>. Release Message ..........................................<a href="#page-48">48</a>
      <a href="#section-16.10">16.10</a>. Reply Message ...........................................<a href="#page-48">48</a>
      <a href="#section-16.11">16.11</a>. Reconfigure Message .....................................<a href="#page-48">48</a>
      <a href="#section-16.12">16.12</a>. Information-request Message .............................<a href="#page-49">49</a>
      <a href="#section-16.13">16.13</a>. Relay-forward Message ...................................<a href="#page-49">49</a>
      <a href="#section-16.14">16.14</a>. Relay-reply Message .....................................<a href="#page-49">49</a>
   <a href="#section-17">17</a>. Client Source Address and Interface Selection .................<a href="#page-49">49</a>
      17.1. Source Address and Interface Selection for
            Address Assignment .......................................<a href="#page-49">49</a>
      17.2. Source Address and Interface Selection for Prefix
            Delegation ...............................................<a href="#page-50">50</a>
   <a href="#section-18">18</a>. DHCP Configuration Exchanges ..................................<a href="#page-50">50</a>
      <a href="#section-18.1">18.1</a>. A Single Exchange for Multiple IA Options ................<a href="#page-53">53</a>
      <a href="#section-18.2">18.2</a>. Client Behavior ..........................................<a href="#page-53">53</a>
           <a href="#section-18.2.1">18.2.1</a>. Creation and Transmission of Solicit Messages .....<a href="#page-55">55</a>
           <a href="#section-18.2.2">18.2.2</a>. Creation and Transmission of Request Messages .....<a href="#page-57">57</a>
           <a href="#section-18.2.3">18.2.3</a>. Creation and Transmission of Confirm Messages .....<a href="#page-59">59</a>
           <a href="#section-18.2.4">18.2.4</a>. Creation and Transmission of Renew Messages .......<a href="#page-60">60</a>
           <a href="#section-18.2.5">18.2.5</a>. Creation and Transmission of Rebind Messages ......<a href="#page-62">62</a>
           18.2.6. Creation and Transmission of
                   Information-request Messages ......................<a href="#page-63">63</a>
           <a href="#section-18.2.7">18.2.7</a>. Creation and Transmission of Release Messages .....<a href="#page-64">64</a>
           <a href="#section-18.2.8">18.2.8</a>. Creation and Transmission of Decline Messages .....<a href="#page-65">65</a>
           <a href="#section-18.2.9">18.2.9</a>. Receipt of Advertise Messages .....................<a href="#page-67">67</a>
           <a href="#section-18.2.10">18.2.10</a>. Receipt of Reply Messages ........................<a href="#page-68">68</a>
                  18.2.10.1. Reply for Solicit (with Rapid
                             Commit), Request, Renew, or Rebind ......<a href="#page-69">69</a>
                  <a href="#section-18.2.10.2">18.2.10.2</a>. Reply for Release and Decline ...........<a href="#page-72">72</a>
                  <a href="#section-18.2.10.3">18.2.10.3</a>. Reply for Confirm .......................<a href="#page-72">72</a>
                  <a href="#section-18.2.10.4">18.2.10.4</a>. Reply for Information-request ...........<a href="#page-72">72</a>




<span class="grey">Mrugalski, et al.            Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


           <a href="#section-18.2.11">18.2.11</a>. Receipt of Reconfigure Messages ..................<a href="#page-72">72</a>
           <a href="#section-18.2.12">18.2.12</a>. Refreshing Configuration Information .............<a href="#page-73">73</a>
      <a href="#section-18.3">18.3</a>. Server Behavior ..........................................<a href="#page-74">74</a>
           <a href="#section-18.3.1">18.3.1</a>. Receipt of Solicit Messages .......................<a href="#page-75">75</a>
           <a href="#section-18.3.2">18.3.2</a>. Receipt of Request Messages .......................<a href="#page-77">77</a>
           <a href="#section-18.3.3">18.3.3</a>. Receipt of Confirm Messages .......................<a href="#page-79">79</a>
           <a href="#section-18.3.4">18.3.4</a>. Receipt of Renew Messages .........................<a href="#page-79">79</a>
           <a href="#section-18.3.5">18.3.5</a>. Receipt of Rebind Messages ........................<a href="#page-81">81</a>
           <a href="#section-18.3.6">18.3.6</a>. Receipt of Information-request Messages ...........<a href="#page-83">83</a>
           <a href="#section-18.3.7">18.3.7</a>. Receipt of Release Messages .......................<a href="#page-84">84</a>
           <a href="#section-18.3.8">18.3.8</a>. Receipt of Decline Messages .......................<a href="#page-85">85</a>
           <a href="#section-18.3.9">18.3.9</a>. Creation of Advertise Messages ....................<a href="#page-85">85</a>
           <a href="#section-18.3.10">18.3.10</a>. Transmission of Advertise and Reply Messages .....<a href="#page-87">87</a>
           18.3.11. Creation and Transmission of Reconfigure
                    Messages .........................................<a href="#page-87">87</a>
      <a href="#section-18.4">18.4</a>. Reception of Unicast Messages ............................<a href="#page-88">88</a>
   <a href="#section-19">19</a>. Relay Agent Behavior ..........................................<a href="#page-89">89</a>
      <a href="#section-19.1">19.1</a>. Relaying a Client Message or a Relay-forward Message .....<a href="#page-89">89</a>
           <a href="#section-19.1.1">19.1.1</a>. Relaying a Message from a Client ..................<a href="#page-90">90</a>
           <a href="#section-19.1.2">19.1.2</a>. Relaying a Message from a Relay Agent .............<a href="#page-90">90</a>
           <a href="#section-19.1.3">19.1.3</a>. Relay Agent Behavior with Prefix Delegation .......<a href="#page-91">91</a>
      <a href="#section-19.2">19.2</a>. Relaying a Relay-reply Message ...........................<a href="#page-91">91</a>
      <a href="#section-19.3">19.3</a>. Construction of Relay-reply Messages .....................<a href="#page-91">91</a>
      <a href="#section-19.4">19.4</a>. Interaction between Relay Agents and Servers .............<a href="#page-92">92</a>
   <a href="#section-20">20</a>. Authentication of DHCP Messages ...............................<a href="#page-93">93</a>
      20.1. Security of Messages Sent between Servers and
            Relay Agents .............................................<a href="#page-94">94</a>
      <a href="#section-20.2">20.2</a>. Summary of DHCP Authentication ...........................<a href="#page-94">94</a>
      <a href="#section-20.3">20.3</a>. Replay Detection .........................................<a href="#page-94">94</a>
      <a href="#section-20.4">20.4</a>. Reconfiguration Key Authentication Protocol (RKAP) .......<a href="#page-95">95</a>
           <a href="#section-20.4.1">20.4.1</a>. Use of the Authentication Option in RKAP ..........<a href="#page-96">96</a>
           <a href="#section-20.4.2">20.4.2</a>. Server Considerations for RKAP ....................<a href="#page-96">96</a>
           <a href="#section-20.4.3">20.4.3</a>. Client Considerations for RKAP ....................<a href="#page-97">97</a>
   <a href="#section-21">21</a>. DHCP Options ..................................................<a href="#page-97">97</a>
      <a href="#section-21.1">21.1</a>. Format of DHCP Options ...................................<a href="#page-98">98</a>
      <a href="#section-21.2">21.2</a>. Client Identifier Option .................................<a href="#page-99">99</a>
      <a href="#section-21.3">21.3</a>. Server Identifier Option .................................<a href="#page-99">99</a>
      21.4. Identity Association for Non-temporary Addresses
            Option ..................................................<a href="#page-100">100</a>
      <a href="#section-21.5">21.5</a>. Identity Association for Temporary Addresses Option .....<a href="#page-102">102</a>
      <a href="#section-21.6">21.6</a>. IA Address Option .......................................<a href="#page-104">104</a>
      <a href="#section-21.7">21.7</a>. Option Request Option ...................................<a href="#page-106">106</a>
      <a href="#section-21.8">21.8</a>. Preference Option .......................................<a href="#page-108">108</a>
      <a href="#section-21.9">21.9</a>. Elapsed Time Option .....................................<a href="#page-108">108</a>
      <a href="#section-21.10">21.10</a>. Relay Message Option ...................................<a href="#page-109">109</a>
      <a href="#section-21.11">21.11</a>. Authentication Option ..................................<a href="#page-110">110</a>
      <a href="#section-21.12">21.12</a>. Server Unicast Option ..................................<a href="#page-111">111</a>
      <a href="#section-21.13">21.13</a>. Status Code Option .....................................<a href="#page-112">112</a>



<span class="grey">Mrugalski, et al.            Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      <a href="#section-21.14">21.14</a>. Rapid Commit Option ....................................<a href="#page-114">114</a>
      <a href="#section-21.15">21.15</a>. User Class Option ......................................<a href="#page-115">115</a>
      <a href="#section-21.16">21.16</a>. Vendor Class Option ....................................<a href="#page-116">116</a>
      <a href="#section-21.17">21.17</a>. Vendor-specific Information Option .....................<a href="#page-117">117</a>
      <a href="#section-21.18">21.18</a>. Interface-Id Option ....................................<a href="#page-119">119</a>
      <a href="#section-21.19">21.19</a>. Reconfigure Message Option .............................<a href="#page-121">121</a>
      <a href="#section-21.20">21.20</a>. Reconfigure Accept Option ..............................<a href="#page-121">121</a>
      <a href="#section-21.21">21.21</a>. Identity Association for Prefix Delegation Option ......<a href="#page-122">122</a>
      <a href="#section-21.22">21.22</a>. IA Prefix Option .......................................<a href="#page-124">124</a>
      <a href="#section-21.23">21.23</a>. Information Refresh Time Option ........................<a href="#page-126">126</a>
      <a href="#section-21.24">21.24</a>. SOL_MAX_RT Option ......................................<a href="#page-127">127</a>
      <a href="#section-21.25">21.25</a>. INF_MAX_RT Option ......................................<a href="#page-128">128</a>
   <a href="#section-22">22</a>. Security Considerations ......................................<a href="#page-130">130</a>
   <a href="#section-23">23</a>. Privacy Considerations .......................................<a href="#page-133">133</a>
   <a href="#section-24">24</a>. IANA Considerations ..........................................<a href="#page-133">133</a>
   <a href="#section-25">25</a>. Obsoleted Mechanisms .........................................<a href="#page-138">138</a>
   <a href="#section-26">26</a>. References ...................................................<a href="#page-139">139</a>
      <a href="#section-26.1">26.1</a>. Normative References ....................................<a href="#page-139">139</a>
      <a href="#section-26.2">26.2</a>. Informative References ..................................<a href="#page-140">140</a>
   <a href="#appendix-A">Appendix A</a>. Summary of Changes ...................................<a href="#page-146">146</a>
   <a href="#appendix-B">Appendix B</a>. Appearance of Options in Message Types ...............<a href="#page-149">149</a>
   <a href="#appendix-C">Appendix C</a>. Appearance of Options in the "options" Field of DHCP
               Options ..............................................<a href="#page-151">151</a>
   Acknowledgments ..................................................<a href="#page-152">152</a>
   Authors' Addresses ...............................................<a href="#page-153">153</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   This document describes DHCP for IPv6 (DHCPv6), a client/server
   protocol that provides managed configuration of devices.  The basic
   operation of DHCPv6 provides configuration for clients connected to
   the same link as the server.  Relay agent functionality is also
   defined for enabling communication between clients and servers that
   are not on the same link.

   DHCPv6 can provide a device with addresses assigned by a DHCPv6
   server and other configuration information; this data is carried in
   options.  DHCPv6 can be extended through the definition of new
   options to carry configuration information not specified in this
   document.

   DHCPv6 also provides a mechanism for automated delegation of IPv6
   prefixes using DHCPv6, as originally specified in [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>].  Through
   this mechanism, a delegating router can delegate prefixes to
   requesting routers.  Use of this mechanism is specified as part of
   [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>] and by [<a href="#ref-TR-187" title='"TR-187 - IPv6 for PPP Broadband Access"'>TR-187</a>].





<span class="grey">Mrugalski, et al.            Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   DHCP can also be used just to provide other configuration options
   (i.e., no addresses or prefixes).  That implies that the server does
   not have to track any state; thus, this mode is called "stateless
   DHCPv6".  Mechanisms necessary to support stateless DHCPv6 are much
   smaller than mechanisms needed to support stateful DHCPv6.  [<a href="./rfc3736" title='"Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6"'>RFC3736</a>]
   was written to document just those portions of DHCPv6 needed to
   support DHCPv6 stateless operation.

   The remainder of this introduction summarizes the relationship to the
   previous DHCPv6 standards (see <a href="#section-1.1">Section 1.1</a>) and clarifies the stance
   with regard to DHCPv4 (see <a href="#section-1.2">Section 1.2</a>).  <a href="#section-5">Section 5</a> describes the
   message exchange mechanisms to illustrate DHCP operation rather than
   provide an exhaustive list of all possible interactions, and
   <a href="#section-6">Section 6</a> provides an overview of common operational models.
   <a href="#section-18">Section 18</a> explains client and server operation in detail.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Relationship%20to%20Previous%20DHCPv6%20Standards"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Relationship to Previous DHCPv6 Standards</span>

   The initial specification of DHCPv6 was defined in [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>], and a
   number of follow-up documents were published over the years:

   -  [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>] ("IPv6 Prefix Options for Dynamic Host Configuration
      Protocol (DHCP) version 6")

   -  [<a href="./rfc3736" title='"Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6"'>RFC3736</a>] ("Stateless Dynamic Host Configuration Protocol (DHCP)
      Service for IPv6")

   -  [<a href="./rfc4242" title='"Information Refresh Time Option for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC4242</a>] ("Information Refresh Time Option for Dynamic Host
      Configuration Protocol for IPv6 (DHCPv6)")

   -  [<a href="./rfc7083" title='"Modification to Default Values of SOL_MAX_RT and INF_MAX_RT"'>RFC7083</a>] ("Modification to Default Values of SOL_MAX_RT and
      INF_MAX_RT")

   -  [<a href="./rfc7283" title='"Handling Unknown DHCPv6 Messages"'>RFC7283</a>] ("Handling Unknown DHCPv6 Messages")

   -  [<a href="./rfc7550" title='"Issues and Recommendations with Multiple Stateful DHCPv6 Options"'>RFC7550</a>] ("Issues and Recommendations with Multiple Stateful
      DHCPv6 Options")

   This document provides a unified, corrected, and cleaned-up
   definition of DHCPv6 that also covers all applicable errata filed
   against older RFCs (see the list in <a href="#appendix-A">Appendix A</a>).  As such, it
   obsoletes the RFCs listed in the previous paragraph.  Also, there are
   a small number of mechanisms that were obsoleted; see <a href="#section-25">Section 25</a> and
   <a href="#appendix-A">Appendix A</a>.







<span class="grey">Mrugalski, et al.            Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20Relationship%20to%20DHCPv4"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Relationship to DHCPv4</span>

   The operational models and relevant configuration information for
   DHCPv4 [<a href="./rfc2131" title='"Dynamic Host Configuration Protocol"'>RFC2131</a>] [<a href="./rfc2132" title='"DHCP Options and BOOTP Vendor Extensions"'>RFC2132</a>] and DHCPv6 are sufficiently different that
   integration between the two services is not included in this
   document.  [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] suggested that future work might be to extend
   DHCPv6 to carry IPv4 address and configuration information.  However,
   the current consensus of the IETF is that DHCPv4 should be used
   rather than DHCPv6 when conveying IPv4 configuration information to
   nodes.  For IPv6-only networks, [<a href="./rfc7341" title='"DHCPv4-over-DHCPv6 (DHCP 4o6) Transport"'>RFC7341</a>] describes a transport
   mechanism to carry DHCPv4 messages using the DHCPv6 protocol for the
   dynamic provisioning of IPv4 address and configuration information.

   Merging DHCPv4 and DHCPv6 configuration is out of scope for this
   document.  [<a href="./rfc4477" title='"Dynamic Host Configuration Protocol (DHCP): IPv4 and IPv6 Dual-Stack Issues"'>RFC4477</a>] discusses some issues and possible strategies
   for running DHCPv4 and DHCPv6 services together.  While [<a href="./rfc4477" title='"Dynamic Host Configuration Protocol (DHCP): IPv4 and IPv6 Dual-Stack Issues"'>RFC4477</a>] is
   a bit dated, it provides a good overview of the issues at hand.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Requirements"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Requirements</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="./rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

   This document also makes use of internal conceptual variables to
   describe protocol behavior and external variables that an
   implementation must allow system administrators to change.  The
   specific variable names, how their values change, and how their
   settings influence protocol behavior are provided to demonstrate
   protocol behavior.  An implementation is not required to have them in
   the exact form described here, as long as its external behavior is
   consistent with that described in this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Background"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Background</span>

   [<a id="ref-RFC8200">RFC8200</a>] ("Internet Protocol, Version 6 (IPv6) Specification")
   provides the base architecture and design of IPv6.  In addition to
   [<a href="./rfc8200" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC8200</a>], related work in IPv6 that an implementer would be best
   served to study includes

   -  [<a href="./rfc4291" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>] ("IP Version 6 Addressing Architecture")

   -  [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>] ("IPv6 Stateless Address Autoconfiguration")

   -  [<a href="./rfc4861" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] ("Neighbor Discovery for IP version 6 (IPv6)")




<span class="grey">Mrugalski, et al.            Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   These specifications enable DHCP to build upon the IPv6 work to
   provide robust stateful autoconfiguration.

   [<a id="ref-RFC4291">RFC4291</a>] defines the address scope that can be used in an IPv6
   implementation and also provides various configuration architecture
   guidelines for network designers of the IPv6 address space.  Two
   advantages of IPv6 are that support for multicast is required and
   nodes can create link-local addresses during initialization.  The
   availability of these features means that a client can use its
   link-local address and a well-known multicast address to discover and
   communicate with DHCP servers or relay agents on its link.

   [<a id="ref-RFC4862">RFC4862</a>] specifies procedures by which a node may autoconfigure
   addresses based on Router Advertisements [<a href="./rfc4861" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] and the use of a
   valid lifetime to support renumbering of addresses on the Internet.
   Compatibility with stateless address autoconfiguration is a design
   requirement of DHCP.

   IPv6 Neighbor Discovery [<a href="./rfc4861" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] is the node discovery protocol in
   IPv6 that replaces and enhances functions of ARP [<a href="./rfc826" title='"An Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>RFC826</a>].  To
   understand IPv6 and stateless address autoconfiguration, it is
   strongly recommended that implementers understand IPv6 Neighbor
   Discovery.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Terminology"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Terminology</span>

   This section defines terminology specific to IPv6 and DHCP used in
   this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20IPv6%20Terminology"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  IPv6 Terminology</span>

   IPv6 terminology from [<a href="./rfc8200" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC8200</a>], [<a href="./rfc4291" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>], and [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>] relevant to
   this specification is included below.

   address                   An IP-layer identifier for an interface or
                             a set of interfaces.

   GUA                       Global unicast address (see [<a href="./rfc4291" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>]).

   host                      Any node that is not a router.

   IP                        Internet Protocol Version 6 (IPv6).  The
                             terms "IPv4" and "IPv6" are used only in
                             contexts where it is necessary to avoid
                             ambiguity.

   interface                 A node's attachment to a link.




<span class="grey">Mrugalski, et al.            Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   link                      A communication facility or medium over
                             which nodes can communicate at the link
                             layer, i.e., the layer immediately below
                             IP.  Examples are Ethernet (simple or
                             bridged); Point-to-Point Protocol (PPP) and
                             PPP over Ethernet (PPPoE) links; and
                             Internet-layer (or higher) "tunnels", such
                             as tunnels over IPv4 or IPv6 itself.

   link-layer identifier     A link-layer identifier for an interface --
                             for example, IEEE 802 addresses for
                             Ethernet or Token Ring network interfaces.

   link-local address        An IPv6 address having a link-only scope,
                             indicated by having the prefix (fe80::/10),
                             that can be used to reach neighboring nodes
                             attached to the same link.  Every IPv6
                             interface on which DHCPv6 can reasonably be
                             useful has a link-local address.

   multicast address         An identifier for a set of interfaces
                             (typically belonging to different nodes).
                             A packet sent to a multicast address is
                             delivered to all interfaces identified by
                             that address.

   neighbor                  A node attached to the same link.

   node                      A device that implements IP.

   packet                    An IP header plus payload.

   prefix                    The initial bits of an address, or a set
                             of IP addresses that share the same
                             initial bits.

   prefix length             The number of bits in a prefix.

   router                    A node that forwards IP packets not
                             explicitly addressed to itself.

   ULA                       Unique local address (see [<a href="./rfc4193" title='"Unique Local IPv6 Unicast Addresses"'>RFC4193</a>]).

   unicast address           An identifier for a single interface.  A
                             packet sent to a unicast address is
                             delivered to the interface identified by
                             that address.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20DHCP%20Terminology"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  DHCP Terminology</span>

   Terminology specific to DHCP can be found below.

   appropriate to the link   An address is "appropriate to the link"
                             when the address is consistent with the
                             DHCP server's knowledge of the network
                             topology, prefix assignment, and address
                             assignment policies.

   binding                   A binding (or client binding) is a group of
                             server data records containing the
                             information the server has about the
                             addresses or delegated prefixes in an
                             Identity Association (IA) or configuration
                             information explicitly assigned to the
                             client.  Configuration information that has
                             been returned to a client through a policy,
                             such as the information returned to all
                             clients on the same link, does not require
                             a binding.  A binding containing
                             information about an IA is indexed by the
                             tuple &lt;DUID, IA-type, IAID&gt; (where IA-type
                             is the type of lease in the IA -- for
                             example, temporary).  A binding containing
                             configuration information for a client is
                             indexed by &lt;DUID&gt;.  See below for
                             definitions of DUID, IA, and IAID.

   configuration parameter   An element of the configuration information
                             set on the server and delivered to the
                             client using DHCP.  Such parameters may be
                             used to carry information to be used by a
                             node to configure its network subsystem and
                             enable communication on a link or
                             internetwork, for example.

   container option          An option that encapsulates other options
                             (for example, the IA_NA option (see
                             <a href="#section-21.4">Section 21.4</a>) may contain IA Address
                             options (see <a href="#section-21.6">Section 21.6</a>)).










<span class="grey">Mrugalski, et al.            Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   delegating router         The router that acts as a DHCP server and
                             responds to requests for delegated
                             prefixes.  This document primarily uses the
                             term "DHCP server" or "server" when
                             discussing the "delegating router"
                             functionality of prefix delegation (see
                             <a href="#section-1">Section 1</a>).

   DHCP                      Dynamic Host Configuration Protocol for
                             IPv6.  The terms "DHCPv4" and "DHCPv6" are
                             used only in contexts where it is necessary
                             to avoid ambiguity.

   DHCP client               Also referred to as "client".  A node that
                             initiates requests on a link to obtain
                             configuration parameters from one or more
                             DHCP servers.  The node may act as a
                             requesting router (see below) if it
                             supports prefix delegation.

   DHCP domain               A set of links managed by DHCP and operated
                             by a single administrative entity.

   DHCP relay agent          Also referred to as "relay agent".  A node
                             that acts as an intermediary to deliver
                             DHCP messages between clients and servers.
                             In certain configurations, there may be
                             more than one relay agent between clients
                             and servers, so a relay agent may send DHCP
                             messages to another relay agent.

   DHCP server               Also referred to as "server".  A node that
                             responds to requests from clients.  It may
                             or may not be on the same link as the
                             client(s).  Depending on its capabilities,
                             if it supports prefix delegation it may
                             also feature the functionality of a
                             delegating router.

   DUID                      A DHCP Unique Identifier for a DHCP
                             participant.  Each DHCP client and server
                             has exactly one DUID.  See <a href="#section-11">Section 11</a> for
                             details of the ways in which a DUID may be
                             constructed.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   encapsulated option       A DHCP option that is usually only
                             contained in another option.  For example,
                             the IA Address option is contained in IA_NA
                             or IA_TA options (see <a href="#section-21.5">Section 21.5</a>).  See
                             <a href="./rfc7227#section-9">Section 9 of [RFC7227]</a> for a more complete
                             definition.

   IA                        Identity Association: a collection of
                             leases assigned to a client.  Each IA has
                             an associated IAID (see below).  A client
                             may have more than one IA assigned to it --
                             for example, one for each of its
                             interfaces.  Each IA holds one type of
                             lease; for example, an identity association
                             for temporary addresses (IA_TA) holds
                             temporary addresses, and an identity
                             association for prefix delegation (IA_PD)
                             holds delegated prefixes.  Throughout this
                             document, "IA" is used to refer to an
                             identity association without identifying
                             the type of a lease in the IA.  At the time
                             of writing this document, there are three
                             IA types defined: IA_NA, IA_TA, and IA_PD.
                             New IA types may be defined in the future.

   IA option(s)              At the time of writing this document, one
                             or more IA_NA, IA_TA, and/or IA_PD options.
                             New IA types may be defined in the future.

   IAID                      Identity Association Identifier: an
                             identifier for an IA, chosen by the client.
                             Each IA has an IAID, which is chosen to be
                             unique among IAIDs for IAs of a specific
                             type that belong to that client.

   IA_NA                     Identity Association for Non-temporary
                             Addresses: an IA that carries assigned
                             addresses that are not temporary addresses
                             (see "IA_TA").  See <a href="#section-21.4">Section 21.4</a> for
                             details on the IA_NA option.

   IA_PD                     Identity Association for Prefix Delegation:
                             an IA that carries delegated prefixes.  See
                             <a href="#section-21.21">Section 21.21</a> for details on the IA_PD
                             option.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   IA_TA                     Identity Association for Temporary
                             Addresses: an IA that carries temporary
                             addresses (see [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>]).  See
                             <a href="#section-21.5">Section 21.5</a> for details on the IA_TA
                             option.

   lease                     A contract by which the server grants the
                             use of an address or delegated prefix to
                             the client for a specified period of time.

   message                   A unit of data carried as the payload of a
                             UDP datagram, exchanged among DHCP servers,
                             relay agents, and clients.

   Reconfigure key           A key supplied to a client by a server.
                             Used to provide security for Reconfigure
                             messages (see <a href="#section-7.3">Section 7.3</a> for the list of
                             available message types).

   relaying                  A DHCP relay agent relays DHCP messages
                             between DHCP participants.

   requesting router         The router that acts as a DHCP client and
                             is requesting prefix(es) to be assigned.
                             This document primarily uses the term "DHCP
                             client" or "client" when discussing the
                             "requesting router" functionality of prefix
                             delegation (see <a href="#section-1">Section 1</a>).

   retransmission            Another attempt to send the same DHCP
                             message by a client or server, as a result
                             of not receiving a valid response to the
                             previously sent messages.  The
                             retransmitted message is typically modified
                             prior to sending, as required by the DHCP
                             specifications.  In particular, the client
                             updates the value of the Elapsed Time
                             option in the retransmitted message.

   RKAP                      The Reconfiguration Key Authentication
                             Protocol (see <a href="#section-20.4">Section 20.4</a>).

   singleton option          An option that is allowed to appear only
                             once as a top-level option or at any
                             encapsulation level.  Most options are
                             singletons.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   T1                        The time interval after which the client is
                             expected to contact the server that did the
                             assignment to extend (renew) the lifetimes
                             of the addresses assigned (via IA_NA
                             option(s)) and/or prefixes delegated (via
                             IA_PD option(s)) to the client.  T1 is
                             expressed as an absolute value in messages
                             (in seconds), is conveyed within IA
                             containers (currently the IA_NA and IA_PD
                             options), and is interpreted as a time
                             interval since the packet's reception.  The
                             value stored in the T1 field in IA options
                             is referred to as the T1 value.  The actual
                             time when the timer expires is referred to
                             as the T1 time.

   T2                        The time interval after which the client is
                             expected to contact any available server to
                             extend (rebind) the lifetimes of the
                             addresses assigned (via IA_NA option(s))
                             and/or prefixes delegated (via IA_PD
                             option(s)) to the client.  T2 is expressed
                             as an absolute value in messages (in
                             seconds), is conveyed within IA containers
                             (currently the IA_NA and IA_PD options),
                             and is interpreted as a time interval since
                             the packet's reception.  The value stored
                             in the T2 field in IA options is referred
                             to as the T2 value.  The actual time when
                             the timer expires is referred to as the
                             T2 time.

   top-level option          An option conveyed in a DHCP message
                             directly, i.e., not encapsulated in any
                             other option, as described in <a href="./rfc7227#section-9">Section 9 of
                             [RFC7227]</a>.

   transaction ID            An opaque value used to match responses
                             with replies initiated by either a client
                             or a server.











<span class="grey">Mrugalski, et al.            Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Client%2FServer%20Exchanges"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Client/Server Exchanges</span>

   Clients and servers exchange DHCP messages using UDP (see [<a href="./rfc768" title='"User Datagram Protocol"'>RFC768</a>]
   and <a href="https://www.rfc-editor.org/bcp/bcp145">BCP 145</a> [<a href="./rfc8085" title='"UDP Usage Guidelines"'>RFC8085</a>]).  The client uses a link-local address or
   addresses determined through other mechanisms for transmitting and
   receiving DHCP messages.

   A DHCP client sends most messages using a reserved, link-scoped
   multicast destination address so that the client need not be
   configured with the address or addresses of DHCP servers.

   To allow a DHCP client to send a message to a DHCP server that is not
   attached to the same link, a DHCP relay agent on the client's link
   will relay messages between the client and server.  The operation of
   the relay agent is transparent to the client.  The discussion of
   message exchanges in the remainder of this section will omit the
   description of the relaying of messages by relay agents.

   Once the client has determined the address of a server, it may, under
   some circumstances, send messages directly to the server using
   unicast.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20Client%2FServer%20Exchanges%20Involving%20Two%20Messages"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Client/Server Exchanges Involving Two Messages</span>

   When a DHCP client does not need to have a DHCP server assign IP
   addresses or delegated prefixes to it, the client can obtain other
   configuration information such as a list of available DNS servers
   [<a href="./rfc3646" title='"DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3646</a>] or NTP servers [<a href="./rfc5908" title='"Network Time Protocol (NTP) Server Option for DHCPv6"'>RFC5908</a>] through a single message and reply
   exchange with a DHCP server.  To obtain other configuration
   information, the client first sends an Information-request message to
   the All_DHCP_Relay_Agents_and_Servers multicast address.  Servers
   respond with a Reply message containing the other configuration
   information for the client.

   A client may also request the server to expedite address assignment
   and/or prefix delegation by using a two-message exchange instead of
   the normal four-message exchange as discussed in the next section.
   Expedited assignment can be requested by the client, and servers may
   or may not honor the request (see Sections <a href="#section-18.3.1">18.3.1</a> and <a href="#section-21.14">21.14</a> for more
   details and why servers may not honor this request).  Clients may
   request this expedited service in environments where it is likely
   that there is only one server available on a link and no expectation
   that a second server would become available, or when completing the
   configuration process as quickly as possible is a priority.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   To request the expedited two-message exchange, the client sends a
   Solicit message to the All_DHCP_Relay_Agents_and_Servers multicast
   address requesting the assignment of addresses and/or delegated
   prefixes and other configuration information.  This message includes
   an indication (the Rapid Commit option; see <a href="#section-21.14">Section 21.14</a>) that the
   client is willing to accept an immediate Reply message from the
   server.  The server that is willing to commit the assignment of
   addresses and/or delegated prefixes to the client immediately
   responds with a Reply message.  The configuration information and the
   addresses and/or delegated prefixes in the Reply message are then
   immediately available for use by the client.

   Each address or delegated prefix assigned to the client has
   associated preferred and valid lifetimes specified by the server.  To
   request an extension of the lifetimes assigned to an address or
   delegated prefix, the client sends a Renew message to the server.
   The server sends a Reply message to the client with the new
   lifetimes, allowing the client to continue to use the address or
   delegated prefix without interruption.  If the server is unable to
   extend the lifetime of an address or delegated prefix, it indicates
   this by returning the address or delegated prefix with lifetimes of
   0.  At the same time, the server may assign other addresses or
   delegated prefixes.

   See <a href="#section-18">Section 18</a> for descriptions of additional two-message exchanges
   between the client and server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20Client%2FServer%20Exchanges%20Involving%20Four%20Messages"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  Client/Server Exchanges Involving Four Messages</span>

   To request the assignment of one or more addresses and/or delegated
   prefixes, a client first locates a DHCP server and then requests the
   assignment of addresses and/or delegated prefixes and other
   configuration information from the server.  The client sends a
   Solicit message to the All_DHCP_Relay_Agents_and_Servers multicast
   address to find available DHCP servers.  Any server that can meet the
   client's requirements responds with an Advertise message.  The client
   then chooses one of the servers and sends a Request message to the
   server asking for confirmed assignment of addresses and/or delegated
   prefixes and other configuration information.  The server responds
   with a Reply message that contains the confirmed addresses, delegated
   prefixes, and configuration.

   As described in the previous section, the client can request an
   extension of the lifetimes assigned to addresses or delegated
   prefixes (this is a two-message exchange).






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20Server%2FClient%20Exchanges"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  Server/Client Exchanges</span>

   A server that has previously communicated with a client and
   negotiated for the client to listen for Reconfigure messages may send
   the client a Reconfigure message to initiate the client to update its
   configuration by sending an Information-request, Renew, or Rebind
   message.  The client then performs the two-message exchange as
   described earlier.  This can be used to expedite configuration
   changes to a client, such as the need to renumber a network (see
   [<a href="./rfc6879" title='"IPv6 Enterprise Network Renumbering Scenarios, Considerations, and Methods"'>RFC6879</a>]).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Operational%20Models"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Operational Models</span>

   This section describes some of the current most common DHCP
   operational models.  The described models are not mutually exclusive
   and are sometimes used together.  For example, a device may start in
   stateful mode to obtain an address and, at a later time when an
   application is started, request additional parameters using
   stateless mode.

   This document assumes that the DHCP servers and the client,
   communicating with the servers via a specific interface, belong to a
   single provisioning domain.

   DHCP may be extended to support additional stateful services that may
   interact with one or more of the models described below.  Such
   interaction should be considered and documented as part of any future
   protocol extension.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20Stateless%20DHCP"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Stateless DHCP</span>

   Stateless DHCP [<a href="./rfc3736" title='"Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6"'>RFC3736</a>] is used when DHCP is not used for obtaining
   a lease but a node (DHCP client) desires one or more DHCP "other
   configuration" parameters, such as a list of DNS recursive name
   servers or DNS domain search lists [<a href="./rfc3646" title='"DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3646</a>].  Stateless DHCP may be
   used when a node initially boots or at any time the software on the
   node requires some missing or expired configuration information that
   is available via DHCP.

   This is the simplest and most basic operation for DHCP and requires a
   client (and a server) to support only two messages --
   Information-request and Reply.  Note that DHCP servers and relay
   agents typically also need to support the Relay-forward and
   Relay-reply messages to accommodate operation when clients and
   servers are not on the same link.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20DHCP%20for%20Non-temporary%20Address%20Assignment"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  DHCP for Non-temporary Address Assignment</span>

   This model of operation was the original motivation for DHCP.  It is
   appropriate for situations where stateless address autoconfiguration
   alone is insufficient or impractical, e.g., because of network
   policy, additional requirements such as dynamic updates to the DNS,
   or client-specific requirements.

   The model of operation for non-temporary address assignment is as
   follows.  The server is provided with prefixes from which it may
   allocate addresses to clients, as well as any related network
   topology information as to which prefixes are present on which links.
   A client requests a non-temporary address to be assigned by the
   server.  The server allocates an address or addresses appropriate for
   the link on which the client is connected.  The server returns the
   allocated address or addresses to the client.

   Each address has associated preferred and valid lifetimes, which
   constitute an agreement about the length of time over which the
   client is allowed to use the address.  A client can request an
   extension of the lifetimes on an address and is required to terminate
   the use of an address if the valid lifetime of the address expires.

   Typically, clients request other configuration parameters, such as
   the DNS name server addresses and domain search lists, when
   requesting addresses.

   Clients can also request more than one address or set of addresses
   (see Sections <a href="#section-6.6">6.6</a> and <a href="#section-12">12</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.3.%20%20DHCP%20for%20Prefix%20Delegation"></a><a class="selflink" href="#section-6.3" id="section-6.3">6.3</a>.  DHCP for Prefix Delegation</span>

   The prefix delegation mechanism, originally described in [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>],
   is another stateful mode of operation and was originally intended for
   simple delegation of prefixes from a delegating router (DHCP server)
   to requesting routers (DHCP clients).  It is appropriate for
   situations in which the delegating router (1) does not have knowledge
   about the topology of the networks to which the requesting router is
   attached and (2) does not require other information aside from the
   identity of the requesting router to choose a prefix for delegation.
   This mechanism is appropriate for use by an ISP to delegate a prefix
   to a subscriber, where the delegated prefix would possibly be
   subnetted and assigned to the links within the subscriber's network.
   [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>] and [<a href="./rfc7368" title='"IPv6 Home Networking Architecture Principles"'>RFC7368</a>] describe such use in detail.

   The design of this prefix delegation mechanism meets the requirements
   for prefix delegation in [<a href="./rfc3769" title='"Requirements for IPv6 Prefix Delegation"'>RFC3769</a>].




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   While [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>] assumes that the DHCP client is a router (hence the
   use of "requesting router") and that the DHCP server is a router
   (hence the use of "delegating router"), DHCP prefix delegation itself
   does not require that the client forward IP packets not addressed to
   itself and thus does not require that the client (or server) be a
   router as defined in [<a href="./rfc8200" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC8200</a>].  Also, in many cases (such as
   tethering or hosting virtual machines), hosts are already forwarding
   IP packets and thus are operating as routers as defined in [<a href="./rfc8200" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC8200</a>].
   Therefore, this document mostly replaces "requesting router" with
   "client" and "delegating router" with "server".

   The model of operation for prefix delegation is as follows.  A server
   is provisioned with prefixes to be delegated to clients.  A client
   requests prefix(es) from the server, as described in <a href="#section-18">Section 18</a>.  The
   server chooses prefix(es) for delegation and responds with prefix(es)
   to the client.  The client is then responsible for the delegated
   prefix(es).  For example, the client might assign a subnet from a
   delegated prefix to one of its interfaces and begin sending Router
   Advertisements for the prefix on that link.

   Each prefix has an associated preferred lifetime and valid lifetime,
   which constitute an agreement about the length of time over which the
   client is allowed to use the prefix.  A client can request an
   extension of the lifetimes on a delegated prefix and is required to
   terminate the use of a delegated prefix if the valid lifetime of the
   prefix expires.

























<span class="grey">Mrugalski, et al.            Standards Track                   [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Figure 1 illustrates a network architecture in which prefix
   delegation could be used.

                      ______________________         \
                     /                      \         \
                    |    ISP core network    |         \
                     \__________ ___________/           |
                                |                       |
                        +-------+-------+               |
                        |  Aggregation  |               | ISP
                        |    device     |               | network
                        |  (delegating  |               |
                        |    router)    |               |
                        +-------+-------+               |
                                |                      /
                                |Network link to      /
                                |subscriber premises /
                                |
                         +------+------+             \
                         |     CPE     |              \
                         | (requesting |               \
                         |   router)   |                |
                         +----+---+----+                |
                              |   |                     | Subscriber
       ---+-------------+-----+   +-----+------         | network
          |             |               |               |
     +----+-----+ +-----+----+     +----+-----+         |
     |Subscriber| |Subscriber|     |Subscriber|        /
     |    PC    | |    PC    |     |    PC    |       /
     +----------+ +----------+     +----------+      /

                    Figure 1: Prefix Delegation Network

   In this example, the server (delegating router) is configured with a
   set of prefixes to be used for assignment to customers at the time of
   each customer's first connection to the ISP service.  The prefix
   delegation process begins when the client (requesting router)
   requests configuration information through DHCP.  The DHCP messages
   from the client are received by the server in the aggregation device.
   When the server receives the request, it selects an available prefix
   or prefixes for delegation to the client.  The server then returns
   the prefix or prefixes to the client.

   The client subnets the delegated prefix and assigns the longer
   prefixes to links in the subscriber's network.  In a typical scenario
   based on the network shown in Figure 1, the client subnets a single
   delegated /48 prefix into /64 prefixes and assigns one /64 prefix to
   each of the links in the subscriber network.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The prefix delegation options can be used in conjunction with other
   DHCP options carrying other configuration information to the client.

   The client may, in turn, provide DHCP service to nodes attached to
   the internal network.  For example, the client may obtain the
   addresses of DNS and NTP servers from the ISP server and then pass
   that configuration information on to the subscriber hosts through a
   DHCP server in the client (requesting router).

   If the client uses a delegated prefix to configure addresses on
   interfaces on itself or other nodes behind it, the preferred and
   valid lifetimes of those addresses MUST be no longer than the
   remaining preferred and valid lifetimes, respectively, for the
   delegated prefix at any time.  In particular, if the delegated prefix
   or a prefix derived from it is advertised for stateless address
   autoconfiguration [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>], the advertised preferred and valid
   lifetimes MUST NOT exceed the corresponding remaining lifetimes of
   the delegated prefix.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.%20%20DHCP%20for%20Customer%20Edge%20Routers"></a><a class="selflink" href="#section-6.4" id="section-6.4">6.4</a>.  DHCP for Customer Edge Routers</span>

   The DHCP requirements and network architecture for Customer Edge
   Routers are described in [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>].  This model of operation combines
   address assignment (see <a href="#section-6.2">Section 6.2</a>) and prefix delegation (see
   <a href="#section-6.3">Section 6.3</a>).  In general, this model assumes that a single set of
   transactions between the client and server will assign or extend the
   client's non-temporary addresses and delegated prefixes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.5.%20%20DHCP%20for%20Temporary%20Addresses"></a><a class="selflink" href="#section-6.5" id="section-6.5">6.5</a>.  DHCP for Temporary Addresses</span>

   Temporary addresses were originally introduced to avoid privacy
   concerns with stateless address autoconfiguration, which based
   64 bits of the address on the EUI-64 (see [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>].  They were added
   to DHCP to provide complementary support when stateful address
   assignment is used.

   Temporary address assignment works mostly like non-temporary address
   assignment (see <a href="#section-6.2">Section 6.2</a>); however, these addresses are generally
   intended to be used for a short period of time and not to have their
   lifetimes extended, though they can be if required.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.6.%20%20Multiple%20Addresses%20and%20Prefixes"></a><a class="selflink" href="#section-6.6" id="section-6.6">6.6</a>.  Multiple Addresses and Prefixes</span>

   DHCP allows a client to receive multiple addresses.  During typical
   operation, a client sends one instance of an IA_NA option and the
   server assigns at most one address from each prefix assigned to the
   link to which the client is attached.  In particular, the server can
   be configured to serve addresses out of multiple prefixes for a given



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   link.  This is useful in cases such as when a network renumbering
   event is in progress.  In a typical deployment, the server will grant
   one address for each IA_NA option (see <a href="#section-21.4">Section 21.4</a>).

   A client can explicitly request multiple addresses by sending
   multiple IA_NA options (and/or IA_TA options; see <a href="#section-21.5">Section 21.5</a>).  A
   client can send multiple IA_NA (and/or IA_TA) options in its initial
   transmissions.  Alternatively, it can send an extra Request message
   with additional new IA_NA (and/or IA_TA) options (or include them in
   a Renew message).

   The same principle also applies to prefix delegation.  In principle,
   DHCP allows a client to request new prefixes to be delegated by
   sending additional IA_PD options (see <a href="#section-21.21">Section 21.21</a>).  However, a
   typical operator usually prefers to delegate a single, larger prefix.
   In most deployments, it is recommended that the client request a
   larger prefix in its initial transmissions rather than request
   additional prefixes later on.

   The exact behavior of the server (whether to grant additional
   addresses and prefixes or not) is up to the server policy and is out
   of scope for this document.

   For more information on how the server distinguishes between IA
   option instances, see <a href="#section-12">Section 12</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20DHCP%20Constants"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  DHCP Constants</span>

   This section describes various program and networking constants used
   by DHCP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Multicast%20Addresses"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Multicast Addresses</span>

   DHCP makes use of the following multicast addresses:

   All_DHCP_Relay_Agents_and_Servers (ff02::1:2)
      A link-scoped multicast address used by a client to communicate
      with neighboring (i.e., on-link) relay agents and servers.  All
      servers and relay agents are members of this multicast group.

   All_DHCP_Servers (ff05::1:3)
      A site-scoped multicast address used by a relay agent to
      communicate with servers, either because the relay agent wants to
      send messages to all servers or because it does not know the
      unicast addresses of the servers.  Note that in order for a relay
      agent to use this address, it must have an address of sufficient





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      scope to be reachable by the servers.  All servers within the site
      are members of this multicast group on the interfaces that are
      within the site.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20UDP%20Ports"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  UDP Ports</span>

   Clients listen for DHCP messages on UDP port 546.  Servers and relay
   agents listen for DHCP messages on UDP port 547.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.3.%20%20DHCP%20Message%20Types"></a><a class="selflink" href="#section-7.3" id="section-7.3">7.3</a>.  DHCP Message Types</span>

   DHCP defines the following message types.  The formats of these
   messages are provided in Sections <a href="#section-8">8</a> and <a href="#section-9">9</a>.  Additional message types
   have been defined and may be defined in the future; see
   &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/dhcpv6-parameters</a>&gt;.  The numeric
   encoding for each message type is shown in parentheses.

   SOLICIT (1)               A client sends a Solicit message to locate
                             servers.

   ADVERTISE (2)             A server sends an Advertise message to
                             indicate that it is available for DHCP
                             service, in response to a Solicit message
                             received from a client.

   REQUEST (3)               A client sends a Request message to request
                             configuration parameters, including
                             addresses and/or delegated prefixes, from a
                             specific server.

   CONFIRM (4)               A client sends a Confirm message to any
                             available server to determine whether the
                             addresses it was assigned are still
                             appropriate to the link to which the client
                             is connected.

   RENEW (5)                 A client sends a Renew message to the
                             server that originally provided the
                             client's leases and configuration
                             parameters to extend the lifetimes on the
                             leases assigned to the client and to update
                             other configuration parameters.









<span class="grey">Mrugalski, et al.            Standards Track                   [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   REBIND (6)                A client sends a Rebind message to any
                             available server to extend the lifetimes on
                             the leases assigned to the client and to
                             update other configuration parameters; this
                             message is sent after a client receives no
                             response to a Renew message.

   REPLY (7)                 A server sends a Reply message containing
                             assigned leases and configuration
                             parameters in response to a Solicit,
                             Request, Renew, or Rebind message received
                             from a client.  A server sends a Reply
                             message containing configuration parameters
                             in response to an Information-request
                             message.  A server sends a Reply message in
                             response to a Confirm message confirming or
                             denying that the addresses assigned to the
                             client are appropriate to the link to which
                             the client is connected.  A server sends a
                             Reply message to acknowledge receipt of a
                             Release or Decline message.

   RELEASE (8)               A client sends a Release message to the
                             server that assigned leases to the client
                             to indicate that the client will no longer
                             use one or more of the assigned leases.

   DECLINE (9)               A client sends a Decline message to a
                             server to indicate that the client has
                             determined that one or more addresses
                             assigned by the server are already in use
                             on the link to which the client is
                             connected.

   RECONFIGURE (10)          A server sends a Reconfigure message to a
                             client to inform the client that the server
                             has new or updated configuration parameters
                             and that the client is to initiate a
                             Renew/Reply, Rebind/Reply, or
                             Information-request/Reply transaction with
                             the server in order to receive the updated
                             information.

   INFORMATION-REQUEST (11)  A client sends an Information-request
                             message to a server to request
                             configuration parameters without the
                             assignment of any leases to the client.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 25]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-26"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   RELAY-FORW (12)           A relay agent sends a Relay-forward message
                             to relay messages to servers, either
                             directly or through another relay agent.
                             The received message -- either a client
                             message or a Relay-forward message from
                             another relay agent -- is encapsulated in
                             an option in the Relay-forward message.

   RELAY-REPL (13)           A server sends a Relay-reply message to a
                             relay agent containing a message that the
                             relay agent delivers to a client.  The
                             Relay-reply message may be relayed by other
                             relay agents for delivery to the
                             destination relay agent.

                             The server encapsulates the client message
                             as an option in the Relay-reply message,
                             which the relay agent extracts and relays
                             to the client.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.4.%20%20DHCP%20Option%20Codes"></a><a class="selflink" href="#section-7.4" id="section-7.4">7.4</a>.  DHCP Option Codes</span>

   DHCP makes extensive use of options in messages; some of these are
   defined later, in <a href="#section-21">Section 21</a>.  Additional options are defined in
   other documents or may be defined in the future (see [<a href="./rfc7227" title='"Guidelines for Creating New DHCPv6 Options"'>RFC7227</a>] for
   guidance on new option definitions).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.5.%20%20Status%20Codes"></a><a class="selflink" href="#section-7.5" id="section-7.5">7.5</a>.  Status Codes</span>

   DHCP uses status codes to communicate the success or failure of
   operations requested in messages from clients and servers and to
   provide additional information about the specific cause of the
   failure of a message.  The specific status codes are defined in
   <a href="#section-21.13">Section 21.13</a>.

   If the Status Code option (see <a href="#section-21.13">Section 21.13</a>) does not appear in a
   message in which the option could appear, the status of the message
   is assumed to be Success.













<span class="grey">Mrugalski, et al.            Standards Track                   [Page 26]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-27"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.6.%20%20Transmission%20and%20Retransmission%20Parameters"></a><a class="selflink" href="#section-7.6" id="section-7.6">7.6</a>.  Transmission and Retransmission Parameters</span>

   This section presents a table of values used to describe the message
   transmission behavior of clients and servers.  Some of the values are
   adjusted by a randomization factor and backoffs (see <a href="#section-15">Section 15</a>).
   Transmissions may also be influenced by rate limiting (see
   <a href="#section-14.1">Section 14.1</a>).

   +-----------------+------------------+------------------------------+
   | Parameter       | Default          | Description                  |
   +-----------------+------------------+------------------------------+
   | SOL_MAX_DELAY   | 1 sec            | Max delay of first Solicit   |
   |                 |                  |                              |
   | SOL_TIMEOUT     | 1 sec            | Initial Solicit timeout      |
   |                 |                  |                              |
   | SOL_MAX_RT      | 3600 secs        | Max Solicit timeout value    |
   |                 |                  |                              |
   | REQ_TIMEOUT     | 1 sec            | Initial Request timeout      |
   |                 |                  |                              |
   | REQ_MAX_RT      | 30 secs          | Max Request timeout value    |
   |                 |                  |                              |
   | REQ_MAX_RC      | 10               | Max Request retry attempts   |
   |                 |                  |                              |
   | CNF_MAX_DELAY   | 1 sec            | Max delay of first Confirm   |
   |                 |                  |                              |
   | CNF_TIMEOUT     | 1 sec            | Initial Confirm timeout      |
   |                 |                  |                              |
   | CNF_MAX_RT      | 4 secs           | Max Confirm timeout          |
   |                 |                  |                              |
   | CNF_MAX_RD      | 10 secs          | Max Confirm duration         |
   |                 |                  |                              |
   | REN_TIMEOUT     | 10 secs          | Initial Renew timeout        |
   |                 |                  |                              |
   | REN_MAX_RT      | 600 secs         | Max Renew timeout value      |
   |                 |                  |                              |
   | REB_TIMEOUT     | 10 secs          | Initial Rebind timeout       |
   |                 |                  |                              |
   | REB_MAX_RT      | 600 secs         | Max Rebind timeout value     |
   |                 |                  |                              |
   | INF_MAX_DELAY   | 1 sec            | Max delay of first           |
   |                 |                  | Information-request          |
   |                 |                  |                              |
   | INF_TIMEOUT     | 1 sec            | Initial Information-request  |
   |                 |                  | timeout                      |
   |                 |                  |                              |
   | INF_MAX_RT      | 3600 secs        | Max Information-request      |
   |                 |                  | timeout value                |
   |                 |                  |                              |



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 27]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-28"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   | REL_TIMEOUT     | 1 sec            | Initial Release timeout      |
   |                 |                  |                              |
   | REL_MAX_RC      | 4                | Max Release retry attempts   |
   |                 |                  |                              |
   | DEC_TIMEOUT     | 1 sec            | Initial Decline timeout      |
   |                 |                  |                              |
   | DEC_MAX_RC      | 4                | Max Decline retry attempts   |
   |                 |                  |                              |
   | REC_TIMEOUT     | 2 secs           | Initial Reconfigure timeout  |
   |                 |                  |                              |
   | REC_MAX_RC      | 8                | Max Reconfigure attempts     |
   |                 |                  |                              |
   | HOP_COUNT_LIMIT | 8                | Max hop count in a           |
   |                 |                  | Relay-forward message        |
   |                 |                  |                              |
   | IRT_DEFAULT     | 86400 secs (24   | Default information refresh  |
   |                 | hours)           | time                         |
   |                 |                  |                              |
   | IRT_MINIMUM     | 600 secs         | Min information refresh time |
   |                 |                  |                              |
   | MAX_WAIT_TIME   | 60 secs          | Max required time to wait    |
   |                 |                  | for a response               |
   +-----------------+------------------+------------------------------+

            Table 1: Transmission and Retransmission Parameters

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.7.%20%20Representation%20of%20Time%20Values%20and%20%22Infinity%22%20as%20a%20Time%20Value"></a><a class="selflink" href="#section-7.7" id="section-7.7">7.7</a>.  Representation of Time Values and "Infinity" as a Time Value</span>

   All time values for lifetimes, T1, and T2 are unsigned 32-bit
   integers and are expressed in units of seconds.  The value 0xffffffff
   is taken to mean "infinity" when used as a lifetime (as in [<a href="./rfc4861" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>])
   or a value for T1 or T2.

   Setting the valid lifetime of an address or a delegated prefix to
   0xffffffff ("infinity") amounts to a permanent assignment of an
   address or delegation to a client and should only be used in cases
   where permanent assignments are desired.

   Care should be taken in setting T1 or T2 to 0xffffffff ("infinity").
   A client will never attempt to extend the lifetimes of any addresses
   in an IA with T1 set to 0xffffffff.  A client will never attempt to
   use a Rebind message to locate a different server to extend the
   lifetimes of any addresses in an IA with T2 set to 0xffffffff.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 28]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-29"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Client%2FServer%20Message%20Formats"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Client/Server Message Formats</span>

   All DHCP messages sent between clients and servers share an identical
   fixed-format header and a variable-format area for options.

   All values in the message header and in options are in network byte
   order.

   Options are stored serially in the "options" field, with no padding
   between the options.  Options are byte-aligned but are not aligned in
   any other way (such as on 2-byte or 4-byte boundaries).

   The following diagram illustrates the format of DHCP messages sent
   between clients and servers:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    msg-type   |               transaction-id                  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      .                            options                            .
      .                 (variable number and length)                  .
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 2: Client/Server Message Format

      msg-type             Identifies the DHCP message type; the
                           available message types are listed in
                           <a href="#section-7.3">Section 7.3</a>.  A 1-octet field.

      transaction-id       The transaction ID for this message exchange.
                           A 3-octet field.

      options              Options carried in this message; options are
                           described in <a href="#section-21">Section 21</a>.  A variable-length
                           field (4 octets less than the size of the
                           message).












<span class="grey">Mrugalski, et al.            Standards Track                   [Page 29]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-30"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Relay%20Agent%2FServer%20Message%20Formats"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Relay Agent/Server Message Formats</span>

   Relay agents exchange messages with other relay agents and servers to
   relay messages between clients and servers that are not connected to
   the same link.

   All values in the message header and in options are in network byte
   order.

   Options are stored serially in the "options" field, with no padding
   between the options.  Options are byte-aligned but are not aligned in
   any other way (such as on 2-byte or 4-byte boundaries).

   There are two relay agent messages (Relay-forward and Relay-reply),
   which share the following format:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    msg-type   |   hop-count   |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      |                                                               |
      |                         link-address                          |
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
      |                               |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      |                                                               |
      |                         peer-address                          |
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
      |                               |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      .                                                               .
      .            options (variable number and length)   ....        .
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 3: Relay Agent/Server Message Format












<span class="grey">Mrugalski, et al.            Standards Track                   [Page 30]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-31"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The following sections describe the use of the relay agent message
   header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Relay-forward%20Message"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Relay-forward Message</span>

   The following table defines the use of message fields in a
   Relay-forward message.

      msg-type             RELAY-FORW (12).  A 1-octet field.

      hop-count            Number of relay agents that have already
                           relayed this message.  A 1-octet field.

      link-address         An address that may be used by the server to
                           identify the link on which the client is
                           located.  This is typically a globally scoped
                           unicast address (i.e., GUA or ULA), but see
                           the discussion in <a href="#section-19.1.1">Section 19.1.1</a>.  A 16-octet
                           field.

      peer-address         The address of the client or relay agent from
                           which the message to be relayed was received.
                           A 16-octet field.

      options              MUST include a Relay Message option (see
                           <a href="#section-21.10">Section 21.10</a>); MAY include other options,
                           such as the Interface-Id option (see
                           <a href="#section-21.18">Section 21.18</a>), added by the relay agent.  A
                           variable-length field (34 octets less than
                           the size of the message).

   See <a href="#section-13.1">Section 13.1</a> for an explanation of how the link-address field
   is used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Relay-reply%20Message"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Relay-reply Message</span>

   The following table defines the use of message fields in a
   Relay-reply message.

      msg-type             RELAY-REPL (13).  A 1-octet field.

      hop-count            Copied from the Relay-forward message.
                           A 1-octet field.

      link-address         Copied from the Relay-forward message.
                           A 16-octet field.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 31]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-32"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      peer-address         Copied from the Relay-forward message.
                           A 16-octet field.

      options              MUST include a Relay Message option (see
                           <a href="#section-21.10">Section 21.10</a>); MAY include other options,
                           such as the Interface-Id option (see
                           <a href="#section-21.18">Section 21.18</a>).  A variable-length field
                           (34 octets less than the size of the
                           message).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Representation%20and%20Use%20of%20Domain%20Names"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Representation and Use of Domain Names</span>

   So that domain names may be encoded uniformly, a domain name or a
   list of domain names is encoded using the technique described in
   <a href="./rfc1035#section-3.1">Section 3.1 of [RFC1035]</a>.  A domain name, or list of domain names, in
   DHCP MUST NOT be stored in compressed form as described in
   <a href="./rfc1035#section-4.1.4">Section 4.1.4 of [RFC1035]</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20DHCP%20Unique%20Identifier%20%28DUID%29"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  DHCP Unique Identifier (DUID)</span>

   Each DHCP client and server has a DUID.  DHCP servers use DUIDs to
   identify clients for the selection of configuration parameters and in
   the association of IAs with clients.  DHCP clients use DUIDs to
   identify a server in messages where a server needs to be identified.
   See Sections <a href="#section-21.2">21.2</a> and <a href="#section-21.3">21.3</a> for details regarding the representation
   of a DUID in a DHCP message.

   Clients and servers MUST treat DUIDs as opaque values and MUST only
   compare DUIDs for equality.  Clients and servers SHOULD NOT in any
   other way interpret DUIDs.  Clients and servers MUST NOT restrict
   DUIDs to the types defined in this document, as additional DUID types
   may be defined in the future.  It should be noted that an attempt to
   parse a DUID to obtain a client's link-layer address is unreliable,
   as there is no guarantee that the client is still using the same
   link-layer address as when it generated its DUID.  Also, such an
   attempt will be more and more unreliable as more clients adopt
   privacy measures such as those defined in [<a href="./rfc7844" title='"Anonymity Profiles for DHCP Clients"'>RFC7844</a>].  If this
   capability is required, it is recommended to rely on the Client
   Link-Layer Address option instead [<a href="./rfc6939" title='"Client Link-Layer Address Option in DHCPv6"'>RFC6939</a>].

   The DUID is carried in an option because it may be variable in length
   and because it is not required in all DHCP messages.  The DUID is
   designed to be unique across all DHCP clients and servers, and stable
   for any specific client or server.  That is, the DUID used by a
   client or server SHOULD NOT change over time if at all possible; for
   example, a device's DUID should not change as a result of a change in
   the device's network hardware or changes to virtual interfaces (e.g.,




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 32]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-33"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   logical PPP (over Ethernet) interfaces that may come and go in
   Customer Premises Equipment routers).  The client may change its DUID
   as specified in [<a href="./rfc7844" title='"Anonymity Profiles for DHCP Clients"'>RFC7844</a>].

   The motivation for having more than one type of DUID is that the DUID
   must be globally unique and must also be easy to generate.  The sort
   of globally unique identifier that is easy to generate for any given
   device can differ quite widely.  Also, some devices may not contain
   any persistent storage.  Retaining a generated DUID in such a device
   is not possible, so the DUID scheme must accommodate such devices.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.1.%20%20DUID%20Contents"></a><a class="selflink" href="#section-11.1" id="section-11.1">11.1</a>.  DUID Contents</span>

   A DUID consists of a 2-octet type code represented in network byte
   order, followed by a variable number of octets that make up the
   actual identifier.  The length of the DUID (not including the type
   code) is at least 1 octet and at most 128 octets.  The following
   types are currently defined:

      +------+------------------------------------------------------+
      | Type | Description                                          |
      +------+------------------------------------------------------+
      | 1    | Link-layer address plus time                         |
      | 2    | Vendor-assigned unique ID based on Enterprise Number |
      | 3    | Link-layer address                                   |
      | 4    | Universally Unique Identifier (UUID) [<a href="./rfc6355" title='"Definition of the UUID-Based DHCPv6 Unique Identifier (DUID-UUID)"'>RFC6355</a>]       |
      +------+------------------------------------------------------+

                            Table 2: DUID Types

   Formats for the variable field of the DUID for the first three of the
   above types are shown below.  The fourth type, DUID-UUID [<a href="./rfc6355" title='"Definition of the UUID-Based DHCPv6 Unique Identifier (DUID-UUID)"'>RFC6355</a>],
   can be used in situations where there is a UUID stored in a device's
   firmware settings.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.2.%20%20DUID%20Based%20on%20Link-Layer%20Address%20Plus%20Time%20%28DUID-LLT%29"></a><a class="selflink" href="#section-11.2" id="section-11.2">11.2</a>.  DUID Based on Link-Layer Address Plus Time (DUID-LLT)</span>

   This type of DUID consists of a 2-octet type field containing the
   value 1, a 2-octet hardware type code, and 4 octets containing a time
   value, followed by the link-layer address of any one network
   interface that is connected to the DHCP device at the time that the
   DUID is generated.  The time value is the time that the DUID is
   generated, represented in seconds since midnight (UTC), January 1,
   2000, modulo 2^32.  The hardware type MUST be a valid hardware type
   assigned by IANA; see [<a href="#ref-IANA-HARDWARE-TYPES">IANA-HARDWARE-TYPES</a>].  Both the time and the
   hardware type are stored in network byte order.  For Ethernet
   hardware types, the link-layer address is stored in canonical form,
   as described in [<a href="./rfc2464" title='"Transmission of IPv6 Packets over Ethernet Networks"'>RFC2464</a>].



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 33]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-34"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The following diagram illustrates the format of a DUID-LLT:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         DUID-Type (1)         |    hardware type (16 bits)    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        time (32 bits)                         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .             link-layer address (variable length)              .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 4: DUID-LLT Format

   The choice of network interface can be completely arbitrary, as long
   as that interface provides a globally unique link-layer address for
   the link type; the same DUID-LLT SHOULD be used in configuring all
   network interfaces connected to the device, regardless of which
   interface's link-layer address was used to generate the DUID-LLT.

   Clients and servers using this type of DUID MUST store the DUID-LLT
   in stable storage and MUST continue to use this DUID-LLT even if the
   network interface used to generate the DUID-LLT is removed.  Clients
   and servers that do not have any stable storage MUST NOT use this
   type of DUID.

   Clients and servers that use this DUID SHOULD attempt to configure
   the time prior to generating the DUID, if that is possible, and MUST
   use some sort of time source (for example, a real-time clock) in
   generating the DUID, even if that time source could not be configured
   prior to generating the DUID.  The use of a time source makes it
   unlikely that two identical DUID-LLTs will be generated if the
   network interface is removed from the client and another client then
   uses the same network interface to generate a DUID-LLT.  A collision
   between two DUID-LLTs is very unlikely even if the clocks have not
   been configured prior to generating the DUID.

   This method of DUID generation is recommended for all general-purpose
   computing devices such as desktop computers and laptop computers, and
   also for devices such as printers, routers, and so on, that contain
   some form of writable non-volatile storage.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 34]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-35"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   It is possible that this algorithm for generating a DUID could result
   in a client identifier collision.  A DHCP client that generates a
   DUID-LLT using this mechanism MUST provide an administrative
   interface that replaces the existing DUID with a newly generated
   DUID-LLT.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.3.%20%20DUID%20Assigned%20by%20Vendor%20Based%20on%20Enterprise%20Number%20%28DUID-EN%29"></a><a class="selflink" href="#section-11.3" id="section-11.3">11.3</a>.  DUID Assigned by Vendor Based on Enterprise Number (DUID-EN)</span>

   The vendor assigns this form of DUID to the device.  This DUID
   consists of the 4-octet vendor's registered Private Enterprise Number
   as maintained by IANA [<a href="#ref-IANA-PEN" title='"Private Enterprise Numbers"'>IANA-PEN</a>] followed by a unique identifier
   assigned by the vendor.  The following diagram summarizes the
   structure of a DUID-EN:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         DUID-Type (2)         |       enterprise-number       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   enterprise-number (contd)   |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      .                           identifier                          .
      .                       (variable length)                       .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 5: DUID-EN Format

   The source of the identifier is left up to the vendor defining it,
   but each identifier part of each DUID-EN MUST be unique to the device
   that is using it, and MUST be assigned to the device no later than at
   the first usage and stored in some form of non-volatile storage.
   This typically means being assigned during the manufacturing process
   in the case of physical devices or, in the case of virtual machines,
   when the image is created or booted for the first time.  The
   generated DUID SHOULD be recorded in non-erasable storage.  The
   enterprise-number is the vendor's registered Private Enterprise
   Number as maintained by IANA [<a href="#ref-IANA-PEN" title='"Private Enterprise Numbers"'>IANA-PEN</a>].  The enterprise-number is
   stored as an unsigned 32-bit number.












<span class="grey">Mrugalski, et al.            Standards Track                   [Page 35]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-36"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   An example DUID of this type might look like this:

      +---+---+---+---+---+---+---+---+
      | 0 | 2 | 0 | 0 | 0 |  9| 12|192|
      +---+---+---+---+---+---+---+---+
      |132|211| 3 | 0 | 9 | 18|
      +---+---+---+---+---+---+

                         Figure 6: DUID-EN Example

   This example includes the 2-octet type of 2 and the Enterprise Number
   (9), followed by 8 octets of identifier data (0x0CC084D303000912).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.4.%20%20DUID%20Based%20on%20Link-Layer%20Address%20%28DUID-LL%29"></a><a class="selflink" href="#section-11.4" id="section-11.4">11.4</a>.  DUID Based on Link-Layer Address (DUID-LL)</span>

   This type of DUID consists of 2 octets containing a DUID type of 3
   and a 2-octet network hardware type code, followed by the link-layer
   address of any one network interface that is permanently connected to
   the client or server device.  For example, a node that has a network
   interface implemented in a chip that is unlikely to be removed and
   used elsewhere could use a DUID-LL.  The hardware type MUST be a
   valid hardware type assigned by IANA; see [<a href="#ref-IANA-HARDWARE-TYPES">IANA-HARDWARE-TYPES</a>].  The
   hardware type is stored in network byte order.  The link-layer
   address is stored in canonical form, as described in [<a href="./rfc2464" title='"Transmission of IPv6 Packets over Ethernet Networks"'>RFC2464</a>].  The
   following diagram illustrates the format of a DUID-LL:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         DUID-Type (3)         |    hardware type (16 bits)    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .             link-layer address (variable length)              .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 7: DUID-LL Format

   The choice of network interface can be completely arbitrary, as long
   as that interface provides a unique link-layer address and is
   permanently attached to the device on which the DUID-LL is being
   generated.  The same DUID-LL SHOULD be used in configuring all
   network interfaces connected to the device, regardless of which
   interface's link-layer address was used to generate the DUID.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 36]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-37"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A DUID-LL is recommended for devices that have a permanently
   connected network interface with a link-layer address and do not have
   nonvolatile, writable stable storage.  A DUID-LL SHOULD NOT be used
   by DHCP clients or servers that cannot tell whether or not a network
   interface is permanently attached to the device on which the DHCP
   client is running.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.5.%20%20DUID%20Based%20on%20Universally%20Unique%20Identifier%20%28DUID-UUID%29"></a><a class="selflink" href="#section-11.5" id="section-11.5">11.5</a>.  DUID Based on Universally Unique Identifier (DUID-UUID)</span>

   This type of DUID consists of 16 octets containing a 128-bit UUID.
   [<a href="./rfc6355" title='"Definition of the UUID-Based DHCPv6 Unique Identifier (DUID-UUID)"'>RFC6355</a>] details when to use this type and how to pick an
   appropriate source of the UUID.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         DUID-Type (4)         |        UUID (128 bits)        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      |                                                               |
      |                                                               |
      |                                -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-

                        Figure 8: DUID-UUID Format

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20Identity%20Association"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  Identity Association</span>

   An Identity Association (IA) is a construct through which a server
   and a client can identify, group, and manage a set of related IPv6
   addresses or delegated prefixes.  Each IA consists of an IAID and
   associated configuration information.

   The IAID uniquely identifies the IA and MUST be chosen to be unique
   among the IAIDs for that IA type on the client (e.g., an IA_NA with
   an IAID of 0 and an IA_PD with an IAID of 0 are each considered
   unique).  The IAID is chosen by the client.  For any given use of an
   IA by the client, the IAID for that IA MUST be consistent across
   restarts of the DHCP client.  The client may maintain consistency by
   either storing the IAID in non-volatile storage or using an algorithm
   that will consistently produce the same IAID as long as the
   configuration of the client has not changed.  There may be no way for
   a client to maintain consistency of the IAIDs if it does not have
   non-volatile storage and the client's hardware configuration changes.
   If the client uses only one IAID, it can use a well-known value,
   e.g., zero.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 37]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-38"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If the client wishes to obtain a distinctly new address or prefix and
   deprecate the existing one, the client sends a Release message to the
   server for the IAs using the original IAID.  The client then creates
   a new IAID, to be used in future messages to obtain leases for the
   new IA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.1.%20%20Identity%20Associations%20for%20Address%20Assignment"></a><a class="selflink" href="#section-12.1" id="section-12.1">12.1</a>.  Identity Associations for Address Assignment</span>

   A client must associate at least one distinct IA with each of its
   network interfaces for which it is to request the assignment of IPv6
   addresses from a DHCP server.  The client uses the IAs assigned to an
   interface to obtain configuration information from a server for that
   interface.  Each such IA must be associated with exactly one
   interface.

   The configuration information in an IA_NA option consists of one or
   more IPv6 addresses along with the T1 and T2 values for the IA.  See
   <a href="#section-21.4">Section 21.4</a> for details regarding the representation of an IA_NA in
   a DHCP message.

   The configuration information in an IA_TA option consists of one or
   more IPv6 addresses.  See <a href="#section-21.5">Section 21.5</a> for details regarding the
   representation of an IA_TA in a DHCP message.

   Each address in an IA has a preferred lifetime and a valid lifetime,
   as defined in [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>].  The lifetimes are transmitted from the DHCP
   server to the client in the IA Address option (see <a href="#section-21.6">Section 21.6</a>).
   The lifetimes apply to the use of addresses; see <a href="./rfc4862#section-5.5.4">Section 5.5.4 of
   [RFC4862]</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.2.%20%20Identity%20Associations%20for%20Prefix%20Delegation"></a><a class="selflink" href="#section-12.2" id="section-12.2">12.2</a>.  Identity Associations for Prefix Delegation</span>

   An IA_PD is different from an IA for address assignment in that it
   does not need to be associated with exactly one interface.  One IA_PD
   can be associated with the client, with a set of interfaces, or with
   exactly one interface.  A client configured to request delegated
   prefixes must create at least one distinct IA_PD.  It may associate a
   distinct IA_PD with each of its downstream network interfaces and use
   that IA_PD to obtain a prefix for that interface from the server.

   The configuration information in an IA_PD option consists of one or
   more prefixes along with the T1 and T2 values for the IA_PD.  See
   <a href="#section-21.21">Section 21.21</a> for details regarding the representation of an IA_PD in
   a DHCP message.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 38]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-39"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Each delegated prefix in an IA has a preferred lifetime and a valid
   lifetime, as defined in [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>].  The lifetimes are transmitted
   from the DHCP server to the client in the IA Prefix option (see
   <a href="#section-21.22">Section 21.22</a>).  The lifetimes apply to the use of delegated
   prefixes; see <a href="./rfc4862#section-5.5.4">Section 5.5.4 of [RFC4862]</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Assignment%20to%20an%20IA"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Assignment to an IA</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.1.%20%20Selecting%20Addresses%20for%20Assignment%20to%20an%20IA_NA"></a><a class="selflink" href="#section-13.1" id="section-13.1">13.1</a>.  Selecting Addresses for Assignment to an IA_NA</span>

   A server selects addresses to be assigned to an IA_NA according to
   the address assignment policies determined by the server
   administrator and the specific information the server determines
   about the client from some combination of the following sources:

   -  The link to which the client is attached.  The server determines
      the link as follows:

      *  If the server receives the message directly from the client and
         the source address in the IP datagram in which the message was
         received is a link-local address, then the client is on the
         same link to which the interface over which the message was
         received is attached.

      *  If the server receives the message from a forwarding relay
         agent, then the client is on the same link as the one to which
         the interface, identified by the link-address field in the
         message from the relay agent, is attached.  According to
         [<a href="./rfc6221" title='"Lightweight DHCPv6 Relay Agent"'>RFC6221</a>], the server MUST ignore any link-address field whose
         value is zero.  The link-address in this case may come from any
         of the Relay-forward messages encapsulated in the received
         Relay-forward, and in general the most encapsulated (closest
         Relay-forward to the client) has the most useful value.

      *  If the server receives the message directly from the client and
         the source address in the IP datagram in which the message was
         received is not a link-local address, then the client is on the
         link identified by the source address in the IP datagram (note
         that this situation can occur only if the server has enabled
         the use of unicast message delivery by the client and the
         client has sent a message for which unicast delivery is
         allowed).

   -  The DUID supplied by the client.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 39]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-40"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   -  Other information in options supplied by the client, e.g., IA
      Address options (see <a href="#section-21.6">Section 21.6</a>) that include the client's
      requests for specific addresses.

   -  Other information in options supplied by the relay agent.

   By default, DHCP server implementations SHOULD NOT generate
   predictable addresses (see <a href="./rfc7721#section-4.7">Section 4.7 of [RFC7721]</a>).  Server
   implementers are encouraged to review [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>], [<a href="./rfc7824" title='"Privacy Considerations for DHCPv6"'>RFC7824</a>], and
   [<a href="./rfc7707" title='"Network Reconnaissance in IPv6 Networks"'>RFC7707</a>] as to possible considerations for how to generate
   addresses.

   A server MUST NOT assign an address that is otherwise reserved for
   some other purpose.  For example, a server MUST NOT assign addresses
   that use a reserved IPv6 Interface Identifier [<a href="./rfc5453" title='"Reserved IPv6 Interface Identifiers"'>RFC5453</a>] [<a href="./rfc7136" title='"Significance of IPv6 Interface Identifiers"'>RFC7136</a>]
   [<a href="#ref-IANA-RESERVED-IID">IANA-RESERVED-IID</a>].

   See [<a href="./rfc7969" title='"Customizing DHCP Configuration on the Basis of Network Topology"'>RFC7969</a>] for a more detailed discussion on how servers determine
   a client's location on the network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.2.%20%20Assignment%20of%20Temporary%20Addresses"></a><a class="selflink" href="#section-13.2" id="section-13.2">13.2</a>.  Assignment of Temporary Addresses</span>

   A client may request the assignment of temporary addresses (see
   [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>] for the definition of temporary addresses).  DHCP handling
   of address assignment is no different for temporary addresses.

   Clients ask for temporary addresses, and servers assign them.
   Temporary addresses are carried in the IA_TA option (see
   <a href="#section-21.5">Section 21.5</a>).  Each IA_TA option typically contains at least one
   temporary address for each of the prefixes on the link to which the
   client is attached.

   The lifetime of the assigned temporary address is set in the IA
   Address option (see <a href="#section-21.6">Section 21.6</a>) encapsulated in the IA_TA option.
   It is RECOMMENDED to set short lifetimes, typically shorter than
   TEMP_VALID_LIFETIME and TEMP_PREFERRED_LIFETIME (see <a href="./rfc4941#section-5">Section 5 of
   [RFC4941]</a>).

   A DHCP server implementation MAY generate temporary addresses,
   referring to the algorithm defined in <a href="./rfc4941#section-3.2.1">Section 3.2.1 of [RFC4941]</a>,
   with the additional condition that any new address is not the same as
   any assigned address.

   The server MAY update the DNS for a temporary address, as described
   in <a href="./rfc4941#section-4">Section 4 of [RFC4941]</a>.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 40]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-41"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   On the clients, by default, temporary addresses are preferred in
   source address selection, according to Rule 7 in <a href="./rfc6724#section-5">Section 5 of
   [RFC6724]</a>.  However, this policy can be overridden.

   One of the most important properties of a temporary address is to
   make it difficult to link the address to different actions over time.
   So, it is NOT RECOMMENDED for a client to renew temporary addresses,
   though DHCP provides for such a possibility (see <a href="#section-21.5">Section 21.5</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.3.%20%20Assignment%20of%20Prefixes%20for%20IA_PD"></a><a class="selflink" href="#section-13.3" id="section-13.3">13.3</a>.  Assignment of Prefixes for IA_PD</span>

   The mechanism through which the server selects prefix(es) for
   delegation is not specified in this document.  Examples of ways in
   which the server might select prefix(es) for a client include static
   assignment based on subscription to an ISP, dynamic assignment from a
   pool of available prefixes, and selection based on an external
   authority such as a RADIUS server using the Framed-IPv6-Prefix option
   as described in [<a href="./rfc3162" title='"RADIUS and IPv6"'>RFC3162</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.%20%20Transmission%20of%20Messages%20by%20a%20Client"></a><a class="selflink" href="#section-14" id="section-14">14</a>.  Transmission of Messages by a Client</span>

   Unless otherwise specified in this document or in a document that
   describes how IPv6 is carried over a specific type of link (for link
   types that do not support multicast), a client sends DHCP messages to
   the All_DHCP_Relay_Agents_and_Servers multicast address.

   DHCP servers SHOULD NOT check to see whether the Layer 2 address used
   was multicast or not, as long as the Layer 3 address was correct.

   A client uses multicast to reach all servers or an individual server.
   An individual server is indicated by specifying that server's DUID in
   a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>) in the client's
   message.  (All servers will receive this message, but only the
   indicated server will respond.)  All servers are indicated when this
   option is not supplied.

   A client may send some messages directly to a server using unicast,
   as described in <a href="#section-21.12">Section 21.12</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.%20%20Rate%20Limiting"></a><a class="selflink" href="#section-14.1" id="section-14.1">14.1</a>.  Rate Limiting</span>

   In order to avoid prolonged message bursts that may be caused by
   possible logic loops, a DHCP client MUST limit the rate of DHCP
   messages it transmits or retransmits.  One example is that a client
   obtains an address or delegated prefix but does not like the
   response, so it reverts back to the Solicit procedure, discovers the
   same (sole) server, requests an address or delegated prefix, and gets
   the same address or delegated prefix as before (as the server has



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 41]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-42"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   this previously requested lease assigned to this client).  This loop
   can repeat infinitely if there is not a quit/stop mechanism.
   Therefore, a client must not initiate transmissions too frequently.

   A recommended method for implementing the rate-limiting function is a
   token bucket (see <a href="./rfc3290#appendix-A">Appendix A of [RFC3290]</a>), limiting the average rate
   of transmission to a certain number in a certain time interval.  This
   method of bounding burstiness also guarantees that the long-term
   transmission rate will not be exceeded.

   A transmission rate limit SHOULD be configurable.  A possible default
   could be 20 packets in 20 seconds.

   For a device that has multiple interfaces, the limit MUST be enforced
   on a per-interface basis.

   Rate limiting of forwarded DHCP messages and server-side messages is
   out of scope for this specification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.2.%20%20Client%20Behavior%20when%20T1%20and%2For%20T2%20Are%200"></a><a class="selflink" href="#section-14.2" id="section-14.2">14.2</a>.  Client Behavior when T1 and/or T2 Are 0</span>

   In certain cases, T1 and/or T2 values may be set to 0.  Currently,
   there are three such cases:

   1.  a client received an IA_NA option (see <a href="#section-21.4">Section 21.4</a>) with a zero
       value

   2.  a client received an IA_PD option (see <a href="#section-21.21">Section 21.21</a>) with a zero
       value

   3.  a client received an IA_TA option (see <a href="#section-21.5">Section 21.5</a>) (which does
       not contain T1 and T2 fields and these leases are not generally
       renewed)

   This is an indication that the renew and rebind times are left to the
   discretion of the client.  However, they are not completely
   discretionary.

   When T1 and/or T2 values are set to 0, the client MUST choose a time
   to avoid packet storms.  In particular, it MUST NOT transmit
   immediately.  If the client received multiple IA options, it SHOULD
   pick renew and/or rebind transmission times so all IA options are
   handled in one exchange, if possible.  The client MUST choose renew
   and rebind times to not violate rate-limiting restrictions as defined
   in <a href="#section-14.1">Section 14.1</a>.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 42]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-43"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.%20%20Reliability%20of%20Client-Initiated%20Message%20Exchanges"></a><a class="selflink" href="#section-15" id="section-15">15</a>.  Reliability of Client-Initiated Message Exchanges</span>

   DHCP clients are responsible for reliable delivery of messages in the
   client-initiated message exchanges described in <a href="#section-18">Section 18</a>.  If a
   DHCP client fails to receive an expected response from a server, the
   client must retransmit its message according to the retransmission
   strategy described in this section.

   Note that the procedure described in this section is slightly
   modified when used with the Solicit message.  The modified procedure
   is described in <a href="#section-18.2.1">Section 18.2.1</a>.

   The client begins the message exchange by transmitting a message to
   the server.  The message exchange terminates when either (1) the
   client successfully receives the appropriate response or responses
   from a server or servers or (2) the message exchange is considered to
   have failed according to the retransmission mechanism described
   below.

   The client MUST update an "elapsed-time" value within an Elapsed Time
   option (see <a href="#section-21.9">Section 21.9</a>) in the retransmitted message.  In some
   cases, the client may also need to modify values in IA Address
   options (see <a href="#section-21.6">Section 21.6</a>) or IA Prefix options (see <a href="#section-21.22">Section 21.22</a>)
   if a valid lifetime for any of the client's leases expires before
   retransmission.  Thus, whenever this document refers to a
   "retransmission" of a client's message, it refers to both modifying
   the original message and sending this new message instance to the
   server.

   The client retransmission behavior is controlled and described by the
   following variables:

      RT      Retransmission timeout

      IRT     Initial retransmission time

      MRC     Maximum retransmission count

      MRT     Maximum retransmission time

      MRD     Maximum retransmission duration

      RAND    Randomization factor

   Specific values for each of these parameters relevant to the various
   messages are given in the subsections of <a href="#section-18.2">Section 18.2</a>, using values
   defined in Table 1 in <a href="#section-7.6">Section 7.6</a>.  The algorithm for RAND is common
   across all message transmissions.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 43]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-44"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   With each message transmission or retransmission, the client sets RT
   according to the rules given below.  If RT expires before the message
   exchange terminates, the client recomputes RT and retransmits the
   message.

   Each of the computations of a new RT includes a randomization factor
   (RAND), which is a random number chosen with a uniform distribution
   between -0.1 and +0.1.  The randomization factor is included to
   minimize synchronization of messages transmitted by DHCP clients.

   The algorithm for choosing a random number does not need to be
   cryptographically sound.  The algorithm SHOULD produce a different
   sequence of random numbers from each invocation of the DHCP client.

   RT for the first message transmission is based on IRT:

      RT = IRT + RAND*IRT

   RT for each subsequent message transmission is based on the previous
   value of RT:

      RT = 2*RTprev + RAND*RTprev

   MRT specifies an upper bound on the value of RT (disregarding the
   randomization added by the use of RAND).  If MRT has a value of 0,
   there is no upper limit on the value of RT.  Otherwise:

      if (RT &gt; MRT)
         RT = MRT + RAND*MRT

   MRC specifies an upper bound on the number of times a client may
   retransmit a message.  Unless MRC is zero, the message exchange fails
   once the client has transmitted the message MRC times.

   MRD specifies an upper bound on the length of time a client may
   retransmit a message.  Unless MRD is zero, the message exchange fails
   once MRD seconds have elapsed since the client first transmitted the
   message.

   If both MRC and MRD are non-zero, the message exchange fails whenever
   either of the conditions specified in the previous two paragraphs
   is met.

   If both MRC and MRD are zero, the client continues to transmit the
   message until it receives a response.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 44]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-45"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A client is not expected to listen for a response during the entire
   RT period and may turn off listening capabilities after waiting at
   least the shorter of RT and MAX_WAIT_TIME due to power consumption
   saving or other reasons.  Of course, a client MUST listen for a
   Reconfigure if it has negotiated for its use with the server.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.%20%20Message%20Validation"></a><a class="selflink" href="#section-16" id="section-16">16</a>.  Message Validation</span>

   This section describes which options are valid in which kinds of
   message types and explains what to do when a client or server
   receives a message that contains known options that are invalid for
   that message.  For example, an IA option is not allowed to appear in
   an Information-request message.

   Clients and servers MAY choose to either (1) extract information from
   such a message if the information is of use to the recipient or
   (2) ignore such a message completely and just discard it.

   If a server receives a message that it considers invalid, it MAY send
   a Reply message (or Advertise message, as appropriate) with a Server
   Identifier option (see <a href="#section-21.3">Section 21.3</a>), a Client Identifier option (see
   <a href="#section-21.2">Section 21.2</a>) (if one was included in the message), and a Status Code
   option (see <a href="#section-21.13">Section 21.13</a>) with status UnspecFail.

   Clients, relay agents, and servers MUST NOT discard messages that
   contain unknown options (or instances of vendor options with unknown
   enterprise-number values).  These should be ignored as if they were
   not present.  This is critical to provide for future extensions of
   DHCP.

   A server MUST discard any Solicit, Confirm, Rebind, or
   Information-request messages it receives with a Layer 3 unicast
   destination address.

   A client or server MUST discard any received DHCP messages with an
   unknown message type.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.1.%20%20Use%20of%20Transaction%20IDs"></a><a class="selflink" href="#section-16.1" id="section-16.1">16.1</a>.  Use of Transaction IDs</span>

   The "transaction-id" field holds a value used by clients and servers
   to synchronize server responses to client messages.  A client SHOULD
   generate a random number that cannot easily be guessed or predicted
   to use as the transaction ID for each new message it sends.  Note
   that if a client generates easily predictable transaction
   identifiers, it may become more vulnerable to certain kinds of
   attacks from off-path intruders.  A client MUST leave the transaction
   ID unchanged in retransmissions of a message.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 45]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-46"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.2.%20%20Solicit%20Message"></a><a class="selflink" href="#section-16.2" id="section-16.2">16.2</a>.  Solicit Message</span>

   Clients MUST discard any received Solicit messages.

   Servers MUST discard any Solicit messages that do not include a
   Client Identifier option or that do include a Server Identifier
   option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.3.%20%20Advertise%20Message"></a><a class="selflink" href="#section-16.3" id="section-16.3">16.3</a>.  Advertise Message</span>

   Clients MUST discard any received Advertise message that meets any of
   the following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>).

   -  the contents of the Client Identifier option do not match the
      client's DUID.

   -  the "transaction-id" field value does not match the value the
      client used in its Solicit message.

   Servers and relay agents MUST discard any received Advertise
   messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.4.%20%20Request%20Message"></a><a class="selflink" href="#section-16.4" id="section-16.4">16.4</a>.  Request Message</span>

   Clients MUST discard any received Request messages.

   Servers MUST discard any received Request message that meets any of
   the following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the contents of the Server Identifier option do not match the
      server's DUID.

   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>).








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 46]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-47"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.5.%20%20Confirm%20Message"></a><a class="selflink" href="#section-16.5" id="section-16.5">16.5</a>.  Confirm Message</span>

   Clients MUST discard any received Confirm messages.

   Servers MUST discard any received Confirm messages that do not
   include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>) or that do
   include a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.6.%20%20Renew%20Message"></a><a class="selflink" href="#section-16.6" id="section-16.6">16.6</a>.  Renew Message</span>

   Clients MUST discard any received Renew messages.

   Servers MUST discard any received Renew message that meets any of the
   following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the contents of the Server Identifier option do not match the
      server's identifier.

   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.7.%20%20Rebind%20Message"></a><a class="selflink" href="#section-16.7" id="section-16.7">16.7</a>.  Rebind Message</span>

   Clients MUST discard any received Rebind messages.

   Servers MUST discard any received Rebind messages that do not include
   a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>) or that do include a
   Server Identifier option (see <a href="#section-21.3">Section 21.3</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.8.%20%20Decline%20Message"></a><a class="selflink" href="#section-16.8" id="section-16.8">16.8</a>.  Decline Message</span>

   Clients MUST discard any received Decline messages.

   Servers MUST discard any received Decline message that meets any of
   the following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the contents of the Server Identifier option do not match the
      server's identifier.

   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>).




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 47]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-48"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.9.%20%20Release%20Message"></a><a class="selflink" href="#section-16.9" id="section-16.9">16.9</a>.  Release Message</span>

   Clients MUST discard any received Release messages.

   Servers MUST discard any received Release message that meets any of
   the following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the contents of the Server Identifier option do not match the
      server's identifier.

   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.10.%20%20Reply%20Message"></a><a class="selflink" href="#section-16.10" id="section-16.10">16.10</a>.  Reply Message</span>

   Clients MUST discard any received Reply message that meets any of the
   following conditions:

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).

   -  the "transaction-id" field in the message does not match the value
      used in the original message.

   If the client included a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   in the original message, the Reply message MUST include a Client
   Identifier option, and the contents of the Client Identifier option
   MUST match the DUID of the client.  If the client did not include a
   Client Identifier option in the original message, the Reply message
   MUST NOT include a Client Identifier option.

   Servers and relay agents MUST discard any received Reply messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.11.%20%20Reconfigure%20Message"></a><a class="selflink" href="#section-16.11" id="section-16.11">16.11</a>.  Reconfigure Message</span>

   Servers and relay agents MUST discard any received Reconfigure
   messages.

   Clients MUST discard any Reconfigure message that meets any of the
   following conditions:

   -  the message was not unicast to the client.

   -  the message does not include a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>).



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 48]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-49"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   -  the message does not include a Client Identifier option (see
      <a href="#section-21.2">Section 21.2</a>) that contains the client's DUID.

   -  the message does not include a Reconfigure Message option (see
      <a href="#section-21.19">Section 21.19</a>).

   -  the Reconfigure Message option msg-type is not a valid value.

   -  the message does not include authentication (such as RKAP; see
      <a href="#section-20.4">Section 20.4</a>) or fails authentication validation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.12.%20%20Information-request%20Message"></a><a class="selflink" href="#section-16.12" id="section-16.12">16.12</a>.  Information-request Message</span>

   Clients MUST discard any received Information-request messages.

   Servers MUST discard any received Information-request message that
   meets any of the following conditions:

   -  the message includes a Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>), and the DUID in the option does not match the
      server's DUID.

   -  the message includes an IA option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.13.%20%20Relay-forward%20Message"></a><a class="selflink" href="#section-16.13" id="section-16.13">16.13</a>.  Relay-forward Message</span>

   Clients MUST discard any received Relay-forward messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/16.14.%20%20Relay-reply%20Message"></a><a class="selflink" href="#section-16.14" id="section-16.14">16.14</a>.  Relay-reply Message</span>

   Clients and servers MUST discard any received Relay-reply messages.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/17.%20%20Client%20Source%20Address%20and%20Interface%20Selection"></a><a class="selflink" href="#section-17" id="section-17">17</a>.  Client Source Address and Interface Selection</span>

   The client's behavior regarding interface selection is different,
   depending on the purpose of the configuration.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/17.1.%20%20Source%20Address%20and%20Interface%20Selection%20for%20Address%20Assignment"></a><a class="selflink" href="#section-17.1" id="section-17.1">17.1</a>.  Source Address and Interface Selection for Address Assignment</span>

   When a client sends a DHCP message to the
   All_DHCP_Relay_Agents_and_Servers multicast address, it SHOULD send
   the message through the interface for which configuration information
   (including the addresses) is being requested.  However, the client
   MAY send the message through another interface if the interface for
   which configuration is being requested is a logical interface without
   direct link attachment or the client is certain that two interfaces
   are attached to the same link.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 49]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-50"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   When a client sends a DHCP message directly to a server using unicast
   (after receiving the Server Unicast option (see <a href="#section-21.12">Section 21.12</a>) from
   that server), the source address in the header of the IPv6 datagram
   MUST be an address assigned to the interface for which the client is
   interested in obtaining configuration and that is suitable for use by
   the server in responding to the client.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/17.2.%20%20Source%20Address%20and%20Interface%20Selection%20for%20Prefix%20Delegation"></a><a class="selflink" href="#section-17.2" id="section-17.2">17.2</a>.  Source Address and Interface Selection for Prefix Delegation</span>

   Delegated prefixes are not associated with a particular interface in
   the same way as addresses are for address assignment as mentioned in
   <a href="#section-17.1">Section 17.1</a> above.

   When a client sends a DHCP message for the purpose of prefix
   delegation, it SHOULD be sent on the interface associated with the
   upstream router (typically, connected to an ISP network); see
   [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>].  The upstream interface is typically determined by
   configuration.  This rule applies even in the case where a separate
   IA_PD is used for each downstream interface.

   When a client sends a DHCP message directly to a server using unicast
   (after receiving the Server Unicast option (see <a href="#section-21.12">Section 21.12</a>) from
   that server), the source address SHOULD be an address that is from
   the upstream interface and that is suitable for use by the server in
   responding to the client.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.%20%20DHCP%20Configuration%20Exchanges"></a><a class="selflink" href="#section-18" id="section-18">18</a>.  DHCP Configuration Exchanges</span>

   A client initiates a message exchange with a server or servers to
   acquire or update configuration information of interest.  A client
   has many reasons to initiate the configuration exchange.  Some of the
   more common ones are:

   1.  as part of the operating system configuration/bootstrap process,

   2.  when requested to do so by the application layer (through an
       operating-system-specific API),

   3.  when a Router Advertisement indicates that DHCPv6 is available
       for address configuration (see <a href="./rfc4861#section-4.2">Section 4.2 of [RFC4861]</a>),

   4.  as required to extend the lifetime of address(es) and/or
       delegated prefix(es), using Renew and Rebind messages, or

   5.  upon the receipt of a Reconfigure message, when requested to do
       so by a server.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 50]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-51"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client is responsible for creating IAs and requesting that a
   server assign addresses and/or delegated prefixes to the IAs.  The
   client first creates the IAs and assigns IAIDs to them.  The client
   then transmits a Solicit message containing the IA options describing
   the IAs.  The client MUST NOT be using any of the addresses or
   delegated prefixes for which it tries to obtain the bindings by
   sending the Solicit message.  In particular, if the client had some
   valid bindings and has chosen to start the server discovery process
   to obtain the same bindings from a different server, the client MUST
   stop using the addresses and delegated prefixes for the bindings that
   it had obtained from the previous server (see <a href="#section-18.2.7">Section 18.2.7</a> for more
   details on what "stop using" means in this context) and that it is
   now trying to obtain from a new server.

   A DHCP client that does not need to have a DHCP server assign IP
   addresses or delegated prefixes to it can obtain configuration
   information such as a list of available DNS servers [<a href="./rfc3646" title='"DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3646</a>] or NTP
   servers [<a href="./rfc5908" title='"Network Time Protocol (NTP) Server Option for DHCPv6"'>RFC5908</a>] through a single message and reply exchange with a
   DHCP server.  To obtain configuration information, the client first
   sends an Information-request message (see <a href="#section-18.2.6">Section 18.2.6</a>) to the
   All_DHCP_Relay_Agents_and_Servers multicast address.  Servers respond
   with a Reply message containing the configuration information for the
   client (see <a href="#section-18.3.6">Section 18.3.6</a>).

   To request the assignment of one or more addresses or delegated
   prefixes, a client first locates a DHCP server and then requests the
   assignment of addresses/prefixes and other configuration information
   from the server.  The client does this by sending the Solicit message
   (see <a href="#section-18.2.1">Section 18.2.1</a>) to the All_DHCP_Relay_Agents_and_Servers
   multicast address and collecting Advertise messages from the servers
   that respond to the client's message; the client then selects a
   server from which it wants to obtain configuration information.  This
   process is referred to as server discovery.  When the client has
   selected the server, it sends a Request message to that server as
   described in <a href="#section-18.2.2">Section 18.2.2</a>.

   A client willing to perform the Solicit/Reply message exchange
   described in <a href="#section-18.2.1">Section 18.2.1</a> includes a Rapid Commit option (see
   <a href="#section-21.14">Section 21.14</a>) in its Solicit message.

   Servers that can assign addresses or delegated prefixes to the IAs
   respond to the client with an Advertise message or Reply message if
   the client included a Rapid Commit option and the server is
   configured to accept it.

   If the server responds with an Advertise message, the client
   initiates a configuration exchange as described in <a href="#section-18.2.2">Section 18.2.2</a>.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 51]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-52"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A server may initiate a message exchange with a client by sending a
   Reconfigure message to cause the client to send a Renew, Rebind, or
   Information-request message to refresh its configuration information
   as soon as the Reconfigure message is received by the client.

   Figure 9 shows a timeline diagram of the messages exchanged between a
   client and two servers for the typical lifecycle of one or more
   leases.  This starts with the four-message Solicit/Advertise/
   Request/Reply exchange to obtain the lease(s), followed by a
   two-message Renew/Reply exchange to extend the lifetime on the
   lease(s), and then ends with a two-message Release/Reply exchange to
   end the client's use of the lease(s).

                Server                          Server
            (not selected)      Client        (selected)

                  v               v               v
                  |               |               |
                  |     Begins initialization     |
                  |               |               |
     start of     | _____________/|\_____________ |
     4-message    |/ Solicit      | Solicit      \|
     exchange     |               |               |
              Determines          |          Determines
             configuration        |         configuration
                  |               |               |
                  |\              |  ____________/|
                  | \________     | /Advertise    |
                  | Advertise\    |/              |
                  |           \   |               |
                  |      Collects Advertises      |
                  |             \ |               |
                  |     Selects configuration     |
                  |               |               |
                  | _____________/|\_____________ |
                  |/ Request      |  Request     \|
                  |               |               |
                  |               |     Commits configuration
                  |               |               |
     end of       |               | _____________/|
     4-message    |               |/ Reply        |
     exchange     |               |               |
                  |    Initialization complete    |
                  |               |               |
                  .               .               .
                  .               .               .
                  |   T1 (renewal) timer expires  |
                  |               |               |



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 52]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-53"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


     2-message    | _____________/|\_____________ |
     exchange     |/ Renew        |  Renew       \|
                  |               |               |
                  |               | Commits extended lease(s)
                  |               |               |
                  |               | _____________/|
                  |               |/ Reply        |
                  .               .               .
                  .               .               .
                  |               |               |
                  |      Graceful shutdown        |
                  |               |               |
     2-message    | _____________/|\_____________ |
     exchange     |/ Release      |  Release     \|
                  |               |               |
                  |               |         Discards lease(s)
                  |               |               |
                  |               | _____________/|
                  |               |/ Reply        |
                  |               |               |
                  v               v               v

   Figure 9: Timeline Diagram of the Messages Exchanged between a Client
      and Two Servers for the Typical Lifecycle of One or More Leases

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.1.%20%20A%20Single%20Exchange%20for%20Multiple%20IA%20Options"></a><a class="selflink" href="#section-18.1" id="section-18.1">18.1</a>.  A Single Exchange for Multiple IA Options</span>

   This document assumes that a client SHOULD use a single transaction
   for all of the IA options required on an interface; this simplifies
   the client implementation and reduces the potential number of
   transactions required (for the background on this design choice,
   refer to <a href="./rfc7550#section-4">Section 4 of [RFC7550]</a>).  To facilitate a client's use of a
   single transaction for all IA options, servers MUST return the same
   T1/T2 values for all IA options in a Reply (see Sections <a href="#section-18.3.2">18.3.2</a>,
   18.3.4, and 18.3.5) so that the client will generate a single
   transaction when renewing or rebinding its leases.  However, because
   some servers may not yet conform to this requirement, a client MUST
   be prepared to select appropriate T1/T2 times as described in
   <a href="#section-18.2.4">Section 18.2.4</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.%20%20Client%20Behavior"></a><a class="selflink" href="#section-18.2" id="section-18.2">18.2</a>.  Client Behavior</span>

   A client uses the Solicit message to discover DHCP servers configured
   to assign leases or return other configuration parameters on the link
   to which the client is attached.

   A client uses Request, Renew, Rebind, Release, and Decline messages
   during the normal lifecycle of addresses and delegated prefixes.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 53]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-54"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   When a client detects that it may have moved to a new link, it uses
   Confirm if it only has addresses and Rebind if it has delegated
   prefixes (and addresses).  It uses Information-request messages when
   it needs configuration information but no addresses and no prefixes.

   When a client requests multiple IA option types or multiple instances
   of the same IA types in a Solicit, Request, Renew, or Rebind, it is
   possible that the available server(s) may only be configured to offer
   a subset of them.  When possible, the client SHOULD use the best
   configuration available and continue to request the additional IAs in
   subsequent messages.  This allows the client to maintain a single
   session and state machine.  In practice, especially in the case of
   handling IA_NA and IA_PD requests [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>], this situation should be
   rare or a result of a temporary operational error.  Thus, it is more
   likely that the client will get all configuration if it continues, in
   each subsequent configuration exchange, to request all the
   configuration information it is programmed to try to obtain,
   including any stateful configuration options for which no results
   were returned in previous message exchanges.

   Upon receipt of a Reconfigure message from the server, a client
   responds with a Renew, Rebind, or Information-request message as
   indicated by the Reconfigure Message option (see <a href="#section-21.19">Section 21.19</a>).  The
   client SHOULD be suspicious of the Reconfigure message (they may be
   faked), and it MUST NOT abandon any resources it might have already
   obtained.  The client SHOULD treat the Reconfigure message as if the
   T1 timer had expired.  The client will expect the server to send IAs
   and/or other configuration information to the client in a Reply
   message.

   If the client has a source address of sufficient scope that can be
   used by the server as a return address and the client has received a
   Server Unicast option (see <a href="#section-21.12">Section 21.12</a>) from the server, the client
   SHOULD unicast any Request, Renew, Release, and Decline messages to
   the server.

   Use of unicast may avoid delays due to the relaying of messages by
   relay agents, as well as avoid overhead on servers due to the
   delivery of client messages to multiple servers.  However, requiring
   the client to relay all DHCP messages through a relay agent enables
   the inclusion of relay agent options in all messages sent by the
   client.  The server should enable the use of unicast only when relay
   agent options will not be used.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 54]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-55"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.1.%20%20Creation%20and%20Transmission%20of%20Solicit%20Messages"></a><a class="selflink" href="#section-18.2.1" id="section-18.2.1">18.2.1</a>.  Creation and Transmission of Solicit Messages</span>

   The client sets the "msg-type" field to SOLICIT.  The client
   generates a transaction ID and inserts this value in the
   "transaction-id" field.

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.  The client includes IA options for
   any IAs to which it wants the server to assign leases.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   The client uses IA_NA options (see <a href="#section-21.4">Section 21.4</a>) to request the
   assignment of non-temporary addresses, IA_TA options (see
   <a href="#section-21.5">Section 21.5</a>) to request the assignment of temporary addresses, and
   IA_PD options (see <a href="#section-21.21">Section 21.21</a>) to request prefix delegation.
   IA_NA, IA_TA, or IA_PD options, or a combination of all, can be
   included in DHCP messages.  In addition, multiple instances of any IA
   option type can be included.

   The client MAY include addresses in IA Address options (see
   <a href="#section-21.6">Section 21.6</a>) encapsulated within IA_NA and IA_TA options as hints to
   the server about the addresses for which the client has a preference.

   The client MAY include values in IA Prefix options (see
   <a href="#section-21.22">Section 21.22</a>) encapsulated within IA_PD options as hints for the
   delegated prefix and/or prefix length for which the client has a
   preference.  See <a href="#section-18.2.4">Section 18.2.4</a> for more on prefix-length hints.

   The client MUST include an Option Request option (ORO) (see
   <a href="#section-21.7">Section 21.7</a>) to request the SOL_MAX_RT option (see <a href="#section-21.24">Section 21.24</a>)
   and any other options the client is interested in receiving.  The
   client MAY additionally include instances of those options that are
   identified in the Option Request option, with data values as hints to
   the server about parameter values the client would like to have
   returned.

   The client includes a Reconfigure Accept option (see <a href="#section-21.20">Section 21.20</a>)
   if the client is willing to accept Reconfigure messages from the
   server.

   The client MUST NOT include any other options in the Solicit message,
   except as specifically allowed in the definition of individual
   options.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 55]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-56"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The first Solicit message from the client on the interface SHOULD be
   delayed by a random amount of time between 0 and SOL_MAX_DELAY.  This
   random delay helps desynchronize clients that start a DHCP session at
   the same time, such as after recovery from a power failure or after a
   router outage after seeing that DHCP is available in Router
   Advertisement messages (see <a href="./rfc4861#section-4.2">Section 4.2 of [RFC4861]</a>).

   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     SOL_TIMEOUT

      MRT     SOL_MAX_RT

      MRC     0

      MRD     0

   A client that wishes to use the Rapid Commit two-message exchange
   includes a Rapid Commit option (see <a href="#section-21.14">Section 21.14</a>) in its Solicit
   message.  The client may receive a number of different replies from
   different servers.  The client will make note of any valid Advertise
   messages that it receives.  The client will discard any Reply
   messages that do not contain the Rapid Commit option.

   Upon receipt of a valid Reply with the Rapid Commit option, the
   client processes the message as described in <a href="#section-18.2.10">Section 18.2.10</a>.

   At the end of the first RT period, if no suitable Reply messages are
   received but the client has valid Advertise messages, then the client
   processes the Advertise as described in <a href="#section-18.2.9">Section 18.2.9</a>.

   If the client subsequently receives a valid Reply message that
   includes a Rapid Commit option, it does one of the following:

   -  processes the Reply message as described in <a href="#section-18.2.10">Section 18.2.10</a> and
      discards any Reply messages received in response to the Request
      message

   -  processes any Reply messages received in response to the Request
      message and discards the Reply message that includes the Rapid
      Commit option

   If the client is waiting for an Advertise message, the mechanism
   described in <a href="#section-15">Section 15</a> is modified as follows for use in the
   transmission of Solicit messages.  The message exchange is not
   terminated by the receipt of an Advertise before the first RT has
   elapsed.  Rather, the client collects valid Advertise messages until



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 56]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-57"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   the first RT has elapsed.  Also, the first RT MUST be selected to be
   strictly greater than IRT by choosing RAND to be strictly greater
   than 0.

   A client MUST collect valid Advertise messages for the first
   RT seconds, unless it receives a valid Advertise message with a
   preference value of 255.  The preference value is carried in the
   Preference option (see <a href="#section-21.8">Section 21.8</a>).  Any valid Advertise that does
   not include a Preference option is considered to have a preference
   value of 0.  If the client receives a valid Advertise message that
   includes a Preference option with a preference value of 255, the
   client immediately begins a client-initiated message exchange (as
   described in <a href="#section-18.2.2">Section 18.2.2</a>) by sending a Request message to the
   server from which the Advertise message was received.  If the client
   receives a valid Advertise message that does not include a Preference
   option with a preference value of 255, the client continues to wait
   until the first RT elapses.  If the first RT elapses and the client
   has received a valid Advertise message, the client SHOULD continue
   with a client-initiated message exchange by sending a Request
   message.

   If the client does not receive any valid Advertise messages before
   the first RT has elapsed, it then applies the retransmission
   mechanism described in <a href="#section-15">Section 15</a>.  The client terminates the
   retransmission process as soon as it receives any valid Advertise
   message, and the client acts on the received Advertise message
   without waiting for any additional Advertise messages.

   A DHCP client SHOULD choose MRC and MRD values of 0.  If the DHCP
   client is configured with either MRC or MRD set to a value other than
   0, it MUST stop trying to configure the interface if the message
   exchange fails.  After the DHCP client stops trying to configure the
   interface, it SHOULD restart the reconfiguration process after some
   external event, such as user input, system restart, or when the
   client is attached to a new link.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.2.%20%20Creation%20and%20Transmission%20of%20Request%20Messages"></a><a class="selflink" href="#section-18.2.2" id="section-18.2.2">18.2.2</a>.  Creation and Transmission of Request Messages</span>

   The client uses a Request message to populate IAs with leases and
   obtain other configuration information.  The client includes one or
   more IA options in the Request message.  The server then returns
   leases and other information about the IAs to the client in IA
   options in a Reply message.

   The client sets the "msg-type" field to REQUEST.  The client
   generates a transaction ID and inserts this value in the
   "transaction-id" field.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 57]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-58"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client MUST include the identifier of the destination server in a
   Server Identifier option (see <a href="#section-21.3">Section 21.3</a>).

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.  The client adds any other
   appropriate options, including one or more IA options.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   The client MUST include an Option Request option (see <a href="#section-21.7">Section 21.7</a>)
   to request the SOL_MAX_RT option (see <a href="#section-21.24">Section 21.24</a>) and any other
   options the client is interested in receiving.  The client MAY
   additionally include instances of those options that are identified
   in the Option Request option, with data values as hints to the server
   about parameter values the client would like to have returned.

   The client includes a Reconfigure Accept option (see <a href="#section-21.20">Section 21.20</a>)
   if the client is willing to accept Reconfigure messages from the
   server.

   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     REQ_TIMEOUT

      MRT     REQ_MAX_RT

      MRC     REQ_MAX_RC

      MRD     0

   If the message exchange fails, the client takes an action based on
   the client's local policy.  Examples of actions the client might take
   include the following:

   -  Select another server from a list of servers known to the client
      -- for example, servers that responded with an Advertise message.

   -  Initiate the server discovery process described in <a href="#section-18">Section 18</a>.

   -  Terminate the configuration process and report failure.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 58]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-59"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.3.%20%20Creation%20and%20Transmission%20of%20Confirm%20Messages"></a><a class="selflink" href="#section-18.2.3" id="section-18.2.3">18.2.3</a>.  Creation and Transmission of Confirm Messages</span>

   The client uses a Confirm message when it has only addresses (no
   delegated prefixes) assigned by a DHCP server to determine if it is
   still connected to the same link when the client detects a change in
   network information as described in <a href="#section-18.2.12">Section 18.2.12</a>.

   The client sets the "msg-type" field to CONFIRM.  The client
   generates a transaction ID and inserts this value in the
   "transaction-id" field.

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   The client includes IA options for all of the IAs assigned to the
   interface for which the Confirm message is being sent.  The IA
   options include all of the addresses the client currently has
   associated with those IAs.  The client SHOULD set the T1 and T2
   fields in any IA_NA options (see <a href="#section-21.4">Section 21.4</a>) and the
   preferred-lifetime and valid-lifetime fields in the IA Address
   options (see <a href="#section-21.6">Section 21.6</a>) to 0, as the server will ignore these
   fields.

   The first Confirm message from the client on the interface MUST be
   delayed by a random amount of time between 0 and CNF_MAX_DELAY.  The
   client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     CNF_TIMEOUT

      MRT     CNF_MAX_RT

      MRC     0

      MRD     CNF_MAX_RD

   If the client receives no responses before the message transmission
   process terminates, as described in <a href="#section-15">Section 15</a>, the client SHOULD
   continue to use any leases, using the last known lifetimes for those
   leases, and SHOULD continue to use any other previously obtained
   configuration parameters.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 59]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-60"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.4.%20%20Creation%20and%20Transmission%20of%20Renew%20Messages"></a><a class="selflink" href="#section-18.2.4" id="section-18.2.4">18.2.4</a>.  Creation and Transmission of Renew Messages</span>

   To extend the preferred and valid lifetimes for the leases assigned
   to the IAs and obtain new addresses or delegated prefixes for IAs,
   the client sends a Renew message to the server from which the leases
   were obtained; the Renew message includes IA options for the IAs
   whose lease lifetimes are to be extended.  The client includes IA
   Address options (see <a href="#section-21.6">Section 21.6</a>) within IA_NA (see <a href="#section-21.4">Section 21.4</a>)
   and IA_TA (see <a href="#section-21.5">Section 21.5</a>) options for the addresses assigned to
   the IAs.  The client includes IA Prefix options (see <a href="#section-21.22">Section 21.22</a>)
   within IA_PD options (see <a href="#section-21.21">Section 21.21</a>) for the delegated prefixes
   assigned to the IAs.

   The server controls the time at which the client should contact the
   server to extend the lifetimes on assigned leases through the T1 and
   T2 values assigned to an IA.  However, as the client SHOULD
   renew/rebind all IAs from the server at the same time, the client
   MUST select T1 and T2 times from all IA options that will guarantee
   that the client initiates transmissions of Renew/Rebind messages not
   later than at the T1/T2 times associated with any of the client's
   bindings (earliest T1/T2).

   At time T1, the client initiates a Renew/Reply message exchange to
   extend the lifetimes on any leases in the IA.

   A client MUST also initiate a Renew/Reply message exchange before
   time T1 if the client's link-local address used in previous
   interactions with the server is no longer valid and it is willing to
   receive Reconfigure messages.

   If T1 or T2 had been set to 0 by the server (for an IA_NA or IA_PD)
   or there are no T1 or T2 times (for an IA_TA) in a previous Reply,
   the client may, at its discretion, send a Renew or Rebind message,
   respectively.  The client MUST follow the rules defined in
   <a href="#section-14.2">Section 14.2</a>.

   The client sets the "msg-type" field to RENEW.  The client generates
   a transaction ID and inserts this value in the "transaction-id"
   field.

   The client MUST include a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>)
   in the Renew message, identifying the server with which the client
   most recently communicated.

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.  The client adds any appropriate
   options, including one or more IA options.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 60]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-61"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   For IAs to which leases have been assigned, the client includes a
   corresponding IA option containing an IA Address option for each
   address assigned to the IA and an IA Prefix option for each prefix
   assigned to the IA.  The client MUST NOT include addresses and
   prefixes in any IA option that the client did not obtain from the
   server or that are no longer valid (that have a valid lifetime of 0).

   The client MAY include an IA option for each binding it desires but
   has been unable to obtain.  In this case, if the client includes the
   IA_PD option to request prefix delegation, the client MAY include the
   IA Prefix option encapsulated within the IA_PD option, with the
   "IPv6-prefix" field set to 0 and the "prefix-length" field set to the
   desired length of the prefix to be delegated.  The server MAY use
   this value as a hint for the prefix length.  The client SHOULD NOT
   include an IA Prefix option with the "IPv6-prefix" field set to 0
   unless it is supplying a hint for the prefix length.

   The client includes an Option Request option (see <a href="#section-21.7">Section 21.7</a>) to
   request the SOL_MAX_RT option (see <a href="#section-21.24">Section 21.24</a>) and any other
   options the client is interested in receiving.  The client MAY
   include options with data values as hints to the server about
   parameter values the client would like to have returned.

   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     REN_TIMEOUT

      MRT     REN_MAX_RT

      MRC     0

      MRD     Remaining time until earliest T2

   The message exchange is terminated when the earliest time T2 is
   reached.  While the client is responding to a Reconfigure, the client
   ignores and discards any additional Reconfigure messages it may
   receive.

   The message exchange is terminated when the earliest time T2 is
   reached, at which point the client begins the Rebind message exchange
   (see <a href="#section-18.2.5">Section 18.2.5</a>).





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 61]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-62"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.5.%20%20Creation%20and%20Transmission%20of%20Rebind%20Messages"></a><a class="selflink" href="#section-18.2.5" id="section-18.2.5">18.2.5</a>.  Creation and Transmission of Rebind Messages</span>

   At time T2 (which will only be reached if the server to which the
   Renew message was sent starting at time T1 has not responded), the
   client initiates a Rebind/Reply message exchange with any available
   server.

   A Rebind is also used to verify delegated prefix bindings but with
   different retransmission parameters as described in <a href="#section-18.2.3">Section 18.2.3</a>.

   The client constructs the Rebind message as described in
   <a href="#section-18.2.4">Section 18.2.4</a>, with the following differences:

   -  The client sets the "msg-type" field to REBIND.

   -  The client does not include the Server Identifier option (see
      <a href="#section-21.3">Section 21.3</a>) in the Rebind message.

   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     REB_TIMEOUT

      MRT     REB_MAX_RT

      MRC     0

      MRD     Remaining time until valid lifetimes of all leases in all
              IAs have expired

   If all leases for an IA have expired, the client may choose to
   include this IA in subsequent Rebind messages to indicate that the
   client is interested in assignment of the leases to this IA.

   The message exchange is terminated when the valid lifetimes of all
   leases across all IAs have expired, at which time the client uses the
   Solicit message to locate a new DHCP server and sends a Request for
   the expired IAs to the new server.  If the terminated Rebind exchange
   was initiated as a result of receiving a Reconfigure message, the
   client ignores and discards the Reconfigure message.











<span class="grey">Mrugalski, et al.            Standards Track                   [Page 62]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-63"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.6.%20%20Creation%20and%20Transmission%20of%20Information-request%20Messages"></a><a class="selflink" href="#section-18.2.6" id="section-18.2.6">18.2.6</a>.  Creation and Transmission of Information-request Messages</span>

   The client uses an Information-request message to obtain
   configuration information without having addresses and/or delegated
   prefixes assigned to it.

   The client sets the "msg-type" field to INFORMATION-REQUEST.  The
   client generates a transaction ID and inserts this value in the
   "transaction-id" field.

   The client SHOULD include a Client Identifier option (see
   <a href="#section-21.2">Section 21.2</a>) to identify itself to the server (however, see
   <a href="./rfc7844#section-4.3.1">Section 4.3.1 of [RFC7844]</a> for reasons why a client may not want to
   include this option).  If the client does not include a Client
   Identifier option, the server will not be able to return any
   client-specific options to the client, or the server may choose not
   to respond to the message at all.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   The client MUST include an Option Request option (see <a href="#section-21.7">Section 21.7</a>)
   to request the INF_MAX_RT option (see <a href="#section-21.25">Section 21.25</a>), the Information
   Refresh Time option (see <a href="#section-21.23">Section 21.23</a>), and any other options the
   client is interested in receiving.  The client MAY include options
   with data values as hints to the server about parameter values the
   client would like to have returned.

   When responding to a Reconfigure, the client includes a Server
   Identifier option (see <a href="#section-21.3">Section 21.3</a>) with the identifier from the
   Reconfigure message to which the client is responding.

   The first Information-request message from the client on the
   interface MUST be delayed by a random amount of time between 0 and
   INF_MAX_DELAY.  The client transmits the message according to
   <a href="#section-15">Section 15</a>, using the following parameters:

      IRT     INF_TIMEOUT

      MRT     INF_MAX_RT

      MRC     0

      MRD     0






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 63]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-64"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.7.%20%20Creation%20and%20Transmission%20of%20Release%20Messages"></a><a class="selflink" href="#section-18.2.7" id="section-18.2.7">18.2.7</a>.  Creation and Transmission of Release Messages</span>

   To release one or more leases, a client sends a Release message to
   the server.

   The client sets the "msg-type" field to RELEASE.  The client
   generates a transaction ID and places this value in the
   "transaction-id" field.

   The client places the identifier of the server that allocated the
   lease(s) in a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>).

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.

   The client includes options containing the IAs for the leases it is
   releasing in the "options" field.  The leases to be released MUST be
   included in the IAs.  Any leases for the IAs the client wishes to
   continue to use MUST NOT be added to the IAs.

   The client MUST stop using all of the leases being released before
   the client begins the Release message exchange process.  For an
   address, this means the address MUST have been removed from the
   interface.  For a delegated prefix, this means the prefix MUST have
   been advertised with a Preferred Lifetime and a Valid Lifetime of 0
   in a Router Advertisement message as described in part (e) of
   <a href="./rfc4862#section-5.5.3">Section 5.5.3 of [RFC4862]</a>; also see requirement L-13 in <a href="./rfc7084#section-4.3">Section 4.3
   of [RFC7084]</a>.

   The client MUST NOT use any of the addresses it is releasing as the
   source address in the Release message or in any subsequently
   transmitted message.

   Because Release messages may be lost, the client should retransmit
   the Release if no Reply is received.  However, there are scenarios
   where the client may not wish to wait for the normal retransmission
   timeout before giving up (e.g., on power down).  Implementations
   SHOULD retransmit one or more times but MAY choose to terminate the
   retransmission procedure early.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 64]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-65"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     REL_TIMEOUT

      MRT     0

      MRC     REL_MAX_RC

      MRD     0

   If leases are released but the Reply from a DHCP server is lost, the
   client will retransmit the Release message, and the server may
   respond with a Reply indicating a status of NoBinding.  Therefore,
   the client does not treat a Reply message with a status of NoBinding
   in a Release message exchange as if it indicates an error.

   Note that if the client fails to release the lease, each lease
   assigned to the IA will be reclaimed by the server when the valid
   lifetime of that lease expires.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.8.%20%20Creation%20and%20Transmission%20of%20Decline%20Messages"></a><a class="selflink" href="#section-18.2.8" id="section-18.2.8">18.2.8</a>.  Creation and Transmission of Decline Messages</span>

   If a client detects that one or more addresses assigned to it by a
   server are already in use by another node, the client sends a Decline
   message to the server to inform it that the address is suspect.

   The Decline message is not used in prefix delegation; thus, the
   client MUST NOT include IA_PD options (see <a href="#section-21.21">Section 21.21</a>) in the
   Decline message.

   The client sets the "msg-type" field to DECLINE.  The client
   generates a transaction ID and places this value in the
   "transaction-id" field.

   The client places the identifier of the server that allocated the
   address(es) in a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>).

   The client MUST include a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>)
   to identify itself to the server.

   The client MUST include an Elapsed Time option (see <a href="#section-21.9">Section 21.9</a>) to
   indicate how long the client has been trying to complete the current
   DHCP message exchange.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 65]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-66"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client includes options containing the IAs for the addresses it
   is declining in the "options" field.  The addresses to be declined
   MUST be included in the IAs.  Any addresses for the IAs the client
   wishes to continue to use should not be added to the IAs.

   The client MUST NOT use any of the addresses it is declining as the
   source address in the Decline message or in any subsequently
   transmitted message.

   The client transmits the message according to <a href="#section-15">Section 15</a>, using the
   following parameters:

      IRT     DEC_TIMEOUT

      MRT     0

      MRC     DEC_MAX_RC

      MRD     0

   If addresses are declined but the Reply from a DHCP server is lost,
   the client will retransmit the Decline message, and the server may
   respond with a Reply indicating a status of NoBinding.  Therefore,
   the client does not treat a Reply message with a status of NoBinding
   in a Decline message exchange as if it indicates an error.

   The client SHOULD NOT send a Release message for other bindings it
   may have received just because it sent a Decline message.  The client
   SHOULD retain the non-conflicting bindings.  The client SHOULD treat
   the failure to acquire a binding (due to the conflict) as equivalent
   to not having received the binding, insofar as how it behaves when
   sending Renew and Rebind messages.



















<span class="grey">Mrugalski, et al.            Standards Track                   [Page 66]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-67"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.9.%20%20Receipt%20of%20Advertise%20Messages"></a><a class="selflink" href="#section-18.2.9" id="section-18.2.9">18.2.9</a>.  Receipt of Advertise Messages</span>

   Upon receipt of one or more valid Advertise messages, the client
   selects one or more Advertise messages based upon the following
   criteria.

   -  Those Advertise messages with the highest server preference value
      SHOULD be preferred over all other Advertise messages.  The client
      MAY choose a less preferred server if that server has a better set
      of advertised parameters, such as the available set of IAs, as
      well as the set of other configuration options advertised.

   -  Within a group of Advertise messages with the same server
      preference value, a client MAY select those servers whose
      Advertise messages advertise information of interest to the
      client.

   Once a client has selected Advertise message(s), the client will
   typically store information about each server, such as the server
   preference value, addresses advertised, when the advertisement was
   received, and so on.

   In practice, this means that the client will maintain independent
   per-IA state machines for each selected server.

   If the client needs to select an alternate server in the case that a
   chosen server does not respond, the client chooses the next server
   according to the criteria given above.

   The client MUST process any SOL_MAX_RT option (see <a href="#section-21.24">Section 21.24</a>) and
   INF_MAX_RT option (see <a href="#section-21.25">Section 21.25</a>) present in an Advertise
   message, even if the message contains a Status Code option (see
   <a href="#section-21.13">Section 21.13</a>) indicating a failure, and the Advertise message will
   be discarded by the client.  A client SHOULD only update its
   SOL_MAX_RT and INF_MAX_RT values if all received Advertise messages
   that contained the corresponding option specified the same value;
   otherwise, it should use the default value (see <a href="#section-7.6">Section 7.6</a>).

   The client MUST ignore any Advertise message that contains no
   addresses (IA Address options (see <a href="#section-21.6">Section 21.6</a>) encapsulated in
   IA_NA options (see <a href="#section-21.4">Section 21.4</a>) or IA_TA options (see <a href="#section-21.5">Section 21.5</a>))
   and no delegated prefixes (IA Prefix options (see <a href="#section-21.22">Section 21.22</a>)
   encapsulated in IA_PD options (see <a href="#section-21.21">Section 21.21</a>)), with the
   exception that the client:

   -  MUST process an included SOL_MAX_RT option and

   -  MUST process an included INF_MAX_RT option.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 67]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-68"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A client can record in an activity log or display to the user any
   associated status message(s).

   The client ignoring an Advertise message MUST NOT restart the Solicit
   retransmission timer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.10.%20%20Receipt%20of%20Reply%20Messages"></a><a class="selflink" href="#section-18.2.10" id="section-18.2.10">18.2.10</a>.  Receipt of Reply Messages</span>

   Upon the receipt of a valid Reply message in response to a Solicit
   with a Rapid Commit option (see <a href="#section-21.14">Section 21.14</a>), Request, Confirm,
   Renew, Rebind, or Information-request message, the client extracts
   the top-level Status Code option (see <a href="#section-21.13">Section 21.13</a>) if present.

   The client MUST process any SOL_MAX_RT option (see <a href="#section-21.24">Section 21.24</a>) and
   INF_MAX_RT option (see <a href="#section-21.25">Section 21.25</a>) present in a Reply message,
   even if the message contains a Status Code option indicating a
   failure.

   If the client receives a Reply message with a status code of
   UnspecFail, the server is indicating that it was unable to process
   the client's message due to an unspecified failure condition.  If the
   client retransmits the original message to the same server to retry
   the desired operation, the client MUST limit the rate at which it
   retransmits the message and limit the duration of the time during
   which it retransmits the message (see <a href="#section-14.1">Section 14.1</a>).

   If the client receives a Reply message with a status code of
   UseMulticast, the client records the receipt of the message and sends
   subsequent messages to the server through the interface on which the
   message was received using multicast.  The client resends the
   original message using multicast.

   Otherwise (no status code or another status code), the client
   processes the Reply as described below based on the original message
   for which the Reply was received.

   The client MAY choose to report any status code or message from the
   Status Code option in the Reply message.

   When a client received a configuration option in an earlier Reply and
   then sends a Renew, Rebind, or Information-request and the requested
   option is not present in the Reply, the client SHOULD stop using the
   previously received configuration information.  In other words, the
   client should behave as if it never received this configuration
   option and return to the relevant default state.  If there is no
   viable way to stop using the received configuration information, the
   values received/configured from the option MAY persist if there are
   no other sources for that data and they have no external impact.  For



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 68]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-69"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   example, a client that previously received a Client FQDN option (see
   [<a href="./rfc4704" title='"The Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Client Fully Qualified Domain Name (FQDN) Option"'>RFC4704</a>]) and used it to set up its hostname is allowed to continue
   using it if there is no reasonable way for a node to unset its
   hostname and it has no external impact.  As a counter-example, a
   client that previously received an NTP server address from the DHCP
   server and does not receive it anymore MUST stop using the configured
   NTP server address.  The client SHOULD be open to other sources of
   the same configuration information.  This behavior does not apply to
   any IA options, as their processing is described in detail in the
   next section.

   When a client receives a requested option that has an updated value
   from what was previously received, the client SHOULD make use of that
   updated value as soon as possible for its configuration information.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.10.1.%20%20Reply%20for%20Solicit%20%28with%20Rapid%20Commit%29%2C%20Request%2C%20Renew%2C%20or"></a><a class="selflink" href="#section-18.2.10.1" id="section-18.2.10.1">18.2.10.1</a>.  Reply for Solicit (with Rapid Commit), Request, Renew, or</span>
<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/Rebind"></a>            Rebind</span>

   If the client receives a NotOnLink status from the server in response
   to a Solicit (with a Rapid Commit option; see <a href="#section-21.14">Section 21.14</a>) or a
   Request, the client can either reissue the message without specifying
   any addresses or restart the DHCP server discovery process (see
   <a href="#section-18">Section 18</a>).

   If the Reply was received in response to a Solicit (with a Rapid
   Commit option), Request, Renew, or Rebind message, the client updates
   the information it has recorded about IAs from the IA options
   contained in the Reply message:

   -  Calculate T1 and T2 times (based on T1 and T2 values sent in the
      packet and the packet reception time), if appropriate for the
      IA type.

   -  Add any new leases in the IA option to the IA as recorded by the
      client.

   -  Update lifetimes for any leases in the IA option that the client
      already has recorded in the IA.

   -  Discard any leases from the IA, as recorded by the client, that
      have a valid lifetime of 0 in the IA Address or IA Prefix option.

   -  Leave unchanged any information about leases the client has
      recorded in the IA but that were not included in the IA from the
      server.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 69]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-70"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If the client can operate with the addresses and/or prefixes obtained
   from the server:

   -  The client uses the addresses, delegated prefixes, and other
      information from any IAs that do not contain a Status Code option
      with the NoAddrsAvail or NoPrefixAvail status code.  The client
      MAY include the IAs for which it received the NoAddrsAvail or
      NoPrefixAvail status code, with no addresses or prefixes, in
      subsequent Renew and Rebind messages sent to the server, to retry
      obtaining the addresses or prefixes for these IAs.

   -  The client MUST perform duplicate address detection as per
      <a href="./rfc4862#section-5.4">Section 5.4 of [RFC4862]</a>, which does list some exceptions, on each
      of the received addresses in any IAs on which it has not performed
      duplicate address detection during processing of any of the
      previous Reply messages from the server.  The client performs the
      duplicate address detection before using the received addresses
      for any traffic.  If any of the addresses are found to be in use
      on the link, the client sends a Decline message to the server for
      those addresses as described in <a href="#section-18.2.8">Section 18.2.8</a>.

   -  For each assigned address that does not have any associated
      reachability information (see the definition of "on-link" in
      <a href="./rfc4861#section-2.1">Section 2.1 of [RFC4861]</a>), in order to avoid the problems
      described in [<a href="./rfc4943" title='"IPv6 Neighbor Discovery On-Link Assumption Considered Harmful"'>RFC4943</a>], the client MUST NOT assume that any
      addresses are reachable on-link as a result of receiving an IA_NA
      or IA_TA.  Addresses obtained from an IA_NA or IA_TA MUST NOT be
      used to form an implicit prefix with a length other than 128.

   -  For each delegated prefix, the client assigns a subnet to each of
      the links to which the associated interfaces are attached.

      When a client subnets a delegated prefix, it must assign
      additional bits to the prefix to generate unique, longer prefixes.
      For example, if the client in Figure 1 were delegated
      2001:db8:0::/48, it might generate 2001:db8:0:1::/64 and
      2001:db8:0:2::/64 for assignment to the two links in the
      subscriber network.  If the client were delegated 2001:db8:0::/48
      and 2001:db8:5::/48, it might assign 2001:db8:0:1::/64 and
      2001:db8:5:1::/64 to one of the links, and 2001:db8:0:2::/64 and
      2001:db8:5:2::/64 for assignment to the other link.

      If the client uses a delegated prefix to configure addresses on
      interfaces on itself or other nodes behind it, the preferred and
      valid lifetimes of those addresses MUST be no longer than the
      remaining preferred and valid lifetimes, respectively, for the
      delegated prefix at any time.  In particular, if the delegated




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 70]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-71"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      prefix or a prefix derived from it is advertised for stateless
      address autoconfiguration [<a href="./rfc4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>], the advertised preferred and
      valid lifetimes MUST NOT exceed the corresponding remaining
      lifetimes of the delegated prefix.

   Management of the specific configuration information is detailed in
   the definition of each option in <a href="#section-21">Section 21</a>.

   If the Reply message contains any IAs but the client finds no usable
   addresses and/or delegated prefixes in any of these IAs, the client
   may either try another server (perhaps restarting the DHCP server
   discovery process) or use the Information-request message to obtain
   other configuration information only.

   When the client receives a Reply message in response to a Renew or
   Rebind message, the client:

   -  Sends a Request message to the server that responded if any of the
      IAs in the Reply message contain the NoBinding status code.  The
      client places IA options in this message for all IAs.  The client
      continues to use other bindings for which the server did not
      return an error.

   -  Sends a Renew/Rebind if any of the IAs are not in the Reply
      message, but as this likely indicates that the server that
      responded does not support that IA type, sending immediately is
      unlikely to produce a different result.  Therefore, the client
      MUST rate-limit its transmissions (see <a href="#section-14.1">Section 14.1</a>) and MAY just
      wait for the normal retransmission time (as if the Reply message
      had not been received).  The client continues to use other
      bindings for which the server did return information.

   -  Otherwise accepts the information in the IA.

   Whenever a client restarts the DHCP server discovery process or
   selects an alternate server as described in <a href="#section-18.2.9">Section 18.2.9</a>, the
   client SHOULD stop using all the addresses and delegated prefixes for
   which it has bindings and try to obtain all required leases from the
   new server.  This facilitates the client using a single state machine
   for all bindings.











<span class="grey">Mrugalski, et al.            Standards Track                   [Page 71]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-72"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.10.2.%20%20Reply%20for%20Release%20and%20Decline"></a><a class="selflink" href="#section-18.2.10.2" id="section-18.2.10.2">18.2.10.2</a>.  Reply for Release and Decline</span>

   When the client receives a valid Reply message in response to a
   Release message, the client considers the Release event completed,
   regardless of the Status Code option (see <a href="#section-21.13">Section 21.13</a>) returned by
   the server.

   When the client receives a valid Reply message in response to a
   Decline message, the client considers the Decline event completed,
   regardless of the Status Code option(s) returned by the server.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.10.3.%20%20Reply%20for%20Confirm"></a><a class="selflink" href="#section-18.2.10.3" id="section-18.2.10.3">18.2.10.3</a>.  Reply for Confirm</span>

   If the client receives any Reply messages that indicate a status of
   Success (explicit or implicit), the client can use the addresses in
   the IA and ignore any messages that indicate a NotOnLink status.
   When the client only receives one or more Reply messages with the
   NotOnLink status in response to a Confirm message, the client
   performs DHCP server discovery as described in <a href="#section-18">Section 18</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.10.4.%20%20Reply%20for%20Information-request"></a><a class="selflink" href="#section-18.2.10.4" id="section-18.2.10.4">18.2.10.4</a>.  Reply for Information-request</span>

   Refer to <a href="#section-21.23">Section 21.23</a> for details on how the Information Refresh
   Time option (whether or not present in the Reply) should be handled
   by the client.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.11.%20%20Receipt%20of%20Reconfigure%20Messages"></a><a class="selflink" href="#section-18.2.11" id="section-18.2.11">18.2.11</a>.  Receipt of Reconfigure Messages</span>

   A client receives Reconfigure messages sent to UDP port 546 on
   interfaces for which it has acquired configuration information
   through DHCP.  These messages may be sent at any time.  Since the
   results of a reconfiguration event may affect application-layer
   programs, the client SHOULD log these events and MAY notify these
   programs of the change through an implementation-specific interface.

   Upon receipt of a valid Reconfigure message, the client responds with
   a Renew message, a Rebind message, or an Information-request message
   as indicated by the Reconfigure Message option (see <a href="#section-21.19">Section 21.19</a>).
   The client ignores the "transaction-id" field in the received
   Reconfigure message.  While the transaction is in progress, the
   client discards any Reconfigure messages it receives.

   The Reconfigure message acts as a trigger that signals the client to
   complete a successful message exchange.  Once the client has received
   a Reconfigure, the client proceeds with the message exchange
   (retransmitting the Renew, Rebind, or Information-request message if
   necessary); the client MUST ignore any additional Reconfigure
   messages until the exchange is complete.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 72]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-73"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Duplicate messages will be ignored because the client will begin the
   exchange after the receipt of the first Reconfigure.  Retransmitted
   messages will either (1) trigger the exchange (if the first
   Reconfigure was not received by the client) or (2) be ignored.  The
   server MAY discontinue retransmission of Reconfigure messages to the
   client once the server receives the Renew, Rebind, or
   Information-request message from the client.

   It might be possible for a duplicate or retransmitted Reconfigure to
   be sufficiently delayed (and delivered out of order) that it arrives
   at the client after the exchange (initiated by the original
   Reconfigure) has been completed.  In this case, the client would
   initiate a redundant exchange.  The likelihood of delayed and
   out-of-order delivery is small enough to be ignored.  The consequence
   of the redundant exchange is inefficiency rather than incorrect
   operation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.2.12.%20%20Refreshing%20Configuration%20Information"></a><a class="selflink" href="#section-18.2.12" id="section-18.2.12">18.2.12</a>.  Refreshing Configuration Information</span>

   Whenever a client may have moved to a new link, the
   prefixes/addresses assigned to the interfaces on that link may no
   longer be appropriate for the link to which the client is attached.
   Examples of times when a client may have moved to a new link include
   the following:

   -  The client reboots (and has stable storage and persistent DHCP
      state).

   -  The client is reconnected to a link on which it has obtained
      leases.

   -  The client returns from sleep mode.

   -  The client changes access points (e.g., if using Wi-Fi
      technology).

   When the client detects that it may have moved to a new link and it
   has obtained addresses and no delegated prefixes from a server, the
   client SHOULD initiate a Confirm/Reply message exchange.  The client
   includes any IAs assigned to the interface that may have moved to a
   new link, along with the addresses associated with those IAs, in its
   Confirm message.  Any responding servers will indicate whether those
   addresses are appropriate for the link to which the client is
   attached with the status in the Reply message it returns to the
   client.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 73]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-74"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If the client has any valid delegated prefixes obtained from the DHCP
   server, the client MUST initiate a Rebind/Reply message exchange as
   described in <a href="#section-18.2.5">Section 18.2.5</a>, with the exception that the
   retransmission parameters should be set as for the Confirm message
   (see <a href="#section-18.2.3">Section 18.2.3</a>).  The client includes IA_NAs, IA_TAs, and
   IA_PDs, along with the associated leases, in its Rebind message.

   If the client has only obtained network information using
   Information-request/Reply message exchanges, the client MUST initiate
   an Information-request/Reply message exchange as described in
   <a href="#section-18.2.6">Section 18.2.6</a>.

   If not associated with one of the above-mentioned conditions, a
   client SHOULD initiate a Renew/Reply exchange (as if the T1 time
   expired) as described in <a href="#section-18.2.4">Section 18.2.4</a> or an Information-request/
   Reply exchange as described in <a href="#section-18.2.6">Section 18.2.6</a> if the client detects a
   significant change regarding the prefixes available on the link (when
   new prefixes are added or existing prefixes are deprecated), as this
   may indicate a configuration change.  However, a client MUST
   rate-limit such attempts to avoid flooding a server with requests
   when there are link issues (for example, only doing one of these at
   most every 30 seconds).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.%20%20Server%20Behavior"></a><a class="selflink" href="#section-18.3" id="section-18.3">18.3</a>.  Server Behavior</span>

   For this discussion, the server is assumed to have been configured in
   an implementation-specific manner with configurations of interest to
   clients.

   A server sends an Advertise message in response to each valid Solicit
   message it receives to announce the availability of the server to the
   client.

   In most cases, the server will send a Reply in response to Request,
   Confirm, Renew, Rebind, Decline, Release, and Information-request
   messages sent by a client.  The server will also send a Reply in
   response to a Solicit with a Rapid Commit option (see <a href="#section-21.14">Section 21.14</a>)
   when the server is configured to respond with committed lease
   assignments.

   These Advertise and Reply messages MUST always contain the Server
   Identifier option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID and
   the Client Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the client
   message if one was present.

   In most response messages, the server includes options containing
   configuration information for the client.  The server must be aware
   of the recommendations on packet sizes and the use of fragmentation



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 74]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-75"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   as discussed in <a href="./rfc8200#section-5">Section 5 of [RFC8200]</a>.  If the client included an
   Option Request option (see <a href="#section-21.7">Section 21.7</a>) in its message, the server
   includes options in the response message containing configuration
   parameters for all of the options identified in the Option Request
   option that the server has been configured to return to the client.
   The server MAY return additional options to the client if it has been
   configured to do so.

   Any message sent from a client may arrive at the server encapsulated
   in one or more Relay-forward messages.  The server MUST use the
   received message to construct the proper Relay-reply message to allow
   the response to the received message to be relayed through the same
   relay agents (in reverse order) as the original client message; see
   <a href="#section-19.3">Section 19.3</a> for more details.  The server may also need to record
   this information with each client in case it is needed to send a
   Reconfigure message at a later time, unless the server has been
   configured with addresses that can be used to send Reconfigure
   messages directly to the client (see <a href="#section-18.3.11">Section 18.3.11</a>).  Note that
   servers that support leasequery [<a href="./rfc5007" title='"DHCPv6 Leasequery"'>RFC5007</a>] also need to record this
   information.

   By sending Reconfigure messages, the server MAY initiate a
   configuration exchange to cause DHCP clients to obtain new addresses,
   prefixes, and other configuration information.  For example, an
   administrator may use a server-initiated configuration exchange when
   links in the DHCP domain are to be renumbered or when other
   configuration options are updated, perhaps because servers are moved,
   added, or removed.

   When a client receives a Reconfigure message from the server, the
   client initiates sending a Renew, Rebind, or Information-request
   message as indicated by msg-type in the Reconfigure Message option
   (see <a href="#section-21.19">Section 21.19</a>).  The server sends IAs and/or other configuration
   information to the client in a Reply message.  The server MAY include
   options containing the IAs and new values for other configuration
   parameters in the Reply message, even if those IAs and parameters
   were not requested in the client's message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.1.%20%20Receipt%20of%20Solicit%20Messages"></a><a class="selflink" href="#section-18.3.1" id="section-18.3.1">18.3.1</a>.  Receipt of Solicit Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Solicit
   messages received via unicast.  Unicast transmission of Solicit
   messages is not allowed, regardless of whether the Server Unicast
   option (see <a href="#section-21.12">Section 21.12</a>) is configured or not.

   The server determines the information about the client and its
   location as described in <a href="#section-13">Section 13</a> and checks its administrative
   policy about responding to the client.  If the server is not



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 75]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-76"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   permitted to respond to the client, the server discards the Solicit
   message.  For example, if the administrative policy for the server is
   that it may only respond to a client that is willing to accept a
   Reconfigure message, if the client does not include a Reconfigure
   Accept option (see <a href="#section-21.20">Section 21.20</a>) in the Solicit message, the server
   discards the Solicit message.

   If (1) the server is permitted to respond to the client, (2) the
   client has not included a Rapid Commit option (see <a href="#section-21.14">Section 21.14</a>) in
   the Solicit message, or (3) the server has not been configured to
   respond with committed assignments of leases and other resources, the
   server sends an Advertise message to the client as described in
   <a href="#section-18.3.9">Section 18.3.9</a>.

   If the client has included a Rapid Commit option in the Solicit
   message and the server has been configured to respond with committed
   assignments of leases and other resources, the server responds to the
   Solicit with a Reply message.  The server produces the Reply message
   as though it had received a Request message as described in
   <a href="#section-18.3.2">Section 18.3.2</a>.  The server transmits the Reply message as described
   in <a href="#section-18.3.10">Section 18.3.10</a>.  The server MUST commit the assignment of any
   addresses and delegated prefixes or other configuration information
   before sending a Reply message to a client.  In this case, the server
   includes a Rapid Commit option in the Reply message to indicate that
   the Reply is in response to a Solicit message.

   DISCUSSION:

      When using the Solicit/Reply message exchange, the server commits
      the assignment of any leases before sending the Reply message.
      The client can assume that it has been assigned the leases in the
      Reply message and does not need to send a Request message for
      those leases.

      Typically, servers that are configured to use the Solicit/Reply
      message exchange will be deployed so that only one server will
      respond to a Solicit message.  If more than one server responds,
      the client will only use the leases from one of the servers, while
      the leases from the other servers will be committed to the client
      but not used by the client.











<span class="grey">Mrugalski, et al.            Standards Track                   [Page 76]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-77"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.2.%20%20Receipt%20of%20Request%20Messages"></a><a class="selflink" href="#section-18.3.2" id="section-18.3.2">18.3.2</a>.  Receipt of Request Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Request
   messages received via unicast.

   When the server receives a valid Request message, the server creates
   the bindings for that client according to the server's policy and
   configuration information and records the IAs and other information
   requested by the client.

   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Request message into
   the "transaction-id" field.

   The server MUST include in the Reply message a Server Identifier
   option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID and the Client
   Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the Request message.

   The server examines all IAs in the message from the client.

   For each IA_NA option (see <a href="#section-21.4">Section 21.4</a>) and IA_TA option (see
   <a href="#section-21.5">Section 21.5</a>) in the Request message, the server checks if the
   prefixes of included addresses are appropriate for the link to which
   the client is connected.  If any of the prefixes of the included
   addresses are not appropriate for the link to which the client is
   connected, the server MUST return the IA to the client with a Status
   Code option (see <a href="#section-21.13">Section 21.13</a>) with the value NotOnLink.  If the
   server does not send the NotOnLink status code but it cannot assign
   any IP addresses to an IA, the server MUST return the IA option in
   the Reply message with no addresses in the IA and a Status Code
   option containing status code NoAddrsAvail in the IA.

   For any IA_PD option (see <a href="#section-21.21">Section 21.21</a>) in the Request message to
   which the server cannot assign any delegated prefixes, the server
   MUST return the IA_PD option in the Reply message with no prefixes in
   the IA_PD and with a Status Code option containing status code
   NoPrefixAvail in the IA_PD.

   The server MAY assign different addresses and/or delegated prefixes
   to an IA than those included within the IA of the client's Request
   message.

   For all IAs to which the server can assign addresses or delegated
   prefixes, the server includes the IAs with addresses (for IA_NAs and
   IA_TAs), prefixes (for IA_PDs), and other configuration parameters
   and records the IA as a new client binding.  The server MUST NOT
   include any addresses or delegated prefixes in the IA that the server
   does not assign to the client.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 77]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-78"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The T1/T2 times set in each applicable IA option for a Reply MUST be
   the same values across all IAs.  The server MUST determine the T1/T2
   times across all of the applicable client's bindings in the Reply.
   This facilitates the client being able to renew all of the bindings
   at the same time.

   The server SHOULD include a Reconfigure Accept option (see
   <a href="#section-21.20">Section 21.20</a>) if the server policy enables the reconfigure mechanism
   and the client supports it.  Currently, sending this option in a
   Reply is technically redundant, as the use of the reconfiguration
   mechanism requires authentication; at present, the only defined
   mechanism is RKAP (see <a href="#section-20.4">Section 20.4</a>), and the presence of the
   reconfigure key signals support for the acceptance of Reconfigure
   messages.  However, there may be better security mechanisms defined
   in the future that would cause RKAP to not be used anymore.

   The server includes other options containing configuration
   information to be returned to the client as described in
   <a href="#section-18.3">Section 18.3</a>.

   If the server finds that the client has included an IA in the Request
   message for which the server already has a binding that associates
   the IA with the client, the server sends a Reply message with
   existing bindings, possibly with updated lifetimes.  The server may
   update the bindings according to its local policies, but the server
   SHOULD generate the response again and not simply retransmit
   previously sent information, even if the "transaction-id" field value
   matches a previous transmission.  The server MUST NOT cache its
   responses.

   DISCUSSION:

      Cached replies are bad because lifetimes need to be updated
      (either decrease the timers by the amount of time elapsed since
      the original transmission or keep the lifetime values and update
      the lease information in the server's database).  Also, if the
      message uses any security protection (such as the Replay Detection
      Method (RDM), as described in <a href="#section-20.3">Section 20.3</a>), its value must be
      updated.  Additionally, any digests must be updated.  Given all of
      the above, caching replies is far more complex than simply sending
      the same buffer as before, and it is easy to miss some of those
      steps.









<span class="grey">Mrugalski, et al.            Standards Track                   [Page 78]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-79"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.3.%20%20Receipt%20of%20Confirm%20Messages"></a><a class="selflink" href="#section-18.3.3" id="section-18.3.3">18.3.3</a>.  Receipt of Confirm Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Confirm
   messages received via unicast.  Unicast transmission of Confirm
   messages is not allowed, regardless of whether the Server Unicast
   option (see <a href="#section-21.12">Section 21.12</a>) is configured or not.

   When the server receives a Confirm message, the server determines
   whether the addresses in the Confirm message are appropriate for the
   link to which the client is attached.  If all of the addresses in the
   Confirm message pass this test, the server returns a status of
   Success.  If any of the addresses do not pass this test, the server
   returns a status of NotOnLink.  If the server is unable to perform
   this test (for example, the server does not have information about
   prefixes on the link to which the client is connected) or there were
   no addresses in any of the IAs sent by the client, the server
   MUST NOT send a Reply to the client.

   The server ignores the T1 and T2 fields in the IA options and the
   preferred-lifetime and valid-lifetime fields in the IA Address
   options (see <a href="#section-21.6">Section 21.6</a>).

   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Confirm message into
   the "transaction-id" field.

   The server MUST include in the Reply message a Server Identifier
   option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID and the Client
   Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the Confirm message.  The
   server includes a Status Code option (see <a href="#section-21.13">Section 21.13</a>) indicating
   the status of the Confirm message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.4.%20%20Receipt%20of%20Renew%20Messages"></a><a class="selflink" href="#section-18.3.4" id="section-18.3.4">18.3.4</a>.  Receipt of Renew Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Renew messages
   received via unicast.

   For each IA in the Renew message from a client, the server locates
   the client's binding and verifies that the information in the IA from
   the client matches the information stored for that client.

   If the server finds the client entry for the IA, the server sends the
   IA back to the client with new lifetimes and, if applicable, T1/T2
   times.  If the server is unable to extend the lifetimes of an address
   or delegated prefix in the IA, the server MAY choose not to include
   the IA Address option (see <a href="#section-21.6">Section 21.6</a>) for that address or IA
   Prefix option (see <a href="#section-21.22">Section 21.22</a>) for that delegated prefix.  If the
   server chooses to include the IA Address or IA Prefix option for such



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 79]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-80"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   an address or delegated prefix, the server SHOULD set T1 and T2
   values to the valid lifetime for the IA option unless the server also
   includes other addresses or delegated prefixes that the server is
   able to extend for the IA.  Setting T1 and T2 to values equal to the
   valid lifetime informs the client that the leases associated with
   said IA will not be extended, so there is no point in trying.  Also,
   it avoids generating unnecessary traffic as the remaining lifetime
   approaches 0.

   The server may choose to change the list of addresses or delegated
   prefixes and the lifetimes in IAs that are returned to the client.

   If the server finds that any of the addresses in the IA are not
   appropriate for the link to which the client is attached, the server
   returns the address to the client with lifetimes of 0.

   If the server finds that any of the delegated prefixes in the IA are
   not appropriate for the link to which the client is attached, the
   server returns the delegated prefix to the client with lifetimes
   of 0.

   For each IA for which the server cannot find a client entry, the
   server has the following choices, depending on the server's policy
   and configuration information:

   -  If the server is configured to create new bindings as a result of
      processing Renew messages, the server SHOULD create a binding and
      return the IA with assigned addresses or delegated prefixes with
      lifetimes and, if applicable, T1/T2 times and other information
      requested by the client.  If the client included the IA Prefix
      option within the IA_PD option (see <a href="#section-21.21">Section 21.21</a>) with a zero
      value in the "IPv6-prefix" field and a non-zero value in the
      "prefix-length" field, the server MAY use the "prefix-length"
      value as a hint for the length of the prefixes to be assigned (see
      [<a href="./rfc8168" title='"DHCPv6 Prefix-Length Hint Issues"'>RFC8168</a>] for further details on prefix-length hints).

   -  If the server is configured to create new bindings as a result of
      processing Renew messages but the server will not assign any
      leases to an IA, the server returns the IA option containing a
      Status Code option (see <a href="#section-21.13">Section 21.13</a>) with the NoAddrsAvail or
      NoPrefixAvail status code and a status message for a user.

   -  If the server does not support creation of new bindings for the
      client sending a Renew message or if this behavior is disabled
      according to the server's policy or configuration information, the
      server returns the IA option containing a Status Code option with
      the NoBinding status code and a status message for a user.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 80]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-81"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Renew message into
   the "transaction-id" field.

   The server MUST include in the Reply message a Server Identifier
   option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID and the Client
   Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the Renew message.

   The server includes other options containing configuration
   information to be returned to the client as described in
   <a href="#section-18.3">Section 18.3</a>.

   The server MAY include options containing the IAs and values for
   other configuration parameters, even if those parameters were not
   requested in the Renew message.

   The T1/T2 values set in each applicable IA option for a Reply MUST be
   the same across all IAs.  The server MUST determine the T1/T2 values
   across all of the applicable client's bindings in the Reply.  This
   facilitates the client being able to renew all of the bindings at the
   same time.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.5.%20%20Receipt%20of%20Rebind%20Messages"></a><a class="selflink" href="#section-18.3.5" id="section-18.3.5">18.3.5</a>.  Receipt of Rebind Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Rebind
   messages received via unicast.  Unicast transmission of Rebind
   messages is not allowed, regardless of whether the Server Unicast
   option (see <a href="#section-21.12">Section 21.12</a>) is configured or not.

   When the server receives a Rebind message that contains an IA option
   from a client, it locates the client's binding and verifies that the
   information in the IA from the client matches the information stored
   for that client.

   If the server finds the client entry for the IA and the server
   determines that the addresses or delegated prefixes in the IA are
   appropriate for the link to which the client's interface is attached
   according to the server's explicit configuration information, the
   server SHOULD send the IA back to the client with new lifetimes and,
   if applicable, T1/T2 values.  If the server is unable to extend the
   lifetimes of an address in the IA, the server MAY choose not to
   include the IA Address option (see <a href="#section-21.6">Section 21.6</a>) for this address.
   If the server is unable to extend the lifetimes of a delegated prefix
   in the IA, the server MAY choose not to include the IA Prefix option
   (see <a href="#section-21.22">Section 21.22</a>) for this prefix.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 81]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-82"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If the server finds that the client entry for the IA and any of the
   addresses or delegated prefixes are no longer appropriate for the
   link to which the client's interface is attached according to the
   server's explicit configuration information, the server returns those
   addresses or delegated prefixes to the client with lifetimes of 0.

   If the server cannot find a client entry for the IA, the server
   checks if the IA contains addresses (for IA_NAs and IA_TAs) or
   delegated prefixes (for IA_PDs).  The server checks if the addresses
   and delegated prefixes are appropriate for the link to which the
   client's interface is attached according to the server's explicit
   configuration information.  For any address that is not appropriate
   for the link to which the client's interface is attached, the server
   MAY include the IA Address option with lifetimes of 0.  For any
   delegated prefix that is not appropriate for the link to which the
   client's interface is attached, the server MAY include the IA Prefix
   option with lifetimes of 0.  The Reply with lifetimes of 0
   constitutes an explicit notification to the client that the specific
   addresses and delegated prefixes are no longer valid and MUST NOT be
   used by the client.  If the server chooses to not include any IAs
   containing IA Address or IA Prefix options with lifetimes of 0 and
   the server does not include any other IAs with leases and/or status
   codes, the server does not send a Reply message.  In this situation,
   the server discards the Rebind message.

   Otherwise, for each IA for which the server cannot find a client
   entry, the server has the following choices, depending on the
   server's policy and configuration information:

   -  If the server is configured to create new bindings as a result of
      processing Rebind messages (also see the note below about the
      Rapid Commit option (<a href="#section-21.14">Section 21.14</a>)), the server SHOULD create a
      binding and return the IA with allocated leases with lifetimes
      and, if applicable, T1/T2 values and other information requested
      by the client.  The server MUST NOT return any addresses or
      delegated prefixes in the IA that the server does not assign to
      the client.

   -  If the server is configured to create new bindings as a result of
      processing Rebind messages but the server will not assign any
      leases to an IA, the server returns the IA option containing a
      Status Code option (see <a href="#section-21.13">Section 21.13</a>) with the NoAddrsAvail or
      NoPrefixAvail status code and a status message for a user.








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 82]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-83"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   -  If the server does not support creation of new bindings for the
      client sending a Rebind message or if this behavior is disabled
      according to the server's policy or configuration information, the
      server returns the IA option containing a Status Code option with
      the NoBinding status code and a status message for a user.

   When the server creates new bindings for the IA, it is possible that
   other servers also create bindings as a result of receiving the same
   Rebind message; see the "DISCUSSION" text in <a href="#section-21.14">Section 21.14</a>.
   Therefore, the server SHOULD only create new bindings during
   processing of a Rebind message if the server is configured to respond
   with a Reply message to a Solicit message containing the Rapid Commit
   option.

   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Rebind message into
   the "transaction-id" field.

   The server MUST include in the Reply message a Server Identifier
   option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID and the Client
   Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the Rebind message.

   The server includes other options containing configuration
   information to be returned to the client as described in
   <a href="#section-18.3">Section 18.3</a>.

   The server MAY include options containing the IAs and values for
   other configuration parameters, even if those IAs and parameters were
   not requested in the Rebind message.

   The T1 or T2 values set in each applicable IA option for a Reply MUST
   be the same values across all IAs.  The server MUST determine the T1
   or T2 values across all of the applicable client's bindings in the
   Reply.  This facilitates the client being able to renew all of the
   bindings at the same time.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.6.%20%20Receipt%20of%20Information-request%20Messages"></a><a class="selflink" href="#section-18.3.6" id="section-18.3.6">18.3.6</a>.  Receipt of Information-request Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of
   Information-request messages received via unicast.

   When the server receives an Information-request message, the client
   is requesting configuration information that does not include the
   assignment of any leases.  The server determines all configuration
   parameters appropriate to the client, based on the server
   configuration policies known to the server.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 83]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-84"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Information-request
   message into the "transaction-id" field.

   The server MUST include a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>)
   containing the server's DUID in the Reply message.  If the client
   included a Client Identifier option (see <a href="#section-21.2">Section 21.2</a>) in the
   Information-request message, the server copies that option to the
   Reply message.

   The server includes options containing configuration information to
   be returned to the client as described in <a href="#section-18.3">Section 18.3</a>.  The server
   MAY include additional options that were not requested by the client
   in the Information-request message.

   If the Information-request message received from the client did not
   include a Client Identifier option, the server SHOULD respond with a
   Reply message containing any configuration parameters that are not
   determined by the client's identity.  If the server chooses not to
   respond, the client may continue to retransmit the
   Information-request message indefinitely.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.7.%20%20Receipt%20of%20Release%20Messages"></a><a class="selflink" href="#section-18.3.7" id="section-18.3.7">18.3.7</a>.  Receipt of Release Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Release
   messages received via unicast.

   The server constructs a Reply message by setting the "msg-type" field
   to REPLY and copying the transaction ID from the Release message into
   the "transaction-id" field.

   Upon the receipt of a valid Release message, the server examines the
   IAs and the leases in the IAs for validity.  If the IAs in the
   message are in a binding for the client and the leases in the IAs
   have been assigned by the server to those IAs, the server deletes the
   leases from the IAs and makes the leases available for assignment to
   other clients.  The server ignores leases not assigned to the IAs,
   although it may choose to log an error.

   After all the leases have been processed, the server generates a
   Reply message and includes a Status Code option (see <a href="#section-21.13">Section 21.13</a>)
   with the value Success, a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>)
   with the server's DUID, and a Client Identifier option (see
   <a href="#section-21.2">Section 21.2</a>) with the client's DUID.  For each IA in the Release
   message for which the server has no binding information, the server
   adds an IA option using the IAID from the Release message and
   includes a Status Code option with the value NoBinding in the IA
   option.  No other options are included in the IA option.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 84]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-85"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A server may choose to retain a record of assigned leases and IAs
   after the lifetimes on the leases have expired to allow the server to
   reassign the previously assigned leases to a client.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.8.%20%20Receipt%20of%20Decline%20Messages"></a><a class="selflink" href="#section-18.3.8" id="section-18.3.8">18.3.8</a>.  Receipt of Decline Messages</span>

   See <a href="#section-18.4">Section 18.4</a> for details regarding the handling of Decline
   messages received via unicast.

   Upon the receipt of a valid Decline message, the server examines the
   IAs and the addresses in the IAs for validity.  If the IAs in the
   message are in a binding for the client and the addresses in the IAs
   have been assigned by the server to those IAs, the server deletes the
   addresses from the IAs.  The server ignores addresses not assigned to
   the IAs (though it may choose to log an error if it finds such
   addresses).

   The client has found any addresses in the Decline messages to be
   already in use on its link.  Therefore, the server SHOULD mark the
   addresses declined by the client so that those addresses are not
   assigned to other clients and MAY choose to make a notification that
   addresses were declined.  Local policy on the server determines when
   the addresses identified in a Decline message may be made available
   for assignment.

   After all the addresses have been processed, the server generates a
   Reply message by setting the "msg-type" field to REPLY and copying
   the transaction ID from the Decline message into the "transaction-id"
   field.  The client includes a Status Code option (see <a href="#section-21.13">Section 21.13</a>)
   with the value Success, a Server Identifier option (see <a href="#section-21.3">Section 21.3</a>)
   with the server's DUID, and a Client Identifier option (see
   <a href="#section-21.2">Section 21.2</a>) with the client's DUID.  For each IA in the Decline
   message for which the server has no binding information, the server
   adds an IA option using the IAID from the Decline message and
   includes a Status Code option with the value NoBinding in the IA
   option.  No other options are included in the IA option.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.9.%20%20Creation%20of%20Advertise%20Messages"></a><a class="selflink" href="#section-18.3.9" id="section-18.3.9">18.3.9</a>.  Creation of Advertise Messages</span>

   The server sets the "msg-type" field to ADVERTISE and copies the
   contents of the "transaction-id" field from the Solicit message
   received from the client to the Advertise message.  The server
   includes its server identifier in a Server Identifier option (see
   <a href="#section-21.3">Section 21.3</a>) and copies the Client Identifier option (see
   <a href="#section-21.2">Section 21.2</a>) from the Solicit message into the Advertise message.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 85]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-86"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The server MAY add a Preference option (see <a href="#section-21.8">Section 21.8</a>) to carry
   the preference value for the Advertise message.  The server
   implementation SHOULD allow the setting of a server preference value
   by the administrator.  The server preference value MUST default to 0
   unless otherwise configured by the server administrator.

   The server includes a Reconfigure Accept option (see <a href="#section-21.20">Section 21.20</a>)
   if the server wants to indicate that it supports the Reconfigure
   mechanism.  This information may be used by the client during the
   server selection process.

   The server includes the options the server will return to the client
   in a subsequent Reply message.  The information in these options may
   be used by the client in the selection of a server if the client
   receives more than one Advertise message.  The server MUST include
   options in the Advertise message containing configuration parameters
   for all of the options identified in the Option Request option (see
   <a href="#section-21.7">Section 21.7</a>) in the Solicit message that the server has been
   configured to return to the client.  If the Option Request option
   includes a container option, the server MUST include all the options
   that are eligible to be encapsulated in the container.  The Option
   Request option MAY be used to signal support for a feature even when
   that option is encapsulated, as in the case of the Prefix Exclude
   option [<a href="./rfc6603" title='"Prefix Exclude Option for DHCPv6-based Prefix Delegation"'>RFC6603</a>].  In this case, special processing is required by
   the server.  The server MAY return additional options to the client
   if it has been configured to do so.

   The server MUST include IA options in the Advertise message
   containing any addresses and/or delegated prefixes that would be
   assigned to IAs contained in the Solicit message from the client.  If
   the client has included addresses in the IA Address options (see
   <a href="#section-21.6">Section 21.6</a>) in the Solicit message, the server MAY use those
   addresses as hints about the addresses that the client would like to
   receive.  If the client has included IA Prefix options (see
   <a href="#section-21.22">Section 21.22</a>), the server MAY use the prefix contained in the
   "IPv6-prefix" field and/or the prefix length contained in the
   "prefix-length" field as hints about the prefixes the client would
   like to receive.  If the server is not going to assign an address or
   delegated prefix received as a hint in the Solicit message, the
   server MUST NOT include this address or delegated prefix in the
   Advertise message.

   If the server will not assign any addresses to an IA_NA or IA_TA in
   subsequent Request messages from the client, the server MUST include
   the IA option in the Advertise message with no addresses in that IA
   and a Status Code option (see <a href="#section-21.13">Section 21.13</a>) encapsulated in the IA
   option containing status code NoAddrsAvail.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 86]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-87"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If the server will not assign any prefixes to an IA_PD in subsequent
   Request messages from the client, the server MUST include the IA_PD
   option (see <a href="#section-21.21">Section 21.21</a>) in the Advertise message with no prefixes
   in the IA_PD option and a Status Code option encapsulated in the
   IA_PD containing status code NoPrefixAvail.

   Transmission of Advertise messages is described in the next section.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.10.%20%20Transmission%20of%20Advertise%20and%20Reply%20Messages"></a><a class="selflink" href="#section-18.3.10" id="section-18.3.10">18.3.10</a>.  Transmission of Advertise and Reply Messages</span>

   If the original message was received directly by the server, the
   server unicasts the Advertise or Reply message directly to the client
   using the address in the source address field from the IP datagram in
   which the original message was received.  The Advertise or Reply
   message MUST be unicast through the interface on which the original
   message was received.

   If the original message was received in a Relay-forward message, the
   server constructs a Relay-reply message with the Reply message in the
   payload of a Relay Message option (see <a href="#section-21.10">Section 21.10</a>).  If the
   Relay-forward messages included an Interface-Id option (see
   <a href="#section-21.18">Section 21.18</a>), the server copies that option to the Relay-reply
   message.  The server unicasts the Relay-reply message directly to the
   relay agent using the address in the source address field from the IP
   datagram in which the Relay-forward message was received.  See
   <a href="#section-19.3">Section 19.3</a> for more details on the construction of Relay-reply
   messages.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.3.11.%20%20Creation%20and%20Transmission%20of%20Reconfigure%20Messages"></a><a class="selflink" href="#section-18.3.11" id="section-18.3.11">18.3.11</a>.  Creation and Transmission of Reconfigure Messages</span>

   The server sets the "msg-type" field to RECONFIGURE and sets the
   "transaction-id" field to 0.  The server includes a Server Identifier
   option (see <a href="#section-21.3">Section 21.3</a>) containing its DUID and a Client Identifier
   option (see <a href="#section-21.2">Section 21.2</a>) containing the client's DUID in the
   Reconfigure message.

   Because of the risk of denial-of-service (DoS) attacks against DHCP
   clients, the use of a security mechanism is mandated in Reconfigure
   messages.  The server MUST use DHCP authentication in the Reconfigure
   message (see <a href="#section-20.4">Section 20.4</a>).

   The server MUST include a Reconfigure Message option (see
   <a href="#section-21.19">Section 21.19</a>) to select whether the client responds with a Renew
   message, a Rebind message, or an Information-request message.

   The server MUST NOT include any other options in the Reconfigure
   message, except as specifically allowed in the definition of
   individual options.



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 87]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-88"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A server sends each Reconfigure message to a single DHCP client,
   using an IPv6 unicast address of sufficient scope belonging to the
   DHCP client.  If the server does not have an address to which it can
   send the Reconfigure message directly to the client, the server uses
   a Relay-reply message (as described in <a href="#section-19.3">Section 19.3</a>) to send the
   Reconfigure message to a relay agent that will relay the message to
   the client.  The server may obtain the address of the client (and the
   appropriate relay agent, if required) through the information the
   server has about clients that have been in contact with the server
   (see <a href="#section-18.3">Section 18.3</a>) or through some external agent.

   To reconfigure more than one client, the server unicasts a separate
   message to each client.  The server may initiate the reconfiguration
   of multiple clients concurrently; for example, a server may send a
   Reconfigure message to additional clients while previous
   reconfiguration message exchanges are still in progress.

   The Reconfigure message causes the client to initiate a Renew/Reply,
   Rebind/Reply, or Information-request/Reply message exchange with the
   server.  The server interprets the receipt of a Renew, Rebind, or
   Information-request message (whichever was specified in the original
   Reconfigure message) from the client as satisfying the Reconfigure
   message request.

   When transmitting the Reconfigure message, the server sets the
   retransmission time (RT) to REC_TIMEOUT.  If the server does not
   receive a Renew, Rebind, or Information-request message from the
   client before the RT elapses, the server retransmits the Reconfigure
   message, doubles the RT value, and waits again.  The server continues
   this process until REC_MAX_RC unsuccessful attempts have been made,
   at which point the server SHOULD abort the reconfigure process for
   that client.

   Default and initial values for REC_TIMEOUT and REC_MAX_RC are
   documented in <a href="#section-7.6">Section 7.6</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/18.4.%20%20Reception%20of%20Unicast%20Messages"></a><a class="selflink" href="#section-18.4" id="section-18.4">18.4</a>.  Reception of Unicast Messages</span>

   Unless otherwise stated in the subsections of <a href="#section-18.3">Section 18.3</a> that
   discuss the receipt of specific messages, the server is not supposed
   to accept unicast traffic when it is not explicitly configured to do
   so.  For example, unicast transmission is not allowed for Solicit,
   Confirm, and Rebind messages (see Sections <a href="#section-18.3.1">18.3.1</a>, <a href="#section-18.3.3">18.3.3</a>, and
   18.3.5, respectively), even if the Server Unicast option (see
   <a href="#section-21.12">Section 21.12</a>) is configured.  For Request, Renew,
   Information-request, Release, and Decline messages, it is allowed
   only if the Server Unicast option is configured.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 88]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-89"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   When the server receives a message via unicast from a client to which
   the server has not sent a Server Unicast option (or is not currently
   configured to do so), the server discards that message and responds
   with an Advertise (when responding to a Solicit message) or Reply
   message (when responding to any other messages) containing a Status
   Code option (see <a href="#section-21.13">Section 21.13</a>) with the value UseMulticast, a Server
   Identifier option (see <a href="#section-21.3">Section 21.3</a>) containing the server's DUID,
   the Client Identifier option (see <a href="#section-21.2">Section 21.2</a>) from the client
   message (if any), and no other options.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.%20%20Relay%20Agent%20Behavior"></a><a class="selflink" href="#section-19" id="section-19">19</a>.  Relay Agent Behavior</span>

   The relay agent SHOULD be configured to use a list of destination
   addresses that includes unicast addresses.  The list of destination
   addresses MAY include the All_DHCP_Servers multicast address or other
   addresses selected by the network administrator.  If the relay agent
   has not been explicitly configured, it MUST use the All_DHCP_Servers
   multicast address as the default.

   If the relay agent relays messages to the All_DHCP_Servers multicast
   address or other multicast addresses, it sets the Hop Limit field
   to 8.

   If the relay agent receives a message other than Relay-forward and
   Relay-reply and the relay agent does not recognize its message type,
   it MUST forward the message as described in <a href="#section-19.1.1">Section 19.1.1</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.1.%20%20Relaying%20a%20Client%20Message%20or%20a%20Relay-forward%20Message"></a><a class="selflink" href="#section-19.1" id="section-19.1">19.1</a>.  Relaying a Client Message or a Relay-forward Message</span>

   A relay agent relays both messages from clients and Relay-forward
   messages from other relay agents.  When a relay agent receives a
   Relay-forward message, a recognized message type for which it is not
   the intended target, or an unrecognized message type [<a href="./rfc7283" title='"Handling Unknown DHCPv6 Messages"'>RFC7283</a>], it
   constructs a new Relay-forward message.  The relay agent copies the
   source address from the header of the IP datagram in which the
   message was received into the peer-address field of the Relay-forward
   message.  The relay agent copies the received DHCP message (excluding
   any IP or UDP headers) into a Relay Message option (see
   <a href="#section-21.10">Section 21.10</a>) in the new message.  The relay agent adds to the
   Relay-forward message any other options it is configured to include.

   [<a id="ref-RFC6221">RFC6221</a>] defines a Lightweight DHCPv6 Relay Agent (LDRA) that allows
   relay agent information to be inserted by an access node that
   performs a link-layer bridging (i.e., non-routing) function.







<span class="grey">Mrugalski, et al.            Standards Track                   [Page 89]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-90"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.1.1.%20%20Relaying%20a%20Message%20from%20a%20Client"></a><a class="selflink" href="#section-19.1.1" id="section-19.1.1">19.1.1</a>.  Relaying a Message from a Client</span>

   If the relay agent received the message to be relayed from a client,
   the relay agent places a globally scoped unicast address (i.e., GUA
   or ULA) from a prefix assigned to the link on which the client should
   be assigned leases into the link-address field.  If such an address
   is not available, the relay agent may set the link-address field to a
   link-local address from the interface on which the original message
   was received.  This is not recommended, as it may require that
   additional information be provided in the server configuration.  See
   <a href="./rfc7969#section-3.2">Section 3.2 of [RFC7969]</a> for a detailed discussion.

   This address will be used by the server to determine the link from
   which the client should be assigned leases and other configuration
   information.

   The hop-count value in the Relay-forward message is set to 0.

   If the relay agent cannot use the address in the link-address field
   to identify the interface through which the response to the client
   will be relayed, the relay agent MUST include an Interface-Id option
   (see <a href="#section-21.18">Section 21.18</a>) in the Relay-forward message.  The server will
   include the Interface-Id option in its Relay-reply message.  The
   relay agent sets the link-address field as described earlier in this
   subsection, regardless of whether the relay agent includes an
   Interface-Id option in the Relay-forward message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.1.2.%20%20Relaying%20a%20Message%20from%20a%20Relay%20Agent"></a><a class="selflink" href="#section-19.1.2" id="section-19.1.2">19.1.2</a>.  Relaying a Message from a Relay Agent</span>

   If the message received by the relay agent is a Relay-forward message
   and the hop-count value in the message is greater than or equal to
   HOP_COUNT_LIMIT, the relay agent discards the received message.

   The relay agent copies the source address from the IP datagram in
   which the message was received into the peer-address field in the
   Relay-forward message and sets the hop-count field to the value of
   the hop-count field in the received message incremented by 1.

   If the source address from the IP datagram header of the received
   message is a globally scoped unicast address (i.e., GUA or ULA), the
   relay agent sets the link-address field to 0; otherwise, the relay
   agent sets the link-address field to a globally scoped unicast
   address (i.e., GUA or ULA) assigned to the interface on which the
   message was received or includes an Interface-Id option (see
   <a href="#section-21.18">Section 21.18</a>) to identify the interface on which the message was
   received.





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 90]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-91"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.1.3.%20%20Relay%20Agent%20Behavior%20with%20Prefix%20Delegation"></a><a class="selflink" href="#section-19.1.3" id="section-19.1.3">19.1.3</a>.  Relay Agent Behavior with Prefix Delegation</span>

   A relay agent forwards messages containing prefix delegation options
   in the same way as it would relay addresses (i.e., per
   Sections <a href="#section-19.1.1">19.1.1</a> and <a href="#section-19.1.2">19.1.2</a>).

   If a server communicates with a client through a relay agent about
   delegated prefixes, the server may need a protocol or other
   out-of-band communication to configure routing information for
   delegated prefixes on any router through which the client may forward
   traffic.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.2.%20%20Relaying%20a%20Relay-reply%20Message"></a><a class="selflink" href="#section-19.2" id="section-19.2">19.2</a>.  Relaying a Relay-reply Message</span>

   The relay agent processes any options included in the Relay-reply
   message in addition to the Relay Message option (see <a href="#section-21.10">Section 21.10</a>).

   The relay agent extracts the message from the Relay Message option
   and relays it to the address contained in the peer-address field of
   the Relay-reply message.  Relay agents MUST NOT modify the message.

   If the Relay-reply message includes an Interface-Id option (see
   <a href="#section-21.18">Section 21.18</a>), the relay agent relays the message from the server to
   the client on the link identified by the Interface-Id option.
   Otherwise, if the link-address field is not set to 0, the relay agent
   relays the message on the link identified by the link-address field.

   If the relay agent receives a Relay-reply message, it MUST process
   the message as defined above, regardless of the type of message
   encapsulated in the Relay Message option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.3.%20%20Construction%20of%20Relay-reply%20Messages"></a><a class="selflink" href="#section-19.3" id="section-19.3">19.3</a>.  Construction of Relay-reply Messages</span>

   A server uses a Relay-reply message to (1) return a response to a
   client if the original message from the client was relayed to the
   server in a Relay-forward message or (2) send a Reconfigure message
   to a client if the server does not have an address it can use to send
   the message directly to the client.

   A response to the client MUST be relayed through the same relay
   agents as the original client message.  The server causes this to
   happen by creating a Relay-reply message that includes a Relay
   Message option (see <a href="#section-21.10">Section 21.10</a>) containing the message for the
   next relay agent in the return path to the client.  The contained
   Relay-reply message contains another Relay Message option to be sent
   to the next relay agent, and so on.  The server must record the





<span class="grey">Mrugalski, et al.            Standards Track                   [Page 91]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-92"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   contents of the peer-address fields in the received message so it can
   construct the appropriate Relay-reply message carrying the response
   from the server.

   For example, if client C sent a message that was relayed by relay
   agent A to relay agent B and then to the server, the server would
   send the following Relay-reply message to relay agent B:

      msg-type:       RELAY-REPL
      hop-count:      1
      link-address:   0
      peer-address:   A
      Relay Message option containing the following:
         msg-type:     RELAY-REPL
         hop-count:    0
         link-address: address from link to which C is attached
         peer-address: C
         Relay Message option: &lt;response from server&gt;

                      Figure 10: Relay-reply Example

   When sending a Reconfigure message to a client through a relay agent,
   the server creates a Relay-reply message that includes a Relay
   Message option containing the Reconfigure message for the next relay
   agent in the return path to the client.  The server sets the
   peer-address field in the Relay-reply message header to the address
   of the client and sets the link-address field as required by the
   relay agent to relay the Reconfigure message to the client.  The
   server obtains the addresses of the client and the relay agent
   through prior interaction with the client or through some external
   mechanism.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/19.4.%20%20Interaction%20between%20Relay%20Agents%20and%20Servers"></a><a class="selflink" href="#section-19.4" id="section-19.4">19.4</a>.  Interaction between Relay Agents and Servers</span>

   Each time a packet is relayed by a relay agent towards a server, a
   new encapsulation level is added around the packet.  Each relay is
   allowed to insert additional options on the encapsulation level it
   added but MUST NOT change anything in the packet being encapsulated.
   If there are multiple relays between a client and a server, multiple
   encapsulations are used.  Although it makes packet processing
   slightly more complex, it provides the major advantage of having a
   clear indication as to which relay inserted which option.  The
   response packet is expected to travel through the same relays, but in
   reverse order.  Each time a response packet is relayed back towards a
   client, one encapsulation level is removed.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 92]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-93"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   In certain cases, relays can add one or more options.  These options
   can be added for several reasons:

   -  First, relays can provide additional information about the client.
      That source of information is usually more trusted by a server
      administrator, as it comes from the network infrastructure rather
      than the client and cannot be easily spoofed.  These options can
      be used by the server to determine its allocation policy.

   -  Second, a relay may need some information to send a response back
      to the client.  Relay agents are expected to be stateless (not
      retain any state after a packet has been processed).  A relay
      agent may include the Interface-Id option (see <a href="#section-21.18">Section 21.18</a>),
      which will be echoed back in the response.  It can include other
      options and ask the server to echo one or more of the options back
      in the response.  These options can then be used by the relay
      agent to send the response back to the client, or for other needs.
      The client will never see these options.  See [<a href="./rfc4994" title='"DHCPv6 Relay Agent Echo Request Option"'>RFC4994</a>] for
      details.

   -  Third, sometimes a relay is the best device to provide values for
      certain options.  A relay can insert an option into the packet
      being forwarded to the server and ask the server to pass that
      option back to the client.  The client will receive that option.
      It should be noted that the server is the ultimate authority here,
      and -- depending on its configuration -- it may or may not send
      the option back to the client.  See [<a href="./rfc6422" title='"Relay-Supplied DHCP Options"'>RFC6422</a>] for details.

   For various reasons, servers may need to retain the relay information
   after the packet processing is completed.  One is a bulk leasequery
   mechanism that may ask for all addresses and/or prefixes that were
   assigned via a specific relay.  A second is for the reconfigure
   mechanism.  The server may choose to not send the Reconfigure message
   directly to the client but rather to send it via relays.  This
   particular behavior is considered an implementation detail and is out
   of scope for this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.%20%20Authentication%20of%20DHCP%20Messages"></a><a class="selflink" href="#section-20" id="section-20">20</a>.  Authentication of DHCP Messages</span>

   This document introduces two security mechanisms for the
   authentication of DHCP messages: (1) authentication (and encryption)
   of messages sent between servers and relay agents using IPsec and
   (2) protection against misconfiguration of a client caused by a
   Reconfigure message sent by a malicious DHCP server.

   The delayed authentication protocol, defined in [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>], has been
   obsoleted by this document (see <a href="#section-25">Section 25</a>).




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 93]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-94"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.1.%20%20Security%20of%20Messages%20Sent%20between%20Servers%20and%20Relay%20Agents"></a><a class="selflink" href="#section-20.1" id="section-20.1">20.1</a>.  Security of Messages Sent between Servers and Relay Agents</span>

   Relay agents and servers that exchange messages can use IPsec as
   detailed in [<a href="./rfc8213" title='"Security of Messages Exchanged between Servers and Relay Agents"'>RFC8213</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.2.%20%20Summary%20of%20DHCP%20Authentication"></a><a class="selflink" href="#section-20.2" id="section-20.2">20.2</a>.  Summary of DHCP Authentication</span>

   Authentication of DHCP messages is accomplished through the use of
   the Authentication option (see <a href="#section-21.11">Section 21.11</a>).  The authentication
   information carried in the Authentication option can be used to
   reliably identify the source of a DHCP message and to confirm that
   the contents of the DHCP message have not been tampered with.

   The Authentication option provides a framework for multiple
   authentication protocols.  One such protocol, RKAP, is defined in
   <a href="#section-20.4">Section 20.4</a>.  Other protocols defined in the future will be
   specified in separate documents.

   Any DHCP message MUST NOT include more than one Authentication
   option.

   The protocol field in the Authentication option identifies the
   specific protocol used to generate the authentication information
   carried in the option.  The algorithm field identifies a specific
   algorithm within the authentication protocol; for example, the
   algorithm field specifies the hash algorithm used to generate the
   Message Authentication Code (MAC) in the Authentication option.  The
   RDM field specifies the type of replay detection used in the replay
   detection field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.3.%20%20Replay%20Detection"></a><a class="selflink" href="#section-20.3" id="section-20.3">20.3</a>.  Replay Detection</span>

   The RDM field of the Authentication option (see <a href="#section-21.11">Section 21.11</a>)
   determines the type of replay detection used in the replay detection
   field.

   If the RDM field contains 0x00, the replay detection field MUST be
   set to the value of a strictly monotonically increasing 64-bit
   unsigned integer (modulo 2^64).  Using this technique can reduce the
   danger of replay attacks.  This method MUST be supported by all
   Authentication option protocols.  One choice might be to use the
   64-bit NTP timestamp format [<a href="./rfc5905" title='"Network Time Protocol Version 4: Protocol and Algorithms Specification"'>RFC5905</a>]).

   A client that receives a message with the RDM field set to 0x00 MUST
   compare its replay detection field with the previous value sent by
   that same server (based on the Server Identifier option; see
   <a href="#section-21.3">Section 21.3</a>) and only accept the message if the received value is
   greater and record this as the new value.  If this is the first time



<span class="grey">Mrugalski, et al.            Standards Track                   [Page 94]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-95"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   a client processes an Authentication option sent by a server, the
   client MUST record the replay detection value and skip the replay
   detection check.

   Servers that support the reconfigure mechanism MUST ensure that the
   replay detection value is retained between restarts.  Failing to do
   so may cause clients to refuse Reconfigure messages sent by the
   server, effectively rendering the reconfigure mechanism useless.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.4.%20%20Reconfiguration%20Key%20Authentication%20Protocol%20%28RKAP%29"></a><a class="selflink" href="#section-20.4" id="section-20.4">20.4</a>.  Reconfiguration Key Authentication Protocol (RKAP)</span>

   RKAP provides protection against misconfiguration of a client caused
   by a Reconfigure message sent by a malicious DHCP server.  In this
   protocol, a DHCP server sends a reconfigure key to the client in the
   initial exchange of DHCP messages.  The client records the
   reconfigure key for use in authenticating subsequent Reconfigure
   messages from that server.  The server then includes a Hashed Message
   Authentication Code (HMAC) computed from the reconfigure key in
   subsequent Reconfigure messages.

   Both the reconfigure key sent from the server to the client and the
   HMAC in subsequent Reconfigure messages are carried as the
   authentication information in an Authentication option (see
   <a href="#section-21.11">Section 21.11</a>).  The format of the authentication information is
   defined in the following section.

   RKAP is used (initiated by the server) only if the client and server
   have negotiated to use Reconfigure messages.























<span class="grey">Mrugalski, et al.            Standards Track                   [Page 95]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-96"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.4.1.%20%20Use%20of%20the%20Authentication%20Option%20in%20RKAP"></a><a class="selflink" href="#section-20.4.1" id="section-20.4.1">20.4.1</a>.  Use of the Authentication Option in RKAP</span>

   The following fields are set in an Authentication option (see
   <a href="#section-21.11">Section 21.11</a>) for RKAP:

      protocol   3

      algorithm  1

      RDM        0

   The format of the authentication information for RKAP is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |                 Value (128 bits)              |
      +-+-+-+-+-+-+-+-+                                               |
      .                                                               .
      .                                                               .
      .                                               +-+-+-+-+-+-+-+-+
      |                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 11: RKAP Authentication Information

      Type             Type of data in the Value field carried in this
                       option:

                          1    Reconfigure key value (used in the Reply
                               message).

                          2    HMAC-MD5 digest of the message (used in
                               the Reconfigure message).

                       A 1-octet field.

      Value            Data as defined by the Type field.  A 16-octet
                       field.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.4.2.%20%20Server%20Considerations%20for%20RKAP"></a><a class="selflink" href="#section-20.4.2" id="section-20.4.2">20.4.2</a>.  Server Considerations for RKAP</span>

   The server selects a reconfigure key for a client during the
   Request/Reply, Solicit/Reply, or Information-request/Reply message
   exchange.  The server records the reconfigure key and transmits that
   key to the client in an Authentication option (see <a href="#section-21.11">Section 21.11</a>) in
   the Reply message.




<span class="grey">Mrugalski, et al.            Standards Track                   [Page 96]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-97"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The reconfigure key is 128 bits long and MUST be a cryptographically
   strong random or pseudorandom number that cannot easily be predicted.

   To provide authentication for a Reconfigure message, the server
   selects a replay detection value according to the RDM selected by the
   server and computes an HMAC-MD5 of the Reconfigure message using the
   reconfigure key for the client.  The server computes the HMAC-MD5
   over the entire DHCP Reconfigure message, including the
   Authentication option; the HMAC-MD5 field in the Authentication
   option is set to 0 for the HMAC-MD5 computation.  The server includes
   the HMAC-MD5 in the authentication information field in an
   Authentication option included in the Reconfigure message sent to the
   client.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/20.4.3.%20%20Client%20Considerations%20for%20RKAP"></a><a class="selflink" href="#section-20.4.3" id="section-20.4.3">20.4.3</a>.  Client Considerations for RKAP</span>

   The client will receive a reconfigure key from the server in an
   Authentication option (see <a href="#section-21.11">Section 21.11</a>) in the initial Reply
   message from the server.  The client records the reconfigure key for
   use in authenticating subsequent Reconfigure messages.

   To authenticate a Reconfigure message, the client computes an
   HMAC-MD5 over the Reconfigure message, with zeroes substituted for
   the HMAC-MD5 field, using the reconfigure key received from the
   server.  If this computed HMAC-MD5 matches the value in the
   Authentication option, the client accepts the Reconfigure message.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.%20%20DHCP%20Options"></a><a class="selflink" href="#section-21" id="section-21">21</a>.  DHCP Options</span>

   Options are used to carry additional information and parameters in
   DHCP messages.  Every option shares a common base format, as
   described in <a href="#section-21.1">Section 21.1</a>.  All values in options are represented in
   network byte order.

   This document describes the DHCP options defined as part of the base
   DHCP specification.  Other options may be defined in the future in
   separate documents.  See [<a href="./rfc7227" title='"Guidelines for Creating New DHCPv6 Options"'>RFC7227</a>] for guidelines regarding the
   definition of new options.  See <a href="#section-24">Section 24</a> for additional information
   about the DHCPv6 "Option Codes" registry maintained by IANA.

   Unless otherwise noted, each option may appear only in the options
   area of a DHCP message and may appear only once.  If an option does
   appear multiple times, each instance is considered separate and the
   data areas of the options MUST NOT be concatenated or otherwise
   combined.






<span class="grey">Mrugalski, et al.            Standards Track                   [Page 97]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-98"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Options that are allowed to appear only once are called "singleton
   options".  The only non-singleton options defined in this document
   are the IA_NA (see <a href="#section-21.4">Section 21.4</a>), IA_TA (see <a href="#section-21.5">Section 21.5</a>), Vendor
   Class (see <a href="#section-21.16">Section 21.16</a>), Vendor-specific Information (see
   <a href="#section-21.17">Section 21.17</a>), and IA_PD (see <a href="#section-21.21">Section 21.21</a>) options.  Also, IA
   Address (see <a href="#section-21.6">Section 21.6</a>) and IA Prefix (see <a href="#section-21.22">Section 21.22</a>) may
   appear in their respective IA options more than once.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.1.%20%20Format%20of%20DHCP%20Options"></a><a class="selflink" href="#section-21.1" id="section-21.1">21.1</a>.  Format of DHCP Options</span>

   The format of DHCP options is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          option-code          |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          option-data                          |
      |                      (option-len octets)                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 12: Option Format

      option-code          An unsigned integer identifying the specific
                           option type carried in this option.
                           A 2-octet field.

      option-len           An unsigned integer giving the length of the
                           option-data field in this option in octets.
                           A 2-octet field.

      option-data          The data for the option; the format of this
                           data depends on the definition of the option.
                           A variable-length field (the length, in
                           octets, is specified by option-len).

   DHCP options are scoped by using encapsulation.  Some options apply
   generally to the client, some are specific to an IA, and some are
   specific to the addresses within an IA.  These latter two cases are
   discussed in Sections <a href="#section-21.4">21.4</a>, <a href="#section-21.5">21.5</a>, and <a href="#section-21.6">21.6</a>.











<span class="grey">Mrugalski, et al.            Standards Track                   [Page 98]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-99"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.2.%20%20Client%20Identifier%20Option"></a><a class="selflink" href="#section-21.2" id="section-21.2">21.2</a>.  Client Identifier Option</span>

   The Client Identifier option is used to carry a DUID (see <a href="#section-11">Section 11</a>)
   that identifies the client.  The format of the Client Identifier
   option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        OPTION_CLIENTID        |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                              DUID                             .
      .                        (variable length)                      .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 13: Client Identifier Option Format

      option-code          OPTION_CLIENTID (1).

      option-len           Length of DUID in octets.

      DUID                 The DUID for the client.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.3.%20%20Server%20Identifier%20Option"></a><a class="selflink" href="#section-21.3" id="section-21.3">21.3</a>.  Server Identifier Option</span>

   The Server Identifier option is used to carry a DUID (see <a href="#section-11">Section 11</a>)
   that identifies the server.  The format of the Server Identifier
   option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        OPTION_SERVERID        |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                              DUID                             .
      .                        (variable length)                      .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 14: Server Identifier Option Format








<span class="grey">Mrugalski, et al.            Standards Track                   [Page 99]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-100"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_SERVERID (2).

      option-len           Length of DUID in octets.

      DUID                 The DUID for the server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.4.%20%20Identity%20Association%20for%20Non-temporary%20Addresses%20Option"></a><a class="selflink" href="#section-21.4" id="section-21.4">21.4</a>.  Identity Association for Non-temporary Addresses Option</span>

   The Identity Association for Non-temporary Addresses (IA_NA) option
   is used to carry an IA_NA, the parameters associated with the IA_NA,
   and the non-temporary addresses associated with the IA_NA.

   Addresses appearing in an IA_NA option are not temporary addresses
   (see <a href="#section-21.5">Section 21.5</a>).

   The format of the IA_NA option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_IA_NA         |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        IAID (4 octets)                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                              T1                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                              T2                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      .                         IA_NA-options                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Figure 15: Identity Association for Non-temporary Addresses
                               Option Format

      option-code          OPTION_IA_NA (3).

      option-len           12 + length of IA_NA-options field.

      IAID                 The unique identifier for this IA_NA; the
                           IAID must be unique among the identifiers for
                           all of this client's IA_NAs.  The number
                           space for IA_NA IAIDs is separate from the
                           number space for other IA option types (i.e.,
                           IA_TA and IA_PD).  A 4-octet field containing
                           an unsigned integer.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 100]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-101"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      T1                   The time interval after which the client
                           should contact the server from which the
                           addresses in the IA_NA were obtained to
                           extend the lifetimes of the addresses
                           assigned to the IA_NA; T1 is a time duration
                           relative to the current time expressed in
                           units of seconds.  A 4-octet field containing
                           an unsigned integer.

      T2                   The time interval after which the client
                           should contact any available server to extend
                           the lifetimes of the addresses assigned to
                           the IA_NA; T2 is a time duration relative to
                           the current time expressed in units of
                           seconds.  A 4-octet field containing an
                           unsigned integer.

      IA_NA-options        Options associated with this IA_NA.  A
                           variable-length field (12 octets less than
                           the value in the option-len field).

   The IA_NA-options field encapsulates those options that are specific
   to this IA_NA.  For example, all of the IA Address options (see
   <a href="#section-21.6">Section 21.6</a>) carrying the addresses associated with this IA_NA are
   in the IA_NA-options field.

   Each IA_NA carries one "set" of non-temporary addresses; it is up to
   the server policy to determine how many addresses are assigned, but
   typically at most one address is assigned from each prefix assigned
   to the link to which the client is attached.

   An IA_NA option may only appear in the options area of a DHCP
   message.  A DHCP message may contain multiple IA_NA options (though
   each must have a unique IAID).

   The status of any operations involving this IA_NA is indicated in a
   Status Code option (see <a href="#section-21.13">Section 21.13</a>) in the IA_NA-options field.

   Note that an IA_NA has no explicit "lifetime" or "lease length" of
   its own.  When the valid lifetimes of all of the addresses in an
   IA_NA have expired, the IA_NA can be considered as having expired.
   T1 and T2 are included to give servers explicit control over when a
   client recontacts the server about a specific IA_NA.

   In a message sent by a client to a server, the T1 and T2 fields
   SHOULD be set to 0.  The server MUST ignore any values in these
   fields in messages received from a client.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 101]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-102"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   In a message sent by a server to a client, the client MUST use the
   values in the T1 and T2 fields for the T1 and T2 times, unless values
   in those fields are 0.  The values in the T1 and T2 fields are the
   number of seconds until T1 and T2 and are calculated since reception
   of the message.

   As per <a href="#section-7.7">Section 7.7</a>, the value 0xffffffff is taken to mean "infinity"
   and should be used carefully.

   The server selects the T1 and T2 values to allow the client to extend
   the lifetimes of any addresses in the IA_NA before the lifetimes
   expire, even if the server is unavailable for some short period of
   time.  Recommended values for T1 and T2 are 0.5 and 0.8 times the
   shortest preferred lifetime of the addresses in the IA that the
   server is willing to extend, respectively.  If the "shortest"
   preferred lifetime is 0xffffffff ("infinity"), the recommended T1 and
   T2 values are also 0xffffffff.  If the time at which the addresses in
   an IA_NA are to be renewed is to be left to the discretion of the
   client, the server sets the T1 and T2 values to 0.  The client MUST
   follow the rules defined in <a href="#section-14.2">Section 14.2</a>.

   If a client receives an IA_NA with T1 greater than T2 and both T1 and
   T2 are greater than 0, the client discards the IA_NA option and
   processes the remainder of the message as though the server had not
   included the invalid IA_NA option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.5.%20%20Identity%20Association%20for%20Temporary%20Addresses%20Option"></a><a class="selflink" href="#section-21.5" id="section-21.5">21.5</a>.  Identity Association for Temporary Addresses Option</span>

   The Identity Association for Temporary Addresses (IA_TA) option is
   used to carry an IA_TA, the parameters associated with the IA_TA, and
   the addresses associated with the IA_TA.  All of the addresses in
   this option are used by the client as temporary addresses, as defined
   in [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>].  The format of the IA_TA option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_IA_TA         |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        IAID (4 octets)                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      .                         IA_TA-options                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure 16: Identity Association for Temporary Addresses Option Format




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 102]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-103"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_IA_TA (4).

      option-len           4 + length of IA_TA-options field.

      IAID                 The unique identifier for this IA_TA; the
                           IAID must be unique among the identifiers for
                           all of this client's IA_TAs.  The number
                           space for IA_TA IAIDs is separate from the
                           number space for other IA option types (i.e.,
                           IA_NA and IA_PD).  A 4-octet field containing
                           an unsigned integer.

      IA_TA-options        Options associated with this IA_TA.  A
                           variable-length field (4 octets less than the
                           value in the option-len field).

   The IA_TA-options field encapsulates those options that are specific
   to this IA_TA.  For example, all of the IA Address options (see
   <a href="#section-21.6">Section 21.6</a>) carrying the addresses associated with this IA_TA are
   in the IA_TA-options field.

   Each IA_TA carries one "set" of temporary addresses.  It is up to the
   server policy to determine how many addresses are assigned.

   An IA_TA option may only appear in the options area of a DHCP
   message.  A DHCP message may contain multiple IA_TA options (though
   each must have a unique IAID).

   The status of any operations involving this IA_TA is indicated in a
   Status Code option (see <a href="#section-21.13">Section 21.13</a>) in the IA_TA-options field.

   Note that an IA has no explicit "lifetime" or "lease length" of its
   own.  When the valid lifetimes of all of the addresses in an IA_TA
   have expired, the IA can be considered as having expired.

   An IA_TA option does not include values for T1 and T2.  A client MAY
   request that the valid lifetime on temporary addresses be extended by
   including the addresses in an IA_TA option sent in a Renew or Rebind
   message to a server.  For example, a client would request an
   extension on the valid lifetime of a temporary address to allow an
   application to continue to use an established TCP connection.
   Extending only the valid, but not the preferred, lifetime means the
   address will end up in a deprecated state eventually.  Existing
   connections could continue, but no new ones would be created using
   that address.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 103]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-104"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The client obtains new temporary addresses by sending an IA_TA option
   with a new IAID to a server.  Requesting new temporary addresses from
   the server is the equivalent of generating new temporary addresses as
   described in [<a href="./rfc4941" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>].  The server will generate new temporary
   addresses and return them to the client.  The client should request
   new temporary addresses before the lifetimes on the previously
   assigned addresses expire.

   A server MUST return the same set of temporary addresses for the same
   IA_TA (as identified by the IAID) as long as those addresses are
   still valid.  After the lifetimes of the addresses in an IA_TA have
   expired, the IAID may be reused to identify a new IA_TA with new
   temporary addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.6.%20%20IA%20Address%20Option"></a><a class="selflink" href="#section-21.6" id="section-21.6">21.6</a>.  IA Address Option</span>

   The IA Address option is used to specify an address associated with
   an IA_NA or an IA_TA.  The IA Address option must be encapsulated in
   the IA_NA-options field of an IA_NA option (see <a href="#section-21.4">Section 21.4</a>) or the
   IA_TA-options field of an IA_TA option (see <a href="#section-21.5">Section 21.5</a>).  The
   IAaddr-options field encapsulates those options that are specific to
   this address.

   The format of the IA Address option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_IAADDR        |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      |                         IPv6-address                          |
      |                                                               |
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      preferred-lifetime                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        valid-lifetime                         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                        IAaddr-options                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 17: IA Address Option Format






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 104]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-105"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_IAADDR (5).

      option-len           24 + length of IAaddr-options field.

      IPv6-address         An IPv6 address.  A client MUST NOT form an
                           implicit prefix with a length other than 128
                           for this address.  A 16-octet field.

      preferred-lifetime   The preferred lifetime for the address in the
                           option, expressed in units of seconds.  A
                           4-octet field containing an unsigned integer.

      valid-lifetime       The valid lifetime for the address in the
                           option, expressed in units of seconds.  A
                           4-octet field containing an unsigned integer.

      IAaddr-options       Options associated with this address.  A
                           variable-length field (24 octets less than
                           the value in the option-len field).

   In a message sent by a client to a server, the preferred-lifetime and
   valid-lifetime fields SHOULD be set to 0.  The server MUST ignore any
   received values.

   The client SHOULD NOT send the IA Address option with an unspecified
   address (::).

   In a message sent by a server to a client, the client MUST use the
   values in the preferred-lifetime and valid-lifetime fields for the
   preferred and valid lifetimes.  The values in these fields are the
   number of seconds remaining in each lifetime.

   The client MUST discard any addresses for which the preferred
   lifetime is greater than the valid lifetime.

   As per <a href="#section-7.7">Section 7.7</a>, if the valid lifetime of an address is
   0xffffffff, it is taken to mean "infinity" and should be used
   carefully.

   More than one IA Address option can appear in an IA_NA option or an
   IA_TA option.

   The status of any operations involving this IA Address is indicated
   in a Status Code option in the IAaddr-options field, as specified in
   <a href="#section-21.13">Section 21.13</a>.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 105]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-106"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.7.%20%20Option%20Request%20Option"></a><a class="selflink" href="#section-21.7" id="section-21.7">21.7</a>.  Option Request Option</span>

   The Option Request option is used to identify a list of options in a
   message between a client and a server.  The format of the Option
   Request option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |           OPTION_ORO          |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    requested-option-code-1    |    requested-option-code-2    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                              ...                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 18: Option Request Option Format

      option-code               OPTION_ORO (6).

      option-len                2 * number of requested options.

      requested-option-code-n   The option code for an option requested
                                by the client.  Each option code is a
                                2-octet field containing an unsigned
                                integer.

   A client MUST include an Option Request option in a Solicit, Request,
   Renew, Rebind, or Information-request message to inform the server
   about options the client wants the server to send to the client.  For
   certain message types, some option codes MUST be included in the
   Option Request option; see Table 4 for details.

   The Option Request option MUST NOT include the following options:

   -  Client Identifier (see <a href="#section-21.2">Section 21.2</a>)

   -  Server Identifier (see <a href="#section-21.3">Section 21.3</a>)

   -  IA_NA (see <a href="#section-21.4">Section 21.4</a>)

   -  IA_TA (see <a href="#section-21.5">Section 21.5</a>)

   -  IA_PD (see <a href="#section-21.21">Section 21.21</a>)

   -  IA Address (see <a href="#section-21.6">Section 21.6</a>)

   -  IA Prefix (see <a href="#section-21.22">Section 21.22</a>)



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 106]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-107"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   -  Option Request (this section)

   -  Elapsed Time (see <a href="#section-21.9">Section 21.9</a>)

   -  Preference (see <a href="#section-21.8">Section 21.8</a>)

   -  Relay Message (see <a href="#section-21.10">Section 21.10</a>)

   -  Authentication (see <a href="#section-21.11">Section 21.11</a>)

   -  Server Unicast (see <a href="#section-21.12">Section 21.12</a>)

   -  Status Code (see <a href="#section-21.13">Section 21.13</a>)

   -  Rapid Commit (see <a href="#section-21.14">Section 21.14</a>)

   -  User Class (see <a href="#section-21.15">Section 21.15</a>)

   -  Vendor Class (see <a href="#section-21.16">Section 21.16</a>)

   -  Interface-Id (see <a href="#section-21.18">Section 21.18</a>)

   -  Reconfigure Message (see <a href="#section-21.19">Section 21.19</a>)

   -  Reconfigure Accept (see <a href="#section-21.20">Section 21.20</a>)

   Other top-level options MUST appear in the Option Request option or
   they will not be sent by the server.  Only top-level options MAY
   appear in the Option Request option.  Options encapsulated in a
   container option SHOULD NOT appear in an Option Request option; see
   [<a href="./rfc7598" title='"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped Clients"'>RFC7598</a>] for an example of container options.  However, options MAY
   be defined that specify exceptions to this restriction on including
   encapsulated options in an Option Request option.  For example, the
   Option Request option MAY be used to signal support for a feature
   even when that option is encapsulated, as in the case of the Prefix
   Exclude option [<a href="./rfc6603" title='"Prefix Exclude Option for DHCPv6-based Prefix Delegation"'>RFC6603</a>].  See Table 4.















<span class="grey">Mrugalski, et al.            Standards Track                  [Page 107]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-108"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.8.%20%20Preference%20Option"></a><a class="selflink" href="#section-21.8" id="section-21.8">21.8</a>.  Preference Option</span>

   The Preference option is sent by a server to a client to control the
   selection of a server by the client.

   The format of the Preference option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |       OPTION_PREFERENCE       |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  pref-value   |
      +-+-+-+-+-+-+-+-+

                    Figure 19: Preference Option Format

      option-code          OPTION_PREFERENCE (7).

      option-len           1.

      pref-value           The preference value for the server in this
                           message.  A 1-octet unsigned integer.

   A server MAY include a Preference option in an Advertise message to
   control the selection of a server by the client.  See <a href="#section-18.2.9">Section 18.2.9</a>
   for information regarding the use of the Preference option by the
   client and the interpretation of the Preference option data value.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.9.%20%20Elapsed%20Time%20Option"></a><a class="selflink" href="#section-21.9" id="section-21.9">21.9</a>.  Elapsed Time Option</span>

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_ELAPSED_TIME      |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          elapsed-time         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 20: Elapsed Time Option Format











<span class="grey">Mrugalski, et al.            Standards Track                  [Page 108]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-109"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_ELAPSED_TIME (8).

      option-len           2.

      elapsed-time         The amount of time since the client began its
                           current DHCP transaction.  This time is
                           expressed in hundredths of a second
                           (10^-2 seconds).  A 2-octet field containing
                           an unsigned integer.

   A client MUST include an Elapsed Time option in messages to indicate
   how long the client has been trying to complete a DHCP message
   exchange.  The elapsed time is measured from the time at which the
   client sent the first message in the message exchange, and the
   elapsed-time field is set to 0 in the first message in the message
   exchange.  Servers and relay agents use the data value in this option
   as input to policy that controls how a server responds to a client
   message.  For example, the Elapsed Time option allows a secondary
   DHCP server to respond to a request when a primary server has not
   answered in a reasonable time.  The elapsed-time value is a 16-bit
   (2-octet) unsigned integer.  The client uses the value 0xffff to
   represent any elapsed-time values greater than the largest time value
   that can be represented in the Elapsed Time option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.10.%20%20Relay%20Message%20Option"></a><a class="selflink" href="#section-21.10" id="section-21.10">21.10</a>.  Relay Message Option</span>

   The Relay Message option carries a DHCP message in a Relay-forward or
   Relay-reply message.

   The format of the Relay Message option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        OPTION_RELAY_MSG       |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      .                       DHCP-relay-message                      .
      .                                                               .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 21: Relay Message Option Format








<span class="grey">Mrugalski, et al.            Standards Track                  [Page 109]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-110"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_RELAY_MSG (9).

      option-len           Length of DHCP-relay-message field.

      DHCP-relay-message   In a Relay-forward message, the received
                           message, relayed verbatim to the next relay
                           agent or server; in a Relay-reply message,
                           the message to be copied and relayed to the
                           relay agent or client whose address is in the
                           peer-address field of the Relay-reply
                           message.  The length, in octets, is specified
                           by option-len.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.11.%20%20Authentication%20Option"></a><a class="selflink" href="#section-21.11" id="section-21.11">21.11</a>.  Authentication Option</span>

   The Authentication option carries authentication information to
   authenticate the identity and contents of DHCP messages.  The use of
   the Authentication option is described in <a href="#section-20">Section 20</a>.  The delayed
   authentication protocol, defined in [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>], has been obsoleted by
   this document, due to lack of usage (see <a href="#section-25">Section 25</a>).  The format of
   the Authentication option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_AUTH          |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   protocol    |   algorithm   |      RDM      |               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
      |                                                               |
      |          replay detection (64 bits)           +-+-+-+-+-+-+-+-+
      |                                               |               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
      .                   authentication information                  .
      .                       (variable length)                       .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 22: Authentication Option Format

      option-code                  OPTION_AUTH (11).

      option-len                   11 + length of authentication
                                   information field.

      protocol                     The authentication protocol used in
                                   this Authentication option.  A
                                   1-octet unsigned integer.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 110]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-111"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      algorithm                    The algorithm used in the
                                   authentication protocol.  A 1-octet
                                   unsigned integer.

      RDM                          The replay detection method used in
                                   this Authentication option.  A
                                   1-octet unsigned integer.

      replay detection             The replay detection information for
                                   the RDM.  A 64-bit (8-octet) field.

      authentication information   The authentication information, as
                                   specified by the protocol and
                                   algorithm used in this Authentication
                                   option.  A variable-length field
                                   (11 octets less than the value in the
                                   option-len field).

   IANA maintains a registry for the protocol, algorithm, and RDM values
   at &lt;<a href="https://www.iana.org/assignments/auth-namespaces">https://www.iana.org/assignments/auth-namespaces</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.12.%20%20Server%20Unicast%20Option"></a><a class="selflink" href="#section-21.12" id="section-21.12">21.12</a>.  Server Unicast Option</span>

   The server sends this option to a client to indicate to the client
   that it is allowed to unicast messages to the server.  The format of
   the Server Unicast option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          OPTION_UNICAST       |        option-len             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      |                       server-address                          |
      |                                                               |
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 23: Server Unicast Option Format

      option-code          OPTION_UNICAST (12).

      option-len           16.

      server-address       The 128-bit address to which the client
                           should send messages delivered using unicast.





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 111]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-112"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The server specifies in the server-address field the address to which
   the client is to send unicast messages.  When a client receives this
   option, where permissible and appropriate the client sends messages
   directly to the server using the address specified in the
   server-address field of the option.

   When the server sends a Server Unicast option to the client, some
   messages from the client will not be relayed by relay agents and will
   not include relay agent options from the relay agents.  Therefore, a
   server should only send a Server Unicast option to a client when
   relay agents are not sending relay agent options.  A DHCP server
   rejects any messages sent inappropriately using unicast to ensure
   that messages are relayed by relay agents when relay agent options
   are in use.

   Details about when the client may send messages to the server using
   unicast are provided in <a href="#section-18">Section 18</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.13.%20%20Status%20Code%20Option"></a><a class="selflink" href="#section-21.13" id="section-21.13">21.13</a>.  Status Code Option</span>

   This option returns a status indication related to the DHCP message
   or option in which it appears.  The format of the Status Code
   option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |       OPTION_STATUS_CODE      |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          status-code          |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
      .                                                               .
      .                        status-message                         .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 24: Status Code Option Format

      option-code          OPTION_STATUS_CODE (13).

      option-len           2 + length of status-message field.

      status-code          The numeric code for the status encoded in
                           this option.  A 2-octet field containing an
                           unsigned integer.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 112]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-113"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      status-message       A UTF-8 encoded [<a href="./rfc3629" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] text string
                           suitable for display to an end user.
                           MUST NOT be null-terminated.  A
                           variable-length field (2 octets less than the
                           value in the option-len field).

   A Status Code option may appear in the "options" field of a DHCP
   message and/or in the "options" field of another option.  If the
   Status Code option does not appear in a message in which the option
   could appear, the status of the message is assumed to be Success.

   The status-code values previously defined by [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] and
   [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>] are:

   +---------------+------+--------------------------------------------+
   | Name          | Code | Description                                |
   +---------------+------+--------------------------------------------+
   | Success       |    0 | Success.                                   |
   |               |      |                                            |
   | UnspecFail    |    1 | Failure, reason unspecified; this status   |
   |               |      | code is sent by either a client or a       |
   |               |      | server to indicate a failure not           |
   |               |      | explicitly specified in this document.     |
   |               |      |                                            |
   | NoAddrsAvail  |    2 | The server has no addresses available to   |
   |               |      | assign to the IA(s).                       |
   |               |      |                                            |
   | NoBinding     |    3 | Client record (binding) unavailable.       |
   |               |      |                                            |
   | NotOnLink     |    4 | The prefix for the address is not          |
   |               |      | appropriate for the link to which the      |
   |               |      | client is attached.                        |
   |               |      |                                            |
   | UseMulticast  |    5 | Sent by a server to a client to force the  |
   |               |      | client to send messages to the server      |
   |               |      | using the                                  |
   |               |      | All_DHCP_Relay_Agents_and_Servers          |
   |               |      | multicast address.                         |
   |               |      |                                            |
   | NoPrefixAvail |    6 | The server has no prefixes available to    |
   |               |      | assign to the IA_PD(s).                    |
   +---------------+------+--------------------------------------------+

                     Table 3: Status Code Definitions

   See the "Status Codes" registry at &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/</a>
   <a href="https://www.iana.org/assignments/dhcpv6-parameters">dhcpv6-parameters</a>&gt; for the current list of status codes.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 113]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-114"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.14.%20%20Rapid%20Commit%20Option"></a><a class="selflink" href="#section-21.14" id="section-21.14">21.14</a>.  Rapid Commit Option</span>

   The Rapid Commit option is used to signal the use of the two-message
   exchange for address assignment.  The format of the Rapid Commit
   option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_RAPID_COMMIT      |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 25: Rapid Commit Option Format

      option-code          OPTION_RAPID_COMMIT (14).

      option-len           0.

   A client MAY include this option in a Solicit message if the client
   is prepared to perform the Solicit/Reply message exchange described
   in <a href="#section-18.2.1">Section 18.2.1</a>.

   A server MUST include this option in a Reply message sent in response
   to a Solicit message when completing the Solicit/Reply message
   exchange.

   DISCUSSION:

      Each server that responds with a Reply to a Solicit that includes
      a Rapid Commit option will commit the leases in the Reply message
      to the client but will not receive any confirmation that the
      client has received the Reply message.  Therefore, if more than
      one server responds to a Solicit that includes a Rapid Commit
      option, all but one server will commit leases that are not
      actually used by the client; this could result in incorrect
      address information in DNS if the DHCP servers update DNS
      [<a href="./rfc4704" title='"The Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Client Fully Qualified Domain Name (FQDN) Option"'>RFC4704</a>], and responses to leasequery requests [<a href="./rfc5007" title='"DHCPv6 Leasequery"'>RFC5007</a>] may
      include information on leases not in use by the client.

      The problem of unused leases can be minimized by designing the
      DHCP service so that only one server responds to the Solicit or by
      using relatively short lifetimes for newly assigned leases.









<span class="grey">Mrugalski, et al.            Standards Track                  [Page 114]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-115"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.15.%20%20User%20Class%20Option"></a><a class="selflink" href="#section-21.15" id="section-21.15">21.15</a>.  User Class Option</span>

   The User Class option is used by a client to identify the type or
   category of users or applications it represents.

   The format of the User Class option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |       OPTION_USER_CLASS       |          option-len           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                          user-class-data                      .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 26: User Class Option Format

      option-code          OPTION_USER_CLASS (15).

      option-len           Length of user-class-data field.

      user-class-data      The user classes carried by the client.  The
                           length, in octets, is specified by
                           option-len.

   The information contained in the data area of this option is
   contained in one or more opaque fields that represent the user class
   or classes of which the client is a member.  A server selects
   configuration information for the client based on the classes
   identified in this option.  For example, the User Class option can be
   used to configure all clients of people in the accounting department
   with a different printer than clients of people in the marketing
   department.  The user class information carried in this option MUST
   be configurable on the client.

   The data area of the User Class option MUST contain one or more
   instances of user-class-data information.  Each instance of
   user-class-data is formatted as follows:

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
      |        user-class-len         |          opaque-data          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+

                Figure 27: Format of user-class-data Field





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 115]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-116"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The user-class-len field is 2 octets long and specifies the length of
   the opaque user-class-data in network byte order.

   A server interprets the classes identified in this option according
   to its configuration to select the appropriate configuration
   information for the client.  A server may use only those user classes
   that it is configured to interpret in selecting configuration
   information for a client and ignore any other user classes.  In
   response to a message containing a User Class option, a server may
   include a User Class option containing those classes that were
   successfully interpreted by the server so that the client can be
   informed of the classes interpreted by the server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.16.%20%20Vendor%20Class%20Option"></a><a class="selflink" href="#section-21.16" id="section-21.16">21.16</a>.  Vendor Class Option</span>

   This option is used by a client to identify the vendor that
   manufactured the hardware on which the client is running.  The
   information contained in the data area of this option is contained in
   one or more opaque fields that identify details of the hardware
   configuration.  The format of the Vendor Class option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_VENDOR_CLASS      |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       enterprise-number                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                       vendor-class-data                       .
      .                             . . .                             .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 28: Vendor Class Option Format

      option-code          OPTION_VENDOR_CLASS (16).

      option-len           4 + length of vendor-class-data field.

      enterprise-number    The vendor's registered Enterprise Number as
                           maintained by IANA [<a href="#ref-IANA-PEN" title='"Private Enterprise Numbers"'>IANA-PEN</a>].  A 4-octet
                           field containing an unsigned integer.

      vendor-class-data    The hardware configuration of the node on
                           which the client is running.  A
                           variable-length field (4 octets less than the
                           value in the option-len field).




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 116]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-117"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The vendor-class-data field is composed of a series of separate
   items, each of which describes some characteristic of the client's
   hardware configuration.  Examples of vendor-class-data instances
   might include the version of the operating system the client is
   running or the amount of memory installed on the client.

   Each instance of vendor-class-data is formatted as follows:

      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
      |       vendor-class-len        |          opaque-data          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+

               Figure 29: Format of vendor-class-data Field

   The vendor-class-len field is 2 octets long and specifies the length
   of the opaque vendor-class-data in network byte order.

   Servers and clients MUST NOT include more than one instance of
   OPTION_VENDOR_CLASS with the same Enterprise Number.  Each instance
   of OPTION_VENDOR_CLASS can carry multiple vendor-class-data
   instances.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.17.%20%20Vendor-specific%20Information%20Option"></a><a class="selflink" href="#section-21.17" id="section-21.17">21.17</a>.  Vendor-specific Information Option</span>

   This option is used by clients and servers to exchange vendor-
   specific information.

   The format of the Vendor-specific Information option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_VENDOR_OPTS       |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       enterprise-number                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                       vendor-option-data                      .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

           Figure 30: Vendor-specific Information Option Format

      option-code          OPTION_VENDOR_OPTS (17).

      option-len           4 + length of vendor-option-data field.





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 117]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-118"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      enterprise-number    The vendor's registered Enterprise Number as
                           maintained by IANA [<a href="#ref-IANA-PEN" title='"Private Enterprise Numbers"'>IANA-PEN</a>].  A 4-octet
                           field containing an unsigned integer.

      vendor-option-data   Vendor options, interpreted by
                           vendor-specific code on the clients and
                           servers.  A variable-length field (4 octets
                           less than the value in the option-len field).

   The definition of the information carried in this option is vendor
   specific.  The vendor is indicated in the enterprise-number field.
   Use of vendor-specific information allows enhanced operation,
   utilizing additional features in a vendor's DHCP implementation.  A
   DHCP client that does not receive requested vendor-specific
   information will still configure the node's IPv6 stack to be
   functional.

   The vendor-option-data field MUST be encoded as a sequence of
   code/length/value fields of format identical to the DHCP options (see
   <a href="#section-21.1">Section 21.1</a>).  The sub-option codes are defined by the vendor
   identified in the enterprise-number field and are not managed by
   IANA.  Each of the sub-options is formatted as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          sub-opt-code         |         sub-option-len        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                        sub-option-data                        .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 31: Vendor-specific Options Format

      sub-opt-code         The code for the sub-option.  A 2-octet
                           field.

      sub-option-len       An unsigned integer giving the length of the
                           sub-option-data field in this sub-option in
                           octets.  A 2-octet field.

      sub-option-data      The data area for the sub-option.  The
                           length, in octets, is specified by
                           sub-option-len.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 118]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-119"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Multiple instances of the Vendor-specific Information option may
   appear in a DHCP message.  Each instance of the option is interpreted
   according to the option codes defined by the vendor identified by the
   Enterprise Number in that option.  Servers and clients MUST NOT send
   more than one instance of the Vendor-specific Information option with
   the same Enterprise Number.  Each instance of the Vendor-specific
   Information option MAY contain multiple sub-options.

   A client that is interested in receiving a Vendor-specific
   Information option:

   -  MUST specify the Vendor-specific Information option in an Option
      Request option.

   -  MAY specify an associated Vendor Class option (see <a href="#section-21.16">Section 21.16</a>).

   -  MAY specify the Vendor-specific Information option with
      appropriate data.

   Servers only return the Vendor-specific Information options if
   specified in Option Request options from clients and:

   -  MAY use the Enterprise Numbers in the associated Vendor Class
      options to restrict the set of Enterprise Numbers in the
      Vendor-specific Information options returned.

   -  MAY return all configured Vendor-specific Information options.

   -  MAY use other information in the packet or in its configuration to
      determine which set of Enterprise Numbers in the Vendor-specific
      Information options to return.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.18.%20%20Interface-Id%20Option"></a><a class="selflink" href="#section-21.18" id="section-21.18">21.18</a>.  Interface-Id Option</span>

   The relay agent MAY send the Interface-Id option to identify the
   interface on which the client message was received.  If a relay agent
   receives a Relay-reply message with an Interface-Id option, the relay
   agent relays the message to the client through the interface
   identified by the option.












<span class="grey">Mrugalski, et al.            Standards Track                  [Page 119]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-120"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The format of the Interface-Id option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_INTERFACE_ID      |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                         interface-id                          .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 32: Interface-Id Option Format

      option-code          OPTION_INTERFACE_ID (18).

      option-len           Length of interface-id field.

      interface-id         An opaque value of arbitrary length generated
                           by the relay agent to identify one of the
                           relay agent's interfaces.  The length, in
                           octets, is specified by option-len.

   The server MUST copy the Interface-Id option from the Relay-forward
   message into the Relay-reply message the server sends to the relay
   agent in response to the Relay-forward message.  This option MUST NOT
   appear in any message except a Relay-forward or Relay-reply message.

   Servers MAY use the interface-id field for parameter assignment
   policies.  The interface-id value SHOULD be considered an opaque
   value, with policies based on exact match only; that is, the
   interface-id field SHOULD NOT be internally parsed by the server.
   The interface-id value for an interface SHOULD be stable and remain
   unchanged -- for example, after the relay agent is restarted; if the
   interface-id value changes, a server will not be able to use it
   reliably in parameter assignment policies.















<span class="grey">Mrugalski, et al.            Standards Track                  [Page 120]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-121"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.19.%20%20Reconfigure%20Message%20Option"></a><a class="selflink" href="#section-21.19" id="section-21.19">21.19</a>.  Reconfigure Message Option</span>

   A server includes a Reconfigure Message option in a Reconfigure
   message to indicate to the client whether the client responds with a
   Renew message, a Rebind message, or an Information-request message.
   The format of the Reconfigure Message option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_RECONF_MSG        |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    msg-type   |
      +-+-+-+-+-+-+-+-+

               Figure 33: Reconfigure Message Option Format

      option-code          OPTION_RECONF_MSG (19).

      option-len           1.

      msg-type             5 for Renew message, 6 for Rebind message,
                           11 for Information-request message.  A
                           1-octet unsigned integer.

   The Reconfigure Message option can only appear in a Reconfigure
   message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.20.%20%20Reconfigure%20Accept%20Option"></a><a class="selflink" href="#section-21.20" id="section-21.20">21.20</a>.  Reconfigure Accept Option</span>

   A client uses the Reconfigure Accept option to announce to the server
   whether the client is willing to accept Reconfigure messages, and a
   server uses this option to tell the client whether or not to accept
   Reconfigure messages.  In the absence of this option, the default
   behavior is that the client is unwilling to accept Reconfigure
   messages.  The format of the Reconfigure Accept option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     OPTION_RECONF_ACCEPT      |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 34: Reconfigure Accept Option Format

      option-code          OPTION_RECONF_ACCEPT (20).

      option-len           0.



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 121]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-122"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.21.%20%20Identity%20Association%20for%20Prefix%20Delegation%20Option"></a><a class="selflink" href="#section-21.21" id="section-21.21">21.21</a>.  Identity Association for Prefix Delegation Option</span>

   The IA_PD option is used to carry a prefix delegation identity
   association, the parameters associated with the IA_PD, and the
   prefixes associated with it.  The format of the IA_PD option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         OPTION_IA_PD          |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         IAID (4 octets)                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                              T1                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                              T2                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      .                                                               .
      .                          IA_PD-options                        .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    Figure 35: Identity Association for Prefix Delegation Option Format

      option-code          OPTION_IA_PD (25).

      option-len           12 + length of IA_PD-options field.

      IAID                 The unique identifier for this IA_PD; the
                           IAID must be unique among the identifiers for
                           all of this client's IA_PDs.  The number
                           space for IA_PD IAIDs is separate from the
                           number space for other IA option types (i.e.,
                           IA_NA and IA_TA).  A 4-octet field containing
                           an unsigned integer.

      T1                   The time interval after which the client
                           should contact the server from which the
                           prefixes in the IA_PD were obtained to extend
                           the lifetimes of the prefixes delegated to
                           the IA_PD; T1 is a time duration relative to
                           the message reception time expressed in units
                           of seconds.  A 4-octet field containing an
                           unsigned integer.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 122]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-123"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      T2                   The time interval after which the client
                           should contact any available server to extend
                           the lifetimes of the prefixes assigned to the
                           IA_PD; T2 is a time duration relative to the
                           message reception time expressed in units of
                           seconds.  A 4-octet field containing an
                           unsigned integer.

      IA_PD-options        Options associated with this IA_PD.  A
                           variable-length field (12 octets less than
                           the value in the option-len field).

   The IA_PD-options field encapsulates those options that are specific
   to this IA_PD.  For example, all of the IA Prefix options (see
   <a href="#section-21.22">Section 21.22</a>) carrying the prefixes associated with this IA_PD are
   in the IA_PD-options field.

   An IA_PD option may only appear in the options area of a DHCP
   message.  A DHCP message may contain multiple IA_PD options (though
   each must have a unique IAID).

   The status of any operations involving this IA_PD is indicated in a
   Status Code option (see <a href="#section-21.13">Section 21.13</a>) in the IA_PD-options field.

   Note that an IA_PD has no explicit "lifetime" or "lease length" of
   its own.  When the valid lifetimes of all of the prefixes in an IA_PD
   have expired, the IA_PD can be considered as having expired.  T1 and
   T2 fields are included to give the server explicit control over when
   a client should contact the server about a specific IA_PD.

   In a message sent by a client to a server, the T1 and T2 fields
   SHOULD be set to 0.  The server MUST ignore any values in these
   fields in messages received from a client.

   In a message sent by a server to a client, the client MUST use the
   values in the T1 and T2 fields for the T1 and T2 timers, unless
   values in those fields are 0.  The values in the T1 and T2 fields are
   the number of seconds until T1 and T2.

   The server selects the T1 and T2 times to allow the client to extend
   the lifetimes of any prefixes in the IA_PD before the lifetimes
   expire, even if the server is unavailable for some short period of
   time.  Recommended values for T1 and T2 are 0.5 and 0.8 times the
   shortest preferred lifetime of the prefixes in the IA_PD that the
   server is willing to extend, respectively.  If the time at which the
   prefixes in an IA_PD are to be renewed is to be left to the
   discretion of the client, the server sets T1 and T2 to 0.  The client
   MUST follow the rules defined in <a href="#section-14.2">Section 14.2</a>.



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 123]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-124"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   If a client receives an IA_PD with T1 greater than T2 and both T1 and
   T2 are greater than 0, the client discards the IA_PD option and
   processes the remainder of the message as though the server had not
   included the IA_PD option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.22.%20%20IA%20Prefix%20Option"></a><a class="selflink" href="#section-21.22" id="section-21.22">21.22</a>.  IA Prefix Option</span>

   The IA Prefix option is used to specify a prefix associated with an
   IA_PD.  The IA Prefix option must be encapsulated in the
   IA_PD-options field of an IA_PD option (see <a href="#section-21.21">Section 21.21</a>).

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        OPTION_IAPREFIX        |           option-len          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      preferred-lifetime                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        valid-lifetime                         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | prefix-length |                                               |
      +-+-+-+-+-+-+-+-+          IPv6-prefix                          |
      |                           (16 octets)                         |
      |                                                               |
      |                                                               |
      |                                                               |
      |               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               |                                               .
      +-+-+-+-+-+-+-+-+                                               .
      .                       IAprefix-options                        .
      .                                                               .
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 36: IA Prefix Option Format

      option-code          OPTION_IAPREFIX (26).

      option-len           25 + length of IAprefix-options field.

      preferred-lifetime   The preferred lifetime for the prefix in the
                           option, expressed in units of seconds.  A
                           value of 0xffffffff represents "infinity"
                           (see <a href="#section-7.7">Section 7.7</a>).  A 4-octet field
                           containing an unsigned integer.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 124]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-125"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      valid-lifetime       The valid lifetime for the prefix in the
                           option, expressed in units of seconds.  A
                           value of 0xffffffff represents "infinity".  A
                           4-octet field containing an unsigned integer.

      prefix-length        Length for this prefix in bits.  A 1-octet
                           unsigned integer.

      IPv6-prefix          An IPv6 prefix.  A 16-octet field.

      IAprefix-options     Options associated with this prefix.  A
                           variable-length field (25 octets less than
                           the value in the option-len field).

   In a message sent by a client to a server, the preferred-lifetime and
   valid-lifetime fields SHOULD be set to 0.  The server MUST ignore any
   received values in these lifetime fields.

   The client SHOULD NOT send an IA Prefix option with 0 in the
   "prefix-length" field (and an unspecified value (::) in the
   "IPv6-prefix" field).  A client MAY send a non-zero value in the
   "prefix-length" field and the unspecified value (::) in the
   "IPv6-prefix" field to indicate a preference for the size of the
   prefix to be delegated.  See [<a href="./rfc8168" title='"DHCPv6 Prefix-Length Hint Issues"'>RFC8168</a>] for further details on prefix-
   length hints.

   The client MUST discard any prefixes for which the preferred lifetime
   is greater than the valid lifetime.

   The values in the preferred-lifetime and valid-lifetime fields are
   the number of seconds remaining in each lifetime.  See
   <a href="#section-18.2.10.1">Section 18.2.10.1</a> for more details on how these values are used for
   delegated prefixes.

   As per <a href="#section-7.7">Section 7.7</a>, the value of 0xffffffff for the preferred
   lifetime or the valid lifetime is taken to mean "infinity" and should
   be used carefully.

   An IA Prefix option may appear only in an IA_PD option.  More than
   one IA Prefix option can appear in a single IA_PD option.

   The status of any operations involving this IA Prefix option is
   indicated in a Status Code option (see <a href="#section-21.13">Section 21.13</a>) in the
   IAprefix-options field.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 125]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-126"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.23.%20%20Information%20Refresh%20Time%20Option"></a><a class="selflink" href="#section-21.23" id="section-21.23">21.23</a>.  Information Refresh Time Option</span>

   This option is requested by clients and returned by servers to
   specify an upper bound for how long a client should wait before
   refreshing information retrieved from a DHCP server.  It is only used
   in Reply messages in response to Information-request messages.  In
   other messages, there will usually be other information that
   indicates when the client should contact the server, e.g., T1/T2
   times and lifetimes.  This option is useful when the configuration
   parameters change or during a renumbering event, as clients running
   in the stateless mode will be able to update their configuration.

   The format of the Information Refresh Time option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |OPTION_INFORMATION_REFRESH_TIME|         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                   information-refresh-time                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

             Figure 37: Information Refresh Time Option Format

      option-code                OPTION_INFORMATION_REFRESH_TIME (32).

      option-len                 4.

      information-refresh-time   Time duration relative to the current
                                 time, expressed in units of seconds.  A
                                 4-octet field containing an unsigned
                                 integer.

   A DHCP client MUST request this option in the Option Request option
   (see <a href="#section-21.7">Section 21.7</a>) when sending Information-request messages.  A
   client MUST NOT request this option in the Option Request option in
   any other messages.

   A server sending a Reply to an Information-request message SHOULD
   include this option if it is requested in the Option Request option
   of the Information-request.  The option value MUST NOT be smaller
   than IRT_MINIMUM.  This option MUST only appear in the top-level
   options area of Reply messages.

   If the Reply to an Information-request message does not contain this
   option, the client MUST behave as if the option with the value
   IRT_DEFAULT was provided.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 126]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-127"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   A client MUST use the refresh time IRT_MINIMUM if it receives the
   option with a value less than IRT_MINIMUM.

   As per <a href="#section-7.7">Section 7.7</a>, the value 0xffffffff is taken to mean "infinity"
   and implies that the client should not refresh its configuration data
   without some other trigger (such as detecting movement to a new
   link).

   If a client contacts the server to obtain new data or refresh some
   existing data before the refresh time expires, then it SHOULD also
   refresh all data covered by this option.

   When the client detects that the refresh time has expired, it SHOULD
   try to update its configuration data by sending an
   Information-request as specified in <a href="#section-18.2.6">Section 18.2.6</a>, except that the
   client MUST delay sending the first Information-request by a random
   amount of time between 0 and INF_MAX_DELAY.

   A client MAY have a maximum value for the refresh time, where that
   value is used whenever the client receives this option with a value
   higher than the maximum.  This also means that the maximum value is
   used when the received value is "infinity".  A maximum value might
   make the client less vulnerable to attacks based on forged DHCP
   messages.  Without a maximum value, a client may be made to use wrong
   information for a possibly infinite period of time.  There may,
   however, be reasons for having a very long refresh time, so it may be
   useful for this maximum value to be configurable.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.24.%20%20SOL_MAX_RT%20Option"></a><a class="selflink" href="#section-21.24" id="section-21.24">21.24</a>.  SOL_MAX_RT Option</span>

   A DHCP server sends the SOL_MAX_RT option to a client to override the
   default value of SOL_MAX_RT.  The value of SOL_MAX_RT in the option
   replaces the default value defined in <a href="#section-7.6">Section 7.6</a>.  One use for the
   SOL_MAX_RT option is to set a higher value for SOL_MAX_RT; this
   reduces the Solicit traffic from a client that has not received a
   response to its Solicit messages.

   The format of the SOL_MAX_RT option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_SOL_MAX_RT        |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       SOL_MAX_RT value                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 38: SOL_MAX_RT Option Format



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 127]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-128"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


      option-code          OPTION_SOL_MAX_RT (82).

      option-len           4.

      SOL_MAX_RT value     Overriding value for SOL_MAX_RT in seconds;
                           MUST be in this range: 60 &lt;= "value" &lt;= 86400
                           (1 day).  A 4-octet field containing an
                           unsigned integer.

   A DHCP client MUST include the SOL_MAX_RT option code in any Option
   Request option (see <a href="#section-21.7">Section 21.7</a>) it sends in a Solicit message.

   The DHCP server MAY include the SOL_MAX_RT option in any response it
   sends to a client that has included the SOL_MAX_RT option code in an
   Option Request option.  The SOL_MAX_RT option is sent as a top-level
   option in the message to the client.

   A DHCP client MUST ignore any SOL_MAX_RT option values that are less
   than 60 or more than 86400.

   If a DHCP client receives a message containing a SOL_MAX_RT option
   that has a valid value for SOL_MAX_RT, the client MUST set its
   internal SOL_MAX_RT parameter to the value contained in the
   SOL_MAX_RT option.  This value of SOL_MAX_RT is then used by the
   retransmission mechanism defined in Sections <a href="#section-15">15</a> and <a href="#section-18.2.1">18.2.1</a>.

   The purpose of this mechanism is to give network administrators a way
   to avoid excessive DHCP traffic if all DHCP servers become
   unavailable.  Therefore, this value is expected to be retained for as
   long as practically possible.

   An updated SOL_MAX_RT value applies only to the network interface on
   which the client received the SOL_MAX_RT option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/21.25.%20%20INF_MAX_RT%20Option"></a><a class="selflink" href="#section-21.25" id="section-21.25">21.25</a>.  INF_MAX_RT Option</span>

   A DHCP server sends the INF_MAX_RT option to a client to override the
   default value of INF_MAX_RT.  The value of INF_MAX_RT in the option
   replaces the default value defined in <a href="#section-7.6">Section 7.6</a>.  One use for the
   INF_MAX_RT option is to set a higher value for INF_MAX_RT; this
   reduces the Information-request traffic from a client that has not
   received a response to its Information-request messages.









<span class="grey">Mrugalski, et al.            Standards Track                  [Page 128]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-129"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   The format of the INF_MAX_RT option is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      OPTION_INF_MAX_RT        |         option-len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       INF_MAX_RT value                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 39: INF_MAX_RT Option Format

      option-code          OPTION_INF_MAX_RT (83).

      option-len           4.

      INF_MAX_RT value     Overriding value for INF_MAX_RT in seconds;
                           MUST be in this range: 60 &lt;= "value" &lt;= 86400
                           (1 day).  A 4-octet field containing an
                           unsigned integer.

   A DHCP client MUST include the INF_MAX_RT option code in any Option
   Request option (see <a href="#section-21.7">Section 21.7</a>) it sends in an Information-request
   message.

   The DHCP server MAY include the INF_MAX_RT option in any response it
   sends to a client that has included the INF_MAX_RT option code in an
   Option Request option.  The INF_MAX_RT option is a top-level option
   in the message to the client.

   A DHCP client MUST ignore any INF_MAX_RT option values that are less
   than 60 or more than 86400.

   If a DHCP client receives a message containing an INF_MAX_RT option
   that has a valid value for INF_MAX_RT, the client MUST set its
   internal INF_MAX_RT parameter to the value contained in the
   INF_MAX_RT option.  This value of INF_MAX_RT is then used by the
   retransmission mechanism defined in Sections <a href="#section-15">15</a> and <a href="#section-18.2.6">18.2.6</a>.

   An updated INF_MAX_RT value applies only to the network interface on
   which the client received the INF_MAX_RT option.










<span class="grey">Mrugalski, et al.            Standards Track                  [Page 129]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-130"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/22.%20%20Security%20Considerations"></a><a class="selflink" href="#section-22" id="section-22">22</a>.  Security Considerations</span>

   This section discusses security considerations that are not related
   to privacy.  See <a href="#section-23">Section 23</a> for a discussion dedicated to privacy.

   The threat to DHCP is inherently an insider threat (assuming a
   properly configured network where DHCP ports are blocked on the
   perimeter gateways of the enterprise).  Regardless of the gateway
   configuration, however, the potential attacks by insiders and
   outsiders are the same.

   DHCP lacks end-to-end encryption between clients and servers; thus,
   hijacking, tampering, and eavesdropping attacks are all possible as a
   result.  Some network environments (discussed below) can be secured
   through various means to minimize these attacks.

   One attack specific to a DHCP client is the establishment of a
   malicious server with the intent of providing incorrect configuration
   information to the client.  The motivation for doing so may be to
   mount a "man in the middle" attack that causes the client to
   communicate with a malicious server instead of a valid server for
   some service (such as DNS or NTP).  The malicious server may also
   mount a DoS attack through misconfiguration of the client; this
   attack would cause all network communication from the client to fail.

   A malicious DHCP server might cause a client to set its SOL_MAX_RT
   and INF_MAX_RT parameters to an unreasonably high value with the
   SOL_MAX_RT (see <a href="#section-21.24">Section 21.24</a>) and INF_MAX_RT (see <a href="#section-21.25">Section 21.25</a>)
   options; this may cause an undue delay in a client completing its
   DHCP protocol transaction in the case where no other valid response
   is received.  Assuming that the client also receives a response from
   a valid DHCP server, large values for SOL_MAX_RT and INF_MAX_RT will
   not have any effect.

   A malicious server can also send a Server Unicast option (see
   <a href="#section-21.12">Section 21.12</a>) to a client in an Advertise message, thus potentially
   causing the client to bypass relays and communicate only with the
   malicious server for subsequent Request and Renew messages.

   Another threat to DHCP clients originates from mistakenly or
   accidentally configured DHCP servers that answer DHCP client requests
   with unintentionally incorrect configuration parameters.

   A DHCP client may also be subject to attack through the receipt of a
   Reconfigure message from a malicious server that causes the client to
   obtain incorrect configuration information from that server.  Note
   that although a client sends its response (Renew, Rebind, or
   Information-request message) through a relay agent and, therefore,



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 130]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-131"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   that response will only be received by servers to which DHCP messages
   are relayed, a malicious server could send a Reconfigure message to a
   client, followed (after an appropriate delay) by a Reply message that
   would be accepted by the client.  Thus, a malicious server that is
   not on the network path between the client and the server may still
   be able to mount a Reconfigure attack on a client.  The use of
   transaction IDs that are cryptographically sound and cannot easily be
   predicted will also reduce the probability that such an attack will
   be successful.

   Because of the opportunity for attack through the Reconfigure
   message, a DHCP client MUST discard any Reconfigure message that does
   not include authentication or that does not pass the validation
   process for the authentication protocol.

   RKAP, described in <a href="#section-20.4">Section 20.4</a>, provides protection against the use
   of a Reconfigure message by a malicious DHCP server to mount a DoS or
   man-in-the-middle attack on a client.  This protocol can be
   compromised by an attacker that can intercept the initial message in
   which the DHCP server sends the key "in plain text" to the client.

   Many of these attacks by rogue servers can be mitigated by making use
   of the mechanisms described in [<a href="./rfc7610" title='"DHCPv6-Shield: Protecting against Rogue DHCPv6 Servers"'>RFC7610</a>] and [<a href="./rfc7513" title='"Source Address Validation Improvement (SAVI) Solution for DHCP"'>RFC7513</a>].

   The threat specific to a DHCP server is an invalid client
   masquerading as a valid client.  The motivation for this may be for
   theft of service, or to circumvent auditing for any number of
   nefarious purposes.

   The threat common to both the client and the server is the "resource-
   exhaustion" DoS attack.  These attacks typically involve the
   exhaustion of available assigned addresses or delegatable prefixes,
   or the exhaustion of CPU or network bandwidth, and are present any
   time there is a shared resource.  Some forms of these exhaustion
   attacks can be partially mitigated by appropriate server policy,
   e.g., limiting the maximum number of leases any one client can get.

   The messages exchanged between relay agents and servers may be used
   to mount a man-in-the-middle or DoS attack.  Communication between a
   server and a relay agent, and communication between relay agents, can
   be authenticated and encrypted through the use of IPsec, as described
   in [<a href="./rfc8213" title='"Security of Messages Exchanged between Servers and Relay Agents"'>RFC8213</a>].









<span class="grey">Mrugalski, et al.            Standards Track                  [Page 131]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-132"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   However, the use of manually configured pre-shared keys for IPsec
   between relay agents and servers does not defend against replayed
   DHCP messages.  Replayed messages can represent a DoS attack through
   exhaustion of processing resources but not through misconfiguration
   or exhaustion of other resources such as assignable addresses and
   delegatable prefixes.

   Various network environments also offer levels of security if
   deployed as described below.

   -  In enterprise and factory networks, use of authentication per
      [<a href="#ref-IEEE-802.1x">IEEE-802.1x</a>] can prevent unknown or untrusted clients from
      connecting to the network.  However, this does not necessarily
      assure that the connected client will be a good DHCP or network
      actor.

   -  For wired networks where clients typically are connected to a
      switch port, snooping DHCP multicast (or unicast) traffic becomes
      difficult, as the switches limit the traffic delivered to a port.
      The client's DHCP multicast packets (with destination address
      fe02::1:2) are only forwarded to the DHCP server's (or relay's)
      switch port -- not all ports.  Also, the server's (or relay's)
      unicast replies are only delivered to the target client's port --
      not all ports.

   -  In public networks (such as a Wi-Fi network in a coffee shop or
      airport), it is possible for others within radio range to snoop
      DHCP and other traffic.  But in these environments, there is very
      little if anything that can be learned from the DHCP traffic
      itself (either from client to server or from server to client) if
      the privacy considerations provided in <a href="#section-23">Section 23</a> are followed.
      Even for devices that do not follow the privacy considerations,
      there is little that can be learned that would not be available
      from subsequent communications anyway (such as the device's Media
      Access Control (MAC) address).  Also, because all clients will
      typically receive similar configuration details, a bad actor that
      initiates a DHCP request itself can learn much of such
      information.  As mentioned above, one threat is that the RKAP key
      for a client can be learned (if the initial
      Solicit/Advertise/Request/Reply exchange is monitored) and trigger
      a premature reconfiguration, but this is relatively easily
      prevented by disallowing direct client-to-client communication on
      these networks or using [<a href="./rfc7610" title='"DHCPv6-Shield: Protecting against Rogue DHCPv6 Servers"'>RFC7610</a>] and [<a href="./rfc7513" title='"Source Address Validation Improvement (SAVI) Solution for DHCP"'>RFC7513</a>].








<span class="grey">Mrugalski, et al.            Standards Track                  [Page 132]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-133"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/23.%20%20Privacy%20Considerations"></a><a class="selflink" href="#section-23" id="section-23">23</a>.  Privacy Considerations</span>

   For an extended discussion about privacy considerations for the
   client, see [<a href="./rfc7824" title='"Privacy Considerations for DHCPv6"'>RFC7824</a>]:

   -  In particular, its <a href="#section-3">Section 3</a> discusses various identifiers that
      could be misused to track the client.

   -  Its <a href="#section-4">Section 4</a> discusses existing mechanisms that may have an
      impact on a client's privacy.

   -  Finally, its <a href="#section-5">Section 5</a> discusses potential attack vectors.

   For recommendations regarding how to address or mitigate those
   issues, see [<a href="./rfc7844" title='"Anonymity Profiles for DHCP Clients"'>RFC7844</a>].

   This specification does not define any allocation strategies for
   servers.  Implementers are expected to develop their own algorithm
   for the server to choose a resource out of the available pool.
   Several possible allocation strategies are mentioned in <a href="./rfc7824#section-4.3">Section 4.3
   of [RFC7824]</a>.  Please keep in mind that the list in [<a href="./rfc7824" title='"Privacy Considerations for DHCPv6"'>RFC7824</a>] is not
   exhaustive; there are certainly other possible strategies.  Readers
   are also encouraged to read [<a href="./rfc7707" title='"Network Reconnaissance in IPv6 Networks"'>RFC7707</a>] -- in particular, its
   <a href="#section-4.1.2">Section 4.1.2</a>, which discusses the problems with certain allocation
   strategies.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/24.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-24" id="section-24">24</a>.  IANA Considerations</span>

   This document does not define any new DHCP name spaces or
   definitions.

   The publication of this document does not change the assignment rules
   for new values for message types, option codes, DUID types, or status
   codes.

   The list of assigned values used in DHCPv6 is available at
   &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/dhcpv6-parameters</a>&gt;.

   IANA has updated &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/dhcpv6-parameters</a>&gt;
   to add a reference to this document for definitions previously
   created by [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>], [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], [<a href="./rfc4242" title='"Information Refresh Time Option for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC4242</a>], and [<a href="./rfc7083" title='"Modification to Default Values of SOL_MAX_RT and INF_MAX_RT"'>RFC7083</a>].

   IANA has added two columns to the DHCPv6 "Option Codes" registry at
   &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/dhcpv6-parameters</a>&gt; to indicate
   which options are allowed to appear in a client's Option Request
   option (see <a href="#section-21.7">Section 21.7</a>) and which options are singleton options





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 133]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-134"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   (only allowed to appear once as a top-level or encapsulated option;
   see <a href="./rfc7227#section-16">Section 16 of [RFC7227]</a>).  Table 4 provides the data for the
   options assigned by IANA at the time of writing this document.

   +---------+--------------------------+------------------+-----------+
   |  Option | Option Name ("OPTION"    | Client ORO (1)   | Singleton |
   |         | prefix removed)          |                  | Option    |
   +---------+--------------------------+------------------+-----------+
   |       1 | CLIENTID                 | No               | Yes       |
   |       2 | SERVERID                 | No               | Yes       |
   |       3 | IA_NA                    | No               | No        |
   |       4 | IA_TA                    | No               | No        |
   |       5 | IAADDR                   | No               | No        |
   |       6 | ORO                      | No               | Yes       |
   |       7 | PREFERENCE               | No               | Yes       |
   |       8 | ELAPSED_TIME             | No               | Yes       |
   |       9 | RELAY_MSG                | No               | Yes       |
   |      11 | AUTH                     | No               | Yes       |
   |      12 | UNICAST                  | No               | Yes       |
   |      13 | STATUS_CODE              | No               | Yes       |
   |      14 | RAPID_COMMIT             | No               | Yes       |
   |      15 | USER_CLASS               | No               | Yes       |
   |      16 | VENDOR_CLASS             | No               | No (2)    |
   |      17 | VENDOR_OPTS              | Optional         | No (2)    |
   |      18 | INTERFACE_ID             | No               | Yes       |
   |      19 | RECONF_MSG               | No               | Yes       |
   |      20 | RECONF_ACCEPT            | No               | Yes       |
   |      21 | SIP_SERVER_D             | Yes              | Yes       |
   |      22 | SIP_SERVER_A             | Yes              | Yes       |
   |      23 | DNS_SERVERS              | Yes              | Yes       |
   |      24 | DOMAIN_LIST              | Yes              | Yes       |
   |      25 | IA_PD                    | No               | No        |
   |      26 | IAPREFIX                 | No               | No        |
   |      27 | NIS_SERVERS              | Yes              | Yes       |
   |      28 | NISP_SERVERS             | Yes              | Yes       |
   |      29 | NIS_DOMAIN_NAME          | Yes              | Yes       |
   |      30 | NISP_DOMAIN_NAME         | Yes              | Yes       |
   |      31 | SNTP_SERVERS             | Yes              | Yes       |
   |      32 | INFORMATION_REFRESH_TIME | Required for     | Yes       |
   |         |                          | Information-     |           |
   |         |                          | request          |           |
   |      33 | BCMCS_SERVER_D           | Yes              | Yes       |
   |      34 | BCMCS_SERVER_A           | Yes              | Yes       |
   |      36 | GEOCONF_CIVIC            | Yes              | Yes       |
   |      37 | REMOTE_ID                | No               | Yes       |
   |      38 | SUBSCRIBER_ID            | No               | Yes       |
   |      39 | CLIENT_FQDN              | Yes              | Yes       |
   |      40 | PANA_AGENT               | Yes              | Yes       |



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 134]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-135"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   |      41 | NEW_POSIX_TIMEZONE       | Yes              | Yes       |
   |      42 | NEW_TZDB_TIMEZONE        | Yes              | Yes       |
   |      43 | ERO                      | No               | Yes       |
   |      44 | LQ_QUERY                 | No               | Yes       |
   |      45 | CLIENT_DATA              | No               | Yes       |
   |      46 | CLT_TIME                 | No               | Yes       |
   |      47 | LQ_RELAY_DATA            | No               | Yes       |
   |      48 | LQ_CLIENT_LINK           | No               | Yes       |
   |      49 | MIP6_HNIDF               | Yes              | Yes       |
   |      50 | MIP6_VDINF               | Yes              | Yes       |
   |      51 | V6_LOST                  | Yes              | Yes       |
   |      52 | CAPWAP_AC_V6             | Yes              | Yes       |
   |      53 | RELAY_ID                 | No               | Yes       |
   |      54 | IPv6_Address-MoS         | Yes              | Yes       |
   |      55 | IPv6_FQDN-MoS            | Yes              | Yes       |
   |      56 | NTP_SERVER               | Yes              | Yes       |
   |      57 | V6_ACCESS_DOMAIN         | Yes              | Yes       |
   |      58 | SIP_UA_CS_LIST           | Yes              | Yes       |
   |      59 | OPT_BOOTFILE_URL         | Yes              | Yes       |
   |      60 | OPT_BOOTFILE_PARAM       | Yes              | Yes       |
   |      61 | CLIENT_ARCH_TYPE         | No               | Yes       |
   |      62 | NII                      | Yes              | Yes       |
   |      63 | GEOLOCATION              | Yes              | Yes       |
   |      64 | AFTR_NAME                | Yes              | Yes       |
   |      65 | ERP_LOCAL_DOMAIN_NAME    | Yes              | Yes       |
   |      66 | RSOO                     | No               | Yes       |
   |      67 | PD_EXCLUDE               | Yes              | Yes       |
   |      68 | VSS                      | No               | Yes       |
   |      69 | MIP6_IDINF               | Yes              | Yes       |
   |      70 | MIP6_UDINF               | Yes              | Yes       |
   |      71 | MIP6_HNP                 | Yes              | Yes       |
   |      72 | MIP6_HAA                 | Yes              | Yes       |
   |      73 | MIP6_HAF                 | Yes              | Yes       |
   |      74 | RDNSS_SELECTION          | Yes              | No        |
   |      75 | KRB_PRINCIPAL_NAME       | Yes              | Yes       |
   |      76 | KRB_REALM_NAME           | Yes              | Yes       |
   |      77 | KRB_DEFAULT_REALM_NAME   | Yes              | Yes       |
   |      78 | KRB_KDC                  | Yes              | Yes       |
   |      79 | CLIENT_LINKLAYER_ADDR    | No               | Yes       |
   |      80 | LINK_ADDRESS             | No               | Yes       |
   |      81 | RADIUS                   | No               | Yes       |
   |      82 | SOL_MAX_RT               | Required for     | Yes       |
   |         |                          | Solicit          |           |
   |      83 | INF_MAX_RT               | Required for     | Yes       |
   |         |                          | Information-     |           |
   |         |                          | request          |           |
   |      84 | ADDRSEL                  | Yes              | Yes       |
   |      85 | ADDRSEL_TABLE            | Yes              | Yes       |



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 135]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-136"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   |      86 | V6_PCP_SERVER            | Yes              | No        |
   |      87 | DHCPV4_MSG               | No               | Yes       |
   |      88 | DHCP4_O_DHCP6_SERVER     | Yes              | Yes       |
   |      89 | S46_RULE                 | No               | No (3)    |
   |      90 | S46_BR                   | No               | No        |
   |      91 | S46_DMR                  | No               | Yes       |
   |      92 | S46_V4V6BIND             | No               | Yes       |
   |      93 | S46_PORTPARAMS           | No               | Yes       |
   |      94 | S46_CONT_MAPE            | Yes              | No        |
   |      95 | S46_CONT_MAPT            | Yes              | Yes       |
   |      96 | S46_CONT_LW              | Yes              | Yes       |
   |      97 | 4RD                      | Yes              | Yes       |
   |      98 | 4RD_MAP_RULE             | Yes              | Yes       |
   |      99 | 4RD_NON_MAP_RULE         | Yes              | Yes       |
   |     100 | LQ_BASE_TIME             | No               | Yes       |
   |     101 | LQ_START_TIME            | No               | Yes       |
   |     102 | LQ_END_TIME              | No               | Yes       |
   |     103 | DHCP Captive-Portal      | Yes              | Yes       |
   |     104 | MPL_PARAMETERS           | Yes              | No        |
   |     105 | ANI_ATT                  | No               | Yes       |
   |     106 | ANI_NETWORK_NAME         | No               | Yes       |
   |     107 | ANI_AP_NAME              | No               | Yes       |
   |     108 | ANI_AP_BSSID             | No               | Yes       |
   |     109 | ANI_OPERATOR_ID          | No               | Yes       |
   |     110 | ANI_OPERATOR_REALM       | No               | Yes       |
   |     111 | S46_PRIORITY             | Yes              | Yes       |
   |     112 | MUD_URL_V6               | No               | Yes       |
   |     113 | V6_PREFIX64              | Yes              | No        |
   |     114 | F_BINDING_STATUS         | No               | Yes       |
   |     115 | F_CONNECT_FLAGS          | No               | Yes       |
   |     116 | F_DNS_REMOVAL_INFO       | No               | Yes       |
   |     117 | F_DNS_HOST_NAME          | No               | Yes       |
   |     118 | F_DNS_ZONE_NAME          | No               | Yes       |
   |     119 | F_DNS_FLAGS              | No               | Yes       |
   |     120 | F_EXPIRATION_TIME        | No               | Yes       |
   |     121 | F_MAX_UNACKED_BNDUPD     | No               | Yes       |
   |     122 | F_MCLT                   | No               | Yes       |
   |     123 | F_PARTNER_LIFETIME       | No               | Yes       |
   |     124 | F_PARTNER_LIFETIME_SENT  | No               | Yes       |
   |     125 | F_PARTNER_DOWN_TIME      | No               | Yes       |
   |     126 | F_PARTNER_RAW_CLT_TIME   | No               | Yes       |
   |     127 | F_PROTOCOL_VERSION       | No               | Yes       |
   |     128 | F_KEEPALIVE_TIME         | No               | Yes       |
   |     129 | F_RECONFIGURE_DATA       | No               | Yes       |
   |     130 | F_RELATIONSHIP_NAME      | No               | Yes       |
   |     131 | F_SERVER_FLAGS           | No               | Yes       |
   |     132 | F_SERVER_STATE           | No               | Yes       |
   |     133 | F_START_TIME_OF_STATE    | No               | Yes       |



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 136]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-137"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   |     134 | F_STATE_EXPIRATION_TIME  | No               | Yes       |
   |     135 | RELAY_PORT               | No               | Yes       |
   |     143 | IPv6_Address-ANDSF       | Yes              | Yes       |
   +---------+--------------------------+------------------+-----------+

                         Table 4: Updated Options

   Notes for Table 4:

   (1)  In the "Client ORO" column, a "Yes" for an option means that the
        client includes this option code in the Option Request option
        (see <a href="#section-21.7">Section 21.7</a>) if it desires that configuration information,
        and a "No" means that the option MUST NOT be included (and
        servers SHOULD silently ignore that option code if it appears in
        a client's Option Request option).

   (2)  For each Enterprise Number, there MUST only be a single
        instance.

   (3)  See [<a href="./rfc7598" title='"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped Clients"'>RFC7598</a>] for details.

   IANA has corrected the range of possible status codes in the "Status
   Codes" table at &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/dhcpv6-parameters</a>&gt;
   by replacing 23-255 (as Unassigned) with 23-65535 (the codes are
   16-bit unsigned integers).

   IANA has updated the All_DHCP_Relay_Agents_and_Servers (ff02::1:2)
   and All_DHCP_Servers (ff05::1:3) table entries in the "IPv6 Multicast
   Address Space Registry" at &lt;<a href="https://www.iana.org/assignments/ipv6-multicast-addresses">https://www.iana.org/assignments/</a>
   <a href="https://www.iana.org/assignments/ipv6-multicast-addresses">ipv6-multicast-addresses</a>&gt; to reference this document instead of
   [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>].

   IANA has added an "Obsolete" annotation in the "DHCPv6 Delayed
   Authentication" entry in the "Authentication Suboption (value 8) -
   Protocol identifier values" registry at
   &lt;<a href="https://www.iana.org/assignments/bootp-dhcp-parameters">https://www.iana.org/assignments/bootp-dhcp-parameters</a>&gt; and has
   added an "Obsolete" annotation in the "Delayed Authentication" entry
   in the "Protocol Name Space Values" registry at
   &lt;<a href="https://www.iana.org/assignments/auth-namespaces">https://www.iana.org/assignments/auth-namespaces</a>&gt;.  IANA has also
   updated these pages to reference this document instead of [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>].

   IANA has added a reference to this document for the RDM value of 0 to
   the "RDM Name Space Values" registry at
   &lt;<a href="https://www.iana.org/assignments/auth-namespaces">https://www.iana.org/assignments/auth-namespaces</a>&gt;.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 137]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-138"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   IANA has updated the "Service Name and Transport Protocol Port Number
   Registry" at &lt;<a href="https://www.iana.org/assignments/service-names-port-numbers">https://www.iana.org/assignments/</a>
   <a href="https://www.iana.org/assignments/service-names-port-numbers">service-names-port-numbers</a>&gt; as follows:

            546/udp      This document
            547/udp      This document
            547/tcp      [<a href="./rfc5460" title='"DHCPv6 Bulk Leasequery"'>RFC5460</a>]
            647/tcp      [<a href="./rfc8156" title='"DHCPv6 Failover Protocol"'>RFC8156</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/25.%20%20Obsoleted%20Mechanisms"></a><a class="selflink" href="#section-25" id="section-25">25</a>.  Obsoleted Mechanisms</span>

   This specification is mostly a corrected and cleaned-up version of
   the original specification -- [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] -- along with numerous
   additions from later RFCs.  However, there are a small number of
   mechanisms that were not widely deployed, were underspecified, or had
   other operational issues.  Those mechanisms are now considered
   deprecated.  Legacy implementations MAY support them, but
   implementations conformant to this document MUST NOT rely on them.

   The following mechanisms are now obsolete:

   Delayed authentication.  This mechanism was underspecified and
      presented a significant operational burden.  As a result, after
      10 years its adoption was extremely limited at best.

   Lifetime hints sent by a client.  Clients used to be allowed to send
      lifetime values as hints.  This mechanism was not widely
      implemented, and there were known misimplementations that sent the
      remaining lifetimes rather than total desired lifetimes.  That in
      turn was sometimes misunderstood by servers as a request for
      ever-decreasing lease lifetimes, which caused issues when values
      started approaching zero.  Clients now SHOULD set lifetimes to 0
      in IA Address and IA Prefix options, and servers MUST ignore any
      requested lifetime value.

   T1/T2 hints sent by a client.  These had issues similar to those for
      the lifetime hints.  Clients now SHOULD set the T1/T2 values to 0
      in IA_NA and IA_PD options, and servers MUST ignore any T1/T2
      values supplied by a client.












<span class="grey">Mrugalski, et al.            Standards Track                  [Page 138]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-139"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/26.%20%20References"></a><a class="selflink" href="#section-26" id="section-26">26</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/26.1.%20%20Normative%20References"></a><a class="selflink" href="#section-26.1" id="section-26.1">26.1</a>.  Normative References</span>

   [<a id="ref-RFC768">RFC768</a>]   Postel, J., "User Datagram Protocol", STD 6, <a href="./rfc768">RFC 768</a>,
              DOI 10.17487/RFC0768, August 1980,
              &lt;<a href="https://www.rfc-editor.org/info/rfc768">https://www.rfc-editor.org/info/rfc768</a>&gt;.

   [<a id="ref-RFC1035">RFC1035</a>]  Mockapetris, P., "Domain names - implementation and
              specification", STD 13, <a href="./rfc1035">RFC 1035</a>, DOI 10.17487/RFC1035,
              November 1987, &lt;<a href="https://www.rfc-editor.org/info/rfc1035">https://www.rfc-editor.org/info/rfc1035</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC4291">RFC4291</a>]  Hinden, R. and S. Deering, "IP Version 6 Addressing
              Architecture", <a href="./rfc4291">RFC 4291</a>, DOI 10.17487/RFC4291,
              February 2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4291">https://www.rfc-editor.org/info/rfc4291</a>&gt;.

   [<a id="ref-RFC4861">RFC4861</a>]  Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
              "Neighbor Discovery for IP version 6 (IPv6)", <a href="./rfc4861">RFC 4861</a>,
              DOI 10.17487/RFC4861, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4861">https://www.rfc-editor.org/info/rfc4861</a>&gt;.

   [<a id="ref-RFC4862">RFC4862</a>]  Thomson, S., Narten, T., and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", <a href="./rfc4862">RFC 4862</a>,
              DOI 10.17487/RFC4862, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4862">https://www.rfc-editor.org/info/rfc4862</a>&gt;.

   [<a id="ref-RFC6221">RFC6221</a>]  Miles, D., Ed., Ooghe, S., Dec, W., Krishnan, S., and A.
              Kavanagh, "Lightweight DHCPv6 Relay Agent", <a href="./rfc6221">RFC 6221</a>,
              DOI 10.17487/RFC6221, May 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6221">https://www.rfc-editor.org/info/rfc6221</a>&gt;.

   [<a id="ref-RFC6355">RFC6355</a>]  Narten, T. and J. Johnson, "Definition of the UUID-Based
              DHCPv6 Unique Identifier (DUID-UUID)", <a href="./rfc6355">RFC 6355</a>,
              DOI 10.17487/RFC6355, August 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6355">https://www.rfc-editor.org/info/rfc6355</a>&gt;.

   [<a id="ref-RFC7227">RFC7227</a>]  Hankins, D., Mrugalski, T., Siodelski, M., Jiang, S., and
              S. Krishnan, "Guidelines for Creating New DHCPv6 Options",
              <a href="https://www.rfc-editor.org/bcp/bcp187">BCP 187</a>, <a href="./rfc7227">RFC 7227</a>, DOI 10.17487/RFC7227, May 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7227">https://www.rfc-editor.org/info/rfc7227</a>&gt;.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 139]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-140"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC7283">RFC7283</a>]  Cui, Y., Sun, Q., and T. Lemon, "Handling Unknown DHCPv6
              Messages", <a href="./rfc7283">RFC 7283</a>, DOI 10.17487/RFC7283, July 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7283">https://www.rfc-editor.org/info/rfc7283</a>&gt;.

   [<a id="ref-RFC8085">RFC8085</a>]  Eggert, L., Fairhurst, G., and G. Shepherd, "UDP Usage
              Guidelines", <a href="https://www.rfc-editor.org/bcp/bcp145">BCP 145</a>, <a href="./rfc8085">RFC 8085</a>, DOI 10.17487/RFC8085,
              March 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in
              <a href="./rfc2119">RFC 2119</a> Key Words", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc8174">RFC 8174</a>,
              DOI 10.17487/RFC8174, May 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8200">RFC8200</a>]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", STD 86, <a href="./rfc8200">RFC 8200</a>,
              DOI 10.17487/RFC8200, July 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;.

   [<a id="ref-RFC8213">RFC8213</a>]  Volz, B. and Y. Pal, "Security of Messages Exchanged
              between Servers and Relay Agents", <a href="./rfc8213">RFC 8213</a>,
              DOI 10.17487/RFC8213, August 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8213">https://www.rfc-editor.org/info/rfc8213</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/26.2.%20%20Informative%20References"></a><a class="selflink" href="#section-26.2" id="section-26.2">26.2</a>.  Informative References</span>

   [<a id="ref-IANA-HARDWARE-TYPES">IANA-HARDWARE-TYPES</a>]
              IANA, "Hardware Types",
              &lt;<a href="https://www.iana.org/assignments/arp-parameters">https://www.iana.org/assignments/arp-parameters</a>&gt;.

   [<a id="ref-IANA-PEN">IANA-PEN</a>] IANA, "Private Enterprise Numbers",
              &lt;<a href="https://www.iana.org/assignments/enterprise-numbers">https://www.iana.org/assignments/enterprise-numbers</a>&gt;.

   [<a id="ref-IANA-RESERVED-IID">IANA-RESERVED-IID</a>]
              IANA, "Reserved IPv6 Interface Identifiers",
              &lt;<a href="https://www.iana.org/assignments/ipv6-interface-ids">https://www.iana.org/assignments/ipv6-interface-ids</a>&gt;.

   [<a id="ref-IEEE-802.1x">IEEE-802.1x</a>]
              IEEE, "IEEE Standard for Local and metropolitan area
              networks--Port-Based Network Access Control",
              IEEE 802.1X-2010, DOI 10.1109/IEEESTD.2010.5409813,
              &lt;<a href="https://ieeexplore.ieee.org/servlet/opac?punumber=5409757">https://ieeexplore.ieee.org/servlet/</a>
              <a href="https://ieeexplore.ieee.org/servlet/opac?punumber=5409757">opac?punumber=5409757</a>&gt;.

   [<a id="ref-RFC826">RFC826</a>]   Plummer, D., "An Ethernet Address Resolution Protocol: Or
              Converting Network Protocol Addresses to 48.bit Ethernet
              Address for Transmission on Ethernet Hardware", STD 37,
              <a href="./rfc826">RFC 826</a>, DOI 10.17487/RFC0826, November 1982,
              &lt;<a href="https://www.rfc-editor.org/info/rfc826">https://www.rfc-editor.org/info/rfc826</a>&gt;.



<span class="grey">Mrugalski, et al.            Standards Track                  [Page 140]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-141"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC2131">RFC2131</a>]  Droms, R., "Dynamic Host Configuration Protocol",
              <a href="./rfc2131">RFC 2131</a>, DOI 10.17487/RFC2131, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2131">https://www.rfc-editor.org/info/rfc2131</a>&gt;.

   [<a id="ref-RFC2132">RFC2132</a>]  Alexander, S. and R. Droms, "DHCP Options and BOOTP Vendor
              Extensions", <a href="./rfc2132">RFC 2132</a>, DOI 10.17487/RFC2132, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2132">https://www.rfc-editor.org/info/rfc2132</a>&gt;.

   [<a id="ref-RFC2464">RFC2464</a>]  Crawford, M., "Transmission of IPv6 Packets over Ethernet
              Networks", <a href="./rfc2464">RFC 2464</a>, DOI 10.17487/RFC2464, December 1998,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2464">https://www.rfc-editor.org/info/rfc2464</a>&gt;.

   [<a id="ref-RFC3162">RFC3162</a>]  Aboba, B., Zorn, G., and D. Mitton, "RADIUS and IPv6",
              <a href="./rfc3162">RFC 3162</a>, DOI 10.17487/RFC3162, August 2001,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3162">https://www.rfc-editor.org/info/rfc3162</a>&gt;.

   [<a id="ref-RFC3290">RFC3290</a>]  Bernet, Y., Blake, S., Grossman, D., and A. Smith, "An
              Informal Management Model for Diffserv Routers", <a href="./rfc3290">RFC 3290</a>,
              DOI 10.17487/RFC3290, May 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3290">https://www.rfc-editor.org/info/rfc3290</a>&gt;.

   [<a id="ref-RFC3315">RFC3315</a>]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", <a href="./rfc3315">RFC 3315</a>, DOI 10.17487/RFC3315,
              July 2003, &lt;<a href="https://www.rfc-editor.org/info/rfc3315">https://www.rfc-editor.org/info/rfc3315</a>&gt;.

   [<a id="ref-RFC3629">RFC3629</a>]  Yergeau, F., "UTF-8, a transformation format of
              ISO 10646", STD 63, <a href="./rfc3629">RFC 3629</a>, DOI 10.17487/RFC3629,
              November 2003, &lt;<a href="https://www.rfc-editor.org/info/rfc3629">https://www.rfc-editor.org/info/rfc3629</a>&gt;.

   [<a id="ref-RFC3633">RFC3633</a>]  Troan, O. and R. Droms, "IPv6 Prefix Options for Dynamic
              Host Configuration Protocol (DHCP) version 6", <a href="./rfc3633">RFC 3633</a>,
              DOI 10.17487/RFC3633, December 2003,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3633">https://www.rfc-editor.org/info/rfc3633</a>&gt;.

   [<a id="ref-RFC3646">RFC3646</a>]  Droms, R., Ed., "DNS Configuration options for Dynamic
              Host Configuration Protocol for IPv6 (DHCPv6)", <a href="./rfc3646">RFC 3646</a>,
              DOI 10.17487/RFC3646, December 2003,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3646">https://www.rfc-editor.org/info/rfc3646</a>&gt;.

   [<a id="ref-RFC3736">RFC3736</a>]  Droms, R., "Stateless Dynamic Host Configuration Protocol
              (DHCP) Service for IPv6", <a href="./rfc3736">RFC 3736</a>, DOI 10.17487/RFC3736,
              April 2004, &lt;<a href="https://www.rfc-editor.org/info/rfc3736">https://www.rfc-editor.org/info/rfc3736</a>&gt;.

   [<a id="ref-RFC3769">RFC3769</a>]  Miyakawa, S. and R. Droms, "Requirements for IPv6 Prefix
              Delegation", <a href="./rfc3769">RFC 3769</a>, DOI 10.17487/RFC3769, June 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3769">https://www.rfc-editor.org/info/rfc3769</a>&gt;.




<span class="grey">Mrugalski, et al.            Standards Track                  [Page 141]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-142"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC4193">RFC4193</a>]  Hinden, R. and B. Haberman, "Unique Local IPv6 Unicast
              Addresses", <a href="./rfc4193">RFC 4193</a>, DOI 10.17487/RFC4193, October 2005,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4193">https://www.rfc-editor.org/info/rfc4193</a>&gt;.

   [<a id="ref-RFC4242">RFC4242</a>]  Venaas, S., Chown, T., and B. Volz, "Information Refresh
              Time Option for Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6)", <a href="./rfc4242">RFC 4242</a>, DOI 10.17487/RFC4242,
              November 2005, &lt;<a href="https://www.rfc-editor.org/info/rfc4242">https://www.rfc-editor.org/info/rfc4242</a>&gt;.

   [<a id="ref-RFC4477">RFC4477</a>]  Chown, T., Venaas, S., and C. Strauf, "Dynamic Host
              Configuration Protocol (DHCP): IPv4 and IPv6 Dual-Stack
              Issues", <a href="./rfc4477">RFC 4477</a>, DOI 10.17487/RFC4477, May 2006,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4477">https://www.rfc-editor.org/info/rfc4477</a>&gt;.

   [<a id="ref-RFC4704">RFC4704</a>]  Volz, B., "The Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6) Client Fully Qualified Domain Name (FQDN)
              Option", <a href="./rfc4704">RFC 4704</a>, DOI 10.17487/RFC4704, October 2006,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4704">https://www.rfc-editor.org/info/rfc4704</a>&gt;.

   [<a id="ref-RFC4941">RFC4941</a>]  Narten, T., Draves, R., and S. Krishnan, "Privacy
              Extensions for Stateless Address Autoconfiguration in
              IPv6", <a href="./rfc4941">RFC 4941</a>, DOI 10.17487/RFC4941, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4941">https://www.rfc-editor.org/info/rfc4941</a>&gt;.

   [<a id="ref-RFC4943">RFC4943</a>]  Roy, S., Durand, A., and J. Paugh, "IPv6 Neighbor
              Discovery On-Link Assumption Considered Harmful",
              <a href="./rfc4943">RFC 4943</a>, DOI 10.17487/RFC4943, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4943">https://www.rfc-editor.org/info/rfc4943</a>&gt;.

   [<a id="ref-RFC4994">RFC4994</a>]  Zeng, S., Volz, B., Kinnear, K., and J. Brzozowski,
              "DHCPv6 Relay Agent Echo Request Option", <a href="./rfc4994">RFC 4994</a>,
              DOI 10.17487/RFC4994, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4994">https://www.rfc-editor.org/info/rfc4994</a>&gt;.

   [<a id="ref-RFC5007">RFC5007</a>]  Brzozowski, J., Kinnear, K., Volz, B., and S. Zeng,
              "DHCPv6 Leasequery", <a href="./rfc5007">RFC 5007</a>, DOI 10.17487/RFC5007,
              September 2007, &lt;<a href="https://www.rfc-editor.org/info/rfc5007">https://www.rfc-editor.org/info/rfc5007</a>&gt;.

   [<a id="ref-RFC5453">RFC5453</a>]  Krishnan, S., "Reserved IPv6 Interface Identifiers",
              <a href="./rfc5453">RFC 5453</a>, DOI 10.17487/RFC5453, February 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5453">https://www.rfc-editor.org/info/rfc5453</a>&gt;.

   [<a id="ref-RFC5460">RFC5460</a>]  Stapp, M., "DHCPv6 Bulk Leasequery", <a href="./rfc5460">RFC 5460</a>,
              DOI 10.17487/RFC5460, February 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5460">https://www.rfc-editor.org/info/rfc5460</a>&gt;.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 142]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-143"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC5905">RFC5905</a>]  Mills, D., Martin, J., Ed., Burbank, J., and W. Kasch,
              "Network Time Protocol Version 4: Protocol and Algorithms
              Specification", <a href="./rfc5905">RFC 5905</a>, DOI 10.17487/RFC5905, June 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5905">https://www.rfc-editor.org/info/rfc5905</a>&gt;.

   [<a id="ref-RFC5908">RFC5908</a>]  Gayraud, R. and B. Lourdelet, "Network Time Protocol (NTP)
              Server Option for DHCPv6", <a href="./rfc5908">RFC 5908</a>, DOI 10.17487/RFC5908,
              June 2010, &lt;<a href="https://www.rfc-editor.org/info/rfc5908">https://www.rfc-editor.org/info/rfc5908</a>&gt;.

   [<a id="ref-RFC6422">RFC6422</a>]  Lemon, T. and Q. Wu, "Relay-Supplied DHCP Options",
              <a href="./rfc6422">RFC 6422</a>, DOI 10.17487/RFC6422, December 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6422">https://www.rfc-editor.org/info/rfc6422</a>&gt;.

   [<a id="ref-RFC6603">RFC6603</a>]  Korhonen, J., Ed., Savolainen, T., Krishnan, S., and O.
              Troan, "Prefix Exclude Option for DHCPv6-based Prefix
              Delegation", <a href="./rfc6603">RFC 6603</a>, DOI 10.17487/RFC6603, May 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6603">https://www.rfc-editor.org/info/rfc6603</a>&gt;.

   [<a id="ref-RFC6724">RFC6724</a>]  Thaler, D., Ed., Draves, R., Matsumoto, A., and T. Chown,
              "Default Address Selection for Internet Protocol Version 6
              (IPv6)", <a href="./rfc6724">RFC 6724</a>, DOI 10.17487/RFC6724, September 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6724">https://www.rfc-editor.org/info/rfc6724</a>&gt;.

   [<a id="ref-RFC6879">RFC6879</a>]  Jiang, S., Liu, B., and B. Carpenter, "IPv6 Enterprise
              Network Renumbering Scenarios, Considerations, and
              Methods", <a href="./rfc6879">RFC 6879</a>, DOI 10.17487/RFC6879, February 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6879">https://www.rfc-editor.org/info/rfc6879</a>&gt;.

   [<a id="ref-RFC6939">RFC6939</a>]  Halwasia, G., Bhandari, S., and W. Dec, "Client Link-Layer
              Address Option in DHCPv6", <a href="./rfc6939">RFC 6939</a>, DOI 10.17487/RFC6939,
              May 2013, &lt;<a href="https://www.rfc-editor.org/info/rfc6939">https://www.rfc-editor.org/info/rfc6939</a>&gt;.

   [<a id="ref-RFC7083">RFC7083</a>]  Droms, R., "Modification to Default Values of SOL_MAX_RT
              and INF_MAX_RT", <a href="./rfc7083">RFC 7083</a>, DOI 10.17487/RFC7083,
              November 2013, &lt;<a href="https://www.rfc-editor.org/info/rfc7083">https://www.rfc-editor.org/info/rfc7083</a>&gt;.

   [<a id="ref-RFC7084">RFC7084</a>]  Singh, H., Beebee, W., Donley, C., and B. Stark, "Basic
              Requirements for IPv6 Customer Edge Routers", <a href="./rfc7084">RFC 7084</a>,
              DOI 10.17487/RFC7084, November 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7084">https://www.rfc-editor.org/info/rfc7084</a>&gt;.

   [<a id="ref-RFC7136">RFC7136</a>]  Carpenter, B. and S. Jiang, "Significance of IPv6
              Interface Identifiers", <a href="./rfc7136">RFC 7136</a>, DOI 10.17487/RFC7136,
              February 2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7136">https://www.rfc-editor.org/info/rfc7136</a>&gt;.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 143]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-144"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC7341">RFC7341</a>]  Sun, Q., Cui, Y., Siodelski, M., Krishnan, S., and I.
              Farrer, "DHCPv4-over-DHCPv6 (DHCP 4o6) Transport",
              <a href="./rfc7341">RFC 7341</a>, DOI 10.17487/RFC7341, August 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7341">https://www.rfc-editor.org/info/rfc7341</a>&gt;.

   [<a id="ref-RFC7368">RFC7368</a>]  Chown, T., Ed., Arkko, J., Brandt, A., Troan, O., and J.
              Weil, "IPv6 Home Networking Architecture Principles",
              <a href="./rfc7368">RFC 7368</a>, DOI 10.17487/RFC7368, October 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7368">https://www.rfc-editor.org/info/rfc7368</a>&gt;.

   [<a id="ref-RFC7513">RFC7513</a>]  Bi, J., Wu, J., Yao, G., and F. Baker, "Source Address
              Validation Improvement (SAVI) Solution for DHCP",
              <a href="./rfc7513">RFC 7513</a>, DOI 10.17487/RFC7513, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7513">https://www.rfc-editor.org/info/rfc7513</a>&gt;.

   [<a id="ref-RFC7550">RFC7550</a>]  Troan, O., Volz, B., and M. Siodelski, "Issues and
              Recommendations with Multiple Stateful DHCPv6 Options",
              <a href="./rfc7550">RFC 7550</a>, DOI 10.17487/RFC7550, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7550">https://www.rfc-editor.org/info/rfc7550</a>&gt;.

   [<a id="ref-RFC7598">RFC7598</a>]  Mrugalski, T., Troan, O., Farrer, I., Perreault, S., Dec,
              W., Bao, C., Yeh, L., and X. Deng, "DHCPv6 Options for
              Configuration of Softwire Address and Port-Mapped
              Clients", <a href="./rfc7598">RFC 7598</a>, DOI 10.17487/RFC7598, July 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7598">https://www.rfc-editor.org/info/rfc7598</a>&gt;.

   [<a id="ref-RFC7610">RFC7610</a>]  Gont, F., Liu, W., and G. Van de Velde, "DHCPv6-Shield:
              Protecting against Rogue DHCPv6 Servers", <a href="https://www.rfc-editor.org/bcp/bcp199">BCP 199</a>,
              <a href="./rfc7610">RFC 7610</a>, DOI 10.17487/RFC7610, August 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7610">https://www.rfc-editor.org/info/rfc7610</a>&gt;.

   [<a id="ref-RFC7707">RFC7707</a>]  Gont, F. and T. Chown, "Network Reconnaissance in IPv6
              Networks", <a href="./rfc7707">RFC 7707</a>, DOI 10.17487/RFC7707, March 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7707">https://www.rfc-editor.org/info/rfc7707</a>&gt;.

   [<a id="ref-RFC7721">RFC7721</a>]  Cooper, A., Gont, F., and D. Thaler, "Security and Privacy
              Considerations for IPv6 Address Generation Mechanisms",
              <a href="./rfc7721">RFC 7721</a>, DOI 10.17487/RFC7721, March 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7721">https://www.rfc-editor.org/info/rfc7721</a>&gt;.

   [<a id="ref-RFC7824">RFC7824</a>]  Krishnan, S., Mrugalski, T., and S. Jiang, "Privacy
              Considerations for DHCPv6", <a href="./rfc7824">RFC 7824</a>,
              DOI 10.17487/RFC7824, May 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7824">https://www.rfc-editor.org/info/rfc7824</a>&gt;.







<span class="grey">Mrugalski, et al.            Standards Track                  [Page 144]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-145"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   [<a id="ref-RFC7844">RFC7844</a>]  Huitema, C., Mrugalski, T., and S. Krishnan, "Anonymity
              Profiles for DHCP Clients", <a href="./rfc7844">RFC 7844</a>,
              DOI 10.17487/RFC7844, May 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7844">https://www.rfc-editor.org/info/rfc7844</a>&gt;.

   [<a id="ref-RFC7969">RFC7969</a>]  Lemon, T. and T. Mrugalski, "Customizing DHCP
              Configuration on the Basis of Network Topology", <a href="./rfc7969">RFC 7969</a>,
              DOI 10.17487/RFC7969, October 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7969">https://www.rfc-editor.org/info/rfc7969</a>&gt;.

   [<a id="ref-RFC8156">RFC8156</a>]  Mrugalski, T. and K. Kinnear, "DHCPv6 Failover Protocol",
              <a href="./rfc8156">RFC 8156</a>, DOI 10.17487/RFC8156, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8156">https://www.rfc-editor.org/info/rfc8156</a>&gt;.

   [<a id="ref-RFC8168">RFC8168</a>]  Li, T., Liu, C., and Y. Cui, "DHCPv6 Prefix-Length Hint
              Issues", <a href="./rfc8168">RFC 8168</a>, DOI 10.17487/RFC8168, May 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8168">https://www.rfc-editor.org/info/rfc8168</a>&gt;.

   [<a id="ref-TR-187">TR-187</a>]   Broadband Forum, "TR-187 - IPv6 for PPP Broadband Access",
              February 2013, &lt;<a href="https://www.broadband-forum.org/technical/download/TR-187_Issue-2.pdf">https://www.broadband-forum.org/</a>
              <a href="https://www.broadband-forum.org/technical/download/TR-187_Issue-2.pdf">technical/download/TR-187_Issue-2.pdf</a>&gt;.






























<span class="grey">Mrugalski, et al.            Standards Track                  [Page 145]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-146"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Summary%20of%20Changes"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Summary of Changes</span>

   This appendix provides a summary of the significant changes made to
   this updated DHCPv6 specification.

   1.   The Introduction (<a href="#section-1">Section 1</a>) was reorganized and updated.  In
        particular, the client/server message exchanges were moved into
        a new (and expanded) section on their own (see <a href="#section-5">Section 5</a>).

   2.   New sections were added to discuss the relationship to previous
        DHCPv6 documents and also to DHCPv4.

   3.   Sections <a href="#section-2">2</a> ("Requirements") and 3 ("Background") had very minor
        edits.

   4.   <a href="#section-4">Section 4</a> ("Terminology") had minor edits.

   5.   <a href="#section-4.2">Section 4.2</a> ("DHCP Terminology") was expanded to incorporate
        definitions from <a href="./rfc3633">RFC 3633</a>, add T1/T2 definitions, add
        definitions useful in describing combined address assignment and
        prefix delegation operations, and improve some existing
        definitions.

   6.   <a href="#section-5">Section 5</a> ("Client/Server Exchanges") was added from material
        previously in <a href="./rfc3315#section-1">Section 1 of RFC 3315</a> ("Introduction and
        Overview") and was expanded.

   7.   <a href="#section-6">Section 6</a> ("Operational Models") is new.  It provides
        information on the kinds of DHCP clients and how they operate.

   8.   <a href="#section-7">Section 7</a> ("DHCP Constants") was primarily updated to add
        constants from <a href="./rfc4242">RFC 4242</a> and <a href="./rfc7083">RFC 7083</a>.  Note that the default
        HOP_COUNT_LIMIT value was reduced from 32 to 8.

   9.   Sections <a href="#section-8">8</a> ("Client/Server Message Formats"), 9 ("Relay Agent/
        Server Message Formats"), and 10 ("Representation and Use of
        Domain Names") had only very minor changes.

   10.  <a href="#section-11">Section 11</a> ("DHCP Unique Identifier (DUID)") now discourages,
        rather than disallows, a server to parse the DUID; now includes
        some information on the DUID-UUID (<a href="./rfc6355">RFC 6355</a>); and had other
        minor edits.

   11.  <a href="#section-12">Section 12</a> ("Identity Association") was expanded to better
        explain the concept and to also include prefix delegation.






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 146]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-147"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   12.  <a href="#section-13">Section 13</a> ("Assignment to an IA") incorporates material from
        two sections (11 and 12) of <a href="./rfc3315">RFC 3315</a> and also includes a section
        on prefix delegation.

   13.  <a href="#section-14">Section 14</a> ("Transmission of Messages by a Client") was expanded
        to include rate limiting by clients and how clients should
        handle T1 or T2 values of 0.

   14.  <a href="#section-15">Section 15</a> ("Reliability of Client-Initiated Message Exchanges")
        was expanded to clarify that the Elapsed Time option must be
        updated in retransmitted messages and that a client is not
        required to listen for DHCP traffic for the entire
        retransmission period.

   15.  <a href="#section-16">Section 16</a> ("Message Validation") had minor edits.

   16.  <a href="#section-17">Section 17</a> ("Client Source Address and Interface Selection") was
        expanded to include prefix delegation.

   17.  <a href="#section-18">Section 18</a> ("DHCP Configuration Exchanges") consolidates what
        used to be in the following sections in <a href="./rfc3315">RFC 3315</a>: "DHCP Server
        Solicitation" (<a href="#section-17">Section 17</a>), "DHCP Client-Initiated Configuration
        Exchange" (<a href="#section-18">Section 18</a>), and "DHCP Server-Initiated Configuration
        Exchange" (<a href="#section-19">Section 19</a>).  This material was reorganized and
        enhanced, and it incorporates prefix delegation from <a href="./rfc3633">RFC 3633</a>
        and other changes from <a href="./rfc4242">RFC 4242</a>, <a href="./rfc7083">RFC 7083</a>, and <a href="./rfc7550">RFC 7550</a>.  A few
        changes of note:

        A.  The Option Request option is no longer optional for some
            messages (Solicit and Information-request), as <a href="./rfc7083">RFC 7083</a>
            requires clients to request SOL_MAX_RT or INF_MAX_RT
            options.

        B.  The Reconfigure message should no longer contain
            IA_NA/IA_PD, ORO, or other options to indicate to the client
            what was reconfigured.  The client should request everything
            it needs in the response to the Reconfigure.

        C.  The lifetime and T1/T2 hints should not be sent by a client
            (it should send values of 0 in these fields), and any
            non-zero values should be ignored by the server.

        D.  Clarified that a server may return different addresses in
            the Reply than requested by a client in the Request message.
            Also clarified that a server must not include addresses that
            it will not assign.





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 147]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-148"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


        Also, <a href="#section-18.2.12">Section 18.2.12</a> ("Refreshing Configuration Information")
        was added to indicate use cases for when a client should try to
        refresh network information.

   18.  <a href="#section-19">Section 19</a> ("Relay Agent Behavior") incorporates <a href="./rfc7283">RFC 7283</a> and
        had minor edits.  A new section, "Interaction between Relay
        Agents and Servers" (<a href="#section-19.4">Section 19.4</a>), was added.

   19.  <a href="#section-20">Section 20</a> ("Authentication of DHCP Messages") includes
        significant changes: IPsec materials were mostly removed and
        replaced with a reference to <a href="./rfc8213">RFC 8213</a>, and the delayed
        authentication protocol has been obsoleted (see <a href="#section-25">Section 25</a>).
        Note that RKAP is still considered current.

   20.  <a href="#section-21">Section 21</a> ("DHCP Options") was expanded to incorporate
        OPTION_IA_PD and OPTION_IAPREFIX from <a href="./rfc3633">RFC 3633</a>, the Information
        Refresh Time option (OPTION_INFORMATION_REFRESH_TIME) from
        <a href="./rfc4242">RFC 4242</a>, and the SOL_MAX_RT and INF_MAX_RT options from
        <a href="./rfc7083">RFC 7083</a>.  Some additional edits were made to clarify option
        handling, such as which options should not be in an Option
        Request option.

   21.  The security considerations (<a href="#section-22">Section 22</a>) were updated to expand
        the discussion of security threats and include material from the
        incorporated documents, primarily <a href="./rfc3633">RFC 3633</a>.

   22.  New privacy considerations were added (<a href="#section-23">Section 23</a>) to account
        for privacy issues.

   23.  <a href="#section-24">Section 24</a> ("IANA Considerations") was rewritten to reflect the
        changes requested for this document, as other documents have
        already made the message, option, DUID, and status code
        assignments and this document does not add any new assignments.

   24.  <a href="#section-25">Section 25</a> ("Obsoleted Mechanisms") is a new section that
        documents the mechanisms obsoleted by this specification.

   25.  Appendices B ("Appearance of Options in Message Types") and C
        ("Appearance of Options in the "options" Field of DHCP Options")
        were updated to reflect the incorporated options from <a href="./rfc3633">RFC 3633</a>,
        <a href="./rfc4242">RFC 4242</a>, and <a href="./rfc7083">RFC 7083</a>.

   26.  Where appropriate, informative references have been added to
        provide further background and guidance throughout the document
        (as can be noted by the vast increase in references).






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 148]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-149"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   27.  Changes were made to incorporate the following errata for
        <a href="./rfc3315">RFC 3315</a>: Erratum IDs 294, 295, 1373, 1815, 2471, 2472, 2509,
        2928, 3577, 5450; <a href="./rfc3633">RFC 3633</a>: Erratum IDs 248, 2468, 2469, 2470,
        3736; and <a href="./rfc3736">RFC 3736</a>: Erratum ID 3796.  Note that Erratum ID 1880
        for <a href="./rfc3633">RFC 3633</a> no longer applies, as servers (delegating routers)
        ignore received T1/T2 hints (see (C) in item 17 above).

   28.  General changes to other IPv6 specifications, such as removing
        the use of site-local unicast addresses and adding unique local
        addresses, were made to the document.

   29.  It should be noted that this document does not refer to all
        DHCPv6 functionality and specifications.  Readers of this
        specification should visit &lt;<a href="https://www.iana.org/assignments/dhcpv6-parameters">https://www.iana.org/assignments/</a>
        <a href="https://www.iana.org/assignments/dhcpv6-parameters">dhcpv6-parameters</a>&gt; and &lt;<a href="https://datatracker.ietf.org/wg/dhc/">https://datatracker.ietf.org/wg/dhc/</a>&gt; to
        learn of the RFCs that define DHCPv6 messages, options,
        status codes, and more.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20%20Appearance%20of%20Options%20in%20Message%20Types"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  Appearance of Options in Message Types</span>

   The following tables indicate with a "*" the options that are allowed
   in each DHCP message type.

   These tables are informational.  If they conflict with text earlier
   in this document, that text should be considered authoritative.

         Client Server IA_NA/                  Elap. Relay       Server
           ID     ID   IA_TA IA_PD  ORO   Pref Time   Msg. Auth. Unicast
 Solicit   *             *     *     *           *
 Advert.   *      *      *     *           *
 Request   *      *      *     *     *           *
 Confirm   *             *                       *
 Renew     *      *      *     *     *           *
 Rebind    *             *     *     *           *
 Decline   *      *      *     *                 *
 Release   *      *      *     *                 *
 Reply     *      *      *     *                             *     *
 Reconf.   *      *                                          *
 Inform.   * (see note)              *           *
 R-forw.                                               *
 R-repl.                                               *

   NOTE: The Server Identifier option (see <a href="#section-21.3">Section 21.3</a>) is only
   included in Information-request messages that are sent in response to
   a Reconfigure (see <a href="#section-18.2.6">Section 18.2.6</a>).






<span class="grey">Mrugalski, et al.            Standards Track                  [Page 149]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-150"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


                                                                  Info
           Status  Rap. User  Vendor Vendor Inter. Recon. Recon. Refresh
            Code  Comm. Class Class  Spec.    ID    Msg.  Accept  Time
   Solicit          *     *     *      *                    *
   Advert.   *            *     *      *                    *
   Request                *     *      *                    *
   Confirm                *     *      *
   Renew                  *     *      *                    *
   Rebind                 *     *      *                    *
   Decline                *     *      *
   Release                *     *      *
   Reply     *      *     *     *      *                    *        *
   Reconf.                                           *
   Inform.                *     *      *                    *
   R-forw.                             *      *
   R-repl.                             *      *

           SOL_MAX_RT  INF_MAX_RT
   Solicit
   Advert.    *
   Request
   Confirm
   Renew
   Rebind
   Decline
   Release
   Reply      *           *
   Reconf.
   Inform.
   R-forw.
   R-repl.




















<span class="grey">Mrugalski, et al.            Standards Track                  [Page 150]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-151"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20C.%20%20Appearance%20of%20Options%20in%20the%20%22options%22%20Field%20of%20DHCP"></a><a class="selflink" href="#appendix-C" id="appendix-C">Appendix C</a>.  Appearance of Options in the "options" Field of DHCP</span>
             Options

   The following table indicates with a "*" where options defined in
   this document can appear as top-level options or can be encapsulated
   in other options defined in this document.  Other RFCs may define
   additional situations where options defined in this document are
   encapsulated in other options.

   This table is informational.  If it conflicts with text earlier in
   this document, that text should be considered authoritative.

                   Top-    IA_NA/                        RELAY-  RELAY-
                   Level   IA_TA  IAADDR IA_PD  IAPREFIX FORW    REPL
   Client ID          *
   Server ID          *
   IA_NA/IA_TA        *
   IAADDR                     *
   IA_PD              *
   IAPREFIX                                 *
   ORO                *
   Preference         *
   Elapsed Time       *
   Relay Message                                            *       *
   Authentic.         *
   Server Uni.        *
   Status Code        *       *             *
   Rapid Comm.        *
   User Class         *
   Vendor Class       *
   Vendor Info.       *                                     *       *
   Interf. ID                                               *       *
   Reconf. MSG.       *
   Reconf. Accept     *
   Info Refresh Time  *
   SOL_MAX_RT         *
   INF_MAX_RT         *

   Notes: Options asterisked in the "Top-Level" column appear in the
   "options" field of client messages (see <a href="#section-8">Section 8</a>).  Options
   asterisked in the "RELAY-FORW" and "RELAY-REPL" columns appear in the
   "options" field of the Relay-forward and Relay-reply messages (see
   <a href="#section-9">Section 9</a>).








<span class="grey">Mrugalski, et al.            Standards Track                  [Page 151]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-152"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


Acknowledgments

   This document is merely a refinement of earlier work by the authors
   of the following documents and would not be possible without their
   original work:

   -  <a href="./rfc3315">RFC 3315</a> (Ralph Droms, Jim Bound, Bernie Volz, Ted Lemon, Charles
      Perkins, and Mike Carney)

   -  <a href="./rfc3633">RFC 3633</a> (Ole Troan and Ralph Droms)

   -  <a href="./rfc3736">RFC 3736</a> (Ralph Droms)

   -  <a href="./rfc4242">RFC 4242</a> (Stig Venaas, Tim Chown, and Bernie Volz)

   -  <a href="./rfc7083">RFC 7083</a> (Ralph Droms)

   -  <a href="./rfc7283">RFC 7283</a> (Yong Cui, Qi Sun, and Ted Lemon)

   -  <a href="./rfc7550">RFC 7550</a> (Ole Troan, Bernie Volz, and Marcin Siodelski)

   A number of additional people have contributed to identifying issues
   with <a href="./rfc3315">RFC 3315</a> and <a href="./rfc3633">RFC 3633</a> and proposed resolutions to these issues
   as reflected in this document (listed here in no particular order):
   Ole Troan, Robert Marks, Leaf Yeh, Michelle Cotton, Pablo Armando,
   John Brzozowski, Suresh Krishnan, Hideshi Enokihara, Alexandru
   Petrescu, Yukiyo Akisada, Tatuya Jinmei, Fred Templin, and Christian
   Huitema.

   We also thank the following, not otherwise acknowledged and in no
   particular order, for their review comments: Jeremy Reed, Francis
   Dupont, Lorenzo Colitti, Tianxiang Li, Ian Farrer, Yogendra Pal, Kim
   Kinnear, Shawn Routhier, Michayla Newcombe, Alissa Cooper, Allison
   Mankin, Adam Roach, Kyle Rose, Elwyn Davies, Eric Rescorla, Ben
   Campbell, Warren Kumari, and Kathleen Moriarty.

   Also, special thanks to Ralph Droms for answering many questions
   related to the original <a href="./rfc3315">RFC 3315</a> and <a href="./rfc3633">RFC 3633</a> work and for
   shepherding this document through the IETF process.












<span class="grey">Mrugalski, et al.            Standards Track                  [Page 152]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-153"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


Authors' Addresses

   Tomek Mrugalski
   Internet Systems Consortium, Inc.
   950 Charter Street
   Redwood City, CA  94063
   United States of America

   Email: tomasz.mrugalski@gmail.com


   Marcin Siodelski
   Internet Systems Consortium, Inc.
   950 Charter Street
   Redwood City, CA  94063
   United States of America

   Email: msiodelski@gmail.com


   Bernie Volz
   Cisco Systems, Inc.
   1414 Massachusetts Ave.
   Boxborough, MA  01719
   United States of America

   Email: volz@cisco.com


   Andrew Yourtchenko
   Cisco Systems, Inc.
   De kleetlaan 6a
   Diegem  BRABANT 1831
   Belgium

   Email: ayourtch@cisco.com


   Michael C. Richardson
   Sandelman Software Works
   470 Dawson Avenue
   Ottawa, ON  K1Z 5V7
   Canada

   Email: mcr+ietf@sandelman.ca
   URI:   <a href="http://www.sandelman.ca/">http://www.sandelman.ca/</a>





<span class="grey">Mrugalski, et al.            Standards Track                  [Page 153]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-154"></span>
<span class="grey"><a href="./rfc8415">RFC 8415</a>                      DHCP for IPv6                November 2018</span>


   Sheng Jiang
   Huawei Technologies Co., Ltd
   Q14, Huawei Campus, No. 156 Beiqing Road
   Hai-Dian District, Beijing  100095
   China

   Email: jiangsheng@huawei.com


   Ted Lemon
   Nibbhaya Consulting
   P.O. Box 958
   Brattleboro, VT  05301-0958
   United States of America

   Email: mellon@fugue.com


   Timothy Winters
   University of New Hampshire, Interoperability Lab (UNH-IOL)
   Durham, NH
   United States of America

   Email: twinters@iol.unh.edu



























Mrugalski, et al.            Standards Track                  [Page 154]
</pre>
</body></html>