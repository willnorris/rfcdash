<html><head></head><body><pre>Internet Engineering Task Force (IETF)                        V. Gurbani
Request for Comments: 5922             Bell Laboratories, Alcatel-Lucent
Updates: <a href="./rfc3261">3261</a>                                                S. Lawrence
Category: Standards Track
ISSN: 2070-1721                                               A. Jeffrey
                                       Bell Laboratories, Alcatel-Lucent
                                                               June 2010


      <span class="h1">Domain Certificates in the Session Initiation Protocol (SIP)</span>

Abstract

   This document describes how to construct and interpret certain
   information in a PKIX-compliant (Public Key Infrastructure using
   X.509) certificate for use in a Session Initiation Protocol (SIP)
   over Transport Layer Security (TLS) connection.  More specifically,
   this document describes how to encode and extract the identity of a
   SIP domain in a certificate and how to use that identity for SIP
   domain authentication.  As such, this document is relevant both to
   implementors of SIP and to issuers of certificates.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">SectionÂ 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc5922">http://www.rfc-editor.org/info/rfc5922</a>.
















<span class="grey">Gurbani, et al.              Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


Copyright Notice

   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. Key Words ..................................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Problem Statement ...............................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. SIP Domain to Host Resolution ...................................<a href="#page-5">5</a>
   <a href="#section-5">5</a>. The Need for Mutual Interdomain Authentication ..................<a href="#page-6">6</a>
   <a href="#section-6">6</a>. Certificate Usage by a SIP Service Provider .....................<a href="#page-7">7</a>
   <a href="#section-7">7</a>. Behavior of SIP Entities ........................................<a href="#page-8">8</a>
      <a href="#section-7.1">7.1</a>. Finding SIP Identities in a Certificate ....................<a href="#page-8">8</a>
      <a href="#section-7.2">7.2</a>. Comparing SIP Identities ...................................<a href="#page-9">9</a>
      <a href="#section-7.3">7.3</a>. Client Behavior ...........................................<a href="#page-10">10</a>
      <a href="#section-7.4">7.4</a>. Server Behavior ...........................................<a href="#page-11">11</a>
      <a href="#section-7.5">7.5</a>. Proxy Behavior ............................................<a href="#page-12">12</a>
      <a href="#section-7.6">7.6</a>. Registrar Behavior ........................................<a href="#page-12">12</a>
      <a href="#section-7.7">7.7</a>. Redirect Server Behavior ..................................<a href="#page-12">12</a>
      <a href="#section-7.8">7.8</a>. Virtual SIP Servers and Certificate Content ...............<a href="#page-12">12</a>
   <a href="#section-8">8</a>. Security Considerations ........................................<a href="#page-13">13</a>
      <a href="#section-8.1">8.1</a>. Connection Authentication Using Digest ....................<a href="#page-13">13</a>
   <a href="#section-9">9</a>. Acknowledgments ................................................<a href="#page-14">14</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-14">14</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-14">14</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-15">15</a>
   <a href="#appendix-A">Appendix A</a>.  Editorial Guidance (Non-Normative) ...................<a href="#page-16">16</a>
     <a href="#appendix-A.1">A.1</a>.  Additions .................................................<a href="#page-16">16</a>
     <a href="#appendix-A.2">A.2</a>.  Changes ...................................................<a href="#page-16">16</a>
       <a href="#appendix-A.2.1">A.2.1</a>.  Changes to <a href="#section-26.3.1">Section 26.3.1</a> .............................<a href="#page-16">16</a>








<span class="grey">Gurbani, et al.              Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   <a href="./rfc5246">RFC 5246</a> [<a href="#ref-5" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>5</a>] Transport Layer Security (TLS) is available in an
   increasing number of Session Initiation Protocol (SIP) <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>]
   implementations.  In order to use the authentication capabilities of
   TLS, certificates as defined by the Internet X.509 Public Key
   Infrastructure, see <a href="./rfc5280">RFC 5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>], are required.

   Existing SIP specifications do not sufficiently specify how to use
   certificates for domain (as opposed to host) authentication.  This
   document provides guidance to ensure interoperability and uniform
   conventions for the construction and interpretation of certificates
   used to identify their holders as being authoritative for the domain.

   The discussion in this document is pertinent to an X.509 PKIX-
   compliant certificate used for a TLS connection; this document does
   not define use of such certificates for any other purpose (such as
   Secure/Multipurpose Internet Mail Extensions (S/MIME)).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20Key%20Words"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Key Words</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="./rfc2119">RFC 2119</a> [<a href="#ref-1" title='"Key words for use in RFCs to Indicate Requirement Levels"'>1</a>].

   Additional definition(s):

   SIP domain identity:  An identity (e.g., "sip:example.com") contained
      in an X.509 certificate bound to a subject that identifies the
      subject as an authoritative SIP server for a domain.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Problem%20Statement"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Problem Statement</span>

   TLS uses <a href="./rfc5280">RFC 5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>] X.509 Public Key Infrastructure to bind an
   identity or a set of identities, to the subject of an X.509
   certificate.  While <a href="./rfc3261">RFC 3261</a> provides adequate guidance on the use of
   X.509 certificates for S/MIME, it is relatively silent on the use of
   such certificates for TLS.  With respect to certificates for TLS, <a href="./rfc3261">RFC</a>
   <a href="./rfc3261">3261</a> (<a href="#section-26.3.1">Section 26.3.1</a>) says:

      Proxy servers, redirect servers, and registrars SHOULD possess a
      site certificate whose subject corresponds to their canonical
      hostname.






<span class="grey">Gurbani, et al.              Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   The security properties of TLS and S/MIME as used in SIP are
   different: X.509 certificates for S/MIME are generally used for end-
   to-end authentication and encryption; thus, they serve to bind the
   identity of a user to the certificate and <a href="./rfc3261">RFC 3261</a> is sufficiently
   clear that in certificates used for S/MIME, the subjectAltName field
   will contain the appropriate identity.  On the other hand, X.509
   certificates used for TLS serve to bind the identities of the per-hop
   domain sending or receiving the SIP messages.  However, the lack of
   guidelines in <a href="./rfc3261">RFC 3261</a> on exactly where to put identities -- in the
   subjectAltName field or carried as a Common Name (CN) in the Subject
   field -- of an X.509 certificate created ambiguities.  Following the
   accepted practice of the time, legacy X.509 certificates were allowed
   to store the identity in the CN field of the certificate instead of
   the currently specified subjectAltName extension.  Lack of further
   guidelines on how to interpret the identities, which identity to
   choose if more than one identity is present in the certificate, the
   behavior when multiple identities with different schemes were present
   in the certificate, etc., lead to ambiguities when attempting to
   interpret the certificate in a uniform manner for TLS use.

   This document shows how the certificates are to be used for mutual
   authentication when both the client and server possess appropriate
   certificates, and normative behavior for matching the DNS query
   string with an identity stored in the X.509 certificate.
   Furthermore, a certificate can contain multiple identities for the
   subject in the subjectAltName extension (the "subject" of a
   certificate identifies the entity associated with the public key
   stored in the public key field).  As such, this document specifies
   appropriate matching rules to encompass various subject identity
   representation options.  And finally, this document also provides
   guidelines to service providers for assigning certificates to SIP
   servers.

   The rest of this document is organized as follows: the next section
   provides an overview of the most primitive case of a client using DNS
   to access a SIP server and the resulting authentication steps.
   <a href="#section-5">Section 5</a> looks at the reason why mutual inter-domain authentication
   is desired in SIP, and the lack of normative text and behavior in <a href="./rfc3261">RFC</a>
   <a href="./rfc3261">3261</a> for doing so.  <a href="#section-6">Section 6</a> outlines normative guidelines for a
   service provider assigning certificates to SIP servers.  <a href="#section-7">Section 7</a>
   provides normative behavior on the SIP entities (user agent clients,
   user agent servers, registrars, redirect servers, and proxies) that
   need perform authentication based on X.509 certificates.  <a href="#section-8">Section 8</a>
   includes the security considerations.







<span class="grey">Gurbani, et al.              Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20SIP%20Domain%20to%20Host%20Resolution"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  SIP Domain to Host Resolution</span>

   Routing in SIP is performed by having the client execute <a href="./rfc3263">RFC 3263</a> [<a href="#ref-8" title='"Session Initiation Protocol (SIP): Locating SIP Servers"'>8</a>]
   procedures on a URI, called the "Application Unique String (AUS)"
   (c.f.  <a href="./rfc3263#section-8">SectionÂ 8 of RFC 3263</a> [<a href="#ref-8" title='"Session Initiation Protocol (SIP): Locating SIP Servers"'>8</a>]).  These procedures take as input a
   SIP AUS (the SIP URI), extract the domain portion of that URI for use
   as a lookup key, and query the Domain Name Service (DNS) to obtain an
   ordered set of one or more IP addresses with a port number and
   transport corresponding to each IP address in the set (the "Expected
   Output").  If the transport indicates the use of TLS, then a TLS
   connection is opened to the server on a specific IP address and port.
   The server presents an X.509 certificate to the client for
   verification as part of the initial TLS handshake.

   The client extracts identifiers from the Subject and any
   subjectAltName extension in the certificate (see <a href="#section-7.1">Section 7.1</a>) and
   compares these values to the domain part extracted from the original
   SIP URI (the AUS).  If any identifier match is found, the server is
   considered to be authenticated and subsequent signaling can now
   proceed over the TLS connection.  Matching rules for X.509
   certificates and the normative behavior for clients is specified in
   <a href="#section-7.3">Section 7.3</a>.

   As an example, consider a request that is to be routed to the SIP
   address "sips:alice@example.com".  This address requires a secure
   connection to the SIP domain "example.com" (the 'sips' scheme
   mandates a secure connection).  Through a series of DNS
   manipulations, the domain name is mapped to a set of host addresses
   and transports.  The entity attempting to create the connection
   selects an address appropriate for use with TLS from this set.  When
   the connection is established to that server, the server presents a
   certificate asserting the identity "sip:example.com".  Since the
   domain part of the SIP AUS matches the subject of the certificate,
   the server is authenticated (see <a href="#section-7.2">Section 7.2</a> for the normative rules
   that govern this comparison).

      Session Initiation Protocol Secure (SIPS) borrows this pattern of
      server certificate matching from HTTPS.  However, <a href="./rfc2818">RFC 2818</a> [<a href="#ref-7" title='"HTTP Over TLS"'>7</a>]
      prefers that the identity be conveyed as a subjectAltName
      extension of type dNSName rather than the common practice of
      conveying the identity in the CN field of the Subject field.
      Similarly, this document recommends that the SIP domain identity
      be conveyed as a subjectAltName extension of type
      uniformResourceIdentifier (c.f.  Sections <a href="#section-6">6</a> and <a href="#section-7.1">7.1</a>).

      A domain name in an X.509 certificates is properly interpreted
      only as a sequence of octets to be compared to the URI used to
      reach the host.  No inference can be made based on the DNS name



<span class="grey">Gurbani, et al.              Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


      hierarchy.  For example, a valid certificate for "example.com"
      does not imply that the owner of that certificate has any
      relationship at all to "subname.example.com".

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20The%20Need%20for%20Mutual%20Interdomain%20Authentication"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  The Need for Mutual Interdomain Authentication</span>

   Consider the SIP trapezoid shown in Figure 1.

     Proxy-A.example.com           Proxy-B.example.net
        +-------+                    +-------+
        | Proxy |--------------------| Proxy |
        +----+--+                    +---+---+
             |                           |
             |                           |
             |                           |
             |                         +---+
           0---0                       |   |
            /-\                        |___|
           +---+                      /    /
                                     +----+
      alice@example.com          bob@example.net

               Figure 1: SIP Trapezoid

   A user, alice@example.com, invites bob@example.net for a multimedia
   communication session.  Alice's outbound proxy, Proxy-A.example.com,
   uses normal <a href="./rfc3263">RFC 3263</a> [<a href="#ref-8" title='"Session Initiation Protocol (SIP): Locating SIP Servers"'>8</a>] resolution rules to find a proxy -- Proxy-
   B.example.net -- in the example.net domain that uses TLS.  Proxy-A
   actively establishes an interdomain TLS connection with Proxy-B and
   each presents a certificate to authenticate that connection.

   <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>], Section 26.3.2.2, "Interdomain Requests" states that
   when a TLS connection is created between two proxies:

      Each side of the connection SHOULD verify and inspect the
      certificate of the other, noting the domain name that appears in
      the certificate for comparison with the header fields of SIP
      messages.

   However, <a href="./rfc3261">RFC 3261</a> is silent on whether to use the subjectAltName or
   CN of the certificate to obtain the domain name, and which takes
   precedence when there are multiple names identifying the holder of
   the certificate.








<span class="grey">Gurbani, et al.              Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   The authentication problem for Proxy-A is straightforward: in the
   certificate Proxy-A receives from Proxy-B, Proxy-A looks for an
   identity that is a SIP URI ("sip:example.net") or a DNS name
   ("example.net") that asserts Proxy-B's authority over the example.net
   domain.  Normative behavior for a TLS client like Proxy-A is
   specified in <a href="#section-7.3">Section 7.3</a>.

   The problem for Proxy-B is slightly more complex since it accepts the
   TLS request passively.  Thus, Proxy-B does not possess an equivalent
   AUS that it can use as an anchor in matching identities from
   Proxy-A's certificate.

      <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>], Section 26.3.2.2, only tells Proxy-B to "compare the
      domain asserted by the certificate with the 'domainname' portion
      of the From header field in the INVITE request".  The difficulty
      with that instruction is that the domainname in the From header
      field is not always that of the domain from which the request is
      received.

   The normative behavior for a TLS server like Proxy-B that passively
   accepts a TLS connection and requires authentication of the sending
   peer domain is provided in <a href="#section-7.4">Section 7.4</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Certificate%20Usage%20by%20a%20SIP%20Service%20Provider"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Certificate Usage by a SIP Service Provider</span>

   It is possible for service providers to continue the practice of
   using existing certificates for SIP usage with the identity conveyed
   only in the Subject field, but they should carefully consider the
   following advantages of conveying identity in the subjectAltName
   extension field:

   o  The subjectAltName extension can hold multiple values, so the same
      certificate can identify multiple servers or sip domains.

   o  There is no fixed syntax specified for the Subject field, so
      issuers vary in how the field content is set.  This forces a
      recipient to use heuristics to extract the identity, again
      increasing opportunities for misinterpretation.

   Because of these advantages, service providers are strongly
   encouraged to obtain certificates that contain the identity or
   identities in the subjectAltName extension field.

   When assigning certificates to authoritative servers, a SIP service
   provider MUST ensure that the SIP domain used to reach the server
   appears as an identity in the subjectAltName field, or for
   compatibility with existing certificates, the Subject field of the
   certificate.  In practice, this means that a service provider



<span class="grey">Gurbani, et al.              Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   distributes to its users SIP URIs whose domain portion corresponds to
   an identity for which the service provider has been issued a
   certificate.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Behavior%20of%20SIP%20Entities"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Behavior of SIP Entities</span>

   This section normatively specifies the behavior of SIP entities when
   using X.509 certificates to determine an authenticated SIP domain
   identity.

   The first two subsections apply to all SIP implementations that use
   TLS to authenticate the peer: <a href="#section-7.1">Section 7.1</a> describes how to extract a
   set of SIP identities from the certificate obtained from a TLS peer,
   and <a href="#section-7.2">Section 7.2</a> specifies how to compare SIP identities.  The
   remaining subsections provide context for how and when these rules
   are to be applied by entities in different SIP roles.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Finding%20SIP%20Identities%20in%20a%20Certificate"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Finding SIP Identities in a Certificate</span>

   Implementations (both clients and server) MUST determine the validity
   of a certificate by following the procedures described in <a href="./rfc5280">RFC 5280</a>
   [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>].

   As specified by <a href="./rfc5280">RFC 5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>], Section 4.2.1.12, implementations MUST
   check for restrictions on certificate usage declared by any
   extendedKeyUsage extensions in the certificate.  The SIP Extended Key
   Usage (EKU) document [<a href="#ref-12" title='"Using Extended Key Usage (EKU) for Session Initiation Protocol (SIP) X.509 Certificates"'>12</a>] defines an extendedKeyUsage for SIP.

   Given an X.509 certificate that the above checks have found to be
   acceptable, the following describes how to determine what SIP domain
   identity or identities the certificate contains.  A single
   certificate can serve more than one purpose -- that is, the
   certificate might contain identities not acceptable as SIP, domain
   identities and/or might contain one or more identities that are
   acceptable for use as SIP domain identities.

   1.  Examine each value in the subjectAltName field.  The
       subjectAltName field and the constraints on its values are
       defined in <a href="./rfc5280#section-4.2.1.6">SectionÂ 4.2.1.6 of RFC 5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>].  The subjectAltName
       field can be absent or can contain one or more values.  Each
       value in the subjectAltName has a type; the only types acceptable
       for encoding a SIP domain identity SHALL be:

       URI   If the scheme of the URI is not "sip", then the
             implementation MUST NOT accept the value as a SIP domain
             identity.





<span class="grey">Gurbani, et al.              Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


             If the scheme of the URI value is "sip", and the URI value
             that contains a userpart (there is an '@'), the
             implementation MUST NOT accept the value as a SIP domain
             identity (a value with a userpart identifies an individual
             user, not a domain).

             If the scheme of the URI value is "sip", and there is no
             userinfo component in the URI (there is no '@'), then the
             implementation MUST accept the hostpart as a SIP domain
             identity.

             Note: URI scheme tokens are always case insensitive.

       DNS   An implementation MUST accept a domain name system
             identifier as a SIP domain identity if and only if no other
             identity is found that matches the "sip" URI type described
             above.

   2.  If and only if the subjectAltName does not appear in the
       certificate, the implementation MAY examine the CN field of the
       certificate.  If a valid DNS name is found there, the
       implementation MAY accept this value as a SIP domain identity.
       Accepting a DNS name in the CN value is allowed for backward
       compatibility, but when constructing new certificates, consider
       the advantages of using the subjectAltName extension field (see
       <a href="#section-6">Section 6</a>).

   The above procedure yields a set containing zero or more identities
   from the certificate.  A client uses these identities to authenticate
   a server (see <a href="#section-7.3">Section 7.3</a>) and a server uses them to authenticate a
   client (see <a href="#section-7.4">Section 7.4</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20Comparing%20SIP%20Identities"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Comparing SIP Identities</span>

   When an implementation (either client or server) compares two values
   as SIP domain identities:

      Implementations MUST compare only the DNS name component of each
      SIP domain identifier; an implementation MUST NOT use any scheme
      or parameters in the comparison.

      Implementations MUST compare the values as DNS names, which means
      that the comparison is case insensitive as specified by <a href="./rfc4343">RFC 4343</a>
      [<a href="#ref-3" title='"Domain Name System (DNS) Case Insensitivity Clarification"'>3</a>].  Implementations MUST handle Internationalized Domain Names
      (IDNs) in accordance with <a href="./rfc5280#section-7.2">SectionÂ 7.2 of RFC 5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>].






<span class="grey">Gurbani, et al.              Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


      Implementations MUST match the values in their entirety:

         Implementations MUST NOT match suffixes.  For example,
         "foo.example.com" does not match "example.com".

         Implementations MUST NOT match any form of wildcard, such as a
         leading "." or "*." with any other DNS label or sequence of
         labels.  For example, "*.example.com" matches only
         "*.example.com" but not "foo.example.com".  Similarly,
         ".example.com" matches only ".example.com", and does not match
         "foo.example.com".

            <a href="./rfc2818">RFC 2818</a> [<a href="#ref-7" title='"HTTP Over TLS"'>7</a>] (HTTP over TLS) allows the dNSName component to
            contain a wildcard; e.g., "DNS:*.example.com".  <a href="./rfc5280">RFC 5280</a>
            [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>], while not disallowing this explicitly, leaves the
            interpretation of wildcards to the individual specification.
            <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>] does not provide any guidelines on the presence
            of wildcards in certificates.  Through the rule above, this
            document prohibits such wildcards in certificates for SIP
            domains.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.3.%20%20Client%20Behavior"></a><a class="selflink" href="#section-7.3" id="section-7.3">7.3</a>.  Client Behavior</span>

   A client uses the domain portion of the SIP AUS to query a (possibly
   untrusted) DNS to obtain a result set, which is one or more SRV and A
   records identifying the server for the domain (see <a href="#section-4">Section 4</a> for an
   overview).

   The SIP server, when establishing a TLS connection, presents its
   certificate to the client for authentication.  The client MUST
   determine the SIP domain identities in the server certificate using
   the procedure in <a href="#section-7.1">Section 7.1</a>.  Then, the client MUST compare the
   original domain portion of the SIP AUS used as input to the <a href="./rfc3263">RFC 3263</a>
   [<a href="#ref-8" title='"Session Initiation Protocol (SIP): Locating SIP Servers"'>8</a>] server location procedures to the SIP domain identities obtained
   from the certificate.

   o  If there were no identities found in the server certificate, the
      server is not authenticated.

   o  If the domain extracted from the AUS matches any SIP domain
      identity obtained from the certificate when compared as described
      in <a href="#section-7.2">Section 7.2</a>, the server is authenticated for the domain.

   If the server is not authenticated, the client MUST close the
   connection immediately.






<span class="grey">Gurbani, et al.              Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.4.%20%20Server%20Behavior"></a><a class="selflink" href="#section-7.4" id="section-7.4">7.4</a>.  Server Behavior</span>

   When a server accepts a TLS connection, the server presents its own
   X.509 certificate to the client.  Servers that wish to authenticate
   the client will ask the client for a certificate.  If the client
   possesses a certificate, that certificate is presented to the server.
   If the client does not present a certificate, the client MUST NOT be
   considered authenticated.

      Whether or not to close a connection if the client does not
      present a certificate is a matter of local policy, and depends on
      the authentication needs of the server for the connection.  Some
      currently deployed servers use Digest authentication to
      authenticate individual requests on the connection, and choose to
      treat the connection as authenticated by those requests for some
      purposes (but see <a href="#section-8.1">Section 8.1</a>).

      If the local server policy requires client authentication for some
      local purpose, then one element of such a local policy might be to
      allow the connection only if the client is authenticated.  For
      example, if the server is an inbound proxy that has peering
      relationships with the outbound proxies of other specific domains,
      the server might allow only connections authenticated as coming
      from those domains.

   When authenticating the client, the server MUST obtain the set of SIP
   domain identities from the client certificate as described in
   <a href="#section-7.1">Section 7.1</a>.  Because the server accepted the TLS connection
   passively, unlike a client, the server does not possess an AUS for
   comparison.  Nonetheless, server policies can use the set of SIP
   domain identities gathered from the certificate in <a href="#section-7.1">Section 7.1</a> to
   make authorization decisions.

   For example, a very open policy could be to accept an X.509
   certificate and validate the certificate using the procedures in <a href="./rfc5280">RFC</a>
   <a href="./rfc5280">5280</a> [<a href="#ref-6" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>6</a>].  If the certificate is valid, the identity set is logged.

   Alternatively, the server could have a list of all SIP domains the
   server is allowed to accept connections from; when a client presents
   its certificate, for each identity in the client certificate, the
   server searches for the identity in the list of acceptable domains to
   decide whether or not to accept the connection.  Other policies that
   make finer distinctions are possible.








<span class="grey">Gurbani, et al.              Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   The decision of whether or not the authenticated connection to the
   client is appropriate for use to route new requests to the client
   domain is independent of whether or not the connection is
   authenticated; the connect-reuse [<a href="#ref-10" title='"Connection Reuse in the Session Initiation Protocol"'>10</a>] document discusses this aspect
   in more detail.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.5.%20%20Proxy%20Behavior"></a><a class="selflink" href="#section-7.5" id="section-7.5">7.5</a>.  Proxy Behavior</span>

   A proxy MUST use the procedures defined for a User Agent Server (UAS)
   in <a href="#section-7.4">Section 7.4</a> when authenticating a connection from a client.

   A proxy MUST use the procedures defined for a User Agent Client (UAC)
   in <a href="#section-7.3">Section 7.3</a> when requesting an authenticated connection to a UAS.

   If a proxy adds a Record-Route when forwarding a request with the
   expectation that the route is to use secure connections, the proxy
   MUST insert into the Record-Route header a URI that corresponds to an
   identity for which the proxy has a certificate; if the proxy does not
   insert such a URI, then creation of a secure connection using the
   value from the Record-Route as the AUS will be impossible.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.6.%20%20Registrar%20Behavior"></a><a class="selflink" href="#section-7.6" id="section-7.6">7.6</a>.  Registrar Behavior</span>

   A SIP registrar, acting as a server, follows the normative behavior
   of <a href="#section-7.4">Section 7.4</a>.  When the SIP registrar accepts a TLS connection from
   the client, the SIP registrar presents its certificate.  Depending on
   the registrar policies, the SIP registrar can challenge the client
   with HTTP Digest.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.7.%20%20Redirect%20Server%20Behavior"></a><a class="selflink" href="#section-7.7" id="section-7.7">7.7</a>.  Redirect Server Behavior</span>

   A SIP redirect server follows the normative behavior of a UAS as
   specified in <a href="#section-7.4">Section 7.4</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.8.%20%20Virtual%20SIP%20Servers%20and%20Certificate%20Content"></a><a class="selflink" href="#section-7.8" id="section-7.8">7.8</a>.  Virtual SIP Servers and Certificate Content</span>

   In the "virtual hosting" cases where multiple domains are managed by
   a single application, a certificate can contain multiple subjects by
   having distinct identities in the subjectAltName field as specified
   in <a href="./rfc4474">RFC 4474</a> [<a href="#ref-9" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>9</a>].  Clients seeking to authenticate a server on such a
   virtual host can still follow the directions in <a href="#section-7.3">Section 7.3</a> to find
   the identity matching the SIP AUS used to query DNS.

   Alternatively, if the TLS client hello "server_name" extension as
   defined in <a href="./rfc4366">RFC 4366</a> [<a href="#ref-4" title='"Transport Layer Security (TLS) Extensions"'>4</a>] is supported, the client SHOULD use that
   extension to request a certificate corresponding to the specific
   domain (from the SIP AUS) with which the client is seeking to
   establish a connection.



<span class="grey">Gurbani, et al.              Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Security Considerations</span>

   The goals of TLS (when used with X.509 certificates) include the
   following security guarantees at the transport layer:

   Confidentiality:  packets tunneled through TLS can be read only by
      the sender and receiver.

   Integrity:  packets tunneled through TLS cannot be undetectably
      modified on the connection between the sender and receiver.

   Authentication:  each principal is authenticated to the other as
      possessing a private key for which a certificate has been issued.
      Moreover, this certificate has not been revoked, and is verifiable
      by a certificate chain leading to a (locally configured) trust
      anchor.

   We expect appropriate processing of domain certificates to provide
   the following security guarantees at the application level:

   Confidentiality:  SIPS messages from alice@example.com to
      bob@example.net can be read only by alice@example.com,
      bob@example.net, and SIP proxies issued with domain certificates
      for example.com or example.net.

   Integrity:  SIPS messages from alice@example.com to bob@example.net
      cannot be undetectably modified on the links between
      alice@example.com, bob@example.net, and SIP proxies issued with
      domain certificates for example.com or example.net.

   Authentication:  alice@example.com and proxy.example.com are mutually
      authenticated; moreover, proxy.example.com is authenticated to
      alice@example.com as an authoritative proxy for domain
      example.com.  Similar mutual authentication guarantees are given
      between proxy.example.com and proxy.example.net and between
      proxy.example.net and bob@example.net.  As a result,
      alice@example.com is transitively mutually authenticated to
      bob@example.net (assuming trust in the authoritative proxies for
      example.com and example.net).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Connection%20Authentication%20Using%20Digest"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Connection Authentication Using Digest</span>

   Digest authentication in SIP provides for authentication of the
   message sender to the challenging UAS.  As commonly deployed, digest
   authentication provides only very limited integrity protection of the
   authenticated message, and has no provision for binding the
   authentication to any attribute of the transport.  Many existing SIP
   deployments have chosen to use the Digest authentication of one or



<span class="grey">Gurbani, et al.              Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   more messages on a particular transport connection as a way to
   authenticate the connection itself -- by implication, authenticating
   other (unauthenticated) messages on that connection.  Some even
   choose to similarly authenticate a UDP source address and port based
   on the digest authentication of another message received from that
   address and port.  This use of digest goes beyond the assurances that
   the Digest Authentication mechanism was designed to provide.  A SIP
   implementation SHOULD NOT use the Digest Authentication of one
   message on a TCP connection or from a UDP peer to infer any
   authentication of any other messages on that connection or from that
   peer.  Authentication of the domain at the other end of a connection
   SHOULD be accomplished using TLS and the certificate validation rules
   described by this specification instead.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Acknowledgments"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Acknowledgments</span>

   The following IETF contributors provided substantive input to this
   document: Jeroen van Bemmel, Michael Hammer, Cullen Jennings, Paul
   Kyzivat, Derek MacDonald, Dave Oran, Jon Peterson, Eric Rescorla,
   Jonathan Rosenberg, and Russ Housley.  Special acknowledgement goes
   to Stephen Kent for extensively reviewing document versions and
   suggesting invaluable feedback, edits, and comments.

   Paul Hoffman, Eric Rescorla, and Robert Sparks provided many valuable
   WGLC comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20References"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-1">1</a>]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-2">2</a>]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
         Peterson, J., Sparks, R., Handley, M., and E. Schooler, "SIP:
         Session Initiation Protocol", <a href="./rfc3261">RFC 3261</a>, June 2002.

   [<a id="ref-3">3</a>]   Eastlake, D., "Domain Name System (DNS) Case Insensitivity
         Clarification", <a href="./rfc4343">RFC 4343</a>, January 2006.

   [<a id="ref-4">4</a>]   Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J., and
         T. Wright, "Transport Layer Security (TLS) Extensions",
         <a href="./rfc4366">RFC 4366</a>, April 2006.

   [<a id="ref-5">5</a>]   Dierks, T. and E. Rescorla, "The Transport Layer Security (TLS)
         Protocol Version 1.2", <a href="./rfc5246">RFC 5246</a>, August 2008.





<span class="grey">Gurbani, et al.              Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


   [<a id="ref-6">6</a>]   Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley,
         R., and W. Polk, "Internet X.509 Public Key Infrastructure
         Certificate and Certificate Revocation List (CRL) Profile",
         <a href="./rfc5280">RFC 5280</a>, May 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-7">7</a>]   Rescorla, E., "HTTP Over TLS", <a href="./rfc2818">RFC 2818</a>, May 2000.

   [<a id="ref-8">8</a>]   Rosenberg, J. and H. Schulzrinne, "Session Initiation Protocol
         (SIP): Locating SIP Servers", <a href="./rfc3263">RFC 3263</a>, June 2002.

   [<a id="ref-9">9</a>]   Peterson, J. and C. Jennings, "Enhancements for Authenticated
         Identity Management in the Session Initiation Protocol (SIP)",
         <a href="./rfc4474">RFC 4474</a>, August 2006.

   [<a id="ref-10">10</a>]  Mahy, R., Gurbani, V., and B. Tate, "Connection Reuse in the
         Session Initiation Protocol", <a href="./rfc5923">RFC 5923</a>, June 2010.

   [<a id="ref-11">11</a>]  Drage, K., "A Process for Handling Essential Corrections to the
         Session Initiation Protocol (SIP)", Work in Progress,
         July 2008.

   [<a id="ref-12">12</a>]  Lawrence, S. and V. Gurbani, "Using Extended Key Usage (EKU)
         for Session Initiation Protocol (SIP) X.509 Certificates",
         <a href="./rfc5924">RFC 5924</a>, June 2010.

























<span class="grey">Gurbani, et al.              Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Editorial%20Guidance%20%28Non-Normative%29"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Editorial Guidance (Non-Normative)</span>

   This document is intended to update <a href="./rfc3261">RFC 3261</a> in accordance with the
   SIP Working Group procedures described in [<a href="#ref-11" title='"A Process for Handling Essential Corrections to the Session Initiation Protocol (SIP)"'>11</a>] or its successor.

   This appendix provides guidance to the editor of the next
   comprehensive update to <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>] on how to incorporate the
   changes provided by this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.1.%20%20Additions"></a><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  Additions</span>

   The content of Sections <a href="#section-4">4</a> through <a href="#section-7">7</a> inclusive can be incorporated as
   subsections within a section that describes SIP domain
   authentication.

   The contents of <a href="#section-8.1">Section 8.1</a> can be incorporated into the Security
   Considerations section of the new document.

   All normative references from this document can be carried forward to
   its successor.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.%20%20Changes"></a><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  Changes</span>

   The following subsections describe changes in specific sections of
   <a href="./rfc3261">RFC 3261</a> [<a href="#ref-2" title='"SIP: Session Initiation Protocol"'>2</a>] that need to be modified in the successor document to
   align them with the content of this document.  In each of the
   following, the token &lt;domain-authentication&gt; is a reference to the
   section added as described in <a href="#appendix-A.1">Appendix A.1</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.1.%20%20Changes%20to%20Section%2026.3.1"></a><a class="selflink" href="#appendix-A.2.1" id="appendix-A.2.1">A.2.1</a>.  Changes to <a href="#section-26.3.1">Section 26.3.1</a></span>

   The current text says:

      Proxy servers, redirect servers and registrars SHOULD possess a
      site certificate whose subject corresponds to their canonical
      hostname.

   The suggested replacement for the above is:

      Proxy servers, redirect servers, registrars, and any other server
      that is authoritative for some SIP purpose in a given domain
      SHOULD possess a certificate whose subjects include the name of
      that SIP domain.








<span class="grey">Gurbani, et al.              Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc5922">RFC 5922</a>                      Domain Certs                     June 2010</span>


Authors' Addresses

   Vijay K. Gurbani
   Bell Laboratories, Alcatel-Lucent
   1960 Lucent Lane
   Room 9C-533
   Naperville, IL  60566
   USA

   Phone: +1 630 224-0216
   EMail: vkg@alcatel-lucent.com


   Scott Lawrence

   EMail: scott-ietf@skrb.org


   Alan S.A. Jeffrey
   Bell Laboratories, Alcatel-Lucent
   1960 Lucent Lane
   Room 9C-533
   Naperville, IL  60566
   USA

   EMail: ajeffrey@alcatel-lucent.com

























Gurbani, et al.              Standards Track                   [Page 17]
</pre>
</body></html>