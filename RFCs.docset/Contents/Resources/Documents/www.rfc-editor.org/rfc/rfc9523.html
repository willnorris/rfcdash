<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9523: A Secure Selection and Filtering Mechanism for the Network Time Protocol with Khronos</title>
<meta content="Neta Rozen-Schiff" name="author"/>
<meta content="Danny Dolev" name="author"/>
<meta content="Tal Mizrahi" name="author"/>
<meta content="Michael Schapira" name="author"/>
<meta content="
       The Network Time Protocol version 4 (NTPv4), as defined in RFC 5905, is the mechanism used by NTP clients to synchronize with NTP servers across the Internet. This document describes a companion application to the NTPv4 client, named &quot;Khronos&quot;, that is used as a &quot;watchdog&quot; alongside NTPv4 and that provides improved security against time-shifting attacks. Khronos involves changes to the NTP client's system process only. Since it does not affect the wire protocol, the Khronos mechanism is applicable to current and future time protocols. 
    " name="description"/>
<meta content="xml2rfc 3.19.4" name="generator"/>
<meta content="NTP" name="keyword"/>
<meta content="NTPv4" name="keyword"/>
<meta content="9523" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.19.4
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9523.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-ntp-chronos-25" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9523" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9523</td>
<td class="center">NTP Extention with Khronos</td>
<td class="right">February 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rozen-Schiff, et al.</td>
<td class="center">Informational</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9523">9523</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Informational</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-02">February 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">N. Rozen-Schiff</div>
<div class="org">Hebrew University of Jerusalem</div>
</div>
<div class="author">
      <div class="author-name">D. Dolev</div>
<div class="org">Hebrew University of Jerusalem</div>
</div>
<div class="author">
      <div class="author-name">T. Mizrahi</div>
<div class="org">Huawei Network.IO Innovation Lab</div>
</div>
<div class="author">
      <div class="author-name">M. Schapira</div>
<div class="org">Hebrew University of Jerusalem</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9523</h1>
<h1 id="title">A Secure Selection and Filtering Mechanism for the Network Time Protocol with Khronos</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">The Network Time Protocol version 4 (NTPv4), as defined in RFC 5905, is the mechanism used by NTP clients to synchronize with NTP servers across the Internet. This document describes a companion application to the NTPv4 client, named "Khronos", that is used as a "watchdog" alongside NTPv4 and that provides improved security against time-shifting attacks. Khronos involves changes to the NTP client's system process only. Since it does not affect the wire protocol, the Khronos mechanism is applicable to current and future time protocols.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for informational purposes.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by the
            Internet Engineering Steering Group (IESG).  Not all documents
            approved by the IESG are candidates for any level of Internet
            Standard; see Section 2 of RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9523">https://www.rfc-editor.org/info/rfc9523</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-conventions-used-in-this-do">Conventions Used in This Document</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p class="keepWithNext" id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-terms-and-abbreviations">Terms and Abbreviations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p class="keepWithNext" id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-notations">Notations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-khronos-design">Khronos Design</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-khronos-calibration-gatheri">Khronos Calibration - Gathering the Khronos Pool</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-khronoss-poll-and-system-pr">Khronos's Poll and System Processes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a class="auto internal xref" href="#section-3.3">3.3</a>.  <a class="internal xref" href="#name-khronoss-recommended-parame">Khronos's Recommended Parameters</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-operational-considerations">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-load-considerations">Load Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-threat-model">Threat Model</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-attack-detection">Attack Detection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a class="auto internal xref" href="#section-5.3">5.3</a>.  <a class="internal xref" href="#name-security-analysis-overview">Security Analysis Overview</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-khronos-pseudocode">Khronos Pseudocode</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-precision-vs-security">Precision vs. Security</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">NTPv4, as defined in <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>, is vulnerable to time-shifting attacks in which the attacker changes (shifts) the clock of a network device. Time-shifting attacks on NTP clients can be based on interfering with the communication between the NTP clients and servers or compromising the servers themselves. Time-shifting attacks on NTP are possible even if NTP communication is encrypted and authenticated. A weaker machine-in-the-middle (MITM) attacker can shift time simply by dropping or delaying packets, whereas a powerful attacker that has full control over an NTP server can do so by explicitly determining the NTP response content. This document introduces a time-shifting mitigation mechanism called "Khronos". 
  Khronos can be integrated as a background-monitoring application (watchdog) that guards against time-shifting attacks in any NTP client. An NTP client that runs Khronos is interoperable with NTPv4 servers that are compatible with <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>. The Khronos mechanism does not affect the wire mechanism; therefore, it is applicable to any current or future time protocol.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">Khronos is a mechanism that runs in the background, continuously monitoring the client clock (which is updated by NTPv4) and calculating an estimated offset (referred to as the "Khronos time offset"). When the offset exceeds a predefined threshold (specified in <a class="auto internal xref" href="#attackDetection">Section 5.2</a>), this is interpreted as the client experiencing a time-shifting attack. In this case, Khronos updates the client's clock.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">When the client is not under attack, Khronos is passive.  This allows NTPv4 to control the client's clock and provides the ordinary high precision and accuracy of NTPv4.  When under attack, Khronos takes control of the client's clock, mitigating the time shift while guaranteeing relatively high accuracy with respect to UTC and precision, as discussed in <a class="auto internal xref" href="#Precision_Security">Section 7</a>.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">By leveraging techniques from distributed computing theory for time synchronization, Khronos achieves accurate time even in the presence of powerful attackers who are in direct control of a large number of NTP servers. Khronos will prevent shifting the clock when the ratio of compromised time samples is below 2/3. In each polling interval, a Khronos client randomly selects and samples a few NTP servers out of a local pool of hundreds of servers. Khronos is carefully engineered to minimize the load on NTP servers and the communication overhead. 
  In contrast, NTPv4 employs an algorithm that typically relies on a small subset of the NTP server pool (e.g., four servers) for time synchronization and is much more vulnerable to time-shifting attacks. Configuring NTPv4 to use several hundreds of servers will increase its security, but will incur very high network and computational overhead compared to Khronos and will be bounded by a compromised ratio of half of the time samples.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">A Khronos client iteratively "crowdsources" time queries across NTP servers and applies a provably secure algorithm for eliminating "suspicious" responses and for averaging over the remaining responses. In each Khronos poll interval, the Khronos client selects, uniformly at random, a small subset (e.g., 10-15 servers) of a large server pool (containing hundreds of servers).
  While Khronos queries around three times more servers per polling interval than NTP, Khronos's polling interval can be longer (e.g., 10 times longer) than NTPv4, thereby minimizing the load on NTP servers and the communication overhead. 
  Moreover, Khronos's random server selection may even help to distribute queries across the whole pool.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6"> Khronos's security was evaluated both theoretically and experimentally with a prototype implementation. According to this security analysis, if a local Khronos pool consists of, for example, 500 servers, one-seventh of whom are controlled by an attacker and Khronos queries 15 servers in each Khronos poll interval (around 10 times the NTPv4 poll interval), then over 20 years of effort are required (in expectation) to successfully shift time at a Khronos client by over 100 ms from UTC. The full exposition of the formal analysis of this guarantee is available at <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">Khronos maintains a time offset value (the Khronos time offset) and uses it as a reference for detecting attacks. This time offset value computation differs from the current NTPv4 in two key aspects:<a class="pilcrow" href="#section-1-7">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-8.1">
      First, in each Khronos poll interval, Khronos periodically communicates  with only a few (tens) randomly selected servers out of a pool consisting of a large number (e.g., hundreds) of NTP servers.<a class="pilcrow" href="#section-1-8.1">¶</a>
</li>
        <li class="normal" id="section-1-8.2">Second, Khronos computes the Khronos time offset based on an approximate agreement technique to remove outliers, thus limiting the attacker's ability to contaminate the time samples (offsets) derived from the queried NTP servers.<a class="pilcrow" href="#section-1-8.2">¶</a>
</li>
      </ul>
<p id="section-1-9">These two aspects allow Khronos to minimize the load on the NTP servers and to provide provable security guarantees against both MITM attackers and attackers capable of compromising a large number of NTP servers.<a class="pilcrow" href="#section-1-9">¶</a></p>
<p id="section-1-10">We note that, to some extent, Network Time Security (NTS) <span>[<a class="cite xref" href="#RFC8915">RFC8915</a>]</span> could make it more challenging for attackers to perform MITM attacks, but is of little impact if the servers themselves are compromised.<a class="pilcrow" href="#section-1-10">¶</a></p>
</section>
<section id="section-2">
      <h2 id="name-conventions-used-in-this-do">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-conventions-used-in-this-do">Conventions Used in This Document</a>
      </h2>
<section id="section-2.1">
        <h3 id="name-terms-and-abbreviations">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-terms-and-abbreviations">Terms and Abbreviations</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-2.1-1">
          <dt id="section-2.1-1.1">NTPv4:</dt>
          <dd id="section-2.1-1.2" style="margin-left: 1.5em">Network Time Protocol version 4. See <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>.<a class="pilcrow" href="#section-2.1-1.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-1.3">System process:</dt>
          <dd id="section-2.1-1.4" style="margin-left: 1.5em">See the "Selection Algorithm" and the "Cluster Algorithm" sections of <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>.<a class="pilcrow" href="#section-2.1-1.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-1.5">Security Requirements:</dt>
          <dd id="section-2.1-1.6" style="margin-left: 1.5em">See "<a class="internal xref" href="#RFC7384">Security Requirements of Time Protocols in Packet Switched Networks</a>" <span>[<a class="cite xref" href="#RFC7384">RFC7384</a>]</span>.<a class="pilcrow" href="#section-2.1-1.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-1.7">NTS:</dt>
          <dd id="section-2.1-1.8" style="margin-left: 1.5em">Network Time Security.  See "<a class="internal xref" href="#RFC8915">Network Time Security for the Network Time Protocol</a>" <span>[<a class="cite xref" href="#RFC8915">RFC8915</a>]</span>.<a class="pilcrow" href="#section-2.1-1.8">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-2.2">
        <h3 id="name-notations">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-notations">Notations</a>
        </h3>
<p class="keepWithNext" id="section-2.2-1">When describing the Khronos algorithm, the following notation is used:<a class="pilcrow" href="#section-2.2-1">¶</a></p>
<span id="name-khronos-notation"></span><div id="table_example">
<table class="center" id="table-1">
          <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-khronos-notation">Khronos Notation</a>
          </caption>
<thead>
            <tr>
              <th class="text-center" colspan="1" rowspan="1">Notation</th>
              <th class="text-left" colspan="1" rowspan="1">Meaning</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">n </td>
              <td class="text-left" colspan="1" rowspan="1">The number of candidate servers in a Khronos pool (potentially hundreds). </td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">m </td>
              <td class="text-left" colspan="1" rowspan="1">The number of servers that Khronos queries in each poll interval (up to tens). </td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">w </td>
              <td class="text-left" colspan="1" rowspan="1">An upper bound on the distance between any "truechimer" NTP server (as in <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>) and UTC.</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">B </td>
              <td class="text-left" colspan="1" rowspan="1">An upper bound on the client's clock error rate (ms/sec). </td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">ERR  </td>
              <td class="text-left" colspan="1" rowspan="1">An upper bound on the client's clock error between Khronos polls (ms).</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">K  </td>
              <td class="text-left" colspan="1" rowspan="1">The number of Khronos pool resamplings until reaching "panic mode".</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">H  </td>
              <td class="text-left" colspan="1" rowspan="1">Predefined threshold for a Khronos time offset triggering clock update by Khronos.</td>
            </tr>
          </tbody>
        </table>
</div>
<p class="keepWithPrevious" id="section-2.2-3"></p>
<p id="section-2.2-4">The recommended values are discussed in <a class="auto internal xref" href="#values">Section 3.3</a>.<a class="pilcrow" href="#section-2.2-4">¶</a></p>
</section>
</section>
<section id="section-3">
      <h2 id="name-khronos-design">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-khronos-design">Khronos Design</a>
      </h2>
<p id="section-3-1">Khronos periodically queries a set of m (tens) servers from a large (hundreds) server pool in each Khronos poll interval, where the m servers are selected from the server pool at random. Based on empirical analyses, to minimize the load on NTP servers while providing high security, the Khronos poll interval should be around 10 times the NTPv4 poll interval (i.e., a Khronos clock update occurs once every 10 NTPv4 clock updates). In each Khronos poll interval, if the Khronos time offset exceeds a predetermined threshold (denoted as H), an attack is indicated.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2"> Unless an attack is indicated, Khronos uses only one sample from each server (avoiding the "Clock Filter Algorithm" as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5905#section-10">Section 10</a> of [<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>). When under attack, Khronos uses several samples from each server and executes the "Clock Filter Algorithm" for choosing the best sample from each server with low jitter. Then, given a sample from each server, Khronos discards outliers by executing the procedure described in <a class="auto internal xref" href="#Conditions">Section 3.2</a>.<a class="pilcrow" href="#section-3-2">¶</a></p>
<p id="section-3-3">Between consecutive Khronos polls, Khronos keeps track of clock offsets, e.g., by catching clock discipline (as in <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>) calls. The sum of offsets is referred to as the "Khronos inter-poll offset" (denoted as tk), which is set to zero after each Khronos poll.<a class="pilcrow" href="#section-3-3">¶</a></p>
<section id="section-3.1">
        <h3 id="name-khronos-calibration-gatheri">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-khronos-calibration-gatheri">Khronos Calibration - Gathering the Khronos Pool</a>
        </h3>
<p id="section-3.1-1">Calibration is performed the first time Khronos is executed and periodically thereafter (once every two weeks). The calibration process generates a local Khronos pool of n (up to hundreds) NTP servers that the client can synchronize with.
To this end, Khronos makes multiple DNS queries to the NTP pools. Each query returns a few NTP server IPs that Khronos combines into one set of IPs considered as the Khronos pool.
The servers in the Khronos pool should be scattered across different regions to make it harder for an attacker to compromise or gain MITM capabilities with respect to a large fraction of the Khronos pool. Therefore, Khronos calibration queries general NTP server pools (e.g., pool.ntp.org) and not just the pool in the client's state or region.

In addition, servers can be selected to be part of the Khronos pool manually or by using other NTP pools (such as NIST Internet time servers).<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<p id="section-3.1-2">The first Khronos update requires m servers, which can be found in several minutes. Moreover, it is possible to query several DNS pool names to vastly accelerate the calibration and the first update.<a class="pilcrow" href="#section-3.1-2">¶</a></p>
<p id="section-3.1-3">The calibration is the only Khronos part where DNS traffic is generated. Around 125 DNS queries are required by Khronos to obtain addresses of 500 NTP servers, which is higher than Khronos pool size (n). Assuming the calibration period is two weeks, the expected DNS traffic generated by the Khronos client is less than 10 DNS queries per day, which is usually several orders of magnitude lower than the total daily number of DNS queries per machine.<a class="pilcrow" href="#section-3.1-3">¶</a></p>
</section>
<div id="Conditions">
<section id="section-3.2">
        <h3 id="name-khronoss-poll-and-system-pr">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-khronoss-poll-and-system-pr">Khronos's Poll and System Processes</a>
        </h3>
<p id="section-3.2-1">In each Khronos poll interval, the Khronos system process randomly chooses a set of m (tens) servers out of the Khronos pool of n (hundreds) servers and samples them. Note that the randomness of the server selection is crucial for the security of the scheme; therefore, any Khronos implementation must use a secure randomness implementation such as what is used for encryption key generation.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2"> Khronos's polling times of different servers may spread uniformly within its poll interval, which is similar to NTPv4. Servers that do not respond during the Khronos poll interval are filtered out. If less than one-third of the m servers are left, a new subset of servers is immediately sampled in the exact same manner (which is called the "resampling" process).<a class="pilcrow" href="#section-3.2-2">¶</a></p>
<p id="section-3.2-3">Next, out of the time samples received from this chosen subset of servers, the lowest third of the samples' offset values and the highest third of the samples' offset values are discarded.<a class="pilcrow" href="#section-3.2-3">¶</a></p>
<p id="section-3.2-4">Khronos checks that the following two conditions hold for the remaining sampled offsets (considering w and ERR defined in <a class="auto internal xref" href="#table_example">Table 1</a>):<a class="pilcrow" href="#section-3.2-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-5.1">The maximal distance between every two offsets does not exceed 2w (can be verified by considering just the minimum and the maximum offsets).<a class="pilcrow" href="#section-3.2-5.1">¶</a>
</li>
          <li class="normal" id="section-3.2-5.2">The distance between the offset's average and the Khronos inter-poll offset is ERR+2w at most.<a class="pilcrow" href="#section-3.2-5.2">¶</a>
</li>
        </ul>
<p id="section-3.2-6">
   In the event that both of these conditions are satisfied, the average of
   the offsets is set to be the Khronos time offset. Otherwise, resampling is
   performed. This process spreads the Khronos client's queries across
   servers, thereby improving security against powerful attackers (as
   discussed in <a class="auto internal xref" href="#Security_analysis">Section 5.3</a>) and
   mitigating the effect of a DoS attack on NTP servers that renders them
   non-responsive. This resampling process continues in subsequent Khronos
   poll intervals until the two conditions are both satisfied or the number of
   times the servers are resampled exceeds a "panic trigger" (K in <a class="auto internal xref" href="#table_example">Table 1</a>). In this case, Khronos enters
   panic mode.<a class="pilcrow" href="#section-3.2-6">¶</a></p>
<p id="section-3.2-7">In panic mode, Khronos queries all the servers in its local Khronos pool, orders the collected time samples from lowest to highest, and eliminates the lowest third and the highest third of the samples. The client then calculates the average of the remaining samples and sets this average to be the new Khronos time offset.<a class="pilcrow" href="#section-3.2-7">¶</a></p>
<p id="section-3.2-8">If the Khronos time offset exceeds a predetermined threshold (H), it is passed on to the clock discipline algorithm in order to steer the system time (as in <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>). In this case, the user and/or admin of the client machine should be notified about the detected time-shifting attack, e.g., by a message written to a relevant event log or displayed on screen.<a class="pilcrow" href="#section-3.2-8">¶</a></p>
<p id="section-3.2-9"> Note that resampling immediately follows the previous sampling
        since waiting until the next polling interval may increase the time
        shift in face of an attack. This shouldn't generate high overhead
        since the number of resamples is bounded by K (after K resamplings,
        panic mode is in place) and the chances of ending up with repeated
        resampling are low (see <a class="auto internal xref" href="#Security">Section 5</a> for
        more details). Moreover, in an interval following a panic mode,
        Khronos executes the same system process that starts by querying only
        m servers (regardless of previous panic).<a class="pilcrow" href="#section-3.2-9">¶</a></p>
</section>
</div>
<div id="values">
<section id="section-3.3">
        <h3 id="name-khronoss-recommended-parame">
<a class="section-number selfRef" href="#section-3.3">3.3. </a><a class="section-name selfRef" href="#name-khronoss-recommended-parame">Khronos's Recommended Parameters</a>
        </h3>
<p id="section-3.3-1">According to empirical observations (presented in <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>), querying 15 servers at each poll interval (i.e., m=15) out of 500 servers (i.e., n=500) and setting w to be around 25 ms provides both high time accuracy and good security. Specifically, when selecting w=25 ms, approximately 83% of the servers' clocks are, at most, w away from UTC and within 2w from each other, satisfying the first condition of Khronos's system process. For a similar reason, the threshold for a Khronos time offset triggering a clock update by Khronos (H) should be between w and 2w; the default is 30 ms. Note that in order to support scenarios with congested links, using a higher w value, such as 1 second, is recommended.<a class="pilcrow" href="#section-3.3-1">¶</a></p>
<p id="section-3.3-2">Furthermore, according to Khronos security analysis, setting K to be 3 (i.e., if  the two conditions are not satisfied after three resamplings, then Khronos enters panic mode) is safe when facing time-shifting attacks.  In addition, the probability of an attacker forcing a panic mode on a client when K=3 is negligible (less than 0.000002 for each polling interval).<a class="pilcrow" href="#section-3.3-2">¶</a></p>
<p id="section-3.3-3">Khronos's effect on precision and accuracy are discussed in Sections <a class="auto internal xref" href="#Security">5</a> and <a class="auto internal xref" href="#Precision_Security">7</a>.<a class="pilcrow" href="#section-3.3-3">¶</a></p>
</section>
</div>
</section>
<div id="operational">
<section id="section-4">
      <h2 id="name-operational-considerations">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-operational-considerations">Operational Considerations</a>
      </h2>
<p id="section-4-1"> Khronos is designed to defend NTP clients from time-shifting attacks while using public NTP servers.  As such, Khronos is not applicable for data centers and enterprises that synchronize with local atomic clocks, GPS devices, or a dedicated NTP server (e.g., due to regulations).<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2"> Khronos can be used for devices that require and depend upon timekeeping within a configurable constant distance from UTC.<a class="pilcrow" href="#section-4-2">¶</a></p>
<div id="Security_vs._load_considerations">
<section id="section-4.1">
        <h3 id="name-load-considerations">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-load-considerations">Load Considerations</a>
        </h3>
<p id="section-4.1-1">One requirement from Khronos is not to induce excessive load on NTP servers beyond that of NTPv4, even if it is widely integrated into NTP clients. We discuss below the possible causes for a Khronos-induced load on servers and how this can be mitigated.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2">Servers in pool.ntp.org are weighted differently by the NTP server pool when assigned to NTP clients. Specifically, server owners define a "server weight" (the "netspeed" parameter) and servers are assigned to clients probabilistically according to their proportional weight. Khronos's queries are equally distributed across a pool of servers. To avoid overloading servers, Khronos queries servers less frequently than NTPv4, with the Khronos query interval set to 10 times the default NTPv4 maxpoll (interval) parameter. Hence, if Khronos queries are targeted at servers in pool.ntp.org, any target increase in server load (in terms of multiplicative increase in queries or number of bytes per second) is controlled by the poll interval configuration, which was analyzed in <span>[<a class="cite xref" href="#Ananke">Ananke</a>]</span>.<a class="pilcrow" href="#section-4.1-2">¶</a></p>
<p id="section-4.1-3">Consider the scenario where an attacker attempts to generate significant load on NTP servers by triggering multiple consecutive panic modes at multiple NTP clients. We note that to accomplish this, the attacker must have MITM capabilities with respect to the communication between each and every client in a large group of clients and a large fraction of all NTP servers in the queried pool. This implies that the attacker must either be physically located at a central location (e.g., at the egress of a large ISP) or launch a wide-scale attack (e.g., on BGP or DNS); thereby, it is capable of carrying similar and even higher impact attacks regardless of Khronos clients.<a class="pilcrow" href="#section-4.1-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Security">
<section id="section-5">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<div id="threatModel">
<section id="section-5.1">
        <h3 id="name-threat-model">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-threat-model">Threat Model</a>
        </h3>
<p id="section-5.1-1">The threat model encompasses a broad spectrum of attackers impacting a subset (e.g., one-third) of the servers in NTP pools. These attackers can range from a fairly weak (yet dangerous) MITM attacker that is only capable of delaying and dropping packets (e.g., using the Bufferbloat attack <span>[<a class="cite xref" href="#RFC8033">RFC8033</a>]</span>) to an extremely powerful attacker who is in control of (even authenticated) NTP servers and is capable of fully determining the values of the time samples returned by these NTP servers (see detailed attacker discussion in <span>[<a class="cite xref" href="#RFC7384">RFC7384</a>]</span>).<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<p id="section-5.1-2">For example, the attackers covered by this model might be:<a class="pilcrow" href="#section-5.1-2">¶</a></p>
<ol class="normal type-1" id="section-5.1-3" start="1" type="1">
<li id="section-5.1-3.1">in direct control of a fraction of the NTP servers (e.g., by exploiting a software vulnerability),<a class="pilcrow" href="#section-5.1-3.1">¶</a>
</li>
          <li id="section-5.1-3.2">an ISP (or other attacker at the Autonomous System level) on the default BGP paths from the NTP client to a fraction of the available servers,<a class="pilcrow" href="#section-5.1-3.2">¶</a>
</li>
          <li id="section-5.1-3.3">a nation state with authority over the owners of NTP servers in its jurisdiction, or<a class="pilcrow" href="#section-5.1-3.3">¶</a>
</li>
          <li id="section-5.1-3.4">an attacker capable of hijacking (e.g., through DNS cache poisoning or BGP prefix hijacking) traffic to some of the available NTP servers.<a class="pilcrow" href="#section-5.1-3.4">¶</a>
</li>
        </ol>
<p id="section-5.1-4">The details of the specific attack scenario are abstracted by reasoning about attackers in terms of the fraction of servers with respect to which the attacker has adversarial capabilities. 
 Attackers that can impact communications with (or control) a higher fraction of the servers (e.g., all servers) are out of scope. 
Considering the pool size across the world to be in the thousands, such attackers will most likely be capable of creating far worse damage than time-shifting attacks.<a class="pilcrow" href="#section-5.1-4">¶</a></p>
<p id="section-5.1-5"> Notably, Khronos provides protection from MITM and powerful attacks that cannot be achieved by cryptographic authentication protocols since, even with such measures in place, an attacker can still influence time by dropping/delaying packets. However, adding an authentication layer (e.g., NTS <span>[<a class="cite xref" href="#RFC8915">RFC8915</a>]</span>) to Khronos will enhance its security guarantees and enable the detection of various spoofing and modification attacks.<a class="pilcrow" href="#section-5.1-5">¶</a></p>
<p id="section-5.1-6"> Moreover, Khronos uses randomness to independently select the queried servers in each poll interval, preventing attackers from exploiting observations of past server selections.<a class="pilcrow" href="#section-5.1-6">¶</a></p>
</section>
</div>
<div id="attackDetection">
<section id="section-5.2">
        <h3 id="name-attack-detection">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-attack-detection">Attack Detection</a>
        </h3>
<p id="section-5.2-1"> Khronos detects time-shifting attacks by constantly monitoring NTPv4's (or potentially any other current or future time protocol) clock and the offset computed by Khronos and checking whether the offset exceeds a predetermined threshold (H). NTPv4 controls the client's clock unless an attack was detected. Under attack, Khronos takes control over the client's clock in order to prevent its shift.<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<p id="section-5.2-2">Analytical results (in <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>) indicate that if a local Khronos pool consists of 500 servers, one-seventh of whom are controlled by a MITM attacker, and 15 of those servers are queried in each Khronos poll interval, then success in shifting time of a Khronos client by even a small degree (100 ms) takes many years of effort (over 20 years in expectation). See a brief overview of Khronos's security analysis below.<a class="pilcrow" href="#section-5.2-2">¶</a></p>
</section>
</div>
<div id="Security_analysis">
<section id="section-5.3">
        <h3 id="name-security-analysis-overview">
<a class="section-number selfRef" href="#section-5.3">5.3. </a><a class="section-name selfRef" href="#name-security-analysis-overview">Security Analysis Overview</a>
        </h3>
<p id="section-5.3-1">Time samples that are at most w away from UTC are considered "good", whereas other samples are considered "malicious". Two scenarios are considered:<a class="pilcrow" href="#section-5.3-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-2.1">Scenario A: Less than two-thirds of the queried servers are under the attacker's control.<a class="pilcrow" href="#section-5.3-2.1">¶</a>
</li>
          <li class="normal" id="section-5.3-2.2">Scenario B: The attacker controls more than two-thirds of the queried servers.<a class="pilcrow" href="#section-5.3-2.2">¶</a>
</li>
        </ul>
<p id="section-5.3-3">Scenario A consists of two sub-cases:<a class="pilcrow" href="#section-5.3-3">¶</a></p>
<ol class="normal type-1" id="section-5.3-4" start="1" type="1">
   <li id="section-5.3-4.1">There is at least one good sample in the set of samples not eliminated by Khronos (in the middle third of samples), and<a class="pilcrow" href="#section-5.3-4.1">¶</a>
</li>
          <li id="section-5.3-4.2">there are no good samples in the remaining set of samples.<a class="pilcrow" href="#section-5.3-4.2">¶</a>
</li>
        </ol>
<p id="section-5.3-5">In sub-case 1, the other remaining samples, including those
   provided by the attacker, must be close to a good sample (otherwise, the first condition of Khronos's system process in <a class="auto internal xref" href="#Conditions">Section 3.2</a> is violated and a new set of servers is chosen). This implies that the average of the remaining samples must be close to UTC.<a class="pilcrow" href="#section-5.3-5">¶</a></p>
<p id="section-5.3-6">In sub-case 2, since more than a third of the initial samples were
   good, both the (discarded) third-lowest-value samples and the
   (discarded) third-highest-value samples must each contain a good
   sample.  Hence, all the remaining samples are bounded from both
   above and below by good samples, and so is their average value,
   implying that this value is close to UTC <span>[<a class="cite xref" href="#RFC5905">RFC5905</a>]</span>.<a class="pilcrow" href="#section-5.3-6">¶</a></p>
<p id="section-5.3-7">In Scenario B, the worst possibility for the client is that all remaining
samples are malicious (i.e., more than w away from UTC).  However, as proved
in <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>, the probability of this scenario
is extremely low, even if the attacker controls a large fraction (e.g.,
one-fourth) of the n servers in the local Khronos pool.  Therefore, the
probability that the attacker repeatedly reaches this scenario decreases
exponentially, rendering the probability of a significant time shift
negligible.  We can express the improvement ratio of Khronos over NTPv4 by the
ratios of their single-shift probabilities.  Such ratios are provided in <a class="auto internal xref" href="#improvement_ratio">Table 2</a>, where higher values indicate
higher improvement of Khronos over NTPv4 and are also proportional to the
expected time until a time-shift attack succeeds once.<a class="pilcrow" href="#section-5.3-7">¶</a></p>
<p class="keepWithNext" id="section-5.3-8"></p>
<span id="name-khronos-improvement"></span><div id="improvement_ratio">
<table class="center" id="table-2">
          <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-khronos-improvement">Khronos Improvement</a>
          </caption>
<thead>
            <tr>
              <th class="text-center" colspan="1" rowspan="1">Attack Ratio</th>
              <th class="text-center" colspan="1" rowspan="1">6 Samples</th>
              <th class="text-center" colspan="1" rowspan="1">12 Samples</th>
              <th class="text-center" colspan="1" rowspan="1">18 Samples</th>
              <th class="text-center" colspan="1" rowspan="1">24 Samples</th>
              <th class="text-center" colspan="1" rowspan="1">30 Samples</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/3</td>
              <td class="text-center" colspan="1" rowspan="1">1.93e+01</td>
              <td class="text-center" colspan="1" rowspan="1">3.85e+02</td>
              <td class="text-center" colspan="1" rowspan="1">7.66e+03</td>
              <td class="text-center" colspan="1" rowspan="1">1.52e+05</td>
              <td class="text-center" colspan="1" rowspan="1">3.03e+06</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/5</td>
              <td class="text-center" colspan="1" rowspan="1">1.25e+01</td>
              <td class="text-center" colspan="1" rowspan="1">1.59e+02</td>
              <td class="text-center" colspan="1" rowspan="1">2.01e+03</td>
              <td class="text-center" colspan="1" rowspan="1">2.54e+04</td>
              <td class="text-center" colspan="1" rowspan="1">3.22e+05</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/7</td>
              <td class="text-center" colspan="1" rowspan="1">1.13e+01</td>
              <td class="text-center" colspan="1" rowspan="1">1.29e+02</td>
              <td class="text-center" colspan="1" rowspan="1">1.47e+03</td>
              <td class="text-center" colspan="1" rowspan="1">1.67e+04</td>
              <td class="text-center" colspan="1" rowspan="1">1.90e+05</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/9</td>
              <td class="text-center" colspan="1" rowspan="1">8.54e+00</td>
              <td class="text-center" colspan="1" rowspan="1">7.32e+01</td>
              <td class="text-center" colspan="1" rowspan="1">6.25e+02</td>
              <td class="text-center" colspan="1" rowspan="1">5.32e+03</td>
              <td class="text-center" colspan="1" rowspan="1">4.52e+04</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/10</td>
              <td class="text-center" colspan="1" rowspan="1">5.83e+00</td>
              <td class="text-center" colspan="1" rowspan="1">3.34e+01</td>
              <td class="text-center" colspan="1" rowspan="1">1.89e+02</td>
              <td class="text-center" colspan="1" rowspan="1">1.07e+03</td>
              <td class="text-center" colspan="1" rowspan="1">6.04e+03</td>
            </tr>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1/15</td>
              <td class="text-center" colspan="1" rowspan="1">3.21e+00</td>
              <td class="text-center" colspan="1" rowspan="1">9.57e+00</td>
              <td class="text-center" colspan="1" rowspan="1">2.79e+01</td>
              <td class="text-center" colspan="1" rowspan="1">8.05e+01</td>
              <td class="text-center" colspan="1" rowspan="1">2.31e+02</td>
            </tr>
          </tbody>
        </table>
</div>
<p class="keepWithPrevious" id="section-5.3-10"></p>
<p id="section-5.3-11">In addition to evaluating the probability of an attacker successfully shifting time at the client's clock, we also evaluated the probability that the attacker succeeds in launching a DoS attack on the servers by causing many clients to enter panic mode (and querying all the servers in their local Khronos pools). This probability (with the previous parameters of n=500, m=15, w=25, and K=3) is negligible even for an attacker who controls a large number of servers in clients' local Khronos pools, and it is expected to take decades to force a panic mode.<a class="pilcrow" href="#section-5.3-11">¶</a></p>
<p id="section-5.3-12">Further details about Khronos's security guarantees can be found in <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>.<a class="pilcrow" href="#section-5.3-12">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Pseudocode">
<section id="section-6">
      <h2 id="name-khronos-pseudocode">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-khronos-pseudocode">Khronos Pseudocode</a>
      </h2>
<p class="keepWithNext" id="section-6-1">The pseudocode for Khronos Time Sampling Scheme, which is invoked in each Khronos poll interval, is as follows:<a class="pilcrow" href="#section-6-1">¶</a></p>
<div class="lang-pseduocode sourcecode" id="section-6-2">
<pre>counter = 0
S = []
T = []
While counter &lt; K do
   S = sample(m) //get samples from (tens of) randomly chosen servers
   T = bi_side_trim(S,1/3) //trim lowest and highest thirds
   if (max(T) - min(T) &lt;= 2w) and (|avg(T) - tk| &lt; ERR + 2w), then
       return avg(T) // Normal case
   end
   counter ++
end
// panic mode
S = sample(n)
T = bi-sided-trim(S,1/3) //trim lowest and highest thirds
return avg(T)
</pre><a class="pilcrow" href="#section-6-2">¶</a>
</div>
<p id="section-6-3">Note that if clock disciplines can be called during this pseudocode's execution, then each time offset sample, as well as the final output (Khronos time offset), should be normalized with the sum of the clock disciplines offsets (tk) at the time of computing it.<a class="pilcrow" href="#section-6-3">¶</a></p>
</section>
</div>
<div id="Precision_Security">
<section id="section-7">
      <h2 id="name-precision-vs-security">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-precision-vs-security">Precision vs. Security</a>
      </h2>
<p id="section-7-1">Since NTPv4 updates the clock at times when no time-shifting attacks are detected, the precision and accuracy of a Khronos client are the same as NTPv4 at these times. 
  Khronos is proved to maintain an accurate estimation of the UTC with high probability. Therefore, when Khronos detects that client's clock error exceeds a threshold (H), it considers it to be an attack and takes control over the client's clock. As a result, the time shift is mitigated and high accuracy is guaranteed (the error is bounded by H).<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2"> Khronos is based on crowdsourcing across servers and regions, changes the set of queried servers more frequently than NTPv4 <span>[<a class="cite xref" href="#Khronos">Khronos</a>]</span>, and avoids some of the filters in NTPv4's system process. These factors can potentially harm its precision. Therefore, a smoothing mechanism can be used where instead of a simple average of the remaining samples, the smallest (in absolute value) offset is used unless its distance from the average is higher than a predefined value. Preliminary experiments demonstrated promising results with precision similar to NTPv4.<a class="pilcrow" href="#section-7-2">¶</a></p>
<p id="section-7-3">In applications such as multi-source media streaming, which are highly sensitive to time differences among hosts, note that it is advisable to use Khronos at all hosts in order to obtain high precision, even in the presence of attackers that try to shift each host in a different magnitude and/or direction. Another approach that is more efficient for these cases may be to allow direct time synchronization between one host who runs Khronos to others.<a class="pilcrow" href="#section-7-3">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a class="pilcrow" href="#section-8-1">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC5905">[RFC5905]</dt>
        <dd>
<span class="refAuthor">Mills, D.</span>, <span class="refAuthor">Martin, J., Ed.</span>, <span class="refAuthor">Burbank, J.</span>, and <span class="refAuthor">W. Kasch</span>, <span class="refTitle">"Network Time Protocol Version 4: Protocol and Algorithms Specification"</span>, <span class="seriesInfo">RFC 5905</span>, <span class="seriesInfo">DOI 10.17487/RFC5905</span>, <time class="refDate" datetime="2010-06">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5905">https://www.rfc-editor.org/info/rfc5905</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7384">[RFC7384]</dt>
        <dd>
<span class="refAuthor">Mizrahi, T.</span>, <span class="refTitle">"Security Requirements of Time Protocols in Packet Switched Networks"</span>, <span class="seriesInfo">RFC 7384</span>, <span class="seriesInfo">DOI 10.17487/RFC7384</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7384">https://www.rfc-editor.org/info/rfc7384</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8033">[RFC8033]</dt>
        <dd>
<span class="refAuthor">Pan, R.</span>, <span class="refAuthor">Natarajan, P.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">G. White</span>, <span class="refTitle">"Proportional Integral Controller Enhanced (PIE): A Lightweight Control Scheme to Address the Bufferbloat Problem"</span>, <span class="seriesInfo">RFC 8033</span>, <span class="seriesInfo">DOI 10.17487/RFC8033</span>, <time class="refDate" datetime="2017-02">February 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8033">https://www.rfc-editor.org/info/rfc8033</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8915">[RFC8915]</dt>
      <dd>
<span class="refAuthor">Franke, D.</span>, <span class="refAuthor">Sibold, D.</span>, <span class="refAuthor">Teichel, K.</span>, <span class="refAuthor">Dansarie, M.</span>, and <span class="refAuthor">R. Sundblad</span>, <span class="refTitle">"Network Time Security for the Network Time Protocol"</span>, <span class="seriesInfo">RFC 8915</span>, <span class="seriesInfo">DOI 10.17487/RFC8915</span>, <time class="refDate" datetime="2020-09">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8915">https://www.rfc-editor.org/info/rfc8915</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="Ananke">[Ananke]</dt>
        <dd>
<span class="refAuthor">Perry, Y.</span>, <span class="refAuthor">Rozen-Schiff, N.</span>, and <span class="refAuthor">M. Schapira</span>, <span class="refTitle">"A Devil of a Time: How Vulnerable is NTP to Malicious Timeservers?"</span>, <span class="refContent">Network and Distributed Systems Security (NDSS) Symposium, Virtual</span>, <span class="seriesInfo">DOI 10.14722/ndss.2021.24302</span>, <time class="refDate" datetime="2021-02">February 2021</time>, <span>&lt;<a href="https://www.ndss-symposium.org/wp-content/uploads/ndss2021_1A-2_24302_paper.pdf">https://www.ndss-symposium.org/wp-content/uploads/ndss2021_1A-2_24302_paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Khronos">[Khronos]</dt>
      <dd>
<span class="refAuthor">Deutsch, O.</span>, <span class="refAuthor">Rozen-Schiff, N.</span>, <span class="refAuthor">Dolev, D.</span>, and <span class="refAuthor">M. Schapira</span>, <span class="refTitle">"Preventing (Network) Time Travel with Chronos"</span>, <span class="refContent">Network and Distributed Systems Security (NDSS) Symposium, San Diego, CA, USA</span>, <span class="seriesInfo">DOI 10.14722/ndss.2018.23231</span>, <time class="refDate" datetime="2018-02">February 2018</time>, <span>&lt;<a href="https://www.ndss-symposium.org/wp-content/uploads/2018/02/ndss2018_02A-2_Deutsch_paper.pdf">https://www.ndss-symposium.org/wp-content/uploads/2018/02/ndss2018_02A-2_Deutsch_paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="Acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank <span class="contact-name">Erik Kline</span>,
      <span class="contact-name">Miroslav Lichvar</span>, <span class="contact-name">Danny       Mayer</span>, <span class="contact-name">Karen O'Donoghue</span>, <span class="contact-name">Dieter Sibold</span>, <span class="contact-name">Yaakov (J) Stein</span>,
      <span class="contact-name">Harlan Stenn</span>, <span class="contact-name">Hal Murray</span>,
      <span class="contact-name">Marcus Dansarie</span>, <span class="contact-name">Geoff       Huston</span>, <span class="contact-name">Roni Even</span>, <span class="contact-name">Benjamin       Schwartz</span>, <span class="contact-name">Tommy Pauly</span>, <span class="contact-name">Rob       Sayre</span>, <span class="contact-name">Dave Hart</span>, and <span class="contact-name">Ask       Bjorn Hansen</span> for valuable contributions to this document and helpful
      discussions and comments.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Neta Rozen-Schiff</span></div>
<div class="left" dir="auto"><span class="org">Hebrew University of Jerusalem</span></div>
<div class="left" dir="auto">
<span class="locality">Jerusalem</span> </div>
<div class="left" dir="auto"><span class="country-name">Israel</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+972%202%20549%204599">+972 2 549 4599</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:neta.r.schiff@gmail.com">neta.r.schiff@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Danny Dolev</span></div>
<div class="left" dir="auto"><span class="org">Hebrew University of Jerusalem</span></div>
<div class="left" dir="auto">
<span class="locality">Jerusalem</span> </div>
<div class="left" dir="auto"><span class="country-name">Israel</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+972%202%20549%204588">+972 2 549 4588</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:danny.dolev@mail.huji.ac.il">danny.dolev@mail.huji.ac.il</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Tal Mizrahi</span></div>
<div class="left" dir="auto"><span class="org">Huawei Network.IO Innovation Lab</span></div>
<div class="left" dir="auto"><span class="country-name">Israel</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:tal.mizrahi.phd@gmail.com">tal.mizrahi.phd@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Michael Schapira</span></div>
<div class="left" dir="auto"><span class="org">Hebrew University of Jerusalem</span></div>
<div class="left" dir="auto">
<span class="locality">Jerusalem</span> </div>
<div class="left" dir="auto"><span class="country-name">Israel</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+972%202%20549%204570">+972 2 549 4570</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:schapiram@huji.ac.il">schapiram@huji.ac.il</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>