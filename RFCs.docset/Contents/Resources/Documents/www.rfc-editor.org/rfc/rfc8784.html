<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 8784: Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security</title>
<meta content="Scott Fluhrer" name="author"/>
<meta content="Panos Kampanakis" name="author"/>
<meta content="David McGrew" name="author"/>
<meta content="Valery Smyslov" name="author"/>
<meta content="
       The possibility of quantum computers poses a serious challenge to
      cryptographic algorithms deployed widely today.  The Internet Key Exchange
      Protocol Version 2 (IKEv2) is one example of a cryptosystem that could
      be broken; someone storing VPN communications today could decrypt them
      at a later time when a quantum computer is available.  It is anticipated
      that IKEv2 will be extended to support quantum-secure key exchange
      algorithms; however, that is not likely to happen in the near term.  To
      address this problem before then, this document describes an extension
      of IKEv2 to allow it to be resistant to a quantum computer by using
      preshared keys. 
    " name="description"/>
<meta content="xml2rfc 2.46.0" name="generator"/>
<meta content="internet key exchange" name="keyword"/>
<meta content="quantum computer" name="keyword"/>
<meta content="post quantum" name="keyword"/>
<meta content="post-quantum" name="keyword"/>
<meta content="quantum safe" name="keyword"/>
<meta content="quantum secure" name="keyword"/>
<meta content="quantum resistant" name="keyword"/>
<meta content="8784" name="rfc.number"/>
<link href="rfc8784.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code {
  background-color: #f9f9f9;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc8784" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-qr-ikev2-11" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 8784</td>
<td class="center">Mixing PSKs in IKEv2 for PQ Security</td>
<td class="right">June 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Fluhrer, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc8784">8784</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2020-06">June 2020</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Fluhrer</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">P. Kampanakis</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">D. McGrew</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 8784</h1>
<h1 id="title">Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">The possibility of quantum computers poses a serious challenge to
      cryptographic algorithms deployed widely today.  The Internet Key Exchange
      Protocol Version 2 (IKEv2) is one example of a cryptosystem that could
      be broken; someone storing VPN communications today could decrypt them
      at a later time when a quantum computer is available.  It is anticipated
      that IKEv2 will be extended to support quantum-secure key exchange
      algorithms; however, that is not likely to happen in the near term.  To
      address this problem before then, this document describes an extension
      of IKEv2 to allow it to be resistant to a quantum computer by using
      preshared keys.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc8784">https://www.rfc-editor.org/info/rfc8784</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a><a class="pilcrow" href="#section-toc.1-1.1.1">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="xref" href="#section-1.1">1.1</a>.  <a class="xref" href="#name-requirements-language">Requirements Language</a><a class="pilcrow" href="#section-toc.1-1.1.2.1.1">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-assumptions">Assumptions</a><a class="pilcrow" href="#section-toc.1-1.2.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-exchanges">Exchanges</a><a class="pilcrow" href="#section-toc.1-1.3.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-upgrade-procedure">Upgrade Procedure</a><a class="pilcrow" href="#section-toc.1-1.4.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-ppk">PPK</a><a class="pilcrow" href="#section-toc.1-1.5.1">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="xref" href="#section-5.1">5.1</a>.  <a class="xref" href="#name-ppk_id-format">PPK_ID Format</a><a class="pilcrow" href="#section-toc.1-1.5.2.1.1">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="xref" href="#section-5.2">5.2</a>.  <a class="xref" href="#name-operational-considerations">Operational Considerations</a><a class="pilcrow" href="#section-toc.1-1.5.2.2.1">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a class="xref" href="#section-5.2.1">5.2.1</a>.  <a class="xref" href="#name-ppk-distribution">PPK Distribution</a><a class="pilcrow" href="#section-toc.1-1.5.2.2.2.1.1">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a class="xref" href="#section-5.2.2">5.2.2</a>.  <a class="xref" href="#name-group-ppk">Group PPK</a><a class="pilcrow" href="#section-toc.1-1.5.2.2.2.2.1">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a class="xref" href="#section-5.2.3">5.2.3</a>.  <a class="xref" href="#name-ppk-only-authentication">PPK-Only Authentication</a><a class="pilcrow" href="#section-toc.1-1.5.2.2.2.3.1">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-security-considerations">Security Considerations</a><a class="pilcrow" href="#section-toc.1-1.6.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-iana-considerations">IANA Considerations</a><a class="pilcrow" href="#section-toc.1-1.7.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#section-8">8</a>.  <a class="xref" href="#name-references">References</a><a class="pilcrow" href="#section-toc.1-1.8.1">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a class="xref" href="#section-8.1">8.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a><a class="pilcrow" href="#section-toc.1-1.8.2.1.1">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a class="xref" href="#section-8.2">8.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a><a class="pilcrow" href="#section-toc.1-1.8.2.2.1">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#section-appendix.a">Appendix A</a>.  <a class="xref" href="#name-discussion-and-rationale">Discussion and Rationale</a><a class="pilcrow" href="#section-toc.1-1.9.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#section-appendix.b"></a><a class="xref" href="#name-acknowledgements">Acknowledgements</a><a class="pilcrow" href="#section-toc.1-1.10.1">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="xref" href="#section-appendix.c"></a><a class="xref" href="#name-authors-addresses">Authors' Addresses</a><a class="pilcrow" href="#section-toc.1-1.11.1">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">Recent achievements in developing quantum computers demonstrate that
      it is probably feasible to build one that is cryptographically significant. If
      such a computer is implemented, many of the cryptographic algorithms and
      protocols currently in use would be insecure.  A quantum computer would
      be able to solve Diffie-Hellman (DH) and Elliptic Curve Diffie-Hellman
      (ECDH) problems in polynomial time <span>[<a class="xref" href="#I-D.hoffman-c2pq">C2PQ</a>]</span>, and this would imply that the security of existing
      IKEv2 <span>[<a class="xref" href="#RFC7296">RFC7296</a>]</span> systems would be
      compromised.  IKEv1 <span>[<a class="xref" href="#RFC2409">RFC2409</a>]</span>, when used with strong preshared
      keys, is not vulnerable to quantum attacks because those keys are one of
      the inputs to the key derivation function.  If the preshared key has
      sufficient entropy and the Pseudorandom Function (PRF), encryption, and authentication
      transforms are quantum secure, then the resulting system is believed to
      be quantum secure -- that is, secure against classical attackers of
      today or future attackers with a quantum computer.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">This document describes a way to extend IKEv2 to have a similar
      property; assuming that the two end systems share a long secret key,
      then the
      resulting exchange is quantum secure.
      By bringing post-quantum security to IKEv2, this document removes the need
      to use an obsolete version of IKE in order to achieve
      that security goal.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The general idea is that we add an additional secret that is shared
      between the initiator and the responder; this secret is in addition to
      the authentication method that is already provided within IKEv2.  We
      stir this secret into the SK_d value, which is used to generate the key
      material (KEYMAT) for the Child Security Associations (SAs) and the
      SKEYSEED for the IKE SAs created as a result
      of the initial IKE SA rekey. This secret provides quantum resistance to
      the IPsec SAs and any subsequent IKE SAs. We also stir the secret into the SK_pi and SK_pr values;
      this allows both sides to detect a secret mismatch cleanly.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">It was considered important to minimize the changes to IKEv2.
      The existing mechanisms to perform authentication and key exchange remain
      in place (that is, we continue to perform (EC)DH and potentially PKI
      authentication if configured). This document does not replace the authentication
      checks that the protocol does; instead, they are 
      strengthened by using an additional secret key.<a class="pilcrow" href="#section-1-4">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-requirements-language">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-assumptions">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-assumptions">Assumptions</a>
      </h2>
<p id="section-2-1"> We assume that each IKE peer has a list of Post-quantum Preshared
      Keys (PPKs) along with their identifiers (PPK_ID), and any potential IKE
      initiator selects which PPK to use with any specific responder.  In
      addition, implementations have a configurable flag that determines
      whether this PPK is mandatory.  This PPK is
      independent of the preshared key (if any) that the IKEv2 protocol uses
      to perform authentication (because the preshared key in IKEv2 is not
      used for any key derivation and thus doesn't protect against quantum
      computers).  The PPK-specific configuration that is assumed to be on
      each node consists of the following tuple:<a class="pilcrow" href="#section-2-1">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2-2">
<pre>Peer, PPK, PPK_ID, mandatory_or_not
</pre><a class="pilcrow" href="#section-2-2">¶</a>
</div>
<p id="section-2-3">We assume the reader is familiar with the payload notation defined in
      <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-1.2">Section 1.2</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>.<a class="pilcrow" href="#section-2-3">¶</a></p>
</section>
<div id="Exchanges">
<section id="section-3">
      <h2 id="name-exchanges">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-exchanges">Exchanges</a>
      </h2>
<p id="section-3-1">If the initiator is configured to use a PPK with the responder (whether or not
      the use of the PPK is mandatory), then it <span class="bcp14">MUST</span> include a
      notification USE_PPK in the IKE_SA_INIT request message as follows:<a class="pilcrow" href="#section-3-1">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-2">
<pre>Initiator                       Responder
------------------------------------------------------------------
HDR, SAi1, KEi, Ni, N(USE_PPK)  ---&gt;
</pre><a class="pilcrow" href="#section-3-2">¶</a>
</div>
<p id="section-3-3">N(USE_PPK) is a status notification payload with the type 16435;
      it has a protocol ID of 0, no Security Parameter Index (SPI), and no notification data associated with it.<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">If the initiator needs to resend this initial message with a COOKIE notification, then the resend would include the USE_PPK notification 
      if the original message did (see <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.6">Section 2.6</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>).<a class="pilcrow" href="#section-3-4">¶</a></p>
<p id="section-3-5">If the responder does not support this specification or does not have any PPK configured, 
      then it ignores the received notification (as defined in <span>[<a class="xref" href="#RFC7296">RFC7296</a>]</span> for unknown status notifications) 
      and continues with the IKEv2 protocol as normal.
      Otherwise, the responder replies with the IKE_SA_INIT message, including a USE_PPK notification in the response:<a class="pilcrow" href="#section-3-5">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-6">
<pre>Initiator                       Responder
------------------------------------------------------------------
                &lt;--- HDR, SAr1, KEr, Nr, [CERTREQ,] N(USE_PPK)
</pre><a class="pilcrow" href="#section-3-6">¶</a>
</div>
<p id="section-3-7">When the initiator receives this reply, it checks whether the responder included the USE_PPK notification.
      If the responder did not include the USE_PPK notification and the flag mandatory_or_not indicates that using PPKs is mandatory for communication with this responder, 
      then the initiator <span class="bcp14">MUST</span> abort the exchange. This
      situation may happen in case of misconfiguration, i.e., when the
      initiator believes it has a mandatory-to-use PPK for the responder and the responder either doesn't support 
      PPKs at all or doesn't have any PPK configured for the initiator. See <a class="xref" href="#Security">Section 6</a> for discussion
      of the possible impacts of this situation.<a class="pilcrow" href="#section-3-7">¶</a></p>
<p id="section-3-8">If the responder did not include the USE_PPK notification and using a PPK for this particular responder is optional, 
      then the initiator continues with the IKEv2 protocol as normal, without using PPKs.<a class="pilcrow" href="#section-3-8">¶</a></p>
<p id="section-3-9">If the responder did include the USE_PPK notification, then the initiator selects a PPK, along with its 
      identifier PPK_ID. Then, it computes this modification of the standard
      IKEv2 key derivation from <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.14">Section 2.14</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>:<a class="pilcrow" href="#section-3-9">¶</a></p>
<div id="section-3-10">
<pre class="sourcecode lang-pseudocode"> SKEYSEED = prf(Ni | Nr, g^ir)
 {SK_d' | SK_ai | SK_ar | SK_ei | SK_er | SK_pi' | SK_pr'}
                 = prf+ (SKEYSEED, Ni | Nr | SPIi | SPIr)

 SK_d  = prf+ (PPK, SK_d')
 SK_pi = prf+ (PPK, SK_pi')
 SK_pr = prf+ (PPK, SK_pr')
</pre><a class="pilcrow" href="#section-3-10">¶</a>
</div>
<p id="section-3-11"> That is, we use the standard IKEv2 key derivation process, except
      that the three resulting subkeys SK_d, SK_pi, and SK_pr 
      (marked with primes in the formula above) are then run through the prf+ again, this time using the PPK as the key.
      The result is the unprimed versions of these keys, which are then used as inputs to subsequent steps of the
      IKEv2 exchange.<a class="pilcrow" href="#section-3-11">¶</a></p>
<p id="section-3-12"> Using a prf+ construction ensures that it is always possible to get
      the resulting keys of the same size as the initial ones, even if the
      underlying PRF has an output size different from its key size. Note that
      at the time of this writing, all PRFs defined for use in IKEv2 (see the
      "Transform Type 2 - Pseudorandom Function Transform IDs" subregistry
<span>[<a class="xref" href="#IANA-IKEV2">IANA-IKEV2</a>]</span>) have an output size equal to the (preferred) key size. For such PRFs, only the first
      iteration of prf+ is needed:<a class="pilcrow" href="#section-3-12">¶</a></p>
<div id="section-3-13">
<pre class="sourcecode lang-pseudocode"> SK_d  = prf (PPK, SK_d'  | 0x01)
 SK_pi = prf (PPK, SK_pi' | 0x01)
 SK_pr = prf (PPK, SK_pr' | 0x01)
</pre><a class="pilcrow" href="#section-3-13">¶</a>
</div>
<p id="section-3-14">Note that the PPK is used in SK_d, SK_pi, and SK_pr calculations only  
       during the initial IKE SA setup. It <span class="bcp14">MUST NOT</span> be used when these subkeys  
       are calculated as result of IKE SA rekey, resumption, or other similar  
       operations.<a class="pilcrow" href="#section-3-14">¶</a></p>
<p id="section-3-15">The initiator then sends the IKE_AUTH request message, including the PPK_ID value as follows:<a class="pilcrow" href="#section-3-15">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-16">
<pre>Initiator                       Responder
------------------------------------------------------------------
HDR, SK {IDi, [CERT,] [CERTREQ,]
    [IDr,] AUTH, SAi2,
    TSi, TSr, N(PPK_IDENTITY, PPK_ID), [N(NO_PPK_AUTH)]}  ---&gt;
</pre><a class="pilcrow" href="#section-3-16">¶</a>
</div>
<p id="section-3-17">PPK_IDENTITY is a status notification with the type 16436; 
      it has a protocol ID of 0, no SPI, and notification data that consists of the identifier PPK_ID.<a class="pilcrow" href="#section-3-17">¶</a></p>
<p id="section-3-18">A situation may happen when the responder has some PPKs but doesn't have a PPK with the PPK_ID received 
      from the initiator. In this case, the responder cannot continue with the
      PPK (in particular, it cannot
      authenticate the initiator), but the responder could be able to continue
      with the normal IKEv2 protocol if the initiator 
      provided its authentication data computed as in the normal IKEv2 without using PPKs. For this purpose, 
      if using PPKs for communication with this responder is optional for the initiator (based on the mandatory_or_not flag),  
      then the initiator <span class="bcp14">MUST</span> include a NO_PPK_AUTH notification in the above message. This notification informs the responder
      that PPKs are optional and allows for authenticating the initiator
      without using PPKs.<a class="pilcrow" href="#section-3-18">¶</a></p>
<p id="section-3-19">NO_PPK_AUTH is a status notification with the type 16437; it has a
      protocol ID of 0 and no SPI.  The Notification Data field contains
      the initiator's authentication data computed using SK_pi', which has
      been computed without using PPKs. This is the same data that would
      normally be placed in the Authentication Data field of an AUTH payload.
      Since the Auth Method field is not present in the notification, the
      authentication method used for computing the authentication data <span class="bcp14">MUST</span>  
      be the same as the method indicated in the AUTH payload.  Note that if the
      initiator decides to include the NO_PPK_AUTH notification, the initiator
      needs to perform authentication data computation twice, which may
      consume computation power (e.g., if digital signatures are involved).<a class="pilcrow" href="#section-3-19">¶</a></p>
<p id="section-3-20">When the responder receives this encrypted exchange, it first computes the values:<a class="pilcrow" href="#section-3-20">¶</a></p>
<div id="section-3-21">
<pre class="sourcecode lang-pseudocode"> SKEYSEED = prf(Ni | Nr, g^ir)
 {SK_d' | SK_ai | SK_ar | SK_ei | SK_er | SK_pi' | SK_pr'}
                 = prf+ (SKEYSEED, Ni | Nr | SPIi | SPIr)
</pre><a class="pilcrow" href="#section-3-21">¶</a>
</div>
<p id="section-3-22">The responder then uses the SK_ei/SK_ai values to decrypt/check the message and then scans through the payloads for the PPK_ID 
      attached to the PPK_IDENTITY notification. If no PPK_IDENTITY notification is found and the peers successfully 
      exchanged USE_PPK notifications in the IKE_SA_INIT exchange, then the
      responder <span class="bcp14">MUST</span> send back an AUTHENTICATION_FAILED 
      notification and then fail the negotiation.<a class="pilcrow" href="#section-3-22">¶</a></p>
<p id="section-3-23">If the PPK_IDENTITY notification contains a PPK_ID that is not known to the responder or is not configured 
      for use for the identity from the IDi payload, then the responder checks whether using PPKs for this initiator is mandatory 
      and whether the initiator included a NO_PPK_AUTH notification in the message. If using PPKs is mandatory or no NO_PPK_AUTH 
      notification is found, then the responder <span class="bcp14">MUST</span> send
      back an AUTHENTICATION_FAILED notification and then fail the negotiation.
   Otherwise (when a PPK is optional and the initiator included a NO_PPK_AUTH notification), the responder <span class="bcp14">MAY</span>
      continue the regular IKEv2 protocol, except that it uses the data from the NO_PPK_AUTH notification as the 
      authentication data (which usually resides in the AUTH payload) for the purpose of the initiator authentication. 
      Note that the authentication method is still indicated in the AUTH payload.<a class="pilcrow" href="#section-3-23">¶</a></p>
<p id="section-3-24"><a class="xref" href="#table1">Table 1</a> summarizes the above logic for the responder:<a class="pilcrow" href="#section-3-24">¶</a></p>
<div id="table1">
<table class="left" id="table-1">
        <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Received USE_PPK</th>
            <th class="text-left" colspan="1" rowspan="1">Received NO_PPK_AUTH</th>
            <th class="text-left" colspan="1" rowspan="1">Configured with PPK</th>
            <th class="text-left" colspan="1" rowspan="1">PPK is Mandatory</th>
            <th class="text-left" colspan="1" rowspan="1">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Standard IKEv2 protocol</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">Standard IKEv2 protocol</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">Abort negotiation</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Abort negotiation</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">Abort negotiation</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">No</td>
            <td class="text-left" colspan="1" rowspan="1">Standard IKEv2 protocol</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Yes</td>
            <td class="text-left" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Use PPK</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-3-26">If a PPK is in use, then the responder extracts the corresponding PPK and computes the following values:<a class="pilcrow" href="#section-3-26">¶</a></p>
<div id="section-3-27">
<pre class="sourcecode lang-pseudocode"> SK_d  = prf+ (PPK, SK_d')
 SK_pi = prf+ (PPK, SK_pi')
 SK_pr = prf+ (PPK, SK_pr')
</pre><a class="pilcrow" href="#section-3-27">¶</a>
</div>
<p id="section-3-28">The responder then continues with the IKE_AUTH exchange (validating the AUTH payload that the initiator included) as usual
      and sends back a response, which includes the PPK_IDENTITY notification with no data to indicate that the PPK is 
      used in the exchange:<a class="pilcrow" href="#section-3-28">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-29">
<pre>Initiator                       Responder
------------------------------------------------------------------
                           &lt;--  HDR, SK {IDr, [CERT,]
                                AUTH, SAr2,
                                TSi, TSr, N(PPK_IDENTITY)}
</pre><a class="pilcrow" href="#section-3-29">¶</a>
</div>
<p id="section-3-30">When the initiator receives the response, it checks for the
   presence of the PPK_IDENTITY notification.  If it receives one, it
   marks the SA as using the configured PPK to generate SK_d, SK_pi, and
   SK_pr (as shown above); the content of the received PPK_IDENTITY (if 
   any) <span class="bcp14">MUST</span> be ignored.  If the initiator does not receive the 
   PPK_IDENTITY, it <span class="bcp14">MUST</span> either fail the IKE SA negotiation sending the 
   AUTHENTICATION_FAILED notification in the INFORMATIONAL exchange (if 
   the PPK was configured as mandatory) or continue without using the 
   PPK (if the PPK was not configured as mandatory and the initiator 
   included the NO_PPK_AUTH notification in the request).<a class="pilcrow" href="#section-3-30">¶</a></p>
<p id="section-3-31">If the Extensible Authentication Protocol (EAP) is used in the IKE_AUTH exchange, then the initiator doesn't
      include the AUTH payload
      in the first request message; however, the responder sends back the AUTH payload in the first reply. 
      The peers then exchange AUTH payloads after EAP is successfully completed.
      As a result, the responder sends the AUTH payload twice -- in the first
      and last IKE_AUTH reply message -- while the initiator sends the AUTH payload only in the last IKE_AUTH request.
      See more details about EAP authentication in IKEv2 in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.16">Section 2.16</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>.<a class="pilcrow" href="#section-3-31">¶</a></p>
<p id="section-3-32">The general rule for using a PPK in the IKE_AUTH exchange, which
      covers the EAP authentication case too, is that the initiator includes a
      PPK_IDENTITY (and optionally a NO_PPK_AUTH) notification in the request
      message containing the AUTH payload. Therefore, in case of EAP, the
      responder always computes the AUTH payload in the first IKE_AUTH reply
      message without using a PPK (by means of SK_pr'), since PPK_ID is not
      yet known to the responder. Once the IKE_AUTH request message containing
      the PPK_IDENTITY notification is received, the responder follows the
      rules described above for the non-EAP authentication case.<a class="pilcrow" href="#section-3-32">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-33">
<pre>   Initiator                         Responder
   ----------------------------------------------------------------
   HDR, SK {IDi, [CERTREQ,]
       [IDr,] SAi2,
       TSi, TSr}  --&gt;
                                &lt;--  HDR, SK {IDr, [CERT,] AUTH,
                                         EAP}
   HDR, SK {EAP}  --&gt;
                                &lt;--  HDR, SK {EAP (success)}
   HDR, SK {AUTH,
       N(PPK_IDENTITY, PPK_ID)
       [, N(NO_PPK_AUTH)]}  --&gt;
                                &lt;--  HDR, SK {AUTH, SAr2, TSi, TSr
                                     [, N(PPK_IDENTITY)]}
</pre><a class="pilcrow" href="#section-3-33">¶</a>
</div>
<p id="section-3-34">Note that the diagram above shows both the cases when the responder
      uses a PPK and when it chooses not to use it (provided the initiator has
      included the NO_PPK_AUTH notification); thus, the responder's
      PPK_IDENTITY notification is marked as optional.  Also, note that the
      IKE_SA_INIT exchange using a PPK is as described above (including
      exchange of the USE_PPK notifications), regardless of whether or not EAP is
      employed in the IKE_AUTH.<a class="pilcrow" href="#section-3-34">¶</a></p>
</section>
</div>
<section id="section-4">
      <h2 id="name-upgrade-procedure">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-upgrade-procedure">Upgrade Procedure</a>
      </h2>
<p id="section-4-1">This algorithm was designed so that someone can introduce PPKs into an existing IKE network
         without causing network disruption.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">In the initial phase of the network upgrade, the network administrator would visit each IKE node and configure:<a class="pilcrow" href="#section-4-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.1">The set of PPKs (and corresponding PPK_IDs) that this node would need to know.<a class="pilcrow" href="#section-4-3.1">¶</a>
</li>
        <li class="normal" id="section-4-3.2">The PPK that will be used for each peer that this node would
 initiate to.<a class="pilcrow" href="#section-4-3.2">¶</a>
</li>
        <li class="normal" id="section-4-3.3">The value "false" for the  mandatory_or_not flag for each peer
 that this node would initiate to (thus indicating that the use of PPKs
 is not mandatory).<a class="pilcrow" href="#section-4-3.3">¶</a>
</li>
      </ul>
<p id="section-4-4">With this configuration, the node will continue to operate with nodes that have not yet been upgraded. 
         This is due to the USE_PPK notification and the NO_PPK_AUTH notification; if the initiator has not been upgraded, it will not send the USE_PPK 
         notification (and so the responder will know that the peers will not use a PPK). If the responder has not been upgraded, it 
         will not send the USE_PPK notification (and so the initiator will know to not use a PPK). If both peers 
         have been upgraded but the responder isn't yet configured with the PPK for the initiator, then the responder
         could continue with the standard IKEv2 protocol if the initiator sent a NO_PPK_AUTH notification.
         If both the responder and initiator have been upgraded and properly configured, they will both realize it, and the Child SAs will be quantum secure.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">As an optional second step, after all nodes have been upgraded, the administrator should then go back through
         the nodes and mark the use of a PPK as mandatory.  This will not affect the strength against a passive attacker, but 
         it would mean that an active attacker with a quantum computer (which is sufficiently fast to be able to break the (EC)DH
         in real time) would not be able to perform a downgrade attack.<a class="pilcrow" href="#section-4-5">¶</a></p>
</section>
<section id="section-5">
      <h2 id="name-ppk">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-ppk">PPK</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-ppk_id-format">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-ppk_id-format">PPK_ID Format</a>
        </h3>
<p id="section-5.1-1">This standard requires that both the initiator and the responder
        have a secret PPK value, with the responder selecting the PPK based on
        the PPK_ID that the initiator sends.  In this standard, both the
        initiator and the responder are configured with fixed PPK and PPK_ID
        values and perform the lookup based on the PPK_ID value.  It is anticipated
        that later specifications will extend this technique to allow
        dynamically changing PPK values.  To facilitate such an extension, we
        specify that the PPK_ID the initiator sends will have its first octet
        be the PPK_ID type value. This document defines two values for the
        PPK_ID type:<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">PPK_ID_OPAQUE (1) - For this type, the format of the PPK_ID (and
          the PPK itself) is not specified by this document; it is assumed to
          be mutually intelligible by both the initiator and the responder.
          This PPK_ID type is intended for those implementations that choose
          not to disclose the type of PPK to active attackers.<a class="pilcrow" href="#section-5.1-2.1">¶</a>
</li>
          <li class="normal" id="section-5.1-2.2">PPK_ID_FIXED (2) - In this case, the format of the PPK_ID and
          the PPK are fixed octet strings; the remaining bytes of the PPK_ID
          are a configured value.  We assume that there is a fixed mapping
          between PPK_ID and PPK, which is configured locally to both the
          initiator and the responder.  The responder can use the PPK_ID to
          look up the corresponding PPK value. Not all implementations are
          able to configure arbitrary octet strings; to improve the potential
          interoperability, it is recommended that, in the PPK_ID_FIXED case,
          both the PPK and the PPK_ID strings be limited to the base64
          character set <span>[<a class="xref" href="#RFC4648">RFC4648</a>]</span>.<a class="pilcrow" href="#section-5.1-2.2">¶</a>
</li>
        </ul>
</section>
<section id="section-5.2">
        <h3 id="name-operational-considerations">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-operational-considerations">Operational Considerations</a>
        </h3>
<p id="section-5.2-1">The need to maintain several independent sets of security credentials can significantly complicate a security administrator's job 
        and can potentially slow down widespread adoption of this specification. It is anticipated that administrators will try to simplify their job 
        by decreasing the number of credentials they need to maintain. This section describes some of the considerations for PPK management.<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<section id="section-5.2.1">
          <h4 id="name-ppk-distribution">
<a class="section-number selfRef" href="#section-5.2.1">5.2.1. </a><a class="section-name selfRef" href="#name-ppk-distribution">PPK Distribution</a>
          </h4>
<p id="section-5.2.1-1">PPK_IDs of the type PPK_ID_FIXED (and the corresponding PPKs) are assumed to be configured within the IKE device in an out-of-band fashion.
   While the method of distribution is a local matter and is out of scope of this document or IKEv2, <span>[<a class="xref" href="#RFC6030">RFC6030</a>]</span> describes a format for the transport and provisioning of symmetric keys. That format
   could be reused using the PIN profile (defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc6030#section-10.2">Section 10.2</a> of [<a class="xref" href="#RFC6030">RFC6030</a>]</span>)
          with the "Id" attribute of the &lt;Key&gt; element being the PPK_ID (without the PPK_ID type octet for a PPK_ID_FIXED) and the &lt;Secret&gt; element containing the PPK.<a class="pilcrow" href="#section-5.2.1-1">¶</a></p>
</section>
<section id="section-5.2.2">
          <h4 id="name-group-ppk">
<a class="section-number selfRef" href="#section-5.2.2">5.2.2. </a><a class="section-name selfRef" href="#name-group-ppk">Group PPK</a>
          </h4>
<p id="section-5.2.2-1">This document doesn't explicitly require that the PPK be unique for each pair of peers. If this is the case, then this solution provides full 
          peer authentication, but it also means that each host must have as many independent PPKs as peers it is going to communicate with. 
          As the number of peers grows, the PPKs will not scale.<a class="pilcrow" href="#section-5.2.2-1">¶</a></p>
<p id="section-5.2.2-2">It is possible to use a single PPK for a group of users.  Since
          each peer uses classical public key cryptography in addition to a
          PPK for key exchange and authentication, members of the group can
          neither impersonate each other nor read each other's traffic unless
          they use quantum computers to break public key operations. However,
          group members can record any traffic they have access to that comes
          from other group members and decrypt it later, when they get access
          to a quantum computer.<a class="pilcrow" href="#section-5.2.2-2">¶</a></p>
<p id="section-5.2.2-3">In addition, the fact that the PPK is known to a (potentially large) group of users makes it more susceptible to theft. 
          When an attacker equipped with a quantum computer gets access to a group PPK, all communications inside the group are revealed.<a class="pilcrow" href="#section-5.2.2-3">¶</a></p>
<p id="section-5.2.2-4">For these reasons, using a group PPK is <span class="bcp14">NOT RECOMMENDED</span>.<a class="pilcrow" href="#section-5.2.2-4">¶</a></p>
</section>
<section id="section-5.2.3">
          <h4 id="name-ppk-only-authentication">
<a class="section-number selfRef" href="#section-5.2.3">5.2.3. </a><a class="section-name selfRef" href="#name-ppk-only-authentication">PPK-Only Authentication</a>
          </h4>
<p id="section-5.2.3-1">If quantum computers become a reality, classical public key cryptography will provide little security, so administrators may find it attractive 
          not to use it at all for authentication. 

This will reduce the number of credentials they need to maintain because they
only need to maintain PPK credentials. Combining group PPK and 
          PPK-only authentication is <span class="bcp14">NOT RECOMMENDED</span> since, in
   this case, any member of the group can impersonate any other member,
   even without the help 
          of quantum computers.<a class="pilcrow" href="#section-5.2.3-1">¶</a></p>
<p id="section-5.2.3-2">PPK-only authentication can be achieved in IKEv2 if the NULL
          Authentication method <span>[<a class="xref" href="#RFC7619">RFC7619</a>]</span> is
          employed. Without PPK, the NULL Authentication method provides no
          authentication of the peers; however, since a PPK is stirred into
          the SK_pi and the SK_pr, the peers become authenticated if a PPK is
          in use. Using PPKs <span class="bcp14">MUST</span> be mandatory for the peers if
          they advertise support for PPKs in IKE_SA_INIT and use NULL
          Authentication. Additionally, since the peers are authenticated via
          PPKs, the ID Type in the IDi/IDr payloads <span class="bcp14">SHOULD NOT</span>
          be ID_NULL, despite using the NULL Authentication method.<a class="pilcrow" href="#section-5.2.3-2">¶</a></p>
</section>
</section>
</section>
<div id="Security">
<section id="section-6">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-6-1">A critical consideration is how to ensure the randomness of this
  post-quantum preshared key. Quantum computers are able to perform Grover's
  algorithm <span>[<a class="xref" href="#GROVER">GROVER</a>]</span>; that effectively halves the size of
      a symmetric key.   In addition, an adversary impersonating the server,
      even with a conventional computer, can perform a dictionary search over
  plausible post-quantum preshared key values. The strongest practice is
  to ensure that any post-quantum preshared key contains at least 256 bits of
  entropy; this will provide 128 bits of post-quantum security, while
  providing security against conventional dictionary attacks.  That provides the security
      equivalent to Category 5 as defined in the NIST Post-Quantum Cryptography
      Call for Proposals <span>[<a class="xref" href="#NISTPQCFP">NISTPQCFP</a>]</span>. Deriving
      a post-quantum preshared key from a password, name, or other low-entropy
      source is not secure because of these known attacks.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">With this protocol, the computed SK_d is a function of the
      PPK. Assuming that the PPK has sufficient entropy (for example, at least
      2<sup>256</sup> possible values), even if an attacker was able to recover the
      rest of the inputs to the PRF function, it would be infeasible to use
      Grover's algorithm with a quantum computer to recover the SK_d value.
      Similarly, all keys that are a function of SK_d, which include all Child
      SA keys and all keys for subsequent IKE SAs (created when the initial
      IKE SA is rekeyed), are also quantum secure (assuming that the PPK was
      of high enough entropy and that all the subkeys are sufficiently long).<a class="pilcrow" href="#section-6-2">¶</a></p>
<p id="section-6-3">An attacker with a quantum computer that can decrypt the initial IKE
      SA has access to all the information exchanged over it, such as
      identities of the peers, configuration parameters, and all negotiated
      IPsec SA information (including traffic selectors), with the exception
      of the cryptographic keys used by the IPsec SAs, which are protected by
      the PPK.<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">Deployments that treat this information as sensitive or that send other sensitive data (like cryptographic keys) 
      over IKE SAs <span class="bcp14">MUST</span> rekey the IKE SA before the sensitive information is sent to ensure this information is protected by the PPK.
      It is possible to create a childless IKE SA as specified in <span>[<a class="xref" href="#RFC6023">RFC6023</a>]</span>. This prevents Child SA 
      configuration information from being transmitted in the original IKE SA that is not protected by a PPK. 
      Some information related to IKE SA that is sent in the IKE_AUTH exchange, such as peer identities, feature notifications, 
      vendor IDs, etc., cannot be hidden from the attack described above, even if the additional IKE SA rekey is performed.<a class="pilcrow" href="#section-6-4">¶</a></p>
<p id="section-6-5">In addition, the policy <span class="bcp14">SHOULD</span> be set to negotiate only quantum-secure  
      symmetric algorithms; while this RFC doesn't claim to give 
      advice as to what algorithms are secure (as that may change 
      based on future cryptographical results), below is a list of defined IKEv2 and 
      IPsec algorithms that should not be used, as they are known to provide less than 128 bits of post-quantum security:<a class="pilcrow" href="#section-6-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-6.1">Any IKEv2 encryption algorithm, PRF, or integrity algorithm with a
 key size less than 256 bits.<a class="pilcrow" href="#section-6-6.1">¶</a>
</li>
        <li class="normal" id="section-6-6.2">Any ESP transform with a key size less than 256 bits.<a class="pilcrow" href="#section-6-6.2">¶</a>
</li>
        <li class="normal" id="section-6-6.3">PRF_AES128_XCBC and PRF_AES128_CBC: even though they can use as
 input a key of arbitrary size, such input keys are converted into a 128-bit key for internal use.<a class="pilcrow" href="#section-6-6.3">¶</a>
</li>
      </ul>
<p id="section-6-7"><a class="xref" href="#Exchanges">Section 3</a> requires the initiator to
      abort the initial exchange if using PPKs is mandatory for it but the
      responder does not include the USE_PPK notification in the response. In
      this situation, when the initiator aborts the negotiation, it leaves a
      half-open IKE SA on the responder (because IKE_SA_INIT completes
      successfully from the responder's point of view). This half-open SA will
      eventually expire and be deleted, but if the initiator continues its
      attempts to create IKE SA with a high enough rate, then the responder may
      consider it a denial-of-service (DoS) attack and take protective
      measures (see <span>[<a class="xref" href="#RFC8019">RFC8019</a>]</span> for more
      details). In this situation, it is <span class="bcp14">RECOMMENDED</span> that the
      initiator cache the negative result of the negotiation and not attempt
      to create it again for some time. This period of time may vary, but it
      is believed that waiting for at least few minutes will not cause the
      responder to treat it as a DoS attack. Note that this situation would
      most likely be a result of misconfiguration, and some reconfiguration of
      the peers would probably be needed.<a class="pilcrow" href="#section-6-7">¶</a></p>
<p id="section-6-8">If using PPKs is optional for both peers and they authenticate themselves using digital signatures, then
      an attacker in between, equipped with a quantum computer capable of breaking public key operations 
      in real time, is able to mount a downgrade attack by removing the USE_PPK notification from the IKE_SA_INIT 
      and forging digital signatures in the subsequent exchange. If using PPKs is mandatory for at least one of the peers
      or if a preshared key mode is used for authentication, then the attack will be detected
      and the SA won't be created.<a class="pilcrow" href="#section-6-8">¶</a></p>
<p id="section-6-9">If using PPKs is mandatory for the initiator, then an attacker able
      to eavesdrop and inject packets into the network can prevent creation of an
      IKE SA by mounting the following attack. The attacker intercepts the
      initial request containing the USE_PPK notification and injects a forged
      response containing no USE_PPK.  If the attacker manages to inject this
      packet before the responder sends a genuine response, then the initiator
      would abort the exchange. To thwart this kind of attack, it is
      <span class="bcp14">RECOMMENDED</span> that, if using PPKs is mandatory for the
      initiator and the received response doesn't contain the USE_PPK
      notification, the initiator not abort the exchange
      immediately. Instead, it waits for more response messages,
      retransmitting the request as if no responses were received at all, until
      either the received message contains the USE_PPK notification or the exchange times
      out (see <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.4">Section 2.4</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span> for more details about retransmission timers in
      IKEv2). If none of the received responses contains USE_PPK, then the
      exchange is aborted.<a class="pilcrow" href="#section-6-9">¶</a></p>
<p id="section-6-10">If using a PPK is optional for both peers, then in case of misconfiguration (e.g., mismatched PPK_ID), the IKE SA
      will be created without protection against quantum computers. It is
      advised that if a PPK was configured but 
      was not used for a particular IKE SA, then implementations <span class="bcp14">SHOULD</span> audit this event.<a class="pilcrow" href="#section-6-10">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-7-1">This document defines three new Notify Message Types in the 
      "IKEv2 Notify Message Types - Status Types" subregistry under the 
      "Internet Key Exchange Version 2 (IKEv2) Parameters" registry                    
      <span>[<a class="xref" href="#IANA-IKEV2">IANA-IKEV2</a>]</span>:<a class="pilcrow" href="#section-7-1">¶</a></p>
<div id="table2">
<table class="center" id="table-2">
        <caption><a class="selfRef" href="#table-2">Table 2</a></caption>
<tbody>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">NOTIFY MESSAGES - STATUS TYPES</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">16435</td>
            <td class="text-left" colspan="1" rowspan="1">USE_PPK</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">16436</td>
            <td class="text-left" colspan="1" rowspan="1">PPK_IDENTITY</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">16437</td>
            <td class="text-left" colspan="1" rowspan="1">NO_PPK_AUTH</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-7-3">Per this document, IANA has created a new subregistry titled "IKEv2
      Post-quantum Preshared Key ID Types" under the "Internet Key Exchange
      Version 2 (IKEv2) Parameters" registry <span>[<a class="xref" href="#IANA-IKEV2">IANA-IKEV2</a>]</span>. This new subregistry is for the PPK_ID types used in
      the PPK_IDENTITY notification defined in this specification. The initial
      contents of the new subregistry are as follows:<a class="pilcrow" href="#section-7-3">¶</a></p>
<div id="table3">
<table class="center" id="table-3">
        <caption><a class="selfRef" href="#table-3">Table 3</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">PPK_ID Type</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">0</td>
            <td class="text-left" colspan="1" rowspan="1">Reserved</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">1</td>
            <td class="text-left" colspan="1" rowspan="1">PPK_ID_OPAQUE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">2</td>
            <td class="text-left" colspan="1" rowspan="1">PPK_ID_FIXED</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">3-127</td>
            <td class="text-left" colspan="1" rowspan="1">Unassigned</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">128-255</td>
            <td class="text-left" colspan="1" rowspan="1">Reserved for Private Use</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 8784</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-7-5">The PPK_ID type value 0 is reserved; values 3-127 are to be assigned
      by IANA; and values 128-255 are for private use among mutually consenting
      parties. To register new PPK_IDs in the Unassigned range, a type name, a
      value between 3 and 127, and a reference specification need to be
      defined. Changes and additions to the Unassigned range of this registry
      are made using the Expert Review policy <span>[<a class="xref" href="#RFC8126">RFC8126</a>]</span>. Changes and additions to the Reserved for Private Use range of
      this registry are made using the Private Use policy <span>[<a class="xref" href="#RFC8126">RFC8126</a>]</span>.<a class="pilcrow" href="#section-7-5">¶</a></p>
</section>
<section id="section-8">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-8.1">8.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span><span class="refAuthor">, Hoffman, P.</span><span class="refAuthor">, Nir, Y.</span><span class="refAuthor">, Eronen, P.</span><span class="refAuthor">, and T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-8.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-8.2">8.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.hoffman-c2pq">[C2PQ]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span>, <span class="refTitle">"The Transition from Classical to Post-Quantum Cryptography"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-hoffman-c2pq-07</span>, <time class="refDate" datetime="2020-05-26">26 May 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-hoffman-c2pq-07">https://tools.ietf.org/html/draft-hoffman-c2pq-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GROVER">[GROVER]</dt>
        <dd>
<span class="refAuthor">Grover, L.</span>, <span class="refTitle">"A Fast Quantum Mechanical Algorithm for Database Search"</span>, <span class="refContent">STOC '96: Proceedings of the Twenty-Eighth Annual ACM Symposium
 on the Theory of Computing, pp. 212-219"</span>, <span class="seriesInfo">DOI 10.1145/237814.237866</span>, <time class="refDate" datetime="1996-07">July 1996</time>, <span>&lt;<a href="https://doi.org/10.1145/237814.237866">https://doi.org/10.1145/237814.237866</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-IKEV2">[IANA-IKEV2]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Internet Key Exchange Version 2 (IKEv2) Parameters"</span>, <span>&lt;<a href="https://www.iana.org/assignments/ikev2-parameters/">https://www.iana.org/assignments/ikev2-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NISTPQCFP">[NISTPQCFP]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Submission Requirements and Evaluation Criteria for the Post-Quantum Cryptography Standardization Process"</span>, <time class="refDate" datetime="2016-12">December 2016</time>, <span>&lt;<a href="https://csrc.nist.gov/CSRC/media/Projects/Post-Quantum-Cryptography/documents/call-for-proposals-final-dec-2016.pdf">https://csrc.nist.gov/CSRC/media/Projects/Post-Quantum-Cryptography/documents/call-for-proposals-final-dec-2016.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2409">[RFC2409]</dt>
        <dd>
<span class="refAuthor">Harkins, D.</span><span class="refAuthor"> and D. Carrel</span>, <span class="refTitle">"The Internet Key Exchange (IKE)"</span>, <span class="seriesInfo">RFC 2409</span>, <span class="seriesInfo">DOI 10.17487/RFC2409</span>, <time class="refDate" datetime="1998-11">November 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2409">https://www.rfc-editor.org/info/rfc2409</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time class="refDate" datetime="2006-10">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6023">[RFC6023]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span><span class="refAuthor">, Tschofenig, H.</span><span class="refAuthor">, Deng, H.</span><span class="refAuthor">, and R. Singh</span>, <span class="refTitle">"A Childless Initiation of the Internet Key Exchange Version 2 (IKEv2) Security Association (SA)"</span>, <span class="seriesInfo">RFC 6023</span>, <span class="seriesInfo">DOI 10.17487/RFC6023</span>, <time class="refDate" datetime="2010-10">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6023">https://www.rfc-editor.org/info/rfc6023</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6030">[RFC6030]</dt>
        <dd>
<span class="refAuthor">Hoyer, P.</span><span class="refAuthor">, Pei, M.</span><span class="refAuthor">, and S. Machani</span>, <span class="refTitle">"Portable Symmetric Key Container (PSKC)"</span>, <span class="seriesInfo">RFC 6030</span>, <span class="seriesInfo">DOI 10.17487/RFC6030</span>, <time class="refDate" datetime="2010-10">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6030">https://www.rfc-editor.org/info/rfc6030</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7619">[RFC7619]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span><span class="refAuthor"> and P. Wouters</span>, <span class="refTitle">"The NULL Authentication Method in the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 7619</span>, <span class="seriesInfo">DOI 10.17487/RFC7619</span>, <time class="refDate" datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7619">https://www.rfc-editor.org/info/rfc7619</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8019">[RFC8019]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span><span class="refAuthor"> and V. Smyslov</span>, <span class="refTitle">"Protecting Internet Key Exchange Protocol Version 2 (IKEv2) Implementations from Distributed Denial-of-Service Attacks"</span>, <span class="seriesInfo">RFC 8019</span>, <span class="seriesInfo">DOI 10.17487/RFC8019</span>, <time class="refDate" datetime="2016-11">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8019">https://www.rfc-editor.org/info/rfc8019</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
      <dd>
<span class="refAuthor">Cotton, M.</span><span class="refAuthor">, Leiba, B.</span><span class="refAuthor">, and T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time class="refDate" datetime="2017-06">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="app-additional">
<section id="section-appendix.a">
      <h2 id="name-discussion-and-rationale">
<a class="section-number selfRef" href="#section-appendix.a">Appendix A. </a><a class="section-name selfRef" href="#name-discussion-and-rationale">Discussion and Rationale</a>
      </h2>
<p id="section-appendix.a-1">The primary goal of this document is to augment the IKEv2 protocol to
      provide protection against
      quantum computers without requiring novel cryptographic algorithms. The idea behind this document is that while a quantum computer can easily
      reconstruct the shared secret of an (EC)DH exchange, it cannot as
      easily recover a secret from a symmetric exchange. This document makes the
      SK_d (and thus also the IPsec KEYMAT and any subsequent IKE SA's SKEYSEED) depend
      on both the symmetric PPK and the Diffie-Hellman exchange.
      If we assume that the attacker knows everything except the
      PPK during the key exchange and there are 2<sup>n</sup> plausible PPKs, then
      a quantum computer (using Grover's algorithm) would take O(2<sup>n/2</sup>)
      time to recover the PPK. So, even if the (EC)DH can be trivially
      solved, the attacker still can't recover any key material
      (except for the SK_ei, SK_er, SK_ai, and SK_ar values for the initial IKE exchange) unless they
      can find the PPK, which is too difficult if the PPK has enough
      entropy (for example, 256 bits).
      Note that we do allow an attacker with a quantum computer to
      rederive the keying material for the initial IKE SA; this was
      a compromise to allow the responder to select the correct PPK quickly.<a class="pilcrow" href="#section-appendix.a-1">¶</a></p>
<p id="section-appendix.a-2">Another goal of this protocol is to minimize the number of changes 
      within the IKEv2 protocol, in particular, within the cryptography 
      of IKEv2.  By limiting our changes to notifications and only adjusting the 
   SK_d, SK_pi, and SK_pr, it is hoped that this would be implementable, even 
   on systems that perform most of the IKEv2 processing in hardware.<a class="pilcrow" href="#section-appendix.a-2">¶</a></p>
<p id="section-appendix.a-3">A third goal is to be friendly to incremental deployment in
      operational networks for which we might not want to have a global
      shared key or for which quantum-secure IKEv2 is rolled out incrementally. This is
      why we specifically try to allow the PPK to be dependent on the peer and
      why we allow the PPK to be configured as optional.<a class="pilcrow" href="#section-appendix.a-3">¶</a></p>
<p id="section-appendix.a-4">A fourth goal is to avoid violating any of the security properties
      provided by IKEv2.<a class="pilcrow" href="#section-appendix.a-4">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="section-appendix.b">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="section-appendix.b-1">We would like to thank <span class="contact-name">Tero Kivinen</span>, <span class="contact-name">Paul Wouters</span>, <span class="contact-name">Graham Bartlett</span>,
      <span class="contact-name">Tommy Pauly</span>, <span class="contact-name">Quynh Dang</span>, and
      the rest of the IPSECME Working Group for their feedback and suggestions
      for the scheme.<a class="pilcrow" href="#section-appendix.b-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.c">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Scott Fluhrer</span></div>
<div class="left" dir="auto"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sfluhrer@cisco.com">sfluhrer@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Panos Kampanakis</span></div>
<div class="left" dir="auto"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:pkampana@cisco.com">pkampana@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">David McGrew</span></div>
<div class="left" dir="auto"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mcgrew@cisco.com">mcgrew@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Valery Smyslov</span></div>
<div class="left" dir="auto"><span class="org">ELVIS-PLUS</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+7%20495%20276%200211">+7 495 276 0211</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:svan@elvis.ru">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>