<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9506: Explicit Host-to-Network Flow Measurements Techniques</title>
<meta content="Mauro Cociglio" name="author"/>
<meta content="Alexandre Ferrieux" name="author"/>
<meta content="Giuseppe Fioccola" name="author"/>
<meta content="Igor Lubashev" name="author"/>
<meta content="Fabio Bulgarella" name="author"/>
<meta content="Massimo Nilo" name="author"/>
<meta content="Isabelle Hamchaoui" name="author"/>
<meta content="Riccardo Sisto" name="author"/>
<meta content="
       This document describes protocol-independent methods called Explicit
Host-to-Network Flow Measurement Techniques that can be applicable to
transport-layer protocols between the client and server. These methods employ just a
few marking bits inside the header of each packet for performance measurements
and require the client and server to collaborate. Both endpoints cooperate by marking
packets and, possibly, mirroring the markings on the round-trip connection. The
techniques are especially valuable when applied to protocols that encrypt
transport headers since they enable loss and delay measurements by passive,
on-path network devices. This document describes several methods that can be
used separately or jointly depending of the availability of marking bits,
desired measurements, and properties of the protocol to which the methods are
applied. 
    " name="description"/>
<meta content="xml2rfc 3.18.2" name="generator"/>
<meta content="Performance" name="keyword"/>
<meta content="Monitoring" name="keyword"/>
<meta content="Passive" name="keyword"/>
<meta content="Hybrid" name="keyword"/>
<meta content="Loss" name="keyword"/>
<meta content="Delay" name="keyword"/>
<meta content="Client" name="keyword"/>
<meta content="Server" name="keyword"/>
<meta content="On-path" name="keyword"/>
<meta content="Observer" name="keyword"/>
<meta content="Probe" name="keyword"/>
<meta content="Alternate" name="keyword"/>
<meta content="Marking" name="keyword"/>
<meta content="Round" name="keyword"/>
<meta content="Trip" name="keyword"/>
<meta content="Latency" name="keyword"/>
<meta content="Encrypted" name="keyword"/>
<meta content="Protocol" name="keyword"/>
<meta content="Bits" name="keyword"/>
<meta content="9506" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9506.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-ippm-explicit-flow-measurements-07" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9506" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9506</td>
<td class="center">Host-to-Network Flow Measurements</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Cociglio, et al.</td>
<td class="center">Informational</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9506">9506</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Informational</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-10">October 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Cociglio</div>
<div class="org">Telecom Italia - TIM</div>
</div>
<div class="author">
      <div class="author-name">A. Ferrieux</div>
<div class="org">Orange Labs</div>
</div>
<div class="author">
      <div class="author-name">G. Fioccola</div>
<div class="org">Huawei Technologies</div>
</div>
<div class="author">
      <div class="author-name">I. Lubashev</div>
<div class="org">Akamai Technologies</div>
</div>
<div class="author">
      <div class="author-name">F. Bulgarella</div>
<div class="org">Telecom Italia - TIM</div>
</div>
<div class="author">
      <div class="author-name">M. Nilo</div>
<div class="org">Telecom Italia - TIM</div>
</div>
<div class="author">
      <div class="author-name">I. Hamchaoui</div>
<div class="org">Orange Labs</div>
</div>
<div class="author">
      <div class="author-name">R. Sisto</div>
<div class="org">Politecnico di Torino</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9506</h1>
<h1 id="title">Explicit Host-to-Network Flow Measurements Techniques</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document describes protocol-independent methods called Explicit
Host-to-Network Flow Measurement Techniques that can be applicable to
transport-layer protocols between the client and server. These methods employ just a
few marking bits inside the header of each packet for performance measurements
and require the client and server to collaborate. Both endpoints cooperate by marking
packets and, possibly, mirroring the markings on the round-trip connection. The
techniques are especially valuable when applied to protocols that encrypt
transport headers since they enable loss and delay measurements by passive,
on-path network devices. This document describes several methods that can be
used separately or jointly depending of the availability of marking bits,
desired measurements, and properties of the protocol to which the methods are
applied.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for informational purposes.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by the
            Internet Engineering Steering Group (IESG).  Not all documents
            approved by the IESG are candidates for any level of Internet
            Standard; see Section 2 of RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9506">https://www.rfc-editor.org/info/rfc9506</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-latency-bits">Latency Bits</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p class="keepWithNext" id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-spin-bit">Spin Bit</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-delay-bit">Delay Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p class="keepWithNext" id="section-toc.1-1.2.2.2.2.1.1"><a class="auto internal xref" href="#section-2.2.1">2.2.1</a>.  <a class="internal xref" href="#name-generation-phase">Generation Phase</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a class="auto internal xref" href="#section-2.2.2">2.2.2</a>.  <a class="internal xref" href="#name-reflection-phase">Reflection Phase</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a class="auto internal xref" href="#section-2.2.3">2.2.3</a>.  <a class="internal xref" href="#name-t_max-selection"><code>T_Max</code> Selection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a class="auto internal xref" href="#section-2.2.4">2.2.4</a>.  <a class="internal xref" href="#name-delay-measurement-using-the">Delay Measurement Using the Delay Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.1">
                        <p id="section-toc.1-1.2.2.2.2.4.2.1.1"><a class="auto internal xref" href="#section-2.2.4.1">2.2.4.1</a>.  <a class="internal xref" href="#name-rtt-measurement">RTT Measurement</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.2">
                        <p id="section-toc.1-1.2.2.2.2.4.2.2.1"><a class="auto internal xref" href="#section-2.2.4.2">2.2.4.2</a>.  <a class="internal xref" href="#name-half-rtt-measurement">Half-RTT Measurement</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.3">
                        <p id="section-toc.1-1.2.2.2.2.4.2.3.1"><a class="auto internal xref" href="#section-2.2.4.3">2.2.4.3</a>.  <a class="internal xref" href="#name-intra-domain-rtt-measuremen">Intra-domain RTT Measurement</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a class="auto internal xref" href="#section-2.2.5">2.2.5</a>.  <a class="internal xref" href="#name-observers-algorithm">Observer's Algorithm</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.6">
                    <p id="section-toc.1-1.2.2.2.2.6.1"><a class="auto internal xref" href="#section-2.2.6">2.2.6</a>.  <a class="internal xref" href="#name-two-bits-delay-measurement-">Two Bits Delay Measurement: Spin Bit + Delay Bit</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-loss-bits">Loss Bits</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-t-bit-round-trip-loss-bit">T Bit -- Round-Trip Loss Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a class="auto internal xref" href="#section-3.1.1">3.1.1</a>.  <a class="internal xref" href="#name-round-trip-loss">Round-Trip Loss</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a class="auto internal xref" href="#section-3.1.2">3.1.2</a>.  <a class="internal xref" href="#name-setting-the-round-trip-loss">Setting the Round-Trip Loss Bit on Outgoing Packets</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a class="auto internal xref" href="#section-3.1.3">3.1.3</a>.  <a class="internal xref" href="#name-observers-logic-for-round-t">Observer's Logic for Round-Trip Loss Signal</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.4">
                    <p id="section-toc.1-1.3.2.1.2.4.1"><a class="auto internal xref" href="#section-3.1.4">3.1.4</a>.  <a class="internal xref" href="#name-loss-coverage-and-signal-ti">Loss Coverage and Signal Timing</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-q-bit-square-bit">Q Bit -- sQuare Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a class="auto internal xref" href="#section-3.2.1">3.2.1</a>.  <a class="internal xref" href="#name-q-block-length-selection">Q Block Length Selection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a class="auto internal xref" href="#section-3.2.2">3.2.2</a>.  <a class="internal xref" href="#name-upstream-loss">Upstream Loss</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a class="auto internal xref" href="#section-3.2.3">3.2.3</a>.  <a class="internal xref" href="#name-identifying-q-block-boundar">Identifying Q Block Boundaries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3.2.1">
                        <p id="section-toc.1-1.3.2.2.2.3.2.1.1"><a class="auto internal xref" href="#section-3.2.3.1">3.2.3.1</a>.  <a class="internal xref" href="#name-improved-resilience-to-burs">Improved Resilience to Burst Losses</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a class="auto internal xref" href="#section-3.3">3.3</a>.  <a class="internal xref" href="#name-l-bit-loss-event-bit">L Bit -- Loss Event Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a class="auto internal xref" href="#section-3.3.1">3.3.1</a>.  <a class="internal xref" href="#name-end-to-end-loss">End-To-End Loss</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1.2.1">
                        <p id="section-toc.1-1.3.2.3.2.1.2.1.1"><a class="auto internal xref" href="#section-3.3.1.1">3.3.1.1</a>.  <a class="internal xref" href="#name-loss-profile-characterizati">Loss Profile Characterization</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a class="auto internal xref" href="#section-3.3.2">3.3.2</a>.  <a class="internal xref" href="#name-lq-bits-loss-measurement-us">L+Q Bits -- Loss Measurement Using L and Q Bits</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2.2.1">
                        <p id="section-toc.1-1.3.2.3.2.2.2.1.1"><a class="auto internal xref" href="#section-3.3.2.1">3.3.2.1</a>.  <a class="internal xref" href="#name-correlating-end-to-end-and-">Correlating End-to-End and Upstream Loss</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2.2.2">
                        <p id="section-toc.1-1.3.2.3.2.2.2.2.1"><a class="auto internal xref" href="#section-3.3.2.2">3.3.2.2</a>.  <a class="internal xref" href="#name-downstream-loss">Downstream Loss</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2.2.3">
                        <p id="section-toc.1-1.3.2.3.2.2.2.3.1"><a class="auto internal xref" href="#section-3.3.2.3">3.3.2.3</a>.  <a class="internal xref" href="#name-observer-loss">Observer Loss</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a class="auto internal xref" href="#section-3.4">3.4</a>.  <a class="internal xref" href="#name-r-bit-reflection-square-bit">R Bit -- Reflection Square Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a class="auto internal xref" href="#section-3.4.1">3.4.1</a>.  <a class="internal xref" href="#name-enhancement-of-reflection-b">Enhancement of Reflection Block Length Computation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a class="auto internal xref" href="#section-3.4.2">3.4.2</a>.  <a class="internal xref" href="#name-improved-resilience-to-pack">Improved Resilience to Packet Reordering</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.2.2.1">
                        <p id="section-toc.1-1.3.2.4.2.2.2.1.1"><a class="auto internal xref" href="#section-3.4.2.1">3.4.2.1</a>.  <a class="internal xref" href="#name-improved-resilience-to-burst">Improved Resilience to Burst Losses</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3">
                    <p id="section-toc.1-1.3.2.4.2.3.1"><a class="auto internal xref" href="#section-3.4.3">3.4.3</a>.  <a class="internal xref" href="#name-rq-bits-loss-measurement-us">R+Q Bits -- Loss Measurement Using R and Q Bits</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3.2.1">
                        <p id="section-toc.1-1.3.2.4.2.3.2.1.1"><a class="auto internal xref" href="#section-3.4.3.1">3.4.3.1</a>.  <a class="internal xref" href="#name-three-quarters-connection-l">Three-Quarters Connection Loss</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3.2.2">
                        <p id="section-toc.1-1.3.2.4.2.3.2.2.1"><a class="auto internal xref" href="#section-3.4.3.2">3.4.3.2</a>.  <a class="internal xref" href="#name-end-to-end-loss-in-the-oppo">End-To-End Loss in the Opposite Direction</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3.2.3">
                        <p id="section-toc.1-1.3.2.4.2.3.2.3.1"><a class="auto internal xref" href="#section-3.4.3.3">3.4.3.3</a>.  <a class="internal xref" href="#name-half-round-trip-loss">Half Round-Trip Loss</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.3.2.4">
                        <p id="section-toc.1-1.3.2.4.2.3.2.4.1"><a class="auto internal xref" href="#section-3.4.3.4">3.4.3.4</a>.  <a class="internal xref" href="#name-downstream-loss-2">Downstream Loss</a></p>
</li>
                    </ul>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a class="auto internal xref" href="#section-3.5">3.5</a>.  <a class="internal xref" href="#name-e-bit-ecn-echo-event-bit">E Bit -- ECN-Echo Event Bit</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5.2.1">
                    <p id="section-toc.1-1.3.2.5.2.1.1"><a class="auto internal xref" href="#section-3.5.1">3.5.1</a>.  <a class="internal xref" href="#name-setting-the-ecn-echo-event-">Setting the ECN-Echo Event Bit on Outgoing Packets</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5.2.2">
                    <p id="section-toc.1-1.3.2.5.2.2.1"><a class="auto internal xref" href="#section-3.5.2">3.5.2</a>.  <a class="internal xref" href="#name-using-e-bit-for-passive-ecn">Using E Bit for Passive ECN-Reported Congestion Measurement</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5.2.3">
                    <p id="section-toc.1-1.3.2.5.2.3.1"><a class="auto internal xref" href="#section-3.5.3">3.5.3</a>.  <a class="internal xref" href="#name-multiple-e-bits">Multiple E Bits</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-summary-of-delay-and-loss-m">Summary of Delay and Loss Marking Methods</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-implementation-consideratio">Implementation Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-examples-of-application">Examples of Application</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-protocol-ossification-consi">Protocol Ossification Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-optimistic-ack-attack">Optimistic ACK Attack</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="auto internal xref" href="#section-7.2">7.2</a>.  <a class="internal xref" href="#name-delay-bit-with-rtt-obfuscat">Delay Bit with RTT Obfuscation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-privacy-considerations">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#section-10.1">10.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#section-10.2">10.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-contributors">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">Packet loss and delay are hard and pervasive problems of day-to-day network
operation. Proactively detecting, measuring, and locating them is crucial to
maintaining high QoS and timely resolution of end-to-end throughput issues.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">Detecting and measuring packet loss and delay allows network operators to
independently confirm trouble reports and, ideally, be proactively notified of
developing problems on the network. Locating the cause of packet loss or
excessive delay is the first step to resolving problems and restoring QoS.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">Network operators wishing to perform quantitative measurement of
packet loss and delay have been heavily relying on information present in the
clear in transport-layer headers (e.g., TCP sequence and acknowledgment
numbers). By passively observing a network path at multiple points within one's
network, operators have been able to either quickly locate the source the
problem within their network or reliably attribute it to an upstream or
downstream network.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">With encrypted protocols, the transport-layer headers are encrypted and passive
packet loss and delay observations are not possible, as also noted in
<span>[<a class="cite xref" href="#RFC9065">TRANSPORT-ENCRYPT</a>]</span>. Nevertheless, accurate measurement of packet loss and
delay experienced by encrypted transport-layer protocols is highly desired,
especially by network operators who own or control the infrastructure between the
client and server.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">The measurement of loss and delay experienced by connections using an encrypted
protocol cannot be based on a measurement of loss and delay experienced by
connections between the same or similar endpoints that use an unencrypted
protocol because different protocols may utilize the network differently and be
routed differently by the network. Therefore, it is necessary to directly
measure the packet loss and delay experienced by users of encrypted protocols.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">The Alternate-Marking method <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span> defines a consolidated method to
perform packet loss, delay, and jitter measurements on live traffic. However,
as mentioned in <span>[<a class="cite xref" href="#RFC9343">IPv6AltMark</a>]</span>, <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span> mainly applies to a network-layer-controlled 
domain managed with a Network Management System (NMS), where the Customer Premises Equipment (CPE)
or the Provider Edge (PE) routers are the starting or the ending nodes. <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span> provides
measurement within a controlled domain in which the packets are
marked. Therefore, applying <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span> to end-to-end transport-layer
connections is not easy because packet identification and marking by network
nodes is prevented when encrypted transport-layer headers (e.g., QUIC, TCP with
TLS) are being used.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">This document defines Explicit Host-to-Network Flow Measurement Techniques that
are specifically designed for encrypted transport protocols. According to the
definitions of <span>[<a class="cite xref" href="#RFC7799">IPPM-METHODS</a>]</span>, these measurement methods can be classified as
Hybrid. They are to be embedded into a transport-layer protocol and are
explicitly intended for exposing delay and loss rate information to on-path
measurement devices. Unlike <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span>, most of these methods require
collaborative endpoint nodes. Since these measurement techniques make performance
information directly visible to the path, they do not rely on an external NMS.<a class="pilcrow" href="#section-1-7">¶</a></p>
<p id="section-1-8">The Explicit Host-to-Network Flow Measurement Techniques described in this
document are applicable to any transport-layer protocol connecting a client and a
server. In this document, the client and the server are also referred to as the
endpoints of the transport-layer protocol.<a class="pilcrow" href="#section-1-8">¶</a></p>
<p id="section-1-9">The different methods described in this document can be used alone or in
combination. Each technique uses few bits and exposes a specific measurement.
It is assumed that the endpoints are collaborative in the sense of the
measurements, indeed both the client and server need to cooperate.<a class="pilcrow" href="#section-1-9">¶</a></p>
<p id="section-1-10">Following the recommendation in <span>[<a class="cite xref" href="#RFC8558">RFC8558</a>]</span> of making path signals explicit,
this document proposes adding some dedicated measurement bits to the clear
portion of the transport protocol headers. These bits can be added to an
unencrypted portion of a transport-layer header, e.g., UDP surplus space (see
<span>[<a class="cite xref" href="#I-D.ietf-tsvwg-udp-options">UDP-OPTIONS</a>]</span> and <span>[<a class="cite xref" href="#I-D.herbert-udp-space-hdr">UDP-SURPLUS</a>]</span>) or reserved bits in a QUIC v1 header, as
already done with the latency Spin bit (see 
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-17.4">Section 17.4</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>). Note that this document does not recommend the use of any
specific bits, as these would need to be chosen by the specific protocol
implementations (see <a class="auto internal xref" href="#applications">Section 5</a>).<a class="pilcrow" href="#section-1-10">¶</a></p>
<p id="section-1-11">The Spin bit, Delay bit, and loss bits explained in this document are inspired by
<span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span>, <span>[<a class="cite xref" href="#RFC9312">QUIC-MANAGEABILITY</a>]</span>, <span>[<a class="cite xref" href="#I-D.trammell-quic-spin">QUIC-SPIN</a>]</span>, <span>[<a class="cite xref" href="#I-D.trammell-tsvwg-spin">TSVWG-SPIN</a>]</span>,
and <span>[<a class="cite xref" href="#I-D.trammell-ippm-spin">IPPM-SPIN</a>]</span>.<a class="pilcrow" href="#section-1-11">¶</a></p>
<p id="section-1-12">Additional details about the performance measurements for QUIC are described in
the paper <span>[<a class="cite xref" href="#ANRW19-PM-QUIC">ANRW19-PM-QUIC</a>]</span>.<a class="pilcrow" href="#section-1-12">¶</a></p>
</section>
</div>
<div id="latency-bits">
<section id="section-2">
      <h2 id="name-latency-bits">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-latency-bits">Latency Bits</a>
      </h2>
<p id="section-2-1">This section introduces bits that can be used for round-trip latency
measurements.  Whenever this section of the specification refers to packets, it
is referring only to packets with protocol headers that include the latency
bits.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">In <span>[<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>], <a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-17.4">Section 17.4</a></span> introduces an explicit, per-flow
transport-layer signal for hybrid measurement of RTT.  This signal consists of a
Spin bit that toggles once per RTT. <span><a class="relref" href="https://datatracker.ietf.org/doc/html/draft-trammell-quic-spin-03#section-4">Section 4</a> of [<a class="cite xref" href="#I-D.trammell-quic-spin">QUIC-SPIN</a>]</span> discusses an
additional two-bit Valid Edge Counter (VEC) to compensate for loss and
reordering of the Spin bit and to increase fidelity of the signal in less than
ideal network conditions.<a class="pilcrow" href="#section-2-2">¶</a></p>
<p id="section-2-3">This document introduces a standalone single-bit delay signal that can be used
by passive observers to measure the RTT of a network flow, avoiding the Spin bit
ambiguities that arise as soon as network conditions deteriorate.<a class="pilcrow" href="#section-2-3">¶</a></p>
<div id="spinbit">
<section id="section-2.1">
        <h3 id="name-spin-bit">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-spin-bit">Spin Bit</a>
        </h3>
<p id="section-2.1-1">This section is a small recap of the Spin bit working mechanism. For a
comprehensive explanation of the algorithm, see 
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9312#section-3.8.2">Section 3.8.2</a> of [<a class="cite xref" href="#RFC9312">QUIC-MANAGEABILITY</a>]</span>.<a class="pilcrow" href="#section-2.1-1">¶</a></p>
<p id="section-2.1-2">The Spin bit is a signal generated by Alternate-Marking <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span>, where the
size of the alternation changes with the flight size each RTT.<a class="pilcrow" href="#section-2.1-2">¶</a></p>
<p id="section-2.1-3">The latency Spin bit is a single-bit signal that toggles once per RTT,
enabling latency monitoring of a connection-oriented communication
from intermediate observation points.<a class="pilcrow" href="#section-2.1-3">¶</a></p>
<p id="section-2.1-4">A "Spin bit period" is a set of packets with the same Spin bit value sent during one
RTT time interval. A "Spin bit period value" is the value of the Spin bit shared by
all packets in a Spin bit period.<a class="pilcrow" href="#section-2.1-4">¶</a></p>
<p id="section-2.1-5">The client and server maintain an internal per-connection spin value (i.e., 0 or
1) used to set the Spin bit on outgoing packets. Both endpoints initialize the
spin value to 0 when a new connection starts. Then:<a class="pilcrow" href="#section-2.1-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-6.1">when the client receives a packet with the packet number larger than any
 number seen so far, it sets the connection spin value to the opposite value
 contained in the received packet; and<a class="pilcrow" href="#section-2.1-6.1">¶</a>
</li>
          <li class="normal" id="section-2.1-6.2">when the server receives a packet with the packet number larger than any
 number seen so far, it sets the connection spin value to the same value
 contained in the received packet.<a class="pilcrow" href="#section-2.1-6.2">¶</a>
</li>
        </ul>
<p id="section-2.1-7">The computed spin value is used by the endpoints for setting the Spin
bit on outgoing packets.  This mechanism allows the endpoints
to generate a square wave such that, by measuring the distance in time
between pairs of consecutive edges observed in the same direction, a
passive on-path observer can compute the round-trip network delay of that
network flow.<a class="pilcrow" href="#section-2.1-7">¶</a></p>
<p id="section-2.1-8">Spin bit enables round-trip latency measurement by observing a single direction
of the traffic flow.<a class="pilcrow" href="#section-2.1-8">¶</a></p>
<p id="section-2.1-9">Note that packet reordering can cause spurious edges that require heuristics to
correct. The Spin bit performance deteriorates as soon as network impairments
arise as explained in <a class="auto internal xref" href="#delaybit">Section 2.2</a>.<a class="pilcrow" href="#section-2.1-9">¶</a></p>
</section>
</div>
<div id="delaybit">
<section id="section-2.2">
        <h3 id="name-delay-bit">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-delay-bit">Delay Bit</a>
        </h3>
<p id="section-2.2-1">The Delay bit has been designed to overcome accuracy limitations experienced by
the Spin bit under difficult network conditions:<a class="pilcrow" href="#section-2.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-2.1">packet reordering leads to generation of spurious edges and errors in delay
estimation;<a class="pilcrow" href="#section-2.2-2.1">¶</a>
</li>
          <li class="normal" id="section-2.2-2.2">loss of edges causes wrong estimation of Spin bit periods and therefore wrong RTT
measurements; and<a class="pilcrow" href="#section-2.2-2.2">¶</a>
</li>
          <li class="normal" id="section-2.2-2.3">application-limited senders cause the Spin bit to measure the application
delays instead of network delays.<a class="pilcrow" href="#section-2.2-2.3">¶</a>
</li>
        </ul>
<p id="section-2.2-3">Unlike the Spin bit, which is set in every packet transmitted on the network,
the Delay bit is set only once per round trip.<a class="pilcrow" href="#section-2.2-3">¶</a></p>
<p id="section-2.2-4">When the Delay bit is used, a single packet with a marked bit (the Delay bit)
bounces between a client and a server during the entire connection lifetime.
This single packet is called the "delay sample".<a class="pilcrow" href="#section-2.2-4">¶</a></p>
<p id="section-2.2-5">An observer placed at an intermediate point, observing a single direction of
traffic and tracking the delay sample and the relative timestamp, can measure the
round-trip delay of the connection.<a class="pilcrow" href="#section-2.2-5">¶</a></p>
<p id="section-2.2-6">The delay sample lifetime comprises two phases: initialization and reflection.
The initialization is the generation of the delay sample, while the
reflection realizes the bounce behavior of this single packet between the two
endpoints.<a class="pilcrow" href="#section-2.2-6">¶</a></p>
<p id="section-2.2-7">The next figure describes the elementary Delay bit mechanism.<a class="pilcrow" href="#section-2.2-7">¶</a></p>
<span id="name-delay-bit-mechanism"></span><figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.2-8.1">
<pre>              +--------+   -   -   -   -   -   +--------+
              |        |      -----------&gt;     |        |
              | Client |                       | Server |
              |        |     &lt;-----------      |        |
              +--------+   -   -   -   -   -   +--------+

              (a) No traffic at beginning.

              +--------+   0   0   1   -   -   +--------+
              |        |      -----------&gt;     |        |
              | Client |                       | Server |
              |        |     &lt;-----------      |        |
              +--------+   -   -   -   -   -   +--------+

              (b) The Client starts sending data and sets
                  the first packet as the delay sample.

              +--------+   0   0   0   0   0   +--------+
              |        |      -----------&gt;     |        |
              | Client |                       | Server |
              |        |     &lt;-----------      |        |
              +--------+   -   -   -   1   0   +--------+

              (c) The Server starts sending data
                  and reflects the delay sample.

              +--------+   0   1   0   0   0   +--------+
              |        |      -----------&gt;     |        |
              | Client |                       | Server |
              |        |     &lt;-----------      |        |
              +--------+   0   0   0   0   0   +--------+

              (d) The Client reflects the delay sample.

              +--------+   0   0   0   0   0   +--------+
              |        |      -----------&gt;     |        |
              | Client |                       | Server |
              |        |     &lt;-----------      |        |
              +--------+   0   0   0   1   0   +--------+

              (e) The Server reflects the delay sample
                  and so on.
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-delay-bit-mechanism">Delay Bit Mechanism</a>
          </figcaption></figure>
<div id="generation-phase">
<section id="section-2.2.1">
          <h4 id="name-generation-phase">
<a class="section-number selfRef" href="#section-2.2.1">2.2.1. </a><a class="section-name selfRef" href="#name-generation-phase">Generation Phase</a>
          </h4>
<p id="section-2.2.1-1">Only the client is actively involved in the Generation Phase. It maintains an
internal per-flow timestamp variable (<code>ds_time</code>) updated every time a delay
sample is transmitted.<a class="pilcrow" href="#section-2.2.1-1">¶</a></p>
<p id="section-2.2.1-2">When connection starts, the client generates a new delay sample initializing the
Delay bit of the first outgoing packet to 1.  Then it updates the <code>ds_time</code>
variable with the timestamp of its transmission.<a class="pilcrow" href="#section-2.2.1-2">¶</a></p>
<p id="section-2.2.1-3">The server initializes the Delay bit to 0 at the beginning of the connection,
and its only task during the connection is described in <a class="auto internal xref" href="#reflection-phase">Section 2.2.2</a>.<a class="pilcrow" href="#section-2.2.1-3">¶</a></p>
<p id="section-2.2.1-4">In absence of network impairments, the delay sample should bounce between the client
and server continuously for the entire duration of the connection.  However, that is
highly unlikely for two reasons:<a class="pilcrow" href="#section-2.2.1-4">¶</a></p>
<ol class="normal type-1" id="section-2.2.1-5" start="1" type="1">
<li id="section-2.2.1-5.1">The packet carrying the Delay bit might be lost.<a class="pilcrow" href="#section-2.2.1-5.1">¶</a>
</li>
            <li id="section-2.2.1-5.2">An endpoint could stop or delay sending packets because the application is
limiting the amount of traffic transmitted.<a class="pilcrow" href="#section-2.2.1-5.2">¶</a>
</li>
          </ol>
<p id="section-2.2.1-6">To deal with these problems, the client generates a new delay sample if more
than a predetermined time (<code>T_Max</code>) has elapsed since the last delay sample
transmission (including reflections). Note that <code>T_Max</code> should be greater than
the max measurable RTT on the network. See <a class="auto internal xref" href="#tmax-selection">Section 2.2.3</a> for details.<a class="pilcrow" href="#section-2.2.1-6">¶</a></p>
</section>
</div>
<div id="reflection-phase">
<section id="section-2.2.2">
          <h4 id="name-reflection-phase">
<a class="section-number selfRef" href="#section-2.2.2">2.2.2. </a><a class="section-name selfRef" href="#name-reflection-phase">Reflection Phase</a>
          </h4>
<p id="section-2.2.2-1">Reflection is the process that enables the bouncing of the delay sample between
a client and a server.  The behavior of the two endpoints is almost the same.<a class="pilcrow" href="#section-2.2.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-2.1">Server-side reflection: When a delay sample arrives, the server marks the
first packet in the opposite direction as the delay sample.<a class="pilcrow" href="#section-2.2.2-2.1">¶</a>
</li>
            <li class="normal" id="section-2.2.2-2.2">Client-side reflection: When a delay sample arrives, the client marks the
first packet in the opposite direction as the delay sample. It also updates
the <code>ds_time</code> variable when the outgoing delay sample is actually forwarded.<a class="pilcrow" href="#section-2.2.2-2.2">¶</a>
</li>
          </ul>
<p id="section-2.2.2-3">In both cases, if the outgoing delay sample is being transmitted with a delay
greater than a predetermined threshold after the reception of the incoming delay
sample (1 ms by default), the delay sample is not reflected, and the outgoing
Delay bit is kept at 0.<a class="pilcrow" href="#section-2.2.2-3">¶</a></p>
<p id="section-2.2.2-4">By doing so, the algorithm can reject measurements that would overestimate the
delay due to lack of traffic at the endpoints.  Hence, the maximum estimation
error would amount to twice the threshold (e.g., 2 ms) per measurement.<a class="pilcrow" href="#section-2.2.2-4">¶</a></p>
</section>
</div>
<div id="tmax-selection">
<section id="section-2.2.3">
          <h4 id="name-t_max-selection">
<a class="section-number selfRef" href="#section-2.2.3">2.2.3. </a><a class="section-name selfRef" href="#name-t_max-selection"><code>T_Max</code> Selection</a>
          </h4>
<p id="section-2.2.3-1">The internal <code>ds_time</code> variable allows a client to identify delay sample losses.
Considering that a lost delay sample is regenerated at the end of an explicit
time (<code>T_Max</code>) since the last generation, this same value can be used by an
observer to reject a measure and start a new one.<a class="pilcrow" href="#section-2.2.3-1">¶</a></p>
<p id="section-2.2.3-2">In other words, if the difference in time between two delay samples is greater
or equal than <code>T_Max</code>, then these cannot be used to produce a delay measure.
Therefore, the value of <code>T_Max</code> must also be known to the on-path network probes.<a class="pilcrow" href="#section-2.2.3-2">¶</a></p>
<p id="section-2.2.3-3">There are two alternatives to selecting the <code>T_Max</code> value so that both the client and
observers know it. The first one requires that <code>T_Max</code> is known a priori
(<code>T_Max_p</code>) and therefore set within the protocol specifications that implements
the marking mechanism (e.g., 1 second, which usually is greater than the max
expected RTT). The second alternative requires a dynamic mechanism able to
adapt the duration of the <code>T_Max</code> to the delay of the connection (<code>T_Max_c</code>).<a class="pilcrow" href="#section-2.2.3-3">¶</a></p>
<p id="section-2.2.3-4">For instance, the client and observers could use the connection RTT as a basis for
calculating an effective <code>T_Max</code>. They should use a predetermined initial value
so that <code>T_Max = T_Max_p</code> (e.g., 1 second) and then, when a valid RTT is
measured, change <code>T_Max</code> accordingly so that <code>T_Max = T_Max_c</code>. In any case, the
selected <code>T_Max</code> should be large enough to absorb any possible variations in the
connection delay. This also helps to prevent the mechanism from failing when the
observer cannot recognize sudden changes in RTT exceeding <code>T_Max</code>.<a class="pilcrow" href="#section-2.2.3-4">¶</a></p>
<p id="section-2.2.3-5"><code>T_Max_c</code> could be computed as two times the measured <code>RTT</code> plus a fixed amount
of time (100 ms) to prevent low <code>T_Max</code> values in the case of very small RTTs.
The resulting formula is: <code>T_Max_c = 2RTT + 100 ms</code>. If <code>T_Max_c</code> is greater than
<code>T_Max_p</code>, then <code>T_Max_c</code> is forced to the <code>T_Max_p</code> value.
Note that the value of 100 ms is provided as an example, and it may be chosen
differently depending on the specific scenarios. For instance, an implementer may
consider using existing protocol-specific values if appropriate.<a class="pilcrow" href="#section-2.2.3-5">¶</a></p>
<p id="section-2.2.3-6">Note that the observer's <code>T_Max</code> should always be less than or equal to the
client's <code>T_Max</code> to avoid considering as a valid measurement what is actually
the client's <code>T_Max</code>. To obtain this result, the client waits for two
consecutive incoming samples and computes the two related RTTs. Then it takes
the largest of them as the basis of the <code>T_Max_c</code> formula. At this point,
observers have already measured a valid RTT and then computed their <code>T_Max_c</code>.<a class="pilcrow" href="#section-2.2.3-6">¶</a></p>
</section>
</div>
<div id="delay-measurement-using-delay-bit">
<section id="section-2.2.4">
          <h4 id="name-delay-measurement-using-the">
<a class="section-number selfRef" href="#section-2.2.4">2.2.4. </a><a class="section-name selfRef" href="#name-delay-measurement-using-the">Delay Measurement Using the Delay Bit</a>
          </h4>
<p id="section-2.2.4-1">When the Delay bit is used, a passive observer can use delay samples directly
and avoid inherent ambiguities in the calculation of the RTT as can be seen in
Spin bit analysis.<a class="pilcrow" href="#section-2.2.4-1">¶</a></p>
<div id="rtt-measurement">
<section id="section-2.2.4.1">
            <h5 id="name-rtt-measurement">
<a class="section-number selfRef" href="#section-2.2.4.1">2.2.4.1. </a><a class="section-name selfRef" href="#name-rtt-measurement">RTT Measurement</a>
            </h5>
<p id="section-2.2.4.1-1">The delay sample generation process ensures that only one packet marked with the
Delay bit set to 1 runs back and forth between two endpoints per round-trip
time.  To determine the RTT measurement of a flow, an on-path passive observer
computes the time difference between two delay samples observed in a single
direction.<a class="pilcrow" href="#section-2.2.4.1-1">¶</a></p>
<p id="section-2.2.4.1-2">To ensure a valid measurement, the observer must verify that the distance in
time between the two samples taken into account is less than <code>T_Max</code>.<a class="pilcrow" href="#section-2.2.4.1-2">¶</a></p>
<span id="name-round-trip-time-both-direct"></span><figure id="figure-2">
              <div class="alignLeft art-text artwork" id="section-2.2.4.1-3.1">
<pre>           =======================|======================&gt;
           = **********     -----Obs----&gt;     ********** =
           = * Client *                       * Server * =
           = **********     &lt;------------     ********** =
           &lt;==============================================

                     (a) client-server RTT

           ==============================================&gt;
           = **********     ------------&gt;     ********** =
           = * Client *                       * Server * =
           = **********     &lt;----Obs-----     ********** =
           &lt;======================|=======================

                     (b) server-client RTT
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-round-trip-time-both-direct">Round-Trip Time (Both Directions)</a>
              </figcaption></figure>
</section>
</div>
<div id="half-rtt-measurement">
<section id="section-2.2.4.2">
            <h5 id="name-half-rtt-measurement">
<a class="section-number selfRef" href="#section-2.2.4.2">2.2.4.2. </a><a class="section-name selfRef" href="#name-half-rtt-measurement">Half-RTT Measurement</a>
            </h5>
<p id="section-2.2.4.2-1">An observer that is able to observe both forward and return traffic directions
can use the delay samples to measure "upstream" and "downstream" RTT components,
also known as the half-RTT measurements. It does this by measuring the time
between a delay sample observed in one direction and the delay sample previously
observed in the opposite direction.<a class="pilcrow" href="#section-2.2.4.2-1">¶</a></p>
<p id="section-2.2.4.2-2">As with RTT measurement, the observer must verify that the distance in time
between the two samples taken into account is less than <code>T_Max</code>.<a class="pilcrow" href="#section-2.2.4.2-2">¶</a></p>
<p id="section-2.2.4.2-3">Note that upstream and downstream sections of paths between the endpoints and
the observer (i.e., observer-to-client vs. client-to-observer and
observer-to-server vs. server-to-observer) may have different delay
characteristics due to the difference in network congestion and other factors.<a class="pilcrow" href="#section-2.2.4.2-3">¶</a></p>
<span id="name-half-round-trip-time-both-d"></span><figure id="figure-3">
              <div class="alignLeft art-text artwork" id="section-2.2.4.2-4.1">
<pre>           =======================&gt;
           = **********     ------|-----&gt;     **********
           = * Client *          Obs          * Server *
           = **********     &lt;-----|------     **********
           &lt;=======================

                  (a) client-observer half-RTT

                                  =======================&gt;
             **********     ------|-----&gt;     ********** =
             * Client *          Obs          * Server * =
             **********     &lt;-----|------     ********** =
                                  &lt;=======================

                  (b) observer-server half-RTT
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-half-round-trip-time-both-d">Half Round-Trip Time (Both Directions)</a>
              </figcaption></figure>
</section>
</div>
<div id="intra-domain-rtt-measurement">
<section id="section-2.2.4.3">
            <h5 id="name-intra-domain-rtt-measuremen">
<a class="section-number selfRef" href="#section-2.2.4.3">2.2.4.3. </a><a class="section-name selfRef" href="#name-intra-domain-rtt-measuremen">Intra-domain RTT Measurement</a>
            </h5>
<p id="section-2.2.4.3-1">Intra-domain RTT is the portion of the entire RTT used by a flow to traverse the
network of a provider.  To measure intra-domain RTT, two observers capable of
observing traffic in both directions must be employed simultaneously at the ingress
and egress of the network to be measured.  Intra-domain RTT is the difference
between the two computed upstream (or downstream) RTT components.<a class="pilcrow" href="#section-2.2.4.3-1">¶</a></p>
<span id="name-intra-domain-round-trip-tim"></span><figure id="figure-4">
              <div class="alignLeft art-text artwork" id="section-2.2.4.3-2.1">
<pre>        =========================================&gt;
        = =====================&gt;
        = = **********      ---|--&gt;           ---|--&gt;      **********
        = = * Client *         Obs               Obs       * Server *
        = = **********      &lt;--|---           &lt;--|---      **********
        = &lt;=====================
        &lt;=========================================

                 (a) client-observer RTT components (half-RTTs)

                               ==================&gt;
            **********      ---|--&gt;           ---|--&gt;      **********
            * Client *         Obs               Obs       * Server *
            **********      &lt;--|---           &lt;--|---      **********
                               &lt;==================

                 (b) the intra-domain RTT resulting from the
                     subtraction of the above RTT components
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-intra-domain-round-trip-tim">Intra-domain Round-Trip Time (Client-Observer: Upstream)</a>
              </figcaption></figure>
</section>
</div>
</section>
</div>
<div id="observers-algorithm">
<section id="section-2.2.5">
          <h4 id="name-observers-algorithm">
<a class="section-number selfRef" href="#section-2.2.5">2.2.5. </a><a class="section-name selfRef" href="#name-observers-algorithm">Observer's Algorithm</a>
          </h4>
<p id="section-2.2.5-1">An on-path observer maintains an internal per-flow variable to keep track of
the time at which the last delay sample has been observed. The flow characterization
should be part of the protocol.<a class="pilcrow" href="#section-2.2.5-1">¶</a></p>
<p id="section-2.2.5-2">If the observer is unidirectional or in case of asymmetric routing, then upon detecting a
delay sample:<a class="pilcrow" href="#section-2.2.5-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.5-3.1">if a delay sample was also detected previously in the same direction and the
distance in time between them is less than <code>T_Max - K</code>, then the two delay
samples can be used to calculate RTT measurement. <code>K</code> is a protection
threshold to absorb differences in <code>T_Max</code> computation and delay variations
between two consecutive delay samples (e.g., <code>K = 10% T_Max</code>).<a class="pilcrow" href="#section-2.2.5-3.1">¶</a>
</li>
          </ul>
<p id="section-2.2.5-4">If the observer can observe both forward and return traffic flows, and it is
able to determine which direction contains the client and the server (e.g., by
observing the connection handshake), then upon detecting a delay sample:<a class="pilcrow" href="#section-2.2.5-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.5-5.1">if a delay sample was also detected in the opposite direction and the distance
in time between them is less than <code>T_Max - K</code>, then the two delay samples can
be used to measure the observer-client half-RTT or the observer-server
half-RTT, according to the direction of the last delay sample observed.<a class="pilcrow" href="#section-2.2.5-5.1">¶</a>
</li>
          </ul>
<p id="section-2.2.5-6">Note that the accuracy can be influenced by what the observer is capable of
observing. Additionally, the type of measurement differs, as described in the
previous sections.<a class="pilcrow" href="#section-2.2.5-6">¶</a></p>
</section>
</div>
<div id="two-bits-delay-measurement-spin-bit-delay-bit">
<section id="section-2.2.6">
          <h4 id="name-two-bits-delay-measurement-">
<a class="section-number selfRef" href="#section-2.2.6">2.2.6. </a><a class="section-name selfRef" href="#name-two-bits-delay-measurement-">Two Bits Delay Measurement: Spin Bit + Delay Bit</a>
          </h4>
<p id="section-2.2.6-1">The Spin and Delay bit algorithms work independently. If both marking methods are
used in the same connection, observers can choose the best measurement between
the two available:<a class="pilcrow" href="#section-2.2.6-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.6-2.1">when a precise measurement can be produced using the Delay bit, observers
choose it; and<a class="pilcrow" href="#section-2.2.6-2.1">¶</a>
</li>
            <li class="normal" id="section-2.2.6-2.2">when a Delay bit measurement is not available, observers choose the
approximate Spin bit one.<a class="pilcrow" href="#section-2.2.6-2.2">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="loss-bits">
<section id="section-3">
      <h2 id="name-loss-bits">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-loss-bits">Loss Bits</a>
      </h2>
<p id="section-3-1">This section introduces bits that can be used for loss measurements.
Whenever this section of the specification refers to packets, it is
referring only to packets with protocol headers that include the loss
bits -- the only packets whose loss can be measured.<a class="pilcrow" href="#section-3-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1">T:</dt>
        <dd id="section-3-2.2" style="margin-left: 2.5em">The "round-Trip loss" bit is used in combination with the Spin bit to
measure round-trip loss. See <a class="auto internal xref" href="#rtlossbit">Section 3.1</a>.<a class="pilcrow" href="#section-3-2.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3">Q:</dt>
        <dd id="section-3-2.4" style="margin-left: 2.5em">The "sQuare" bit is used to measure upstream loss. See
<a class="auto internal xref" href="#squarebit">Section 3.2</a>.<a class="pilcrow" href="#section-3-2.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.5">L:</dt>
        <dd id="section-3-2.6" style="margin-left: 2.5em">The "Loss Event" bit is used to measure end-to-end loss. See <a class="auto internal xref" href="#lossbit">Section 3.3</a>.<a class="pilcrow" href="#section-3-2.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.7">R:</dt>
        <dd id="section-3-2.8" style="margin-left: 2.5em">The "Reflection square" bit is used in combination with the Q bit to
measure end-to-end loss. See <a class="auto internal xref" href="#refsquarebit">Section 3.4</a>.<a class="pilcrow" href="#section-3-2.8">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-3-3">Loss measurements enabled by T, Q, and L bits can be implemented by those loss
bits alone (T bit requires a working Spin bit). Two-bit combinations Q+L and Q+R
enable additional measurement opportunities discussed below.<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">Each endpoint maintains appropriate counters independently and separately for
each identifiable flow (or each sub-flow for multipath connections).<a class="pilcrow" href="#section-3-4">¶</a></p>
<p id="section-3-5">Since loss is reported independently for each flow, all bits (except for the L bit)
require a certain minimum number of packets to be exchanged per flow before any
signal can be measured. Therefore, loss measurements work best for flows that
transfer more than a minimal amount of data.<a class="pilcrow" href="#section-3-5">¶</a></p>
<div id="rtlossbit">
<section id="section-3.1">
        <h3 id="name-t-bit-round-trip-loss-bit">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-t-bit-round-trip-loss-bit">T Bit -- Round-Trip Loss Bit</a>
        </h3>
<p id="section-3.1-1">The round-Trip loss bit is used to mark a variable number of packets exchanged
twice between the endpoints realizing a two round-trip reflection. A passive
on-path observer, observing either direction, can count and compare the number
of marked packets seen during the two reflections, estimating the loss rate
experienced by the connection. The overall exchange comprises:<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">the client selects and consequently sets the T bit to 1 in order to identify
a first train of packets;<a class="pilcrow" href="#section-3.1-2.1">¶</a>
</li>
          <li class="normal" id="section-3.1-2.2">upon receiving each packet included in the first train, the server sets the T bit to 1 and reflects
to the client a respective second train of packets of the same size as the
first train received;<a class="pilcrow" href="#section-3.1-2.2">¶</a>
</li>
          <li class="normal" id="section-3.1-2.3">upon receiving each packet included in the second train, the client sets the T bit to 1 and reflects
to the server a respective third train of packets of the same size as the
second train received; and<a class="pilcrow" href="#section-3.1-2.3">¶</a>
</li>
          <li class="normal" id="section-3.1-2.4">upon receiving each packet included in the third train, the server sets the T bit to 1 and finally
reflects to the client a respective fourth train of packets of the same size
as the third train received.<a class="pilcrow" href="#section-3.1-2.4">¶</a>
</li>
        </ul>
<p id="section-3.1-3">Packets belonging to the first round trip (first and second train)
represent the Generation Phase, while those belonging to the second
round trip (third and fourth train) represent the Reflection Phase.<a class="pilcrow" href="#section-3.1-3">¶</a></p>
<p id="section-3.1-4">A passive on-path observer can count and compare the number of marked
packets seen during the two round trips (i.e., the first and third
or the second and the fourth trains of packets, depending on which
direction is observed) and estimate the loss rate experienced by the
connection. This process is repeated continuously to obtain more
measurements as long as the endpoints exchange traffic.  These
measurements can be called round-trip losses.<a class="pilcrow" href="#section-3.1-4">¶</a></p>
<p id="section-3.1-5">Since the packet rates in two directions may be different, the number of marked
packets in the train is determined by the direction with the lowest packet rate.
See <a class="auto internal xref" href="#tbit-details">Section 3.1.2</a> for details on packet generation.<a class="pilcrow" href="#section-3.1-5">¶</a></p>
<div id="round-trip-loss">
<section id="section-3.1.1">
          <h4 id="name-round-trip-loss">
<a class="section-number selfRef" href="#section-3.1.1">3.1.1. </a><a class="section-name selfRef" href="#name-round-trip-loss">Round-Trip Loss</a>
          </h4>
<p id="section-3.1.1-1">Since the measurements are performed on a portion of the traffic exchanged
between the client and the server, the observer calculates the end-to-end Round-Trip 
Packet Loss (RTPL) that, statistically, will correspond to the loss rate
experienced by the connection along the entire network path.<a class="pilcrow" href="#section-3.1.1-1">¶</a></p>
<span id="name-round-trip-packet-loss-both"></span><figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-3.1.1-2.1">
<pre>           =======================|======================&gt;
           = **********     -----Obs----&gt;     ********** =
           = * Client *                       * Server * =
           = **********     &lt;------------     ********** =
           &lt;==============================================

                     (a) client-server RTPL

           ==============================================&gt;
           = **********     ------------&gt;     ********** =
           = * Client *                       * Server * =
           = **********     &lt;----Obs-----     ********** =
           &lt;======================|=======================

                     (b) server-client RTPL
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-round-trip-packet-loss-both">Round-Trip Packet Loss (Both Directions)</a>
            </figcaption></figure>
<p id="section-3.1.1-3">This methodology also allows the half-RTPL measurement and
the Intra-domain RTPL measurement in a way similar to RTT measurement.<a class="pilcrow" href="#section-3.1.1-3">¶</a></p>
<span id="name-half-round-trip-packet-loss"></span><figure id="figure-6">
            <div class="alignLeft art-text artwork" id="section-3.1.1-4.1">
<pre>           =======================&gt;
           = **********     ------|-----&gt;     **********
           = * Client *          Obs          * Server *
           = **********     &lt;-----|------     **********
           &lt;=======================

                  (a) client-observer half-RTPL

                                  =======================&gt;
             **********     ------|-----&gt;     ********** =
             * Client *          Obs          * Server * =
             **********     &lt;-----|------     ********** =
                                  &lt;=======================

                  (b) observer-server half-RTPL
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-half-round-trip-packet-loss">Half Round-Trip Packet Loss (Both Directions)</a>
            </figcaption></figure>
<span id="name-intra-domain-round-trip-pac"></span><figure id="figure-7">
            <div class="alignLeft art-text artwork" id="section-3.1.1-5.1">
<pre>                           =========================================&gt;
                                             =====================&gt; =
        **********      ---|--&gt;           ---|--&gt;      ********** = =
        * Client *         Obs               Obs       * Server * = =
        **********      &lt;--|---           &lt;--|---      ********** = =
                                             &lt;===================== =
                           &lt;=========================================

             (a) observer-server RTPL components (half-RTPLs)

                           ==================&gt;
        **********      ---|--&gt;           ---|--&gt;      **********
        * Client *         Obs               Obs       * Server *
        **********      &lt;--|---           &lt;--|---      **********
                           &lt;==================

             (b) the intra-domain RTPL resulting from the
                 subtraction of the above RTPL components
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-intra-domain-round-trip-pac">Intra-domain Round-Trip Packet Loss (Observer-Server)</a>
            </figcaption></figure>
</section>
</div>
<div id="tbit-details">
<section id="section-3.1.2">
          <h4 id="name-setting-the-round-trip-loss">
<a class="section-number selfRef" href="#section-3.1.2">3.1.2. </a><a class="section-name selfRef" href="#name-setting-the-round-trip-loss">Setting the Round-Trip Loss Bit on Outgoing Packets</a>
          </h4>
<p id="section-3.1.2-1">The round-Trip loss signal requires a working Spin bit signal to separate trains
of marked packets (packets with T bit set to 1).  A "pause" of at least one
empty Spin bit period between each phase of the algorithm serves as such a
separator for the on-path observer. The connection between T bit and Spin bit
helps the observer correlate packet trains.<a class="pilcrow" href="#section-3.1.2-1">¶</a></p>
<p id="section-3.1.2-2">The client maintains a "generation token" count that is set to zero at the
beginning of the session and is incremented every time a packet is received
(marked or unmarked). The client also maintains a "reflection counter" that
starts at zero at the beginning of the session.<a class="pilcrow" href="#section-3.1.2-2">¶</a></p>
<p id="section-3.1.2-3">The client is in charge of launching trains of marked packets and does so
according to the algorithm:<a class="pilcrow" href="#section-3.1.2-3">¶</a></p>
<ol class="normal type-1" id="section-3.1.2-4" start="1" type="1">
<li id="section-3.1.2-4.1">Generation Phase. The client starts generating marked packets for two
consecutive Spin bit periods. When the client transmits a packet and a
"generation token" is available, the client marks the packet and retires a
"generation token". If no token is available, the outgoing packet is
transmitted unmarked.  At the end of the first Spin bit period spent in
generation, the reflection counter is unlocked to start counting incoming
marked packets that will be reflected later.<a class="pilcrow" href="#section-3.1.2-4.1">¶</a>
</li>
            <li id="section-3.1.2-4.2">Pause Phase. When the generation is completed, the client pauses till it has
observed one entire Spin bit period with no marked packets.  That Spin bit
period is used by the observer as a separator between generated and
reflected packets.  During this marking pause, all the outgoing packets are
transmitted with T bit set to 0.  The reflection counter is still
incremented every time a marked packet arrives.<a class="pilcrow" href="#section-3.1.2-4.2">¶</a>
</li>
            <li id="section-3.1.2-4.3">Reflection Phase. The client starts transmitting marked packets,
decrementing the reflection counter for each transmitted marked packet until
the reflection counter has reached zero. The "generation token" method from the
Generation Phase is used during this phase as well.  At the end of the first
Spin bit period spent in reflection, the reflection counter is locked to avoid
incoming reflected packets incrementing it.<a class="pilcrow" href="#section-3.1.2-4.3">¶</a>
</li>
            <li id="section-3.1.2-4.4">Pause Phase 2. The Pause Phase is repeated after the Reflection Phase and
serves as a separator between the reflected packet train and a new packet
train.<a class="pilcrow" href="#section-3.1.2-4.4">¶</a>
</li>
          </ol>
<p id="section-3.1.2-5">The generation token counter should be capped to limit the effects of a
subsequent sudden reduction in the other endpoint's packet rate that could
prevent that endpoint from reflecting collected packets. A
cap value of 1 is recommended.<a class="pilcrow" href="#section-3.1.2-5">¶</a></p>
<p id="section-3.1.2-6">A server maintains a "marking counter" that starts at zero and is incremented
every time a marked packet arrives. When the server transmits a packet and the
"marking counter" is positive, the server marks the packet and decrements the
"marking counter". If the "marking counter" is zero, the outgoing packet is
transmitted unmarked.<a class="pilcrow" href="#section-3.1.2-6">¶</a></p>
<p id="section-3.1.2-7">Note that a choice of 2 RTT (two Spin bit periods) for the Generation Phase is a
trade-off between the percentage of marked packets (i.e., the percentage of
traffic monitored) and the measurement delay. Using this value, the algorithm
produces a measurement approximately every 6 RTT (2 generations, ~2
reflections, 2 pauses), marking ~1/3 of packets exchanged in the slower
direction (see <a class="auto internal xref" href="#tbit-losscov">Section 3.1.4</a>). Choosing a Generation Phase of 1 RTT, we would
produce measurements every 4 RTT, monitoring ~1/4 of packets in the
slower direction.<a class="pilcrow" href="#section-3.1.2-7">¶</a></p>
<p id="section-3.1.2-8">It is worth mentioning that problems can happen in some cases, especially if the
rate suddenly changes, but the mechanism described here
worked well with normal traffic conditions in the implementation.<a class="pilcrow" href="#section-3.1.2-8">¶</a></p>
</section>
</div>
<div id="observers-logic-for-round-trip-loss-signal">
<section id="section-3.1.3">
          <h4 id="name-observers-logic-for-round-t">
<a class="section-number selfRef" href="#section-3.1.3">3.1.3. </a><a class="section-name selfRef" href="#name-observers-logic-for-round-t">Observer's Logic for Round-Trip Loss Signal</a>
          </h4>
<p id="section-3.1.3-1">The on-path observer counts marked packets and separates different trains by
detecting Spin bit periods (at least one) with no marked packets.  The Round-Trip Packet Loss (RTPL) is the difference between the size of the Generation
train and the Reflection train.<a class="pilcrow" href="#section-3.1.3-1">¶</a></p>
<p id="section-3.1.3-2">In the following example, packets are represented by two bits (first one
is the Spin bit, second one is the round-Trip loss bit):<a class="pilcrow" href="#section-3.1.3-2">¶</a></p>
<span id="name-round-trip-loss-signal-exam"></span><figure id="figure-8">
            <div class="alignLeft art-text artwork" id="section-3.1.3-3.1">
<pre>        Generation          Pause           Reflection       Pause
   ____________________ ______________ ____________________ ________
  |                    |              |                    |        |
   01 01 00 01 11 10 11 00 00 10 10 10 01 00 01 01 10 11 10 00 00 10
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-round-trip-loss-signal-exam">Round-Trip Loss Signal Example</a>
            </figcaption></figure>
<p id="section-3.1.3-4">Note that 5 marked packets have been generated, of which 4 have been reflected.<a class="pilcrow" href="#section-3.1.3-4">¶</a></p>
</section>
</div>
<div id="tbit-losscov">
<section id="section-3.1.4">
          <h4 id="name-loss-coverage-and-signal-ti">
<a class="section-number selfRef" href="#section-3.1.4">3.1.4. </a><a class="section-name selfRef" href="#name-loss-coverage-and-signal-ti">Loss Coverage and Signal Timing</a>
          </h4>
<p id="section-3.1.4-1">A cycle of the round-Trip loss signaling algorithm contains 2 RTTs of Generation
phase, 2 RTTs of Reflection Phase, and 2 Pause Phases at least 1 RTT in
duration each.  Hence, the loss signal is delayed by about 6 RTTs since the loss
events.<a class="pilcrow" href="#section-3.1.4-1">¶</a></p>
<p id="section-3.1.4-2">The observer can only detect the loss of marked packets that occurs after its
initial observation of the Generation Phase and before its subsequent
observation of the Reflection Phase. Hence, if the loss occurs on the path that
sends packets at a lower rate (typically ACKs in such asymmetric scenarios),
2/6 (1/3) of the packets will be sampled for loss detection.<a class="pilcrow" href="#section-3.1.4-2">¶</a></p>
<p id="section-3.1.4-3">If the loss occurs on the path that sends packets at a higher rate,
<code>lowPacketRate/(3*highPacketRate)</code> of the packets will be sampled for loss
detection. For protocols that use ACKs, the portion of packets sampled for loss
in the higher rate direction during unidirectional data transfer is
<code>1/(3*packetsPerAck)</code>, where the value of <code>packetsPerAck</code> can vary by protocol,
by implementation, and by network conditions.<a class="pilcrow" href="#section-3.1.4-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="squarebit">
<section id="section-3.2">
        <h3 id="name-q-bit-square-bit">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-q-bit-square-bit">Q Bit -- sQuare Bit</a>
        </h3>
<p id="section-3.2-1">The sQuare bit (Q bit) takes its name from the square wave generated by its
signal. This method is based on the Alternate-Marking method <span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span>, and
the Q bit represents the "packet color" that can be switched between 0 and 1 in order to mark consecutive blocks
of packets with different colors. This method does not require cooperation from
both endpoints.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2"><span>[<a class="cite xref" href="#RFC9341">AltMark</a>]</span> introduces two variations of the Alternate-Marking method depending
on whether the color is switched according to a fixed timer or after a fixed
number of packets. Cooperating and synchronized observers on either end of a network 
segment can use the fixed-timer method to measure packet loss on the
segment by comparing packet counters for the same packet blocks.  The time length of
the blocks can be chosen depending on the desired measurement frequency, but it
must be long enough to guarantee the proper operation with respect to clock errors
and network delay issues.<a class="pilcrow" href="#section-3.2-2">¶</a></p>
<p id="section-3.2-3">The Q bit method described in this document chooses the color-switching method
based on a fixed number of packets for each block. This approach has the
advantage that it does not require cooperating or synchronized observers or
network elements. Each probe can measure packet loss autonomously without
relying on an external NMS. For the purpose of the
packet loss measurement, all blocks have the same number of packets, and it is
necessary to detect only the loss event and not to identify the exact block with
losses.<a class="pilcrow" href="#section-3.2-3">¶</a></p>
<p id="section-3.2-4">Following the method based on fixed number of packets, the square wave signal is
generated by the switching of the Q bit: every outgoing packet contains the Q
bit value, which is initialized to 0 and inverted after sending N packets (a
sQuare Block or simply Q Block). Hence, Q Period is 2*N.<a class="pilcrow" href="#section-3.2-4">¶</a></p>
<p id="section-3.2-5">Observation points can estimate upstream losses by watching a single direction
of the traffic flow and counting the number of packets in each observed Q Block,
as described in <a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>.<a class="pilcrow" href="#section-3.2-5">¶</a></p>
<div id="q-block-length-selection">
<section id="section-3.2.1">
          <h4 id="name-q-block-length-selection">
<a class="section-number selfRef" href="#section-3.2.1">3.2.1. </a><a class="section-name selfRef" href="#name-q-block-length-selection">Q Block Length Selection</a>
          </h4>
<p id="section-3.2.1-1">The length of the block must be known to the on-path network probes.  There are
two alternatives to selecting the Q Block length. The first one requires that
the length is known a priori and therefore set within the protocol
specifications that implement the marking mechanism. The second requires the
sender to select it.<a class="pilcrow" href="#section-3.2.1-1">¶</a></p>
<p id="section-3.2.1-2">In this latter scenario, the sender is expected to choose N (Q Block
length) based on the expected amount of loss and reordering on the
path.  The choice of N strikes a compromise -- the observation could
become too unreliable in case of packet reordering and/or severe loss
if N is too small, while short flows may not yield a useful upstream
loss measurement if N is too large (see <a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>).<a class="pilcrow" href="#section-3.2.1-2">¶</a></p>
<p id="section-3.2.1-3">The value of N should be at least 64 and be a power of 2. This requirement allows
an observer to infer the Q Block length by observing one period of the square
signal. It also allows the observer to identify flows that set the loss bits to
arbitrary values (see <a class="auto internal xref" href="#ossification">Section 6</a>).<a class="pilcrow" href="#section-3.2.1-3">¶</a></p>
<p id="section-3.2.1-4">If the sender does not have sufficient information to make an informed decision
about Q Block length, the sender should use N=64, since this value has been
extensively tried in large-scale field tests and yielded good results.
Alternatively, the sender may also choose a random power-of-2 N for each flow,
increasing the chances of using a Q Block length that gives the best signal for
some flows.<a class="pilcrow" href="#section-3.2.1-4">¶</a></p>
<p id="section-3.2.1-5">The sender must keep the value of N constant for a given flow.<a class="pilcrow" href="#section-3.2.1-5">¶</a></p>
</section>
</div>
<div id="upstreamloss">
<section id="section-3.2.2">
          <h4 id="name-upstream-loss">
<a class="section-number selfRef" href="#section-3.2.2">3.2.2. </a><a class="section-name selfRef" href="#name-upstream-loss">Upstream Loss</a>
          </h4>
<p id="section-3.2.2-1">Blocks of N (Q Block length) consecutive packets are sent with the same
value of the Q bit, followed by another block of N packets with an
inverted value of the Q bit.  Hence, knowing the value of N, an
on-path observer can estimate the amount of upstream loss after
observing at least N packets.  The upstream loss rate (<code>uloss</code>) is one
minus the average number of packets in a block of packets with the
same Q value (<code>p</code>) divided by N (<code>uloss=1-avg(p)/N</code>).<a class="pilcrow" href="#section-3.2.2-1">¶</a></p>
<p id="section-3.2.2-2">The observer needs to be able to tolerate packet reordering that can
blur the edges of the square signal, as explained in <a class="auto internal xref" href="#endmarkingblock">Section 3.2.3</a>.<a class="pilcrow" href="#section-3.2.2-2">¶</a></p>
<span id="name-upstream-loss-2"></span><figure id="figure-9">
            <div class="alignLeft art-text artwork" id="section-3.2.2-3.1">
<pre>          =====================&gt;
          **********     -----Obs----&gt;     **********
          * Client *                       * Server *
          **********     &lt;------------     **********

            (a) in client-server channel (uloss_up)

          **********     ------------&gt;     **********
          * Client *                       * Server *
          **********     &lt;----Obs-----     **********
                               &lt;=====================

            (b) in server-client channel (uloss_down)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-upstream-loss-2">Upstream Loss</a>
            </figcaption></figure>
</section>
</div>
<div id="endmarkingblock">
<section id="section-3.2.3">
          <h4 id="name-identifying-q-block-boundar">
<a class="section-number selfRef" href="#section-3.2.3">3.2.3. </a><a class="section-name selfRef" href="#name-identifying-q-block-boundar">Identifying Q Block Boundaries</a>
          </h4>
<p id="section-3.2.3-1">Packet reordering can produce spurious edges in the square signal. To address
this, the observer should look for packets with the current Q bit value up to X
packets past the first packet with a reverse Q bit value. The value of X, a
"Marking Block Threshold", should be less than <code>N/2</code>.<a class="pilcrow" href="#section-3.2.3-1">¶</a></p>
<p id="section-3.2.3-2">The choice of X represents a trade-off between resiliency to reordering and
resiliency to loss. A very large Marking Block Threshold will be able to
reconstruct Q Blocks despite a significant amount of reordering, but it may
erroneously coalesce packets from multiple Q Blocks into fewer Q Blocks if loss
exceeds 50% for some Q Blocks.<a class="pilcrow" href="#section-3.2.3-2">¶</a></p>
<div id="Qburst">
<section id="section-3.2.3.1">
            <h5 id="name-improved-resilience-to-burs">
<a class="section-number selfRef" href="#section-3.2.3.1">3.2.3.1. </a><a class="section-name selfRef" href="#name-improved-resilience-to-burs">Improved Resilience to Burst Losses</a>
            </h5>
<p id="section-3.2.3.1-1">Burst losses can affect the accuracy of Q measurements. Generally, burst losses can be
absorbed and correctly measured if smaller than the established Q Block
length. If the entire Q Block length of packets is lost in a burst, however, the
observer may be left completely unaware of the loss.<a class="pilcrow" href="#section-3.2.3.1-1">¶</a></p>
<p id="section-3.2.3.1-2">To improve burst loss resilience, an observer may consider a received Q Block
larger than the selected Q Block length as an indication of a burst loss
event. The observer would then compute the loss as three times the Q Block length
minus the measured block length. By doing so, the observer can detect burst
losses of less than two blocks (e.g., less than 128 packets for a Q Block length
of 64 packets). A burst loss of two or more consecutive periods would still
remain unnoticed by the observer (or underestimated if a period longer than Q
Block length were formed).<a class="pilcrow" href="#section-3.2.3.1-2">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="lossbit">
<section id="section-3.3">
        <h3 id="name-l-bit-loss-event-bit">
<a class="section-number selfRef" href="#section-3.3">3.3. </a><a class="section-name selfRef" href="#name-l-bit-loss-event-bit">L Bit -- Loss Event Bit</a>
        </h3>
<p id="section-3.3-1">The Loss Event bit uses an Unreported Loss counter maintained by the protocol
that implements the marking mechanism. To use the Loss Event bit, the protocol
must allow the sender to identify lost packets. This is true of protocols such
as QUIC, partially true for TCP and Stream Control Transmission Protocol (SCTP) (losses of pure ACKs are not detected),
and is not true of protocols such as UDP and IPv4/IPv6.<a class="pilcrow" href="#section-3.3-1">¶</a></p>
<p id="section-3.3-2">The Unreported Loss counter is initialized to 0, and the L bit of every outgoing
packet indicates whether the Unreported Loss counter is positive (L=1 if the
counter is positive, and L=0 otherwise).<a class="pilcrow" href="#section-3.3-2">¶</a></p>
<p id="section-3.3-3">The value of the Unreported Loss counter is decremented every time a packet
with L=1 is sent.<a class="pilcrow" href="#section-3.3-3">¶</a></p>
<p id="section-3.3-4">The value of the Unreported Loss counter is incremented for every packet that
the protocol declares lost, using whatever loss detection machinery the protocol
employs. If the protocol is able to rescind the loss determination later, a
positive Unreported Loss counter may be decremented due to the rescission.
In general, it should not become negative due to the rescission, but it can happen
in few cases.<a class="pilcrow" href="#section-3.3-4">¶</a></p>
<p id="section-3.3-5">This loss signaling is similar to loss signaling in <span>[<a class="cite xref" href="#RFC7713">ConEx</a>]</span>, except that the Loss
Event bit is reporting the exact number of lost packets, whereas the signal mechanism
in <span>[<a class="cite xref" href="#RFC7713">ConEx</a>]</span> is reporting an approximate number of lost bytes.<a class="pilcrow" href="#section-3.3-5">¶</a></p>
<p id="section-3.3-6">For protocols, such as TCP <span>[<a class="cite xref" href="#RFC9293">TCP</a>]</span>, that allow network devices to change data
segmentation, it is possible that only a part of the packet is lost. In these
cases, the sender must increment the Unreported Loss counter by the fraction of the
packet data lost (so the Unreported Loss counter may become negative when a packet
with L=1 is sent after a partial packet has been lost).<a class="pilcrow" href="#section-3.3-6">¶</a></p>
<p id="section-3.3-7">Observation points can estimate the end-to-end loss, as determined by the
upstream endpoint, by counting packets in this direction with the L bit equal to
1, as described in <a class="auto internal xref" href="#endtoendloss">Section 3.3.1</a>.<a class="pilcrow" href="#section-3.3-7">¶</a></p>
<div id="endtoendloss">
<section id="section-3.3.1">
          <h4 id="name-end-to-end-loss">
<a class="section-number selfRef" href="#section-3.3.1">3.3.1. </a><a class="section-name selfRef" href="#name-end-to-end-loss">End-To-End Loss</a>
          </h4>
<p id="section-3.3.1-1">The Loss Event bit allows an observer to estimate the end-to-end loss rate by
counting packets with L bit values of 0 and 1 for a given flow. The end-to-end
loss ratio is the fraction of packets with L=1.<a class="pilcrow" href="#section-3.3.1-1">¶</a></p>
<p id="section-3.3.1-2">The assumption here is that upstream loss affects packets with L=0 and L=1
equally. If some loss is caused by tail-drop in a network device, this may be a
simplification.  If the sender's congestion controller reduces the packet send
rate after loss, there may be a sufficient delay before sending packets with L=1
that they have a greater chance of arriving at the observer.<a class="pilcrow" href="#section-3.3.1-2">¶</a></p>
<div id="loss-profile">
<section id="section-3.3.1.1">
            <h5 id="name-loss-profile-characterizati">
<a class="section-number selfRef" href="#section-3.3.1.1">3.3.1.1. </a><a class="section-name selfRef" href="#name-loss-profile-characterizati">Loss Profile Characterization</a>
            </h5>
<p id="section-3.3.1.1-1">The Loss Event bit allows an observer to characterize the loss profile, since the
distribution of observed packets with the L bit set to 1 roughly corresponds to the
distribution of packets lost between 1 RTT and 1 retransmission timeout (RTO) before (see
<a class="auto internal xref" href="#loss-correlation">Section 3.3.2.1</a>).  Hence, observing random single instances of the L bit set
to 1 indicates random single packet loss, while observing blocks of packets
with the L bit set to 1 indicates loss affecting entire blocks of packets.<a class="pilcrow" href="#section-3.3.1.1-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="lq-bits-loss-measurement-using-l-and-q-bits">
<section id="section-3.3.2">
          <h4 id="name-lq-bits-loss-measurement-us">
<a class="section-number selfRef" href="#section-3.3.2">3.3.2. </a><a class="section-name selfRef" href="#name-lq-bits-loss-measurement-us">L+Q Bits -- Loss Measurement Using L and Q Bits</a>
          </h4>
<p id="section-3.3.2-1">Combining L and Q bits allows a passive observer watching a single direction of
traffic to accurately measure:<a class="pilcrow" href="#section-3.3.2-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.3.2-2">
            <dt id="section-3.3.2-2.1">upstream loss:</dt>
            <dd id="section-3.3.2-2.2" style="margin-left: 1.5em">sender-to-observer loss (see <a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>)<a class="pilcrow" href="#section-3.3.2-2.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-2.3">downstream loss:</dt>
            <dd id="section-3.3.2-2.4" style="margin-left: 1.5em">observer-to-receiver loss (see <a class="auto internal xref" href="#downstreamloss">Section 3.3.2.2</a>)<a class="pilcrow" href="#section-3.3.2-2.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-2.5">end-to-end loss:</dt>
            <dd id="section-3.3.2-2.6" style="margin-left: 1.5em">sender-to-receiver loss on the observed path (see
<a class="auto internal xref" href="#endtoendloss">Section 3.3.1</a>) with loss profile characterization (see <a class="auto internal xref" href="#loss-profile">Section 3.3.1.1</a>)<a class="pilcrow" href="#section-3.3.2-2.6">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div id="loss-correlation">
<section id="section-3.3.2.1">
            <h5 id="name-correlating-end-to-end-and-">
<a class="section-number selfRef" href="#section-3.3.2.1">3.3.2.1. </a><a class="section-name selfRef" href="#name-correlating-end-to-end-and-">Correlating End-to-End and Upstream Loss</a>
            </h5>
<p id="section-3.3.2.1-1">Upstream loss is calculated by observing packets that did not suffer the
upstream loss (<a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>). End-to-end loss, however, is calculated by
observing subsequent packets after the sender's protocol detected the loss.
Hence, end-to-end loss is generally observed with a delay of between 1 RTT (loss
declared due to multiple duplicate acknowledgments) and 1 RTO (loss declared
due to a timeout) relative to the upstream loss.<a class="pilcrow" href="#section-3.3.2.1-1">¶</a></p>
<p id="section-3.3.2.1-2">The flow RTT can sometimes be estimated by timing the protocol handshake
messages. This RTT estimate can be greatly improved by observing a dedicated
protocol mechanism for conveying RTT information, such as the Spin bit (see
<a class="auto internal xref" href="#spinbit">Section 2.1</a>) or Delay bit (see <a class="auto internal xref" href="#delaybit">Section 2.2</a>).<a class="pilcrow" href="#section-3.3.2.1-2">¶</a></p>
<p id="section-3.3.2.1-3">Whenever the observer needs to perform a computation that uses both upstream and
end-to-end loss rate measurements, it should consider the upstream loss rate leading the
end-to-end loss rate by approximately 1 RTT. If the observer is unable to
estimate RTT of the flow, it should accumulate loss measurements over time
periods of at least 4 times the typical RTT for the observed flows.<a class="pilcrow" href="#section-3.3.2.1-3">¶</a></p>
<p id="section-3.3.2.1-4">If the calculated upstream loss rate exceeds the end-to-end loss rate calculated
in <a class="auto internal xref" href="#endtoendloss">Section 3.3.1</a>, then either the Q Period is too short for the amount of
packet reordering or there is observer loss, described in <a class="auto internal xref" href="#observerloss">Section 3.3.2.3</a>. If
this happens, the observer should adjust the calculated upstream loss rate to
match end-to-end loss rate, unless the following applies.<a class="pilcrow" href="#section-3.3.2.1-4">¶</a></p>
<p id="section-3.3.2.1-5">In case of a protocol, such as TCP or SCTP, that does not track losses of pure
ACK packets, observing a direction of traffic dominated by pure ACK packets
could result in measured upstream loss that is higher than measured end-to-end
loss if said pure ACK packets are lost upstream. Hence, if the measurement is
applied to such protocols, and the observer can confirm that pure ACK packets
dominate the observed traffic direction, the observer should adjust the
calculated end-to-end loss rate to match upstream loss rate.<a class="pilcrow" href="#section-3.3.2.1-5">¶</a></p>
</section>
</div>
<div id="downstreamloss">
<section id="section-3.3.2.2">
            <h5 id="name-downstream-loss">
<a class="section-number selfRef" href="#section-3.3.2.2">3.3.2.2. </a><a class="section-name selfRef" href="#name-downstream-loss">Downstream Loss</a>
            </h5>
<p id="section-3.3.2.2-1">Because downstream loss affects only those packets that did not suffer upstream
loss, the end-to-end loss rate (<code>eloss</code>) relates to the upstream loss rate
(<code>uloss</code>) and downstream loss rate (<code>dloss</code>) as <code>(1-uloss)(1-dloss)=1-eloss</code>.
Hence, <code>dloss=(eloss-uloss)/(1-uloss)</code>.<a class="pilcrow" href="#section-3.3.2.2-1">¶</a></p>
</section>
</div>
<div id="observerloss">
<section id="section-3.3.2.3">
            <h5 id="name-observer-loss">
<a class="section-number selfRef" href="#section-3.3.2.3">3.3.2.3. </a><a class="section-name selfRef" href="#name-observer-loss">Observer Loss</a>
            </h5>
<p id="section-3.3.2.3-1">A typical deployment of a passive observation system includes a network tap
device that mirrors network packets of interest to a device that performs
analysis and measurement on the mirrored packets. The observer loss is the loss
that occurs on the mirror path.<a class="pilcrow" href="#section-3.3.2.3-1">¶</a></p>
<p id="section-3.3.2.3-2">Observer loss affects the upstream loss rate measurement since it causes the
observer to account for fewer packets in a block of identical Q bit values (see
<a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>). The end-to-end loss rate measurement, however, is unaffected
by the observer loss since it is a measurement of the fraction of packets with
the L bit value of 1, and the observer loss would affect all packets equally
(see <a class="auto internal xref" href="#endtoendloss">Section 3.3.1</a>).<a class="pilcrow" href="#section-3.3.2.3-2">¶</a></p>
<p id="section-3.3.2.3-3">The need to adjust the upstream loss rate down to match the end-to-end loss rate as
described in <a class="auto internal xref" href="#loss-correlation">Section 3.3.2.1</a> is an indication of the observer loss, whose
magnitude is between the amount of such adjustment and the entirety of the
upstream loss measured in <a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>. Alternatively, a high apparent
upstream loss rate could be an indication of significant packet reordering,
possibly due to packets belonging to a single flow being multiplexed over
several upstream paths with different latency characteristics.<a class="pilcrow" href="#section-3.3.2.3-3">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="refsquarebit">
<section id="section-3.4">
        <h3 id="name-r-bit-reflection-square-bit">
<a class="section-number selfRef" href="#section-3.4">3.4. </a><a class="section-name selfRef" href="#name-r-bit-reflection-square-bit">R Bit -- Reflection Square Bit</a>
        </h3>
<p id="section-3.4-1">R bit requires a deployment alongside Q bit. Unlike the square signal for which
packets are transmitted in blocks of fixed size, the number of packets in
Reflection square blocks (also an Alternate-Marking signal) varies
according to these rules:<a class="pilcrow" href="#section-3.4-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-2.1">when the transmission of a new block starts, its size is set equal
to the size of the last Q Block whose reception has been completed; and<a class="pilcrow" href="#section-3.4-2.1">¶</a>
</li>
          <li class="normal" id="section-3.4-2.2">if the reception of at least one further Q Block is completed before transmission of the block is terminated, the size of the block
is updated to be the average size of the further received Q Blocks.<a class="pilcrow" href="#section-3.4-2.2">¶</a>
</li>
        </ul>
<p id="section-3.4-3">The Reflection square value is initialized to 0 and is applied to the R bit of
every outgoing packet.  The Reflection square value is toggled for the first
time when the completion of a Q Block is detected in the incoming square signal
(produced by the other endpoint using the Q bit). The number of packets
detected within this first Q Block (<code>p</code>), is used to generate a reflection
square signal that toggles every <code>M=p</code> packets (at first). This new signal
produces blocks of M packets (marked using the R bit) and each of them is
called "Reflection Block" (Reflection Block).<a class="pilcrow" href="#section-3.4-3">¶</a></p>
<p id="section-3.4-4">The M value is then updated every time a completed Q Block in the
incoming square signal is received, following this formula:
<code>M=round(avg(p))</code>.<a class="pilcrow" href="#section-3.4-4">¶</a></p>
<p id="section-3.4-5">The parameter <code>avg(p)</code>, the average number of packets in a marking
period, is computed based on all the Q Blocks received since the
beginning of the current Reflection Block.<a class="pilcrow" href="#section-3.4-5">¶</a></p>
<p id="section-3.4-6">The transmission of a Reflection Block is considered complete (and the signal toggled)
when the number of packets transmitted in that block is at least the latest
computed M value.<a class="pilcrow" href="#section-3.4-6">¶</a></p>
<p id="section-3.4-7">To ensure a proper computation of the M value, endpoints implementing the R bit
must identify the boundaries of incoming Q Blocks. The same approach described
in <a class="auto internal xref" href="#endmarkingblock">Section 3.2.3</a> should be used.<a class="pilcrow" href="#section-3.4-7">¶</a></p>
<p id="section-3.4-8">By looking at the R bit, unidirectional observation points have an indication of
loss experienced by the entire unobserved channel plus the loss on the path
from the sender to them.<a class="pilcrow" href="#section-3.4-8">¶</a></p>
<p id="section-3.4-9">Since the Q Block is sent in one direction, and the corresponding reflected R
Block is sent in the opposite direction, the reflected R signal is transmitted
with the packet rate of the slowest direction. Namely, if the observed direction
is the slowest, there can be multiple Q Blocks transmitted in the unobserved
direction before a complete Reflection Block is transmitted in the observed direction. If
the unobserved direction is the slowest, the observed direction can be sending R
Blocks of the same size repeatedly before it can update the signal to account
for a newly completed Q Block.<a class="pilcrow" href="#section-3.4-9">¶</a></p>
<div id="enhancement-of-r-block-length-computation">
<section id="section-3.4.1">
          <h4 id="name-enhancement-of-reflection-b">
<a class="section-number selfRef" href="#section-3.4.1">3.4.1. </a><a class="section-name selfRef" href="#name-enhancement-of-reflection-b">Enhancement of Reflection Block Length Computation</a>
          </h4>
<p id="section-3.4.1-1">The use of the rounding function used in the M computation introduces errors
that can be minimized by storing the rounding applied each time M is computed
and using it during the computation of the M value in the following Reflection Block.<a class="pilcrow" href="#section-3.4.1-1">¶</a></p>
<p id="section-3.4.1-2">This can be achieved by introducing the new <code>r_avg</code> parameter in the computation of
M.  The new formula is <code>Mr=avg(p)+r_avg; M=round(Mr); r_avg=Mr-M</code> where the
initial value of <code>r_avg</code> is equal to 0.<a class="pilcrow" href="#section-3.4.1-2">¶</a></p>
</section>
</div>
<div id="improved-resilience-to-packet-reordering">
<section id="section-3.4.2">
          <h4 id="name-improved-resilience-to-pack">
<a class="section-number selfRef" href="#section-3.4.2">3.4.2. </a><a class="section-name selfRef" href="#name-improved-resilience-to-pack">Improved Resilience to Packet Reordering</a>
          </h4>
<p id="section-3.4.2-1">When a protocol implementing the marking mechanism is able to detect when
packets are received out of order, it can improve resilience to packet
reordering beyond what is possible by using methods described in
<a class="auto internal xref" href="#endmarkingblock">Section 3.2.3</a>.<a class="pilcrow" href="#section-3.4.2-1">¶</a></p>
<p id="section-3.4.2-2">This can be achieved by updating the size of the current Reflection Block while it is
being transmitted.  The Reflection Block size is then updated every time an
incoming reordered packet of the previous Q Block is detected.  This can be
done if and only if the transmission of the current Reflection Block is in
progress and no packets of the following Q Block have been received.<a class="pilcrow" href="#section-3.4.2-2">¶</a></p>
<div id="Rburst">
<section id="section-3.4.2.1">
            <h5 id="name-improved-resilience-to-burst">
<a class="section-number selfRef" href="#section-3.4.2.1">3.4.2.1. </a><a class="section-name selfRef" href="#name-improved-resilience-to-burst">Improved Resilience to Burst Losses</a>
            </h5>
<p id="section-3.4.2.1-1">Burst losses can affect the accuracy of R measurements similar to how they affect
accuracy of Q measurements. Therefore, recommendations in <a class="auto internal xref" href="#Qburst">Section 3.2.3.1</a> apply
equally to improving burst loss resilience for R measurements.<a class="pilcrow" href="#section-3.4.2.1-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="rq-bits-loss-measurement-using-r-and-q-bits">
<section id="section-3.4.3">
          <h4 id="name-rq-bits-loss-measurement-us">
<a class="section-number selfRef" href="#section-3.4.3">3.4.3. </a><a class="section-name selfRef" href="#name-rq-bits-loss-measurement-us">R+Q Bits -- Loss Measurement Using R and Q Bits</a>
          </h4>
<p id="section-3.4.3-1">Since both sQuare and Reflection square bits are toggled at most every N packets
(except for the first transition of the R bit as explained before), an on-path
observer can count the number of packets of each marking block and, knowing the
value of N, can estimate the amount of loss experienced by the connection.  An
observer can calculate different measurements depending on whether it is able to
observe a single direction of the traffic or both directions.<a class="pilcrow" href="#section-3.4.3-1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.4.3-2">
            <dt id="section-3.4.3-2.1">Single directional observer:</dt>
            <dd id="section-3.4.3-2.2" style="margin-left: 1.5em">
              <span class="break"></span><dl class="dlParallel" id="section-3.4.3-2.2.1">
                <dt id="section-3.4.3-2.2.1.1">upstream loss in the observed direction:</dt>
                <dd id="section-3.4.3-2.2.1.2" style="margin-left: 1.5em">the loss between the sender and the
observation point (see <a class="auto internal xref" href="#upstreamloss">Section 3.2.2</a>)<a class="pilcrow" href="#section-3.4.3-2.2.1.2">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-3.4.3-2.2.1.3">"three-quarters" connection loss:</dt>
                <dd id="section-3.4.3-2.2.1.4" style="margin-left: 1.5em">the loss between the receiver and
the sender in the unobserved direction plus the loss between the
sender and the observation point in the observed direction<a class="pilcrow" href="#section-3.4.3-2.2.1.4">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-3.4.3-2.2.1.5">end-to-end loss in the unobserved direction:</dt>
                <dd id="section-3.4.3-2.2.1.6" style="margin-left: 1.5em">the loss between the
receiver and the sender in the opposite direction<a class="pilcrow" href="#section-3.4.3-2.2.1.6">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-3.4.3-2.3">Two directions observer (same metrics seen previously applied to both
direction, plus):</dt>
            <dd id="section-3.4.3-2.4" style="margin-left: 1.5em">
              <span class="break"></span><dl class="dlParallel" id="section-3.4.3-2.4.1">
                <dt id="section-3.4.3-2.4.1.1">client-observer half round-trip loss:</dt>
                <dd id="section-3.4.3-2.4.1.2" style="margin-left: 1.5em">the loss between the client
and the observation point in both directions<a class="pilcrow" href="#section-3.4.3-2.4.1.2">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-3.4.3-2.4.1.3">observer-server half round-trip loss:</dt>
                <dd id="section-3.4.3-2.4.1.4" style="margin-left: 1.5em">the loss between the
observation point and the server in both directions<a class="pilcrow" href="#section-3.4.3-2.4.1.4">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-3.4.3-2.4.1.5">downstream loss:</dt>
                <dd id="section-3.4.3-2.4.1.6" style="margin-left: 1.5em">the loss between the observation point and the
receiver (applicable to both directions)<a class="pilcrow" href="#section-3.4.3-2.4.1.6">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
</dl>
<div id="tqloss">
<section id="section-3.4.3.1">
            <h5 id="name-three-quarters-connection-l">
<a class="section-number selfRef" href="#section-3.4.3.1">3.4.3.1. </a><a class="section-name selfRef" href="#name-three-quarters-connection-l">Three-Quarters Connection Loss</a>
            </h5>
<p id="section-3.4.3.1-1">Except for the very first block in which there is nothing to reflect
(a complete Q Block has not been yet received), packets are
continuously R-bit marked into alternate blocks of size lower or equal
than N.  By knowing the value of N, an on-path observer can estimate the
amount of loss that has occurred in the whole opposite channel plus the loss
from the sender up to it in the observation channel. As for the
previous metric, the <code>three-quarters</code> connection loss rate (<code>tqloss</code>) is
one minus the average number of packets in a block of packets with the
same R value (<code>t</code>) divided by <code>N</code> (<code>tqloss=1-avg(t)/N</code>).<a class="pilcrow" href="#section-3.4.3.1-1">¶</a></p>
<span id="name-three-quarters-connection-lo"></span><figure id="figure-10">
              <div class="alignLeft art-text artwork" id="section-3.4.3.1-2.1">
<pre>        =======================&gt;
        = **********     -----Obs----&gt;     **********
        = * Client *                       * Server *
        = **********     &lt;------------     **********
        &lt;============================================

            (a) in client-server channel (tqloss_up)

          ============================================&gt;
          **********     ------------&gt;     ********** =
          * Client *                       * Server * =
          **********     &lt;----Obs-----     ********** =
                               &lt;=======================

            (b) in server-client channel (tqloss_down)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-10">Figure 10</a>:
<a class="selfRef" href="#name-three-quarters-connection-lo">Three-Quarters Connection Loss</a>
              </figcaption></figure>
<p id="section-3.4.3.1-3">The following metrics derive from this last metric and the upstream
loss produced by the Q bit.<a class="pilcrow" href="#section-3.4.3.1-3">¶</a></p>
</section>
</div>
<div id="end-to-end-loss-in-the-opposite-direction">
<section id="section-3.4.3.2">
            <h5 id="name-end-to-end-loss-in-the-oppo">
<a class="section-number selfRef" href="#section-3.4.3.2">3.4.3.2. </a><a class="section-name selfRef" href="#name-end-to-end-loss-in-the-oppo">End-To-End Loss in the Opposite Direction</a>
            </h5>
<p id="section-3.4.3.2-1">End-to-end loss in the unobserved direction (<code>eloss_unobserved</code>) relates to the
"three-quarters" connection loss (<code>tqloss</code>) and upstream loss in the observed
direction (<code>uloss</code>) as <code>(1-eloss_unobserved)(1-uloss)=1-tqloss</code>.  Hence,
<code>eloss_unobserved=(tqloss-uloss)/(1-uloss)</code>.<a class="pilcrow" href="#section-3.4.3.2-1">¶</a></p>
<span id="name-end-to-end-loss-in-the-oppos"></span><figure id="figure-11">
              <div class="alignLeft art-text artwork" id="section-3.4.3.2-2.1">
<pre>          **********     -----Obs----&gt;     **********
          * Client *                       * Server *
          **********     &lt;------------     **********
          &lt;==========================================

            (a) in client-server channel (eloss_down)

          ==========================================&gt;
          **********     ------------&gt;     **********
          * Client *                       * Server *
          **********     &lt;----Obs-----     **********

            (b) in server-client channel (eloss_up)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-11">Figure 11</a>:
<a class="selfRef" href="#name-end-to-end-loss-in-the-oppos">End-To-End Loss in the Opposite Direction</a>
              </figcaption></figure>
</section>
</div>
<div id="half-round-trip-loss">
<section id="section-3.4.3.3">
            <h5 id="name-half-round-trip-loss">
<a class="section-number selfRef" href="#section-3.4.3.3">3.4.3.3. </a><a class="section-name selfRef" href="#name-half-round-trip-loss">Half Round-Trip Loss</a>
            </h5>
<p id="section-3.4.3.3-1">If the observer is able to observe both directions of traffic, it is able to
calculate two "half round-trip" loss measurements -- loss from the observer to
the receiver (in a given direction) and then back to the observer in the
opposite direction.  For both directions, "half round-trip" loss (<code>hrtloss</code>)
relates to "three-quarters" connection loss (<code>tqloss_opposite</code>) measured in the
opposite direction and the upstream loss (<code>uloss</code>) measured in the given
direction as <code>(1-uloss)(1-hrtloss)=1-tqloss_opposite</code>.  Hence,
<code>hrtloss=(tqloss_opposite-uloss)/(1-uloss)</code>.<a class="pilcrow" href="#section-3.4.3.3-1">¶</a></p>
<span id="name-half-round-trip-loss-both-d"></span><figure id="figure-12">
              <div class="alignLeft art-text artwork" id="section-3.4.3.3-2.1">
<pre>        =======================&gt;
        = **********     ------|-----&gt;     **********
        = * Client *          Obs          * Server *
        = **********     &lt;-----|------     **********
        &lt;=======================

      (a) client-observer half round-trip loss (hrtloss_co)

                               =======================&gt;
          **********     ------|-----&gt;     ********** =
          * Client *          Obs          * Server * =
          **********     &lt;-----|------     ********** =
                               &lt;=======================

      (b) observer-server half round-trip loss (hrtloss_os)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-12">Figure 12</a>:
<a class="selfRef" href="#name-half-round-trip-loss-both-d">Half Round-Trip Loss (Both Directions)</a>
              </figcaption></figure>
</section>
</div>
<div id="downstream-loss">
<section id="section-3.4.3.4">
            <h5 id="name-downstream-loss-2">
<a class="section-number selfRef" href="#section-3.4.3.4">3.4.3.4. </a><a class="section-name selfRef" href="#name-downstream-loss-2">Downstream Loss</a>
            </h5>
<p id="section-3.4.3.4-1">If the observer is able to observe both directions of traffic, it is able to
calculate two downstream loss measurements using either end-to-end loss and
upstream loss, similar to the calculation in <a class="auto internal xref" href="#downstreamloss">Section 3.3.2.2</a>, or "half
round-trip" loss and upstream loss in the opposite direction.<a class="pilcrow" href="#section-3.4.3.4-1">¶</a></p>
<p id="section-3.4.3.4-2">For the latter, <code>dloss=(hrtloss-uloss_opposite)/(1-uloss_opposite)</code>.<a class="pilcrow" href="#section-3.4.3.4-2">¶</a></p>
<span id="name-downstream-loss-3"></span><figure id="figure-13">
              <div class="alignLeft art-text artwork" id="section-3.4.3.4-3.1">
<pre>                               =====================&gt;
          **********     ------|-----&gt;     **********
          * Client *          Obs          * Server *
          **********     &lt;-----|------     **********

             (a) in client-server channel (dloss_up)

          **********     ------|-----&gt;     **********
          * Client *          Obs          * Server *
          **********     &lt;-----|------     **********
          &lt;=====================

             (b) in server-client channel (dloss_down)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-13">Figure 13</a>:
<a class="selfRef" href="#name-downstream-loss-3">Downstream Loss</a>
              </figcaption></figure>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="e-bit-ecn-echo-event-bit">
<section id="section-3.5">
        <h3 id="name-e-bit-ecn-echo-event-bit">
<a class="section-number selfRef" href="#section-3.5">3.5. </a><a class="section-name selfRef" href="#name-e-bit-ecn-echo-event-bit">E Bit -- ECN-Echo Event Bit</a>
        </h3>
<p id="section-3.5-1">While the primary focus of this document is on exposing packet loss and
delay, modern networks can report congestion before they are forced to
drop packets, as described in <span>[<a class="cite xref" href="#RFC3168">ECN</a>]</span>.  When transport protocols keep
ECN-Echo feedback under encryption, this signal cannot be observed by
the network operators.  When tasked with diagnosing network
performance problems, knowledge of a congestion downstream of an
observation point can be instrumental.<a class="pilcrow" href="#section-3.5-1">¶</a></p>
<p id="section-3.5-2">If downstream congestion information is desired, this information can be
signaled with an additional bit.<a class="pilcrow" href="#section-3.5-2">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.5-3">
          <dt id="section-3.5-3.1">E:</dt>
          <dd id="section-3.5-3.2" style="margin-left: 1.5em">The "ECN-Echo Event" bit is set to 0 or 1 according to the Unreported ECN-Echo 
counter, as explained below in <a class="auto internal xref" href="#ecnbit">Section 3.5.1</a>.<a class="pilcrow" href="#section-3.5-3.2">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div id="ecnbit">
<section id="section-3.5.1">
          <h4 id="name-setting-the-ecn-echo-event-">
<a class="section-number selfRef" href="#section-3.5.1">3.5.1. </a><a class="section-name selfRef" href="#name-setting-the-ecn-echo-event-">Setting the ECN-Echo Event Bit on Outgoing Packets</a>
          </h4>
<p id="section-3.5.1-1">The Unreported ECN-Echo counter operates identically to Unreported Loss counter
(<a class="auto internal xref" href="#lossbit">Section 3.3</a>), except it counts packets delivered by the network with Congestion Experienced (CE)
markings, according to the ECN-Echo feedback from the receiver.<a class="pilcrow" href="#section-3.5.1-1">¶</a></p>
<p id="section-3.5.1-2">This ECN-Echo signaling is similar to ECN signaling in <span>[<a class="cite xref" href="#RFC7713">ConEx</a>]</span>. The ECN-Echo
mechanism in QUIC provides the number of packets received with CE marks. For
protocols like TCP, the method described in <span>[<a class="cite xref" href="#RFC7786">ConEx-TCP</a>]</span> can be employed. As
stated in <span>[<a class="cite xref" href="#RFC7786">ConEx-TCP</a>]</span>, such feedback can be further improved using a method
described in <span>[<a class="cite xref" href="#I-D.ietf-tcpm-accurate-ecn">ACCURATE-ECN</a>]</span>.<a class="pilcrow" href="#section-3.5.1-2">¶</a></p>
</section>
</div>
<div id="ech-usage">
<section id="section-3.5.2">
          <h4 id="name-using-e-bit-for-passive-ecn">
<a class="section-number selfRef" href="#section-3.5.2">3.5.2. </a><a class="section-name selfRef" href="#name-using-e-bit-for-passive-ecn">Using E Bit for Passive ECN-Reported Congestion Measurement</a>
          </h4>
<p id="section-3.5.2-1">A network observer can count packets with the CE codepoint and determine the
upstream CE-marking rate directly.<a class="pilcrow" href="#section-3.5.2-1">¶</a></p>
<p id="section-3.5.2-2">Observation points can also estimate ECN-reported end-to-end congestion by
counting packets in this direction with an E bit equal to 1.<a class="pilcrow" href="#section-3.5.2-2">¶</a></p>
<p id="section-3.5.2-3">The upstream CE-marking rate and end-to-end ECN-reported congestion can provide
information about the downstream CE-marking rate. The presence of E bits along with L
bits, however, can somewhat confound precise estimates of upstream and
downstream CE markings if the flow contains packets that are not
ECN capable.<a class="pilcrow" href="#section-3.5.2-3">¶</a></p>
</section>
</div>
<div id="multiple-e-bits">
<section id="section-3.5.3">
          <h4 id="name-multiple-e-bits">
<a class="section-number selfRef" href="#section-3.5.3">3.5.3. </a><a class="section-name selfRef" href="#name-multiple-e-bits">Multiple E Bits</a>
          </h4>
<p id="section-3.5.3-1">Some protocols, such as QUIC, support separate ECN-Echo counters. For example,
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-13.4.1">Section 13.4.1</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span> describes separate counters for ECT(0),
ECT(1), and ECN-CE. To better support such protocols, multiple E bits can be
used, one per a corresponding ECN-Echo counter.<a class="pilcrow" href="#section-3.5.3-1">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="summary-of-delay-and-loss-marking-methods">
<section id="section-4">
      <h2 id="name-summary-of-delay-and-loss-m">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-summary-of-delay-and-loss-m">Summary of Delay and Loss Marking Methods</a>
      </h2>
<p id="section-4-1">This section summarizes the marking methods described in this document, which
proposes a toolkit of techniques that can be used separately, partly, or all
together depending on the need.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">For the delay measurement, it is possible to use the Spin bit and/or the Delay
bit. A unidirectional or bidirectional observer can be used.<a class="pilcrow" href="#section-4-2">¶</a></p>
<span id="name-delay-comparison"></span><div id="fig_summary_D">
<table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-delay-comparison">Delay Comparison</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="2">Method</th>
            <th class="text-center" colspan="1" rowspan="2"># of bits</th>
            <th class="text-center" colspan="2" rowspan="1">Available Delay Metrics</th>
            <th class="text-center" colspan="1" rowspan="2">Impairments Resiliency</th>
            <th class="text-center" colspan="1" rowspan="2"># of meas.</th>
          </tr>
          <tr>
            <th class="text-center" colspan="1" rowspan="1">UniDir Observer</th>
            <th class="text-center" colspan="1" rowspan="1">BiDir Observer</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">S: Spin Bit</td>
            <td class="text-center" colspan="1" rowspan="1">1</td>
            <td class="text-center" colspan="1" rowspan="1">RTT</td>
            <td class="text-center" colspan="1" rowspan="1">x2, Half RTT</td>
            <td class="text-center" colspan="1" rowspan="1">low</td>
            <td class="text-center" colspan="1" rowspan="1">very high</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">D: Delay Bit</td>
            <td class="text-center" colspan="1" rowspan="1">1</td>
            <td class="text-center" colspan="1" rowspan="1">RTT</td>
            <td class="text-center" colspan="1" rowspan="1">x2, Half RTT</td>
            <td class="text-center" colspan="1" rowspan="1">high</td>
            <td class="text-center" colspan="1" rowspan="1">medium</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">SD: Spin Bit &amp; Delay Bit *</td>
            <td class="text-center" colspan="1" rowspan="1">2</td>
            <td class="text-center" colspan="1" rowspan="1">RTT</td>
            <td class="text-center" colspan="1" rowspan="1">x2, Half RTT</td>
            <td class="text-center" colspan="1" rowspan="1">high</td>
            <td class="text-center" colspan="1" rowspan="1">very high</td>
          </tr>
        </tbody>
      </table>
</div>
<span class="break"></span><dl class="dlParallel" id="section-4-4">
        <dt id="section-4-4.1">x2</dt>
        <dd id="section-4-4.2" style="margin-left: 3.0em">Same metric for both directions<a class="pilcrow" href="#section-4-4.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-4.3">*</dt>
        <dd id="section-4-4.4" style="margin-left: 3.0em">Both bits work independently; an observer could use less accurate Spin bit measurements when Delay bit ones are unavailable.<a class="pilcrow" href="#section-4-4.4">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-4-5">For the Loss measurement, each row in <a class="auto internal xref" href="#fig_summary_L">Table 2</a>
represents a loss-marking method. For each method, the table specifies
the number of bits required in the header, the available metrics using
a unidirectional or bidirectional observer, applicable protocols,
measurement fidelity, and delay.<a class="pilcrow" href="#section-4-5">¶</a></p>
<span id="name-loss-comparison"></span><div id="fig_summary_L">
<table class="center" id="table-2">
        <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-loss-comparison">Loss Comparison</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="2">Method</th>
            <th class="text-center" colspan="1" rowspan="2">Bits</th>
            <th class="text-center" colspan="2" rowspan="1">Available Loss Metrics</th>
            <th class="text-center" colspan="1" rowspan="2">Prto</th>
            <th class="text-center" colspan="2" rowspan="1">Measurement Aspects</th>
          </tr>
          <tr>
            <th class="text-center" colspan="1" rowspan="1">UniDir Observer</th>
            <th class="text-center" colspan="1" rowspan="1">BiDir Observer</th>
            <th class="text-center" colspan="1" rowspan="1">Fidelity</th>
            <th class="text-center" colspan="1" rowspan="1">Delay</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">T: Round-Trip Loss Bit</td>
            <td class="text-center" colspan="1" rowspan="1">$1</td>
            <td class="text-center" colspan="1" rowspan="1">RT</td>
            <td class="text-center" colspan="1" rowspan="1">x2, Half RT</td>
            <td class="text-center" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Rate by sampling 1/3 to 1/(3*ppa) of pkts over 2 RTT</td>
            <td class="text-left" colspan="1" rowspan="1">~6 RTT</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Q: sQuare Bit</td>
            <td class="text-center" colspan="1" rowspan="1">1</td>
            <td class="text-center" colspan="1" rowspan="1">Upstream</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="1">Rate over N pkts (e.g., 64)</td>
            <td class="text-left" colspan="1" rowspan="1">N pkts (e.g., 64)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">L: Loss Event Bit</td>
            <td class="text-center" colspan="1" rowspan="1">1</td>
            <td class="text-center" colspan="1" rowspan="1">E2E</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">#</td>
            <td class="text-left" colspan="1" rowspan="1">Loss shape (and rate)</td>
            <td class="text-left" colspan="1" rowspan="1">Min: RTT, Max: RTO</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="3">QL: sQuare + Loss Ev. Bits</td>
            <td class="text-center" colspan="1" rowspan="3">2</td>
            <td class="text-center" colspan="1" rowspan="1">Upstream</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">#</td>
            <td class="text-left" colspan="1" rowspan="1">see Q</td>
            <td class="text-left" colspan="1" rowspan="1">see Q</td>
          </tr>
          <tr>
            <td class="text-center" colspan="1" rowspan="1">Downstream</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">#</td>
            <td class="text-left" colspan="1" rowspan="1">see Q|L</td>
            <td class="text-left" colspan="1" rowspan="1">see L</td>
          </tr>
          <tr>
            <td class="text-center" colspan="1" rowspan="1">E2E</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">#</td>
            <td class="text-left" colspan="1" rowspan="1">see L</td>
            <td class="text-left" colspan="1" rowspan="1">see L</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="3">QR: sQuare + Ref. Sq. Bits</td>
            <td class="text-center" colspan="1" rowspan="3">2</td>
            <td class="text-center" colspan="1" rowspan="1">Upstream</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="3">Rate over N*ppa pkts (see Q bit for N)</td>
            <td class="text-left" colspan="1" rowspan="1">see Q</td>
          </tr>
          <tr>
            <td class="text-center" colspan="1" rowspan="1">3/4 RT</td>
            <td class="text-center" colspan="1" rowspan="1">x2</td>
            <td class="text-center" colspan="1" rowspan="1">*</td>
            <td class="text-left" colspan="1" rowspan="2">N*ppa pkts (see Q bit for N)</td>
          </tr>
          <tr>
            <td class="text-center" colspan="1" rowspan="1">!E2E</td>
            <td class="text-center" colspan="1" rowspan="1">E2E, Downstream, Half RT</td>
            <td class="text-center" colspan="1" rowspan="1">*</td>
          </tr>
        </tbody>
      </table>
</div>
<span class="break"></span><dl class="dlParallel" id="section-4-7">
        <dt id="section-4-7.1">*</dt>
        <dd id="section-4-7.2" style="margin-left: 3.0em">All protocols<a class="pilcrow" href="#section-4-7.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.3">#</dt>
        <dd id="section-4-7.4" style="margin-left: 3.0em">Protocols employing loss detection (with or without pure ACK loss detection)<a class="pilcrow" href="#section-4-7.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.5">$</dt>
        <dd id="section-4-7.6" style="margin-left: 3.0em">Require a working Spin bit<a class="pilcrow" href="#section-4-7.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.7">!</dt>
        <dd id="section-4-7.8" style="margin-left: 3.0em">Metric relative to the opposite channel<a class="pilcrow" href="#section-4-7.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.9">x2</dt>
        <dd id="section-4-7.10" style="margin-left: 3.0em">Same metric for both directions<a class="pilcrow" href="#section-4-7.10">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.11">ppa</dt>
        <dd id="section-4-7.12" style="margin-left: 3.0em">Packets-Per-Ack<a class="pilcrow" href="#section-4-7.12">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.13">Q|L</dt>
        <dd id="section-4-7.14" style="margin-left: 3.0em">See Q if Upstream loss is significant; L otherwise<a class="pilcrow" href="#section-4-7.14">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-7.15">E2E</dt>
        <dd id="section-4-7.16" style="margin-left: 3.0em">End to end<a class="pilcrow" href="#section-4-7.16">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<div id="implementation-considerations">
<section id="section-4.1">
        <h3 id="name-implementation-consideratio">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-implementation-consideratio">Implementation Considerations</a>
        </h3>
<p id="section-4.1-1">By combining the information of the two tables above, it can be deduced that the
solutions with 3 bits (i.e., QL or QR + S or D) or 4 bits (i.e., QL or QR + SD)
allow having more complete and resilient measurements.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2">The methodologies described in the previous sections are transport agnostic and
can be applied in various situations. The choice of the methods also depends
on the specific protocol. For example, QL is a good combination; however, if
a protocol does not support, or cannot set, the L bit, QR is the only
viable solution.<a class="pilcrow" href="#section-4.1-2">¶</a></p>
</section>
</div>
</section>
</div>
<div id="applications">
<section id="section-5">
      <h2 id="name-examples-of-application">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-examples-of-application">Examples of Application</a>
      </h2>
<p id="section-5-1">This document describes several measurement methods, but it is not expected that
all methods will be implemented together. For example, only some of the methods
described in this document (i.e., sQuare bit and Spin bit) are utilized in
<span>[<a class="cite xref" href="#I-D.ietf-core-coap-pm">CORE-COAP-PM</a>]</span>. Also, the binding of a delay signal to QUIC is
partially described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-17.4">Section 17.4</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>, which adds only the
Spin bit to the first byte of the short packet header, leaving two reserved bits
for future use (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-17.2.2">Section 17.2.2</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>).<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">All signals discussed in this document have been implemented in successful
experiments for both QUIC and TCP. The application scenarios considered allow
the monitoring of the interconnections inside a data center (Intra-DC), between
data centers (Inter-DC), as well as end-to-end large-scale data transfers.  For
the application of the methods described in this document, it is assumed that
the monitored flows follow stable paths and traverse the same measurement
points.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3">The specific implementation details and the choice of the bits used for the
experiments with QUIC and TCP are out of scope for this document.  A
specification defining the specific protocol application is expected to discuss
the implementation details depending on which bits will be implemented in the
protocol, e.g., <span>[<a class="cite xref" href="#I-D.ietf-core-coap-pm">CORE-COAP-PM</a>]</span>. If bits used for specific
measurements can also be used for other purposes by a protocol, the
specification is expected to address ways for on-path observers to disambiguate
the signals or to discuss limitations on the conditions under which the
observers can expect a valid signal.<a class="pilcrow" href="#section-5-3">¶</a></p>
</section>
</div>
<div id="ossification">
<section id="section-6">
      <h2 id="name-protocol-ossification-consi">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-protocol-ossification-consi">Protocol Ossification Considerations</a>
      </h2>
<p id="section-6-1">Accurate loss and delay information is not required for the operation of any
protocol, though its presence for a sufficient number of flows is important for
the operation of networks.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">The delay and loss bits are amenable to "greasing" described in <span>[<a class="cite xref" href="#RFC8701">RFC8701</a>]</span> if
the protocol designers are not ready to dedicate (and ossify) bits used for loss
reporting to this function. The greasing could be accomplished similarly to the
latency Spin bit greasing in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-17.4">Section 17.4</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>. For example,
the protocol designers could decide that a fraction of flows should not encode
loss and delay information, and instead, the bits would be set to arbitrary
values. Setting any of the bits described in this document to arbitrary values
would make the corresponding delay and loss information resemble noise rather
than the expected signal for the flow, and the observers would need to be ready
to ignore such flows.<a class="pilcrow" href="#section-6-2">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-7-1">The methods described in this document are transport agnostic and potentially
applicable to any transport-layer protocol, and especially valuable for encrypted
protocols. These methods can be applied to both limited domains and the Internet,
depending on the specific protocol application.<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2">Passive loss and delay observations have been a part of the network operations
for a long time, so exposing loss and delay information to the network does not
add new security concerns for protocols that are currently observable.<a class="pilcrow" href="#section-7-2">¶</a></p>
<p id="section-7-3">In the absence of packet loss, Q and R bits signals do not provide any
information that cannot be observed by simply counting packets transiting a
network path. In the presence of packet loss, Q and R bits will disclose
the loss, but this is information about the environment and not the endpoint
state. The L bit signal discloses internal state of the protocol's loss-detection 
machinery, but this state can often be gleaned by timing packets and
observing the congestion controller response.<a class="pilcrow" href="#section-7-3">¶</a></p>
<p id="section-7-4">The measurements described in this document do not imply that new packets injected
into the network can cause potential harm to the network itself and to data
traffic. The measurements could be harmed by an attacker altering the marking
of the packets or injecting artificial traffic. Authentication techniques may be
used where appropriate to guard against these traffic attacks.<a class="pilcrow" href="#section-7-4">¶</a></p>
<p id="section-7-5">Hence, loss bits do not provide a viable new mechanism to attack data integrity
and secrecy.<a class="pilcrow" href="#section-7-5">¶</a></p>
<p id="section-7-6">The measurement fields introduced in this document are intended to be included
in the packets. However, it is worth mentioning that it may be possible to use this
information as a covert channel.<a class="pilcrow" href="#section-7-6">¶</a></p>
<p id="section-7-7">This document does not define a specific application, and the described
techniques can generally apply to different communication protocols operating in
different security environments. A specification defining a specific protocol
application is expected to address the respective security considerations and
must consider specifics of the protocol and its expected operating environment.
For example, security considerations for QUIC, discussed in 
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-21">Section 21</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span> and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9001#section-9">Section 9</a> of [<a class="cite xref" href="#RFC9001">QUIC-TLS</a>]</span>, consider a possibility of
active and passive attackers in the network as well as attacks on specific QUIC
mechanisms.<a class="pilcrow" href="#section-7-7">¶</a></p>
<div id="optimistic-ack-attack">
<section id="section-7.1">
        <h3 id="name-optimistic-ack-attack">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-optimistic-ack-attack">Optimistic ACK Attack</a>
        </h3>
<p id="section-7.1-1">A defense against an optimistic ACK attack, described in 
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-21.4">Section 21.4</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>, involves a sender randomly skipping packet numbers to detect
a receiver acknowledging packet numbers that have never been received. The Q bit
signal may inform the attacker which packet numbers were skipped on purpose and
which had been actually lost (and are, therefore, safe for the attacker to
acknowledge). To use the Q bit for this purpose, the attacker must first receive
at least an entire Q Block of packets, which renders the attack ineffective
against a delay-sensitive congestion controller.<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<p id="section-7.1-2">A protocol that is more susceptible to an optimistic ACK attack with the loss
signal provided by the Q bit and that uses a loss-based congestion controller should
shorten the current Q Block by the number of skipped packets numbers. For example,
skipping a single packet number will invert the square signal one outgoing
packet sooner.<a class="pilcrow" href="#section-7.1-2">¶</a></p>
<p id="section-7.1-3">Similar considerations apply to the R bit, although a shortened Reflection Block along
with a matching skip in packet numbers does not necessarily imply a lost
packet, since it could be due to a lost packet on the reverse path along with a
deliberately skipped packet by the sender.<a class="pilcrow" href="#section-7.1-3">¶</a></p>
</section>
</div>
<div id="delay-bit-with-rtt-obfuscation">
<section id="section-7.2">
        <h3 id="name-delay-bit-with-rtt-obfuscat">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-delay-bit-with-rtt-obfuscat">Delay Bit with RTT Obfuscation</a>
        </h3>
<p id="section-7.2-1">Theoretically, delay measurements can be used to roughly evaluate the distance
of the client from the server (using the RTT) or from any intermediate observer
(using the client-observer half-RTT). As described in <span>[<a class="cite xref" href="#RTT-PRIVACY">RTT-PRIVACY</a>]</span>, connection
RTT measurements for geolocating endpoints are usually inferior to even the
most basic IP geolocation databases. It is the variability within RTT
measurements (the jitter) that is most informative, as it can provide insight
into the operating environment of the endpoints as well as the state of the
networks (queuing delays) used by the connection.<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<p id="section-7.2-2">Nevertheless, to further mask the actual RTT of the connection, the Delay bit
algorithm can be slightly modified by, for example, delaying the client-side
reflection of the delay sample by a fixed, randomly chosen time value. This
would lead an intermediate observer to measure a delay greater than the real
one.<a class="pilcrow" href="#section-7.2-2">¶</a></p>
<p id="section-7.2-3">This Additional Delay should be randomly selected by the client and kept
constant for a certain amount of time across multiple connections. This ensures
that the client-server jitter remains the same as if no Additional Delay had
been inserted. For example, a new Additional Delay value could be generated
whenever the client's IP address changes.<a class="pilcrow" href="#section-7.2-3">¶</a></p>
<p id="section-7.2-4">Despite the Additional Delay, this Hidden Delay technique still allows an
accurate measurement of the RTT components (observer-server) and all the
intra-domain measurements used to distribute the delay in the network.
Furthermore, unlike the Delay bit, the Hidden Delay bit does not require the
use of the client reflection threshold (1 ms by default). Removing this
threshold may lead to increasing the number of valid measurements produced by
the algorithm.<a class="pilcrow" href="#section-7.2-4">¶</a></p>
<p id="section-7.2-5">Note that the Hidden Delay bit does not affect an observer's ability to measure
accurate RTT using other means, such as timing packets exchanged during the
connection establishment.<a class="pilcrow" href="#section-7.2-5">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-8">
      <h2 id="name-privacy-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-privacy-considerations">Privacy Considerations</a>
      </h2>
<p id="section-8-1">To minimize unintentional exposure of information, loss bits provide an explicit
loss signal -- a preferred way to share information per <span>[<a class="cite xref" href="#RFC8558">RFC8558</a>]</span>.<a class="pilcrow" href="#section-8-1">¶</a></p>
<p id="section-8-2">New protocols commonly have specific privacy goals, and loss reporting must
ensure that loss information does not compromise those privacy goals. For
example, <span>[<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span> allows changing Connection IDs in the middle of a
connection to reduce the likelihood of a passive observer linking old and new
sub-flows to the same device (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-5.1">Section 5.1</a> of [<a class="cite xref" href="#RFC9000">QUIC-TRANSPORT</a>]</span>). A QUIC
implementation would need to reset all counters when it changes the destination
(IP address or UDP port) or the Connection ID used for outgoing packets. It
would also need to avoid incrementing the Unreported Loss counter for loss of
packets sent to a different destination or with a different Connection ID.<a class="pilcrow" href="#section-8-2">¶</a></p>
<p id="section-8-3">It is also worth highlighting that, if these techniques are not widely deployed,
an endpoint that uses them may be fingerprinted based on their usage.
However, since there is no release of user data, the techniques seem unlikely to
substantially increase the existing privacy risks.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4">Furthermore, if there is experimental traffic with these bits set on the network,
a network operator could potentially prioritize this marked traffic by placing it
in a priority queue. This may result in the delivery of better service, which
could potentially mislead an experiment intended to benchmark the network.<a class="pilcrow" href="#section-8-4">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document has no IANA actions.<a class="pilcrow" href="#section-9-1">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-10.1">10.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC3168">[ECN]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time class="refDate" datetime="2001-09">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3168">https://www.rfc-editor.org/info/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7799">[IPPM-METHODS]</dt>
        <dd>
<span class="refAuthor">Morton, A.</span>, <span class="refTitle">"Active and Passive Metrics and Methods (with Hybrid Types In-Between)"</span>, <span class="seriesInfo">RFC 7799</span>, <span class="seriesInfo">DOI 10.17487/RFC7799</span>, <time class="refDate" datetime="2016-05">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7799">https://www.rfc-editor.org/info/rfc7799</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[QUIC-TRANSPORT]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time class="refDate" datetime="2021-05">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9000">https://www.rfc-editor.org/info/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8558">[RFC8558]</dt>
        <dd>
<span class="refAuthor">Hardie, T., Ed.</span>, <span class="refTitle">"Transport Protocol Path Signals"</span>, <span class="seriesInfo">RFC 8558</span>, <span class="seriesInfo">DOI 10.17487/RFC8558</span>, <time class="refDate" datetime="2019-04">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8558">https://www.rfc-editor.org/info/rfc8558</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9293">[TCP]</dt>
      <dd>
<span class="refAuthor">Eddy, W., Ed.</span>, <span class="refTitle">"Transmission Control Protocol (TCP)"</span>, <span class="seriesInfo">STD 7</span>, <span class="seriesInfo">RFC 9293</span>, <span class="seriesInfo">DOI 10.17487/RFC9293</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9293">https://www.rfc-editor.org/info/rfc9293</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-10.2">10.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-tcpm-accurate-ecn">[ACCURATE-ECN]</dt>
        <dd>
<span class="refAuthor">Briscoe, B.</span>, <span class="refAuthor">Kühlewind, M.</span>, and <span class="refAuthor">R. Scheffenegger</span>, <span class="refTitle">"More Accurate Explicit Congestion Notification (ECN) Feedback in TCP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tcpm-accurate-ecn-26</span>, <time class="refDate" datetime="2023-07-24">24 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tcpm-accurate-ecn-26">https://datatracker.ietf.org/doc/html/draft-ietf-tcpm-accurate-ecn-26</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9341">[AltMark]</dt>
        <dd>
<span class="refAuthor">Fioccola, G., Ed.</span>, <span class="refAuthor">Cociglio, M.</span>, <span class="refAuthor">Mirsky, G.</span>, <span class="refAuthor">Mizrahi, T.</span>, and <span class="refAuthor">T. Zhou</span>, <span class="refTitle">"Alternate-Marking Method"</span>, <span class="seriesInfo">RFC 9341</span>, <span class="seriesInfo">DOI 10.17487/RFC9341</span>, <time class="refDate" datetime="2022-12">December 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9341">https://www.rfc-editor.org/info/rfc9341</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ANRW19-PM-QUIC">[ANRW19-PM-QUIC]</dt>
        <dd>
<span class="refAuthor">Bulgarella, F.</span>, <span class="refAuthor">Cociglio, M.</span>, <span class="refAuthor">Fioccola, G.</span>, <span class="refAuthor">Marchetto, G.</span>, and <span class="refAuthor">R. Sisto</span>, <span class="refTitle">"Performance measurements of QUIC communications"</span>, <span class="refContent">Proceedings of the Applied Networking Research Workshop (ANRW '19), Association for Computing Machinery</span>, <span class="seriesInfo">DOI 10.1145/3340301.3341127</span>, <time class="refDate" datetime="2019-07">July 2019</time>, <span>&lt;<a href="https://doi.org/10.1145/3340301.3341127">https://doi.org/10.1145/3340301.3341127</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7713">[ConEx]</dt>
        <dd>
<span class="refAuthor">Mathis, M.</span> and <span class="refAuthor">B. Briscoe</span>, <span class="refTitle">"Congestion Exposure (ConEx) Concepts, Abstract Mechanism, and Requirements"</span>, <span class="seriesInfo">RFC 7713</span>, <span class="seriesInfo">DOI 10.17487/RFC7713</span>, <time class="refDate" datetime="2015-12">December 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7713">https://www.rfc-editor.org/info/rfc7713</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7786">[ConEx-TCP]</dt>
        <dd>
<span class="refAuthor">Kuehlewind, M., Ed.</span> and <span class="refAuthor">R. Scheffenegger</span>, <span class="refTitle">"TCP Modifications for Congestion Exposure (ConEx)"</span>, <span class="seriesInfo">RFC 7786</span>, <span class="seriesInfo">DOI 10.17487/RFC7786</span>, <time class="refDate" datetime="2016-05">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7786">https://www.rfc-editor.org/info/rfc7786</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-coap-pm">[CORE-COAP-PM]</dt>
        <dd>
<span class="refAuthor">Fioccola, G.</span>, <span class="refAuthor">Zhou, T.</span>, <span class="refAuthor">Nilo, M.</span>, <span class="refAuthor">Milan, F.</span>, and <span class="refAuthor">F. Bulgarella</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Performance Measurement Option"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-coap-pm-01</span>, <time class="refDate" datetime="2023-10-19">19 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pm-01">https://datatracker.ietf.org/doc/html/draft-ietf-core-coap-pm-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.trammell-ippm-spin">[IPPM-SPIN]</dt>
        <dd>
<span class="refAuthor">Trammell, B., Ed.</span>, <span class="refTitle">"An Explicit Transport-Layer Signal for Hybrid RTT Measurement"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-trammell-ippm-spin-00</span>, <time class="refDate" datetime="2019-01-09">9 January 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-trammell-ippm-spin-00">https://datatracker.ietf.org/doc/html/draft-trammell-ippm-spin-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9343">[IPv6AltMark]</dt>
        <dd>
<span class="refAuthor">Fioccola, G.</span>, <span class="refAuthor">Zhou, T.</span>, <span class="refAuthor">Cociglio, M.</span>, <span class="refAuthor">Qin, F.</span>, and <span class="refAuthor">R. Pang</span>, <span class="refTitle">"IPv6 Application of the Alternate-Marking Method"</span>, <span class="seriesInfo">RFC 9343</span>, <span class="seriesInfo">DOI 10.17487/RFC9343</span>, <time class="refDate" datetime="2022-12">December 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9343">https://www.rfc-editor.org/info/rfc9343</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9312">[QUIC-MANAGEABILITY]</dt>
        <dd>
<span class="refAuthor">Kühlewind, M.</span> and <span class="refAuthor">B. Trammell</span>, <span class="refTitle">"Manageability of the QUIC Transport Protocol"</span>, <span class="seriesInfo">RFC 9312</span>, <span class="seriesInfo">DOI 10.17487/RFC9312</span>, <time class="refDate" datetime="2022-09">September 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9312">https://www.rfc-editor.org/info/rfc9312</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.trammell-quic-spin">[QUIC-SPIN]</dt>
        <dd>
<span class="refAuthor">Trammell, B., Ed.</span>, <span class="refAuthor">De Vaere, P.</span>, <span class="refAuthor">Even, R.</span>, <span class="refAuthor">Fioccola, G.</span>, <span class="refAuthor">Fossati, T.</span>, <span class="refAuthor">Ihlar, M.</span>, <span class="refAuthor">Morton, A.</span>, and <span class="refAuthor">S. Emile</span>, <span class="refTitle">"Adding Explicit Passive Measurability of Two-Way Latency to the QUIC Transport Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-trammell-quic-spin-03</span>, <time class="refDate" datetime="2018-05-14">14 May 2018</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-trammell-quic-spin-03">https://datatracker.ietf.org/doc/html/draft-trammell-quic-spin-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9001">[QUIC-TLS]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">S. Turner, Ed.</span>, <span class="refTitle">"Using TLS to Secure QUIC"</span>, <span class="seriesInfo">RFC 9001</span>, <span class="seriesInfo">DOI 10.17487/RFC9001</span>, <time class="refDate" datetime="2021-05">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9001">https://www.rfc-editor.org/info/rfc9001</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8701">[RFC8701]</dt>
        <dd>
<span class="refAuthor">Benjamin, D.</span>, <span class="refTitle">"Applying Generate Random Extensions And Sustain Extensibility (GREASE) to TLS Extensibility"</span>, <span class="seriesInfo">RFC 8701</span>, <span class="seriesInfo">DOI 10.17487/RFC8701</span>, <time class="refDate" datetime="2020-01">January 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8701">https://www.rfc-editor.org/info/rfc8701</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RTT-PRIVACY">[RTT-PRIVACY]</dt>
        <dd>
<span class="refAuthor">Trammell, B.</span> and <span class="refAuthor">M. Kühlewind</span>, <span class="refTitle">"Revisiting the Privacy Implications of Two-Way Internet Latency Data"</span>, <span class="refContent">Passive and Active Measurement, pp. 73-84, Springer International Publishing</span>, <span class="seriesInfo">DOI 10.1007/978-3-319-76481-8_6</span>, <span class="seriesInfo">ISBN 9783319764801</span>, <time class="refDate" datetime="2018-03">March 2018</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-319-76481-8_6">https://doi.org/10.1007/978-3-319-76481-8_6</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9065">[TRANSPORT-ENCRYPT]</dt>
        <dd>
<span class="refAuthor">Fairhurst, G.</span> and <span class="refAuthor">C. Perkins</span>, <span class="refTitle">"Considerations around Transport Header Confidentiality, Network Operations, and the Evolution of Internet Transport Protocols"</span>, <span class="seriesInfo">RFC 9065</span>, <span class="seriesInfo">DOI 10.17487/RFC9065</span>, <time class="refDate" datetime="2021-07">July 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9065">https://www.rfc-editor.org/info/rfc9065</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.trammell-tsvwg-spin">[TSVWG-SPIN]</dt>
        <dd>
<span class="refAuthor">Trammell, B., Ed.</span>, <span class="refTitle">"A Transport-Independent Explicit Signal for Hybrid RTT Measurement"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-trammell-tsvwg-spin-00</span>, <time class="refDate" datetime="2018-07-02">2 July 2018</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-trammell-tsvwg-spin-00">https://datatracker.ietf.org/doc/html/draft-trammell-tsvwg-spin-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tsvwg-udp-options">[UDP-OPTIONS]</dt>
        <dd>
<span class="refAuthor">Touch, J.</span>, <span class="refTitle">"Transport Options for UDP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tsvwg-udp-options-23</span>, <time class="refDate" datetime="2023-09-15">15 September 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tsvwg-udp-options-23">https://datatracker.ietf.org/doc/html/draft-ietf-tsvwg-udp-options-23</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.herbert-udp-space-hdr">[UDP-SURPLUS]</dt>
      <dd>
<span class="refAuthor">Herbert, T.</span>, <span class="refTitle">"UDP Surplus Header"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-herbert-udp-space-hdr-01</span>, <time class="refDate" datetime="2019-07-08">8 July 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-herbert-udp-space-hdr-01">https://datatracker.ietf.org/doc/html/draft-herbert-udp-space-hdr-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank the QUIC WG for their contributions, 
<span class="contact-name">Christian Huitema</span> for implementing Q and L bits in his picoquic stack, and <span class="contact-name">Ike Kunze</span> for
providing constructive reviews and helpful suggestions.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
</section>
</div>
<div id="contributors">
<section id="appendix-B">
      <h2 id="name-contributors">
<a class="section-name selfRef" href="#name-contributors">Contributors</a>
      </h2>
<p id="appendix-B-1">The following people provided valuable contributions to this document:<a class="pilcrow" href="#appendix-B-1">¶</a></p>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Marcus Ihlar</span></div>
<div class="left" dir="auto"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:marcus.ihlar@ericsson.com">marcus.ihlar@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Jari Arkko</span></div>
<div class="left" dir="auto"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:jari.arkko@ericsson.com">jari.arkko@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Emile Stephan</span></div>
<div class="left" dir="auto"><span class="org">Orange</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:emile.stephan@orange.com">emile.stephan@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Dmitri Tikhonov</span></div>
<div class="left" dir="auto"><span class="org">LiteSpeed Technologies</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:dtikhonov@litespeedtech.com">dtikhonov@litespeedtech.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mauro Cociglio</span></div>
<div class="left" dir="auto"><span class="org">Telecom Italia - TIM</span></div>
<div class="left" dir="auto"><span class="street-address">Via Reiss Romoli, 274</span></div>
<div class="left" dir="auto">
<span class="postal-code">10148</span> <span class="locality">Torino</span> </div>
<div class="left" dir="auto"><span class="country-name">Italy</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mauro.cociglio@outlook.com">mauro.cociglio@outlook.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Alexandre Ferrieux</span></div>
<div class="left" dir="auto"><span class="org">Orange Labs</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:alexandre.ferrieux@orange.com">alexandre.ferrieux@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Giuseppe Fioccola</span></div>
<div class="left" dir="auto"><span class="org">Huawei Technologies</span></div>
<div class="left" dir="auto"><span class="street-address">Riesstrasse, 25</span></div>
<div class="left" dir="auto">
<span class="postal-code">80992</span> <span class="locality">Munich</span>
</div>
<div class="left" dir="auto"><span class="country-name">Germany</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:giuseppe.fioccola@huawei.com">giuseppe.fioccola@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Igor Lubashev</span></div>
<div class="left" dir="auto"><span class="org">Akamai Technologies</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ilubashe@akamai.com">ilubashe@akamai.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Fabio Bulgarella</span></div>
<div class="left" dir="auto"><span class="org">Telecom Italia - TIM</span></div>
<div class="left" dir="auto"><span class="street-address">Via Reiss Romoli, 274</span></div>
<div class="left" dir="auto">
<span class="postal-code">10148</span> <span class="locality">Torino</span> </div>
<div class="left" dir="auto"><span class="country-name">Italy</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:fabio.bulgarella@guest.telecomitalia.it">fabio.bulgarella@guest.telecomitalia.it</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Massimo Nilo</span></div>
<div class="left" dir="auto"><span class="org">Telecom Italia - TIM</span></div>
<div class="left" dir="auto"><span class="street-address">Via Reiss Romoli, 274</span></div>
<div class="left" dir="auto">
<span class="postal-code">10148</span> <span class="locality">Torino</span> </div>
<div class="left" dir="auto"><span class="country-name">Italy</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:massimo.nilo@telecomitalia.it">massimo.nilo@telecomitalia.it</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Isabelle Hamchaoui</span></div>
<div class="left" dir="auto"><span class="org">Orange Labs</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:isabelle.hamchaoui@orange.com">isabelle.hamchaoui@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Riccardo Sisto</span></div>
<div class="left" dir="auto"><span class="org">Politecnico di Torino</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:riccardo.sisto@polito.it">riccardo.sisto@polito.it</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>