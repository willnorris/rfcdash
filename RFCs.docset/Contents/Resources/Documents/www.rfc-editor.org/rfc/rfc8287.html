<html><head></head><body><pre>Internet Engineering Task Force (IETF)                     N. Kumar, Ed.
Request for Comments: 8287                             C. Pignataro, Ed.
Category: Standards Track                                          Cisco
ISSN: 2070-1721                                               G. Swallow
                                               Southend Technical Center
                                                                N. Akiya
                                                     Big Switch Networks
                                                                 S. Kini
                                                              Individual
                                                                 M. Chen
                                                                  Huawei
                                                           December 2017


   <span class="h1">Label Switched Path (LSP) Ping/Traceroute for Segment Routing (SR)</span>
        <span class="h1">IGP-Prefix and IGP-Adjacency Segment Identifiers (SIDs)</span>
                         <span class="h1">with MPLS Data Planes</span>

Abstract

   A Segment Routing (SR) architecture leverages source routing and
   tunneling paradigms and can be directly applied to the use of a
   Multiprotocol Label Switching (MPLS) data plane.  A node steers a
   packet through a controlled set of instructions called "segments" by
   prepending the packet with an SR header.

   The segment assignment and forwarding semantic nature of SR raises
   additional considerations for connectivity verification and fault
   isolation for a Label Switched Path (LSP) within an SR architecture.
   This document illustrates the problem and defines extensions to
   perform LSP Ping and Traceroute for Segment Routing IGP-Prefix and
   IGP-Adjacency Segment Identifiers (SIDs) with an MPLS data plane.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc7841#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8287">https://www.rfc-editor.org/info/rfc8287</a>.





<span class="grey">Kumar, et al.                Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Kumar, et al.                Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     1.1.  Coexistence of SR-Capable and Non-SR-Capable Node
           Scenarios . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-2">2</a>.  Requirements Notation . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Challenges with Existing Mechanisms . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.1">4.1</a>.  Path Validation in Segment Routing Networks . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  Segment ID Sub-TLV  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.1">5.1</a>.  IPv4 IGP-Prefix Segment ID  . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.2">5.2</a>.  IPv6 IGP-Prefix Segment ID  . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-5.3">5.3</a>.  IGP-Adjacency Segment ID  . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-6">6</a>.  Extension to Downstream Detailed Mapping TLV  . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  Procedures  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-7.1">7.1</a>.  FECs in Target FEC Stack TLV  . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-7.2">7.2</a>.  FEC Stack Change Sub-TLV  . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.3">7.3</a>.  Segment ID POP Operation  . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.4">7.4</a>.  Segment ID Check  . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.5">7.5</a>.  TTL Consideration for Traceroute  . . . . . . . . . . . .  <a href="#page-19">19</a>
   <a href="#section-8">8</a>.  Backward Compatibility with Non-SR Devices  . . . . . . . . .  <a href="#page-19">19</a>
   <a href="#section-9">9</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
     <a href="#section-9.1">9.1</a>.  New Target FEC Stack Sub-TLVs . . . . . . . . . . . . . .  <a href="#page-20">20</a>
     <a href="#section-9.2">9.2</a>.  Protocol in the Segment ID Sub-TLV  . . . . . . . . . . .  <a href="#page-20">20</a>
     <a href="#section-9.3">9.3</a>.  Adjacency Type in the IGP-Adjacency Segment ID  . . . . .  <a href="#page-20">20</a>
     9.4.  Protocol in the Label Stack Sub-TLV of the Downstream
           Detailed Mapping TLV  . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
     <a href="#section-9.5">9.5</a>.  Return Code . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   <a href="#section-10">10</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   <a href="#section-11">11</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
     <a href="#section-11.1">11.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
     <a href="#section-11.2">11.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-24">24</a>
   Contributors  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-24">24</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
















<span class="grey">Kumar, et al.                Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   "Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"
   [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] defines a simple and efficient mechanism to detect data-
   plane failures in Label Switched Paths (LSPs) by specifying
   information to be carried in an MPLS "echo request" and "echo reply"
   for the purposes of fault detection and isolation.  Mechanisms for
   reliably sending the echo reply are defined.  The functionality
   defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] is modeled after the Ping/Traceroute paradigm
   (ICMP echo request [<a href="./rfc792" title='"Internet Control Message Protocol"'>RFC792</a>]) and is typically referred to as "LSP
   Ping" and "LSP Traceroute".  [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] supports hierarchical and
   stitching LSPs.

   [<a id="ref-SR">SR</a>] introduces and describes an SR architecture that leverages the
   source routing and tunneling paradigms.  A node steers a packet
   through a controlled set of instructions called "segments" by
   prepending the packet with an SR header.  A detailed definition of
   the SR architecture is available in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>].

   As described in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>] and [<a href="#ref-SR-MPLS" title='"Segment Routing with MPLS data plane"'>SR-MPLS</a>], the SR architecture can be
   directly applied to an MPLS data plane, the SID will be 20 bits, and
   the SR header is the label stack.  Consequently, the mechanics of
   data-plane validation of [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] can be directly applied to SR
   MPLS.

   Unlike LDP or RSVP, which are the other well-known MPLS control plane
   protocols, the basis of Segment ID assignment in SR architecture is
   not always on a hop-by-hop basis.  Depending on the type of Segment
   ID, the assignment can be unique to the node or within a domain.

   This nature of SR raises additional considerations for validation of
   fault detection and isolation in an SR network.  This document
   illustrates the problem and describes a mechanism to perform LSP Ping
   and Traceroute for Segment Routing IGP-Prefix and IGP-Adjacency SIDs
   within an MPLS data plane.
















<span class="grey">Kumar, et al.                Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Coexistence%20of%20SR-Capable%20and%20Non-SR-Capable%20Node%20Scenarios"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Coexistence of SR-Capable and Non-SR-Capable Node Scenarios</span>

   [<a id="ref-INTEROP">INTEROP</a>] describes how SR operates in a network where SR-capable and
   non-SR-capable nodes coexist.  In such a network, one or more
   SR-based LSPs and non-SR-based LSPs are stitched together to achieve
   an end-to-end LSP.  This is similar to a network where LDP and RSVP
   nodes coexist and the mechanism defined in <a href="./rfc8029#section-4.5.2">Section 4.5.2 of [RFC8029]</a>
   is applicable for LSP Ping and Trace.

   <a href="#section-8">Section 8</a> of this document explains one of the potential gaps that is
   specific to SR-Capable and non-SR-capable node scenarios and explains
   how the existing mechanism defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] handles it.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Requirements%20Notation"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Requirements Notation</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="./rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Terminology"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Terminology</span>

   This document uses the terminology defined in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>] and [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>];
   readers are expected to be familiar with those terms.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Challenges%20with%20Existing%20Mechanisms"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Challenges with Existing Mechanisms</span>

   The following example describes the challenges with using the current
   MPLS Operations, Administration, and Maintenance (OAM) mechanisms on
   an SR network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Path%20Validation%20in%20Segment%20Routing%20Networks"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Path Validation in Segment Routing Networks</span>

   [<a id="ref-RFC8029">RFC8029</a>] defines the MPLS OAM mechanisms that help with fault
   detection and isolation for an MPLS data-plane path by the use of
   various Target Forwarding Equivalence Class (FEC) Stack sub-TLVs that
   are carried in MPLS echo request packets and used by the responder
   for FEC validation.  While it is obvious that new sub-TLVs need to be
   assigned for SR, the unique nature of the SR architecture raises the
   need for additional operational considerations for path validation.
   This section discusses the challenges.









<span class="grey">Kumar, et al.                Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


                        L1
                    +--------+
                    |   L2   |
                    R3-------R6
                   /           \
                  /             \
          R1----R2               R7----R8
                  \             /
                   \           /
                    R4-------R5

            Figure 1: Segment Routing Network

   The Node Segment IDs for R1, R2, R3, R4, R5, R6, R7, and R8 are 5001,
   5002, 5003, 5004, 5005, 5006, 5007, and 5008, respectively.

      9136 --&gt; Adjacency Segment ID from R3 to R6 over link L1.
      9236 --&gt; Adjacency Segment ID from R3 to R6 over link L2.
      9124 --&gt; Adjacency segment ID from R2 to R4.
      9123 --&gt; Adjacency Segment ID from R2 to R3.

   The forwarding semantic of the Adjacency Segment ID is to pop the
   Segment ID and send the packet to a specific neighbor over a specific
   link.  A malfunctioning node may forward packets using the Adjacency
   Segment ID to an incorrect neighbor or over an incorrect link.  The
   exposed Segment ID (of an incorrectly forwarded Adjacency Segment ID)
   might still allow such a packet to reach the intended destination,
   even though the intended strict traversal was broken.

   In the topology above, assume that R1 sends traffic with a segment
   stack as {9124, 5008} so that the path taken will be
   R1-R2-R4-R5-R7-R8.  If the Adjacency Segment ID 9124 is misprogrammed
   in R2 to send the packet to R1 or R3, the packet may still be
   delivered to R8 (if the nodes are configured with the same SR Global
   Block (SRGB)) [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>] but not via the expected path.

   MPLS traceroute may help with detecting such a deviation in the
   above-mentioned scenario.  However, in a different example, it may
   not be helpful, for example, if R3 forwards a packet with Adjacency
   Segment ID 9236 via link L1 (due to misprogramming) when it was
   expected to be forwarded over link L2.










<span class="grey">Kumar, et al.                Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Segment%20ID%20Sub-TLV"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Segment ID Sub-TLV</span>

   The format of the following Segment ID sub-TLVs follows the
   philosophy of the Target FEC Stack TLV carrying FECs corresponding to
   each label in the label stack.  When operated with the procedures
   defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>], this allows LSP Ping/Traceroute operations to
   function when the Target FEC Stack TLV contains more FECs than
   received label stacks at the responder nodes.

   Three new sub-TLVs are defined for the Target FEC Stack TLV (Type 1),
   the Reverse-Path Target FEC Stack TLV (Type 16), and the Reply Path
   TLV (Type 21).

           Sub-Type    Sub-TLV Name
           --------  ---------------
             34      IPv4 IGP-Prefix Segment ID
             35      IPv6 IGP-Prefix Segment ID
             36      IGP-Adjacency Segment ID

   See <a href="#section-9.2">Section 9.2</a> for the registry for the Protocol field specified
   within these sub-TLVs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20IPv4%20IGP-Prefix%20Segment%20ID"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  IPv4 IGP-Prefix Segment ID</span>

   The IPv4 IGP-Prefix Segment ID is defined in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>].  The format is as
   specified below:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         IPv4 Prefix                           |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |Prefix Length  |    Protocol   |         Reserved              |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IPv4 Prefix

      This field carries the IPv4 Prefix to which the Segment ID is
      assigned.  In case of an Anycast Segment ID, this field will carry
      the IPv4 Anycast address.  If the prefix is shorter than 32 bits,
      trailing bits SHOULD be set to zero.

   Prefix Length

      The Prefix Length field is one octet.  It gives the length of the
      prefix in bits (values can be 1-32).





<span class="grey">Kumar, et al.                Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


   Protocol

      This field is set to 1, if the responder MUST perform FEC
      validation using OSPF as the IGP protocol.  Set to 2, if the
      responder MUST perform Egress FEC validation using the
      Intermediate System to Intermediate System (IS-IS) as the IGP
      protocol.  Set to 0, if the responder can use any IGP protocol for
      Egress FEC validation.

   Reserved

      The Reserved field MUST be set to 0 when sent and MUST be ignored
      on receipt.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20IPv6%20IGP-Prefix%20Segment%20ID"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  IPv6 IGP-Prefix Segment ID</span>

   The IPv6 IGP-Prefix Segment ID is defined in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>].  The format is as
   specified below:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                                                               |
     |                         IPv6 Prefix                           |
     |                                                               |
     |                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |Prefix Length  |    Protocol   |              Reserved         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   IPv6 Prefix

      This field carries the IPv6 prefix to which the Segment ID is
      assigned.  In case of an Anycast Segment ID, this field will carry
      the IPv4 Anycast address.  If the prefix is shorter than 128 bits,
      trailing bits SHOULD be set to zero.

   Prefix Length

      The Prefix Length field is one octet, it gives the length of the
      prefix in bits (values can be 1-128).










<span class="grey">Kumar, et al.                Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


   Protocol

      Set to 1 if the responder MUST perform FEC validation using OSPF
      as the IGP protocol.  Set to 2 if the responder MUST perform
      Egress FEC validation using IS-IS as the IGP protocol.  Set to 0
      if the responder can use any IGP protocol for Egress FEC
      validation.

   Reserved

      MUST be set to 0 on send and MUST be ignored on receipt.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20IGP-Adjacency%20Segment%20ID"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  IGP-Adjacency Segment ID</span>

   This sub-TLV is applicable for any IGP-Adjacency defined in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>].
   The format is as specified below:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |   Adj. Type   |    Protocol   |          Reserved             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~                                                               ~
     |               Local Interface ID (4 or 16 octets)             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~                                                               ~
     |              Remote Interface ID (4 or 16 octets)             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~                                                               ~
     |          Advertising Node Identifier (4 or 6 octets)          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~                                                               ~
     |           Receiving Node Identifier (4 or 6 octets)           |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Adj. Type (Adjacency Type)

      Set to 1 when the Adjacency Segment is a Parallel Adjacency as
      defined in [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>].  Set to 4 when the Adjacency Segment is IPv4
      based and is not a Parallel Adjacency.  Set to 6 when the
      Adjacency Segment is IPv6 based and is not a Parallel Adjacency.
      Set to 0 when the Adjacency Segment is over an unnumbered
      interface.








<span class="grey">Kumar, et al.                Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


   Protocol

      Set to 1 if the responder MUST perform FEC validation using OSPF
      as the IGP protocol.  Set to 2 if the responder MUST perform
      Egress FEC validation using IS-IS as the IGP protocol.  Set to 0
      if the responder can use any IGP protocol for Egress FEC
      validation.

   Reserved

      MUST be set to 0 on send and MUST be ignored on receipt.

   Local Interface ID

      An identifier that is assigned by the local Label Switching Router
      (LSR) for a link to which the Adjacency Segment ID is bound.  This
      field is set to a local link address (IPv4 or IPv6).  For IPv4,
      this field is 4 octets; for IPv6, this field is 16 octets.  If
      unnumbered, this field is 4 octets and includes a 32-bit link
      identifier as defined in [<a href="./rfc4203" title='"OSPF Extensions in Support of Generalized Multi-Protocol Label Switching (GMPLS)"'>RFC4203</a>] and [<a href="./rfc5307" title='"IS-IS Extensions in Support of Generalized Multi-Protocol Label Switching (GMPLS)"'>RFC5307</a>].  If the
      Adjacency Segment ID represents Parallel Adjacencies [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>], this
      field is 4 octets and MUST be set to 4 octets of zeroes.

   Remote Interface ID

      An identifier that is assigned by the remote LSR for a link on
      which the Adjacency Segment ID is bound.  This field is set to the
      remote (downstream neighbor) link address (IPv4 or IPv6).  For
      IPv4, this field is 4 octets; for IPv6, this field is 16 octets.
      If unnumbered, this field is 4 octets and includes a 32-bit link
      identifier as defined in [<a href="./rfc4203" title='"OSPF Extensions in Support of Generalized Multi-Protocol Label Switching (GMPLS)"'>RFC4203</a>] and [<a href="./rfc5307" title='"IS-IS Extensions in Support of Generalized Multi-Protocol Label Switching (GMPLS)"'>RFC5307</a>].  If the
      Adjacency Segment ID represents Parallel Adjacencies [<a href="#ref-SR" title='"Segment Routing Architecture"'>SR</a>], this
      field is 4 octets and MUST be set to 4 octets of zeroes.

   Advertising Node Identifier

      This specifies the Advertising Node Identifier.  When the Protocol
      field is set to 1, then this field is 4 octets and carries the
      32-bit OSPF Router ID.  If the Protocol field is set to 2, then
      this field is 6 octets and carries the 48-bit IS-IS System ID.  If
      the Protocol field is set to 0, then this field is 4 octets and
      MUST be set to zero.









<span class="grey">Kumar, et al.                Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


   Receiving Node Identifier

      This specifies the downstream node identifier.  When the Protocol
      field is set to 1, then this field is 4 octets and carries the
      32-bit OSPF Router ID.  If the Protocol field is set to 2, then
      this field is 6 octets and carries the 48-bit IS-IS System ID.  If
      the Protocol field is set to 0, then this field is 4 octets and
      MUST be set to zero.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Extension%20to%20Downstream%20Detailed%20Mapping%20TLV"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Extension to Downstream Detailed Mapping TLV</span>

   In an echo reply, the Downstream Detailed Mapping TLV [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] is
   used to report for each interface over which a FEC could be
   forwarded.  For a FEC, there are multiple protocols that may be used
   to distribute label mapping.  The Protocol field of the Downstream
   Detailed Mapping TLV is used to return the protocol that is used to
   distribute the label carried in the Downstream Label field.  The
   following protocols are defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>]:

      Protocol #        Signaling Protocol
      ----------        ------------------
        0               Unknown
        1               Static
        2               BGP
        3               LDP
        4               RSVP-TE

   With SR, OSPF or IS-IS can be used for label distribution.  This
   document adds two new protocols as follows:

      Protocol #        Signaling Protocol
      ----------        ------------------
        5               OSPF
        6               IS-IS

   See <a href="#section-9.4">Section 9.4</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Procedures"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Procedures</span>

   This section describes aspects of LSP Ping and Traceroute operations
   that require further considerations beyond [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20FECs%20in%20Target%20FEC%20Stack%20TLV"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  FECs in Target FEC Stack TLV</span>

   When LSP echo request packets are generated by an initiator, FECs
   carried in the Target FEC Stack TLV may need to differ to support an
   SR architecture.  The following defines the Target FEC Stack TLV
   construction mechanics by an initiator for SR scenarios.



<span class="grey">Kumar, et al.                Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


      Ping

         The initiator MUST include FEC(s) corresponding to the
         destination segment.

         The initiator MAY include FECs corresponding to some or all of
         the segments imposed in the label stack by the initiator to
         communicate the segments traversed.

      Traceroute

         The initiator MUST initially include FECs corresponding to all
         segments imposed in the label stack.

         When a received echo reply contains the FEC Stack Change TLV
         with one or more of the original segments being popped, the
         initiator MAY remove a corresponding FEC(s) from the Target FEC
         Stack TLV in the next (TTL+1) traceroute request, as defined in
         <a href="./rfc8029#section-4.6">Section 4.6 of [RFC8029]</a>.

         When a received echo reply does not contain the FEC Stack
         Change TLV, the initiator MUST NOT attempt to remove any FECs
         from the Target FEC Stack TLV in the next (TTL+1) traceroute
         request.

   As defined in [<a href="#ref-SR-OSPF" title='"OSPF Extensions for Segment Routing"'>SR-OSPF</a>] and [<a href="#ref-SR-IS-IS" title='"IS-IS Extensions for Segment Routing"'>SR-IS-IS</a>], the Prefix SID can be
   advertised as an absolute value, an index, or as a range.  In any of
   these cases, the initiator MUST derive the Prefix mapped to the
   Prefix SID and use it in the IGP-Prefix Segment ID defined in
   Sections <a href="#section-5.1">5.1</a> and <a href="#section-5.2">5.2</a>.  How the responder uses the details in the
   SR-FEC sub-TLV to perform the validation is a local implementation
   matter.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20FEC%20Stack%20Change%20Sub-TLV"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  FEC Stack Change Sub-TLV</span>

   [<a id="ref-RFC8029">RFC8029</a>] defines a FEC Stack Change sub-TLV that a router must
   include when the FEC stack changes.

   The network node that advertised the Node Segment ID is responsible
   for generating a FEC Stack Change sub-TLV with the Post Office
   Protocol (POP) operation type for the Node Segment ID, regardless of
   whether or not Penultimate Hop Popping (PHP) is enabled.

   The network node that is immediately downstream of the node that
   advertised the Adjacency Segment ID is responsible for generating the
   FEC Stack Change sub-TLV for POP operation for the Adjacency Segment
   ID.




<span class="grey">Kumar, et al.                Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.3.%20%20Segment%20ID%20POP%20Operation"></a><a class="selflink" href="#section-7.3" id="section-7.3">7.3</a>.  Segment ID POP Operation</span>

   The forwarding semantic of the Node Segment ID with the PHP flag is
   equivalent to usage of Implicit Null in MPLS protocols.  The
   Adjacency Segment ID is also similar in a sense that it can be
   thought of as a locally allocated segment that has PHP enabled when
   destined for the next-hop IGP Adjacency Node.  Procedures described
   in <a href="./rfc8029#section-4.4">Section 4.4 of [RFC8029]</a> rely on the Stack-D and Stack-R
   explicitly having the Implicit Null value.  Implementations SHOULD
   use the Implicit Null for the Node Segment ID PHP and Adjacency
   Segment ID PHP cases.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.4.%20%20Segment%20ID%20Check"></a><a class="selflink" href="#section-7.4" id="section-7.4">7.4</a>.  Segment ID Check</span>

   This section modifies the procedure defined in <a href="./rfc8029#section-4.4.1">Section 4.4.1 of
   [RFC8029]</a>.  Step 4 defined in <a href="./rfc8029#section-4.4.1">Section 4.4.1 of [RFC8029]</a> is modified
   as below:

        4. If the label mapping for FEC is Implicit Null, set the
           FEC-status to 2 and proceed to step 4a.  Otherwise,
           if the label mapping for FEC is Label-L, proceed to step 4a.
           Otherwise, set the FEC-return-code to 10 ("Mapping for this
           FEC is not the given label at stack-depth"), set the
           FEC-status to 1, and return.

       4a. Segment Routing IGP-Prefix and IGP-Adjacency SID Validation:

         If the Label-stack-depth is 0 and the Target FEC Stack sub-TLV
         at FEC-stack-depth is 34 (IPv4 IGP-Prefix Segment ID), {

            Set the Best-return-code to 10, "Mapping for this FEC is not
            the given label at stack-depth &lt;RSC&gt;" if any below
            conditions fail:

            /* The responder LSR is to check if it is the egress of the
            IPv4 IGP-Prefix Segment ID described in the Target FEC Stack
            sub-TLV, and if the FEC was advertised with the PHP bit
            set.*/

            -  Validate that the Node Segment ID is advertised for the
               IPv4 Prefix by IGP Protocol {

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 0, use any locally
                  enabled IGP protocol.






<span class="grey">Kumar, et al.                Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 1, use OSPF as the IGP
                  protocol.

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 2, use IS-IS as the IGP
                  protocol.

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is an unrecognized value, it
                  MUST be treated as a Protocol value of 0.

               }

            -  Validate that the Node Segment ID is advertised with the
               No-PHP flag. {

               o  When the Protocol is OSPF, the NP-Flag defined in
                  Section 5 of [<a href="#ref-SR-OSPF" title='"OSPF Extensions for Segment Routing"'>SR-OSPF</a>] MUST be set to 0.

               o  When the Protocol is IS-IS, the P-Flag defined in
                  Section 6.1 of [<a href="#ref-SR-IS-IS" title='"IS-IS Extensions for Segment Routing"'>SR-IS-IS</a>] MUST be set to 0.

               }

            If it can be determined that no protocol associated with the
            Interface-I would have advertised the FEC-Type at FEC-stack-
            depth, set the Best-return-code to 12, "Protocol not
            associated with interface at FEC-stack-depth" and return.

            Set FEC-Status to 1 and return.

         }

         Else, if the Label-stack-depth is greater than 0 and the Target
         FEC Stack sub-TLV at FEC-stack-depth is 34 (IPv4 IGP-Prefix
         Segment ID), {

            Set the Best-return-code to 10 if any below conditions fail:

            -  Validate that the Node Segment ID is advertised for the
               IPv4 Prefix by the IGP protocol {

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 0, use any locally
                  enabled IGP protocol.





<span class="grey">Kumar, et al.                Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 1, use OSPF as the IGP
                  protocol.

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is 2, use IS-IS as the IGP
                  protocol.

               o  When the Protocol field in the received IPv4 IGP-
                  Prefix Segment ID sub-TLV is an unrecognized value, it
                  MUST be treated as a Protocol value of 0.

               }

            If it can be determined that no protocol associated with
            Interface-I would have advertised the FEC-Type at FEC-stack-
            depth, set the Best-return-code to 12, "Protocol not
            associated with interface at FEC stack-depth" and return.

            Set FEC-Status to 1 and return.

         }

         Else, if the Label-stack-depth is 0 and the Target FEC sub-TLV
         at FEC-stack-depth is 35 (IPv6 IGP-Prefix Segment ID), {

            Set the Best-return-code to 10 if any of the below
            conditions fail:

            /* The LSR needs to check if it is being a tail-end for the
            LSP and have the prefix advertised with the PHP bit set*/

            -  Validate that the Node Segment ID is advertised for the
               IPv6 Prefix by the IGP protocol {

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 0, use any locally
                  enabled IGP protocol.

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 1, use OSPF as the IGP
                  protocol.

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 2, use IS-IS as the IGP
                  protocol.





<span class="grey">Kumar, et al.                Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is an unrecognized value, it
                  MUST be treated as a Protocol value of 0.

               }

            -  Validate that the Node Segment ID is advertised with the
               No-PHP flag. {

               o  When the Protocol is OSPF, the NP-flag defined in
                  Section 5 of [<a href="#ref-SR-OSPFV3">SR-OSPFV3</a>] MUST be set to 0.

               o  When the Protocol is IS-IS, the P-Flag defined in
                  Section 6.1 of [<a href="#ref-SR-IS-IS" title='"IS-IS Extensions for Segment Routing"'>SR-IS-IS</a>] MUST be set to 0.

               }

            If it can be determined that no protocol associated with
            Interface-I would have advertised the FEC-Type at FEC-stack-
            depth, set the Best-return-code to 12, "Protocol not
            associated with interface at FEC stack-depth" and return.

            Set the FEC-Status to 1 and return.

         }

         Else, if the Label-stack-depth is greater than 0 and the Target
         FEC sub-TLV at FEC-stack-depth is 35 (IPv6 IGP-Prefix Segment
         ID), {

            Set the Best-return-code to 10 if any below conditions fail:

            -  Validate that the Node Segment ID is advertised for the
               IPv4 Prefix by the IGP protocol {

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 0, use any locally
                  enabled IGP protocol.

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 1, use OSPF as the IGP
                  protocol.

               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is 2, use IS-IS as the IGP
                  protocol.





<span class="grey">Kumar, et al.                Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


               o  When the Protocol field in the received IPv6 IGP-
                  Prefix Segment ID sub-TLV is an unrecognized value, it
                  MUST be treated as a Protocol value of 0.

               }

            If it can be determined that no protocol associated with
            Interface-I would have advertised the FEC-Type at FEC-stack-
            depth, set the Best-return-code to 12, "Protocol not
            associated with interface at FEC stack-depth" and return.

            Set the FEC-Status to 1 and return.

         }

         Else, if the Target FEC sub-TLV at FEC-stack-depth is 36
         (IGP-Adjacency Segment ID), {

            Set the Best-return-code to 35 (<a href="#section-9.5">Section 9.5</a>) if any below
            conditions fail:

               When the Adj. Type is 1 (Parallel Adjacency):

               o  Validate that the Receiving Node Identifier is the
                  local IGP identifier.

               o  Validate that the IGP-Adjacency Segment ID is
                  advertised by the Advertising Node Identifier of the
                  Protocol in the local IGP database {

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 0, use any locally
                     enabled IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 1, use OSPF as the
                     IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 2, use IS-IS as the
                     IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is an unrecognized
                     value, it MUST be treated as a Protocol value of 0.

                  }




<span class="grey">Kumar, et al.                Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


               When the Adj. Type is 4 or 6 (IGP Adjacency or LAN
               Adjacency):

               o  Validate that the Remote Interface ID matches the
                  local identifier of the interface (Interface-I) on
                  which the packet was received.

               o  Validate that the Receiving Node Identifier is the
                  local IGP identifier.

               o  Validate that the IGP-Adjacency Segment ID is
                  advertised by the Advertising Node Identifier of
                  Protocol in the local IGP database {

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 0, use any locally
                     enabled IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 1, use OSPF as the
                     IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is 2, use IS-IS as the
                     IGP protocol.

                  *  When the Protocol field in the received IGP-
                     Adjacency Segment ID sub-TLV is an unrecognized
                     value, it MUST be treated as a Protocol value of 0.

                  }

            Set the FEC-Status to 1 and return.

         }
















<span class="grey">Kumar, et al.                Standards Track                   [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.5.%20%20TTL%20Consideration%20for%20Traceroute"></a><a class="selflink" href="#section-7.5" id="section-7.5">7.5</a>.  TTL Consideration for Traceroute</span>

   The LSP Traceroute operation can properly traverse every hop of the
   SR network for the Uniform Model as described in [<a href="./rfc3443" title='"Time To Live (TTL) Processing in Multi-Protocol Label Switching (MPLS) Networks"'>RFC3443</a>].  If one
   or more LSRs employ a Short Pipe Model, as described in [<a href="./rfc3443" title='"Time To Live (TTL) Processing in Multi-Protocol Label Switching (MPLS) Networks"'>RFC3443</a>],
   then the LSP Traceroute may not be able to properly traverse every
   hop of the SR network due to the absence of TTL copy operation when
   the outer label is popped.  The Short Pipe is one of the most
   commonly used models.  The following TTL manipulation technique MAY
   be used when the Short Pipe Model is used.

   When tracing an LSP according to the procedures in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>], the TTL
   is incremented by one in order to trace the path sequentially along
   the LSP.  However, when a source-routed LSP has to be traced, there
   are as many TTLs as there are labels in the stack.  The LSR that
   initiates the traceroute SHOULD start by setting the TTL to 1 for the
   tunnel in the LSP's label stack it wants to start the tracing from,
   the TTL of all outer labels in the stack to the max value, and the
   TTL of all the inner labels in the stack to zero.  Thus, a typical
   start to the traceroute would have a TTL of 1 for the outermost label
   and all the inner labels would have a TTL of 0.  If the FEC Stack TLV
   is included, it should contain only those for the inner-stacked
   tunnels.  The Return Code/Subcode and FEC Stack Change TLV should be
   used to diagnose the tunnel as described in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>].  When the
   tracing of a tunnel in the stack is complete, then the next tunnel in
   the stack should be traced.  The end of a tunnel can be detected from
   the Return Code when it indicates that the responding LSR is an
   egress for the stack at depth 1.  Thus, the traceroute procedures in
   [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] can be recursively applied to traceroute a source-routed
   LSP.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Backward%20Compatibility%20with%20Non-SR%20Devices"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Backward Compatibility with Non-SR Devices</span>

   [<a id="ref-INTEROP">INTEROP</a>] describes how SR operates in a network where SR-capable and
   non-SR-capable nodes coexist.  In such networks, there may not be any
   FEC mapping in the responder when the initiator is SR-capable, while
   the responder is not (or vice-versa).  But this is not different from
   RSVP and LDP interoperation scenarios.  When LSP Ping is triggered,
   the responder will set the FEC-return-code to Return 4, "Replying
   router has no mapping for the FEC at stack-depth".

   Similarly, when an SR-capable node assigns Adj-SID for a non-SR-
   capable node, the LSP traceroute may fail as the non-SR-capable node
   is not aware of the "IGP Adjacency Segment ID" sub-TLV and may not
   reply with the FEC Stack Change sub-TLVs.  This may result in any
   further downstream nodes replying back with a Return Code of 4,
   "Replying router has no mapping for the FEC at stack-depth".




<span class="grey">Kumar, et al.                Standards Track                   [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20New%20Target%20FEC%20Stack%20Sub-TLVs"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  New Target FEC Stack Sub-TLVs</span>

   IANA has assigned three new sub-TLVs from the "sub-TLVs for TLV Types
   1, 16, and 21" subregistry of the "Multi-Protocol Label Switching
   (MPLS) Label Switched Paths (LSPs) Ping Parameters" registry [<a href="#ref-IANA" title='"Multi-Protocol Label Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters"'>IANA</a>].

   Sub-Type    Sub-TLV Name                 Reference
   --------    -----------------            ------------
     34        IPv4 IGP-Prefix Segment ID   <a href="#section-5.1">Section 5.1</a>
     35        IPv6 IGP-Prefix Segment ID   <a href="#section-5.2">Section 5.2</a>
     36        IGP-Adjacency Segment ID     <a href="#section-5.3">Section 5.3</a>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Protocol%20in%20the%20Segment%20ID%20Sub-TLV"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Protocol in the Segment ID Sub-TLV</span>

   IANA has created a new "Protocol in the Segment ID sub-TLV" (see
   <a href="#section-5">Section 5</a>) registry under the "Multi-Protocol Label Switching (MPLS)
   Label Switched Paths (LSPs) Ping Parameters" registry.  Code points
   in the range of 0-250 will be assigned by Standards Action [<a href="./rfc8126" title="">RFC8126</a>].
   The range of 251-254 is reserved for experimental use and will not be
   assigned.  The value of 255 is marked "Reserved".  The initial
   entries into the registry are:

     Value           Meaning              Reference
   ----------        ----------------     ------------
     0               Any IGP protocol     This document
     1               OSPF                 This document
     2               IS-IS                This document

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.3.%20%20Adjacency%20Type%20in%20the%20IGP-Adjacency%20Segment%20ID"></a><a class="selflink" href="#section-9.3" id="section-9.3">9.3</a>.  Adjacency Type in the IGP-Adjacency Segment ID</span>

   IANA has created a new "Adjacency Type in the IGP-Adjacency Segment
   ID" registry (see <a href="#section-5.3">Section 5.3</a>) under the "Multi-Protocol Label
   Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters"
   registry.  Code points in the range of 0-250 will be assigned by
   Standards Action.  The range of 251-254 is reserved for experimental
   use and will not be assigned.  The value of 255 is marked "Reserved".
   The initial entries into the registry are:

     Value           Meaning
   ----------        ----------------
     0               Unnumbered Interface Adjacency
     1               Parallel Adjacency
     4               IPv4, Non-parallel Adjacency
     6               IPv6, Non-parallel Adjacency





<span class="grey">Kumar, et al.                Standards Track                   [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.4.%20%20Protocol%20in%20the%20Label%20Stack%20Sub-TLV%20of%20the%20Downstream%20Detailed"></a><a class="selflink" href="#section-9.4" id="section-9.4">9.4</a>.  Protocol in the Label Stack Sub-TLV of the Downstream Detailed</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/Mapping%20TLV"></a>      Mapping TLV</span>

   IANA has created a new "Protocol in the Label Stack sub-TLV of the
   Downstream Detailed Mapping TLV" registry under the "Multi-Protocol
   Label Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters"
   registry.  Code points in the range of 0-250 will be assigned by
   Standards Action.  The range of 251-254 is reserved for experimental
   use and will not be assigned.  The value of 255 is marked "Reserved".
   The initial entries into the registry are:

     Value        Meaning              Reference
   ----------     ----------------     ------------
     0            Unknown              <a href="./rfc8029#section-3.4.1.2">Section 3.4.1.2 of RFC 8029</a>
     1            Static               <a href="./rfc8029#section-3.4.1.2">Section 3.4.1.2 of RFC 8029</a>
     2            BGP                  <a href="./rfc8029#section-3.4.1.2">Section 3.4.1.2 of RFC 8029</a>
     3            LDP                  <a href="./rfc8029#section-3.4.1.2">Section 3.4.1.2 of RFC 8029</a>
     4            RSVP-TE              <a href="./rfc8029#section-3.4.1.2">Section 3.4.1.2 of RFC 8029</a>
     5            OSPF                 <a href="#section-6">Section 6</a> of this document
     6            IS-IS                <a href="#section-6">Section 6</a> of this document
     7-250        Unassigned
     251-254      Reserved for
                  Experimental Use     This document
     255          Reserved             This document

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.5.%20%20Return%20Code"></a><a class="selflink" href="#section-9.5" id="section-9.5">9.5</a>.  Return Code</span>

   IANA has assigned a new Return Code from the "Multi-Protocol Label
   Switching (MPLS) Label Switched Paths (LSPs) Ping Parameters" in the
   0-191 (Standards Action) range from the "Return Codes" subregistry.

     Value     Meaning                                  Reference
   ----------  -----------------                        ------------
     35        Mapping for this FEC is not associated   <a href="#section-7.4">Section 7.4</a> of
               with the incoming interface              this document

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Security Considerations</span>

   This document defines additional MPLS LSP Ping sub-TLVs and follows
   the mechanisms defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>].  All the security considerations
   defined in [<a href="./rfc8029" title='"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"'>RFC8029</a>] will be applicable for this document and, in
   addition, they do not impose any additional security challenges to be
   considered.








<span class="grey">Kumar, et al.                Standards Track                   [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20References"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" id="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3443">RFC3443</a>]  Agarwal, P. and B. Akyol, "Time To Live (TTL) Processing
              in Multi-Protocol Label Switching (MPLS) Networks",
              <a href="./rfc3443">RFC 3443</a>, DOI 10.17487/RFC3443, January 2003,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3443">https://www.rfc-editor.org/info/rfc3443</a>&gt;.

   [<a id="ref-RFC4203">RFC4203</a>]  Kompella, K., Ed. and Y. Rekhter, Ed., "OSPF Extensions in
              Support of Generalized Multi-Protocol Label Switching
              (GMPLS)", <a href="./rfc4203">RFC 4203</a>, DOI 10.17487/RFC4203, October 2005,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4203">https://www.rfc-editor.org/info/rfc4203</a>&gt;.

   [<a id="ref-RFC5307">RFC5307</a>]  Kompella, K., Ed. and Y. Rekhter, Ed., "IS-IS Extensions
              in Support of Generalized Multi-Protocol Label Switching
              (GMPLS)", <a href="./rfc5307">RFC 5307</a>, DOI 10.17487/RFC5307, October 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5307">https://www.rfc-editor.org/info/rfc5307</a>&gt;.

   [<a id="ref-RFC8029">RFC8029</a>]  Kompella, K., Swallow, G., Pignataro, C., Ed., Kumar, N.,
              Aldrin, S., and M. Chen, "Detecting Multiprotocol Label
              Switched (MPLS) Data-Plane Failures", <a href="./rfc8029">RFC 8029</a>,
              DOI 10.17487/RFC8029, March 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8029">https://www.rfc-editor.org/info/rfc8029</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="./rfc2119">RFC</a>
              <a href="./rfc2119">2119</a> Key Words", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" id="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-IANA">IANA</a>]     IANA, "Multi-Protocol Label Switching (MPLS) Label
              Switched Paths (LSPs) Ping Parameters",
              &lt;<a href="http://www.iana.org/assignments/mpls-lsp-ping-parameters">http://www.iana.org/assignments/</a>
              <a href="http://www.iana.org/assignments/mpls-lsp-ping-parameters">mpls-lsp-ping-parameters</a>&gt;.

   [<a id="ref-INTEROP">INTEROP</a>]  Filsfils, C., Previdi, S., Bashandy, A., Decraene, B., and
              S. Litkowski, "Segment Routing interworking with LDP",
              Work in Progress, <a href="./draft-ietf-spring-segment-routing-ldp-interop-09">draft-ietf-spring-segment-routing-ldp-</a>
              <a href="./draft-ietf-spring-segment-routing-ldp-interop-09">interop-09</a>, September 2017.






<span class="grey">Kumar, et al.                Standards Track                   [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


   [<a id="ref-RFC792">RFC792</a>]   Postel, J., "Internet Control Message Protocol", STD 5,
              <a href="./rfc792">RFC 792</a>, DOI 10.17487/RFC0792, September 1981,
              &lt;<a href="https://www.rfc-editor.org/info/rfc792">https://www.rfc-editor.org/info/rfc792</a>&gt;.

   [<a id="ref-RFC8126">RFC8126</a>]  Cotton, M., Leiba, B., and T. Narten, "Guidelines for
              Writing an IANA Considerations Section in RFCs", <a href="https://www.rfc-editor.org/bcp/bcp26">BCP 26</a>,
              <a href="./rfc8126">RFC 8126</a>, DOI 10.17487/RFC8126, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;.

   [<a id="ref-SR">SR</a>]       Filsfils, C., Previdi, S., Ginsberg, L., Decraene, B.,
              Litkowski, S., and R. Shakir, "Segment Routing
              Architecture", Work in Progress, <a href="./draft-ietf-spring-segment-routing-14">draft-ietf-spring-</a>
              <a href="./draft-ietf-spring-segment-routing-14">segment-routing-14</a>, December 2017.

   [<a id="ref-SR-IS-IS">SR-IS-IS</a>] Previdi, S., Ginsberg, L., Filsfils, C., Bashandy, A.,
              Gredler, H., Litkowski, S., Decraene, B., and J. Tantsura,
              "IS-IS Extensions for Segment Routing", Work in Progress,
              <a href="./draft-ietf-isis-segment-routing-extensions-15">draft-ietf-isis-segment-routing-extensions-15</a>, December
              2017.

   [<a id="ref-SR-MPLS">SR-MPLS</a>]  Filsfils, C., Previdi, S., Bashandy, A., Decraene, B.,
              Litkowski, S., and R. Shakir, "Segment Routing with MPLS
              data plane", Work in Progress, <a href="./draft-ietf-spring-segment-routing-mpls-11">draft-ietf-spring-segment-</a>
              <a href="./draft-ietf-spring-segment-routing-mpls-11">routing-mpls-11</a>, October 2017.

   [<a id="ref-SR-OSPF">SR-OSPF</a>]  Psenak, P., Previdi, S., Filsfils, C., Gredler, H.,
              Shakir, R., Henderickx, W., and J. Tantsura, "OSPF
              Extensions for Segment Routing", Work in Progress,
              <a href="./draft-ietf-ospf-segment-routing-extensions-24">draft-ietf-ospf-segment-routing-extensions-24</a>, December
              2017.

   [<a id="ref-SR-OSPFV3">SR-OSPFV3</a>]
              Psenak, P., Previdi, S., Filsfils, C., Gredler, H.,
              Shakir, R., Henderickx, W., and J. Tantsura, "OSPFv3
              Extensions for Segment Routing", Work in Progress,
              <a href="./draft-ietf-ospf-ospfv3-segment-routing-extensions-10">draft-ietf-ospf-ospfv3-segment-routing-extensions-10</a>,
              September 2017.














<span class="grey">Kumar, et al.                Standards Track                   [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


Acknowledgements

   The authors would like to thank Stefano Previdi, Les Ginsberg, Balaji
   Rajagopalan, Harish Sitaraman, Curtis Villamizar, Pranjal Dutta,
   Lizhong Jin, Tom Petch, Victor Ji, Mustapha Aissaoui, Tony
   Przygienda, Alexander Vainshtein, and Deborah Brungard for their
   review and comments.

   The authors would like to thank Loa Andersson for his comments and
   recommendation to merge documents.

Contributors

   The following are key contributors to this document:

      Hannes Gredler, RtBrick, Inc.
      Tarek Saad, Cisco Systems, Inc.
      Siva Sivabalan, Cisco Systems, Inc.
      Balaji Rajagopalan, Juniper Networks
      Faisal Iqbal, Cisco Systems, Inc.































<span class="grey">Kumar, et al.                Standards Track                   [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc8287">RFC 8287</a>               LSP Ping/Trace for SR-MPLS          December 2017</span>


Authors' Addresses

   Nagendra Kumar (editor)
   Cisco Systems, Inc.
   7200-12 Kit Creek Road
   Research Triangle Park, NC  27709-4987
   United States of America

   Email: naikumar@cisco.com


   Carlos Pignataro (editor)
   Cisco Systems, Inc.
   7200-11 Kit Creek Road
   Research Triangle Park, NC  27709-4987
   United States of America

   Email: cpignata@cisco.com


   George Swallow
   Southend Technical Center

   Email: swallow.ietf@gmail.com


   Nobo Akiya
   Big Switch Networks

   Email: nobo.akiya.dev@gmail.com


   Sriganesh Kini
   Individual

   Email: sriganeshkini@gmail.com


   Mach(Guoyi) Chen
   Huawei

   Email: mach.chen@huawei.com









Kumar, et al.                Standards Track                   [Page 25]
</pre>
</body></html>