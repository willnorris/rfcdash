<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9489: Label Switched Path (LSP) Ping Mechanisms for EVPN and Provider Backbone Bridging EVPN (PBB-EVPN)</title>
<meta content="Parag Jain" name="author"/>
<meta content="Ali Sajassi" name="author"/>
<meta content="Samer Salam" name="author"/>
<meta content="Sami Boutros" name="author"/>
<meta content="Greg Mirsky" name="author"/>
<meta content="
       Label Switched Path (LSP) Ping is a widely deployed Operations, Administration, and 
   Maintenance (OAM) mechanism in MPLS networks. 
This document describes mechanisms for detecting data plane failures using LSP
Ping in MPLS-based Ethernet VPN (EVPN) and Provider Backbone Bridging EVPN (PBB-EVPN) networks. 
    " name="description"/>
<meta content="xml2rfc 3.18.2" name="generator"/>
<meta content="EVPN" name="keyword"/>
<meta content="LSP Ping" name="keyword"/>
<meta content="MPLS OAM" name="keyword"/>
<meta content="9489" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9489.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-bess-evpn-lsp-ping-11" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9489" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9489</td>
<td class="center">LSP Ping for EVPN and PBB-EVPN</td>
<td class="right">November 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Jain, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9489">9489</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-11">November 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">P. Jain</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">A. Sajassi</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">S. Salam</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">S. Boutros</div>
<div class="org">Ciena</div>
</div>
<div class="author">
      <div class="author-name">G. Mirsky</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9489</h1>
<h1 id="title">Label Switched Path (LSP) Ping Mechanisms for EVPN and Provider Backbone Bridging EVPN (PBB-EVPN)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">Label Switched Path (LSP) Ping is a widely deployed Operations, Administration, and 
   Maintenance (OAM) mechanism in MPLS networks. 
This document describes mechanisms for detecting data plane failures using LSP
Ping in MPLS-based Ethernet VPN (EVPN) and Provider Backbone Bridging EVPN (PBB-EVPN) networks.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9489">https://www.rfc-editor.org/info/rfc9489</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-specification-of-requiremen">Specification of Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-terminology">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-target-fec-stack-sub-tlvs">Target FEC Stack Sub-TLVs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-evpn-mac-ip-sub-tlv">EVPN MAC/IP Sub-TLV</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="auto internal xref" href="#section-4.2">4.2</a>.  <a class="internal xref" href="#name-evpn-inclusive-multicast-su">EVPN Inclusive Multicast Sub-TLV</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="auto internal xref" href="#section-4.3">4.3</a>.  <a class="internal xref" href="#name-evpn-ethernet-auto-discover">EVPN Ethernet Auto-Discovery (A-D) Sub-TLV</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a class="auto internal xref" href="#section-4.3.1">4.3.1</a>.  <a class="internal xref" href="#name-ethernet-tag-value">Ethernet Tag Value</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a class="auto internal xref" href="#section-4.3.2">4.3.2</a>.  <a class="internal xref" href="#name-per-es-evpn-auto-discovery-">Per-ES EVPN Auto-Discovery Route with Different RDs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a class="auto internal xref" href="#section-4.3.3">4.3.3</a>.  <a class="internal xref" href="#name-evpn-vpws">EVPN VPWS</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="auto internal xref" href="#section-4.4">4.4</a>.  <a class="internal xref" href="#name-evpn-ip-prefix-sub-tlv">EVPN IP Prefix Sub-TLV</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-encapsulation-of-oam-ping-p">Encapsulation of OAM Ping Packets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-operations">Operations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-unicast-data-plane-connecti">Unicast Data Plane Connectivity Checks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#section-6.2">6.2</a>.  <a class="internal xref" href="#name-inclusive-multicast-data-pl">Inclusive Multicast Data Plane Connectivity Checks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a class="auto internal xref" href="#section-6.2.1">6.2.1</a>.  <a class="internal xref" href="#name-ingress-replication">Ingress Replication</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a class="auto internal xref" href="#section-6.2.2">6.2.2</a>.  <a class="internal xref" href="#name-using-p2mp-p-tree">Using P2MP P-Tree</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a class="auto internal xref" href="#section-6.2.3">6.2.3</a>.  <a class="internal xref" href="#name-controlling-echo-responses-">Controlling Echo Responses When Using P2MP P-Tree</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a class="auto internal xref" href="#section-6.3">6.3</a>.  <a class="internal xref" href="#name-evpn-aliasing-data-plane-co">EVPN Aliasing Data Plane Connectivity Check</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a class="auto internal xref" href="#section-6.4">6.4</a>.  <a class="internal xref" href="#name-evpn-ip-prefix-rt-5-data-pl">EVPN IP Prefix (RT-5) Data Plane Connectivity Check</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a class="auto internal xref" href="#section-8.1">8.1</a>.  <a class="internal xref" href="#name-sub-tlv-type">Sub-TLV Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a class="auto internal xref" href="#section-8.2">8.2</a>.  <a class="internal xref" href="#name-new-return-codes">New Return Codes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1"><span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> describes MPLS-based EVPN
      technology.  An EVPN comprises one or more Customer Edge devices (CEs) connected to one or more
      Provider Edge devices (PEs). The PEs provide Layer 2 (L2) EVPN among the
      CE(s) over the MPLS core infrastructure.  In EVPN networks, the PEs
      advertise the Media Access Control (MAC) addresses learned from the
      locally connected CE(s), along with the MPLS label, to remote PE(s)
      in the control plane using multiprotocol BGP <span>[<a class="cite xref" href="#RFC4760">RFC4760</a>]</span>. EVPN enables multihoming of CE(s) connected to
      multiple PEs and load balancing of traffic to and from multihomed
      CE(s).<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2"><span>[<a class="cite xref" href="#RFC7623">RFC7623</a>]</span> describes the use of
      Provider Backbone Bridging EVPN. PBB-EVPN maintains the Customer
      MAC (C-MAC) learning in the data plane and only advertises Backbone MAC
      (B-MAC) addresses in a control plane using BGP.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">Procedures for simple and efficient mechanisms to detect data plane 
   failures using LSP Ping in MPLS networks are well defined in 
   <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and <span>[<a class="cite xref" href="#RFC6425">RFC6425</a>]</span>. 
   The basic idea for the LSP Ping mechanism is to send an MPLS Echo Request packet
   along the same data path as data packets belonging to the same Forwarding 
   Equivalent Class (FEC). The Echo Request packet carries the FEC being verified 
   in the Target FEC Stack TLV <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>. Once the Echo Request packet reaches the end of 
   the MPLS path, it is sent to the control plane of the egress PE. 
   The Echo Request packet contains sufficient information to verify the correctness 
   of data plane operations and validate the data plane against the control plane.
   The egress PE sends the results of the validation in an Echo Reply packet to the 
   originating PE of the Echo Request packet.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">This document defines procedures to detect data 
   plane failures using LSP Ping in MPLS networks deploying EVPN and 
   PBB-EVPN. This document defines four new sub-TLVs for the Target FEC Stack TLV 
   with the purpose of identifying the FEC on the egress PE.<a class="pilcrow" href="#section-1-4">¶</a></p>
</section>
<section id="section-2">
      <h2 id="name-specification-of-requiremen">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-specification-of-requiremen">Specification of Requirements</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
</section>
<section id="section-3">
      <h2 id="name-terminology">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
      </h2>
<span class="break"></span><dl class="dlParallel" id="section-3-1">
        <dt id="section-3-1.1">A-D:</dt>
        <dd id="section-3-1.2" style="margin-left: 1.5em">Auto-Discovery<a class="pilcrow" href="#section-3-1.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.3">B-MAC:</dt>
        <dd id="section-3-1.4" style="margin-left: 1.5em">Backbone MAC<a class="pilcrow" href="#section-3-1.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.5">BUM:</dt>
        <dd id="section-3-1.6" style="margin-left: 1.5em">Broadcast, Unknown Unicast, and Multicast<a class="pilcrow" href="#section-3-1.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.7">CE:</dt>
        <dd id="section-3-1.8" style="margin-left: 1.5em">Customer Edge device<a class="pilcrow" href="#section-3-1.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.9">C-MAC:</dt>
        <dd id="section-3-1.10" style="margin-left: 1.5em">Customer MAC<a class="pilcrow" href="#section-3-1.10">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.11">DF:</dt>
        <dd id="section-3-1.12" style="margin-left: 1.5em">Designated Forwarder<a class="pilcrow" href="#section-3-1.12">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.13">ES:</dt>
        <dd id="section-3-1.14" style="margin-left: 1.5em">Ethernet Segment<a class="pilcrow" href="#section-3-1.14">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.15">ESI:</dt>
        <dd id="section-3-1.16" style="margin-left: 1.5em">Ethernet Segment Identifier<a class="pilcrow" href="#section-3-1.16">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.17">EVI:</dt>
        <dd id="section-3-1.18" style="margin-left: 1.5em">EVPN Instance Identifier that globally identifies the EVPN Instance<a class="pilcrow" href="#section-3-1.18">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.19">EVPN:</dt>
        <dd id="section-3-1.20" style="margin-left: 1.5em">Ethernet Virtual Private Network<a class="pilcrow" href="#section-3-1.20">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.21">FEC:</dt>
        <dd id="section-3-1.22" style="margin-left: 1.5em">Forwarding Equivalent Class<a class="pilcrow" href="#section-3-1.22">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.23">G-ACh:</dt>
        <dd id="section-3-1.24" style="margin-left: 1.5em">Generic Associated Channel<a class="pilcrow" href="#section-3-1.24">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.25">GAL:</dt>
        <dd id="section-3-1.26" style="margin-left: 1.5em">G-ACh Label<a class="pilcrow" href="#section-3-1.26">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.27">MAC-VRF:</dt>
        <dd id="section-3-1.28" style="margin-left: 1.5em">A Virtual Routing and Forwarding table for MAC
      addresses on a PE<a class="pilcrow" href="#section-3-1.28">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.29">ND:</dt>
        <dd id="section-3-1.30" style="margin-left: 1.5em">Neighbor Discovery<a class="pilcrow" href="#section-3-1.30">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.31">OAM:</dt>
        <dd id="section-3-1.32" style="margin-left: 1.5em">Operations, Administration, and Maintenance<a class="pilcrow" href="#section-3-1.32">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.33">P2MP:</dt>
        <dd id="section-3-1.34" style="margin-left: 1.5em">Point-to-Multipoint<a class="pilcrow" href="#section-3-1.34">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.35">PBB-EVPN:</dt>
        <dd id="section-3-1.36" style="margin-left: 1.5em">Provider Backbone Bridging EVPN<a class="pilcrow" href="#section-3-1.36">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.37">PE:</dt>
        <dd id="section-3-1.38" style="margin-left: 1.5em">Provider Edge device<a class="pilcrow" href="#section-3-1.38">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-1.39">VPWS:</dt>
        <dd id="section-3-1.40" style="margin-left: 1.5em">Virtual Private Wire Service<a class="pilcrow" href="#section-3-1.40">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
<section id="section-4">
      <h2 id="name-target-fec-stack-sub-tlvs">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-target-fec-stack-sub-tlvs">Target FEC Stack Sub-TLVs</a>
      </h2>
<p id="section-4-1">This document introduces four new Target FEC Stack sub-TLVs that 
   are included in the MPLS Echo Request packet. The Echo Request packets 
   are used for connectivity checks in the data plane in EVPN and PBB-EVPN networks. 
   The Target FEC Stack sub-TLVs <span class="bcp14">MAY</span> be used to validate that an identifier 
   for a given EVPN is programmed at the target node.<a class="pilcrow" href="#section-4-1">¶</a></p>
<section id="section-4.1">
        <h3 id="name-evpn-mac-ip-sub-tlv">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-evpn-mac-ip-sub-tlv">EVPN MAC/IP Sub-TLV</a>
        </h3>
<p id="section-4.1-1">The EVPN MAC/IP sub-TLV identifies the target MAC, MAC/IP binding for ARP/ND, 
        or IP address for an EVI under test at an egress PE.
        This sub-TLV is included in the Echo Request sent by an
        EVPN/PBB-EVPN PE to a peer PE.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2">The fields of the EVPN MAC/IP sub-TLV are derived from the MAC/IP Advertisement 
   route defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7432#section-7.2">Section 7.2</a> of [<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and have the format 
   shown in <a class="auto internal xref" href="#fig1">Figure 1</a>. The fields of the EVPN MAC/IP sub-TLV should be set according to the 
   following, which is consistent with <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and <span>[<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>:<a class="pilcrow" href="#section-4.1-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-3.1">The Ethernet Tag ID field can be 0 or a valid VLAN ID for EVPN VLAN-aware bundle 
         service <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. For PBB-EVPN, the value of this field is always 0 as 
         per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7623#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>.<a class="pilcrow" href="#section-4.1-3.1">¶</a>
</li>
          <li class="normal" id="section-4.1-3.2">The Ethernet Segment Identifier field is a 10-octet field. For EVPN, it is set to 0 for a
         single-homed ES or to a valid ESI ID for a multihomed ES. For PBB-EVPN, the Ethernet 
         Segment Identifier field must be set to either 0 (for single-homed segments or multihomed segments with per-I-SID load balancing) or to MAX-ESI (for multihomed segments with per-flow load balancing) as
         described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7623#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>.<a class="pilcrow" href="#section-4.1-3.2">¶</a>
</li>
          <li class="normal" id="section-4.1-3.3">The MAC Addr Len field specifies the MAC length in bits. Only 48-bit MAC addresses
         are supported as this document follows the MAC address length supported by <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-4.1-3.3">¶</a>
</li>
          <li class="normal" id="section-4.1-3.4">The MAC Address field is set to the 6-octet MAC address.<a class="pilcrow" href="#section-4.1-3.4">¶</a>
</li>
          <li class="normal" id="section-4.1-3.5">The IP Address field is optional. When the IP Address field is not present, 
         the IP Addr Len field is set to 0. When the IP Address field is present, the IP Addr Len field is in
         bits and is set to either 32 for IPv4 addresses or 128 for IPv6 addresses.<a class="pilcrow" href="#section-4.1-3.5">¶</a>
</li>
          <li class="normal" id="section-4.1-3.6">The Must Be Zero fields are set to 0. The receiving PE should ignore the 
         Must Be Zero fields.<a class="pilcrow" href="#section-4.1-3.6">¶</a>
</li>
        </ul>
<span id="name-evpn-mac-ip-sub-tlv-format"></span><div id="fig1">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-4.1-4.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Route Distinguisher                        |
|                        (8 octets)                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Ethernet Tag ID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Ethernet Segment Identifier                     |
|                     (10 octets)                               |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               | Must Be Zero  |  MAC Addr Len |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                MAC Address                                    |
+                 (6 octets)    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               | Must Be Zero  |  IP Addr Len  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                IP Address (0, 4 or 16 octets)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-evpn-mac-ip-sub-tlv-format">EVPN MAC/IP Sub-TLV Format</a>
          </figcaption></figure>
</div>
<p id="section-4.1-5">The MPLS Echo Request is sent by the ingress PE using the EVPN MPLS label(s) associated with the MAC/IP Advertisement route announced by the egress PE and the MPLS transport label(s) to reach the egress PE.<a class="pilcrow" href="#section-4.1-5">¶</a></p>
<p id="section-4.1-6">In EVPN, the MAC/IP Advertisement route has multiple uses and is used for
the following cases:<a class="pilcrow" href="#section-4.1-6">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-7.1">This route with only a MAC address and MPLS Label1 is used for populating MAC-VRF and performing MAC forwarding.<a class="pilcrow" href="#section-4.1-7.1">¶</a>
</li>
          <li class="normal" id="section-4.1-7.2">This route with MAC and IP addresses and only MPLS Label1 is used for populating both MAC-VRF and ARP/ND tables (for ARP suppression) as well as for performing MAC forwarding.<a class="pilcrow" href="#section-4.1-7.2">¶</a>
</li>
          <li class="normal" id="section-4.1-7.3">This route with MAC and IP addresses and both MPLS Label1 and Label2 is used for populating MAC-VRF and IP-VRF tables as well as for both MAC and IP forwarding in the case of symmetric Integrated Routing and Bridging (IRB).<a class="pilcrow" href="#section-4.1-7.3">¶</a>
</li>
        </ul>
<p id="section-4.1-8">When an MPLS Echo Request is sent by an ingress PE, the contents of the Echo Request and the egress PE mode of operation (i.e., IRB mode or L2 mode) along with EVPN MPLS label of the packet determine which of the three cases above this Echo Request is for. When the egress PE receives the EVPN MAC/IP sub-TLV containing only the MAC address, the egress PE validates the MAC state and forwarding.  When the egress PE receives the EVPN MAC/IP sub-TLV containing both MAC and IP addresses and if the EVPN label points to a MAC-VRF, then the egress PE validates the MAC state and forwarding. If the egress PE is not configured in symmetric IRB mode, it also validates ARP/ND state. However, if the EVPN label points to an IP-VRF, then the egress PE validates IP state and forwarding. 
Any other combinations (e.g., the egress PE receiving
   the EVPN MAC/IP sub-TLV containing only the MAC address but with the EVPN label
   pointing to an IP-VRF) should be considered invalid, 
   and the egress PE should send an Echo Reply with the appropriate Return          
   Code to the ingress PE.<a class="pilcrow" href="#section-4.1-8">¶</a></p>
</section>
<section id="section-4.2">
        <h3 id="name-evpn-inclusive-multicast-su">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-evpn-inclusive-multicast-su">EVPN Inclusive Multicast Sub-TLV</a>
        </h3>
<p id="section-4.2-1">The fields of the EVPN Inclusive Multicast sub-TLV are based on the EVPN 
   Inclusive Multicast Tag route defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7432#section-7.3">Section 7.3</a> of [<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.
   This TLV is included in the Echo Request sent to the EVPN 
   peer PE by the originator of the request to verify the multicast 
   connectivity state on the peer PE(s) in EVPN and PBB-EVPN networks.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<p id="section-4.2-2">The EVPN Inclusive Multicast sub-TLV has the format shown in 
   <a class="auto internal xref" href="#fig2">Figure 2</a>. The fields of this sub-TLV should be set according to the 
   following, which is consistent with <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and 
   <span>[<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>:<a class="pilcrow" href="#section-4.2-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-3.1">The Route Distinguisher (RD) field is a 10-octet field and is set to the RD
         of the MAC-VRF on the peer PE.<a class="pilcrow" href="#section-4.2-3.1">¶</a>
</li>
          <li class="normal" id="section-4.2-3.2">For EVPN, the Ethernet Tag ID field can be set to 0 or a valid VLAN ID for 
         EVPN VLAN-aware bundle service <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.
         For PBB-EVPN, the value of this field is set to the Service 
         Instance Identifier (I-SID) value as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7623#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>.<a class="pilcrow" href="#section-4.2-3.2">¶</a>
</li>
          <li class="normal" id="section-4.2-3.3">The IP Addr Len field specifies the length of the Originating Router's IP Addr field in bits and is set to either 32 for IPv4 addresses or 128 for IPv6 addresses.<a class="pilcrow" href="#section-4.2-3.3">¶</a>
</li>
          <li class="normal" id="section-4.2-3.4">The Originating Router's IP Addr field is set to the IPv4 or IPv6 address of the peer PE.<a class="pilcrow" href="#section-4.2-3.4">¶</a>
</li>
        </ul>
<span id="name-evpn-inclusive-multicast-sub"></span><div id="fig2">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.2-4.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Route Distinguisher                        |
|                        (8 octets)                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Ethernet Tag ID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| IP Addr Len |                                                 |
+-+-+-+-+-+-+-+                                                 |
~               Originating Router's IP Addr                    ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-evpn-inclusive-multicast-sub">EVPN Inclusive Multicast Sub-TLV Format</a>
          </figcaption></figure>
</div>
<p id="section-4.2-5">BUM traffic can be sent using ingress replication or P2MP P-tree in
        EVPN and PBB-EVPN networks.  When using ingress replication, the Echo
        Request is sent using a label stack of [Transport label, Inclusive
        Multicast label] to each egress PE participating in EVPN or
        PBB-EVPN. The Inclusive Multicast label is the downstream-assigned
        label announced by the egress PE to which the Echo Request is being
        sent. The Inclusive Multicast label is the inner label in the MPLS
        label stack.<a class="pilcrow" href="#section-4.2-5">¶</a></p>
<p id="section-4.2-6">When using P2MP P-tree in EVPN or PBB-EVPN, the Echo Request is 
   sent using a P2MP P-tree transport label for the Inclusive P-tree 
   arrangement or using a label stack of [P2MP P-tree Transport label,
   upstream-assigned EVPN Inclusive Multicast label] for the Aggregate 
   Inclusive P2MP P-tree arrangement as described in <a class="auto internal xref" href="#operations">Section 6</a>.<a class="pilcrow" href="#section-4.2-6">¶</a></p>
<p id="section-4.2-7"> In an EVPN network, to emulate traffic coming from a multihomed site, an
additional EVPN Ethernet A-D sub-TLV in the Target FEC Stack TLV
and an ESI Split Horizon Group MPLS label as the bottom label are also
included in the Echo Request packet.  When using P2MP P-tree, the ESI Split
Horizon Group MPLS label is upstream assigned. Please see <a class="auto internal xref" href="#p2mp-ptree">Section 6.2.2</a> for operations using P2MP P-trees.<a class="pilcrow" href="#section-4.2-7">¶</a></p>
</section>
<section id="section-4.3">
        <h3 id="name-evpn-ethernet-auto-discover">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-evpn-ethernet-auto-discover">EVPN Ethernet Auto-Discovery (A-D) Sub-TLV</a>
        </h3>
<p id="section-4.3-1">The fields in the EVPN Ethernet A-D sub-TLV are based on the 
   EVPN Ethernet A-D route advertisement defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7432#section-7.1">Section 7.1</a> of [<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.  The EVPN Ethernet A-D sub-TLV only applies to EVPN.<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<p id="section-4.3-2">The EVPN Ethernet A-D sub-TLV has the format shown in <a class="auto internal xref" href="#fig3">Figure 3</a>.
      The fields of this sub-TLV should be set according to the 
          following, which is consistent with <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>:<a class="pilcrow" href="#section-4.3-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-3.1">The Route Distinguisher (RD) field is a 10-octet field and is set to the RD
         of the MAC-VRF on the peer PE. Please see <a class="auto internal xref" href="#adroute">Section 4.3.2</a> for the case when a
         per-ES A-D route is announced with different RDs.<a class="pilcrow" href="#section-4.3-3.1">¶</a>
</li>
          <li class="normal" id="section-4.3-3.2">The Ethernet Tag ID field can be 0, MAX-ET, or a valid VLAN ID as described in 
         <a class="auto internal xref" href="#etagvalue">Section 4.3.1</a>.<a class="pilcrow" href="#section-4.3-3.2">¶</a>
</li>
          <li class="normal" id="section-4.3-3.3">The Ethernet Segment Identifier field is a 10-octet field and is set to 0 for 
        a single-homed ES or to a valid ESI ID for a multihomed ES.<a class="pilcrow" href="#section-4.3-3.3">¶</a>
</li>
          <li class="normal" id="section-4.3-3.4">The Must Be Zero field is set to 0. The receiving PE should ignore the 
         Must Be Zero field.<a class="pilcrow" href="#section-4.3-3.4">¶</a>
</li>
        </ul>
<span id="name-evpn-ethernet-a-d-sub-tlv-f"></span><div id="fig3">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.3-4.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Route Distinguisher                        |
|                        (8 octets)                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Ethernet Tag ID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Ethernet Segment Identifier                     |
|                     (10 octets)                               |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |      Must Be Zero             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-evpn-ethernet-a-d-sub-tlv-f">EVPN Ethernet A-D Sub-TLV Format</a>
          </figcaption></figure>
</div>
<div id="etagvalue">
<section id="section-4.3.1">
          <h4 id="name-ethernet-tag-value">
<a class="section-number selfRef" href="#section-4.3.1">4.3.1. </a><a class="section-name selfRef" href="#name-ethernet-tag-value">Ethernet Tag Value</a>
          </h4>
<p id="section-4.3.1-1">The EVPN Ethernet A-D sub-TLV can be sent in the context of per-ES or per-EVI.
When an operator performs a connectivity check for the BUM L2 service, 
         an Echo Request packet is sent and <span class="bcp14">MAY</span> contain the EVPN Ethernet A-D sub-TLV to emulate traffic 
         coming from a multihomed site.  In this case, the EVPN Ethernet A-D sub-TLV is 
         added in the per-ES context. When an Echo Request packet is sent for the connectivity 
         check for EVPN Aliasing state, the context for the EVPN Ethernet A-D 
         sub-TLV is per-EVI.<a class="pilcrow" href="#section-4.3.1-1">¶</a></p>
<p id="section-4.3.1-2">The Ethernet Tag field value in the EVPN Ethernet A-D sub-TLV <span class="bcp14">MUST</span> be set according 
         to the context:<a class="pilcrow" href="#section-4.3.1-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-3.1">For the per-ES context, the Ethernet Tag field in the sub-TLV <span class="bcp14">MUST</span> be set to 
         the reserved MAX-ET value <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-4.3.1-3.1">¶</a>
</li>
            <li class="normal" id="section-4.3.1-3.2">For the per-EVI context, the Ethernet Tag field in the sub-TLV <span class="bcp14">MUST</span> be set to 
         the non-reserved value.<a class="pilcrow" href="#section-4.3.1-3.2">¶</a>
</li>
          </ul>
</section>
</div>
<div id="adroute">
<section id="section-4.3.2">
          <h4 id="name-per-es-evpn-auto-discovery-">
<a class="section-number selfRef" href="#section-4.3.2">4.3.2. </a><a class="section-name selfRef" href="#name-per-es-evpn-auto-discovery-">Per-ES EVPN Auto-Discovery Route with Different RDs</a>
          </h4>
<p id="section-4.3.2-1"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc7432#section-8.2">Section 8.2</a> of [<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> specifies that a per-ES EVPN A-D route for 
        a given multihomed ES may be advertised more than once with different RD values 
        because many EVIs may be associated with the same ES and Route Targets for all these 
        EVIs may not fit in a single BGP Update message.  In this case, the RD value used 
        in the EVPN Ethernet A-D sub-TLV <span class="bcp14">MUST</span> be the RD value received for the EVI in the 
        per-ES EVPN A-D route.<a class="pilcrow" href="#section-4.3.2-1">¶</a></p>
</section>
</div>
<section id="section-4.3.3">
          <h4 id="name-evpn-vpws">
<a class="section-number selfRef" href="#section-4.3.3">4.3.3. </a><a class="section-name selfRef" href="#name-evpn-vpws">EVPN VPWS</a>
          </h4>
<p id="section-4.3.3-1">LSP Ping can also be used to detect data plane failures for the EVPN VPWS described in <span>[<a class="cite xref" href="#RFC8214">RFC8214</a>]</span>. 
        The Echo Request packet carries the EVPN Ethernet A-D sub-TLV with fields populated from 
        the EVPN Ethernet A-D per-EVI route announced by the egress PE for the EVPN VPWS under test.
        The Echo Request is sent by the ingress 
        PE using the EVPN MPLS label associated with the EVPN Ethernet A-D route announced by the 
        egress PE and the MPLS transport label(s) to reach the egress PE.<a class="pilcrow" href="#section-4.3.3-1">¶</a></p>
<p id="section-4.3.3-2">The egress PE processes the Echo Request packet and performs
          checks for the EVPN Ethernet A-D sub-TLV present in the Target FEC
          Stack TLV as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and responds according to processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.  The egress PE can identify
          that the Echo Request is for the EVPN VPWS instance as EVI
          (identified by the RD) for EVPN VPWS is different from EVI assigned
          for EVPN. The egress PE will use the information from the EVPN
          Ethernet A-D sub-TLV in the Target FEC Stack TLV and validate the
          VLAN state for the EVPN VPWS under test.  For the success case, the
          egress PE will reply with Return Code 3 ("Replying router is an
          egress for the FEC at stack-depth &lt;RSC&gt;").<a class="pilcrow" href="#section-4.3.3-2">¶</a></p>
</section>
</section>
<section id="section-4.4">
        <h3 id="name-evpn-ip-prefix-sub-tlv">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-evpn-ip-prefix-sub-tlv">EVPN IP Prefix Sub-TLV</a>
        </h3>
<p id="section-4.4-1">The EVPN IP Prefix sub-TLV identifies the IP prefix for an EVI under 
   test at a peer PE.<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<p id="section-4.4-2">The EVPN IP Prefix sub-TLV fields are derived from the IP Prefix route (RT-5) 
          advertisement defined in <span>[<a class="cite xref" href="#RFC9136">RFC9136</a>]</span>. This sub-TLV only applies to 
          EVPN.<a class="pilcrow" href="#section-4.4-2">¶</a></p>
<p id="section-4.4-3">The EVPN IP Prefix sub-TLV has the format shown in <a class="auto internal xref" href="#fig4">Figure 4</a>.  The
           total length (not shown) of this sub-TLV <span class="bcp14">MUST</span> be either 32 bytes (if
           IPv4 addresses are carried) or 56 bytes (if IPv6 addresses are carried).
          The IP prefix and gateway IP address <span class="bcp14">MUST</span> be from the same IP address
          family, as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9136#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#RFC9136">RFC9136</a>]</span>.<a class="pilcrow" href="#section-4.4-3">¶</a></p>
<p id="section-4.4-4">The fields of the EVPN IP Prefix sub-TLV should be set according to the 
          following, which is consistent with <span>[<a class="cite xref" href="#RFC9136">RFC9136</a>]</span>:<a class="pilcrow" href="#section-4.4-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-5.1">The Route Distinguisher (RD) field is a 10-octet field and is set to the RD
         of the IP-VRF on the peer PE.<a class="pilcrow" href="#section-4.4-5.1">¶</a>
</li>
          <li class="normal" id="section-4.4-5.2">The Ethernet Tag ID field can be 0 or a valid VLAN ID for EVPN VLAN-aware bundle 
         service <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-4.4-5.2">¶</a>
</li>
          <li class="normal" id="section-4.4-5.3">The Ethernet Segment Identifier field is a 10-octet field and is set to 
         a valid ESI ID if the ESI is used as an Overlay Index as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9136#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#RFC9136">RFC9136</a>]</span>.
         Otherwise, the Ethernet Segment Identifier field is set to 0.<a class="pilcrow" href="#section-4.4-5.3">¶</a>
</li>
          <li class="normal" id="section-4.4-5.4">The IP Prefix Len field specifies the number of bits in the IP Prefix field. It 
        is set to a value between 0 and 32 for IPv4 or between 0 to 128 for IPv6.<a class="pilcrow" href="#section-4.4-5.4">¶</a>
</li>
          <li class="normal" id="section-4.4-5.5">The IP Prefix field is set to a 4-octet IPv4 address (with
         trailing 0 bits to make 32 bits in all) or a 16-octet IPv6 address
         (with trailing 0 bits to make 128 bits in all). The address family
         of this field is inferred from the sub-TLV length field, as
         discussed above.<a class="pilcrow" href="#section-4.4-5.5">¶</a>
</li>
          <li class="normal" id="section-4.4-5.6"> The Gateway (GW) IP Address field is set to a 4-octet IPv4 address
          or a 16-octet IPv6 address if it's used as an Overlay Index for the
         IP prefixes.  If the GW IP Address is not being used, it must be
         set to 0 as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9136#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#RFC9136">RFC9136</a>]</span>. The address
         family of this field is inferred from the sub-TLV length field, as
         discussed above.<a class="pilcrow" href="#section-4.4-5.6">¶</a>
</li>
          <li class="normal" id="section-4.4-5.7">The Must Be Zero field is set to 0. The receiving PE should ignore the 
         Must Be Zero field.<a class="pilcrow" href="#section-4.4-5.7">¶</a>
</li>
        </ul>
<span id="name-evpn-ip-prefix-sub-tlv-form"></span><div id="fig4">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.4-6.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Route Distinguisher                        |
|                        (8 octets)                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Ethernet Tag ID                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Ethernet Segment Identifier                     |
|                     (10 octets)                               |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               | Must Be Zero  | IP Prefix Len |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                 IP Prefix  (4 or 16 octets)                   ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                GW IP Address (4 or 16 octets)                 ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-evpn-ip-prefix-sub-tlv-form">EVPN IP Prefix Sub-TLV Format</a>
          </figcaption></figure>
</div>
<p id="section-4.4-7">The MPLS Echo Request is sent by the ingress PE using the EVPN MPLS label(s) 
   associated with the IP Prefix route announced by the egress PE and the MPLS 
   transport label(s) to reach the egress PE.<a class="pilcrow" href="#section-4.4-7">¶</a></p>
</section>
</section>
<section id="section-5">
      <h2 id="name-encapsulation-of-oam-ping-p">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-encapsulation-of-oam-ping-p">Encapsulation of OAM Ping Packets</a>
      </h2>
<p id="section-5-1">The MPLS Echo Request IP/UDP packets <span class="bcp14">MUST</span> be encapsulated 
         with the Transport and EVPN label(s) followed by the
         GAL <span>[<a class="cite xref" href="#RFC5586">RFC5586</a>]</span>, which is the bottommost label.
         The GAL is followed by a G-ACh header carrying the 
         IPv4(0x0021) or IPv6(0x0057) Channel Type. The code points for IPv4 and 
         IPv6 channels are defined in the "Generic Associated Channel (G-ACh) Parameters" IANA registry.<a class="pilcrow" href="#section-5-1">¶</a></p>
</section>
<div id="operations">
<section id="section-6">
      <h2 id="name-operations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-operations">Operations</a>
      </h2>
<section id="section-6.1">
        <h3 id="name-unicast-data-plane-connecti">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-unicast-data-plane-connecti">Unicast Data Plane Connectivity Checks</a>
        </h3>
<p id="section-6.1-1"><a class="auto internal xref" href="#fig5">Figure 5</a> is an example of a PBB-EVPN network. CE1 is dual-homed to 
  PE1 and PE2. Assume that PE1 announced a MAC route with RD 192.0.2.1:00 and 
  B-MAC 00-AA-00-BB-00-CC and with MPLS label 16001 for EVI 10. Similarly, 
  PE2 announced a MAC route with RD 203.0.113.2:00 and B-MAC 00-AA-00-BB-00-CC 
  and with MPLS label 16002.<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<p id="section-6.1-2">On PE3, when an operator performs a connectivity check for the B-MAC 
  address 00-AA-00-BB-00-CC on PE1, the operator initiates an LSP Ping
  request with the Target FEC Stack TLV containing the EVPN MAC/IP sub-TLV in 
  the Echo Request packet. The Echo Request packet is sent with the 
  {Transport label(s) to reach PE1, EVPN label = 16001, GAL} MPLS label 
  stack and IP ACH Channel header. Once the Echo Request packet reaches PE1, 
  PE1 will use the GAL and the IP ACH Channel header
  to determine if the packet is an IPv4 or IPv6 OAM packet. The PE1 will process the 
  packet and perform checks for the EVPN MAC/IP sub-TLV present in the 
  Target FEC Stack TLV as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and 
  respond according to the processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.<a class="pilcrow" href="#section-6.1-2">¶</a></p>
<span id="name-pbb-evpn-network"></span><div id="fig5">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-6.1-3.1">
<pre>                  +-----------------+
                  |                 |
                  |                 |
+----+ AC1  +-----+                 +-----+     +----+
| CE1|------|     |                 | PE3 |-----| CE2|
+----+\     | PE1 |     IP/MPLS     |     |     +----+
       \    +-----+     Network     +-----+
        \         |                 |
      AC2\  +-----+                 |
          \ |     |                 |
           \| PE2 |                 |
            +-----+                 |
                  |                 |
                  +-----------------+

  &lt;-802.1Q-&gt;  &lt;------PBB over MPLS------&gt;  &lt;-802.1Q-&gt;
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-pbb-evpn-network">PBB-EVPN Network</a>
          </figcaption></figure>
</div>
<p id="section-6.1-4">Similarly, on PE3, when an operator performs a connectivity check for 
  the B-MAC address 00-AA-00-BB-00-CC on PE2, the operator initiates an 
  LSP Ping request with the Target FEC Stack TLV containing the EVPN MAC/IP 
  sub-TLV in the Echo Request packet. The Echo Request packet is sent 
  with the {MPLS Transport label(s) to reach PE2, EVPN label = 16002, GAL} 
  MPLS label stack and IP ACH Channel header.<a class="pilcrow" href="#section-6.1-4">¶</a></p>
<p id="section-6.1-5">LSP Ping operations for unicast data plane connectivity checks in EVPN
  are similar to those described above for PBB-EVPN, except that the 
  checks are for C-MAC addresses instead of B-MAC addresses.<a class="pilcrow" href="#section-6.1-5">¶</a></p>
<p id="section-6.1-6"> In EVPN networks, an operator can also perform a MAC state test using an aliasing 
    label for the MAC to verify the MAC state on the egress multihoming PE that did 
    not learn the MAC from the multihomed CE on a local ESI but has announced Ethernet 
    A-D per-EVI and per-ESI routes for the ESI. This is due to the fact that
    MAC state on multihoming PEs that did not learn the MAC locally get created
    from EVPN MAC/IP route advertisement from the multihoming PE that has
    learned the CE's MAC address locally.<a class="pilcrow" href="#section-6.1-6">¶</a></p>
</section>
<section id="section-6.2">
        <h3 id="name-inclusive-multicast-data-pl">
<a class="section-number selfRef" href="#section-6.2">6.2. </a><a class="section-name selfRef" href="#name-inclusive-multicast-data-pl">Inclusive Multicast Data Plane Connectivity Checks</a>
        </h3>
<section id="section-6.2.1">
          <h4 id="name-ingress-replication">
<a class="section-number selfRef" href="#section-6.2.1">6.2.1. </a><a class="section-name selfRef" href="#name-ingress-replication">Ingress Replication</a>
          </h4>
<p id="section-6.2.1-1">Assume PE1 announced an Inclusive Multicast route for EVI 10, with 
   RD 192.0.2.1:00, Ethernet Tag (ISID 10), PMSI tunnel attribute Tunnel 
   type set to ingress replication, and downstream-assigned Inclusive 
   Multicast MPLS label 17001. Similarly, PE2 announced an Inclusive 
   Multicast route for EVI 10, with RD 203.0.113.2:00, Ethernet Tag (ISID 
   10), PMSI tunnel attribute Tunnel type set to ingress replication, 
   and downstream-assigned Inclusive Multicast MPLS label 17002.<a class="pilcrow" href="#section-6.2.1-1">¶</a></p>
<p id="section-6.2.1-2">Given CE1 is dual-homed to PE1 and PE2, assume that PE1 is the DF 
   for ISID 10 for the port corresponding to the ESI 11aa.22bb.33cc. 
   44dd.5500.<a class="pilcrow" href="#section-6.2.1-2">¶</a></p>
<p id="section-6.2.1-3">When an operator at PE3 initiates a connectivity check for the 
   Inclusive Multicast on PE1, the operator initiates an LSP Ping 
   request with the Target FEC Stack TLV containing the EVPN Inclusive 
   Multicast sub-TLV in the Echo Request packet. The Echo Request 
   packet is sent with the {Transport label(s) to reach PE1, EVPN 
   Inclusive Multicast label = 17001, GAL} MPLS label stack and IP ACH Channel header. 
   Once the Echo Request packet reaches PE1, 
   PE1 will use the GAL and the IP ACH Channel header
   to determine if the packet is an IPv4 or IPv6 OAM packet. 
   The packet will have the EVPN Inclusive Multicast label. 
   PE1 will process the packet and perform checks for the EVPN 
   Inclusive Multicast sub-TLV present in the Target FEC Stack TLV as 
   described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and respond according to 
   the processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>. For the success case, PE1 will reply 
   with Return Code 3 ("Replying router is an egress for the FEC at stack-depth &lt;RSC&gt;").<a class="pilcrow" href="#section-6.2.1-3">¶</a></p>
<p id="section-6.2.1-4">Similarly, an operator at PE3 may initiate an LSP Ping to PE2 with 
   the Target FEC Stack TLV containing the EVPN Inclusive Multicast sub-TLV in the 
   Echo Request packet. The Echo Request packet is sent with 
   the {Transport label(s) to reach PE2, EVPN Inclusive Multicast label = 
   17002, GAL} MPLS label stack and IP ACH Channel header. 
   Once the Echo Request packet reaches PE2, 
   PE2 will use the GAL and the IP ACH Channel header
   to determine if the packet is an IPv4 or IPv6 OAM packet. The processing on PE2 will be similar 
   to that on PE1 as described above. For the success case, PE2 will 
   reply with Return Code 3 ("Replying 
   router is an egress for the FEC at stack-depth &lt;RSC&gt;") as per <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.<a class="pilcrow" href="#section-6.2.1-4">¶</a></p>
<p id="section-6.2.1-5">In an Echo Request packet for EVPN, a combination of an EVPN
          Ethernet A-D sub-TLV and the associated MPLS Split Horizon label,
          immediately preceding the GAL in the MPLS label stack, may be used
          to emulate traffic coming from a multihomed site.  The Split Horizon
          label is used by leaf PE(s) attached to the same multihomed site to
          prevent forwarding of packets back to the multihomed site. If the
          behavior on a leaf PE is to not forward the packet to the multihomed
          site on the ESI identified by the EVPN Ethernet A-D sub-TLV because
          of Split Horizon filtering, the PE will reply with Return Code 37 (see <a class="auto internal xref" href="#iana">Section 8</a>) and drop the BUM packets on the ES corresponding to the ESI received in the EVPN
Ethernet A-D sub-TLV because of the Split Horizon Group filtering.<a class="pilcrow" href="#section-6.2.1-5">¶</a></p>
</section>
<div id="p2mp-ptree">
<section id="section-6.2.2">
          <h4 id="name-using-p2mp-p-tree">
<a class="section-number selfRef" href="#section-6.2.2">6.2.2. </a><a class="section-name selfRef" href="#name-using-p2mp-p-tree">Using P2MP P-Tree</a>
          </h4>
<p id="section-6.2.2-1">Both Inclusive P-tree and Aggregate Inclusive P-tree can be used in 
  EVPN or PBB-EVPN networks.<a class="pilcrow" href="#section-6.2.2-1">¶</a></p>
<p id="section-6.2.2-2">When using an Inclusive P-tree arrangement, the P2MP P-tree transport 
  label itself is used to identify the L2 service associated with the 
  Inclusive Multicast route. This L2 service could be a Customer 
  Bridge or a Provider Backbone Bridge.<a class="pilcrow" href="#section-6.2.2-2">¶</a></p>
<p id="section-6.2.2-3">For an Inclusive P-tree arrangement, when an operator performs a 
  connectivity check for the multicast L2 service, the operator 
  initiates an LSP Ping request with the Target FEC Stack TLV 
  containing the EVPN Inclusive Multicast sub-TLV in the Echo Request 
  packet. The Echo Request packet is sent over P2MP LSP
  with the {P2MP P-tree Transport label, GAL} 
  MPLS label stack and IP ACH Channel header.<a class="pilcrow" href="#section-6.2.2-3">¶</a></p>
<p id="section-6.2.2-4">When using an Aggregate Inclusive P-tree arrangement, a PE announces an upstream-assigned MPLS label along with the P-tree ID, so both the 
  P2MP P-tree MPLS transport label and the upstream MPLS label can be 
  used to identify the L2 service.<a class="pilcrow" href="#section-6.2.2-4">¶</a></p>
<p id="section-6.2.2-5">For an Aggregate Inclusive P-tree arrangement, when an operator 
  performs a connectivity check for the multicast L2 service, the 
  operator initiates an LSP Ping request with the Target FEC Stack TLV 
  containing the EVPN Inclusive Multicast sub-TLV in the Echo Request 
  packet. The Echo Request packet is sent over P2MP LSP using the 
  IP-ACH Control channel with the {P2MP P-tree Transport label, 
  EVPN upstream-assigned Multicast label, GAL} MPLS label stack and
  IP ACH Channel header.<a class="pilcrow" href="#section-6.2.2-5">¶</a></p>
<p id="section-6.2.2-6">The leaf PE(s) of the P2MP P-tree will process the packet and perform 
  checks for the EVPN Inclusive Multicast sub-TLV present in the 
  Target FEC Stack TLV as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and 
  respond according to the processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>. 
  For the success case, the leaf PE will reply with Return Code 3 
  ("Replying router is an egress for the FEC at stack-depth &lt;RSC&gt;").<a class="pilcrow" href="#section-6.2.2-6">¶</a></p>
<p id="section-6.2.2-7">In an Echo Request packet for EVPN, a combination of an EVPN
          Ethernet A-D sub-TLV and the associated MPLS Split Horizon label,
          immediately preceding the GAL in the MPLS label stack, may be used
          to emulate traffic coming from a multihomed site.  When using P2MP
          P-tree, the Split Horizon label is upstream assigned and is received
          by all the leaf PEs of the P2MP P-tree. The Split Horizon label is
          used by leaf PE(s) attached to the same multihomed site so that
          packets will not be forwarded back to the multihomed site. If the
          behavior on a leaf PE is to not forward the packet to the multihomed
          site on the ESI in the EVPN Ethernet A-D sub-TLV because of Split
          Horizon filtering, the PE will reply with Return Code 37 (see <a class="auto internal xref" href="#iana">Section 8</a>) and drop the BUM packets on the ES
corresponding to the ESI received in the EVPN Ethernet A-D sub-TLV
because of the Split Horizon Group filtering.
          
          If the leaf PE does not have the ESI identified in the
          EVPN Ethernet A-D sub-TLV, the PE <span class="bcp14">MAY</span> reply with Return Code 38 (see <a class="auto internal xref" href="#iana">Section 8</a>), and the BUM packets are forwarded
because there is no ES corresponding to the
ESI received in the EVPN Ethernet A-D sub-TLV.<a class="pilcrow" href="#section-6.2.2-7">¶</a></p>
</section>
</div>
<section id="section-6.2.3">
          <h4 id="name-controlling-echo-responses-">
<a class="section-number selfRef" href="#section-6.2.3">6.2.3. </a><a class="section-name selfRef" href="#name-controlling-echo-responses-">Controlling Echo Responses When Using P2MP P-Tree</a>
          </h4>
<p id="section-6.2.3-1">The procedures described in <span>[<a class="cite xref" href="#RFC6425">RFC6425</a>]</span> for preventing congestion of
   Echo Responses (Echo Jitter TLV) and limiting the Echo Reply to a
   single egress node (P2MP Responder Identifier TLV with either the
   IPv4 Node Address P2MP Responder sub-TLV or the IPv6 Node Address P2MP
   Responder sub-TLV) can
   be applied to LSP Ping in EVPN and PBB-EVPN when using P2MP P-trees
   for BUM traffic.<a class="pilcrow" href="#section-6.2.3-1">¶</a></p>
</section>
</section>
<section id="section-6.3">
        <h3 id="name-evpn-aliasing-data-plane-co">
<a class="section-number selfRef" href="#section-6.3">6.3. </a><a class="section-name selfRef" href="#name-evpn-aliasing-data-plane-co">EVPN Aliasing Data Plane Connectivity Check</a>
        </h3>
<p id="section-6.3-1">Assume PE1 announced an Ethernet A-D per-EVI route with the ESI 
   set to CE1 system ID and MPLS label 19001. Additionally, assume PE2 announced an Ethernet A-D per-EVI route 
   with the ESI set to CE1 system ID and MPLS label 19002.<a class="pilcrow" href="#section-6.3-1">¶</a></p>
<p id="section-6.3-2">At PE3, when an operator performs a connectivity check for the 
   aliasing aspect of the EVPN Ethernet A-D route on PE1, the operator 
   initiates an LSP Ping request with the Target FEC Stack TLV 
   containing the EVPN Ethernet A-D sub-TLV in the Echo Request packet. The 
   Echo Request packet is sent with the {Transport label(s) to reach 
   PE1, EVPN Ethernet A-D label 19001, GAL} MPLS label stack and 
   IP ACH Channel header.<a class="pilcrow" href="#section-6.3-2">¶</a></p>
<p id="section-6.3-3">When PE1 receives the packet, it will process the packet and perform 
   checks for the EVPN Ethernet A-D sub-TLV present in the Target FEC 
   Stack TLV as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and respond 
   according to the processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.<a class="pilcrow" href="#section-6.3-3">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-evpn-ip-prefix-rt-5-data-pl">
<a class="section-number selfRef" href="#section-6.4">6.4. </a><a class="section-name selfRef" href="#name-evpn-ip-prefix-rt-5-data-pl">EVPN IP Prefix (RT-5) Data Plane Connectivity Check</a>
        </h3>
<p id="section-6.4-1">Assume PE1 in <a class="auto internal xref" href="#fig5">Figure 5</a> announced an IP Prefix route (RT-5) with an IP prefix  
   reachable behind CE1 and MPLS label 20001. When an operator on PE3 performs a 
   connectivity check for the IP prefix on PE1, the operator 
   initiates an LSP Ping request with the Target FEC Stack TLV 
   containing the EVPN IP Prefix sub-TLV in the Echo Request packet. The 
   Echo Request packet is sent with the {Transport label(s) to reach 
   PE1, EVPN IP Prefix label 20001 } MPLS label stack.<a class="pilcrow" href="#section-6.4-1">¶</a></p>
<p id="section-6.4-2">When PE1 receives the packet, it will process the packet and perform 
   checks for the EVPN IP Prefix sub-TLV present in the Target FEC 
   Stack TLV as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8029#section-4.4">Section 4.4</a> of [<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> and respond 
   according to the processing rules in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.<a class="pilcrow" href="#section-6.4-2">¶</a></p>
</section>
</section>
</div>
<section id="section-7">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-7-1">  This document does not introduce any new 
           security considerations beyond those that apply in
           <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>, 
           <span>[<a class="cite xref" href="#RFC7623">RFC7623</a>]</span>, and  
           <span>[<a class="cite xref" href="#RFC6425">RFC6425</a>]</span>.

          Furthermore, the security considerations 
          discussed in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> apply to this document and need to be 
          considered. As described in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>, these security considerations 
          are:<a class="pilcrow" href="#section-7-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">A Denial-of-Service (DoS) attack by sending MPLS Echo 
                Requests/Replies to Label Switching Routers (LSRs) and thereby increasing their workload.<a class="pilcrow" href="#section-7-2.1">¶</a>
</li>
        <li class="normal" id="section-7-2.2">Obfuscating the state of the MPLS data plane liveness by spoofing, 
                 hijacking, replaying, or otherwise tampering with MPLS Echo Requests 
                 and Replies.<a class="pilcrow" href="#section-7-2.2">¶</a>
</li>
        <li class="normal" id="section-7-2.3">Obtaining information about the network through an unauthorized source 
                using an LSP Ping.<a class="pilcrow" href="#section-7-2.3">¶</a>
</li>
      </ul>
<p id="section-7-3"> There are mitigations described in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.  The same mitigations  
            can be applied to the LSP Ping procedures described in this document; thus, this document 
            doesn't require additional security considerations beyond the ones described 
            in <span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span>.<a class="pilcrow" href="#section-7-3">¶</a></p>
<p id="section-7-4"> This document does not introduce any new privacy concerns because these TLVs contain the same information that are present in data packets and EVPN routes.<a class="pilcrow" href="#section-7-4">¶</a></p>
</section>
<div id="iana">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-sub-tlv-type">
<a class="section-number selfRef" href="#section-8.1">8.1. </a><a class="section-name selfRef" href="#name-sub-tlv-type">Sub-TLV Type</a>
        </h3>
<p id="section-8.1-1">   This document defines four new sub-TLV types to be included in the Target 
   FEC Stack TLV (TLV types 1, 16, and 21) <span>[<a class="cite xref" href="#RFC9041">RFC9041</a>]</span> in Echo Request and Echo 
   Reply messages in EVPN and PBB-EVPN networks.<a class="pilcrow" href="#section-8.1-1">¶</a></p>
<p id="section-8.1-2">IANA has assigned the following values
        from the "Standards Action" (0-16383) range in the "Sub-TLVs for TLV
        Types 1, 16, and 21" subregistry within the "TLVs" registry of the
        "Multiprotocol Label Switching (MPLS) Label Switched Paths (LSPs)
        Ping Parameters" name space.<a class="pilcrow" href="#section-8.1-2">¶</a></p>
<div id="iana1">
<table class="center" id="table-1">
          <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Sub-Type</th>
              <th class="text-left" colspan="1" rowspan="1">Sub-TLV Name</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">42</td>
              <td class="text-left" colspan="1" rowspan="1">EVPN MAC/IP</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">43</td>
              <td class="text-left" colspan="1" rowspan="1">EVPN Inclusive Multicast</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">44</td>
              <td class="text-left" colspan="1" rowspan="1">EVPN Ethernet Auto-Discovery</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">45</td>
              <td class="text-left" colspan="1" rowspan="1">EVPN IP Prefix</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
<section id="section-8.2">
        <h3 id="name-new-return-codes">
<a class="section-number selfRef" href="#section-8.2">8.2. </a><a class="section-name selfRef" href="#name-new-return-codes">New Return Codes</a>
        </h3>
<p id="section-8.2-1"><span>[<a class="cite xref" href="#RFC8029">RFC8029</a>]</span> defines values for the Return Code field of Echo Reply messages. 
   This document defines two new Return Codes that <span class="bcp14">SHOULD</span> be 
   included in the Echo Reply message by a PE in response to  
   an Echo Request message in EVPN and PBB-EVPN networks.<a class="pilcrow" href="#section-8.2-1">¶</a></p>
<p id="section-8.2-2"> IANA has assigned the following values in the "Return Codes"
        registry of the "Multiprotocol Label Switching (MPLS) Label Switched
        Paths (LSPs) Ping Parameters" name space.<a class="pilcrow" href="#section-8.2-2">¶</a></p>
<div id="iana2">
<table class="center" id="table-2">
          <caption><a class="selfRef" href="#table-2">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Meaning</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">37</td>
              <td class="text-left" colspan="1" rowspan="1">Replying router is egress for the FEC at the stack depth. In
      addition, the BUM packets are dropped on the ES corresponding to the ESI
      received in the EVPN Ethernet Auto-Discovery sub-TLV because of the Split Horizon Group
      filtering.</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">38</td>
              <td class="text-left" colspan="1" rowspan="1">Replying router is egress for the FEC at the stack depth. In
      addition, the BUM packets are forwarded because there is no ES
      corresponding to the ESI received in the EVPN Ethernet Auto-Discovery sub-TLV.</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9489</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</section>
</div>
<section id="section-9">
      <h2 id="name-normative-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4760">[RFC4760]</dt>
      <dd>
<span class="refAuthor">Bates, T.</span>, <span class="refAuthor">Chandra, R.</span>, <span class="refAuthor">Katz, D.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"Multiprotocol Extensions for BGP-4"</span>, <span class="seriesInfo">RFC 4760</span>, <span class="seriesInfo">DOI 10.17487/RFC4760</span>, <time class="refDate" datetime="2007-01">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4760">https://www.rfc-editor.org/info/rfc4760</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5586">[RFC5586]</dt>
      <dd>
<span class="refAuthor">Bocci, M., Ed.</span>, <span class="refAuthor">Vigoureux, M., Ed.</span>, and <span class="refAuthor">S. Bryant, Ed.</span>, <span class="refTitle">"MPLS Generic Associated Channel"</span>, <span class="seriesInfo">RFC 5586</span>, <span class="seriesInfo">DOI 10.17487/RFC5586</span>, <time class="refDate" datetime="2009-06">June 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5586">https://www.rfc-editor.org/info/rfc5586</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6425">[RFC6425]</dt>
      <dd>
<span class="refAuthor">Saxena, S., Ed.</span>, <span class="refAuthor">Swallow, G.</span>, <span class="refAuthor">Ali, Z.</span>, <span class="refAuthor">Farrel, A.</span>, <span class="refAuthor">Yasukawa, S.</span>, and <span class="refAuthor">T. Nadeau</span>, <span class="refTitle">"Detecting Data-Plane Failures in Point-to-Multipoint MPLS - Extensions to LSP Ping"</span>, <span class="seriesInfo">RFC 6425</span>, <span class="seriesInfo">DOI 10.17487/RFC6425</span>, <time class="refDate" datetime="2011-11">November 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6425">https://www.rfc-editor.org/info/rfc6425</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
      <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time class="refDate" datetime="2015-02">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7623">[RFC7623]</dt>
      <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"Provider Backbone Bridging Combined with Ethernet VPN (PBB-EVPN)"</span>, <span class="seriesInfo">RFC 7623</span>, <span class="seriesInfo">DOI 10.17487/RFC7623</span>, <time class="refDate" datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7623">https://www.rfc-editor.org/info/rfc7623</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8029">[RFC8029]</dt>
      <dd>
<span class="refAuthor">Kompella, K.</span>, <span class="refAuthor">Swallow, G.</span>, <span class="refAuthor">Pignataro, C., Ed.</span>, <span class="refAuthor">Kumar, N.</span>, <span class="refAuthor">Aldrin, S.</span>, and <span class="refAuthor">M. Chen</span>, <span class="refTitle">"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"</span>, <span class="seriesInfo">RFC 8029</span>, <span class="seriesInfo">DOI 10.17487/RFC8029</span>, <time class="refDate" datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8029">https://www.rfc-editor.org/info/rfc8029</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8214">[RFC8214]</dt>
      <dd>
<span class="refAuthor">Boutros, S.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Virtual Private Wire Service Support in Ethernet VPN"</span>, <span class="seriesInfo">RFC 8214</span>, <span class="seriesInfo">DOI 10.17487/RFC8214</span>, <time class="refDate" datetime="2017-08">August 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8214">https://www.rfc-editor.org/info/rfc8214</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9041">[RFC9041]</dt>
      <dd>
<span class="refAuthor">Andersson, L.</span>, <span class="refAuthor">Chen, M.</span>, <span class="refAuthor">Pignataro, C.</span>, and <span class="refAuthor">T. Saad</span>, <span class="refTitle">"Updating the MPLS Label Switched Paths (LSPs) Ping Parameters IANA Registry"</span>, <span class="seriesInfo">RFC 9041</span>, <span class="seriesInfo">DOI 10.17487/RFC9041</span>, <time class="refDate" datetime="2021-07">July 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9041">https://www.rfc-editor.org/info/rfc9041</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9136">[RFC9136]</dt>
    <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"IP Prefix Advertisement in Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 9136</span>, <span class="seriesInfo">DOI 10.17487/RFC9136</span>, <time class="refDate" datetime="2021-10">October 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9136">https://www.rfc-editor.org/info/rfc9136</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank <span class="contact-name">Loa Andersson</span>,
      <span class="contact-name">Alexander Vainshtein</span>, <span class="contact-name">Ron       Sdayoor</span>, <span class="contact-name">Jim Guichard</span>, <span class="contact-name">Lars       Eggert</span>, <span class="contact-name">John Scudder</span>, <span class="contact-name">Éric       Vyncke</span>, <span class="contact-name">Warren Kumari</span>, <span class="contact-name">Patrice Brissette</span>, and <span class="contact-name">Weiguo Hao</span> for
      their valuable comments.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Parag Jain</span></div>
<div class="left" dir="auto"><span class="org">Cisco</span></div>
<div class="left" dir="auto"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:paragj@cisco.com">paragj@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Ali Sajassi</span></div>
<div class="left" dir="auto"><span class="org">Cisco</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sajassi@cisco.com">sajassi@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Samer Salam</span></div>
<div class="left" dir="auto"><span class="org">Cisco</span></div>
<div class="left" dir="auto"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ssalam@cisco.com">ssalam@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Sami Boutros</span></div>
<div class="left" dir="auto"><span class="org">Ciena</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sboutros@ciena.com">sboutros@ciena.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Greg Mirsky</span></div>
<div class="left" dir="auto"><span class="org">Ericsson</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:gregimirsky@gmail.com">gregimirsky@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>