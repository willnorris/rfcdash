<html><head></head><body><pre>Internet Engineering Task Force (IETF)                           H. Chen
Request for Comments: 8099                                         R. Li
Category: Experimental                               Huawei Technologies
ISSN: 2070-1721                                                A. Retana
                                                     Cisco Systems, Inc.
                                                                 Y. Yang
                                                                Sockrate
                                                                  Z. Liu
                                                            China Mobile
                                                           February 2017


                     <span class="h1">OSPF Topology-Transparent Zone</span>

Abstract

   This document presents a Topology-Transparent Zone (TTZ) in an OSPF
   area.  A TTZ comprises a group of routers and a number of links
   connecting these routers.  Any router outside of the zone is not
   aware of the zone.  A TTZ hides the internal topology of the TTZ from
   the outside.  It does not directly advertise any internal information
   about the TTZ to a router outside of the TTZ.  The information about
   the links and routers such as a link down inside the TTZ is not
   advertised to any router outside of the TTZ.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for examination, experimental implementation, and
   evaluation.

   This document defines an Experimental Protocol for the Internet
   community.  This document is a product of the Internet Engineering
   Task Force (IETF).  It represents the consensus of the IETF
   community.  It has received public review and has been approved for
   publication by the Internet Engineering Steering Group (IESG).  Not
   all documents approved by the IESG are a candidate for any level of
   Internet Standard; see <a href="./rfc7841#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc8099">http://www.rfc-editor.org/info/rfc8099</a>.









<span class="grey">Chen, et al.                  Experimental                      [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Chen, et al.                  Experimental                      [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Conventions Used in This Document . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Requirements  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  Topology-Transparent Zone . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-5.1">5.1</a>.  Overview of Topology-Transparent Zone . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-5.2">5.2</a>.  TTZ Example . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-6">6</a>.  Extensions to OSPF Protocols  . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-6.1">6.1</a>.  General Format of TTZ LSA . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-6.2">6.2</a>.  TTZ ID TLV  . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-6.3">6.3</a>.  TTZ Router TLV  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-6.4">6.4</a>.  TTZ Options TLV . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.5">6.5</a>.  Link Scope TTZ LSA  . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-7">7</a>.  Constructing LSAs for TTZ . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.1">7.1</a>.  TTZ Migration Process . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-8">8</a>.  Establishing Adjacencies  . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-8.1">8.1</a>.  Discovery of TTZ Neighbors  . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-8.2">8.2</a>.  Adjacency between TTZ Edge and TTZ-External Router  . . .  <a href="#page-17">17</a>
   <a href="#section-9">9</a>.  Advertisement of LSAs . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-9.1">9.1</a>.  Advertisement of LSAs within TTZ  . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-9.2">9.2</a>.  Advertisement of LSAs through TTZ . . . . . . . . . . . .  <a href="#page-18">18</a>
   <a href="#section-10">10</a>. Computation of Routing Table  . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
   <a href="#section-11">11</a>. Operations  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
     <a href="#section-11.1">11.1</a>.  Configuring TTZ  . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
     <a href="#section-11.2">11.2</a>.  Migration to TTZ . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-11.3">11.3</a>.  Adding a Router into TTZ . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   <a href="#section-12">12</a>. Manageability Considerations  . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
   <a href="#section-13">13</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
   <a href="#section-14">14</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
   <a href="#section-15">15</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-23">23</a>
     <a href="#section-15.1">15.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-23">23</a>
     <a href="#section-15.2">15.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-23">23</a>
   <a href="#appendix-A">Appendix A</a>.  Prototype Implementation . . . . . . . . . . . . . .  <a href="#page-24">24</a>
     <a href="#appendix-A.1">A.1</a>.  What Is Implemented and Tested  . . . . . . . . . . . . .  <a href="#page-24">24</a>
     <a href="#appendix-A.2">A.2</a>.  Implementation Experience . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-26">26</a>
   Contributors  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-26">26</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>











<span class="grey">Chen, et al.                  Experimental                      [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Networks expand as business grows and traffic increases.  For
   scalability and manageability, a hierarchical network architecture is
   usually deployed in OSPF networks by regrouping routers into areas,
   which is often challenging and causes service interruptions.

   At first, reorganizing a network from one area into multiple areas or
   from a number of existing areas into even more areas is a very
   challenging and time-consuming task since it involves significant
   network architecture changes.  Considering the one area case,
   originally the network has only one area, which is the backbone.
   This original backbone area will be reorganized into a new backbone
   and a number of non-backbone areas.  In general, each of the
   non-backbone areas is connected to the new backbone area through the
   Area Border Routers (ABRs) between the non-backbone and the backbone
   area (refer to <a href="./rfc2328#section-3">RFC 2328, Section 3</a>).  It demands careful redesigning
   of network topology in advance to guarantee backbone area continuity
   and non-backbone-area reachability, and it requires significant
   modifications of configurations on many routers to ensure consistent
   routing.

   Second, the services carried by the network may be interrupted while
   the network is being reorganized from one area into multiple areas or
   from a number of existing areas into even more areas since every OSPF
   interface with an area change is going down with its old area and
   then up with a new area.

   This document presents a Topology-Transparent Zone (TTZ) in an OSPF
   area and describes extensions to OSPFv2 for supporting the TTZ, which
   is scalable and resolves the issues above.  A TTZ hides the internal
   topology of the TTZ from the outside.  It does not directly advertise
   any internal information about the TTZ to any router outside of the
   TTZ.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   TTZ link or TTZ-internal link:
       A link whose ends are within a single TTZ.

   TTZ-internal router:
       A router whose links are TTZ-internal links inside a single TTZ.

   TTZ-external router:
       A router outside of a TTZ that has no TTZ-internal links.

   TTZ-external link:
       A link not configured to be within a TTZ.



<span class="grey">Chen, et al.                  Experimental                      [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   TTZ edge router:
       A router is called a TTZ edge router if some, but not all, of its
       links are within a single TTZ.

   TTZ router:
       A TTZ-internal router or a TTZ edge router.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Requirements"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Requirements</span>

   A Topology-Transparent Zone may be deployed to resolve some critical
   issues in existing networks and future networks.  The requirements
   for a TTZ are listed as follows:

   o  Routers outside a TTZ MUST NOT require any changes to operate with
      the TTZ.

   o  A TTZ MUST be enclosed in a single area.

   o  A TTZ MUST hide the topology of the TTZ from any router outside of
      the TTZ.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Topology-Transparent%20Zone"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Topology-Transparent Zone</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20Overview%20of%20Topology-Transparent%20Zone"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Overview of Topology-Transparent Zone</span>

   A Topology-Transparent Zone is identified by a TTZ identifier (ID),
   and it consists of a group of routers and a number of links
   connecting the routers.  A TTZ MUST be contained within an OSPF area.

   A TTZ ID is a 32-bit number that is unique for identifying a TTZ.
   The TTZ ID SHOULD NOT be 0 in order to avoid confusion with Area 0.
   The same TTZ ID MUST be configured on the routers and/or links that
   make up a specific instance of a TTZ.  All TTZ instances in an OSPF
   area MUST be unique.

   In addition to having similar functions of an OSPF area, an OSPF TTZ
   makes some improvements on an OSPF area, which include:

   o  An OSPF TTZ represents a set of TTZ edge routers, connected by a
      full mesh of virtual connections between them.





<span class="grey">Chen, et al.                  Experimental                      [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   o  Non-TTZ link-state information is handled as normal.  TTZ routers
      receive the link-state information about the topology outside of
      the TTZ, store the information, and flood the information through
      the TTZ to the routers outside of the TTZ.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20TTZ%20Example"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  TTZ Example</span>

   The figure below shows an area containing a TTZ: TTZ 600.

                 TTZ 600                       ---- TTZ-Internal Link
                   \                           ==== Normal Link
     Area X         \ ^~^~^~^~^~^~^~^~^~^~^~^~
                     (                        )
    ===[R15]========(==[T61]----[T81]---[T63]==)======[R29]===
        ||         (   |    \          /    |   )       ||
        ||         (   |     \        /     |   )       ||
        ||         ( [T75]    \      /      |   )       ||
        ||         (   |    ___\    /       |   )       ||
        ||         (   |   /   [T71]     [T79]  )       ||
        ||         (   | [T73] /    \       |   )       ||
        ||         (   |      /      \      |   )       ||
        ||         (   |     /        \     |   )       ||
        ||         (   |    /          \    |   )       ||
    ===[R17]========(==[T65]---[T77]----[T67]==)======[R31]===
         \\          (//                    \\)       //
          ||         //v~v~v~v~v~v~v~v~v~v~v~\\      ||
          ||        //                        \\     ||
          ||       //                          \\    ||
           \\     //                            \\  //
       ======[R23]==============================[R25]=====
             //                                     \\
            //                                       \\

   All the routers in the figure are in area X.  Routers with T (i.e.,
   T61, T63, T65, T67, T71, T73, T75, T77, T79, and T81) are also in TTZ
   600, which contains the TTZ-internal links connecting them.  To
   create a TTZ, we need to configure it (refer to <a href="#section-11">Section 11</a>).

   There are two types of routers in a TTZ: TTZ-internal and TTZ edge
   routers.  TTZ 600 has four TTZ edge routers: T61, T63, T65, and T67.
   Each of them has at least one adjacent router in TTZ 600 and one
   adjacent router outside of TTZ 600.  For instance, router T61 is a
   TTZ edge router since it has an adjacent router, R15, outside of TTZ
   600 and three adjacent routers T71, T75, and T81 in TTZ 600.

   In addition, TTZ 600 comprises six TTZ-internal routers: T71, T73,
   T75, T77, T79, and T81.  Each of them has all its adjacent routers in
   TTZ 600.  For instance, router T71 is a TTZ-internal router since its



<span class="grey">Chen, et al.                  Experimental                      [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   adjacent routers, T61, T63, T65, T67, and T73, are all in TTZ 600.
   It should be noted that, by definition, a TTZ-internal router cannot
   also be an ABR.

   A TTZ hides the internal topology of the TTZ from the outside.  It
   does not directly advertise any internal information about the TTZ to
   any router outside of the TTZ.

   For instance, TTZ 600 does not send the information about TTZ-
   internal router T71 to any router outside of TTZ 600; it does not
   send the information about the link between TTZ routers T61 and T71
   to any router outside of TTZ 600.

   The figure below illustrates area X from the point of view of a
   router outside of TTZ 600 after TTZ 600 is created.

     Area X                                    ==== Normal Link

    ===[R15]===========[T61]=========[T63]=========[R29]===
        ||             ||  \\      //   ||           ||
        ||             ||   \\    //    ||           ||
        ||             ||    \\  //     ||           ||
        ||             ||     \\//      ||           ||
        ||             ||      //\      ||           ||
        ||             ||     // \\     ||           ||
        ||             ||    //   \\    ||           ||
        ||             ||   //     \\   ||           ||
        ||             ||  //       \\  ||           ||
    ===[R17]===========[T65]=========[T67]=========[R31]===
         \\           //                  \\        //
          ||         //                    \\      ||
          ||        //                      \\     ||
          ||       //                        \\    ||
           \\     //                          \\  //
       ======[R23]============================[R25]=====
             //                                   \\
            //                                     \\

   From a router outside of the TTZ, a TTZ is seen as the TTZ edge
   routers connected to each other.  For instance, router R15 sees that
   T61, T63, T65, and T67 are connected to each other.

   In addition, a router outside of the TTZ sees TTZ edge routers having
   normal connections to the routers outside of the TTZ.  For example,
   router R15 sees that T61, T63, T65, and T67 have the normal
   connections to R15; R29; R17 and R23; and R25 and R31, respectively.





<span class="grey">Chen, et al.                  Experimental                      [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Extensions%20to%20OSPF%20Protocols"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Extensions to OSPF Protocols</span>

   The link-state information about a TTZ includes router Link-State
   Advertisements (LSAs), which can be contained and advertised in
   opaque LSAs [<a href="./rfc5250" title='"The OSPF Opaque LSA Option"'>RFC5250</a>] within the TTZ.  Some control information
   regarding a TTZ can also be contained and advertised in opaque LSAs
   within the TTZ.  These opaque LSAs are called TTZ opaque LSAs or TTZ
   LSAs for short.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20General%20Format%20of%20TTZ%20LSA"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  General Format of TTZ LSA</span>

   The following is the general format of a TTZ LSA.  It has a Link-
   State (LS) Type = 10/9 and TTZ LSA Type, and it contains a number of
   TLVs.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            LS age             |     Options   | LS Type = 10/9|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |TTZ LSA Type(9)|                   Instance ID                 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Advertising Router                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      LS Sequence Number                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         LS checksum           |           Length              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      ~                              TLVs                             ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   There are three TTZ LSAs of LS Type 10 defined:

   o  TTZ router LSA: a TTZ LSA containing a TTZ ID TLV and a TTZ Router
      TLV.

   o  TTZ control LSA: a TTZ LSA containing a TTZ ID TLV and a TTZ
      Options TLV.

   o  TTZ indication LSA: a TTZ LSA containing a TTZ ID TLV with E = 0,
      which indicates that the router originating this LSA is a TTZ-
      internal router.

   There is one TTZ LSA of LS Type 9:

   o  TTZ discovery LSA: a TTZ LSA containing a TTZ ID TLV and an
      optional TTZ Options TLV.



<span class="grey">Chen, et al.                  Experimental                      [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20TTZ%20ID%20TLV"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  TTZ ID TLV</span>

   A TTZ ID TLV has the following format.  It contains a TTZ ID (refer
   to <a href="#section-5.1">Section 5.1</a>) and some flags.  It has the TLV-Length of 8 octets.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      TTZ ID TLV Type (1)      |        TLV-Length (8)         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                            TTZ ID                             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                 Reserved (MUST be zero)                   |E|Z|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      E = 1: Indicating a router is a TTZ edge router
      Z = 1: Indicating a router has migrated to TTZ

   When a TTZ router originates a TTZ LSA containing a TTZ ID TLV, it
   MUST set flag E to 1 in the TTZ ID TLV if it is a TTZ edge router and
   to 0 if it is a TTZ-internal router.  It MUST set flag Z to 1 after
   it has migrated to TTZ and to 0 before it migrates to TTZ or after it
   rolls back from TTZ (refer to <a href="#section-6.4">Section 6.4</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.3.%20%20TTZ%20Router%20TLV"></a><a class="selflink" href="#section-6.3" id="section-6.3">6.3</a>.  TTZ Router TLV</span>

   The format of a TTZ Router TLV is as follows.  It has the same
   content as a standard OSPF router LSA (<a href="./rfc2328">RFC 2328</a>) with the following
   modifications.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      TTZ RT TLV Type (2)      |          TLV-Length           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     0   |V|E|B|        0      |            # links            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                          Link ID                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         Link Data                             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |     # TOS     |            metric             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ~                              ...                              ~

      Note: TOS = Type of Service





<span class="grey">Chen, et al.                  Experimental                      [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   For a router link, the existing 8-bit Link Type field for a router
   link is split into two fields as follows:

         0   1   2   3   4   5   6   7
       +---+---+---+---+---+---+---+---+
       | I |         Type-1            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       I bit flag:
         1: Router link is a TTZ-internal link.
         0: Router link is a TTZ-external link.
       Type-1: The kind of the link.  The values for Type-1 are the same
               as those for Type defined in <a href="./rfc2328#section-12.4.1">RFC 2328, Section 12.4.1</a>.

   The Link Type field is 8 bits and the values 128-255 of the field are
   reserved (refer to [<a href="./rfc4940" title='"IANA Considerations for OSPF"'>RFC4940</a>]), which allows the reuse of the bottom 7
   bits to indicate the type of TTZ-internal or external link.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.%20%20TTZ%20Options%20TLV"></a><a class="selflink" href="#section-6.4" id="section-6.4">6.4</a>.  TTZ Options TLV</span>

   The format of a TTZ Options TLV is as follows.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      TTZ OP TLV Type (3)      |          TLV-Length           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  OP |                 Reserved (MUST be zero)                 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       OP Value    Meaning (Operation)
       0x001 (T):  Advertising TTZ Topology Information for Migration
       0x010 (M):  Migrating to TTZ
       0x011 (N):  Advertising Normal Topology Information for Rollback
       0x100 (R):  Rolling Back from TTZ

   An OP field of 3 bits is defined.  It may have a value of 0x001 for
   T, 0x010 for M, 0x011 for N, or 0x100 for R, which indicates one of
   the four operations above.  When any of the other values is received,
   it is ignored.

   Advertising TTZ Topology Information for Migration (T):
       After a user configures a TTZ router to advertise TTZ topology
       information, advertising TTZ topology information for migration
       is triggered.  The TTZ router originates a TTZ control LSA having
       a TTZ Options TLV with OP for T.  It also originates its other





<span class="grey">Chen, et al.                  Experimental                     [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


       TTZ LSA such as a TTZ router LSA or TTZ indication LSA.  When
       another TTZ router receives the LSA with OP for T, it originates
       its TTZ LSA as described in <a href="#section-7">Section 7</a>.

   Migrating to TTZ (M):
       After a user configures a TTZ router to migrate to TTZ, migrating
       to TTZ is triggered.  The TTZ router originates a TTZ control LSA
       having a TTZ Options TLV with OP for M and migrates to TTZ.  When
       another TTZ router receives the LSA with OP for M, it also
       migrates to TTZ.  When a router migrates to TTZ, it computes
       routes using the TTZ topology and the topology outside of the
       TTZ.  For a TTZ-internal router, it also updates its TTZ
       indication LSA with Z = 1.  For a TTZ edge router, it updates its
       TTZ router LSA with Z = 1 and its router LSA for virtualizing the
       TTZ.  A TTZ router determines whether it is internal or edge
       based on configurations (refer to <a href="#section-11.1">Section 11.1</a>).

   Advertising Normal Topology Information for Rollback (N):
       After a user configures a TTZ router to advertise normal topology
       information, advertising Normal topology information for rollback
       is triggered.  The TTZ router originates a TTZ control LSA having
       a TTZ Options TLV with OP for N.  It also advertises its normal
       LSAs such as its normal router LSA and stops advertising its
       other TTZ LSAs.  When another TTZ router receives the LSA with OP
       for N, it forwards the LSA, advertises its normal LSAs, and stops
       advertising its TTZ LSAs.

   Rolling back from TTZ (R):
       After a user configures a TTZ router to roll back from TTZ,
       rolling back from TTZ is triggered.  The TTZ router originates a
       TTZ control LSA having a TTZ Options TLV with OP for R and rolls
       back from TTZ.  When another TTZ router receives the LSA with OP
       for R, it also rolls back from TTZ.

   After a TTZ router originates a TTZ control LSA in response to a
   configuration described above to control TTZ, it flushes the TTZ
   control LSA if OP in the LSA is set for the configuration and the
   configuration is removed.













<span class="grey">Chen, et al.                  Experimental                     [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.5.%20%20Link%20Scope%20TTZ%20LSA"></a><a class="selflink" href="#section-6.5" id="section-6.5">6.5</a>.  Link Scope TTZ LSA</span>

   A TTZ LSA of LS Type 9 has the following format.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            LS age             |     Options   | LS Type = 9   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |TTZ LSA Type(9)|                   Instance ID                 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Advertising Router                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      LS Sequence Number                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |         LS checksum           |           Length              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      ~                           TTZ ID TLV                          ~
      +---------------------------------------------------------------+
      |                                                               |
      ~                        (TTZ Options TLV)                      ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   It contains a mandatory TTZ ID TLV, which may be followed by an
   optional TTZ Options TLV.  It is used to discover a TTZ neighbor.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Constructing%20LSAs%20for%20TTZ"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Constructing LSAs for TTZ</span>

   For a TTZ, its topology is represented by the LSAs generated by its
   TTZ routers for the link states in the TTZ, which include TTZ router
   LSAs by TTZ edge routers, TTZ indication LSAs by TTZ-internal
   routers, normal router LSAs, and network LSAs.  The TTZ router LSAs
   and TTZ indication LSAs MUST be generated after advertising TTZ
   topology information for migration is triggered.

   A TTZ edge router generates a TTZ router LSA that has a TTZ ID TLV
   and a TTZ Router TLV.  The former includes the ID of the TTZ to which
   the router belongs and flag E is set to 1, which indicates the
   originator of the LSA is a TTZ edge router.  The TTZ Router TLV
   contains the TTZ-external links to the routers outside of the TTZ and
   the TTZ-internal links to the routers inside of the TTZ as described
   in <a href="#section-6">Section 6</a>.  The TTZ router LSA containing this TLV is constructed
   and advertised within the TTZ.

   A TTZ-internal router generates a TTZ indication LSA that has a TTZ
   ID TLV containing the ID of the TTZ to which the router belongs and
   flag E is set to 0, which indicates the originator of the LSA is a



<span class="grey">Chen, et al.                  Experimental                     [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   TTZ-internal router.  For a TTZ-internal router, its regular router
   LSA is still generated.  If a TTZ router is a Designated Router (DR),
   it originates its regular network LSA.

   After receiving a trigger to migrate to TTZ such as a TTZ control LSA
   with OP for M, a TTZ edge router MUST originate its normal router LSA
   for virtualizing a TTZ, which comprises three groups of links in
   general.

   The first group is the router links connecting the TTZ-external
   routers.  These router links are normal router links.  There is a
   router link for every adjacency between this TTZ edge router and a
   TTZ-external router.

   The second group is the "virtual" router links connecting to the
   other TTZ edge routers.  For each of the other TTZ edge routers,
   there is a corresponding point-to-point (P2P) router link to it from
   this TTZ edge router.  The cost of the link is the cost of the
   shortest path from this TTZ edge router to the other TTZ edge router
   within the TTZ.

   In addition, the LSA may contain a third group of links, which are
   the stub links for the loopback addresses inside the TTZ to be
   accessed by nodes outside of the TTZ.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20TTZ%20Migration%20Process"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  TTZ Migration Process</span>

   After migration to TTZ is triggered, a TTZ router computes routes
   using its TTZ topology (refer to <a href="#section-10">Section 10</a>), and a TTZ edge router
   originates its normal router LSA for virtualizing the TTZ in two
   steps:

   Step 1:  The router updates its router LSA by adding a P2P link to
      each of the other known edge routers in the TTZ and also by adding
      the stub links for the loopback addresses in the TTZ to be
      accessed outside of the TTZ according to configuration policies of
      operators.

   Step 2:  After MaxLSAGenAdvTime (0.3 s) or sr-time + MaxLSAAdvTime
      (0.1 s), it removes the TTZ links from its router LSA, where
      sr-time is the time from updating its router LSA to receiving the
      ack for its router LSA and receiving the updated router LSAs
      originated by the other TTZ edge routers.  In other words, it
      removes the TTZ links from its router LSA after sending its
      updated router LSA and receiving the updated router LSAs
      originated by the other TTZ edge routers for MaxLSAAdvTime or
      after sending its updated router LSA for MaxLSAGenAdvTime.
      MaxLSAAdvTime and MaxLSAGenAdvTime SHOULD be set to 100 ms and 300



<span class="grey">Chen, et al.                  Experimental                     [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


      ms, respectively, but MAY be configurable.  The former is the
      maximum time for an LSA to be advertised to all the routers in an
      area.  The latter is the maximum time for all TTZ router LSAs to
      be generated by all TTZ edge routers and advertised to all the
      routers in an area after a first TTZ router LSA is generated.

   This is to avoid a possible route down or change in a TTZ-external
   router while the TTZ is being virtualized.  If each TTZ edge router
   originates its router LSA by adding its P2P links to the other TTZ
   edge routers and removing its TTZ links in one step, a route taking a
   path through the TTZ in the TTZ-external router may be down or
   changed before all the router LSAs generated by the TTZ edge routers
   reach the TTZ-external router.  When the TTZ-external router computes
   routes with some router LSAs originated by the TTZ edge routers,
   bidirectional checks for some of the P2P links will fail.  Thus, the
   route taking the path through the shortest path for the P2P link
   failing the bidirectional check will be down or changed.

   To roll back from a TTZ smoothly after receiving a trigger to roll
   back from TTZ, a TTZ edge router MUST originate its normal router LSA
   in the above two steps in a reverse way.

   Step 1:  Initially, it updates its normal router LSA by adding the
      normal links for the links configured as TTZ links into the LSA.

   Step 2:  It then removes the P2P links to the other edge routers of
      the TTZ for virtualizing the TTZ and the stub links for the
      loopback addresses from its updated router LSA after sending its
      updated router LSA and receiving the updated router LSAs
      originated by the other TTZ edge routers for MaxLSAAdvTime or
      after sending its updated router LSA for MaxLSAGenAdvTime.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Establishing%20Adjacencies"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Establishing Adjacencies</span>

   This section describes the TTZ adjacencies.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Discovery%20of%20TTZ%20Neighbors"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Discovery of TTZ Neighbors</span>

   When two routers A and B are connected by a P2P link and have a
   normal adjacency, they TTZ discover each other through a TTZ LSA of
   LS Type 9 with a TTZ ID TLV.  We call this LSA D-LSA for short.

   If two ends of the link have different TTZ IDs or only one end is
   configured with a TTZ ID, TTZ adjacency over the link MUST NOT be
   "formed".






<span class="grey">Chen, et al.                  Experimental                     [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   If two ends of the link have the same TTZ ID and Z flag value, A and
   B are TTZ neighbors.  The following is a sequence of events related
   to TTZ for this case.

           A                                         B
      Configure TTZ                             Configure TTZ
                          D-LSA (TTZ ID=100)
                        ----------------------&gt; Same TTZ ID and Z
                                                A is B's TTZ Neighbor
                          D-LSA (TTZ ID=100)
      Same TTZ ID and Z &lt;----------------------
      B is A's TTZ Neighbor

   A sends B a D-LSA with TTZ ID after the TTZ is configured on it.  B
   sends A a D-LSA with TTZ ID after the TTZ is configured on it.

   When A receives the D-LSA from B and determines they have the same
   TTZ ID and Z flag value, B is A's TTZ neighbor.  A also sends B all
   the TTZ LSAs it has and originates its TTZ LSA when one of the
   following conditions is met.

   o  Z = 0 and there is a TTZ LSA with OP for T.

   o  Z = 1.

   B is symmetric to A and acts similarly to A.

   If two ends of the link have the same TTZ ID but the Z flags are
   different, a TTZ adjacency over the link MUST be "formed" in the
   following steps.  Suppose that A has migrated to TTZ and B has not
   (i.e., flag Z in A's D-LSA is 1, and flag Z in B's D-LSA is 0).

           A                                          B
      Configure TTZ                              Configure TTZ
                         D-LSA(TTZ ID=100,Z=1)
                        ----------------------&gt; Same TTZ ID, but
                                                different Z
                                                A is B's TTZ Neighbor
                         D-LSA(TTZ ID=100,Z=0)
      Same TTZ ID, but &lt;----------------------
      different Z
      B is A's TTZ Neighbor
                               TTZ LSAs
                       -----------------------&gt;
                               TTZ LSAs
                       &lt;-----------------------





<span class="grey">Chen, et al.                  Experimental                     [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   When A receives the D-LSA from B and determines they have the same
   TTZ ID but its Z = 1 and B's Z = 0, A sends B all the TTZ LSAs it has
   and triggers B to migrate to TTZ.  A updates and sends B its D-LSA by
   adding a TTZ Options TLV with OP for M after sending B all the TTZ
   LSAs.

                         D-LSA(TTZ ID=100,OP=M)
      Add TTZ Options  -----------------------&gt; Migrate to TTZ
      TLV with OP for M
                         D-LSA(TTZ ID=100,Z=1)  Migrated to TTZ
                       &lt;----------------------- Set Z=1

                         D-LSA(TTZ ID=100,Z=1)
      Remove           -----------------------&gt;
      TTZ Options TLV

   When B receives the D-LSA from A and determines they have the same
   TTZ ID but its Z = 0 and A's Z = 1, B sends A all the TTZ LSAs it
   has.

   When B receives the D-LSA from A with OP for M, it starts to migrate
   to TTZ.  B updates and advertises its LSAs as needed.

   After receiving B's D-LSA with Z = 1, A updates and sends B its D-LSA
   by removing the TTZ Options TLV.  It also updates and advertises its
   LSAs as needed.

   When a number of routers connected through a broadcast link have
   normal adjacencies among them, they also TTZ discover each other
   through D-LSAs.  The Designated Router (DR) for the link MUST "form"
   TTZ adjacencies with the other routers if all the routers attached to
   the link have the same TTZ ID configured on the connections to the
   link.  Otherwise, the DR MUST NOT "form" any TTZ adjacency with any
   router attached to the link.

   When a number of routers connected through a broadcast link have TTZ
   adjacencies among them, if a misconfigured router is introduced on
   the broadcast link, the DR for the link MUST NOT "form" any TTZ
   adjacency with this misconfigured router.

   For routers connected via a link without any adjacency among them,
   they TTZ discover each other through D-LSAs in the same way as
   described above after they form a normal adjacency.

   A TTZ adjacency over a link MUST be removed when one of the following
   events happens.

   o  TTZ ID on one end of the link is changed to a different one.



<span class="grey">Chen, et al.                  Experimental                     [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   o  TTZ ID on one end of the link is removed.

   o  The D-LSA is not received after the D-LSA-MAX-RETRANSMIT-TIME or
      is explicitly flushed.  The D-LSA-MAX-RETRANSMIT-TIME SHOULD be
      set to 60 minutes, but MAY be configurable.

   o  Normal adjacency over the link is down.

   When the TTZ ID on one end of the link is removed, the corresponding
   D-LSA is flushed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20Adjacency%20between%20TTZ%20Edge%20and%20TTZ-External%20Router"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  Adjacency between TTZ Edge and TTZ-External Router</span>

   A TTZ edge router forms an adjacency with any TTZ-external router to
   which it is connected.

   When the TTZ edge router synchronizes its link-state database with
   the TTZ-external router, it sends the TTZ-external router the
   information about all the LSAs except for the LSAs belonging to the
   TTZ that are hidden from any router outside of the TTZ.

   At the end of the link-state database synchronization, the TTZ edge
   router originates its own router LSA for virtualizing the TTZ and
   sends this LSA to its adjacent routers, including the TTZ-external
   router.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Advertisement%20of%20LSAs"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Advertisement of LSAs</span>

   LSAs can be divided into a couple of classes according to their
   Advertisements.  The first class of LSAs is advertised within a TTZ.
   The second is advertised through a TTZ.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Advertisement%20of%20LSAs%20within%20TTZ"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Advertisement of LSAs within TTZ</span>

   Any LSA about a link state in a TTZ is advertised only within the
   TTZ.  It is not advertised to any router outside of the TTZ.  For
   example, a router LSA generated for a TTZ-internal router is
   advertised only within the TTZ.

   Any network LSA generated for a broadcast or Non-Broadcast Multi-
   Access (NBMA) network in a TTZ is advertised only within the TTZ.  It
   is not advertised outside of the TTZ.

   Any opaque LSA generated for a TTZ-internal TE link is advertised
   only within the TTZ.






<span class="grey">Chen, et al.                  Experimental                     [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   After migrating to TTZ, every edge router of a TTZ MUST NOT advertise
   any LSA about a link state in the TTZ to any router outside of the
   TTZ.  The TTZ edge router determines whether an LSA is about a TTZ-
   internal link state by checking if the advertising router of the LSA
   is a TTZ-internal router (i.e., there is a TTZ indication LSA
   generated by the TTZ-internal router that has the same advertising
   router).

   For any TTZ LSA originated by a router within the TTZ, every edge
   router of the TTZ MUST NOT advertise it to any router outside of the
   TTZ.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Advertisement%20of%20LSAs%20through%20TTZ"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Advertisement of LSAs through TTZ</span>

   Any LSA about a link state outside of a TTZ received by an edge
   router of the TTZ is advertised using the TTZ as transit.  For
   example, when an edge router of a TTZ receives an LSA from a router
   outside of the TTZ, it floods it to its neighboring routers both
   inside and outside of the TTZ.  This LSA may be any LSA such as a
   router LSA that is advertised within an OSPF area.

   The routers in the TTZ continue to flood the LSA.  When another edge
   router of the TTZ receives the LSA, it floods the LSA to its
   neighboring routers both inside and outside of the TTZ.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Computation%20of%20Routing%20Table"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Computation of Routing Table</span>

   After a router migrates to TTZ, the computation of the routing table
   on the router is the same as that described in <a href="./rfc2328#section-16">RFC 2328, Section 16</a>
   with one exception.  The router in a TTZ ignores the router LSAs
   generated by the TTZ edge routers for virtualizing the TTZ.  It
   computes routes using the TTZ router LSAs and the regular LSAs,
   excluding the router LSAs for virtualizing the TTZ.  That is, it
   computes routes using the TTZ topology and the topology outside of
   the TTZ, excluding the links for virtualizing the TTZ.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20Operations"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  Operations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.1.%20%20Configuring%20TTZ"></a><a class="selflink" href="#section-11.1" id="section-11.1">11.1</a>.  Configuring TTZ</span>

   This section proposes some options for configuring a TTZ.

   1.  Configuring TTZ on Every Link in TTZ

   If every link in a TTZ is configured with the same TTZ ID as a TTZ
   link, the TTZ is determined.  A router with some links in a TTZ and
   some links not in this TTZ is a TTZ edge router.  A router with all
   its links in a TTZ is a TTZ-internal router.



<span class="grey">Chen, et al.                  Experimental                     [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   2.  Configuring TTZ on Routers in TTZ

   A same TTZ ID is configured on every TTZ-internal router in a TTZ and
   on every TTZ edge router's links connecting to the routers in the
   TTZ.

   A router configured with the TTZ ID on some of its links is a TTZ
   edge router.  A router configured with the TTZ ID only is a TTZ-
   internal router.  All the links on a TTZ-internal router are TTZ
   links.  This option is simpler than option 1 above.

   For a TTZ edge router X with different TTZ IDs on its different
   links, router X connects two or more different TTZs.  In this case,
   router X originates its router LSA for virtualizing the TTZs.  This
   LSA includes the normal links connecting to routers outside of these
   TTZs and the virtual links to the other edge routers of each of these
   TTZs.  Router X also originates its TTZ router LSA for each of the
   TTZs.  The TTZ router LSA for TTZ N includes the links to the routers
   outside of these TTZs, the virtual links to the other edge routers of
   the other TTZs, and the TTZ links to the routers in TTZ N.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.2.%20%20Migration%20to%20TTZ"></a><a class="selflink" href="#section-11.2" id="section-11.2">11.2</a>.  Migration to TTZ</span>

   For a group of routers and a number of links connecting the routers
   in an area, making them transfer to work as a TTZ without any service
   interruption takes a few steps or stages.

   At first, a user configures the TTZ feature on every router in the
   TTZ.  In this stage, a router does not originate or advertise its TTZ
   topology information.  It will discover its TTZ neighbors.

   Second, after configuring the TTZ, a user issues a configuration on
   one router in the TTZ, which triggers every router in the TTZ to
   generate and advertise TTZ information among the routers in the TTZ.
   When the router receives the configuration, it originates a TTZ
   control LSA with OP for T (indicating TTZ information generation and
   advertisement for migration).  It also originates its TTZ LSA, such
   as TTZ router LSA or TTZ indication LSA, and advertises the LSA to
   its TTZ neighbors.  When another router in the TTZ receives the LSA
   with OP for T, it originates its TTZ LSA.  In this stage, every
   router in the TTZ has dual roles.  One is to function as a normal
   router.  The other is to generate and advertise TTZ information.

   Third, a user checks whether a router in the TTZ is ready for
   migration to TTZ.  A router in the TTZ is ready after it has received
   all the TTZ LSAs, including TTZ router LSAs from TTZ edge routers and
   TTZ indication LSAs from TTZ-internal routers.  This information may
   be displayed on a router through a configuration.



<span class="grey">Chen, et al.                  Experimental                     [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   Then, a user activates the TTZ through using a configuration such as
   migrate to TTZ on one router in the TTZ.  The router migrates to TTZ,
   generates and advertises a TTZ control LSA with OP for M (indicating
   Migrating to TTZ) after it receives the configuration.  After another
   router in the TTZ receives the TTZ control LSA with OP for M, it also
   migrates to TTZ.  Thus, activating the TTZ on one TTZ router
   propagates to every router in the TTZ, which migrates to TTZ.

   For an edge router of the TTZ, migrating to work as a TTZ router
   comprises generating a router LSA to virtualize the TTZ and flooding
   this LSA to all its neighboring routers in two steps as described in
   <a href="#section-7">Section 7</a>.

   In normal operations for migration to TTZ and rollback from TTZ, a
   user issues a series of configurations according to certain
   procedures.  In an abnormal case, for example, two conflicting
   configurations are issued on two TTZ routers in a TTZ at the same
   time, and a TTZ router issues an error and logs the error when it
   detects a conflict.

   A conflicting configuration may be detected on a router on which the
   configuration is issued.  Thus, some abnormal cases may be prevented.
   When a configuration for migration/rollback is issued on a router,
   the router checks whether it is in a correct sequence of
   configurations for migration/rollback through using the information
   it has.  For migrating a part of an area to a TTZ, the correct
   sequence of configurations is in general as follows:

   1) configure TTZ on every router in the part of the area to be
      migrated to TTZ;

   2) configure on one router in the TTZ to trigger every router in the
      TTZ to generate and advertise TTZ information for migration; and

   3) configure on one router in the TTZ to trigger every router in the
      TTZ to migrate to TTZ.

   After receiving a configuration on a router to migrate to TTZ, which
   is for 3), the router determines whether 2) is performed by checking
   if it has received/originated TTZ LSAs.  If it has not, it issues an
   error to an operator (generation and advertisement of TTZ information
   for migration to TTZ is not done yet) and rejects the configuration
   at this time.

   After a router receives a TTZ LSA with OP for M for 3) from another
   router, it determines whether 2) is performed by checking if it has
   received/originated TTZ LSAs.  If it has not, it issues an error and
   logs the error, and it does not migrate to TTZ.  In this case, it



<span class="grey">Chen, et al.                  Experimental                     [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   does not originate its router LSA for virtualizing the TTZ if it is a
   TTZ edge router.

   After receiving a configuration on a router to generate and advertise
   TTZ information, which is for 2), the router determines whether 1) is
   performed by checking if TTZ is configured on it.  If it is not, it
   issues an error to an operator (TTZ is not configured on it yet) and
   rejects the configuration at this time.

   For rolling back from TTZ, the correct sequence of configurations is
   below.

   1) configure on one router in the TTZ to trigger every router in the
      TTZ to advertise normal LSAs and stop advertising TTZ LSAs; and

   2) configure on one router in the TTZ to trigger every router in the
      TTZ to roll back from TTZ.

   After receiving a configuration on a router to roll back from TTZ,
   which is for 2), the router determines whether 1) is performed by
   checking if it has received TTZ LSA with OP for N.  If it has not, it
   issues an error to an operator (advertise normal LSAs and stop
   advertising TTZ LSAs as rolling back from TTZ is not done yet) and
   rejects the configuration at this time.

   After a router receives a TTZ LSA with OP for R for 2) from another
   router, it determines whether 1) is performed by checking if it has
   received TTZ LSA with OP for N.  If it has not, it issues an error
   and logs the error, and it does not roll back from TTZ.

   After receiving a configuration on a router to advertise normal LSAs
   and stop advertising TTZ LSAs for rolling back from TTZ, which is for
   1), the router checks whether it has any TTZ LSAs.  If it does not,
   it issues an error to an operator (no TTZ to be rolled back) and
   rejects the configuration at this time.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.3.%20%20Adding%20a%20Router%20into%20TTZ"></a><a class="selflink" href="#section-11.3" id="section-11.3">11.3</a>.  Adding a Router into TTZ</span>

   When a non-TTZ router (say R1) is connected via a P2P link to a
   migrated TTZ router (say T1), and there is a normal adjacency between
   them over the link, a user can configure TTZ on both ends of the link
   to add R1 into the TTZ to which T1 belongs.  They TTZ discover each
   other as described in <a href="#section-8">Section 8</a>.

   When a number of non-TTZ routers are connected via a broadcast or
   NBMA link to a migrated TTZ router (say T1), and there are normal
   adjacencies among them, a user configures TTZ on the connection to
   the link on every router to add the non-TTZ routers into the TTZ to



<span class="grey">Chen, et al.                  Experimental                     [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   which T1 belongs.  The DR for the link "forms" TTZ adjacencies with
   the other routers connected to the link if they all have the same TTZ
   ID configured for the link.  This is determined through the TTZ
   discovery process described in <a href="#section-8">Section 8</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20Manageability%20Considerations"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  Manageability Considerations</span>

   <a href="#section-11">Section 11</a> ("Operations") outlines the configuration process and
   deployment scenarios for a TTZ.  The configurable item is enabling a
   TTZ on a router and/or an interface on a router.  The TTZ function
   may be controlled by a policy module and assigned a suitable user
   privilege level to enable.  A suitable model may be required to
   verify the TTZ status on routers participating in the TTZ, including
   their role as an internal or edge TTZ router.  The mechanisms defined
   in this document do not imply any new liveness detection and
   monitoring requirements in addition to those indicated in [<a href="./rfc2328" title='"OSPF Version 2"'>RFC2328</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Security%20Considerations"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Security Considerations</span>

   A notable beneficial security aspect of TTZ is that the TTZ is
   enclosed in a single area, and TTZ could be used to mask the internal
   topology.  External routers that are not participating in the TTZ
   will not be aware of the internal TTZ topology.  It should be noted
   that a malicious node could inject TTZ LSAs with the OP field set to
   M or R, which could trigger the migration into/from a TTZ and may
   result in the isolation of some routers in the network.  Good
   security practice might reuse the OSPF authentication and other
   security mechanisms described in [<a href="./rfc2328" title='"OSPF Version 2"'>RFC2328</a>] and [<a href="./rfc7474" title='"Security Extension for OSPFv2 When Using Manual Key Management"'>RFC7474</a>] to mitigate
   this type of risk.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-14" id="section-14">14</a>.  IANA Considerations</span>

   Under the registry name "Opaque Link-State Advertisements (LSA)
   Option Types" [<a href="./rfc5250" title='"The OSPF Opaque LSA Option"'>RFC5250</a>], IANA has assigned a new Opaque Type registry
   value for TTZ LSA as follows:

     +====================+===============+=======================+
     |  Registry Value    |  Opaque Type  |    reference          |
     +====================+===============+=======================+
     |         9          |    TTZ LSA    |    This document      |
     +--------------------+---------------+-----------------------+

   IANA has created and will maintain a new registry:

   o  OSPFv2 TTZ LSA TLVs






<span class="grey">Chen, et al.                  Experimental                     [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   Initial values for the registry are given below.  The future
   assignments are to be made through IETF Review [<a href="./rfc5226" title="">RFC5226</a>].

       Value         OSPFv2 TTZ LSA TLV Name    Definition
       -----         -----------------------    ----------
       0             Reserved
       1             TTZ ID TLV                 see <a href="#section-6.2">Section 6.2</a>
       2             TTZ Router TLV             see <a href="#section-6.3">Section 6.3</a>
       3             TTZ Options TLV            see <a href="#section-6.4">Section 6.4</a>
       4-32767       Unassigned
       32768-65535   Reserved

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.%20%20References"></a><a class="selflink" href="#section-15" id="section-15">15</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.1.%20%20Normative%20References"></a><a class="selflink" href="#section-15.1" id="section-15.1">15.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2328">RFC2328</a>]  Moy, J., "OSPF Version 2", STD 54, <a href="./rfc2328">RFC 2328</a>,
              DOI 10.17487/RFC2328, April 1998,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2328">http://www.rfc-editor.org/info/rfc2328</a>&gt;.

   [<a id="ref-RFC5250">RFC5250</a>]  Berger, L., Bryskin, I., Zinin, A., and R. Coltun, "The
              OSPF Opaque LSA Option", <a href="./rfc5250">RFC 5250</a>, DOI 10.17487/RFC5250,
              July 2008, &lt;<a href="http://www.rfc-editor.org/info/rfc5250">http://www.rfc-editor.org/info/rfc5250</a>&gt;.

   [<a id="ref-RFC7474">RFC7474</a>]  Bhatia, M., Hartman, S., Zhang, D., and A. Lindem, Ed.,
              "Security Extension for OSPFv2 When Using Manual Key
              Management", <a href="./rfc7474">RFC 7474</a>, DOI 10.17487/RFC7474, April 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7474">http://www.rfc-editor.org/info/rfc7474</a>&gt;.

   [<a id="ref-RFC4940">RFC4940</a>]  Kompella, K. and B. Fenner, "IANA Considerations for
              OSPF", <a href="https://www.rfc-editor.org/bcp/bcp130">BCP 130</a>, <a href="./rfc4940">RFC 4940</a>, DOI 10.17487/RFC4940, July 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4940">http://www.rfc-editor.org/info/rfc4940</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.2.%20%20Informative%20References"></a><a class="selflink" href="#section-15.2" id="section-15.2">15.2</a>.  Informative References</span>

   [<a id="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://www.rfc-editor.org/bcp/bcp26">BCP 26</a>, <a href="./rfc5226">RFC 5226</a>,
              DOI 10.17487/RFC5226, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5226">http://www.rfc-editor.org/info/rfc5226</a>&gt;.







<span class="grey">Chen, et al.                  Experimental                     [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Prototype%20Implementation"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Prototype Implementation</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.1.%20%20What%20Is%20Implemented%20and%20Tested"></a><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  What Is Implemented and Tested</span>

   1.  Command-Line Interface (CLI) Commands for TTZ

   The CLIs implemented and tested include:

   o  the CLIs of the simpler option for configuring TTZ, and

   o  the CLIs for controlling migration to TTZ.

   2.  Extensions to OSPF Protocols for TTZ

   All the extensions defined in "Extensions to OSPF Protocols"
   (<a href="#section-6">Section 6</a>) are implemented and tested except for rolling back from
   TTZ.  The testing results illustrate:

   o  As seen from the outside, a TTZ is virtualized as its edge routers
      connected to each other.  Any router outside of the TTZ sees the
      edge routers (as normal routers) connecting to each other and to
      some other routers.

   o  The link-state information about the routers and links inside the
      TTZ is contained within the TTZ.  It is not advertised to any
      router outside of the TTZ.

   o  TTZ is transparent.  From a router inside a TTZ, it sees the
      topology (link state) outside of the TTZ.  From a router outside
      of the TTZ, it sees the topology beyond the TTZ.  The link-state
      information outside of the TTZ is advertised through the TTZ.

   o  TTZ is backward compatible.  Any router outside of a TTZ does not
      need to support or know TTZ.

   3.  Smooth Migration to TTZ

   The procedures and related protocol extensions for smooth migration
   to TTZ are implemented and tested.  The testing results show:

   o  A part of an OSPF area is smoothly migrated to a TTZ without any
      routing disruptions.  The routes on every router are stable while
      the part of the area is being migrated to the TTZ.

   o  Migration to TTZ is very easy to operate.






<span class="grey">Chen, et al.                  Experimental                     [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


   4.  Add a Router to TTZ

   Adding a router into TTZ is implemented and tested.  The testing
   results illustrate:

   o  A router can be easily added into a TTZ to become a TTZ router.

   o  The router added into the TTZ is not seen on any router outside of
      the TTZ, but it is a part of the TTZ.

   5.  Leak TTZ Loopbacks Outside

   Leaking loopback addresses in a TTZ to routers outside of the TTZ is
   implemented and tested.  The testing results illustrate:

   o  The loopback addresses inside the TTZ are advertised to the
      routers outside of the TTZ.

   o  The loopback addresses are accessible from a router outside of the
      TTZ.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.%20%20Implementation%20Experience"></a><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  Implementation Experience</span>

   The implementation of TTZ reuses the existing OSPF code along with
   additional simple logic.  A couple of engineers started to work on
   implementing the TTZ from the middle of June 2014 and finished coding
   it just before the end of July 2014.  After some testing and bug
   fixes, it works as expected.

   In our implementation, the link-state information in a TTZ opaque LSA
   is stored in the same link-state database as the link-state
   information in a normal LSA.  For each TTZ link in the TTZ opaque
   LSA, there is an additional flag, which is used to differentiate
   between a TTZ link and a normal link.

   Before migration to TTZ, every router in the TTZ computes its routing
   table using the normal links.  After migration to TTZ, every router
   in the TTZ computes its routing table using the TTZ links and normal
   links.  In the case where both the TTZ link and the normal link
   exist, the TTZ link is used.











<span class="grey">Chen, et al.                  Experimental                     [Page 25]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-26"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


Acknowledgements

   The authors would like to thank Acee Lindem, Abhay Roy, Christian
   Hopps, Dean Cheng, Russ White, Tony Przygienda, Wenhu Lu, Lin Han,
   Kiran Makhijani, Padmadevi Pillay Esnault, and Yang Yu for their
   valuable comments on this specification.

Contributors

   The following people contributed significantly to the content of this
   document and should be considered co-authors:

        Mehmet Toy
        United States of America
        Email: mehmet.toy@verizon.com

        Gregory Cauchie
        France
        Email: greg.cauchie@gmail.com

        Anil Kumar SN
        India
        Email: anil.sn@huawei.com

        Ning So
        United States of America
        Email: ningso01@gmail.com

        Lei Liu
        United States of America
        Email: lliu@us.fujitsu.com


   We also acknowledge the contribution of the following individuals:

        Veerendranatha Reddy Vallem
        India
        Email: veerendranatharv@huawei.com


        William McCall
        United States of America
        will.mccall@rightside.co








<span class="grey">Chen, et al.                  Experimental                     [Page 26]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-27"></span>
<span class="grey"><a href="./rfc8099">RFC 8099</a>                Topology-Transparent Zone          February 2017</span>


Authors' Addresses

   Huaimo Chen
   Huawei Technologies
   Boston, MA
   United States of America

   Email: huaimo.chen@huawei.com


   Renwei Li
   Huawei Technologies
   2330 Central expressway
   Santa Clara, CA
   United States of America

   Email: renwei.li@huawei.com


   Alvaro Retana
   Cisco Systems, Inc.
   7025 Kit Creek Rd.
   Raleigh, NC  27709
   United States of America

   Email: aretana@cisco.com


   Yi Yang
   Sockrate
   Cary, NC
   United States of America

   Email: yyang1998@gmail.com


   Zhiheng Liu
   China Mobile
   No.32 Xuanwumen West Street, Xicheng District
   Beijing  100053
   China

   Email: liu.cmri@gmail.com








Chen, et al.                  Experimental                     [Page 27]
</pre>
</body></html>