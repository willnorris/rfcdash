<html><head></head><body><pre>Network Working Group                                          D. Willis
Request for Comments: 3608                              dynamicsoft Inc.
Category: Standards Track                                   B. Hoeneisen
                                                                  Switch
                                                            October 2003


       <span class="h1">Session Initiation Protocol (SIP) Extension Header Field</span>
            <span class="h1">for Service Route Discovery During Registration</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

Abstract

   This document defines a Session Initiation Protocol (SIP) extension
   header field used in conjunction with responses to REGISTER requests
   to provide a mechanism by which a registrar may inform a registering
   user agent (UA) of a service route that the UA may use to request
   outbound services from the registrar's domain.

Table of Contents

   <a href="#section-1">1</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Background . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-3">3</a>.  Discussion of Mechanism  . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Applicability Statement  . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  Syntax . . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-6">6</a>.  Usage  . . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
       <a href="#section-6.1">6.1</a>.  Procedures at the UA . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
       <a href="#section-6.2">6.2</a>.  Procedures at the Proxy  . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-6.3">6.3</a>.  Procedures at the Registrar  . . . . . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-6.4">6.4</a>.  Examples of Usage  . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
             6.4.1.  Example of Mechanism in REGISTER Transaction .   9
             <a href="#section-6.4.2">6.4.2</a>.  Example of Mechanism in INVITE Transaction . .  <a href="#page-12">12</a>
   <a href="#section-7">7</a>.  Security Considerations  . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-8">8</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-9">9</a>.  Normative References . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-10">10</a>. Informative References . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>



<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


   <a href="#section-11">11</a>. Intellectual Property Statement. . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-12">12</a>. Authors' Addresses . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-13">13</a>. Full Copyright Statement . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Terminology"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a> [<a href="#ref-1" title='"Key words for use in RFCs to Indicate Requirement Levels"'>1</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Background"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Background</span>

   The Third Generation Partnership Project (3GPP) established a
   requirement for discovering home proxies during SIP registration and
   published this requirement in [<a href="#ref-6" title='"3rd-Generation Partnership Project (3GPP) Release 5 requirements on the Session Initiation Protocol (SIP)"'>6</a>].  The 3GPP network dynamically
   assigns a home service proxy to each address-of-record (AOR).  This
   assignment may occur in conjunction with a REGISTER operation, or
   out-of-band as needed to support call services when the address-of-
   record has no registrations.  This home service proxy may provide
   both inbound (UA terminated) and outbound (UA originated) services.

   In the inbound case, the Request-Uniform Resource Identifier (URI) of
   incoming SIP requests matches the address-of-record of a user
   associated with the home service proxy.  The home service proxy then
   (in most cases) forwards the request to the registered contact
   address for that AOR.  A mechanism for traversing required proxies
   between the home service proxy and the registered UA is presented in
   [<a href="#ref-4" title='"Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts"'>4</a>].

   Outbound (UA originated) session cases raise another issue.
   Specifically, "How does the UA know which service proxy to use and
   how to get there?"

   Several mechanisms were proposed in list discussions, including:

   1. Configuration data in the UA.  This raises questions of UA
      configuration management and updating, especially if proxy
      assignment is very dynamic, such as in load-balancing scenarios.

   2. Use of some other protocol, such as HTTP, to get configuration
      data from a configuration server in the home network.  While
      functional, this solution requires additional protocol engines,
      firewall complexity, operations overhead, and significant
      additional "over the air" traffic.

   3. Use of lookup tables in the home network, as may be done for
      inbound requests in some 3G networks.  This has a relatively high
      overhead in terms of database operations.



<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


   4. Returning a 302 response indicating the service proxy as a new
      contact, causing the upstream node processing the 302 (ostensibly
      the UA) to retransmit the request toward the service proxy.  While
      this shares the database operation of the previous alternative, it
      does explicitly allow for caching the 302 response thereby
      potentially reducing the frequency and number of database
      operations.

   5. Performing an operation equivalent to record-routing in a REGISTER
      transaction between the UA and the associated registrar, then
      storing that route in the UA and reusing it as a service route on
      future requests originating from the UA.  While efficient, this
      constrains the service route for proxy operations to be congruent
      with the route taken by the REGISTER message.

   6. Returning service route information as the value of a header field
      in the REGISTER response.  While similar to the previous
      alternative, this approach grants the ability for the registrar to
      selectively apply knowledge about the topology of the home network
      in constructing the service route.

   This document defines this final alternative: returning the service
   route information as a header field in the REGISTER response.  This
   new header field indicates a "preloaded route" that the UA may wish
   to use if requesting services from the proxy network associated with
   the registrar generating the response.

   Scenario

      UA1----P1-----|    |--R-------|
                    |    |          |
                    P2---|         DBMS
                    |    |          |
      UA2-----------|    |--HSP-----|

   In this scenario, we have a "home network" containing routing proxy
   P2, registrar R, home service proxy HSP, and database DBMS used by
   both R and HSP.  P2 represents the "edge" of the home network from a
   SIP perspective, and might be called an "edge proxy".  UA1 is an
   external UA behind proxy P1.  UA1 discovers P1 via Dynamic Host
   Configuration Protocol (DHCP) (this is just an example, and other
   mechanisms besides DHCP are possible).  UA2 is another UA on the
   Internet, and does not use a default outbound proxy.  We do not show
   Domain Name System (DNS) elements in this diagram, but will assume
   their reasonable availability in the discussion.  The mission is for
   UA1 to discover HSP so that outbound requests from UA1 may be routed
   (at the discretion of UA1) through HSP, thereby receiving outbound
   services from HSP.



<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Discussion%20of%20Mechanism"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Discussion of Mechanism</span>

   UAs may include a Route header field in an initial request to force
   that request to visit and potentially be serviced by one or more
   proxies.  Using such a route (called a "service route" or "preloaded
   route") allows a UA to request services from a specific home proxy or
   network of proxies.  The open question is, "How may a UA discover
   what service route to use?"

   This document defines a header field called "Service-Route" which can
   contain a route vector that, if used as discussed above, will direct
   requests through a specific sequence of proxies.  A registrar may use
   a Service-Route header field to inform a UA of a service route that,
   if used by the UA, will provide services from a proxy or set of
   proxies associated with that registrar.  The Service-Route header
   field may be included by a registrar in the response to a REGISTER
   request.  Consequently, a registering UA learns of a service route
   that may be used to request services from the system it just
   registered with.

   The routing established by the Service-Route mechanism applies only
   to requests originating in the user agent.  That is, it applies only
   to UA originated requests, and not to requests terminated by that UA.

   Simply put, the registrar generates a service route for the
   registering UA and returns it in the response to each successful
   REGISTER request.  This service route has the form of a Route header
   field that the registering UA may use to send requests through the
   service proxy selected by the registrar.  The UA would use this route
   by inserting it as a preloaded Route header field in requests
   originated by the UA intended for routing through the service proxy.

   The mechanism by which the registrar constructs the header field
   value is specific to the local implementation and outside the scope
   of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Applicability%20Statement"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Applicability Statement</span>

   The Service-Route mechanism is applicable when:

   1. The UA registers with a registrar.

   2. The registrar has knowledge of a service proxy that should be used
      by the UA when requesting services from the domain of the
      registrar.  This knowledge may be a result of dynamic assignment
      or some other mechanism outside the scope of this document.





<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


   3. The registrar(s) has/have sufficient knowledge of the network
      topology, policy, and situation such that a reasonable service
      route can be constructed.

   4. The service route constructed by the registrar is the same for all
      contacts associated with a single address-of-record.  This
      mechanism does not provide for contact-specific service routes.

   5. Other mechanisms for proposing a service route to the UA are not
      available or are inappropriate for use within the specific
      environment.

   Other methods may also be available by which a UA may be informed of
   a service route.  Such alternative methods are outside the scope of
   this document.  Discussion of why one might wish to assign a service
   route during registration or when it might be appropriate to do so is
   outside the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Syntax"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Syntax</span>

   The syntax for the Service-Route header field is:

   Service-Route = "Service-Route" HCOLON sr-value *( COMMA sr-value)

   sr-value = name-addr *( SEMI rr-param )

   Note that the Service-Route header field values MUST conform to the
   syntax of a Route element as defined in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].  As suggested therein,
   such values MUST include the loose-routing indicator parameter ";lr"
   for full compliance with [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].

   The allowable usage of header fields is described in Tables 2 and 3
   of [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].  The following additions to this table are needed for
   Service-Route.

   Addition of Service-Route to SIP Table 3:

      Header field          where   proxy ACK BYE CAN INV OPT REG PRA
      _______________________________________________________________
      Service-Route        2xx      ar     -   -   -   -   -   o   -











<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Usage"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Usage</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20Procedures%20at%20the%20UA"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Procedures at the UA</span>

   The UA performs a registration as usual.  The REGISTER response may
   contain a Service-Route header field.  If so, the UA MAY store the
   value of the Service-Route header field in an association with the
   address-of-record for which the REGISTER transaction had registered a
   contact.  If the UA supports multiple addresses-of-record, it may be
   able to store multiple service routes, one per address-of-record.  If
   the UA refreshes the registration, the stored value of the Service-
   Route is updated according to the Service-Route header field of the
   latest 200 class response.  If there is no Service-Route header field
   in the response, the UA clears any service route for that address-
   of-record previously stored by the UA.  If the re-registration
   request is refused or if an existing registration expires and the UA
   chooses not to re-register, the UA SHOULD discard any stored service
   route for that address-of-record.

   The UA MAY choose to exercise a service route for future requests
   associated with a given address-of-record for which a service route
   is known.  If so, it uses the content of the Service-Route header
   field as a preloaded Route header field in outgoing initial requests
   [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].  The UA MUST preserve the order, in case there is more than one
   Service-Route header field or header field value.

   Loose routes may interact with routing policy in interesting ways.
   The specifics of how the service route set integrates with any
   locally required default route and local policy are implementation
   dependent.  For example, some devices will use locally-configured
   explicit loose routing to reach a next-hop proxy, and others will use
   a default outbound-proxy routing rule.  However, for the result to
   function, the combination MUST provide valid routing in the local
   environment.  In general, the service route set is appended to any
   locally configured route needed to egress the access proxy chain.
   Systems designers must match the service routing policy of their
   nodes with the basic SIP routing policy in order to get a workable
   system.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20Procedures%20at%20the%20Proxy"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Procedures at the Proxy</span>

   The Service-Route header field is generally treated like any other
   unknown header field by intermediate proxies.  They simply forward it
   on towards the destination.  Note that, as usual, intermediate
   proxies that need to be traversed by future requests within a dialog
   may record-route.  Proxies should not assume that they will be
   traversed by future requests in a dialog simply because they appear
   in the Service-Route header field.



<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


   There is a question of whether proxies processing a REGISTER response
   may add themselves to the route set in the Service-Route header
   field.  While this would enable dynamic construction of service
   routes, it has two significant problems.  The first is one of
   transparency, as seen by the registrar: Intermediate proxies could
   add themselves without the knowledge or consent of the registrar.
   The second problem is interaction with end-to-end security.  If the
   registrar uses S/MIME techniques to protect the REGISTER response,
   such additions would be visible to the UA as "man in the middle"
   alterations in the response.  Consequently, intermediate proxies
   SHOULD NOT alter the value of Service-Route in REGISTER responses,
   and if they do, the UA MUST NOT be required to accept the alteration.

   Additional considerations apply if a proxy is "dual homed", meaning
   connected to two (or more) different networks such that requests are
   received on one interface and proxied out through another network
   interface.  Proxies implementing multi-homing precisely as documented
   in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>] record-route a request with the sending interface.  When
   processing the reply, they replace the Record-Route header field
   value that represents the interface onto which they proxied the
   request with a new value that represents the interface onto which
   they will proxy the response.  Consequently, the route vector seen at
   the User Agent Server (UAS) is not the exact inverse of the route
   vector seen at the User Agent Client (UAC).  While in itself
   harmless, this complicates matters for nodes that use the recorded
   route vector (or recorded Path vector as per [<a href="#ref-4" title='"Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts"'>4</a>]) in the
   determination of a service route for future use.

   Instead of following the procedure in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>], proxies used with
   Service-Route that are inserting Record-Route or Path header field
   values SHOULD record not one but two route values when processing the
   request.  The first value recorded indicates the receiving interface,
   and the second indicates the sending interface.  When processing the
   response, no modification of the recorded route is required.  This
   optimization provides for fully invertible routes that can be
   effectively used in construction of service routes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.3.%20%20Procedures%20at%20the%20Registrar"></a><a class="selflink" href="#section-6.3" id="section-6.3">6.3</a>.  Procedures at the Registrar</span>

   When a registrar receives a successful REGISTER request, it MAY
   choose to return one or more Service-Route header field(s) in the 200
   class response.  The determination(s) of whether to include these
   header fields(s) into the 200 class response and what value(s) to
   insert are a matter of local policy and outside the scope of this
   document.






<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


   Having inserted a Service-Route header field or fields, the registrar
   returns the 200 class response to the UA in accordance with standard
   procedures.

   A REGISTER operation performing a Fetching Bindings (i.e., no Contact
   header field is present in the request) SHOULD return the same value
   of Service-Route as returned in the corresponding previous REGISTER
   response for the address-of-record in question.  In some cases, the
   Service-Route may be dynamically calculated by the registrar rather
   than stored, and the decision as to whether this route should be
   recalculated in the event of a Fetching Bindings operation is left to
   the implementation.

   Note: A Fetching Bindings operation could be used by the UA to
         recover a lost value of Service-Route.  Alternatively, a UA in
         this situation could just re-REGISTER.

   Certain network topologies MAY require a specific proxy (e.g.,
   firewall proxy) to be traversed before the home service proxy.  Thus,
   a registrar with specific knowledge of the network topology MAY
   return more than one Service-Route header field or element in the 200
   class response; the order is specified as top-down, meaning the
   topmost Service-Route entry will be visited first.  Such
   constructions are implementation specific and outside the scope of
   this document.

   In general, the Service-Route header field contains references to
   elements strictly within the administrative domain of the registrar
   and home service proxy.  For example, consider a case where a user
   leaves the "home" network and roams into a "visited" network.  The
   registrar cannot be assumed to have knowledge of the topology of the
   visited network, so the Service-Route it returns contains elements
   only within the home network.

   Note that the inserted Service-Route element(s) MUST conform to the
   syntax of a Route element as defined in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].  As suggested therein,
   such route elements MUST include the loose-routing indicator
   parameter ";lr" for full compliance with [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].













<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.%20%20Examples%20of%20Usage"></a><a class="selflink" href="#section-6.4" id="section-6.4">6.4</a>.  Examples of Usage</span>

   We present an example in the context of the scenario presented in the
   Background section earlier in this document.  The network diagram is
   replicated below:

   Scenario

      UA1----P1-----|    |--R-------|
                    |    |          |
                    P2---|         DBMS
                    |    |          |
      UA2-----------|    |--HSP-----|

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.1.%20%20Example%20of%20Mechanism%20in%20REGISTER%20Transaction"></a><a class="selflink" href="#section-6.4.1" id="section-6.4.1">6.4.1</a>.  Example of Mechanism in REGISTER Transaction</span>

   This example shows the message sequence for user agent UA1
   registering to HOME.EXAMPLE.COM using registrar R.  R returns a
   Service-Route indicating that UA1 may use home service proxy
   HSP.HOME.EXAMPLE.COM to receive outbound services from
   HOME.EXAMPLE.COM.

   Please note that some header fields (e.g., Content-Length) and
   session descriptions are omitted to provide a shorter and hopefully
   more readable presentation.

   Message sequence for REGISTER returning Service-Route:

F1 Register UA1 -&gt; P1

 REGISTER sip:HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
  . . .













<span class="grey">Willis &amp; Hoeneisen          Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


F2 Register P1 -&gt; P2

 REGISTER sip:HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKlJuB1mcr
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
  . . .

F3 Register P2 -&gt; R

 REGISTER sip:HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP P2.HOME.EXAMPLE.COM:5060;branch=z9hG4bKvE0R2l07o2b6T
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKlJuB1mcr
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
  . . .

F4 R executes Register

 R Stores:
 For &lt;sip:UA1@HOME.EXAMPLE.COM&gt;
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;

F5 R calculates Service Route

 In this example, R is statically configured to reference HSP as a
 service route, and R also knows that P2 is used as the provider
 edge proxy, so:

 Service-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
                &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;












<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


F6 Register Response r -&gt; P2

 SIP/2.0 200 OK
 Via: SIP/2.0/UDP P2.HOME.EXAMPLE.COM:5060;branch=z9hG4bKvE0R2l07o2b6T
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKlJuB1mcr
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=87654
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Service-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
                &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .

F7 Register Response P2 -&gt; P1

 SIP/2.0 200 OK
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKlJuB1mcr
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=87654
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Service-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
                &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .

F8 Register Response P1 -&gt; UA1

 SIP/2.0 200 OK
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKcR1ntRAp
 To: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=87654
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=981211
 Call-ID: 843817637684230@998sdasdh09
 CSeq: 1826 REGISTER
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Service-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
                &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .

F9 UA1 stores service route for UA1@HOME.EXAMPLE.COM








<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.2.%20%20Example%20of%20Mechanism%20in%20INVITE%20Transaction"></a><a class="selflink" href="#section-6.4.2" id="section-6.4.2">6.4.2</a>.  Example of Mechanism in INVITE Transaction</span>

   This example shows the message sequence for an INVITE transaction
   originating from UA1 eventually arriving at UA2 using outbound
   services from HOME.EXAMPLE.COM.  UA1 has previously registered with
   HOME.EXAMPLE.COM and been informed of a service route through
   HSP.HOME.EXAMPLE.COM.  The service being provided by HOME.EXAMPLE.COM
   is a "logging" service, which provides a record of the call for UA1's
   use (perhaps the user of UA1 is an attorney who bills for calls to
   customers).

   Note that in this example UA1 and UA2 are assumed to be registered
   with the same network (HOME.EXAMPLE.COM).  This does not generally
   need to be the case to use the herein described service route
   mechanism.

   Message sequence for INVITE using Service-Route:

F1 Invite UA1 -&gt; P1

 INVITE sip:UA2@HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKnashds7
 To: Customer &lt;sip:UA2@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=456248
 Call-ID: 38615183343@s1i1l2j6u
 CSeq: 18 INVITE
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
        &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .

 Note: P1 is selected using the "outbound proxy" rule in UA1.

F2 Invite P1 -&gt; P2

 INVITE sip:UA2@HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bK34ghi7ab04
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKnashds7
 To: Customer &lt;sip:UA2@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=456248
 Call-ID: 38615183343@s1i1l2j6u
 CSeq: 18 INVITE
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Record-Route: &lt;sip:P1.VISITED.EXAMPLE.ORG;lr&gt;
 Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;,
        &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .




<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


 Note: P1 has added itself to the Record Route.

F3 Invite P2 -&gt; HSP

 INVITE sip:UA2@HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/UDP P2.HOME.EXAMPLE.COM:5060;branch=z9hG4bKiokioukju908
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bK34ghi7ab04
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKnashds7
 To: Customer &lt;sip:UA2@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=456248
 Call-ID: 38615183343@s1i1l2j6u
 CSeq: 18 INVITE
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Record-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;
 Record-Route: &lt;sip:P1.VISITED.EXAMPLE.ORG;lr&gt;
 Route: &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
  . . .

 Note: HSP is selected using a DNS lookup for HSP within
 HOME.EXAMPLE.COM.
 P2 has added itself to the Record-Route.
 P2 has removed itself from the Route.

F4 HSP executes service

 HSP identifies the service to be executed from UA1's stored
 profile.  The specifics of this are outside the scope of this
 document. For this example HSP writes a record to "Lawyer's log
 book", then looks up the AOR  "sip:UA2@HOME.EXAMPLE.COM" and
 discovers that the current contact for UA2 is at host
 UAADDR2.HOME.EXAMPLE.COM.  This will be the Request-URI of the
 next-hop INVITE.

F5 Invite HSP -&gt; P2

 INVITE sip:UA2@UAADDR2.HOME.EXAMPLE.COM SIP/2.0
 Via: SIP/2.0/USP HSP.HOME.EXAMPLE.COM:5060;branch=z9hG4bKHSP10120323
 Via: SIP/2.0/UDP P2.HOME.EXAMPLE.COM:5060;branch=z9hG4bKiokioukju908
 Via: SIP/2.0/UDP P1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bK34ghi7ab04
 Via: SIP/2.0/UDP UADDR1.VISITED.EXAMPLE.ORG:5060;branch=z9hG4bKnashds7
 To: Customer &lt;sip:UA2@HOME.EXAMPLE.COM&gt;
 From: Lawyer &lt;sip:UA1@HOME.EXAMPLE.COM&gt;;tag=456248
 Call-ID: 38615183343@s1i1l2j6u
 CSeq: 18 INVITE
 Contact: &lt;sip:UA1@UADDR1.VISITED.EXAMPLE.ORG&gt;
 Record-Route: &lt;sip:HSP.HOME.EXAMPLE.COM;lr&gt;
 Record-Route: &lt;sip:P2.HOME.EXAMPLE.COM;lr&gt;
 Record-Route: &lt;sip:P1.VISITED.EXAMPLE.ORG;lr&gt;



<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


  . . .

 Note: P2 selected by outbound proxy rule on HSP.
 HSP has removed itself from the Route.

INVITE propagates toward UA2 as usual.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Security Considerations</span>

   It is possible for proxies between the UA and the registrar during
   the REGISTER transaction to modify the value of Service-Route
   returned by the registrar, or to insert a Service-Route even when one
   was not returned by the registrar.  The consequence of such an attack
   is that future requests made by the UA using the service route might
   be diverted to or through a node other than would normally be
   visited.  It is also possible for proxies on the INVITE path to
   execute many different attacks.  It is therefore desirable to apply
   transitive mutual authentication using sips: or other available
   mechanisms in order to prevent such attacks.

   The "sips:" URI as defined in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>] defines a mechanism by which a UA
   may request transport-level message integrity and mutual
   authentication.  Since there is no requirement for proxies to modify
   messages, S/MIME signed bodies may be used to provide end-to-end
   protection for the returned value.

   Systems using Service-Route SHOULD provide hop-by-hop message
   integrity and mutual authentication.  UAs SHOULD request this support
   by using a "sips:" URI.  Registrars returning a Service-Route MUST
   implement end-to-end protection using S/MIME and SHOULD use S/MIME to
   protect all such responses.  UAs receiving Service-Route SHOULD
   authenticate attached S/MIME bodies if present.



















<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  IANA Considerations</span>

   This document defines the SIP extension header field "Service-Route"
   which has been included in the registry of SIP header fields defined
   in [<a href="#ref-3" title='"SIP: Session Initiation Protocol"'>3</a>].  The change process for SIP, [<a href="#ref-5" title='"Change Process for the Session Initiation Protocol (SIP)"'>5</a>] mandates that general SIP
   extension header fields be defined by a standards-track RFC.  This
   document provides the required definition.

   The following is the registration for the Service-Route header field:

   RFC Number: <a href="./rfc3608">RFC 3608</a>

   Header Field Name: Service-Route

   Compact Form: none

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Normative%20References"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Normative References</span>

   [<a id="ref-1">1</a>]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-2">2</a>]  Postel, J. and J. Reynolds, "Instructions to RFC Authors", <a href="./rfc2223">RFC</a>
        <a href="./rfc2223">2223</a>, October 1997.

   [<a id="ref-3">3</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
        Peterson, J., Sparks, R., Handley, M. and E. Schooler, "SIP:
        Session Initiation Protocol", <a href="./rfc3261">RFC 3261</a>, June 2002.

   [<a id="ref-4">4</a>]  Willis, D. and B. Hoeneisen, "Session Initiation Protocol (SIP)
        Extension Header Field for Registering Non-Adjacent Contacts",
        <a href="./rfc3327">RFC 3327</a>, December 2002.

   [<a id="ref-5">5</a>]  Mankin, A., Bradner, S., Mahy, R., Willis, D., Ott, J. and B.
        Rosen, "Change Process for the Session Initiation Protocol
        (SIP)", <a href="https://www.rfc-editor.org/bcp/bcp67">BCP 67</a>, <a href="./rfc3427">RFC 3427</a>, December 2002.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Informative%20References"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Informative References</span>

   [<a id="ref-6">6</a>]  Garcia-Martin, M., "3rd-Generation Partnership Project (3GPP)
        Release 5 requirements on the  Session Initiation Protocol
        (SIP)", Work in Progress, October 2002.










<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20Intellectual%20Property%20Statement"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  Intellectual Property Statement</span>

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights. Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in <a href="https://www.rfc-editor.org/bcp/bcp11">BCP-11</a>. Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard. Please address the information to the IETF Executive
   Director.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20Authors%27%20Addresses"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  Authors' Addresses</span>

   Dean Willis
   dynamicsoft Inc.
   3100 Independence Parkway
   #311-164
   Plano, TX  75075
   US

   Phone: +1 972 473 5455
   EMail: dean.willis@softarmor.com


   Bernie Hoeneisen
   Switch
   Limmatquai 138
   CH-8001 Zuerich
   Switzerland

   Phone: +41 1 268 1515
   EMail: hoeneisen@switch.ch, b.hoeneisen@ieee.org
   URI:   <a href="http://www.switch.ch/">http://www.switch.ch/</a>







<span class="grey">Willis &amp; Hoeneisen          Standards Track                    [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc3608">RFC 3608</a>       SIP Extension for Service Route Discovery    October 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Full%20Copyright%20Statement"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Full Copyright Statement</span>

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Willis &amp; Hoeneisen          Standards Track                    [Page 17]
</pre>
</body></html>