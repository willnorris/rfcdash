<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9302: Locator/ID Separation Protocol (LISP) Map-Versioning</title>
<meta content="Luigi Iannone" name="author"/>
<meta content="Damien Saucez" name="author"/>
<meta content="Olivier Bonaventure" name="author"/>
<meta content="
       
    This document describes the Locator/ID Separation Protocol (LISP) Map-Versioning mechanism, which provides in-packet information about Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mappings used to encapsulate LISP data packets.
    This approach is based on associating a version number to EID-to-RLOC mappings and transporting such a version number in the LISP-specific header of LISP-encapsulated packets.
    LISP Map-Versioning is particularly useful to inform communicating Ingress Tunnel Routers (ITRs) and Egress Tunnel Routers (ETRs) about modifications of the mappings used to encapsulate packets.

    The mechanism is optional and transparent to implementations not supporting this feature, since in the LISP-specific header and in the Map Records, bits used for Map-Versioning can be safely ignored by ITRs and ETRs that do not support or do not want to use the mechanism.
       
       
    This document obsoletes RFC 6834, which is the initial experimental specifications of the mechanisms updated by this document.
       
    " name="description"/>
<meta content="xml2rfc 3.15.1" name="generator"/>
<meta content="9302" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.15.1
    Python 3.9.13
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.1
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 3.1.2
    kitchen 1.2.6
    lxml 4.9.0
    MarkupSafe 2.1.1
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    weasyprint 56.1
-->
<link href="rfc9302.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  pre.breakable {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9302" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-lisp-6834bis-14" rel="prev"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9302</td>
<td class="center">LISP Map-Versioning</td>
<td class="right">October 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Iannone, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9302">9302</a></dd>
<dt class="label-obsoletes">Obsoletes:</dt>
<dd class="obsoletes">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc6834">6834</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2022-10">October 2022</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">L. Iannone</div>
<div class="org">Huawei Technologies France</div>
</div>
<div class="author">
      <div class="author-name">D. Saucez</div>
<div class="org">Inria</div>
</div>
<div class="author">
      <div class="author-name">O. Bonaventure</div>
<div class="org">Universite catholique de Louvain</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9302</h1>
<h1 id="title">Locator/ID Separation Protocol (LISP) Map-Versioning</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">
    This document describes the Locator/ID Separation Protocol (LISP) Map-Versioning mechanism, which provides in-packet information about Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mappings used to encapsulate LISP data packets.
    This approach is based on associating a version number to EID-to-RLOC mappings and transporting such a version number in the LISP-specific header of LISP-encapsulated packets.
    LISP Map-Versioning is particularly useful to inform communicating Ingress Tunnel Routers (ITRs) and Egress Tunnel Routers (ETRs) about modifications of the mappings used to encapsulate packets.

    The mechanism is optional and transparent to implementations not supporting this feature, since in the LISP-specific header and in the Map Records, bits used for Map-Versioning can be safely ignored by ITRs and ETRs that do not support or do not want to use the mechanism.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
<p id="section-abstract-2">
    This document obsoletes RFC 6834, which is the initial experimental specifications of the mechanisms updated by this document.<a class="pilcrow" href="#section-abstract-2">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9302">https://www.rfc-editor.org/info/rfc9302</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-requirements-notation">Requirements Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-definitions-of-terms">Definitions of Terms</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-lisp-specific-header-and-ma">LISP-Specific Header and Map-Version Numbers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-map-record-and-map-version">Map Record and Map-Version</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-eid-to-rloc-map-version-num">EID-to-RLOC Map-Version Number</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-the-null-map-version">The Null Map-Version</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-dealing-with-map-version-nu">Dealing with Map-Version Numbers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-handling-dest-map-version-n">Handling Dest Map-Version Number</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="auto internal xref" href="#section-7.2">7.2</a>.  <a class="internal xref" href="#name-handling-source-map-version">Handling Source Map-Version Number</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-deployment-considerations">Deployment Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#section-11">11</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a class="auto internal xref" href="#section-11.1">11.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a class="auto internal xref" href="#section-11.2">11.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-benefits-and-case-studies-f">Benefits and Case Studies for Map-Versioning</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a class="auto internal xref" href="#appendix-A.1">A.1</a>.  <a class="internal xref" href="#name-map-versioning-and-unidirec">Map-Versioning and Unidirectional Traffic</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a class="auto internal xref" href="#appendix-A.2">A.2</a>.  <a class="internal xref" href="#name-map-versioning-and-interwor">Map-Versioning and Interworking</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2.2.1">
                    <p id="section-toc.1-1.12.2.2.2.1.1"><a class="auto internal xref" href="#appendix-A.2.1">A.2.1</a>.  <a class="internal xref" href="#name-map-versioning-and-proxy-it">Map-Versioning and Proxy-ITRs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2.2.2">
                    <p id="section-toc.1-1.12.2.2.2.2.1"><a class="auto internal xref" href="#appendix-A.2.2">A.2.2</a>.  <a class="internal xref" href="#name-map-versioning-and-lisp-nat">Map-Versioning and LISP-NAT</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2.2.3">
                    <p id="section-toc.1-1.12.2.2.2.3.1"><a class="auto internal xref" href="#appendix-A.2.3">A.2.3</a>.  <a class="internal xref" href="#name-map-versioning-and-proxy-et">Map-Versioning and Proxy-ETRs</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a class="auto internal xref" href="#appendix-A.3">A.3</a>.  <a class="internal xref" href="#name-rloc-shutdown-withdraw">RLOC Shutdown/Withdraw</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">
    This document describes the Map-Versioning mechanism used to provide information on changes in the Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mappings used in the Locator/ID Separation Protocol (LISP) <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span> <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> context to perform packet encapsulation.
    The mechanism is totally transparent to Ingress and Egress Tunnel Routers (xTRs) not supporting or not using such functionality.
   The architecture of LISP is described in <span>[<a class="cite xref" href="#RFC9299">RFC9299</a>]</span>.  The reader is expected to be familiar with this introductory document.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">
    This document obsoletes <span>[<a class="cite xref" href="#RFC6834">RFC6834</a>]</span>, which is the initial experimental specification that describes the mechanisms updated by this document.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">
    The basic mechanism is to associate a Map-Version number to each LISP EID-to-RLOC mapping and transport such a version number in the LISP-specific header.
    When a mapping changes, a new version number is assigned to the updated mapping.
    A change in an EID-to-RLOC mapping can be a modification in the RLOCs set, such as addition of, removal of, or change in the priority or weight of one or more RLOCs.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">
    When Map-Versioning is used, LISP-encapsulated data packets contain
   the version number of the two mappings used to select the RLOCs in
   the outer header (i.e., both source and destination RLOCs).  This
   information has two uses:<a class="pilcrow" href="#section-1-4">¶</a></p>
<ol class="normal type-1" id="section-1-5" start="1" type="1">
 <li id="section-1-5.1">Map-Versioning enables the Egress Tunnel Router (ETR) receiving 
       the packet to know if the Ingress Tunnel Router (ITR) is using the latest 
       mapping version for the destination EID.  If this is not the case, the ETR 
       can directly send a Map-Request containing the updated mapping to 
       the ITR to notify it of the latest version.  The ETR can also solicit the 
       ITR to trigger a Map-Request to obtain the latest mapping by sending 
       a Solicit Map-Request (SMR) message.  Both options are defined in
 <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-1-5.1">¶</a>
</li>
        <li id="section-1-5.2">Map-Versioning enables an ETR  receiving the packet to know if it 
      has in its EID-to-RLOC Map-Cache the latest mapping for the 
 source EID.  If this is not the case, a Map-Request can be sent.<a class="pilcrow" href="#section-1-5.2">¶</a>
</li>
      </ol>
<p id="section-1-6">
    Considerations about the deployment of LISP Map-Versioning are discussed in <a class="auto internal xref" href="#considerations">Section 9</a>.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">
The benefits of Map-Versioning in some common LISP-related use cases are discussed in <a class="auto internal xref" href="#benefits">Appendix A</a>.<a class="pilcrow" href="#section-1-7">¶</a></p>
</section>
</div>
<section id="section-2">
      <h2 id="name-requirements-notation">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-requirements-notation">Requirements Notation</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
</section>
<div id="terms">
<section id="section-3">
      <h2 id="name-definitions-of-terms">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-definitions-of-terms">Definitions of Terms</a>
      </h2>
<p id="section-3-1">
    This document uses terms already defined in the main LISP specifications (<span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span> and <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>).
    Here, we define the terms that are specific to the Map-Versioning mechanism. Throughout the whole document, big-endian bit ordering is used.<a class="pilcrow" href="#section-3-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1">Map-Version number:</dt>
        <dd id="section-3-2.2" style="margin-left: 1.0em"> An unsigned 12-bit integer is assigned to an EID-to-RLOC mapping, indicating its version number (<a class="auto internal xref" href="#vnum">Section 6</a>).<a class="pilcrow" href="#section-3-2.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3">Null Map-Version:</dt>
        <dd id="section-3-2.4" style="margin-left: 1.0em"> A Map-Version number with a value of 0x000 (zero), which is used to signal that the Map-Version feature is not used and no Map-Version number is assigned to the EID-to-RLOC mapping (<a class="auto internal xref" href="#sec_null">Section 6.1</a>).<a class="pilcrow" href="#section-3-2.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.5">Dest Map-Version number:</dt>
        <dd id="section-3-2.6" style="margin-left: 1.0em"> Map-Version of the mapping in the EID-to-RLOC Map-Cache used by the ITR to select the RLOC present in the 'Destination Routing Locator' field of the outer IP header of LISP-encapsulated packets (<a class="auto internal xref" href="#dmvn">Section 7.1</a>).<a class="pilcrow" href="#section-3-2.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.7">Source Map-Version number:</dt>
        <dd id="section-3-2.8" style="margin-left: 1.0em"> Map-Version of the mapping in the EID-to-RLOC Database used by the ITR to select the RLOC present in the 'Source Routing Locator' field of the outer IP header of LISP-encapsulated packets (<a class="auto internal xref" href="#smvn">Section 7.2</a>).<a class="pilcrow" href="#section-3-2.8">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="lisphdr">
<section id="section-4">
      <h2 id="name-lisp-specific-header-and-ma">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-lisp-specific-header-and-ma">LISP-Specific Header and Map-Version Numbers</a>
      </h2>
<p id="section-4-1">
    In order for the versioning approach to work, the LISP-specific header has to carry both the Source Map-Version number and Dest Map-Version number.
    This is done by setting the V-bit in the LISP-specific header as specified in <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span> and shown in the example in  <a class="auto internal xref" href="#lispshimhdr">Figure 1</a>.
    All permissible combinations of the flags when the V-bit is set to 1 are described in <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span>.
    Not all of the LISP-encapsulated packets need to carry version numbers.
    When the V-bit is set, the LISP-specific header has the following encoding:<a class="pilcrow" href="#section-4-1">¶</a></p>
<span id="name-lisp-specific-header-exampl"></span><div id="lispshimhdr">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-4-2.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|N|L|E|V|I|R|K|K|  Source Map-Version   |   Dest Map-Version    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Instance ID/Locator-Status-Bits               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-lisp-specific-header-exampl">LISP-Specific Header Example When Map-Versioning Is in Use</a>
        </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-4-3">
        <dt id="section-4-3.1">Source Map-Version number (12 bits):</dt>
        <dd id="section-4-3.2" style="margin-left: 1.0em"> See <a class="auto internal xref" href="#terms">Section 3</a>.<a class="pilcrow" href="#section-4-3.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-3.3">Dest Map-Version number (12 bits):</dt>
        <dd id="section-4-3.4" style="margin-left: 1.0em"> See <a class="auto internal xref" href="#terms">Section 3</a>.<a class="pilcrow" href="#section-4-3.4">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="vnumpkt">
<section id="section-5">
      <h2 id="name-map-record-and-map-version">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-map-record-and-map-version">Map Record and Map-Version</a>
      </h2>
<p id="section-5-1">
    To accommodate the mechanism, the Map Records that are transported in Map-Request/Map-Reply/Map-Register messages need to carry the Map-Version number as well. For reference, the Map Record (specified  in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>) is reported here as an example in <a class="auto internal xref" href="#maprecord">Figure 2</a>. This memo does not change the operation of Map-Request/Map-Reply/Map-Register messages; they continue to be used as specified in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-5-1">¶</a></p>
<span id="name-map-record-format-example"></span><div id="maprecord">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-5-2.1">
<pre>     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   |                          Record TTL                           |
|   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
c   | Rsvd  |  Map-Version Number   |       EID-Prefix-AFI          |
o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
r   |                          EID-Prefix                           |
d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
| L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| o |        Unused Flags     |L|p|R|           Loc-AFI             |
| c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  \|                             Locator                           |
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-map-record-format-example">Map-Record Format Example</a>
        </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-5-3">
        <dt id="section-5-3.1">Map-Version Number:</dt>
        <dd id="section-5-3.2" style="margin-left: 1.0em">Map-Version of the mapping contained in the Record.
        As explained in <a class="auto internal xref" href="#sec_null">Section 6.1</a>, this field can be zero (0), meaning that no Map-Version is associated to the mapping.<a class="pilcrow" href="#section-5-3.2">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-5-4">
    This packet format is backward compatible with xTRs that do not support Map-Versioning, since they can simply ignore those bits.<a class="pilcrow" href="#section-5-4">¶</a></p>
<p id="section-5-5">
    A Map-Server receiving a message with an unexpected Map-Version number, for instance an old one, <span class="bcp14">MUST</span> silently drop the message
    and an appropriate log action <span class="bcp14">SHOULD</span> be taken.<a class="pilcrow" href="#section-5-5">¶</a></p>
</section>
</div>
<div id="vnum">
<section id="section-6">
      <h2 id="name-eid-to-rloc-map-version-num">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-eid-to-rloc-map-version-num">EID-to-RLOC Map-Version Number</a>
      </h2>
<p id="section-6-1">
    The EID-to-RLOC Map-Version number consists of an unsigned 12-bit integer.
    The version number is assigned on a per-mapping basis, meaning that different mappings have  different version numbers, which are updated independently.
    An update in the version number (i.e., a newer version) <span class="bcp14">MUST</span> consist of an increment of the older version number (the only exception is for the Null Map-Version as explained in at the end of <a class="auto internal xref" href="#sec_null">Section 6.1</a>).<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">
 The space of version numbers has a circular order where half of the version numbers are considered greater (i.e., newer) than the current Map-Version number and the other half of the version numbers are considered smaller (i.e., older) than the current Map-Version number. This is basically a serial number on which the arithmetic described in <span>[<a class="cite xref" href="#RFC1982">RFC1982</a>]</span> applies.    The ordering enables different reactions to "older" and "newer" Map-Version numbers, whereby
"older" numbers are discarded and "newer" numbers trigger Map-Requests (see <a class="auto internal xref" href="#dealing">Section 7</a> for further details).
    In a formal way, assuming that we have two version numbers (V1 and V2), both different from the special value Null Map-Version (see <a class="auto internal xref" href="#sec_null">Section 6.1</a>), and that the numbers are expressed on 12 bits, the following steps <span class="bcp14">MUST</span> be performed (in the same order shown below) to strictly define their order:<a class="pilcrow" href="#section-6-2">¶</a></p>
<ol class="normal type-1" id="section-6-3" start="1" type="1">
 <li id="section-6-3.1"> V1 = V2 : The Map-Version numbers are the same.<a class="pilcrow" href="#section-6-3.1">¶</a>
</li>
        <li id="section-6-3.2">
          <p id="section-6-3.2.1"> V2 &gt; V1 : if and only if<a class="pilcrow" href="#section-6-3.2.1">¶</a></p>
<p id="section-6-3.2.2" style="margin-left: 1.0em"> V2 &gt; V1   AND  (V2 - V1)  &lt;= 2<sup>(12-1)</sup><a class="pilcrow" href="#section-6-3.2.2">¶</a></p>
<p id="section-6-3.2.3" style="margin-left: 1.0em"> OR<a class="pilcrow" href="#section-6-3.2.3">¶</a></p>
<p id="section-6-3.2.4" style="margin-left: 1.0em"> V1 &gt; V2   AND    (V1 - V2) &gt; 2<sup>(12-1)</sup><a class="pilcrow" href="#section-6-3.2.4">¶</a></p>
</li>
        <li id="section-6-3.3"> V1 &gt; V2 : otherwise.<a class="pilcrow" href="#section-6-3.3">¶</a>
</li>
      </ol>
<p id="section-6-4">
    Using 12 bits and assuming a Map-Version value of 69, Map-Version numbers in the range [70; 69 + 2048] are greater than 69, while Map-Version numbers in the range [69 + 2049; (69 + 4095) mod 4096] are smaller than 69.<a class="pilcrow" href="#section-6-4">¶</a></p>
<p id="section-6-5">
    The initial Map-Version number of a new EID-to-RLOC mapping <span class="bcp14">SHOULD</span> be assigned randomly, but it <span class="bcp14">MUST NOT</span> be set to the Null Map-Version value (0x000), because the Null Map-Version number has a special meaning (see <a class="auto internal xref" href="#sec_null">Section 6.1</a>). Optionally, the initial Map-version number may be configured.<a class="pilcrow" href="#section-6-5">¶</a></p>
<p id="section-6-6">
    Upon reboot, an ETR will use mappings configured in its EID-to-RLOC Database.
    If those mappings have a Map-Version number, it will be used according to the mechanisms described in this document.
    ETRs <span class="bcp14">MUST NOT</span> automatically generate and assign Map-Version numbers to mappings in the EID-to-RLOC Database.<a class="pilcrow" href="#section-6-6">¶</a></p>
<div id="sec_null">
<section id="section-6.1">
        <h3 id="name-the-null-map-version">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-the-null-map-version">The Null Map-Version</a>
        </h3>
<p id="section-6.1-1">
      The value 0x000 (zero) is a special Map-Version number indicating that there is actually no version number associated to the EID-to-RLOC mapping.
      Such a value is used for special purposes and is named the Null Map-Version number.<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<p id="section-6.1-2">
      Map Records that have a Null Map-Version number indicate that there is no Map-Version number associated with the mapping.
      This means that LISP-encapsulated packets destined to the EID-Prefix referred to by the Map Record <span class="bcp14">MUST NOT</span> contain any Map-Version numbers (V-bit set to 0).
      If an ETR receives LISP-encapsulated packets with the V-bit set, when the original mapping in the EID-to-RLOC Database has the version number set to the Null Map-Version value, then those packets <span class="bcp14">MUST</span> be silently dropped.<a class="pilcrow" href="#section-6.1-2">¶</a></p>
<p id="section-6.1-3">
      The Null Map-Version may appear in the LISP-specific header as a Source Map-Version number (<a class="auto internal xref" href="#smvn">Section 7.2</a>).
      When the Source Map-Version number is set to the Null Map-Version value, it means that no map version information is conveyed for the source site.
      This means that if a mapping exists for the source EID in the EID-to-RLOC Map-Cache, then the ETR <span class="bcp14">MUST NOT</span> compare the received Null Map-Version with the content of the EID-to-RLOC Map-Cache (<a class="auto internal xref" href="#smvn">Section 7.2</a>).<a class="pilcrow" href="#section-6.1-3">¶</a></p>
<p id="section-6.1-4">
      The fact that the 0 value has a special meaning for the Map-Version number implies that, when updating a Map-Version number because of a change in the mapping, if the next value is 0, then the Map-Version number <span class="bcp14">MUST</span> be incremented by 2 (i.e., set to 1 (0x001), which is the next valid value).<a class="pilcrow" href="#section-6.1-4">¶</a></p>
</section>
</div>
</section>
</div>
<div id="dealing">
<section id="section-7">
      <h2 id="name-dealing-with-map-version-nu">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-dealing-with-map-version-nu">Dealing with Map-Version Numbers</a>
      </h2>
<p id="section-7-1">
     The main idea of using Map-Version numbers is that whenever there is
   a change in the mapping (e.g., adding/removing RLOCs, a change in the
   weights due to Traffic Engineering policies, or a change in the
   priorities) or a LISP site realizes that one or more of its own RLOCs
   are no longer reachable from a local perspective (e.g., through IGP
   or policy changes), the LISP site updates the mapping and also assigns
   a new Map-Version number.
    Only the latest Map-Version number has to be considered valid. Mapping updates and their corresponding Map-Version Number must be managed so that a very old version number will not be confused as a new version number (because of the circular numbering space). To this end, simple measures can be taken, like
   updating a mapping only when all active traffic is using the latest
   version, or waiting a sufficient amount of time to be sure that the
   mapping in LISP caches expires, which means waiting at least as long
   as the mapping Time To Live (TTL) (as defined in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>).<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2">
    An ETR receiving a LISP packet with Map-Version numbers checks the following predicates:<a class="pilcrow" href="#section-7-2">¶</a></p>
<ol class="normal type-1" id="section-7-3" start="1" type="1">
 <li id="section-7-3.1">The ITR that has sent the packet has an up-to-date mapping in its EID-to-RLOC Map-Cache for the destination EID and is performing encapsulation correctly. See <a class="auto internal xref" href="#dmvn">Section 7.1</a> for details.<a class="pilcrow" href="#section-7-3.1">¶</a>
</li>
        <li id="section-7-3.2">In the case of bidirectional traffic, the mapping in the local ETR EID-to-RLOC Map-Cache for the source EID is up to date. See <a class="auto internal xref" href="#smvn">Section 7.2</a> for details.<a class="pilcrow" href="#section-7-3.2">¶</a>
</li>
      </ol>
<div id="dmvn">
<section id="section-7.1">
        <h3 id="name-handling-dest-map-version-n">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-handling-dest-map-version-n">Handling Dest Map-Version Number</a>
        </h3>
<p id="section-7.1-1">
      When an ETR receives a packet, the Dest Map-Version number relates to the mapping for the destination EID for which the ETR is an RLOC.
      This mapping is part of the ETR EID-to-RLOC Database.
      Since the ETR is authoritative for the mapping, it has the correct and up-to-date Dest Map-Version number.
      A check on this version number <span class="bcp14">MUST</span> be done, where the following cases can arise:<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<ol class="normal type-1" id="section-7.1-2" start="1" type="1">
   <li id="section-7.1-2.1">The packet arrives with the same Dest Map-Version number stored in the EID-to-RLOC Database.
          This is the regular case.
          The ITR sending the packet has, in its EID-to-RLOC Map-Cache, an up-to-date mapping. No further actions are needed.<a class="pilcrow" href="#section-7.1-2.1">¶</a>
</li>
          <li id="section-7.1-2.2">The packet arrives with a Dest Map-Version number newer (as defined in <a class="auto internal xref" href="#vnum">Section 6</a>) than the one stored in the EID-to-RLOC Database.
          Since the ETR is authoritative on the mapping, meaning that the Map-Version number of its mapping is the correct one,
           the packet carries a version number that is not considered valid. Therefore, the packet <span class="bcp14">MUST</span> be silently dropped and an appropriate log action <span class="bcp14">SHOULD</span> be taken.<a class="pilcrow" href="#section-7.1-2.2">¶</a>
</li>
          <li id="section-7.1-2.3">The packet arrives with a Dest Map-Version number older (as defined in <a class="auto internal xref" href="#vnum">Section 6</a>) than the one stored in the EID-to-RLOC Database.
          This means that the ITR sending the packet has an old mapping in its EID-to-RLOC Map-Cache containing stale information.
          The ETR <span class="bcp14">MAY</span> choose to normally process the encapsulated datagram according to <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span>; however, the ITR sending the packet <span class="bcp14">MUST</span> be informed that a newer mapping is
          available, respecting rate-limitation policies described in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.
          This is done with a Map-Request message sent back to the ITR,
          as specified in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.
          One feature introduced by Map-Version numbers is the possibility of blocking traffic not using the latest mapping. This can happen if an ITR is not updating the mapping for which the ETR is authoritative, or it might be some form of attack.
          According to the rate-limitation policy defined in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> for Map-Request messages, after 10 retries, Map-Requests are sent every 30 seconds; if after the first 10 retries the Dest Map-Version number in the packets is not updated, the ETR <span class="bcp14">SHOULD</span> drop packets with a stale Map-Version number. Operators can configure exceptions to this recommendation, which are outside the scope of this document.<a class="pilcrow" href="#section-7.1-2.3">¶</a>
</li>
        </ol>
<p id="section-7.1-3">
      The rule in the third case <span class="bcp14">MAY</span> be more restrictive.
      If the Record TTL of the previous mapping has already expired, all packets arriving with an old Map-Version <span class="bcp14">MUST</span> be silently dropped right away without issuing any Map-Request.
      Such action is permitted because, if the new mapping with the updated version number has been unchanged for at least the same amount of time as the Record TTL of the older mapping, all the entries in the EID-to-RLOC Map-Caches of ITRs must have expired.
      Indeed, all ITRs sending traffic should have refreshed the mapping according to <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-7.1-3">¶</a></p>
<p id="section-7.1-4">
      It is a protocol violation for LISP-encapsulated packets to contain a Dest Map-Version number equal to the Null Map-Version number (see <a class="auto internal xref" href="#sec_null">Section 6.1</a>).<a class="pilcrow" href="#section-7.1-4">¶</a></p>
</section>
</div>
<div id="smvn">
<section id="section-7.2">
        <h3 id="name-handling-source-map-version">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-handling-source-map-version">Handling Source Map-Version Number</a>
        </h3>
<p id="section-7.2-1">
      When an ETR receives a packet, the Source Map-Version number relates to the mapping for the source EID for which the ITR that sent the packet is authoritative.
      If the ETR has an entry in its EID-to-RLOC Map-Cache for the source EID, then a check <span class="bcp14">MUST</span> be performed, and the following cases can arise:<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<ol class="normal type-1" id="section-7.2-2" start="1" type="1">
   <li id="section-7.2-2.1">The packet arrives with the same Source Map-Version number as that stored in the EID-to-RLOC Map-Cache. This is the regular case. The ETR has in its EID-to-RLOC Map-Cache an up-to-date copy of the mapping. No further actions are needed.<a class="pilcrow" href="#section-7.2-2.1">¶</a>
</li>
          <li id="section-7.2-2.2">The packet arrives with a Source Map-Version number newer (as defined in <a class="auto internal xref" href="#vnum">Section 6</a>) than the one stored in the local EID-to-RLOC Map-Cache.
          This means that the ETR has in its EID-to-RLOC Map-Cache a mapping that is stale and needs to be updated.
          A Map-Request <span class="bcp14">MUST</span> be sent to get the new mapping for the source EID, respecting rate-limitation policies described in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-7.2-2.2">¶</a>
</li>
          <li id="section-7.2-2.3">The packet arrives with a Source Map-Version number older (as defined in <a class="auto internal xref" href="#vnum">Section 6</a>) than the one stored in the local EID-to-RLOC Map-Cache.
          Note that if the mapping is already present in the EID-to-RLOC Map-Cache, this means that an explicit Map-Request has been sent and a Map-Reply has been received from an authoritative source.
          In this situation, the packet <span class="bcp14">SHOULD</span> be silently dropped.
          Operators can configure exceptions to this recommendation, which are outside the scope of this document.<a class="pilcrow" href="#section-7.2-2.3">¶</a>
</li>
        </ol>
<p id="section-7.2-3">
      If the ETR does not have an entry in the EID-to-RLOC Map-Cache for the source EID, then the Source Map-Version number <span class="bcp14">MUST</span> be ignored. See <a class="auto internal xref" href="#utrf">Appendix A.1</a> for an example of when this situation can arise.<a class="pilcrow" href="#section-7.2-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-8-1">
    This document builds on the specification and operation of the
    LISP control and data planes. The Security Considerations of <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span> and <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> apply. As such, Map-Versioning <span class="bcp14">MUST NOT</span> be used over the public Internet and <span class="bcp14">MUST</span> only be used in trusted and closed deployments.
    A thorough security analysis of LISP is documented in <span>[<a class="cite xref" href="#RFC7835">RFC7835</a>]</span>.<a class="pilcrow" href="#section-8-1">¶</a></p>
<p id="section-8-2">
    Attackers can try to trigger a large number of Map-Requests by simply forging packets with random Map-Versions.
    The Map-Requests are rate limited as described in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.
    With Map-Versioning, it is possible to filter packets carrying  invalid version numbers before triggering a Map-Request, thus helping to reduce the effects of DoS attacks.
    However, it might not be enough to really protect against a DDoS attack.<a class="pilcrow" href="#section-8-2">¶</a></p>
<p id="section-8-3">
    The present memo includes log action to be taken upon certain events. It is recommended that implementations include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4">
    The specifications in the present memo are relatively conservative in the sense that, in several cases, the packets are dropped. Such an approach is the outcome of considerations made about the possible risks that control plane actions that are triggered by the data plane can be used to carry out attacks. There exists corner cases where, even with an invalid Map-Version number, forwarding the packet might be potentially considered safe; however, system manageability has been given priority with respect to having to put in place more machinery to be able to identify legitimate traffic.<a class="pilcrow" href="#section-8-4">¶</a></p>
</section>
</div>
<div id="considerations">
<section id="section-9">
      <h2 id="name-deployment-considerations">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-deployment-considerations">Deployment Considerations</a>
      </h2>
<p id="section-9-1">
    LISP requires multiple ETRs within the same site to provide identical mappings for a given EID-Prefix.
    Map-Versioning does not require additional synchronization mechanisms. Clearly, all the ETRs have to reply with the same mapping, including the same Map-Version number; otherwise, there can be an inconsistency that creates additional control traffic, instabilities, and traffic disruptions.<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">
    There are two ways Map-Versioning is helpful with respect to synchronization.
    On the one hand, assigning version numbers to mappings helps in debugging, since quick checks on the consistency of the mappings on different ETRs can be done by looking at the Map-Version number.
    On the other hand, Map-Versioning can be used to control the traffic toward ETRs that announce the latest mapping.<a class="pilcrow" href="#section-9-2">¶</a></p>
<p id="section-9-3">
    As an example, let's consider the topology of <a class="auto internal xref" href="#vtraffic">Figure 3</a> where ITR A.1 of Domain A is sending unidirectional traffic to Domain B, while A.2 of Domain A exchanges bidirectional traffic with Domain B.
    In particular, ITR A.2 sends traffic to ETR B, and ETR A.2 receives traffic from ITR B.<a class="pilcrow" href="#section-9-3">¶</a></p>
<span id="name-example-topology"></span><div id="vtraffic">
<figure id="figure-3">
        <div class="alignLeft art-text artwork" id="section-9-4.1">
<pre> +-----------------+              +-----------------+
 | Domain A        |              | Domain B        |
 |       +---------+              |                 |
 |       | ITR A.1 |---           |                 |
 |       +---------+    \         +---------+       |
 |                 |      -------&gt;| ETR B   |       |
 |                 |      -------&gt;|         |       |
 |       +---------+    /         |         |       |
 |       | ITR A.2 |---      -----| ITR B   |       |
 |       |         |       /      +---------+       |
 |       | ETR A.2 |&lt;-----        |                 |
 |       +---------+              |                 |
 |                 |              |                 |
 +-----------------+              +-----------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-example-topology">Example Topology</a>
        </figcaption></figure>
</div>
<p id="section-9-5">
    Obviously, in the case of Map-Versioning, both ITR A.1 and ITR A.2 of Domain A must use the same value; otherwise, the ETR of Domain B will start to send Map-Requests.<a class="pilcrow" href="#section-9-5">¶</a></p>
<p id="section-9-6">
    The same problem can, however, arise without Map-Versioning, for instance, if the two ITRs of Domain A send different Locator-Status-Bits. In this case, either the traffic is disrupted if ETR B does not verify reachability or if ETR B will start sending Map-Requests to confirm each change in reachability.<a class="pilcrow" href="#section-9-6">¶</a></p>
<p id="section-9-7">
    So far, LISP does not provide any specific synchronization mechanism but assumes that synchronization is provided by configuring the different xTRs consistently.
    The same applies for Map-Versioning. If in the future any synchronization mechanism is provided, Map-Versioning will take advantage of it automatically, since it is included in the Map Record format, as described in <a class="auto internal xref" href="#vnumpkt">Section 5</a>.<a class="pilcrow" href="#section-9-7">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document has no IANA actions.<a class="pilcrow" href="#section-10-1">¶</a></p>
</section>
<section id="section-11">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-11.1">11.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9300">[RFC9300]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Fuller, V.</span>, <span class="refAuthor">Meyer, D.</span>, <span class="refAuthor">Lewis, D.</span>, and <span class="refAuthor">A. Cabellos, Ed.</span>, <span class="refTitle">"The Locator/ID Separation Protocol (LISP)"</span>, <span class="seriesInfo">RFC 9300</span>, <span class="seriesInfo">DOI 10.17487/RFC9300</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9300">https://www.rfc-editor.org/info/rfc9300</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9301">[RFC9301]</dt>
      <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Maino, F.</span>, <span class="refAuthor">Fuller, V.</span>, and <span class="refAuthor">A. Cabellos, Ed.</span>, <span class="refTitle">"Locator/ID Separation Protocol (LISP) Control Plane"</span>, <span class="seriesInfo">RFC 9301</span>, <span class="seriesInfo">DOI 10.17487/RFC9301</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9301">https://www.rfc-editor.org/info/rfc9301</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-11.2">11.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC1982">[RFC1982]</dt>
        <dd>
<span class="refAuthor">Elz, R.</span> and <span class="refAuthor">R. Bush</span>, <span class="refTitle">"Serial Number Arithmetic"</span>, <span class="seriesInfo">RFC 1982</span>, <span class="seriesInfo">DOI 10.17487/RFC1982</span>, <time class="refDate" datetime="1996-08">August 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1982">https://www.rfc-editor.org/info/rfc1982</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6832">[RFC6832]</dt>
        <dd>
<span class="refAuthor">Lewis, D.</span>, <span class="refAuthor">Meyer, D.</span>, <span class="refAuthor">Farinacci, D.</span>, and <span class="refAuthor">V. Fuller</span>, <span class="refTitle">"Interworking between Locator/ID Separation Protocol (LISP) and Non-LISP Sites"</span>, <span class="seriesInfo">RFC 6832</span>, <span class="seriesInfo">DOI 10.17487/RFC6832</span>, <time class="refDate" datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6832">https://www.rfc-editor.org/info/rfc6832</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6834">[RFC6834]</dt>
        <dd>
<span class="refAuthor">Iannone, L.</span>, <span class="refAuthor">Saucez, D.</span>, and <span class="refAuthor">O. Bonaventure</span>, <span class="refTitle">"Locator/ID Separation Protocol (LISP) Map-Versioning"</span>, <span class="seriesInfo">RFC 6834</span>, <span class="seriesInfo">DOI 10.17487/RFC6834</span>, <time class="refDate" datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6834">https://www.rfc-editor.org/info/rfc6834</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7835">[RFC7835]</dt>
        <dd>
<span class="refAuthor">Saucez, D.</span>, <span class="refAuthor">Iannone, L.</span>, and <span class="refAuthor">O. Bonaventure</span>, <span class="refTitle">"Locator/ID Separation Protocol (LISP) Threat Analysis"</span>, <span class="seriesInfo">RFC 7835</span>, <span class="seriesInfo">DOI 10.17487/RFC7835</span>, <time class="refDate" datetime="2016-04">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7835">https://www.rfc-editor.org/info/rfc7835</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9299">[RFC9299]</dt>
      <dd>
<span class="refAuthor">Cabellos, A.</span> and <span class="refAuthor">D. Saucez, Ed.</span>, <span class="refTitle">"An Architectural Introduction to the Locator/ID Separation Protocol (LISP)"</span>, <span class="seriesInfo">RFC 9299</span>, <span class="seriesInfo">DOI 10.17487/RFC9299</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9299">https://www.rfc-editor.org/info/rfc9299</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="benefits">
<section id="appendix-A">
      <h2 id="name-benefits-and-case-studies-f">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-benefits-and-case-studies-f">Benefits and Case Studies for Map-Versioning</a>
      </h2>
<p id="appendix-A-1">
    In the following sections, we provide more discussion on various aspects and uses of Map-Versioning. Security observations are grouped in <a class="auto internal xref" href="#security">Section 8</a>.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<div id="utrf">
<section id="appendix-A.1">
        <h3 id="name-map-versioning-and-unidirec">
<a class="section-number selfRef" href="#appendix-A.1">A.1. </a><a class="section-name selfRef" href="#name-map-versioning-and-unidirec">Map-Versioning and Unidirectional Traffic</a>
        </h3>
<p id="appendix-A.1-1">
      When using Map-Versioning, the LISP-specific header carries two Map-Version numbers for both source and destination mappings.
      This can raise the question on what will happen in the case of unidirectional flows, for instance, in the case presented in <a class="auto internal xref" href="#utraffic">Figure 4</a>, since the LISP specifications do not mandate that the ETR have a mapping from the source EID.<a class="pilcrow" href="#appendix-A.1-1">¶</a></p>
<span id="name-unidirectional-traffic-betw"></span><div id="utraffic">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="appendix-A.1-2.1">
<pre> +-----------------+            +-----------------+
 | Domain A        |            | Domain B        |
 |       +---------+            +---------+       |
 |       | ITR A   |-----------&gt;| ETR B   |       |
 |       +---------+            +---------+       |
 |                 |            |                 |
 +-----------------+            +-----------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-unidirectional-traffic-betw">Unidirectional Traffic between LISP Domains</a>
          </figcaption></figure>
</div>
<p id="appendix-A.1-3">
      An ITR is able to put both the source and destination version numbers in the LISP-specific header since the Source Map-Version number is in its database, while the Dest Map-Version number is in its cache.<a class="pilcrow" href="#appendix-A.1-3">¶</a></p>
<p id="appendix-A.1-4">
      The ETR checks only the Dest Map-Version number, ignoring the Source Map-Version number as specified in the final sentence of  <a class="auto internal xref" href="#smvn">Section 7.2</a>.<a class="pilcrow" href="#appendix-A.1-4">¶</a></p>
</section>
</div>
<section id="appendix-A.2">
        <h3 id="name-map-versioning-and-interwor">
<a class="section-number selfRef" href="#appendix-A.2">A.2. </a><a class="section-name selfRef" href="#name-map-versioning-and-interwor">Map-Versioning and Interworking</a>
        </h3>
<p id="appendix-A.2-1">
      Map-Versioning is compatible with the LISP interworking between LISP and non-LISP sites as defined in <span>[<a class="cite xref" href="#RFC6832">RFC6832</a>]</span>.
      LISP interworking defines three techniques to allow communication LISP sites and non-LISP sites, namely: Proxy-ITR, LISP-NAT, and Proxy-ETR.
      The following text describes how Map-Versioning relates to these three mechanisms.<a class="pilcrow" href="#appendix-A.2-1">¶</a></p>
<div id="pitr">
<section id="appendix-A.2.1">
          <h4 id="name-map-versioning-and-proxy-it">
<a class="section-number selfRef" href="#appendix-A.2.1">A.2.1. </a><a class="section-name selfRef" href="#name-map-versioning-and-proxy-it">Map-Versioning and Proxy-ITRs</a>
          </h4>
<p id="appendix-A.2.1-1">
        The purpose of the Proxy-ITR (PITR) is to encapsulate traffic originating in a non-LISP site in order to deliver the packet to one of the ETRs of the LISP site (cf. <a class="auto internal xref" href="#fpitr">Figure 5</a>).
        This case is very similar to the unidirectional traffic case described in <a class="auto internal xref" href="#utrf">Appendix A.1</a>; hence, similar rules apply.<a class="pilcrow" href="#appendix-A.2.1-1">¶</a></p>
<span id="name-unidirectional-traffic-from"></span><div id="fpitr">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="appendix-A.2.1-2.1">
<pre> +----------+                             +-------------+
 | LISP     |                             | non-LISP    |
 | Domain A |                             | Domain B    |
 |  +-------+        +-----------+        |             |
 |  | ETR A |&lt;-------| Proxy-ITR |&lt;-------|             |
 |  +-------+        +-----------+        |             |
 |          |                             |             |
 +----------+                             +-------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-unidirectional-traffic-from">Unidirectional Traffic from Non-LISP Domain to LISP Domain</a>
            </figcaption></figure>
</div>
<p id="appendix-A.2.1-3">
        The main difference is that a Proxy-ITR does not have any mapping, since it just encapsulates packets arriving from the non-LISP site, and thus cannot provide a Source Map-Version.
        In this case, the Proxy-ITR will just put the Null Map-Version value as the Source Map-Version number, while the receiving ETR will ignore the field.<a class="pilcrow" href="#appendix-A.2.1-3">¶</a></p>
<p id="appendix-A.2.1-4">
        With this setup, LISP Domain A is able to check whether the PITR is using the latest mapping. In the Dest Map-Version Number of the LISP-specific header, the Proxy-ITR will put the version number of the mapping it is using for encapsulation; the ETR A can use such value as defined in <a class="auto internal xref" href="#dmvn">Section 7.1</a>.<a class="pilcrow" href="#appendix-A.2.1-4">¶</a></p>
</section>
</div>
<div id="lispnat">
<section id="appendix-A.2.2">
          <h4 id="name-map-versioning-and-lisp-nat">
<a class="section-number selfRef" href="#appendix-A.2.2">A.2.2. </a><a class="section-name selfRef" href="#name-map-versioning-and-lisp-nat">Map-Versioning and LISP-NAT</a>
          </h4>
<p id="appendix-A.2.2-1">
        The LISP-NAT mechanism is based on address translation from non-routable EIDs to routable EIDs and does not involve any form of encapsulation. As such, Map-Versioning does not apply in this case.<a class="pilcrow" href="#appendix-A.2.2-1">¶</a></p>
</section>
</div>
<div id="petr">
<section id="appendix-A.2.3">
          <h4 id="name-map-versioning-and-proxy-et">
<a class="section-number selfRef" href="#appendix-A.2.3">A.2.3. </a><a class="section-name selfRef" href="#name-map-versioning-and-proxy-et">Map-Versioning and Proxy-ETRs</a>
          </h4>
<p id="appendix-A.2.3-1">
        The purpose of the Proxy-ETR (PETR) is to decapsulate traffic originating in a LISP site in order to deliver the packet to the non-LISP site (cf. <a class="auto internal xref" href="#fpetr">Figure 6</a>).
        One of the main reasons to deploy PETRs is to bypass Unicast Reverse Path Forwarding checks on the domain.<a class="pilcrow" href="#appendix-A.2.3-1">¶</a></p>
<span id="name-unidirectional-traffic-from-"></span><div id="fpetr">
<figure id="figure-6">
            <div class="alignLeft art-text artwork" id="appendix-A.2.3-2.1">
<pre> +----------+                             +-------------+
 | LISP     |                             | non-LISP    |
 | Domain A |                             | Domain B    |
 |  +-------+        +-----------+        |             |
 |  | ITR A |-------&gt;| Proxy-ETR |-------&gt;|             |
 |  +-------+        +-----------+        |             |
 |          |                             |             |
 +----------+                             +-------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-unidirectional-traffic-from-">Unidirectional Traffic from LISP Domain to Non-LISP Domain</a>
            </figcaption></figure>
</div>
<p id="appendix-A.2.3-3">
        A Proxy-ETR does not have any mapping, since it just decapsulates packets arriving from the LISP site.
        In this case, the ITR can interchangeably put a Map-Version value or the Null Map-Version value as the Dest Map-Version number, since the receiving Proxy-ETR will ignore the field.<a class="pilcrow" href="#appendix-A.2.3-3">¶</a></p>
<p id="appendix-A.2.3-4">
        With this setup, the Proxy-ETR, by looking at the Source Map-Version Number, is able to check whether the mapping of the source EID has changed. This is useful to perform source RLOC validation. In the example above, traffic coming from the LISP domain has to be LISP encapsulated with a source address being an RLOC of the domain. The Proxy-ETR can retrieve the mapping associated to the LISP domain and check if incoming LISP-encapsulated traffic is arriving from a valid RLOC. A change in the RLOC-Set that can be used as source addresses can be signaled via the version number, with the Proxy-ETR able to request the latest mapping if necessary as described in <a class="auto internal xref" href="#smvn">Section 7.2</a>.<a class="pilcrow" href="#appendix-A.2.3-4">¶</a></p>
</section>
</div>
</section>
<div id="shutdown">
<section id="appendix-A.3">
        <h3 id="name-rloc-shutdown-withdraw">
<a class="section-number selfRef" href="#appendix-A.3">A.3. </a><a class="section-name selfRef" href="#name-rloc-shutdown-withdraw">RLOC Shutdown/Withdraw</a>
        </h3>
<p id="appendix-A.3-1">
      Map-Versioning can also be used to perform a graceful shutdown or to withdraw a specific RLOC.
      This is achieved by simply issuing a new mapping, with an updated Map-Version number where the specific RLOC to be shut down is withdrawn or announced as unreachable (via the R-bit in the Map Record; see <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>) but without actually turning it off.<a class="pilcrow" href="#appendix-A.3-1">¶</a></p>
<p id="appendix-A.3-2">
      Upon updating the mapping, the RLOC will receive less and less traffic because remote LISP sites will request the updated mapping and see that it is disabled. At least one TTL, plus a little time for traffic transit, after the mapping is updated, it should be safe to shut down the RLOC gracefully, because all sites actively using the mapping should have been updated.<a class="pilcrow" href="#appendix-A.3-2">¶</a></p>
<p id="appendix-A.3-3">
      Note that a change in ETR for a flow can result in the reordering of the packet in the flow just as any other routing change could cause reordering.<a class="pilcrow" href="#appendix-A.3-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Luigi Iannone</span></div>
<div class="left" dir="auto"><span class="org">Huawei Technologies France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:luigi.iannone@huawei.com">luigi.iannone@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Damien Saucez</span></div>
<div class="left" dir="auto"><span class="org">Inria</span></div>
<div class="left" dir="auto"><span class="street-address">2004 route des Lucioles - BP 93</span></div>
<div class="left" dir="auto"><span class="locality">Sophia Antipolis</span></div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:damien.saucez@inria.fr">damien.saucez@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Olivier Bonaventure</span></div>
<div class="left" dir="auto"><span class="org">Universite catholique de Louvain</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:olivier.bonaventure@uclouvain.be">olivier.bonaventure@uclouvain.be</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>