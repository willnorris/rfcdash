<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9484: Proxying IP in HTTP</title>
<meta content="Tommy Pauly" name="author"/>
<meta content="David Schinazi" name="author"/>
<meta content="Alex Chernyakhovsky" name="author"/>
<meta content="Mirja Kühlewind" name="author"/>
<meta content="Magnus Westerlund" name="author"/>
<meta content="
       This document describes how to proxy IP packets in HTTP. This protocol is
similar to UDP proxying in HTTP but allows transmitting arbitrary IP packets.
More specifically, this document defines a protocol that allows an HTTP client
to create an IP tunnel through an HTTP server that acts as an IP proxy. This
document updates RFC 9298. 
    " name="description"/>
<meta content="xml2rfc 3.18.2" name="generator"/>
<meta content="quic" name="keyword"/>
<meta content="http" name="keyword"/>
<meta content="datagram" name="keyword"/>
<meta content="VPN" name="keyword"/>
<meta content="proxy" name="keyword"/>
<meta content="tunnels" name="keyword"/>
<meta content="quic in udp in IP in quic" name="keyword"/>
<meta content="turtles all the way down" name="keyword"/>
<meta content="masque" name="keyword"/>
<meta content="http-ng" name="keyword"/>
<meta content="9484" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9484.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-masque-connect-ip-13" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9484" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9484</td>
<td class="center">Proxying IP in HTTP</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Pauly, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9484">9484</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc9298">9298</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-10">October 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Pauly, <span class="editor">Ed.</span>
</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">D. Schinazi</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">A. Chernyakhovsky</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">M. Kühlewind</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">M. Westerlund</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9484</h1>
<h1 id="title">Proxying IP in HTTP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document describes how to proxy IP packets in HTTP. This protocol is
similar to UDP proxying in HTTP but allows transmitting arbitrary IP packets.
More specifically, this document defines a protocol that allows an HTTP client
to create an IP tunnel through an HTTP server that acts as an IP proxy. This
document updates RFC 9298.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9484">https://www.rfc-editor.org/info/rfc9484</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-conventions-and-definitions">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-configuration-of-clients">Configuration of Clients</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-tunnelling-ip-over-http">Tunnelling IP over HTTP</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-ip-proxy-handling">IP Proxy Handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="auto internal xref" href="#section-4.2">4.2</a>.  <a class="internal xref" href="#name-http-11-request">HTTP/1.1 Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="auto internal xref" href="#section-4.3">4.3</a>.  <a class="internal xref" href="#name-http-11-response">HTTP/1.1 Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="auto internal xref" href="#section-4.4">4.4</a>.  <a class="internal xref" href="#name-http-2-and-http-3-requests">HTTP/2 and HTTP/3 Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a class="auto internal xref" href="#section-4.5">4.5</a>.  <a class="internal xref" href="#name-http-2-and-http-3-responses">HTTP/2 and HTTP/3 Responses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a class="auto internal xref" href="#section-4.6">4.6</a>.  <a class="internal xref" href="#name-limiting-request-scope">Limiting Request Scope</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a class="auto internal xref" href="#section-4.7">4.7</a>.  <a class="internal xref" href="#name-capsules">Capsules</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.1">
                    <p id="section-toc.1-1.4.2.7.2.1.1"><a class="auto internal xref" href="#section-4.7.1">4.7.1</a>.  <a class="internal xref" href="#name-address_assign-capsule">ADDRESS_ASSIGN Capsule</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.2">
                    <p id="section-toc.1-1.4.2.7.2.2.1"><a class="auto internal xref" href="#section-4.7.2">4.7.2</a>.  <a class="internal xref" href="#name-address_request-capsule">ADDRESS_REQUEST Capsule</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.3">
                    <p id="section-toc.1-1.4.2.7.2.3.1"><a class="auto internal xref" href="#section-4.7.3">4.7.3</a>.  <a class="internal xref" href="#name-route_advertisement-capsule">ROUTE_ADVERTISEMENT Capsule</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a class="auto internal xref" href="#section-4.8">4.8</a>.  <a class="internal xref" href="#name-ipv6-extension-headers">IPv6 Extension Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-context-identifiers">Context Identifiers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-http-datagram-payload-forma">HTTP Datagram Payload Format</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-ip-packet-handling">IP Packet Handling</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-link-operation">Link Operation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="auto internal xref" href="#section-7.2">7.2</a>.  <a class="internal xref" href="#name-routing-operation">Routing Operation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a class="auto internal xref" href="#section-7.2.1">7.2.1</a>.  <a class="internal xref" href="#name-error-signalling">Error Signalling</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-examples">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a class="auto internal xref" href="#section-8.1">8.1</a>.  <a class="internal xref" href="#name-remote-access-vpn">Remote Access VPN</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a class="auto internal xref" href="#section-8.2">8.2</a>.  <a class="internal xref" href="#name-site-to-site-vpn">Site-to-Site VPN</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a class="auto internal xref" href="#section-8.3">8.3</a>.  <a class="internal xref" href="#name-ip-flow-forwarding">IP Flow Forwarding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a class="auto internal xref" href="#section-8.4">8.4</a>.  <a class="internal xref" href="#name-proxied-connection-racing">Proxied Connection Racing</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-extensibility-consideration">Extensibility Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-performance-considerations">Performance Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#section-10.1">10.1</a>.  <a class="internal xref" href="#name-mtu-considerations">MTU Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#section-10.2">10.2</a>.  <a class="internal xref" href="#name-ecn-considerations">ECN Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a class="auto internal xref" href="#section-10.3">10.3</a>.  <a class="internal xref" href="#name-differentiated-services-con">Differentiated Services Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#section-11">11</a>. <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#section-12">12</a>. <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a class="auto internal xref" href="#section-12.1">12.1</a>.  <a class="internal xref" href="#name-http-upgrade-token-registra">HTTP Upgrade Token Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a class="auto internal xref" href="#section-12.2">12.2</a>.  <a class="internal xref" href="#name-masque-uri-suffixes-registr">MASQUE URI Suffixes Registry Creation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a class="auto internal xref" href="#section-12.3">12.3</a>.  <a class="internal xref" href="#name-updates-to-masque-well-know">Updates to masque Well-Known URI Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a class="auto internal xref" href="#section-12.4">12.4</a>.  <a class="internal xref" href="#name-http-capsule-types-registra">HTTP Capsule Types Registrations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#section-13">13</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a class="auto internal xref" href="#section-13.1">13.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a class="auto internal xref" href="#section-13.2">13.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">HTTP provides the CONNECT method (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6">Section 9.3.6</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>) for
creating a TCP <span>[<a class="cite xref" href="#RFC9293">TCP</a>]</span> tunnel to a destination and a similar mechanism
for UDP <span>[<a class="cite xref" href="#RFC9298">CONNECT-UDP</a>]</span>. However, these mechanisms cannot tunnel other
IP protocols <span>[<a class="cite xref" href="#IANA-PN">IANA-PN</a>]</span> nor convey fields of the IP header.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">This document describes a protocol for tunnelling IP through an HTTP server
acting as an IP-specific proxy over HTTP. This can be used for various use
cases, such as remote access VPN, site-to-site VPN, secure point-to-point
communication, or general-purpose packet tunnelling.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">IP proxying operates similarly to UDP proxying <span>[<a class="cite xref" href="#RFC9298">CONNECT-UDP</a>]</span>,
whereby the proxy itself is identified with an absolute URL, optionally
containing the traffic's destination. Clients generate these URLs using a URI
Template <span>[<a class="cite xref" href="#RFC6570">TEMPLATE</a>]</span>, as described in <a class="auto internal xref" href="#client-config">Section 3</a>.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">This protocol supports all existing versions of HTTP by using HTTP Datagrams
<span>[<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>. When using HTTP/2 <span>[<a class="cite xref" href="#RFC9113">HTTP/2</a>]</span> or HTTP/3 <span>[<a class="cite xref" href="#RFC9114">HTTP/3</a>]</span>, it uses
HTTP Extended CONNECT, as described in <span>[<a class="cite xref" href="#RFC8441">EXT-CONNECT2</a>]</span> and
<span>[<a class="cite xref" href="#RFC9220">EXT-CONNECT3</a>]</span>. When using HTTP/1.x <span>[<a class="cite xref" href="#RFC9112">HTTP/1.1</a>]</span>, it uses HTTP Upgrade, as
      defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.8">Section 7.8</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">This document updates <span>[<a class="cite xref" href="#RFC9298">CONNECT-UDP</a>]</span> to change the "masque" well-known URI;
see <a class="auto internal xref" href="#iana-uri">Section 12.3</a>.<a class="pilcrow" href="#section-1-5">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-conventions-and-definitions">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">In this document, we use the term "IP proxy" to refer to the HTTP server that
responds to the IP proxying request. The term "client" is used in the HTTP
sense; the client constructs the IP proxying request. If there are HTTP
intermediaries (as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-3.7">Section 3.7</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>) between the client and
the IP proxy, those are referred to as "intermediaries" in this document. The
term "IP proxying endpoints" refers to both the client and the IP proxy.<a class="pilcrow" href="#section-2-2">¶</a></p>
<p id="section-2-3">This document uses terminology from <span>[<a class="cite xref" href="#RFC9000">QUIC</a>]</span>. Where this document
defines protocol types, the definition format uses the notation from <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-1.3">Section 1.3</a> of [<a class="cite xref" href="#RFC9000">QUIC</a>]</span>. This specification uses the variable-length integer encoding
from <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-16">Section 16</a> of [<a class="cite xref" href="#RFC9000">QUIC</a>]</span>. Variable-length integer values do not
need to be encoded in the minimum number of bytes necessary.<a class="pilcrow" href="#section-2-3">¶</a></p>
<p id="section-2-4">Note that, when the HTTP version in use does not support multiplexing streams
(such as HTTP/1.1), any reference to "stream" in this document represents the
entire connection.<a class="pilcrow" href="#section-2-4">¶</a></p>
</section>
</div>
<div id="client-config">
<section id="section-3">
      <h2 id="name-configuration-of-clients">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-configuration-of-clients">Configuration of Clients</a>
      </h2>
<p id="section-3-1">Clients are configured to use IP proxying over HTTP via a URI Template
<span>[<a class="cite xref" href="#RFC6570">TEMPLATE</a>]</span>. The URI Template <span class="bcp14">MAY</span> contain two variables: "target" and
"ipproto"; see <a class="auto internal xref" href="#scope">Section 4.6</a>. The optionality of the variables needs to be
considered when defining the template so that the variable is either
self-identifying or possible to exclude in the syntax.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2">Examples are shown below:<a class="pilcrow" href="#section-3-2">¶</a></p>
<span id="name-uri-template-examples"></span><div id="fig-template-examples">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-3-3.1">
<pre>https://example.org/.well-known/masque/ip/{target}/{ipproto}/
https://proxy.example.org:4443/masque/ip?t={target}&amp;i={ipproto}
https://proxy.example.org:4443/masque/ip{?target,ipproto}
https://masque.example.org/?user=bob
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-uri-template-examples">URI Template Examples</a>
        </figcaption></figure>
</div>
<p id="section-3-4">The following requirements apply to the URI Template:<a class="pilcrow" href="#section-3-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-5.1">The URI Template <span class="bcp14">MUST</span> be a level 3 template or lower.<a class="pilcrow" href="#section-3-5.1">¶</a>
</li>
        <li class="normal" id="section-3-5.2">The URI Template <span class="bcp14">MUST</span> be in absolute form and <span class="bcp14">MUST</span> include non-empty scheme,
authority, and path components.<a class="pilcrow" href="#section-3-5.2">¶</a>
</li>
        <li class="normal" id="section-3-5.3">The path component of the URI Template <span class="bcp14">MUST</span> start with a slash "/".<a class="pilcrow" href="#section-3-5.3">¶</a>
</li>
        <li class="normal" id="section-3-5.4">All template variables <span class="bcp14">MUST</span> be within the path or query components of the URI.<a class="pilcrow" href="#section-3-5.4">¶</a>
</li>
        <li class="normal" id="section-3-5.5">The URI Template <span class="bcp14">MAY</span> contain the two variables "target" and "ipproto" and <span class="bcp14">MAY</span>
contain other variables. If the "target" or "ipproto" variables are included,
their values <span class="bcp14">MUST NOT</span> be empty. Clients can instead use "*" to indicate
wildcard or no-preference values; see <a class="auto internal xref" href="#scope">Section 4.6</a>.<a class="pilcrow" href="#section-3-5.5">¶</a>
</li>
        <li class="normal" id="section-3-5.6">The URI Template <span class="bcp14">MUST NOT</span> contain any non-ASCII Unicode characters and <span class="bcp14">MUST</span>
only contain ASCII characters in the range 0x21-0x7E inclusive (note that
percent-encoding is allowed; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc3986#section-2.1">Section 2.1</a> of [<a class="cite xref" href="#RFC3986">URI</a>]</span>).<a class="pilcrow" href="#section-3-5.6">¶</a>
</li>
        <li class="normal" id="section-3-5.7">The URI Template <span class="bcp14">MUST NOT</span> use Reserved Expansion ("+" operator), Fragment
Expansion ("#" operator), Label Expansion with Dot-Prefix, Path Segment
Expansion with Slash-Prefix, nor Path-Style Parameter Expansion with
Semicolon-Prefix.<a class="pilcrow" href="#section-3-5.7">¶</a>
</li>
      </ul>
<p id="section-3-6">Clients <span class="bcp14">SHOULD</span> validate the requirements above; however, clients <span class="bcp14">MAY</span> use a
general-purpose URI Template implementation that lacks this specific
validation. If a client detects that any of the requirements above are not met
by a URI Template, the client <span class="bcp14">MUST</span> reject its configuration and abort the
request without sending it to the IP proxy.<a class="pilcrow" href="#section-3-6">¶</a></p>
<p id="section-3-7">As with UDP proxying, some client configurations for IP proxies will only allow
the user to configure the proxy host and proxy port. Clients with such
limitations <span class="bcp14">MAY</span> attempt to access IP proxying capabilities using the default
template, which is defined as:
"https://$PROXY_HOST:$PROXY_PORT/.well-known/masque/ip/{target}/{ipproto}/",
where $PROXY_HOST and $PROXY_PORT are the configured host and port of the IP
proxy, respectively. IP proxy deployments <span class="bcp14">SHOULD</span> offer service at this location
if they need to interoperate with such clients.<a class="pilcrow" href="#section-3-7">¶</a></p>
</section>
</div>
<div id="tunnelling-ip-over-http">
<section id="section-4">
      <h2 id="name-tunnelling-ip-over-http">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-tunnelling-ip-over-http">Tunnelling IP over HTTP</a>
      </h2>
<p id="section-4-1">To allow negotiation of a tunnel for IP over HTTP, this document defines the
"connect-ip" HTTP upgrade token. The resulting IP tunnels use the Capsule
Protocol (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>) with HTTP Datagrams in the format
defined in <a class="auto internal xref" href="#payload-format">Section 6</a>.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">To initiate an IP tunnel associated with a single HTTP stream, a client issues
a request containing the "connect-ip" upgrade token.<a class="pilcrow" href="#section-4-2">¶</a></p>
<p id="section-4-3">When sending its IP proxying request, the client <span class="bcp14">SHALL</span> perform URI Template
expansion to determine the path and query of its request; see <a class="auto internal xref" href="#client-config">Section 3</a>.<a class="pilcrow" href="#section-4-3">¶</a></p>
<p id="section-4-4">By virtue of the definition of the Capsule Protocol (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>), IP proxying requests do not carry any message content.
Similarly, successful IP proxying responses also do not carry any message
content.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">IP proxying over HTTP <span class="bcp14">MUST</span> be operated over TLS or QUIC encryption, or another
equivalent encryption protocol, to provide confidentiality, integrity, and
authentication.<a class="pilcrow" href="#section-4-5">¶</a></p>
<div id="ip-proxy-handling">
<section id="section-4.1">
        <h3 id="name-ip-proxy-handling">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-ip-proxy-handling">IP Proxy Handling</a>
        </h3>
<p id="section-4.1-1">Upon receiving an IP proxying request:<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">If the recipient is configured to use another HTTP server, it will act as an
intermediary by forwarding the request to the other HTTP server. Note that
such intermediaries may need to re-encode the request if they forward it
using a version of HTTP that is different from the one used to receive it,
as the request encoding differs by version (see below).<a class="pilcrow" href="#section-4.1-2.1">¶</a>
</li>
          <li class="normal" id="section-4.1-2.2">Otherwise, the recipient will act as an IP proxy. The IP proxy can choose to
reject the IP proxying request. Otherwise, it extracts the optional "target"
and "ipproto" variables from the URI it has reconstructed from the request
headers, decodes their percent-encoding, and establishes an IP tunnel.<a class="pilcrow" href="#section-4.1-2.2">¶</a>
</li>
        </ul>
<p id="section-4.1-3">IP proxies <span class="bcp14">MUST</span> validate whether the decoded "target" and "ipproto" variables
meet the requirements in <a class="auto internal xref" href="#scope">Section 4.6</a>. If they do not, the IP proxy <span class="bcp14">MUST</span> treat the
request as malformed; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9113#section-8.1.1">Section 8.1.1</a> of [<a class="cite xref" href="#RFC9113">HTTP/2</a>]</span> and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9114#section-4.1.2">Section 4.1.2</a> of [<a class="cite xref" href="#RFC9114">HTTP/3</a>]</span>.
If the "target" variable is a DNS name, the IP proxy <span class="bcp14">MUST</span> perform DNS
resolution (to obtain the corresponding IPv4 and/or IPv6 addresses via A and/or
AAAA records) before replying to the HTTP request. If errors occur during this
process, the IP proxy <span class="bcp14">MUST</span> reject the request and <span class="bcp14">SHOULD</span> send details using an
appropriate Proxy-Status header field <span>[<a class="cite xref" href="#RFC9209">PROXY-STATUS</a>]</span>. For example,
if DNS resolution returns an error, the proxy can use the <code>dns_error</code> proxy
error type from <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9209#section-2.3.2">Section 2.3.2</a> of [<a class="cite xref" href="#RFC9209">PROXY-STATUS</a>]</span>.<a class="pilcrow" href="#section-4.1-3">¶</a></p>
<p id="section-4.1-4">The lifetime of the IP forwarding tunnel is tied to the IP proxying request
stream. The IP proxy <span class="bcp14">MUST</span> maintain all IP address and route assignments
associated with the IP forwarding tunnel while the request stream is open. IP
proxies <span class="bcp14">MAY</span> choose to tear down the tunnel due to a period of inactivity, but
they <span class="bcp14">MUST</span> close the request stream when doing so.<a class="pilcrow" href="#section-4.1-4">¶</a></p>
<p id="section-4.1-5">A successful IP proxying response (as defined in Sections <a class="auto internal xref" href="#resp1">4.3</a> and <a class="auto internal xref" href="#resp23">4.5</a>)
indicates that the IP proxy has established an IP tunnel and is willing to
proxy IP payloads. Any response other than a successful IP proxying response indicates that
the request has failed; thus, the client <span class="bcp14">MUST</span> abort the request.<a class="pilcrow" href="#section-4.1-5">¶</a></p>
<p id="section-4.1-6">Along with a successful IP proxying response, the IP proxy can send capsules to assign
addresses and advertise routes to the client (<a class="auto internal xref" href="#capsules">Section 4.7</a>). The client can
also assign addresses and advertise routes to the IP proxy for
network-to-network routing.<a class="pilcrow" href="#section-4.1-6">¶</a></p>
</section>
</div>
<div id="req1">
<section id="section-4.2">
        <h3 id="name-http-11-request">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-http-11-request">HTTP/1.1 Request</a>
        </h3>
<p id="section-4.2-1">When using HTTP/1.1 <span>[<a class="cite xref" href="#RFC9112">HTTP/1.1</a>]</span>, an IP proxying request will meet the following
requirements:<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">The method <span class="bcp14">SHALL</span> be "GET".<a class="pilcrow" href="#section-4.2-2.1">¶</a>
</li>
          <li class="normal" id="section-4.2-2.2">The request <span class="bcp14">SHALL</span> include a single Host header field containing the host
and optional port of the IP proxy.<a class="pilcrow" href="#section-4.2-2.2">¶</a>
</li>
          <li class="normal" id="section-4.2-2.3">The request <span class="bcp14">SHALL</span> include a Connection header field with value "Upgrade"
(note that this requirement is case-insensitive, as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1">Section 7.6.1</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>).<a class="pilcrow" href="#section-4.2-2.3">¶</a>
</li>
          <li class="normal" id="section-4.2-2.4">The request <span class="bcp14">SHALL</span> include an Upgrade header field with value "connect-ip".<a class="pilcrow" href="#section-4.2-2.4">¶</a>
</li>
        </ul>
<p id="section-4.2-3">An IP proxying request that does not conform to these restrictions is
malformed. The recipient of such a malformed request <span class="bcp14">MUST</span> respond with an error
and <span class="bcp14">SHOULD</span> use the 400 (Bad Request) status code.<a class="pilcrow" href="#section-4.2-3">¶</a></p>
<p id="section-4.2-4">For example, if the client is configured with URI Template
"https://example.org/.well-known/masque/ip/{target}/{ipproto}/" and wishes to
open an IP forwarding tunnel with no target or protocol limitations, it could
send the following request:<a class="pilcrow" href="#section-4.2-4">¶</a></p>
<span id="name-example-http-11-request"></span><div id="fig-req-h1">
<figure id="figure-2">
          <div class="lang-http-message sourcecode" id="section-4.2-5.1">
<pre>GET https://example.org/.well-known/masque/ip/*/*/ HTTP/1.1
Host: example.org
Connection: Upgrade
Upgrade: connect-ip
Capsule-Protocol: ?1
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-example-http-11-request">Example HTTP/1.1 Request</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="resp1">
<section id="section-4.3">
        <h3 id="name-http-11-response">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-http-11-response">HTTP/1.1 Response</a>
        </h3>
<p id="section-4.3-1">The server indicates a successful IP proxying response by replying with the following
requirements:<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">The HTTP status code on the response <span class="bcp14">SHALL</span> be 101 (Switching Protocols).<a class="pilcrow" href="#section-4.3-2.1">¶</a>
</li>
          <li class="normal" id="section-4.3-2.2">The response <span class="bcp14">SHALL</span> include a Connection header field with value "Upgrade"
(note that this requirement is case-insensitive, as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1">Section 7.6.1</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>).<a class="pilcrow" href="#section-4.3-2.2">¶</a>
</li>
          <li class="normal" id="section-4.3-2.3">The response <span class="bcp14">SHALL</span> include a single Upgrade header field with value
"connect-ip".<a class="pilcrow" href="#section-4.3-2.3">¶</a>
</li>
          <li class="normal" id="section-4.3-2.4">The response <span class="bcp14">SHALL</span> meet the requirements of HTTP responses that start the
Capsule Protocol; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>.<a class="pilcrow" href="#section-4.3-2.4">¶</a>
</li>
        </ul>
<p id="section-4.3-3">If any of these requirements are not met, the client <span class="bcp14">MUST</span> treat this proxying
attempt as failed and close the connection.<a class="pilcrow" href="#section-4.3-3">¶</a></p>
<p id="section-4.3-4">For example, the server could respond with:<a class="pilcrow" href="#section-4.3-4">¶</a></p>
<span id="name-example-http-11-response"></span><div id="fig-resp-h1">
<figure id="figure-3">
          <div class="lang-http-message sourcecode" id="section-4.3-5.1">
<pre>HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: connect-ip
Capsule-Protocol: ?1
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-example-http-11-response">Example HTTP/1.1 Response</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="req23">
<section id="section-4.4">
        <h3 id="name-http-2-and-http-3-requests">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-http-2-and-http-3-requests">HTTP/2 and HTTP/3 Requests</a>
        </h3>
<p id="section-4.4-1">When using HTTP/2 <span>[<a class="cite xref" href="#RFC9113">HTTP/2</a>]</span> or HTTP/3 <span>[<a class="cite xref" href="#RFC9114">HTTP/3</a>]</span>, IP proxying requests use HTTP
Extended CONNECT. This requires that servers send an HTTP Setting, as specified
in <span>[<a class="cite xref" href="#RFC8441">EXT-CONNECT2</a>]</span> and <span>[<a class="cite xref" href="#RFC9220">EXT-CONNECT3</a>]</span>, and that requests use HTTP
pseudo-header fields with the following requirements:<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">The :method pseudo-header field <span class="bcp14">SHALL</span> be "CONNECT".<a class="pilcrow" href="#section-4.4-2.1">¶</a>
</li>
          <li class="normal" id="section-4.4-2.2">The :protocol pseudo-header field <span class="bcp14">SHALL</span> be "connect-ip".<a class="pilcrow" href="#section-4.4-2.2">¶</a>
</li>
          <li class="normal" id="section-4.4-2.3">The :authority pseudo-header field <span class="bcp14">SHALL</span> contain the authority of the IP
proxy.<a class="pilcrow" href="#section-4.4-2.3">¶</a>
</li>
          <li class="normal" id="section-4.4-2.4">The :path and :scheme pseudo-header fields <span class="bcp14">SHALL NOT</span> be empty. Their values
<span class="bcp14">SHALL</span> contain the scheme and path from the URI Template after the URI
Template expansion process has been completed; see <a class="auto internal xref" href="#client-config">Section 3</a>.
Variables in the URI Template can determine the scope of the request, such as
requesting full-tunnel IP packet forwarding, or a specific proxied flow; see
<a class="auto internal xref" href="#scope">Section 4.6</a>.<a class="pilcrow" href="#section-4.4-2.4">¶</a>
</li>
        </ul>
<p id="section-4.4-3">An IP proxying request that does not conform to these restrictions is
malformed; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9113#section-8.1.1">Section 8.1.1</a> of [<a class="cite xref" href="#RFC9113">HTTP/2</a>]</span> and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9114#section-4.1.2">Section 4.1.2</a> of [<a class="cite xref" href="#RFC9114">HTTP/3</a>]</span>.<a class="pilcrow" href="#section-4.4-3">¶</a></p>
<p id="section-4.4-4">For example, if the client is configured with URI Template
"https://example.org/.well-known/masque/ip/{target}/{ipproto}/" and wishes to
open an IP forwarding tunnel with no target or protocol limitations, it could
send the following request:<a class="pilcrow" href="#section-4.4-4">¶</a></p>
<span id="name-example-http-2-or-http-3-re"></span><div id="fig-req-h2">
<figure id="figure-4">
          <div class="lang-http-message sourcecode" id="section-4.4-5.1">
<pre>HEADERS
:method = CONNECT
:protocol = connect-ip
:scheme = https
:path = /.well-known/masque/ip/*/*/
:authority = example.org
capsule-protocol = ?1
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-example-http-2-or-http-3-re">Example HTTP/2 or HTTP/3 Request</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="resp23">
<section id="section-4.5">
        <h3 id="name-http-2-and-http-3-responses">
<a class="section-number selfRef" href="#section-4.5">4.5. </a><a class="section-name selfRef" href="#name-http-2-and-http-3-responses">HTTP/2 and HTTP/3 Responses</a>
        </h3>
<p id="section-4.5-1">The server indicates a successful IP proxying response by replying with the following
requirements:<a class="pilcrow" href="#section-4.5-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-2.1">The HTTP status code on the response <span class="bcp14">SHALL</span> be in the 2xx (Successful) range.<a class="pilcrow" href="#section-4.5-2.1">¶</a>
</li>
          <li class="normal" id="section-4.5-2.2">The response <span class="bcp14">SHALL</span> meet the requirements of HTTP responses that start the
Capsule Protocol; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>.<a class="pilcrow" href="#section-4.5-2.2">¶</a>
</li>
        </ul>
<p id="section-4.5-3">If any of these requirements are not met, the client <span class="bcp14">MUST</span> treat this proxying
attempt as failed and abort the request. As an example, any status code in the
3xx range will be treated as a failure and cause the client to abort the
request.<a class="pilcrow" href="#section-4.5-3">¶</a></p>
<p id="section-4.5-4">For example, the server could respond with:<a class="pilcrow" href="#section-4.5-4">¶</a></p>
<span id="name-example-http-2-or-http-3-res"></span><div id="fig-resp-h2">
<figure id="figure-5">
          <div class="lang-http-message sourcecode" id="section-4.5-5.1">
<pre>HEADERS
:status = 200
capsule-protocol = ?1
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-example-http-2-or-http-3-res">Example HTTP/2 or HTTP/3 Response</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="scope">
<section id="section-4.6">
        <h3 id="name-limiting-request-scope">
<a class="section-number selfRef" href="#section-4.6">4.6. </a><a class="section-name selfRef" href="#name-limiting-request-scope">Limiting Request Scope</a>
        </h3>
<p id="section-4.6-1">Unlike UDP proxying requests, which require specifying a target host, IP
proxying requests can allow endpoints to send arbitrary IP packets to any host.
The client can choose to restrict a given request to a specific IP prefix or IP
protocol by adding parameters to its request. When the IP proxy knows that a
request is scoped to a target prefix or protocol, it can leverage this
information to optimize its resource allocation; for example, the IP proxy can
assign the same public IP address to two IP proxying requests that are scoped
to different prefixes and/or different protocols.<a class="pilcrow" href="#section-4.6-1">¶</a></p>
<p id="section-4.6-2">The scope of the request is indicated by the client to the IP proxy via the
"target" and "ipproto" variables of the URI Template; see <a class="auto internal xref" href="#client-config">Section 3</a>.
Both the "target" and "ipproto" variables are optional; if they are not
included, they are considered to carry the wildcard value "*".<a class="pilcrow" href="#section-4.6-2">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.6-3">
          <dt id="section-4.6-3.1">target:</dt>
          <dd id="section-4.6-3.2" style="margin-left: 1.5em">
            <p id="section-4.6-3.2.1">The variable "target" contains a hostname or IP prefix of a specific host to
which the client wants to proxy packets. If the "target" variable is not
specified or its value is "*", the client is requesting to communicate with
any allowable host. "target" supports using DNS names, IPv6 prefixes, and IPv4
prefixes. Note that IPv6 scoped addressing zone identifiers <span>[<a class="cite xref" href="#RFC6874">IPv6-ZONE-ID</a>]</span> are
not supported. If the target is an IP prefix (IP address optionally followed by
a percent-encoded slash followed by the prefix length in bits), the request
will only support a single IP version. If the target is a hostname, the IP
proxy is expected to perform DNS resolution to determine which route(s) to
advertise to the client. The IP proxy <span class="bcp14">SHOULD</span> send a ROUTE_ADVERTISEMENT capsule
that includes routes for all addresses that were resolved for the requested
hostname, that are accessible to the IP proxy, and belong to an address family
for which the IP proxy also sends an Assigned Address.<a class="pilcrow" href="#section-4.6-3.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.6-3.3">ipproto:</dt>
          <dd id="section-4.6-3.4" style="margin-left: 1.5em">
            <p id="section-4.6-3.4.1">The variable "ipproto" contains an Internet Protocol Number; see the defined list in the
"Assigned Internet Protocol Numbers" IANA registry <span>[<a class="cite xref" href="#IANA-PN">IANA-PN</a>]</span>. If present, it
specifies that a client only wants to proxy a specific IP protocol for this
request. If the value is "*", or the variable is not included, the client is
requesting to use any IP protocol. The IP protocol indicated in the "ipproto"
variable represents an allowable next header value carried in IP headers that
are directly sent in HTTP Datagrams (the outermost IP headers). ICMP traffic
is always allowed, regardless of the value of this field.<a class="pilcrow" href="#section-4.6-3.4.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.6-4">Using the terms IPv6address, IPv4address, and reg-name from <span>[<a class="cite xref" href="#RFC3986">URI</a>]</span>, the
"target" and "ipproto" variables <span class="bcp14">MUST</span> adhere to the format in
<a class="auto internal xref" href="#target-format">Figure 6</a>, using notation from <span>[<a class="cite xref" href="#RFC5234">ABNF</a>]</span>. Additionally:<a class="pilcrow" href="#section-4.6-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6-5.1">If "target" contains an IPv6 literal or prefix, the colons (":") <span class="bcp14">MUST</span> be
percent-encoded. For example, if the target host is "2001:db8::42", it will
be encoded in the URI as "2001%3Adb8%3A%3A42".<a class="pilcrow" href="#section-4.6-5.1">¶</a>
</li>
          <li class="normal" id="section-4.6-5.2">If present, the IP prefix length in "target" <span class="bcp14">SHALL</span> be preceded by a
percent-encoded slash ("/"): "%2F". The IP prefix length <span class="bcp14">MUST</span> represent a
decimal integer between 0 and the length of the IP address in bits, inclusive.<a class="pilcrow" href="#section-4.6-5.2">¶</a>
</li>
          <li class="normal" id="section-4.6-5.3">If "target" contains an IP prefix and the prefix length is strictly less than
the length of the IP address in bits, the lower bits of the IP address that
are not covered by the prefix length <span class="bcp14">MUST</span> all be set to 0.<a class="pilcrow" href="#section-4.6-5.3">¶</a>
</li>
          <li class="normal" id="section-4.6-5.4">"ipproto" <span class="bcp14">MUST</span> represent a decimal integer between 0 and 255 inclusive or
the wildcard value "*".<a class="pilcrow" href="#section-4.6-5.4">¶</a>
</li>
        </ul>
<span id="name-uri-template-variable-forma"></span><div id="target-format">
<figure id="figure-6">
          <div class="lang-abnf sourcecode" id="section-4.6-6.1">
<pre>target = IPv6prefix / IPv4prefix / reg-name / "*"
IPv6prefix = IPv6address ["%2F" 1*3DIGIT]
IPv4prefix = IPv4address ["%2F" 1*2DIGIT]
ipproto = 1*3DIGIT / "*"
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-uri-template-variable-forma">URI Template Variable Format</a>
          </figcaption></figure>
</div>
<p id="section-4.6-7">IP proxies <span class="bcp14">MAY</span> perform access control using the scoping information provided by
the client, i.e., if the client is not authorized to access any of the destinations
included in the scope, then the IP proxy can immediately reject the request.<a class="pilcrow" href="#section-4.6-7">¶</a></p>
</section>
</div>
<div id="capsules">
<section id="section-4.7">
        <h3 id="name-capsules">
<a class="section-number selfRef" href="#section-4.7">4.7. </a><a class="section-name selfRef" href="#name-capsules">Capsules</a>
        </h3>
<p id="section-4.7-1">This document defines multiple new capsule types that allow endpoints to
exchange IP configuration information. Both endpoints <span class="bcp14">MAY</span> send any number of
these new capsules.<a class="pilcrow" href="#section-4.7-1">¶</a></p>
<div id="addressassign-capsule">
<section id="section-4.7.1">
          <h4 id="name-address_assign-capsule">
<a class="section-number selfRef" href="#section-4.7.1">4.7.1. </a><a class="section-name selfRef" href="#name-address_assign-capsule">ADDRESS_ASSIGN Capsule</a>
          </h4>
<p id="section-4.7.1-1">The ADDRESS_ASSIGN capsule (capsule type 0x01) allows an endpoint to assign its peer a list of IP addresses or
prefixes. Every capsule contains the full list of IP
prefixes currently assigned to the receiver. Any of these addresses can be used
as the source address on IP packets originated by the receiver of this capsule.<a class="pilcrow" href="#section-4.7.1-1">¶</a></p>
<span id="name-address_assign-capsule-form"></span><div id="addr-assign-format">
<figure id="figure-7">
            <div class="alignLeft art-text artwork" id="section-4.7.1-2.1">
<pre>ADDRESS_ASSIGN Capsule {
  Type (i) = 0x01,
  Length (i),
  Assigned Address (..) ...,
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-address_assign-capsule-form">ADDRESS_ASSIGN Capsule Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.1-3">The ADDRESS_ASSIGN capsule contains a sequence of zero or more Assigned
Addresses.<a class="pilcrow" href="#section-4.7.1-3">¶</a></p>
<span id="name-assigned-address-format"></span><div id="assigned-addr-format">
<figure id="figure-8">
            <div class="alignLeft art-text artwork" id="section-4.7.1-4.1">
<pre>Assigned Address {
  Request ID (i),
  IP Version (8),
  IP Address (32..128),
  IP Prefix Length (8),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-assigned-address-format">Assigned Address Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.1-5">Each Assigned Address contains the following fields:<a class="pilcrow" href="#section-4.7.1-5">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.7.1-6">
            <dt id="section-4.7.1-6.1">Request ID:</dt>
            <dd id="section-4.7.1-6.2" style="margin-left: 1.5em">
              <p id="section-4.7.1-6.2.1">Request identifier, encoded as a variable-length integer. If this address
assignment is in response to an Address Request (see <a class="auto internal xref" href="#addr_req">Section 4.7.2</a>), then this
field <span class="bcp14">SHALL</span> contain the value of the corresponding field in the request.
Otherwise, this field <span class="bcp14">SHALL</span> be zero.<a class="pilcrow" href="#section-4.7.1-6.2.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.1-6.3">IP Version:</dt>
            <dd id="section-4.7.1-6.4" style="margin-left: 1.5em">
              <p id="section-4.7.1-6.4.1">IP Version of this address assignment, encoded as an unsigned 8-bit integer. It
<span class="bcp14">MUST</span> be either 4 or 6.<a class="pilcrow" href="#section-4.7.1-6.4.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.1-6.5">IP Address:</dt>
            <dd id="section-4.7.1-6.6" style="margin-left: 1.5em">
              <p id="section-4.7.1-6.6.1">Assigned IP address. If the IP Version field has value 4, the IP Address
field <span class="bcp14">SHALL</span> have a length of 32 bits. If the IP Version field has value 6, the
IP Address field <span class="bcp14">SHALL</span> have a length of 128 bits.<a class="pilcrow" href="#section-4.7.1-6.6.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.1-6.7">IP Prefix Length:</dt>
            <dd id="section-4.7.1-6.8" style="margin-left: 1.5em">
              <p id="section-4.7.1-6.8.1">The number of bits in the IP address that are used to define the prefix that
is being assigned, encoded as an unsigned 8-bit integer. This <span class="bcp14">MUST</span> be less than
or equal to the length of the IP Address field in bits. If the prefix length
is equal to the length of the IP address, the receiver of this capsule is
allowed to send packets from a single source address. If the prefix length is
less than the length of the IP address, the receiver of this capsule is allowed
to send packets from any source address that falls within the prefix. If the
prefix length is strictly less than the length of the IP address in bits, the
lower bits of the IP Address field that are not covered by the prefix length
<span class="bcp14">MUST</span> all be set to 0.<a class="pilcrow" href="#section-4.7.1-6.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.7.1-7">If any of the capsule fields are malformed upon reception, the receiver of the
capsule <span class="bcp14">MUST</span> follow the error-handling procedure defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>.<a class="pilcrow" href="#section-4.7.1-7">¶</a></p>
<p id="section-4.7.1-8">If an ADDRESS_ASSIGN capsule does not contain an address that was previously
transmitted in another ADDRESS_ASSIGN capsule, it indicates that the address
has been removed. An ADDRESS_ASSIGN capsule can also be empty, indicating that
all addresses have been removed.<a class="pilcrow" href="#section-4.7.1-8">¶</a></p>
<p id="section-4.7.1-9">In some deployments of IP proxying in HTTP, an endpoint needs to be assigned an
address by its peer before it knows what source address to set on its own
packets. For example, in the remote access VPN case (<a class="auto internal xref" href="#example-remote">Section 8.1</a>), the
client cannot send IP packets until it knows what address to use.
In these
deployments, the endpoint that is expecting an address assignment <span class="bcp14">MUST</span> send an
ADDRESS_REQUEST capsule. This isn't required if the endpoint does not need any
address assignment, for example, when it is configured out-of-band with static
addresses.<a class="pilcrow" href="#section-4.7.1-9">¶</a></p>
<p id="section-4.7.1-10">While ADDRESS_ASSIGN capsules are commonly sent in response to ADDRESS_REQUEST
capsules, endpoints <span class="bcp14">MAY</span> send ADDRESS_ASSIGN capsules unprompted.<a class="pilcrow" href="#section-4.7.1-10">¶</a></p>
</section>
</div>
<div id="addr_req">
<section id="section-4.7.2">
          <h4 id="name-address_request-capsule">
<a class="section-number selfRef" href="#section-4.7.2">4.7.2. </a><a class="section-name selfRef" href="#name-address_request-capsule">ADDRESS_REQUEST Capsule</a>
          </h4>
<p id="section-4.7.2-1">The ADDRESS_REQUEST capsule (capsule type 0x02) allows an endpoint to request assignment of IP addresses from its peer.
The capsule allows the endpoint to optionally indicate a preference for which
address it would get assigned.<a class="pilcrow" href="#section-4.7.2-1">¶</a></p>
<span id="name-address_request-capsule-for"></span><div id="addr-req-format">
<figure id="figure-9">
            <div class="alignLeft art-text artwork" id="section-4.7.2-2.1">
<pre>ADDRESS_REQUEST Capsule {
  Type (i) = 0x02,
  Length (i),
  Requested Address (..) ...,
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-address_request-capsule-for">ADDRESS_REQUEST Capsule Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.2-3">The ADDRESS_REQUEST capsule contains a sequence of one or more Requested
Addresses.<a class="pilcrow" href="#section-4.7.2-3">¶</a></p>
<span id="name-requested-address-format"></span><div id="requested-addr-format">
<figure id="figure-10">
            <div class="alignLeft art-text artwork" id="section-4.7.2-4.1">
<pre>Requested Address {
  Request ID (i),
  IP Version (8),
  IP Address (32..128),
  IP Prefix Length (8),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-10">Figure 10</a>:
<a class="selfRef" href="#name-requested-address-format">Requested Address Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.2-5">Each Requested Address contains the following fields:<a class="pilcrow" href="#section-4.7.2-5">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.7.2-6">
            <dt id="section-4.7.2-6.1">Request ID:</dt>
            <dd id="section-4.7.2-6.2" style="margin-left: 1.5em">
              <p id="section-4.7.2-6.2.1">Request identifier, encoded as a variable-length integer. This is the
identifier of this specific address request. Each request from a given endpoint
carries a different identifier. Request IDs <span class="bcp14">MUST NOT</span> be reused by an endpoint
and <span class="bcp14">MUST NOT</span> be zero.<a class="pilcrow" href="#section-4.7.2-6.2.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.2-6.3">IP Version:</dt>
            <dd id="section-4.7.2-6.4" style="margin-left: 1.5em">
              <p id="section-4.7.2-6.4.1">IP Version of this address request, encoded as an unsigned 8-bit integer. It
<span class="bcp14">MUST</span> be either 4 or 6.<a class="pilcrow" href="#section-4.7.2-6.4.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.2-6.5">IP Address:</dt>
            <dd id="section-4.7.2-6.6" style="margin-left: 1.5em">
              <p id="section-4.7.2-6.6.1">Requested IP address. If the IP Version field has value 4, the IP Address
field <span class="bcp14">SHALL</span> have a length of 32 bits. If the IP Version field has value 6, the
IP Address field <span class="bcp14">SHALL</span> have a length of 128 bits.<a class="pilcrow" href="#section-4.7.2-6.6.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.2-6.7">IP Prefix Length:</dt>
            <dd id="section-4.7.2-6.8" style="margin-left: 1.5em">
              <p id="section-4.7.2-6.8.1">Length of the IP Prefix requested in bits, encoded as an unsigned 8-bit
integer. It <span class="bcp14">MUST</span> be less than or equal to the length of the IP Address field in
bits. If the prefix length is strictly less than the length of the IP address
in bits, the lower bits of the IP Address field that are not covered by the
prefix length <span class="bcp14">MUST</span> all be set to 0.<a class="pilcrow" href="#section-4.7.2-6.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.7.2-7">If the IP address is all-zero (0.0.0.0 or ::), this indicates that the sender
is requesting an address of that address family but does not have a preference
for a specific address. In that scenario, the prefix length still indicates the
sender's preference for the prefix length it is requesting.<a class="pilcrow" href="#section-4.7.2-7">¶</a></p>
<p id="section-4.7.2-8">If any of the capsule fields are malformed upon reception, the receiver of the
capsule <span class="bcp14">MUST</span> follow the error-handling procedure defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>.<a class="pilcrow" href="#section-4.7.2-8">¶</a></p>
<p id="section-4.7.2-9">Upon receiving the ADDRESS_REQUEST capsule, an endpoint <span class="bcp14">SHOULD</span> assign one or
more IP addresses to its peer and then respond with an ADDRESS_ASSIGN capsule
to inform the peer of the assignment. For each Requested Address, the receiver
of the ADDRESS_REQUEST capsule <span class="bcp14">SHALL</span> respond with an Assigned Address with a
matching Request ID. If the requested address was assigned, the IP Address and
IP Prefix Length fields in the Assigned Address response <span class="bcp14">SHALL</span> be set to the
assigned values. If the requested address was not assigned, the IP address
<span class="bcp14">SHALL</span> be all-zero, and the IP Prefix Length <span class="bcp14">SHALL</span> be the maximum length
(0.0.0.0/32 or ::/128) to indicate that no address was assigned. These address
rejections <span class="bcp14">SHOULD NOT</span> be included in subsequent ADDRESS_ASSIGN capsules. Note
that other Assigned Address entries that do not correspond to any Request ID
can also be contained in the same ADDRESS_ASSIGN response.<a class="pilcrow" href="#section-4.7.2-9">¶</a></p>
<p id="section-4.7.2-10">If an endpoint receives an ADDRESS_REQUEST capsule that contains zero Requested
Addresses, it <span class="bcp14">MUST</span> abort the IP proxying request stream.<a class="pilcrow" href="#section-4.7.2-10">¶</a></p>
<p id="section-4.7.2-11">Note that the ordering of Requested Addresses does not carry any semantics.
Similarly, the Request ID is only meant as a unique identifier; it does not
convey any priority or importance.<a class="pilcrow" href="#section-4.7.2-11">¶</a></p>
</section>
</div>
<div id="route-adv">
<section id="section-4.7.3">
          <h4 id="name-route_advertisement-capsule">
<a class="section-number selfRef" href="#section-4.7.3">4.7.3. </a><a class="section-name selfRef" href="#name-route_advertisement-capsule">ROUTE_ADVERTISEMENT Capsule</a>
          </h4>
<p id="section-4.7.3-1">The ROUTE_ADVERTISEMENT capsule (capsule type 0x03) allows an endpoint to communicate to its peer that it is willing
to route traffic to a set of IP address ranges. This indicates that the sender
has an existing route to each address range and notifies its peer that, if the
receiver of the ROUTE_ADVERTISEMENT capsule sends IP packets for one of these
ranges in HTTP Datagrams, the sender of the capsule will forward them along its
preexisting route. Any address that is in one of the address ranges can be
used as the destination address on IP packets originated by the receiver of
this capsule.<a class="pilcrow" href="#section-4.7.3-1">¶</a></p>
<span id="name-route_advertisement-capsule-"></span><div id="route-adv-format">
<figure id="figure-11">
            <div class="alignLeft art-text artwork" id="section-4.7.3-2.1">
<pre>ROUTE_ADVERTISEMENT Capsule {
  Type (i) = 0x03,
  Length (i),
  IP Address Range (..) ...,
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-11">Figure 11</a>:
<a class="selfRef" href="#name-route_advertisement-capsule-">ROUTE_ADVERTISEMENT Capsule Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.3-3">The ROUTE_ADVERTISEMENT capsule contains a sequence of zero or more IP Address
Ranges.<a class="pilcrow" href="#section-4.7.3-3">¶</a></p>
<span id="name-ip-address-range-format"></span><div id="addr-range-format">
<figure id="figure-12">
            <div class="alignLeft art-text artwork" id="section-4.7.3-4.1">
<pre>IP Address Range {
  IP Version (8),
  Start IP Address (32..128),
  End IP Address (32..128),
  IP Protocol (8),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-12">Figure 12</a>:
<a class="selfRef" href="#name-ip-address-range-format">IP Address Range Format</a>
            </figcaption></figure>
</div>
<p id="section-4.7.3-5">Each IP Address Range contains the following fields:<a class="pilcrow" href="#section-4.7.3-5">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.7.3-6">
            <dt id="section-4.7.3-6.1">IP Version:</dt>
            <dd id="section-4.7.3-6.2" style="margin-left: 1.5em">
              <p id="section-4.7.3-6.2.1">IP Version of this range, encoded as an unsigned 8-bit integer. It <span class="bcp14">MUST</span> be
either 4 or 6.<a class="pilcrow" href="#section-4.7.3-6.2.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.3-6.3">Start IP Address and End IP Address:</dt>
            <dd id="section-4.7.3-6.4" style="margin-left: 1.5em">
              <p id="section-4.7.3-6.4.1">Inclusive start and end IP address of the advertised range. If the IP Version
field has value 4, these fields <span class="bcp14">SHALL</span> have a length of 32 bits. If the IP
Version field has value 6, these fields <span class="bcp14">SHALL</span> have a length of 128 bits. The
Start IP Address <span class="bcp14">MUST</span> be less than or equal to the End IP Address.<a class="pilcrow" href="#section-4.7.3-6.4.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.7.3-6.5">IP Protocol:</dt>
            <dd id="section-4.7.3-6.6" style="margin-left: 1.5em">
              <p id="section-4.7.3-6.6.1">The Internet Protocol Number for traffic that can be sent to this range,
encoded as an unsigned 8-bit integer. If the value is 0, all protocols are
allowed. If the value is not 0, it represents an allowable next header value
carried in IP headers that are sent directly in HTTP Datagrams (the outermost
IP headers). ICMP traffic is always allowed, regardless of the value of this
field.<a class="pilcrow" href="#section-4.7.3-6.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.7.3-7">If any of the capsule fields are malformed upon reception, the receiver of the
capsule <span class="bcp14">MUST</span> follow the error-handling procedure defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9297#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>.<a class="pilcrow" href="#section-4.7.3-7">¶</a></p>
<p id="section-4.7.3-8">Upon receiving the ROUTE_ADVERTISEMENT capsule, an endpoint <span class="bcp14">MAY</span> update its
local state regarding what its peer is willing to route (subject to local
policy), such as by installing entries in a routing table.<a class="pilcrow" href="#section-4.7.3-8">¶</a></p>
<p id="section-4.7.3-9">Each ROUTE_ADVERTISEMENT contains the full list of address ranges. If multiple
ROUTE_ADVERTISEMENT capsules are sent in one direction, each
ROUTE_ADVERTISEMENT capsule supersedes prior ones. In other words, if a given
address range was present in a prior capsule but the most recently received
ROUTE_ADVERTISEMENT capsule does not contain it, the receiver will consider
that range withdrawn.<a class="pilcrow" href="#section-4.7.3-9">¶</a></p>
<p id="section-4.7.3-10">If multiple ranges using the same IP protocol were to overlap, some routing
table implementations might reject them. To prevent overlap, the ranges are
ordered; this places the burden on the sender and makes verification by the
receiver much simpler. If an IP Address Range A precedes an IP Address Range B
in the same ROUTE_ADVERTISEMENT capsule, they <span class="bcp14">MUST</span> follow these requirements:<a class="pilcrow" href="#section-4.7.3-10">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.3-11.1">The IP Version of A <span class="bcp14">MUST</span> be less than or equal to the IP Version of B.<a class="pilcrow" href="#section-4.7.3-11.1">¶</a>
</li>
            <li class="normal" id="section-4.7.3-11.2">If the IP Version of A and B are equal, the IP Protocol of A <span class="bcp14">MUST</span> be less
than or equal to the IP Protocol of B.<a class="pilcrow" href="#section-4.7.3-11.2">¶</a>
</li>
            <li class="normal" id="section-4.7.3-11.3">If the IP Version and IP Protocol of A and B are both equal, the End IP
Address of A <span class="bcp14">MUST</span> be strictly less than the Start IP Address of B.<a class="pilcrow" href="#section-4.7.3-11.3">¶</a>
</li>
          </ul>
<p id="section-4.7.3-12">If an endpoint receives a ROUTE_ADVERTISEMENT capsule that does not meet these
requirements, it <span class="bcp14">MUST</span> abort the IP proxying request stream.<a class="pilcrow" href="#section-4.7.3-12">¶</a></p>
<p id="section-4.7.3-13">Since setting the IP protocol to zero indicates all protocols are allowed, the
requirements above make it possible for two routes to overlap when one has its IP
protocol set to zero and the other has it set to non-zero. Endpoints <span class="bcp14">MUST NOT</span> send a
ROUTE_ADVERTISEMENT capsule with routes that overlap in such a way. Validating
this requirement is <span class="bcp14">OPTIONAL</span>, but if an endpoint detects the violation, it <span class="bcp14">MUST</span>
abort the IP proxying request stream.<a class="pilcrow" href="#section-4.7.3-13">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ipv6-extension-headers">
<section id="section-4.8">
        <h3 id="name-ipv6-extension-headers">
<a class="section-number selfRef" href="#section-4.8">4.8. </a><a class="section-name selfRef" href="#name-ipv6-extension-headers">IPv6 Extension Headers</a>
        </h3>
<p id="section-4.8-1">Both request scoping (see <a class="auto internal xref" href="#scope">Section 4.6</a>) and the ROUTE_ADVERTISEMENT capsule (see
<a class="auto internal xref" href="#route-adv">Section 4.7.3</a>) use Internet Protocol Numbers. These numbers represent both upper
layers (as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8200#section-2">Section 2</a> of [<a class="cite xref" href="#RFC8200">IPv6</a>]</span>, with examples that include TCP and
UDP) and IPv6 extension headers (as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8200#section-4">Section 4</a> of [<a class="cite xref" href="#RFC8200">IPv6</a>]</span>, with examples
that include Fragment and Options headers). IP proxies <span class="bcp14">MAY</span> reject requests to scope
to protocol numbers that are used for extension headers. Upon receiving
packets, implementations that support scoping or routing by Internet Protocol Number
<span class="bcp14">MUST</span> walk the chain of extensions to find the outermost non-extension Internet Protocol
Number to match against the scoping rule. Note that the ROUTE_ADVERTISEMENT
capsule uses Internet Protocol Number 0 to indicate that all protocols are allowed;
it does not restrict the route to the IPv6 Hop-by-Hop Options header
(<span><a class="relref" href="https://rfc-editor.org/rfc/rfc8200#section-4.3">Section 4.3</a> of [<a class="cite xref" href="#RFC8200">IPv6</a>]</span>).<a class="pilcrow" href="#section-4.8-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="context-identifiers">
<section id="section-5">
      <h2 id="name-context-identifiers">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-context-identifiers">Context Identifiers</a>
      </h2>
<p id="section-5-1">The mechanism for proxying IP in HTTP defined in this document allows future
extensions to exchange HTTP Datagrams that carry different semantics from IP
payloads. Some of these extensions can augment IP payloads with additional data
or compress IP header fields, while others can exchange data that is completely
separate from IP payloads. In order to accomplish this, all HTTP Datagrams
associated with IP proxying request streams start with a Context ID field; see
<a class="auto internal xref" href="#payload-format">Section 6</a>.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">Context IDs are 62-bit integers (0 to 2<sup>62</sup>-1). Context IDs are
encoded as variable-length integers; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-16">Section 16</a> of [<a class="cite xref" href="#RFC9000">QUIC</a>]</span>. The Context ID
value of 0 is reserved for IP payloads, while non-zero values are dynamically
allocated. Non-zero even-numbered Context IDs are client-allocated, and
odd-numbered Context IDs are proxy-allocated. The Context ID namespace is tied
to a given HTTP request; it is possible for a Context ID with the same numeric
value to be simultaneously allocated in distinct requests, potentially with
different semantics. Context IDs <span class="bcp14">MUST NOT</span> be re-allocated within a given HTTP
request but <span class="bcp14">MAY</span> be allocated in any order. The Context ID allocation
restrictions to the use of even-numbered and odd-numbered Context IDs exist in
order to avoid the need for synchronization between endpoints. However, once a
Context ID has been allocated, those restrictions do not apply to the use of
the Context ID; it can be used by either the client or the IP proxy,
independent of which endpoint initially allocated it.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3">Registration is the action by which an endpoint informs its peer of the
semantics and format of a given Context ID. This document does not define how
registration occurs. Future extensions <span class="bcp14">MAY</span> use HTTP header fields or capsules
to register Context IDs. Depending on the method being used, it is possible for
datagrams to be received with Context IDs that have not yet been registered.
For instance, this can be due to reordering of the packet containing the
datagram and the packet containing the registration message during transmission.<a class="pilcrow" href="#section-5-3">¶</a></p>
</section>
</div>
<div id="payload-format">
<section id="section-6">
      <h2 id="name-http-datagram-payload-forma">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-http-datagram-payload-forma">HTTP Datagram Payload Format</a>
      </h2>
<p id="section-6-1">When associated with IP proxying request streams, the HTTP Datagram Payload
field of HTTP Datagrams (see <span>[<a class="cite xref" href="#RFC9297">HTTP-DGRAM</a>]</span>) has the format defined in
<a class="auto internal xref" href="#dgram-format">Figure 13</a>. Note that, when HTTP Datagrams are encoded using QUIC DATAGRAM
frames, the Context ID field defined below directly follows the Quarter Stream
ID field that is at the start of the QUIC DATAGRAM frame payload:<a class="pilcrow" href="#section-6-1">¶</a></p>
<span id="name-ip-proxying-http-datagram-f"></span><div id="dgram-format">
<figure id="figure-13">
        <div class="alignLeft art-text artwork" id="section-6-2.1">
<pre>IP Proxying HTTP Datagram Payload {
  Context ID (i),
  Payload (..),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-13">Figure 13</a>:
<a class="selfRef" href="#name-ip-proxying-http-datagram-f">IP Proxying HTTP Datagram Format</a>
        </figcaption></figure>
</div>
<p id="section-6-3">The IP Proxying HTTP Datagram Payload contains the following fields:<a class="pilcrow" href="#section-6-3">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6-4">
        <dt id="section-6-4.1">Context ID:</dt>
        <dd id="section-6-4.2" style="margin-left: 1.5em">
          <p id="section-6-4.2.1">A variable-length integer that contains the value of the Context ID. If an
HTTP/3 datagram that carries an unknown Context ID is received, the receiver
<span class="bcp14">SHALL</span> either drop that datagram silently or buffer it temporarily (on the order
of a round trip) while awaiting the registration of the corresponding Context
ID.<a class="pilcrow" href="#section-6-4.2.1">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-6-4.3">Payload:</dt>
        <dd id="section-6-4.4" style="margin-left: 1.5em">
          <p id="section-6-4.4.1">The payload of the datagram, whose semantics depend on value of the previous
field. Note that this field can be empty.<a class="pilcrow" href="#section-6-4.4.1">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-6-5">IP packets are encoded using HTTP Datagrams with the Context ID set to zero.
When the Context ID is set to zero, the Payload field contains a full IP packet
(from the IP Version field until the last byte of the IP payload).<a class="pilcrow" href="#section-6-5">¶</a></p>
</section>
</div>
<div id="ip-packet-handling">
<section id="section-7">
      <h2 id="name-ip-packet-handling">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-ip-packet-handling">IP Packet Handling</a>
      </h2>
<p id="section-7-1">This document defines a tunneling mechanism that is conceptually an IP link.
However, because links are attached to IP routers, implementations might need
to handle some of the responsibilities of IP routers if they do not delegate
them to another implementation, such as a kernel.<a class="pilcrow" href="#section-7-1">¶</a></p>
<div id="link-operation">
<section id="section-7.1">
        <h3 id="name-link-operation">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-link-operation">Link Operation</a>
        </h3>
<p id="section-7.1-1">The IP forwarding tunnels described in this document are not fully featured
"interfaces" in the IPv6 addressing architecture sense <span>[<a class="cite xref" href="#RFC4291">IPv6-ADDR</a>]</span>.
In particular, they do not necessarily have IPv6 link-local addresses.
Additionally, IPv6 stateless autoconfiguration or router advertisement messages
are not used in such interfaces, and neither is neighbor discovery.<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<p id="section-7.1-2">When using HTTP/2 or HTTP/3, a client <span class="bcp14">MAY</span> optimistically start sending proxied IP packets before receiving
the response to its IP proxying request, noting however that those may not be
processed by the IP proxy if it responds to the request with a failure or if
the datagrams are received by the IP proxy before the request. Since receiving
addresses and routes is required in order to know that a packet can be sent
through the tunnel, such optimistic packets might be dropped by the IP proxy if
it chooses to provide different addressing or routing information than what the
client assumed.<a class="pilcrow" href="#section-7.1-2">¶</a></p>
<p id="section-7.1-3">Note that it is possible for multiple proxied IP packets to be encapsulated in
the same outer packet, for example, because a QUIC packet can carry more than one QUIC
DATAGRAM frame. It is also possible for a proxied IP packet to span multiple
outer packets, because a DATAGRAM capsule can be split across multiple QUIC or
TCP packets.<a class="pilcrow" href="#section-7.1-3">¶</a></p>
</section>
</div>
<div id="routing-operation">
<section id="section-7.2">
        <h3 id="name-routing-operation">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-routing-operation">Routing Operation</a>
        </h3>
<p id="section-7.2-1">The requirements in this section are a repetition of requirements that apply to
IP routers in general and might not apply to implementations of IP proxying
that rely on external software for routing.<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<p id="section-7.2-2">When an endpoint receives an HTTP Datagram containing an IP packet, it will
parse the packet's IP header, perform any local policy checks (e.g., source
address validation), check their routing table to pick an outbound interface,
and then send the IP packet on that interface or pass it to a local
application. The endpoint can also choose to drop any received packets instead
of forwarding them. If a received IP packet fails any correctness or policy
checks, that is a forwarding error, not a protocol violation, as far as IP
proxying is concerned; see <a class="auto internal xref" href="#error-signal">Section 7.2.1</a>. IP proxying endpoints <span class="bcp14">MAY</span>
implement additional filtering policies on the IP packets they forward.<a class="pilcrow" href="#section-7.2-2">¶</a></p>
<p id="section-7.2-3">In the other direction, when an endpoint receives an IP packet, it checks to see
if the packet matches the routes mapped for an IP tunnel and performs the same
forwarding checks as above before transmitting the packet over HTTP Datagrams.<a class="pilcrow" href="#section-7.2-3">¶</a></p>
<p id="section-7.2-4">When IP proxying endpoints forward IP packets between different links, they
will decrement the IP Hop Count (or TTL) upon encapsulation but not upon
decapsulation. In other words, the Hop Count is decremented right before an IP
packet is transmitted in an HTTP Datagram. This prevents infinite loops in the
presence of routing loops and matches the choices in IPsec <span>[<a class="cite xref" href="#RFC4301">IPSEC</a>]</span>.
This does not apply to IP packets generated by the IP proxying endpoint itself.<a class="pilcrow" href="#section-7.2-4">¶</a></p>
<p id="section-7.2-5">Implementers need to ensure that they do not forward any link-local traffic
beyond the IP proxying interface that it was received on. IP proxying endpoints
also need to properly reply to packets destined to link-local multicast
addresses.<a class="pilcrow" href="#section-7.2-5">¶</a></p>
<p id="section-7.2-6">IPv6 requires that every link have an MTU of at least 1280 bytes <span>[<a class="cite xref" href="#RFC8200">IPv6</a>]</span>.
Since IP proxying in HTTP conveys IP packets in HTTP Datagrams and those can in
turn be sent in QUIC DATAGRAM frames that cannot be fragmented
<span>[<a class="cite xref" href="#RFC9221">DGRAM</a>]</span>, the MTU of an IP tunnel can be limited by the MTU of the
QUIC connection that IP proxying is operating over. This can lead to situations
where the IPv6 minimum link MTU is violated. IP proxying endpoints that operate
as routers and support IPv6 <span class="bcp14">MUST</span> ensure that the IP tunnel link MTU is at least
1280 bytes (i.e., that they can send HTTP Datagrams with payloads of at least 1280
bytes). This can be accomplished using various techniques:<a class="pilcrow" href="#section-7.2-6">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-7.1">If both IP proxying endpoints know for certain that HTTP intermediaries are
not in use, the endpoints can pad the QUIC INITIAL packets of the outer
QUIC connection that IP proxying is running over. (Assuming QUIC version 1 is
in use, the overhead is 1 byte for the type, 20 bytes for the maximal connection ID length, 4
bytes for the maximal packet number length, 1 byte for the DATAGRAM frame type, 8 bytes
for the maximal Quarter Stream ID, 1 byte for the zero Context ID, and 16 bytes for
the Authenticated Encryption with Associated Data (AEAD) authentication tag, for a total of 51 bytes of overhead, which
corresponds to padding QUIC INITIAL packets to 1331 bytes or more.)<a class="pilcrow" href="#section-7.2-7.1">¶</a>
</li>
          <li class="normal" id="section-7.2-7.2">IP proxying endpoints can also send ICMPv6 echo requests with 1232 bytes of
data to ascertain the link MTU and tear down the tunnel if they do not
receive a response. Unless endpoints have an out-of-band means of
guaranteeing that the previous techniques are sufficient, they <span class="bcp14">MUST</span> use this
method. If an endpoint does not know an IPv6 address of its peer, it can send
the ICMPv6 echo request to the link-local all nodes multicast address
(ff02::1).<a class="pilcrow" href="#section-7.2-7.2">¶</a>
</li>
        </ul>
<p id="section-7.2-8">If an endpoint is using QUIC DATAGRAM frames to convey IPv6 packets and it
detects that the QUIC MTU is too low to allow sending 1280 bytes, it <span class="bcp14">MUST</span> abort
the IP proxying request stream.<a class="pilcrow" href="#section-7.2-8">¶</a></p>
<div id="error-signal">
<section id="section-7.2.1">
          <h4 id="name-error-signalling">
<a class="section-number selfRef" href="#section-7.2.1">7.2.1. </a><a class="section-name selfRef" href="#name-error-signalling">Error Signalling</a>
          </h4>
<p id="section-7.2.1-1">Since IP proxying endpoints often forward IP packets onwards to other network
interfaces, they need to handle errors in the forwarding process. For example,
forwarding can fail if the endpoint does not have a route for the destination
address, if it is configured to reject a destination prefix by policy, or if
the MTU of the outgoing link is lower than the size of the packet to be
forwarded. In such scenarios, IP proxying endpoints <span class="bcp14">SHOULD</span> use ICMP
<span>[<a class="cite xref" href="#RFC0792">ICMP</a>]</span> <span>[<a class="cite xref" href="#RFC4443">ICMPv6</a>]</span> to signal the forwarding error to its
peer by generating ICMP packets and sending them using HTTP Datagrams.<a class="pilcrow" href="#section-7.2.1-1">¶</a></p>
<p id="section-7.2.1-2">Endpoints are free to select the most appropriate ICMP errors to send. Some
examples that are relevant for IP proxying include the following:<a class="pilcrow" href="#section-7.2.1-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.1-3.1">For invalid source addresses, send Destination Unreachable (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc4443#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#RFC4443">ICMPv6</a>]</span>) with code 5, "Source address failed ingress/egress policy".<a class="pilcrow" href="#section-7.2.1-3.1">¶</a>
</li>
            <li class="normal" id="section-7.2.1-3.2">For unroutable destination addresses, send Destination Unreachable (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc4443#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#RFC4443">ICMPv6</a>]</span>) with code 0, "No route to destination", or code 1,
"Communication with destination administratively prohibited".<a class="pilcrow" href="#section-7.2.1-3.2">¶</a>
</li>
            <li class="normal" id="section-7.2.1-3.3">For packets that cannot fit within the MTU of the outgoing link, send Packet
Too Big (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc4443#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC4443">ICMPv6</a>]</span>).<a class="pilcrow" href="#section-7.2.1-3.3">¶</a>
</li>
          </ul>
<p id="section-7.2.1-4">In order to receive these errors, endpoints need to be prepared to receive ICMP
packets. If an endpoint does not send ROUTE_ADVERTISEMENT capsules, such as a
client opening an IP flow through an IP proxy, it <span class="bcp14">SHOULD</span> process proxied ICMP
packets from its peer in order to receive these errors. Note that ICMP messages
can originate from a source address different from that of the IP proxying
peer and also from outside the target if scoping is in use (see <a class="auto internal xref" href="#scope">Section 4.6</a>).<a class="pilcrow" href="#section-7.2.1-4">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-8">
      <h2 id="name-examples">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-examples">Examples</a>
      </h2>
<p id="section-8-1">IP proxying in HTTP enables many different use cases that can benefit from IP
packet proxying and tunnelling. These examples are provided to help illustrate
some of the ways in which IP proxying in HTTP can be used.<a class="pilcrow" href="#section-8-1">¶</a></p>
<div id="example-remote">
<section id="section-8.1">
        <h3 id="name-remote-access-vpn">
<a class="section-number selfRef" href="#section-8.1">8.1. </a><a class="section-name selfRef" href="#name-remote-access-vpn">Remote Access VPN</a>
        </h3>
<p id="section-8.1-1">The following example shows a point-to-network VPN setup, where a client
receives a set of local addresses and can send to any remote host through the
IP proxy. Such VPN setups can be either full-tunnel or split-tunnel.<a class="pilcrow" href="#section-8.1-1">¶</a></p>
<span id="name-vpn-tunnel-setup"></span><div id="diagram-tunnel">
<figure id="figure-14">
          <div id="section-8.1-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.1-2.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" text-anchor="middle" version="1.1" viewBox="0 0 768 128" xmlns="http://www.w3.org/2000/svg">
                <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                <path d="M 80,32 L 80,96" fill="none" stroke="black"></path>
                <path d="M 248,32 L 248,96" fill="none" stroke="black"></path>
                <path d="M 320,32 L 320,96" fill="none" stroke="black"></path>
                <path d="M 416,32 L 416,96" fill="none" stroke="black"></path>
                <path d="M 8,32 L 80,32" fill="none" stroke="black"></path>
                <path d="M 248,32 L 320,32" fill="none" stroke="black"></path>
                <path d="M 416,32 L 448,32" fill="none" stroke="black"></path>
                <path d="M 80,48 L 248,48" fill="none" stroke="black"></path>
                <path d="M 192,64 L 216,64" fill="none" stroke="black"></path>
                <path d="M 320,64 L 448,64" fill="none" stroke="black"></path>
                <path d="M 80,80 L 248,80" fill="none" stroke="black"></path>
                <path d="M 8,96 L 80,96" fill="none" stroke="black"></path>
                <path d="M 248,96 L 320,96" fill="none" stroke="black"></path>
                <path d="M 416,96 L 448,96" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="456,96 444,90.4 444,101.6" transform="rotate(0,448,96)"></polygon>
                <polygon class="arrowhead" fill="black" points="456,64 444,58.4 444,69.6" transform="rotate(0,448,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="456,32 444,26.4 444,37.6" transform="rotate(0,448,32)"></polygon>
                <polygon class="arrowhead" fill="black" points="224,64 212,58.4 212,69.6" transform="rotate(0,216,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="200,64 188,58.4 188,69.6" transform="rotate(180,192,64)"></polygon>
                <g class="text">
                  <text x="100" y="36">IP</text>
                  <text x="120" y="36">A</text>
                  <text x="212" y="36">IP</text>
                  <text x="232" y="36">B</text>
                  <text x="468" y="36">IP</text>
                  <text x="488" y="36">D</text>
                  <text x="284" y="52">IP</text>
                  <text x="340" y="52">IP</text>
                  <text x="360" y="52">C</text>
                  <text x="44" y="68">Client</text>
                  <text x="100" y="68">IP</text>
                  <text x="140" y="68">Subnet</text>
                  <text x="176" y="68">C</text>
                  <text x="232" y="68">?</text>
                  <text x="288" y="68">Proxy</text>
                  <text x="468" y="68">IP</text>
                  <text x="488" y="68">E</text>
                  <text x="468" y="100">IP</text>
                  <text x="496" y="100">...</text>
                </g>
              </svg><a class="pilcrow" href="#section-8.1-2.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-14">Figure 14</a>:
<a class="selfRef" href="#name-vpn-tunnel-setup">VPN Tunnel Setup</a>
          </figcaption></figure>
</div>
<p id="section-8.1-3">In this case, the client does not specify any scope in its request. The IP
proxy assigns the client an IPv4 address (192.0.2.11) and a full-tunnel route
of all IPv4 addresses (0.0.0.0/0). The client can then send to any IPv4 host
using its assigned address as its source address.<a class="pilcrow" href="#section-8.1-3">¶</a></p>
<span id="name-vpn-full-tunnel-example"></span><div id="fig-full-tunnel">
<figure id="figure-15">
          <div class="alignLeft art-text artwork" id="section-8.1-4.1">
<pre>[[ From Client ]]             [[ From IP Proxy ]]

SETTINGS
  H3_DATAGRAM = 1

                              SETTINGS
                                ENABLE_CONNECT_PROTOCOL = 1
                                H3_DATAGRAM = 1

STREAM(44): HEADERS
:method = CONNECT
:protocol = connect-ip
:scheme = https
:path = /vpn
:authority = proxy.example.com
capsule-protocol = ?1

                              STREAM(44): HEADERS
                              :status = 200
                              capsule-protocol = ?1

STREAM(44): DATA
Capsule Type = ADDRESS_REQUEST
(Request ID = 1
 IP Version = 4
 IP Address = 0.0.0.0
 IP Prefix Length = 32)

                              STREAM(44): DATA
                              Capsule Type = ADDRESS_ASSIGN
                              (Request ID = 1
                               IP Version = 4
                               IP Address = 192.0.2.11
                               IP Prefix Length = 32)

                              STREAM(44): DATA
                              Capsule Type = ROUTE_ADVERTISEMENT
                              (IP Version = 4
                               Start IP Address = 0.0.0.0
                               End IP Address = 255.255.255.255
                               IP Protocol = 0) // Any

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated IP Packet

                              DATAGRAM
                              Quarter Stream ID = 11
                              Context ID = 0
                              Payload = Encapsulated IP Packet
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-15">Figure 15</a>:
<a class="selfRef" href="#name-vpn-full-tunnel-example">VPN Full-Tunnel Example</a>
          </figcaption></figure>
</div>
<p id="section-8.1-5">A setup for a split-tunnel VPN (the case where the client can only access a
specific set of private subnets) is quite similar. In this case, the advertised
route is restricted to 192.0.2.0/24, rather than 0.0.0.0/0.<a class="pilcrow" href="#section-8.1-5">¶</a></p>
<span id="name-vpn-split-tunnel-example"></span><div id="fig-split-tunnel">
<figure id="figure-16">
          <div class="alignLeft art-text artwork" id="section-8.1-6.1">
<pre>[[ From Client ]]             [[ From IP Proxy ]]

                              STREAM(44): DATA
                              Capsule Type = ADDRESS_ASSIGN
                              (Request ID = 0
                               IP Version = 4
                               IP Address = 192.0.2.42
                               IP Prefix Length = 32)

                              STREAM(44): DATA
                              Capsule Type = ROUTE_ADVERTISEMENT
                              (IP Version = 4
                               Start IP Address = 192.0.2.0
                               End IP Address = 192.0.2.41
                               IP Protocol = 0) // Any
                              (IP Version = 4
                               Start IP Address = 192.0.2.43
                               End IP Address = 192.0.2.255
                               IP Protocol = 0) // Any
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-16">Figure 16</a>:
<a class="selfRef" href="#name-vpn-split-tunnel-example">VPN Split-Tunnel Example</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="site-to-site-vpn">
<section id="section-8.2">
        <h3 id="name-site-to-site-vpn">
<a class="section-number selfRef" href="#section-8.2">8.2. </a><a class="section-name selfRef" href="#name-site-to-site-vpn">Site-to-Site VPN</a>
        </h3>
<p id="section-8.2-1">The following example shows how to connect a branch office network to a
corporate network such that all machines on those networks can communicate. In
this example, the IP proxying client is attached to the branch office network
192.0.2.0/24, and the IP proxy is attached to the corporate network
203.0.113.0/24. There are legacy clients on the branch office network that only
allow maintenance requests from machines on their subnet, so the IP proxy is
provisioned with an IP address from that subnet.<a class="pilcrow" href="#section-8.2-1">¶</a></p>
<span id="name-site-to-site-vpn-example"></span><div id="diagram-s2s">
<figure id="figure-17">
          <div id="section-8.2-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.2-2.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" text-anchor="middle" version="1.1" viewBox="0 0 700 128" xmlns="http://www.w3.org/2000/svg">
                <path d="M 112,32 L 112,96" fill="none" stroke="black"></path>
                <path d="M 144,32 L 144,96" fill="none" stroke="black"></path>
                <path d="M 216,32 L 216,96" fill="none" stroke="black"></path>
                <path d="M 328,32 L 328,96" fill="none" stroke="black"></path>
                <path d="M 392,32 L 392,96" fill="none" stroke="black"></path>
                <path d="M 424,32 L 424,96" fill="none" stroke="black"></path>
                <path d="M 88,32 L 112,32" fill="none" stroke="black"></path>
                <path d="M 144,32 L 216,32" fill="none" stroke="black"></path>
                <path d="M 328,32 L 392,32" fill="none" stroke="black"></path>
                <path d="M 424,32 L 456,32" fill="none" stroke="black"></path>
                <path d="M 216,48 L 328,48" fill="none" stroke="black"></path>
                <path d="M 88,64 L 144,64" fill="none" stroke="black"></path>
                <path d="M 392,64 L 456,64" fill="none" stroke="black"></path>
                <path d="M 216,80 L 328,80" fill="none" stroke="black"></path>
                <path d="M 88,96 L 112,96" fill="none" stroke="black"></path>
                <path d="M 144,96 L 216,96" fill="none" stroke="black"></path>
                <path d="M 328,96 L 392,96" fill="none" stroke="black"></path>
                <path d="M 424,96 L 456,96" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="464,96 452,90.4 452,101.6" transform="rotate(0,456,96)"></polygon>
                <polygon class="arrowhead" fill="black" points="464,64 452,58.4 452,69.6" transform="rotate(0,456,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="464,32 452,26.4 452,37.6" transform="rotate(0,456,32)"></polygon>
                <polygon class="arrowhead" fill="black" points="96,96 84,90.4 84,101.6" transform="rotate(180,88,96)"></polygon>
                <polygon class="arrowhead" fill="black" points="96,64 84,58.4 84,69.6" transform="rotate(180,88,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="96,32 84,26.4 84,37.6" transform="rotate(180,88,32)"></polygon>
                <g class="text">
                  <text x="40" y="36">192.0.2.1</text>
                  <text x="512" y="36">203.0.113.9</text>
                  <text x="356" y="52">IP</text>
                  <text x="40" y="68">192.0.2.2</text>
                  <text x="180" y="68">Client</text>
                  <text x="236" y="68">IP</text>
                  <text x="284" y="68">Proxying</text>
                  <text x="360" y="68">Proxy</text>
                  <text x="512" y="68">203.0.113.8</text>
                  <text x="40" y="100">192.0.2.3</text>
                  <text x="512" y="100">203.0.113.7</text>
                </g>
              </svg><a class="pilcrow" href="#section-8.2-2.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-17">Figure 17</a>:
<a class="selfRef" href="#name-site-to-site-vpn-example">Site-to-Site VPN Example</a>
          </figcaption></figure>
</div>
<p id="section-8.2-3">In this case, the client does not specify any scope in its request. The IP
proxy assigns the client an IPv4 address (203.0.113.100) and a split-tunnel
route to the corporate network (203.0.113.0/24). The client assigns the IP
proxy an IPv4 address (192.0.2.200) and a split-tunnel route to the branch
office network (192.0.2.0/24). This allows hosts on both networks to
communicate with each other and allows the IP proxy to perform maintenance on
legacy hosts in the branch office. Note that IP proxying endpoints will
decrement the IP Hop Count (or TTL) when encapsulating forwarded packets, so
protocols that require that field be set to 255 will not function.<a class="pilcrow" href="#section-8.2-3">¶</a></p>
<span id="name-site-to-site-vpn-capsule-ex"></span><div id="fig-s2s">
<figure id="figure-18">
          <div class="alignLeft art-text artwork" id="section-8.2-4.1">
<pre>[[ From Client ]]             [[ From IP Proxy ]]

SETTINGS
  H3_DATAGRAM = 1

                              SETTINGS
                                ENABLE_CONNECT_PROTOCOL = 1
                                H3_DATAGRAM = 1

STREAM(44): HEADERS
:method = CONNECT
:protocol = connect-ip
:scheme = https
:path = /corp
:authority = proxy.example.com
capsule-protocol = ?1

                              STREAM(44): HEADERS
                              :status = 200
                              capsule-protocol = ?1

STREAM(44): DATA
Capsule Type = ADDRESS_ASSIGN
(Request ID = 0
IP Version = 4
IP Address = 192.0.2.200
IP Prefix Length = 32)

STREAM(44): DATA
Capsule Type = ROUTE_ADVERTISEMENT
(IP Version = 4
Start IP Address = 192.0.2.0
End IP Address = 192.0.2.255
IP Protocol = 0) // Any

                              STREAM(44): DATA
                              Capsule Type = ADDRESS_ASSIGN
                              (Request ID = 0
                               IP Version = 4
                               IP Address = 203.0.113.100
                               IP Prefix Length = 32)

                              STREAM(44): DATA
                              Capsule Type = ROUTE_ADVERTISEMENT
                              (IP Version = 4
                               Start IP Address = 203.0.113.0
                               End IP Address = 203.0.113.255
                               IP Protocol = 0) // Any

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated IP Packet

                              DATAGRAM
                              Quarter Stream ID = 11
                              Context ID = 0
                              Payload = Encapsulated IP Packet
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-18">Figure 18</a>:
<a class="selfRef" href="#name-site-to-site-vpn-capsule-ex">Site-to-Site VPN Capsule Example</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="ip-flow-forwarding">
<section id="section-8.3">
        <h3 id="name-ip-flow-forwarding">
<a class="section-number selfRef" href="#section-8.3">8.3. </a><a class="section-name selfRef" href="#name-ip-flow-forwarding">IP Flow Forwarding</a>
        </h3>
<p id="section-8.3-1">The following example shows an IP flow forwarding setup, where a client
requests to establish a forwarding tunnel to target.example.com using the Stream Control Transmission Protocol (SCTP) (IP
protocol 132) and receives a single local address and remote address it can
use for transmitting packets. A similar approach could be used for any other IP
protocol that isn't easily proxied with existing HTTP methods, such as ICMP,
Encapsulating Security Payload (ESP), etc.<a class="pilcrow" href="#section-8.3-1">¶</a></p>
<span id="name-proxied-flow-setup"></span><div id="diagram-flow">
<figure id="figure-19">
          <div id="section-8.3-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.3-2.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" text-anchor="middle" version="1.1" viewBox="0 0 660 128" xmlns="http://www.w3.org/2000/svg">
                <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                <path d="M 80,32 L 80,96" fill="none" stroke="black"></path>
                <path d="M 240,32 L 240,96" fill="none" stroke="black"></path>
                <path d="M 312,32 L 312,96" fill="none" stroke="black"></path>
                <path d="M 8,32 L 80,32" fill="none" stroke="black"></path>
                <path d="M 240,32 L 312,32" fill="none" stroke="black"></path>
                <path d="M 80,48 L 240,48" fill="none" stroke="black"></path>
                <path d="M 160,64 L 184,64" fill="none" stroke="black"></path>
                <path d="M 312,64 L 392,64" fill="none" stroke="black"></path>
                <path d="M 80,80 L 240,80" fill="none" stroke="black"></path>
                <path d="M 8,96 L 80,96" fill="none" stroke="black"></path>
                <path d="M 240,96 L 312,96" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="400,64 388,58.4 388,69.6" transform="rotate(0,392,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="192,64 180,58.4 180,69.6" transform="rotate(0,184,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="168,64 156,58.4 156,69.6" transform="rotate(180,160,64)"></polygon>
                <g class="text">
                  <text x="100" y="36">IP</text>
                  <text x="120" y="36">A</text>
                  <text x="204" y="36">IP</text>
                  <text x="224" y="36">B</text>
                  <text x="276" y="52">IP</text>
                  <text x="332" y="52">IP</text>
                  <text x="352" y="52">C</text>
                  <text x="44" y="68">Client</text>
                  <text x="124" y="68">IP</text>
                  <text x="144" y="68">C</text>
                  <text x="200" y="68">D</text>
                  <text x="280" y="68">Proxy</text>
                  <text x="412" y="68">IP</text>
                  <text x="432" y="68">D</text>
                </g>
              </svg><a class="pilcrow" href="#section-8.3-2.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-19">Figure 19</a>:
<a class="selfRef" href="#name-proxied-flow-setup">Proxied Flow Setup</a>
          </figcaption></figure>
</div>
<p id="section-8.3-3">In this case, the client specifies both a target hostname and an Internet Protocol
Number in the scope of its request, indicating that it only needs to
communicate with a single host. The IP proxy is able to perform DNS resolution
on behalf of the client and allocate a specific outbound socket for the client
instead of allocating an entire IP address to the client. In this regard, the
request is similar to a regular CONNECT proxy request.<a class="pilcrow" href="#section-8.3-3">¶</a></p>
<p id="section-8.3-4">The IP proxy assigns a single IPv6 address to the client (2001:db8:1234::a) and
a route to a single IPv6 host (2001:db8:3456::b) scoped to SCTP. The client
can send and receive SCTP IP packets to the remote host.<a class="pilcrow" href="#section-8.3-4">¶</a></p>
<span id="name-proxied-sctp-flow-example"></span><div id="fig-flow">
<figure id="figure-20">
          <div class="alignLeft art-text artwork" id="section-8.3-5.1">
<pre>[[ From Client ]]             [[ From IP Proxy ]]

SETTINGS
  H3_DATAGRAM = 1

                              SETTINGS
                                ENABLE_CONNECT_PROTOCOL = 1
                                H3_DATAGRAM = 1

STREAM(44): HEADERS
:method = CONNECT
:protocol = connect-ip
:scheme = https
:path = /proxy?target=target.example.com&amp;ipproto=132
:authority = proxy.example.com
capsule-protocol = ?1

                              STREAM(44): HEADERS
                              :status = 200
                              capsule-protocol = ?1

                              STREAM(44): DATA
                              Capsule Type = ADDRESS_ASSIGN
                              (Request ID = 0
                               IP Version = 6
                               IP Address = 2001:db8:1234::a
                               IP Prefix Length = 128)

                              STREAM(44): DATA
                              Capsule Type = ROUTE_ADVERTISEMENT
                              (IP Version = 6
                               Start IP Address = 2001:db8:3456::b
                               End IP Address = 2001:db8:3456::b
                               IP Protocol = 132)

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated SCTP/IP Packet

                              DATAGRAM
                              Quarter Stream ID = 11
                              Context ID = 0
                              Payload = Encapsulated SCTP/IP Packet
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-20">Figure 20</a>:
<a class="selfRef" href="#name-proxied-sctp-flow-example">Proxied SCTP Flow Example</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="proxied-connection-racing">
<section id="section-8.4">
        <h3 id="name-proxied-connection-racing">
<a class="section-number selfRef" href="#section-8.4">8.4. </a><a class="section-name selfRef" href="#name-proxied-connection-racing">Proxied Connection Racing</a>
        </h3>
<p id="section-8.4-1">The following example shows a setup where a client is proxying UDP packets
through an IP proxy in order to control connection establishment racing through
an IP proxy, as defined in Happy Eyeballs <span>[<a class="cite xref" href="#RFC8305">HEv2</a>]</span>. This example is a
variant of the proxied flow but highlights how IP-level proxying can enable
new capabilities, even for TCP and UDP.<a class="pilcrow" href="#section-8.4-1">¶</a></p>
<span id="name-proxied-connection-racing-s"></span><div id="diagram-racing">
<figure id="figure-21">
          <div id="section-8.4-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.4-2.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" text-anchor="middle" version="1.1" viewBox="0 0 708 144" xmlns="http://www.w3.org/2000/svg">
                <path d="M 8,32 L 8,112" fill="none" stroke="black"></path>
                <path d="M 80,32 L 80,112" fill="none" stroke="black"></path>
                <path d="M 240,32 L 240,112" fill="none" stroke="black"></path>
                <path d="M 312,32 L 312,112" fill="none" stroke="black"></path>
                <path d="M 8,32 L 80,32" fill="none" stroke="black"></path>
                <path d="M 240,32 L 312,32" fill="none" stroke="black"></path>
                <path d="M 80,48 L 240,48" fill="none" stroke="black"></path>
                <path d="M 320,48 L 424,48" fill="none" stroke="black"></path>
                <path d="M 144,64 L 168,64" fill="none" stroke="black"></path>
                <path d="M 144,80 L 168,80" fill="none" stroke="black"></path>
                <path d="M 80,96 L 240,96" fill="none" stroke="black"></path>
                <path d="M 320,96 L 424,96" fill="none" stroke="black"></path>
                <path d="M 8,112 L 80,112" fill="none" stroke="black"></path>
                <path d="M 240,112 L 312,112" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="432,96 420,90.4 420,101.6" transform="rotate(0,424,96)"></polygon>
                <polygon class="arrowhead" fill="black" points="432,48 420,42.4 420,53.6" transform="rotate(0,424,48)"></polygon>
                <polygon class="arrowhead" fill="black" points="328,96 316,90.4 316,101.6" transform="rotate(180,320,96)"></polygon>
                <polygon class="arrowhead" fill="black" points="328,48 316,42.4 316,53.6" transform="rotate(180,320,48)"></polygon>
                <polygon class="arrowhead" fill="black" points="176,80 164,74.4 164,85.6" transform="rotate(0,168,80)"></polygon>
                <polygon class="arrowhead" fill="black" points="176,64 164,58.4 164,69.6" transform="rotate(0,168,64)"></polygon>
                <polygon class="arrowhead" fill="black" points="152,80 140,74.4 140,85.6" transform="rotate(180,144,80)"></polygon>
                <polygon class="arrowhead" fill="black" points="152,64 140,58.4 140,69.6" transform="rotate(180,144,64)"></polygon>
                <g class="text">
                  <text x="100" y="36">IP</text>
                  <text x="120" y="36">A</text>
                  <text x="204" y="36">IP</text>
                  <text x="224" y="36">B</text>
                  <text x="332" y="36">IP</text>
                  <text x="352" y="36">C</text>
                  <text x="444" y="52">IP</text>
                  <text x="464" y="52">E</text>
                  <text x="44" y="68">Client</text>
                  <text x="108" y="68">IP</text>
                  <text x="128" y="68">C</text>
                  <text x="184" y="68">E</text>
                  <text x="276" y="68">IP</text>
                  <text x="128" y="84">D</text>
                  <text x="184" y="84">F</text>
                  <text x="280" y="84">Proxy</text>
                  <text x="444" y="100">IP</text>
                  <text x="464" y="100">F</text>
                  <text x="332" y="116">IP</text>
                  <text x="352" y="116">D</text>
                </g>
              </svg><a class="pilcrow" href="#section-8.4-2.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-21">Figure 21</a>:
<a class="selfRef" href="#name-proxied-connection-racing-s">Proxied Connection Racing Setup</a>
          </figcaption></figure>
</div>
<p id="section-8.4-3">As with proxied flows, the client specifies both a target hostname and an Internet
Protocol Number in the scope of its request. When the IP proxy performs DNS
resolution on behalf of the client, it can send the various remote address
options to the client as separate routes. It can also ensure that the client
has both IPv4 and IPv6 addresses assigned.<a class="pilcrow" href="#section-8.4-3">¶</a></p>
<p id="section-8.4-4">The IP proxy assigns both an IPv4 address (192.0.2.3) and an IPv6
address (2001:db8:1234::a) to the client, as well as an IPv4 route
(198.51.100.2) and an IPv6 route (2001:db8:3456::b), which represent the
resolved addresses of the target hostname, scoped to UDP. The client can send
and receive UDP IP packets to either one of the IP proxy addresses to enable
Happy Eyeballs through the IP proxy.<a class="pilcrow" href="#section-8.4-4">¶</a></p>
<span id="name-proxied-connection-racing-e"></span><div id="fig-listen">
<figure id="figure-22">
          <div class="alignLeft art-text artwork" id="section-8.4-5.1">
<pre>[[ From Client ]]             [[ From IP Proxy ]]

SETTINGS
  H3_DATAGRAM = 1

                              SETTINGS
                                ENABLE_CONNECT_PROTOCOL = 1
                                H3_DATAGRAM = 1

STREAM(44): HEADERS
:method = CONNECT
:protocol = connect-ip
:scheme = https
:path = /proxy?target=target.example.com&amp;ipproto=17
:authority = proxy.example.com
capsule-protocol = ?1

                              STREAM(44): HEADERS
                              :status = 200
                              capsule-protocol = ?1

                              STREAM(44): DATA
                              Capsule Type = ADDRESS_ASSIGN
                              (Request ID = 0
                               IP Version = 4
                               IP Address = 192.0.2.3
                               IP Prefix Length = 32),
                              (Request ID = 0
                               IP Version = 6
                               IP Address = 2001:db8::1234:1234
                               IP Prefix Length = 128)

                              STREAM(44): DATA
                              Capsule Type = ROUTE_ADVERTISEMENT
                              (IP Version = 4
                               Start IP Address = 198.51.100.2
                               End IP Address = 198.51.100.2
                               IP Protocol = 17),
                              (IP Version = 6
                               Start IP Address = 2001:db8:3456::b
                               End IP Address = 2001:db8:3456::b
                               IP Protocol = 17)
...

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated IPv6 Packet

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated IPv4 Packet

</pre>
</div>
<figcaption><a class="selfRef" href="#figure-22">Figure 22</a>:
<a class="selfRef" href="#name-proxied-connection-racing-e">Proxied Connection Racing Example</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="extensibility-considerations">
<section id="section-9">
      <h2 id="name-extensibility-consideration">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-extensibility-consideration">Extensibility Considerations</a>
      </h2>
<p id="section-9-1">Extensions to IP proxying in HTTP can define behavior changes to this
mechanism. Such extensions <span class="bcp14">SHOULD</span> define new capsule types to exchange
configuration information if needed.  
It is <span class="bcp14">RECOMMENDED</span> for extensions that
modify addressing to specify that their extension capsules be sent before the
ADDRESS_ASSIGN capsule and that they do not take effect until the
ADDRESS_ASSIGN capsule is parsed. This allows modifications to address
assignment to operate atomically. Similarly, extensions that modify routing
<span class="bcp14">SHOULD</span> behave similarly with regard to the ROUTE_ADVERTISEMENT capsule.<a class="pilcrow" href="#section-9-1">¶</a></p>
</section>
</div>
<div id="performance-considerations">
<section id="section-10">
      <h2 id="name-performance-considerations">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-performance-considerations">Performance Considerations</a>
      </h2>
<p id="section-10-1">Bursty traffic can often lead to temporally correlated packet losses; in turn,
this can lead to suboptimal responses from congestion controllers in protocols
running inside the tunnel. To avoid this, IP proxying endpoints <span class="bcp14">SHOULD</span> strive
to avoid increasing burstiness of IP traffic; they <span class="bcp14">SHOULD NOT</span> queue packets in
order to increase batching beyond the minimal amount required to take advantage
of hardware offloads.<a class="pilcrow" href="#section-10-1">¶</a></p>
<p id="section-10-2">When the protocol running inside the tunnel uses congestion control (e.g.,
<span>[<a class="cite xref" href="#RFC9293">TCP</a>]</span> or <span>[<a class="cite xref" href="#RFC9000">QUIC</a>]</span>), the proxied traffic will incur at least two nested
congestion controllers. When tunneled packets are sent using QUIC DATAGRAM
frames, the outer HTTP connection <span class="bcp14">MAY</span> disable congestion control for those
packets that contain only QUIC DATAGRAM frames encapsulating IP packets.
Implementers will benefit from reading the guidance in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8085#section-3.1.11">Section 3.1.11</a> of [<a class="cite xref" href="#RFC8085">UDP-USAGE</a>]</span>.<a class="pilcrow" href="#section-10-2">¶</a></p>
<p id="section-10-3">When the protocol running inside the tunnel uses loss recovery (e.g., <span>[<a class="cite xref" href="#RFC9293">TCP</a>]</span>
or <span>[<a class="cite xref" href="#RFC9000">QUIC</a>]</span>) and the outer HTTP connection runs over TCP, the proxied traffic
will incur at least two nested loss recovery mechanisms. This can reduce
performance, as both can sometimes independently retransmit the same data. To
avoid this, IP proxying <span class="bcp14">SHOULD</span> be performed over HTTP/3 to allow leveraging the
QUIC DATAGRAM frame.<a class="pilcrow" href="#section-10-3">¶</a></p>
<div id="mtu-considerations">
<section id="section-10.1">
        <h3 id="name-mtu-considerations">
<a class="section-number selfRef" href="#section-10.1">10.1. </a><a class="section-name selfRef" href="#name-mtu-considerations">MTU Considerations</a>
        </h3>
<p id="section-10.1-1">When using HTTP/3 with the QUIC Datagram extension <span>[<a class="cite xref" href="#RFC9221">DGRAM</a>]</span>, IP packets are
transmitted in QUIC DATAGRAM frames. Since these frames cannot be fragmented,
they can only carry packets up to a given length determined by the QUIC
connection configuration and the Path MTU (PMTU). If an endpoint is using QUIC
DATAGRAM frames and it attempts to route an IP packet through the tunnel that
will not fit inside a QUIC DATAGRAM frame, the IP proxy <span class="bcp14">SHOULD NOT</span> send the IP
packet in a DATAGRAM capsule, as that defeats the end-to-end unreliability
characteristic that methods such as Datagram Packetization Layer PMTU Discovery
(DPLPMTUD) depend on <span>[<a class="cite xref" href="#RFC8899">DPLPMTUD</a>]</span>. In this scenario, the endpoint
<span class="bcp14">SHOULD</span> drop the IP packet and send an ICMP Packet Too Big message to the sender
of the dropped packet; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc4443#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#RFC4443">ICMPv6</a>]</span>.<a class="pilcrow" href="#section-10.1-1">¶</a></p>
</section>
</div>
<div id="ecn-considerations">
<section id="section-10.2">
        <h3 id="name-ecn-considerations">
<a class="section-number selfRef" href="#section-10.2">10.2. </a><a class="section-name selfRef" href="#name-ecn-considerations">ECN Considerations</a>
        </h3>
<p id="section-10.2-1">If an IP proxying endpoint with a connection containing an IP proxying request
stream disables congestion control, it cannot signal Explicit Congestion
Notification (ECN) <span>[<a class="cite xref" href="#RFC3168">ECN</a>]</span> support on that outer connection. That is,
the QUIC sender <span class="bcp14">MUST</span> mark all IP headers with the Not ECN-Capable Transport (Not-ECT) codepoint for QUIC
packets that are outside of congestion control. The endpoint can still report
ECN feedback via QUIC ACK_ECN frames or the TCP ECN-Echo (ECE) bit, as the peer might not
have disabled congestion control.<a class="pilcrow" href="#section-10.2-1">¶</a></p>
<p id="section-10.2-2">Conversely, if congestion control is not disabled on the outer congestion, the
guidance in <span>[<a class="cite xref" href="#RFC6040">ECN-TUNNEL</a>]</span> about transferring ECN marks between inner
and outer IP headers does not apply because the outer connection will react
correctly to congestion notifications if it uses ECN. The inner traffic can
also use ECN, independently of whether it is in use on the outer connection.<a class="pilcrow" href="#section-10.2-2">¶</a></p>
</section>
</div>
<div id="dscp-considerations">
<section id="section-10.3">
        <h3 id="name-differentiated-services-con">
<a class="section-number selfRef" href="#section-10.3">10.3. </a><a class="section-name selfRef" href="#name-differentiated-services-con">Differentiated Services Considerations</a>
        </h3>
<p id="section-10.3-1">Tunneled IP packets can have Differentiated Services Code Points (DSCPs)
<span>[<a class="cite xref" href="#RFC2474">DSCP</a>]</span> set in the traffic class IP header field to request a
particular per-hop behavior. If an IP proxying endpoint is configured as part
of a Differentiated Services domain, it <span class="bcp14">MAY</span> implement traffic differentiation
based on these markings. However, the use of HTTP can limit the possibilities
for differentiated treatment of the tunneled IP packets on the path between the
IP proxying endpoints.<a class="pilcrow" href="#section-10.3-1">¶</a></p>
<p id="section-10.3-2">When an HTTP connection is congestion-controlled, marking packets with
different DSCPs can lead to reordering between them, and that can in turn lead
the underlying transport connection's congestion controller to perform poorly.
If tunneled packets are subject to congestion control by the outer connection,
they need to avoid carrying DSCP markings that are not equivalent in forwarding
behavior to prevent this situation. In this scenario, the IP proxying endpoint
<span class="bcp14">MUST NOT</span> copy the DSCP field from the inner IP header to the outer IP header of
the packet carrying this packet. Instead, an application would need to use
separate connections to the proxy, one for each DSCP. Note that this document
does not define a way for requests to scope to particular DSCP values; such
support is left to future extensions.<a class="pilcrow" href="#section-10.3-2">¶</a></p>
<p id="section-10.3-3">If tunneled packets use QUIC datagrams and are not subject to congestion
control by the outer connection, the IP proxying endpoints <span class="bcp14">MAY</span> translate the
DSCP field value from the tunneled traffic to the outer IP header. IP proxying
endpoints <span class="bcp14">MUST NOT</span> coalesce multiple inner packets into the same outer packet
unless they have the same DSCP marking or an equivalent traffic class. Note
that the ability to translate DSCP values is dependent on the tunnel ingress
and egress belonging to the same Differentiated Service domain or not.<a class="pilcrow" href="#section-10.3-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-11-1">There are significant risks in allowing arbitrary clients to establish a tunnel
that permits sending to arbitrary hosts, regardless of whether tunnels are
scoped to specific hosts or not. Bad actors could abuse this capability to send
traffic and have it attributed to the IP proxy. HTTP servers that support IP
proxying <span class="bcp14">SHOULD</span> restrict its use to authenticated users. Depending on the
deployment, possible authentication mechanisms include mutual TLS between IP
proxying endpoints, HTTP-based authentication via the HTTP Authorization header
<span>[<a class="cite xref" href="#RFC9110">HTTP</a>]</span>, or even bearer tokens. Proxies can enforce policies for authenticated
users to further constrain client behavior or deal with possible abuse. For
example, proxies can rate limit individual clients that send an excessively
large amount of traffic through the proxy. As another example, proxies can
restrict address (prefix) assignment to clients based on certain client
attributes, such as geographic location.<a class="pilcrow" href="#section-11-1">¶</a></p>
<p id="section-11-2">Address assignment can have privacy implications for endpoints. For example, if
a proxy partitions its address space by the number of authenticated clients and
then assigns distinct address ranges to each client, target hosts could use
this information to determine when IP packets correspond to the same client.
Avoiding such tracking vectors may be important for certain proxy deployments.
Proxies <span class="bcp14">SHOULD</span> avoid persistent per-client address (prefix) assignment when
possible.<a class="pilcrow" href="#section-11-2">¶</a></p>
<p id="section-11-3">Falsifying IP source addresses in sent traffic has been common for denial-of-service 
attacks. Implementations of this mechanism need to ensure that they do
not facilitate such attacks. In particular, there are scenarios where an
endpoint knows that its peer is only allowed to send IP packets from a given
prefix. For example, that can happen through out-of-band configuration
information or when allowed prefixes are shared via ADDRESS_ASSIGN capsules.
In such scenarios, endpoints <span class="bcp14">MUST</span> follow the recommendations from
<span>[<a class="cite xref" href="#RFC2827">BCP38</a>]</span> to prevent source address spoofing.<a class="pilcrow" href="#section-11-3">¶</a></p>
<p id="section-11-4">Limiting request scope (see <a class="auto internal xref" href="#scope">Section 4.6</a>) allows two clients to share one of the
proxy's external IP addresses if their requests are scoped to different Internet
Protocol Numbers. If the proxy receives an ICMP packet destined for that
external IP address, it has the option to forward it back to the clients.
However, some of these ICMP packets carry part of the original IP packet that
triggered the ICMP response. Forwarding such packets can accidentally divulge
information about one client's traffic to another client. To avoid this,
proxies that forward ICMP on shared external IP addresses <span class="bcp14">MUST</span> inspect the
invoking packet included in the ICMP packet and only forward the ICMP packet to
the client whose scoping matches the invoking packet.<a class="pilcrow" href="#section-11-4">¶</a></p>
<p id="section-11-5">Implementers will benefit from reading the guidance in
<span>[<a class="cite xref" href="#RFC6169">TUNNEL-SECURITY</a>]</span>. Since there are known risks with some IPv6
extension headers (e.g., <span>[<a class="cite xref" href="#RFC5095">ROUTING-HDR</a>]</span>), implementers need to follow
the latest guidance regarding handling of IPv6 extension headers.<a class="pilcrow" href="#section-11-5">¶</a></p>
<p id="section-11-6">Transferring DSCP markings from inner to outer packets (see
<a class="auto internal xref" href="#dscp-considerations">Section 10.3</a>) exposes end-to-end flow level information to an
on-path observer between the IP proxying endpoints. This can potentially expose
a single end-to-end flow. Because of this, such use of DSCPs in
privacy-sensitive contexts is <span class="bcp14">NOT RECOMMENDED</span>.<a class="pilcrow" href="#section-11-6">¶</a></p>
<p id="section-11-7">Opportunistic sending of IP packets (see <a class="auto internal xref" href="#link-operation">Section 7.1</a>) is not allowed
in HTTP/1.x because a server could reject the HTTP Upgrade and
attempt to parse the IP packets as a subsequent HTTP request,
allowing request smuggling attacks; see <span>[<a class="cite xref" href="#I-D.schwartz-httpbis-optimistic-upgrade">OPTIMISTIC</a>]</span>.  In particular,
an intermediary that re-encodes a request from HTTP/2 or 3 to
HTTP/1.1 <span class="bcp14">MUST NOT</span> forward any received capsules until it has parsed a
successful IP proxying response.<a class="pilcrow" href="#section-11-7">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-12">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-12">12. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<div id="http-upgrade-token">
<section id="section-12.1">
        <h3 id="name-http-upgrade-token-registra">
<a class="section-number selfRef" href="#section-12.1">12.1. </a><a class="section-name selfRef" href="#name-http-upgrade-token-registra">HTTP Upgrade Token Registration</a>
        </h3>
<p id="section-12.1-1">IANA has registered "connect-ip" in the "HTTP Upgrade
Tokens" registry maintained at
<span>&lt;<a href="https://www.iana.org/assignments/http-upgrade-tokens">https://www.iana.org/assignments/http-upgrade-tokens</a>&gt;</span>.<a class="pilcrow" href="#section-12.1-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-12.1-2">
          <dt id="section-12.1-2.1">Value:</dt>
          <dd id="section-12.1-2.2" style="margin-left: 1.5em">
            <p id="section-12.1-2.2.1">connect-ip<a class="pilcrow" href="#section-12.1-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.1-2.3">Description:</dt>
          <dd id="section-12.1-2.4" style="margin-left: 1.5em">
            <p id="section-12.1-2.4.1">Proxying of IP Payloads<a class="pilcrow" href="#section-12.1-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.1-2.5">Expected Version Tokens:</dt>
          <dd id="section-12.1-2.6" style="margin-left: 1.5em">
            <p id="section-12.1-2.6.1">None<a class="pilcrow" href="#section-12.1-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.1-2.7">References:</dt>
          <dd id="section-12.1-2.8" style="margin-left: 1.5em">
            <p id="section-12.1-2.8.1">RFC 9484<a class="pilcrow" href="#section-12.1-2.8.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-suffix">
<section id="section-12.2">
        <h3 id="name-masque-uri-suffixes-registr">
<a class="section-number selfRef" href="#section-12.2">12.2. </a><a class="section-name selfRef" href="#name-masque-uri-suffixes-registr">MASQUE URI Suffixes Registry Creation</a>
        </h3>
<p id="section-12.2-1">IANA has created the "MASQUE URI Suffixes" registry 
maintained at <span>&lt;<a href="https://www.iana.org/assignments/masque">https://www.iana.org/assignments/masque</a>&gt;</span>. The registration policy is Expert Review; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8126#section-4.5">Section 4.5</a> of [<a class="cite xref" href="#RFC8126">IANA-POLICY</a>]</span>. This new registry governs the path segment that
immediately follows "masque" in paths that start with "/.well-known/masque/";
see <span>&lt;<a href="https://www.iana.org/assignments/well-known-uris">https://www.iana.org/assignments/well-known-uris</a>&gt;</span> for the registration
of "masque" in the "Well-Known URIs" registry.<a class="pilcrow" href="#section-12.2-1">¶</a></p>
<p id="section-12.2-2">This new registry contains three
columns:<a class="pilcrow" href="#section-12.2-2">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-12.2-3">
          <dt id="section-12.2-3.1">Path Segment:</dt>
          <dd id="section-12.2-3.2" style="margin-left: 1.5em">
            <p id="section-12.2-3.2.1">An ASCII string containing only characters allowed in tokens; see
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-5.6.2">Section 5.6.2</a> of [<a class="cite xref" href="#RFC9110">HTTP</a>]</span>. Entries in this registry <span class="bcp14">MUST</span> all have distinct
entries in this column.<a class="pilcrow" href="#section-12.2-3.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.2-3.3">Description:</dt>
          <dd id="section-12.2-3.4" style="margin-left: 1.5em">
            <p id="section-12.2-3.4.1">A description of the entry.<a class="pilcrow" href="#section-12.2-3.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.2-3.5">Reference:</dt>
          <dd id="section-12.2-3.6" style="margin-left: 1.5em">
            <p id="section-12.2-3.6.1">An optional reference defining the use of the entry.<a class="pilcrow" href="#section-12.2-3.6.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-12.2-4">The registry's initial entries are as follows:<a class="pilcrow" href="#section-12.2-4">¶</a></p>
<span id="name-masque-uri-suffixes-registry"></span><div id="iana-suffixes-table">
<table class="center" id="table-1">
          <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-masque-uri-suffixes-registry">MASQUE URI Suffixes Registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Path Segment</th>
              <th class="text-left" colspan="1" rowspan="1">Description</th>
              <th class="text-left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">udp</td>
              <td class="text-left" colspan="1" rowspan="1">UDP Proxying</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9298</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">ip</td>
              <td class="text-left" colspan="1" rowspan="1">IP Proxying</td>
              <td class="text-left" colspan="1" rowspan="1">RFC 9484</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-12.2-6">Designated experts for this registry are advised that they should approve all
requests as long as the expert believes that both (1) the requested Path
Segment will not conflict with existing or expected future IETF work and (2)
the use case is relevant to proxying.<a class="pilcrow" href="#section-12.2-6">¶</a></p>
</section>
</div>
<div id="iana-uri">
<section id="section-12.3">
        <h3 id="name-updates-to-masque-well-know">
<a class="section-number selfRef" href="#section-12.3">12.3. </a><a class="section-name selfRef" href="#name-updates-to-masque-well-know">Updates to masque Well-Known URI Registration</a>
        </h3>
<p id="section-12.3-1">IANA has updated the entry for the "masque"
URI suffix in the "Well-Known URIs" registry maintained at
<span>&lt;<a href="https://www.iana.org/assignments/well-known-uris">https://www.iana.org/assignments/well-known-uris</a>&gt;</span>.<a class="pilcrow" href="#section-12.3-1">¶</a></p>
<p id="section-12.3-2">IANA has updated the "Reference" field to include this
document and has replaced the "Related Information" field with
"For sub-suffix allocations, see the registry at <span>&lt;<a href="https://www.iana.org/assignments/masque">https://www.iana.org/assignments/masque</a>&gt;</span>.".<a class="pilcrow" href="#section-12.3-2">¶</a></p>
</section>
</div>
<div id="iana-types">
<section id="section-12.4">
        <h3 id="name-http-capsule-types-registra">
<a class="section-number selfRef" href="#section-12.4">12.4. </a><a class="section-name selfRef" href="#name-http-capsule-types-registra">HTTP Capsule Types Registrations</a>
        </h3>
<p id="section-12.4-1">IANA has added the following values to the "HTTP Capsule
Types" registry maintained at
<span>&lt;<a href="https://www.iana.org/assignments/masque">https://www.iana.org/assignments/masque</a>&gt;</span>.<a class="pilcrow" href="#section-12.4-1">¶</a></p>
<span id="name-new-capsules"></span><div id="iana-capsules-table">
<table class="center" id="table-2">
          <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-new-capsules">New Capsules</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">Value</th>
              <th class="text-left" colspan="1" rowspan="1">Capsule Type</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">0x01</td>
              <td class="text-left" colspan="1" rowspan="1">ADDRESS_ASSIGN</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">0x02</td>
              <td class="text-left" colspan="1" rowspan="1">ADDRESS_REQUEST</td>
            </tr>
            <tr>
              <td class="text-left" colspan="1" rowspan="1">0x03</td>
              <td class="text-left" colspan="1" rowspan="1">ROUTE_ADVERTISEMENT</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-12.4-3">All of these new entries use the following values for these fields:<a class="pilcrow" href="#section-12.4-3">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-12.4-4">
          <dt id="section-12.4-4.1">Status:</dt>
          <dd id="section-12.4-4.2" style="margin-left: 1.5em">
            <p id="section-12.4-4.2.1">permanent<a class="pilcrow" href="#section-12.4-4.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.4-4.3">Reference:</dt>
          <dd id="section-12.4-4.4" style="margin-left: 1.5em">
            <p id="section-12.4-4.4.1">RFC 9484<a class="pilcrow" href="#section-12.4-4.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.4-4.5">Change Controller:</dt>
          <dd id="section-12.4-4.6" style="margin-left: 1.5em">
            <p id="section-12.4-4.6.1">IETF<a class="pilcrow" href="#section-12.4-4.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.4-4.7">Contact:</dt>
          <dd id="section-12.4-4.8" style="margin-left: 1.5em">
            <p id="section-12.4-4.8.1">masque@ietf.org<a class="pilcrow" href="#section-12.4-4.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-12.4-4.9">Notes:</dt>
          <dd id="section-12.4-4.10" style="margin-left: 1.5em">
            <p id="section-12.4-4.10.1">None<a class="pilcrow" href="#section-12.4-4.10.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-13">13. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-13.1">13.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC5234">[ABNF]</dt>
        <dd>
<span class="refAuthor">Crocker, D., Ed.</span> and <span class="refAuthor">P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">STD 68</span>, <span class="seriesInfo">RFC 5234</span>, <span class="seriesInfo">DOI 10.17487/RFC5234</span>, <time class="refDate" datetime="2008-01">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2827">[BCP38]</dt>
        <dd>
<span class="refAuthor">Ferguson, P.</span> and <span class="refAuthor">D. Senie</span>, <span class="refTitle">"Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing"</span>, <span class="seriesInfo">BCP 38</span>, <span class="seriesInfo">RFC 2827</span>, <span class="seriesInfo">DOI 10.17487/RFC2827</span>, <time class="refDate" datetime="2000-05">May 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2827">https://www.rfc-editor.org/info/rfc2827</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9221">[DGRAM]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Kinnear, E.</span>, and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"An Unreliable Datagram Extension to QUIC"</span>, <span class="seriesInfo">RFC 9221</span>, <span class="seriesInfo">DOI 10.17487/RFC9221</span>, <time class="refDate" datetime="2022-03">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9221">https://www.rfc-editor.org/info/rfc9221</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2474">[DSCP]</dt>
        <dd>
<span class="refAuthor">Nichols, K.</span>, <span class="refAuthor">Blake, S.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"</span>, <span class="seriesInfo">RFC 2474</span>, <span class="seriesInfo">DOI 10.17487/RFC2474</span>, <time class="refDate" datetime="1998-12">December 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2474">https://www.rfc-editor.org/info/rfc2474</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3168">[ECN]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time class="refDate" datetime="2001-09">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3168">https://www.rfc-editor.org/info/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8441">[EXT-CONNECT2]</dt>
        <dd>
<span class="refAuthor">McManus, P.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/2"</span>, <span class="seriesInfo">RFC 8441</span>, <span class="seriesInfo">DOI 10.17487/RFC8441</span>, <time class="refDate" datetime="2018-09">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8441">https://www.rfc-editor.org/info/rfc8441</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9220">[EXT-CONNECT3]</dt>
        <dd>
<span class="refAuthor">Hamilton, R.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/3"</span>, <span class="seriesInfo">RFC 9220</span>, <span class="seriesInfo">DOI 10.17487/RFC9220</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9220">https://www.rfc-editor.org/info/rfc9220</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[HTTP]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9110">https://www.rfc-editor.org/info/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9297">[HTTP-DGRAM]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">L. Pardue</span>, <span class="refTitle">"HTTP Datagrams and the Capsule Protocol"</span>, <span class="seriesInfo">RFC 9297</span>, <span class="seriesInfo">DOI 10.17487/RFC9297</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9297">https://www.rfc-editor.org/info/rfc9297</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9112">[HTTP/1.1]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9112">https://www.rfc-editor.org/info/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9113">[HTTP/2]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9113">https://www.rfc-editor.org/info/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9114">[HTTP/3]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9114">https://www.rfc-editor.org/info/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[IANA-POLICY]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time class="refDate" datetime="2017-06">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC0792">[ICMP]</dt>
        <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Internet Control Message Protocol"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 792</span>, <span class="seriesInfo">DOI 10.17487/RFC0792</span>, <time class="refDate" datetime="1981-09">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc792">https://www.rfc-editor.org/info/rfc792</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4443">[ICMPv6]</dt>
        <dd>
<span class="refAuthor">Conta, A.</span>, <span class="refAuthor">Deering, S.</span>, and <span class="refAuthor">M. Gupta, Ed.</span>, <span class="refTitle">"Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 89</span>, <span class="seriesInfo">RFC 4443</span>, <span class="seriesInfo">DOI 10.17487/RFC4443</span>, <time class="refDate" datetime="2006-03">March 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4443">https://www.rfc-editor.org/info/rfc4443</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[IPv6]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time class="refDate" datetime="2017-07">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6874">[IPv6-ZONE-ID]</dt>
        <dd>
<span class="refAuthor">Carpenter, B.</span>, <span class="refAuthor">Cheshire, S.</span>, and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Representing IPv6 Zone Identifiers in Address Literals and Uniform Resource Identifiers"</span>, <span class="seriesInfo">RFC 6874</span>, <span class="seriesInfo">DOI 10.17487/RFC6874</span>, <time class="refDate" datetime="2013-02">February 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6874">https://www.rfc-editor.org/info/rfc6874</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9209">[PROXY-STATUS]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Sikora</span>, <span class="refTitle">"The Proxy-Status HTTP Response Header Field"</span>, <span class="seriesInfo">RFC 9209</span>, <span class="seriesInfo">DOI 10.17487/RFC9209</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9209">https://www.rfc-editor.org/info/rfc9209</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time class="refDate" datetime="2021-05">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9000">https://www.rfc-editor.org/info/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9293">[TCP]</dt>
        <dd>
<span class="refAuthor">Eddy, W., Ed.</span>, <span class="refTitle">"Transmission Control Protocol (TCP)"</span>, <span class="seriesInfo">STD 7</span>, <span class="seriesInfo">RFC 9293</span>, <span class="seriesInfo">DOI 10.17487/RFC9293</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9293">https://www.rfc-editor.org/info/rfc9293</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6570">[TEMPLATE]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time class="refDate" datetime="2012-03">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6570">https://www.rfc-editor.org/info/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3986">[URI]</dt>
      <dd>
<span class="refAuthor">Berners-Lee, T.</span>, <span class="refAuthor">Fielding, R.</span>, and <span class="refAuthor">L. Masinter</span>, <span class="refTitle">"Uniform Resource Identifier (URI): Generic Syntax"</span>, <span class="seriesInfo">STD 66</span>, <span class="seriesInfo">RFC 3986</span>, <span class="seriesInfo">DOI 10.17487/RFC3986</span>, <time class="refDate" datetime="2005-01">January 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-13.2">13.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC9298">[CONNECT-UDP]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"Proxying UDP in HTTP"</span>, <span class="seriesInfo">RFC 9298</span>, <span class="seriesInfo">DOI 10.17487/RFC9298</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9298">https://www.rfc-editor.org/info/rfc9298</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8899">[DPLPMTUD]</dt>
        <dd>
<span class="refAuthor">Fairhurst, G.</span>, <span class="refAuthor">Jones, T.</span>, <span class="refAuthor">Tüxen, M.</span>, <span class="refAuthor">Rüngeler, I.</span>, and <span class="refAuthor">T. Völker</span>, <span class="refTitle">"Packetization Layer Path MTU Discovery for Datagram Transports"</span>, <span class="seriesInfo">RFC 8899</span>, <span class="seriesInfo">DOI 10.17487/RFC8899</span>, <time class="refDate" datetime="2020-09">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8899">https://www.rfc-editor.org/info/rfc8899</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6040">[ECN-TUNNEL]</dt>
        <dd>
<span class="refAuthor">Briscoe, B.</span>, <span class="refTitle">"Tunnelling of Explicit Congestion Notification"</span>, <span class="seriesInfo">RFC 6040</span>, <span class="seriesInfo">DOI 10.17487/RFC6040</span>, <time class="refDate" datetime="2010-11">November 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6040">https://www.rfc-editor.org/info/rfc6040</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8305">[HEv2]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">T. Pauly</span>, <span class="refTitle">"Happy Eyeballs Version 2: Better Connectivity Using Concurrency"</span>, <span class="seriesInfo">RFC 8305</span>, <span class="seriesInfo">DOI 10.17487/RFC8305</span>, <time class="refDate" datetime="2017-12">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8305">https://www.rfc-editor.org/info/rfc8305</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-PN">[IANA-PN]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Protocol Numbers"</span>, <span>&lt;<a href="https://www.iana.org/assignments/protocol-numbers">https://www.iana.org/assignments/protocol-numbers</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4301">[IPSEC]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span> and <span class="refAuthor">K. Seo</span>, <span class="refTitle">"Security Architecture for the Internet Protocol"</span>, <span class="seriesInfo">RFC 4301</span>, <span class="seriesInfo">DOI 10.17487/RFC4301</span>, <time class="refDate" datetime="2005-12">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4301">https://www.rfc-editor.org/info/rfc4301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4291">[IPv6-ADDR]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"IP Version 6 Addressing Architecture"</span>, <span class="seriesInfo">RFC 4291</span>, <span class="seriesInfo">DOI 10.17487/RFC4291</span>, <time class="refDate" datetime="2006-02">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4291">https://www.rfc-editor.org/info/rfc4291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.schwartz-httpbis-optimistic-upgrade">[OPTIMISTIC]</dt>
        <dd>
<span class="refAuthor">Schwartz, B. M.</span>, <span class="refTitle">"Security Considerations for Optimistic Use of HTTP Upgrade"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-schwartz-httpbis-optimistic-upgrade-00</span>, <time class="refDate" datetime="2023-08-21">21 August 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-schwartz-httpbis-optimistic-upgrade-00">https://datatracker.ietf.org/doc/html/draft-schwartz-httpbis-optimistic-upgrade-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-masque-ip-proxy-reqs">[PROXY-REQS]</dt>
        <dd>
<span class="refAuthor">Chernyakhovsky, A.</span>, <span class="refAuthor">McCall, D.</span>, and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"Requirements for a MASQUE Protocol to Proxy IP Traffic"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-masque-ip-proxy-reqs-03</span>, <time class="refDate" datetime="2021-08-27">27 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-masque-ip-proxy-reqs-03">https://datatracker.ietf.org/doc/html/draft-ietf-masque-ip-proxy-reqs-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5095">[ROUTING-HDR]</dt>
        <dd>
<span class="refAuthor">Abley, J.</span>, <span class="refAuthor">Savola, P.</span>, and <span class="refAuthor">G. Neville-Neil</span>, <span class="refTitle">"Deprecation of Type 0 Routing Headers in IPv6"</span>, <span class="seriesInfo">RFC 5095</span>, <span class="seriesInfo">DOI 10.17487/RFC5095</span>, <time class="refDate" datetime="2007-12">December 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5095">https://www.rfc-editor.org/info/rfc5095</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6169">[TUNNEL-SECURITY]</dt>
        <dd>
<span class="refAuthor">Krishnan, S.</span>, <span class="refAuthor">Thaler, D.</span>, and <span class="refAuthor">J. Hoagland</span>, <span class="refTitle">"Security Concerns with IP Tunneling"</span>, <span class="seriesInfo">RFC 6169</span>, <span class="seriesInfo">DOI 10.17487/RFC6169</span>, <time class="refDate" datetime="2011-04">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6169">https://www.rfc-editor.org/info/rfc6169</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8085">[UDP-USAGE]</dt>
      <dd>
<span class="refAuthor">Eggert, L.</span>, <span class="refAuthor">Fairhurst, G.</span>, and <span class="refAuthor">G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time class="refDate" datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">The design of this method was inspired by discussions in the MASQUE Working
Group around <span>[<a class="cite xref" href="#I-D.ietf-masque-ip-proxy-reqs">PROXY-REQS</a>]</span>. The authors would
like to thank participants in those discussions for their feedback.
Additionally, <span class="contact-name">Mike Bishop</span>, <span class="contact-name">Lucas Pardue</span>, and <span class="contact-name">Alejandro Sedeño</span>
provided valuable feedback on the document.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<p id="appendix-A-2">Most of the text on client configuration is based on the corresponding text in
<span>[<a class="cite xref" href="#RFC9298">CONNECT-UDP</a>]</span>.<a class="pilcrow" href="#appendix-A-2">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Tommy Pauly (<span class="role">editor</span>)</span></div>
<div class="left" dir="auto"><span class="org">Apple Inc.</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:tpauly@apple.com">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">David Schinazi</span></div>
<div class="left" dir="auto"><span class="org">Google LLC</span></div>
<div class="left" dir="auto"><span class="street-address">1600 Amphitheatre Parkway</span></div>
<div class="left" dir="auto">
<span class="locality">Mountain View</span>, <span class="region">CA</span> <span class="postal-code">94043</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:dschinazi.ietf@gmail.com">dschinazi.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Alex Chernyakhovsky</span></div>
<div class="left" dir="auto"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:achernya@google.com">achernya@google.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mirja Kühlewind</span></div>
<div class="left" dir="auto"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mirja.kuehlewind@ericsson.com">mirja.kuehlewind@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Magnus Westerlund</span></div>
<div class="left" dir="auto"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:magnus.westerlund@ericsson.com">magnus.westerlund@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>