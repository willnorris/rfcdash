<html><head></head><body><pre>Independent Submission                                        N. Leymann
Request for Comments: 8157                                  C. Heidemann
Category: Informational                              Deutsche Telekom AG
ISSN: 2070-1721                                                 M. Zhang
                                                             B. Sarikaya
                                                                  Huawei
                                                               M. Cullen
                                                       Painless Security
                                                                May 2017


                  <span class="h1">Huawei's GRE Tunnel Bonding Protocol</span>

Abstract

   There is an emerging demand for solutions that provide redundancy and
   load-sharing across wired and cellular links from a single Service
   Provider, so that a single subscriber is provided with bonded access
   to heterogeneous connections at the same time.

   In this document, GRE (Generic Routing Encapsulation) Tunnel Bonding
   is specified as an enabling approach for bonded access to a wired and
   a wireless network in customer premises, e.g., homes.  In GRE Tunnel
   Bonding, two GRE tunnels, one per network connection, are set up and
   bonded together to form a single GRE tunnel for a subscriber.
   Compared with each subconnection, the bonded connections promise
   increased access capacity and improved reliability.  The solution
   described in this document is currently implemented by Huawei and
   deployed by Deutsche Telekom AG.  This document will enable other
   developers to build interoperable implementations.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This is a contribution to the RFC Series, independently of any other
   RFC stream.  The RFC Editor has chosen to publish this document at
   its discretion and makes no statement about its value for
   implementation or deployment.  Documents approved for publication by
   the RFC Editor are not a candidate for any level of Internet
   Standard; see <a href="./rfc7841#section-2">SectionÂ 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc8157">http://www.rfc-editor.org/info/rfc8157</a>.





<span class="grey">Leymann, et al.               Informational                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Acronyms and Terminology ........................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Use Case ........................................................<a href="#page-6">6</a>
   <a href="#section-4">4</a>. Overview ........................................................<a href="#page-7">7</a>
      <a href="#section-4.1">4.1</a>. Control Plane ..............................................<a href="#page-7">7</a>
      <a href="#section-4.2">4.2</a>. Data Plane .................................................<a href="#page-7">7</a>
      <a href="#section-4.3">4.3</a>. Traffic Classification and Distribution ....................<a href="#page-8">8</a>
      <a href="#section-4.4">4.4</a>. Traffic Recombination ......................................<a href="#page-8">8</a>
      <a href="#section-4.5">4.5</a>. Bypass .....................................................<a href="#page-9">9</a>
      <a href="#section-4.6">4.6</a>. Measurement ................................................<a href="#page-9">9</a>
      <a href="#section-4.7">4.7</a>. Policy Control Considerations ..............................<a href="#page-9">9</a>
   <a href="#section-5">5</a>. Control Protocol Specification (Control Plane) .................<a href="#page-10">10</a>
      <a href="#section-5.1">5.1</a>. GRE Tunnel Setup Request ..................................<a href="#page-12">12</a>
           <a href="#section-5.1.1">5.1.1</a>. Client Identification Name .........................<a href="#page-12">12</a>
           <a href="#section-5.1.2">5.1.2</a>. Session ID .........................................<a href="#page-13">13</a>
           <a href="#section-5.1.3">5.1.3</a>. DSL Synchronization Rate ...........................<a href="#page-14">14</a>
      <a href="#section-5.2">5.2</a>. GRE Tunnel Setup Accept ...................................<a href="#page-14">14</a>
           <a href="#section-5.2.1">5.2.1</a>. H IPv4 Address .....................................<a href="#page-15">15</a>
           <a href="#section-5.2.2">5.2.2</a>. H IPv6 Address .....................................<a href="#page-15">15</a>
           <a href="#section-5.2.3">5.2.3</a>. Session ID .........................................<a href="#page-16">16</a>
           <a href="#section-5.2.4">5.2.4</a>. RTT Difference Threshold ...........................<a href="#page-16">16</a>
           <a href="#section-5.2.5">5.2.5</a>. Bypass Bandwidth Check Interval ....................<a href="#page-17">17</a>
           <a href="#section-5.2.6">5.2.6</a>. Active Hello Interval ..............................<a href="#page-17">17</a>
           <a href="#section-5.2.7">5.2.7</a>. Hello Retry Times ..................................<a href="#page-18">18</a>
           <a href="#section-5.2.8">5.2.8</a>. Idle Timeout .......................................<a href="#page-18">18</a>
           <a href="#section-5.2.9">5.2.9</a>. Bonding Key Value ..................................<a href="#page-19">19</a>
           <a href="#section-5.2.10">5.2.10</a>. Configured DSL Upstream Bandwidth .................<a href="#page-20">20</a>
           <a href="#section-5.2.11">5.2.11</a>. Configured DSL Downstream Bandwidth ...............<a href="#page-21">21</a>
           <a href="#section-5.2.12">5.2.12</a>. RTT Difference Threshold Violation ................<a href="#page-21">21</a>
           <a href="#section-5.2.13">5.2.13</a>. RTT Difference Threshold Compliance ...............<a href="#page-22">22</a>
           <a href="#section-5.2.14">5.2.14</a>. Idle Hello Interval ...............................<a href="#page-23">23</a>
           <a href="#section-5.2.15">5.2.15</a>. No Traffic Monitored Interval .....................<a href="#page-23">23</a>





<span class="grey">Leymann, et al.               Informational                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


      <a href="#section-5.3">5.3</a>. GRE Tunnel Setup Deny .....................................<a href="#page-24">24</a>
           <a href="#section-5.3.1">5.3.1</a>. Error Code .........................................<a href="#page-24">24</a>
      <a href="#section-5.4">5.4</a>. GRE Tunnel Hello ..........................................<a href="#page-25">25</a>
           <a href="#section-5.4.1">5.4.1</a>. Timestamp ..........................................<a href="#page-25">25</a>
           <a href="#section-5.4.2">5.4.2</a>. IPv6 Prefix Assigned by HAAP .......................<a href="#page-26">26</a>
      <a href="#section-5.5">5.5</a>. GRE Tunnel Tear Down ......................................<a href="#page-26">26</a>
      <a href="#section-5.6">5.6</a>. GRE Tunnel Notify .........................................<a href="#page-27">27</a>
           <a href="#section-5.6.1">5.6.1</a>. Bypass Traffic Rate ................................<a href="#page-27">27</a>
           <a href="#section-5.6.2">5.6.2</a>. Filter List Package ................................<a href="#page-28">28</a>
           <a href="#section-5.6.3">5.6.3</a>. Switching to DSL Tunnel ............................<a href="#page-31">31</a>
           <a href="#section-5.6.4">5.6.4</a>. Overflowing to LTE Tunnel ..........................<a href="#page-31">31</a>
           <a href="#section-5.6.5">5.6.5</a>. DSL Link Failure ...................................<a href="#page-32">32</a>
           <a href="#section-5.6.6">5.6.6</a>. LTE Link Failure ...................................<a href="#page-32">32</a>
           <a href="#section-5.6.7">5.6.7</a>. IPv6 Prefix Assigned to Host .......................<a href="#page-33">33</a>
           <a href="#section-5.6.8">5.6.8</a>. Diagnostic Start: Bonding Tunnel ...................<a href="#page-33">33</a>
           <a href="#section-5.6.9">5.6.9</a>. Diagnostic Start: DSL Tunnel .......................<a href="#page-34">34</a>
           <a href="#section-5.6.10">5.6.10</a>. Diagnostic Start: LTE Tunnel ......................<a href="#page-34">34</a>
           <a href="#section-5.6.11">5.6.11</a>. Diagnostic End ....................................<a href="#page-35">35</a>
           <a href="#section-5.6.12">5.6.12</a>. Filter List Package ACK ...........................<a href="#page-35">35</a>
           <a href="#section-5.6.13">5.6.13</a>. Switching to Active Hello State ...................<a href="#page-36">36</a>
           <a href="#section-5.6.14">5.6.14</a>. Switching to Idle Hello State .....................<a href="#page-37">37</a>
           <a href="#section-5.6.15">5.6.15</a>. Tunnel Verification ...............................<a href="#page-37">37</a>
   <a href="#section-6">6</a>. Tunnel Protocol Operation (Data Plane) .........................<a href="#page-38">38</a>
      <a href="#section-6.1">6.1</a>. The GRE Header ............................................<a href="#page-38">38</a>
      <a href="#section-6.2">6.2</a>. Automatic Setup of GRE Tunnels ............................<a href="#page-39">39</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-41">41</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-41">41</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-41">41</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-41">41</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-42">42</a>
   Contributors ......................................................<a href="#page-43">43</a>
   Authors' Addresses ................................................<a href="#page-44">44</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Service Providers used to provide subscribers with separate access to
   their fixed networks and mobile networks.  It has become desirable to
   bond these heterogeneous networks together to offer access service to
   subscribers; this service will provide increased access capacity and
   improved reliability.

   This document focuses on the use case where a DSL (Digital Subscriber
   Line) connection and an LTE (Long Term Evolution) connection are
   bonded together.  When the traffic volume exceeds the bandwidth of
   the DSL connection, the excess amount can be offloaded to the LTE
   connection.  A Home Gateway (HG) is a Customer Premises Equipment
   (CPE) device initiating the DSL and LTE connections.  A Hybrid Access
   Aggregation Point (HAAP) is the network function that resides in the



<span class="grey">Leymann, et al.               Informational                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   provider's networks to terminate these bonded connections.  Note that
   if there were more than two connections that need to be bonded, the
   GRE Tunnel Bonding mechanism could support that scenario as well.
   However, support for more than two connections is out of scope for
   this document.  Also, the protocol specified in this document is
   limited to the single-operator scenario only, i.e., the two peering
   boxes -- the HG and the HAAP -- are operated by a single provider.
   The adaptation of the GRE Tunnel Bonding Protocol to the
   multi-provider scenario is left for future work.

   This document bases the solution on GRE (Generic Routing
   Encapsulation [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>] [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>]), since GRE is widely supported in
   both fixed and mobile networks.  Approaches specified in this
   document might also be used by other tunneling technologies to
   achieve tunnel bonding.  However, such variants are out of scope for
   this document.

   For each heterogeneous connection (DSL and LTE) between the HG and
   the HAAP, one GRE tunnel is set up.  The HG and the HAAP,
   respectively, serve as the common termination point of the two
   tunnels at both ends.  Those GRE tunnels are further bonded together
   to form a logical GRE tunnel for the subscriber.  The HG conceals the
   GRE tunnels from the end nodes, and end nodes simply treat the
   logical GRE tunnel as a single IP link.  This provides an overlay:
   the users' IP packets (inner IP) are encapsulated in GRE, which is in
   turn carried over IP (outer IP).

   The GRE Tunnel Bonding Protocol is developed by Huawei and has been
   deployed in networks operated by Deutsche Telekom AG.  This document
   makes this protocol available to the public, thereby enabling other
   developers to build interoperable implementations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Acronyms%20and%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Acronyms and Terminology</span>

   GRE: Generic Routing Encapsulation [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>] [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>].

   DSL: Digital Subscriber Line.  A family of technologies used to
      transmit digital data over telephone lines.

   LTE: Long Term Evolution.  A standard for wireless communication of
      high-speed data for mobile phones and data terminals.  Commonly
      marketed as 4G LTE.

   HG: Home Gateway.  A CPE device that is enhanced to support the
      simultaneous use of both fixed broadband and 3GPP access
      connections.





<span class="grey">Leymann, et al.               Informational                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   HAAP: Hybrid Access Aggregation Point.  A logical function in an
      operator's network, terminating bonded connections while offering
      high-speed Internet.

   CIR: Committed Information Rate [<a href="./rfc2697" title='"A Single Rate Three Color Marker"'>RFC2697</a>].

   RTT: Round-Trip Time.

   AAA: Authentication, Authorization, and Accounting [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>].

   SOAP: Simple Object Access Protocol.  A protocol specification for
      exchanging structured information in the implementation of web
      services in computer networks.

   FQDN: Fully Qualified Domain Name.  Generally, a host name with at
      least one domain label under the top-level domain.  For example,
      "dhcp.example.org" is an FQDN [<a href="./rfc7031" title='"DHCPv6 Failover Requirements"'>RFC7031</a>].

   DSCP: The 6-bit codepoint (DSCP) of the Differentiated Services field
      (DS field) in the IPv4 and IPv6 headers [<a href="./rfc2724" title='"RTFM: New Attributes for Traffic Flow Measurement"'>RFC2724</a>].

   BRAS: Broadband Remote Access Server.  Routes traffic to and from
      broadband remote access devices such as Digital Subscriber Line
      Access Multiplexers (DSLAMs) on an Internet Service Provider's
      (ISP's) network.

   PGW: Packet Data Network Gateway.  In the Long Term Evolution (LTE)
      architecture for the Evolved Packet Core (EPC), acts as an anchor
      for user-plane mobility.

   PDP: Packet Data Protocol.  A packet transfer protocol used in
      wireless GPRS (General Packet Radio Service) / HSDPA (High-Speed
      Downlink Packet Access) networks.

   PPPoE: Point-to-Point over Ethernet.  A network protocol for
      encapsulating PPP frames inside Ethernet frames.

   DNS: Domain Name System.  A hierarchical distributed naming system
      for computers, services, or any resource connected to the Internet
      or a private network.

   DHCP: Dynamic Host Configuration Protocol.  A standardized network
      protocol used on Internet Protocol (IP) networks for dynamically
      distributing network configuration parameters, such as IP
      addresses for interfaces and services.






<span class="grey">Leymann, et al.               Informational                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="./rfc2119">RFC 2119</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Use%20Case"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Use Case</span>

                           Bonding Connection
                  +-+ ****************************
                  | | *+-+                    +-+*
                  | | *|E+-- LTE Connection --+ |*
       subscriber |C| *+-+                    |H|*  Internet
                  | | *+-+                    | |*
                  | | *|D+-- DSL Connection --+ |*
                  | | *+-+                    +-+*
                  +-+ ****************************
                  \______/                    \__/
                     HG                       HAAP

       C: The service endpoint of the bonding service at the HG.
       E: The endpoint of the LTE connection resides in the HG.
       D: The endpoint of the DSL connection resides in the HG.
       H: The endpoint for each heterogeneous connection at the HAAP.

      Figure 1: Offloading from DSL to LTE, Increased Access Capacity

   If a Service Provider runs heterogeneous networks, such as fixed and
   mobile, subscribers might be eager to use those networks
   simultaneously for increased access capacity rather than just using a
   single network.  As shown by the reference model in Figure 1, the
   subscriber expects a significantly higher access bandwidth from the
   bonding connection than from the DSL connection.  In other words,
   when the traffic volume exceeds the bandwidth of the DSL connection,
   the excess amount may be offloaded to the LTE connection.

   Compared to per-flow load-balancing mechanisms, which are widely used
   nowadays, the use case described in this document requires a
   per-packet offloading approach.  For per-flow load balancing, the
   maximum bandwidth that may be used by a traffic flow is the bandwidth
   of an individual connection, while for per-packet offloading, a
   single flow may use the combined bandwidth of the two connections.











<span class="grey">Leymann, et al.               Informational                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Overview"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Overview</span>

   In this document, the widely supported GRE is chosen as the tunneling
   technique.  With the newly defined control protocol, GRE tunnels are
   set up on top of the DSL and LTE connections, which are ended at
   D and H or at E and H, as shown in Figure 1.  These tunnels are
   bonded together to form a single logical bonding connection between
   the HG and the HAAP.  Subscribers use this logical connection without
   knowing the GRE tunnels.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Control%20Plane"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Control Plane</span>

   A clean-slate control protocol is designed to manage the GRE tunnels
   that are set up per heterogeneous connection between the HG and the
   HAAP.  The goal is to design a compact control plane for bonding
   access instead of reusing existing control planes.

   In order to measure the performance of connections, control packets
   need to co-route the same path with data packets.  Therefore, a
   GRE Channel is opened for the purpose of data-plane forwarding of
   control-plane packets.  As shown in Figure 2 (see <a href="#section-5">Section 5</a>), the GRE
   header [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>] with the Key extension specified by [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>] is
   being used.  The GRE Protocol Type (0xB7EA) is used to identify this
   GRE Channel.  A family of control messages is encapsulated with a GRE
   header and carried over this channel.  Attributes, formatted in
   Type-Length-Value (TLV) style, are further defined and included in
   each control message.

   With the newly defined control plane, the GRE tunnels between the HG
   and the HAAP can be established, managed, and released without the
   involvement of operators.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Data%20Plane"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Data Plane</span>

   Using the control plane defined in <a href="#section-4.1">Section 4.1</a>, GRE tunnels can be
   automatically set up per heterogeneous connection between the HG and
   the HAAP.  For the use case described in <a href="#section-3">Section 3</a>, one GRE tunnel is
   ended at the DSL WAN interfaces, e.g., the DSL GRE tunnel, and
   another GRE tunnel is ended at the LTE WAN interfaces, e.g., the LTE
   GRE tunnel.  Each tunnel may carry a user's IP packets as payload,
   which forms a typical IP-over-IP overlay.  These tunnels are bonded
   together to offer a single access point to subscribers.

   As shown in Figure 3 (see <a href="#section-6.1">Section 6.1</a>), the GRE header [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>] with
   the Key and Sequence Number extensions specified by [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>] is used
   to encapsulate data packets.  The Protocol Type is either 0x0800
   (listed as "0x800" in [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>]) or 0x86DD [<a href="./rfc7676" title='"IPv6 Support for Generic Routing Encapsulation (GRE)"'>RFC7676</a>], which indicates
   that the inner packet is either an IPv4 packet or an IPv6 packet,



<span class="grey">Leymann, et al.               Informational                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   respectively.  The GRE Key field is set to a unique value for the
   entire bonding connection.  The GRE Sequence Number field is used to
   maintain the sequence of packets transported in all GRE tunnels as a
   single flow between the HG and the HAAP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20Traffic%20Classification%20and%20Distribution"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  Traffic Classification and Distribution</span>

   For the offloading use case, the coloring mechanism specified in
   [<a href="./rfc2697" title='"A Single Rate Three Color Marker"'>RFC2697</a>] is being used to classify subscribers' IP packets, both
   upstream and downstream, into the DSL GRE tunnel or the LTE GRE
   tunnel.  Packets colored as green or yellow will be distributed into
   the DSL GRE tunnel, and packets colored as red will be distributed
   into the LTE GRE tunnel.  For the scenario that requires more than
   two GRE tunnels, multiple levels of token buckets might be realized.
   However, that scenario is out of scope for this document.

   The Committed Information Rate (CIR) of the coloring mechanism is set
   to the total DSL WAN bandwidth minus the bypass DSL bandwidth (see
   <a href="#section-4.5">Section 4.5</a>).  The total DSL WAN bandwidth MAY be configured, MAY be
   obtained from the management system (AAA server, SOAP server, etc.),
   or MAY be detected in real time using the Access Node Control
   Protocol (ANCP) [<a href="./rfc6320" title='"Protocol for Access Node Control Mechanism in Broadband Networks"'>RFC6320</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.4.%20%20Traffic%20Recombination"></a><a class="selflink" href="#section-4.4" id="section-4.4">4.4</a>.  Traffic Recombination</span>

   For the offloading use case, the recombination function at the
   receiver provides in-order delivery of subscribers' traffic.  The
   receiver maintains a small reordering buffer and orders the data
   packets in this buffer via the Sequence Number field [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>] of the
   GRE header.  All packets carried on GRE tunnels that belong to the
   same bonding connection go into a single reordering buffer.

   Operators may configure the maximum allowed size (see
   MAX_PERFLOW_BUFFER in [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>]) of the buffer for reordering.  They
   may also configure the maximum time (see OUTOFORDER_TIMER in
   [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>]) that a packet can stay in the buffer for reordering.  The
   OUTOFORDER_TIMER must be configured carefully.  Values larger than
   the difference of the normal Round-Trip Time (RTT) (e.g., 100 ms) of
   the two connections are not recommended.  Implementation and
   deployment experiences have demonstrated that there is usually a
   large margin for the value of MAX_PERFLOW_BUFFER.  Values larger than
   the multiplication of the sum of the line rate of the two connections
   and the value of OUTOFORDER_TIMER should be used.








<span class="grey">Leymann, et al.               Informational                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.5.%20%20Bypass"></a><a class="selflink" href="#section-4.5" id="section-4.5">4.5</a>.  Bypass</span>

   Service Providers provide some services that should not be delivered
   over the bonding connection.  For example, Service Providers may not
   expect real-time IPTV to be carried by the LTE GRE tunnel.  It is
   required that IPTV traffic bypass the GRE Tunnel Bonding and use the
   raw DSL bandwidth.  Bypass traffic is not subject to the traffic
   classification and distribution specified above.  The raw connection
   used for bypass traffic is not controlled by the HAAP.  It may or may
   not go through a device in which the HAAP resides.

   The HAAP may announce the service types that need to bypass the
   bonded GRE tunnels by using the Filter List Package attribute as
   specified in <a href="#section-5.6.2">Section 5.6.2</a>.  The HG and the HAAP need to set aside
   the DSL bandwidth for bypassing.  The available DSL bandwidth for GRE
   Tunnel Bonding is equal to the total DSL bandwidth minus the bypass
   bandwidth.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.6.%20%20Measurement"></a><a class="selflink" href="#section-4.6" id="section-4.6">4.6</a>.  Measurement</span>

   Since control packets are routed using the same paths as the data
   packets, the real performance of the data paths (e.g., the GRE
   tunnels) can be measured.  The GRE Tunnel Hello messages specified in
   <a href="#section-5.4">Section 5.4</a> are used to carry the timestamp information, and the RTT
   value can therefore be calculated based on the timestamp.

   Besides the end-to-end delay of the GRE tunnels, the HG and the HAAP
   need to measure the capacity of the tunnels as well.  For example,
   the HG is REQUIRED to measure the downstream bypassing bandwidth and
   report it to the HAAP in real time (see <a href="#section-5.6.1">Section 5.6.1</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.7.%20%20Policy%20Control%20Considerations"></a><a class="selflink" href="#section-4.7" id="section-4.7">4.7</a>.  Policy Control Considerations</span>

   Operators and users may input policies into the GRE Tunnel Bonding.
   These policies will be "interpreted" into parameters or actions that
   impact the traffic classification, distribution, combination,
   measurement, and bypass.

   Operators and users may offer the service types that need to bypass
   the bonded GRE tunnels.  Service types defined by operators (see
   <a href="#section-5.6.2">Section 5.6.2</a>) will be delivered from the HAAP to the HG through the
   control plane (see <a href="#section-4.1">Section 4.1</a>), and the HG will use the raw
   connection to transmit traffic for these service types.  Users may
   also define bypass service types on the HG.  Bypass service types
   defined by users need not be delivered to the HAAP.






<span class="grey">Leymann, et al.               Informational                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Operators may specify the interval for sending Hello messages and the
   retry times for the HG or the HAAP to send out Hello messages before
   the failure of a connection.

   Since the GRE tunnels are set up on top of heterogeneous DSL and LTE
   connections, if the difference of the transmission delays of these
   connections exceeds a given threshold for a certain period, the HG
   and the HAAP should be able to stop the offloading behavior and
   fall back to a traditional transmission mode, where the LTE GRE
   tunnel is disused while all traffic is transmitted over the DSL GRE
   tunnel.  Operators are allowed to define this threshold and period.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Control%20Protocol%20Specification%20%28Control%20Plane%29"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Control Protocol Specification (Control Plane)</span>

   Control messages are used to establish, maintain, measure, and
   tear down GRE tunnels between the HG and the HAAP.  Also, the control
   plane undertakes the responsibility to convey traffic policies over
   the GRE tunnels.

   For the purpose of measurement, control messages need to be delivered
   as GRE encapsulated packets and co-routed with data-plane packets.
   The new GRE Protocol Type (0xB7EA) is allocated for this purpose, and
   the standard GRE header as per [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>] with the Key extension
   specified by [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>] is used.  The Checksum Present bit is set
   to 0.  The Key Present bit is set to 1.  The Sequence Number Present
   bit is set to 0.  So, the format of the GRE header for control
   messages of the GRE Tunnel Bonding Protocol is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0| |1|0| Reserved0       | Ver |   Protocol Type 0xB7EA        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Key                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Key
      For security purposes, the Key field is used to carry a random
      number.  The random number is generated by the HAAP, and the HG is
      informed of it (see <a href="#section-5.2.9">Section 5.2.9</a>).











<span class="grey">Leymann, et al.               Informational                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   The general format of the entire control message is as follows:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0| |1|0|   Reserved0     | Ver |   Protocol Type 0xB7EA        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                              Key                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |MsgType|T-Type |                                               |
    +-+-+-+-+-+-+-+-+           Attributes                          +
    ~                                                               ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Figure 2: Format of Control Messages of GRE Tunnel Bonding

   MsgType (4 bits)
      Message Type.  The control message family contains the following
      six types of control messages (not including "Reserved"):

                 Control Message Family         Type
                ==========================    =========
                 GRE Tunnel Setup Request       1
                 GRE Tunnel Setup Accept        2
                 GRE Tunnel Setup Deny          3
                 GRE Tunnel Hello               4
                 GRE Tunnel Tear Down           5
                 GRE Tunnel Notify              6
                 Reserved                       0, 7-15

   T-Type (4 bits)
      Tunnel Type.  Set to 0001 if the control message is sent via the
      primary GRE tunnel (normally the DSL GRE tunnel).  Set to 0010 if
      the control message is sent via the secondary GRE tunnel (normally
      the LTE GRE tunnel).  Values 0000 and values from 0011 through
      1111 are reserved for future use and MUST be ignored on receipt.















<span class="grey">Leymann, et al.               Informational                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attributes
      The Attributes field includes the attributes that need to be
      carried in the control message.  Each Attribute has the following
      format:

      +-+-+-+-+-+-+-+-+
      |Attribute Type |                  (1 byte)
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Attribute Length             |  (2 bytes)
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Attribute Value              ~  (variable)
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Attribute Type
         The Attribute Type specifies the type of the attribute.

      Attribute Length
         Attribute Length indicates the length of the Attribute Value
         in bytes.

      Attribute Value
         The Attribute Value includes the value of the attribute.

   All control messages are sent in network byte order (high-order bytes
   first).  The Protocol Type carried in the GRE header for the control
   message is 0xB7EA.  Based on this number, the receiver will decide to
   consume the GRE packet locally rather than forward it further.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20GRE%20Tunnel%20Setup%20Request"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  GRE Tunnel Setup Request</span>

   The HG uses the GRE Tunnel Setup Request message to request that the
   HAAP establish the GRE tunnels.  It is sent out from the HG's LTE and
   DSL WAN interfaces separately.  Attributes that need to be included
   in this message are defined in the following subsections.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.1.%20%20Client%20Identification%20Name"></a><a class="selflink" href="#section-5.1.1" id="section-5.1.1">5.1.1</a>.  Client Identification Name</span>

   An operator uses the Client Identification Name (CIN) to identify the
   HG.  The HG sends the CIN to the HAAP for authentication and
   authorization as specified in [<a href="#ref-TS23.401" title='"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access"'>TS23.401</a>].  It is REQUIRED that the
   GRE Tunnel Setup Request message sent out from the LTE WAN interface
   contain the CIN attribute while the GRE Tunnel Setup Request message
   sent out from the DSL WAN interface does not contain this attribute.








<span class="grey">Leymann, et al.               Informational                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   The CIN attribute has the following format:

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Client Identification Name       (40 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      CIN, set to 3.

   Attribute Length
      Set to 40.

   Client Identification Name
      This is a 40-byte string value encoded in UTF-8 and set by the
      operator.  It is used as the identification of the HG in the
      operator's network.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.2.%20%20Session%20ID"></a><a class="selflink" href="#section-5.1.2" id="section-5.1.2">5.1.2</a>.  Session ID</span>

   This Session ID is generated by the HAAP when the LTE GRE Tunnel
   Setup Request message is received.  The HAAP announces the Session ID
   to the HG in the LTE GRE Tunnel Setup Accept message.  For those WAN
   interfaces that need to be bonded together, the HG MUST use the same
   Session ID.  The HG MUST carry the Session ID attribute in each DSL
   GRE Tunnel Setup Request message.  For the first time that the LTE
   GRE Tunnel Setup Request message is sent to the HAAP, the Session ID
   attribute need not be included.  However, if the LTE GRE tunnel fails
   and the HG tries to revive it, the LTE GRE Tunnel Setup Request
   message MUST include the Session ID attribute.

   The Session ID attribute has the following format:

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Session ID                       (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+








<span class="grey">Leymann, et al.               Informational                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Session ID, set to 4.

   Attribute Length
      Set to 4.

   Session ID
      An unsigned integer generated by the HAAP.  It is used as the
      identification of bonded GRE tunnels.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.3.%20%20DSL%20Synchronization%20Rate"></a><a class="selflink" href="#section-5.1.3" id="section-5.1.3">5.1.3</a>.  DSL Synchronization Rate</span>

   The HG uses the DSL Synchronization Rate to notify the HAAP about the
   downstream bandwidth of the DSL link.  The DSL GRE Tunnel Setup
   Request message MUST include the DSL Synchronization Rate attribute.
   The LTE GRE Tunnel Setup Request message SHOULD NOT include this
   attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  DSL Synchronization Rate         (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      DSL Synchronization Rate, set to 7.

   Attribute Length
      Set to 4.

   DSL Synchronization Rate
      An unsigned integer measured in kbps.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20GRE%20Tunnel%20Setup%20Accept"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  GRE Tunnel Setup Accept</span>

   The HAAP uses the GRE Tunnel Setup Accept message as the response to
   the GRE Tunnel Setup Request message.  This message indicates
   acceptance of the tunnel establishment and carries parameters of the
   GRE tunnels.  Attributes that need to be included in this message are
   defined below.









<span class="grey">Leymann, et al.               Informational                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.1.%20%20H%20IPv4%20Address"></a><a class="selflink" href="#section-5.2.1" id="section-5.2.1">5.2.1</a>.  H IPv4 Address</span>

   The HAAP uses the H IPv4 Address attribute to inform the HG of the
   H IPv4 address.  The HG uses the H IPv4 address as the destination
   endpoint IPv4 address of the GRE tunnels (the source endpoint IPv4
   addresses of the GRE tunnels are the DSL WAN interface IP address (D)
   and the LTE WAN interface IP address (E), respectively, as shown in
   Figure 1).  The LTE GRE Tunnel Setup Accept message MUST include the
   H IPv4 Address attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  H IPv4 Address                   (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      H IPv4 Address, set to 1.

   Attribute Length
      Set to 4.

   H IPv4 Address
      Set to the pre-configured IPv4 address (e.g., an IP address of a
      Line Card in the HAAP), which is used as the endpoint IP address
      of GRE tunnels by the HAAP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.2.%20%20H%20IPv6%20Address"></a><a class="selflink" href="#section-5.2.2" id="section-5.2.2">5.2.2</a>.  H IPv6 Address</span>

   The HAAP uses the H IPv6 Address attribute to inform the HG of the
   H IPv6 address.  The HG uses the H IPv6 address as the destination
   endpoint IPv6 address of the GRE tunnels (the source endpoint IPv6
   addresses of the GRE tunnels are the DSL WAN interface IP address (D)
   and the LTE WAN interface IP address (E), respectively, as shown in
   Figure 1).

   The LTE GRE Tunnel Setup Accept message MUST include the H IPv6
   Address attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  H IPv6 Address                   (16 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+



<span class="grey">Leymann, et al.               Informational                    [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      H IPv6 Address, set to 2.

   Attribute Length
      Set to 16.

   H IPv6 Address
      Set to the pre-configured IPv6 address (e.g., an IP address of a
      Line Card in the HAAP), which is used as the endpoint IP address
      of GRE tunnels by the HAAP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.3.%20%20Session%20ID"></a><a class="selflink" href="#section-5.2.3" id="section-5.2.3">5.2.3</a>.  Session ID</span>

   The LTE GRE Tunnel Setup Accept message MUST include the Session ID
   attribute as defined in <a href="#section-5.1.2">Section 5.1.2</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.4.%20%20RTT%20Difference%20Threshold"></a><a class="selflink" href="#section-5.2.4" id="section-5.2.4">5.2.4</a>.  RTT Difference Threshold</span>

   The HAAP uses the RTT Difference Threshold attribute to inform the HG
   of the acceptable threshold of the RTT difference between the DSL
   link and the LTE link.  If the measured RTT difference exceeds this
   threshold, the HG SHOULD stop offloading traffic to the LTE GRE
   tunnel.  The LTE GRE Tunnel Setup Accept message MUST include the RTT
   Difference Threshold attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  RTT Difference Threshold         (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      RTT Difference Threshold, set to 9.

   Attribute Length
      Set to 4.

   RTT Difference Threshold
      An unsigned integer measured in milliseconds.  This value can be
      chosen in the range 0 through 1000.









<span class="grey">Leymann, et al.               Informational                    [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.5.%20%20Bypass%20Bandwidth%20Check%20Interval"></a><a class="selflink" href="#section-5.2.5" id="section-5.2.5">5.2.5</a>.  Bypass Bandwidth Check Interval</span>

   The HAAP uses the Bypass Bandwidth Check Interval attribute to inform
   the HG of how frequently the bypass bandwidth should be checked.  The
   HG should check the bypass bandwidth of the DSL WAN interface in each
   time period indicated by this interval.  The LTE GRE Tunnel Setup
   Accept message MUST include the Bypass Bandwidth Check Interval
   attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Bypass Bandwidth Check Interval  (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Bypass Bandwidth Check Interval, set to 10.

   Attribute Length
      Set to 4.

   Bypass Bandwidth Check Interval
      An unsigned integer measured in seconds.  This value can be chosen
      in the range 10 through 300.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.6.%20%20Active%20Hello%20Interval"></a><a class="selflink" href="#section-5.2.6" id="section-5.2.6">5.2.6</a>.  Active Hello Interval</span>

   The HAAP uses the Active Hello Interval attribute to inform the HG of
   the pre-configured interval for sending out GRE Tunnel Hellos.  The
   HG should send out GRE Tunnel Hellos via both the DSL and LTE WAN
   interfaces in each time period as indicated by this interval.  The
   LTE GRE Tunnel Setup Accept message MUST include the Active Hello
   Interval attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Active Hello Interval            (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+








<span class="grey">Leymann, et al.               Informational                    [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Active Hello Interval, set to 14.

   Attribute Length
      Set to 4.

   Active Hello Interval
      An unsigned integer measured in seconds.  This value can be chosen
      in the range 1 through 100.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.7.%20%20Hello%20Retry%20Times"></a><a class="selflink" href="#section-5.2.7" id="section-5.2.7">5.2.7</a>.  Hello Retry Times</span>

   The HAAP uses the Hello Retry Times attribute to inform the HG of the
   retry times for sending GRE Tunnel Hellos.  If the HG does not
   receive any acknowledgement from the HAAP for the number of GRE
   Tunnel Hello attempts specified in this attribute, the HG will
   declare a failure of the GRE tunnel.  The LTE GRE Tunnel Setup Accept
   message MUST include the Hello Retry Times attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Hello Retry Times                (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Hello Retry Times, set to 15.

   Attribute Length
      Set to 4.

   Hello Retry Times
      An unsigned integer that takes values in the range 3 through 10.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.8.%20%20Idle%20Timeout"></a><a class="selflink" href="#section-5.2.8" id="section-5.2.8">5.2.8</a>.  Idle Timeout</span>

   The HAAP uses the Idle Timeout attribute to inform the HG of the
   pre-configured timeout value to terminate the DSL GRE tunnel.  When
   an LTE GRE tunnel failure is detected, all traffic will be sent over
   the DSL GRE tunnel.  If the failure of the LTE GRE tunnel lasts
   longer than the Idle Timeout, subsequent traffic will be sent over
   raw DSL rather than over a tunnel, and the DSL GRE tunnel SHOULD be
   terminated.  The LTE GRE Tunnel Setup Accept message MUST include the
   Idle Timeout attribute.





<span class="grey">Leymann, et al.               Informational                    [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Idle Timeout                     (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Idle Timeout, set to 16.

   Attribute Length
      Set to 4.

   Idle Timeout
      An unsigned integer measured in seconds.  It takes values in the
      range 0 through 172,800 with a granularity of 60.  The default
      value is 86,400 (24 hours).  The value 0 indicates that the idle
      timer never expires.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.9.%20%20Bonding%20Key%20Value"></a><a class="selflink" href="#section-5.2.9" id="section-5.2.9">5.2.9</a>.  Bonding Key Value</span>

   The HAAP uses the Bonding Key Value attribute to inform the HG of the
   number that is to be carried as the Key of the GRE header for
   subsequent control messages.  The Bonding Key Value is generated by
   the HAAP and used for security purposes.

   The method used to generate this number is left up to
   implementations.  The pseudorandom number generator defined in
   ANSI X9.31, <a href="#appendix-A.2.4">Appendix A.2.4</a> [<a href="#ref-ANSI-X9.31-1998">ANSI-X9.31-1998</a>] is RECOMMENDED.  Note
   that random number generation "collisions" are allowed in the GRE
   Tunnel Bonding Protocol.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Bonding Key Value                (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+











<span class="grey">Leymann, et al.               Informational                    [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Bonding Key Value, set to 20.

   Attribute Length
      Set to 4.

   Bonding Key Value
      A 32-bit random number generated by the HAAP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.10.%20%20Configured%20DSL%20Upstream%20Bandwidth"></a><a class="selflink" href="#section-5.2.10" id="section-5.2.10">5.2.10</a>.  Configured DSL Upstream Bandwidth</span>

   The HAAP obtains the upstream bandwidth of the DSL link from the
   management system and uses the Configured DSL Upstream Bandwidth
   attribute to inform the HG.  The HG uses the received upstream
   bandwidth as the CIR [<a href="./rfc2697" title='"A Single Rate Three Color Marker"'>RFC2697</a>] for the DSL link.  The DSL GRE Tunnel
   Setup Accept message MUST include the Configured DSL Upstream
   Bandwidth attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   | Configured DSL Upstream Bandwidth (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Configured DSL Upstream Bandwidth, set to 22.

   Attribute Length
      Set to 4.

   Configured DSL Upstream Bandwidth
      An unsigned integer measured in kbps.

















<span class="grey">Leymann, et al.               Informational                    [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.11.%20%20Configured%20DSL%20Downstream%20Bandwidth"></a><a class="selflink" href="#section-5.2.11" id="section-5.2.11">5.2.11</a>.  Configured DSL Downstream Bandwidth</span>

   The HAAP obtains the downstream bandwidth of the DSL link from the
   management system and uses the Configured DSL Downstream Bandwidth
   attribute to inform the HG.  The HG uses the received downstream
   bandwidth as the base in calculating the bypassing bandwidth.  The
   DSL GRE Tunnel Setup Accept message MUST include the Configured DSL
   Downstream Bandwidth attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |Configured DSL Downstream Bandwidth(4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Configured DSL Downstream Bandwidth, set to 23.

   Attribute Length
      Set to 4.

   Configured DSL Downstream Bandwidth
      An unsigned integer measured in kbps.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.12.%20%20RTT%20Difference%20Threshold%20Violation"></a><a class="selflink" href="#section-5.2.12" id="section-5.2.12">5.2.12</a>.  RTT Difference Threshold Violation</span>

   The HAAP uses the RTT Difference Threshold Violation attribute to
   inform the HG of the number of times in a row that the RTT Difference
   Threshold (see <a href="#section-5.2.4">Section 5.2.4</a>) may be violated before the HG MUST stop
   using the LTE GRE tunnel.  If the RTT Difference Threshold is
   continuously violated for more than the indicated number of
   measurements, the HG MUST stop using the LTE GRE tunnel.  The LTE GRE
   Tunnel Setup Accept message MUST include the RTT Difference Threshold
   Violation attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  RTT Diff Threshold Violation     (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+







<span class="grey">Leymann, et al.               Informational                    [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      RTT Difference Threshold Violation, set to 24.

   Attribute Length
      Set to 4.

   RTT Difference Threshold Violation
      An unsigned integer that takes values in the range 1 through 25.
      A typical value is 3.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.13.%20%20RTT%20Difference%20Threshold%20Compliance"></a><a class="selflink" href="#section-5.2.13" id="section-5.2.13">5.2.13</a>.  RTT Difference Threshold Compliance</span>

   The HAAP uses the RTT Difference Threshold Compliance attribute to
   inform the HG of the number of times in a row that the RTT Difference
   Threshold (see <a href="#section-5.2.4">Section 5.2.4</a>) must be compliant before use of the LTE
   GRE tunnel can be resumed.  If the RTT Difference Threshold is
   continuously detected to be compliant across more than this number of
   measurements, the HG MAY resume using the LTE GRE tunnel.  The LTE
   GRE Tunnel Setup Accept message MUST include the RTT Difference
   Threshold Compliance attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                   (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |   (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  RTT Diff Threshold Compliance    (4 bytes)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      RTT Difference Threshold Compliance, set to 25.

   Attribute Length
      Set to 4.

   RTT Difference Threshold Compliance
      An unsigned integer that takes values in the range 1 through 25.
      A typical value is 3.













<span class="grey">Leymann, et al.               Informational                    [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.14.%20%20Idle%20Hello%20Interval"></a><a class="selflink" href="#section-5.2.14" id="section-5.2.14">5.2.14</a>.  Idle Hello Interval</span>

   The HAAP uses the Idle Hello Interval attribute to inform the HG of
   the pre-configured interval for sending out GRE Tunnel Hellos when
   the subscriber is detected to be idle.  The HG SHOULD begin to send
   out GRE Tunnel Hellos via both the DSL and LTE WAN interfaces in each
   time period as indicated by this interval, if the bonded tunnels have
   seen no traffic for a period longer than the "No Traffic Monitored
   Interval" (see <a href="#section-5.2.15">Section 5.2.15</a>).  The LTE GRE Tunnel Setup Accept
   message MUST include the Idle Hello Interval attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Idle Hello Interval               (4 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Idle Hello Interval, set to 31.

   Attribute Length
      Set to 4.

   Idle Hello Interval
      An unsigned integer measured in seconds.  This value can be chosen
      in the range 100 through 86,400 (24 hours) with a granularity of
      100.  The default value is 1800 (30 minutes).

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.15.%20%20No%20Traffic%20Monitored%20Interval"></a><a class="selflink" href="#section-5.2.15" id="section-5.2.15">5.2.15</a>.  No Traffic Monitored Interval</span>

   The HAAP uses the No Traffic Monitored Interval attribute to inform
   the HG of the pre-configured interval for switching the GRE Tunnel
   Hello mode.  If traffic is detected on the bonded GRE tunnels before
   this interval expires, the HG SHOULD switch to the Active Hello
   Interval.  The LTE GRE Tunnel Setup Accept message MUST include the
   No Traffic Monitored Interval attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  No Traffic Monitored Interval     (4 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+





<span class="grey">Leymann, et al.               Informational                    [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      No Traffic Monitored Interval, set to 32.

   Attribute Length
      Set to 4.

   No Traffic Monitored Interval
      An unsigned integer measured in seconds.  This value is in the
      range 30 through 86,400 (24 hours).  The default value is 60.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20GRE%20Tunnel%20Setup%20Deny"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  GRE Tunnel Setup Deny</span>

   The HAAP MUST send the GRE Tunnel Setup Deny message to the HG if the
   GRE Tunnel Setup Request from this HG is denied.  The HG MUST
   terminate the GRE tunnel setup process as soon as it receives the GRE
   Tunnel Setup Deny message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.1.%20%20Error%20Code"></a><a class="selflink" href="#section-5.3.1" id="section-5.3.1">5.3.1</a>.  Error Code</span>

   The HAAP uses the Error Code attribute to inform the HG of the error
   code.  The error code depicts why the GRE Tunnel Setup Request is
   denied.  Both the LTE GRE Tunnel Setup Deny message and the DSL GRE
   Tunnel Setup Deny message MUST include the Error Code attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Error Code                        (4 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Error Code, set to 17.

   Attribute Length
      Set to 4.

   Error Code
      An unsigned integer.  The list of codes is as follows:

      1:  The HAAP was not reachable over LTE during the GRE Tunnel
          Setup Request.

      2:  The HAAP was not reachable via DSL during the GRE Tunnel Setup
          Request.

      3:  The LTE GRE tunnel to the HAAP failed.



<span class="grey">Leymann, et al.               Informational                    [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


      4:  The DSL GRE tunnel to the HAAP failed.

      5:  The given DSL User ID is not allowed to use the GRE Tunnel
          Bonding service.

      6:  The given User Alias / User ID (Globally Unique Identifier
          (GUID)) is not allowed to use the GRE Tunnel Bonding service.

      7:  The LTE and DSL User IDs do not match.

      8:  The HAAP denied the GRE Tunnel Setup Request because a bonding
          session with the same User ID already exists.

      9:  The HAAP denied the GRE Tunnel Setup Request because the
          user's CIN is not permitted.

      10: The HAAP terminated a GRE Tunnel Bonding session for
          maintenance reasons.

      11: There was a communication error between the HAAP and the
          management system during the LTE GRE Tunnel Setup Request.

      12: There was a communication error between the HAAP and the
          management system during the DSL GRE Tunnel Setup Request.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.%20%20GRE%20Tunnel%20Hello"></a><a class="selflink" href="#section-5.4" id="section-5.4">5.4</a>.  GRE Tunnel Hello</span>

   After the DSL/LTE GRE tunnel is established, the HG begins to
   periodically send out GRE Tunnel Hello messages via the tunnel; the
   HAAP acknowledges the HG's messages by returning GRE Tunnel Hello
   messages to the HG.  This continues until the tunnel is terminated.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.1.%20%20Timestamp"></a><a class="selflink" href="#section-5.4.1" id="section-5.4.1">5.4.1</a>.  Timestamp</span>

   The HAAP uses the Timestamp attribute to inform the HG of the
   timestamp value that is used for RTT calculation.  Both the LTE GRE
   Tunnel Hello message and the DSL GRE Tunnel Hello message MUST
   include the Timestamp attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Timestamp                         (8 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+





<span class="grey">Leymann, et al.               Informational                    [Page 25]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-26"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Timestamp, set to 5.

   Attribute Length
      Set to 8.

   Timestamp
      The time since the system restarted.  The high-order 4 bytes
      indicate an unsigned integer in units of 1 second; the low-order
      4 bytes indicate an unsigned integer in units of 1 millisecond.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.2.%20%20IPv6%20Prefix%20Assigned%20by%20HAAP"></a><a class="selflink" href="#section-5.4.2" id="section-5.4.2">5.4.2</a>.  IPv6 Prefix Assigned by HAAP</span>

   The HAAP uses the IPv6 Prefix Assigned by HAAP attribute to inform
   the HG of the assigned IPv6 prefix.  This IPv6 prefix is to be
   captured via lawful intercept.  Both the LTE GRE Tunnel Hello message
   and the DSL GRE Tunnel Hello message MUST include the IPv6 Prefix
   Assigned by HAAP attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  IPv6 Prefix Assigned by HAAP      (16 bytes) |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      IPv6 Prefix Assigned by HAAP, set to 13.

   Attribute Length
      Set to 17.

   IPv6 Prefix Assigned by HAAP
      The highest-order 16 bytes encode an IPv6 address.  The
      lowest-order 1 byte encodes the prefix length.  These two values
      are put together to represent an IPv6 prefix.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.5.%20%20GRE%20Tunnel%20Tear%20Down"></a><a class="selflink" href="#section-5.5" id="section-5.5">5.5</a>.  GRE Tunnel Tear Down</span>

   The HAAP can terminate a DSL/LTE GRE tunnel by sending the GRE Tunnel
   Tear Down message to the HG via the tunnel.  The Error Code attribute
   as defined in <a href="#section-5.3.1">Section 5.3.1</a> MUST be included in this message.  After
   receiving the GRE Tunnel Tear Down message, the HG removes the IP
   address of H, which is the destination IP addresses of the DSL and
   LTE GRE tunnels.





<span class="grey">Leymann, et al.               Informational                    [Page 26]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-27"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.%20%20GRE%20Tunnel%20Notify"></a><a class="selflink" href="#section-5.6" id="section-5.6">5.6</a>.  GRE Tunnel Notify</span>

   The HG and the HAAP use the GRE Tunnel Notify message, which is
   transmitted through either the DSL GRE tunnel or the LTE GRE tunnel,
   to notify each other about their status regarding the DSL/LTE GRE
   tunnels, the information for the bonded tunnels, the actions that
   need to be taken, etc.

   Usually, the receiver just sends the received attributes back as the
   acknowledgement for each GRE Tunnel Notify message.  However, there
   is an exception for the Filter List Package: since the size of the
   Filter List Package attribute can be very large, a special attribute
   -- the Filter List Package ACK attribute -- is used as the
   acknowledgement (see <a href="#section-5.6.12">Section 5.6.12</a>).

   Attributes that need to be included in the GRE Tunnel Notify message
   are defined below.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.1.%20%20Bypass%20Traffic%20Rate"></a><a class="selflink" href="#section-5.6.1" id="section-5.6.1">5.6.1</a>.  Bypass Traffic Rate</span>

   There are a few types of traffic that need to be transmitted over the
   raw DSL WAN interface rather than the bonded GRE tunnels.  The HG has
   to set aside bypass bandwidth on the DSL WAN interface for these
   traffic types.  Therefore, the available bandwidth of the DSL GRE
   tunnel is the entire DSL WAN interface bandwidth minus the occupied
   bypass bandwidth.

   The HG uses the Bypass Traffic Rate attribute to inform the HAAP of
   the downstream bypass bandwidth for the DSL WAN interface.  The
   Bypass Traffic Rate attribute will be included in the DSL GRE Tunnel
   Notify message.  The HAAP calculates the available downstream
   bandwidth for the DSL GRE tunnel as the Configured DSL Downstream
   Bandwidth minus the bypass bandwidth provided by the HG.  The
   available DSL bandwidth will be used as the CIR of the coloring
   system [<a href="./rfc2697" title='"A Single Rate Three Color Marker"'>RFC2697</a>].

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Bypass Traffic Rate               (4 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+








<span class="grey">Leymann, et al.               Informational                    [Page 27]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-28"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Bypass Traffic Rate, set to 6.

   Attribute Length
      Set to 4.

   Bypass Traffic Rate
      An unsigned integer measured in kbps.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.2.%20%20Filter%20List%20Package"></a><a class="selflink" href="#section-5.6.2" id="section-5.6.2">5.6.2</a>.  Filter List Package</span>

   The HAAP uses the Filter List Package attribute to inform the HG of
   the service types that need to bypass the bonded GRE tunnels.  The
   full list of all Filter Items may be given by a series of Filter List
   Package attributes with each specifying a partial list.  At the HG, a
   full list of Filter Items is maintained.  Also, the HG needs to
   maintain an exception list of Filter Items.  For example, the packets
   carrying the control messages defined in this document should be
   excluded from the filter list.

   Incoming packets that match a Filter Item in the filter list while
   not matching any item in the exception list MUST be transmitted over
   raw DSL rather than the bonded GRE tunnels.  Both the LTE GRE Tunnel
   Notify message and the DSL GRE Tunnel Notify message MAY include the
   Filter List Package attribute.  The DSL GRE Tunnel Notify message is
   preferred.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Filter List TLV                   (variable) ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Filter List Package, set to 8.

   Attribute Length
      The total length of the Filter List TLV.  The maximum allowed
      length is 969 bytes.










<span class="grey">Leymann, et al.               Informational                    [Page 28]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-29"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Filter List TLV
      The Filter List TLV occurs one time in a Filter List Package
      attribute.  It has the following format:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  Commit_Count                                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Packet_Sum               |         Packet_ID             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Filter Item (1)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         ......                                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Filter Item (n)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   where each Filter Item is of the following format:

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Type                  |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Enable                |     Description Length        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                 Description Value                             ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                        Value                                  ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Commit_Count
         An unsigned integer that identifies the version of the Filter
         Item list.  The version is shared by all Filter List Packages
         and increases monotonically by one for each new Filter Item
         list.  The HG MUST refresh its Filter Item list when a new
         Commit_Count is received.

      Packet_Sum
         If a single Filter List Package attribute might make the
         control message larger than the MTU, fragmentation is used.
         The Packet_Sum indicates the total number of fragments.

      Packet_ID
         The fragmentation index for this Filter List Package attribute.
         Each fragment is numbered starting at 1 and increasing by one
         up to Packet_Sum.





<span class="grey">Leymann, et al.               Informational                    [Page 29]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-30"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


      Type
         The Type of the Filter Item.  Currently, the following types
         are supported:

                       Filter Item                  Type
                   ===========================   ============
                   FQDN [<a href="./rfc7031" title='"DHCPv6 Failover Requirements"'>RFC7031</a>]                    1
                   DSCP [<a href="./rfc2724" title='"RTFM: New Attributes for Traffic Flow Measurement"'>RFC2724</a>]                    2
                   Destination Port                  3
                   Destination IP                    4
                   Destination IP &amp; Port             5
                   Source Port                       6
                   Source IP                         7
                   Source IP &amp; Port                  8
                   Source MAC                        9
                   Protocol                          10
                   Source IP Range                   11
                   Destination IP Range              12
                   Source IP Range &amp; Port            13
                   Destination IP Range &amp; Port       14

         Other values are reserved for future use and MUST be ignored on
         receipt.

      Length
         The length of the Filter Item in bytes.  Type and Length are
         excluded.

      Enable
         An integer that indicates whether or not the Filter Item is
         enabled.  A value of 1 means "enabled", and a value of 0 means
         "disabled".  Other possible values are reserved and MUST be
         ignored on receipt.

      Description Length
         The length of the Description Value in bytes.

      Description Value
         A variable-length string value encoded in UTF-8 that describes
         the Filter List TLV (e.g., "FQDN").

      Value
         A variable-length string encoded in UTF-8 that specifies the
         value of the Filter Item (e.g., "www.yahoo.com").  As an
         example, Type = 1 and Value = "www.yahoo.com" mean that packets
         whose FQDN field equals "www.yahoo.com" match the Filter Item.
         "Source MAC" (source Media Access Control address) values are
         specified using hexadecimal numbers.  Port numbers are decimals



<span class="grey">Leymann, et al.               Informational                    [Page 30]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-31"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


         as assigned by IANA in [<a href="#ref-Port-NO" title='"Service Name and Transport Protocol Port Number Registry"'>Port-NO</a>].  For the "Protocol" type, the
         value could be either a decimal or a keyword specified by IANA
         in [<a href="#ref-Pro-NO" title='"Assigned Internet Protocol Numbers"'>Pro-NO</a>].  The formats for IP addresses and IP address
         ranges are defined in [<a href="./rfc4632" title='"Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan"'>RFC4632</a>] and [<a href="./rfc4291" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>] for IPv4 and
         IPv6, respectively.  A Filter Item of Type 5, 8, 13, or 14 is a
         combination of two parameters; values for the two parameters
         are separated by a colon (":").

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.3.%20%20Switching%20to%20DSL%20Tunnel"></a><a class="selflink" href="#section-5.6.3" id="section-5.6.3">5.6.3</a>.  Switching to DSL Tunnel</span>

   If the RTT difference is continuously detected to be in violation of
   the RTT Difference Threshold (see <a href="#section-5.2.4">Section 5.2.4</a>) more than the number
   of times specified in the RTT Difference Threshold Violation
   attribute (see <a href="#section-5.2.12">Section 5.2.12</a>), the HG uses the Switching to DSL
   Tunnel attribute to inform the HAAP to use the DSL GRE tunnel only.
   When the HAAP receives this attribute, it MUST begin to transmit
   downstream traffic to this HG solely over the DSL GRE tunnel.  The
   DSL GRE Tunnel Notify message MAY include the Switching to DSL Tunnel
   attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Switching to DSL Tunnel, set to 11.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.4.%20%20Overflowing%20to%20LTE%20Tunnel"></a><a class="selflink" href="#section-5.6.4" id="section-5.6.4">5.6.4</a>.  Overflowing to LTE Tunnel</span>

   If the RTT difference is continuously detected to not be in violation
   of the RTT Difference Threshold (see <a href="#section-5.2.4">Section 5.2.4</a>) more than the
   number of times specified in the RTT Difference Threshold Compliance
   attribute (see <a href="#section-5.2.13">Section 5.2.13</a>), the HG uses the Overflowing to LTE
   Tunnel attribute to inform the HAAP that the LTE GRE tunnel can be
   used again.  The DSL GRE Tunnel Notify message MAY include the
   Overflowing to LTE Tunnel attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




<span class="grey">Leymann, et al.               Informational                    [Page 31]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-32"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Attribute Type
      Overflowing to LTE Tunnel, set to 12.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.5.%20%20DSL%20Link%20Failure"></a><a class="selflink" href="#section-5.6.5" id="section-5.6.5">5.6.5</a>.  DSL Link Failure</span>

   When the HG detects that the DSL WAN interface status is "down", it
   MUST tear down the DSL GRE tunnel.  It informs the HAAP about the
   failure by using the DSL Link Failure attribute.  The HAAP MUST
   tear down the DSL GRE tunnel upon receipt of the DSL Link Failure
   attribute.  The DSL Link Failure attribute SHOULD be carried in the
   LTE GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      DSL Link Failure, set to 18.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.6.%20%20LTE%20Link%20Failure"></a><a class="selflink" href="#section-5.6.6" id="section-5.6.6">5.6.6</a>.  LTE Link Failure</span>

   When the HG detects that the LTE WAN interface status is "down", it
   MUST tear down the LTE GRE tunnel.  It informs the HAAP about the
   failure by using the LTE Link Failure attribute.  The HAAP MUST
   tear down the LTE GRE tunnel upon receipt of the LTE Link Failure
   attribute.  The LTE Link Failure attribute SHOULD be carried in the
   DSL GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      LTE Link Failure, set to 19.

   Attribute Length
      Set to 0.




<span class="grey">Leymann, et al.               Informational                    [Page 32]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-33"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.7.%20%20IPv6%20Prefix%20Assigned%20to%20Host"></a><a class="selflink" href="#section-5.6.7" id="section-5.6.7">5.6.7</a>.  IPv6 Prefix Assigned to Host</span>

   If the HG changes the IPv6 prefix assigned to the host, it uses the
   IPv6 Prefix Assigned to Host attribute to inform the HAAP.  Both the
   LTE GRE Tunnel Notify message and the DSL GRE Tunnel Notify message
   MAY include the IPv6 Prefix Assigned to Host attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  IPv6 Prefix Assigned to Host      (16 bytes) |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      IPv6 Prefix Assigned to Host, set to 21.

   Attribute Length
      Set to 17.

   IPv6 Prefix Assigned to Host
      The highest-order 16 bytes encode an IPv6 address.  The
      lowest-order 1 byte encodes the prefix length.  These two values
      are put together to represent an IPv6 prefix.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.8.%20%20Diagnostic%20Start%3A%20Bonding%20Tunnel"></a><a class="selflink" href="#section-5.6.8" id="section-5.6.8">5.6.8</a>.  Diagnostic Start: Bonding Tunnel</span>

   The HG uses the Diagnostic Start: Bonding Tunnel attribute to inform
   the HAAP to switch to diagnostic mode to test the performance of the
   entire bonding tunnel.  The Diagnostic Start: Bonding Tunnel
   attribute SHOULD be carried in the DSL GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Diagnostic Start: Bonding Tunnel, set to 26.

   Attribute Length
      Set to 0.







<span class="grey">Leymann, et al.               Informational                    [Page 33]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-34"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.9.%20%20Diagnostic%20Start%3A%20DSL%20Tunnel"></a><a class="selflink" href="#section-5.6.9" id="section-5.6.9">5.6.9</a>.  Diagnostic Start: DSL Tunnel</span>

   The HG uses the Diagnostic Start: DSL Tunnel attribute to inform the
   HAAP to switch to diagnostic mode to test the performance of the DSL
   GRE tunnel.  The Diagnostic Start: DSL Tunnel attribute SHOULD be
   carried in the DSL GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Diagnostic Start: DSL Tunnel, set to 27.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.10.%20%20Diagnostic%20Start%3A%20LTE%20Tunnel"></a><a class="selflink" href="#section-5.6.10" id="section-5.6.10">5.6.10</a>.  Diagnostic Start: LTE Tunnel</span>

   The HG uses the Diagnostic Start: LTE Tunnel attribute to inform the
   HAAP to switch to diagnostic mode to test the performance of the
   LTE GRE tunnel.  The Diagnostic Start: LTE Tunnel attribute SHOULD be
   carried in the DSL GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Diagnostic Start: LTE Tunnel, set to 28.

   Attribute Length
      Set to 0.














<span class="grey">Leymann, et al.               Informational                    [Page 34]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-35"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.11.%20%20Diagnostic%20End"></a><a class="selflink" href="#section-5.6.11" id="section-5.6.11">5.6.11</a>.  Diagnostic End</span>

   The HG uses the Diagnostic End attribute to inform the HAAP to stop
   operating in diagnostic mode.  The Diagnostic End attribute SHOULD be
   carried in the DSL GRE Tunnel Notify message.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Diagnostic End, set to 29.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.12.%20%20Filter%20List%20Package%20ACK"></a><a class="selflink" href="#section-5.6.12" id="section-5.6.12">5.6.12</a>.  Filter List Package ACK</span>

   The HG uses the Filter List Package ACK attribute to acknowledge the
   Filter List Package sent by the HAAP.  Both the LTE GRE Tunnel Notify
   message and the DSL GRE Tunnel Notify message MAY include the Filter
   List Package ACK attribute.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
   |  Filter List Package ACK           (5 bytes)  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+

   Attribute Type
      Filter List Package ACK, set to 30.

   Attribute Length
      Set to 5.













<span class="grey">Leymann, et al.               Informational                    [Page 35]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-36"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Filter List Package ACK
      The highest-order 4 bytes are the Commit_Count as defined in
      <a href="#section-5.6.2">Section 5.6.2</a>.  The lowest-order 1 byte encodes the following
      error codes:

      0: The Filter List Package is acknowledged.

      1: The Filter List Package is not acknowledged.  The HG is a new
         subscriber and has not ever received a Filter List Package.  In
         this case, the HAAP SHOULD tear down the bonding tunnels and
         force the HG to re-establish the GRE tunnels.

      2: The Filter List Package is not acknowledged.  The HG has
         already gotten a valid Filter List Package.  The filter list on
         the HG will continue to be used, while the HAAP need not do
         anything.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.13.%20%20Switching%20to%20Active%20Hello%20State"></a><a class="selflink" href="#section-5.6.13" id="section-5.6.13">5.6.13</a>.  Switching to Active Hello State</span>

   If traffic is being sent/received over the bonding GRE tunnels before
   the "No Traffic Monitored Interval" expires (see <a href="#section-5.2.15">Section 5.2.15</a>), the
   HG sends the HAAP a GRE Tunnel Notify message containing the
   Switching to Active Hello State attribute.

   The HAAP will switch to Active Hello State and send the HG a GRE
   Tunnel Notify message carrying the Switching to Active Hello State
   attribute as the ACK.

   When the HG receives the ACK, it will switch to Active Hello State,
   start RTT detection, and start sending GRE Tunnel Hello messages with
   the Active Hello Interval (see <a href="#section-5.2.6">Section 5.2.6</a>).

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Switching to Active Hello State, set to 33.

   Attribute Length
      Set to 0.








<span class="grey">Leymann, et al.               Informational                    [Page 36]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-37"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.14.%20%20Switching%20to%20Idle%20Hello%20State"></a><a class="selflink" href="#section-5.6.14" id="section-5.6.14">5.6.14</a>.  Switching to Idle Hello State</span>

   The HG initiates switching to Idle Hello State when the bonding of
   GRE tunnels is successfully established and the LTE GRE Tunnel Setup
   Accept message carrying the Idle Hello Interval attribute (see
   <a href="#section-5.2.14">Section 5.2.14</a>) is received.  The HG sends the HAAP a GRE Tunnel
   Notify message containing the Switching to Idle Hello State
   attribute.

   The HAAP will switch to Idle Hello State, clear RTT state, and send
   the HG a GRE Tunnel Notify message carrying the Switching to Idle
   Hello State attribute as the ACK.

   When the HG receives the ACK, it will (1) switch to Idle Hello State,
   (2) stop RTT detection and clear RTT state, and (3) start sending GRE
   Tunnel Hello messages with the Idle Hello Interval (see
   <a href="#section-5.2.14">Section 5.2.14</a>).

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Switching to Idle Hello State, set to 34.

   Attribute Length
      Set to 0.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.15.%20%20Tunnel%20Verification"></a><a class="selflink" href="#section-5.6.15" id="section-5.6.15">5.6.15</a>.  Tunnel Verification</span>

   The HAAP uses the Tunnel Verification attribute to inform the HG to
   verify whether an existing LTE GRE tunnel is still functioning.  The
   Tunnel Verification attribute SHOULD be carried in the LTE GRE Tunnel
   Notify message.  It provides a means to detect the tunnel faster than
   the GRE Tunnel Hello, especially when the LTE GRE tunnel is in the
   Idle Hello State and it takes a much longer time to detect this
   tunnel.

   When the HAAP receives an LTE GRE Tunnel Setup Request and finds that
   the requested tunnel conflicts with an existing tunnel, the HAAP
   initiates tunnel verification.  The HAAP drops all conflicting LTE
   GRE Tunnel Setup Request messages and sends GRE Tunnel Notify
   messages carrying the Tunnel Verification attribute until the
   verification ends.  The HG MUST respond to the HAAP with the same
   Tunnel Verification attribute as the ACK if the tunnel is still
   functioning.



<span class="grey">Leymann, et al.               Informational                    [Page 37]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-38"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   If the ACK of the Tunnel Verification attribute is received from the
   HG, the HAAP determines that the existing tunnel is still
   functioning.  An LTE GRE Tunnel Deny message (with Error Code = 8)
   will be sent to the HG.  The HG SHOULD terminate the GRE Tunnel Setup
   Request process immediately.

   If the HAAP does not receive a tunnel verification ACK message after
   three attempts (one initial attempt and two retries), it will regard
   the existing tunnel as failed, and the LTE GRE Tunnel Setup Request
   will be accepted.

   +-+-+-+-+-+-+-+-+
   |Attribute Type |                    (1 byte)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Attribute Length             |    (2 bytes)
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Attribute Type
      Tunnel Verification, set to 35.

   Attribute Length
      Set to 0.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Tunnel%20Protocol%20Operation%20%28Data%20Plane%29"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Tunnel Protocol Operation (Data Plane)</span>

   GRE tunnels are set up over heterogeneous connections, such as LTE
   and DSL, between the HG and the HAAP.  Users' IP (inner) packets are
   encapsulated in GRE packets that are in turn carried in IP (outer)
   packets.  The general structure of data packets of the GRE Tunnel
   Bonding Protocol is shown below.

                  +--------------------------------+
                  |          Media Header          |
                  +--------------------------------+
                  |         Outer IP Header        |
                  +--------------------------------+
                  |           GRE Header           |
                  +--------------------------------+
                  |         Inner IP Packet        |
                  +--------------------------------+

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20The%20GRE%20Header"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  The GRE Header</span>

   The GRE header was first standardized in [<a href="./rfc2784" title='"Generic Routing Encapsulation (GRE)"'>RFC2784</a>].  [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>] added
   the optional Key and Sequence Number fields.

   The Checksum and the Reserved1 fields are not used in the GRE Tunnel
   Bonding; therefore, the C bit is set to 0.



<span class="grey">Leymann, et al.               Informational                    [Page 38]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-39"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   The Key bit is set to 1 so that the Key field is present.  The Key
   field is used as a 32-bit random number.  It is generated by the HAAP
   per bonding connection, and the HG is notified (see <a href="#section-5.2.9">Section 5.2.9</a>).

   The S bit is set to 1, and the Sequence Number field is present and
   used for in-order delivery as per [<a href="./rfc2890" title='"Key and Sequence Number Extensions to GRE"'>RFC2890</a>].

   The Protocol Type field in the GRE header MUST be set to 0x0800 for
   IPv4 or 0x86DD for IPv6.  So, the GRE header used by data packets of
   the GRE Tunnel Bonding Protocol has the following format:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |0| |1|1| Reserved0       | Ver |  Protocol Type 0x0800/86DD    |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                              Key                              |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Sequence Number                        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Figure 3: GRE Header for Data Packets of GRE Tunnel Bonding

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20Automatic%20Setup%20of%20GRE%20Tunnels"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Automatic Setup of GRE Tunnels</span>

   The HG gets the DSL WAN interface IP address (D) from the Broadband
   Remote Access Server (BRAS) via the Point-to-Point Protocol over
   Ethernet (PPPoE) and gets the LTE WAN interface IP address (E)
   through the Packet Data Protocol (PDP) from the Packet Data Network
   Gateway (PGW).  The domain name of a HAAP group may be configured or
   obtained via the DSL/LTE WAN interface based on gateway configuration
   protocols such as [<a href="#ref-TR-069" title='"CPE WAN Management Protocol"'>TR-069</a>], where the HAAP group comprises one or
   multiple HAAPs.  The Domain Name System (DNS) resolution of the HAAP
   group's domain name is requested via the DSL/LTE WAN interface.  The
   DNS server will reply with an anycast HAAP IP address (G), which MAY
   be pre-configured by the operator.

   After the interface IP addresses have been acquired, the HG starts
   the following GRE Tunnel Bonding procedure.  It is REQUIRED that the
   HG first set up the LTE GRE tunnel and then set up the DSL GRE
   tunnel.

   The HG sends the GRE Tunnel Setup Request message to the HAAP via the
   LTE WAN interface.  The outer source IP address for this message is
   the LTE WAN interface IP address (E), while the outer destination IP
   address is the anycast HAAP IP address (G).  The HAAP with the
   highest priority (e.g., the one that the HG has the least-cost path
   to reach) in the HAAP group, which receives the GRE Tunnel Setup



<span class="grey">Leymann, et al.               Informational                    [Page 39]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-40"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   Request message, will initiate the procedure for authentication and
   authorization, as specified in [<a href="#ref-TS23.401" title='"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access"'>TS23.401</a>], to check whether the HG is
   trusted by the PGW.

   If the authentication and authorization succeed, the HAAP sets the
   LTE WAN interface IP address (E), which is obtained from the GRE
   Tunnel Setup Request message (i.e., its outer source IP address), as
   the destination endpoint IP address of the GRE tunnel and replies to
   the HG's LTE WAN interface with the GRE Tunnel Setup Accept message
   in which an IP address (H) of the HAAP (e.g., an IP address of a Line
   Card in the HAAP) and a Session ID randomly generated by the HAAP are
   carried as attributes.  The outer source IP address for this message
   is the IP address (H) or the anycast HAAP IP address (G), while the
   outer destination IP address is the LTE WAN interface IP address (E).
   Otherwise, the HAAP MUST send to the HG's LTE WAN interface the GRE
   Tunnel Setup Deny message, and the HG MUST terminate the tunnel setup
   process once it receives the GRE Tunnel Setup Deny message.

   After the LTE GRE tunnel is successfully set up, the HG will obtain
   the C address (see Figure 1) over the tunnel from the HAAP through
   the Dynamic Host Configuration Protocol (DHCP).  After that, the HG
   starts to set up the DSL GRE tunnel.  It sends a GRE Tunnel Setup
   Request message via the DSL WAN interface, carrying the
   aforementioned Session ID received from the HAAP.  The outer source
   IP address for this message is the DSL WAN interface IP address (D),
   while the outer destination IP address is the IP address (H) of the
   HAAP.  The HAAP, which receives the GRE Tunnel Setup Request message,
   will initiate the procedure for authentication and authorization in
   order to check whether the HG is trusted by the BRAS.

   If the authentication and authorization succeed, the HAAP sets the
   DSL WAN interface IP address (D), which is obtained from the GRE
   Tunnel Setup Request message (i.e., its outer source IP address), as
   the destination endpoint IP address of the GRE tunnel and replies to
   the HG's DSL WAN interface with the GRE Tunnel Setup Accept message.
   The outer source IP address for this message is the IP address (H) of
   the HAAP, while the outer destination IP address is the DSL WAN
   interface IP address (D).  In this way, the two tunnels with the same
   Session ID can be used to carry traffic from the same user.  That is
   to say, the two tunnels are "bonded" together.  Otherwise, if the
   authentication and authorization fail, the HAAP MUST send to the HG's
   DSL WAN interface the GRE Tunnel Setup Deny message.  Meanwhile, it
   MUST send to the HG's LTE WAN interface the GRE Tunnel Tear Down
   message.  The HG MUST terminate the tunnel setup process once it
   receives the GRE Tunnel Setup Deny message and MUST tear down the LTE
   GRE tunnel that has been set up once it receives the GRE Tunnel
   Tear Down message.




<span class="grey">Leymann, et al.               Informational                    [Page 40]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-41"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Security Considerations</span>

   Malicious devices controlled by attackers may intercept the control
   messages sent on the GRE tunnels.  Later on, the rogue devices may
   fake control messages to disrupt the GRE tunnels or attract traffic
   from the target HG.

   As a security feature, the Key field of the GRE header of the control
   messages and the data packets is generated as a 32-bit cleartext
   password, except for the first GRE Setup Request message per bonding
   connection sent from the HG to the HAAP, whose Key field is filled
   with all zeros.  The HAAP and the HG validate the Key value and the
   outer source IP address, and they discard any packets with invalid
   combinations.

   Moreover, GRE over IP Security (IPsec) could be used to enhance
   security.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  IANA Considerations</span>

   IANA need not assign anything for the GRE Tunnel Bonding Protocol.
   The GRE Protocol Type, the Ethertype for the GRE Channel, is set to
   0xB7EA, which is under the control of the IEEE Registration
   Authority.  However, IANA has updated the "IEEE 802 Numbers" IANA web
   page [<a href="#ref-802Type" title='"IEEE 802 Numbers"'>802Type</a>], which is of primarily historic interest.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20References"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-Port-NO">Port-NO</a>]  IANA, "Service Name and Transport Protocol Port Number
              Registry", &lt;<a href="http://www.iana.org/assignments/service-names-port-numbers">http://www.iana.org/assignments/</a>
              <a href="http://www.iana.org/assignments/service-names-port-numbers">service-names-port-numbers</a>&gt;.

   [<a id="ref-Pro-NO">Pro-NO</a>]   IANA, "Assigned Internet Protocol Numbers",
              &lt;<a href="http://www.iana.org/assignments/protocol-numbers">http://www.iana.org/assignments/protocol-numbers</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2697">RFC2697</a>]  Heinanen, J. and R. Guerin, "A Single Rate Three Color
              Marker", <a href="./rfc2697">RFC 2697</a>, DOI 10.17487/RFC2697, September 1999,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2697">http://www.rfc-editor.org/info/rfc2697</a>&gt;.






<span class="grey">Leymann, et al.               Informational                    [Page 41]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-42"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   [<a id="ref-RFC2784">RFC2784</a>]  Farinacci, D., Li, T., Hanks, S., Meyer, D., and P.
              Traina, "Generic Routing Encapsulation (GRE)", <a href="./rfc2784">RFC 2784</a>,
              DOI 10.17487/RFC2784, March 2000,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2784">http://www.rfc-editor.org/info/rfc2784</a>&gt;.

   [<a id="ref-RFC2890">RFC2890</a>]  Dommety, G., "Key and Sequence Number Extensions to GRE",
              <a href="./rfc2890">RFC 2890</a>, DOI 10.17487/RFC2890, September 2000,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2890">http://www.rfc-editor.org/info/rfc2890</a>&gt;.

   [<a id="ref-RFC4291">RFC4291</a>]  Hinden, R. and S. Deering, "IP Version 6 Addressing
              Architecture", <a href="./rfc4291">RFC 4291</a>, DOI 10.17487/RFC4291,
              February 2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4291">http://www.rfc-editor.org/info/rfc4291</a>&gt;.

   [<a id="ref-RFC4632">RFC4632</a>]  Fuller, V. and T. Li, "Classless Inter-domain Routing
              (CIDR): The Internet Address Assignment and Aggregation
              Plan", <a href="https://www.rfc-editor.org/bcp/bcp122">BCP 122</a>, <a href="./rfc4632">RFC 4632</a>, DOI 10.17487/RFC4632,
              August 2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4632">http://www.rfc-editor.org/info/rfc4632</a>&gt;.

   [<a id="ref-TR-069">TR-069</a>]   Broadband Forum, "CPE WAN Management Protocol", Issue: 1
              Amendment 5, November 2013,
              &lt;<a href="https://www.broadband-forum.org/technical/download/TR-069_Amendment-5.pdf">https://www.broadband-forum.org/technical/download/</a>
              <a href="https://www.broadband-forum.org/technical/download/TR-069_Amendment-5.pdf">TR-069_Amendment-5.pdf</a>&gt;.

   [<a id="ref-TS23.401">TS23.401</a>] 3GPP TS23.401, "General Packet Radio Service (GPRS)
              enhancements for Evolved Universal Terrestrial Radio
              Access Network (E-UTRAN) access", v11.7.0, September 2013.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-802Type">802Type</a>]  IANA, "IEEE 802 Numbers",
              &lt;<a href="http://www.iana.org/assignments/ieee-802-numbers">http://www.iana.org/assignments/ieee-802-numbers</a>&gt;.

   [<a id="ref-ANSI-X9.31-1998">ANSI-X9.31-1998</a>]
              ANSI Standard X9.31-1998, "Digital Signatures Using
              Reversible Public Key Cryptography for the Financial
              Services Industry (rDSA)", 1998.

   [<a id="ref-RFC2724">RFC2724</a>]  Handelman, S., Stibler, S., Brownlee, N., and G. Ruth,
              "RTFM: New Attributes for Traffic Flow Measurement",
              <a href="./rfc2724">RFC 2724</a>, DOI 10.17487/RFC2724, October 1999,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2724">http://www.rfc-editor.org/info/rfc2724</a>&gt;.

   [<a id="ref-RFC6320">RFC6320</a>]  Wadhwa, S., Moisand, J., Haag, T., Voigt, N., and T.
              Taylor, Ed., "Protocol for Access Node Control Mechanism
              in Broadband Networks", <a href="./rfc6320">RFC 6320</a>, DOI 10.17487/RFC6320,
              October 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6320">http://www.rfc-editor.org/info/rfc6320</a>&gt;.





<span class="grey">Leymann, et al.               Informational                    [Page 42]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-43"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


   [<a id="ref-RFC6733">RFC6733</a>]  Fajardo, V., Ed., Arkko, J., Loughney, J., and G. Zorn,
              Ed., "Diameter Base Protocol", <a href="./rfc6733">RFC 6733</a>,
              DOI 10.17487/RFC6733, October 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6733">http://www.rfc-editor.org/info/rfc6733</a>&gt;.

   [<a id="ref-RFC7031">RFC7031</a>]  Mrugalski, T. and K. Kinnear, "DHCPv6 Failover
              Requirements", <a href="./rfc7031">RFC 7031</a>, DOI 10.17487/RFC7031,
              September 2013, &lt;<a href="http://www.rfc-editor.org/info/rfc7031">http://www.rfc-editor.org/info/rfc7031</a>&gt;.

   [<a id="ref-RFC7676">RFC7676</a>]  Pignataro, C., Bonica, R., and S. Krishnan, "IPv6 Support
              for Generic Routing Encapsulation (GRE)", <a href="./rfc7676">RFC 7676</a>,
              DOI 10.17487/RFC7676, October 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7676">http://www.rfc-editor.org/info/rfc7676</a>&gt;.

Contributors

   Li Xue
   Individual
   Email: xueli_jas@163.com


   Zhongwen Jiang
   Huawei Technologies
   Email: jiangzhongwen@huawei.com



























<span class="grey">Leymann, et al.               Informational                    [Page 43]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-44"></span>
<span class="grey"><a href="./rfc8157">RFC 8157</a>                   GRE Tunnel Bonding                   May 2017</span>


Authors' Addresses

   Nicolai Leymann
   Deutsche Telekom AG
   Winterfeldtstrasse 21-27
   Berlin  10781
   Germany
   Phone: +49-170-2275345
   Email: n.leymann@telekom.de


   Cornelius Heidemann
   Deutsche Telekom AG
   Heinrich-Hertz-Strasse 3-7
   Darmstadt  64295
   Germany
   Phone: +49-6151-5812721
   Email: heidemannc@telekom.de


   Mingui Zhang
   Huawei Technologies
   No. 156 Beiqing Rd.
   Haidian District
   Beijing  100095
   China
   Email: zhangmingui@huawei.com


   Behcet Sarikaya
   Huawei USA
   5340 Legacy Dr. Building 3
   Plano, TX  75024
   United States of America
   Email: sarikaya@ieee.org


   Margaret Cullen
   Painless Security
   14 Summer St. Suite 202
   Malden, MA  02148
   United States of America
   Email: margaret@painless-security.com








Leymann, et al.               Informational                    [Page 44]
</pre>
</body></html>