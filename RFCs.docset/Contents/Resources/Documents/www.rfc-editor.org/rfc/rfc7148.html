<html><head></head><body><pre>Internet Engineering Task Force (IETF)                           X. Zhou
Request for Comments: 7148                               ZTE Corporation
Category: Standards Track                                    J. Korhonen
ISSN: 2070-1721                                                 Broadcom
                                                             C. Williams
                                                              Consultant
                                                           S. Gundavelli
                                                                   Cisco
                                                           CJ. Bernardos
                                                                    UC3M
                                                              March 2014


            <span class="h1">Prefix Delegation Support for Proxy Mobile IPv6</span>

Abstract

   This specification defines extensions to the Proxy Mobile IPv6
   protocol for allowing a mobile router in a Proxy Mobile IPv6 domain
   to obtain IP prefixes for its attached mobile networks using DHCPv6
   prefix delegation.  Network-based mobility management support is
   provided for those delegated IP prefixes just as it is provided for
   the mobile node's home address.  Even if the mobile router performs a
   handoff and changes its network point of attachment, mobility support
   is ensured for all the delegated IP prefixes and for all the IP nodes
   in the mobile network that use IP address configuration from those
   delegated IP prefixes.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7148">http://www.rfc-editor.org/info/rfc7148</a>.










<span class="grey">Zhou, et al.                 Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Zhou, et al.                 Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-6">6</a>
   <a href="#section-3">3</a>. Solution Overview ...............................................<a href="#page-7">7</a>
      <a href="#section-3.1">3.1</a>. Stated Assumptions .........................................<a href="#page-7">7</a>
      <a href="#section-3.2">3.2</a>. Deployment Models ..........................................<a href="#page-8">8</a>
           3.2.1. Delegating Router Co-located with Mobile
                  Access Gateway ......................................<a href="#page-8">8</a>
           3.2.2. Delegating Router Co-located with Local
                  Mobility Anchor .....................................<a href="#page-9">9</a>
           3.2.3. Static Configuration of Delegated Mobile
                  Network Prefixes ...................................<a href="#page-12">12</a>
   <a href="#section-4">4</a>. Message Formats ................................................<a href="#page-12">12</a>
      <a href="#section-4.1">4.1</a>. Delegated Mobile Network Prefix Option ....................<a href="#page-12">12</a>
      <a href="#section-4.2">4.2</a>. Status Codes ..............................................<a href="#page-14">14</a>
   <a href="#section-5">5</a>. Operational Details ............................................<a href="#page-14">14</a>
      <a href="#section-5.1">5.1</a>. MAG Considerations ........................................<a href="#page-14">14</a>
           5.1.1. Extension to Binding Update List Entry Data
                  Structure ..........................................<a href="#page-14">14</a>
           <a href="#section-5.1.2">5.1.2</a>. Signaling Considerations ...........................<a href="#page-14">14</a>
           <a href="#section-5.1.3">5.1.3</a>. DHCP -- MAG Interactions ...........................<a href="#page-16">16</a>
                  5.1.3.1. Delegating Router Co-located with
                           Mobile Access Gateway .....................<a href="#page-17">17</a>
                  5.1.3.2. Delegating Router Co-Located with
                           Local Mobility Anchor .....................<a href="#page-18">18</a>
           <a href="#section-5.1.4">5.1.4</a>. Packet Forwarding ..................................<a href="#page-19">19</a>
      <a href="#section-5.2">5.2</a>. LMA Considerations ........................................<a href="#page-20">20</a>
           <a href="#section-5.2.1">5.2.1</a>. Extensions to Binding Cache Entry Data Structure ...<a href="#page-20">20</a>
           <a href="#section-5.2.2">5.2.2</a>. Signaling Considerations ...........................<a href="#page-20">20</a>
           <a href="#section-5.2.3">5.2.3</a>. Packet Forwarding ..................................<a href="#page-22">22</a>
      <a href="#section-5.3">5.3</a>. Security Policy Database (SPD) Example Entries ............<a href="#page-22">22</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-23">23</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-24">24</a>
   <a href="#section-8">8</a>. Acknowledgements ...............................................<a href="#page-24">24</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-25">25</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-25">25</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-26">26</a>













<span class="grey">Zhou, et al.                 Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Proxy Mobile IPv6 [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] enables network-based mobility management
   support for an IP host without requiring its participation in any IP
   mobility signaling.  In Proxy Mobile IPv6 (PMIPv6), the mobile access
   gateway (MAG) performs the mobility management function on behalf of
   the mobile node (MN).  The local mobility anchor (LMA) is the home
   agent for the MN and the topological anchor point.  The mobility
   elements (LMA and MAGs) in the network allow an IP host to obtain an
   IPv4 address and/or a set of IPv6 addresses and be able to obtain IP
   mobility support for those IP address(es) within the Proxy Mobile
   IPv6 domain.  In this context, the mobility management support is
   enabled for an individual IP host, which is the mobile node.  The
   IPv4 home address or the IPv6 home network prefixes are logically
   bound to the link shared between the mobile access gateway and the
   mobile node, and only the mobile node can use those IP address(es) by
   configuring them on the interface attached to that link.  Currently,
   there is no mobility support for the mobile networks attached to a
   mobile router (MR) in a Proxy Mobile IPv6 domain.

   This specification defines extensions to the Proxy Mobile IPv6
   protocol for allowing mobility support to the mobile networks
   attached to a mobile router.  These extension include definition of a
   new mobility option that can be exchanged in the signaling messages
   between the mobile access gateway and the local mobility anchor.  The
   mobile router can request the mobility entities in the Proxy Mobile
   IPv6 domain for delegated IP prefix(es) using DHCP prefix delegation
   extensions [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], static configuration of the prefixes, or
   mechanisms specific to the access technology.  The mobility entities
   in the PMIPv6 network provide network-based mobility management
   support for those delegated prefixes just as it is supported for a
   home address.  The delegated prefixes are hosted in the mobile
   network attached to the mobile router.  IP mobility is ensured for
   all the IP nodes in the mobile network, even as the mobile router
   performs a handoff by changing its point of network attachment within
   the Proxy Mobile IPv6 domain.  The local mobility anchor in the Proxy
   Mobile IPv6 domain will not track the individual IP nodes in the
   mobile network; it only tracks a single mobile router session that is
   hosting the mobile network and associates the delegated IP prefixes
   with that session.  Although the protocol solution defined in this
   specification also allows signaling IPv4 subnets between the mobile
   access gateway and the local mobility anchor, the delegation of IPv4
   subnets to the mobile router is out of the scope of this
   specification.







<span class="grey">Zhou, et al.                 Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


                                      _----_
                       +-------+    _(      )_
                       |       |---( Internet )
                       |  LMA  |    (_      _)
                       |       |      '----'
                       +-------+
                           |
                      === === ===
                   ==    Proxy    ==
                ==    Mobile IPv6    ==
                   ==    Domain   ==
                      === === ===
                ___________|___________
               |                       |
           +-------+               +-------+
           |  MAG  |               |  MAG  |
           +-------+               +-------+
               .
               .
        - - - - - - - -
       |   +------+    |
       |   |  MR  |    |
       |   +------+    |
       |       |       |
       |    -------    |
       |    |     |    |
       |   LFN   LFN   |
        - - - - - - - -

            Figure 1: Mobile Router in Proxy Mobile IPv6 Domain

   Within the context of this document, the definition of a mobile
   router extends the definition of a mobile node from [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>]  by
   adding routing capability between the mobile network and the point of
   attachment of the mobile router.  Local fixed nodes (LFNs) are IP
   nodes in the mobile network; LFNs all move with the mobile router as
   a single cluster.  As the mobile router moves, the LFNs are not aware
   of the mobility of the MR to a new point of attachment.  Figure 1
   illustrates a mobile router in a Proxy Mobile IPv6 domain.

   The rest of this document identifies the protocol extensions and the
   operational details of the local mobility anchor and mobile access
   gateway for realizing prefix delegation support for Proxy Mobile
   IPv6.







<span class="grey">Zhou, et al.                 Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   All the mobility-related terms used in this document are to be
   interpreted as defined in Proxy Mobile IPv6 specifications [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>]
   and [<a href="./rfc5844" title='"IPv4 Support for Proxy Mobile IPv6"'>RFC5844</a>].  All the DHCP-related terms are to be interpreted as
   defined in DHCPv6 Prefix Delegation for Network Mobility (NEMO)
   [<a href="./rfc6276" title='"DHCPv6 Prefix Delegation for Network Mobility (NEMO)"'>RFC6276</a>], DHCPv6 Prefix Delegation (DHCPv6PD) [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], and Subnet
   Allocation Option for DHCPv4 [<a href="./rfc6656" title="&quot;Description of Cisco Systems' Subnet Allocation Option for DHCPv4&quot;">RFC6656</a>].  This document also provides
   a context-specific explanation of the following terms used here and
   originally defined in the Mobile Network terminology document
   [<a href="./rfc4885" title='"Network Mobility Support Terminology"'>RFC4885</a>].

   Mobile Router (MR)

      The term "mobile router" is used to refer to an IP router whose
      mobility is managed by the network while being attached to a Proxy
      Mobile IPv6 domain.  The mobile router is a mobile node as defined
      in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] but with additional capabilities for supporting an
      attached mobile network.  The MR's interface used for attachment
      to the mobile access gateway is referred to as the "egress
      interface".  Any MR's interface used for attachment to the mobile
      network is referred to as the "ingress interface".  The mobility
      entities in the Proxy Mobile IPv6 domain provide mobility for the
      IPv4/IPv6 address(es) assigned to the mobile node's egress link
      and also mobility support to the network prefixes hosted in the
      network attached to the mobile router.

   Mobile Network

      A mobile network is an IP network attached to a mobile router.
      There can be many IP nodes in this IP network.  The mobile router
      is a gateway for these IP nodes for reaching other IP networks or
      the Internet.  The mobile router and the attached IP networks move
      as a single cluster.

   Delegated Mobile Network Prefix (DMNP)

      The Delegated Mobile Network Prefix is an IPv4/IPv6 prefix
      delegated to a mobile router and is hosted in the mobile network.
      The IP nodes in the mobile network will be able to obtain IP
      address configuration from the DMNP and will have IP mobility
      support for that address configuration.  The DMNP is topologically
      anchored on the local mobility anchor, and the mobility elements




<span class="grey">Zhou, et al.                 Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


      in the Proxy Mobile IPv6 domain provide IP mobility support for
      the prefix by forwarding the mobile network traffic to the mobile
      router.

   Local Fixed Node (LFN)

      A local fixed node is an IP node in the mobile network.  As the
      mobile router performs a handoff and changes its network point of
      attachment, the local fixed node moves along with the mobile
      router.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Solution%20Overview"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Solution Overview</span>

   This section lists the stated assumptions and provides an overview of
   the operation of this specification.  This document references three
   different deployment scenarios and explains the protocol operation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20Stated%20Assumptions"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Stated Assumptions</span>

   o  The mobile router is a mobile node as defined in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] but
      with additional capabilities for routing IP packets between its
      egress interface (interface used for attachment to the mobile
      access gateway) and any of its ingress interfaces (interfaces used
      for attachment to the mobile network).

   o  This specification assumes that a mobile router is an IPv4 and/or
      IPv6 router without any capability for mobility management.

   o  The mobile router can obtain the delegated IP prefix(es) for its
      attached mobile networks using DHCPv6 prefix delegation, static
      configuration, or mechanisms specific to access technology.  This
      document assumes DHCPv6 prefix delegation [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>] in conjunction
      with the Prefix Exclude Option [<a href="./rfc6603" title='"Prefix Exclude Option for DHCPv6-based Prefix Delegation"'>RFC6603</a>] as the default mechanism
      for prefix assignment to the mobile node.  It defines an
      interworking between the mobility entities and the DHCPv6
      functional elements in a non-normative way.  The mechanism that
      delegates IPv4 subnets to a mobile router is out of the scope of
      this specification.

   o  The mobile router obtains the IP address configuration for its
      egress roaming interface as specified in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] and [<a href="./rfc5844" title='"IPv4 Support for Proxy Mobile IPv6"'>RFC5844</a>].
      The mobile router, along with its mobile networks, will be able to
      perform handoff, change its point of attachment in the network,
      and retain IP mobility support.

   o  When using DHCPv6 prefix delegation, this document assumes that
      the mobile router uses its egress interface when making DHCPv6
      requests.



<span class="grey">Zhou, et al.                 Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20Deployment%20Models"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Deployment Models</span>

   This section explains the protocol operation used to support prefix
   delegation in Proxy Mobile IPv6 for the following three deployment
   models: i) delegating router co-located with mobile access gateway,
   ii) delegating router co-located with local mobility anchor, and iii)
   static configuration of delegated prefixes.  High-level message call
   flows between the mobile router, mobile access gateway, and the local
   mobility anchor are presented while explaining the protocol
   operation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.1.%20%20Delegating%20Router%20Co-located%20with%20Mobile%20Access%20Gateway"></a><a class="selflink" href="#section-3.2.1" id="section-3.2.1">3.2.1</a>.  Delegating Router Co-located with Mobile Access Gateway</span>

   In this deployment scenario, the delegating router (DR) function, as
   specified in [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], is co-located with the mobile access gateway,
   and a requesting router (RR) function is enabled on the mobile
   router.

   Figure 2 shows the high-level message call flow for this case.  The
   mobile router attaches to the mobile access gateway, which triggers
   the Proxy Mobile IPv6 signaling between the mobile access gateway and
   the local mobility anchor, setting up the bidirectional tunnel
   between them (regular Proxy Mobile IPv6 registration).  After that,
   the DHCPv6 requesting router function running on the mobile router
   sends a Solicit message requesting a prefix.  This message is
   received by the DHCPv6 delegating router function running on the
   mobile access gateway.  The mobile access gateway then sends a Proxy
   Binding Update message including a Delegated Mobile Network Prefix
   (DMNP) option carrying the ALL_ZERO value [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>].  This serves as
   a request for the local mobility anchor to allocate a set of
   delegated prefixes, conveyed back in one or more DMNP options in a
   Proxy Binding Acknowledgement message.  The DHCPv6-PD procedure is
   then completed as described in [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], ending with the delegating
   router sending a Reply message conveying the delegated prefixes.  If
   the requesting router includes a Rapid Commit option in its Solicit
   message, it is preferable that the MAG respond directly with a Reply
   message rather than with an Advertise message, as described in
   <a href="./rfc3315#section-17.2.3">[RFC3315], Section 17.2.3</a>.













<span class="grey">Zhou, et al.                 Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


      +-----+            +-----+                      +-----+
      | MR  |            | MAG |                      | LMA |
      |(RR) |            | (DR)|                      |     |
      +-----+            +-----+                      +-----+
   1)    |-- MN Attach -----|                            |
         |                  |--Proxy Binding Update-----&gt;|
         |                  |                            |
         |                  |&lt;-------Proxy Binding Ack.--|
         |                  |                            |
         |                  |o==========================o|
   2)    |                  |       PMIPv6 tunnel        |
         |                  |o==========================o|
   3)    |--Solicit for----&gt;|                            |
         | delegated prefix |                            |
   4)    |                  |--Proxy Binding Update-----&gt;|
         |                  |                            |
   5)    |                  |&lt;--Proxy Binding Ack.(DMNP)-|
         |                  |                            |
         -                  -&lt;---+                       |
   6)    |&lt;------Advertise--|    |                       |
         |                  |    |                       |
   7)    |--Request--------&gt;| Optional                   |
         |                  |    |                       |
         -                  -&lt;---+                       |
   8)    |&lt;---Reply (DMNP)--|                            |
         |                  |                            |

     Figure 2: Delegating Router Co-located with Mobile Access Gateway

   From an operational point of view, this is the simplest deployment
   option, as it keeps a single protocol interface between the mobile
   access gateway and the local mobility anchor.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.2.%20%20Delegating%20Router%20Co-located%20with%20Local%20Mobility%20Anchor"></a><a class="selflink" href="#section-3.2.2" id="section-3.2.2">3.2.2</a>.  Delegating Router Co-located with Local Mobility Anchor</span>

   In this deployment scenario, the delegating router (DR) function, as
   specified in [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], is co-located with the local mobility anchor;
   the requesting router (RR) function is enabled on the mobile router;
   and a DHCPv6 relay agent (DRA) function is co-located on the mobile
   access gateway.

   Figure 3 shows the high-level message call flow for this case.  The
   mobile router attaches to the mobile access gateway, which triggers
   the Proxy Mobile IPv6 signaling between the mobile access gateway and
   the local mobility anchor, setting up the bidirectional tunnel
   between them (regular Proxy Mobile IPv6 registration).  After that,
   the DHCPv6 requesting router function running on the mobile router
   requests a prefix by sending a Solicit message.  This message is



<span class="grey">Zhou, et al.                 Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   received by the DHCPv6 relay agent function running on the mobile
   access gateway, which then completes the DHCPv6 signaling, according
   to [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>].  The relay agent function SHOULD include the relay
   agent remote-id option [<a href="./rfc4649" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Relay Agent Remote-ID Option"'>RFC4649</a>] into Relay-forward messages with
   appropriate identity information to enable correlation of mobile
   router identities used over DHCPv6 and PMIPv6.

   Once the mobile access gateway gets the set of delegated prefixes
   from the delegating router function running on the local mobility
   anchor, the MAG conveys the delegated prefixes in a Proxy Binding
   Update.  This ensures that the local mobility anchor properly routes
   the traffic addressed to the delegated prefixes via the PMIPv6 tunnel
   established with the mobile access gateway and that mobility is
   provided to these prefixes while the mobile router roams within the
   PMIPv6 domain.  Note that the relay agent function in the mobile
   access gateway has to queue the Reply message for the duration of the
   PMIPv6 signaling (steps 10 and 11) before forwarding the Reply
   message to the requesting router.  While this does not change
   anything from the DHCPv6-PD protocol's point of view, implementations
   will need to account for interactions between the timing of PMIPv6
   signaling and the DHCPv6 timeout/retry logic.






























<span class="grey">Zhou, et al.                 Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


      +-----+            +-----+                    +-----+
      | MR  |            | MAG |                    | LMA |
      |(RR) |            |(DRA)|                    |(DR) |
      +-----+            +-----+                    +-----+
   1)    |-- MN Attach -----|                          |
         |                  |--------- PBU -----------&gt;|
         |                  |                          |
         |                  |&lt;-------- PBA ------------|
         |                  |                          |
         |                  |o========================o|
   2)    |                  |      PMIPv6 tunnel       |
         |                  |o========================o|
   3)    |-- Solicit for --&gt;|                          |
         | delegated prefix |                          |
   4)    |                  |--- Solicit -------------&gt;|
         -                  -                          - &lt;---+
   5)    |                  |&lt;-- Advertise ------------|     |
         |                  |                          |     |
   6)    |&lt;- Advertise -----|                          |     |
         |                  |                          |  Optional
   7)    |-- Request ------&gt;|                          |     |
         |                  |                          |     |
   8)    |                  |--- Request -------------&gt;|     |
         -                  -                          - &lt;---+
   9)    |                  |&lt;-- Reply (DMNP) ---------|
         |                  |                          |
   10)   |                  |----------PBU (DMNP)-----&gt;|
         |                  |                          |
   11)   |                  |&lt;---------PBA (DMNP)------|
         |                  |                          |
   12)   |&lt;-- Reply (DMNP) -|                          |
         |                  |                          |

     Figure 3: Delegating Router Co-located with Local Mobility Anchor

   The DR function can also be located in other entities of the home
   network aside from the LMA.  This deployment model requires some
   interworking between the DR and the LMA and is out of the scope of
   this specification.  Note that this additional interworking would
   have no impact on the protocol between the LMA and MAG defined in
   this document.










<span class="grey">Zhou, et al.                 Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.3.%20%20Static%20Configuration%20of%20Delegated%20Mobile%20Network%20Prefixes"></a><a class="selflink" href="#section-3.2.3" id="section-3.2.3">3.2.3</a>.  Static Configuration of Delegated Mobile Network Prefixes</span>

   In this deployment scenario, the DMNPs of the mobile router are
   statically configured in the mobile node's policy profile [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>].
   The DMNPs are statically configured in the mobile network attached to
   the mobile router.  The mobile router is the default-router for the
   mobile networks.

   Figure 4 shows a high-level message call flow for this example.  The
   mobile access gateway obtains statically configured mobile network
   prefixes from the policy profile and registers them with the local
   mobility anchor using the extensions specified in this document, that
   is, the use of the Delegated Mobile Network Prefix (DMNP) option in
   the Proxy Mobile IPv6 signaling.  There is no explicit trigger from
   the mobile router for registering or de-registering those prefixes.
   As long as there is a mobility session for the mobile router's home
   address, the local mobility anchor enables mobility support for the
   mobile network prefixes.

      +-----+            +-----+                    +-----+
      | MR  |            | MAG |                    | LMA |
      |     |            |     |                    |     |
      +-----+            +-----+                    +-----+
   1)    |-- MN Attach -----|                          |
   2)    |                  - (Policy Profile)         |
         |                  |                          |
   3)    |                  |--------- PBU (DMNP) ----&gt;|
         |                  |                          |
   4)    |                  |&lt;-------- PBA (DMNP) -----|
         |                  |                          |
         |                  |o========================o|
   5)    |                  |      PMIPv6 tunnel       |
         |                  |o========================o|
         |                  |                          |

    Figure 4: Static Configuration of Delegated Mobile Network Prefixes

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Message%20Formats"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Message Formats</span>

   This section defines extensions to Proxy Mobile IPv6 [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>]
   protocol messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Delegated%20Mobile%20Network%20Prefix%20Option"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Delegated Mobile Network Prefix Option</span>

   A new mobility header option, the Delegated Mobile Network Prefix
   option, is defined for use with Proxy Binding Update and Proxy
   Binding Acknowledgement messages exchanged between a local mobility
   anchor and a mobile access gateway.  This option is used for



<span class="grey">Zhou, et al.                 Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   exchanging the mobile router's IPv4/IPv6 DMNP.  There can be multiple
   instances of the Delegated Mobile Network Prefix option present in a
   message.

   The Delegated Mobile Network Prefix option has an alignment
   requirement of 8n+2.  Its format is as follows:

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |   Length      |V|  Reserved   | Prefix Length |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   .                                                               .
   +           IPv4 or IPv6 Delegated Mobile Network Prefix        +
   |                         (DMNP)                                |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type

      55

   Length

      8-bit unsigned integer indicating the length of the option in
      octets, excluding the Type and Length fields.

   IPv4 Prefix (V)

      If the IPv4 Prefix (V) flag is set to a value of (1), then it
      indicates that the prefix that is included in the DMNP field is an
      IPv4 prefix.  If the IPv4 Prefix (V) flag is set to a value of
      (0), then it indicates that the prefix that is included in the
      DMNP field is an IPv6 prefix.

   Reserved

      This field is unused for now.  The value MUST be initialized to 0
      by the sender and MUST be ignored by the receiver.








<span class="grey">Zhou, et al.                 Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   Prefix Length

      8-bit unsigned integer indicating the number of leftmost bits
      covering the network part of the address contained in the Prefix
      field.

   Delegated Mobile Network Prefix

      Contains a mobile router's 4-byte IPv4 or a 16-byte IPv6 Delegated
      Mobile Network Prefix.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Status%20Codes"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Status Codes</span>

   This document defines the following new status code values for use in
   the Proxy Binding Acknowledgement message.  These values have been
   allocated from the same number space as defined in <a href="./rfc6275#section-6.1.8">Section 6.1.8 of
   [RFC6275]</a>.

   NOT_AUTHORIZED_FOR_DELEGATED_MNP: 177

      Not authorized for DMNP

   REQUESTED_DMNP_IN_USE: 178

      Requested DMNP is in use

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Operational%20Details"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Operational Details</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20MAG%20Considerations"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  MAG Considerations</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.1.%20%20Extension%20to%20Binding%20Update%20List%20Entry%20Data%20Structure"></a><a class="selflink" href="#section-5.1.1" id="section-5.1.1">5.1.1</a>.  Extension to Binding Update List Entry Data Structure</span>

   In order to support this specification, the conceptual Binding Update
   List Entry (BULE) data structure [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] needs to be extended to
   include a Delegated Mobile Network Prefix (DMNP) list.  Each entry in
   the list is used for storing an IPv4/IPv6 mobile network prefix
   delegated to the mobile router.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.2.%20%20Signaling%20Considerations"></a><a class="selflink" href="#section-5.1.2" id="section-5.1.2">5.1.2</a>.  Signaling Considerations</span>

   During the mobile router's initial attachment procedure, the mobile
   access gateway obtains the mobile router's policy profile, as per the
   procedures defined in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>].  The mobile node's policy profile
   defined in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] is extended to include a parameter that
   indicates Delegated Prefix support.  If the policy profile indicates
   that the mobile router is authorized for Delegated Prefix support,
   then the considerations described next apply.




<span class="grey">Zhou, et al.                 Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   The mobile access gateway MUST include one or more Delegated Mobile
   Network Prefix (DMNP) options in the Proxy Binding Update message in
   order to request the local mobility anchor to allocate DMNP(s) for
   the mobile router.

   If the mobile access gateway requests the local mobility anchor to
   perform the prefix assignment, then:

   o  There MUST be exactly one instance of the Delegated Mobile Network
      Prefix option with an ALL_ZERO value and with the (V) flag set to
      a value of (0).  This serves as a request to the local mobility
      anchor to allocate a set of IPv6 DMNPs.

   o  There MUST be exactly one instance of the Delegated Mobile Network
      Prefix option with an ALL_ZERO value and with the (V) flag set to
      a value of (1).  This serves as a request to the local mobility
      anchor to allocate a set of IPv4 DMNP.

   o  If the received Proxy Binding Acknowledgement message has the
      status field value set to NOT_AUTHORIZED_FOR_DELEGATED_MNP (not
      authorized for DMNP), the mobile access gateway MUST NOT enable
      mobility support for any of the prefixes in the mobile network,
      and prefix delegation support has to be disabled.

   o  If the received Proxy Binding Acknowledgement message has the
      status field value set to REQUESTED_DMNP_IN_USE (Requested DMNP is
      in use), the mobile access gateway MUST NOT enable mobility
      support for the requested prefixes.  The mobile access gateway MAY
      choose to send Proxy Binding Update message requesting the local
      mobility anchor to perform the prefix assignment.

   If the mobile access gateway provides the local mobility anchor with
   the prefix(es) to be allocated, then:

   o  There MUST be exactly one instance of the Delegated Mobile Network
      Prefix option with NON_ZERO prefix value [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] for each of the
      mobile network prefixes that the mobile access gateway is
      requesting the local mobility anchor to allocate.  The prefix
      value in the option is the prefix that is either statically
      configured for that mobile router in the mobile node's policy
      profile or obtained via interactions with the DHCP PD functions.
      This serves as a request to the local mobility anchor to allocate
      the requested IPv4/IPv6 prefix.

   If the received Proxy Binding Acknowledgement message has the status
   field value set to 0 (Proxy Binding Update accepted), the mobile
   access gateway has to apply the following considerations.




<span class="grey">Zhou, et al.                 Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   o  The Delegated Mobile Network Prefix (DMNP) list in the mobile
      router's Binding Update List entry has to be updated with the
      allocated prefix(es).  However, if the received message was in
      response to a de-registration request with a lifetime value of
      (0), then the DMNP list has to be removed along with the Binding
      Update List entry.

   o  The mobile access gateway has to set up a policy-based route for
      forwarding the IP packets received from the mobile network (with
      the source IP address from any of the IPv4/IPv6 DMNPs) through the
      bidirectional tunnel set up for that mobile router.  However, if
      the received message was in response to a de-registration request
      with a lifetime value of (0), then the created forwarding state
      has to be removed.

   This specification assumes that all the mobile access gateways of a
   PMIPv6 domain support the same prefix delegation mechanism.  Any
   differences will result in DMNPs getting de-registered and the mobile
   network losing the prefix(es).  This would result in the attached
   local fixed nodes losing the assigned IP addresses.  The mobile
   router MAY explicitly deprecate these prefixes.  Alternatively, the
   lifetime of the addresses may expire.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.3.%20%20DHCP%20--%20MAG%20Interactions"></a><a class="selflink" href="#section-5.1.3" id="section-5.1.3">5.1.3</a>.  DHCP -- MAG Interactions</span>

   This section describes the interactions between the DHCP and PMIPv6
   logical entities running on the mobile access gateway.  This section
   is applicable only for deployments that use DHCPv6-based prefix
   delegation (i.e., it does not apply if static configuration is used).
   As described next, these interactions vary slightly depending on the
   considered deployment model at the mobile access gateway (described
   in <a href="#section-3.2">Section 3.2</a>).

   The mobile router, acting as a requesting router as described in
   [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>], sends a Solicit message including one or more IA_PD
   option(s) to the delegating router / DHCPv6 relay agent co-located on
   the mobile access gateway.  This message provides the needed trigger
   for the mobile access gateway to request the local mobility anchor to
   enable DMNP support for that mobility session.  We next describe the
   subsequent interactions depending on the deployment model.











<span class="grey">Zhou, et al.                 Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.3.1.%20%20Delegating%20Router%20Co-located%20with%20Mobile%20Access%20Gateway"></a><a class="selflink" href="#section-5.1.3.1" id="section-5.1.3.1">5.1.3.1</a>.  Delegating Router Co-located with Mobile Access Gateway</span>

   The mobile access gateway applies the considerations in <a href="#section-5.1.2">Section 5.1.2</a>
   for requesting the local mobility anchor to enable delegated prefix
   support.  For example, if the mobile router is soliciting an IPv4
   prefix, the mobile access gateway includes in the Proxy Binding
   Update signaling a Delegated Mobile Network Prefix option with an
   ALL_ZERO value and with the (V) flag set to a value of (1).

   The mobile access gateway, upon successfully completing the Proxy
   Binding Update signaling with the local mobility anchor (following
   the considerations described in <a href="#section-5.1.2">Section 5.1.2</a>), adds the DMNPs to the
   Binding Update List.  Then, the mobile access gateway provides the
   obtained prefixes to the DHCPv6 delegating router for prefix
   assignment.  The way in which these prefixes are passed to the DHCPv6
   delegating router function is beyond the scope of this document.

   o  In case the Proxy Binding Update signaling with the local mobility
      anchor is not completed successfully, for example, because the
      local mobility anchor is not authorized for DMNP or the requested
      prefix is in use, the DHCPv6 delegating router will send a Reply
      message to the requesting router with no IA_PREFIX suboptions and
      with a Status Code option as described in <a href="./rfc3633#section-11.2">[RFC3633], Section 11.2</a>.

   The standard DHCPv6 considerations will be applied with respect to
   the interactions between the delegating router and the requesting
   router.  The requesting router is provided with the delegated
   prefix(es), which can then be then advertised in the mobile network
   and therefore used by the local fixed nodes to autoconfigure IP
   addresses, allowing them to gain access to the Internet.

   Any time the requesting router releases the delegated prefixes, the
   delegating router removes the assigned prefixes.  To do so, the
   mobile access gateway will send an Updated Proxy Binding Update
   following the considerations described in <a href="#section-5.1.2">Section 5.1.2</a> for
   de-registering those prefixes.  The way in which the DHCPv6
   delegating router triggers the mobile access gateway in order to
   de-register the prefixes is beyond the scope of this document.

   In case the mobile router performs a handover and attaches to a
   different mobile access gateway, the following cases are possible:

   o  The new mobile access gateway does not support the delegation of
      mobile network prefixes described in this specification.  In this
      case, forwarding of the previously DMNPs is no longer performed.






<span class="grey">Zhou, et al.                 Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   o  The new mobile access gateway supports the delegation of mobile
      network prefixes described in this specification.  There are two
      possible cases upon the reception of the Solicit message by the
      delegating router.  If the MAG already knows the DMNPs, it conveys
      them in a DMNP option included in the Proxy Binding Update sent to
      the local mobility anchor, which then authorizes them based on: a)
      the content of the associated Binding Cache entry (if one exists),
      b) the user profile (if the allocation is static), or c) checking
      that the DMNPs are not already allocated.  On the other hand, if
      the mobile access gateway is not aware of the DMNPs, it will
      include 0.0.0.0 / :: in a DMNP option included in the Proxy
      Binding Update sent to the LMA, which will provide the right
      prefixes back in the Proxy Binding Acknowledgement based on a) the
      content of the associated Binding Cache entry (if one exits), b)
      the profile (if static allocation is used), or c) dynamic
      assignment.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.3.2.%20%20Delegating%20Router%20Co-Located%20with%20Local%20Mobility%20Anchor"></a><a class="selflink" href="#section-5.1.3.2" id="section-5.1.3.2">5.1.3.2</a>.  Delegating Router Co-Located with Local Mobility Anchor</span>

   A DHCPv6 relay agent function running on the mobile access gateway
   will forward the DHCP messages to the local mobility anchor that has
   the co-located delegating router function.  The requesting router and
   the delegating router complete the DHCP messages related to prefix
   delegation.

   During the DHCPv6 exchange, the standard DHCPv6 considerations apply
   with respect to the interactions between the delegating router,
   DHCPv6 relay agent, and requesting router.

   The mobile access gateway learns from the co-located DHCPv6 relay
   agent the prefixes allocated by the delegating router.  The way in
   which the mobile access gateway obtains this information from the
   DHCPv6 relay agent function is beyond the scope of this document.

   The mobile access gateway will apply the considerations in
   <a href="#section-5.1.2">Section 5.1.2</a> for requesting the local mobility anchor to enable
   delegated prefix support.  The mobile access gateway will include
   exactly one instance of the Delegated Mobile Network Prefix option
   with NON_ZERO prefix value for each of the mobile network prefixes
   that the mobile access gateway is requesting the local mobility
   anchor to allocate.  The prefix value(s) in the option will be the
   prefix(es) obtained via DHCP prefix delegation.

   The mobile access gateway, upon successfully completing the Proxy
   Binding Update signaling with the local mobility anchor, will provide
   the obtained prefixes to the DHCPv6 relay agent for prefix
   assignment.  The delegating router is provided with the delegated
   prefix(es) completing the standard DHCPv6 signaling.  These prefixes



<span class="grey">Zhou, et al.                 Standards Track                   [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   can then be advertised in the mobile network and therefore used by
   the local fixed nodes to autoconfigure IP addresses, allowing them to
   gain access to the Internet.

   o  In case the Proxy Binding Update signaling with the local mobility
      anchor is not completed successfully, for example, because the
      local mobility anchor is not authorized for DMNP, the requested
      prefix is in use, or the delegated prefix(es) do not match the
      ones allocated by DHCP prefix delegation, the DHCPv6 relay agent
      MAY send a Reply message to the requesting router with no
      IA_PREFIX suboptions and with a Status Code option as described in
      <a href="./rfc3633#section-11.2">[RFC3633], Section 11.2</a>.

   In case the mobile router performs a handover and attaches to a
   different mobile access gateway, the following cases are possible:

   o  The new mobile access gateway does not support the delegation of
      mobile network prefixes described in this specification.  In this
      case, forwarding of the previously delegated mobile network
      prefixes is no longer performed.

   o  The new mobile access gateway supports the delegation of mobile
      network prefixes described in this specification.  There are two
      possible cases upon the reception of the Solicit message by the
      DHCPv6 relay agent.  If the MAG already knows the DMNPs, it
      conveys them in a DMNP option included in the Proxy Binding Update
      sent to the local mobility anchor, which then authorizes them
      based on: a) the content of the associated Binding Cache entry (if
      one exists), b) the user profile (if the allocation is static), or
      c) checking that the DMNPs are not already allocated.  On the
      other hand, if the mobile access gateway is not aware of the
      DMNPs, it will include 0.0.0.0 / :: in a DMNP option included in
      the Proxy Binding Update sent to the LMA, which will provide the
      right prefixes back in the Proxy Binding Acknowledgement based on
      a) the content of the associated Binding Cache entry (if one
      exits), b) the profile (if static allocation is used), or c)
      dynamic assignment.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.4.%20%20Packet%20Forwarding"></a><a class="selflink" href="#section-5.1.4" id="section-5.1.4">5.1.4</a>.  Packet Forwarding</span>

   On receiving an IP packet from a mobile router, the mobile access
   gateway MUST ensure, before tunneling the packet to the local
   mobility anchor, that there is an established binding for the mobile
   router and that the source IP address of the packet is a prefix
   delegated to that mobile router.  If the source address of the
   received IP packet is not part of the DMNP, then the mobile access
   gateway MUST NOT tunnel the packet to the local mobility anchor.




<span class="grey">Zhou, et al.                 Standards Track                   [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   On receiving an IP packet from the bidirectional tunnel established
   with the local mobility anchor, the mobile access gateway MUST first
   decapsulate the packet (remove the outer header) and then use the
   destination address of the (inner) packet to forward it on the
   interface through which the mobile router is reachable.

   The above forwarding considerations are not applicable to the IP
   traffic sent/received to/from the mobile router's home address (IPv4
   HoA / Home Network Prefix (HNP)).  For the mobile router's home
   address traffic, forwarding considerations from [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] and
   [<a href="./rfc5844" title='"IPv4 Support for Proxy Mobile IPv6"'>RFC5844</a>] continue to apply.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20LMA%20Considerations"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  LMA Considerations</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.1.%20%20Extensions%20to%20Binding%20Cache%20Entry%20Data%20Structure"></a><a class="selflink" href="#section-5.2.1" id="section-5.2.1">5.2.1</a>.  Extensions to Binding Cache Entry Data Structure</span>

   In order to support this specification, the conceptual Binding Cache
   entry (BCE) data structure [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] needs to be extended to include
   the Delegated Mobile Network Prefix (DMNP) list.  Each entry in the
   list represents a DMNP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.2.%20%20Signaling%20Considerations"></a><a class="selflink" href="#section-5.2.2" id="section-5.2.2">5.2.2</a>.  Signaling Considerations</span>

   If the Proxy Binding Update message does not include any Delegated
   Mobile Network Prefix option(s) (<a href="#section-4.1">Section 4.1</a>), then the local
   mobility anchor MUST NOT enable Delegated Prefix support for the
   mobility session, and the Proxy Binding Acknowledgement message that
   is sent in response MUST NOT contain any Delegated Mobile Network
   Prefix option(s).

   If the Proxy Binding Update message includes one or more Delegated
   Mobile Network Prefix options, but the local mobility anchor is not
   configured with Delegated Prefix support, then the local mobility
   anchor will ignore the option(s) and process the rest of the option
   as specified in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>].  This would have no effect on the
   operation of the rest of the protocol.  The Proxy Binding
   Acknowledgement message that is sent in response will not include any
   Delegated Mobile Network Prefix option(s).

   If the Proxy Binding Update message has the Delegated Mobile Network
   Prefix option(s) and if the local mobility anchor is configured for
   Delegated Prefix support, then the local mobility anchor MUST enable
   the Delegated Mobile Network Prefix option for that mobility session.
   The Proxy Binding Acknowledgement message that is sent in response
   MUST include the Delegated Mobile Network Prefix option(s).  The
   following considerations apply.





<span class="grey">Zhou, et al.                 Standards Track                   [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   o  If there is at least one instance of the Delegated Mobile Network
      Prefix option with an ALL_ZERO [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] prefix value, then this
      serves as a request for the local mobility anchor to perform the
      assignment of one or more DMNPs.

      *  A Delegated Mobile Network option with an ALL_ZERO value and
         with the (V) flag set to a value of (0) is a request for the
         local mobility anchor to allocate one or more IPv6 prefixes.

      *  A Delegated Mobile Network option with an ALL_ZERO value and
         with the (V) flag set to a value of (1) is a request for the
         local mobility anchor to allocate one or more IPv4 prefixes.

      *  Inclusion of multiple instances of Delegated Mobile Network
         options with ALL_ZERO values, one with the (V) flag set to a
         value of (1) and another instance with the (V) flag set to a
         value of (0), is a request to allocate both IPv4 and IPv6
         prefixes.

   o  If there are no instances of the Delegated Mobile Network Prefix
      option present in the request with an ALL_ZERO value but a
      specific prefix value exists, then this serves as a request for
      the local mobility anchor to perform the allocation of the
      requested prefix(es).

      *  If any one of the requested prefixes are assigned to some other
         mobility node, or not from an authorized pool that the local
         mobility can allocate for that mobility session, then the Proxy
         Binding Update MUST be rejected by sending a Proxy Binding
         Acknowledgement message with the Status field set to
         REQUESTED_DMNP_IN_USE (Requested DMNP is in use).

   Upon accepting the Proxy Binding Update, the local mobility anchor
   MUST send a Proxy Binding Acknowledgement message with the Status
   field set to 0 (Proxy Binding Update accepted).

   o  The message MUST include one instance of the Delegated Mobile
      Network Prefix option for each of the allocated IPv4/IPv6 DMNPs.

   o  The Delegated Mobile Network Prefix (DMNP) list in the mobile
      router's Binding Cache entry has to be updated with the allocated
      prefix(es).  However, if the request is a de-registration request
      with a lifetime value of (0), the DMNP list has to be removed
      along with the Binding Cache entry.







<span class="grey">Zhou, et al.                 Standards Track                   [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   o  A route (or a platform-specific equivalent function that sets up
      the forwarding) for each of the allocated prefixes over the tunnel
      has to be added.  However, if the request is a de-registration
      request, with a lifetime value of (0), all the IPv4/IPv6 delegated
      prefix routes created for that session have to be removed.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.3.%20%20Packet%20Forwarding"></a><a class="selflink" href="#section-5.2.3" id="section-5.2.3">5.2.3</a>.  Packet Forwarding</span>

   The local mobility anchor MUST advertise a connected route into the
   routing infrastructure for the IP prefixes delegated to all of the
   mobile routers that it is serving.  This step essentially enables the
   local mobility anchor to be a routing anchor for those IP prefixes
   and be able to intercept IP packets sent to those mobile networks.

   On receiving a packet from a correspondent node with the destination
   address matching any of the mobile router's DMNPs, the local mobility
   anchor MUST forward the packet through the bidirectional tunnel set
   up with the mobile access gateway where the mobile router is
   attached.

   On receiving an IP packet from the bidirectional tunnel established
   with the mobile access gateway, the local mobility anchor MUST first
   decapsulate the packet (remove the outer header) and then use the
   destination address of the (inner) packet for forwarding decisions.
   The local mobility anchor MUST ensure that there is an established
   binding for the mobile router and that the source IP address of the
   packet is a prefix delegated to a mobile router reachable over that
   bidirectional tunnel.

   The above forwarding considerations are not applicable to the IP
   traffic sent/received to/from the mobile router's home address (IPv4
   HoA/HNP).  For the mobile router's home address traffic, forwarding
   considerations from [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] and [<a href="./rfc5844" title='"IPv4 Support for Proxy Mobile IPv6"'>RFC5844</a>] continue to apply.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20Security%20Policy%20Database%20%28SPD%29%20Example%20Entries"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  Security Policy Database (SPD) Example Entries</span>

   The use of DHCPv6, as described in this document, requires message
   integrity protection and source authentication.  The IPsec security
   mechanism used by Proxy Mobile IPv6 [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] for securing the
   signaling messages between the mobile access gateway and the local
   mobility anchor can be used for securing the DHCP signaling between
   the mobile access gateway and the local mobility anchor.

   The Security Policy Database (SPD) and Security Association Database
   (SAD) entries necessary to protect the DHCP signaling is specified
   below.  The format of these entries is based on [<a href="./rfc4877" title='"Mobile IPv6 Operation with IKEv2 and the Revised IPsec Architecture"'>RFC4877</a>]
   conventions.  The SPD and SAD entries are only example
   configurations.  A particular implementation of mobile access gateway



<span class="grey">Zhou, et al.                 Standards Track                   [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   and local mobility anchor implementation can configure different SPD
   and SAD entries as long as they provide the required security for
   protecting DHCP signaling messages.

   For the examples described in this document, a mobile access gateway
   with address "mag_address_1" and a local mobility anchor with address
   "lma_address_1" are assumed.

      mobile access gateway SPD-S:
        - IF local_address = mag_address_1 &amp;
             remote_address = lma_address_1 &amp; proto = UDP &amp;
             local_port = any &amp; remote_port = DHCP
          Then use SA1 (OUT) and SA2 (IN)

      mobile access gateway SAD:
        - SA1(OUT, spi_a, lma_address_1, ESP, TRANSPORT):
              local_address = mag_address_1 &amp;
              remote_address = lma_address_1 &amp;
              proto = UDP &amp; remote_port = DHCP
        - SA2(IN, spi_b, mag_address_1, ESP, TRANSPORT):
              local_address = lma_address_1 &amp;
              remote_address = mag_address_1 &amp;
              proto = UDP &amp; local_port = DHCP

      local mobility anchor SPD-S:
        - IF local_address = lma_address_1 &amp;
             remote_address = mag_address_1 &amp; proto = UDP &amp;
             local_port = DHCP &amp; remote_port = any
          Then use SA2 (OUT) and SA1 (IN)

      local mobility anchor SAD:
        - SA2(OUT, spi_b, mag_address_1, ESP, TRANSPORT):
              local_address = lma_address_1 &amp;
              remote_address = mag_address_1 &amp;
              proto = UDP &amp; local_port = DHCP
        - SA1(IN, spi_a, lma_address_1, ESP, TRANSPORT):
              local_address = mag_address_1 &amp;
              remote_address = lma_address_1 &amp;
              proto = UDP &amp; remote_port = DHCP

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Security Considerations</span>

   The Delegated Mobile Network Prefix option defined in this
   specification is for use in Proxy Binding Update and Proxy Binding
   Acknowledgement messages.  This option is carried like any other
   mobility header option as specified in [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>].  Therefore, it
   inherits from [<a href="./rfc5213" title='"Proxy Mobile IPv6"'>RFC5213</a>] its security guidelines and does not require
   any additional security considerations.



<span class="grey">Zhou, et al.                 Standards Track                   [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


   The use of DHCPv6 in this specification is as defined in the DHCPv6
   base specification [<a href="./rfc3315" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] and DHCPv6 prefix delegation
   specification [<a href="./rfc3633" title='"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6"'>RFC3633</a>].  The security considerations specified in
   those specifications apply to this document.

   If IPsec is used, the IPsec security association that is used for
   protecting the Proxy Binding Update and Proxy Binding Acknowledgement
   also needs to be used for protecting the DHCPv6 signaling between the
   mobile access gateway and the local mobility anchor.  Considerations
   specified in <a href="#section-5.3">Section 5.3</a> identify the extensions to security policy
   entries [<a href="./rfc4301" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  IANA Considerations</span>

   o  This specification defines a new mobility header option, the
      Delegated Mobile Network Prefix option.  This mobility option is
      described in <a href="#section-4.1">Section 4.1</a>.  The type value 55 for this message has
      been allocated from the "Mobility Options" registry at <a href="http://www.iana.org/assignments/mobility-parameters">http://</a>
      <a href="http://www.iana.org/assignments/mobility-parameters">www.iana.org/assignments/mobility-parameters</a>.

   o  This document also defines two new status code values for use in
      the Proxy Binding Acknowledgement message, as described in
      <a href="#section-4.2">Section 4.2</a>.  These status codes are
      NOT_AUTHORIZED_FOR_DELEGATED_MNP (not authorized for DMNP) with a
      status code value of 177 and REQUESTED_DMNP_IN_USE (Requested DMNP
      is in use) with a status code value of 178.  These values have
      been assigned from the same number space as allocated for other
      status codes [<a href="./rfc6275" title='"Mobility Support in IPv6"'>RFC6275</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Acknowledgements"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Acknowledgements</span>

   The authors would like to acknowledge Ryuji Wakikawa, Alexandru
   Petrescu, Behcet Sarikaya, Seil Jeon, Basavaraj Patil, Brian
   Haberman, and Michal Hoeft for all the discussions and reviews of
   this document.

   The work of Carlos J. Bernardos has also been partially supported by
   the European Community's Seventh Framework Programme (FP7-ICT-2009-5)
   under grant agreement n. 258053 (MEDIEVAL project) and by the
   Ministry of Science and Innovation of Spain under the QUARTET project
   (TIN2009-13992-C02-01).










<span class="grey">Zhou, et al.                 Standards Track                   [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20References"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3315">RFC3315</a>]  Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C.,
              and M. Carney, "Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6)", <a href="./rfc3315">RFC 3315</a>, July 2003.

   [<a id="ref-RFC3633">RFC3633</a>]  Troan, O. and R. Droms, "IPv6 Prefix Options for Dynamic
              Host Configuration Protocol (DHCP) version 6", <a href="./rfc3633">RFC 3633</a>,
              December 2003.

   [<a id="ref-RFC4301">RFC4301</a>]  Kent, S. and K. Seo, "Security Architecture for the
              Internet Protocol", <a href="./rfc4301">RFC 4301</a>, December 2005.

   [<a id="ref-RFC4649">RFC4649</a>]  Volz, B., "Dynamic Host Configuration Protocol for IPv6
              (DHCPv6) Relay Agent Remote-ID Option", <a href="./rfc4649">RFC 4649</a>, August
              2006.

   [<a id="ref-RFC4877">RFC4877</a>]  Devarapalli, V. and F. Dupont, "Mobile IPv6 Operation with
              IKEv2 and the Revised IPsec Architecture", <a href="./rfc4877">RFC 4877</a>, April
              2007.

   [<a id="ref-RFC5213">RFC5213</a>]  Gundavelli, S., Leung, K., Devarapalli, V., Chowdhury, K.,
              and B. Patil, "Proxy Mobile IPv6", <a href="./rfc5213">RFC 5213</a>, August 2008.

   [<a id="ref-RFC5844">RFC5844</a>]  Wakikawa, R. and S. Gundavelli, "IPv4 Support for Proxy
              Mobile IPv6", <a href="./rfc5844">RFC 5844</a>, May 2010.

   [<a id="ref-RFC6275">RFC6275</a>]  Perkins, C., Johnson, D., and J. Arkko, "Mobility Support
              in IPv6", <a href="./rfc6275">RFC 6275</a>, July 2011.

   [<a id="ref-RFC6276">RFC6276</a>]  Droms, R., Thubert, P., Dupont, F., Haddad, W., and C.
              Bernardos, "DHCPv6 Prefix Delegation for Network Mobility
              (NEMO)", <a href="./rfc6276">RFC 6276</a>, July 2011.

   [<a id="ref-RFC6603">RFC6603</a>]  Korhonen, J., Savolainen, T., Krishnan, S., and O. Troan,
              "Prefix Exclude Option for DHCPv6-based Prefix
              Delegation", <a href="./rfc6603">RFC 6603</a>, May 2012.









<span class="grey">Zhou, et al.                 Standards Track                   [Page 25]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-26"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-RFC4885">RFC4885</a>]  Ernst, T. and H-Y. Lach, "Network Mobility Support
              Terminology", <a href="./rfc4885">RFC 4885</a>, July 2007.

   [<a id="ref-RFC6656">RFC6656</a>]  Johnson, R., Kinnear, K., and M. Stapp, "Description of
              Cisco Systems' Subnet Allocation Option for DHCPv4", <a href="./rfc6656">RFC</a>
              <a href="./rfc6656">6656</a>, July 2012.











































<span class="grey">Zhou, et al.                 Standards Track                   [Page 26]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-27"></span>
<span class="grey"><a href="./rfc7148">RFC 7148</a>          Prefix Delegation Support for PMIPv6        March 2014</span>


Authors' Addresses

   Xingyue Zhou
   ZTE Corporation
   No.50 Software Avenue, Yuhuatai District
   Nanjing
   China

   Phone: +86-25-8801-4634
   EMail: zhou.xingyue@zte.com.cn


   Jouni Korhonen
   Broadcom
   Porkkalankatu 24
   Helsinki  FIN-00180
   Finland

   EMail: jouni.nospam@gmail.com


   Carl Williams
   Consultant
   San Jose, CA
   USA

   EMail: carlw@mcsr-labs.org


   Sri Gundavelli
   Cisco
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   EMail: sgundave@cisco.com


   Carlos J. Bernardos
   Universidad Carlos III de Madrid
   Av. Universidad, 30
   Leganes, Madrid  28911
   Spain

   Phone: +34 91624 6236
   EMail: cjbc@it.uc3m.es
   URI:   <a href="http://www.it.uc3m.es/cjbc/">http://www.it.uc3m.es/cjbc/</a>




Zhou, et al.                 Standards Track                   [Page 27]
</pre>
</body></html>