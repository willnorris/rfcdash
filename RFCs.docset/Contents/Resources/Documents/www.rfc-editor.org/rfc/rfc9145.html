<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9145: Integrity Protection for the Network Service Header (NSH) and Encryption of Sensitive Context Headers</title>
<meta content="Mohamed Boucadair" name="author"/>
<meta content="Tirumaleswar Reddy.K" name="author"/>
<meta content="Dan Wing" name="author"/>
<meta content="
       This specification presents an optional method to add integrity
      protection directly to the Network Service Header (NSH) used for Service
      Function Chaining (SFC). Also, this specification allows for the
      encryption of sensitive metadata (MD) that is carried in the NSH. 
    " name="description"/>
<meta content="xml2rfc 3.12.0" name="generator"/>
<meta content="Security" name="keyword"/>
<meta content="Resilience" name="keyword"/>
<meta content="Automation" name="keyword"/>
<meta content="Service delivery" name="keyword"/>
<meta content="Providers" name="keyword"/>
<meta content="Differentiated services" name="keyword"/>
<meta content="Traffic Engineering" name="keyword"/>
<meta content="Attack mitigation" name="keyword"/>
<meta content="9145" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.13
    appdirs 1.4.4
    ConfigArgParse 1.4.1
    google-i18n-address 2.4.0
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.15.1
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.4.1
    requests 2.24.0
    setuptools 40.5.0
    six 1.14.0
    WeasyPrint 52.5
-->
<link href="rfc9145.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9145" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-sfc-nsh-integrity-09" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9145</td>
<td class="center">Integrity Protection for the NSH</td>
<td class="right">December 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Boucadair, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9145">9145</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2021-12">December 2021</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Boucadair</div>
<div class="org">Orange</div>
</div>
<div class="author">
      <div class="author-name">T. Reddy.K</div>
<div class="org">Akamai</div>
</div>
<div class="author">
      <div class="author-name">D. Wing</div>
<div class="org">Citrix</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9145</h1>
<h1 id="title">Integrity Protection for the Network Service Header (NSH) and Encryption of Sensitive Context Headers</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This specification presents an optional method to add integrity
      protection directly to the Network Service Header (NSH) used for Service
      Function Chaining (SFC). Also, this specification allows for the
      encryption of sensitive metadata (MD) that is carried in the NSH.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9145">https://www.rfc-editor.org/info/rfc9145</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-terminology">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-assumptions-and-basic-requi">Assumptions and Basic Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-design-overview">Design Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="xref" href="#section-4.1">4.1</a>.  <a class="xref" href="#name-supported-security-services">Supported Security Services</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a class="xref" href="#section-4.1.1">4.1.1</a>.  <a class="xref" href="#name-encrypt-all-or-a-subset-of-">Encrypt All or a Subset of Context Headers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a class="xref" href="#section-4.1.2">4.1.2</a>.  <a class="xref" href="#name-integrity-protection">Integrity Protection</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="xref" href="#section-4.2">4.2</a>.  <a class="xref" href="#name-one-secret-key-two-security">One Secret Key, Two Security Services</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="xref" href="#section-4.3">4.3</a>.  <a class="xref" href="#name-mandatory-to-implement-auth">Mandatory-to-Implement Authenticated Encryption and HMAC Algorithms</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="xref" href="#section-4.4">4.4</a>.  <a class="xref" href="#name-key-management">Key Management</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a class="xref" href="#section-4.5">4.5</a>.  <a class="xref" href="#name-new-nsh-variable-length-con">New NSH Variable-Length Context Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a class="xref" href="#section-4.6">4.6</a>.  <a class="xref" href="#name-encapsulation-of-nsh-within">Encapsulation of NSH within NSH</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-new-nsh-variable-length-cont">New NSH Variable-Length Context Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="xref" href="#section-5.1">5.1</a>.  <a class="xref" href="#name-mac1-context-header">MAC#1 Context Header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="xref" href="#section-5.2">5.2</a>.  <a class="xref" href="#name-mac2-context-header">MAC#2 Context Header</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-timestamp-format">Timestamp Format</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-processing-rules">Processing Rules</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="xref" href="#section-7.1">7.1</a>.  <a class="xref" href="#name-generic-behavior">Generic Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="xref" href="#section-7.2">7.2</a>.  <a class="xref" href="#name-mac-nsh-data-generation">MAC NSH Data Generation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a class="xref" href="#section-7.3">7.3</a>.  <a class="xref" href="#name-encrypted-nsh-metadata-gene">Encrypted NSH Metadata Generation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a class="xref" href="#section-7.4">7.4</a>.  <a class="xref" href="#name-timestamp-for-replay-attack">Timestamp for Replay Attack Prevention</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a class="xref" href="#section-7.5">7.5</a>.  <a class="xref" href="#name-nsh-data-validation">NSH Data Validation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a class="xref" href="#section-7.6">7.6</a>.  <a class="xref" href="#name-decryption-of-nsh-metadata">Decryption of NSH Metadata</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#section-8">8</a>.  <a class="xref" href="#name-mtu-considerations">MTU Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#section-9">9</a>.  <a class="xref" href="#name-security-considerations">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="xref" href="#section-9.1">9.1</a>.  <a class="xref" href="#name-mac1">MAC#1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="xref" href="#section-9.2">9.2</a>.  <a class="xref" href="#name-mac2">MAC#2</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a class="xref" href="#section-9.3">9.3</a>.  <a class="xref" href="#name-time-synchronization">Time Synchronization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#section-10">10</a>. <a class="xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="xref" href="#section-11">11</a>. <a class="xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a class="xref" href="#section-11.1">11.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a class="xref" href="#section-11.2">11.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="xref" href="#appendix-A"></a><a class="xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="xref" href="#appendix-B"></a><a class="xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">Many advanced Service Functions (SFs) are enabled for the delivery of
      value-added services. Typically, SFs are used to meet various service
      objectives such as IP address sharing, avoiding covert channels,
      detecting Denial-of-Service (DoS) attacks and protecting network
      infrastructures against them, network slicing, etc. Because of the
      proliferation of such advanced SFs together with complex service
      deployment constraints that demand more agile service delivery
      procedures, operators need to rationalize their service delivery logic
      and control its complexity while optimizing service activation time
      cycles. The overall problem space is described in <span>[<a class="xref" href="#RFC7498">RFC7498</a>]</span>.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2"><span>[<a class="xref" href="#RFC7665">RFC7665</a>]</span> presents a data plane
      architecture addressing the problematic aspects of existing service
      deployments, including topological dependence and configuration
      complexity. It also describes an architecture for the specification,
      creation, and maintenance of Service Function Chains (SFCs) within a
      network, that is, how to define an ordered set of SFs and ordering
      constraints that must be applied to packets/flows selected as a result
      of traffic classification. <span>[<a class="xref" href="#RFC8300">RFC8300</a>]</span>
      specifies the SFC encapsulation: Network Service Header (NSH).<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The NSH data is unauthenticated and unencrypted, forcing a service
      topology that requires security and privacy to use a transport
      encapsulation that supports such features (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-8.2">Section 8.2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>).<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">Note that some transport encapsulations (e.g., IPsec) only provide
      hop-by-hop security between two SFC data plane elements (e.g., two
      Service Function Forwarders (SFFs), SFF to SF) and do not provide
      SF-to-SF security of NSH metadata. For example, if IPsec is used, SFFs
      or SFs within a Service Function Path (SFP) that are not authorized to
      access the sensitive metadata (e.g., privacy-sensitive information) will
      have access to the metadata. As a reminder, the metadata referred to is
      information that is inserted by Classifiers or intermediate SFs and
      shared with downstream SFs; such information is not visible to the
      communication endpoints (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7665#section-4.9">Section 4.9</a> of [<a class="xref" href="#RFC7665">RFC7665</a>]</span>).<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">The lack of such capability was reported during the development of
      <span>[<a class="xref" href="#RFC8300">RFC8300</a>]</span> and <span>[<a class="xref" href="#RFC8459">RFC8459</a>]</span>. The reader may refer to <span><a class="relref" href="https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04#section-3.2.1">Section 3.2.1</a> of [<a class="xref" href="#I-D.arkko-farrell-arch-model-t">INTERNET-THREAT-MODEL</a>]</span> for a discussion on the need for more awareness
      about attacks from within closed domains.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">This specification fills that gap for SFC (that is, it defines the
      "NSH Variable Header-Based Integrity" option mentioned in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-8.2.1">Section 8.2.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>). Concretely, this
      document adds integrity protection and optional encryption of sensitive
      metadata directly to the NSH (<a class="xref" href="#overview">Section 4</a>). The integrity protection covers the packet payload
      and provides replay protection (<a class="xref" href="#time">Section 7.4</a>). Thus, the NSH does not have to rely upon an
      underlying transport encapsulation for security.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">This specification introduces new Variable-Length Context Headers to
      carry fields necessary for integrity-protected NSH headers and encrypted
      Context Headers (<a class="xref" href="#new">Section 5</a>). This
      specification is only applicable to NSH MD Type 0x02 (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5">Section 2.5</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>). MTU considerations
      are discussed in <a class="xref" href="#MTU">Section 8</a>. This
      specification is not applicable to NSH MD Type 0x01 (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.4">Section 2.4</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>) because that MD
      Type only allows a Fixed-Length Context Header whose size is 16 bytes;
      that is not sufficient to accommodate both the metadata and message
      integrity of the NSH data.<a class="pilcrow" href="#section-1-7">¶</a></p>
<p id="section-1-8">This specification limits access to NSH-supplied information along an
      SFP to entities that have a need to interpret it.<a class="pilcrow" href="#section-1-8">¶</a></p>
<p id="section-1-9">The mechanism specified in this document does not preclude the use of
      transport security. Such considerations are deployment specific.<a class="pilcrow" href="#section-1-9">¶</a></p>
<p id="section-1-10">It is out of the scope of this document to specify an NSH-aware
      control plane solution.<a class="pilcrow" href="#section-1-10">¶</a></p>
</section>
<div id="notation">
<section id="section-2">
      <h2 id="name-terminology">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
      "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
      "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
      "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are
      to be interpreted as described in BCP 14 <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> when, and
      only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">This document makes use of the terms defined in <span>[<a class="xref" href="#RFC7665">RFC7665</a>]</span> and <span>[<a class="xref" href="#RFC8300">RFC8300</a>]</span>. The term "transport encapsulation" used in this
      document refers to the outer encapsulation (e.g., Generic Routing
      Encapsulation (GRE), IPsec, and Generic Protocol Extension for Virtual
      eXtensible Local Area Network (VXLAN-GPE)) that is used to carry
      NSH-encapsulated packets as per <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-4">Section 4</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>.<a class="pilcrow" href="#section-2-2">¶</a></p>
<p id="section-2-3">The document defines the following terms:<a class="pilcrow" href="#section-2-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-4">
        <dt id="section-2-4.1">SFC data plane element:</dt>
        <dd id="section-2-4.2" style="margin-left: 1.5em">Refers to NSH-aware SF, SFF,
          the SFC Proxy, or the Classifier as defined in the SFC data plane
          architecture <span>[<a class="xref" href="#RFC7665">RFC7665</a>]</span> and further refined in
          <span>[<a class="xref" href="#RFC8300">RFC8300</a>]</span>.<a class="pilcrow" href="#section-2-4.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-4.3">SFC control element:</dt>
        <dd id="section-2-4.4" style="margin-left: 1.5em">Is a logical entity that
          instructs one or more SFC data plane elements on how to process NSH
          packets within an SFC-enabled domain.<a class="pilcrow" href="#section-2-4.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-4.5">Key Identifier:</dt>
        <dd id="section-2-4.6" style="margin-left: 1.5em">Is used to identify keys to authorized entities. See, for example,
        "kid" usage in <span>[<a class="xref" href="#RFC7635">RFC7635</a>]</span>.<a class="pilcrow" href="#section-2-4.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-4.7">NSH data:</dt>
        <dd id="section-2-4.8" style="margin-left: 1.5em">The NSH is composed of a Base Header, a
          Service Path Header, and optional Context Headers. NSH data refers
          to all the above headers and the packet or frame on which the NSH is
          imposed to realize an SFP.<a class="pilcrow" href="#section-2-4.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-4.9">NSH imposer:</dt>
        <dd id="section-2-4.10" style="margin-left: 1.5em">Refers to an SFC data plane element that
          is entitled to impose the NSH with the Context Headers defined in
          this document.<a class="pilcrow" href="#section-2-4.10">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="req">
<section id="section-3">
      <h2 id="name-assumptions-and-basic-requi">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-assumptions-and-basic-requi">Assumptions and Basic Requirements</a>
      </h2>
<p id="section-3-1"><span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2">Section 2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span> specifies that the NSH
      data can be spread over three headers:<a class="pilcrow" href="#section-3-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1">Base Header:
        </dt>
        <dd id="section-3-2.2" style="margin-left: 1.5em">Provides information about the service header and the payload protocol.<a class="pilcrow" href="#section-3-2.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3">Service Path Header:
        </dt>
        <dd id="section-3-2.4" style="margin-left: 1.5em">Provides path identification and location within an SFP.<a class="pilcrow" href="#section-3-2.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.5">Context Header(s):
        </dt>
        <dd id="section-3-2.6" style="margin-left: 1.5em">Carries metadata (i.e., context data) along a service path.<a class="pilcrow" href="#section-3-2.6">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-3-3">The NSH allows sharing context information (a.k.a. metadata) with
      downstream NSH-aware data plane elements on a per-SFC/SFP basis. To that
      aim:<a class="pilcrow" href="#section-3-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-4.1">The Classifier is instructed by an SFC control element about the
          set of context information to be supplied for a given service
          function chain.<a class="pilcrow" href="#section-3-4.1">¶</a>
</li>
        <li class="normal" id="section-3-4.2">An NSH-aware SF is instructed by an SFC control element about any
          metadata it needs to attach to packets for a given service function
          chain. This instruction may occur any time during the validity
          lifetime of an SFC/SFP. For a given service function chain, the
          NSH-aware SF is also provided with an order for consuming a set of
          contexts supplied in a packet.<a class="pilcrow" href="#section-3-4.2">¶</a>
</li>
        <li class="normal" id="section-3-4.3">An NSH-aware SF can also be instructed by an SFC control element
          about the behavior it should adopt after consuming context
          information that was supplied in the NSH. For example, the context
          information can be maintained, updated, or stripped.<a class="pilcrow" href="#section-3-4.3">¶</a>
</li>
        <li class="normal" id="section-3-4.4">An SFC Proxy may be instructed by an SFC control element about
          the behavior it should adopt to process the context information that
          was supplied in the NSH on behalf of an NSH-unaware SF (e.g., the
          context information can be maintained or stripped). The SFC Proxy
          may also be instructed to add some new context information into the
          NSH on behalf of an NSH-unaware SF.<a class="pilcrow" href="#section-3-4.4">¶</a>
</li>
      </ul>
<p id="section-3-5">In reference to <a class="xref" href="#NSH">Table 1</a>:<a class="pilcrow" href="#section-3-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-6.1">Classifiers, NSH-aware SFs, and SFC proxies are entitled to
          update the Context Header(s).<a class="pilcrow" href="#section-3-6.1">¶</a>
</li>
        <li class="normal" id="section-3-6.2">Only NSH-aware SFs and SFC proxies are entitled to update the
          Service Path Header.<a class="pilcrow" href="#section-3-6.2">¶</a>
</li>
        <li class="normal" id="section-3-6.3">SFFs are entitled to modify the Base Header (TTL value, for
          example). Nevertheless, SFFs are not supposed to act on the Context
          Headers or look into the content of the Context Headers (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7665#section-4.3">Section 4.3</a> of [<a class="xref" href="#RFC7665">RFC7665</a>]</span>).<a class="pilcrow" href="#section-3-6.3">¶</a>
</li>
      </ul>
<p id="section-3-7">Thus, the following requirements:<a class="pilcrow" href="#section-3-7">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-8.1">Only Classifiers, NSH-aware SFs, and SFC proxies must be able to
          encrypt and decrypt a given Context Header.<a class="pilcrow" href="#section-3-8.1">¶</a>
</li>
        <li class="normal" id="section-3-8.2">Both encrypted and unencrypted Context Headers may be included in
          the same NSH.<a class="pilcrow" href="#section-3-8.2">¶</a>
</li>
        <li class="normal" id="section-3-8.3">The solution must provide integrity protection for the Service
          Path Header.<a class="pilcrow" href="#section-3-8.3">¶</a>
</li>
        <li class="normal" id="section-3-8.4">The solution must provide optional integrity protection for the
          Base Header. The implications of disabling such checks are discussed
          in <a class="xref" href="#mac1">Section 9.1</a>.<a class="pilcrow" href="#section-3-8.4">¶</a>
</li>
      </ul>
<span id="name-summary-of-nsh-actions"></span><div id="NSH">
<table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-summary-of-nsh-actions">Summary of NSH Actions</a>
        </caption>
<thead>
          <tr>
            <th class="text-center" colspan="1" rowspan="2">SFC Data Plane Element</th>
            <th class="text-center" colspan="3" rowspan="1">Insert, remove, or replace the NSH</th>
            <th class="text-center" colspan="2" rowspan="1">Update the NSH</th>
          </tr>
          <tr>
            <th class="text-center" colspan="1" rowspan="1">Insert</th>
            <th class="text-center" colspan="1" rowspan="1">Remove</th>
            <th class="text-center" colspan="1" rowspan="1">Replace</th>
            <th class="text-center" colspan="1" rowspan="1">Decrement Service Index</th>
            <th class="text-center" colspan="1" rowspan="1">Update Context Header(s)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Classifier</td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Service Function Forwarder (SFF)</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Service Function (SF)</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">Service Function Chaining (SFC) Proxy</td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
            <td class="text-center" colspan="1" rowspan="1">+</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="overview">
<section id="section-4">
      <h2 id="name-design-overview">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-design-overview">Design Overview</a>
      </h2>
<section id="section-4.1">
        <h3 id="name-supported-security-services">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-supported-security-services">Supported Security Services</a>
        </h3>
<p id="section-4.1-1">This specification provides the functions described in the
        following subsections.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<section id="section-4.1.1">
          <h4 id="name-encrypt-all-or-a-subset-of-">
<a class="section-number selfRef" href="#section-4.1.1">4.1.1. </a><a class="section-name selfRef" href="#name-encrypt-all-or-a-subset-of-">Encrypt All or a Subset of Context Headers</a>
          </h4>
<p id="section-4.1.1-1">The solution allows encrypting all or a subset of NSH Context
          Headers by Classifiers, NSH-aware SFs, and SFC proxies.<a class="pilcrow" href="#section-4.1.1-1">¶</a></p>
<p id="section-4.1.1-2">As depicted in <a class="xref" href="#encryption">Table 2</a>, SFFs are not involved in data
          encryption.<a class="pilcrow" href="#section-4.1.1-2">¶</a></p>
<span id="name-encryption-function-support"></span><div id="encryption">
<table class="center" id="table-2">
            <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-encryption-function-support">Encryption Function Supported by SFC Data Plane Elements</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" colspan="1" rowspan="1"> Data Plane Element</th>
                <th class="text-left" colspan="1" rowspan="1"> Base and Service Path Headers Encryption</th>
                <th class="text-left" colspan="1" rowspan="1">Context Header Encryption</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" colspan="1" rowspan="1">Classifier</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
                <td class="text-left" colspan="1" rowspan="1">Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1">SFF</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> NSH-aware SF</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
                <td class="text-left" colspan="1" rowspan="1">Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1">SFC Proxy</td>
                <td class="text-left" colspan="1" rowspan="1"> No </td>
                <td class="text-left" colspan="1" rowspan="1">Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1">NSH-unaware SF</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
                <td class="text-left" colspan="1" rowspan="1">No</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-4.1.1-4">Classifier(s), NSH-aware SFs, and SFC proxies are instructed with
          the set of Context Headers (privacy-sensitive metadata, typically)
          that must be encrypted. Encryption keying material is only provided
          to these SFC data plane elements.<a class="pilcrow" href="#section-4.1.1-4">¶</a></p>
<p id="section-4.1.1-5">The control plane may indicate the set of SFC data plane elements
          that are entitled to supply a given Context Header (e.g., in
          reference to their identifiers as assigned within the SFC-enabled
          domain). It is out of the scope of this document to elaborate on how
          such instructions are provided to the appropriate SFC data plane
          elements nor to detail the structure used to store the
          instructions.<a class="pilcrow" href="#section-4.1.1-5">¶</a></p>
<p id="section-4.1.1-6">The Service Path Header (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2">Section 2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>) is not encrypted because SFFs use the Service
          Index (SI) in conjunction with the Service Path Identifier (SPI) for
          determining the next SF in the path.<a class="pilcrow" href="#section-4.1.1-6">¶</a></p>
</section>
<section id="section-4.1.2">
          <h4 id="name-integrity-protection">
<a class="section-number selfRef" href="#section-4.1.2">4.1.2. </a><a class="section-name selfRef" href="#name-integrity-protection">Integrity Protection</a>
          </h4>
<p id="section-4.1.2-1">The solution provides integrity protection for the NSH data. Two
          levels of assurance (LoAs) are supported.<a class="pilcrow" href="#section-4.1.2-1">¶</a></p>
<p id="section-4.1.2-2">The first level of assurance is where all NSH data except the
          Base Header are integrity protected (<a class="xref" href="#first">Figure 1</a>).
          In this case, the NSH imposer may be a Classifier, an NSH-aware SF,
          or an SFC Proxy. SFFs are not provided with authentication material.
          Further details are discussed in <a class="xref" href="#enc1">Section 5.1</a>.<a class="pilcrow" href="#section-4.1.2-2">¶</a></p>
<span id="name-first-level-of-assurance"></span><div id="first">
<figure id="figure-1">
            <div class="alignCenter art-text artwork" id="section-4.1.2-3.1">
<pre>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                Transport Encapsulation                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...
   |                Base Header                            |  |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  N
|  |                Service Path Header                    |  S
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  H
|  |                Context Header(s)                      |  |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...
|  |                Original Packet                        |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|
+------Scope of integrity-protected data
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-first-level-of-assurance">First Level of Assurance</a>
            </figcaption></figure>
</div>
<p id="section-4.1.2-4">The second level of assurance is where all NSH data, including
          the Base Header, are integrity protected (<a class="xref" href="#sec">Figure 2</a>). In this case, the NSH imposer may be a
          Classifier, an NSH-aware SF, an SFF, or an SFC Proxy. Further
          details are provided in <a class="xref" href="#enc2">Section 5.2</a>.<a class="pilcrow" href="#section-4.1.2-4">¶</a></p>
<span id="name-second-level-of-assurance"></span><div id="sec">
<figure id="figure-2">
            <div class="alignCenter art-text artwork" id="section-4.1.2-5.1">
<pre>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                Transport Encapsulation                |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...
|  |                Base Header                            |  |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  N
|  |                Service Path Header                    |  S
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  H
|  |                Context Header(s)                      |  |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...
|  |                Original Packet                        |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|
+----Scope of integrity-protected data

</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-second-level-of-assurance">Second Level of Assurance</a>
            </figcaption></figure>
</div>
<p id="section-4.1.2-6">The integrity-protection scope is explicitly signaled to
          NSH-aware SFs, SFFs, and SFC proxies in the NSH by means of a
          dedicated MD Type (<a class="xref" href="#new">Section 5</a>).<a class="pilcrow" href="#section-4.1.2-6">¶</a></p>
<p id="section-4.1.2-7">In both levels of assurance, the Context Headers and the packet
          on which the NSH is imposed are subject to integrity protection.<a class="pilcrow" href="#section-4.1.2-7">¶</a></p>
<p id="section-4.1.2-8"><a class="xref" href="#integrity">Table 3</a> classifies the data plane elements as being involved or not involved in
          providing integrity protection for the NSH.<a class="pilcrow" href="#section-4.1.2-8">¶</a></p>
<span id="name-integrity-protection-suppor"></span><div id="integrity">
<table class="center" id="table-3">
            <caption>
<a class="selfRef" href="#table-3">Table 3</a>:
<a class="selfRef" href="#name-integrity-protection-suppor">Integrity Protection Supported by SFC Data Plane Elements</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" colspan="1" rowspan="1">Data Plane Element</th>
                <th class="text-left" colspan="1" rowspan="1">Integrity Protection</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> Classifier</td>
                <td class="text-left" colspan="1" rowspan="1"> Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> SFF</td>
                <td class="text-left" colspan="1" rowspan="1"> No (first LoA); Yes (second LoA)</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> NSH-aware SF</td>
                <td class="text-left" colspan="1" rowspan="1">Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> SFC Proxy</td>
                <td class="text-left" colspan="1" rowspan="1">Yes</td>
              </tr>
              <tr>
                <td class="text-left" colspan="1" rowspan="1"> NSH-unaware SF</td>
                <td class="text-left" colspan="1" rowspan="1"> No</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</section>
<section id="section-4.2">
        <h3 id="name-one-secret-key-two-security">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-one-secret-key-two-security">One Secret Key, Two Security Services</a>
        </h3>
<p id="section-4.2-1">The Authenticated Encryption with Associated Data (AEAD) interface
        defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-5">Section 5</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span> is used to
        encrypt the Context Headers that carry sensitive metadata and to
        provide integrity protection for the encrypted Context Headers.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<p id="section-4.2-2">The secondary keys "MAC_KEY" and "ENC_KEY" are generated from the input
        secret key (K) as follows; each of these two keys is an octet
        string:<a class="pilcrow" href="#section-4.2-2">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.2-3">
          <dt id="section-4.2-3.1">MAC_KEY:</dt>
          <dd id="section-4.2-3.2" style="margin-left: 1.5em">Consists of the initial MAC_KEY_LEN octets
            of K, in order. The MAC_KEY is used for calculating the message
            integrity of the NSH data. In other words, the integrity
            protection provided by the cryptographic mechanism is extended to
            also provide protection for the unencrypted Context Headers and
            the packet on which the NSH is imposed.<a class="pilcrow" href="#section-4.2-3.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-3.3">ENC_KEY:</dt>
          <dd id="section-4.2-3.4" style="margin-left: 1.5em">Consists of the final ENC_KEY_LEN octets of
            K, in order. The ENC_KEY is used as the symmetric encryption key
            for encrypting the Context Headers.<a class="pilcrow" href="#section-4.2-3.4">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.2-4">The Hashed Message Authentication Code (HMAC) algorithm discussed
        in <span>[<a class="xref" href="#RFC4868">RFC4868</a>]</span> is used to protect the integrity of
        the NSH data. The algorithm for implementing and validating HMACs is
        provided in <span>[<a class="xref" href="#RFC2104">RFC2104</a>]</span>.<a class="pilcrow" href="#section-4.2-4">¶</a></p>
<p id="section-4.2-5">The advantage of using both AEAD and HMAC algorithms (instead of
        just AEAD) is that NSH-aware SFs and SFC proxies only need to
        recompute the message integrity of the NSH data after decrementing
        the SI and do not have to recompute the ciphertext.
        The other advantage is that SFFs do not have access to the ENC_KEY and
        cannot act on the encrypted Context Headers, and (in the case of the
        second level of assurance) SFFs do have access to the MAC_KEY.
        Similarly, an NSH-aware SF or SFC Proxy not allowed to decrypt the
        Context Headers will not have access to the ENC_KEY.<a class="pilcrow" href="#section-4.2-5">¶</a></p>
<p id="section-4.2-6">The authenticated encryption algorithm or HMAC algorithm to be used
        by SFC data plane elements is typically controlled using the SFC
        control plane. Mandatory-to-implement authenticated encryption and
        HMAC algorithms are listed in <a class="xref" href="#mti">Section 4.3</a>.<a class="pilcrow" href="#section-4.2-6">¶</a></p>
<p id="section-4.2-7">The authenticated encryption process takes four inputs, each of
        which is an octet string: a secret key (ENC_KEY, referred to as "K" in
        <span>[<a class="xref" href="#RFC5116">RFC5116</a>]</span>), a plaintext (P), associated data (A)
        (which contains the data to be authenticated but not encrypted), and
        a nonce (N). A ciphertext (C) is generated as an output as discussed
        in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-2.1">Section 2.1</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span>.<a class="pilcrow" href="#section-4.2-7">¶</a></p>
<p id="section-4.2-8">In order to decrypt and verify, the cipher takes ENC_KEY,
        N, A, and C as input. The output is either the plaintext or an error indicating
        that the decryption failed as described in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-2.2">Section 2.2</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span>.<a class="pilcrow" href="#section-4.2-8">¶</a></p>
</section>
<div id="mti">
<section id="section-4.3">
        <h3 id="name-mandatory-to-implement-auth">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-mandatory-to-implement-auth">Mandatory-to-Implement Authenticated Encryption and HMAC Algorithms</a>
        </h3>
<p id="section-4.3-1">Classifiers, NSH-aware SFs, and SFC proxies <span class="bcp14">MUST</span> implement the
        AES_128_GCM <span>[<a class="xref" href="#GCM">GCM</a>]</span><span>[<a class="xref" href="#RFC5116">RFC5116</a>]</span>
        algorithm and <span class="bcp14">SHOULD</span> implement the AES_192_GCM and AES_256_GCM
        algorithms.<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<p id="section-4.3-2">Classifiers, NSH-aware SFs, and SFC proxies <span class="bcp14">MUST</span> implement the
        HMAC-SHA-256-128 algorithm and <span class="bcp14">SHOULD</span> implement the HMAC-SHA-384-192
        and HMAC-SHA-512-256 algorithms.<a class="pilcrow" href="#section-4.3-2">¶</a></p>
<p id="section-4.3-3">SFFs <span class="bcp14">MAY</span> implement the aforementioned cipher suites and HMAC
        algorithms.<a class="pilcrow" href="#section-4.3-3">¶</a></p>
<p id="section-4.3-4" style="margin-left: 1.5em"> Note: The use of the AES_128_CBC_HMAC_SHA_256 algorithm would
 have avoided the need for a second 128-bit authentication tag, but due
 to the nature of how Cipher Block Chaining (CBC) mode operates,
 AES_128_CBC_HMAC_SHA_256 allows for the malleability of plaintexts. This
 malleability allows for attackers that know the Message Authentication Code (MAC) key but not the
 encryption key to make changes in the ciphertext and, if parts of the
 plaintext are known, create arbitrary blocks of plaintext. This
 specification mandates the use of separate AEAD and MAC protections to
 prevent this type of attack.<a class="pilcrow" href="#section-4.3-4">¶</a></p>
</section>
</div>
<div id="kms">
<section id="section-4.4">
        <h3 id="name-key-management">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-key-management">Key Management</a>
        </h3>
<p id="section-4.4-1">The procedure for the allocation/provisioning of secret keys (K)
        and the authenticated encryption algorithm or MAC_KEY and HMAC algorithm
        is outside the scope of this specification. As such, this
        specification does not mandate the support of any specific
        mechanism.<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<p id="section-4.4-2">The document does not assume nor preclude the following:<a class="pilcrow" href="#section-4.4-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-3.1">The same keying material is used for all the service functions
            used within an SFC-enabled domain.<a class="pilcrow" href="#section-4.4-3.1">¶</a>
</li>
          <li class="normal" id="section-4.4-3.2">Distinct keying material is used per SFP by all involved SFC
            data path elements.<a class="pilcrow" href="#section-4.4-3.2">¶</a>
</li>
          <li class="normal" id="section-4.4-3.3">Per-tenant keys are used.<a class="pilcrow" href="#section-4.4-3.3">¶</a>
</li>
        </ul>
<p id="section-4.4-4">In order to accommodate deployments relying upon keying material
        per SFC/SFP and also the need to update keys after encrypting NSH data
        for a certain amount of time, this document uses key identifiers to
        unambiguously identify the appropriate keying material and associated
        algorithms for MAC and encryption. This use of in-band identifiers
        addresses the problem of the synchronization of keying material.<a class="pilcrow" href="#section-4.4-4">¶</a></p>
<p id="section-4.4-5">Additional information on manual vs. automated key management and
        when one should be used over the other can be found in <span>[<a class="xref" href="#RFC4107">RFC4107</a>]</span>.<a class="pilcrow" href="#section-4.4-5">¶</a></p>
<p id="section-4.4-6">The risk involved in using a group-shared symmetric key increases
        with the size of the group to which it is shared. Additional security
        issues are discussed in <a class="xref" href="#Security">Section 9</a>.<a class="pilcrow" href="#section-4.4-6">¶</a></p>
</section>
</div>
<div id="newch">
<section id="section-4.5">
        <h3 id="name-new-nsh-variable-length-con">
<a class="section-number selfRef" href="#section-4.5">4.5. </a><a class="section-name selfRef" href="#name-new-nsh-variable-length-con">New NSH Variable-Length Context Headers</a>
        </h3>
<p id="section-4.5-1">New NSH Variable-Length Context Headers are defined in <a class="xref" href="#new">Section 5</a> for NSH data integrity protection and,
        optionally, encryption of Context Headers carrying sensitive metadata.
        Concretely, an NSH imposer includes (1) the key identifier to identify
        the keying material, (2) the timestamp to protect against replay
        attacks (<a class="xref" href="#time">Section 7.4</a>), and (3) MAC for the target NSH data (depending on the
        integrity-protection scope) calculated using MAC_KEY and,
        optionally, Context Headers encrypted using ENC_KEY.<a class="pilcrow" href="#section-4.5-1">¶</a></p>
<p id="section-4.5-2">An SFC data plane element that needs to check the integrity of the
        NSH data uses the MAC_KEY and HMAC algorithm for the key identifier
        being carried in the NSH.<a class="pilcrow" href="#section-4.5-2">¶</a></p>
<p id="section-4.5-3">An NSH-aware SF or SFC Proxy that needs to decrypt some Context
        Headers uses ENC_KEY and the decryption algorithm for the key
        identifier being carried in the NSH.<a class="pilcrow" href="#section-4.5-3">¶</a></p>
<p id="section-4.5-4"><a class="xref" href="#prorules">Section 7</a> specifies the detailed
        procedure.<a class="pilcrow" href="#section-4.5-4">¶</a></p>
</section>
</div>
<div id="nsh-in-nsh">
<section id="section-4.6">
        <h3 id="name-encapsulation-of-nsh-within">
<a class="section-number selfRef" href="#section-4.6">4.6. </a><a class="section-name selfRef" href="#name-encapsulation-of-nsh-within">Encapsulation of NSH within NSH</a>
        </h3>
<p id="section-4.6-1">As discussed in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8459#section-3">Section 3</a> of [<a class="xref" href="#RFC8459">RFC8459</a>]</span>, an
        SFC-enabled domain (called an upper-level domain) may be decomposed into
        many sub-domains (called lower-level domains). In order to avoid
        maintaining state to restore upper-level NSH information at the
        boundaries of lower-level domains, two NSH levels are used: an
        Upper-NSH that is imposed at the boundaries of the upper-level domain
        and a Lower-NSH that is pushed by the Classifier of a lower-level
        domain in front of the original NSH (<a class="xref" href="#nest">Figure 3</a>). As
        such, the Upper-NSH information is carried along the lower-level chain
        without modification. The packet is forwarded in the top-level domain
        according to the Upper-NSH, while it is forwarded according to the
        Lower-NSH in a lower-level domain.<a class="pilcrow" href="#section-4.6-1">¶</a></p>
<span id="name-encapsulation-of-nsh-within-"></span><div id="nest">
<figure id="figure-3">
          <div class="alignCenter art-text artwork" id="section-4.6-2.1">
<pre>   +---------------------------------+
   |     Transport Encapsulation     |
+-&gt;+---------------------------------+
|  |        Lower-NSH Header         |
|  +---------------------------------+
|  |        Upper-NSH Header         |
|  +---------------------------------+
|  |          Original Packet        |
+-&gt;+---------------------------------+
|
|
+----Scope of NSH security protection
     provided by a lower-level domain
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-encapsulation-of-nsh-within-">Encapsulation of NSH within NSH</a>
          </figcaption></figure>
</div>
<p id="section-4.6-3">SFC data plane elements of a lower-level domain include the
        Upper-NSH when computing the MAC.<a class="pilcrow" href="#section-4.6-3">¶</a></p>
<p id="section-4.6-4">Keying material used at the upper-level domain <span class="bcp14">SHOULD NOT</span> be the
        same as the one used by a lower-level domain.<a class="pilcrow" href="#section-4.6-4">¶</a></p>
</section>
</div>
</section>
</div>
<div id="new">
<section id="section-5">
      <h2 id="name-new-nsh-variable-length-cont">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-new-nsh-variable-length-cont">New NSH Variable-Length Context Headers</a>
      </h2>
<p id="section-5-1">This section specifies the format of new Variable-Length Context
      Headers that are used for NSH integrity protection and, optionally,
      Context Header encryption.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">In particular, this section defines two "MAC and Encrypted Metadata"
      Context Headers, each having specific deployment constraints. Unlike
      <a class="xref" href="#enc1">Section 5.1</a>, the level of assurance provided
      in <a class="xref" href="#enc2">Section 5.2</a> requires sharing MAC_KEY with
      SFFs. Both Context Headers have the same format as shown in <a class="xref" href="#mac">Figure 4</a>.<a class="pilcrow" href="#section-5-2">¶</a></p>
<span id="name-mac-and-encrypted-metadata-"></span><div id="mac">
<figure id="figure-4">
        <div class="alignCenter art-text artwork" id="section-5-3.1">
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Metadata Class       |      Type     |U|    Length   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Key Id Len  |         Key Identifier (Variable)               ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                      Timestamp (8 bytes)                      ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Nonce Length  |           Nonce  (Variable)                   ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Message Authentication Code and optional Encrypted        |
   ~                  Context Headers (Variable)                   ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-mac-and-encrypted-metadata-">MAC and Encrypted Metadata Context Header</a>
        </figcaption></figure>
</div>
<p id="section-5-4">The "MAC and Encrypted Metadata" Context Headers are padded out to a
      multiple of 4 bytes as per <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.2">Section 2.2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>.
      The "MAC and Encrypted Metadata" Context
      Header, if included, <span class="bcp14">MUST</span> always be the last Context Header.<a class="pilcrow" href="#section-5-4">¶</a></p>
<div id="enc1">
<section id="section-5.1">
        <h3 id="name-mac1-context-header">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-mac1-context-header">MAC#1 Context Header</a>
        </h3>
<p id="section-5.1-1">The MAC#1 Context Header is a Variable-Length Context Header that
        carries MAC for the Service Path
        Header, Context Headers, and the inner packet on which NSH is imposed,
        calculated using MAC_KEY and, optionally, Context Headers encrypted
        using ENC_KEY. The scope of the integrity protection provided by this
        Context Header is depicted in <a class="xref" href="#scope1">Figure 5</a>.<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<p id="section-5.1-2">This MAC scheme does not require sharing MAC_KEY with SFFs. It does
        not require recomputing the MAC by each SFF because of TTL
        processing. <a class="xref" href="#mac1">Section 9.1</a> discusses the possible threat
        associated with this level of assurance.<a class="pilcrow" href="#section-5.1-2">¶</a></p>
<span id="name-scope-of-mac1"></span><div id="scope1">
<figure id="figure-5">
          <div class="alignCenter art-text artwork" id="section-5.1-3.1">
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Ver|O|U|    TTL    |   Length  |U|U|U|U|MD Type| Next Protocol |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;--+
   |          Service Path Identifier              | Service Index |   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   ~       Variable-Length Unencrypted Context Headers  (opt.)     ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   |          Metadata Class       |      Type     |U|    Length   |   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   | Key Id Len  |         Key Identifier (Variable)               ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   ~                      Timestamp (8 bytes)                      ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   | Nonce Length  |           Nonce  (Variable)                   ~   |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  ~                Encrypted Context Headers (opt.)               ~   |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  ~                 Message Authentication Code                   ~   |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  |                                                               |   |
|  ~               Inner Packet on which NSH is imposed            ~   |
|  |                                                               |   |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;--|
|                                                                      |
|                                       Integrity-Protection Scope ----+
+----Encrypted Data
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-scope-of-mac1">Scope of MAC#1</a>
          </figcaption></figure>
</div>
<p id="section-5.1-4">In reference to <a class="xref" href="#mac">Figure 4</a>, the description of the
        fields is as follows:<a class="pilcrow" href="#section-5.1-4">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.1-5">
          <dt id="section-5.1-5.1">Metadata Class:</dt>
          <dd id="section-5.1-5.2" style="margin-left: 6.0em">
            <span class="bcp14">MUST</span> be set to 0x0 (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.2">Section 2.2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>).<a class="pilcrow" href="#section-5.1-5.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.3">Type:</dt>
          <dd id="section-5.1-5.4" style="margin-left: 6.0em">0x02 (see <a class="xref" href="#IANA">Section 10</a>).<a class="pilcrow" href="#section-5.1-5.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.5">U:</dt>
          <dd id="section-5.1-5.6" style="margin-left: 6.0em">Unassigned bit (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5.1">Section 2.5.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>).<a class="pilcrow" href="#section-5.1-5.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.7">Length:</dt>
          <dd id="section-5.1-5.8" style="margin-left: 6.0em">Indicates the length of the variable-length
            metadata in bytes. Padding considerations are discussed in
           <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5.1">Section 2.5.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>.<a class="pilcrow" href="#section-5.1-5.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.9">Key Id Len:</dt>
          <dd id="section-5.1-5.10" style="margin-left: 6.0em">Variable. Carries the length of the key
            identifier in octets.<a class="pilcrow" href="#section-5.1-5.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.11">Key Identifier:</dt>
          <dd id="section-5.1-5.12" style="margin-left: 6.0em">Carries a variable-length Key
            Identifier object used to identify and deliver keys to SFC data
            plane elements. This identifier is helpful for accommodating
            deployments relying upon keying material per SFC/SFP. The key
            identifier helps to resolve the problem of synchronization of
            keying material. A single key identifier is used to look up both
            the ENC_KEY and the MAC_KEY associated with a key, and the
            corresponding encryption and MAC algorithms used with those
            keys.<a class="pilcrow" href="#section-5.1-5.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.13">Timestamp:</dt>
          <dd id="section-5.1-5.14" style="margin-left: 6.0em">Refer to <a class="xref" href="#timef">Section 6</a> for
            more details about the structure of this field.<a class="pilcrow" href="#section-5.1-5.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.15">Nonce Length:</dt>
          <dd id="section-5.1-5.16" style="margin-left: 6.0em">Carries the length of the Nonce. If
            the Context Headers are only integrity protected, "Nonce Length"
            is set to zero (that is, no "Nonce" is included).<a class="pilcrow" href="#section-5.1-5.16">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.17">Nonce:</dt>
          <dd id="section-5.1-5.18" style="margin-left: 6.0em">Carries the Nonce for the authenticated
            encryption operation (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-3.1">Section 3.1</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span>).<a class="pilcrow" href="#section-5.1-5.18">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.19">Encrypted Context Headers:</dt>
          <dd id="section-5.1-5.20" style="margin-left: 6.0em">Carries the optional
            encrypted Context Headers.<a class="pilcrow" href="#section-5.1-5.20">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-5.21">Message Authentication Code: </dt>
          <dd id="section-5.1-5.22" style="margin-left: 6.0em">Covers the entire NSH
            data, excluding the Base Header.<a class="pilcrow" href="#section-5.1-5.22">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="enc2">
<section id="section-5.2">
        <h3 id="name-mac2-context-header">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-mac2-context-header">MAC#2 Context Header</a>
        </h3>
<p id="section-5.2-1">The MAC#2 Context Header is a Variable-Length Context Header that
        carries the MAC for the entire NSH data calculated using MAC_KEY and,
        optionally, Context Headers encrypted using ENC_KEY. The scope of the
        integrity protection provided by this Context Header is depicted in
        <a class="xref" href="#scope2">Figure 6</a>.<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<span id="name-scope-of-mac2"></span><div id="scope2">
<figure id="figure-6">
          <div class="alignCenter art-text artwork" id="section-5.2-2.1">
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;--+
   |Ver|O|U|    TTL    |   Length  |U|U|U|U|MD Type| Next Protocol |   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   |          Service Path Identifier              | Service Index |   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   ~       Variable-Length Unencrypted Context Headers  (opt.)     ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   |          Metadata Class       |      Type     |U|    Length   |   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   | Key Id Len  |         Key Identifier (Variable)               ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   ~                      Timestamp (8 bytes)                      ~   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
   | Nonce Length  |           Nonce  (Variable)                   ~   |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  ~                Encrypted Context Headers (opt.)               ~   |
+-&gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  ~                 Message Authentication Code                   ~   |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+   |
|  |                                                               |   |
|  ~               Inner Packet on which NSH is imposed            ~   |
|  |                                                               |   |
|  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+&lt;--|
|                                                                      |
|                                       Integrity-Protection Scope ----+
+----Encrypted Data
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-scope-of-mac2">Scope of MAC#2</a>
          </figcaption></figure>
</div>
<p id="section-5.2-3">In reference to <a class="xref" href="#mac">Figure 4</a>, the description of the
        fields is as follows:<a class="pilcrow" href="#section-5.2-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-4">
          <dt id="section-5.2-4.1">Metadata Class:</dt>
          <dd id="section-5.2-4.2" style="margin-left: 6.0em">
            <span class="bcp14">MUST</span> be set to 0x0 (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.2">Section 2.2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>).<a class="pilcrow" href="#section-5.2-4.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.3">Type:</dt>
          <dd id="section-5.2-4.4" style="margin-left: 6.0em">0x03 (see <a class="xref" href="#IANA">Section 10</a>).<a class="pilcrow" href="#section-5.2-4.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.5">U:</dt>
          <dd id="section-5.2-4.6" style="margin-left: 6.0em">Unassigned bit (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5.1">Section 2.5.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>).<a class="pilcrow" href="#section-5.2-4.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.7">Length:</dt>
          <dd id="section-5.2-4.8" style="margin-left: 6.0em">Indicates the length of the variable-length
            metadata in bytes. Padding considerations are discussed in
            <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5.1">Section 2.5.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>.<a class="pilcrow" href="#section-5.2-4.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.9">Key Id Len:</dt>
          <dd id="section-5.2-4.10" style="margin-left: 6.0em">See <a class="xref" href="#enc1">Section 5.1</a>.<a class="pilcrow" href="#section-5.2-4.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.11">Key Identifier:</dt>
          <dd id="section-5.2-4.12" style="margin-left: 6.0em">See <a class="xref" href="#enc1">Section 5.1</a>.<a class="pilcrow" href="#section-5.2-4.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.13">Timestamp:</dt>
          <dd id="section-5.2-4.14" style="margin-left: 6.0em">See <a class="xref" href="#timef">Section 6</a>.<a class="pilcrow" href="#section-5.2-4.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.15">Nonce Length:</dt>
          <dd id="section-5.2-4.16" style="margin-left: 6.0em">See <a class="xref" href="#enc1">Section 5.1</a>.<a class="pilcrow" href="#section-5.2-4.16">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.17">Nonce:</dt>
          <dd id="section-5.2-4.18" style="margin-left: 6.0em">See <a class="xref" href="#enc1">Section 5.1</a>.<a class="pilcrow" href="#section-5.2-4.18">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.19">Encrypted Context Headers:</dt>
          <dd id="section-5.2-4.20" style="margin-left: 6.0em">Carries the optional
            encrypted Context Headers.<a class="pilcrow" href="#section-5.2-4.20">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.21">Message Authentication Code:</dt>
          <dd id="section-5.2-4.22" style="margin-left: 6.0em">Covers the entire NSH
            data.<a class="pilcrow" href="#section-5.2-4.22">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="timef">
<section id="section-6">
      <h2 id="name-timestamp-format">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-timestamp-format">Timestamp Format</a>
      </h2>
<p id="section-6-1">This section follows the template provided in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8877#section-3">Section 3</a> of [<a class="xref" href="#RFC8877">RFC8877</a>]</span>.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">The format of the Timestamp field introduced in <a class="xref" href="#new">Section 5</a> is depicted in <a class="xref" href="#tf">Figure 7</a>.<a class="pilcrow" href="#section-6-2">¶</a></p>
<span id="name-timestamp-field-format"></span><div id="tf">
<figure id="figure-7">
        <div class="alignCenter art-text artwork" id="section-6-3.1">
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            Seconds                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Fraction                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-timestamp-field-format">Timestamp Field Format</a>
        </figcaption></figure>
</div>
<span class="break"></span><dl class="dlNewline" id="section-6-4">
        <dt id="section-6-4.1">Timestamp field format:</dt>
        <dd id="section-6-4.2" style="margin-left: 1.5em">
          <span class="break"></span><dl class="dlParallel" id="section-6-4.2.1">
            <dt id="section-6-4.2.1.1">Seconds:</dt>
            <dd id="section-6-4.2.1.2" style="margin-left: 1.5em">Specifies the integer portion of the number of seconds
          since the epoch.<a class="pilcrow" href="#section-6-4.2.1.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6-4.2.1.3">+ Size:</dt>
            <dd id="section-6-4.2.1.4" style="margin-left: 1.5em"> 32 bits<a class="pilcrow" href="#section-6-4.2.1.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6-4.2.1.5">+ Units:</dt>
            <dd id="section-6-4.2.1.6" style="margin-left: 1.5em"> Seconds<a class="pilcrow" href="#section-6-4.2.1.6">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6-4.2.1.7">Fraction:</dt>
            <dd id="section-6-4.2.1.8" style="margin-left: 1.5em"> Specifies the fractional portion of the number of
          seconds since the epoch.<a class="pilcrow" href="#section-6-4.2.1.8">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6-4.2.1.9">+ Size:</dt>
            <dd id="section-6-4.2.1.10" style="margin-left: 1.5em"> 32 bits<a class="pilcrow" href="#section-6-4.2.1.10">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-6-4.2.1.11">+ Units:</dt>
            <dd id="section-6-4.2.1.12" style="margin-left: 1.5em">The unit is 2<sup>(-32)</sup> seconds, which is roughly equal to
          233 picoseconds.<a class="pilcrow" href="#section-6-4.2.1.12">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</dd>
      <dd class="break"></dd>
</dl>
<span class="break"></span><dl class="dlNewline" id="section-6-5">
        <dt id="section-6-5.1">Epoch:</dt>
        <dd id="section-6-5.2" style="margin-left: 1.5em">The epoch is 1970-01-01T00:00 in UTC time. Note that this epoch
        value is different from the one used in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5905#section-6">Section 6</a> of [<a class="xref" href="#RFC5905">RFC5905</a>]</span> (which will wrap around in
        2036).<a class="pilcrow" href="#section-6-5.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-6-5.3">Leap seconds:</dt>
        <dd id="section-6-5.4" style="margin-left: 1.5em">This timestamp format is affected by leap seconds. The timestamp
          represents the number of seconds elapsed since the epoch minus the
          number of leap seconds.<a class="pilcrow" href="#section-6-5.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-6-5.5">Resolution:</dt>
        <dd id="section-6-5.6" style="margin-left: 1.5em">The resolution is 2<sup>(-32)</sup> seconds.<a class="pilcrow" href="#section-6-5.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-6-5.7">Wraparound:</dt>
        <dd id="section-6-5.8" style="margin-left: 1.5em">This time format wraps around every 2<sup>32</sup> seconds, which is
          roughly 136 years. The next wraparound will occur in the year
          2106.<a class="pilcrow" href="#section-6-5.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-6-5.9">Synchronization aspects:</dt>
        <dd id="section-6-5.10" style="margin-left: 1.5em">It is assumed that SFC data plane elements are synchronized to
          UTC using a synchronization mechanism that is outside the scope of
          this document. In typical deployments, SFC data plane elements use
          NTP <span>[<a class="xref" href="#RFC5905">RFC5905</a>]</span> for synchronization. Thus, the
          timestamp may be derived from the NTP-synchronized clock, allowing
          the timestamp to be measured with respect to the clock of an NTP
          server. Since this time format is specified in terms of UTC, it is
          affected by leap seconds (in a manner analogous to the NTP time
          format, which is similar). Therefore, the value of a timestamp
          during or slightly after a leap second may be temporarily
          inaccurate.<a class="pilcrow" href="#section-6-5.10">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="prorules">
<section id="section-7">
      <h2 id="name-processing-rules">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-processing-rules">Processing Rules</a>
      </h2>
<p id="section-7-1">The following subsections describe the processing rules for
      integrity-protected NSH and, optionally, encrypted Context Headers.<a class="pilcrow" href="#section-7-1">¶</a></p>
<div id="gen">
<section id="section-7.1">
        <h3 id="name-generic-behavior">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-generic-behavior">Generic Behavior</a>
        </h3>
<p id="section-7.1-1">This document adheres to the recommendations in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-8.1">Section 8.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span> for handling the Context Headers at
        both ingress and egress SFC boundary nodes (i.e., to strip the entire
        NSH, including Context Headers).<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<p id="section-7.1-2">Failures of a Classifier to inject the Context Headers defined in
        this document <span class="bcp14">SHOULD</span> be logged locally while a notification alarm <span class="bcp14">MAY</span>
        be sent to an SFC control element. Failures of an NSH-aware node to
        validate the integrity of the NSH data <span class="bcp14">MUST</span> cause that packet to be
        discarded while a notification alarm <span class="bcp14">MAY</span> be sent to an SFC control
        element. The details of sending notification alarms (i.e., the
        parameters that affect the transmission of the notification alarms
        depending on the information in the Context Header such as frequency,
        thresholds, and content in the alarm) <span class="bcp14">SHOULD</span> be configurable.<a class="pilcrow" href="#section-7.1-2">¶</a></p>
<p id="section-7.1-3">NSH-aware SFs and SFC proxies <span class="bcp14">MAY</span> be instructed to
        strip some encrypted Context Headers from the packet or to pass the
        data to the next SF in the service function chain after processing the
        content of the Context Headers. If no instruction is provided, the
        default behavior for intermediary NSH-aware nodes is to maintain such
        Context Headers so that the information can be passed to the next
        NSH-aware hops.  NSH-aware SFs and SFC proxies <span class="bcp14">MUST</span>
        reapply the integrity protection if any modification is made to the
        Context Headers (e.g., strip a Context Header, update the content of
        an existing Context Header, insert a new Context Header).<a class="pilcrow" href="#section-7.1-3">¶</a></p>
<p id="section-7.1-4">An NSH-aware SF or SFC Proxy that is not allowed to decrypt any
        Context Headers <span class="bcp14">MUST NOT</span> be given access to the ENC_KEY.<a class="pilcrow" href="#section-7.1-4">¶</a></p>
<p id="section-7.1-5">Otherwise, an NSH-aware SF or SFC Proxy that receives encrypted
        Context Headers, for which it is not allowed to consume a specific
        Context Header it decrypts (but consumes others), <span class="bcp14">MUST</span> keep that
        Context Header unaltered when forwarding the packet upstream.<a class="pilcrow" href="#section-7.1-5">¶</a></p>
<p id="section-7.1-6">Only one instance of a "MAC and Encrypted Metadata" Context Header
        (<a class="xref" href="#new">Section 5</a>) is allowed in an NSH level. If multiple
        instances of a "MAC and Encrypted Metadata" Context Header are included
        in an NSH level, the SFC data plane element <span class="bcp14">MUST</span> process the first
        instance and ignore subsequent instances and <span class="bcp14">MAY</span> log or increase a
        counter for this event as per <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-2.5.1">Section 2.5.1</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>. If NSH within NSH is used (<a class="xref" href="#nsh-in-nsh">Section 4.6</a>), distinct LoAs may be used for each NSH
        level.<a class="pilcrow" href="#section-7.1-6">¶</a></p>
<p id="section-7.1-7">MTU and fragmentation considerations are discussed in <a class="xref" href="#MTU">Section 8</a>.<a class="pilcrow" href="#section-7.1-7">¶</a></p>
</section>
</div>
<section id="section-7.2">
        <h3 id="name-mac-nsh-data-generation">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-mac-nsh-data-generation">MAC NSH Data Generation</a>
        </h3>
<p id="section-7.2-1">After performing any Context Header encryption, the HMAC algorithm
        discussed in <span>[<a class="xref" href="#RFC4868">RFC4868</a>]</span> is used to
        integrity protect the target NSH data. An NSH imposer inserts a "MAC
        and Encrypted Metadata" Context Header for integrity protection (<a class="xref" href="#new">Section 5</a>).<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<p id="section-7.2-2">The NSH imposer sets the MAC field to zero and then computes the
        message integrity for the target NSH data (depending on the
        integrity-protection scope discussed in <a class="xref" href="#new">Section 5</a>) using the MAC_KEY and HMAC algorithm. It inserts
        the computed digest in the MAC field of the "MAC and Encrypted
        Metadata" Context Header. The length of the MAC is decided by the HMAC
        algorithm adopted for the particular key identifier.<a class="pilcrow" href="#section-7.2-2">¶</a></p>
<p id="section-7.2-3">The Message Authentication Code (T) computation process for the
        target NSH data with HMAC-SHA-256-128() can be illustrated as
        follows:<a class="pilcrow" href="#section-7.2-3">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-4">
<pre>      T = HMAC-SHA-256-128(MAC_KEY, target NSH data)
</pre><a class="pilcrow" href="#section-7.2-4">¶</a>
</div>
<p id="section-7.2-5">An entity in the SFP that updates the NSH <span class="bcp14">MUST</span> follow the above
        behavior to maintain message integrity of the NSH for subsequent
        validations.<a class="pilcrow" href="#section-7.2-5">¶</a></p>
</section>
<section id="section-7.3">
        <h3 id="name-encrypted-nsh-metadata-gene">
<a class="section-number selfRef" href="#section-7.3">7.3. </a><a class="section-name selfRef" href="#name-encrypted-nsh-metadata-gene">Encrypted NSH Metadata Generation</a>
        </h3>
<p id="section-7.3-1">An NSH imposer can encrypt Context Headers carrying sensitive
        metadata, i.e., encrypted and unencrypted metadata may be carried
        simultaneously in the same NSH packet (Sections <a class="xref" href="#scope1">5</a> and <a class="xref" href="#scope2">6</a>).<a class="pilcrow" href="#section-7.3-1">¶</a></p>
<p id="section-7.3-2">In order to prevent pervasive monitoring <span>[<a class="xref" href="#RFC7258">RFC7258</a>]</span>, it is <span class="bcp14">RECOMMENDED</span> to encrypt all Context
        Headers. All Context Headers carrying privacy-sensitive metadata <span class="bcp14">MUST</span>
        be encrypted; by doing so, privacy-sensitive metadata is not revealed
        to attackers. Privacy-specific threats are discussed in
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc6973#section-5.2">Section 5.2</a> of [<a class="xref" href="#RFC6973">RFC6973</a>]</span>.<a class="pilcrow" href="#section-7.3-2">¶</a></p>
<p id="section-7.3-3">Using the secret key (ENC_KEY) and authenticated encryption
        algorithm, the NSH imposer encrypts the Context Headers (as set, for
        example, in <a class="xref" href="#req">Section 3</a>) and inserts the
        resulting payload in the "MAC and Encrypted Metadata" Context Header
        (<a class="xref" href="#new">Section 5</a>). The additional authenticated
        data input to the AEAD function is a zero-length byte string. The
        entire Context Header carrying sensitive metadata is encrypted (that
        is, including the MD Class, Type, Length, and associated metadata of
        each Context Header).<a class="pilcrow" href="#section-7.3-3">¶</a></p>
<p id="section-7.3-4">More details about the exact encryption procedure are provided in
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-2.1">Section 2.1</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span>. In this
        case, the associated data (A) input is zero length for AES
        Galois/Counter Mode (AES-GCM).<a class="pilcrow" href="#section-7.3-4">¶</a></p>
<p id="section-7.3-5">An authorized entity in the SFP that updates the content of an
        encrypted Context Header or needs to add a new encrypted Context
        Header <span class="bcp14">MUST</span> also follow the aforementioned behavior.<a class="pilcrow" href="#section-7.3-5">¶</a></p>
</section>
<div id="time">
<section id="section-7.4">
        <h3 id="name-timestamp-for-replay-attack">
<a class="section-number selfRef" href="#section-7.4">7.4. </a><a class="section-name selfRef" href="#name-timestamp-for-replay-attack">Timestamp for Replay Attack Prevention</a>
        </h3>
<p id="section-7.4-1">The Timestamp imposed by an initial Classifier is left untouched
        along an SFP. However, it can be updated when reclassification occurs
        (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7665#section-4.8">Section 4.8</a> of [<a class="xref" href="#RFC7665">RFC7665</a>]</span>). The same
        considerations for setting the Timestamp are followed in both initial
        classification and reclassification (<a class="xref" href="#timef">Section 6</a>).<a class="pilcrow" href="#section-7.4-1">¶</a></p>
<p id="section-7.4-2">The received NSH is accepted by an NSH-aware node if the Timestamp
        (TS) in the NSH is recent enough to the reception time of the NSH
        (TSrt). The following formula is used for this check:<a class="pilcrow" href="#section-7.4-2">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-3">
<pre>      -Delta &lt; (TSrt - TS) &lt; +Delta
</pre><a class="pilcrow" href="#section-7.4-3">¶</a>
</div>
<p id="section-7.4-4">The Delta interval is a configurable parameter. The default value
        for the allowed Delta is 2 seconds. Special care should be taken when
        setting very low Delta values as this may lead to dropping legitimate
        traffic. If the timestamp is not within the boundaries, then the SFC
        data plane element receiving such packets <span class="bcp14">MUST</span> discard the NSH
        message.<a class="pilcrow" href="#section-7.4-4">¶</a></p>
<p id="section-7.4-5">Replay attacks within the Delta window may be detected by an
        NSH-aware node by recording a unique value derived from the packet,
        such as a unique value from the MAC field value. Such an NSH-aware
        node will detect and reject duplicates. If for legitimate service
        reasons some flows have to be duplicated but still share a portion of
        an SFP with the original flow, legitimate duplicate packets will be
        tagged by NSH-aware nodes involved in that segment as replay packets
        unless sufficient entropy is added to the duplicate packet.  How such
        an entropy is added is implementation specific.<a class="pilcrow" href="#section-7.4-5">¶</a></p>
<p id="section-7.4-6" style="margin-left: 1.5em">
Note: Within the timestamp Delta window, defining a sequence number to protect
against replay attacks may be considered. In such a mode, NSH-aware nodes must
discard packets with duplicate sequence numbers within the timestamp Delta
window. However, in deployments with several instances of the same SF (e.g.,
cluster or load-balanced SFs), a mechanism to coordinate among those instances
to discard duplicate sequence numbers is required.  Because the coordination
mechanism to comply with this requirement is service specific, this document
does not include this protection.<a class="pilcrow" href="#section-7.4-6">¶</a></p>
<p id="section-7.4-7">All SFC data plane elements must be synchronized among themselves.
        These elements may be synchronized to a global reference time.<a class="pilcrow" href="#section-7.4-7">¶</a></p>
</section>
</div>
<section id="section-7.5">
        <h3 id="name-nsh-data-validation">
<a class="section-number selfRef" href="#section-7.5">7.5. </a><a class="section-name selfRef" href="#name-nsh-data-validation">NSH Data Validation</a>
        </h3>
<p id="section-7.5-1">When an SFC data plane element that conforms to this specification
        needs to check the validity of the NSH data, it <span class="bcp14">MUST</span> ensure that a
        "MAC and Encrypted Metadata" Context Header is included in a received
        NSH packet. The imposer <span class="bcp14">MUST</span> silently discard the packet and <span class="bcp14">MUST</span> log
        an error at least once per the SPI if at least one of the following is
        observed:<a class="pilcrow" href="#section-7.5-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.5-2.1">the "MAC and Encrypted Metadata" Context Header is missing,<a class="pilcrow" href="#section-7.5-2.1">¶</a>
</li>
          <li class="normal" id="section-7.5-2.2">the enclosed key identifier is unknown or invalid (e.g., the
            corresponding key expired), or<a class="pilcrow" href="#section-7.5-2.2">¶</a>
</li>
          <li class="normal" id="section-7.5-2.3">the timestamp is invalid (<a class="xref" href="#time">Section 7.4</a>).<a class="pilcrow" href="#section-7.5-2.3">¶</a>
</li>
        </ul>
<p id="section-7.5-3">If the timestamp check is successfully passed, the SFC data plane
        element proceeds with NSH data integrity validation. After storing the
        value of the MAC field in the "MAC and Encrypted Metadata" Context
        Header, the SFC data plane element fills the MAC field with zeros.
        Then, the SFC data plane element generates the message integrity for
        the target NSH data (depending on the integrity-protection scope
        discussed in <a class="xref" href="#new">Section 5</a>) using the MAC_KEY and
        HMAC algorithm. If the value of the newly generated digest is
        identical to the stored one, the SFC data plane element is certain
        that the NSH data has not been tampered with and validation is
        therefore successful.  Otherwise, the NSH packet <span class="bcp14">MUST</span>
        be discarded. The comparison of the computed HMAC value to the stored
        value <span class="bcp14">MUST</span> be done in a constant-time manner to thwart
        timing attacks.<a class="pilcrow" href="#section-7.5-3">¶</a></p>
</section>
<section id="section-7.6">
        <h3 id="name-decryption-of-nsh-metadata">
<a class="section-number selfRef" href="#section-7.6">7.6. </a><a class="section-name selfRef" href="#name-decryption-of-nsh-metadata">Decryption of NSH Metadata</a>
        </h3>
<p id="section-7.6-1">If entitled to consume a supplied encrypted Context Header, an
        NSH-aware SF or SFC Proxy decrypts metadata using (K) and a decryption
        algorithm for the key identifier in the NSH.<a class="pilcrow" href="#section-7.6-1">¶</a></p>
<p id="section-7.6-2">The authenticated encryption algorithm has only a single output, either
        a plaintext or a special symbol (FAIL) that indicates that the inputs
        are not authentic (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc5116#section-2.2">Section 2.2</a> of [<a class="xref" href="#RFC5116">RFC5116</a>]</span>).<a class="pilcrow" href="#section-7.6-2">¶</a></p>
</section>
</section>
</div>
<div id="MTU">
<section id="section-8">
      <h2 id="name-mtu-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-mtu-considerations">MTU Considerations</a>
      </h2>
<p id="section-8-1">The SFC architecture prescribes that additional information be added
      to packets to:<a class="pilcrow" href="#section-8-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-2.1">Identify SFPs: this is typically the NSH Base Header and Service
          Path Header.<a class="pilcrow" href="#section-8-2.1">¶</a>
</li>
        <li class="normal" id="section-8-2.2">Carry metadata such as that defined in <a class="xref" href="#new">Section 5</a>.<a class="pilcrow" href="#section-8-2.2">¶</a>
</li>
        <li class="normal" id="section-8-2.3">Steer the traffic along the SFPs: This is realized by means of
        transport encapsulation.<a class="pilcrow" href="#section-8-2.3">¶</a>
</li>
      </ul>
<p id="section-8-3">This added information increases the size of the packet to be carried
      along an SFP.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4">Aligned with <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-5">Section 5</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>, it is
      <span class="bcp14">RECOMMENDED</span> that network operators increase the underlying MTU so that
      NSH traffic is forwarded within an SFC-enabled domain without
      fragmentation. The available underlying MTU should be taken into account
      by network operators when providing SFs with the required Context
      Headers to be injected per SFP and the size of the data to be carried in
      these Context Headers.<a class="pilcrow" href="#section-8-4">¶</a></p>
<p id="section-8-5">If the underlying MTU cannot be increased to accommodate the NSH
      overhead, network operators may rely upon a transport encapsulation
      protocol with the required fragmentation handling. The impact of
      activating such features on SFFs should be carefully assessed by network
      operators (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7665#section-5.6">Section 5.6</a> of [<a class="xref" href="#RFC7665">RFC7665</a>]</span>).<a class="pilcrow" href="#section-8-5">¶</a></p>
<p id="section-8-6">When dealing with MTU issues, network operators should consider the
      limitations of various tunnel mechanisms such as those discussed in
      <span>[<a class="xref" href="#I-D.ietf-intarea-tunnels">INTERNET-IP-TUNNELS</a>]</span>.<a class="pilcrow" href="#section-8-6">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-9">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-9-1">Data plane SFC-related security considerations, including privacy,
      are discussed in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7665#section-6">Section 6</a> of [<a class="xref" href="#RFC7665">RFC7665</a>]</span>
      and <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-8">Section 8</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>. In
      particular, <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8300#section-8.2.2">Section 8.2.2</a> of [<a class="xref" href="#RFC8300">RFC8300</a>]</span>
      states that attached metadata (i.e., Context Headers) should be limited
      to that which is necessary for correct operation of the SFP. Also, that section
      indicates that <span>[<a class="xref" href="#RFC8165">RFC8165</a>]</span> discusses
      metadata considerations that operators can take into account when using
      NSH.<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">The guidelines for cryptographic key management are discussed in
      <span>[<a class="xref" href="#RFC4107">RFC4107</a>]</span>. The group key management
      protocol-related security considerations discussed in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc4046#section-8">Section 8</a> of [<a class="xref" href="#RFC4046">RFC4046</a>]</span> need to be taken into
      consideration.<a class="pilcrow" href="#section-9-2">¶</a></p>
<p id="section-9-3">The interaction between the SFC data plane elements and a key
      management system <span class="bcp14">MUST NOT</span> be transmitted unencrypted since
      this would completely destroy the security benefits of the
      integrity-protection solution defined in this document.<a class="pilcrow" href="#section-9-3">¶</a></p>
<p id="section-9-4">The secret key (K) must have an expiration time assigned as the
      latest point in time before which the key may be used for integrity
      protection of NSH data and encryption of Context Headers. Prior to the
      expiration of the secret key, all participating NSH-aware nodes <span class="bcp14">SHOULD</span>
      have the control plane distribute a new key identifier and associated
      keying material so that when the secret key is expired, those nodes are
      prepared with the new secret key. This allows the NSH imposer to switch
      to the new key identifier as soon as necessary. It is <span class="bcp14">RECOMMENDED</span> that
      the next key identifier and associated keying material be distributed by
      the control plane well prior to the secret key expiration time.
      Additional guidance for users of AEAD functions about rekeying can be
      found in <span>[<a class="xref" href="#I-D.irtf-cfrg-aead-limits">AEAD-LIMITS</a>]</span>.<a class="pilcrow" href="#section-9-4">¶</a></p>
<p id="section-9-5">The security and integrity of the key-distribution mechanism is vital
      to the security of the SFC system as a whole.<a class="pilcrow" href="#section-9-5">¶</a></p>
<p id="section-9-6">NSH data is exposed to several threats:<a class="pilcrow" href="#section-9-6">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-7.1">An on-path attacker modifying the NSH data.<a class="pilcrow" href="#section-9-7.1">¶</a>
</li>
        <li class="normal" id="section-9-7.2">An attacker spoofing the NSH data.<a class="pilcrow" href="#section-9-7.2">¶</a>
</li>
        <li class="normal" id="section-9-7.3">An attacker capturing and replaying the NSH data.<a class="pilcrow" href="#section-9-7.3">¶</a>
</li>
        <li class="normal" id="section-9-7.4">Data carried in Context Headers revealing privacy-sensitive
          information to attackers.<a class="pilcrow" href="#section-9-7.4">¶</a>
</li>
        <li class="normal" id="section-9-7.5">An attacker replacing the packet on which the NSH is imposed with a
          modified or bogus packet.<a class="pilcrow" href="#section-9-7.5">¶</a>
</li>
      </ul>
<p id="section-9-8">In an SFC-enabled domain where the above attacks are possible, (1)
      NSH data <span class="bcp14">MUST</span> be integrity protected and
      replay protected, and (2) privacy-sensitive NSH metadata
      <span class="bcp14">MUST</span> be encrypted for confidentiality preservation
      purposes. The Base and Service Path Headers are not encrypted.<a class="pilcrow" href="#section-9-8">¶</a></p>
<p id="section-9-9">MACs with two levels of assurance are defined in <a class="xref" href="#new">Section 5</a>. Considerations specific to each level of assurance
      are discussed in Sections <a class="xref" href="#mac1">9.1</a> and
      <a class="xref" href="#mac2">9.2</a>.<a class="pilcrow" href="#section-9-9">¶</a></p>
<p id="section-9-10">The attacks discussed in <span>[<a class="xref" href="#I-D.nguyen-sfc-security-architecture">ARCH-SFC-THREATS</a>]</span> are
      handled based on the solution specified in this document, with the
      exception of attacks dropping packets. Such attacks can be detected
      by relying upon statistical analysis; such analysis is out of the scope of
      this document. Also, if SFFs are not involved in the integrity checks, a
      misbehaving SFF that decrements SI while this should be done by an SF
      (SF bypass attack) will be detected by an upstream SF because the
      integrity check will fail.<a class="pilcrow" href="#section-9-10">¶</a></p>
<p id="section-9-11">Some events are logged locally with notification alerts sent by
      NSH-aware nodes to a Control Element. These events <span class="bcp14">SHOULD</span> be
      rate limited.<a class="pilcrow" href="#section-9-11">¶</a></p>
<p id="section-9-12">The solution specified in this document does not provide data origin
      authentication.<a class="pilcrow" href="#section-9-12">¶</a></p>
<p id="section-9-13">In order to detect compromised nodes, it is assumed that appropriate
      mechanisms to monitor and audit an SFC-enabled domain to detect
      misbehavior and to deter misuse are in place. Compromised nodes can thus
      be withdrawn from active service function chains using appropriate
      control plane mechanisms.<a class="pilcrow" href="#section-9-13">¶</a></p>
<div id="mac1">
<section id="section-9.1">
        <h3 id="name-mac1">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-mac1">MAC#1</a>
        </h3>
<p id="section-9.1-1">An active attacker can potentially modify the Base Header (e.g.,
        decrement the TTL so the next SFF in the SFP discards the NSH packet).
        An active attacker can typically also drop NSH packets. As such, this
        attack is not considered an attack against the security mechanism
        specified in the document.<a class="pilcrow" href="#section-9.1-1">¶</a></p>
<p id="section-9.1-2">It is expected that specific devices in the SFC-enabled domain will
        be configured such that no device other than the Classifiers (when
        reclassification is enabled), NSH-aware SFs, and SFC proxies will be
        able to update the integrity-protected NSH data (<a class="xref" href="#gen">Section 7.1</a>), and no device other than the
        NSH-aware SFs and SFC proxies will be able to decrypt and update the
        Context Headers carrying sensitive metadata (<a class="xref" href="#gen">Section 7.1</a>). In other words, it is expected that the NSH-aware
        SFs and SFC proxies in the SFC-enabled domain are considered fully
        trusted to act on the NSH data. Only these elements can have access to
        sensitive NSH metadata and the keying material used to integrity
        protect NSH data and encrypt Context Headers.<a class="pilcrow" href="#section-9.1-2">¶</a></p>
</section>
</div>
<div id="mac2">
<section id="section-9.2">
        <h3 id="name-mac2">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-mac2">MAC#2</a>
        </h3>
<p id="section-9.2-1">SFFs can detect whether an illegitimate node has altered the
        content of the Base Header. Such messages must be discarded with
        appropriate logs and alarms generated (see <a class="xref" href="#gen">Section 7.1</a>).<a class="pilcrow" href="#section-9.2-1">¶</a></p>
<p id="section-9.2-2">Similar to <a class="xref" href="#mac1">Section 9.1</a>, no device other than the
        NSH-aware SFs and SFC proxies in the SFC-enabled domain should be able
        to decrypt and update the Context Headers carrying sensitive
        metadata.<a class="pilcrow" href="#section-9.2-2">¶</a></p>
</section>
</div>
<section id="section-9.3">
        <h3 id="name-time-synchronization">
<a class="section-number selfRef" href="#section-9.3">9.3. </a><a class="section-name selfRef" href="#name-time-synchronization">Time Synchronization</a>
        </h3>
<p id="section-9.3-1"><span>[<a class="xref" href="#RFC8633">RFC8633</a>]</span> describes best current practices to
        be considered in deployments where SFC data plane elements use NTP for
        time-synchronization purposes.<a class="pilcrow" href="#section-9.3-1">¶</a></p>
<p id="section-9.3-2">Also, a mechanism to provide cryptographic security for NTP is
        specified in <span>[<a class="xref" href="#RFC8915">RFC8915</a>]</span>.<a class="pilcrow" href="#section-9.3-2">¶</a></p>
</section>
</section>
</div>
<div id="IANA">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-10-1">IANA has added the following types to the "NSH IETF-Assigned Optional
      Variable-Length Metadata Types" registry (0x0000 IETF Base NSH MD Class)
      at <span>&lt;<a href="https://www.iana.org/assignments/nsh">https://www.iana.org/assignments/nsh</a>&gt;</span>.<a class="pilcrow" href="#section-10-1">¶</a></p>
<span id="name-additions-to-the-nsh-ietf-a"></span><table class="center" id="table-4">
        <caption>
<a class="selfRef" href="#table-4">Table 4</a>:
<a class="selfRef" href="#name-additions-to-the-nsh-ietf-a">Additions to the NSH IETF-Assigned Optional Variable-Length Metadata Types Registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Description</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">0x02</td>
            <td class="text-left" colspan="1" rowspan="1">MAC and Encrypted Metadata #1</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9145</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">0x03</td>
            <td class="text-left" colspan="1" rowspan="1">MAC and Encrypted Metadata #2</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9145</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-11.1">11.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="GCM">[GCM]</dt>
        <dd>
<span class="refAuthor">Dworkin, M.</span>, <span class="refTitle">"Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMAC"</span>, <span class="seriesInfo">NIST Special Publication 800-38D</span>, <span class="seriesInfo">DOI 10.6028/NIST.SP.800-38D</span>, <time class="refDate" datetime="2007-11">November 2007</time>, <span>&lt;<a href="https://doi.org/10.6028/NIST.SP.800-38D">https://doi.org/10.6028/NIST.SP.800-38D</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2104">[RFC2104]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refAuthor">Bellare, M.</span>, and <span class="refAuthor">R. Canetti</span>, <span class="refTitle">"HMAC: Keyed-Hashing for Message Authentication"</span>, <span class="seriesInfo">RFC 2104</span>, <span class="seriesInfo">DOI 10.17487/RFC2104</span>, <time class="refDate" datetime="1997-02">February 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2104">https://www.rfc-editor.org/info/rfc2104</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4107">[RFC4107]</dt>
        <dd>
<span class="refAuthor">Bellovin, S.</span> and <span class="refAuthor">R. Housley</span>, <span class="refTitle">"Guidelines for Cryptographic Key Management"</span>, <span class="seriesInfo">BCP 107</span>, <span class="seriesInfo">RFC 4107</span>, <span class="seriesInfo">DOI 10.17487/RFC4107</span>, <time class="refDate" datetime="2005-06">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4107">https://www.rfc-editor.org/info/rfc4107</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4868">[RFC4868]</dt>
        <dd>
<span class="refAuthor">Kelly, S.</span> and <span class="refAuthor">S. Frankel</span>, <span class="refTitle">"Using HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with IPsec"</span>, <span class="seriesInfo">RFC 4868</span>, <span class="seriesInfo">DOI 10.17487/RFC4868</span>, <time class="refDate" datetime="2007-05">May 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4868">https://www.rfc-editor.org/info/rfc4868</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time class="refDate" datetime="2008-01">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7665">[RFC7665]</dt>
        <dd>
<span class="refAuthor">Halpern, J., Ed.</span> and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Service Function Chaining (SFC) Architecture"</span>, <span class="seriesInfo">RFC 7665</span>, <span class="seriesInfo">DOI 10.17487/RFC7665</span>, <time class="refDate" datetime="2015-10">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7665">https://www.rfc-editor.org/info/rfc7665</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8300">[RFC8300]</dt>
      <dd>
<span class="refAuthor">Quinn, P., Ed.</span>, <span class="refAuthor">Elzur, U., Ed.</span>, and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Network Service Header (NSH)"</span>, <span class="seriesInfo">RFC 8300</span>, <span class="seriesInfo">DOI 10.17487/RFC8300</span>, <time class="refDate" datetime="2018-01">January 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8300">https://www.rfc-editor.org/info/rfc8300</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-11.2">11.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.irtf-cfrg-aead-limits">[AEAD-LIMITS]</dt>
        <dd>
<span class="refAuthor">Günther, F.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Usage Limits on AEAD Algorithms"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-aead-limits-03</span>, <time class="refDate" datetime="2021-07-12">12 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-03">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.nguyen-sfc-security-architecture">[ARCH-SFC-THREATS]</dt>
        <dd>
<span class="refAuthor">THANG, N. C.</span> and <span class="refAuthor">M. Park</span>, <span class="refTitle">"A Security Architecture Against Service Function Chaining Threats"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-nguyen-sfc-security-architecture-00</span>, <time class="refDate" datetime="2019-11-24">24 November 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-nguyen-sfc-security-architecture-00">https://datatracker.ietf.org/doc/html/draft-nguyen-sfc-security-architecture-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-intarea-tunnels">[INTERNET-IP-TUNNELS]</dt>
        <dd>
<span class="refAuthor">Touch, J.</span> and <span class="refAuthor">M. Townsley</span>, <span class="refTitle">"IP Tunnels in the Internet Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-intarea-tunnels-10</span>, <time class="refDate" datetime="2019-09-12">12 September 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-intarea-tunnels-10">https://datatracker.ietf.org/doc/html/draft-ietf-intarea-tunnels-10</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.arkko-farrell-arch-model-t">[INTERNET-THREAT-MODEL]</dt>
        <dd>
<span class="refAuthor">Arkko, J.</span> and <span class="refAuthor">S. Farrell</span>, <span class="refTitle">"Challenges and Changes in the Internet Threat Model"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-arkko-farrell-arch-model-t-04</span>, <time class="refDate" datetime="2020-07-13">13 July 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04">https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4046">[RFC4046]</dt>
        <dd>
<span class="refAuthor">Baugher, M.</span>, <span class="refAuthor">Canetti, R.</span>, <span class="refAuthor">Dondeti, L.</span>, and <span class="refAuthor">F. Lindholm</span>, <span class="refTitle">"Multicast Security (MSEC) Group Key Management Architecture"</span>, <span class="seriesInfo">RFC 4046</span>, <span class="seriesInfo">DOI 10.17487/RFC4046</span>, <time class="refDate" datetime="2005-04">April 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4046">https://www.rfc-editor.org/info/rfc4046</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5905">[RFC5905]</dt>
        <dd>
<span class="refAuthor">Mills, D.</span>, <span class="refAuthor">Martin, J., Ed.</span>, <span class="refAuthor">Burbank, J.</span>, and <span class="refAuthor">W. Kasch</span>, <span class="refTitle">"Network Time Protocol Version 4: Protocol and Algorithms Specification"</span>, <span class="seriesInfo">RFC 5905</span>, <span class="seriesInfo">DOI 10.17487/RFC5905</span>, <time class="refDate" datetime="2010-06">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5905">https://www.rfc-editor.org/info/rfc5905</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6973">[RFC6973]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Morris, J.</span>, <span class="refAuthor">Hansen, M.</span>, and <span class="refAuthor">R. Smith</span>, <span class="refTitle">"Privacy Considerations for Internet Protocols"</span>, <span class="seriesInfo">RFC 6973</span>, <span class="seriesInfo">DOI 10.17487/RFC6973</span>, <time class="refDate" datetime="2013-07">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6973">https://www.rfc-editor.org/info/rfc6973</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time class="refDate" datetime="2014-05">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7258">https://www.rfc-editor.org/info/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7498">[RFC7498]</dt>
        <dd>
<span class="refAuthor">Quinn, P., Ed.</span> and <span class="refAuthor">T. Nadeau, Ed.</span>, <span class="refTitle">"Problem Statement for Service Function Chaining"</span>, <span class="seriesInfo">RFC 7498</span>, <span class="seriesInfo">DOI 10.17487/RFC7498</span>, <time class="refDate" datetime="2015-04">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7498">https://www.rfc-editor.org/info/rfc7498</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7635">[RFC7635]</dt>
        <dd>
<span class="refAuthor">Reddy, T.</span>, <span class="refAuthor">Patil, P.</span>, <span class="refAuthor">Ravindranath, R.</span>, and <span class="refAuthor">J. Uberti</span>, <span class="refTitle">"Session Traversal Utilities for NAT (STUN) Extension for Third-Party Authorization"</span>, <span class="seriesInfo">RFC 7635</span>, <span class="seriesInfo">DOI 10.17487/RFC7635</span>, <time class="refDate" datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7635">https://www.rfc-editor.org/info/rfc7635</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8165">[RFC8165]</dt>
        <dd>
<span class="refAuthor">Hardie, T.</span>, <span class="refTitle">"Design Considerations for Metadata Insertion"</span>, <span class="seriesInfo">RFC 8165</span>, <span class="seriesInfo">DOI 10.17487/RFC8165</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8165">https://www.rfc-editor.org/info/rfc8165</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8459">[RFC8459]</dt>
        <dd>
<span class="refAuthor">Dolson, D.</span>, <span class="refAuthor">Homma, S.</span>, <span class="refAuthor">Lopez, D.</span>, and <span class="refAuthor">M. Boucadair</span>, <span class="refTitle">"Hierarchical Service Function Chaining (hSFC)"</span>, <span class="seriesInfo">RFC 8459</span>, <span class="seriesInfo">DOI 10.17487/RFC8459</span>, <time class="refDate" datetime="2018-09">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8459">https://www.rfc-editor.org/info/rfc8459</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8633">[RFC8633]</dt>
        <dd>
<span class="refAuthor">Reilly, D.</span>, <span class="refAuthor">Stenn, H.</span>, and <span class="refAuthor">D. Sibold</span>, <span class="refTitle">"Network Time Protocol Best Current Practices"</span>, <span class="seriesInfo">BCP 223</span>, <span class="seriesInfo">RFC 8633</span>, <span class="seriesInfo">DOI 10.17487/RFC8633</span>, <time class="refDate" datetime="2019-07">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8633">https://www.rfc-editor.org/info/rfc8633</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8877">[RFC8877]</dt>
        <dd>
<span class="refAuthor">Mizrahi, T.</span>, <span class="refAuthor">Fabini, J.</span>, and <span class="refAuthor">A. Morton</span>, <span class="refTitle">"Guidelines for Defining Packet Timestamps"</span>, <span class="seriesInfo">RFC 8877</span>, <span class="seriesInfo">DOI 10.17487/RFC8877</span>, <time class="refDate" datetime="2020-09">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8877">https://www.rfc-editor.org/info/rfc8877</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8915">[RFC8915]</dt>
      <dd>
<span class="refAuthor">Franke, D.</span>, <span class="refAuthor">Sibold, D.</span>, <span class="refAuthor">Teichel, K.</span>, <span class="refAuthor">Dansarie, M.</span>, and <span class="refAuthor">R. Sundblad</span>, <span class="refTitle">"Network Time Security for the Network Time Protocol"</span>, <span class="seriesInfo">RFC 8915</span>, <span class="seriesInfo">DOI 10.17487/RFC8915</span>, <time class="refDate" datetime="2020-09">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8915">https://www.rfc-editor.org/info/rfc8915</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">This document was created as a follow-up to the discussion in
      IETF 104:
      <span>&lt;<a href="https://datatracker.ietf.org/meeting/104/materials/slides-104-sfc-sfc-chair-slides-01">https://datatracker.ietf.org/meeting/104/materials/slides-104-sfc-sfc-chair-slides-01</a>&gt;</span>
      (slide 7).<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<p id="appendix-A-2">Thanks to <span class="contact-name">Joel Halpern</span>, <span class="contact-name">Christian Jacquenet</span>, <span class="contact-name">Dirk von Hugo</span>,
      <span class="contact-name">Tal Mizrahi</span>, <span class="contact-name">Daniel Migault</span>,
      <span class="contact-name">Diego Lopez</span>, <span class="contact-name">Greg Mirsky</span>,
      and <span class="contact-name">Dhruv Dhody</span> for the comments.<a class="pilcrow" href="#appendix-A-2">¶</a></p>
<p id="appendix-A-3">Many thanks to <span class="contact-name">Steve Hanna</span> for the valuable secdir review and
      <span class="contact-name">Juergen Schoenwaelder</span> for the opsdir review.<a class="pilcrow" href="#appendix-A-3">¶</a></p>
<p id="appendix-A-4">Thanks to <span class="contact-name">Greg Mirsky</span> for the <span class="contact-name">Shepherd review</span>.<a class="pilcrow" href="#appendix-A-4">¶</a></p>
<p id="appendix-A-5">Thanks to <span class="contact-name">Alvaro Retana</span>, <span class="contact-name">Lars Eggert</span>, <span class="contact-name">Martin Duke</span>, <span class="contact-name">Erik Kline</span>, <span class="contact-name">Zaheduzzaman Sarker</span>,
      <span class="contact-name">Éric Vyncke</span>, <span class="contact-name">Roman Danyliw</span>,
      <span class="contact-name">Murray Kucherawy</span>, <span class="contact-name">John       Scudder</span>, and <span class="contact-name">Benjamin Kaduk</span> for the IESG
      review.<a class="pilcrow" href="#appendix-A-5">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mohamed Boucadair</span></div>
<div class="left" dir="auto"><span class="org">Orange</span></div>
<div class="left" dir="auto">
<span class="postal-code">35000</span> <span class="locality">Rennes</span>
</div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mohamed.boucadair@orange.com">mohamed.boucadair@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Tirumaleswar Reddy.K</span></div>
<div class="left" dir="auto"><span class="org">Akamai</span></div>
<div class="left" dir="auto"><span class="street-address">Embassy Golf Link Business Park</span></div>
<div class="left" dir="auto">
<span class="locality">Bangalore</span> <span class="postal-code">560071</span>
</div>
<div class="left" dir="auto"><span class="region">Karnataka</span></div>
<div class="left" dir="auto"><span class="country-name">India</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:kondtir@gmail.com">kondtir@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Dan Wing</span></div>
<div class="left" dir="auto"><span class="org">Citrix Systems, Inc.</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:dwing-ietf@fuggles.com">dwing-ietf@fuggles.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>