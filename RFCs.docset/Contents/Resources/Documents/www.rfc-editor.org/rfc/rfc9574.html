<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9574: Optimized Ingress Replication Solution for Ethernet VPNs (EVPNs)</title>
<meta content="Jorge Rabadan" name="author"/>
<meta content="Senthil Sathappan" name="author"/>
<meta content="Wen Lin" name="author"/>
<meta content="Mukul Katiyar" name="author"/>
<meta content="Ali Sajassi" name="author"/>
<meta content="
       Network Virtualization Overlay (NVO) networks using Ethernet VPNs
      (EVPNs) as their control plane may use trees based on ingress replication
      or Protocol Independent Multicast (PIM) to convey the overlay Broadcast,
      Unknown Unicast, or Multicast (BUM) traffic. PIM provides an efficient
      solution that prevents sending multiple copies of the same packet over the
      same physical link; however, it may not always be deployed in the
      NVO network core. Ingress replication avoids the
      dependency on PIM in the NVO network core.
      While ingress replication provides a simple multicast transport, some
      NVO networks with demanding multicast
      applications require a more efficient solution without PIM in the core.
      This document describes a solution to optimize the efficiency of ingress
      replication trees. 
    " name="description"/>
<meta content="xml2rfc 3.21.0" name="generator"/>
<meta content="Assisted Replication" name="keyword"/>
<meta content="AR" name="keyword"/>
<meta content="AR-Replicator" name="keyword"/>
<meta content="RNVE" name="keyword"/>
<meta content="Pruned Flood List" name="keyword"/>
<meta content="PFL" name="keyword"/>
<meta content="Pruned Flooding List" name="keyword"/>
<meta content="9574" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.21.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9574.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-bess-evpn-optimized-ir-12" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9574" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9574</td>
<td class="center">EVPN Optimized IR</td>
<td class="right">May 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rabadan, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9574">9574</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-05">May 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Rabadan, <span class="editor">Ed.</span>
</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Sathappan</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">W. Lin</div>
<div class="org">Juniper Networks</div>
</div>
<div class="author">
      <div class="author-name">M. Katiyar</div>
<div class="org">Versa Networks</div>
</div>
<div class="author">
      <div class="author-name">A. Sajassi</div>
<div class="org">Cisco Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9574</h1>
<h1 id="title">Optimized Ingress Replication Solution for Ethernet VPNs (EVPNs)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">Network Virtualization Overlay (NVO) networks using Ethernet VPNs
      (EVPNs) as their control plane may use trees based on ingress replication
      or Protocol Independent Multicast (PIM) to convey the overlay Broadcast,
      Unknown Unicast, or Multicast (BUM) traffic. PIM provides an efficient
      solution that prevents sending multiple copies of the same packet over the
      same physical link; however, it may not always be deployed in the
      NVO network core. Ingress replication avoids the
      dependency on PIM in the NVO network core.
      While ingress replication provides a simple multicast transport, some
      NVO networks with demanding multicast
      applications require a more efficient solution without PIM in the core.
      This document describes a solution to optimize the efficiency of ingress
      replication trees.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9574">https://www.rfc-editor.org/info/rfc9574</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-terminology-and-conventions">Terminology and Conventions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-solution-requirements">Solution Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-evpn-bgp-attributes-for-opt">EVPN BGP Attributes for Optimized Ingress Replication</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-non-selective-assisted-repl">Non-selective Assisted Replication (AR) Solution Description</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-non-selective-ar-replicator">Non-selective AR-REPLICATOR Procedures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-non-selective-ar-leaf-proce">Non-selective AR-LEAF Procedures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a class="auto internal xref" href="#section-5.3">5.3</a>.  <a class="internal xref" href="#name-rnve-procedures">RNVE Procedures</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-selective-assisted-replicat">Selective Assisted Replication (AR) Solution Description</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-selective-ar-replicator-pro">Selective AR-REPLICATOR Procedures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#section-6.2">6.2</a>.  <a class="internal xref" href="#name-selective-ar-leaf-procedure">Selective AR-LEAF Procedures</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-pruned-flooding-lists-pfls">Pruned Flooding Lists (PFLs)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-example-of-a-pruned-floodin">Example of a Pruned Flooding List</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-ar-procedures-for-single-ip">AR Procedures for Single-IP AR-REPLICATORS</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-ar-procedures-and-evpn-all-">AR Procedures and EVPN All-Active Multihoming Split-Horizon</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-ethernet-segments-on-ar-lea">Ethernet Segments on AR-LEAF Nodes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-ethernet-segments-on-ar-rep">Ethernet Segments on AR-REPLICATOR Nodes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#section-11">11</a>. <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#section-12">12</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a class="auto internal xref" href="#section-12.1">12.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a class="auto internal xref" href="#section-12.2">12.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-contributors">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sect-1">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">Ethernet Virtual Private Networks (EVPNs) may be used as the control
      plane for a Network Virtualization Overlay (NVO) network <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>. Network Virtualization Edge (NVE) and Provider Edge
      (PE) devices that are part of the same EVPN Broadcast Domain (BD) use
      Ingress Replication (IR) or PIM-based trees to transport the tenant's
      Broadcast, Unknown Unicast, or Multicast (BUM) traffic.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2"> In the ingress replication approach, the ingress NVE receiving a BUM
      frame from the Tenant System (TS) will create as many copies of the
      frame as the number of remote NVEs/PEs that are attached to the BD. Each of
      those copies will be
      encapsulated into an IP packet where the outer IP Destination Address
      (IP DA) identifies the loopback of the egress NVE/PE. The IP fabric core
      nodes (also known as spines) will simply route the IP-encapsulated BUM
      frames based on the outer IP DA. If PIM-based trees are used instead of
      ingress replication, the NVEs/PEs attached to the same BD will join a
      PIM-based tree. The ingress NVE receiving a BUM frame will send a single
      copy of the frame, encapsulated into an IP packet where the outer IP DA
      is the multicast address that represents the PIM-based tree. The IP
      fabric core nodes are part of the PIM tree and keep multicast state for
      the multicast group, so that IP-encapsulated BUM frames can be routed to
      all the NVEs/PEs that joined the tree.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The two approaches are illustrated in <a class="auto internal xref" href="#IR-PIM">Figure 1</a>. On the
      left-hand side of the diagram, NVE1 uses ingress replication to send a BUM frame
      (originated from Tenant System TS1) to the remote nodes attached to the
      BD, i.e., NVE2, NVE3, and PE1. On the right-hand side, the
      same example is depicted but using a PIM-based tree, i.e., (S1,G1),
      instead of ingress replication. While a single copy of the tunneled BUM
      frame is generated in the latter approach, all the routers in the fabric
      need to keep multicast state, e.g., the spine keeps a PIM
      routing entry for (S1,G1) with an Incoming Interface (IIF) and three
      Outgoing Interfaces (OIFs).<a class="pilcrow" href="#section-1-3">¶</a></p>
<span id="name-ingress-replication-vs-pim-"></span><div id="IR-PIM">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-1-4.1">
<pre>           To WAN                           To WAN
              ^                                ^
              |                                |
           +-----+                          +-----+
+----------| PE1 |-----------+   +----------| PE1 |-----------+
|          +--^--+           |   |          +--^--+           |
|             |    IP Fabric |   |             |    IP Fabric |
|             PE             |   |    (S1,G1)  |OIF to G1     |
| +----PE-&gt;+-----+ No State  |   |      IIF +-----+ OIF to G1 |
| | +---2-&gt;|Spine|------+    |   |   +------&gt;Spine|------+    |
| | | +-3-&gt;+-----+      |    |   |   |      +-----+      |    |
| | | |       2         3    |   |   |PIM      |OIF to G1|    |
| | | |IR     |         |    |   |   |tree     |         |    |
|+-----+   +--v--+   +--v--+ |   |+-----+   +--v--+   +--v--+ |
+| NVE1|---| NVE2|---| NVE3|-+   +| NVE1|---| NVE2|---| NVE3|-+
 +--^--+   +-----+   +-----+      +--^--+   +-----+   +-----+
    |         |         |            |         |         |
    |         v         v            |         v         v
   TS1       TS2       TS3          TS1       TS2       TS3
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-ingress-replication-vs-pim-">Ingress Replication vs. PIM-Based Trees in NVO Networks</a>
        </figcaption></figure>
</div>
<p id="section-1-5">In NVO networks where PIM-based trees
      cannot be used, ingress replication is the only option. Examples of
      these situations are NVO networks where the
      core nodes do not support PIM or the network operator does not want to
      run PIM in the core.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">In some use cases, the amount of replication for BUM traffic is kept
      under control on the NVEs due to the following fairly common
      assumptions:<a class="pilcrow" href="#section-1-6">¶</a></p>
<ol class="normal type-a" id="section-1-7" start="1" type="a">
<li id="section-1-7.1">Broadcast traffic is greatly reduced due to the proxy
          Address Resolution Protocol (ARP) and proxy Neighbor Discovery (ND)
          capabilities supported by EVPNs <span>[<a class="cite xref" href="#RFC9161">RFC9161</a>]</span> on the NVEs. Some NVEs can even
          provide Dynamic Host Configuration Protocol (DHCP) server functions
          for the attached TSs, reducing the broadcast traffic even
          further.<a class="pilcrow" href="#section-1-7.1">¶</a>
</li>
        <li id="section-1-7.2">Unknown
          unicast traffic is greatly reduced in NVO
          networks where all the Media Access Control (MAC) and IP addresses from the TSs
          are learned in the control plane.<a class="pilcrow" href="#section-1-7.2">¶</a>
</li>
        <li id="section-1-7.3">Multicast applications are not used.<a class="pilcrow" href="#section-1-7.3">¶</a>
</li>
      </ol>
<p id="section-1-8">If the above assumptions are true for a given NVO network, then ingress replication provides a simple solution for
      multi-destination traffic. However, statement c. above is not always
      true, and multicast applications are required in many use cases.<a class="pilcrow" href="#section-1-8">¶</a></p>
<p id="section-1-9">When the multicast sources are attached to NVEs residing in
      hypervisors or low-performance-replication Top-of-Rack (ToR) switches,
      the ingress replication of a large amount of multicast traffic to a
      significant number of remote NVEs/PEs can seriously degrade the
      performance of the NVE and impact the application.<a class="pilcrow" href="#section-1-9">¶</a></p>
<p id="section-1-10">This document describes a solution that makes use of two ingress
      replication optimizations:<a class="pilcrow" href="#section-1-10">¶</a></p>
<ol class="normal type-1" id="section-1-11" start="1" type="1">
<li id="section-1-11.1">Assisted Replication (AR)<a class="pilcrow" href="#section-1-11.1">¶</a>
</li>
        <li id="section-1-11.2">Pruned Flooding Lists (PFLs)<a class="pilcrow" href="#section-1-11.2">¶</a>
</li>
      </ol>
<p id="section-1-12">Assisted Replication consists of a set of procedures that allows the
      ingress NVE/PE to send a single copy of a broadcast or multicast frame
      received from a TS to the BD without the need
      for PIM in the underlay. Assisted Replication defines the roles of
      AR-REPLICATOR and AR-LEAF routers. The AR-LEAF is the ingress NVE/PE
      attached to the TS. The AR-LEAF sends a single copy of a
      broadcast or multicast packet to a selected AR-REPLICATOR that
      replicates the packet multiple times to remote AR-LEAF or AR-REPLICATOR
      routers and is therefore "assisting" the ingress AR-LEAF in delivering the
      broadcast or multicast traffic to the remote NVEs/PEs attached to the
      same BD. Assisted Replication can use a single
      AR-REPLICATOR or two AR-REPLICATOR routers in the path between the
      ingress AR-LEAF and the remote destination NVEs/PEs. The procedures that
      use a single AR-REPLICATOR (the non-selective Assisted Replication solution)
      are specified in <a class="auto internal xref" href="#sect-5">Section 5</a>, whereas <a class="auto internal xref" href="#sect-6">Section 6</a> describes how multi-stage replication, i.e., two
      AR-REPLICATOR routers in the path between the ingress AR-LEAF and
      destination NVEs/PEs, is accomplished (the selective Assisted Replication
      solution). The procedures for Assisted Replication do not impact unknown
      unicast traffic, which follows the same forwarding procedures as known
      unicast traffic so that packet reordering does not occur.<a class="pilcrow" href="#section-1-12">¶</a></p>
<p id="section-1-13">PFLs provide a method for the ingress NVE/PE to prune or
      remove certain destination NVEs/PEs from a flooding list, depending on the
      interest of those NVEs/PEs in receiving BUM traffic. As specified in <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>, an NVE/PE builds a
      flooding list for BUM traffic based on the next hops of the received EVPN
      Inclusive Multicast Ethernet Tag routes for the BD. While
      <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> states that the flooding list is used for all BUM
      traffic, this document allows pruning certain next hops from the list.
      As an example, suppose an ingress NVE creates a flooding list with
      next hops PE1, PE2, and PE3. If PE2 and PE3 did not signal any interest in
      receiving unknown unicast traffic in their Inclusive Multicast Ethernet Tag
      routes, when the ingress NVE receives an unknown unicast frame from a
      TS, it will replicate it only to PE1. That is, PE2 and PE3 are
      "pruned" from the NVE's flooding list for unknown unicast traffic.
      PFLs can be used with ingress replication or
      Assisted Replication and are described in <a class="auto internal xref" href="#sect-7">Section 7</a>.<a class="pilcrow" href="#section-1-13">¶</a></p>
<p id="section-1-14">Both optimizations -- Assisted Replication and PFLs -- may
      be used together or independently so that the performance and efficiency
      of the network to transport multicast can be improved. Both solutions
      require some extensions to the BGP attributes used in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>; see <a class="auto internal xref" href="#sect-4">Section 4</a> for details.<a class="pilcrow" href="#section-1-14">¶</a></p>
<p id="section-1-15">The Assisted Replication solution described in this document is
      focused on NVO networks (hence its use of IP
      tunnels). MPLS transport networks are out of scope for this document. The
      PFLs solution <span class="bcp14">MAY</span> be used in NVO
      and MPLS transport networks.<a class="pilcrow" href="#section-1-15">¶</a></p>
<p id="section-1-16"><a class="auto internal xref" href="#sect-3">Section 3</a> lists the requirements of the combined
      optimized ingress replication solution, whereas Sections <a class="auto internal xref" href="#sect-5">5</a>
      and <a class="auto internal xref" href="#sect-6">6</a> describe the Assisted Replication solution
      for non-selective and selective procedures, respectively. <a class="auto internal xref" href="#sect-7">Section 7</a> provides the PFLs solution.<a class="pilcrow" href="#section-1-16">¶</a></p>
</section>
</div>
<div id="sect-2">
<section id="section-2">
      <h2 id="name-terminology-and-conventions">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology-and-conventions">Terminology and Conventions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
      "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
      "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
      "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are
      to be interpreted as described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and
      only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">The following terminology is used throughout this document:<a class="pilcrow" href="#section-2-2">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-3">
        <dt id="section-2-3.1">AR-IP:</dt>
        <dd id="section-2-3.2" style="margin-left: 1.5em">Assisted Replication - IP. Refers to an IP address owned by the AR-REPLICATOR and used to
          differentiate the incoming traffic that must follow the AR
          procedures. The AR-IP is also used in the Tunnel Identifier and
          Next Hop fields of the Replicator-AR route.<a class="pilcrow" href="#section-2-3.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">AR-LEAF:</dt>
        <dd id="section-2-3.4" style="margin-left: 1.5em">Assisted Replication - LEAF. Refers to an NVE/PE that
          sends all the BM traffic to an AR-REPLICATOR
          that can replicate the traffic further on its behalf. An AR-LEAF is
          typically an NVE/PE with poor replication performance
          capabilities.<a class="pilcrow" href="#section-2-3.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.5">AR-REPLICATOR:</dt>
        <dd id="section-2-3.6" style="margin-left: 1.5em">Assisted Replication - REPLICATOR. Refers to an
          NVE/PE that can replicate broadcast or multicast traffic received on
          overlay tunnels to other overlay tunnels and local Attachment Circuits (ACs).
          This document defines the control and data plane
          procedures that an AR-REPLICATOR needs to follow.<a class="pilcrow" href="#section-2-3.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.7">AR-VNI:</dt>
        <dd id="section-2-3.8" style="margin-left: 1.5em">Assisted Replication - VNI. Refers to a Virtual eXtensible Local Area Network (VXLAN) Network Identifier (VNI) advertised by the AR-REPLICATOR along with the
          Replicator-AR route. It is used to identify the incoming packets
          that must follow the AR procedures ONLY in the single-IP AR-REPLICATOR
          case (see <a class="auto internal xref" href="#sect-8">Section 8</a>).<a class="pilcrow" href="#section-2-3.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.9">Assisted Replication forwarding mode:</dt>
        <dd id="section-2-3.10" style="margin-left: 1.5em">In the case of an AR-LEAF,
          sending an AC Broadcast and Multicast (BM) packet to a single AR-REPLICATOR
          with a tunnel destination address AR-IP. In the case of an AR-REPLICATOR, this means
          sending a BM packet to a selected number of, or all of, the overlay tunnels
          when the packet was previously received from an overlay tunnel.<a class="pilcrow" href="#section-2-3.10">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.11">BD:</dt>
        <dd id="section-2-3.12" style="margin-left: 1.5em"> Broadcast Domain, as defined in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-2-3.12">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.13">BD label:</dt>
        <dd id="section-2-3.14" style="margin-left: 1.5em">Defined as the MPLS label that identifies the BD
          and is advertised in Regular-IR or Replicator-AR routes, when
          the encapsulation is MPLS over GRE (MPLSoGRE) or MPLS over UDP (MPLSoUDP).<a class="pilcrow" href="#section-2-3.14">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.15">BM traffic:</dt>
        <dd id="section-2-3.16" style="margin-left: 1.5em">Refers to broadcast and multicast frames (excluding
          unknown unicast frames).<a class="pilcrow" href="#section-2-3.16">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.17">DF and NDF:</dt>
        <dd id="section-2-3.18" style="margin-left: 1.5em">Designated Forwarder and Non-Designated Forwarder.
          These are roles defined in NVEs/PEs attached to multihomed TSs,
          as per <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>.<a class="pilcrow" href="#section-2-3.18">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.19">ES and ESI:</dt>
        <dd id="section-2-3.20" style="margin-left: 1.5em">Ethernet Segment and Ethernet Segment Identifier.
          EVPN multihoming concepts as specified in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-2-3.20">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.21">EVI:</dt>
        <dd id="section-2-3.22" style="margin-left: 1.5em"> EVPN Instance. A group of Provider Edge (PE) devices
          participating in the same EVPN service, as specified in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-2-3.22">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.23">GRE:</dt>
        <dd id="section-2-3.24" style="margin-left: 1.5em">Generic Routing Encapsulation <span>[<a class="cite xref" href="#RFC4023">RFC4023</a>]</span>.<a class="pilcrow" href="#section-2-3.24">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.25">Ingress Replication forwarding mode:</dt>
        <dd id="section-2-3.26" style="margin-left: 1.5em"> Refers to the ingress
          replication behavior explained in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. In
          this mode, an AC BM packet copy is sent to each remote PE/NVE
          in the BD, and an overlay BM packet is sent only to the ACs
          and not to other overlay tunnels.<a class="pilcrow" href="#section-2-3.26">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.27">IR-IP:</dt>
        <dd id="section-2-3.28" style="margin-left: 1.5em">Ingress Replication - IP. Refers to the local IP address of an NVE/PE that is used for the ingress
          replication signaling and procedures provided in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.
          Encapsulated incoming traffic with an outer destination IP address matching the
          IR-IP will follow the procedures for ingress replication and not the
          procedures for Assisted Replication. The IR-IP is also used in the
          Tunnel Identifier and Next Hop fields of the Regular-IR route.<a class="pilcrow" href="#section-2-3.28">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.29">IR-VNI:</dt>
        <dd id="section-2-3.30" style="margin-left: 1.5em">Ingress Replication - VNI. Refers to a VNI advertised along with the Inclusive Multicast
          Ethernet Tag route for the ingress replication tunnel type.<a class="pilcrow" href="#section-2-3.30">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.31">MPLS:</dt>
        <dd id="section-2-3.32" style="margin-left: 1.5em">Multi-Protocol Label Switching.<a class="pilcrow" href="#section-2-3.32">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.33">NVE:</dt>
        <dd id="section-2-3.34" style="margin-left: 1.5em">Network Virtualization Edge <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>.<a class="pilcrow" href="#section-2-3.34">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.35">NVGRE:</dt>
        <dd id="section-2-3.36" style="margin-left: 1.5em">Network virtualization using Generic Routing
          Encapsulation <span>[<a class="cite xref" href="#RFC7637">RFC7637</a>]</span>.<a class="pilcrow" href="#section-2-3.36">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.37">PE:</dt>
        <dd id="section-2-3.38" style="margin-left: 1.5em">Provider Edge.<a class="pilcrow" href="#section-2-3.38">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.39">PMSI:</dt>
        <dd id="section-2-3.40" style="margin-left: 1.5em">P-Multicast Service Interface. A conceptual interface for
          a PE to send customer multicast traffic to all or some PEs in the
          same VPN <span>[<a class="cite xref" href="#RFC6513">RFC6513</a>]</span>.<a class="pilcrow" href="#section-2-3.40">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.41">RD:</dt>
        <dd id="section-2-3.42" style="margin-left: 1.5em">Route Distinguisher.<a class="pilcrow" href="#section-2-3.42">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.43">Regular-IR route:</dt>
        <dd id="section-2-3.44" style="margin-left: 1.5em">An EVPN Inclusive Multicast Ethernet Tag route
          <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> that uses the ingress replication tunnel
          type.<a class="pilcrow" href="#section-2-3.44">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.45">Replicator-AR route:</dt>
        <dd id="section-2-3.46" style="margin-left: 1.5em">An EVPN Inclusive Multicast Ethernet Tag
          route that is advertised by an AR-REPLICATOR to signal its
          capabilities, as described in <a class="auto internal xref" href="#sect-4">Section 4</a>.<a class="pilcrow" href="#section-2-3.46">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.47">RNVE:</dt>
        <dd id="section-2-3.48" style="margin-left: 1.5em">Regular NVE. Refers to an NVE that supports the procedures
          provided in <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> and does not support the procedures provided in
          this document. However, this document defines procedures to
          interoperate with RNVEs.<a class="pilcrow" href="#section-2-3.48">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.49">ToR switch:</dt>
        <dd id="section-2-3.50" style="margin-left: 1.5em">Top-of-Rack switch.<a class="pilcrow" href="#section-2-3.50">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.51">TS and VM:</dt>
        <dd id="section-2-3.52" style="margin-left: 1.5em">Tenant System and Virtual Machine. In this document,
          TSs and VMs are the devices connected to
          the ACs of the PEs and NVEs.<a class="pilcrow" href="#section-2-3.52">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.53">VNI:</dt>
        <dd id="section-2-3.54" style="margin-left: 1.5em">VXLAN Network Identifier. Used in VXLAN tunnels.<a class="pilcrow" href="#section-2-3.54">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.55">VSID:</dt>
        <dd id="section-2-3.56" style="margin-left: 1.5em">Virtual Segment Identifier. Used in NVGRE tunnels.<a class="pilcrow" href="#section-2-3.56">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.57">VXLAN:</dt>
        <dd id="section-2-3.58" style="margin-left: 1.5em">Virtual eXtensible Local Area Network <span>[<a class="cite xref" href="#RFC7348">RFC7348</a>]</span>.<a class="pilcrow" href="#section-2-3.58">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="sect-3">
<section id="section-3">
      <h2 id="name-solution-requirements">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-solution-requirements">Solution Requirements</a>
      </h2>
<p id="section-3-1">The ingress replication optimization solution specified in this
      document meets the following requirements:<a class="pilcrow" href="#section-3-1">¶</a></p>
<ol class="normal type-a" id="section-3-2" start="1" type="a">
<li id="section-3-2.1">The solution provides an ingress replication optimization for BM
          traffic without the need for PIM while preserving the
          packet order for unicast applications, i.e., unknown unicast traffic
          should follow the same path as known unicast traffic. This
          optimization is required in low-performance NVEs.<a class="pilcrow" href="#section-3-2.1">¶</a>
</li>
        <li id="section-3-2.2">The solution reduces the flooded traffic in NVO
          networks where some NVEs do not need broadcast/multicast and/or
          unknown unicast traffic.<a class="pilcrow" href="#section-3-2.2">¶</a>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">The solution is compatible with <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and
          <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> and has no impact on the Customer Edge (CE) procedures for
          BM traffic. In particular, the solution supports the following EVPN
          functions:<a class="pilcrow" href="#section-3-2.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.3.2.1">All-active multihoming, including the split-horizon and
              DF functions.<a class="pilcrow" href="#section-3-2.3.2.1">¶</a>
</li>
            <li class="normal" id="section-3-2.3.2.2">Single-active multihoming, including the DF function.<a class="pilcrow" href="#section-3-2.3.2.2">¶</a>
</li>
            <li class="normal" id="section-3-2.3.2.3">Handling of multi-destination traffic and processing of
              BM traffic as per <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-3-2.3.2.3">¶</a>
</li>
          </ul>
</li>
        <li id="section-3-2.4">The solution is backward compatible with existing NVEs using a
          non-optimized version of ingress replication. A given BD can have
          NVEs/PEs supporting regular ingress replication and optimized
          ingress replication.<a class="pilcrow" href="#section-3-2.4">¶</a>
</li>
        <li id="section-3-2.5">The solution is independent of the NVO-specific data plane encapsulation and the virtual identifiers being
          used, e.g., VXLAN VNIs, NVGRE VSIDs, or MPLS labels, as long as the
          tunnel is IP based.<a class="pilcrow" href="#section-3-2.5">¶</a>
</li>
      </ol>
</section>
</div>
<div id="sect-4">
<section id="section-4">
      <h2 id="name-evpn-bgp-attributes-for-opt">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-evpn-bgp-attributes-for-opt">EVPN BGP Attributes for Optimized Ingress Replication</a>
      </h2>
<p id="section-4-1">The ingress replication optimization solution specified in this document
extends the Inclusive
      Multicast Ethernet Tag routes and attributes described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> so that an NVE/PE can
      signal its optimized ingress replication capabilities.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">The Network Layer Reachability Information (NLRI) of the Inclusive Multicast Ethernet Tag route <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> is shown in <a class="auto internal xref" href="#imet-route">Figure 2</a> and is
      used in this document without any modifications to its format. The PMSI
      Tunnel Attribute's general format as provided in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> (which
      takes it from <span>[<a class="cite xref" href="#RFC6514">RFC6514</a>]</span>) is used in this document; only a
      new tunnel type and new flags are specified, as shown in <a class="auto internal xref" href="#pta">Figure 3</a>.<a class="pilcrow" href="#section-4-2">¶</a></p>
<span id="name-evpn-inclusive-multicast-et"></span><div id="imet-route">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-4-3.1">
<pre>                 +------------------------------------+
                 |      RD (8 octets)                 |
                 +------------------------------------+
                 |  Ethernet Tag ID (4 octets)        |
                 +------------------------------------+
                 |  IP Address Length (1 octet)       |
                 +------------------------------------+
                 |  Originating Router's IP Address   |
                 |        (4 or 16 octets)            |
                 +------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-evpn-inclusive-multicast-et">EVPN Inclusive Multicast Ethernet Tag Route's NLRI</a>
        </figcaption></figure>
</div>
<span id="name-pmsi-tunnel-attribute"></span><div id="pta">
<figure id="figure-3">
        <div class="alignLeft art-text artwork" id="section-4-4.1">
<pre>                                        0  1  2  3  4  5  6  7
+---------------------------------+    +--+--+--+--+--+--+--+--+
|  Flags (1 octet)                | -&gt; |x |E |x |  T  |BM|U |L |
+---------------------------------+    +--+--+--+--+--+--+--+--+
|  Tunnel Type (1 octet)          |    T = Assisted Replication Type
+---------------------------------+    BM = Broadcast and Multicast
|  MPLS Label (3 octets)          |    U = Unknown (unknown unicast)
+---------------------------------+    x = unassigned
|  Tunnel Identifier (variable)   |
+---------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-pmsi-tunnel-attribute">PMSI Tunnel Attribute</a>
        </figcaption></figure>
</div>
<p id="section-4-5">The Flags field in <a class="auto internal xref" href="#pta">Figure 3</a> is 8 bits long as per
      <span>[<a class="cite xref" href="#RFC7902">RFC7902</a>]</span>. The Extension (E) flag was allocated by <span>[<a class="cite xref" href="#RFC7902">RFC7902</a>]</span>, and the Leaf
      Information Required (L) flag was allocated by <span>[<a class="cite xref" href="#RFC6514">RFC6514</a>]</span>. This document defines the use of 4 bits of this Flags field:<a class="pilcrow" href="#section-4-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-6.1">Bits 3 and 4, which together form the Assisted Replication Type (T)
          field<a class="pilcrow" href="#section-4-6.1">¶</a>
</li>
        <li class="normal" id="section-4-6.2">Bit 5, called the Broadcast and Multicast (BM) flag<a class="pilcrow" href="#section-4-6.2">¶</a>
</li>
        <li class="normal" id="section-4-6.3">Bit 6, called the Unknown (U) flag<a class="pilcrow" href="#section-4-6.3">¶</a>
</li>
      </ul>
<p id="section-4-7">Bits 5 and 6 are collectively referred to as the Pruned Flooding Lists (PFLs) flags.<a class="pilcrow" href="#section-4-7">¶</a></p>
<p id="section-4-8">The T field and PFLs flags are defined as follows:<a class="pilcrow" href="#section-4-8">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-9.1">
          <p id="section-4-9.1.1">T is the Assisted Replication Type field (2 bits), which defines
          the AR role of the advertising router:<a class="pilcrow" href="#section-4-9.1.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-9.1.2.1">00 (decimal 0) = RNVE (non-AR support)<a class="pilcrow" href="#section-4-9.1.2.1">¶</a>
</li>
            <li class="normal" id="section-4-9.1.2.2">01 (decimal 1) = AR-REPLICATOR<a class="pilcrow" href="#section-4-9.1.2.2">¶</a>
</li>
            <li class="normal" id="section-4-9.1.2.3">10 (decimal 2) = AR-LEAF<a class="pilcrow" href="#section-4-9.1.2.3">¶</a>
</li>
            <li class="normal" id="section-4-9.1.2.4">11 (decimal 3) = RESERVED<a class="pilcrow" href="#section-4-9.1.2.4">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-4-9.2">
          <p id="section-4-9.2.1">The PFLs flags define the desired behavior of the
          advertising router for the different types of traffic:<a class="pilcrow" href="#section-4-9.2.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-9.2.2.1">Broadcast and Multicast (BM) flag. BM = 1 means "prune me from
              the BM flooding list". BM = 0 indicates regular behavior.<a class="pilcrow" href="#section-4-9.2.2.1">¶</a>
</li>
            <li class="normal" id="section-4-9.2.2.2">Unknown (U) flag. U = 1 means "prune me from the Unknown
              flooding list". U = 0 indicates regular behavior.<a class="pilcrow" href="#section-4-9.2.2.2">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-4-9.3">The L flag (bit 7) is defined in <span>[<a class="cite xref" href="#RFC6514">RFC6514</a>]</span>
          and will be used only in the
          selective AR solution.<a class="pilcrow" href="#section-4-9.3">¶</a>
</li>
      </ul>
<p id="section-4-10">Please refer to <a class="auto internal xref" href="#sect-11">Section 11</a> for the IANA considerations
      related to the PMSI Tunnel Attribute flags.<a class="pilcrow" href="#section-4-10">¶</a></p>
<p id="section-4-11">In this document, the above Inclusive Multicast Ethernet Tag route
      (<a class="auto internal xref" href="#imet-route">Figure 2</a>) and PMSI Tunnel Attribute (<a class="auto internal xref" href="#pta">Figure 3</a>) can be used in two different modes for the same BD:<a class="pilcrow" href="#section-4-11">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4-12">
        <dt id="section-4-12.1">Regular-IR route:</dt>
        <dd id="section-4-12.2" style="margin-left: 1.5em">In this route, Originating Router's IP Address,
          Tunnel Type (0x06), MPLS Label, and Tunnel Identifier <span class="bcp14">MUST</span> be used as
          described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> when ingress replication is in
          use. The NVE/PE that advertises the route will set the Next Hop to
          an IP address that we denominate IR-IP in this document. When
          advertised by an AR-LEAF node, the Regular-IR route <span class="bcp14">MUST</span> be
          advertised with the T field set to 10 (AR-LEAF).<a class="pilcrow" href="#section-4-12.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-12.3">
          Replicator-AR route:</dt>
        <dd id="section-4-12.4" style="margin-left: 1.5em">
          <p id="section-4-12.4.1">This route is used by the AR-REPLICATOR to
          advertise its AR capabilities, with the fields set as follows:<a class="pilcrow" href="#section-4-12.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-12.4.2.1">
              <p id="section-4-12.4.2.1.1">Originating Router's IP Address <span class="bcp14">MUST</span> be set to an IP address
              of the advertising router that is common to all the EVIs on the
              PE (usually this is a loopback address of the PE).<a class="pilcrow" href="#section-4-12.4.2.1.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-12.4.2.1.2.1">The Tunnel Identifier and Next Hop fields <span class="bcp14">SHOULD</span> be set to the
                  same IP address as the Originating Router's IP Address field when
                  the NVE/PE originates the route -- that is, when the NVE/PE is
                  not an ASBR; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8365#section-10.2">Section 10.2</a> of [<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>.
                  Irrespective of the values in the Tunnel Identifier and
                  Originating Router's IP Address fields, the ingress NVE/PE
                  will process the received Replicator-AR route and will use
                  the IP address setting in the Next Hop field to create IP tunnels to
                  the AR-REPLICATOR.<a class="pilcrow" href="#section-4-12.4.2.1.2.1">¶</a>
</li>
                <li class="normal" id="section-4-12.4.2.1.2.2">The Next Hop address is referred to as the AR-IP and <span class="bcp14">MUST</span>
                  be different from the IR-IP for a given PE/NVE, unless the
                  procedures provided in <a class="auto internal xref" href="#sect-8">Section 8</a> are followed.<a class="pilcrow" href="#section-4-12.4.2.1.2.2">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4-12.4.2.2">Tunnel Type <span class="bcp14">MUST</span> be set to Assisted Replication Tunnel. <a class="auto internal xref" href="#sect-11">Section 11</a> provides the allocated type value.<a class="pilcrow" href="#section-4-12.4.2.2">¶</a>
</li>
            <li class="normal" id="section-4-12.4.2.3">T (Assisted Replication type) <span class="bcp14">MUST</span> be set to 01 (AR-REPLICATOR).<a class="pilcrow" href="#section-4-12.4.2.3">¶</a>
</li>
            <li class="normal" id="section-4-12.4.2.4">L (Leaf Information Required) <span class="bcp14">MUST</span> be set to 0 for
              non-selective AR and <span class="bcp14">MUST</span> be set to 1 for selective AR.<a class="pilcrow" href="#section-4-12.4.2.4">¶</a>
</li>
          </ul>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-4-13">An NVE/PE configured as an AR-REPLICATOR for a BD <span class="bcp14">MUST</span> advertise a
      Replicator-AR route for the BD and <span class="bcp14">MAY</span> advertise a Regular-IR route. The
      advertisement of the Replicator-AR route will indicate to the AR-LEAFs which
      outer IP DA, i.e., which AR-IP, they need to use for IP-encapsulated BM
      frames that use Assisted Replication forwarding mode. The AR-REPLICATOR
      will forward an IP-encapsulated BM frame in Assisted Replication
      forwarding mode if the outer IP DA matches its AR-IP but will forward
      in Ingress Replication forwarding mode if the outer IP DA matches its
      IR-IP.<a class="pilcrow" href="#section-4-13">¶</a></p>
<p id="section-4-14">In addition, this document also uses the Leaf Auto-Discovery (Leaf
      A-D) route defined in <span>[<a class="cite xref" href="#RFC9572">RFC9572</a>]</span> in cases where the
      selective AR mode is used. An AR-LEAF <span class="bcp14">MAY</span> send a Leaf A-D route in
      response to reception of a Replicator-AR route whose L flag is set. The
      Leaf A-D route is only used for selective AR, and the fields
      of such a route are set as follows:<a class="pilcrow" href="#section-4-14">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-15.1">Originating Router's IP Address is set to the advertising
              router's IP address (the same IP address used by the AR-LEAF in Regular-IR
              routes). The Next Hop address is set to the IR-IP, which <span class="bcp14">SHOULD</span>
              be the same IP address as the advertising router's IP address,
              when the NVE/PE originates the route, i.e., when the NVE/PE is
              not an ASBR; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8365#section-10.2">Section 10.2</a> of [<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>.<a class="pilcrow" href="#section-4-15.1">¶</a>
</li>
        <li class="normal" id="section-4-15.2">Route Key <span>[<a class="cite xref" href="#RFC9572">RFC9572</a>]</span> is the "Route Type Specific" NLRI of the
              Replicator-AR route for which this Leaf A-D route is
              generated.<a class="pilcrow" href="#section-4-15.2">¶</a>
</li>
        <li class="normal" id="section-4-15.3">The AR-LEAF constructs an IP-address-specific Route Target,
              analogously to <span>[<a class="cite xref" href="#RFC9572">RFC9572</a>]</span>, by placing
              the IP address carried in the Next Hop field of the received
              Replicator-AR route in the Global Administrator field of the
              extended community, with the Local Administrator field of this extended community
              set to 0, and setting the Extended Communities attribute of the
              Leaf A-D route to that extended community. The same
              IP-address-specific import Route Target is auto-configured by
              the AR-REPLICATOR that sent the Replicator-AR route, in order to
              control the acceptance of the Leaf A-D routes.<a class="pilcrow" href="#section-4-15.3">¶</a>
</li>
        <li class="normal" id="section-4-15.4">The Leaf A-D route <span class="bcp14">MUST</span> include the PMSI Tunnel
              Attribute with Tunnel Type set to Assisted Replication Tunnel (<a class="auto internal xref" href="#sect-11">Section 11</a>), T (Assisted Replication type) set to AR-LEAF, and
              Tunnel Identifier set to the IP address of the advertising
              AR-LEAF. The PMSI Tunnel Attribute <span class="bcp14">MUST</span> carry a
              downstream-assigned MPLS label or VNI that is used by the
              AR-REPLICATOR to send traffic to the AR-LEAF.<a class="pilcrow" href="#section-4-15.4">¶</a>
</li>
      </ul>
<p id="section-4-16">Each AR-enabled node understands and processes the T
      (Assisted Replication type) field in the PMSI Tunnel Attribute (Flags
      field) of the routes and <span class="bcp14">MUST</span> signal the corresponding type
      (AR-REPLICATOR or AR-LEAF type) according to its administrative choice.
      An NVE/PE following this specification is not expected to set the
      Assisted Replication Type field to decimal 3 (which is a RESERVED
      value). If a route with the Assisted Replication Type field set to decimal 3 is received
      by an AR-REPLICATOR or AR-LEAF, the router will process the route as a
      Regular-IR route advertised by an RNVE.<a class="pilcrow" href="#section-4-16">¶</a></p>
<p id="section-4-17">Each node attached to the BD may understand and process the BM/U
      flags (PFLs flags). Note that these BM/U flags may be used
      to optimize the delivery of multi-destination traffic; their use
      <span class="bcp14">SHOULD</span> be an administrative choice and independent of the AR role. When
      the PFL capability is enabled, the BM/U flags can be used
      with the Regular-IR, Replicator-AR, and Leaf A-D routes.<a class="pilcrow" href="#section-4-17">¶</a></p>
<p id="section-4-18">Non-optimized ingress replication NVEs/PEs will be unaware of the new
      PMSI Tunnel Attribute flag definition as well as the new tunnel type
      (AR), i.e., non-upgraded NVEs/PEs will ignore the information contained
      in the Flags field or an unknown tunnel type (type AR in this case) for
      any Inclusive Multicast Ethernet Tag route.<a class="pilcrow" href="#section-4-18">¶</a></p>
</section>
</div>
<div id="sect-5">
<section id="section-5">
      <h2 id="name-non-selective-assisted-repl">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-non-selective-assisted-repl">Non-selective Assisted Replication (AR) Solution Description</a>
      </h2>
<p id="section-5-1"><a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a> illustrates an example
      NVO network where the non-selective AR
      function is enabled. Three different roles are defined for a given BD:
      AR-REPLICATOR, AR-LEAF, and RNVE. The solution is called
      "non-selective" because the chosen AR-REPLICATOR for a given flow <span class="bcp14">MUST</span>
      replicate the BM traffic to all the NVEs/PEs in the BD except for the
      source NVE/PE. NVO tunnels, i.e., IP tunnels,
      exist among all the PEs and NVEs in the diagram. The PEs and NVEs in the
      diagram have TSs or VMs connected to their
      ACs.<a class="pilcrow" href="#section-5-1">¶</a></p>
<span id="name-non-selective-ar-scenario"></span><div id="ure-optimized-ir-scenario">
<figure id="figure-4">
        <div class="alignLeft art-text artwork" id="section-5-2.1">
<pre>                        (           )
                       (_    WAN    _)
                    +---(_         _)----+
                    |     (_      _)     |
              PE1   |                PE2 |
             +------+----+          +----+------+
        TS1--+  (BD-1)   |          |  (BD-1)   +--TS2
             |REPLICATOR |          |REPLICATOR |
             +--------+--+          +--+--------+
                      |                |
                   +--+----------------+--+
                   |                      |
                   |                      |
              +----+ VXLAN/NVGRE/MPLSoGRE +----+
              |    |      IP Fabric       |    |
              |    |                      |    |
    NVE1      |    +-----------+----------+    |      NVE3
    Hypervisor|          ToR   |  NVE2         |Hypervisor
    +---------+-+        +-----+-----+       +-+---------+
    |  (BD-1)   |        |  (BD-1)   |       |  (BD-1)   |
    |    LEAF   |        |   RNVE    |       |    LEAF   |
    +--+-----+--+        +--+-----+--+       +--+-----+--+
       |     |              |     |             |     |
      VM11  VM12           TS3   TS4           VM31  VM32
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-non-selective-ar-scenario">Non-selective AR Scenario</a>
        </figcaption></figure>
</div>
<p id="section-5-3">In AR BDs, such as BD-1 in <a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a>, BM
      traffic between two NVEs may follow a different path than unicast
      traffic. This solution recommends the replication of BM traffic through the
      AR-REPLICATOR node, whereas unknown/known unicast traffic will be delivered
      directly from the source node to the destination node without being
      replicated by any intermediate node.<a class="pilcrow" href="#section-5-3">¶</a></p>
<p id="section-5-4">Note that known unicast forwarding is not impacted by this solution,
      i.e., unknown unicast traffic <span class="bcp14">SHALL</span> follow the same path as known unicast
      traffic.<a class="pilcrow" href="#section-5-4">¶</a></p>
<div id="sect-5.1">
<section id="section-5.1">
        <h3 id="name-non-selective-ar-replicator">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-non-selective-ar-replicator">Non-selective AR-REPLICATOR Procedures</a>
        </h3>
<p id="section-5.1-1">An AR-REPLICATOR is defined as an NVE/PE capable of replicating
        incoming BM traffic received on an overlay tunnel to other overlay
        tunnels and local ACs. The AR-REPLICATOR signals its
        role in the control plane and understands where the other roles
        (AR-LEAF nodes, RNVEs, and other AR-REPLICATORs) are located. A given
        AR-enabled BD service may have zero, one, or more AR-REPLICATORs. In
        our example in <a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a>, PE1 and PE2
        are defined as AR-REPLICATORs. The following considerations apply to
        the AR-REPLICATOR role:<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<ol class="normal type-a" id="section-5.1-2" start="1" type="a">
<li id="section-5.1-2.1">The AR-REPLICATOR role <span class="bcp14">SHOULD</span> be an administrative
            choice in any NVE/PE that is part of an AR-enabled BD. This
            administrative option to enable AR-REPLICATOR capabilities <span class="bcp14">MAY</span> be
            implemented as a system-level option as opposed to a per-BD
            option.<a class="pilcrow" href="#section-5.1-2.1">¶</a>
</li>
          <li id="section-5.1-2.2">An AR-REPLICATOR <span class="bcp14">MUST</span> advertise a Replicator-AR
            route and <span class="bcp14">MAY</span> advertise a Regular-IR route. The AR-REPLICATOR <span class="bcp14">MUST NOT</span> generate a Regular-IR route if it does not have local
            ACs. If the Regular-IR route is advertised,
            the Assisted Replication Type field of the Regular-IR route <span class="bcp14">MUST</span>
            be set to 0.<a class="pilcrow" href="#section-5.1-2.2">¶</a>
</li>
          <li id="section-5.1-2.3">The Replicator-AR and Regular-IR routes are
            generated according to <a class="auto internal xref" href="#sect-4">Section 4</a>. The AR-IP and
            IR-IP are different IP addresses owned by the AR-REPLICATOR.<a class="pilcrow" href="#section-5.1-2.3">¶</a>
</li>
          <li id="section-5.1-2.4">
            <p id="section-5.1-2.4.1">When a node defined as an AR-REPLICATOR receives a BM
            packet on an overlay tunnel, it will do a tunnel destination IP
            address lookup and apply the following procedures:<a class="pilcrow" href="#section-5.1-2.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.4.2.1">If the destination IP address is the AR-REPLICATOR IR-IP
                address, the node will process the packet normally as discussed in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-5.1-2.4.2.1">¶</a>
</li>
              <li class="normal" id="section-5.1-2.4.2.2">If the destination IP address is the AR-REPLICATOR AR-IP
                address, the node <span class="bcp14">MUST</span> replicate the packet to local ACs
                and overlay tunnels (excluding the overlay tunnel to
                the source of the packet). When replicating to remote
                AR-REPLICATORs, the tunnel destination IP address will be an
                IR-IP. This will indicate to the remote AR-REPLICATOR
                that it <span class="bcp14">MUST NOT</span> replicate to overlay tunnels. The tunnel
                source IP address used by the AR-REPLICATOR <span class="bcp14">MUST</span> be its IR-IP
                when replicating to AR-REPLICATOR or AR-LEAF nodes.<a class="pilcrow" href="#section-5.1-2.4.2.2">¶</a>
</li>
            </ul>
</li>
        </ol>
<p id="section-5.1-3">An AR-REPLICATOR <span class="bcp14">MUST</span> follow a data path implementation
        compatible with the following rules:<a class="pilcrow" href="#section-5.1-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.1">The AR-REPLICATORs will build a flooding list composed of
            ACs and overlay tunnels to remote nodes in the BD.
            Some of those overlay tunnels <span class="bcp14">MAY</span> be flagged as non-BM receivers
            based on the BM flag received from the remote nodes in the BD.<a class="pilcrow" href="#section-5.1-4.1">¶</a>
</li>
          <li class="normal" id="section-5.1-4.2">When an AR-REPLICATOR receives a BM packet on an AC,
            it will forward the BM packet to its flooding list
            (including local ACs and remote NVEs/PEs), skipping
            the non-BM overlay tunnels.<a class="pilcrow" href="#section-5.1-4.2">¶</a>
</li>
          <li class="normal" id="section-5.1-4.3">
            <p id="section-5.1-4.3.1">When an AR-REPLICATOR receives a BM packet on an overlay
            tunnel, it will check the destination IP address of the underlay
            IP header and:<a class="pilcrow" href="#section-5.1-4.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.3.2.1">If the destination IP address matches its IR-IP, the
                AR-REPLICATOR will skip all the overlay tunnels from the
                flooding list, i.e., it will only replicate to local ACs.
                This is the regular ingress replication behavior
                described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-5.1-4.3.2.1">¶</a>
</li>
              <li class="normal" id="section-5.1-4.3.2.2">If the destination IP address matches its AR-IP, the
                AR-REPLICATOR <span class="bcp14">MUST</span> forward the BM packet to its flooding list
                (ACs and overlay tunnels), excluding the non-BM overlay
                tunnels. The AR-REPLICATOR will ensure that the traffic is not sent
                back to the originating AR-LEAF.<a class="pilcrow" href="#section-5.1-4.3.2.2">¶</a>
</li>
              <li class="normal" id="section-5.1-4.3.2.3">If the encapsulation is MPLSoGRE or MPLSoUDP and the
                received BD label that the AR-REPLICATOR advertised in the
                Replicator-AR route is not at the bottom of the stack, the
                AR-REPLICATOR <span class="bcp14">MUST</span> copy all the labels below the BD label
                and propagate them when forwarding the packet to the egress
                overlay tunnels.<a class="pilcrow" href="#section-5.1-4.3.2.3">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.1-4.4">
            <p id="section-5.1-4.4.1">The AR-REPLICATOR/LEAF nodes will build an unknown unicast
            flooding list composed of ACs and overlay tunnels to
            the IR-IP addresses of the remote nodes in the BD. Some of those
            overlay tunnels <span class="bcp14">MAY</span> be flagged as non-U (unknown unicast)
            receivers based on the U flag received from the remote nodes in
            the BD.<a class="pilcrow" href="#section-5.1-4.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.4.2.1">When an AR-REPLICATOR/LEAF receives an unknown unicast
                packet on an AC, it will forward the unknown
                unicast packet to its flooding list, skipping the non-U overlay
                tunnels.<a class="pilcrow" href="#section-5.1-4.4.2.1">¶</a>
</li>
              <li class="normal" id="section-5.1-4.4.2.2">When an AR-REPLICATOR/LEAF receives an unknown unicast
                packet on an overlay tunnel, it will forward the unknown
                unicast packet to its local ACs and never to
                an overlay tunnel. This is the regular ingress replication
                behavior described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-5.1-4.4.2.2">¶</a>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
<div id="sect-5.2">
<section id="section-5.2">
        <h3 id="name-non-selective-ar-leaf-proce">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-non-selective-ar-leaf-proce">Non-selective AR-LEAF Procedures</a>
        </h3>
<p id="section-5.2-1">An AR-LEAF is defined as an NVE/PE that, given its poor replication
        performance, sends all the BM traffic to an AR-REPLICATOR that can
        replicate the traffic further on its behalf. It <span class="bcp14">MAY</span> signal its AR-LEAF
        capability in the control plane and understands where the other roles
        are located (AR-REPLICATORs and RNVEs). A given service can have zero,
        one, or more AR-LEAF nodes. In <a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a>,
        NVE1 and NVE3 (both residing in hypervisors) act as AR-LEAF nodes.
        The following considerations apply to the AR-LEAF role:<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<ol class="normal type-a" id="section-5.2-2" start="1" type="a">
<li id="section-5.2-2.1">The AR-LEAF role <span class="bcp14">SHOULD</span> be an administrative choice
            in any NVE/PE that is part of an AR-enabled BD. This
            administrative option to enable AR-LEAF capabilities <span class="bcp14">MAY</span> be
            implemented as a system-level option as opposed to a per-BD
            option.<a class="pilcrow" href="#section-5.2-2.1">¶</a>
</li>
          <li id="section-5.2-2.2">In this non-selective AR solution, the AR-LEAF <span class="bcp14">MUST</span>
            advertise a single Regular-IR Inclusive Multicast Ethernet Tag route as described in
            <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. The AR-LEAF <span class="bcp14">SHOULD</span> set the
            Assisted Replication Type field to AR-LEAF. Note that although this
            field does not affect the remote nodes when creating an EVPN destination
            to the AR-LEAF, this field is useful from the standpoint of ease of
            operation and troubleshooting of the BD.<a class="pilcrow" href="#section-5.2-2.2">¶</a>
</li>
          <li id="section-5.2-2.3">
            <p id="section-5.2-2.3.1">In a BD where there are no AR-REPLICATORs due to
            the AR-REPLICATORs being down or reconfigured, the AR-LEAF <span class="bcp14">MUST</span>
            use regular ingress replication based on the remote Regular-IR
            Inclusive Multicast Ethernet Tag routes as described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. This may happen in the following cases:<a class="pilcrow" href="#section-5.2-2.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.3.2.1">The AR-LEAF has a list of AR-REPLICATORs for the BD, but it
                detects that all the AR-REPLICATORs for the BD are down (via
                next-hop tracking in the IGP or some other detection
                mechanism).<a class="pilcrow" href="#section-5.2-2.3.2.1">¶</a>
</li>
              <li class="normal" id="section-5.2-2.3.2.2">The AR-LEAF receives updates from all the former
                AR-REPLICATORs containing a non-REPLICATOR AR type in the
                Inclusive Multicast Ethernet Tag routes.<a class="pilcrow" href="#section-5.2-2.3.2.2">¶</a>
</li>
              <li class="normal" id="section-5.2-2.3.2.3">The AR-LEAF never discovered an AR-REPLICATOR for the
                BD.<a class="pilcrow" href="#section-5.2-2.3.2.3">¶</a>
</li>
            </ul>
</li>
          <li id="section-5.2-2.4">
            <p id="section-5.2-2.4.1">In a service where there are one or more
            AR-REPLICATORs (based on the received Replicator-AR routes for the
            BD), the AR-LEAF can locally select which AR-REPLICATOR it sends
            the BM traffic to:<a class="pilcrow" href="#section-5.2-2.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.4.2.1">A single AR-REPLICATOR <span class="bcp14">MAY</span> be selected for all the BM
                packets received on the AR-LEAF ACs for
                a given BD. This selection is a local decision and does not
                have to match other AR-LEAFs' selections within the same
                BD.<a class="pilcrow" href="#section-5.2-2.4.2.1">¶</a>
</li>
              <li class="normal" id="section-5.2-2.4.2.2">An AR-LEAF <span class="bcp14">MAY</span> select more than one AR-REPLICATOR and do
                either per-flow or per-BD load balancing.<a class="pilcrow" href="#section-5.2-2.4.2.2">¶</a>
</li>
              <li class="normal" id="section-5.2-2.4.2.3">In the case of failure of the selected AR-REPLICATOR, another
                AR-REPLICATOR <span class="bcp14">SHOULD</span> be selected by the AR-LEAF.<a class="pilcrow" href="#section-5.2-2.4.2.3">¶</a>
</li>
              <li class="normal" id="section-5.2-2.4.2.4">When an AR-REPLICATOR is selected for a given flow or BD,
                the AR-LEAF <span class="bcp14">MUST</span> send all the BM packets targeted to that
                AR-REPLICATOR using the forwarding information given by the
                Replicator-AR route for the chosen AR-REPLICATOR, with Tunnel
                Type = 0x0A (AR tunnel). The underlay destination IP address
                <span class="bcp14">MUST</span> be the AR-IP advertised by the AR-REPLICATOR in the
                Replicator-AR route.<a class="pilcrow" href="#section-5.2-2.4.2.4">¶</a>
</li>
              <li class="normal" id="section-5.2-2.4.2.5">An AR-LEAF <span class="bcp14">MAY</span> change the selection of AR-REPLICATOR(s)
                dynamically due to an administrative or policy configuration
                change.<a class="pilcrow" href="#section-5.2-2.4.2.5">¶</a>
</li>
              <li class="normal" id="section-5.2-2.4.2.6">AR-LEAF nodes <span class="bcp14">SHALL</span> send service-level BM control plane
                packets, following the procedures for regular ingress replication. An
                example would be IGMP, Multicast Listener Discovery (MLD), or PIM
packets, and, in
                general, any packets using link-local scope multicast IPv4 or
                IPv6 packets. The AR-REPLICATORs <span class="bcp14">MUST NOT</span> replicate these
                control plane packets to other overlay tunnels, since they will
                use the IR-IP address.<a class="pilcrow" href="#section-5.2-2.4.2.6">¶</a>
</li>
            </ul>
</li>
          <li id="section-5.2-2.5">The use of an AR-REPLICATOR-activation-timer (in
            seconds, with a default value of 3) on the AR-LEAF nodes is <span class="bcp14">RECOMMENDED</span>.
            Upon receiving a new Replicator-AR route where the AR-REPLICATOR
            is selected, the AR-LEAF will run a timer before programming the
            new AR-REPLICATOR. In the case of a newly added AR-REPLICATOR or if
            an AR-REPLICATOR reboots, this timer will give the
            AR-REPLICATOR some time to program the AR-LEAF nodes before the
            AR-LEAF sends BM traffic. The AR-REPLICATOR-activation-timer
            <span class="bcp14">SHOULD</span> be configurable in seconds, and its value needs to account for the
            time it takes for the AR-LEAF Regular-IR Inclusive Multicast Ethernet Tag route
            to get to the AR-REPLICATOR and be programmed. While the
            AR-REPLICATOR-activation-timer is running, the AR-LEAF node will
            use regular ingress replication.<a class="pilcrow" href="#section-5.2-2.5">¶</a>
</li>
          <li id="section-5.2-2.6">If the AR-LEAF has selected an AR-REPLICATOR, whether
            or not to change to a new preferred AR-REPLICATOR for the existing BM traffic flows is a matter of local policy.<a class="pilcrow" href="#section-5.2-2.6">¶</a>
</li>
        </ol>
<p id="section-5.2-3">An AR-LEAF <span class="bcp14">MUST</span> follow a data path implementation compatible
        with the following rules:<a class="pilcrow" href="#section-5.2-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-4.1">
            <p id="section-5.2-4.1.1">The AR-LEAF nodes will build two flooding lists:<a class="pilcrow" href="#section-5.2-4.1.1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-4.1.2">
              <dt id="section-5.2-4.1.2.1">Flooding list #1:
              </dt>
              <dd id="section-5.2-4.1.2.2" style="margin-left: 1.5em">Composed of ACs and an AR-REPLICATOR-set of
       overlay tunnels. The AR-REPLICATOR-set is defined as one or more
       overlay tunnels to the AR-IP addresses of the remote
       AR-REPLICATOR(s) in the BD. The selection of more than one
       AR-REPLICATOR is described in item d. above and is a local
       AR-LEAF decision.<a class="pilcrow" href="#section-5.2-4.1.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-5.2-4.1.2.3">Flooding list #2:
              </dt>
              <dd id="section-5.2-4.1.2.4" style="margin-left: 1.5em">Composed of ACs and overlay tunnels to the
       remote IR-IP addresses.<a class="pilcrow" href="#section-5.2-4.1.2.4">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</li>
          <li class="normal" id="section-5.2-4.2">
            <p id="section-5.2-4.2.1">When an AR-LEAF receives a BM packet on an AC,
            it will check the AR-REPLICATOR-set:<a class="pilcrow" href="#section-5.2-4.2.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-4.2.2.1">If the AR-REPLICATOR-set is empty, the AR-LEAF <span class="bcp14">MUST</span> send
                the packet to flooding list #2.<a class="pilcrow" href="#section-5.2-4.2.2.1">¶</a>
</li>
              <li class="normal" id="section-5.2-4.2.2.2">If the AR-REPLICATOR-set is NOT empty, the AR-LEAF <span class="bcp14">MUST</span>
                send the packet to flooding list #1, where only one of the
                overlay tunnels of the AR-REPLICATOR-set is used.<a class="pilcrow" href="#section-5.2-4.2.2.2">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.2-4.3">When an AR-LEAF receives a BM packet on an overlay tunnel, it
            will forward the BM packet to its local ACs and
            never to an overlay tunnel. This is the regular ingress
            replication behavior described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-5.2-4.3">¶</a>
</li>
          <li class="normal" id="section-5.2-4.4">AR-LEAF nodes process unknown unicast traffic in the same way
            AR-REPLICATORS do, as described in <a class="auto internal xref" href="#sect-5.1">Section 5.1</a>.<a class="pilcrow" href="#section-5.2-4.4">¶</a>
</li>
        </ul>
</section>
</div>
<div id="sect-5.3">
<section id="section-5.3">
        <h3 id="name-rnve-procedures">
<a class="section-number selfRef" href="#section-5.3">5.3. </a><a class="section-name selfRef" href="#name-rnve-procedures">RNVE Procedures</a>
        </h3>
<p id="section-5.3-1">An RNVE is defined as an
        NVE/PE without AR-REPLICATOR or AR-LEAF capabilities that does ingress
        replication as described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. The RNVE does
        not signal any AR role and is unaware of the AR-REPLICATOR/LEAF roles
        in the BD. The RNVE will ignore the flags in the Regular-IR routes and
        will ignore the Replicator-AR routes (due to an unknown tunnel type in
        the PMSI Tunnel Attribute) and the Leaf A-D routes (due to
        the IP-address-specific Route Target).<a class="pilcrow" href="#section-5.3-1">¶</a></p>
<p id="section-5.3-2">This role provides EVPNs with the backward compatibility required
        in optimized ingress replication BDs. In <a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a>, NVE2 acts as an RNVE.<a class="pilcrow" href="#section-5.3-2">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-6">
<section id="section-6">
      <h2 id="name-selective-assisted-replicat">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-selective-assisted-replicat">Selective Assisted Replication (AR) Solution Description</a>
      </h2>
<p id="section-6-1"><a class="auto internal xref" href="#selective-ar">Figure 5</a> is used to describe the selective AR
      solution.<a class="pilcrow" href="#section-6-1">¶</a></p>
<span id="name-selective-ar-scenario"></span><div id="selective-ar">
<figure id="figure-5">
        <div class="alignLeft art-text artwork" id="section-6-2.1">
<pre>                        (           )
                       (_    WAN    _)
                    +---(_         _)----+
                    |     (_      _)     |
              PE1   |                PE2 |
             +------+----+          +----+------+
        TS1--+  (BD-1)   |          |  (BD-1)   +--TS2
             |REPLICATOR |          |REPLICATOR |
             +--------+--+          +--+--------+
                      |                |
                   +--+----------------+--+
                   |                      |
                   |                      |
              +----+ VXLAN/NVGRE/MPLSoGRE +----+
              |    |      IP Fabric       |    |
              |    |                      |    |
    NVE1      |    +-----------+----------+    |      NVE3
    Hypervisor|          ToR   |  NVE2         |Hypervisor
    +---------+-+        +-----+-----+       +-+---------+
    |  (BD-1)   |        |  (BD-1)   |       |  (BD-1)   |
    |LEAF-set-1 |        |LEAF-set-1 |       |LEAF-set-2 |
    +--+-----+--+        +--+-----+--+       +--+-----+--+
       |     |              |     |             |     |
      VM11  VM12           TS3   TS4           VM31  VM32
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-selective-ar-scenario">Selective AR Scenario</a>
        </figcaption></figure>
</div>
<p id="section-6-3">The solution is called "selective" because a given AR-REPLICATOR <span class="bcp14">MUST</span>
      replicate the BM traffic to only the AR-LEAFs that requested the
      replication (as opposed to all the AR-LEAF nodes) and <span class="bcp14">MUST</span> replicate the
      BM traffic to the RNVEs (if there are any). The same AR roles as those defined in
      Sections <a class="auto internal xref" href="#sect-4">4</a> and <a class="auto internal xref" href="#sect-5">5</a> are used here; however, the procedures are
      different.<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">The selective AR procedures create multiple AR-LEAF-sets in the EVPN
      BD and build single-hop trees among AR-LEAFs of the same set
      (AR-LEAF-&gt;AR-REPLICATOR-&gt;AR-LEAF) and two-hop trees among
      AR-LEAFs of different sets
      (AR-LEAF-&gt;AR-REPLICATOR-&gt;AR-REPLICATOR-&gt;AR-LEAF). Compared to
      the selective solution, the non-selective AR method assumes that all the
      AR-LEAFs of the BD are in the same set and always creates single-hop trees
      among AR-LEAFs. While the selective solution is more efficient than the
      non-selective solution in multi-stage IP fabrics, the trade-off is
      additional signaling and an additional outer source IP address
      lookup.<a class="pilcrow" href="#section-6-4">¶</a></p>
<p id="section-6-5">The following subsections describe the differences in the procedures
      for AR-REPLICATORs/LEAFs compared to the non-selective AR solution. There
      are no changes applicable to RNVEs.<a class="pilcrow" href="#section-6-5">¶</a></p>
<div id="sect-6.1">
<section id="section-6.1">
        <h3 id="name-selective-ar-replicator-pro">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-selective-ar-replicator-pro">Selective AR-REPLICATOR Procedures</a>
        </h3>
<p id="section-6.1-1">In our example in <a class="auto internal xref" href="#selective-ar">Figure 5</a>, PE1 and PE2 are
        defined as selective AR-REPLICATORs. The following considerations
        apply to the selective AR-REPLICATOR role:<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<ol class="normal type-a" id="section-6.1-2" start="1" type="a">
<li id="section-6.1-2.1">The selective AR-REPLICATOR role <span class="bcp14">SHOULD</span> be an
            administrative choice in any NVE/PE that is part of an
            AR-enabled BD. This
            administrative option <span class="bcp14">MAY</span> be implemented as a system-level option
            as opposed to a per-BD option.<a class="pilcrow" href="#section-6.1-2.1">¶</a>
</li>
          <li id="section-6.1-2.2">Each AR-REPLICATOR will build a list of AR-REPLICATOR, AR-LEAF,
            and RNVE nodes. In spite of the "selective" administrative option,
            an AR-REPLICATOR <span class="bcp14">MUST NOT</span> behave as a selective AR-REPLICATOR if
            at least one of the AR-REPLICATORs has the L flag NOT set. If at
            least one AR-REPLICATOR sends a Replicator-AR route with L = 0 (in
            the BD context), the rest of the AR-REPLICATORs will fall back to
            non-selective AR mode.<a class="pilcrow" href="#section-6.1-2.2">¶</a>
</li>
          <li id="section-6.1-2.3">
            <p id="section-6.1-2.3.1">The selective AR-REPLICATOR <span class="bcp14">MUST</span> follow the procedures
            described in <a class="auto internal xref" href="#sect-5.1">Section 5.1</a>, except for the following
            differences:<a class="pilcrow" href="#section-6.1-2.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.3.2.1">The AR-REPLICATOR <span class="bcp14">MUST</span> have the L flag set to 1
                when advertising the Replicator-AR route. This flag is used by the
                AR-REPLICATORs to advertise their "selective" AR-REPLICATOR
                capabilities. In addition, the AR-REPLICATOR auto-configures
                its IP-address-specific import Route Target as described in
                the third bullet of the procedures for Leaf A-D
                routes in <a class="auto internal xref" href="#sect-4">Section 4</a>.<a class="pilcrow" href="#section-6.1-2.3.2.1">¶</a>
</li>
              <li class="normal" id="section-6.1-2.3.2.2">The AR-REPLICATOR will build a "selective" AR-LEAF-set with
                the list of nodes that requested replication to its own AR-IP.
                For instance, assuming that NVE1 and NVE2 advertise a Leaf
                A-D route with PE1's IP-address-specific
                Route Target and NVE3 advertises a Leaf A-D route
                with PE2's IP-address-specific Route Target, PE1 will only add
                NVE1/NVE2 to its selective AR-LEAF-set for BD-1 and exclude
                NVE3. Likewise, PE2 will only add NVE3 to its selective
                AR-LEAF-set for BD-1 and exclude NVE1/NVE2.<a class="pilcrow" href="#section-6.1-2.3.2.2">¶</a>
</li>
              <li class="normal" id="section-6.1-2.3.2.3">
                <p id="section-6.1-2.3.2.3.1">When a node defined and operating as a selective
                AR-REPLICATOR receives a packet on an overlay tunnel, it will
                do a tunnel destination IP lookup, and if the destination IP
                address is the AR-REPLICATOR AR-IP address, the node <span class="bcp14">MUST</span>
                replicate the packet to:<a class="pilcrow" href="#section-6.1-2.3.2.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.3.2.3.2.1">Local ACs.<a class="pilcrow" href="#section-6.1-2.3.2.3.2.1">¶</a>
</li>
                  <li class="normal" id="section-6.1-2.3.2.3.2.2">Overlay tunnels in the selective AR-LEAF-set, excluding
                    the overlay tunnel to the source AR-LEAF.<a class="pilcrow" href="#section-6.1-2.3.2.3.2.2">¶</a>
</li>
                  <li class="normal" id="section-6.1-2.3.2.3.2.3">Overlay tunnels to the RNVEs if the tunnel source IP
                    address is the IR-IP of an AR-LEAF. In any other case, the
                    AR-REPLICATOR <span class="bcp14">MUST NOT</span> replicate the BM traffic to remote
                    RNVEs. In other words, only the first-hop selective
                    AR-REPLICATOR will replicate to all the RNVEs.<a class="pilcrow" href="#section-6.1-2.3.2.3.2.3">¶</a>
</li>
                  <li class="normal" id="section-6.1-2.3.2.3.2.4">Overlay tunnels to the remote selective AR-REPLICATORs
                    if the tunnel source IP address (of the encapsulated
                    packet that arrived on the overlay tunnel) is an IR-IP of
                    its own AR-LEAF-set. In any other case, the AR-REPLICATOR
                    <span class="bcp14">MUST NOT</span> replicate the BM traffic to remote
                    AR-REPLICATORs. When doing this replication, the tunnel
                    destination IP address is the AR-IP of the remote
                    selective AR-REPLICATOR. The tunnel destination address AR-IP
                    will indicate to the remote selective
                    AR-REPLICATOR that the packet needs further replication to
                    its AR-LEAFs.<a class="pilcrow" href="#section-6.1-2.3.2.3.2.4">¶</a>
</li>
                </ul>
</li>
            </ul>
</li>
        </ol>
<p id="section-6.1-3">A selective AR-REPLICATOR data path implementation <span class="bcp14">MUST</span> be
        compatible with the following rules:<a class="pilcrow" href="#section-6.1-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1">
            <p id="section-6.1-4.1.1">The selective AR-REPLICATORs will build two flooding lists:<a class="pilcrow" href="#section-6.1-4.1.1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.1-4.1.2">
              <dt id="section-6.1-4.1.2.1">Flooding list #1:
              </dt>
              <dd id="section-6.1-4.1.2.2" style="margin-left: 1.5em">
                <p id="section-6.1-4.1.2.2.1">Composed of ACs and overlay tunnels to the
       remote nodes in the BD, always using the IR-IPs in the tunnel
       destination IP addresses.<a class="pilcrow" href="#section-6.1-4.1.2.2.1">¶</a></p>
</dd>
              <dd class="break"></dd>
<dt id="section-6.1-4.1.2.3">Flooding list #2:
              </dt>
              <dd id="section-6.1-4.1.2.4" style="margin-left: 1.5em">
                <p id="section-6.1-4.1.2.4.1">Composed of ACs, a selective AR-LEAF-set, and
       a selective AR-REPLICATOR-set, where:<a class="pilcrow" href="#section-6.1-4.1.2.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1.2.4.2.1">The selective AR-LEAF-set is composed of the overlay
                  tunnels to the AR-LEAFs that advertise a Leaf A-D
                  route for the local AR-REPLICATOR. This set is updated with
                  every Leaf A-D route received/withdrawn from a
                  new AR-LEAF.<a class="pilcrow" href="#section-6.1-4.1.2.4.2.1">¶</a>
</li>
                  <li class="normal" id="section-6.1-4.1.2.4.2.2">The selective AR-REPLICATOR-set is composed of the
                  overlay tunnels to all the AR-REPLICATORs that send a
                  Replicator-AR route with L = 1. The AR-IP addresses are used
                  as tunnel destination IP addresses.<a class="pilcrow" href="#section-6.1-4.1.2.4.2.2">¶</a>
</li>
                </ul>
</dd>
            <dd class="break"></dd>
</dl>
</li>
          <li class="normal" id="section-6.1-4.2">Some of the overlay tunnels in the flooding lists <span class="bcp14">MAY</span> be flagged
            as non-BM receivers based on the BM flag received from the remote
            nodes in the routes.<a class="pilcrow" href="#section-6.1-4.2">¶</a>
</li>
          <li class="normal" id="section-6.1-4.3">When a selective AR-REPLICATOR receives a BM packet on an
            AC, it <span class="bcp14">MUST</span> forward the BM packet to its
            flooding list #1, skipping the non-BM overlay tunnels.<a class="pilcrow" href="#section-6.1-4.3">¶</a>
</li>
          <li class="normal" id="section-6.1-4.4">
            <p id="section-6.1-4.4.1">When a selective AR-REPLICATOR receives a BM packet on an
            overlay tunnel, it will check the destination and source IPs of
            the underlay IP header and:<a class="pilcrow" href="#section-6.1-4.4.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.4.2.1">If the destination IP address matches its AR-IP and the
                source IP address matches an IP of its own selective
                AR-LEAF-set, the AR-REPLICATOR <span class="bcp14">MUST</span> forward the BM packet to
                its flooding list #2, unless some AR-REPLICATOR within the BD has
                advertised L = 0. In the latter case, the node reverts to
                Non-selective mode, and flooding list #1 <span class="bcp14">MUST</span> be used. Non-BM
                overlay tunnels are skipped when sending BM packets.<a class="pilcrow" href="#section-6.1-4.4.2.1">¶</a>
</li>
              <li class="normal" id="section-6.1-4.4.2.2">If the destination IP address matches its AR-IP and the
                source IP address does not match any IP address of its
                selective AR-LEAF-set, the AR-REPLICATOR <span class="bcp14">MUST</span> forward the BM
                packet to flooding list #2, skipping the AR-REPLICATOR-set.
                Non-BM overlay tunnels are skipped when sending BM
                packets.<a class="pilcrow" href="#section-6.1-4.4.2.2">¶</a>
</li>
              <li class="normal" id="section-6.1-4.4.2.3">If the destination IP address matches its IR-IP, the
                AR-REPLICATOR <span class="bcp14">MUST</span> use flooding list #1 but <span class="bcp14">MUST</span> skip all the
                overlay tunnels from the flooding list, i.e., it will only
                replicate to local ACs. This is the regular ingress replication
                behavior described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>. Non-BM overlay
                tunnels are skipped when sending BM packets.<a class="pilcrow" href="#section-6.1-4.4.2.3">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-6.1-4.5">In any case, the AR-REPLICATOR ensures that the traffic is not sent
            back to the originating source. If the encapsulation is MPLSoGRE
            or MPLSoUDP and the received BD label (the label that the
            AR-REPLICATOR advertised in the Replicator-AR route) is not at the
            bottom of the stack, the AR-REPLICATOR <span class="bcp14">MUST</span> copy the rest of the
            labels when forwarding them to the egress overlay tunnels.<a class="pilcrow" href="#section-6.1-4.5">¶</a>
</li>
        </ul>
</section>
</div>
<div id="sect-6.2">
<section id="section-6.2">
        <h3 id="name-selective-ar-leaf-procedure">
<a class="section-number selfRef" href="#section-6.2">6.2. </a><a class="section-name selfRef" href="#name-selective-ar-leaf-procedure">Selective AR-LEAF Procedures</a>
        </h3>
<p id="section-6.2-1">A selective AR-LEAF chooses a single selective AR-REPLICATOR per BD
        and:<a class="pilcrow" href="#section-6.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">Sends all the BD's BM traffic to that AR-REPLICATOR and<a class="pilcrow" href="#section-6.2-2.1">¶</a>
</li>
          <li class="normal" id="section-6.2-2.2">Expects to receive all the BM traffic for a given BD from the
            same AR-REPLICATOR (except for the BM traffic from the RNVEs,
            which comes directly from the RNVEs)<a class="pilcrow" href="#section-6.2-2.2">¶</a>
</li>
        </ul>
<p id="section-6.2-3">In the example in <a class="auto internal xref" href="#selective-ar">Figure 5</a>, we consider
        NVE1/NVE2/NVE3 as selective AR-LEAFs. NVE1 selects PE1 as its
        selective AR-REPLICATOR. If that is so, NVE1 will send all its BM
        traffic for BD-1 to PE1. If other AR-LEAFs/REPLICATORs send BM traffic,
        NVE1 will receive that traffic from PE1. A selective AR-LEAF and a non-selective AR-LEAF behave differently, as follows:<a class="pilcrow" href="#section-6.2-3">¶</a></p>
<ol class="normal type-a" id="section-6.2-4" start="1" type="a">
<li id="section-6.2-4.1">The selective AR-LEAF role <span class="bcp14">SHOULD</span> be an
            administrative choice in any NVE/PE that is part of an
            AR-enabled BD. This administrative option to
            enable AR-LEAF capabilities <span class="bcp14">MAY</span> be implemented as a system-level option as opposed to a per-BD option.<a class="pilcrow" href="#section-6.2-4.1">¶</a>
</li>
          <li id="section-6.2-4.2">The AR-LEAF <span class="bcp14">MAY</span> advertise a Regular-IR route if there are RNVEs
            in the BD. The selective AR-LEAF <span class="bcp14">MUST</span> advertise a Leaf
            A-D route after receiving a Replicator-AR route with
            L = 1. It is <span class="bcp14">RECOMMENDED</span> that the selective AR-LEAF wait for a period specified by an
            AR-LEAF-join-wait-timer (in seconds, with a default value of 3) before
            sending the Leaf A-D route, so that the AR-LEAF can
            collect all the Replicator-AR routes for the BD before advertising
            the Leaf A-D route. If the Replicator-AR route with L = 1
            is withdrawn, the corresponding Leaf A-D route is
            withdrawn too.<a class="pilcrow" href="#section-6.2-4.2">¶</a>
</li>
          <li id="section-6.2-4.3">
            <p id="section-6.2-4.3.1">In a service where there is more than one selective
            AR-REPLICATOR, the selective AR-LEAF <span class="bcp14">MUST</span> locally select a single
            selective AR-REPLICATOR for the BD. Once selected:<a class="pilcrow" href="#section-6.2-4.3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-4.3.2.1">The selective AR-LEAF <span class="bcp14">MUST</span> send a Leaf A-D route,
                including the route key and IP-address-specific Route Target
                of the selected AR-REPLICATOR.<a class="pilcrow" href="#section-6.2-4.3.2.1">¶</a>
</li>
              <li class="normal" id="section-6.2-4.3.2.2">The selective AR-LEAF <span class="bcp14">MUST</span> send all the BM packets received
                on the ACs for a given BD to that
                AR-REPLICATOR.<a class="pilcrow" href="#section-6.2-4.3.2.2">¶</a>
</li>
              <li class="normal" id="section-6.2-4.3.2.3">In the case of failure of the selected AR-REPLICATOR
                (detected when the Replicator-AR route becomes infeasible as
                a result of any of the underlying BGP mechanisms), another
                AR-REPLICATOR will be selected and a new Leaf A-D
                update will be issued for the new AR-REPLICATOR. This new
                route will update the selective list in the new selective
                AR-REPLICATOR. In the case of failure of the active selective
                AR-REPLICATOR, it is <span class="bcp14">RECOMMENDED</span> that the selective AR-LEAF
                revert to ingress replication behavior for an
                AR-REPLICATOR-activation-timer (in seconds, with a default value of
                3) to mitigate the traffic impact. When the timer expires, the
                selective AR-LEAF will resume its AR mode with the new
                selective AR-REPLICATOR. The AR-REPLICATOR-activation-timer
                <span class="bcp14">MAY</span> be the same configurable parameter as the parameter discussed in <a class="auto internal xref" href="#sect-5.2">Section 5.2</a>.<a class="pilcrow" href="#section-6.2-4.3.2.3">¶</a>
</li>
              <li class="normal" id="section-6.2-4.3.2.4">A selective AR-LEAF <span class="bcp14">MAY</span> change the selection of AR-REPLICATOR(s)
                dynamically due to an administrative or policy
                configuration change.<a class="pilcrow" href="#section-6.2-4.3.2.4">¶</a>
</li>
            </ul>
</li>
        </ol>
<p id="section-6.2-5">All the AR-LEAFs in a BD are expected to be configured as either
        selective or non-selective. A mix of selective and non-selective
        AR-LEAFs <span class="bcp14">SHOULD NOT</span> coexist in the same BD. If a
        non-selective AR-LEAF is present, its BM traffic sent to a selective
        AR-REPLICATOR will not be replicated to other AR-LEAFs that are not in
        its selective AR-LEAF-set.<a class="pilcrow" href="#section-6.2-5">¶</a></p>
<p id="section-6.2-6">A selective AR-LEAF <span class="bcp14">MUST</span> follow a data path implementation
        compatible with the following rules:<a class="pilcrow" href="#section-6.2-6">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-7.1">
            <p id="section-6.2-7.1.1">The selective AR-LEAF nodes will build two flooding lists:<a class="pilcrow" href="#section-6.2-7.1.1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.2-7.1.2">
              <dt id="section-6.2-7.1.2.1">Flooding list #1:
</dt>
              <dd id="section-6.2-7.1.2.2" style="margin-left: 1.5em">Composed of ACs and the overlay tunnel to the selected
AR-REPLICATOR (using the AR-IP as the tunnel destination IP address).<a class="pilcrow" href="#section-6.2-7.1.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-6.2-7.1.2.3">Flooding list #2:
</dt>
              <dd id="section-6.2-7.1.2.4" style="margin-left: 1.5em">Composed of ACs and overlay tunnels to the remote IR-IP
addresses.<a class="pilcrow" href="#section-6.2-7.1.2.4">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</li>
          <li class="normal" id="section-6.2-7.2">Some of the overlay tunnels in the flooding lists <span class="bcp14">MAY</span> be flagged
            as non-BM receivers based on the BM flag received from the remote
            nodes in the routes.<a class="pilcrow" href="#section-6.2-7.2">¶</a>
</li>
          <li class="normal" id="section-6.2-7.3">When an AR-LEAF receives a BM packet on an AC,
            it will check to see if an AR-REPLICATOR was selected; if one is found,
            flooding list #1 <span class="bcp14">MUST</span> be used. Otherwise, flooding list #2 <span class="bcp14">MUST</span> be used.
            Non-BM overlay tunnels are skipped when sending BM packets.<a class="pilcrow" href="#section-6.2-7.3">¶</a>
</li>
          <li class="normal" id="section-6.2-7.4">When an AR-LEAF receives a BM packet on an overlay tunnel, it
            <span class="bcp14">MUST</span> forward the BM packet to its local ACs and
            never to an overlay tunnel. This is the regular ingress
            replication behavior described in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span>.<a class="pilcrow" href="#section-6.2-7.4">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sect-7">
<section id="section-7">
      <h2 id="name-pruned-flooding-lists-pfls">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-pruned-flooding-lists-pfls">Pruned Flooding Lists (PFLs)</a>
      </h2>
<p id="section-7-1">In addition to AR, the second optimization supported by the ingress
replication optimization solution specified in this document
      is the ability of all the BD nodes to signal PFLs. As described in <a class="auto internal xref" href="#sect-4">Section 4</a>, an EVPN node can signal
      a given value for the BM and U PFLs flags in the
      Regular-IR, Replicator-AR, or Leaf A-D routes, where:<a class="pilcrow" href="#section-7-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">BM is the Broadcast and Multicast flag. BM = 1 means "prune me
          from the BM flooding list". BM = 0 indicates regular behavior.<a class="pilcrow" href="#section-7-2.1">¶</a>
</li>
        <li class="normal" id="section-7-2.2">U is the Unknown flag. U = 1 means "prune me from the Unknown
          flooding list". U = 0 indicates regular behavior.<a class="pilcrow" href="#section-7-2.2">¶</a>
</li>
      </ul>
<p id="section-7-3">The ability to signal and process these PFLs flags
      <span class="bcp14">SHOULD</span> be an administrative choice. If a node is configured to process
      the PFLs flags, upon receiving a non-zero
      PFLs flag for a route, an NVE/PE will add the
      corresponding flag to the created overlay tunnel in the flooding list. When
      replicating a BM packet in the context of a flooding list, the NVE/PE will
      skip the overlay tunnels marked with the flag BM = 1, since the NVEs/PEs at
      the end of those tunnels are not expecting BM packets. Similarly, when
      replicating unknown unicast packets, the NVE/PE will skip the overlay
      tunnels marked with U = 1.<a class="pilcrow" href="#section-7-3">¶</a></p>
<p id="section-7-4">An NVE/PE not following this document or not configured for this
      optimization will ignore any of the received PFLs flags.
      An AR-LEAF or RNVE receiving BUM traffic on an overlay tunnel <span class="bcp14">MUST</span>
      replicate the traffic to its local ACs, regardless of
      the BM/U flags on the overlay tunnels.<a class="pilcrow" href="#section-7-4">¶</a></p>
<p id="section-7-5">This optimization <span class="bcp14">MAY</span> be used along with the Assisted Replication
      solution.<a class="pilcrow" href="#section-7-5">¶</a></p>
<div id="sect-7.1">
<section id="section-7.1">
        <h3 id="name-example-of-a-pruned-floodin">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-example-of-a-pruned-floodin">Example of a Pruned Flooding List</a>
        </h3>
<p id="section-7.1-1">In order to illustrate the use of the PFLs solution, we will assume that BD-1 in <a class="auto internal xref" href="#ure-optimized-ir-scenario">Figure 4</a> is optimized ingress replication
        enabled and:<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">PE1 and PE2 are administratively configured as AR-REPLICATORs
            due to their high-performance replication capabilities. PE1 and
            PE2 will send a Replicator-AR route with BM/U flags = 00.<a class="pilcrow" href="#section-7.1-2.1">¶</a>
</li>
          <li class="normal" id="section-7.1-2.2">
            <p id="section-7.1-2.2.1">NVE1 and NVE3 are administratively configured as AR-LEAF nodes
            due to their low-performance software-based replication
            capabilities. They will advertise a Regular-IR route with type
            AR-LEAF. Assuming that both NVEs advertise all of the attached VMs'
            MAC and IP addresses in EVPNs as soon as they come up and
            these NVEs do not have any VMs interested in
            multicast applications, they will be configured to signal BM/U
            flags = 11 for BD-1. That is, neither NVE1 nor NVE3 is interested
            in receiving BM or unknown unicast traffic, since:<a class="pilcrow" href="#section-7.1-2.2.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.2.2.1">Their attached VMs (VM11, VM12, VM31, VM32) do not support
                multicast applications.<a class="pilcrow" href="#section-7.1-2.2.2.1">¶</a>
</li>
              <li class="normal" id="section-7.1-2.2.2.2">Their attached VMs will not receive ARP Requests. Proxy ARP
                <span>[<a class="cite xref" href="#RFC9161">RFC9161</a>]</span> on the remote
                NVEs/PEs will reply to ARP Requests locally, and no other
                broadcast traffic is expected.<a class="pilcrow" href="#section-7.1-2.2.2.2">¶</a>
</li>
              <li class="normal" id="section-7.1-2.2.2.3">Their attached VMs will not receive unknown unicast
                traffic, since the VMs' MAC and IP addresses are always
                advertised by EVPNs as long as the VMs are active.<a class="pilcrow" href="#section-7.1-2.2.2.3">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-7.1-2.3">NVE2 is optimized ingress replication unaware; therefore, it
            takes on the RNVE role in BD-1.<a class="pilcrow" href="#section-7.1-2.3">¶</a>
</li>
        </ul>
<p id="section-7.1-3">Based on the above assumptions, the following forwarding behavior
        will take place:<a class="pilcrow" href="#section-7.1-3">¶</a></p>
<ol class="normal type-1" id="section-7.1-4" start="1" type="1">
<li id="section-7.1-4.1">Any BM packets sent from VM11 will be sent to VM12
            and PE1. PE1 will then forward the BM packets on to TS1, the WAN link,
            PE2, and NVE2 but not to NVE3. PE2 and NVE2 will replicate the BM
            packets to their local ACs, but NVE3 will be prevented from
            having to replicate those BM packets to VM31 and
            VM32 unnecessarily.<a class="pilcrow" href="#section-7.1-4.1">¶</a>
</li>
          <li id="section-7.1-4.2">Any BM packets received on PE2 from the WAN will be
            sent to PE1 and NVE2 but not to NVE1 and NVE3, sparing the two
            hypervisors from replicating unnecessarily to their local VMs.
            PE1 and NVE2 will replicate to their local ACs
            only.<a class="pilcrow" href="#section-7.1-4.2">¶</a>
</li>
          <li id="section-7.1-4.3">Any unknown unicast packet sent from VM31 will be
            forwarded by NVE3 to NVE2, PE1, and PE2 but not to NVE1. The solution
            prevents unnecessary replication to NVE1, since the destination
            of the unknown traffic cannot be NVE1.<a class="pilcrow" href="#section-7.1-4.3">¶</a>
</li>
          <li id="section-7.1-4.4">Any unknown unicast packet sent from TS1 will be
            forwarded by PE1 to the WAN link, PE2, and NVE2 but not to NVE1 and
            NVE3, since the target of the unknown traffic cannot be NVE1 or
            NVE3.<a class="pilcrow" href="#section-7.1-4.4">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="sect-8">
<section id="section-8">
      <h2 id="name-ar-procedures-for-single-ip">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-ar-procedures-for-single-ip">AR Procedures for Single-IP AR-REPLICATORS</a>
      </h2>
<p id="section-8-1">The procedures explained in Sections <a class="auto internal xref" href="#sect-5">5</a> and
      <a class="auto internal xref" href="#sect-6">6</a> assume that the AR-REPLICATOR can use two local
      routable IP addresses to terminate and originate NVO
      tunnels, i.e., IR-IP and AR-IP addresses. This is usually the
      case for PE-based AR-REPLICATOR nodes.<a class="pilcrow" href="#section-8-1">¶</a></p>
<p id="section-8-2">In some cases, the AR-REPLICATOR node does not support more than one
      IP address to terminate and originate NVO
      tunnels, i.e., the IR-IP and AR-IP are the same IP addresses. This may be
      the case in some software-based or low-end AR-REPLICATOR nodes. If this
      is the case, the procedures provided in Sections <a class="auto internal xref" href="#sect-5">5</a> and <a class="auto internal xref" href="#sect-6">6</a> <span class="bcp14">MUST</span> be modified in the following way:<a class="pilcrow" href="#section-8-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.1">The Replicator-AR routes generated by the AR-REPLICATOR use an
          AR-IP that will match its IR-IP. In order to differentiate the data
          plane packets that need to use ingress replication from the packets
          that must use Assisted Replication forwarding mode, the
          Replicator-AR route <span class="bcp14">MUST</span> advertise a different VNI/VSID than the one
          used by the Regular-IR route. For instance, the AR-REPLICATOR will
          advertise an AR-VNI along with the Replicator-AR route and an IR-VNI along
          with the Regular-IR route. Since both routes have the same key,
          different Route Distinguishers are needed in each route.<a class="pilcrow" href="#section-8-3.1">¶</a>
</li>
        <li class="normal" id="section-8-3.2">An AR-REPLICATOR will perform Ingress Replication forwarding mode or Assisted
          Replication forwarding mode for the incoming overlay packets based
          on an ingress VNI lookup as opposed to the tunnel IP DA lookup.
          Note that when replicating to remote AR-REPLICATOR nodes, the use
          of the IR-VNI or AR-VNI advertised by the egress node will determine
          whether Ingress Replication forwarding mode or Assisted Replication forwarding mode is used at
          the subsequent AR-REPLICATOR.<a class="pilcrow" href="#section-8-3.2">¶</a>
</li>
      </ul>
<p id="section-8-4">The rest of the procedures will follow those described in
      Sections <a class="auto internal xref" href="#sect-5">5</a> and                 
      <a class="auto internal xref" href="#sect-6">6</a>.<a class="pilcrow" href="#section-8-4">¶</a></p>
</section>
</div>
<div id="sect-9">
<section id="section-9">
      <h2 id="name-ar-procedures-and-evpn-all-">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-ar-procedures-and-evpn-all-">AR Procedures and EVPN All-Active Multihoming Split-Horizon</a>
      </h2>
<p id="section-9-1">This section extends the procedures for the cases where two or more
      AR-LEAF nodes are attached to the same ES and two or more
      AR-REPLICATOR nodes are attached to the same ES in the BD.
      The mixed case -- where an AR-LEAF node and an AR-REPLICATOR node are
      attached to the same ES -- would require extended procedures
      that are out of scope for this document.<a class="pilcrow" href="#section-9-1">¶</a></p>
<div id="sect-9.1">
<section id="section-9.1">
        <h3 id="name-ethernet-segments-on-ar-lea">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-ethernet-segments-on-ar-lea">Ethernet Segments on AR-LEAF Nodes</a>
        </h3>
<p id="section-9.1-1">If a VXLAN or NVGRE is used and if the split-horizon is based on
        the tunnel source IP address and "local bias" as described in <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>, the split-horizon check will not work if
        an ES is shared between two AR-LEAF nodes, and the
        AR-REPLICATOR replaces the tunnel source IP address of the packets
        with its own AR-IP.<a class="pilcrow" href="#section-9.1-1">¶</a></p>
<p id="section-9.1-2">In order to be compatible with the source IP address split-horizon
        check, the AR-REPLICATOR <span class="bcp14">MAY</span> keep the original received tunnel source IP
        address when replicating packets to a remote AR-LEAF or RNVE.
        This will allow AR-LEAF nodes to apply split-horizon check procedures
        for BM packets before sending them to the local ES.
        Even if the AR-LEAF's source IP address is preserved when replicating
        to AR-LEAFs or RNVEs, the AR-REPLICATOR <span class="bcp14">MUST</span> always use its IR-IP as
        the source IP address when replicating to other AR-REPLICATORs.<a class="pilcrow" href="#section-9.1-2">¶</a></p>
<p id="section-9.1-3">When EVPNs are used for MPLSoGRE or MPLSoUDP, the ESI-label-based
        split-horizon procedure provided in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> will not work
        for multihomed ESs defined on AR-LEAF nodes.
        Local bias is recommended in this case, as it is in the case of a VXLAN or
        NVGRE as explained above. The local-bias and tunnel source IP address
        preservation mechanisms provide the required split-horizon behavior in
        non-selective or selective AR.<a class="pilcrow" href="#section-9.1-3">¶</a></p>
<p id="section-9.1-4">Note that if the AR-REPLICATOR implementation keeps the received
        tunnel source IP address, the use of unicast Reverse Path
        Forwarding (uRPF) checks in the IP fabric based on the tunnel source IP
        address <span class="bcp14">MUST</span> be disabled.<a class="pilcrow" href="#section-9.1-4">¶</a></p>
</section>
</div>
<div id="sect-9.2">
<section id="section-9.2">
        <h3 id="name-ethernet-segments-on-ar-rep">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-ethernet-segments-on-ar-rep">Ethernet Segments on AR-REPLICATOR Nodes</a>
        </h3>
<p id="section-9.2-1">AR-REPLICATOR nodes attached to the same all-active ES
        will follow local-bias procedures <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>
        as follows:<a class="pilcrow" href="#section-9.2-1">¶</a></p>
<ol class="normal type-a" id="section-9.2-2" start="1" type="a">
<li id="section-9.2-2.1">For BUM traffic received on a local AR-REPLICATOR's AC,
            local-bias procedures as provided in <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span>
            <span class="bcp14">MUST</span> be followed.<a class="pilcrow" href="#section-9.2-2.1">¶</a>
</li>
          <li id="section-9.2-2.2">For BUM traffic received on an AR-REPLICATOR overlay tunnel
            with AR-IP as the IP DA, local bias <span class="bcp14">MUST</span> also
            be followed. That is, traffic received with AR-IP as the IP DA
            will be treated as though it had been received
            on a local AC that is part of the ES
            and will be forwarded to all local ESs, irrespective
            of their DF or NDF state.<a class="pilcrow" href="#section-9.2-2.2">¶</a>
</li>
          <li id="section-9.2-2.3">BUM traffic received on an AR-REPLICATOR overlay tunnel with
            IR-IP as the IP DA will follow regular local-bias rules <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> and will not be forwarded to
            local ESs that are shared with the AR-LEAF or
            AR-REPLICATOR originating the traffic.<a class="pilcrow" href="#section-9.2-2.3">¶</a>
</li>
          <li id="section-9.2-2.4">In cases where the AR-REPLICATOR supports a single IP address,
            the IR-IP and the AR-IP are the same IP address, as discussed in
            <a class="auto internal xref" href="#sect-8">Section 8</a>. The received BUM traffic will be treated
            as specified in item b above if the received VNI is the AR-VNI and as specified in item c if the VNI is the IR-VNI.<a class="pilcrow" href="#section-9.2-2.4">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="sect-10">
<section id="section-10">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-10-1">The security considerations in <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> and <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> apply to this document. The security considerations
      related to the Leaf A-D route in <span>[<a class="cite xref" href="#RFC9572">RFC9572</a>]</span> apply too.<a class="pilcrow" href="#section-10-1">¶</a></p>
<p id="section-10-2">In addition, the Assisted Replication method introduced by this
      document may introduce some new risks that could affect the successful delivery of BM
      traffic. Unicast traffic is not affected by Assisted Replication
      (although unknown unicast traffic is affected by the procedures for PFLs). The forwarding of BM traffic is
      modified, and BM traffic from the AR-LEAF nodes will be drawn toward
AR-REPLICATORs in the BD. An AR-LEAF will forward BM
      traffic to its selected AR-REPLICATOR; therefore, an attack on the
      AR-REPLICATOR could impact the delivery of the BM traffic using that
      node. Also, an attack on the AR-REPLICATOR and any change to the advertised
      AR type will modify the selections made by the AR-LEAF nodes. If no other
      AR-REPLICATOR is selected, the AR-LEAF nodes will be forced to use
      Ingress Replication forwarding mode, which will impact their
      performance, since the AR-LEAF nodes are usually NVEs/PEs with poor
      replication performance.<a class="pilcrow" href="#section-10-2">¶</a></p>
<p id="section-10-3">This document introduces the ability of the AR-REPLICATOR to forward
      traffic received on an overlay tunnel to another overlay tunnel. The
      reader may determine that this introduces the risk of BM loops -- that is,
      an AR-LEAF receiving a BM-encapsulated packet that the AR-LEAF
      originated in the first place due to one or two AR-REPLICATORs
      "looping" the BM traffic back to the AR-LEAF. Following the procedures provided in this
      document will prevent these BM loops, since the AR-REPLICATOR will always
      forward the BM traffic using the correct tunnel IP DA
      (or the correct VNI in the case of single-IP AR-REPLICATORs), which instructs the
      remote nodes regarding how to forward the traffic. This is true for both the
      Non-selective and Selective modes defined in this document. However,
      incorrect implementation of the procedures provided in this document may lead to
      those unexpected BM loops.<a class="pilcrow" href="#section-10-3">¶</a></p>
<p id="section-10-4">The Selective mode provides a multi-stage replication solution,
      where proper configuration of all the AR-REPLICATORs will prevent any
      issues. A mix of mistakenly configured selective and non-selective
      AR-REPLICATORs in the same BD could theoretically create packet
      duplication in some AR-LEAFs; however, this document specifies a fallback solution -- falling back to Non-selective mode in cases where the AR-REPLICATORs
      advertised an inconsistent AR mode.<a class="pilcrow" href="#section-10-4">¶</a></p>
<p id="section-10-5">This document allows the AR-REPLICATOR to preserve the tunnel source IP
      address of the AR-LEAF (as an option) when forwarding BM packets
      from an overlay tunnel to another overlay tunnel. Preserving the AR-LEAF
      source IP address makes the local-bias filtering procedures possible
      for AR-LEAF nodes that are attached to the same ES. If the
      AR-REPLICATOR does not preserve the AR-LEAF source IP address, AR-LEAF
      nodes attached to all-active ESs will cause packet
      duplication on the multihomed CE.<a class="pilcrow" href="#section-10-5">¶</a></p>
<p id="section-10-6">The AR-REPLICATOR nodes are, by design, using more bandwidth than PEs <span>[<a class="cite xref" href="#RFC7432">RFC7432</a>]</span> or NVEs <span>[<a class="cite xref" href="#RFC8365">RFC8365</a>]</span> would use.
      Certain network events or unexpected low performance may exceed the
      AR-REPLICATOR's local bandwidth and cause service disruption.<a class="pilcrow" href="#section-10-6">¶</a></p>
<p id="section-10-7">Finally, PFLs (<a class="auto internal xref" href="#sect-7">Section 7</a>) should be
      used with care. Intentional or unintentional misconfiguration of
      the BDs on a given leaf node may result in the leaf not receiving the
      required BM or unknown unicast traffic.<a class="pilcrow" href="#section-10-7">¶</a></p>
</section>
</div>
<div id="sect-11">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-11-1">IANA has allocated the following Border Gateway Protocol (BGP)
      parameters:<a class="pilcrow" href="#section-11-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-2.1">Allocation in the "P-Multicast Service Interface Tunnel (PMSI Tunnel) Tunnel Types" registry:<a class="pilcrow" href="#section-11-2.1">¶</a>
</li>
      </ul>
<table class="center" id="table-1">
        <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Meaning</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">0x0A</td>
            <td class="text-left" colspan="1" rowspan="1">Assisted Replication Tunnel</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9574</td>
          </tr>
        </tbody>
      </table>
<ul class="normal">
<li class="normal" id="section-11-4.1">Allocations in the "P-Multicast Service Interface (PMSI) Tunnel Attribute Flags" registry:<a class="pilcrow" href="#section-11-4.1">¶</a>
</li>
      </ul>
<table class="center" id="table-2">
        <caption><a class="selfRef" href="#table-2">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Name</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">3-4</td>
            <td class="text-left" colspan="1" rowspan="1">Assisted Replication Type (T)</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9574</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">5</td>
            <td class="text-left" colspan="1" rowspan="1">Broadcast and Multicast (BM)</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9574</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">6</td>
            <td class="text-left" colspan="1" rowspan="1">Unknown (U)</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9574</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<section id="section-12">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-12">12. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-12.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-12.1">12.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6513">[RFC6513]</dt>
        <dd>
<span class="refAuthor">Rosen, E., Ed.</span> and <span class="refAuthor">R. Aggarwal, Ed.</span>, <span class="refTitle">"Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6513</span>, <span class="seriesInfo">DOI 10.17487/RFC6513</span>, <time class="refDate" datetime="2012-02">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6513">https://www.rfc-editor.org/info/rfc6513</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6514">[RFC6514]</dt>
        <dd>
<span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Morin, T.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6514</span>, <span class="seriesInfo">DOI 10.17487/RFC6514</span>, <time class="refDate" datetime="2012-02">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6514">https://www.rfc-editor.org/info/rfc6514</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time class="refDate" datetime="2015-02">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7902">[RFC7902]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">T. Morin</span>, <span class="refTitle">"Registry and Extensions for P-Multicast Service Interface Tunnel Attribute Flags"</span>, <span class="seriesInfo">RFC 7902</span>, <span class="seriesInfo">DOI 10.17487/RFC7902</span>, <time class="refDate" datetime="2016-06">June 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7902">https://www.rfc-editor.org/info/rfc7902</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8365">[RFC8365]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Drake, J., Ed.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Shekhar, R.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 8365</span>, <span class="seriesInfo">DOI 10.17487/RFC8365</span>, <time class="refDate" datetime="2018-03">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8365">https://www.rfc-editor.org/info/rfc8365</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9572">[RFC9572]</dt>
      <dd>
<span class="refAuthor">Zhang, Z.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Patel, K.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"Updates to EVPN Broadcast, Unknown Unicast, or Multicast (BUM) Procedures"</span>, <span class="seriesInfo">RFC 9572</span>, <span class="seriesInfo">DOI 10.17487/RFC9572</span>, <time class="refDate" datetime="2024-05">May 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9572">https://www.rfc-editor.org/info/rfc9572</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-12.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-12.2">12.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC4023">[RFC4023]</dt>
        <dd>
<span class="refAuthor">Worster, T.</span>, <span class="refAuthor">Rekhter, Y.</span>, and <span class="refAuthor">E. Rosen, Ed.</span>, <span class="refTitle">"Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)"</span>, <span class="seriesInfo">RFC 4023</span>, <span class="seriesInfo">DOI 10.17487/RFC4023</span>, <time class="refDate" datetime="2005-03">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4023">https://www.rfc-editor.org/info/rfc4023</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7348">[RFC7348]</dt>
        <dd>
<span class="refAuthor">Mahalingam, M.</span>, <span class="refAuthor">Dutt, D.</span>, <span class="refAuthor">Duda, K.</span>, <span class="refAuthor">Agarwal, P.</span>, <span class="refAuthor">Kreeger, L.</span>, <span class="refAuthor">Sridhar, T.</span>, <span class="refAuthor">Bursell, M.</span>, and <span class="refAuthor">C. Wright</span>, <span class="refTitle">"Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks"</span>, <span class="seriesInfo">RFC 7348</span>, <span class="seriesInfo">DOI 10.17487/RFC7348</span>, <time class="refDate" datetime="2014-08">August 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7348">https://www.rfc-editor.org/info/rfc7348</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7637">[RFC7637]</dt>
        <dd>
<span class="refAuthor">Garg, P., Ed.</span> and <span class="refAuthor">Y. Wang, Ed.</span>, <span class="refTitle">"NVGRE: Network Virtualization Using Generic Routing Encapsulation"</span>, <span class="seriesInfo">RFC 7637</span>, <span class="seriesInfo">DOI 10.17487/RFC7637</span>, <time class="refDate" datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7637">https://www.rfc-editor.org/info/rfc7637</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9161">[RFC9161]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Sathappan, S.</span>, <span class="refAuthor">Nagaraj, K.</span>, <span class="refAuthor">Hankins, G.</span>, and <span class="refAuthor">T. King</span>, <span class="refTitle">"Operational Aspects of Proxy ARP/ND in Ethernet Virtual Private Networks"</span>, <span class="seriesInfo">RFC 9161</span>, <span class="seriesInfo">DOI 10.17487/RFC9161</span>, <time class="refDate" datetime="2022-01">January 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9161">https://www.rfc-editor.org/info/rfc9161</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank <span class="contact-name">Neil Hart</span>, <span class="contact-name">David Motz</span>, <span class="contact-name">Dai Truong</span>,
      <span class="contact-name">Thomas Morin</span>, <span class="contact-name">Jeffrey Zhang</span>, <span class="contact-name">Shankar Murthy</span>, and <span class="contact-name">Krzysztof Szarkowicz</span> for
      their valuable feedback and contributions. Also, thanks to <span class="contact-name">John Scudder</span> for his thorough review, which improved the quality of the document
      significantly.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
</section>
<section id="appendix-B">
      <h2 id="name-contributors">
<a class="section-name selfRef" href="#name-contributors">Contributors</a>
      </h2>
<p id="appendix-B-1">In addition to the authors listed on the front page, the following people also contributed to this document and should be considered coauthors:<a class="pilcrow" href="#appendix-B-1">¶</a></p>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Wim Henderickx</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Kiran Nagaraj</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Ravi Shekhar</span></div>
<div class="left" dir="auto"><span class="org">Juniper Networks</span></div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Nischal Sheth</span></div>
<div class="left" dir="auto"><span class="org">Juniper Networks</span></div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Aldrin Isaac</span></div>
<div class="left" dir="auto"><span class="org">Juniper</span></div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mudassir Tufail</span></div>
<div class="left" dir="auto"><span class="org">Citibank</span></div>
</address>
</section>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Jorge Rabadan (<span class="role">editor</span>)</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
<div class="left" dir="auto"><span class="street-address">777 Middlefield Road</span></div>
<div class="left" dir="auto">
<span class="locality">Mountain View</span>, <span class="region">CA</span> <span class="postal-code">94043</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:jorge.rabadan@nokia.com">jorge.rabadan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Senthil Sathappan</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:senthil.sathappan@nokia.com">senthil.sathappan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Wen Lin</span></div>
<div class="left" dir="auto"><span class="org">Juniper Networks</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:wlin@juniper.net">wlin@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mukul Katiyar</span></div>
<div class="left" dir="auto"><span class="org">Versa Networks</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mukul@versa-networks.com">mukul@versa-networks.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Ali Sajassi</span></div>
<div class="left" dir="auto"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sajassi@cisco.com">sajassi@cisco.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>