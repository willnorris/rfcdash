<html><head></head><body><pre>Internet Engineering Task Force (IETF)                 J. Palet Martinez
Request for Comments: 8585                              The IPv6 Company
Category: Informational                                     H. M.-H. Liu
ISSN: 2070-1721                                     D-Link Systems, Inc.
                                                            M. Kawashima
                                                     NEC Platforms, Ltd.
                                                                May 2019


              <span class="h1">Requirements for IPv6 Customer Edge Routers</span>
                      <span class="h1">to Support IPv4-as-a-Service</span>

Abstract

   This document specifies the IPv4 service continuity requirements for
   IPv6 Customer Edge (CE) routers that are provided either by the
   service provider or by vendors who sell through the retail market.

   Specifically, this document extends the basic requirements for IPv6
   CE routers as described in <a href="./rfc7084">RFC 7084</a> to allow the provisioning of IPv6
   transition services for the support of IPv4-as-a-Service (IPv4aaS) by
   means of new transition mechanisms.  The document only covers
   IPv4aaS, i.e., transition technologies for delivering IPv4 in
   IPv6-only access networks.  IPv4aaS is necessary because there aren't
   sufficient IPv4 addresses available for every possible customer/
   device.  However, devices or applications in the customer Local Area
   Networks (LANs) may be IPv4-only or IPv6-only and still need to
   communicate with IPv4-only services on the Internet.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are candidates for any level of Internet
   Standard; see <a href="./rfc7841#section-2">SectionÂ 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8585">https://www.rfc-editor.org/info/rfc8585</a>.







<span class="grey">Palet Martinez, et al.        Informational                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Requirements Language . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Requirements  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.1">3.1</a>.  LAN-Side Configuration  . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     3.2.  Transition Technologies Support for IPv4 Service
           Continuity (IPv4-as-a-Service)  . . . . . . . . . . . . .   <a href="#page-5">5</a>
       <a href="#section-3.2.1">3.2.1</a>.  464XLAT . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-3.2.2">3.2.2</a>.  Dual-Stack Lite (DS-Lite) . . . . . . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-3.2.3">3.2.3</a>.  Lightweight 4over6 (lw4o6)  . . . . . . . . . . . . .   <a href="#page-9">9</a>
       <a href="#section-3.2.4">3.2.4</a>.  MAP-E . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-3.2.5">3.2.5</a>.  MAP-T . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-4">4</a>.  IPv4 Multicast Support  . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-5">5</a>.  UPnP Support  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  Comparison to <a href="./rfc7084">RFC 7084</a>  . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-7">7</a>.  Code Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-8">8</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-9">9</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-10">10</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-10.1">10.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-10.2">10.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#appendix-A">Appendix A</a>.  Usage Scenarios  . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   <a href="#appendix-B">Appendix B</a>.  End-User Network Architecture  . . . . . . . . . . .  <a href="#page-18">18</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>









<span class="grey">Palet Martinez, et al.        Informational                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   This document defines IPv4 service continuity features over an
   IPv6-only network for residential or small office routers (referred
   to as "IPv6 Transition CE Routers") in order to establish an industry
   baseline for transition features to be implemented on such routers.

   These routers rely upon requirements for IPv6 CE routers defined in
   [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>].  The scope of this document is to ensure IPv4 service
   continuity support for devices in the LAN side.  This ensures that
   remote IPv4-only services continue to be accessible, for both
   IPv4-only and IPv6-only applications and devices, located in the LAN
   side behind an IPv6 Transition CE Router connected to an IPv6-only
   access network.  These ISP access networks are typically referred to
   as Wide Area Networks (WANs), even if they may be metropolitan or
   regional in some cases.  Figure 1 presents a simplified view of this
   architecture.

            +------------+   +------------+   \
            | IPv4-only  |   | IPv4/IPv6  |    \
            |   Remote   |   |   Remote   |     |
            |    Host    |   |    Host    |     | Internet
            +--------+---+   +---+--------+     |
                     |           |             /
                     |           |            /
                   +-+-----------+-+               \
                   |   Service     |                \
                   |   Provider    |                 \
                   |    Router     |                  | Service
                   +-------+-------+                  | Provider
                           | IPv6-only                | Network
                           | Customer                /
                           | Internet Connection    /
                           |                       /
                    +------+--------+                    \
                    |     IPv6      |                     \
                    | Transition CE |                      \
                    |    Router     |                       |
                    +---+-------+---+                       |
          LAN A       |       |       LAN B                 | End-User
    -+----------------+-     -+-----+-------------+-        | Network(s)
     |                              |             |         |
 +---+------+                  +----+-----+ +-----+----+    |
 | IPv6-only|                  | IPv4-only| |IPv4/IPv6 |   /
 |   Host   |                  |   Host   | |   Host   |  /
 +----------+                  +----------+ +----------+ /

           Figure 1: Simplified Typical IPv6-Only Access Network



<span class="grey">Palet Martinez, et al.        Informational                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   This document covers a set of IP transition techniques required when
   ISPs have, or want to have, an IPv6-only access network.  This is a
   common situation when sufficient IPv4 addresses are no longer
   available for every possible customer and device, which causes IPv4
   addresses to become prohibitively expensive.  This, in turn, may
   result in service providers provisioning IPv6-only WAN access.  At
   the same time, they need to ensure that both IPv4-only and IPv6-only
   devices and applications in the customer networks can still reach
   IPv4-only devices and applications on the Internet.

   This document specifies the IPv4 service continuity mechanisms to be
   supported by an IPv6 Transition CE Router and relevant provisioning
   or configuration information differences from [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>].

   This document is not a recommendation for service providers to use
   any specific transition mechanism.

   Automatic provisioning of more complex topology than a single router
   with multiple LAN interfaces may be handled by means of the Home
   Networking Control Protocol (HNCP) [<a href="./rfc7788" title='"Home Networking Control Protocol"'>RFC7788</a>], which is out of the
   scope of this document.

   Since it is impossible to know prior to sale which transition
   mechanism a device will need over its lifetime, an IPv6 Transition CE
   Router intended for the retail market MUST support all the IPv4aaS
   transition mechanisms listed in this document.  Service providers
   that specify feature sets for the IPv6 Transition CE Router may
   define a different set of features from those included in this
   document, for example, features that support only some of the
   transition mechanisms enumerated in this document.

   Appendices A and B contain a complete description of the usage
   scenarios and end-user network architecture, respectively.  These
   appendices, along with [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>], will facilitate a clearer
   understanding of this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="./rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.








<span class="grey">Palet Martinez, et al.        Informational                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   This document uses the same terms as in [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>], with minor
   clarifications.

   "IPv4aaS" stands for "IPv4-as-a-Service", meaning transition
   technologies for delivering IPv4 in IPv6-only connectivity.

   The term "IPv6 transition Customer Edge Router with IPv4aaS"
   (shortened as "IPv6 Transition CE Router") is defined as an IPv6
   Customer Edge Router that provides features for the delivery of IPv4
   services over an IPv6-only WAN network, including IPv6-IPv4
   communications.

   The term "WAN Interface" as used in this document is defined as an
   IPv6 Transition CE Router attachment to an IPv6-only link used to
   provide connectivity to a service provider network, including link
   Internet-layer (or higher layers) tunnels, such as IPv4-in-IPv6
   tunnels.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Requirements"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Requirements</span>

   The IPv6 Transition CE Router MUST comply with [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>] ("Basic
   Requirements for IPv6 Customer Edge Routers").  This document adds
   new requirements, as described in the following subsections.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20LAN-Side%20Configuration"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  LAN-Side Configuration</span>

   A new LAN requirement is added, which is, in fact, common in regular
   IPv6 Transition CE Routers, and is required by most of the transition
   mechanisms:

   L-1:  The IPv6 Transition CE Router MUST implement a DNS proxy as
         described in [<a href="./rfc5625" title='"DNS Proxy Implementation Guidelines"'>RFC5625</a>] ("DNS Proxy Implementation Guidelines").

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20Transition%20Technologies%20Support%20for%20IPv4%20Service%20Continuity%20%28IPv4-"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Transition Technologies Support for IPv4 Service Continuity (IPv4-</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/as-a-Service%29"></a>      as-a-Service)</span>

   The main target of this document is the support of IPv6-only WAN
   access.  To enable legacy IPv4 functionality, this document also
   includes the support of IPv4-only devices and applications in the
   customer LANs, as well as IPv4-only services on the Internet.  Thus,
   both IPv4-only and IPv6-only devices in the customer-side LANs of the
   IPv6 Transition CE Router are able to reach the IPv4-only services.







<span class="grey">Palet Martinez, et al.        Informational                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   Note that this document only configures IPv4aaS in the IPv6
   Transition CE Router itself; it does not forward such information to
   devices attached to the LANs.  Thus, the WAN configuration and
   availability of native IPv4 or IPv4aaS are transparent for the
   devices attached to the LANs.

   This document takes no position on simultaneous operation of one or
   several transition mechanisms and/or native IPv4.

   In order to seamlessly provide IPv4 service continuity in the
   customer LANs and allow automated IPv6 transition mechanism
   provisioning, the following general transition requirements are
   defined.

   General transition requirements:

   TRANS-1:  The IPv6 Transition CE Router MUST support the DHCPv6 S46
             priority options described in [<a href="./rfc8026" title='"Unified IPv4-in-IPv6 Softwire Customer Premises Equipment (CPE): A DHCPv6-Based Prioritization Mechanism"'>RFC8026</a>] ("Unified IPv4-in-
             IPv6 Softwire Customer Premises Equipment (CPE): A
             DHCPv6-Based Prioritization Mechanism").

   TRANS-2:  The IPv6 Transition CE Router MUST have a GUI and either a
             CLI or API (or both) to manually enable/disable each of the
             supported transition mechanisms.

   TRANS-3:  If an IPv6 Transition CE Router supports more than one LAN
             subnet, the IPv6 Transition CE Router MUST allow
             appropriate subnetting and configuration of the address
             space among several interfaces.  In some transition
             mechanisms, this may require differentiating mappings/
             translations on a per-interface basis.

   In order to allow the service provider to disable all the transition
   mechanisms and/or choose the most convenient one, the IPv6 Transition
   CE Router MUST follow the following configuration steps:

   CONFIG-1:  Request the relevant configuration options for each
              supported transition mechanisms, which MUST remain
              disabled at this step.

   CONFIG-2:  Following the steps in <a href="./rfc8026#section-1.4">SectionÂ 1.4 of [RFC8026]</a>, MUST
              check for a valid match in OPTION_S46_PRIORITY, which
              allows enabling/disabling a transition mechanism.

   CONFIG-3:  Keep disabled all the transition mechanisms if no match is
              found between the priority list and the candidate list,
              unless a NAT64 [<a href="./rfc6146" title='"Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers"'>RFC6146</a>] prefix has been configured, in
              which case, 464XLAT [<a href="./rfc6877" title='"464XLAT: Combination of Stateful and Stateless Translation"'>RFC6877</a>] MUST be enabled.



<span class="grey">Palet Martinez, et al.        Informational                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   Because 464XLAT has no DHCPv6 configuration options, it can't
   currently be included in the OPTION_S46_PRIORITY.  In the future, an
   update of [<a href="./rfc8026" title='"Unified IPv4-in-IPv6 Softwire Customer Premises Equipment (CPE): A DHCPv6-Based Prioritization Mechanism"'>RFC8026</a>] or a NAT64 DHCPv6 configuration option may enable
   it.  Meanwhile, if an operator provides 464XLAT, it needs to ensure
   that OPTION_S46_PRIORITY is not sent for any other transition
   mechanism to the relevant customers.

   The following subsections describe the requirements for supporting
   each one of the transition mechanisms.  An IPv6 Transition CE Router
   intended for the retail market MUST support all of them.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.1.%20%20464XLAT"></a><a class="selflink" href="#section-3.2.1" id="section-3.2.1">3.2.1</a>.  464XLAT</span>

   464XLAT [<a href="./rfc6877" title='"464XLAT: Combination of Stateful and Stateless Translation"'>RFC6877</a>] is a technique to provide IPv4 service over an
   IPv6-only access network without encapsulation.  This architecture
   assumes a Stateful NAT64 [<a href="./rfc6146" title='"Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers"'>RFC6146</a>] function deployed at the service
   provider or a third-party network.

   The IPv6 Transition CE Router MUST support customer-side translator
   (CLAT) functionality [<a href="./rfc6877" title='"464XLAT: Combination of Stateful and Stateless Translation"'>RFC6877</a>] if intended for the retail market.  If
   464XLAT is supported, it MUST be implemented according to [<a href="./rfc6877" title='"464XLAT: Combination of Stateful and Stateless Translation"'>RFC6877</a>].
   The following IPv6 Transition CE Router requirements also apply.

   464XLAT requirements:

   464XLAT-1:  Unless a dedicated /64 prefix has been acquired, either
               by using DHCPv6-PD (Dynamic Host Configuration Protocol
               for IPv6 Prefix Delegation) or by alternative means, the
               IPv6 Transition CE Router MUST perform IPv4 Network
               Address Translation (NAT) on IPv4 traffic translated
               using the CLAT.

   464XLAT-2:  The IPv6 Transition CE Router SHOULD support IGD-PCP IWF
               [<a href="./rfc6970" title='"Universal Plug and Play (UPnP) Internet Gateway Device - Port Control Protocol Interworking Function (IGD-PCP IWF)"'>RFC6970</a>] ("Universal Plug and Play (UPnP) Internet
               Gateway Device - Port Control Protocol Interworking
               Function (IGD-PCP IWF)").

   464XLAT-3:  If the Port Control Protocol (PCP) [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>] is
               implemented, the IPv6 Transition CE Router MUST also
               implement [<a href="./rfc7291" title='"DHCP Options for the Port Control Protocol (PCP)"'>RFC7291</a>] ("DHCP Options for the Port Control
               Protocol (PCP)").  Following [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>], if no PCP server
               is configured, the IPv6 Transition CE Router MAY verify
               if the default gateway or the NAT64 is the PCP server.
               The IPv6 Transition CE Router MUST use plain IPv6 mode
               (i.e., not IPv4-in-IPv6 encapsulation) to send PCP
               requests to the server.





<span class="grey">Palet Martinez, et al.        Informational                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   464XLAT-4:  The IPv6 Transition CE Router MUST implement [<a href="./rfc7050" title='"Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis"'>RFC7050</a>]
               ("Discovery of the IPv6 Prefix Used for IPv6 Address
               Synthesis") in order to discover the provider-side
               translator (PLAT) translation IPv4 and IPv6
               prefix(es)/suffix(es).

   464XLAT-5:  If PCP is implemented, the IPv6 Transition CE Router MUST
               follow [<a href="./rfc7225" title='"Discovering NAT64 IPv6 Prefixes Using the Port Control Protocol (PCP)"'>RFC7225</a>] ("Discovering NAT64 IPv6 Prefixes Using
               the Port Control Protocol (PCP)") in order to learn the
               PLAT-side translation IPv4 and IPv6 prefix(es)/suffix(es)
               used by an upstream PCP-controlled NAT64 device.

   464XLAT-6:  If the network provides several choices for the
               discovery/learning of the NAT64 prefix, the priority to
               use one or the other MUST follow this order: 1) [<a href="./rfc7225" title='"Discovering NAT64 IPv6 Prefixes Using the Port Control Protocol (PCP)"'>RFC7225</a>]
               and 2) [<a href="./rfc7050" title='"Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis"'>RFC7050</a>].

   The NAT64 prefix could be discovered by means of the method defined
   in [<a href="./rfc7050" title='"Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis"'>RFC7050</a>] only if the service provider uses DNS64 [<a href="./rfc6147" title='"DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers"'>RFC6147</a>].  It
   may be the case that the service provider does not use or does not
   trust DNS64 [<a href="./rfc6147" title='"DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers"'>RFC6147</a>] because the DNS configuration at the CE (or
   hosts behind the CE) can be modified by the customer.  In that case,
   the service provider may opt to configure the NAT64 prefix by means
   of the option defined in [<a href="./rfc7225" title='"Discovering NAT64 IPv6 Prefixes Using the Port Control Protocol (PCP)"'>RFC7225</a>].  This can also be used if the
   service provider uses DNS64 [<a href="./rfc6147" title='"DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers"'>RFC6147</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.2.%20%20Dual-Stack%20Lite%20%28DS-Lite%29"></a><a class="selflink" href="#section-3.2.2" id="section-3.2.2">3.2.2</a>.  Dual-Stack Lite (DS-Lite)</span>

   DS-Lite [<a href="./rfc6333" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>RFC6333</a>] enables continued support for IPv4 services.
   DS-Lite enables a broadband service provider to share IPv4 addresses
   among customers by combining two well-known technologies: IP in IP
   (IPv4-in-IPv6) and Network Address Translation (NAT).  It is expected
   that DS-Lite traffic is forwarded over the IPv6 Transition CE
   Router's native IPv6 WAN interface and not encapsulated in another
   tunnel.

   The IPv6 Transition CE Router MUST implement DS-Lite B4 functionality
   [<a href="./rfc6333" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>RFC6333</a>] if intended for the retail market.  If DS-Lite is
   supported, it MUST be implemented according to [<a href="./rfc6333" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>RFC6333</a>].  The
   following IPv6 Transition CE Router requirements also apply.











<span class="grey">Palet Martinez, et al.        Informational                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   DS-Lite requirements:

   DSLITE-1:  The IPv6 Transition CE Router MUST support configuration
              of DS-Lite via the DS-Lite DHCPv6 option [<a href="./rfc6334" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Option for Dual-Stack Lite"'>RFC6334</a>]
              ("Dynamic Host Configuration Protocol for IPv6 (DHCPv6)
              Option for Dual-Stack Lite").  The IPv6 Transition CE
              Router MAY use other mechanisms to configure DS-Lite
              parameters.  Such mechanisms are outside the scope of this
              document.

   DSLITE-2:  The IPv6 Transition CE Router SHOULD support IGD-PCP IWF
              [<a href="./rfc6970" title='"Universal Plug and Play (UPnP) Internet Gateway Device - Port Control Protocol Interworking Function (IGD-PCP IWF)"'>RFC6970</a>].

   DSLITE-3:  If PCP [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>] is implemented, the IPv6 Transition CE
              Router SHOULD implement [<a href="./rfc7291" title='"DHCP Options for the Port Control Protocol (PCP)"'>RFC7291</a>].  If PCP [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>] is
              implemented and a PCP server is not configured, the IPv6
              Transition CE Router MUST assume, by default, that the
              Address Family Transition Router (AFTR, commonly called
              "CGN" - Carrier-Grade NAT) is the PCP server.  The IPv6

              Transition CE Router MUST use plain IPv6 mode (i.e., not
              IPv4-in-IPv6 encapsulation) to send PCP requests to the
              server.  The term "default" above is to be interpreted as
              pertaining to a configuration as applied by a vendor prior
              to the administrator changing it for its initial
              activation.

   DSLITE-4:  The IPv6 Transition CE Router MUST NOT perform IPv4
              Network Address Translation (NAT) on IPv4 traffic
              encapsulated using DS-Lite [<a href="./rfc6333" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>RFC6333</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.3.%20%20Lightweight%204over6%20%28lw4o6%29"></a><a class="selflink" href="#section-3.2.3" id="section-3.2.3">3.2.3</a>.  Lightweight 4over6 (lw4o6)</span>

   lw4o6 [<a href="./rfc7596" title='"Lightweight 4over6: An Extension to the Dual- Stack Lite Architecture"'>RFC7596</a>] specifies an extension to DS-Lite that moves the NAPT
   function from the DS-Lite tunnel concentrator to the tunnel client
   located in the IPv6 Transition CE Router, removing the requirement
   for an AFTR (CGN) function in the tunnel concentrator and reducing
   the amount of centralized state.

   The IPv6 Transition CE Router MUST implement lwB4 functionality
   [<a href="./rfc7596" title='"Lightweight 4over6: An Extension to the Dual- Stack Lite Architecture"'>RFC7596</a>] if intended for the retail market.  If DS-Lite is
   implemented, lw4o6 SHOULD be implemented as well.  If lw4o6 is
   supported, it MUST be implemented according to [<a href="./rfc7596" title='"Lightweight 4over6: An Extension to the Dual- Stack Lite Architecture"'>RFC7596</a>].  The
   following IPv6 Transition CE Router requirements also apply.







<span class="grey">Palet Martinez, et al.        Informational                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   lw4o6 requirements:

   LW4O6-1:  The IPv6 Transition CE Router MUST support configuration of
             lw4o6 via the lw4o6 DHCPv6 options [<a href="./rfc7598" title='"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped Clients"'>RFC7598</a>] ("DHCPv6
             Options for Configuration of Softwire Address and Port-
             Mapped Clients").  The IPv6 Transition CE Router MAY use
             other mechanisms to configure lw4o6 parameters.  Such
             mechanisms are outside the scope of this document.

   LW4O6-2:  The IPv6 Transition CE Router MUST support the DHCPv4-over-
             DHCPv6 (DHCP 4o6) transport described in [<a href="./rfc7341" title='"DHCPv4-over-DHCPv6 (DHCP 4o6) Transport"'>RFC7341</a>]
             ("DHCPv4-over-DHCPv6 (DHCP 4o6) Transport").

   LW4O6-3:  The IPv6 Transition CE Router MAY support Dynamic
             Allocation of Shared IPv4 Addresses as described in
             [<a href="./rfc7618" title='"Dynamic Allocation of Shared IPv4 Addresses"'>RFC7618</a>] ("Dynamic Allocation of Shared IPv4 Addresses").

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.4.%20%20MAP-E"></a><a class="selflink" href="#section-3.2.4" id="section-3.2.4">3.2.4</a>.  MAP-E</span>

   Mapping of Address and Port with Encapsulation (MAP-E) [<a href="./rfc7597" title='"Mapping of Address and Port with Encapsulation (MAP-E)"'>RFC7597</a>] is a
   mechanism for transporting IPv4 packets across an IPv6 network using
   IP encapsulation.  MAP-E includes an algorithmic mechanism for
   mapping between IPv6 and IPv4 addresses.

   The IPv6 Transition CE Router MUST support MAP-E CE functionality
   [<a href="./rfc7597" title='"Mapping of Address and Port with Encapsulation (MAP-E)"'>RFC7597</a>] if intended for the retail market.  If MAP-E is supported,
   it MUST be implemented according to [<a href="./rfc7597" title='"Mapping of Address and Port with Encapsulation (MAP-E)"'>RFC7597</a>].  The following IPv6
   Transition CE Router requirements also apply.

   MAP-E requirements:

   MAPE-1:  The IPv6 Transition CE Router MUST support configuration of
            MAP-E via the MAP-E DHCPv6 options [<a href="./rfc7598" title='"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped Clients"'>RFC7598</a>].  The IPv6
            Transition CE Router MAY use other mechanisms to configure
            MAP-E parameters.  Such mechanisms are outside the scope of
            this document.

   MAPE-2:  The IPv6 Transition CE Router MAY support Dynamic Allocation
            of Shared IPv4 Addresses as described in [<a href="./rfc7618" title='"Dynamic Allocation of Shared IPv4 Addresses"'>RFC7618</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.5.%20%20MAP-T"></a><a class="selflink" href="#section-3.2.5" id="section-3.2.5">3.2.5</a>.  MAP-T</span>

   MAP-T [<a href="./rfc7599" title='"Mapping of Address and Port using Translation (MAP-T)"'>RFC7599</a>] is a mechanism similar to MAP-E, differing from it in
   that MAP-T uses IPv4-IPv6 translation, instead of encapsulation, as
   the form of IPv6 domain transport.






<span class="grey">Palet Martinez, et al.        Informational                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   The IPv6 Transition CE Router MUST support MAP-T CE functionality
   [<a href="./rfc7599" title='"Mapping of Address and Port using Translation (MAP-T)"'>RFC7599</a>] if intended for the retail market.  If MAP-T is supported,
   it MUST be implemented according to [<a href="./rfc7599" title='"Mapping of Address and Port using Translation (MAP-T)"'>RFC7599</a>].  The following IPv6
   Transition CE Router requirements also apply.

   MAP-T requirements:

   MAPT-1:  The IPv6 Transition CE Router MUST support configuration of
            MAP-T via the MAP-T DHCPv6 options [<a href="./rfc7598" title='"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped Clients"'>RFC7598</a>].  The IPv6
            Transition CE Router MAY use other mechanisms to configure
            MAP-T parameters.  Such mechanisms are outside the scope of
            this document.

   MAPT-2:  The IPv6 Transition CE Router MAY support Dynamic Allocation
            of Shared IPv4 Addresses as described in [<a href="./rfc7618" title='"Dynamic Allocation of Shared IPv4 Addresses"'>RFC7618</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20IPv4%20Multicast%20Support"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  IPv4 Multicast Support</span>

   Existing IPv4 deployments support IPv4 multicast for services such as
   IPTV.  In the transition phase, it is expected that multicast
   services will still be provided using IPv4 to the customer LANs.

   If the IPv6 Transition CE Router supports delivery of IPv4 multicast
   services, then it MUST support [<a href="./rfc8114" title='"Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6 Multicast Network"'>RFC8114</a>] ("Delivery of IPv4 Multicast
   Services to IPv4 Clients over an IPv6 Multicast Network") and
   [<a href="./rfc8115" title='"DHCPv6 Option for IPv4-Embedded Multicast and Unicast IPv6 Prefixes"'>RFC8115</a>] ("DHCPv6 Option for IPv4-Embedded Multicast and Unicast
   IPv6 Prefixes").

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20UPnP%20Support"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  UPnP Support</span>

   If the UPnP WANIPConnection:2 service [<a href="#ref-UPnP-WANIPC">UPnP-WANIPC</a>][OCF-IGD] is
   enabled on a CE router, but cannot be associated with an IPv4
   interface established by an IPv4aaS mechanism or cannot determine
   which ports are available, an AddPortMapping() or AddAnyPortMapping()
   action MUST be rejected with error code 729
   ("ConflictWithOtherMechanisms").  Port availability could be
   determined through PCP or access to a configured port set (if the
   IPv4aaS mechanism limits the available ports).

   An AddPortMapping() request for a port that is not available MUST
   result in "ConflictInMappingEntry".

   An AddAnyPortMapping() request for a port that is not available
   SHOULD result in a successful mapping with an alternative
   "NewReservedPort" value from within the configured port set range or
   as assigned by PCP as per <a href="./rfc6970#section-5.6.1">SectionÂ 5.6.1 of [RFC6970]</a>.





<span class="grey">Palet Martinez, et al.        Informational                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   Note that IGD:1 and its WANIPConnection:1 service have been
   deprecated by OCF (Open Connectivity Foundation) [<a href="#ref-OCF-IGD" title='"Internet Gateway Device (IGD) V 2.0"'>OCF-IGD</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Comparison%20to%20RFC%207084"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Comparison to <a href="./rfc7084">RFC 7084</a></span>

   This document doesn't include support for 6rd [<a href="./rfc5969" title='"IPv6 Rapid Deployment on IPv4 Infrastructures (6rd) -- Protocol Specification"'>RFC5969</a>] because it is
   an IPv6-in-IPv4 tunneling.

   Regarding DS-LITE [<a href="./rfc6333" title='"Dual- Stack Lite Broadband Deployments Following IPv4 Exhaustion"'>RFC6333</a>], this document includes slightly
   different requirements related to the support of PCP [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>],
   IGD-PCP IWF [<a href="./rfc6970" title='"Universal Plug and Play (UPnP) Internet Gateway Device - Port Control Protocol Interworking Function (IGD-PCP IWF)"'>RFC6970</a>], and the prioritization of the transition
   mechanisms, including dual-stack.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Code%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Code Considerations</span>

   At the time of this writing, one of the apparent main issues for
   vendors with regard to including new functionalities, such as support
   for new transition mechanisms, is the lack of space in the flash (or
   equivalent) memory.  However, it has been confirmed from existing
   open-source implementations (e.g., OpenWRT/LEDE, Linux, and VPP) that
   adding the support for the new transition mechanisms requires around
   10-12 KBs because most of the code base is shared among several
   transition mechanisms, which are already supported by [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>].  A
   single data plane is common to all of them, which typically means, in
   popular CEs already in the market [<a href="#ref-OpenWRT" title='"Packages"'>OpenWRT</a>], the new required code is
   only about 0.15% of the total existing code size.

   In general, the new requirements don't have extra cost in terms of
   RAM memory, nor other hardware requirements such as more powerful
   CPUs, if compared to the cost of NAT44 code.  Thus, existing hardware
   should be able to support all of them with minimal impact.

   The other issue seems to be the cost of developing the code for those
   new functionalities.  However, at the time of writing this document,
   it has been confirmed that there are several open-source versions of
   the required code for supporting all the new transition mechanisms,
   and several vendors already have implementations and provided them to
   ISPs.  Therefore, the development cost is negligible, and only
   integration and testing cost may become an issue.

   Finally, in some cases, operators supporting several transition
   mechanisms may need to consider training costs for staff in all the
   techniques for the operation and management of these mechanisms, even
   if the costs are not directly caused by supporting this document but
   because of business decisions.






<span class="grey">Palet Martinez, et al.        Informational                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Security Considerations</span>

   The IPv6 Transition CE Router must comply with the Security
   Considerations in [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>] as well as those for each transition
   mechanism implemented by the IPv6 Transition CE Router.

   As described in the Security Considerations of [<a href="./rfc8026" title='"Unified IPv4-in-IPv6 Softwire Customer Premises Equipment (CPE): A DHCPv6-Based Prioritization Mechanism"'>RFC8026</a>] and
   [<a href="./rfc8415" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC8415</a>], there are generic DHCP security issues, which, in the case
   of this document, mean that malicious nodes may alter the priority of
   the transition mechanisms.

   Access network architecture for securing DHCP within the access
   network is out of scope for this document.  Securing DHCP in the LAN
   is also not in scope.  DHCP packets MUST NOT be forwarded between LAN
   and WAN interfaces of an IPv6 Transition CE Router.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  IANA Considerations</span>

   This document has no IANA actions.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20References"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5625">RFC5625</a>]  Bellis, R., "DNS Proxy Implementation Guidelines",
              <a href="https://www.rfc-editor.org/bcp/bcp152">BCP 152</a>, <a href="./rfc5625">RFC 5625</a>, DOI 10.17487/RFC5625, August 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5625">https://www.rfc-editor.org/info/rfc5625</a>&gt;.

   [<a id="ref-RFC5969">RFC5969</a>]  Townsley, W. and O. Troan, "IPv6 Rapid Deployment on IPv4
              Infrastructures (6rd) -- Protocol Specification",
              <a href="./rfc5969">RFC 5969</a>, DOI 10.17487/RFC5969, August 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5969">https://www.rfc-editor.org/info/rfc5969</a>&gt;.

   [<a id="ref-RFC6146">RFC6146</a>]  Bagnulo, M., Matthews, P., and I. van Beijnum, "Stateful
              NAT64: Network Address and Protocol Translation from IPv6
              Clients to IPv4 Servers", <a href="./rfc6146">RFC 6146</a>, DOI 10.17487/RFC6146,
              April 2011, &lt;<a href="https://www.rfc-editor.org/info/rfc6146">https://www.rfc-editor.org/info/rfc6146</a>&gt;.

   [<a id="ref-RFC6147">RFC6147</a>]  Bagnulo, M., Sullivan, A., Matthews, P., and I. van
              Beijnum, "DNS64: DNS Extensions for Network Address
              Translation from IPv6 Clients to IPv4 Servers", <a href="./rfc6147">RFC 6147</a>,
              DOI 10.17487/RFC6147, April 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6147">https://www.rfc-editor.org/info/rfc6147</a>&gt;.



<span class="grey">Palet Martinez, et al.        Informational                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   [<a id="ref-RFC6333">RFC6333</a>]  Durand, A., Droms, R., Woodyatt, J., and Y. Lee, "Dual-
              Stack Lite Broadband Deployments Following IPv4
              Exhaustion", <a href="./rfc6333">RFC 6333</a>, DOI 10.17487/RFC6333, August 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6333">https://www.rfc-editor.org/info/rfc6333</a>&gt;.

   [<a id="ref-RFC6334">RFC6334</a>]  Hankins, D. and T. Mrugalski, "Dynamic Host Configuration
              Protocol for IPv6 (DHCPv6) Option for Dual-Stack Lite",
              <a href="./rfc6334">RFC 6334</a>, DOI 10.17487/RFC6334, August 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6334">https://www.rfc-editor.org/info/rfc6334</a>&gt;.

   [<a id="ref-RFC6877">RFC6877</a>]  Mawatari, M., Kawashima, M., and C. Byrne, "464XLAT:
              Combination of Stateful and Stateless Translation",
              <a href="./rfc6877">RFC 6877</a>, DOI 10.17487/RFC6877, April 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6877">https://www.rfc-editor.org/info/rfc6877</a>&gt;.

   [<a id="ref-RFC6887">RFC6887</a>]  Wing, D., Ed., Cheshire, S., Boucadair, M., Penno, R., and
              P. Selkirk, "Port Control Protocol (PCP)", <a href="./rfc6887">RFC 6887</a>,
              DOI 10.17487/RFC6887, April 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6887">https://www.rfc-editor.org/info/rfc6887</a>&gt;.

   [<a id="ref-RFC6970">RFC6970</a>]  Boucadair, M., Penno, R., and D. Wing, "Universal Plug and
              Play (UPnP) Internet Gateway Device - Port Control
              Protocol Interworking Function (IGD-PCP IWF)", <a href="./rfc6970">RFC 6970</a>,
              DOI 10.17487/RFC6970, July 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6970">https://www.rfc-editor.org/info/rfc6970</a>&gt;.

   [<a id="ref-RFC7050">RFC7050</a>]  Savolainen, T., Korhonen, J., and D. Wing, "Discovery of
              the IPv6 Prefix Used for IPv6 Address Synthesis",
              <a href="./rfc7050">RFC 7050</a>, DOI 10.17487/RFC7050, November 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7050">https://www.rfc-editor.org/info/rfc7050</a>&gt;.

   [<a id="ref-RFC7084">RFC7084</a>]  Singh, H., Beebee, W., Donley, C., and B. Stark, "Basic
              Requirements for IPv6 Customer Edge Routers", <a href="./rfc7084">RFC 7084</a>,
              DOI 10.17487/RFC7084, November 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7084">https://www.rfc-editor.org/info/rfc7084</a>&gt;.

   [<a id="ref-RFC7225">RFC7225</a>]  Boucadair, M., "Discovering NAT64 IPv6 Prefixes Using the
              Port Control Protocol (PCP)", <a href="./rfc7225">RFC 7225</a>,
              DOI 10.17487/RFC7225, May 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7225">https://www.rfc-editor.org/info/rfc7225</a>&gt;.

   [<a id="ref-RFC7291">RFC7291</a>]  Boucadair, M., Penno, R., and D. Wing, "DHCP Options for
              the Port Control Protocol (PCP)", <a href="./rfc7291">RFC 7291</a>,
              DOI 10.17487/RFC7291, July 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7291">https://www.rfc-editor.org/info/rfc7291</a>&gt;.






<span class="grey">Palet Martinez, et al.        Informational                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   [<a id="ref-RFC7341">RFC7341</a>]  Sun, Q., Cui, Y., Siodelski, M., Krishnan, S., and I.
              Farrer, "DHCPv4-over-DHCPv6 (DHCP 4o6) Transport",
              <a href="./rfc7341">RFC 7341</a>, DOI 10.17487/RFC7341, August 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7341">https://www.rfc-editor.org/info/rfc7341</a>&gt;.

   [<a id="ref-RFC7596">RFC7596</a>]  Cui, Y., Sun, Q., Boucadair, M., Tsou, T., Lee, Y., and I.
              Farrer, "Lightweight 4over6: An Extension to the Dual-
              Stack Lite Architecture", <a href="./rfc7596">RFC 7596</a>, DOI 10.17487/RFC7596,
              July 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7596">https://www.rfc-editor.org/info/rfc7596</a>&gt;.

   [<a id="ref-RFC7597">RFC7597</a>]  Troan, O., Ed., Dec, W., Li, X., Bao, C., Matsushima, S.,
              Murakami, T., and T. Taylor, Ed., "Mapping of Address and
              Port with Encapsulation (MAP-E)", <a href="./rfc7597">RFC 7597</a>,
              DOI 10.17487/RFC7597, July 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7597">https://www.rfc-editor.org/info/rfc7597</a>&gt;.

   [<a id="ref-RFC7598">RFC7598</a>]  Mrugalski, T., Troan, O., Farrer, I., Perreault, S., Dec,
              W., Bao, C., Yeh, L., and X. Deng, "DHCPv6 Options for
              Configuration of Softwire Address and Port-Mapped
              Clients", <a href="./rfc7598">RFC 7598</a>, DOI 10.17487/RFC7598, July 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7598">https://www.rfc-editor.org/info/rfc7598</a>&gt;.

   [<a id="ref-RFC7599">RFC7599</a>]  Li, X., Bao, C., Dec, W., Ed., Troan, O., Matsushima, S.,
              and T. Murakami, "Mapping of Address and Port using
              Translation (MAP-T)", <a href="./rfc7599">RFC 7599</a>, DOI 10.17487/RFC7599, July
              2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7599">https://www.rfc-editor.org/info/rfc7599</a>&gt;.

   [<a id="ref-RFC7618">RFC7618</a>]  Cui, Y., Sun, Q., Farrer, I., Lee, Y., Sun, Q., and M.
              Boucadair, "Dynamic Allocation of Shared IPv4 Addresses",
              <a href="./rfc7618">RFC 7618</a>, DOI 10.17487/RFC7618, August 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7618">https://www.rfc-editor.org/info/rfc7618</a>&gt;.

   [<a id="ref-RFC8026">RFC8026</a>]  Boucadair, M. and I. Farrer, "Unified IPv4-in-IPv6
              Softwire Customer Premises Equipment (CPE): A DHCPv6-Based
              Prioritization Mechanism", <a href="./rfc8026">RFC 8026</a>, DOI 10.17487/RFC8026,
              November 2016, &lt;<a href="https://www.rfc-editor.org/info/rfc8026">https://www.rfc-editor.org/info/rfc8026</a>&gt;.

   [<a id="ref-RFC8114">RFC8114</a>]  Boucadair, M., Qin, C., Jacquenet, C., Lee, Y., and Q.
              Wang, "Delivery of IPv4 Multicast Services to IPv4 Clients
              over an IPv6 Multicast Network", <a href="./rfc8114">RFC 8114</a>,
              DOI 10.17487/RFC8114, March 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8114">https://www.rfc-editor.org/info/rfc8114</a>&gt;.

   [<a id="ref-RFC8115">RFC8115</a>]  Boucadair, M., Qin, J., Tsou, T., and X. Deng, "DHCPv6
              Option for IPv4-Embedded Multicast and Unicast IPv6
              Prefixes", <a href="./rfc8115">RFC 8115</a>, DOI 10.17487/RFC8115, March 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8115">https://www.rfc-editor.org/info/rfc8115</a>&gt;.




<span class="grey">Palet Martinez, et al.        Informational                    [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="./rfc2119">RFC</a>
              <a href="./rfc2119">2119</a> Key Words", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8415">RFC8415</a>]  Mrugalski, T., Siodelski, M., Volz, B., Yourtchenko, A.,
              Richardson, M., Jiang, S., Lemon, T., and T. Winters,
              "Dynamic Host Configuration Protocol for IPv6 (DHCPv6)",
              <a href="./rfc8415">RFC 8415</a>, DOI 10.17487/RFC8415, November 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8415">https://www.rfc-editor.org/info/rfc8415</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-IPv6Survey">IPv6Survey</a>]
              Palet Martinez, J., "Best Current Operational Practice for
              operators: IPv6 Prefix Assignment for end-customers --
              persistent vs non-persistent and what size to choose",
              January 2018,
              &lt;<a href="https://indico.uknof.org.uk/event/41/contribution/5/material/slides/0.pdf">https://indico.uknof.org.uk/event/41/contribution/5/</a>
              <a href="https://indico.uknof.org.uk/event/41/contribution/5/material/slides/0.pdf">material/slides/0.pdf</a>&gt;.

   [<a id="ref-OCF-IGD">OCF-IGD</a>]  Open Connectivity Foundation, "Internet Gateway Device
              (IGD) V 2.0", March 2015,
              &lt;<a href="https://openconnectivity.org/developer/specifications/upnp-resources/upnp/internet-gateway-device-igd-v-2-0">https://openconnectivity.org/developer/specifications/</a>
              <a href="https://openconnectivity.org/developer/specifications/upnp-resources/upnp/internet-gateway-device-igd-v-2-0">upnp-resources/upnp/internet-gateway-device-igd-v-2-0</a>&gt;.

   [<a id="ref-OpenWRT">OpenWRT</a>]  OpenWRT, "Packages", &lt;<a href="https://openwrt.org/packages/start">https://openwrt.org/packages/start</a>&gt;.

   [<a id="ref-RFC7788">RFC7788</a>]  Stenberg, M., Barth, S., and P. Pfister, "Home Networking
              Control Protocol", <a href="./rfc7788">RFC 7788</a>, DOI 10.17487/RFC7788, April
              2016, &lt;<a href="https://www.rfc-editor.org/info/rfc7788">https://www.rfc-editor.org/info/rfc7788</a>&gt;.

   [<a id="ref-UPnP-IGD">UPnP-IGD</a>]
              UPnP Forum, "InternetGatewayDevice:2 Device Template
              Version 1.01", December 2010, &lt;<a href="http://upnp.org/specs/gw/UPnP-gw-InternetGatewayDevice-v2-Device.pdf">http://upnp.org/specs/gw/</a>
              <a href="http://upnp.org/specs/gw/UPnP-gw-InternetGatewayDevice-v2-Device.pdf">UPnP-gw-InternetGatewayDevice-v2-Device.pdf</a>&gt;.

   [<a id="ref-UPnP-WANIPC">UPnP-WANIPC</a>]
              UPnP Forum, "WANIPConnection:2 Service", September 2010,
              &lt;<a href="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v2-Service.pdf">http://upnp.org/specs/gw/</a>
              <a href="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v2-Service.pdf">UPnP-gw-WANIPConnection-v2-Service.pdf</a>&gt;.











<span class="grey">Palet Martinez, et al.        Informational                    [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Usage%20Scenarios"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Usage Scenarios</span>

   The situation of ongoing IPv6 deployment and a lack of IPv4 addresses
   is not happening at the same pace in every country and even within
   every country for every ISP.  For different technical, financial,
   commercial/marketing, and socio-economic reasons, each network is
   transitioning at their own pace; the global transition timings cannot
   be reliably estimated.

   Different studies (for example, [<a href="#ref-IPv6Survey">IPv6Survey</a>]) also show that IPv6
   deployment is a changing situation.  In a single country, not all
   operators will necessarily provide IPv6 support.  Consumers may also
   switch ISPs and use the same IPv6 Transition CE Router with either an
   ISP that provides IPv4-only or an ISP that provides IPv6 with
   IPv4aaS.

   So, to cover all those evolving situations, an IPv6 Transition CE
   Router is required, at least from the perspective of transition
   support.

   Moreover, because some services and service providers will remain
   IPv4-only for an undetermined period of time, IPv4 service continuity
   is required.  Thus, there is a need for CEs to support IPv4aaS
   indefinitely.

   Based on these premises, this document ensures that the IPv6
   Transition CE Router allows the continued transition from networks
   that today may provide access with dual-stack or IPv6-in-IPv4 (as
   described in [<a href="./rfc7084" title='"Basic Requirements for IPv6 Customer Edge Routers"'>RFC7084</a>]) to networks that provide IPv6-only access
   with IPv4aaS.

   Considering that situation and different possible usage cases, the
   IPv6 Transition CE Router described in this document is expected to
   be used in residential/household; small office, home office (SOHO);
   and small/medium enterprise (SME).  Common usage is any kind of
   Internet access (web, email, streaming, online gaming, etc.), and
   more advanced requirements include inbound connections (IP cameras,
   web, DNS, email, VPN, etc.).

   The above is not intended to be a comprehensive list of all the
   possible usage cases, just an overview.  In fact, combinations of the
   above usages are also possible, along with situations where the same
   CE is used at different times in different scenarios or even with
   different IPv4aaSes at different service providers.







<span class="grey">Palet Martinez, et al.        Informational                    [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   The mechanisms for allowing inbound connections are naturally
   available in any IPv6 router when using IPv6 Global Unicast Addresses
   (GUAs), unless they are blocked by firewall rules, which may require
   some manual configuration.

   However, in the case of IPv4aaS, because of the usage of private IPv4
   addresses and NAT and depending on the specific transition mechanism,
   inbound connections typically require some degree of more complex
   manual configuration, such as setting up a DMZ, setting up virtual
   servers, or setting up port/protocol forwarding.  In general, IPv4 CE
   Routers already provide a GUI, CLI, or API to manually configure
   them, or provide the possibility to set up the CE in bridge mode, so
   another Router behind the original CE, takes care of inbound
   connections.  The requirements for that support are out of the scope
   of this document.

   Who provides the IPv6 Transition CE Router is not relevant.  In most
   cases, the service provider is responsible for provisioning/managing,
   at least on the WAN side.  Commonly, the user has access to configure
   the LAN interfaces, firewall, DMZ, and many other features.  However,
   in many cases, the user must supply or may replace the IPv6
   Transition CE Router.  This underscores the importance of the IPv6
   Transition CE Routers fulfilling the requirements defined in this
   document.

   The IPv6 Transition CE Router described in this document is not
   intended for usage in other scenarios, such as large enterprises,
   data centers, content providers, etc.  Even if the documented
   requirements meet their needs, they may have additional requirements,
   which are out of the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20%20End-User%20Network%20Architecture"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  End-User Network Architecture</span>

   An end-user network will likely support both IPv4 and IPv6 (see
   <a href="#section-1">Section 1</a> and <a href="#appendix-A">Appendix A</a>).  It is not expected that end users will
   change their existing network topology with the introduction of IPv6.
   There are some differences in how IPv6 works and is provisioned;
   these differences have implications for the network architecture.

   A typical IPv4 end-user network consists of a "plug and play" router
   with NAT functionality and a single link upstream, connected to the
   service provider network.

   From the perspective of an IPv4 user behind an IPv6 Transition CE
   Router, this doesn't change.






<span class="grey">Palet Martinez, et al.        Informational                    [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   However, while a typical IPv4 NAT deployment, by default, blocks all
   incoming connections and may allow opening of ports using a Universal
   Plug and Play Internet Gateway Device (UPnP IGD) [<a href="#ref-UPnP-IGD">UPnP-IGD</a>][OCF-IGD]
   or some other firewall control protocol, in the case of an IPv6-only
   access and IPv4aaS, that may not be feasible depending on specific
   transition mechanism details.  PCP [<a href="./rfc6887" title='"Port Control Protocol (PCP)"'>RFC6887</a>] may be an alternative
   solution.

   Another consequence of using IPv4 private address space in the end-
   user network is that it provides stable addressing; that is, it
   doesn't change, even when you change service providers, and the
   addresses are always usable even when the WAN interface is down or
   the customer edge router has not yet been provisioned.  In the case
   of IPv6-only access, private IPv4 addresses are also available if the
   IPv4aaS transition mechanism keeps running the NAT interface towards
   the LAN side when the WAN interface is down.

   More advanced routers support dynamic routing (which learns routes
   from other routers), and advanced end users can build arbitrary,
   complex networks using manual configuration of address prefixes
   combined with a dynamic routing protocol.  Once again, this is true
   for both IPv4 and IPv6.

   In general, the end-user network architecture for IPv6 should provide
   equivalent or better capabilities and functionality than the current
   IPv4 architecture.

   The end-user network is a stub network in the sense that is not
   providing transit to other external networks.  However, HNCP
   [<a href="./rfc7788" title='"Home Networking Control Protocol"'>RFC7788</a>] allows support for automatic provisioning of downstream
   routers.  Figure 2 illustrates the model topology for the end-user
   network.



















<span class="grey">Palet Martinez, et al.        Informational                    [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


                   +---------------+               \
                   |   Service     |                \
                   |   Provider    |                 \
                   |    Router     |                  | Service
                   +-------+-------+                  | Provider
                           | IPv6-only                | Network
                           | Customer                /
                           | Internet Connection    /
                           |                       /
                    +------+--------+                    \
                    |     IPv6      |                     \
                    | Transition CE |                      \
                    |    Router     |                       |
                    +---+-------+---+                       |
        Network A       |       |   Network B               |
    -+----------------+-+-     -+---+-------------+-        |
     |                |             |             |         |
 +---+------+         |        +----+-----+ +-----+----+    |
 |   IPv6   |         |        |   IPv4   | |IPv4/IPv6 |    |
 |   Host   |         |        |   Host   | |   Host   |    |
 +----------+         |        +----------+ +----------+    | End-User
                      |                                     | Network(s)
               +------+--------+                            |
               |     IPv6      |                            |
               |    Router     |                            |
               +------+--------+                            |
        Network C     |                                     |
    -+-------------+--+-                                    |
     |             |                                        |
 +---+------+ +----+-----+                                  |
 |   IPv6   | |   IPv6   |                                 /
 |   Host   | |   Host   |                                /
 +----------+ +----------+                               /

              Figure 2: Example of a Typical End-User Network

   This architecture describes the:

   o  Basic capabilities of the IPv6 Transition CE Router

   o  Provisioning of the WAN interface connecting to the service
      provider

   o  Provisioning of the LAN interfaces







<span class="grey">Palet Martinez, et al.        Informational                    [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8585">RFC 8585</a>       Requirements for IPv6 CE to Support IPv4aaS      May 2019</span>


   The IPv6 Transition CE Router may be manually configured in an
   arbitrary topology with a dynamic routing protocol or HNCP [<a href="./rfc7788" title='"Home Networking Control Protocol"'>RFC7788</a>].
   Automatic provisioning and configuration are described for a single
   IPv6 Transition CE Router only.

Acknowledgements

   Thanks to Mikael Abrahamsson, Fred Baker, Mohamed Boucadair, Brian
   Carpenter, Lorenzo Colitti, Alejandro D'Egidio, Ian Farrer, Lee
   Howard, Richard Patterson, Barbara Stark, Ole Troan, and James
   Woodyatt for their review and comments in this and/or previous draft
   versions of this document.  Thanks also for the Last Call reviews by
   Dan Romascanu (OPS-DIR); Christian Huitema (SEC-DIR); Daniele
   Ceccarelli (RTG-DIR); Martin Stiemerling (TSV-ART); Matthew Miller
   (Gen-ART); and Alissa Cooper, Benjamin Kaduk, Suresh Krishnan, Ben
   Campbell, Spencer Dawkins, Mirja Kuhlewind, and Adam Roach (all
   IESG).

Authors' Addresses

   Jordi Palet Martinez
   The IPv6 Company
   Molino de la Navata, 75
   La Navata - Galapagar, Madrid  28420
   Spain

   Email: jordi.palet@theipv6company.com
   URI:   <a href="http://www.theipv6company.com/">http://www.theipv6company.com/</a>


   Hans M.-H. Liu
   D-Link Systems, Inc.
   17595 Mount Herrmann St.
   Fountain Valley, California  92708
   United States of America

   Email: hans.liu@dlinkcorp.com
   URI:   <a href="https://www.dlink.com/">https://www.dlink.com/</a>


   Masanobu Kawashima
   NEC Platforms, Ltd.
   2-3, Kanda-Tsukasamachi
   Chiyoda-ku, Tokyo  101-8532
   Japan

   Email: kawashimam@vx.jp.nec.com
   URI:   <a href="https://www.necplatforms.co.jp/en/">https://www.necplatforms.co.jp/en/</a>



Palet Martinez, et al.        Informational                    [Page 21]
</pre>
</body></html>