<html><head></head><body><pre>Network Working Group                                           A. Malis
Request for Comments: 5143                        Verizon Communications
Obsoleted by: 4842                                            J. Brayley
Category: Historic                                            J. Shirron
                                                        ECI Telecom Inc.
                                                              L. Martini
                                                     Cisco Systems, Inc.
                                                            S. Vogelsang
                                                          Alcatel-Lucent
                                                           February 2008


 <span class="h1">Synchronous Optical Network/Synchronous Digital Hierarchy (SONET/SDH)</span>
       <span class="h1">Circuit Emulation Service over MPLS (CEM) Encapsulation</span>

Status of This Memo

   This memo defines a Historic Document for the Internet community.  It
   does not specify an Internet standard of any kind.  Distribution of
   this memo is unlimited.

IESG Note

   The IESG thinks that this work is related to IETF work done in WG
   PWE3, but this does not prevent publishing.

Abstract

   This document describes a historical method for encapsulating
   Synchronous Optical Network/Synchronous Digital Hierarchy (SONET/SDH)
   Path signals for transport across packet-switched networks (PSNs).
   The PSNs explicitly supported by this document include MPLS and IP.
   Note that <a href="./rfc4842">RFC 4842</a> describes the standards-track protocol for this
   functionality, and new implementations must use <a href="./rfc4842">RFC 4842</a> rather than
   this document except when interoperability with older implementations
   is desired.















<span class="grey">Malis, et al.                   Historic                        [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions Used in This Document ...............................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Scope ...........................................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. CEM Encapsulation Format ........................................<a href="#page-4">4</a>
      <a href="#section-4.1">4.1</a>. Transport Encapsulation ....................................<a href="#page-6">6</a>
           <a href="#section-4.1.1">4.1.1</a>. MPLS Transport ......................................<a href="#page-6">6</a>
           <a href="#section-4.1.2">4.1.2</a>. IP Transport ........................................<a href="#page-7">7</a>
   <a href="#section-5">5</a>. CEM Operation ...................................................<a href="#page-8">8</a>
      <a href="#section-5.1">5.1</a>. Introduction and Terminology ...............................<a href="#page-8">8</a>
           <a href="#section-5.1.1">5.1.1</a>. CEM Packetizer and De-Packetizer ....................<a href="#page-9">9</a>
           <a href="#section-5.1.2">5.1.2</a>. CEM DBA .............................................<a href="#page-9">9</a>
      <a href="#section-5.2">5.2</a>. Description of Normal CEM Operation .......................<a href="#page-10">10</a>
      <a href="#section-5.3">5.3</a>. Description of CEM Operation during DBA ...................<a href="#page-10">10</a>
      <a href="#section-5.4">5.4</a>. Packet Synchronization ....................................<a href="#page-11">11</a>
           <a href="#section-5.4.1">5.4.1</a>. Acquisition of Packet Synchronization ..............<a href="#page-11">11</a>
           <a href="#section-5.4.2">5.4.2</a>. Loss of Packet Synchronization .....................<a href="#page-11">11</a>
   <a href="#section-6">6</a>. SONET/SDH Maintenance Signals ..................................<a href="#page-12">12</a>
      <a href="#section-6.1">6.1</a>. SONET/SDH to PSN ..........................................<a href="#page-12">12</a>
           <a href="#section-6.1.1">6.1.1</a>. AIS-P Indication ...................................<a href="#page-13">13</a>
           <a href="#section-6.1.2">6.1.2</a>. STS SPE Unequipped Indication ......................<a href="#page-14">14</a>
           <a href="#section-6.1.3">6.1.3</a>. CEM-RDI ............................................<a href="#page-14">14</a>
      <a href="#section-6.2">6.2</a>. PSN to SONET/SDH ..........................................<a href="#page-15">15</a>
           <a href="#section-6.2.1">6.2.1</a>. AIS-P Indication ...................................<a href="#page-15">15</a>
           <a href="#section-6.2.2">6.2.2</a>. STS SPE Unequipped Indication ......................<a href="#page-15">15</a>
   <a href="#section-7">7</a>. Clocking Modes .................................................<a href="#page-16">16</a>
      <a href="#section-7.1">7.1</a>. Synchronous ...............................................<a href="#page-16">16</a>
           <a href="#section-7.1.1">7.1.1</a>. Synchronous Unstructured CEM .......................<a href="#page-16">16</a>
           <a href="#section-7.1.2">7.1.2</a>. Synchronous Structured CEM .........................<a href="#page-16">16</a>
      <a href="#section-7.2">7.2</a>. Asynchronous ..............................................<a href="#page-17">17</a>
   <a href="#section-8">8</a>. CEM LSP Signaling ..............................................<a href="#page-17">17</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-18">18</a>
   <a href="#section-10">10</a>. IANA Considerations ...........................................<a href="#page-18">18</a>
   <a href="#section-11">11</a>. References ....................................................<a href="#page-18">18</a>
      <a href="#section-11.1">11.1</a>. Normative References .....................................<a href="#page-18">18</a>
      <a href="#section-11.2">11.2</a>. Informative References ...................................<a href="#page-19">19</a>
   <a href="#appendix-A">Appendix A</a>. SONET/SDH Rates and Formats ...........................<a href="#page-20">20</a>
   <a href="#appendix-B">Appendix B</a>. ECC-6 Definition ......................................<a href="#page-21">21</a>












<span class="grey">Malis, et al.                   Historic                        [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   This document describes a historical method for encapsulating
   SONET/SDH Path signals for transport across packet-switched networks
   (PSNs).

   The native transmission system for circuit-oriented Time Division
   Multiplexing (TDM) signals is the Synchronous Optical Network (SONET)
   [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>]/Synchronous Digital Hierarchy (SDH) [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>].  To
   support TDM traffic (which includes voice, data, and private leased
   line services), PSNs must emulate the circuit characteristics of
   SONET/SDH payloads.  MPLS labels and a new circuit emulation header
   are used to encapsulate TDM signals and provide the Circuit Emulation
   Service over MPLS (CEM) function.  The MPLS encapsulation may be
   further encapsulated in IP for carriage across IP PSNs [<a href="./rfc4023" title='"Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)"'>RFC4023</a>].

   This document also describes an optional extension to CEM called
   Dynamic Bandwidth Allocation (DBA).  This is a method for dynamically
   reducing the bandwidth utilized by emulated SONET/SDH circuits in the
   packet network.  This bandwidth reduction is accomplished by not
   sending the SONET/SDH payload through the packet network under
   certain conditions, such as Alarm Indication Signal - Path (AIS-P) or
   Synchronous Transport Signal Synchronous Payload Envelope (STS SPE)
   Unequipped.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Scope"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Scope</span>

   This document describes how to provide CEM for the following digital
   signals:

   1. SONET STS-1 synchronous payload envelope (SPE)/SDH VC-3

   2. STS-Nc SPE (N = 3, 12, or 48)/SDH VC-4, VC-4-4c, VC-4-16c

   3. Unstructured SONET Emulation, where the entire SONET bit-stream
      (including the transport overhead) is packetized and transported
      across the PSN.

   For the remainder of this document, these constructs will be referred
   to as SONET/SDH channels.





<span class="grey">Malis, et al.                   Historic                        [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   Other SONET/SDH signals, such as virtual tributary (VT) structured
   sub-rate mapping, are not explicitly discussed in this document;
   however, it can be extended in the future to support VT and lower
   speed non-SONET/SDH services.  OC-192c SPE/VC-4-64c are also not
   included at this point, since most PSNs use OC-192c or slower trunks,
   and thus would not have sufficient capacity.  As trunk capacities
   increase in the future, the scope of this document can be accordingly
   extended.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20CEM%20Encapsulation%20Format"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  CEM Encapsulation Format</span>

   In order to transport SONET/SDH SPEs through a packet-oriented
   network, the SPE is broken into fragments.  A 32-bit CEM header is
   pre-pended to each fragment.  The Basic CEM packet appears in Figure
   1.

   +-----------------------------------+
   |            CEM Header             |
   +-----------------------------------+
   |                                   |
   |                                   |
   |        SONET/SDH SPE Fragment     |
   |                                   |
   |                                   |
   +-----------------------------------+

   Figure 1.  Basic CEM Packet

   The 32-bit CEM header has the following format:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |D|R|Rvd|   Sequence Num    | Structure Pointer |N|P|   ECC-6   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure 2.  CEM Header Format

   The above fields are defined as follows:

   D-bit: This bit signals DBA Mode.  It MUST be set to zero for normal
   operation, and it MUST be set to one if CEM is currently in DBA mode.
   DBA is an optional mode during which trivial SPEs are not transmitted
   into the packet network.  See Table 1 and sections <a href="#section-7">7</a> and <a href="#section-8">8</a> for
   further details.

      Note: for unstructured CEM, the D-bit MUST be set to zero.




<span class="grey">Malis, et al.                   Historic                        [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   R bit: CEM-RDI (Remote Defect Indicator).  This bit is set to one to
   signal to the remote CEM function that a loss of packet
   synchronization has occurred.

   Rvd: These bits are reserved for future use, and MUST be set to zero.

   Sequence Number:  This is a packet sequence number, which MUST
   continuously cycle from 0 to 1023.  It SHOULD begin at zero when a
   CEM LSP (Label Switched Path) is created.

   Structure Pointer: The Structure Pointer MUST contain the offset of
   the J1 byte within the CEM payload.  The value is from 0 to 1,022,
   where 0 means the first byte after the CEM header.  The Structure
   Pointer MUST be set to 0x3FF (1,023) if a packet does not carry the
   J1 byte.  See [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>], and [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>] for more information On
   the J1 byte and the SONET/SDH payload pointer.

      Note: for unstructured CEM, the Structure Pointer field MUST be
      set to 0x3FF.

   The N and P bits: These bits indicate negative and positive pointer
   adjustment events.  They are also used to relay SONET/SDH maintenance
   signals, such as AIS-P.  See Table 1 and sections <a href="#section-7">7</a> and <a href="#section-8">8</a> for more
   details.

      Note: for unstructured CEM, the N and P bits MUST both be set to
      zero.

   +---+---+---+----------------------------------------------+
   | D | N | P |         Interpretation                       |
   +---+---+---+-------------+--------------------------------+
   | 0 | 0 | 0 | Normal Mode | No Ptr Adjustment              |
   | 0 | 0 | 1 | Normal Mode | Positive Ptr Adjustment        |
   | 0 | 1 | 0 | Normal Mode | Negative Ptr Adjustment        |
   | 0 | 1 | 1 | Normal Mode | AIS-P                          |
   |   |   |   |             |                                |
   | 1 | 0 | 0 | DBA Mode    | STS SPE Unequipped             |
   | 1 | 0 | 1 | DBA Mode    | STS SPE Unequipped Pos Ptr Adj |
   | 1 | 1 | 0 | DBA Mode    | STS SPE Unequipped Neg Ptr Adj |
   | 1 | 1 | 1 | DBA Mode    | AIS-P                          |
   +---+---+---+-------------+--------------------------------+

   Table 1.  Interpretation of D, N, and P bits








<span class="grey">Malis, et al.                   Historic                        [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   ECC-6: An Error Correction Code to protect the CEM header.  This
   offers the ability to correct single bit errors and detect up to two
   bit errors.  The ECC algorithm is described in <a href="#appendix-B">Appendix B</a>.  The ECC-6
   can be optionally disabled at provisioning time.  If the ECC-6 is not
   utilized, it MUST be set to zero.

      Note: Normal CEM packets are fixed in length for all of the
      packets of a particular emulated TDM stream.  This length is
      signaled using the CEM Payload Bytes parameter defined in
      [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>], or is statically provisioned for each TDM stream.
      Therefore, the length of each CEM packet does not need to be
      carried in the CEM header.

      Note: Setting the D-bit to 0 and the R bit to 1 violates the Best
      Current Practice defined in [<a href="./rfc4928" title='"Avoiding Equal Cost Multipath Treatment in MPLS Networks"'>RFC4928</a>] when operating on MPLS
      networks.  In this situation, MPLS networks could mistake a CEM
      payload as the first nibble of an IPv4 packet, potentially causing
      mis-ordering of packets on the pseudowire in the presence of IP
      Equal Cost Multi-Path (ECMP) in the MPLS network.  The use of this
      CEM header preceded the use of MPLS ECMP.  As stated earlier,
      [<a href="./rfc4842" title='"Synchronous Optical Network/Synchronous Digital Hierarchy (SONET/SDH) Circuit Emulation over Packet (CEP)"'>RFC4842</a>] describes the standards-track protocol for this
      functionality, and it does not share this violation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Transport%20Encapsulation"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Transport Encapsulation</span>

   In principle, CEM packets can be transported over any packet-oriented
   network.  The following sections describe specifically how CEM
   packets MUST be encapsulated for transport over MPLS or IP networks.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.1.%20%20MPLS%20Transport"></a><a class="selflink" href="#section-4.1.1" id="section-4.1.1">4.1.1</a>.  MPLS Transport</span>

   To transport a CEM packet over an MPLS network, an MPLS label stack
   MUST be pushed on top of the CEM packet.

   The last two labels prior to the CEM header are referred to as the
   Tunnel and Virtual Circuit (VC) labels.

   The VC label is required, and is the last label prior to the CEM
   Header.  The VC label MUST be used to identify the CEM connection
   within the MPLS tunnel.

   The optional tunnel label is immediately above the VC label on the
   label stack.  If present, the tunnel label MUST be used to identify
   the MPLS LSP used to tunnel the TDM packets through the MPLS network
   (the tunnel LSP).

   This is similar to the label stack usage defined in [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>].




<span class="grey">Malis, et al.                   Historic                        [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   +-----------------------------------+
   | Additional MPLS Labels (Optional) |
   +-----------------------------------+
   |       Tunnel Label (Optional)     |
   +-----------------------------------+
   |             VC Label              |
   +-----------------------------------+
   |            CEM Header             |
   +-----------------------------------+
   |                                   |
   |                                   |
   |       SONET/SDH SPE Fragment      |
   |                                   |
   |                                   |
   +-----------------------------------+

   Figure 3.  Typical MPLS Transport Encapsulation

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.2.%20%20IP%20Transport"></a><a class="selflink" href="#section-4.1.2" id="section-4.1.2">4.1.2</a>.  IP Transport</span>

   It is highly desirable to define a single encapsulation format that
   will work for both IP and MPLS.  Furthermore, it is desirable that
   the encapsulation mechanism be as efficient as possible.

   One way to achieve these goals is to map CEM directly onto IP by
   mapping the previously described MPLS packets onto IP.

   A mechanism for carrying MPLS over IP is described in [<a href="./rfc4023" title='"Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)"'>RFC4023</a>].

   Using this encapsulation scheme would result in the packet format
   illustrated in Figure 4.




















<span class="grey">Malis, et al.                   Historic                        [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   +-----------------------------------+
   |                                   |
   |    IPv6/v4 Header [<a href="./rfc4023" title='"Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)"'>RFC4023</a>]       |
   |                                   |
   +-----------------------------------+
   |      Tunnel Label (Optional)      |
   +-----------------------------------+
   |             VC Label              |
   +-----------------------------------+
   |            CEM Header             |
   +-----------------------------------+
   |                                   |
   |                                   |
   |       SONET/SDH SPE Fragment      |
   |                                   |
   |                                   |
   +-----------------------------------+

   Figure 4.  MPLS Transport Encapsulation

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20CEM%20Operation"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  CEM Operation</span>

   The following sections describe CEM operation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20Introduction%20and%20Terminology"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Introduction and Terminology</span>

   There are two types of CEM: structured and unstructured.

   Unstructured CEM packetizes the entire SONET/SDH bit-stream
   (including transport overhead).

   Structured CEM terminates the transport overhead and packetizes
   individual channels (STS-1/Nc) within the SONET/SDH frame.  Because
   structured CEM terminates the transport overhead, structured CEM
   implementations SHOULD meet the generic requirements for SONET/SDH
   Line Terminating Equipment as defined in [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>], and
   [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>].

   Implementations MUST support structured CEM and MAY support
   unstructured CEM.

   Structured CEM MUST support a normal mode of operation and MAY
   support an optional extension called Dynamic Bandwidth Allocation
   (DBA).  During normal operation, SONET/SDH payloads are fragmented,
   pre-pended with the CEM header, the VC label, and the PSN header, and






<span class="grey">Malis, et al.                   Historic                        [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   then transmitted into the packet network.  During DBA mode, only the
   CEM header, the VC label, and PSN header are transmitted.  This is
   done to conserve bandwidth when meaningful user data is not present
   in the SPE, such as during AIS-P or STS SPE Unequipped.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.1.%20%20CEM%20Packetizer%20and%20De-Packetizer"></a><a class="selflink" href="#section-5.1.1" id="section-5.1.1">5.1.1</a>.  CEM Packetizer and De-Packetizer</span>

   As with all adaptation functions, CEM has two distinct components:
   adapting TDM SONET/SDH into a CEM packet stream, and converting the
   CEM packet stream back into a TDM SONET/SDH.  The first function will
   be referred to as CEM packetizer and the second as CEM de-packetizer.
   This terminology is illustrated in Figure 5.

             +------------+              +---------------+
             |            |              |               |
   SONET --&gt; |    CEM     | --&gt; PSN  --&gt; |      CEM      | --&gt; SONET
    SDH      | Packetizer |              | De-Packetizer |      SDH
             |            |              |               |
             +------------+              +---------------+

   Figure 5.  CEM Terminology

   Note: the CEM de-packetizer requires a buffering mechanism to account
   for delay variation in the CEM packet stream.  This buffering
   mechanism will be generically referred to as the CEM jitter buffer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.2.%20%20CEM%20DBA"></a><a class="selflink" href="#section-5.1.2" id="section-5.1.2">5.1.2</a>.  CEM DBA</span>

   DBA is an optional mode of operation for structured CEM that only
   transmits the CEM header, the VC label, and PSN header into the
   packet network under certain circumstances, such as AIS-P or STS SPE
   Unequipped.

   If DBA is supported by a CEM implementation, the user SHOULD be able
   to configure if DBA will be triggered by AIS-P, STS SPE Unequipped,
   both, or neither on a per channel basis.

   If DBA is supported, the determination of AIS-P and STS SPE
   Unequipped MUST be based on the state of SONET/SDH Section, Line, and
   Path Overhead bytes.  DBA based on pattern detection within the SPE
   (i.e., all zeros, 7Es, or ATM idle cells) is for further study.

   During AIS-P, there is no valid payload pointer, so pointer
   adjustments cannot occur.  During STS SPE Unequipped, the SONET/SDH
   payload pointer is valid, and therefore pointer adjustments MUST be
   supported even during DBA.  See Table 1 for details.





<span class="grey">Malis, et al.                   Historic                        [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20Description%20of%20Normal%20CEM%20Operation"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  Description of Normal CEM Operation</span>

   During normal operation, the CEM packetizer will receive a fixed rate
   byte stream from a SONET/SDH interface.  When a packet's worth of
   data has been received from a SONET/SDH channel, the CEM header, the
   VC Label, and PSN header are pre-pended to the SPE fragment and the
   resulting CEM packet is transmitted into the packet network.  Because
   all normal CEM packets associated with a specific SONET/SDH channel
   will have the same length, the transmission of CEM packets for that
   channel SHOULD occur at regular intervals.

   At the far-end of the packet network, the CEM de-packetizer will
   receive packets into a jitter buffer and then play out the received
   byte stream at a fixed rate onto the corresponding SONET/SDH channel.
   The jitter buffer SHOULD be adjustable in length to account for
   varying network delay behavior.  The received packet rate from the
   packet network should be exactly balanced by the transmission rate
   onto the SONET/SDH channel, on average.  The time over which this
   average is taken corresponds to the depth of the jitter buffer for a
   specific CEM channel.

   The CEM sequence numbers provide a mechanism to detect lost and/or
   mis-ordered packets.  The CEM de-packetizer MUST detect lost or
   mis-ordered packets.  The CEM de-packetizer MUST play out a
   programmable byte pattern in place of any dropped packets.  The CEM
   de-packetizer MAY re-order packets received out of order.  If the CEM
   de-packetizer does not support re-ordering, it MUST drop mis-ordered
   packets.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20Description%20of%20CEM%20Operation%20during%20DBA"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  Description of CEM Operation during DBA</span>

   (Note: DBA is only applicable to structured CEM.)

   There are several issues that should be addressed by a workable CEM
   DBA mechanism.  First, when DBA is invoked, there should be a
   substantial savings in bandwidth utilization in the packet network.
   The second issue is that the transition in and out of DBA should be
   tightly coordinated between the local CEM packetizer and CEM
   de-packetizer at the far side of the packet network.  A third is that
   the transition in and out of DBA should be accomplished with minimal
   disruption to the adapted data stream.

   Another goal is that the reduction of CEM traffic due to DBA should
   not be mistaken for a fault in the packet network or vice-versa.
   Finally, the implementation of DBA should require minimal
   modifications beyond what is necessary for the nominal CEM case.  The
   mechanism described below is a reasonable balance of these goals.




<span class="grey">Malis, et al.                   Historic                       [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   During DBA, packets MUST be emitted at exactly the same rate as they
   would be during normal operation.  This SHOULD be accomplished by
   transmitting each DBA packet after a complete packet of data has been
   received from the SONET/SDH channel.  The only change from normal
   operation is that the CEM packets during DBA MUST only carry the CEM
   header, the VC label, and the PSN header.

   Because some links have a minimum supported packet size, the CEM
   packetizer MAY append a configurable number of bytes immediately
   after the CEM header to pad out the CEM packet to reach the minimum
   supported packet size.  The value of the padding bytes is
   implementation specific.  The D-bit MUST be set to one, to indicate
   that DBA is active.

   The CEM de-packetizer MUST assume that each packet received with the
   D-bit set represents a normal-sized packet containing an AIS-P or STS
   SPE Unequipped payload as noted by N and P, (see Table 1).  The CEM
   de-packetizer MUST accept DBA packets with or without padding.

   This allows the CEM packetization and de-packetization logic during
   DBA to be similar to the nominal case.  It insures that the correct
   SONET/SDH indication is reliably transmitted between CEM adaptation
   points.  It minimizes the risk of under or over running the jitter
   buffer during the transition in and out of DBA.  And, it guarantees
   that faults in the packet network are recognized as distinctly
   different from line conditioning on the SONET/SDH interfaces.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.%20%20Packet%20Synchronization"></a><a class="selflink" href="#section-5.4" id="section-5.4">5.4</a>.  Packet Synchronization</span>

   A key component in declaring the state of a CEM service is whether or
   not the CEM de-packetizer is in or out of packet synchronization.
   The following paragraphs describe how that determination is made.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.1.%20%20Acquisition%20of%20Packet%20Synchronization"></a><a class="selflink" href="#section-5.4.1" id="section-5.4.1">5.4.1</a>.  Acquisition of Packet Synchronization</span>

   At startup, a CEM de-packetizer will be out of packet synchronization
   by default.  To declare packet synchronization at startup or after a
   loss of packet synchronization, the CEM de-packetizer must receive a
   configurable number of CEM packets with sequential sequence numbers.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.2.%20%20Loss%20of%20Packet%20Synchronization"></a><a class="selflink" href="#section-5.4.2" id="section-5.4.2">5.4.2</a>.  Loss of Packet Synchronization</span>

   Once a CEM de-packetizer is in packet sync, it may encounter a set of
   events that will cause it to lose packet synchronization.

   As discussed in <a href="#section-5.2">section 5.2</a>, a CEM de-packetizer MAY support the
   re-ordering of mis-ordered packets.




<span class="grey">Malis, et al.                   Historic                       [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   If a CEM de-packetizer supports re-ordering, then the determination
   that packet synchronization has been lost cannot be made at the time
   the packets are received from the PSN.  Instead, the determination
   MUST be made as the packets are being played out onto the SONET/SDH
   interface.  This is because it is only at play-out time that the
   determination can be made as to whether the entire emulated SONET/SDH
   stream was received from the PSN.

   If a CEM de-packetizer does not support re-ordering, a number of
   approaches may be used to minimize the impact of mis-ordered or lost
   packets on the final re-assembled SONET/SDH stream.  For example, ATM
   Adaptation Layer 1 (AAL1) [<a href="#ref-I.363.1" title='"Recommendation I.363.1, B-ISDN Adaptation Layer Specification: Type AAL1"'>I.363.1</a>] uses a simple state-machine to
   re-order packets in a subset of possible cases.  The algorithm for
   these state-machines is outside of the scope of CEM.  However, the
   final determination as to whether or not to declare loss of packet
   synchronization MUST be based on the same criteria as for
   implementations that do support re-ordering.

   Whether or not a CEM implementation supports re-ordering, the
   declaration of loss of packet synchronization MUST be based on the
   following criteria.

   As packets are played out towards the SONET/SDH interface, the CEM
   de-packetizer will encounter empty packets in the place of packets
   that were dropped by the PSN, or effectively dropped due to
   limitations of the CEM implementation.  If the CEM de-packetizer
   encounters more than a configurable number of sequential dropped
   packets, the CEM de-packetizer MUST declare loss of packet
   synchronization.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20SONET%2FSDH%20Maintenance%20Signals"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  SONET/SDH Maintenance Signals</span>

   There are several issues that must be considered in the mapping of
   maintenance signals between SONET/SDH and a PSN.  A description of
   how these signals and conditions are mapped between the two domains
   is given below.

   For clarity, the mappings are split into two groups: SONET/SDH to PSN
   and PSN to SONET/SDH.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20SONET%2FSDH%20to%20PSN"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  SONET/SDH to PSN</span>

   The following sections describe how SONET/SDH Maintenance Signals and
   Alarm conditions are mapped into a Packet-Switched Network.







<span class="grey">Malis, et al.                   Historic                       [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.1.%20%20AIS-P%20Indication"></a><a class="selflink" href="#section-6.1.1" id="section-6.1.1">6.1.1</a>.  AIS-P Indication</span>

   In a SONET/SDH network, SONET/SDH Path outages are signaled using
   maintenance alarms, such as Path AIS (AIS-P).  In particular, AIS-P
   indicates that the SONET/SDH Path is not currently transmitting valid
   end-user data, and the SPE contains all ones.

   It should be noted that for structured CEM, nearly every type of
   service-effecting section or line defect will result in an AIS-P
   condition.

   The SONET/SDH hierarchy is illustrated below.

                              +----------+
                              |   PATH   |
                              +----------+
                                   ^
                                   |
                                 AIS-P
                                   |
                                   |
                              +----------+
                              |   LINE   |
                              + ---------+
                                 ^     ^
                                 |     |
                               AIS-L   +------ LOP
                                 |
                                 |
                              +----------+
                              | SECTION  |
                              +----------+
                                 ^    ^
                                 |    |
                                 |    |
                                LOS  LOF

                    Figure 6.  SONET/SDH Fault Hierarchy

   Should the Section Layer detect a Loss of Signal (LOS) or Loss of
   Frame (LOF) condition, it sends AIS-L up to the Line Layer.  If the
   Line Layer detects AIS-L or Loss of Path (LOP), it sends AIS-P to the
   Path Layer.

   In normal mode during AIS-P, structured CEM packets are generated as
   usual.  The N and P bits MUST be set to 11 binary to signal AIS-P
   explicitly through the packet network.  The D-bit MUST be set to zero




<span class="grey">Malis, et al.                   Historic                       [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   to indicate that the SPE is being carried through the packet network.
   Normal CEM packets with the SPE fragment, CEM header, the VC label,
   and PSN header MUST be transmitted into the packet network.

   However, to conserve network bandwidth during AIS-P, DBA MAY be
   employed.  If DBA has been enabled for AIS-P and AIS-P is currently
   occurring, the N and P bits MUST be set to 11 binary to signal AIS,
   and the D-bit MUST be set to one to indicate that the SPE is not
   being carried through the packet network.  Only the CEM header, the
   VC label, and the PSN header MUST be transmitted into the packet
   network.

   Also note that this differs from the outage mechanism in [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>],
   which withdraws the VC label as a result of an endpoint outage.  TDM
   circuit emulation requires the ability to distinguish between the
   de-provisioning of a circuit (which causes the VC label to be
   withdrawn), and temporary outages (which are signaled using AIS-P).

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.2.%20%20STS%20SPE%20Unequipped%20Indication"></a><a class="selflink" href="#section-6.1.2" id="section-6.1.2">6.1.2</a>.  STS SPE Unequipped Indication</span>

   The STS SPE Unequipped Indication is a slightly different case than
   AIS-P.  When byte C2 of the Path Overhead (STS path signal label) is
   00h and Byte B3 (STS Path BIP-8) is valid, it indicates that the STS
   SPE is unequipped.  Note: this is typically signaled by setting the
   entire SPE to zeros.

   For normal structured CEM operation during STS SPE Unequipped, the N
   and P bits MUST be interpreted as usual.  The SPE MUST be transmitted
   into the packet network along with the CEM header, the VC label, and
   PSN header, and the D-Bit MUST be set to zero.

   If DBA has been enabled for STS SPE Unequipped and the Unequipped
   condition is occurring on the SONET/SDH channel, the D-bit MUST be
   set to one to indicate DBA is active.  Only the CEM header, the VC
   Label, and PSN header MUST be transmitted into the packet network.
   The N and P bits MUST be used to signal pointer adjustments as
   normal.  See Table 1 and <a href="#section-8">section 8</a> for details.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.3.%20%20CEM-RDI"></a><a class="selflink" href="#section-6.1.3" id="section-6.1.3">6.1.3</a>.  CEM-RDI</span>

   The CEM function MUST send CEM-RDI towards the packet network during
   loss of packet synchronization.  This MUST be accomplished by setting
   the R bit to one in the CEM header.  This applies for both structured
   and unstructured CEM.







<span class="grey">Malis, et al.                   Historic                       [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20PSN%20to%20SONET%2FSDH"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  PSN to SONET/SDH</span>

   The following sections discuss how the various conditions on the
   packet network are converted into SONET/SDH indications.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.1.%20%20AIS-P%20Indication"></a><a class="selflink" href="#section-6.2.1" id="section-6.2.1">6.2.1</a>.  AIS-P Indication</span>

   There are several conditions in the packet network that will cause
   the structured CEM de-packetization function to send an AIS-P
   indication onto a SONET/SDH channel.

   The first of these is the receipt of structured CEM packets with the
   N and P bits set to one, and the D-bit set to zero.  This is an
   explicit indication of AIS-P being received at the far-end of the
   packet network, with DBA disabled for AIS-P.  The CEM de-packetizer
   MUST play out the received SPE fragment (which will incidentally be
   carrying all ones), and MUST configure the SONET/SDH Overhead to
   signal AIS-P as defined in [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>], and [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>].

   The second case is the receipt of structured CEM packets with the N
   and P bits set to one, and the D-bit set to one.  This is an explicit
   indication of AIS-P being received at the far-end of the packet
   network, with DBA enabled for AIS-P.  The CEM de-packetizer MUST play
   out one packet's worth of all ones for each packet received, and MUST
   configure the SONET/SDH Overhead to signal AIS-P as defined in
   [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>], and [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>].

   A third case that will cause a structured CEM de-packetization
   function to send an AIS-P indication onto a SONET/SDH channel is loss
   of packet synchronization.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.2.%20%20STS%20SPE%20Unequipped%20Indication"></a><a class="selflink" href="#section-6.2.2" id="section-6.2.2">6.2.2</a>.  STS SPE Unequipped Indication</span>

   There are three conditions in the packet network that will cause the
   CEM function to transmit STS SPE Unequipped Indications onto the
   SONET/SDH channel.

   The first, which is transparent to CEM, is the receipt of regular CEM
   packets that happen to be carrying an SPE that contains the
   appropriate Path Overhead to signal STS SPE Unequipped.  This case
   does not require any special processing on the part of the CEM
   de-packetizer.

   The second case is the receipt of structured CEM packets that have
   the D-bit set to one to indicate that DBA is active and the N and P
   bits set to 00 binary, 01 binary, or 10 binary to indicate STS SPE





<span class="grey">Malis, et al.                   Historic                       [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   Unequipped with or without pointer adjustments.  The CEM
   de-packetizer MUST use this information to transmit a packet of all
   zeros onto the SONET/SDH interface, and adjust the payload pointer as
   necessary.

   The third case when a structured CEM de-packetizer MUST send an STS
   SPE Unequipped Indication towards the SONET/SDH interface is when the
   VC-label has been withdrawn due to de-provisioning of the circuit.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Clocking%20Modes"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Clocking Modes</span>

   It is necessary to be able to regenerate the input service clock at
   the output interface.  Two clocking modes are supported: synchronous
   and asynchronous.  Selection of the clocking mode is made as part of
   service provisioning.  Both ends of the emulated circuit must be
   configured with the same clocking mode.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Synchronous"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Synchronous</span>

   When synchronous SONET/SDH timing is available at both ends of the
   circuit, the issue of clock recovery becomes much simpler.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.1.%20%20Synchronous%20Unstructured%20CEM"></a><a class="selflink" href="#section-7.1.1" id="section-7.1.1">7.1.1</a>.  Synchronous Unstructured CEM</span>

   For unstructured CEM, the external clock is used to clock each bit
   onto the optical carrier.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.2.%20%20Synchronous%20Structured%20CEM"></a><a class="selflink" href="#section-7.1.2" id="section-7.1.2">7.1.2</a>.  Synchronous Structured CEM</span>

   For structured CEM, the external clock is used to clock the SONET/SDH
   carrier.  The N and P bits are used to signal negative or positive
   pointer adjustment events between structured CEM endpoints.

   If there is a frequency offset between the frame rate of the
   transport overhead and that of the SONET/SDH SPE, then the alignment
   of the SPE shall periodically slip back or advance in time through
   positive or negative stuffing.  The N and P bits are used to replay
   the pointer adjustment events and eliminate transport jitter.

   During a negative pointer adjustment event, the H3 byte from the
   SONET/SDH stream is incorporated into the CEM packet payload in order
   with the rest of the SPE.  During a positive pointer adjustment
   event, the stuff byte is not included in the CEM packet payload.

   The pointer adjustment event MUST be transmitted in three consecutive
   packets by the packetizer.  The de-packetizer MUST play out the
   pointer adjustment event when the first packet of the three with the
   N/P bits set is received.



<span class="grey">Malis, et al.                   Historic                       [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   The CEM de-packetizer MUST utilize the CEM sequence numbers to insure
   that SONET/SDH pointer adjustment events are not played any more
   frequently than once per every three CEM packets transmitted by the
   remote CEM packetizer.

   References [<a href="#ref-T1.105" title='"Synchronous Optical Network (SONET) - Basic Description including Multiplex Structure, Rates and Formats,"'>T1.105</a>], [<a href="#ref-G.707" title='"Network Node Interface For The Synchronous Digital Hierarchy"'>G.707</a>], and [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>] specify that pointer
   adjustment events MUST be separated by three SONET/SDH frames without
   a pointer adjustment event.  In order to relay all legal pointer
   adjustment events, the packet size for a specific circuit MUST be no
   larger than (783 * 4 * N)/3, where N is the STS-Nc multiplier.

   However, some SONET/SDH equipment allows pointer adjustments to occur
   in back-to-back SONET/SDH frames.  In order to support this
   possibility, the packet size for a particular circuit SHOULD be no
   larger than (783*N)/3, where N is the STS-Nc multiplier.

   Since the minimum value of N is one, CEM implementations SHOULD
   support a minimum payload length of 783/3 or 261 bytes.  Smaller
   payload lengths MAY be supported as an option.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20Asynchronous"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Asynchronous</span>

   If synchronous timing is not available, other methods MAY be employed
   to regenerate the circuit timing.

   For structured CEM, the CEM packetizer SHOULD generate the N and P
   bits as usual.  However, without external synchronization, this
   information is not sufficient to reliably justify the SPE within the
   SONET/SDH transport framing at the CEM de-packetizer.  The
   de-packetizer MAY employ an adaptive algorithm to introduce pointer
   adjustment events to map the CEM SPE to the SONET/SDH transport
   framing.  Regardless of whether the N and P bits are used by the
   de-packetizer as part of the adaptive clock recovery algorithm, they
   MUST still be used in conjunction with the D-bit to signal AIS-P, STS
   SPE Unequipped, and DBA.

   For unstructured CEM, the CEM de-packetizer MAY use an adaptive clock
   recovery technique to regenerate the SONET/SDH transport clock.

   An example adaptive clock recovery method can be found in <a href="#section-3.4.2">section</a>
   <a href="#section-3.4.2">3.4.2</a> of [<a href="#ref-VTOA" title='"Circuit Emulation Service Interoperability Specification Version 2.0"'>VTOA</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20CEM%20LSP%20Signaling"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  CEM LSP Signaling</span>

   For maximum network scaling in MPLS applications, CEM LSP signaling
   may be performed using the Label Distribution Protocol (LDP) Extended
   Discovery mechanism as augmented by the Pseudo-Wire id Forward Error
   Correction (PWid FEC) Element defined in [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>].  MPLS traffic



<span class="grey">Malis, et al.                   Historic                       [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   tunnels may be dedicated to CEM, or shared with other MPLS-based
   services.  The value 0x8008 is used for the PWE3 PW Type in the PWid
   FEC Element in order to signify that the LSP being signaled is to
   carry CEM.  Note that the generic control word defined in [<a href="#ref-GR-253" title='"Synchronous Optical Network (SONET) Transport Systems: Common Generic Criteria"'>GR-253</a>] is
   not used, as its functionality is included in the CEM encapsulation
   header.

   Alternatively, static label assignment may be used, or a dedicated
   traffic engineered LSP may be used for each CEM service.

   Normal CEM packets are fixed in length for all of the packets of a
   particular emulated TDM stream.  This length is signaled using the
   CEM Payload Bytes parameter defined in [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>], or it is statically
   provisioned for each CEM service.

   At this time, other aspects of the CEM service MUST be statically
   provisioned.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Security Considerations</span>

   The CEM encapsulation is subject to all of the general security
   considerations discussed in [<a href="./rfc3985" title='"Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture"'>RFC3985</a>] and [<a href="./rfc4447" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>].  In addition,
   this document specifies only encapsulations, and not the protocols
   used to carry the encapsulated packets across the PSN.  Each such
   protocol may have its own set of security issues, but those issues
   are not affected by the encapsulations specified herein.  Note that
   the security of the transported CEM service will only be as good as
   the security of the PSN.  This level of security may be less rigorous
   then that available from a native TDM service due to the inherent
   differences between circuit-switched and packet-switched public
   networks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  IANA Considerations</span>

   IANA has already allocated the PWE3 PW Type value 0x0008 for this
   specification.  No further actions are required.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20References"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" id="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-G.707">G.707</a>]     ITU Recommendation G.707, "Network Node Interface For The
               Synchronous Digital Hierarchy", 1996.

   [<a id="ref-GR-253">GR-253</a>]    Telcordia Technologies, "Synchronous Optical Network
               (SONET) Transport Systems: Common Generic Criteria", GR-
               253-CORE, Issue 3, September 2000.




<span class="grey">Malis, et al.                   Historic                       [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   [<a id="ref-I.363.1">I.363.1</a>]   ITU-T, "Recommendation I.363.1, B-ISDN Adaptation Layer
               Specification: Type AAL1", <a href="#appendix-I">Appendix I</a>II, August 1996.

   [<a id="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC4023">RFC4023</a>]   Worster, T., Rekhter, Y., and E. Rosen, Ed.,
               "Encapsulating MPLS in IP or Generic Routing
               Encapsulation (GRE)", <a href="./rfc4023">RFC 4023</a>, March 2005.

   [<a id="ref-RFC4447">RFC4447</a>]   Martini, L., Ed., Rosen, E., El-Aawar, N., Smith, T., and
               G. Heron, "Pseudowire Setup and Maintenance Using the
               Label Distribution Protocol (LDP)", <a href="./rfc4447">RFC 4447</a>, April 2006.

   [<a id="ref-RFC4842">RFC4842</a>]   Malis, A., Pate, P., Cohen, R., Ed., and D. Zelig,
               "Synchronous Optical Network/Synchronous Digital
               Hierarchy (SONET/SDH) Circuit Emulation over Packet
               (CEP)", <a href="./rfc4842">RFC 4842</a>, April 2007.

   [<a id="ref-RFC4928">RFC4928</a>]   Swallow, G., Bryant, S., and L. Andersson, "Avoiding
               Equal Cost Multipath Treatment in MPLS Networks", <a href="https://www.rfc-editor.org/bcp/bcp128">BCP</a>
               <a href="https://www.rfc-editor.org/bcp/bcp128">128</a>, <a href="./rfc4928">RFC 4928</a>, June 2007.

   [<a id="ref-T1.105">T1.105</a>]    American National Standards Institute, "Synchronous
               Optical Network (SONET) - Basic Description including
               Multiplex Structure, Rates and Formats," ANSI T1.105-
               1995.

   [<a id="ref-VTOA">VTOA</a>]      ATM Forum, "Circuit Emulation Service Interoperability
               Specification Version 2.0", af-vtoa-0078.000, January
               1997.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" id="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-RFC3985">RFC3985</a>]   Bryant, S., Ed., and P. Pate, Ed., "Pseudo Wire Emulation
               Edge-to-Edge (PWE3) Architecture", <a href="./rfc3985">RFC 3985</a>, March 2005.















<span class="grey">Malis, et al.                   Historic                       [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20SONET%2FSDH%20Rates%20and%20Formats"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  SONET/SDH Rates and Formats</span>

   For simplicity, the discussion in this section uses SONET
   terminology, but it applies equally to SDH as well.  SDH-equivalent
   terminology is shown in the tables.

   The basic SONET modular signal is the synchronous transport
   signal-level 1 (STS-1).  A number of STS-1s may be multiplexed into
   higher-level signals denoted as STS-N, with N synchronous payload
   envelopes (SPEs).  The optical counterpart of the STS-N is the
   Optical Carrier-level N, or OC-N.  Table 2 lists standard SONET line
   rates discussed in this document.

   OC Level          OC-1    OC-3    OC-12      OC-48     OC-192
   SDH Term             -   STM-1    STM-4     STM-16     STM-64
   Line Rate(Mb/s) 51.840 155.520  622.080  2,488.320  9,953.280

   Table 2.  Standard SONET Line Rates

   Each SONET frame is 125 us and consists of nine rows.  An STS-N frame
   has nine rows and N*90 columns.  Of the N*90 columns, the first N*3
   columns are transport overhead and the other N*87 columns are SPEs.
   A number of STS-1s may also be linked together to form a super-rate
   signal with only one SPE.  The optical super-rate signal is denoted
   as OC-Nc, which has a higher payload capacity than OC-N.

   The first 9-byte column of each SPE is the Path Overhead (POH) and
   the remaining columns form the payload capacity with fixed stuff
   (STS-Nc only).  The fixed stuff, which is purely overhead, is N/3-1
   columns for STS-Nc.  Thus, STS-1 and STS-3c do not have any fixed
   stuff, STS-12c has three columns of fixed stuff, and so on.

   The POH of an STS-1 or STS-Nc is always nine bytes in nine rows.  The
   payload capacity of an STS-1 is 86 columns (774 bytes) per frame.
   The payload capacity of an STS-Nc is (N*87)-(N/3) columns per frame.
   Thus, the payload capacity of an STS-3c is (3*87 - 1)*9 = 2,340 bytes
   per frame.  As another example, the payload capacity of an STS-192c
   is 149,760 bytes, which is exactly 64 times larger than the STS-3c.

   There are 8,000 SONET frames per second.  Therefore, the SPE size,
   (POH plus payload capacity) of an STS-1 is 783*8*8,000 = 50.112 Mb/s.
   The SPE size of a concatenated STS-3c is 2,349 bytes per frame or
   150.336 Mb/s.  The payload capacity of an STS-192c is 149,760 bytes
   per frame, which is equivalent to 9,584.640 Mb/s.  Table 3 lists the
   SPE and payload rates supported.






<span class="grey">Malis, et al.                   Historic                       [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   SONET STS Level     STS-1   STS-3c  STS-12c    STS-48c   STS-192c
   SDH VC Level            -     VC-4  VC-4-4c   VC-4-16c   VC-4-64c
   Payload Size(Bytes)   774    2,340    9,360     37,440    149,760
   Payload Rate(Mb/s) 49.536  149.760  599.040  2,396.160  9,584.640
   SPE Size(Bytes)       783    2,349    9,396     37,584    150,336
   SPE Rate(Mb/s)     50.112  150.336  601.344  2,405.376  9,621.504

   Table 3.  Payload Size and Rate

   To support circuit emulation, the entire SPE of a SONET STS or SDH VC
   level is encapsulated into packets, using the encapsulation defined
   in <a href="#section-5">section 5</a>, for carriage across packet-switched networks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20%20ECC-6%20Definition"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  ECC-6 Definition</span>

   ECC-6 is an Error Correction Code to protect the CEM header.  This
   provides single bit correction and the ability to detect up to two
   bit errors.

   Error Correction Code:

   |---------------Header bits 0-25 -------------------| ECC-6 code|
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |1 1 1 1 1 0 0 0 1 0 0 0 1 1 1 1 1 0 1 0 0 0 1 0 1 1|1 0 0 0 0 0|
   |1 1 1 1 0 1 0 0 0 1 0 0 1 0 0 0 0 1 0 1 1 1 1 1 1 1|0 1 0 0 0 0|
   |1 0 0 0 1 1 1 1 0 0 1 0 1 1 1 0 0 0 1 1 1 1 0 0 1 1|0 0 1 0 0 0|
   |0 1 0 0 1 1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 0 0 1 1 0 1|0 0 0 1 0 0|
   |0 0 1 0 0 0 1 0 1 1 1 1 1 1 0 0 1 1 1 1 1 0 1 0 1 0|0 0 0 0 1 0|
   |0 0 0 1 0 0 0 1 1 1 1 1 0 0 1 1 0 0 1 1 0 1 1 1 1 1|0 0 0 0 0 1|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure 7.  ECC-6 Check Matrix X

   The ECC-6 code protects the 32-bit CEM header as follows:

   The encoder generates the 6-bit ECC using the matrix shown in Figure
   7.  In brief, the encoder builds another 26 column by 6 row matrix
   and calculates even parity over the rows.  The matrix columns
   represent CEM header bits 0 through 25.

   Denote each column of the ECC-6 check matrix by X[], and each column
   of the intermediate encoder matrix as Y[].  CEM[] denotes the CEM
   header and ECC[] is the error correction code that is inserted into
   CEM header bits 26 through 31.





<span class="grey">Malis, et al.                   Historic                       [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


   for i = 0 to 25 {
        if CEM[i] = 0 {
                Y[i] = 0;
        } else {
                Y[i] = X[i];
        }
   }

   In other words, for each CEM header bit (i) set to one, set the
   resulting matrix column Y[i] according to Figure 7.

   The final ECC-6 code is calculated as even parity of each row in Y
   (i.e., ECC[k]=CEM[25+k]=even parity of row k).

   The receiver also uses matrix X to calculate an intermediate matrix
   Y' based on all 32 bits of the CEM header.  Therefore, Y' is 32
   columns wide and includes the ECC-6 code.

   for i = 0 to 31 {
        if CEM[i] = 0 {
                Y'[i] = 0;
        } else {
                Y'[i] = X[i];
        }
   }

   The receiver then appends the incoming ECC-6 code to Y as column 32
   (ECC[0] should align with row 0) and calculates even parity for each
   row.  The result is a single 6-bit column Z.  If all 6 bits are 0,
   there are no bit errors (or at least no detectable errors).
   Otherwise, it uses Z to perform a reverse lookup on X[] from Figure
   7.  If Z matches column X[i], then there is a single bit error.  The
   receiver should invert bit CEM[i] to correct the header.  If Z fails
   to match any column of X, then the CEM header contains more than one
   bit error and the CEM packet MUST be discarded.

   Note that the ECC-6 code provides single-bit correction and 2-bit
   detection of errors within the received ECC-6 code itself.













<span class="grey">Malis, et al.                   Historic                       [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


Acknowledgments

   The authors would like to thank Mitri Halabi, Bob Colvin, and Ken
   Hsu, all formerly of Vivace Networks and Tellabs; Tom Johnson,
   Marlene Drost, Ed Hallman, and Dave Danenberg, all formerly of
   Litchfield Communications, for their contributions to the document.

Authors' Addresses

   Andrew G. Malis
   Verizon Communications
   40 Sylvan Road
   Waltham, MA 02451
   EMail: andrew.g.malis@verizon.com


   Jeremy Brayley
   ECI Telecom Inc.
   Omega Corporate Center
   1300 Omega Drive
   Pittsburgh, PA 15205
   EMail: jeremy.brayley@ecitele.com


   John Shirron
   ECI Telecom Inc.
   Omega Corporate Center
   1300 Omega Drive
   Pittsburgh, PA 15205
   EMail: john.shirron@ecitele.com


   Luca Martini
   Cisco Systems, Inc.
   9155 East Nichols Avenue, Suite 400
   Englewood, CO, 80112
   EMail: lmartini@cisco.com


   Steve Vogelsang
   Alcatel-Lucent
   600 March Road
   Kanata, ON K2K 2T6
   Canada
   EMail: steve.vogelsang@alcatel-lucent.com






<span class="grey">Malis, et al.                   Historic                       [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc5143">RFC 5143</a>         SONET/SDH Circuit Emulation over MPLS     February 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and at www.rfc-editor.org/copyright.html, and
   except as set forth therein, the authors retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and <a href="https://www.rfc-editor.org/bcp/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Malis, et al.                   Historic                       [Page 24]
</pre>
</body></html>