<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9370: Multiple Key Exchanges in the Internet Key Exchange Protocol Version 2 (IKEv2)</title>
<meta content="Cen Jung Tjhai" name="author"/>
<meta content="Martin Tomlinson" name="author"/>
<meta content="Graham Bartlett" name="author"/>
<meta content="Scott Fluhrer" name="author"/>
<meta content="Daniel Van Geest" name="author"/>
<meta content="Oscar Garcia-Morchon" name="author"/>
<meta content="Valery Smyslov" name="author"/>
<meta content='
       This document describes how to extend the Internet Key Exchange
  Protocol Version 2 (IKEv2) to allow multiple key exchanges to take
  place while computing a shared secret during a Security Association
  (SA) setup. 
       This document utilizes the IKE_INTERMEDIATE exchange, where multiple key exchanges are performed when an IKE SA is being
  established.  It also introduces a new IKEv2 exchange,
  IKE_FOLLOWUP_KE, which is used for the same purpose when the IKE SA
  is being rekeyed or is creating additional Child SAs. 
       This document updates RFC 7296 by renaming a Transform Type 4 from
  "Diffie-Hellman Group (D-H)" to "Key Exchange Method (KE)" and
  renaming a field in the Key Exchange Payload from "Diffie-Hellman
  Group Num" to "Key Exchange Method".  It also renames an IANA
  registry for this Transform Type from "Transform Type 4 - Diffie-
  Hellman Group Transform IDs" to "Transform Type 4 - Key Exchange
  Method Transform IDs".  These changes generalize key exchange
  algorithms that can be used in IKEv2. 
    ' name="description"/>
<meta content="xml2rfc 3.17.1" name="generator"/>
<meta content="post-quantum" name="keyword"/>
<meta content="PQC" name="keyword"/>
<meta content="hybrid" name="keyword"/>
<meta content="hybridization" name="keyword"/>
<meta content="hybrid key exchange" name="keyword"/>
<meta content="key encapsulation" name="keyword"/>
<meta content="quantum" name="keyword"/>
<meta content="quantum-safe" name="keyword"/>
<meta content="KEM" name="keyword"/>
<meta content="PQ" name="keyword"/>
<meta content="9370" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.17.1
    Python 3.9.15
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.1
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9370.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9370" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-ikev2-multiple-ke-12" rel="prev"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9370</td>
<td class="center">Multiple Key Exchanges in IKEv2</td>
<td class="right">May 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tjhai, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9370">9370</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc7296">7296</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-05">May 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">CJ. Tjhai</div>
<div class="org">Post-Quantum</div>
</div>
<div class="author">
      <div class="author-name">M. Tomlinson</div>
<div class="org">Post-Quantum</div>
</div>
<div class="author">
      <div class="author-name">G. Bartlett</div>
<div class="org">Quantum Secret</div>
</div>
<div class="author">
      <div class="author-name">S. Fluhrer</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">D. Van Geest</div>
<div class="org">ISARA Corporation</div>
</div>
<div class="author">
      <div class="author-name">O. Garcia-Morchon</div>
<div class="org">Philips</div>
</div>
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9370</h1>
<h1 id="title">Multiple Key Exchanges in the Internet Key Exchange Protocol Version 2 (IKEv2)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document describes how to extend the Internet Key Exchange
  Protocol Version 2 (IKEv2) to allow multiple key exchanges to take
  place while computing a shared secret during a Security Association
  (SA) setup.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
<p id="section-abstract-2">This document utilizes the IKE_INTERMEDIATE exchange, where multiple key exchanges are performed when an IKE SA is being
  established.  It also introduces a new IKEv2 exchange,
  IKE_FOLLOWUP_KE, which is used for the same purpose when the IKE SA
  is being rekeyed or is creating additional Child SAs.<a class="pilcrow" href="#section-abstract-2">¶</a></p>
<p id="section-abstract-3">This document updates RFC 7296 by renaming a Transform Type 4 from
  "Diffie-Hellman Group (D-H)" to "Key Exchange Method (KE)" and
  renaming a field in the Key Exchange Payload from "Diffie-Hellman
  Group Num" to "Key Exchange Method".  It also renames an IANA
  registry for this Transform Type from "Transform Type 4 - Diffie-
  Hellman Group Transform IDs" to "Transform Type 4 - Key Exchange
  Method Transform IDs".  These changes generalize key exchange
  algorithms that can be used in IKEv2.<a class="pilcrow" href="#section-abstract-3">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9370">https://www.rfc-editor.org/info/rfc9370</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.  <a class="internal xref" href="#name-problem-description">Problem Description</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p class="keepWithNext" id="section-toc.1-1.1.2.2.1"><a class="auto internal xref" href="#section-1.2">1.2</a>.  <a class="internal xref" href="#name-proposed-extension">Proposed Extension</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p class="keepWithNext" id="section-toc.1-1.1.2.3.1"><a class="auto internal xref" href="#section-1.3">1.3</a>.  <a class="internal xref" href="#name-document-organization">Document Organization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-multiple-key-exchanges">Multiple Key Exchanges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-design-overview">Design Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-protocol-details">Protocol Details</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a class="auto internal xref" href="#section-2.2.1">2.2.1</a>.  <a class="internal xref" href="#name-ike_sa_init-round-negotiati">IKE_SA_INIT Round: Negotiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a class="auto internal xref" href="#section-2.2.2">2.2.2</a>.  <a class="internal xref" href="#name-ike_intermediate-round-addi">IKE_INTERMEDIATE Round: Additional Key Exchanges</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a class="auto internal xref" href="#section-2.2.3">2.2.3</a>.  <a class="internal xref" href="#name-ike_auth-exchange">IKE_AUTH Exchange</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a class="auto internal xref" href="#section-2.2.4">2.2.4</a>.  <a class="internal xref" href="#name-create_child_sa-exchange">CREATE_CHILD_SA Exchange</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a class="auto internal xref" href="#section-2.2.5">2.2.5</a>.  <a class="internal xref" href="#name-interaction-with-ikev2-exte">Interaction with IKEv2 Extensions</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-sample-multiple-key-exchang">Sample Multiple Key Exchanges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#appendix-A.1">A.1</a>.  <a class="internal xref" href="#name-ike_intermediate-exchanges-">IKE_INTERMEDIATE Exchanges Carrying Additional Key Exchange Payloads</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#appendix-A.2">A.2</a>.  <a class="internal xref" href="#name-no-additional-key-exchange-">No Additional Key Exchange Used</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a class="auto internal xref" href="#appendix-A.3">A.3</a>.  <a class="internal xref" href="#name-additional-key-exchange-in-">Additional Key Exchange in the CREATE_CHILD_SA Exchange Only</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a class="auto internal xref" href="#appendix-A.4">A.4</a>.  <a class="internal xref" href="#name-no-matching-proposal-for-ad">No Matching Proposal for Additional Key Exchanges</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#appendix-B">Appendix B</a>.  <a class="internal xref" href="#name-design-criteria">Design Criteria</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#appendix-C">Appendix C</a>.  <a class="internal xref" href="#name-alternative-design">Alternative Design</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#appendix-D"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-E"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<section id="section-1.1">
        <h3 id="name-problem-description">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-problem-description">Problem Description</a>
        </h3>
<p id="section-1.1-1">The Internet Key Exchange Protocol version 2 (IKEv2), as specified in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>, uses
  the Diffie-Hellman (DH) or the Elliptic Curve Diffie-Hellman (ECDH)
  algorithm, which shall be referred to as "(EC)DH" collectively, to
  establish a shared secret between an initiator and a responder.  The
  security of the (EC)DH algorithms relies on the difficulty to solve a
  discrete logarithm problem in multiplicative (and, respectively,
  elliptic curve) groups when the order of the group parameter is large
  enough.  While solving such a problem remains infeasible with current
  computing power, it is believed that general-purpose quantum
  computers will be able to solve this problem, implying that the
  security of IKEv2 is compromised.  There are, however, a number of
  cryptosystems that are conjectured to be resistant to quantum-computer attacks.  This family of cryptosystems is known as "post-quantum cryptography" (or "PQC").  It is sometimes also referred to as
  "quantum-safe cryptography" (or "QSC") or "quantum-resistant cryptography"
  (or "QRC").<a class="pilcrow" href="#section-1.1-1">¶</a></p>
<p id="section-1.1-2">It is essential to have the ability to perform one or more post-quantum key exchanges in conjunction with an (EC)DH key exchange so that the resulting
  shared key is resistant to quantum-computer attacks.   Since there is currently no post-quantum key exchange that
  is as well-studied as (EC)DH, performing multiple key exchanges with
  different post-quantum algorithms along with the well-established
  classical key-exchange algorithms addresses this concern, since the
  overall security is at least as strong as each individual primitive.<a class="pilcrow" href="#section-1.1-2">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-proposed-extension">
<a class="section-number selfRef" href="#section-1.2">1.2. </a><a class="section-name selfRef" href="#name-proposed-extension">Proposed Extension</a>
        </h3>
<p id="section-1.2-1">This document describes a method to perform multiple successive key
        exchanges in IKEv2. This method allows integration of PQC in IKEv2,
        while maintaining backward compatibility, to derive a set of IKE keys
        that is resistant to quantum-computer attacks.  This extension allows
        the negotiation of one or more PQC algorithms to exchange data, in
        addition to the existing (EC)DH key exchange data.  It is believed
        that the feature of using more than one post-quantum algorithm is
        important, as many of these algorithms are relatively new, and there may
        be a need to hedge the security risk with multiple key exchange data
        from several distinct PQC algorithms.<a class="pilcrow" href="#section-1.2-1">¶</a></p>
<p id="section-1.2-2">IKE peers perform multiple successive key exchanges to establish
            an IKE SA.  Each exchange produces some shared secret, and
            these secrets are combined in a way such that:<a class="pilcrow" href="#section-1.2-2">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-1.2-3">
          <dt>(a)</dt>
<dd id="section-1.2-3.1">the final shared secret is computed from all of the component
          key exchange secrets;<a class="pilcrow" href="#section-1.2-3.1">¶</a>
</dd>
          <dd class="break"></dd>
<dt>(b)</dt>
<dd id="section-1.2-3.2">unless both peers support and agree to use the additional key
       exchanges introduced in this specification, the final shared
       secret equivalent to the shared secret specified in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> is obtained; and<a class="pilcrow" href="#section-1.2-3.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt>(c)</dt>
<dd id="section-1.2-3.3">if any part of the component key exchange method is a post-quantum
          algorithm, the final shared secret is post-quantum secure.<a class="pilcrow" href="#section-1.2-3.3">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.2-4">Some post-quantum key exchange payloads may have sizes larger than
        the standard maximum transmission unit (MTU) size. Therefore, there
        could be issues with fragmentation at the IP layer.  In order to allow
        the use of those larger payload sizes, this mechanism relies on the
        IKE_INTERMEDIATE exchange as specified in <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>.  With this mechanism, the key exchange is
        initiated using a smaller, possibly classical primitive, such as
        (EC)DH.  Then, before the IKE_AUTH exchange, one or more
        IKE_INTERMEDIATE exchanges are carried out, each of which contains an
        additional key exchange.  As the IKE_INTERMEDIATE exchange is
        encrypted, the IKE fragmentation protocol <span>[<a class="cite xref" href="#RFC7383">RFC7383</a>]</span> can be used. The IKE SK_* values are updated after
        each exchange, as described in <a class="auto internal xref" href="#additional_ke">Section 2.2.2</a>; thus, the final IKE SA keys depend on all the key
        exchanges. Hence, the keys are secure if any of the key exchanges are
        secure.<a class="pilcrow" href="#section-1.2-4">¶</a></p>
<p id="section-1.2-5">While this extension is primarily aimed at IKE SAs due to the
        potential fragmentation issue discussed above, it also applies to
        CREATE_CHILD_SA exchanges as illustrated in <a class="auto internal xref" href="#create_child_sa_exchange">Section 2.2.4</a> for
        creating/rekeying of Child SAs and rekeying of IKE SAs.<a class="pilcrow" href="#section-1.2-5">¶</a></p>
<p id="section-1.2-6">Note that readers should consider the approach defined in this
        document as providing a long-term solution in upgrading the IKEv2
        protocol to support post-quantum algorithms.  A short-term solution to
        make IKEv2 key exchange quantum secure is to use post-quantum
        pre-shared keys as specified in <span>[<a class="cite xref" href="#RFC8784">RFC8784</a>]</span>.<a class="pilcrow" href="#section-1.2-6">¶</a></p>
<p id="section-1.2-7"> Note also that the proposed approach of performing multiple
  successive key exchanges in such a way, when the resulting session keys
  depend on all of them, is not limited to only addressing the
  threat of quantum computers.  It can also be used when all of the performed key
        exchanges are classical (EC)DH primitives, where, for various reasons
        (e.g., policy requirements), it is essential to perform multiple key
        exchanges.<a class="pilcrow" href="#section-1.2-7">¶</a></p>
<p id="section-1.2-8">This specification does not attempt to address key exchanges with KE payloads
        longer than 64 KB; the current IKE payload format does not allow such a
        possibility.  At the time of writing, it appears likely that there
        are a number of key exchanges available that would not have such
        a requirement.  <span>[<a class="cite xref" href="#I-D.tjhai-ikev2-beyond-64k-limit">BEYOND-64K</a>]</span> discusses approaches
        that could be taken to exchange huge payloads if such a requirement were needed.<a class="pilcrow" href="#section-1.2-8">¶</a></p>
</section>
<section id="section-1.3">
        <h3 id="name-document-organization">
<a class="section-number selfRef" href="#section-1.3">1.3. </a><a class="section-name selfRef" href="#name-document-organization">Document Organization</a>
        </h3>
<p id="section-1.3-1">The remainder of this document is organized as follows.  <a class="auto internal xref" href="#specification">Section 2</a> describes how multiple key
        exchanges are performed between two IKE peers and how keying materials
        are derived for both SAs and Child SAs. <a class="auto internal xref" href="#IANA">Section 3</a> discusses IANA considerations for the namespaces
        introduced in this document. <a class="auto internal xref" href="#security">Section 4</a> discusses security considerations.  In the
        Appendices, some examples of multiple key exchanges are illustrated in
        <a class="auto internal xref" href="#sample-exchanges">Appendix A</a>.  <a class="auto internal xref" href="#design">Appendix B</a> summarizes design criteria and
        alternative approaches that have been considered. These approaches are
        later discarded, as described in <a class="auto internal xref" href="#altdesign">Appendix C</a>.<a class="pilcrow" href="#section-1.3-1">¶</a></p>
<p id="section-1.3-2">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
        "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>", "<span class="bcp14">MAY</span>", and
        "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as described in
        BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when,
        and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-1.3-2">¶</a></p>
</section>
</section>
<div id="specification">
<section id="section-2">
      <h2 id="name-multiple-key-exchanges">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-multiple-key-exchanges">Multiple Key Exchanges</a>
      </h2>
<section id="section-2.1">
        <h3 id="name-design-overview">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-design-overview">Design Overview</a>
        </h3>
<p id="section-2.1-1"> Most post-quantum key agreement algorithms are relatively new.
        Thus, they are not fully trusted.  There are also many proposed
        algorithms that have different trade-offs and that rely on different
        hard problems.  The concern is that some of these hard problems may
        turn out to be easier to solve than anticipated; thus, the key
        agreement algorithm may not be as secure as expected.

A hybrid solution, when multiple key exchanges are performed and the
calculated shared key depends on all of them, allows us to deal with
this uncertainty by combining a classical key exchange with a
post-quantum one, as well as leaving open the possibility of
combining it with multiple post-quantum key exchanges.<a class="pilcrow" href="#section-2.1-1">¶</a></p>
<p id="section-2.1-2"> In order to be able to use IKE fragmentation <span>[<a class="cite xref" href="#RFC7383">RFC7383</a>]</span> for those key exchanges that may
        have long public keys, this specification utilizes the
        IKE_INTERMEDIATE exchange defined in <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>.  The initial IKE_SA_INIT messages do not have any
        inherent fragmentation support within IKE. However, IKE_SA_INIT
        messages can include a relatively short KE payload.  The additional
        key exchanges are performed using IKE_INTERMEDIATE messages that
        follow the IKE_SA_INIT exchange. This is to allow the standard IKE
        fragmentation mechanisms (which cannot be used in IKE_SA_INIT) to be
        available for the potentially large Key Exchange payloads with
        post-quantum algorithm data.<a class="pilcrow" href="#section-2.1-2">¶</a></p>
<p id="section-2.1-3"> Note that this document assumes that each key exchange method
        requires one round trip and consumes exactly one IKE_INTERMEDIATE
        exchange.  This assumption is valid for all classic key exchange
        methods defined so far and for all post-quantum methods currently
        known.  For hypothetical future key exchange methods that require
        multiple round trips to complete, a separate document should define
        how such methods are split into several IKE_INTERMEDIATE exchanges.<a class="pilcrow" href="#section-2.1-3">¶</a></p>
<p id="section-2.1-4"> In order to minimize communication overhead, only the key shares
        that are agreed upon are actually exchanged.  To negotiate
        additional key exchanges, seven new Transform Types are defined.  These
        transforms and Transform Type 4 share the same Transform IDs.<a class="pilcrow" href="#section-2.1-4">¶</a></p>
<p id="section-2.1-5"> It is assumed that new Transform Type 4 identifiers will be
        assigned later for various post-quantum key exchanges <span>[<a class="cite xref" href="#IKEV2TYPE4ID">IKEV2TYPE4ID</a>]</span>.  This specification does not
        make a distinction between classical (EC)DH and post-quantum key
        exchanges, nor between post-quantum algorithms that are true key
        exchanges and post-quantum algorithms that act as key transport
        mechanisms: all are treated equivalently by the protocol.  This
        document renames a field in the Key Exchange Payload from
        "Diffie-Hellman Group Num" to "Key Exchange Method". This document also
        renames Transform Type 4 from "Diffie-Hellman Group (D-H)" to "Key
        Exchange Method (KE)". The corresponding renaming to the IANA registry
        is described in <a class="auto internal xref" href="#IANA">Section 3</a>.<a class="pilcrow" href="#section-2.1-5">¶</a></p>
<p id="section-2.1-6"> The fact that newly defined transforms share the same registry for
        possible Transform IDs with Transform Type 4 allows additional key
        exchanges to be of any type: either post-quantum or classical
        (EC)DH.  This approach allows any combination of the defined key
        exchange methods to take place.  This also allows IKE peers to perform
        a single post-quantum key exchange in the IKE_SA_INIT without
        additional key exchanges, provided that the IP fragmentation is not an
        issue and that hybrid key exchange is not needed.<a class="pilcrow" href="#section-2.1-6">¶</a></p>
<p id="section-2.1-7"> The SA payload in the IKE_SA_INIT message includes one or more
        newly defined transforms that represent the extra key exchange policy
        required by the initiator. The responder follows the usual IKEv2
        negotiation rules: it selects a single transform of each type and
        returns all of them in the IKE_SA_INIT response message.<a class="pilcrow" href="#section-2.1-7">¶</a></p>
<p id="section-2.1-8">Then, provided that additional key exchanges are negotiated, the
        initiator and the responder perform one or more IKE_INTERMEDIATE
        exchanges. Following that, the IKE_AUTH exchange authenticates peers
        and completes IKE SA establishment.<a class="pilcrow" href="#section-2.1-8">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.1-9">
<pre>Initiator                             Responder
---------------------------------------------------------------------
&lt;-- IKE_SA_INIT (additional key exchanges negotiation) --&gt;

&lt;-- {IKE_INTERMEDIATE (additional key exchange)} --&gt;

                         ...

&lt;-- {IKE_INTERMEDIATE (additional key exchange)} --&gt;

&lt;-- {IKE_AUTH} --&gt;

</pre><a class="pilcrow" href="#section-2.1-9">¶</a>
</div>
</section>
<section id="section-2.2">
        <h3 id="name-protocol-details">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-protocol-details">Protocol Details</a>
        </h3>
<p id="section-2.2-1"> In the simplest case, the initiator starts a single key exchange
        (and has no interest in supporting multiple), and it is not concerned
        with possible fragmentation of the IKE_SA_INIT messages (because either
        the key exchange that it selects is small enough not to fragment
        or the initiator is confident that fragmentation will be handled
        either by IP fragmentation or by transport via TCP).<a class="pilcrow" href="#section-2.2-1">¶</a></p>
<p id="section-2.2-2"> In this case, the initiator performs the IKE_SA_INIT for a single
        key exchange using a Transform Type 4 (possibly with a post-quantum
        algorithm) and including the initiator KE payload.  If the responder
        accepts the policy, it responds with an IKE_SA_INIT response, and IKE
        continues as usual.<a class="pilcrow" href="#section-2.2-2">¶</a></p>
<p id="section-2.2-3"> If the initiator wants to negotiate multiple key exchanges, then
        the initiator uses the protocol behavior listed below.<a class="pilcrow" href="#section-2.2-3">¶</a></p>
<div id="negotiation">
<section id="section-2.2.1">
          <h4 id="name-ike_sa_init-round-negotiati">
<a class="section-number selfRef" href="#section-2.2.1">2.2.1. </a><a class="section-name selfRef" href="#name-ike_sa_init-round-negotiati">IKE_SA_INIT Round: Negotiation</a>
          </h4>
<p id="section-2.2.1-1"> Multiple key exchanges are negotiated using the standard IKEv2
          mechanism via SA payload.  For this purpose, seven new transform
          types are defined: Additional Key Exchange 1 (ADDKE1) with IANA-assigned value
          6, Additional Key Exchange 2 (ADDKE2) (7), Additional Key Exchange 3 (ADDKE3) (8),
          Additional Key Exchange 4 (ADDKE4) (9), Additional Key Exchange 5 (ADDKE5) (10),
          Additional Key Exchange 6 (ADDKE6) (11), and Additional Key Exchange 7 (ADDKE7) (12).
          They are collectively called "Additional Key Exchange (ADDKE)
          Transform Types" in this document and have slightly different semantics
          than the existing IKEv2 Transform Types.  They are interpreted as an
          indication of additional key exchange methods that peers agree to
          perform in a series of IKE_INTERMEDIATE exchanges following the
          IKE_SA_INIT exchange.  The allowed Transform IDs for these transform
          types are the same as the IDs for Transform Type 4, so they all
          share a single IANA registry for Transform IDs.<a class="pilcrow" href="#section-2.2.1-1">¶</a></p>
<p id="section-2.2.1-2">The key exchange method negotiated via Transform Type 4 always
          takes place in the IKE_SA_INIT exchange, as defined in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.  Additional key exchanges
          negotiated via newly defined transforms <span class="bcp14">MUST</span> take
          place in a series of IKE_INTERMEDIATE exchanges following the
          IKE_SA_INIT exchange, performed in an order of the values of their
          Transform Types.  This is so that the key exchange negotiated using Additional
          Key Exchange i always precedes that of Additional Key Exchange i +
          1. Each additional key exchange method <span class="bcp14">MUST</span> be fully
          completed before the next one is started.<a class="pilcrow" href="#section-2.2.1-2">¶</a></p>
<p id="section-2.2.1-3">With these semantics, note that ADDKE
          Transform Types are not associated with any particular type of key
          exchange and do not have any Transform IDs that are specific per
          Transform Type IANA registry.  Instead, they all share a single
          registry for Transform IDs, namely "Transform Type 4 - Key Exchange Method Transform
          IDs".  All key exchange
          algorithms (both classical or post-quantum) should be added to this
          registry.  This approach gives peers flexibility in defining the
          ways they want to combine different key exchange methods.<a class="pilcrow" href="#section-2.2.1-3">¶</a></p>
<p id="section-2.2.1-4"> When forming a proposal, the initiator adds transforms for the
          IKE_SA_INIT exchange using Transform Type 4.  In most cases, they
          will contain classical (EC)DH key exchange methods, but that is not
          a requirement.  Additional key exchange methods are proposed using
          ADDKE Transform Types.  All of these transform
          types are optional; the initiator is free to select any of them for
          proposing additional key exchange methods.  Consequently, if none of
          the ADDKE Transform Types are included in the proposal,
          then this proposal indicates the performing of standard IKEv2, as
          defined in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.  On the other
          hand, if the initiator includes any ADDKE
          Transform Type in the proposal, the responder <span class="bcp14">MUST</span> select
          one of the algorithms proposed using this type.  Note that this is
          not a new requirement; this behavior is already specified in
          <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.7">Section 2.7</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.  A
          Transform ID NONE <span class="bcp14">MAY</span> be added to those transform
          types that contain key exchange methods which the initiator believes
          are optional according to its local policy.<a class="pilcrow" href="#section-2.2.1-4">¶</a></p>
<p id="section-2.2.1-5"> The responder performs the negotiation using the standard IKEv2
          procedure described in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.  However, for the ADDKE Transform Types,
          the responder's choice <span class="bcp14">MUST NOT</span> contain duplicated
          algorithms (those with an identical Transform ID and attributes),
          except for the Transform ID of NONE.  An algorithm is represented as
          a transform. In some cases, the transform could include a set of
          associated attributes that define details of the algorithm. In this
          case, two transforms can be the same, but the attributes must be
          different.   Additionally, the order of the attributes does not
   affect the equality of the algorithm, so the following two
   transforms define the same algorithm:
   "ID=alg1, ATTR1=attr1, ATTR2=attr2" and
   "ID=alg1, ATTR2=attr2, ATTR1=attr1". If the
          responder is unable to select algorithms that are not duplicated for each
          proposed key exchange (either because the proposal contains too few
          choices or due to the local policy restrictions on using the
          proposed algorithms), then the responder <span class="bcp14">MUST</span> reject
          the message with an error notification of type NO_PROPOSAL_CHOSEN.
          If the responder's message contains one or more duplicated choices,
          the initiator should log the error and <span class="bcp14">MUST</span> treat the
          exchange as failed.  The initiator <span class="bcp14">MUST NOT</span> initiate
          any IKE_INTERMEDIATE (or IKE_FOLLOWUP_KE) exchanges so that no new
          SA is created.  If this happens in the CREATE_CHILD_SA exchange,
          then the initiator <span class="bcp14">MAY</span> delete the IKE SA over which
          the invalid message was received by sending a Delete payload.<a class="pilcrow" href="#section-2.2.1-5">¶</a></p>
<p id="section-2.2.1-6"> If the responder selects NONE for some ADDKE
          Transform Types (provided they are proposed by the initiator), then any
          corresponding additional key exchanges <span class="bcp14">MUST NOT</span> take place.

   Therefore, if the
          initiator includes NONE in all of the ADDKE
          Transform Types and the responder selects this value for all of them,
          then no IKE_INTERMEDIATE exchanges performing additional key
          exchanges will take place between the peers.  Note that the
          IKE_INTERMEDIATE exchanges may still take place for other purposes.<a class="pilcrow" href="#section-2.2.1-6">¶</a></p>
<p id="section-2.2.1-7">The initiator <span class="bcp14">MAY</span> propose
          ADDKE Transform Types that are not consecutive, for example, proposing
          ADDKE2 and ADDKE5 Transform Types only.  The
          responder <span class="bcp14">MUST</span> treat all of the omitted ADDKE
          transforms as if they were proposed with Transform ID
          NONE.<a class="pilcrow" href="#section-2.2.1-7">¶</a></p>
<p id="section-2.2.1-8">Below is an example of the SA payload in the initiator's IKE_SA_INIT
  request message.  Here, the abbreviation "KE" is used for the Key Exchange transform, which this
  document renames from the Diffie-Hellman Group transform.  Additionally, the notations PQ_KEM_1, PQ_KEM_2, and
          PQ_KEM_3 are used to represent Transform IDs that have yet to be defined of
          some popular post-quantum key exchange methods.<a class="pilcrow" href="#section-2.2.1-8">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.1-9">
<pre>SA Payload
   |
   +--- Proposal #1 ( Proto ID = IKE(1), SPI Size = 8,
         |            9 transforms,      SPI = 0x35a1d6f22564f89d )
         |
         +-- Transform ENCR ( ID = ENCR_AES_GCM_16 )
         |     +-- Attribute ( Key Length = 256 )
         |
         +-- Transform KE ( ID = 4096-bit MODP Group )
         |
         +-- Transform PRF ( ID = PRF_HMAC_SHA2_256 )
         |
         +-- Transform ADDKE2 ( ID = PQ_KEM_1 )
         |
         +-- Transform ADDKE2 ( ID = PQ_KEM_2 )
         |
         +-- Transform ADDKE3 ( ID = PQ_KEM_1 )
         |
         +-- Transform ADDKE3 ( ID = PQ_KEM_2 )
         |
         +-- Transform ADDKE5 ( ID = PQ_KEM_3 )
         |
         +-- Transform ADDKE5 ( ID = NONE )

</pre><a class="pilcrow" href="#section-2.2.1-9">¶</a>
</div>
<p id="section-2.2.1-10"> In this example, the initiator proposes performing the
          initial key exchange using a 4096-bit MODP Group followed by two
          mandatory additional key exchanges (i.e., ADDKE2 and ADDKE3 Transform Types)
          using PQ_KEM_1 and PQ_KEM_2 methods in any order followed
          by an additional key exchange (i.e., ADDKE5 Transform Type) using the PQ_KEM_3
          method that may be omitted.<a class="pilcrow" href="#section-2.2.1-10">¶</a></p>
<p id="section-2.2.1-11"> The responder might return the following SA payload, indicating
          that it agrees to perform two additional key exchanges, PQ_KEM_2
          followed by PQ_KEM_1, and that it does not want to additionally perform
          PQ_KEM_3.<a class="pilcrow" href="#section-2.2.1-11">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.1-12">
<pre>SA Payload
   |
   +--- Proposal #1 ( Proto ID = IKE(1), SPI Size = 8,
         |            6 transforms,      SPI = 0x8df52b331a196e7b )
         |
         +-- Transform ENCR ( ID = ENCR_AES_GCM_16 )
         |     +-- Attribute ( Key Length = 256 )
         |
         +-- Transform KE ( ID = 4096-bit MODP Group )
         |
         +-- Transform PRF ( ID = PRF_HMAC_SHA2_256 )
         |
         +-- Transform ADDKE2 ( ID = PQ_KEM_2 )
         |
         +-- Transform ADDKE3 ( ID = PQ_KEM_1 )
         |
         +-- Transform ADDKE5 ( ID = NONE )

</pre><a class="pilcrow" href="#section-2.2.1-12">¶</a>
</div>
<p id="section-2.2.1-13"> If the initiator includes any ADDKE Transform
          Types into the SA payload in the IKE_SA_INIT exchange request
          message, then it <span class="bcp14">MUST</span> also negotiate the use of the
          IKE_INTERMEDIATE exchange, as described in <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span> by including an INTERMEDIATE_EXCHANGE_SUPPORTED
          notification in the same message.  If the responder agrees to use
          additional key exchanges while establishing an initial IKE SA, it
          <span class="bcp14">MUST</span> also return this notification in the IKE_SA_INIT
          response message, confirming that IKE_INTERMEDIATE exchange is
          supported and will be used for transferring additional key exchange
          data.  If the IKE_INTERMEDIATE exchange is not negotiated, then the
          peers <span class="bcp14">MUST</span> treat any ADDKE
          Transform Types in the IKE_SA_INIT exchange messages as unknown transform
          types and skip the proposals they appear in.  If no other proposals
          are present in the SA payload, the peers will proceed as if no
          proposal has been chosen (i.e., the responder will send a NO_PROPOSAL_CHOSEN
          notification).<a class="pilcrow" href="#section-2.2.1-13">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.1-14">
<pre>Initiator                          Responder
---------------------------------------------------------------------
HDR, SAi1(.. ADDKE*...), KEi, Ni,
N(INTERMEDIATE_EXCHANGE_SUPPORTED)    ---&gt;
                                   HDR, SAr1(.. ADDKE*...), KEr, Nr,
                                   [CERTREQ],
                           &lt;---    N(INTERMEDIATE_EXCHANGE_SUPPORTED)

</pre><a class="pilcrow" href="#section-2.2.1-14">¶</a>
</div>
<p id="section-2.2.1-15"> It is possible for an attacker to manage to send a response to
          the initiator's IKE_SA_INIT request before the legitimate responder
          does.  If the initiator continues to create the IKE SA using this
          response, the attempt will fail.  Implementers may wish to consider
         strategies as described
   in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.4">Section 2.4</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> to handle such an attack.<a class="pilcrow" href="#section-2.2.1-15">¶</a></p>
</section>
</div>
<div id="additional_ke">
<section id="section-2.2.2">
          <h4 id="name-ike_intermediate-round-addi">
<a class="section-number selfRef" href="#section-2.2.2">2.2.2. </a><a class="section-name selfRef" href="#name-ike_intermediate-round-addi">IKE_INTERMEDIATE Round: Additional Key Exchanges</a>
          </h4>
<p id="section-2.2.2-1"> For each additional key exchange agreed to in the IKE_SA_INIT exchange,
         the initiator and the responder perform an IKE_INTERMEDIATE exchange,
                as described in <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>.<a class="pilcrow" href="#section-2.2.2-1">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.2-2">
<pre>Initiator                          Responder
---------------------------------------------------------------------
HDR, SK {KEi(n)}    --&gt;
                            &lt;--    HDR, SK {KEr(n)}

</pre><a class="pilcrow" href="#section-2.2.2-2">¶</a>
</div>
<p id="section-2.2.2-3"> The initiator sends key exchange data in the KEi(n) payload.
          This message is protected with the current SK_ei/SK_ai keys.  The
          notation "KEi(n)" denotes the n-th IKE_INTERMEDIATE KE payload from
          the initiator; the integer "n" is sequential starting from
          1.<a class="pilcrow" href="#section-2.2.2-3">¶</a></p>
<p id="section-2.2.2-4"> On receiving this, the responder sends back key exchange payload
          KEr(n); "KEr(n)" denotes the n-th IKE_INTERMEDIATE KE payload from the
          responder.  Similar to how the request is protected, this message is protected with the current
          SK_er/SK_ar keys.<a class="pilcrow" href="#section-2.2.2-4">¶</a></p>
<p id="section-2.2.2-5"> The former "Diffie-Hellman Group Num" (now called "Key Exchange Method") field in the KEi(n) and KEr(n) payloads <span class="bcp14">MUST</span> match the
                n-th negotiated additional key exchange.<a class="pilcrow" href="#section-2.2.2-5">¶</a></p>
<p id="section-2.2.2-6"> Once this exchange is done, both sides compute an updated keying material:<a class="pilcrow" href="#section-2.2.2-6">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.2-7">
<pre>SKEYSEED(n) = prf(SK_d(n-1), SK(n) | Ni | Nr)

</pre><a class="pilcrow" href="#section-2.2.2-7">¶</a>
</div>
<p id="section-2.2.2-8"> From this exchange, SK(n) is the resulting shared secret. Ni and Nr are nonces from the IKE_SA_INIT exchange.
          SK_d(n-1) is the last generated SK_d (derived from IKE_SA_INIT
          for the first use of IKE_INTERMEDIATE and, otherwise, from the
          previous IKE_INTERMEDIATE exchange).  The other keying materials,
          SK_d, SK_ai, SK_ar, SK_ei, SK_er, SK_pi, and SK_pr, are generated
          from the SKEYSEED(n) as follows:<a class="pilcrow" href="#section-2.2.2-8">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.2-9">
<pre>{SK_d(n) | SK_ai(n) | SK_ar(n) | SK_ei(n) | SK_er(n) | SK_pi(n) |
 SK_pr(n)} = prf+ (SKEYSEED(n), Ni | Nr | SPIi | SPIr)

</pre><a class="pilcrow" href="#section-2.2.2-9">¶</a>
</div>
<p id="section-2.2.2-10"> Both the initiator and the responder use these updated key
         values in the next exchange (IKE_INTERMEDIATE or IKE_AUTH).<a class="pilcrow" href="#section-2.2.2-10">¶</a></p>
</section>
</div>
<section id="section-2.2.3">
          <h4 id="name-ike_auth-exchange">
<a class="section-number selfRef" href="#section-2.2.3">2.2.3. </a><a class="section-name selfRef" href="#name-ike_auth-exchange">IKE_AUTH Exchange</a>
          </h4>
<p id="section-2.2.3-1"> After all IKE_INTERMEDIATE exchanges have completed, the initiator and
         the responder perform an IKE_AUTH exchange.  This exchange is
         the standard IKE exchange, as described in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>, with
 the modification of AUTH payload calculation described in
 <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>.<a class="pilcrow" href="#section-2.2.3-1">¶</a></p>
</section>
<div id="create_child_sa_exchange">
<section id="section-2.2.4">
          <h4 id="name-create_child_sa-exchange">
<a class="section-number selfRef" href="#section-2.2.4">2.2.4. </a><a class="section-name selfRef" href="#name-create_child_sa-exchange">CREATE_CHILD_SA Exchange</a>
          </h4>
<p id="section-2.2.4-1"> The CREATE_CHILD_SA exchange is used in IKEv2 for the purposes
          of creating additional Child SAs, rekeying these Child SAs, and
          rekeying IKE SA itself.  When creating or rekeying Child SAs, the
          peers may optionally perform a key exchange to add a fresh entropy
          into the session keys.  In the case of an IKE SA rekey, the key exchange is
          mandatory.  Peers supporting this specification may want to use
          multiple key exchanges in these situations.<a class="pilcrow" href="#section-2.2.4-1">¶</a></p>
<p id="section-2.2.4-2"> Using multiple key exchanges with a CREATE_CHILD_SA exchange is
          negotiated in a similar fashion to the initial IKE exchange, see <a class="auto internal xref" href="#negotiation">Section 2.2.1</a>.  If the initiator includes
          any ADDKE Transform Types in the SA payload (along with
          Transform Type 4), and if the responder agrees to perform additional
          key exchanges, then the additional key exchanges are performed in a
          series of new IKE_FOLLOWUP_KE exchanges that follow the
          CREATE_CHILD_SA exchange.  The IKE_FOLLOWUP_KE exchange is introduced especially for
transferring data of additional key exchanges following the one
performed in the CREATE_CHILD_SA.  Its Exchange Type value is
44.<a class="pilcrow" href="#section-2.2.4-2">¶</a></p>
<p id="section-2.2.4-3">
     The key exchange negotiated via Transform Type 4 always takes
          place in the CREATE_CHILD_SA exchange, as per the IKEv2
          specification <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.  Additional key exchanges are performed in an order
          of the values of their Transform Types so that the key exchange
          negotiated using Additional Key Exchange i always precedes the key exchange
          negotiated using Additional Key Exchange i + 1. Each additional key exchange
          method <span class="bcp14">MUST</span> be fully completed before the next one is
          started.  Note that this document assumes that each key exchange
          method consumes exactly one IKE_FOLLOWUP_KE exchange.  For the
          methods that require multiple round trips, a separate document should
          define how such methods are split into several IKE_FOLLOWUP_KE
          exchanges.<a class="pilcrow" href="#section-2.2.4-3">¶</a></p>
<p id="section-2.2.4-4">After an IKE SA is created, the window size may be greater than one; thus, multiple concurrent exchanges may be in progress.  Therefore, it is
essential to link the IKE_FOLLOWUP_KE exchanges together with the
corresponding CREATE_CHILD_SA exchange.  Once an IKE SA is created, all IKE
  exchanges are independent and IKEv2 doesn't have a built-in mechanism to link an exchange
  with another one. A new status type notification called
  "ADDITIONAL_KEY_EXCHANGE" is introduced for this purpose.
          Its Notify Message Type value is 16441, and the Protocol ID and SPI
          Size are both set to 0.  The data associated with this notification
          is a blob meaningful only to the responder so that the
          responder can correctly link successive exchanges.  For the
          initiator, the content of this notification is an opaque blob.<a class="pilcrow" href="#section-2.2.4-4">¶</a></p>
<p id="section-2.2.4-5"> The responder <span class="bcp14">MUST</span> include this notification in a
          CREATE_CHILD_SA or IKE_FOLLOWUP_KE response message in case the next
          IKE_FOLLOWUP_KE exchange is expected, filling it with some data that
          would allow linking the current exchange to the next one.
          The initiator <span class="bcp14">MUST</span> send back this notification intact
          in the request message of the next IKE_FOLLOWUP_KE exchange.<a class="pilcrow" href="#section-2.2.4-5">¶</a></p>
<p id="section-2.2.4-6"> Below is an example of CREATE_CHILD_SA exchange followed by three additional key exchanges.<a class="pilcrow" href="#section-2.2.4-6">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.4-7">
<pre>Initiator                             Responder
---------------------------------------------------------------------
HDR(CREATE_CHILD_SA), SK {SA, Ni, KEi} --&gt;
                          &lt;--  HDR(CREATE_CHILD_SA), SK {SA, Nr, KEr,
                                   N(ADDITIONAL_KEY_EXCHANGE)(link1)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(1),
 N(ADDITIONAL_KEY_EXCHANGE)(link1)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(1),
                                   N(ADDITIONAL_KEY_EXCHANGE)(link2)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(2),
 N(ADDITIONAL_KEY_EXCHANGE)(link2)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(2),
                                   N(ADDITIONAL_KEY_EXCHANGE)(link3)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(3),
 N(ADDITIONAL_KEY_EXCHANGE)(link3)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(3)}

</pre><a class="pilcrow" href="#section-2.2.4-7">¶</a>
</div>
<p id="section-2.2.4-8"> The former "Diffie-Hellman Group Num" (now called "Key Exchange Method") field in the KEi(n) and KEr(n) payloads <span class="bcp14">MUST</span> match the
                n-th negotiated additional key exchange.<a class="pilcrow" href="#section-2.2.4-8">¶</a></p>
<p id="section-2.2.4-9">Due to some unexpected events (e.g., a
          reboot), it is possible that the initiator may lose its state, forget that it is in
          the process of performing additional key exchanges, and never
          start the remaining IKE_FOLLOWUP_KE exchanges.  The responder
          <span class="bcp14">MUST</span> handle this situation gracefully and delete the
          associated state if it does not receive the next expected
          IKE_FOLLOWUP_KE request after some reasonable period of time.  Due to various factors such as computational resource and key
          exchange algorithm used, note that it is not possible to give  normative
          guidance on how long this timeout period should be. In general, 5-20
          seconds of waiting time should be appropriate in most cases.<a class="pilcrow" href="#section-2.2.4-9">¶</a></p>
<p id="section-2.2.4-10">It may also take too long for the initiator to prepare
and to send the next IKE_FOLLOWUP_KE request, or, due to the
network conditions, the request could be lost and retransmitted.
  In
          this case, the message may reach the responder when it has already
          deleted the associated state, following the advice above.  If the
          responder receives an IKE_FOLLOWUP_KE message for which it does not
          have a key exchange state, it <span class="bcp14">MUST</span> send back a new
          error type notification called "STATE_NOT_FOUND".  This is an error notification that is not fatal to the IKE SA.
  Its Notify Message Type value is 47, its Protocol ID and SPI Size are
  both set to 0, and the data is empty.  If the
          initiator receives this notification in response to an IKE_FOLLOWUP_KE
          exchange performing an additional key exchange, it <span class="bcp14">MUST</span>
          cancel this exchange and <span class="bcp14">MUST</span> treat the whole series
          of exchanges started from the CREATE_CHILD_SA exchange as having failed.
          In most cases, the receipt of this notification is caused by the
          premature deletion of the corresponding state on the responder (the
          time period between IKE_FOLLOWUP_KE exchanges appeared to be too
          long from the responder's point of view, e.g., due to a temporary
          network failure).  After receiving this notification, the initiator
          <span class="bcp14">MAY</span> start a new CREATE_CHILD_SA exchange, which may
          eventually be followed by the IKE_FOLLOWUP_KE exchanges, to retry
          the failed attempt.  If the initiator continues to receive
          STATE_NOT_FOUND notifications after several retries, it
          <span class="bcp14">MUST</span> treat this situation as a fatal error and delete
          the IKE SA by sending a DELETE payload.<a class="pilcrow" href="#section-2.2.4-10">¶</a></p>
<p id="section-2.2.4-11"> It is possible that
          the peers start rekeying the IKE SA or the Child SA at the same time, which is called
          "simultaneous rekeying".  Sections <a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.8.1">2.8.1</a> and <a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.8.2">2.8.2</a> of <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>
          describe how IKEv2 handles this situation.  In a nutshell, IKEv2
          follows the rule that, in the case of simultaneous rekeying, if two
          identical new IKE SAs (or two pairs of Child SAs) are created, then
          one of them should be deleted.  Which one to delete is
          determined by comparing the values of four nonces that are used in
          the colliding CREATE_CHILD_SA exchanges. The IKE SA (or pair of
          Child SAs) created by the exchange in which the smallest
          nonce is used should be deleted by the initiator of this exchange.<a class="pilcrow" href="#section-2.2.4-11">¶</a></p>
<p id="section-2.2.4-12"> With multiple key exchanges, the SAs are not yet created when
          the CREATE_CHILD_SA is completed. Instead, they would be created
          only after the series of IKE_FOLLOWUP_KE exchanges is finished.  For
          this reason, if additional key exchanges are negotiated in the
          CREATE_CHILD_SA exchange in which the smallest nonce is used, then,
          because there is nothing to delete yet, the initiator of this
          exchange just stops the rekeying process, and it <span class="bcp14">MUST NOT</span> initiate the IKE_FOLLOWUP_KE exchange.<a class="pilcrow" href="#section-2.2.4-12">¶</a></p>
<p id="section-2.2.4-13"> In most cases, rekey collisions are resolved in the
          CREATE_CHILD_SA exchange.  However, a situation may occur when, due
          to packet loss, one of the peers receives the CREATE_CHILD_SA
          message requesting the rekey of an SA that is already being rekeyed by
          this peer (i.e., the CREATE_CHILD_SA exchange initiated by this peer
          has already been completed, and the series of IKE_FOLLOWUP_KE
          exchanges is in progress).  In this case, a TEMPORARY_FAILURE
          notification <span class="bcp14">MUST</span> be sent in response to such a
          request.<a class="pilcrow" href="#section-2.2.4-13">¶</a></p>
<p id="section-2.2.4-14"> If multiple key exchanges are negotiated in the CREATE_CHILD_SA exchange, then the resulting keys are
                computed as follows.<a class="pilcrow" href="#section-2.2.4-14">¶</a></p>
<p id="section-2.2.4-15">In the case of an IKE SA rekey:<a class="pilcrow" href="#section-2.2.4-15">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.4-16">
<pre>SKEYSEED = prf(SK_d, SK(0) | Ni | Nr | SK(1) | ... SK(n))

</pre><a class="pilcrow" href="#section-2.2.4-16">¶</a>
</div>
<p id="section-2.2.4-17"> In the case of a Child SA creation or rekey:<a class="pilcrow" href="#section-2.2.4-17">¶</a></p>
<div class="alignCenter art-text artwork" id="section-2.2.4-18">
<pre>KEYMAT = prf+ (SK_d, SK(0) | Ni | Nr | SK(1) |  ... SK(n))

</pre><a class="pilcrow" href="#section-2.2.4-18">¶</a>
</div>
<p id="section-2.2.4-19"> In both cases, SK_d is from the existing IKE SA; SK(0), Ni, and
          Nr are the shared key and nonces from the CREATE_CHILD_SA,
          respectively; SK(1)...SK(n) are the shared keys from additional
          key exchanges.<a class="pilcrow" href="#section-2.2.4-19">¶</a></p>
</section>
</div>
<section id="section-2.2.5">
          <h4 id="name-interaction-with-ikev2-exte">
<a class="section-number selfRef" href="#section-2.2.5">2.2.5. </a><a class="section-name selfRef" href="#name-interaction-with-ikev2-exte">Interaction with IKEv2 Extensions</a>
          </h4>
<p id="section-2.2.5-1"> It is believed that this specification requires no modification
          to the IKEv2 extensions defined so far.  In particular, the IKE SA
          resumption mechanism defined in <span>[<a class="cite xref" href="#RFC5723">RFC5723</a>]</span> can be used to resume IKE SAs created using this
          specification.<a class="pilcrow" href="#section-2.2.5-1">¶</a></p>
<section id="section-2.2.5.1">
            <h5 id="name-interaction-with-childless-">
<a class="section-number selfRef" href="#section-2.2.5.1">2.2.5.1. </a><a class="section-name selfRef" href="#name-interaction-with-childless-">Interaction with Childless IKE SA</a>
            </h5>
<p id="section-2.2.5.1-1">It is possible to establish IKE SAs with post-quantum algorithms by
only using IKE_FOLLOWUP_KE exchanges and without the use of
IKE_INTERMEDIATE exchanges.  In this case, the IKE SA that is
created from the IKE_SA_INIT exchange, can be immediately rekeyed with
CREATE_CHILD_SA with additional key exchanges, where IKE_FOLLOWUP_KE
messages are used for these additional key exchanges.  If the classical key exchange method is used in the
            IKE_SA_INIT message, the very first Child SA created in IKE_AUTH
            will offer no resistance against the quantum threats.
            Consequently, if the peers' local policy requires all Child
            SAs to be post-quantum secure, then the peers can avoid creating
            the very first Child SA by adopting <span>[<a class="cite xref" href="#RFC6023">RFC6023</a>]</span>.  In this case, the initiator sends two types
            of proposals in the IKE_SA_INIT request: one with and another one
            without ADDKE Transform Types.  The responder
            chooses the latter proposal type and includes a
            CHILDLESS_IKEV2_SUPPORTED notification in the IKE_SA_INIT
            response.  Assuming that the initiator supports childless IKE SA
            extension, both peers perform the modified IKE_AUTH exchange
            described in <span>[<a class="cite xref" href="#RFC6023">RFC6023</a>]</span>, and no
            Child SA is created in this exchange.  The peers should then
            immediately rekey the IKE SA and subsequently create the Child
            SAs, all with additional key exchanges using a CREATE_CHILD_SA
            exchange.<a class="pilcrow" href="#section-2.2.5.1-1">¶</a></p>
<p id="section-2.2.5.1-2">It is also possible for the initiator to send proposals without
            any ADDKE Transform Types in the IKE_SA_INIT message.
            In this instance, the responder will have no information
            about whether or not the initiator supports the extension in this
            specification.  This may not be efficient, as the responder will
            have to wait for the subsequent CREATE_CHILD_SA request to
            determine whether or not the initiator's request is appropriate
            for its local policy.<a class="pilcrow" href="#section-2.2.5.1-2">¶</a></p>
<p id="section-2.2.5.1-3">The support for childless IKE SA is not negotiated, but it is
            the responder that indicates the support for this mode.  As such,
            the responder cannot enforce that the initiator use this mode.
            Therefore, it is entirely possible that the initiator does not
            support this extension and sends IKE_AUTH request as per <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> instead of <span>[<a class="cite xref" href="#RFC6023">RFC6023</a>]</span>.  In this case, the responder
            may respond with an error that is not fatal, such as the NO_PROPOSAL_CHOSEN
            notify message type.<a class="pilcrow" href="#section-2.2.5.1-3">¶</a></p>
<p id="section-2.2.5.1-4">Note that if the initial IKE SA is used to transfer sensitive
            information, then this information will not be protected using the
            additional key exchanges, which may use post-quantum algorithms.
            In this arrangement, the peers will have to use post-quantum
            algorithm in Transform Type 4 in order to mitigate the risk of
            quantum attack.<a class="pilcrow" href="#section-2.2.5.1-4">¶</a></p>
</section>
</section>
</section>
</section>
</div>
<div id="IANA">
<section id="section-3">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-3-1">This document adds a new exchange type into the "IKEv2 Exchange
      Types" registry:<a class="pilcrow" href="#section-3-1">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-2">
<pre>44         IKE_FOLLOWUP_KE

</pre><a class="pilcrow" href="#section-3-2">¶</a>
</div>
<p id="section-3-3">This document renames Transform Type 4 defined in the "Transform Type Values" registry
        from "Diffie-Hellman Group (D-H)" to "Key Exchange Method (KE)".<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">This document renames the IKEv2 registry originally titled "Transform Type 4 - Diffie-Hellman Group Transform IDs" to
        "Transform Type 4 - Key Exchange Method Transform IDs".<a class="pilcrow" href="#section-3-4">¶</a></p>
<p id="section-3-5">This document adds the following Transform Types to the "Transform Type Values" registry:<a class="pilcrow" href="#section-3-5">¶</a></p>
<span id="name-transform-type-values-regis"></span><div id="transform-type-values">
<table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-transform-type-values-regis">"Transform Type Values" Registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Type</th>
            <th class="text-left" colspan="1" rowspan="1">Description</th>
            <th class="text-left" colspan="1" rowspan="1">Used In</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">6</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 1 (ADDKE1)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">7</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 2 (ADDKE2)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">8</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 3 (ADDKE3)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">9</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 4 (ADDKE4)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">10</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 5 (ADDKE5)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">11</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 6 (ADDKE6)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">12</td>
            <td class="text-left" colspan="1" rowspan="1">Additional Key Exchange 7 (ADDKE7)</td>
            <td class="text-left" colspan="1" rowspan="1">(optional in IKE, AH, ESP)</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-3-7">This document defines a new Notify Message Type in the "IKEv2 Notify Message Types - Status Types" registry:<a class="pilcrow" href="#section-3-7">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-8">
<pre>16441       ADDITIONAL_KEY_EXCHANGE

</pre><a class="pilcrow" href="#section-3-8">¶</a>
</div>
<p id="section-3-9">This document also defines a new Notify Message Type in the "IKEv2 Notify Message Types - Error Types" registry:<a class="pilcrow" href="#section-3-9">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-10">
<pre>47         STATE_NOT_FOUND

</pre><a class="pilcrow" href="#section-3-10">¶</a>
</div>
<p id="section-3-11">IANA has added the following instructions for designated
        experts for the "Transform Type 4 - Key Exchange Method Transform IDs" subregistry:<a class="pilcrow" href="#section-3-11">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-12.1">While adding new Key Exchange (KE) methods, the following considerations must be
        applied.  A KE method must take exactly one round-trip (one IKEv2
        exchange), and at the end of this exchange, both peers must be able to
        derive the shared secret. In addition, any public value that peers
        exchanged during a KE method must fit into a single IKEv2 payload.  If
        these restrictions are not met for a KE method, then there must be
        documentation on how this KE method is used in IKEv2.<a class="pilcrow" href="#section-3-12.1">¶</a>
</li>
      </ul>
<p id="section-3-13">IANA has also completed the following changes. It is assumed that
            [RFC9370] refers to this specification.<a class="pilcrow" href="#section-3-13">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-14.1">
          <p id="section-3-14.1.1">Added a reference to [RFC9370] in what was the "Transform Type 4 -
          Diffie-Hellman Group Transform IDs" registry.<a class="pilcrow" href="#section-3-14.1.1">¶</a></p>
</li>
        <li class="normal" id="section-3-14.2">
          <p id="section-3-14.2.1">Replaced the Note on what was the "Transform Type 4 - Diffie-Hellman Group
          Transform IDs" registry with the following notes:<a class="pilcrow" href="#section-3-14.2.1">¶</a></p>
<p id="section-3-14.2.2">This registry was originally named "Transform Type 4 -
     Diffie-Hellman Group Transform IDs" and was referenced using
     that name in a number of RFCs published prior to [RFC9370],
       which gave it the current title.<a class="pilcrow" href="#section-3-14.2.2">¶</a></p>
<p id="section-3-14.2.3">This registry is used by the "Key Exchange Method (KE)" transform type and by all "Additional Key Exchange (ADDKE)" transform types.<a class="pilcrow" href="#section-3-14.2.3">¶</a></p>
<p id="section-3-14.2.4">To find out requirement levels
   for Key Exchange Methods for IKEv2, see <span>[<a class="cite xref" href="#RFC8247">RFC8247</a>]</span>.<a class="pilcrow" href="#section-3-14.2.4">¶</a></p>
</li>
        <li class="normal" id="section-3-14.3">
          <p id="section-3-14.3.1">Appended [RFC9370] to the Reference column of Transform Type 4 in
     the "Transform Type Values" registry.<a class="pilcrow" href="#section-3-14.3.1">¶</a></p>
</li>
        <li class="normal" id="section-3-14.4">
          <p id="section-3-14.4.1">Added these notes to the "Transform Type Values" registry:<a class="pilcrow" href="#section-3-14.4.1">¶</a></p>
<p id="section-3-14.4.2">"Key Exchange Method (KE)" transform type was originally 
    named "Diffie-Hellman Group (D-H)" and was referenced by that name in a number of RFCs
    published prior to [RFC9370], which gave it the current title.<a class="pilcrow" href="#section-3-14.4.2">¶</a></p>
<p id="section-3-14.4.3">All "Additional Key Exchange (ADDKE)" entries use the same 
    "Transform Type 4 - Key Exchange Method Transform IDs"
    registry as the "Key Exchange Method (KE)" entry.<a class="pilcrow" href="#section-3-14.4.3">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="security">
<section id="section-4">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-4-1">The extension in this document is intended to mitigate two possible
      threats in IKEv2: the compromise of (EC)DH key exchange using
      Shor's algorithm while remaining backward compatible and the potential
      compromise of existing or future PQC key exchange algorithms.  To
      address the former threat, this extension allows the establishment of a
      shared secret by using multiple key exchanges: typically, one classical
      (EC)DH and the other one post-quantum algorithm.  In order to address
      the latter threat, multiple key exchanges using a post-quantum algorithm
      can be performed to form the shared key.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">Unlike key exchange methods (Transform Type 4), the Encryption
      Algorithm (Transform Type 1), the Pseudorandom Function (Transform Type
      2), and the Integrity Algorithm (Transform Type 3) are not susceptible
      to Shor's algorithm.  However, they are susceptible to Grover's attack
      <span>[<a class="cite xref" href="#GROVER">GROVER</a>]</span>, which allows a quantum
      computer to perform a brute force key search, using quadratically fewer
      steps than the classical counterpart.  Simply increasing the key length
      can mitigate this attack.  It was previously believed that one needed to
      double the key length of these algorithms.  However, there are a number
      of factors that suggest that it is quite unlikely to achieve the
      quadratic speedup using Grover's algorithm.  According to NIST <span>[<a class="cite xref" href="#NISTPQCFAQ">NISTPQCFAQ</a>]</span>, current applications can
      continue using an AES algorithm with the minimum key length of 128 bits.
      Nevertheless, if the data needs to remain secure for many years to come,
      one may want to consider using a longer key size for the algorithms in
      Transform Types 1-3.<a class="pilcrow" href="#section-4-2">¶</a></p>
<p id="section-4-3">SKEYSEED is calculated from shared SK(x), using an algorithm defined
     in Transform Type 2.  While a quantum attacker may learn the value
     of SK(x), if this value is obtained by means of a classical key exchange,
     other SK(x) values generated by means of a post-quantum algorithm
     ensure that the final SKEYSEED is not compromised.  This assumes that
     the algorithm defined in the Transform Type 2 is quantum resistant.<a class="pilcrow" href="#section-4-3">¶</a></p>
<p id="section-4-4">The ordering of the additional key exchanges should not matter in
      general, as only the final shared secret is of interest.  Nonetheless,
      because the strength of the running shared secret increases with every
      additional key exchange, an implementer may want to first perform the
      most secure method (in some metrics) followed by less secure
      methods.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">The main focus of this document is to prevent a passive attacker from
  performing a "harvest-and-decrypt" attack: in other words, attackers that record
  messages exchanged today and proceed to decrypt them once they have access
  to cryptographically relevant quantum computers.  This attack is prevented due to the hybrid
        nature of the key exchange.  Other attacks involving an active attacker
        using a quantum-computer are not completely solved by this
        document.  This is for two reasons:<a class="pilcrow" href="#section-4-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-6.1">The first reason is that the authentication step remains
        classical.  In particular, the authenticity of the SAs established
        under IKEv2 is protected by using a pre-shared key or digital signature
        algorithms.  While the pre-shared key option, provided the key is
        long enough, is post-quantum secure, the other algorithms are not.   Moreover,
        in implementations where scalability is a requirement, the pre-shared
        key method may not be suitable.  Post-quantum authenticity may be
        provided by using a post-quantum digital signature.<a class="pilcrow" href="#section-4-6.1">¶</a>
</li>
        <li class="normal" id="section-4-6.2">Secondly, it should be noted that the purpose of post-quantum algorithms is
        to provide resistance to attacks mounted in the future.  The current
        threat is that encrypted sessions are subject to eavesdropping and are
        archived with decryption by quantum computers at some
        point in the future.  Until quantum computers become available, there
        is no point in attacking the authenticity of a connection because
        there are no possibilities for exploitation.  These only occur at
        the time of the connection, for example, by mounting an on-path
        attack.  Consequently, there is less urgency for
        post-quantum authenticity compared to post-quantum confidentiality.<a class="pilcrow" href="#section-4-6.2">¶</a>
</li>
      </ul>
<p id="section-4-7"> Performing multiple key exchanges while establishing an IKE SA
      increases the responder's susceptibility to DoS attacks because of an
      increased amount of resources needed before the initiator is
      authenticated.  This is especially true for post-quantum key exchange
      methods, where many of them are more memory and/or CPU intensive than
      the classical counterparts.<a class="pilcrow" href="#section-4-7">¶</a></p>
<p id="section-4-8"> Responders may consider recommendations from <span>[<a class="cite xref" href="#RFC8019">RFC8019</a>]</span> to deal with increased DoS-attack susceptibility.  It
      is also possible that the responder only agrees to create an initial IKE SA
      without performing additional key exchanges if the initiator includes
      such an option in its proposals.  Then, peers immediately rekey the
      initial IKE SA with the CREATE_CHILD_SA exchange, and additional key
      exchanges are performed via the IKE_FOLLOWUP_KE exchanges.  In this
      case, at the point when resource-intensive operations are required, the
      peers have already authenticated each other.  However, in the context of
      hybrid post-quantum key exchanges, this scenario would leave the initial
      IKE SA (and initial Child SA, if it is created) unprotected against
      quantum computers. Nevertheless, the rekeyed IKE SA (and Child SAs that
      will be created over it) will have a full protection.  This is similar
      to the scenario described in <span>[<a class="cite xref" href="#RFC8784">RFC8784</a>]</span>.
      Depending on the arrangement and peers' policy, this scenario may or may
      not be appropriate.  For example, in the G-IKEv2 protocol <span>[<a class="cite xref" href="#I-D.ietf-ipsecme-g-ikev2">G-IKEV2</a>]</span>, the cryptographic
      materials are sent from the group controller to the group members when
      the initial IKE SA is created.<a class="pilcrow" href="#section-4-8">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9242">[RFC9242]</dt>
      <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Intermediate Exchange in the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 9242</span>, <span class="seriesInfo">DOI 10.17487/RFC9242</span>, <time class="refDate" datetime="2022-05">May 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9242">https://www.rfc-editor.org/info/rfc9242</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-5.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.tjhai-ikev2-beyond-64k-limit">[BEYOND-64K]</dt>
        <dd>
<span class="refAuthor">Tjhai, CJ.</span>, <span class="refAuthor">Heider, T.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Beyond 64KB Limit of IKEv2 Payloads"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-tjhai-ikev2-beyond-64k-limit-03</span>, <time class="refDate" datetime="2022-07-28">28 July 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-tjhai-ikev2-beyond-64k-limit-03">https://datatracker.ietf.org/doc/html/draft-tjhai-ikev2-beyond-64k-limit-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ipsecme-g-ikev2">[G-IKEV2]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span> and <span class="refAuthor">B. Weis</span>, <span class="refTitle">"Group Key Management using IKEv2"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ipsecme-g-ikev2-09</span>, <time class="refDate" datetime="2023-04-19">19 April 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ipsecme-g-ikev2-09">https://datatracker.ietf.org/doc/html/draft-ietf-ipsecme-g-ikev2-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GROVER">[GROVER]</dt>
        <dd>
<span class="refAuthor">Grover, L.</span>, <span class="refTitle">"A fast quantum mechanical algorithm for database search"</span>, <span class="seriesInfo">Proc. of the Twenty-Eighth Annual ACM Symposium on the Theory of Computing (STOC), pp. 212-219</span>, <span class="seriesInfo">DOI 10.48550/arXiv.quant-ph/9605043</span>, <time class="refDate" datetime="1996-05">May 1996</time>, <span>&lt;<a href="https://doi.org/10.48550/arXiv.quant-ph/9605043">https://doi.org/10.48550/arXiv.quant-ph/9605043</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IKEV2TYPE4ID">[IKEV2TYPE4ID]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Internet Key Exchange Version 2 (IKEv2) Parameters: Transform Type 4 - Diffie-Hellman Group Transform IDs"</span>, <span>&lt;<a href="https://www.iana.org/assignments/ikev2-parameters/">https://www.iana.org/assignments/ikev2-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NISTPQCFAQ">[NISTPQCFAQ]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Post-Quantum Cryptography Standard"</span>, <time class="refDate" datetime="2023-01">January 2023</time>, <span>&lt;<a href="https://csrc.nist.gov/Projects/post-quantum-cryptography/faqs">https://csrc.nist.gov/Projects/post-quantum-cryptography/faqs</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5723">[RFC5723]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2) Session Resumption"</span>, <span class="seriesInfo">RFC 5723</span>, <span class="seriesInfo">DOI 10.17487/RFC5723</span>, <time class="refDate" datetime="2010-01">January 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5723">https://www.rfc-editor.org/info/rfc5723</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6023">[RFC6023]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Deng, H.</span>, and <span class="refAuthor">R. Singh</span>, <span class="refTitle">"A Childless Initiation of the Internet Key Exchange Version 2 (IKEv2) Security Association (SA)"</span>, <span class="seriesInfo">RFC 6023</span>, <span class="seriesInfo">DOI 10.17487/RFC6023</span>, <time class="refDate" datetime="2010-10">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6023">https://www.rfc-editor.org/info/rfc6023</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7383">[RFC7383]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2) Message Fragmentation"</span>, <span class="seriesInfo">RFC 7383</span>, <span class="seriesInfo">DOI 10.17487/RFC7383</span>, <time class="refDate" datetime="2014-11">November 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7383">https://www.rfc-editor.org/info/rfc7383</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8019">[RFC8019]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span> and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Protecting Internet Key Exchange Protocol Version 2 (IKEv2) Implementations from Distributed Denial-of-Service Attacks"</span>, <span class="seriesInfo">RFC 8019</span>, <span class="seriesInfo">DOI 10.17487/RFC8019</span>, <time class="refDate" datetime="2016-11">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8019">https://www.rfc-editor.org/info/rfc8019</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8247">[RFC8247]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Kivinen, T.</span>, <span class="refAuthor">Wouters, P.</span>, and <span class="refAuthor">D. Migault</span>, <span class="refTitle">"Algorithm Implementation Requirements and Usage Guidance for the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 8247</span>, <span class="seriesInfo">DOI 10.17487/RFC8247</span>, <time class="refDate" datetime="2017-09">September 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8247">https://www.rfc-editor.org/info/rfc8247</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8784">[RFC8784]</dt>
      <dd>
<span class="refAuthor">Fluhrer, S.</span>, <span class="refAuthor">Kampanakis, P.</span>, <span class="refAuthor">McGrew, D.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security"</span>, <span class="seriesInfo">RFC 8784</span>, <span class="seriesInfo">DOI 10.17487/RFC8784</span>, <time class="refDate" datetime="2020-06">June 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8784">https://www.rfc-editor.org/info/rfc8784</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sample-exchanges">
<section id="appendix-A">
      <h2 id="name-sample-multiple-key-exchang">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-sample-multiple-key-exchang">Sample Multiple Key Exchanges</a>
      </h2>
<p id="appendix-A-1">This appendix shows some examples of multiple key exchanges.  These
      examples are not normative, and they describe some message flow scenarios
      that may occur in establishing an IKE or Child SA.  Note that some
      payloads that are not relevant to multiple key exchanges may be omitted
      for brevity.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<div id="sample-ake-ike-intermediate">
<section id="appendix-A.1">
        <h3 id="name-ike_intermediate-exchanges-">
<a class="section-number selfRef" href="#appendix-A.1">A.1. </a><a class="section-name selfRef" href="#name-ike_intermediate-exchanges-">IKE_INTERMEDIATE Exchanges Carrying Additional Key Exchange Payloads</a>
        </h3>
<p id="appendix-A.1-1">The exchanges below show that the initiator proposes the use of
        additional key exchanges to establish an IKE SA.  The initiator
        proposes three sets of additional key exchanges, all of which are
        optional.  Therefore, the responder can choose NONE for some or all of
        the additional exchanges if the proposed key exchange methods are not
        supported or for whatever reasons the responder decides not to perform
        the additional key exchange.<a class="pilcrow" href="#appendix-A.1-1">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.1-2">
<pre>Initiator                     Responder
---------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1(.. ADDKE*...), ---&gt;
KEi(Curve25519), Ni, N(IKEV2_FRAG_SUPPORTED),
N(INTERMEDIATE_EXCHANGE_SUPPORTED)
    Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                    256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform ADDKE1 (ID = PQ_KEM_1)
    Transform ADDKE1 (ID = PQ_KEM_2)
    Transform ADDKE1 (ID = NONE)
    Transform ADDKE2 (ID = PQ_KEM_3)
    Transform ADDKE2 (ID = PQ_KEM_4)
    Transform ADDKE2 (ID = NONE)
    Transform ADDKE3 (ID = PQ_KEM_5)
    Transform ADDKE3 (ID = PQ_KEM_6)
    Transform ADDKE3 (ID = NONE)
                   &lt;--- HDR(IKE_SA_INIT), SAr1(.. ADDKE*...),
                        KEr(Curve25519), Nr, N(IKEV2_FRAG_SUPPORTED),
                        N(INTERMEDIATE_EXCHANGE_SUPPORTED)
                        Proposal #1
                          Transform ECR (ID = ENCR_AES_GCM_16,
                                         256-bit key)
                          Transform PRF (ID = PRF_HMAC_SHA2_512)
                          Transform KE (ID = Curve25519)
                          Transform ADDKE1 (ID = PQ_KEM_2)
                          Transform ADDKE2 (ID = NONE)
                          Transform ADDKE3 (ID = PQ_KEM_5)

HDR(IKE_INTERMEDIATE), SK {KEi(1)(PQ_KEM_2)} --&gt;
                   &lt;--- HDR(IKE_INTERMEDIATE), SK {KEr(1)(PQ_KEM_2)}
HDR(IKE_INTERMEDIATE), SK {KEi(2)(PQ_KEM_5)} --&gt;
                   &lt;--- HDR(IKE_INTERMEDIATE), SK {KEr(2)(PQ_KEM_5)}

HDR(IKE_AUTH), SK{ IDi, AUTH, SAi2, TSi, TSr } ---&gt;
                      &lt;--- HDR(IKE_AUTH), SK{ IDr, AUTH, SAr2,
                           TSi, TSr }

</pre><a class="pilcrow" href="#appendix-A.1-2">¶</a>
</div>
<p id="appendix-A.1-3">In this particular example, the responder chooses to perform two
        additional key exchanges.  It selects PQ_KEM_2, NONE, and PQ_KEM_5 for
        the first, second, and third additional key exchanges, respectively.  As
        per <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>, a set of
        keying materials is derived, in particular SK_d, SK_a[i/r], and
        SK_e[i/r].  Both peers then perform an IKE_INTERMEDIATE exchange,
        carrying PQ_KEM_2 payload, which is protected with SK_e[i/r] and
        SK_a[i/r] keys.  After the completion of this IKE_INTERMEDIATE
        exchange, the SKEYSEED is updated using SK(1), which is the PQ_KEM_2
        shared secret, as follows.<a class="pilcrow" href="#appendix-A.1-3">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-4">
<pre>SKEYSEED(1) = prf(SK_d, SK(1) | Ni | Nr)

</pre><a class="pilcrow" href="#appendix-A.1-4">¶</a>
</div>
<p id="appendix-A.1-5">The updated SKEYSEED value is then used to derive the following keying materials.<a class="pilcrow" href="#appendix-A.1-5">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-6">
<pre>{SK_d(1) | SK_ai(1) | SK_ar(1) | SK_ei(1) | SK_er(1) | SK_pi(1) |
 SK_pr(1)} = prf+ (SKEYSEED(1), Ni | Nr | SPIi | SPIr)

</pre><a class="pilcrow" href="#appendix-A.1-6">¶</a>
</div>
<p id="appendix-A.1-7">As per <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>,
        both peers compute IntAuth_i1 and IntAuth_r1 using the SK_pi(1) and
        SK_pr(1) keys, respectively.  These values are required in the IKE_AUTH
        phase of the exchange.<a class="pilcrow" href="#appendix-A.1-7">¶</a></p>
<p id="appendix-A.1-8">In the next IKE_INTERMEDIATE exchange, the peers use SK_e[i/r](1)
        and SK_a[i/r](1) keys to protect the PQ_KEM_5 payload.  After
        completing this exchange, keying materials are updated as follows:<a class="pilcrow" href="#appendix-A.1-8">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-9">
<pre>SKEYSEED(2) = prf(SK_d(1), SK(2) | Ni | Nr)
{SK_d(2) | SK_ai(2) | SK_ar(2) | SK_ei(2) | SK_er(2) | SK_pi(2) |
    SK_pr(2)} = prf+ (SKEYSEED(2), Ni | Nr | SPIi | SPIr)

</pre><a class="pilcrow" href="#appendix-A.1-9">¶</a>
</div>
<p id="appendix-A.1-10">In this update, SK(2) is the shared secret from the third
        additional key exchange, i.e., PQ_KEM_5.  Then, both peers compute the
        values of IntAuth_[i/r]2 using the SK_p[i/r](2) keys.<a class="pilcrow" href="#appendix-A.1-10">¶</a></p>
<p id="appendix-A.1-11">After the completion of the second IKE_INTERMEDIATE exchange, both
        peers continue to the IKE_AUTH exchange phase.  As defined in <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>, the values IntAuth_[i/r]2 are
        used to compute IntAuth, which, in turn, is used to calculate  InitiatorSignedOctets and
ResponderSignedOctets blobs (see <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9242#section-3.3.2">Section 3.3.2</a> of [<a class="cite xref" href="#RFC9242">RFC9242</a>]</span>).<a class="pilcrow" href="#appendix-A.1-11">¶</a></p>
</section>
</div>
<div id="sample-exchanges-none-selected">
<section id="appendix-A.2">
        <h3 id="name-no-additional-key-exchange-">
<a class="section-number selfRef" href="#appendix-A.2">A.2. </a><a class="section-name selfRef" href="#name-no-additional-key-exchange-">No Additional Key Exchange Used</a>
        </h3>
<p id="appendix-A.2-1">The initiator proposes two sets of optional additional key
        exchanges, but the responder does not support any of them.  The
        responder chooses NONE for each set. Consequently, the
        IKE_INTERMEDIATE exchange does not take place, and the exchange
        proceeds to the IKE_AUTH phase.  The resulting keying materials are the
        same as those derived with <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.<a class="pilcrow" href="#appendix-A.2-1">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.2-2">
<pre>Initiator                     Responder
---------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1(.. ADDKE*...), ---&gt;
KEi(Curve25519), Ni, N(IKEV2_FRAG_SUPPORTED),
N(INTERMEDIATE_EXCHANGE_SUPPORTED)
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform ADDKE1 (ID = PQ_KEM_1)
    Transform ADDKE1 (ID = PQ_KEM_2)
    Transform ADDKE1 (ID = NONE)
    Transform ADDKE2 (ID = PQ_KEM_3)
    Transform ADDKE2 (ID = PQ_KEM_4)
    Transform ADDKE2 (ID = NONE)
                   &lt;--- HDR(IKE_SA_INIT), SAr1(.. ADDKE*...),
                        KEr(Curve25519), Nr, N(IKEV2_FRAG_SUPPORTED),
                        N(INTERMEDIATE_EXCHANGE_SUPPORTED)
                          Proposal #1
                            Transform ECR (ID = ENCR_AES_GCM_16,
                                           256-bit key)
                            Transform PRF (ID = PRF_HMAC_SHA2_512)
                            Transform KE (ID = Curve25519)
                            Transform ADDKE1 (ID = NONE)
                            Transform ADDKE2 (ID = NONE)

HDR(IKE_AUTH), SK{ IDi, AUTH, SAi2, TSi, TSr } ---&gt;
                   &lt;--- HDR(IKE_AUTH), SK{ IDr, AUTH, SAr2,
                        TSi, TSr }

</pre><a class="pilcrow" href="#appendix-A.2-2">¶</a>
</div>
</section>
</div>
<div id="sample-exchanges-ake-child-sas">
<section id="appendix-A.3">
        <h3 id="name-additional-key-exchange-in-">
<a class="section-number selfRef" href="#appendix-A.3">A.3. </a><a class="section-name selfRef" href="#name-additional-key-exchange-in-">Additional Key Exchange in the CREATE_CHILD_SA Exchange Only</a>
        </h3>
<p id="appendix-A.3-1">The exchanges below show that the initiator does not propose the
        use of additional key exchanges to establish an IKE SA, but they are
        required in order to establish a Child SA.  In order to establish a
        fully quantum-resistant IPsec SA, the responder includes a
        CHILDLESS_IKEV2_SUPPORTED notification in their IKE_SA_INIT response
        message.  The initiator understands and supports this notification,
        exchanges a modified IKE_AUTH message with the responder, and
        rekeys the IKE SA immediately with additional key exchanges.  Any
        Child SA will have to be created via a subsequent CREATED_CHILD_SA
        exchange.<a class="pilcrow" href="#appendix-A.3-1">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.3-2">
<pre>Initiator                     Responder
---------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1, ---&gt;
KEi(Curve25519), Ni, N(IKEV2_FRAG_SUPPORTED)
                   &lt;--- HDR(IKE_SA_INIT), SAr1,
                        KEr(Curve25519), Nr, N(IKEV2_FRAG_SUPPORTED),
                        N(CHILDLESS_IKEV2_SUPPORTED)

HDR(IKE_AUTH), SK{ IDi, AUTH  } ---&gt;
                   &lt;--- HDR(IKE_AUTH), SK{ IDr, AUTH }

HDR(CREATE_CHILD_SA),
      SK{ SAi(.. ADDKE*...), Ni, KEi(Curve25519) } ---&gt;
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform ADDKE1 (ID = PQ_KEM_1)
    Transform ADDKE1 (ID = PQ_KEM_2)
    Transform ADDKE2 (ID = PQ_KEM_5)
    Transform ADDKE2 (ID = PQ_KEM_6)
    Transform ADDKE2 (ID = NONE)
                   &lt;--- HDR(CREATE_CHILD_SA), SK{ SAr(.. ADDKE*...),
                        Nr, KEr(Curve25519),
                        N(ADDITIONAL_KEY_EXCHANGE)(link1) }
                          Proposal #1
                            Transform ECR (ID = ENCR_AES_GCM_16,
                                           256-bit key)
                            Transform PRF (ID = PRF_HMAC_SHA2_512)
                            Transform KE (ID = Curve25519)
                            Transform ADDKE1 (ID = PQ_KEM_2)
                            Transform ADDKE2 (ID = PQ_KEM_5)

HDR(IKE_FOLLOWUP_KE), SK{ KEi(1)(PQ_KEM_2), ---&gt;
N(ADDITIONAL_KEY_EXCHANGE)(link1) }
                  &lt;--- HDR(IKE_FOLLOWUP_KE), SK{ KEr(1)(PQ_KEM_2),
                        N(ADDITIONAL_KEY_EXCHANGE)(link2) }

HDR(IKE_FOLLOWUP_KE), SK{ KEi(2)(PQ_KEM_5), ---&gt;
N(ADDITIONAL_KEY_EXCHANGE)(link2) }
                  &lt;--- HDR(IKE_FOLLOWUP_KE), SK{ KEr(2)(PQ_KEM_5) }

</pre><a class="pilcrow" href="#appendix-A.3-2">¶</a>
</div>
</section>
</div>
<div id="sample-exchanges-no-proposal-chosen">
<section id="appendix-A.4">
        <h3 id="name-no-matching-proposal-for-ad">
<a class="section-number selfRef" href="#appendix-A.4">A.4. </a><a class="section-name selfRef" href="#name-no-matching-proposal-for-ad">No Matching Proposal for Additional Key Exchanges</a>
        </h3>
<p id="appendix-A.4-1">The initiator proposes the combination of PQ_KEM_1, PQ_KEM_2,
        PQ_KEM_3, and PQ_KEM_4 as the additional key exchanges.  The initiator
        indicates that either PQ_KEM_1 or PQ_KEM_2 must be used to establish
        an IKE SA, but ADDKE2 Transform Type is optional. Therefore, the
        responder can either select PQ_KEM_3 or PQ_KEM_4 or omit this key
        exchange by selecting NONE.  Although the responder supports the
        optional PQ_KEM_3 and PQ_KEM_4 methods, it does not support
        either the PQ_KEM_1 or the PQ_KEM_2 mandatory method; therefore, it responds
        with a NO_PROPOSAL_CHOSEN notification.<a class="pilcrow" href="#appendix-A.4-1">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.4-2">
<pre>Initiator                     Responder
---------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1(.. ADDKE*...), ---&gt;
KEi(Curve25519), Ni, N(IKEV2_FRAG_SUPPORTED),
N(INTERMEDIATE_EXCHANGE_SUPPORTED)
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform ADDKE1 (ID = PQ_KEM_1)
    Transform ADDKE1 (ID = PQ_KEM_2)
    Transform ADDKE2 (ID = PQ_KEM_3)
    Transform ADDKE2 (ID = PQ_KEM_4)
    Transform ADDKE2 (ID = NONE)
                         &lt;--- HDR(IKE_SA_INIT), N(NO_PROPOSAL_CHOSEN)

</pre><a class="pilcrow" href="#appendix-A.4-2">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="design">
<section id="appendix-B">
      <h2 id="name-design-criteria">
<a class="section-number selfRef" href="#appendix-B">Appendix B. </a><a class="section-name selfRef" href="#name-design-criteria">Design Criteria</a>
      </h2>
<p id="appendix-B-1">
        The design of the extension is driven by the
        following criteria:<a class="pilcrow" href="#appendix-B-1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="appendix-B-2">
        <dt>1)</dt>
<dd id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">Need for PQC in IPsec<a class="pilcrow" href="#appendix-B-2.1.1">¶</a></p>
<p id="appendix-B-2.1.2">Quantum computers, which might become feasible in the near future,
 pose a threat to our classical public key cryptography.  PQC, a family
 of public key cryptography that is believed to be resistant to
 these computers, needs to be integrated into the IPsec protocol suite
 to restore confidentiality and authenticity.<a class="pilcrow" href="#appendix-B-2.1.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>2)</dt>
<dd id="appendix-B-2.2">
          <p id="appendix-B-2.2.1">Hybrid<a class="pilcrow" href="#appendix-B-2.2.1">¶</a></p>
<p id="appendix-B-2.2.2">There is currently no post-quantum key exchange that is trusted at
 the level that (EC)DH is trusted for defending against conventional
 (non-quantum) adversaries.  A hybrid post-quantum algorithm to be
 introduced, along with the well-established primitives, addresses this
 concern, since the overall security is at least as strong as each
 individual primitive.<a class="pilcrow" href="#appendix-B-2.2.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>3)</dt>
<dd id="appendix-B-2.3">
          <p id="appendix-B-2.3.1">Focus on post-quantum confidentiality<a class="pilcrow" href="#appendix-B-2.3.1">¶</a></p>
<p id="appendix-B-2.3.2">A passive attacker can store
     all monitored encrypted IPsec communication today and decrypt it once
     a quantum computer is available in the future.  This attack can have
     serious consequences that will not be visible for years to come.  On
     the other hand, an attacker can only perform active attacks, such as
     impersonation of the communicating peers, once a quantum computer is
     available sometime in the future.  Thus, this specification focuses
     on confidentiality due to the urgency of this problem and presents a
     defense against the serious attack described above, but it does not
     address authentication because it is less urgent at this stage.<a class="pilcrow" href="#appendix-B-2.3.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>4)</dt>
<dd id="appendix-B-2.4">
          <p id="appendix-B-2.4.1">Limit the amount of exchanged data<a class="pilcrow" href="#appendix-B-2.4.1">¶</a></p>
<p id="appendix-B-2.4.2">The protocol design should be
     such that the amount of exchanged data, such as public keys, is
        kept as small as possible, even if the initiator and the responder need
        to agree on a hybrid group or if multiple public keys need to be
        exchanged.<a class="pilcrow" href="#appendix-B-2.4.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>5)</dt>
<dd id="appendix-B-2.5">
          <p id="appendix-B-2.5.1">Not post-quantum specific<a class="pilcrow" href="#appendix-B-2.5.1">¶</a></p>
<p id="appendix-B-2.5.2">Any cryptographic algorithm could be potentially
     broken in the future by currently unknown or impractical
        attacks. Quantum computers are merely the most concrete example
        of this.  The design does not categorize algorithms as "post-quantum"
     or "non-post-quantum", nor does it create assumptions
        about the properties of the algorithms; meaning that if
        algorithms with different properties become necessary in the future,
        this extension can be used unchanged to facilitate migration to
        those algorithms.<a class="pilcrow" href="#appendix-B-2.5.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>6)</dt>
<dd id="appendix-B-2.6">
          <p id="appendix-B-2.6.1">Limited amount of changes<a class="pilcrow" href="#appendix-B-2.6.1">¶</a></p>
<p id="appendix-B-2.6.2">A key goal is to limit the number of
     changes required when enabling a post-quantum handshake.  This
        ensures easier and quicker adoption in existing implementations.<a class="pilcrow" href="#appendix-B-2.6.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>7)</dt>
<dd id="appendix-B-2.7">
          <p id="appendix-B-2.7.1">Localized changes<a class="pilcrow" href="#appendix-B-2.7.1">¶</a></p>
<p id="appendix-B-2.7.2">Another key requirement is that changes to
     the protocol are limited in scope, in particular, limiting
        changes in the exchanged messages and in the state machine, so
        that they can be easily implemented.<a class="pilcrow" href="#appendix-B-2.7.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>8)</dt>
<dd id="appendix-B-2.8">
          <p id="appendix-B-2.8.1">Deterministic operation<a class="pilcrow" href="#appendix-B-2.8.1">¶</a></p>
<p id="appendix-B-2.8.2">This requirement means that the hybrid post-quantum exchange and, thus,
 the computed keys will be based on algorithms that both client and
 server wish to support.<a class="pilcrow" href="#appendix-B-2.8.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>9)</dt>
<dd id="appendix-B-2.9">
          <p id="appendix-B-2.9.1">Fragmentation support<a class="pilcrow" href="#appendix-B-2.9.1">¶</a></p>
<p id="appendix-B-2.9.2">Some PQC algorithms could be relatively
     bulky and might require fragmentation.  Thus, a design goal
        is the adaptation and adoption of an existing fragmentation
        method or the design of a new method that allows for the
        fragmentation of the key shares.<a class="pilcrow" href="#appendix-B-2.9.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>10)</dt>
<dd id="appendix-B-2.10">
          <p id="appendix-B-2.10.1">Backward compatibility and interoperability<a class="pilcrow" href="#appendix-B-2.10.1">¶</a></p>
<p id="appendix-B-2.10.2">This is a fundamental
     requirement to ensure that hybrid post-quantum IKEv2 and standard
     IKEv2 implementations as per <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>
     are interoperable.<a class="pilcrow" href="#appendix-B-2.10.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>11)</dt>
<dd id="appendix-B-2.11">
          <p id="appendix-B-2.11.1">Compliance with USA Federal Information Processing Standards (FIPS)<a class="pilcrow" href="#appendix-B-2.11.1">¶</a></p>
<p id="appendix-B-2.11.2">IPsec is widely used in Federal Information Systems, and FIPS
 certification is an important requirement.  However, at the time of
 writing, none of the algorithms that is believed to be post-quantum is yet
 FIPS compliant.  Nonetheless, it is possible to combine this
 post-quantum algorithm with a FIPS-compliant key establishment method
 so that the overall design remains FIPS compliant <span>[<a class="cite xref" href="#NISTPQCFAQ">NISTPQCFAQ</a>]</span>.<a class="pilcrow" href="#appendix-B-2.11.2">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt>12)</dt>
<dd id="appendix-B-2.12">
          <p id="appendix-B-2.12.1">Ability to use this method with multiple classical (EC)DH key
        exchanges<a class="pilcrow" href="#appendix-B-2.12.1">¶</a></p>
<p id="appendix-B-2.12.2">In some situations, peers have no single, mutually trusted, key
        exchange algorithm (e.g., due to local policy restrictions).  The
        ability to combine two (or more) key exchange methods in such a way
        that the resulting shared key depends on all of them allows peers to
        communicate in this situation.<a class="pilcrow" href="#appendix-B-2.12.2">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="altdesign">
<section id="appendix-C">
      <h2 id="name-alternative-design">
<a class="section-number selfRef" href="#appendix-C">Appendix C. </a><a class="section-name selfRef" href="#name-alternative-design">Alternative Design</a>
      </h2>
<p id="appendix-C-1">
        This section gives an overview on a number of alternative approaches
        that have been considered but later discarded.  These approaches are as follows.<a class="pilcrow" href="#appendix-C-1">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C-2.1">
          <p id="appendix-C-2.1.1">Sending the classical and post-quantum key
        exchanges as a single transform<a class="pilcrow" href="#appendix-C-2.1.1">¶</a></p>
<p id="appendix-C-2.1.2">
        A method to combine the various key exchanges into a single large KE
        payload was considered. This effort is documented in a previous
        version of this document (draft-tjhai-ipsecme-hybrid-qske-ikev2-01).
        This method allows us to cleanly apply hybrid key exchanges during the
        Child SA. However, it does add considerable complexity and requires an
        independent fragmentation solution.<a class="pilcrow" href="#appendix-C-2.1.2">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.2">
          <p id="appendix-C-2.2.1">Sending post-quantum proposals and policies in the KE payload
        only<a class="pilcrow" href="#appendix-C-2.2.1">¶</a></p>
<p id="appendix-C-2.2.2">

        With the objective of not introducing unnecessary notify payloads, a
        method to communicate the hybrid post-quantum proposal in the KE
        payload during the first pass of the protocol exchange was considered.
        Unfortunately, this design is susceptible to the following downgrade
        attack.  Consider the scenario where there is an on-path attacker
        sitting between an initiator and a responder. Through the SAi payload, the
        initiator proposes using a hybrid post-quantum group and, as a
        fallback, a Diffie-Hellman group; and through the KEi payload, the
        initiator proposes a list of hybrid post-quantum proposals and
        policies.  The on-path attacker intercepts this traffic and replies
        with N(INVALID_KE_PAYLOAD), suggesting a downgrade to the fallback
        Diffie-Hellman group instead.  The initiator then resends the same SAi
        payload and the KEi payload containing the public value of the
        fallback Diffie-Hellman group.  Note that the attacker may forward the
        second IKE_SA_INIT message only to the responder. Therefore, at this
        point in time, the responder will not have the information that the
        initiator prefers the hybrid group. Of course, it is possible for the
        responder to have a policy to reject an IKE_SA_INIT message that (a)
        offers a hybrid group but does not offer the corresponding public value
        in the KEi payload and (b) the responder has not specifically
        acknowledged that it does not support the requested hybrid group.
        However, the checking of this policy introduces unnecessary protocol
        complexity.  Therefore, in order to fully prevent any downgrade
        attacks, using a KE payload alone is not sufficient, and the initiator
        <span class="bcp14">MUST</span> always indicate its preferred post-quantum
        proposals and policies in a notify payload in the subsequent
        IKE_SA_INIT messages following an N(INVALID_KE_PAYLOAD) response.<a class="pilcrow" href="#appendix-C-2.2.2">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.3">
          <p id="appendix-C-2.3.1">New payload types to negotiate hybrid proposals and to carry
          post-quantum public values<a class="pilcrow" href="#appendix-C-2.3.1">¶</a></p>
<p id="appendix-C-2.3.2">
        Semantically, it makes sense to use a new payload type, which mimics
        the SA payload, to carry a hybrid proposal.  Likewise, another new
        payload type that mimics the KE payload could be used to transport
        hybrid public value.  Although, in theory, a new payload type could be
        made backward compatible by not setting its critical flag as per
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.5">Section 2.5</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>, it is
        believed that it may not be that simple in practice.  Since the
        original release of IKEv2 in RFC 4306, no new payload type has ever
        been proposed; therefore, this creates a potential risk of having a
        backward-compatibility issue from nonconformant IKEv2
        implementations.  Since there appears to be no other compelling
        advantages apart from a semantic one, the existing Transform Type and
        notify payloads are used instead.<a class="pilcrow" href="#appendix-C-2.3.2">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.4">
          <p id="appendix-C-2.4.1">Hybrid public value payload<a class="pilcrow" href="#appendix-C-2.4.1">¶</a></p>
<p id="appendix-C-2.4.2">
        One way to transport the negotiated hybrid public payload, which
        contains one classical Diffie-Hellman public value and one or more
        post-quantum public values, is to bundle these into a single KE
        payload.  Alternatively, these could also be transported in a single
        new hybrid public value payload. However, following the same reasoning
        as above may not be a good idea from a backward-compatibility
        perspective.  Using a single KE payload would require encoding or
        formatting to be defined so that both peers are able to compose and
        extract the individual public values.  However, it is believed that it
        is cleaner to send the hybrid public values in multiple KE payloads:
        one for each group or algorithm.  Furthermore, at this point in the
        protocol exchange, both peers should have indicated support for
        handling multiple KE payloads.<a class="pilcrow" href="#appendix-C-2.4.2">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.5">
          <p id="appendix-C-2.5.1">Fragmentation<a class="pilcrow" href="#appendix-C-2.5.1">¶</a></p>
<p id="appendix-C-2.5.2">
        The handling of large IKE_SA_INIT messages has been one of the most
        challenging tasks.  A number of approaches have been considered,
        and the two prominent ones that have been discarded are outlined as
        follows.<a class="pilcrow" href="#appendix-C-2.5.2">¶</a></p>
<p id="appendix-C-2.5.3">
        The first approach is to treat the entire IKE_SA_INIT message as
        a stream of bytes, which is then split into a number of
        fragments, each of which is wrapped onto a payload that will fit
        into the size of the network MTU.  The payload that wraps each
        fragment has a new payload type, and it is envisaged that this new
        payload type will not cause a backward-compatibility issue because,
        at this stage of the protocol, both peers should have indicated
        support of fragmentation in the first pass of the IKE_SA_INIT
        exchange.  The negotiation of fragmentation is performed using a
        notify payload, which also defines supporting parameters, such as
        the size of fragment in octets and the fragment identifier.  The
        new payload that wraps each fragment of the messages in this
        exchange is assigned the same fragment identifier. Furthermore, it
        also has other parameters, such as a fragment index and total
        number of fragments.  This approach has been discarded due to
        its blanket approach to fragmentation.  In cases where only a few
        payloads need to be fragmented, this approach appears to be
        overly complicated.<a class="pilcrow" href="#appendix-C-2.5.3">¶</a></p>
<p id="appendix-C-2.5.4">
        Another idea that has been discarded is fragmenting an individual
        payload without introducing a new payload type.  The idea is to
        use the 9-th bit (the bit after the critical flag in the RESERVED
        field) in the generic payload header as a flag to mark that this
        payload is fragmented.  As an example, if a KE payload is to be
        fragmented, it may look as follows.<a class="pilcrow" href="#appendix-C-2.5.4">¶</a></p>
<span id="name-example-of-how-to-fragment-"></span><figure id="figure-1">
            <div class="alignCenter art-text artwork" id="appendix-C-2.5.5.1">
<pre>                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Payload  |C|F| RESERVED  |         Payload Length        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Diffie-Hellman Group Number  |     Fragment Identifier       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Fragment Index        |        Total Fragments        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Total KE Payload Data Length                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                       Fragmented KE Payload                   ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-example-of-how-to-fragment-">Example of How to Fragment a KE Payload</a>
            </figcaption></figure>
<p id="appendix-C-2.5.6">
        When the flag F is set, the current KE payload is a
        fragment of a larger KE payload.  The Payload Length field denotes
        the size of this payload fragment in octets: including the size of
        the generic payload header.  The 2-octet RESERVED field
        following Diffie-Hellman Group Number was to be used as a fragment
        identifier to help the assembly and disassembly of fragments.  The
        Fragment Index and Total Fragments fields are self-explanatory.
        The Total KE Payload Data Length indicates the size of the
        assembled KE payload data in octets.  Finally, the actual fragment
        is carried in Fragment KE Payload field.<a class="pilcrow" href="#appendix-C-2.5.6">¶</a></p>
<p id="appendix-C-2.5.7">
        This approach has been discarded because it is believed that the
        working group may not want to use the RESERVED field to change the
        format of a packet, and that implementers may not like the added
        complexity from checking the fragmentation flag in each received
        payload. More importantly, fragmenting the messages in this way
     may leave the system to be more prone to denial-of-service (DoS)
     attacks.  This issue can be solved using IKE_INTERMEDIATE <span>[<a class="cite xref" href="#RFC9242">RFC9242</a>]</span> to
     transport the large post-quantum key exchange payloads and using
     the generic IKEv2 fragmentation protocol
        <span>[<a class="cite xref" href="#RFC7383">RFC7383</a>]</span>.<a class="pilcrow" href="#appendix-C-2.5.7">¶</a></p>
</li>
        <li class="normal" id="appendix-C-2.6">
          <p id="appendix-C-2.6.1">Group sub-identifier<a class="pilcrow" href="#appendix-C-2.6.1">¶</a></p>
<p id="appendix-C-2.6.2">
        As discussed before, each group identifier is used to distinguish a
        post-quantum algorithm.  Further classification could be made on a
        particular post-quantum algorithm by assigning an additional value
        alongside the group identifier.  This sub-identifier value may be used
        to assign different security-parameter sets to a given post-quantum
        algorithm.  However, this level of detail does not fit the principles
        of the document where it should deal with generic hybrid key exchange
        protocol and not a specific ciphersuite.  Furthermore, there are
        enough Diffie-Hellman group identifiers should this be required in the
        future.<a class="pilcrow" href="#appendix-C-2.6.2">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-D">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-D-1"> The authors would like to thank <span class="contact-name">Frederic       Detienne</span> and <span class="contact-name">Olivier Pelerin</span> for their comments
      and suggestions, including the idea to negotiate the post-quantum
      algorithms using the existing KE payload.  The authors are also grateful
      to <span class="contact-name">Tobias Heider</span> and <span class="contact-name">Tobias       Guggemos</span> for valuable comments.  Thanks to <span class="contact-name">Paul       Wouters</span> for reviewing the document.<a class="pilcrow" href="#appendix-D-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Cen Jung Tjhai</span></div>
<div class="left" dir="auto"><span class="org">Post-Quantum</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:cjt@post-quantum.com">cjt@post-quantum.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Martin Tomlinson</span></div>
<div class="left" dir="auto"><span class="org">Post-Quantum</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mt@post-quantum.com">mt@post-quantum.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Graham Bartlett</span></div>
<div class="left" dir="auto"><span class="org">Quantum Secret</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:graham.ietf@gmail.com">graham.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Scott Fluhrer</span></div>
<div class="left" dir="auto"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sfluhrer@cisco.com">sfluhrer@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Daniel Van Geest</span></div>
<div class="left" dir="auto"><span class="org">ISARA Corporation</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:daniel.vangeest.ietf@gmail.com">daniel.vangeest.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Oscar Garcia-Morchon</span></div>
<div class="left" dir="auto"><span class="org">Philips</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:oscar.garcia-morchon@philips.com">oscar.garcia-morchon@philips.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Valery Smyslov</span></div>
<div class="left" dir="auto"><span class="org">ELVIS-PLUS</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:svan@elvis.ru">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>