<html><head></head><body><pre>Network Working Group                                           G. Klyne
Request for Comments: 3342                        Clearswift Corporation
Category: Standards Track                                        M. Rose
                                            Dover Beach Consulting, Inc.
                                                             M. Schwartz
                                                   Code On The Road, LLC
                                                                E. Dixon
                                                             H. Franklin
                                                                 J. Kint
                                                                  D. New
                                                                 S. Pead
                                                               July 2002


     <span class="h1">The Application Exchange (APEX) Option Party Pack, Part Deux!</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

Abstract

   Application Exchange (APEX), at its core, provides a best-effort
   application-layer datagram service.  Options are used to alter the
   semantics of the core service.  This memo defines various options to
   change the default behavior of APEX's "relaying mesh".

















<span class="grey">Klyne, et. al.              Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


Table of Contents

   <a href="#section-1">1</a>.    The attachOverride Option  . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-2">2</a>.    The dataTiming Option  . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2.1">2.1</a>   Upper-Bounds on Delivery . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-2.1.1">2.1.1</a> Final Hop Report . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-2.1.2">2.1.2</a> Timing Error Report  . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-2.2">2.2</a>   Reporting on Delayed Delivery  . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-2.2.1">2.2.1</a> Transient Timing Report  . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
   <a href="#section-3">3</a>.    The hold4Endpoint Option . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-4">4</a>.    The dataHopping Option . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#section-5">5</a>.    Initial Registrations  . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-5.1">5.1</a>   Registration: The attachOverride Option  . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-5.2">5.2</a>   Registration: The dataTiming Option  . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-5.3">5.3</a>   Registration: The hold4Endpoint Option . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-5.4">5.4</a>   Registration: The dataHopping Option . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-6">6</a>.    The APEX Party Pack DTD  . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-7">7</a>.    Security Considerations  . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
         References . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
   <a href="#appendix-A">A</a>.    Acknowledgements . . . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
   <a href="#appendix-B">B</a>.    IANA Considerations  . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
         Authors' Addresses . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
         Full Copyright Statement . . . . . . . . . . . . . . . . . . <a href="#page-22">22</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20The%20attachOverride%20Option"></a><a class="selflink" href="#section-1" id="section-1">1</a>. The attachOverride Option</span>

   <a href="#section-5.1">Section 5.1</a> contains the APEX option registration for the
   "attachOverride" option.

   The default behavior of the APEX relaying mesh, in the absence of
   processing options, is to allow at most one application to attach as
   a particular endpoint, on a "first come, first served" basis.  The
   "attachOverride" option provides gives preference to the current
   application trying to attach.

   If this option is present in the "attach" operation (c.f., <a href="#section-4.4.1">Section</a>
   <a href="#section-4.4.1">4.4.1</a> of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) and if any application is already attached as the
   specified endpoint, that endpoint has its attachment terminated
   (c.f., Section 4.4.3 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) concurrently with processing of that
   "attach" operation.  The "code" attribute of the resulting
   "terminate" operation is set to 556.

   Note that any data being expected by the previously-attached
   application may instead be delivered to the last application to
   successfully attach.  Accordingly, applications should take care to
   properly deal with incoming data having unrecognized transaction-
   identifiers (c.f., Section 6.1.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]).




<span class="grey">Klyne, et. al.              Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   This option provides for a new attachment to automatically terminate
   any existing attachment for the same endpoint.  For example, this
   might be helpful when a new attachment is required from a different
   device while a previously-used device is still attached e.g.,

        +-------+                  +-------+
        |       | -- attach -----&gt; |       |
        | appl. |                  | relay |
        |   #1  | &lt;--------- ok -- |       |
        +-------+                  +-------+

      C: &lt;attach endpoint='fred@example.com' transID='1' /&gt;
      S: &lt;ok /&gt;

    ... some time later appl #2 starts on a different computer ...

                                   +-------+                  +-------+
                                   |       | &lt;----- attach -- |       |
        +-------+                  |       |                  | appl. |
        |       | &lt;-- terminate -- | relay | -- ok ---------&gt; |   #2  |
        | appl. |                  |       |                  +-------+
        |   #1  | -- ok ---------&gt; |       |
        +-------+                  +-------+

                C: &lt;attach endpoint='fred@example.com' transID='2'&gt;
                       &lt;option internal='attachOverride' transID='3' /&gt;
                   &lt;/attach&gt;
                S: &lt;ok /&gt;

      C: &lt;terminate transID='1' code='556'&gt;overriden&lt;/terminate&gt;
      S: &lt;ok /&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20The%20dataTiming%20Option"></a><a class="selflink" href="#section-2" id="section-2">2</a>. The dataTiming Option</span>

   <a href="#section-5.2">Section 5.2</a> contains the APEX option registration for the
   "dataTiming" option.  This option contains a "dataTiming" element
   (c.f., <a href="#section-6">Section 6</a>).

   The default behavior of the APEX relaying mesh is "immediate, best
   effort", and expects that all relays and endpoints are able to
   process and transfer data without delay -- in the absence of
   processing options, if a relay is unavailable, then data is silently
   dropped.  The "dataTiming" option provides for controlled queuing
   delays in processing, whilst providing reasonable deterministic
   behavior for the originator.






<span class="grey">Klyne, et. al.              Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   There are two types of delays addressed by the "dataTiming" option:

   o  delays in transit through the relaying mesh, possibly due to
      intermittent or slow connections, or congested relays; and,

   o  delays because the intended endpoint is not available to receive
      the data, when used in conjunction with the hold4Endpoint option
      (<a href="#section-3">Section 3</a>).

   Accordingly, the "dataTiming" option allows for:

   o  data to be discarded if not delivered within a finite amount of
      time as specified using the "noLaterThan" attribute (<a href="#section-2.1">Section 2.1</a>);

   o  a "statusResponse" message (c.f., Section 5.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) to be
      generated if data is not delivered within a known amount of time
      as specified using the "reportAfter" attribute (<a href="#section-2.2">Section 2.2</a>); and,

   o  an upper limit on the amount of time for the "statusResponse"
      message to be delivered using the "returnTrip" attribute (<a href="#section-2.1.1">Section</a>
      <a href="#section-2.1.1">2.1.1</a>), after which the sender may presume the message to be lost.

   This option does not provide any functionality with respect to the
   priority of the data.  Nor does this option have any effect on other
   parts of the relaying process.

   Further, note that because this option is processed on a per-hop
   basis, the originator must set the "targetHop" attribute to the value
   "all" and the "mustUnderstand" attribute to the value "true".

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1%20Upper-Bounds%20on%20Delivery"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a> Upper-Bounds on Delivery</span>

   The "noLaterThan" attribute of the "dataTiming" option provides for
   control over delays that may occur in transit through the relaying
   mesh or to the recipient endpoint.

   If this option is present in the "data" operation (c.f., <a href="#section-4.4.4">Section</a>
   <a href="#section-4.4.4">4.4.4</a> of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) and the value of the "noLaterThan" attribute is non-
   zero, then:

   o  For Step 5.2 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      Immediately prior to sending the data to the next relay, the value
      of the "noLaterThan" attribute is adjusted to reflect the
      processing time of the data at the local relay (e.g., the time
      required to determine the next relay, to successfully issue a
      "bind" operation, and then be ready to immediately issue a "data"
      operation).



<span class="grey">Klyne, et. al.              Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


      If the value of the "noLaterThan" attribute becomes less than or
      equal to zero, an error in processing has occurred, the data
      element is not sent to the next relay, and if the "reportErrors"
      attribute is true, the APEX report service is invoked to send a
      timing error report.

   o  For Step 5.3 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      If the relay does not receive an "ok" element from the recipient
      endpoint within the number of milli-seconds indicated by the value
      of the "noLaterThan" attribute, an error in processing has
      occurred, and if the "reportErrors" attribute is true, the APEX
      report service is invoked to send a timing error report.

      Otherwise, if the data is successfully transmitted to the
      recipient, and the "returnTrip" attribute is non-zero, the APEX
      report service is invoked to send a final hop report.

   Note that in some cases, a relay may be able to predict this outcome
   without actually connecting to the next relay; if so, a timing error
   report may be sent without connecting to the next relay.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.1%20Final%20Hop%20Report"></a><a class="selflink" href="#section-2.1.1" id="section-2.1.1">2.1.1</a> Final Hop Report</span>

   If the APEX report service (c.f., Section 6.2 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) is invoked to
   send a final hop report, it issues a data operation with:

   o  its originator identifying the report service associated with the
      issuing relay

   o  its recipient identifying the endpoint address of the originator
      associated with the "dataTiming" option

   o  a new "dataTiming" option having:

      *  its "noLaterThan" attribute equal to the "returnTrip" attribute
         of the original "dataTiming" option

      *  and no other attributes present

   o  its content consisting of a "statusResponse" element having:

      *  its "transID" attribute equal to the "transID" attribute of the
         "dataTiming" option

      *  and identifying the original recipient with a permanent success
         indicator




<span class="grey">Klyne, et. al.              Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   For example:

                                  +-------+                  +-------+
                                  |       | -- data -------&gt; |       |
                                  | relay |                  | appl. |
                                  |       | &lt;--------- ok -- |   #2  |
                                  +-------+                  +-------+

     C: &lt;data content='cid:1@example.com'&gt;
            &lt;originator identity='fred@example.com' /&gt;
            &lt;recipient identity='barney@example.com' /&gt;
            &lt;option internal='dataTiming' targetHop='all'
                    mustUnderstand='true' transID='86'&gt;
                &lt;dataTiming noLaterThan='10000' returnTrip='20000' /&gt;
            &lt;/option&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;

       +-------+                  +-------+
       |       | &lt;------- data -- |       |
       | appl. |                  | relay |
       |   #1  | -- ok ---------&gt; |       |
       +-------+                  +-------+

     C: &lt;data content='#Content'&gt;
            &lt;originator identity='apex=report@example.com' /&gt;
            &lt;recipient identity='fred@example.com' /&gt;
            &lt;option internal='dataTiming' targetHop='all'
                    mustUnderstand='true' transID='99'&gt;
                &lt;dataTiming noLaterThan='20000' /&gt;
            &lt;/option&gt;
            &lt;data-content Name='Content'&gt;
                &lt;statusResponse transID='86'&gt;
                    &lt;destination identity='barney@example.com'&gt;
                        &lt;reply code='250' /&gt;
                    &lt;/destination&gt;
                &lt;/statusResponse&gt;
            &lt;/data-content&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;











<span class="grey">Klyne, et. al.              Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.2%20Timing%20Error%20Report"></a><a class="selflink" href="#section-2.1.2" id="section-2.1.2">2.1.2</a> Timing Error Report</span>

   If the APEX report service (c.f., Section 6.2 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) is invoked to
   send a timing error report, it issues a data operation with:

   o  its originator identifying the report service associated with the
      issuing relay

   o  its recipient identifying the endpoint address of the originator
      associated with the "dataTiming" option

   o  its content consisting of a "statusResponse" element having:

      *  its "transID" attribute equal to the "transID" attribute of the
         "dataTiming" option

      *  and identifying the original recipient with a permanent failure
         indicator

































<span class="grey">Klyne, et. al.              Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   For example:

       +-------+                  +-------+
       |       | -- data -------&gt; |       |
       | appl. |                  | relay |
       |       | &lt;--------- ok -- |       |
       +-------+                  +-------+

     C: &lt;data content='cid:1@example.com'&gt;
            &lt;originator identity='fred@example.com' /&gt;
            &lt;recipient identity='barney@example.com' /&gt;
            &lt;option internal='dataTiming' targetHop='all'
                    mustUnderstand='true' transID='86'&gt;
                &lt;dataTiming noLaterThan='6000' reportErrors='true' /&gt;
            &lt;/option&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;

      ... some time later ...

          +-------+                  +-------+
          |       | &lt;------- data -- |       |
          | appl. |                  | relay |
          |       | -- ok ---------&gt; |       |
          +-------+                  +-------+

        C: &lt;data content='#Content'&gt;
               &lt;originator identity='apex=report@example.com' /&gt;
               &lt;recipient identity='fred@example.com' /&gt;
               &lt;data-content Name='Content'&gt;
                   &lt;statusResponse transID='86'&gt;
                       &lt;destination identity='barney@example.com'&gt;
                           &lt;reply code='550' /&gt;
                       &lt;/destination&gt;
                   &lt;/statusResponse&gt;
               &lt;/data-content&gt;
           &lt;/data&gt;
        S: &lt;ok /&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2%20Reporting%20on%20Delayed%20Delivery"></a><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a> Reporting on Delayed Delivery</span>

   The "reportAfter" attribute of the "dataTiming" option provides for
   the originator to be notified if delivery is delayed beyond a
   specified time.  Delivery of the data is not affected.  Note that if
   the value of the "noLaterThan" attribute is non-zero, then it
   provides the operational upper-bounds for the "reportAfter"
   attribute.




<span class="grey">Klyne, et. al.              Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   If this option is present in the "data" operation (c.f., <a href="#section-4.4.4">Section</a>
   <a href="#section-4.4.4">4.4.4</a> of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) and the value of the "reportAfter" attribute is non-
   zero, then:

   o  For Step 5.2 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      Immediately prior to sending the data to the next relay, the value
      of the "reportAfter" attribute is adjusted to reflect the
      processing time of the data at the local relay (e.g., the time
      required to determine the next relay, to successfully issue a
      "bind" operation, and then be ready to immediately issue a "data"
      operation).

      If the value of the "reportAfter" attribute becomes less than or
      equal to zero, then its value is set to zero and the APEX report
      service is invoked to send a transient timing report; regardless,
      the data element is sent to the next relay.

   o  For Step 5.3 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      If the relay does not receive an "ok" element from the recipient
      endpoint within the number of milli-seconds indicated by the value
      of the "reportAfter" attribute, then its value is set to zero and
      the APEX report service is invoked to send a transient timing
      report.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.1%20Transient%20Timing%20Report"></a><a class="selflink" href="#section-2.2.1" id="section-2.2.1">2.2.1</a> Transient Timing Report</span>

   If the APEX report service (c.f., Section 6.2 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) is invoked to
   send a transient timing report, it issues a data operation with:

   o  its originator identifying the report service associated with the
      issuing relay

   o  its recipient identifying the endpoint address of the originator
      associated with the "dataTiming" option

   o  its content consisting of a "statusResponse" element having:

      *  its "transID" attribute equal to the "transID" attribute of the
         "dataTiming" option

      *  and identifying the original recipient with a transient success
         indicator







<span class="grey">Klyne, et. al.              Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   For example:

        +-------+                  +-------+
        |       | -- data -------&gt; |       |
        | appl. |                  | relay |
        |   #1  | &lt;--------- ok -- |       |
        +-------+                  +-------+

      C: &lt;data content='cid:1@example.com'&gt;
             &lt;originator identity='fred@example.com' /&gt;
             &lt;recipient identity='barney@example.com' /&gt;
             &lt;option internal='dataTiming' targetHop='all'
                     mustUnderstand='true' transID='86'&gt;
                 &lt;dataTiming reportAfter='60000' /&gt;
             &lt;/option&gt;
         &lt;/data&gt;
      S: &lt;ok /&gt;

    ... some time later ...

                                   +-------+                  +-------+
                                   |       | &lt;------- data -- |       |
                                   | relay |                  | relay |
                                   |  #n-1 | -- ok ---------&gt; |   #n  |
                                   +-------+                  +-------+

      C: &lt;data content='#Content'&gt;
             &lt;originator identity='apex=report@example.com' /&gt;
             &lt;recipient identity='fred@example.com' /&gt;
             &lt;data-content Name='Content'&gt;
                 &lt;statusResponse transID='86'&gt;
                     &lt;destination identity='barney@example.com'&gt;
                         &lt;reply code='350' /&gt;
                     &lt;/destination&gt;
                 &lt;/statusResponse&gt;
             &lt;/data-content&gt;
         &lt;/data&gt;
      S: &lt;ok /&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20The%20hold4Endpoint%20Option"></a><a class="selflink" href="#section-3" id="section-3">3</a>. The hold4Endpoint Option</span>

   <a href="#section-5.3">Section 5.3</a> contains the APEX option registration for the
   "hold4Endpoint" option.

   The default behavior of the APEX relaying mesh, in the absence of
   processing options, is to silently drop data for a recipient if its
   endpoint isn't attached.  The "hold4Endpoint" option provides for
   data to be queued if the recipient endpoint is not attached.



<span class="grey">Klyne, et. al.              Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   If this option is present in the "data" operation (c.f., <a href="#section-4.4.4">Section</a>
   <a href="#section-4.4.4">4.4.4</a> of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]), and the value of the "hold4Endpoint" attribute is true
   then:

   o  For Step 5.3 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      If the recipient's endpoint is not currently attached, the relay
      will queue the data waiting for an application to attach as that
      endpoint.

   Note that in the absence of an upper-bounds on delivery, such as
   limits provided by the dataTiming option (<a href="#section-2">Section 2</a>), the data will
   be queued indefinitely for the endpoint.






































<span class="grey">Klyne, et. al.              Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   For example:

        +-------+                  +-------+
        |       | -- data -------&gt; |       |
        | appl. |                  | relay |
        |   #1  | &lt;--------- ok -- |       |
        +-------+                  +-------+

      C: &lt;data content='cid:1@example.com'&gt;
             &lt;originator identity='fred@example.com' /&gt;
             &lt;recipient identity='barney@example.com' /&gt;
             &lt;option internal='hold4Endpoint' /&gt;
             &lt;option internal='dataTiming' targetHop='all'
                     mustUnderstand='true' transID='86'&gt;
                 &lt;dataTiming noLaterThan='60000' /&gt;
             &lt;/option&gt;
         &lt;/data&gt;
      S: &lt;ok /&gt;

    ... some time later the recipient's endpoint attaches ...

                                   +-------+                  +-------+
                                   |       | &lt;----- attach -- |       |
                                   |       |                  |       |
                                   |       | -- ok ---------&gt; |       |
                                   | relay |                  | appl. |
                                   |       | -- data -------&gt; |   #2  |
                                   |       |                  |       |
                                   |       | &lt;--------- ok -- |       |
                                   +-------+                  +-------+

      C: &lt;attach endpoint='barney@example.com' transID='2'&gt;
             &lt;option internal='attachOverride' transID='3' /&gt;
         &lt;/attach&gt;
      S: &lt;ok /&gt;

      C: &lt;data content='cid:1@example.com'&gt;
             &lt;originator identity='fred@example.com' /&gt;
             &lt;recipient identity='barney@example.com' /&gt;
             &lt;option internal='hold4Endpoint' /&gt;
             &lt;option internal='dataTiming' targetHop='all'
                     mustUnderstand='true' transID='86'&gt;
                 &lt;dataTiming noLaterThan='18000' /&gt;
             &lt;/option&gt;
         &lt;/data&gt;
      S: &lt;ok /&gt;





<span class="grey">Klyne, et. al.              Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20The%20dataHopping%20Option"></a><a class="selflink" href="#section-4" id="section-4">4</a>. The dataHopping Option</span>

   To detect misconfigurations that cause forwarding loops in the APEX
   relaying mesh, the APEX pubsub service re-introduces a mechanism
   similar to the IP TTL [<a href="#ref-2" title='"Internet Protocol"'>2</a>] mechanism, in the form of an APEX option.
   <a href="#section-5.4">Section 5.4</a> contains the APEX option registration for the
   "dataHopping" option.

   If this option is present in the "data" operation (c.f., <a href="#section-4.4.4">Section</a>
   <a href="#section-4.4.4">4.4.4</a> of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) and the value of the "noMoreThan" attribute is non-
   zero, then:

   o  For Step 5.2 of Section 4.4.4.1 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]:

      Immediately prior to sending the data to the next relay, the value
      of the "noMoreThan" attribute is reduced by 1.

      If the value of the "noMoreThan" attribute becomes less than or
      equal to zero, an error in processing has occurred, the data
      element is not sent to the next relay, and if the "reportErrors"
      attribute is true, the APEX report service is invoked to send an
      error report.

   Further, note that because this option is processed on a per-hop
   basis, the originator must set the "targetHop" attribute to the value
   "all" and the "mustUnderstand" attribute to the value "true".

   If the APEX report service (c.f., Section 6.2 of [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]) is invoked to
   send an error report, it issues a data operation with:

   o  its originator identifying the report service associated with the
      issuing relay

   o  its recipient identifying the endpoint address of the originator
      associated with the "dataHopping" option

   o  its content consisting of a "statusResponse" element having:

      *  its "transID" attribute equal to the "transID" attribute of the
         "dataHopping" option

      *  and identifying the original recipient with a permanent failure
         indicator








<span class="grey">Klyne, et. al.              Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   For example:

       +-------+                  +-------+
       |       | -- data -------&gt; |       |
       | appl. |                  | relay |
       |       | &lt;--------- ok -- |   #1  |
       +-------+                  +-------+

     C: &lt;data content='cid:1@example.com'&gt;
            &lt;originator identity='appl=pubsub/topic=fred@example.com' /&gt;
            &lt;recipient identity='barney@example.com' /&gt;
            &lt;option internal='dataHopping' targetHop='all'
                    mustUnderstand='true' transID='86'&gt;
                &lt;dataHopping noMoreThan='2' reportErrors='true' /&gt;
            &lt;/option&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;
                                  +-------+                  +-------+
                                  |       | -- data -------&gt; |       |
                                  | relay |                  | relay |
                                  |   #1  | &lt;--------- ok -- |   #2  |
                                  +-------+                  +-------+

     C: &lt;data content='cid:1@example.com'&gt;
            &lt;originator identity='appl=pubsub/topic=fred@example.com' /&gt;
            &lt;recipient identity='barney@example.com' /&gt;
            &lt;option internal='dataHopping' targetHop='all'
                    mustUnderstand='true' transID='86'&gt;
                &lt;dataHopping noMoreThan='1' reportErrors='true' /&gt;
            &lt;/option&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;



















<span class="grey">Klyne, et. al.              Standards Track                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   relay #2 determines that further relaying is necessary:

       +-------+                  +-------+
       |       | &lt;------- data -- |       |
       | relay |                  | relay |
       |   #1  | -- ok ---------&gt; |   #2  |
       +-------+                  +-------+

     C: &lt;data content='#Content'&gt;
            &lt;originator identity='apex=report@example.com' /&gt;
            &lt;recipient identity='appl=pubsub/topic=fred@example.com' /&gt;
            &lt;data-content Name='Content'&gt;
                &lt;statusResponse transID='86'&gt;
                    &lt;destination identity='barney@example.com'&gt;
                        &lt;reply code='550' /&gt;
                    &lt;/destination&gt;
                &lt;/statusResponse&gt;
            &lt;/data-content&gt;
        &lt;/data&gt;
     S: &lt;ok /&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20Initial%20Registrations"></a><a class="selflink" href="#section-5" id="section-5">5</a>. Initial Registrations</span>

   The APEX option registration template is defined in Section 7.1 of
   [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1%20Registration%3A%20The%20attachOverride%20Option"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a> Registration: The attachOverride Option</span>

   Option Identification: attachOverride

   Present in: APEX's "attach" element

   Contains: nothing

   Processing Rules: c.f., <a href="#section-1">Section 1</a>

   Contact Information: c.f., the "Authors' Addresses" section of this
      memo













<span class="grey">Klyne, et. al.              Standards Track                    [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2%20Registration%3A%20The%20dataTiming%20Option"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a> Registration: The dataTiming Option</span>

   Option Identification: dataTiming

   Present in: APEX's "data" element

   Contains: dataTiming (c.f., <a href="#section-6">Section 6</a>)

   Processing Rules: c.f., <a href="#section-2">Section 2</a>

   Contact Information: c.f., the "Authors' Addresses" section of this
      memo

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3%20Registration%3A%20The%20hold4Endpoint%20Option"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a> Registration: The hold4Endpoint Option</span>

   Option Identification: hold4Endpoint

   Present in: APEX's "data" element

   Contains: nothing

   Processing Rules: c.f., <a href="#section-3">Section 3</a>

   Contact Information: c.f., the "Authors' Addresses" section of this
      memo

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4%20Registration%3A%20The%20dataHopping%20Option"></a><a class="selflink" href="#section-5.4" id="section-5.4">5.4</a> Registration: The dataHopping Option</span>

   Option Identification: dataHopping

   Present in: APEX's "data" element

   Contains: dataHopping (c.f., <a href="#section-6">Section 6</a>)

   Processing Rules: c.f., <a href="#section-4">Section 4</a>

   Contact Information: c.f., the "Authors' Addresses" section of this
      memo













<span class="grey">Klyne, et. al.              Standards Track                    [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20The%20APEX%20Party%20Pack%20DTD"></a><a class="selflink" href="#section-6" id="section-6">6</a>. The APEX Party Pack DTD</span>

   &lt;!--
     DTD for the APEX option party pack, as of 2001-05-14


     Refer to this DTD as:

       &lt;!ENTITY % APEXPARTY PUBLIC "-//IETF//DTD APEX PARTY//EN" ""&gt;
       %APEXPARTY;
     --&gt;

   &lt;!ENTITY % APEXCORE PUBLIC "-//IETF//DTD APEX CORE//EN"
   %APEXCORE;

   &lt;!--
     DTD data types:

          entity        syntax/reference     example
          ======        ================     =======
       hopcount
           HOPS         0..255               17

       milli-seconds
           MILLISECS    0..2147483647        60000
     --&gt;

   &lt;!ENTITY  % HOPS     "CDATA"&gt;
   &lt;!ENTITY  % MILLISECS
                         "CDATA"&gt;


   &lt;!ELEMENT dataHopping EMPTY&gt;
   &lt;!ATTLIST dataHopping
             noMoreThan  %HOPS;            "0"
             reportErrors
                         (true|false)      "false"&gt;

   &lt;!ELEMENT dataTiming  EMPTY&gt;
   &lt;!ATTLIST dataTiming
             noLaterThan %MILLISECS;       "0"
             returnTrip  %MILLISECS;       "0"
             reportAfter %MILLISECS;       "0"
             reportErrors
                         (true|false)      "false"&gt;






<span class="grey">Klyne, et. al.              Standards Track                    [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20Security%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>. Security Considerations</span>

   Consult [<a href="#ref-1" title='"The Application Exchange Core"'>1</a>]'s <a href="#section-11">Section 11</a> for a discussion of security issues.

   In addition:

   o  The dataTiming option (<a href="#section-2">Section 2</a>) may be used to expose private
      network topology.  Accordingly, an administrator may wish to
      choose to disable this option except at the ingress/egress points
      for its administrative domain.

   o  The hold4Endpoint option (<a href="#section-3">Section 3</a>) may be used to facilitate
      denial-of-service attacks.  Accordingly, an administrator may wish
      to impose administrative limits on this attribute (e.g., always
      require that the "dataTiming" option also be present with a
      short-lived "noLaterThan" attribute).

References

   [<a id="ref-1">1</a>]   Rose, M., Klyne, G. and D. Crocker, "The Application Exchange
         Core", <a href="./rfc3340">RFC 3340</a>, July 2002.

   [<a id="ref-2">2</a>]   Postel, J., "Internet Protocol", STD 5, <a href="./rfc791">RFC 791</a>, September
         1981.

   [<a id="ref-3">3</a>]   Newman, D., "Deliver By SMTP Service Extension", <a href="./rfc2852">RFC 2852</a>, June
         2000.
























<span class="grey">Klyne, et. al.              Standards Track                    [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20Acknowledgements"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>. Acknowledgements</span>

   The authors gratefully acknowledge the contributions of Chris Newman
   and Bob Wyman.  Further, the dataTiming option is similar in function
   to "Deliver By" SMTP service extension defined by Dan Newman in [<a href="#ref-3" title='"Deliver By SMTP Service Extension"'>3</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20IANA%20Considerations"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>. IANA Considerations</span>

   The IANA completed the registrations specified in <a href="#section-5">Section 5</a>.










































<span class="grey">Klyne, et. al.              Standards Track                    [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


Authors' Addresses

   Graham Klyne
   Clearswift Corporation
   1310 Waterside
   Arlington Business Park
   Theale, Reading  RG7 4SA
   UK

   Phone: +44 11 8903 8903
   EMail: Graham.Klyne@MIMEsweeper.com


   Marshall T. Rose
   Dover Beach Consulting, Inc.
   POB 255268
   Sacramento, CA  95865-5268
   US

   Phone: +1 916 483 8878
   EMail: mrose@dbc.mtview.ca.us


   Michael F. Schwartz
   Code On The Road, LLC

   EMail: schwartz@CodeOnTheRoad.com
   URI:   <a href="http://www.CodeOnTheRoad.com">http://www.CodeOnTheRoad.com</a>


   Eric Dixon

   EMail: edixon@myrealbox.com


   Huston Franklin

   EMail: huston@franklin.ro


   Jay Kint

   EMail: d20@icosahedron.org








<span class="grey">Klyne, et. al.              Standards Track                    [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


   Darren New
   5390 Caminito Exquisito
   San Diego, CA  92130
   US

   Phone: +1 858 350 9733
   EMail: dnew@san.rr.com


   Scott Pead

   EMail: spead@fiber.net







































<span class="grey">Klyne, et. al.              Standards Track                    [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc3342">RFC 3342</a>       The Application Exchange (APEX) Party Pack      July 2002</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Klyne, et. al.              Standards Track                    [Page 22]
</pre>
</body></html>