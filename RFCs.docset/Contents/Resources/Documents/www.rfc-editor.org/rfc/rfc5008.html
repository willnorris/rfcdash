<html><head></head><body><pre>Network Working Group                                         R. Housley
Request for Comments: 5008                                Vigil Security
Category: Informational                                       J. Solinas
                                                                     NSA
                                                           September 2007


    <span class="h1">Suite B in Secure/Multipurpose Internet Mail Extensions (S/MIME)</span>

Status of This Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Abstract

   This document specifies the conventions for using the United States
   National Security Agency's Suite B algorithms in Secure/Multipurpose
   Internet Mail Extensions (S/MIME) as specified in <a href="./rfc3851">RFC 3851</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   This document specifies the conventions for using the United States
   National Security Agency's Suite B algorithms [<a href="#ref-SuiteB" title='"Fact Sheet NSA Suite B Cryptography"'>SuiteB</a>] in
   Secure/Multipurpose Internet Mail Extensions (S/MIME) [<a href="#ref-MSG" title='"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification"'>MSG</a>].  S/MIME
   makes use of the Cryptographic Message Syntax (CMS) [<a href="#ref-CMS" title='"Cryptographic Message Syntax (CMS)"'>CMS</a>].  In
   particular, the signed-data and the enveloped-data content types are
   used.

   Since many of the Suite B algorithms enjoy uses in other environments
   as well, the majority of the conventions needed for the Suite B
   algorithms are already specified in other documents.  This document
   references the source of these conventions, and the relevant details
   are repeated to aid developers that choose to support Suite B.  In a
   few cases, additional algorithm identifiers are needed, and they are
   provided in this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="./rfc2119">RFC 2119</a> [<a href="#ref-STDWORDS" title='"Key words for use in RFCs to Indicate Requirement Levels"'>STDWORDS</a>].








<span class="grey">Housley &amp; Solinas            Informational                      [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20ASN.1"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  ASN.1</span>

   CMS values are generated using ASN.1 [<a href="#ref-X.208-88">X.208-88</a>], the Basic Encoding
   Rules (BER) [<a href="#ref-X.209-88">X.209-88</a>], and the Distinguished Encoding Rules (DER)
   [<a href="#ref-X.509-88">X.509-88</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.3.%20%20Suite%20B%20Security%20Levels"></a><a class="selflink" href="#section-1.3" id="section-1.3">1.3</a>.  Suite B Security Levels</span>

   Suite B offers two security levels: Level 1 and Level 2.  Security
   Level 2 offers greater cryptographic strength by using longer keys.

   For S/MIME signed messages, Suite B follows the direction set by <a href="./rfc3278">RFC</a>
   <a href="./rfc3278">3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>], but some additional algorithm identifiers are
   assigned.  Suite B uses these algorithms:

                            Security Level 1   Security Level 2
                            ----------------   ----------------
      Message Digest:       SHA-256            SHA-384
      Signature:            ECDSA with P-256   ECDSA with P-384

   For S/MIME-encrypted messages, Suite B follows the direction set by
   <a href="./rfc3278">RFC 3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>] and follows the conventions set by <a href="./rfc3565">RFC 3565</a>
   [<a href="#ref-CMSAES" title='"Use of the Advanced Encryption Standard (AES) Encryption Algorithm in Cryptographic Message Syntax (CMS)"'>CMSAES</a>].  Again, additional algorithm identifiers are assigned.
   Suite B uses these algorithms:

                            Security Level 1   Security Level 2
                            ----------------   ----------------
      Key Agreement:        ECDH with P-256    ECDH with P-384
      Key Derivation:       SHA-256            SHA-384
      Key Wrap:             AES-128 Key Wrap   AES-256 Key Wrap
      Content Encryption:   AES-128 CBC        AES-256 CBC

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20SHA-256%20and%20SHA-256%20Message%20Digest%20Algorithms"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  SHA-256 and SHA-256 Message Digest Algorithms</span>

   This section specifies the conventions employed by implementations
   that support SHA-256 or SHA-384 [<a href="#ref-SHA2" title='"Secure Hash Standard"'>SHA2</a>].  In Suite B, Security Level
   1, the SHA-256 message digest algorithm MUST be used.  In Suite B,
   Security Level 2, SHA-384 MUST be used.

   Within the CMS signed-data content type, message digest algorithm
   identifiers are located in the SignedData digestAlgorithms field and
   the SignerInfo digestAlgorithm field.  Also, message digest values
   are located in the Message Digest authenticated attribute.  In
   addition, message digest values are input into signature algorithms.

   The SHA-256 and SHA-384 message digest algorithms are defined in FIPS
   Pub 180-2 [<a href="#ref-SHA2" title='"Secure Hash Standard"'>SHA2</a>, <a href="#ref-EH" title='"US Secure Hash Algorithms (SHA and HMAC-SHA)"'>EH</a>].  The algorithm identifier for SHA-256 is:




<span class="grey">Housley &amp; Solinas            Informational                      [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


      id-sha256  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistalgorithm(4) hashalgs(2) 1 }

   The algorithm identifier for SHA-384 is:

      id-sha384  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistalgorithm(4) hashalgs(2) 2 }

   There are two possible encodings for the AlgorithmIdentifier
   parameters field.  The two alternatives arise from the fact that when
   the 1988 syntax for AlgorithmIdentifier was translated into the 1997
   syntax, the OPTIONAL associated with the AlgorithmIdentifier
   parameters got lost.  Later, the OPTIONAL was recovered via a defect
   report, but by then many people thought that algorithm parameters
   were mandatory.  Because of this history some implementations encode
   parameters as a NULL element and others omit them entirely.  The
   correct encoding for the SHA-256 and SHA-384 message digest
   algorithms is to omit the parameters field; however, to ensure
   compatibility, implementations ought to also handle a SHA-256 and
   SHA-384 AlgorithmIdentifier parameters field, which contains a NULL.

   For both SHA-256 and SHA-384, the AlgorithmIdentifier parameters
   field is OPTIONAL, and if present, the parameters field MUST contain
   a NULL.  Implementations MUST accept SHA-256 and SHA-384
   AlgorithmIdentifiers with absent parameters.  Implementations MUST
   accept SHA-256 and SHA-384 AlgorithmIdentifiers with NULL parameters.
   Implementations SHOULD generate SHA-256 and SHA-384
   AlgorithmIdentifiers with absent parameters.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20ECDSA%20Signature%20Algorithm"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  ECDSA Signature Algorithm</span>

   This section specifies the conventions employed by implementations
   that support Elliptic Curve Digital Signature Algorithm (ECDSA).  The
   direction set by <a href="./rfc3278">RFC 3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>] is followed, but additional
   message digest algorithms and additional elliptic curves are
   employed.  In Suite B, Security Level 1, ECDSA MUST be used with the
   SHA-256 message digest algorithm and the P-256 elliptic curve.  In
   Suite B, Security Level 2, ECDSA MUST be used with the SHA-384
   message digest algorithm and the P-384 elliptic curve.  The P-256 and
   P-384 elliptic curves are specified in [<a href="#ref-DSS" title='"Digital Signature Standard (DSS)"'>DSS</a>].

   Within the CMS signed-data content type, signature algorithm
   identifiers are located in the SignerInfo signatureAlgorithm field of
   SignedData.  In addition, signature algorithm identifiers are located
   in the SignerInfo signatureAlgorithm field of countersignature
   attributes.



<span class="grey">Housley &amp; Solinas            Informational                      [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


   Within the CMS signed-data content type, signature values are located
   in the SignerInfo signature field of SignedData.  In addition,
   signature values are located in the SignerInfo signature field of
   countersignature attributes.

   As specified in <a href="./rfc3279">RFC 3279</a> [<a href="#ref-PKIX1ALG" title='"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1ALG</a>], ECDSA and Elliptic Curve
   Diffie-Hellman (ECDH) use the same algorithm identifier for subject
   public keys in certificates, and it is repeated here:

      id-ecPublicKey  OBJECT IDENTIFIER  ::=  { iso(1) member-body(2)
          us(840) ansi-x9-62(10045) keyType(2) 1 }

   This object identifier is used in public key certificates for both
   ECDSA signature keys and ECDH encryption keys.  The intended
   application for the key may be indicated in the key usage field (see
   <a href="./rfc3280">RFC 3280</a> [<a href="#ref-PKIX1" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1</a>]).  The use of separate keys for signature and
   encryption purposes is RECOMMENDED; however, the use of a single key
   for both signature and encryption purposes is not forbidden.

   As specified in <a href="./rfc3279">RFC 3279</a> [<a href="#ref-PKIX1ALG" title='"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1ALG</a>], ECDSA and ECDH use the same
   encoding for subject public keys in certificates, and it is repeated
   here:

      ECPoint  ::=  OCTET STRING

   The elliptic curve public key (an OCTET STRING) is mapped to a
   subject public key (a BIT STRING) as follows: the most significant
   bit of the OCTET STRING becomes the most significant bit of the BIT
   STRING, and the least significant bit of the OCTET STRING becomes the
   least significant bit of the BIT STRING.  Note that this octet string
   may represent an elliptic curve point in compressed or uncompressed
   form.  Implementations that support elliptic curves according to this
   specification MUST support the uncompressed form and MAY support the
   compressed form.

   ECDSA and ECDH require use of certain parameters with the public key.
   The parameters may be inherited from the certificate issuer,
   implicitly included through reference to a named curve, or explicitly
   included in the certificate.  As specified in <a href="./rfc3279">RFC 3279</a> [<a href="#ref-PKIX1ALG" title='"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1ALG</a>],
   the parameter structure is:

      EcpkParameters  ::=  CHOICE {
        ecParameters  ECParameters,
        namedCurve    OBJECT IDENTIFIER,
        implicitlyCA  NULL }






<span class="grey">Housley &amp; Solinas            Informational                      [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


   In Suite B, the namedCurve CHOICE MUST be used.  The object
   identifier for P-256 is:

      ansip256r1  OBJECT IDENTIFIER  ::=  { iso(1) member-body(2)
          us(840) ansi-x9-62(10045) curves(3) prime(1) 7 }

   The object identifier for P-384 is:

      secp384r1  OBJECT IDENTIFIER  ::=  { iso(1)
          identified-organization(3) certicom(132) curve(0) 34 }

   The algorithm identifier used in CMS for ECDSA with SHA-256 signature
   values is:

      ecdsa-with-SHA256  OBJECT IDENTIFIER  ::=  { iso(1) member-body(2)
          us(840) ansi-X9-62(10045) signatures(4) ecdsa-with-sha2(3) 2 }

   The algorithm identifier used in CMS for ECDSA with SHA-384 signature
   values is:

      ecdsa-with-SHA384  OBJECT IDENTIFIER  ::=  { iso(1) member-body(2)
          us(840) ansi-X9-62(10045) signatures(4) ecdsa-with-sha2(3) 3 }

   When either the ecdsa-with-SHA256 or the ecdsa-with-SHA384 algorithm
   identifier is used, the AlgorithmIdentifier parameters field MUST be
   absent.

   When signing, the ECDSA algorithm generates two values, commonly
   called r and s.  To transfer these two values as one signature, they
   MUST be encoded using the Ecdsa-Sig-Value type specified in <a href="./rfc3279">RFC 3279</a>
   [<a href="#ref-PKIX1ALG" title='"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1ALG</a>]:

      Ecdsa-Sig-Value  ::=  SEQUENCE {
        r  INTEGER,
        s  INTEGER }

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Key%20Management"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Key Management</span>

   CMS accommodates the following general key management techniques: key
   agreement, key transport, previously distributed symmetric key-
   encryption keys, and passwords.  In Suite B, ephemeral-static key
   agreement MUST be used as described in <a href="#section-4.1">Section 4.1</a>.

   When a key agreement algorithm is used, a key-encryption algorithm is
   also needed.  In Suite B, the Advanced Encryption Standard (AES) Key
   Wrap, as specified in <a href="./rfc3394">RFC 3394</a> [<a href="#ref-AESWRAP" title='"AES Key Wrap Specification"'>AESWRAP</a>, <a href="#ref-SH" title='"Advanced Encryption Standard (AES) Key Wrap Algorithm"'>SH</a>], MUST be used as the
   key-encryption algorithm.  AES Key Wrap is discussed further in
   <a href="#section-4.2">Section 4.2</a>.  The key-encryption key used with the AES Key Wrap



<span class="grey">Housley &amp; Solinas            Informational                      [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


   algorithm is obtained from a key derivation function (KDF).  In Suite
   B, there are two KDFs, one based on SHA-256 and one based on SHA-384.
   These KDFs are discussed further in <a href="#section-4.3">Section 4.3</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20ECDH%20Key%20Agreement%20Algorithm"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  ECDH Key Agreement Algorithm</span>

   This section specifies the conventions employed by implementations
   that support ECDH.  The direction set by <a href="./rfc3278">RFC 3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>] is
   followed, but additional key derivation functions and key wrap
   algorithms are employed.  S/MIME is used in store-and-forward
   communications, which means that ephemeral-static ECDH is always
   employed.  This means that the message originator uses an ephemeral
   ECDH key and that the message recipient uses a static ECDH key, which
   is obtained from an X.509 certificate.  In Suite B, Security Level 1,
   ephemeral-static ECDH MUST be used with the SHA-256 KDF, AES-128 Key
   Wrap, and the P-256 elliptic curve.  In Suite B, Security Level 2,
   ephemeral-static ECDH MUST be used with the SHA-384 KDF, AES-256 Key
   Wrap, and the P-384 elliptic curve.

   Within the CMS enveloped-data content type, key agreement algorithm
   identifiers are located in the EnvelopedData RecipientInfos
   KeyAgreeRecipientInfo keyEncryptionAlgorithm field.

   As specified in <a href="./rfc3279">RFC 3279</a> [<a href="#ref-PKIX1ALG" title='"Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>PKIX1ALG</a>], ECDSA and ECDH use the same
   conventions for carrying a subject public key in a certificate.
   These conventions are discussed in <a href="#section-3">Section 3</a>.

   Ephemeral-static ECDH key agreement is defined in [<a href="#ref-SEC1" title='"Elliptic Curve Cryptography"'>SEC1</a>] and
   [<a href="#ref-IEEE1363" title='"Standard Specifications for Public Key Cryptography"'>IEEE1363</a>].  When using ephemeral-static ECDH, the EnvelopedData
   RecipientInfos keyAgreeRecipientInfo field is used as follows:

      version MUST be 3.

      originator MUST be the originatorKey alternative.  The
      originatorKey algorithm field MUST contain the id-ecPublicKey
      object identifier (see <a href="#section-3">Section 3</a>) with NULL parameters.  The
      originatorKey publicKey field MUST contain the message
      originator's ephemeral public key, which is a DER-encoded ECPoint
      (see <a href="#section-3">Section 3</a>).  The ECPoint SHOULD be represented in
      uncompressed form.

      ukm can be present or absent.  However, message originators SHOULD
      include the ukm.  As specified in <a href="./rfc3852">RFC 3852</a> [<a href="#ref-CMS" title='"Cryptographic Message Syntax (CMS)"'>CMS</a>], implementations
      MUST support ukm message recipient processing, so interoperability
      is not a concern if the ukm is present or absent.  When present,
      the ukm is used to ensure that a different key-encryption key is
      generated, even when the ephemeral private key is improperly used




<span class="grey">Housley &amp; Solinas            Informational                      [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


      more than once.  See [<a href="#ref-RANDOM" title='"Randomness Requirements for Security"'>RANDOM</a>] for guidance on generation of random
      values.

      keyEncryptionAlgorithm MUST be one of the two algorithm
      identifiers listed below, and the algorithm identifier parameter
      field MUST be present and identify the key wrap algorithm.  The
      key wrap algorithm denotes the symmetric encryption algorithm used
      to encrypt the content-encryption key with the pairwise key-
      encryption key generated using the ephemeral-static ECDH key
      agreement algorithm (see <a href="#section-4.3">Section 4.3</a>).  In Suite B, Security Level
      1, the keyEncryptionAlgorithm MUST be dhSinglePass-stdDH-
      sha256kdf-scheme, and the keyEncryptionAlgorithm parameter MUST be
      a KeyWrapAlgorithm containing id-aes128-wrap (see <a href="#section-4.2">Section 4.2</a>).
      In Suite B, Security Level 2, the keyEncryptionAlgorithm MUST be
      dhSinglePass-stdDH-sha384kdf-scheme, and the
      keyEncryptionAlgorithm parameter MUST be a KeyWrapAlgorithm
      containing id-aes256-wrap (see <a href="#section-4.2">Section 4.2</a>).  The algorithm
      identifier for dhSinglePass-stdDH-sha256kdf-scheme and
      dhSinglePass-stdDH-sha384kdf-scheme are:

         dhSinglePass-stdDH-sha256kdf-scheme  OBJECT IDENTIFIER  ::=
             { iso(1) identified-organization(3) certicom(132)
               schemes(1) 11 1 }

         dhSinglePass-stdDH-sha384kdf-scheme  OBJECT IDENTIFIER  ::=
             { iso(1) identified-organization(3) certicom(132)
               schemes(1) 11 2 }

      Both of these algorithm identifiers use KeyWrapAlgorithm as the
      type for their parameter:

         KeyWrapAlgorithm  ::=  AlgorithmIdentifier

      recipientEncryptedKeys contains an identifier and an encrypted key
      for each recipient.  The RecipientEncryptedKey
      KeyAgreeRecipientIdentifier MUST contain either the
      issuerAndSerialNumber identifying the recipient's certificate or
      the RecipientKeyIdentifier containing the subject key identifier
      from the recipient's certificate.  In both cases, the recipient's
      certificate contains the recipient's static ECDH public key.
      RecipientEncryptedKey EncryptedKey MUST contain the content-
      encryption key encrypted with the ephemeral-static, ECDH-generated
      pairwise key-encryption key using the algorithm specified by the
      KeyWrapAlgorithm (see <a href="#section-4.3">Section 4.3</a>).







<span class="grey">Housley &amp; Solinas            Informational                      [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20AES%20Key%20Wrap"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  AES Key Wrap</span>

   CMS offers support for symmetric key-encryption key management;
   however, it is not used in Suite B.  Rather, the AES Key Wrap key-
   encryption algorithm, as specified in <a href="./rfc3394">RFC 3394</a> [<a href="#ref-AESWRAP" title='"AES Key Wrap Specification"'>AESWRAP</a>, <a href="#ref-SH" title='"Advanced Encryption Standard (AES) Key Wrap Algorithm"'>SH</a>], is used
   to encrypt the content-encryption key with a pairwise key-encryption
   key that is generated using ephemeral-static ECDH.  In Suite B,
   Security Level 1, AES-128 Key Wrap MUST be used as the key-encryption
   algorithm.  In Suite B, Security Level 2, AES-256 Key Wrap MUST be
   used as the key-encryption algorithm.

   Within the CMS enveloped-data content type, wrapped content-
   encryption keys are located in the EnvelopedData RecipientInfos
   KeyAgreeRecipientInfo RecipientEncryptedKeys encryptedKey field, and
   key wrap algorithm identifiers are located in the KeyWrapAlgorithm
   parameters within the EnvelopedData RecipientInfos
   KeyAgreeRecipientInfo keyEncryptionAlgorithm field.

   The algorithm identifiers for AES Key Wrap are specified in <a href="./rfc3394">RFC 3394</a>
   [<a href="#ref-SH" title='"Advanced Encryption Standard (AES) Key Wrap Algorithm"'>SH</a>], and the ones needed for Suite B are repeated here:

      id-aes128-wrap  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistAlgorithm(4) aes(1) 5 }

      id-aes256-wrap  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistAlgorithm(4) aes(1) 45 }

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20Key%20Derivation%20Functions"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  Key Derivation Functions</span>

   CMS offers support for deriving symmetric key-encryption keys from
   passwords; however, password-based key management is not used in
   Suite B.  Rather, KDFs based on SHA-256 and SHA-384 are used to
   derive a pairwise key-encryption key from the shared secret produced
   by ephemeral-static ECDH.  In Suite B, Security Level 1, the KDF
   based on SHA-256 MUST be used.  In Suite B, Security Level 2, KDF
   based on SHA-384 MUST be used.

   As specified in <a href="./rfc3278#section-8.2">SectionÂ 8.2 of RFC 3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>], using ECDH with the
   CMS enveloped-data content type, the derivation of key-encryption
   keys makes use of the ECC-CMS-SharedInfo type, which is repeated
   here:

      ECC-CMS-SharedInfo  ::=  SEQUENCE {
        keyInfo      AlgorithmIdentifier,
        entityUInfo  [0] EXPLICIT OCTET STRING OPTIONAL,
        suppPubInfo  [2] EXPLICIT OCTET STRING }



<span class="grey">Housley &amp; Solinas            Informational                      [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


   In Suite B, the fields of ECC-CMS-SharedInfo are used as follows:

      keyInfo contains the object identifier of the key-encryption
      algorithm that will be used to wrap the content-encryption key and
      NULL parameters.  In Suite B, Security Level 1, AES-128 Key Wrap
      MUST be used, resulting in {id-aes128-wrap, NULL}.  In Suite B,
      Security Level 2, AES-256 Key Wrap MUST be used, resulting in
      {id-aes256-wrap, NULL}.

      entityUInfo optionally contains a random value provided by the
      message originator.  If the ukm is present, then the entityUInfo
      MUST be present, and it MUST contain the ukm value.  If the ukm is
      not present, then the entityUInfo MUST be absent.

      suppPubInfo contains the length of the generated key-encryption
      key, in bits, represented as a 32-bit unsigned number, as
      described in <a href="./rfc2631">RFC 2631</a> [<a href="#ref-CMSDH" title='"Diffie-Hellman Key Agreement Method"'>CMSDH</a>].  In Suite B, Security Level 1, a
      128-bit AES key MUST be used, resulting in 0x00000080.  In Suite
      B, Security Level 2, a 256-bit AES key MUST be used, resulting in
      0x00000100.

   ECC-CMS-SharedInfo is DER-encoded and used as input to the key
   derivation function, as specified in Section 3.6.1 of [<a href="#ref-SEC1" title='"Elliptic Curve Cryptography"'>SEC1</a>].  Note
   that ECC-CMS-SharedInfo differs from the OtherInfo specified in
   [<a href="#ref-CMSDH" title='"Diffie-Hellman Key Agreement Method"'>CMSDH</a>].  Here, a counter value is not included in the keyInfo field
   because the KDF specified in [<a href="#ref-SEC1" title='"Elliptic Curve Cryptography"'>SEC1</a>] ensures that sufficient keying
   data is provided.

   The KDF specified in [<a href="#ref-SEC1" title='"Elliptic Curve Cryptography"'>SEC1</a>] provides an algorithm for generating an
   essentially arbitrary amount of keying material from the shared
   secret produced by ephemeral-static ECDH, which is called Z for the
   remainder of this discussion.  The KDF can be summarized as:

      KM = Hash ( Z || Counter || ECC-CMS-SharedInfo )

   To generate a key-encryption key, one or more KM blocks are
   generated, incrementing Counter appropriately, until enough material
   has been generated.  The KM blocks are concatenated left to right:

      KEK = KM ( counter=1 ) || KM ( counter=2 ) ...

   The elements of the KDF are used as follows:

      Hash is the one-way hash function, and it is either SHA-256 or
      SHA-384 [<a href="#ref-SHA2" title='"Secure Hash Standard"'>SHA2</a>].  In Suite B, Security Level 1, the SHA-256 MUST be
      used.  In Suite B, Security Level 2, SHA-384 MUST be used.





<span class="grey">Housley &amp; Solinas            Informational                      [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


      Z is the shared secret value generated by ephemeral-static ECDH.
      Leading zero bits MUST be preserved.  In Suite B, Security Level
      1, Z MUST be exactly 256 bits.  In Suite B, Security Level 2, Z
      MUST be exactly 384 bits.

      Counter is a 32-bit unsigned number, represented in network byte
      order.  Its initial value MUST be 0x00000001 for any key
      derivation operation.  In Suite B, Security Level 1 and Security
      Level 2, exactly one iteration is needed; the Counter is not
      incremented.

      ECC-CMS-SharedInfo is composed as described above.  It MUST be DER
      encoded.

   To generate a key-encryption key, one KM block is generated, with a
   Counter value of 0x00000001:

      KEK = KM ( 1 ) = Hash ( Z || Counter=1 || ECC-CMS-SharedInfo )

   In Suite B, Security Level 1, the key-encryption key MUST be the most
   significant 128 bits of the SHA-256 output value.  In Suite B,
   Security Level 2, the key-encryption key MUST be the most significant
   256 bits of the SHA-384 output value.

   Note that the only source of secret entropy in this computation is Z.
   The effective key space of the key-encryption key is limited by the
   size of Z, in addition to any security level considerations imposed
   by the elliptic curve that is used.  However, if entityUInfo is
   different for each message, a different key-encryption key will be
   generated for each message.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20AES%20CBC%20Content%20Encryption"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  AES CBC Content Encryption</span>

   This section specifies the conventions employed by implementations
   that support content encryption using AES [<a href="#ref-AES" title='"Advanced Encryption Standard (AES)"'>AES</a>] in Cipher Block
   Chaining (CBC) mode [<a href="#ref-MODES" title='"DES Modes of Operation"'>MODES</a>].  The conventions in <a href="./rfc3565">RFC 3565</a> [<a href="#ref-CMSAES" title='"Use of the Advanced Encryption Standard (AES) Encryption Algorithm in Cryptographic Message Syntax (CMS)"'>CMSAES</a>]
   are followed.  In Suite B, Security Level 1, the AES-128 in CBC mode
   MUST be used for content encryption.  In Suite B, Security Level 2,
   AES-256 in CBC mode MUST be used.

   Within the CMS enveloped-data content type, content encryption
   algorithm identifiers are located in the EnvelopedData
   EncryptedContentInfo contentEncryptionAlgorithm field.  The content
   encryption algorithm is used to encipher the content located in the
   EnvelopedData EncryptedContentInfo encryptedContent field.

   The AES CBC content-encryption algorithm is described in [<a href="#ref-AES" title='"Advanced Encryption Standard (AES)"'>AES</a>] and
   [<a href="#ref-MODES" title='"DES Modes of Operation"'>MODES</a>].  The algorithm identifier for AES-128 in CBC mode is:



<span class="grey">Housley &amp; Solinas            Informational                     [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


      id-aes128-CBC  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistAlgorithm(4) aes(1) 2 }

   The algorithm identifier for AES-256 in CBC mode is:

      id-aes256-CBC  OBJECT IDENTIFIER  ::=  { joint-iso-itu-t(2)
          country(16) us(840) organization(1) gov(101) csor(3)
          nistAlgorithm(4) aes(1) 42 }

   The AlgorithmIdentifier parameters field MUST be present, and the
   parameters field must contain AES-IV:

      AES-IV  ::=  OCTET STRING (SIZE(16))

   The 16-octet initialization vector is generated at random by the
   originator.  See [<a href="#ref-RANDOM" title='"Randomness Requirements for Security"'>RANDOM</a>] for guidance on generation of random
   values.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Security Considerations</span>

   This document specifies the conventions for using the NSA's Suite B
   algorithms in S/MIME.  All of the algorithms have been specified in
   previous documents, although a few new algorithm identifiers have
   been assigned.

   Two levels of security may be achieved using this specification.
   Users must consider their risk environment to determine which level
   is appropriate for their own use.

   For signed and encrypted messages, Suite B provides a consistent
   level of security for confidentiality and integrity of the message
   content.

   The security considerations in <a href="./rfc3852">RFC 3852</a> [<a href="#ref-CMS" title='"Cryptographic Message Syntax (CMS)"'>CMS</a>] discuss the CMS as a
   method for digitally signing data and encrypting data.

   The security considerations in <a href="./rfc3370">RFC 3370</a> [<a href="#ref-CMSALG" title='"Cryptographic Message Syntax (CMS) Algorithms"'>CMSALG</a>] discuss
   cryptographic algorithm implementation concerns in the context of the
   CMS.

   The security considerations in <a href="./rfc3278">RFC 3278</a> [<a href="#ref-CMSECC" title='"Use of Elliptic Curve Cryptography (ECC) Algorithms in Cryptographic Message Syntax (CMS)"'>CMSECC</a>] discuss the use of
   elliptic curve cryptography (ECC) in the CMS.

   The security considerations in <a href="./rfc3565">RFC 3565</a> [<a href="#ref-CMSAES" title='"Use of the Advanced Encryption Standard (AES) Encryption Algorithm in Cryptographic Message Syntax (CMS)"'>CMSAES</a>] discuss the use of
   AES in the CMS.





<span class="grey">Housley &amp; Solinas            Informational                     [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20References"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Normative%20References"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-AES">AES</a>]       National Institute of Standards and Technology, "Advanced
               Encryption Standard (AES)", FIPS PUB 197, November 2001.

   [<a id="ref-AESWRAP">AESWRAP</a>]   National Institute of Standards and Technology, "AES Key
               Wrap Specification", 17 November 2001.  [See
               <a href="http://csrc.nist.gov/encryption/kms/key-wrap">http://csrc.nist.gov/encryption/kms/key-wrap</a>.pdf]

   [<a id="ref-DSS">DSS</a>]       National Institute of Standards and Technology, "Digital
               Signature Standard (DSS)", FIPS PUB 186-2, January 2000.

   [<a id="ref-ECDSA">ECDSA</a>]     American National Standards Institute, "Public Key
               Cryptography For The Financial Services Industry: The
               Elliptic Curve Digital Signature Algorithm (ECDSA)", ANSI
               X9.62-1998, 1999.

   [<a id="ref-CMS">CMS</a>]       Housley, R., "Cryptographic Message Syntax (CMS)", <a href="./rfc3852">RFC</a>
               <a href="./rfc3852">3852</a>, July 2004.

   [<a id="ref-CMSAES">CMSAES</a>]    Schaad, J., "Use of the Advanced Encryption Standard
               (AES) Encryption Algorithm in Cryptographic Message
               Syntax (CMS)", <a href="./rfc3565">RFC 3565</a>, July 2003.

   [<a id="ref-CMSALG">CMSALG</a>]    Housley, R., "Cryptographic Message Syntax (CMS)
               Algorithms", <a href="./rfc3370">RFC 3370</a>, August 2002.

   [<a id="ref-CMSDH">CMSDH</a>]     Rescorla, E., "Diffie-Hellman Key Agreement Method", <a href="./rfc2631">RFC</a>
               <a href="./rfc2631">2631</a>, June 1999.

   [<a id="ref-CMSECC">CMSECC</a>]    Blake-Wilson, S., Brown, D., and P. Lambert, "Use of
               Elliptic Curve Cryptography (ECC) Algorithms in
               Cryptographic Message Syntax (CMS)", <a href="./rfc3278">RFC 3278</a>, April
               2002.

   [<a id="ref-IEEE1363">IEEE1363</a>]  Institute of Electrical and Electronics Engineers,
               "Standard Specifications for Public Key Cryptography",
               IEEE Std 1363, 2000.

   [<a id="ref-MODES">MODES</a>]     National Institute of Standards and Technology, "DES
               Modes of Operation", FIPS Pub 81, 2 December 1980.

   [<a id="ref-MSG">MSG</a>]       Ramsdell, B., "Secure/Multipurpose Internet Mail
               Extensions (S/MIME) Version 3.1 Message Specification",
               <a href="./rfc3851">RFC 3851</a>, July 2004.




<span class="grey">Housley &amp; Solinas            Informational                     [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


   [<a id="ref-PKIX1">PKIX1</a>]     Housley, R., Polk, W., Ford, W., and D. Solo, "Internet
               X.509 Public Key Infrastructure Certificate and
               Certificate Revocation List (CRL) Profile", <a href="./rfc3280">RFC 3280</a>,
               April 2002.

   [<a id="ref-PKIX1ALG">PKIX1ALG</a>]  Bassham, L., Polk, W., and R. Housley, "Algorithms and
               Identifiers for the Internet X.509 Public Key
               Infrastructure Certificate and Certificate Revocation
               List (CRL) Profile", <a href="./rfc3279">RFC 3279</a>, April 2002.

   [<a id="ref-SEC1">SEC1</a>]      Standards for Efficient Cryptography Group, "Elliptic
               Curve Cryptography", 2000.  [See <a href="http://www.secg.org/collateral/sec1.pdf">http://www.secg.org/</a>
               <a href="http://www.secg.org/collateral/sec1.pdf">collateral/sec1.pdf</a>.]

   [<a id="ref-SH">SH</a>]        Schaad, J., and R. Housley, "Advanced Encryption Standard
               (AES) Key Wrap Algorithm", <a href="./rfc3394">RFC 3394</a>, September 2002.

   [<a id="ref-SHA2">SHA2</a>]      National Institute of Standards and Technology, "Secure
               Hash Standard", FIPS 180-2, 1 August 2002.

   [<a id="ref-STDWORDS">STDWORDS</a>]  S. Bradner, "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-X.208-88">X.208-88</a>]  CCITT.  Recommendation X.208: Specification of Abstract
               Syntax Notation One (ASN.1).  1988.

   [<a id="ref-X.209-88">X.209-88</a>]  CCITT.  Recommendation X.209: Specification of Basic
               Encoding Rules for Abstract Syntax Notation One (ASN.1).
               1988.

   [<a id="ref-X.509-88">X.509-88</a>]  CCITT.  Recommendation X.509: The Directory -
               Authentication Framework.  1988.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20Informative%20References"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-EH">EH</a>]        Eastlake 3rd, D. and T. Hansen, "US Secure Hash
               Algorithms (SHA and HMAC-SHA)", <a href="./rfc4634">RFC 4634</a>, July 2006.

   [<a id="ref-RANDOM">RANDOM</a>]    Eastlake, D., 3rd, Schiller, J., and S. Crocker,
               "Randomness Requirements for Security", <a href="https://www.rfc-editor.org/bcp/bcp106">BCP 106</a>, <a href="./rfc4086">RFC</a>
               <a href="./rfc4086">4086</a>, June 2005.

   [<a id="ref-SuiteB">SuiteB</a>]    National Security Agency, "Fact Sheet NSA Suite B
               Cryptography", July 2005.  [See <a href="http://www.nsa.gov/ia/industry/crypto_Suite_b.cfm?MenuID=10.2.7">http://www.nsa.gov/ia/</a>
               <a href="http://www.nsa.gov/ia/industry/crypto_Suite_b.cfm?MenuID=10.2.7">industry/crypto_Suite_b.cfm?MenuID=10.2.7</a>)






<span class="grey">Housley &amp; Solinas            Informational                     [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


Authors' Addresses

   Russell Housley
   Vigil Security, LLC
   918 Spring Knoll Drive
   Herndon, VA 20170
   USA

   EMail: housley@vigilsec.com


   Jerome A. Solinas
   National Information Assurance Laboratory
   National Security Agency
   9800 Savage Road
   Fort George G. Meade, MD 20755
   USA

   EMail: jasolin@orion.ncsc.mil
































<span class="grey">Housley &amp; Solinas            Informational                     [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5008">RFC 5008</a>                   Suite B in S/MIME              September 2007</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and <a href="https://www.rfc-editor.org/bcp/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Housley &amp; Solinas            Informational                     [Page 15]
</pre>
</body></html>