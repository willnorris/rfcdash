<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9464: Internet Key Exchange Protocol Version 2 (IKEv2) Configuration for Encrypted DNS</title>
<meta content="Mohamed Boucadair" name="author"/>
<meta content="Tirumaleswar Reddy.K" name="author"/>
<meta content="Dan Wing" name="author"/>
<meta content="Valery Smyslov" name="author"/>
<meta content="
       This document specifies new Internet Key Exchange Protocol Version 2
      (IKEv2) Configuration Payload Attribute Types to assign DNS resolvers
      that support encrypted DNS protocols, such as DNS over HTTPS (DoH),
      DNS over TLS (DoT), and DNS over QUIC (DoQ). 
    " name="description"/>
<meta content="xml2rfc 3.18.2" name="generator"/>
<meta content="security" name="keyword"/>
<meta content="name resolution" name="keyword"/>
<meta content="encryption" name="keyword"/>
<meta content="service discovery" name="keyword"/>
<meta content="naming" name="keyword"/>
<meta content="resolver" name="keyword"/>
<meta content="stub-resolver" name="keyword"/>
<meta content="CPE" name="keyword"/>
<meta content="Customer premise equipment" name="keyword"/>
<meta content="VPN" name="keyword"/>
<meta content="Secure discovery" name="keyword"/>
<meta content="DoT" name="keyword"/>
<meta content="DoH" name="keyword"/>
<meta content="DoQ" name="keyword"/>
<meta content="Tunnel" name="keyword"/>
<meta content="connectivity" name="keyword"/>
<meta content="9464" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9464.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-add-ike-14" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9464" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9464</td>
<td class="center">IKEv2 for Encrypted DNS</td>
<td class="right">November 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Boucadair, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9464">9464</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-11">November 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Boucadair</div>
<div class="org">Orange</div>
</div>
<div class="author">
      <div class="author-name">T. Reddy.K</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">D. Wing</div>
<div class="org">Cloud Software Group</div>
</div>
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9464</h1>
<h1 id="title">Internet Key Exchange Protocol Version 2 (IKEv2) Configuration for Encrypted DNS</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document specifies new Internet Key Exchange Protocol Version 2
      (IKEv2) Configuration Payload Attribute Types to assign DNS resolvers
      that support encrypted DNS protocols, such as DNS over HTTPS (DoH),
      DNS over TLS (DoT), and DNS over QUIC (DoQ).<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9464">https://www.rfc-editor.org/info/rfc9464</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-terminology">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-ikev2-configuration-payload">IKEv2 Configuration Payload Attribute Types for Encrypted DNS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p class="keepWithNext" id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-encdns_ip-configuration-pay">ENCDNS_IP* Configuration Payload Attributes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-encdns_digest_info-configur">ENCDNS_DIGEST_INFO Configuration Payload Attribute</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-ikev2-protocol-exchange">IKEv2 Protocol Exchange</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-subject-public-key-info-spk">Subject Public Key Info (SPKI) Hash</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-privacy-considerations">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-configuration-payload-examp">Configuration Payload Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#appendix-A.1">A.1</a>.  <a class="internal xref" href="#name-configuration-of-encrypted-">Configuration of Encrypted IPv6 DNS Resolvers without Suggested Values</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#appendix-A.2">A.2</a>.  <a class="internal xref" href="#name-configuration-of-encrypted-i">Configuration of Encrypted IPv6 DNS Resolvers with Suggested Values</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a class="auto internal xref" href="#appendix-A.3">A.3</a>.  <a class="internal xref" href="#name-split-dns">Split DNS</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies a mechanism for assigning encrypted DNS
      configurations to an Internet Key Exchange Protocol Version 2 (IKEv2)
      initiator <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>. Specifically, it assigns one
      or more Authentication Domain Names (ADNs) of DNS resolvers that support
      encrypted DNS protocols. The specific protocols supported are described
      using the Service Parameters format defined in <span>[<a class="cite xref" href="#RFC9460">RFC9460</a>]</span>; supported protocols include
      DNS over HTTPS (DoH) <span>[<a class="cite xref" href="#RFC8484">RFC8484</a>]</span>, DNS over TLS (DoT)
      <span>[<a class="cite xref" href="#RFC7858">RFC7858</a>]</span>, and DNS over QUIC (DoQ) <span>[<a class="cite xref" href="#RFC9250">RFC9250</a>]</span>.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">This document introduces three new IKEv2 Configuration Payload
      Attribute Types (<a class="auto internal xref" href="#RI">Section 3</a>) to add support for encrypted
      DNS resolvers. The ENCDNS_IP4 and ENCDNS_IP6 attribute types (<a class="auto internal xref" href="#RIIP">Section 3.1</a>) are used to provision ADNs, a list of IP
      addresses, and a set of service parameters. The ENCDNS_DIGEST_INFO
      attribute (<a class="auto internal xref" href="#digest">Section 3.2</a>) additionally allows a specific
      resolver certificate to be indicated by the IKEv2 responder.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The encrypted DNS resolver hosted by a Virtual Private Network (VPN)
      provider can get a domain-validated certificate from a public Certificate
      Authority (CA). The VPN client does not need to be provisioned with the
      root certificate of a private CA to authenticate the certificate of the
      encrypted DNS resolvers. The encrypted DNS resolver can run on private
      IP addresses, and its access can be restricted to clients connected to
      the VPN.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">For many years, typical designs have often assumed that the DNS
      resolver was usually located inside the protected domain, but they don't
      consider implementations where the DNS resolver could be located outside of it. With encrypted DNS, implementing the latter scenario becomes
      plausible. Note that existing VPN client implementations might not
      expect the discovered DNS resolver IP addresses to be outside of
      the covered IP address ranges of the VPN tunnel.<a class="pilcrow" href="#section-1-4">¶</a></p>
</section>
</div>
<div id="notation">
<section id="section-2">
      <h2 id="name-terminology">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
       "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>",
       "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>",
       "<span class="bcp14">SHOULD NOT</span>",
       "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
       "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document
       are to be interpreted as described in BCP 14
       <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only
       when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">This document uses the terms defined in <span>[<a class="cite xref" href="#RFC8499">RFC8499</a>]</span>.<a class="pilcrow" href="#section-2-2">¶</a></p>
<p id="section-2-3">Also, this document uses the terms defined in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>. In particular, readers should be familiar with the terms
      "initiator" and "responder" as used in that document.<a class="pilcrow" href="#section-2-3">¶</a></p>
<p id="section-2-4">This document makes use of the following terms:<a class="pilcrow" href="#section-2-4">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-5">
        <dt id="section-2-5.1">Do53:</dt>
        <dd id="section-2-5.2" style="margin-left: 1.5em">Refers to unencrypted DNS.<a class="pilcrow" href="#section-2-5.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-5.3">Encrypted DNS:</dt>
        <dd id="section-2-5.4" style="margin-left: 1.5em">Refers to a scheme where DNS messages
          are sent over an encrypted channel. Examples of encrypted DNS are
          DoT, DoH, and DoQ.<a class="pilcrow" href="#section-2-5.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-5.5">ENCDNS_IP*:</dt>
        <dd id="section-2-5.6" style="margin-left: 1.5em">Refers to any of the IKEv2 Configuration Payload
          Attribute Types defined in <a class="auto internal xref" href="#RIIP">Section 3.1</a>.<a class="pilcrow" href="#section-2-5.6">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="RI">
<section id="section-3">
      <h2 id="name-ikev2-configuration-payload">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-ikev2-configuration-payload">IKEv2 Configuration Payload Attribute Types for Encrypted DNS</a>
      </h2>
<div id="RIIP">
<section id="section-3.1">
        <h3 id="name-encdns_ip-configuration-pay">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-encdns_ip-configuration-pay">ENCDNS_IP* Configuration Payload Attributes</a>
        </h3>
<p id="section-3.1-1">The ENCDNS_IP* IKEv2 Configuration Payload Attribute Types,
        ENCDNS_IP4 and ENCDNS_IP6, are used to configure an initiator with encrypted DNS
        resolvers. Both attribute types share the format
        shown in <a class="auto internal xref" href="#ri_attr">Figure 1</a>. The information included
        in these attributes adheres to the recommendation in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9463#section-3.1.9">Section 3.1.9</a> of [<a class="cite xref" href="#RFC9463">RFC9463</a>]</span>.<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<span id="name-format-of-encdns_ip4-and-en"></span><div id="ri_attr">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-3.1-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-----------------------------+-------------------------------+
|R|         Attribute Type      |            Length             |
+-+-----------------------------+---------------+---------------+
|       Service Priority        | Num Addresses |  ADN Length   |
+-------------------------------+---------------+---------------+
~                        IP Address(es)                         ~
+---------------------------------------------------------------+
~                  Authentication Domain Name                   ~
+---------------------------------------------------------------+
~                 Service Parameters (SvcParams)                ~
+---------------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-format-of-encdns_ip4-and-en">Format of ENCDNS_IP4 and ENCDNS_IP6 Configuration Attributes</a>
          </figcaption></figure>
</div>
<p id="section-3.1-3">The description of the fields shown in <a class="auto internal xref" href="#ri_attr">Figure 1</a> is as follows:<a class="pilcrow" href="#section-3.1-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-4">
          <dt id="section-3.1-4.1">R (Reserved, 1 bit):</dt>
          <dd id="section-3.1-4.2" style="margin-left: 1.5em">This bit <span class="bcp14">MUST</span> be set to zero and <span class="bcp14">MUST</span> be
            ignored on receipt (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-3.15.1">Section 3.15.1</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> for details).<a class="pilcrow" href="#section-3.1-4.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.3">Attribute Type (15 bits):</dt>
          <dd id="section-3.1-4.4" style="margin-left: 1.5em">Identifier for the Configuration
            Attribute Type. This is set to 27 for ENCDNS_IP4 or 28 for
            ENCDNS_IP6, as registered in <a class="auto internal xref" href="#IANA1">Section 8</a>.<a class="pilcrow" href="#section-3.1-4.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.5">Length (2 octets, unsigned integer):</dt>
          <dd id="section-3.1-4.6" style="margin-left: 1.5em">
            <p id="section-3.1-4.6.1">Length of the enclosed
            data in octets. In particular, this field is set to:<a class="pilcrow" href="#section-3.1-4.6.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.6.2.1">0, if the Configuration payload has type (1) CFG_REQUEST
                and no specific DNS resolver is requested or (2) CFG_ACK. If the "Length" field is set to 0, then the subsequent fields
                shown in <a class="auto internal xref" href="#ri_attr">Figure 1</a> are not present.<a class="pilcrow" href="#section-3.1-4.6.2.1">¶</a>
</li>
              <li class="normal" id="section-3.1-4.6.2.2">(4 + 'Length of the ADN' + N * 4 + 'Length of SvcParams') for
                ENCDNS_IP4 attributes if the Configuration payload has type
                CFG_REQUEST, CFG_REPLY, or CFG_SET, with N being the number of
                included IPv4 addresses ("Num Addresses").<a class="pilcrow" href="#section-3.1-4.6.2.2">¶</a>
</li>
              <li class="normal" id="section-3.1-4.6.2.3">(4 + 'Length of the ADN' + N * 16 + 'Length of SvcParams')
                for ENCDNS_IP6 attributes if the Configuration payload has
                type CFG_REQUEST, CFG_REPLY, or CFG_SET, with N being the number
                of included IPv6 addresses ("Num Addresses").<a class="pilcrow" href="#section-3.1-4.6.2.3">¶</a>
</li>
            </ul>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.7">Service Priority (2 octets):</dt>
          <dd id="section-3.1-4.8" style="margin-left: 1.5em">The priority of this attribute
            compared to other ENCDNS_IP* instances. This 16-bit unsigned
            integer is interpreted following the rules specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9460#section-2.4.1">Section 2.4.1</a> of [<a class="cite xref" href="#RFC9460">RFC9460</a>]</span>. As
            AliasMode (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9460#section-2.4.2">Section 2.4.2</a> of [<a class="cite xref" href="#RFC9460">RFC9460</a>]</span>) is not supported, this
            field <span class="bcp14">MUST NOT</span> be set to 0. Note that AliasMode is not supported
            because such a mode will trigger additional Do53 queries while the
            data can be supplied directly in the IKE response.<a class="pilcrow" href="#section-3.1-4.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.9">Num Addresses (1 octet):</dt>
          <dd id="section-3.1-4.10" style="margin-left: 1.5em">Indicates the number of enclosed IPv4
            (for ENCDNS_IP4) or IPv6 (for ENCDNS_IP6) addresses. This value
            <span class="bcp14">MUST NOT</span> be set to 0 if the Configuration payload has type
            CFG_REPLY or CFG_SET. This may be set to 0 in CFG_REQUEST to
            indicate that no IP address is encoded in the attribute.<a class="pilcrow" href="#section-3.1-4.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.11">ADN Length (1 octet):</dt>
          <dd id="section-3.1-4.12" style="margin-left: 1.5em">Indicates the length of the
            "Authentication Domain Name" field in octets. When set to 0,
            this means that no ADN is enclosed in the attribute.<a class="pilcrow" href="#section-3.1-4.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.13">IP Address(es) (variable):</dt>
          <dd id="section-3.1-4.14" style="margin-left: 1.5em">Includes one or more IP addresses
            that can be used to reach the encrypted DNS resolver identified by
            the ADN. For ENCDNS_IP4, this field contains
            one or more 4-octet IPv4 addresses, and for ENCDNS_IP6, this field
            contains one or more 16-octet IPv6 addresses.<a class="pilcrow" href="#section-3.1-4.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.15">Authentication Domain Name (variable):</dt>
          <dd id="section-3.1-4.16" style="margin-left: 1.5em">
            <p id="section-3.1-4.16.1">A fully qualified
            domain name of the encrypted DNS resolver, in DNS presentation
            format and using an Internationalized Domain Names for
            Applications (IDNA) A-label <span>[<a class="cite xref" href="#RFC5890">RFC5890</a>]</span>. The
            name <span class="bcp14">MUST NOT</span> contain any terminators (e.g., NULL, CR).<a class="pilcrow" href="#section-3.1-4.16.1">¶</a></p>
<p id="section-3.1-4.16.2">An example of a valid ADN for a DoH server is
            "doh1.example.com".<a class="pilcrow" href="#section-3.1-4.16.2">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-4.17">Service Parameters (SvcParams) (variable):</dt>
          <dd id="section-3.1-4.18" style="margin-left: 1.5em">
            <p id="section-3.1-4.18.1">Specifies a set of
            service parameters that are encoded following the same rules
for encoding SvcParams using the wire format specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9460#section-2.2">Section 2.2</a> of [<a class="cite xref" href="#RFC9460">RFC9460</a>]</span>. <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9463#section-3.1.5">Section 3.1.5</a> of [<a class="cite xref" href="#RFC9463">RFC9463</a>]</span> lists a set of
            service parameters that are recommended to be supported by
            implementations.<a class="pilcrow" href="#section-3.1-4.18.1">¶</a></p>
<p id="section-3.1-4.18.2">The service parameters
            <span class="bcp14">MUST NOT</span> include "ipv4hint" or "ipv6hint" SvcParams, as they are
            superseded by the included IP addresses.<a class="pilcrow" href="#section-3.1-4.18.2">¶</a></p>
<p id="section-3.1-4.18.3">If no "port" service parameter is included, this
            indicates that default port numbers should be used. As a reminder,
            the default port number is 853 for DoT (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc7858#section-6">Section 6</a> of [<a class="cite xref" href="#RFC7858">RFC7858</a>]</span>), 443 for DoH (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc8484#section-8.1">Section 8.1</a> of [<a class="cite xref" href="#RFC8484">RFC8484</a>]</span>), and 853 for DoQ (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9250#section-8">Section 8</a> of [<a class="cite xref" href="#RFC9250">RFC9250</a>]</span>).<a class="pilcrow" href="#section-3.1-4.18.3">¶</a></p>
<p id="section-3.1-4.18.4">The service
            parameters apply to all IP addresses in the ENCDNS_IP*
            Configuration Payload Attribute.<a class="pilcrow" href="#section-3.1-4.18.4">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="digest">
<section id="section-3.2">
        <h3 id="name-encdns_digest_info-configur">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-encdns_digest_info-configur">ENCDNS_DIGEST_INFO Configuration Payload Attribute</a>
        </h3>
<p id="section-3.2-1">The ENCDNS_DIGEST_INFO Configuration Payload Attribute (<a class="auto internal xref" href="#digest_attr_full">Figure 2</a>) allows IKEv2 responders to specify
        a certificate digest that initiators can use when validating TLS
        connections to encrypted resolvers. This attribute can also be sent by
        the initiator to request specific hash algorithms for such
        digests.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<span id="name-encdns_digest_info-attribut"></span><div id="digest_attr_full">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.2-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-----------------------------+-------------------------------+
|R|         Attribute Type      |            Length             |
+-+-------------+---------------+-------------------------------+
| Num Hash Algs |  ADN Length   |                               |
+---------------+---------------+                               +
~                Authentication Domain Name                     ~
+---------------------------------------------------------------+
~                List of Hash Algorithm Identifiers             ~
+---------------------------------------------------------------+
~                       Certificate Digest                      ~
+---------------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-encdns_digest_info-attribut">ENCDNS_DIGEST_INFO Attribute Format</a>
          </figcaption></figure>
</div>
<p id="section-3.2-3">Some of the fields shown in <a class="auto internal xref" href="#digest_attr_full">Figure 2</a> can be omitted, as further detailed
        below.<a class="pilcrow" href="#section-3.2-3">¶</a></p>
<p id="section-3.2-4">The format of the ENCDNS_DIGEST_INFO attribute if the Configuration
        payload has type CFG_REQUEST is shown in <a class="auto internal xref" href="#digest_attr">Figure 3</a>.<a class="pilcrow" href="#section-3.2-4">¶</a></p>
<span id="name-encdns_digest_info-attribute"></span><div id="digest_attr">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-3.2-5.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-----------------------------+-------------------------------+
|R|         Attribute Type      |            Length             |
+-+-------------+---------------+-------------------------------+
| Num Hash Algs |  ADN Length   |                               |
+---------------+---------------+                               +
~                List of Hash Algorithm Identifiers             ~
+---------------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-encdns_digest_info-attribute">ENCDNS_DIGEST_INFO Attribute Format in CFG_REQUEST</a>
          </figcaption></figure>
</div>
<p id="section-3.2-6">The description of the fields shown in <a class="auto internal xref" href="#digest_attr">Figure 3</a> is as follows:<a class="pilcrow" href="#section-3.2-6">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-7">
          <dt id="section-3.2-7.1">R (Reserved, 1 bit):</dt>
          <dd id="section-3.2-7.2" style="margin-left: 1.5em">This bit <span class="bcp14">MUST</span> be set to zero and <span class="bcp14">MUST</span> be
            ignored on receipt (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-3.15.1">Section 3.15.1</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> for details).<a class="pilcrow" href="#section-3.2-7.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-7.3">Attribute Type (15 bits):</dt>
          <dd id="section-3.2-7.4" style="margin-left: 1.5em">Identifier for the Configuration
            Attribute Type.  This is set to 29; see <a class="auto internal xref" href="#IANA1">Section 8</a>.<a class="pilcrow" href="#section-3.2-7.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-7.5">Length (2 octets, unsigned integer):</dt>
          <dd id="section-3.2-7.6" style="margin-left: 1.5em">Length of the enclosed
            data in octets. This field <span class="bcp14">MUST</span> be set to "2 + (2 * 'number of
            included hash algorithm identifiers')".<a class="pilcrow" href="#section-3.2-7.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-7.7">Num Hash Algs (1 octet):</dt>
          <dd id="section-3.2-7.8" style="margin-left: 1.5em">Indicates the number of identifiers included in the "List of Hash Algorithm Identifiers" field. This field <span class="bcp14">MUST</span> be set to "(Length
            - 2)/2".<a class="pilcrow" href="#section-3.2-7.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-7.9">ADN Length (1 octet):</dt>
          <dd id="section-3.2-7.10" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be set to 0.<a class="pilcrow" href="#section-3.2-7.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-7.11">List of Hash Algorithm Identifiers (variable):</dt>
          <dd id="section-3.2-7.12" style="margin-left: 1.5em">
            <p id="section-3.2-7.12.1">Specifies a
            list of 16-bit hash algorithm identifiers that are supported by
            the encrypted DNS client. This list may be controlled by a local
            policy.<a class="pilcrow" href="#section-3.2-7.12.1">¶</a></p>
<p id="section-3.2-7.12.2">The values of this field are identifiers taken
            from "IKEv2 Hash Algorithms" on IANA's "Internet Key
            Exchange Version 2 (IKEv2) Parameters" registry <span>[<a class="cite xref" href="#IANA-IKE-HASH">IANA-IKE-HASH</a>]</span>.<a class="pilcrow" href="#section-3.2-7.12.2">¶</a></p>
<p id="section-3.2-7.12.3">There is
            no padding between the hash algorithm identifiers.<a class="pilcrow" href="#section-3.2-7.12.3">¶</a></p>
<p id="section-3.2-7.12.4">Note that SHA2-256 is mandatory to implement (see
            <a class="auto internal xref" href="#hash">Section 5</a>).<a class="pilcrow" href="#section-3.2-7.12.4">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-8">The format of the ENCDNS_DIGEST_INFO attribute if the Configuration
        payload has type CFG_REPLY or CFG_SET is shown in <a class="auto internal xref" href="#digest_attr_res">Figure 4</a>.<a class="pilcrow" href="#section-3.2-8">¶</a></p>
<span id="name-encdns_digest_info-attribute-"></span><div id="digest_attr_res">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-3.2-9.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-----------------------------+-------------------------------+
|R|         Attribute Type      |            Length             |
+-+-------------+---------------+-------------------------------+
| Num Hash Algs |  ADN Length   |                               |
+---------------+---------------+                               +
~                Authentication Domain Name                     ~
+-------------------------------+-------------------------------+
| Hash Algorithm Identifier     |                               ~
+-------------------------------+                               +
~                     Certificate Digest                        ~
+---------------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-encdns_digest_info-attribute-">ENCDNS_DIGEST_INFO Attribute Format in CFG_REPLY or CFG_SET</a>
          </figcaption></figure>
</div>
<p id="section-3.2-10">The description of the fields shown in
        <a class="auto internal xref" href="#digest_attr_res">Figure 4</a> is as follows:<a class="pilcrow" href="#section-3.2-10">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-11">
          <dt id="section-3.2-11.1">R (Reserved, 1 bit):</dt>
          <dd id="section-3.2-11.2" style="margin-left: 1.5em">This bit <span class="bcp14">MUST</span> be set to zero and <span class="bcp14">MUST</span> be
            ignored on receipt (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-3.15.1">Section 3.15.1</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> for details).<a class="pilcrow" href="#section-3.2-11.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.3">Attribute Type (15 bits):</dt>
          <dd id="section-3.2-11.4" style="margin-left: 1.5em">Identifier for the Configuration
            Attribute Type.  This is set to 29; see <a class="auto internal xref" href="#IANA1">Section 8</a>.<a class="pilcrow" href="#section-3.2-11.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.5">Length (2 octets, unsigned integer):</dt>
          <dd id="section-3.2-11.6" style="margin-left: 1.5em">Length of the data in
            octets.<a class="pilcrow" href="#section-3.2-11.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.7">Num Hash Algs (1 octet):</dt>
          <dd id="section-3.2-11.8" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be set to 1.<a class="pilcrow" href="#section-3.2-11.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.9">ADN Length (1 octet):</dt>
          <dd id="section-3.2-11.10" style="margin-left: 1.5em">Indicates the length of the
            "Authentication Domain Name" field in octets. When set to 0,
            this means that the digest applies on the ADN conveyed in the
            ENCDNS_IP* Configuration Payload Attribute.<a class="pilcrow" href="#section-3.2-11.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.11">Authentication Domain Name (variable):</dt>
          <dd id="section-3.2-11.12" style="margin-left: 1.5em">A fully qualified
            domain name of the encrypted DNS resolver following the syntax
            defined in <span>[<a class="cite xref" href="#RFC5890">RFC5890</a>]</span>. The name <span class="bcp14">MUST NOT</span>
            contain any terminators (e.g., NULL, CR). A name is included only
            when multiple ADNs are included in the ENCDNS_IP* Configuration
            Payload Attribute.<a class="pilcrow" href="#section-3.2-11.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.13">Hash Algorithm Identifier (2 octets):</dt>
          <dd id="section-3.2-11.14" style="margin-left: 1.5em">Specifies the 16-bit
            hash algorithm identifier selected by the DNS resolver to generate
            the digest of its certificate.<a class="pilcrow" href="#section-3.2-11.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-11.15">Certificate Digest (variable):</dt>
          <dd id="section-3.2-11.16" style="margin-left: 1.5em">Includes the Subject
            Public Key Info (SPKI) hash (<a class="auto internal xref" href="#hash">Section 5</a>) of the
            encrypted DNS resolver certificate using the algorithm identified
            in the "Hash Algorithm Identifier" field. The length of this field
            is "Length - 4 - 'ADN Length'".<a class="pilcrow" href="#section-3.2-11.16">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-12">The ENCDNS_DIGEST_INFO attribute may be present in the
        Configuration payload of CFG_ACK. In such a case, the
        ENCDNS_DIGEST_INFO <span class="bcp14">MUST</span> be returned with zero-length data.<a class="pilcrow" href="#section-3.2-12">¶</a></p>
<p id="section-3.2-13">As discussed in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-3.15.1">Section 3.15.1</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>,
        there are no defined uses for the CFG_SET/CFG_ACK exchange. The use of
        the ENCDNS_DIGEST_INFO attribute for these messages is provided for
        completeness.<a class="pilcrow" href="#section-3.2-13">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol">
<section id="section-4">
      <h2 id="name-ikev2-protocol-exchange">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-ikev2-protocol-exchange">IKEv2 Protocol Exchange</a>
      </h2>
<p id="section-4-1">This section describes how the attributes defined in <a class="auto internal xref" href="#RI">Section 3</a> are used to configure an IKEv2 initiator with one or
      more encrypted DNS resolvers. As a reminder, badly formatted attributes
      or unacceptable fields are handled as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-2.21">Section 2.21</a> of [<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">Initiators first indicate support for encrypted DNS by including
      ENCDNS_IP* attributes in their CFG_REQUEST payloads. Responders supply
      encrypted DNS configuration by including ENCDNS_IP* attributes in their
      CFG_REPLY payloads. Concretely:<a class="pilcrow" href="#section-4-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.1">If the initiator supports encrypted DNS, it includes either or
          both of the ENCDNS_IP4 and ENCDNS_IP6 attributes in its CFG_REQUEST.
          If the initiator does not want to request specific DNS resolvers, it
          sets the "Length" field to 0 for the attribute. For a given attribute
          type, the initiator <span class="bcp14">MAY</span> send either an empty attribute or a list of
          distinct suggested resolvers. The initiator <span class="bcp14">MAY</span> also include the
          ENCDNS_DIGEST_INFO attribute with a list of hash algorithms that are
          supported by the encrypted DNS client.<a class="pilcrow" href="#section-4-3.1">¶</a>
</li>
        <li class="normal" id="section-4-3.2">If the request includes multiple bitwise identical attributes,
          only the first occurrence is processed, and the rest <span class="bcp14">SHOULD</span> be
          ignored by the responder. The responder <span class="bcp14">MAY</span> discard the full request
          if the count of repeated attributes exceeds an
          (implementation-specific) threshold.<a class="pilcrow" href="#section-4-3.2">¶</a>
</li>
        <li class="normal" id="section-4-3.3">For each ENCDNS_IP* attribute from the CFG_REQUEST, if the
          responder supports the corresponding address family, and absent any
          policy restrictions, the responder sends back one or more ENCDNS_IP*
          attributes in the CFG_REPLY with an appropriate list of IP
          addresses, service parameters, and an ADN. The list of IP addresses
          <span class="bcp14">MUST</span> include at least one IP address. The service parameters <span class="bcp14">SHOULD</span>
          include at least the "alpn" service parameter. The "alpn" service
          parameter may not be required in contexts such as a variant of DNS
          over the Constrained Application Protocol (CoAP) where the messages are encrypted using Object Security for
          Constrained RESTful Environments (OSCORE) <span>[<a class="cite xref" href="#RFC8613">RFC8613</a>]</span>.<a class="pilcrow" href="#section-4-3.3">¶</a>
</li>
        <li class="normal" id="section-4-3.4">The responder <span class="bcp14">MAY</span> ignore suggested values from the initiator (if
          any). Multiple instances of the same ENCDNS_IP* attribute <span class="bcp14">MAY</span> be
          returned if distinct ADNs or service parameters need to be assigned
          to the initiator. In such instances, the different attributes can
          have matching or distinct IP addresses. These instances <span class="bcp14">MUST</span> be
          presented to a local DNS client following their service priority
          (i.e., a smaller service priority value indicates a higher
          preference).<a class="pilcrow" href="#section-4-3.4">¶</a>
</li>
        <li class="normal" id="section-4-3.5">In addition, the responder <span class="bcp14">MAY</span> return the ENCDNS_DIGEST_INFO
          attribute to convey a digest of the certificate of the encrypted DNS
          and the identifier of the hash algorithm that is used to generate
          the digest.<a class="pilcrow" href="#section-4-3.5">¶</a>
</li>
        <li class="normal" id="section-4-3.6">If the CFG_REQUEST includes an ENCDNS_IP* attribute but the
          CFG_REPLY does not include an ENCDNS_IP* attribute matching the requested
          address family, this is an indication that the requested address family
          is not supported by the responder or the responder is not configured
          to provide corresponding resolver addresses.<a class="pilcrow" href="#section-4-3.6">¶</a>
</li>
        <li class="normal" id="section-4-3.7">If the initiator receives both ENCDNS_IP* and INTERNAL_IP6_DNS
          (or INTERNAL_IP4_DNS) attributes, it is <span class="bcp14">RECOMMENDED</span> that the
          initiator use the encrypted DNS resolvers.<a class="pilcrow" href="#section-4-3.7">¶</a>
</li>
      </ul>
<p id="section-4-4">The DNS client establishes an encrypted DNS session (e.g., DoT, DoH, or
      DoQ) with the address or addresses conveyed in ENCDNS_IP* and uses the mechanisms
      discussed in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8310#section-8">Section 8</a> of [<a class="cite xref" href="#RFC8310">RFC8310</a>]</span> to authenticate
      the DNS resolver certificate using the ADN
      conveyed in ENCDNS_IP*.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">If the CFG_REPLY includes an ENCDNS_DIGEST_INFO attribute, the client
      has to create an SPKI hash (<a class="auto internal xref" href="#hash">Section 5</a>) of the DNS
      resolver certificate received in the TLS handshake using the negotiated
      hash algorithm in the ENCDNS_DIGEST_INFO attribute. If the computed
      digest for an ADN matches the digest sent in the ENCDNS_DIGEST_INFO
      attribute, the encrypted DNS resolver certificate is successfully
      validated. If so, the client continues with the TLS connection as
      normal. Otherwise, the client <span class="bcp14">MUST</span> treat the resolver certificate
      validation failure as a non-recoverable error. This approach is similar
      to certificate usage PKIX-EE(1) with selector SPKI(1) as defined in <span>[<a class="cite xref" href="#RFC7671">RFC7671</a>]</span>, but without PKIX validation.<a class="pilcrow" href="#section-4-5">¶</a></p>
<p id="section-4-6">If the IPsec connection is a split-tunnel configuration and the
      initiator negotiated INTERNAL_DNS_DOMAIN as per <span>[<a class="cite xref" href="#RFC8598">RFC8598</a>]</span>, the DNS client resolves the internal names
      using ENCDNS_IP* DNS resolvers.<a class="pilcrow" href="#section-4-6">¶</a></p>
<p id="section-4-7" style="margin-left: 1.5em">Note: <span>[<a class="cite xref" href="#RFC8598">RFC8598</a>]</span> requires that the INTERNAL_IP6_DNS
          (or INTERNAL_IP4_DNS) attribute be present when
          INTERNAL_DNS_DOMAIN is included. This specification relaxes that
          constraint in the presence of ENCDNS_IP* attributes. That is, if
          ENCDNS_IP* attributes are supplied, responders are allowed to
          include INTERNAL_DNS_DOMAIN even in the absence of INTERNAL_IP6_DNS
          (or INTERNAL_IP4_DNS) attributes.<a class="pilcrow" href="#section-4-7">¶</a></p>
</section>
</div>
<div id="hash">
<section id="section-5">
      <h2 id="name-subject-public-key-info-spk">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-subject-public-key-info-spk">Subject Public Key Info (SPKI) Hash</a>
      </h2>
<p id="section-5-1">The SPKI hash of the encrypted DNS resolver certificate is the output
      of a cryptographic hash algorithm whose input is the DER-encoded ASN.1
      representation of the SPKI.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">Implementations <span class="bcp14">MUST</span> support SHA2-256 <span>[<a class="cite xref" href="#RFC6234">RFC6234</a>]</span>.<a class="pilcrow" href="#section-5-2">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-6">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-6-1">This document adheres to the security considerations defined in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>. In particular, this document does not alter
      the trust that the initiator has placed on the DNS configuration provided by a responder.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">Networks are susceptible to internal attacks as discussed in <span><a class="relref" href="https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04#section-3.2">Section 3.2</a> of [<a class="cite xref" href="#I-D.arkko-farrell-arch-model-t">INT-THREAT-MOD</a>]</span>. Hosting
      encrypted DNS resolvers even in the case of split-VPN configuration can
      minimize the attack vector (e.g., a compromised network device cannot
      monitor/modify DNS traffic). This specification describes a mechanism for
      restricting access to the DNS messages to only the parties that need to
      know.<a class="pilcrow" href="#section-6-2">¶</a></p>
<p id="section-6-3">If the IKEv2 responder has used the NULL Authentication method <span>[<a class="cite xref" href="#RFC7619">RFC7619</a>]</span> to authenticate itself, the initiator <span class="bcp14">MUST NOT</span>
      use returned ENCDNS_IP* resolvers configuration unless the initiator is
      preconfigured, e.g., in the operating system or the application.<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">This specification does not extend the scope of accepting DNSSEC
      trust anchors beyond the usage guidelines defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8598#section-6">Section 6</a> of [<a class="cite xref" href="#RFC8598">RFC8598</a>]</span>.<a class="pilcrow" href="#section-6-4">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-privacy-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-privacy-considerations">Privacy Considerations</a>
      </h2>
<p id="section-7-1">As discussed in <span>[<a class="cite xref" href="#RFC9076">RFC9076</a>]</span>, the use of encrypted
      DNS does not reduce the data available in the DNS resolver. For example,
      the reader may refer to <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8484#section-8">Section 8</a> of [<a class="cite xref" href="#RFC8484">RFC8484</a>]</span> or
      <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9250#section-7">Section 7</a> of [<a class="cite xref" href="#RFC9250">RFC9250</a>]</span> for a discussion on specific
      privacy considerations for encrypted DNS.<a class="pilcrow" href="#section-7-1">¶</a></p>
</section>
<div id="IANA1">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-8-1">IANA has assigned the following new IKEv2
      Configuration Payload Attribute Types in the "IKEv2 Configuration
      Payload Attribute Types" namespace available at <span>[<a class="cite xref" href="#IANA-IKE-CFG">IANA-IKE-CFG</a>]</span>.<a class="pilcrow" href="#section-8-1">¶</a></p>
<div id="tab-1">
<table class="center" id="table-1">
        <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Attribute Type</th>
            <th class="text-left" colspan="1" rowspan="1">Multivalued</th>
            <th class="text-left" colspan="1" rowspan="1">Length</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">27</td>
            <td class="text-left" colspan="1" rowspan="1">ENCDNS_IP4</td>
            <td class="text-left" colspan="1" rowspan="1">YES</td>
            <td class="text-left" colspan="1" rowspan="1">0 or more</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9464</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">28</td>
            <td class="text-left" colspan="1" rowspan="1">ENCDNS_IP6</td>
            <td class="text-left" colspan="1" rowspan="1">YES</td>
            <td class="text-left" colspan="1" rowspan="1">0 or more</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9464</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">29</td>
            <td class="text-left" colspan="1" rowspan="1">ENCDNS_DIGEST_INFO</td>
            <td class="text-left" colspan="1" rowspan="1">YES</td>
            <td class="text-left" colspan="1" rowspan="1">0 or more</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9464</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="IANA-IKE-HASH">[IANA-IKE-HASH]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"IKEv2 Hash Algorithms"</span>, <span>&lt;<a href="https://www.iana.org/assignments/ikev2-parameters/">https://www.iana.org/assignments/ikev2-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5890">[RFC5890]</dt>
        <dd>
<span class="refAuthor">Klensin, J.</span>, <span class="refTitle">"Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework"</span>, <span class="seriesInfo">RFC 5890</span>, <span class="seriesInfo">DOI 10.17487/RFC5890</span>, <time class="refDate" datetime="2010-08">August 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5890">https://www.rfc-editor.org/info/rfc5890</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time class="refDate" datetime="2011-05">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8310">[RFC8310]</dt>
        <dd>
<span class="refAuthor">Dickinson, S.</span>, <span class="refAuthor">Gillmor, D.</span>, and <span class="refAuthor">T. Reddy</span>, <span class="refTitle">"Usage Profiles for DNS over TLS and DNS over DTLS"</span>, <span class="seriesInfo">RFC 8310</span>, <span class="seriesInfo">DOI 10.17487/RFC8310</span>, <time class="refDate" datetime="2018-03">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8310">https://www.rfc-editor.org/info/rfc8310</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8598">[RFC8598]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span> and <span class="refAuthor">P. Wouters</span>, <span class="refTitle">"Split DNS Configuration for the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 8598</span>, <span class="seriesInfo">DOI 10.17487/RFC8598</span>, <time class="refDate" datetime="2019-05">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8598">https://www.rfc-editor.org/info/rfc8598</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9460">[RFC9460]</dt>
      <dd>
<span class="refAuthor">Schwartz, B.</span>, <span class="refAuthor">Bishop, M.</span>, and <span class="refAuthor">E. Nygren</span>, <span class="refTitle">"Service Binding and Parameter Specification via the DNS (SVCB and HTTPS Resource Records)"</span>, <span class="seriesInfo">RFC 9460</span>, <span class="seriesInfo">DOI 10.17487/RFC9460</span>, <time class="refDate" datetime="2023-11">November 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9460">https://www.rfc-editor.org/info/rfc9460</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="IANA-IKE-CFG">[IANA-IKE-CFG]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"IKEv2 Configuration Payload Attribute Types"</span>, <span>&lt;<a href="https://www.iana.org/assignments/ikev2-parameters/">https://www.iana.org/assignments/ikev2-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.arkko-farrell-arch-model-t">[INT-THREAT-MOD]</dt>
        <dd>
<span class="refAuthor">Arkko, J.</span> and <span class="refAuthor">S. Farrell</span>, <span class="refTitle">"Challenges and Changes in the Internet Threat Model"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-arkko-farrell-arch-model-t-04</span>, <time class="refDate" datetime="2020-07-13">13 July 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04">https://datatracker.ietf.org/doc/html/draft-arkko-farrell-arch-model-t-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7619">[RFC7619]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span> and <span class="refAuthor">P. Wouters</span>, <span class="refTitle">"The NULL Authentication Method in the Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 7619</span>, <span class="seriesInfo">DOI 10.17487/RFC7619</span>, <time class="refDate" datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7619">https://www.rfc-editor.org/info/rfc7619</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7671">[RFC7671]</dt>
        <dd>
<span class="refAuthor">Dukhovni, V.</span> and <span class="refAuthor">W. Hardaker</span>, <span class="refTitle">"The DNS-Based Authentication of Named Entities (DANE) Protocol: Updates and Operational Guidance"</span>, <span class="seriesInfo">RFC 7671</span>, <span class="seriesInfo">DOI 10.17487/RFC7671</span>, <time class="refDate" datetime="2015-10">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7671">https://www.rfc-editor.org/info/rfc7671</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7858">[RFC7858]</dt>
        <dd>
<span class="refAuthor">Hu, Z.</span>, <span class="refAuthor">Zhu, L.</span>, <span class="refAuthor">Heidemann, J.</span>, <span class="refAuthor">Mankin, A.</span>, <span class="refAuthor">Wessels, D.</span>, and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Specification for DNS over Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 7858</span>, <span class="seriesInfo">DOI 10.17487/RFC7858</span>, <time class="refDate" datetime="2016-05">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7858">https://www.rfc-editor.org/info/rfc7858</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time class="refDate" datetime="2018-10">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8484">https://www.rfc-editor.org/info/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8499">[RFC8499]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Sullivan, A.</span>, and <span class="refAuthor">K. Fujiwara</span>, <span class="refTitle">"DNS Terminology"</span>, <span class="seriesInfo">BCP 219</span>, <span class="seriesInfo">RFC 8499</span>, <span class="seriesInfo">DOI 10.17487/RFC8499</span>, <time class="refDate" datetime="2019-01">January 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8499">https://www.rfc-editor.org/info/rfc8499</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time class="refDate" datetime="2019-07">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9076">[RFC9076]</dt>
        <dd>
<span class="refAuthor">Wicinski, T., Ed.</span>, <span class="refTitle">"DNS Privacy Considerations"</span>, <span class="seriesInfo">RFC 9076</span>, <span class="seriesInfo">DOI 10.17487/RFC9076</span>, <time class="refDate" datetime="2021-07">July 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9076">https://www.rfc-editor.org/info/rfc9076</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9250">[RFC9250]</dt>
        <dd>
<span class="refAuthor">Huitema, C.</span>, <span class="refAuthor">Dickinson, S.</span>, and <span class="refAuthor">A. Mankin</span>, <span class="refTitle">"DNS over Dedicated QUIC Connections"</span>, <span class="seriesInfo">RFC 9250</span>, <span class="seriesInfo">DOI 10.17487/RFC9250</span>, <time class="refDate" datetime="2022-05">May 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9250">https://www.rfc-editor.org/info/rfc9250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9463">[RFC9463]</dt>
      <dd>
<span class="refAuthor">Boucadair, M., Ed.</span>, <span class="refAuthor">Reddy.K, T., Ed.</span>, <span class="refAuthor">Wing, D.</span>, <span class="refAuthor">Cook, N.</span>, and <span class="refAuthor">T. Jensen</span>, <span class="refTitle">"DHCP and Router Advertisement Options for the Discovery of Network-designated Resolvers (DNR)"</span>, <span class="seriesInfo">RFC 9463</span>, <span class="seriesInfo">DOI 10.17487/RFC9463</span>, <time class="refDate" datetime="2023-11">November 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9463">https://www.rfc-editor.org/info/rfc9463</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-configuration-payload-examp">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-configuration-payload-examp">Configuration Payload Examples</a>
      </h2>
<section id="appendix-A.1">
        <h3 id="name-configuration-of-encrypted-">
<a class="section-number selfRef" href="#appendix-A.1">A.1. </a><a class="section-name selfRef" href="#name-configuration-of-encrypted-">Configuration of Encrypted IPv6 DNS Resolvers without Suggested Values</a>
        </h3>
<p id="appendix-A.1-1"><a class="auto internal xref" href="#ex1">Figure 5</a> depicts an example of a CFG_REQUEST to
        request the configuration of IPv6 DNS resolvers without providing any
        suggested values. In this example, the initiator uses the
        ENCDNS_DIGEST_INFO attribute to indicate that the encrypted DNS client
        supports SHA2-256 (2), SHA2-384 (3), and SHA2-512 (4) hash algorithms
        for certificate digests. The label of these algorithms is taken from
        <span>[<a class="cite xref" href="#IANA-IKE-HASH">IANA-IKE-HASH</a>]</span>. The use of INTERNAL_IP6_ADDRESS
        is explained in <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span> and thus is not
        reiterated here.<a class="pilcrow" href="#appendix-A.1-1">¶</a></p>
<span id="name-example-of-a-cfg_request"></span><div id="ex1">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="appendix-A.1-2.1">
<pre>CP(CFG_REQUEST) =
  INTERNAL_IP6_ADDRESS()
  INTERNAL_IP6_DNS()
  ENCDNS_IP6()
  ENCDNS_DIGEST_INFO(0, (SHA2-256, SHA2-384, SHA2-512))
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-example-of-a-cfg_request">Example of a CFG_REQUEST</a>
          </figcaption></figure>
</div>
<p id="appendix-A.1-3"><a class="auto internal xref" href="#ex2">Figure 6</a> depicts an example of a CFG_REPLY that
        can be sent by a responder as a response to the above CFG_REQUEST. This
        response indicates the following information to identify the encrypted
        DNS resolver:<a class="pilcrow" href="#appendix-A.1-3">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-4.1">Its service priority, which is 1.<a class="pilcrow" href="#appendix-A.1-4.1">¶</a>
</li>
          <li class="normal" id="appendix-A.1-4.2">Its single (1) IPv6 address (2001:db8:99:88:77:66:55:44).<a class="pilcrow" href="#appendix-A.1-4.2">¶</a>
</li>
          <li class="normal" id="appendix-A.1-4.3">Its ADN (doh.example.com). This ADN has
            a length of 15.<a class="pilcrow" href="#appendix-A.1-4.3">¶</a>
</li>
          <li class="normal" id="appendix-A.1-4.4">Its supported HTTP version (h2).<a class="pilcrow" href="#appendix-A.1-4.4">¶</a>
</li>
          <li class="normal" id="appendix-A.1-4.5">The relative form of the URI Template (/dns-query{?dns}).<a class="pilcrow" href="#appendix-A.1-4.5">¶</a>
</li>
          <li class="normal" id="appendix-A.1-4.6">The SPKI hash of the resolver's certificate using SHA2-256
            (8b6e7a5971cc6bb0b4db5a71...).<a class="pilcrow" href="#appendix-A.1-4.6">¶</a>
</li>
        </ul>
<span id="name-example-of-a-cfg_reply"></span><div id="ex2">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="appendix-A.1-5.1">
<pre>CP(CFG_REPLY) =
  INTERNAL_IP6_ADDRESS(2001:db8:0:1:2:3:4:5/64)
  ENCDNS_IP6(1, 1, 15,
                (2001:db8:99:88:77:66:55:44),
                "doh.example.com",
                (alpn=h2 dohpath=/dns-query{?dns}))
  ENCDNS_DIGEST_INFO(0, SHA2-256,
                        8b6e7a5971cc6bb0b4db5a71...)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-example-of-a-cfg_reply">Example of a CFG_REPLY</a>
          </figcaption></figure>
</div>
<p id="appendix-A.1-6">In the example depicted in <a class="auto internal xref" href="#ex2">Figure 6</a>, no ADN is
        included in the ENCDNS_DIGEST_INFO attribute because only one ADN is
        provided in the ENCDNS_IP6 attribute. Identifying the encrypted resolver
        associated with the supplied digest is therefore unambiguous.<a class="pilcrow" href="#appendix-A.1-6">¶</a></p>
</section>
<section id="appendix-A.2">
        <h3 id="name-configuration-of-encrypted-i">
<a class="section-number selfRef" href="#appendix-A.2">A.2. </a><a class="section-name selfRef" href="#name-configuration-of-encrypted-i">Configuration of Encrypted IPv6 DNS Resolvers with Suggested Values</a>
        </h3>
<p id="appendix-A.2-1">An initiator may provide suggested values in the CFG_REQUEST when
        requesting an encrypted DNS resolver. For example, the initiator
        may:<a class="pilcrow" href="#appendix-A.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-2.1">
            <p id="appendix-A.2-2.1.1">Indicate a preferred resolver that is identified by an IPv6
            address (see <a class="auto internal xref" href="#ex3">Figure 7</a>).<a class="pilcrow" href="#appendix-A.2-2.1.1">¶</a></p>
<span id="name-example-of-a-cfg_request-wi"></span><div id="ex3">
<figure id="figure-7">
              <div class="alignLeft art-text artwork" id="appendix-A.2-2.1.2.1">
<pre>CP(CFG_REQUEST) =
  INTERNAL_IP6_ADDRESS()
  INTERNAL_IP6_DNS()
  ENCDNS_IP6(1, 1, 0,
                (2001:db8:99:88:77:66:55:44))
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-example-of-a-cfg_request-wi">Example of a CFG_REQUEST with a Preferred Resolver Identified by Its IP Address</a>
              </figcaption></figure>
</div>
</li>
          <li class="normal" id="appendix-A.2-2.2">
            <p id="appendix-A.2-2.2.1">Indicate a preferred resolver that is identified by an ADN (see
            <a class="auto internal xref" href="#ex4">Figure 8</a>).<a class="pilcrow" href="#appendix-A.2-2.2.1">¶</a></p>
<span id="name-example-of-a-cfg_request-wit"></span><div id="ex4">
<figure id="figure-8">
              <div class="alignLeft art-text artwork" id="appendix-A.2-2.2.2.1">
<pre>CP(CFG_REQUEST) =
  INTERNAL_IP6_ADDRESS()
  INTERNAL_IP6_DNS()
  ENCDNS_IP6(1, 0, 15, "doh.example.com")
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-example-of-a-cfg_request-wit">Example of a CFG_REQUEST with a Preferred Resolver Identified by Its ADN</a>
              </figcaption></figure>
</div>
</li>
          <li class="normal" id="appendix-A.2-2.3">
            <p id="appendix-A.2-2.3.1">Indicate a preferred transport protocol (DoT, in the example
            depicted in <a class="auto internal xref" href="#ex5">Figure 9</a>).<a class="pilcrow" href="#appendix-A.2-2.3.1">¶</a></p>
<span id="name-example-of-a-cfg_request-with"></span><div id="ex5">
<figure id="figure-9">
              <div class="alignLeft art-text artwork" id="appendix-A.2-2.3.2.1">
<pre>CP(CFG_REQUEST) =
  INTERNAL_IP6_ADDRESS()
  INTERNAL_IP6_DNS()
  ENCDNS_IP6(1, 0, 0, (alpn=dot))
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-example-of-a-cfg_request-with">Example of a CFG_REQUEST with a Preferred Transport Protocol</a>
              </figcaption></figure>
</div>
</li>
          <li class="normal" id="appendix-A.2-2.4">or any combination thereof.<a class="pilcrow" href="#appendix-A.2-2.4">¶</a>
</li>
        </ul>
</section>
<section id="appendix-A.3">
        <h3 id="name-split-dns">
<a class="section-number selfRef" href="#appendix-A.3">A.3. </a><a class="section-name selfRef" href="#name-split-dns">Split DNS</a>
        </h3>
<p id="appendix-A.3-1">An initiator may also indicate that it supports Split DNS by
        including the INTERNAL_DNS_DOMAIN attribute in a CFG_REQUEST as shown
        in <a class="auto internal xref" href="#ex6">Figure 10</a>. In this example, the initiator does not
        indicate any preference for the requested encrypted DNS server, nor does it indicate
        which DNS queries will be forwarded through the IPsec tunnel.<a class="pilcrow" href="#appendix-A.3-1">¶</a></p>
<span id="name-example-of-a-cfg_request-with-"></span><div id="ex6">
<figure id="figure-10">
          <div class="alignLeft art-text artwork" id="appendix-A.3-2.1">
<pre>CP(CFG_REQUEST) =
  INTERNAL_IP6_ADDRESS()
  INTERNAL_IP6_DNS()
  ENCDNS_IP6()
  INTERNAL_DNS_DOMAIN()
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-10">Figure 10</a>:
<a class="selfRef" href="#name-example-of-a-cfg_request-with-">Example of a CFG_REQUEST with Support for Split DNS</a>
          </figcaption></figure>
</div>
<p id="appendix-A.3-3"><a class="auto internal xref" href="#ex7">Figure 11</a> shows an example of the responder's reply. Absent any prohibited local policy, the initiator uses the
        encrypted DNS server (doh.example.com) for any subsequent DNS queries
        for "example.com" and its subdomains.<a class="pilcrow" href="#appendix-A.3-3">¶</a></p>
<span id="name-example-of-a-cfg_reply-with"></span><div id="ex7">
<figure id="figure-11">
          <div class="alignLeft art-text artwork" id="appendix-A.3-4.1">
<pre>CP(CFG_REPLY) =
  INTERNAL_IP6_ADDRESS(2001:db8:0:1:2:3:4:5/64)
  ENCDNS_IP6(1, 1, 15,
                (2001:db8:99:88:77:66:55:44),
                "doh.example.com",
                (alpn=h2 dohpath=/dns-query{?dns}))
  INTERNAL_DNS_DOMAIN(example.com)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-11">Figure 11</a>:
<a class="selfRef" href="#name-example-of-a-cfg_reply-with">Example of a CFG_REPLY with INTERNAL_DNS_DOMAIN</a>
          </figcaption></figure>
</div>
</section>
</section>
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">Many thanks to <span class="contact-name">Yoav Nir</span>, <span class="contact-name">Christian Jacquenet</span>, <span class="contact-name">Paul Wouters</span>, and <span class="contact-name">Tommy Pauly</span> for their reviews and comments.<a class="pilcrow" href="#appendix-B-1">¶</a></p>
<p id="appendix-B-2"><span class="contact-name">Yoav</span> and <span class="contact-name">Paul</span> suggested the use of one single attribute carrying both
      the name and an IP address instead of depending on the existing
      INTERNAL_IP6_DNS and INTERNAL_IP4_DNS attributes.<a class="pilcrow" href="#appendix-B-2">¶</a></p>
<p id="appendix-B-3">Thanks to <span class="contact-name">Tero Kivinen</span> for the Shepherd review and <span class="contact-name">Roman Danyliw</span> for
      the AD review.<a class="pilcrow" href="#appendix-B-3">¶</a></p>
<p id="appendix-B-4">Thanks to <span class="contact-name">Stewart Bryant</span> for the gen-art review, <span class="contact-name">Dhruv Dhody</span> for the
      ops-dir review, and <span class="contact-name">Patrick Mevzek</span> for the dns-dir review.<a class="pilcrow" href="#appendix-B-4">¶</a></p>
<p id="appendix-B-5">Thanks to <span class="contact-name">Paul Wouters</span>, <span class="contact-name">Zaheduzzaman Sarker</span>, <span class="contact-name">Éric Vyncke</span>, and <span class="contact-name">Robert Wilton</span> for their comments during the IESG review.<a class="pilcrow" href="#appendix-B-5">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mohamed Boucadair</span></div>
<div class="left" dir="auto"><span class="org">Orange</span></div>
<div class="left" dir="auto">
<span class="postal-code">35000</span> <span class="locality">Rennes</span>
</div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mohamed.boucadair@orange.com">mohamed.boucadair@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Tirumaleswar Reddy.K</span></div>
<div class="left" dir="auto"><span class="org">Nokia</span></div>
<div class="left" dir="auto"><span class="country-name">India</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:kondtir@gmail.com">kondtir@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Dan Wing</span></div>
<div class="left" dir="auto"><span class="org">Cloud Software Group Holdings, Inc.</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:dwing-ietf@fuggles.com">dwing-ietf@fuggles.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Valery Smyslov</span></div>
<div class="left" dir="auto"><span class="org">ELVIS-PLUS</span></div>
<div class="left" dir="auto"><span class="country-name">Russian Federation</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:svan@elvis.ru">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>