<html><head></head><body><pre>Network Working Group                                       T. Moncaster
Request for Comments: 5696                                    B. Briscoe
Category: Standards Track                                             BT
                                                                M. Menth
                                                 University of Wuerzburg
                                                           November 2009


     <span class="h1">Baseline Encoding and Transport of Pre-Congestion Information</span>

Abstract

   The objective of the Pre-Congestion Notification (PCN) architecture
   is to protect the quality of service (QoS) of inelastic flows within
   a Diffserv domain.  It achieves this by marking packets belonging to
   PCN-flows when the rate of traffic exceeds certain configured
   thresholds on links in the domain.  These marks can then be evaluated
   to determine how close the domain is to being congested.  This
   document specifies how such marks are encoded into the IP header by
   redefining the Explicit Congestion Notification (ECN) codepoints
   within such domains.  The baseline encoding described here provides
   only two PCN encoding states: Not-marked and PCN-marked.  Future
   extensions to this encoding may be needed in order to provide more
   than one level of marking severity.

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the BSD License.




<span class="grey">Moncaster, et al.           Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Requirements Notation  . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Terminology and Abbreviations  . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-3.1">3.1</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-3.2">3.2</a>.  List of Abbreviations  . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Encoding Two PCN States in IP  . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-4.1">4.1</a>.  Marking Packets  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-4.2">4.2</a>.  Valid and Invalid Codepoint Transitions  . . . . . . . . .  <a href="#page-6">6</a>
     <a href="#section-4.3">4.3</a>.  Rationale for Encoding . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-4.4">4.4</a>.  PCN-Compatible Diffserv Codepoints . . . . . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-4.4.1">4.4.1</a>.  Co-Existence of PCN and Not-PCN Traffic  . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-5">5</a>.  Rules for Experimental Encoding Schemes  . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Backward Compatibility . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
   <a href="#section-7">7</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
   <a href="#section-8">8</a>.  Conclusions  . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-9">9</a>.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#section-10">10</a>. References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-10.1">10.1</a>. Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-10.2">10.2</a>. Informative References . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
   <a href="#appendix-A">Appendix A</a>.  PCN Deployment Considerations (Informative) . . . . . <a href="#page-11">11</a>
     <a href="#appendix-A.1">A.1</a>.  Choice of Suitable DSCPs . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
     <a href="#appendix-A.2">A.2</a>.  Rationale for Using ECT(0) for Not-Marked  . . . . . . . . <a href="#page-12">12</a>
   <a href="#appendix-B">Appendix B</a>.  Co-Existence of PCN and ECN (Informative) . . . . . . <a href="#page-13">13</a>














<span class="grey">Moncaster, et al.           Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   The objective of the Pre-Congestion Notification (PCN) architecture
   [<a href="./rfc5559" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>] is to protect the quality of service (QoS) of inelastic
   flows within a Diffserv domain in a simple, scalable, and robust
   fashion.  The overall rate of PCN-traffic is metered on every link in
   the PCN-domain, and PCN-packets are appropriately marked when certain
   configured rates are exceeded.  These configured rates are below the
   rate of the link, thus providing notification before any congestion
   occurs (hence "Pre-Congestion Notification").  The level of marking
   allows the boundary nodes to make decisions about whether to admit or
   block a new flow request, and (in abnormal circumstances) whether to
   terminate some of the existing flows, thereby protecting the QoS of
   previously admitted flows.

   This document specifies how these PCN-marks are encoded into the IP
   header by reusing the bits of the Explicit Congestion Notification
   (ECN) field [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>].  It also describes how packets are identified
   as belonging to a PCN-flow.  Some deployment models require two PCN
   encoding states, others require more.  The baseline encoding
   described here only provides for two PCN encoding states.  However,
   the encoding can be easily extended to provide more states.  Rules
   for such extensions are given in <a href="#section-5">Section 5</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Requirements%20Notation"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Requirements Notation</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Terminology%20and%20Abbreviations"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Terminology and Abbreviations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20Terminology"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Terminology</span>

   The terms PCN-capable, PCN-domain, PCN-node, PCN-interior-node, PCN-
   ingress-node, PCN-egress-node, PCN-boundary-node, PCN-traffic, PCN-
   packets and PCN-marking are used as defined in [<a href="./rfc5559" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>].  The
   following additional terms are defined in this document:

   o  PCN-compatible Diffserv codepoint - a Diffserv codepoint
      indicating packets for which the ECN field is used to carry PCN-
      markings rather than [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>] markings.

   o  PCN-marked codepoint - a codepoint that indicates packets that
      have been marked at a PCN-interior-node using some PCN-marking
      behaviour [<a href="./rfc5670" title='"Metering and Marking Behaviour of PCN- Nodes"'>RFC5670</a>].  Abbreviated to PM.





<span class="grey">Moncaster, et al.           Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   o  Not-marked codepoint - a codepoint that indicates packets that are
      PCN-capable but that are not PCN-marked.  Abbreviated to NM.

   o  not-PCN codepoint - a codepoint that indicates packets that are
      not PCN-capable.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20List%20of%20Abbreviations"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  List of Abbreviations</span>

   The following abbreviations are used in this document:

   o  AF = Assured Forwarding [<a href="./rfc2597" title='"Assured Forwarding PHB Group"'>RFC2597</a>]

   o  CE = Congestion Experienced [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>]

   o  CS = Class Selector [<a href="./rfc2474" title='"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"'>RFC2474</a>]

   o  DSCP = Diffserv codepoint

   o  ECN = Explicit Congestion Notification [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>]

   o  ECT = ECN Capable Transport [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>]

   o  EF = Expedited Forwarding [<a href="./rfc3246" title='"An Expedited Forwarding PHB (Per-Hop Behavior)"'>RFC3246</a>]

   o  EXP = Experimental

   o  NM = Not-marked

   o  PCN = Pre-Congestion Notification

   o  PM = PCN-marked

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Encoding%20Two%20PCN%20States%20in%20IP"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Encoding Two PCN States in IP</span>

   The PCN encoding states are defined using a combination of the DSCP
   and ECN fields within the IP header.  The baseline PCN encoding
   closely follows the semantics of ECN [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>].  It allows the
   encoding of two PCN states: Not-marked and PCN-marked.  It also
   allows for traffic that is not PCN-capable to be marked as such (not-
   PCN).  Given the scarcity of codepoints within the IP header, the
   baseline encoding leaves one codepoint free for experimental use.
   The following table defines how to encode these states in IP:









<span class="grey">Moncaster, et al.           Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   +---------------+-------------+-------------+-------------+---------+
   | ECN codepoint |   Not-ECT   | ECT(0) (10) | ECT(1) (01) | CE (11) |
   |               |     (00)    |             |             |         |
   +---------------+-------------+-------------+-------------+---------+
   |     DSCP n    |   not-PCN   |      NM     |     EXP     |    PM   |
   +---------------+-------------+-------------+-------------+---------+

                        Table 1: Encoding PCN in IP

   In the table above, DSCP n is a PCN-compatible Diffserv codepoint
   (see <a href="#section-4.4">Section 4.4</a>) and EXP means available for Experimental use.  N.B.
   we deliberately reserve this codepoint for experimental use only (and
   not local use) to prevent future compatibility issues.

   The following rules apply to all PCN-traffic:

   o  PCN-traffic MUST be marked with a PCN-compatible Diffserv
      codepoint.  To conserve DSCPs, Diffserv codepoints SHOULD be
      chosen that are already defined for use with admission-controlled
      traffic.  <a href="#appendix-A.1">Appendix A.1</a> gives guidance to implementors on suitable
      DSCPs.  Guidelines for mixing traffic types within a PCN-domain
      are given in [<a href="./rfc5670" title='"Metering and Marking Behaviour of PCN- Nodes"'>RFC5670</a>].

   o  Any packet arriving at the PCN-ingress-node that shares a PCN-
      compatible DSCP and is not a PCN-packet MUST be marked as not-PCN
      within the PCN-domain.

   o  If a packet arrives at the PCN-ingress-node with its ECN field
      already set to a value other than not-ECT, then appropriate action
      MUST be taken to meet the requirements of [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>].  The simplest
      appropriate action is to just drop such packets.  However, this is
      a drastic action that an operator may feel is undesirable.
      <a href="#appendix-B">Appendix B</a> provides more information and summarises other
      alternative actions that might be taken.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Marking%20Packets"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Marking Packets</span>

   [<a id="ref-RFC5670">RFC5670</a>] states that any encoding scheme document must specify the
   required action to take if one of the marking algorithms indicates
   that a packet needs to be marked.  For the baseline encoding scheme,
   the required action is simply as follows:

   o  If a marking algorithm indicates the need to mark a PCN-packet,
      then that packet MUST have its PCN codepoint set to 11, PCN-
      marked.






<span class="grey">Moncaster, et al.           Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Valid%20and%20Invalid%20Codepoint%20Transitions"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Valid and Invalid Codepoint Transitions</span>

   A PCN-ingress-node MUST set the Not-marked (10) codepoint on any
   arriving packet that belongs to a PCN-flow.  It MUST set the not-PCN
   (00) codepoint on all other packets sharing a PCN-compatible Diffserv
   codepoint.

   The only valid codepoint transitions within a PCN-interior-node are
   from NM to PM (which should occur if either meter indicates a need to
   PCN-mark a packet [<a href="./rfc5670" title='"Metering and Marking Behaviour of PCN- Nodes"'>RFC5670</a>]) and from EXP to PM.  PCN-nodes that only
   implement the baseline encoding MUST be able to PCN-mark packets that
   arrive with the EXP codepoint.  This should ease the design of
   experimental schemes that want to allow partial deployment of
   experimental nodes alongside nodes that only implement the baseline
   encoding.  The following table gives the full set of valid and
   invalid codepoint transitions.

                    +-------------------------------------------------+
                    |                  Codepoint Out                  |
     +--------------+-------------+-----------+-----------+-----------+
     | Codepoint in | not-PCN(00) |   NM(10)  |  EXP(01)  |   PM(11)  |
     +--------------+-------------+-----------+-----------+-----------+
     |  not-PCN(00) |    Valid    | Not valid | Not valid | Not valid |
     +--------------+-------------+-----------+-----------+-----------+
     |       NM(10) |  Not valid  |   Valid   | Not valid |   Valid   |
     +--------------+-------------+-----------+-----------+-----------+
     |     EXP(01)* |  Not valid  | Not valid |   Valid   |   Valid   |
     +--------------+-------------+-----------+-----------+-----------+
     |       PM(11) |  Not valid  | Not valid | Not valid |   Valid   |
     +--------------+-------------+-----------+-----------+-----------+
        * This MAY cause an alarm to be raised at a management layer.
          See paragraph above for an explanation of this transition.

          Table 2: Valid and Invalid Codepoint Transitions for
                       PCN-Packets at PCN-Interior-Nodes

   The codepoint transition constraints given here apply only to the
   baseline encoding scheme.  Constraints on codepoint transitions for
   future experimental schemes are discussed in <a href="#section-5">Section 5</a>.

   A PCN-egress-node SHOULD set the not-PCN (00) codepoint on all
   packets it forwards out of the PCN-domain.  The only exception to
   this is if the PCN-egress-node is certain that revealing other
   codepoints outside the PCN-domain won't contravene the guidance given
   in [<a href="./rfc4774" title='"Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field"'>RFC4774</a>].  For instance, if the PCN-ingress-node has explicitly
   informed the PCN-egress-node that this flow is ECN-capable, then it
   might be safe to expose other codepoints.




<span class="grey">Moncaster, et al.           Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20Rationale%20for%20Encoding"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  Rationale for Encoding</span>

   The exact choice of encoding was dictated by the constraints imposed
   by existing IETF RFCs, in particular [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>], [<a href="./rfc4301" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>], and
   [<a href="./rfc4774" title='"Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field"'>RFC4774</a>].  One of the tightest constraints was the need for any PCN
   encoding to survive being tunnelled through either an IP-in-IP tunnel
   or an IPsec Tunnel.  [<a href="#ref-ECN-TUN" title='"Tunnelling of Explicit Congestion Notification"'>ECN-TUN</a>] explains this in more detail.  The
   main effect of this constraint is that any PCN-marking has to carry
   the 11 codepoint in the ECN field since this is the only codepoint
   that is guaranteed to be copied down into the forwarded header upon
   decapsulation.  An additional constraint is the need to minimise the
   use of Diffserv codepoints because there is a limited supply of
   Standards Track codepoints remaining.  <a href="#section-4.4">Section 4.4</a> explains how we
   have minimised this still further by reusing pre-existing Diffserv
   codepoint(s) such that non-PCN-traffic can still be distinguished
   from PCN-traffic.

   There are a number of factors that were considered before choosing to
   set 10 as the NM state instead of 01.  These included similarity to
   ECN, presence of tunnels within the domain, leakage into and out of
   the PCN-domain, and incremental deployment (see <a href="#appendix-A.2">Appendix A.2</a>).

   The encoding scheme above seems to meet all these constraints and
   ends up looking very similar to ECN.  This is perhaps not surprising
   given the similarity in architectural intent between PCN and ECN.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.4.%20%20PCN-Compatible%20Diffserv%20Codepoints"></a><a class="selflink" href="#section-4.4" id="section-4.4">4.4</a>.  PCN-Compatible Diffserv Codepoints</span>

   Equipment complying with the baseline PCN encoding MUST allow PCN to
   be enabled for certain Diffserv codepoints.  This document defines
   the term "PCN-compatible Diffserv codepoint" for such a DSCP.  To be
   clear, any packets with such a DSCP will be PCN-enabled only if they
   are within a PCN-domain and have their ECN field set to indicate a
   codepoint other than not-PCN.

   Enabling PCN-marking behaviour for a specific DSCP disables any other
   marking behaviour (e.g., enabling PCN replaces the default ECN
   marking behaviour introduced in [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>]) with the PCN-metering and
   -marking behaviours described in [<a href="./rfc5670" title='"Metering and Marking Behaviour of PCN- Nodes"'>RFC5670</a>]).  This ensures compliance
   with the Best Current Practice (BCP) guidance set out in [<a href="./rfc4774" title='"Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field"'>RFC4774</a>].

   The PCN working group has chosen not to define a single DSCP for use
   with PCN for several reasons.  Firstly, the PCN mechanism is
   applicable to a variety of different traffic classes.  Secondly,
   Standards Track DSCPs are in increasingly short supply.  Thirdly, PCN
   is not a scheduling behaviour -- rather, it should be seen as being





<span class="grey">Moncaster, et al.           Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   essentially a marking behaviour similar to ECN but intended for
   inelastic traffic.  More details are given in the informational
   <a href="#appendix-A.1">Appendix A.1</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.4.1.%20%20Co-Existence%20of%20PCN%20and%20Not-PCN%20Traffic"></a><a class="selflink" href="#section-4.4.1" id="section-4.4.1">4.4.1</a>.  Co-Existence of PCN and Not-PCN Traffic</span>

   The scarcity of pool 1 DSCPs, coupled with the fact that PCN is
   envisaged as a marking behaviour that could be applied to a number of
   different DSCPs, makes it essential that we provide a not-PCN state.
   As stated above (and expanded in <a href="#appendix-A.1">Appendix A.1</a>), the aim is for PCN to
   re-use existing DSCPs.  Because PCN redefines the meaning of the ECN
   field for such DSCPs, it is important to allow an operator to still
   use the DSCP for non-PCN-traffic.  This is achieved by providing a
   not-PCN state within the encoding scheme.  <a href="./rfc5559#section-3.5">SectionÂ 3.5 of [RFC5559]</a>
   discusses how competing-non-PCN-traffic should be handled.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Rules%20for%20Experimental%20Encoding%20Schemes"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Rules for Experimental Encoding Schemes</span>

   Any experimental encoding scheme MUST follow these rules to ensure
   backward compatibility with this baseline scheme:

   o  All PCN-interior-nodes within a PCN-domain MUST interpret the 00
      codepoint in the ECN field as not-PCN and MUST NOT change it to
      another value.  Therefore, a PCN-ingress-node wishing to disable
      PCN-marking for a packet with a PCN-compatible Diffserv codepoint
      MUST set the ECN field to 00.

   o  The 11 codepoint in the ECN field MUST indicate that the packet
      has been PCN-marked as the result of one or both of the meters
      indicating a need to PCN-mark a packet [<a href="./rfc5670" title='"Metering and Marking Behaviour of PCN- Nodes"'>RFC5670</a>].  The
      experimental scheme MUST define which meter(s) trigger this
      marking.

   o  The 01 Experimental codepoint in the ECN field MAY mean PCN-marked
      or it MAY carry some other meaning.  However, any experimental
      scheme MUST define its meaning in the context of that experiment.

   o  If both the 01 and 11 codepoints are being used to indicate PCN-
      marked, then the 11 codepoint MUST be taken to be the more severe
      marking and the choice of which meter sets which mark MUST be
      defined.

   o  Once set, the 11 codepoint in the ECN field MUST NOT be changed to
      any other codepoint.

   o  Any experimental scheme MUST include details of all valid and
      invalid codepoint transitions at any PCN-nodes.




<span class="grey">Moncaster, et al.           Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Backward%20Compatibility"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Backward Compatibility</span>

   <a href="https://www.rfc-editor.org/bcp/bcp124">BCP 124</a> [<a href="./rfc4774" title='"Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field"'>RFC4774</a>] gives guidelines for specifying alternative
   semantics for the ECN field.  It sets out a number of factors to be
   taken into consideration.  It also suggests various techniques to
   allow the co-existence of default ECN and alternative ECN semantics.
   The baseline encoding specified in this document defines PCN-
   compatible Diffserv codepoints as no longer supporting the default
   ECN semantics.  As such, this document is compatible with <a href="https://www.rfc-editor.org/bcp/bcp124">BCP 124</a>.

   On its own, this baseline encoding cannot support both ECN marking
   end-to-end (e2e) and PCN-marking within a PCN-domain.  It is possible
   to do this by carrying e2e ECN across a PCN-domain within the inner
   header of an IP-in-IP tunnel, or by using a richer encoding such as
   the proposed experimental scheme in [<a href="#ref-PCN-ENC" title='"A PCN encoding using 2 DSCPs to provide 3 or more states"'>PCN-ENC</a>].

   In any PCN deployment, traffic can only enter the PCN-domain through
   PCN-ingress-nodes and leave through PCN-egress-nodes.  PCN-ingress-
   nodes ensure that any packets entering the PCN-domain have the ECN
   field in their outermost IP header set to the appropriate PCN
   codepoint.  PCN-egress-nodes then guarantee that the ECN field of any
   packet leaving the PCN-domain has the correct ECN semantics.  This
   prevents unintended leakage of ECN marks into or out of the PCN-
   domain, and thus reduces backward-compatibility issues.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Security Considerations</span>

   PCN-marking only carries a meaning within the confines of a PCN-
   domain.  This encoding document is intended to stand independently of
   the architecture used to determine how specific packets are
   authorised to be PCN-marked, which will be described in separate
   documents on PCN-boundary-node behaviour.

   This document assumes the PCN-domain to be entirely under the control
   of a single operator, or a set of operators who trust each other.
   However, future extensions to PCN might include inter-domain versions
   where trust cannot be assumed between domains.  If such schemes are
   proposed, they must ensure that they can operate securely despite the
   lack of trust.  However, such considerations are beyond the scope of
   this document.

   One potential security concern is the injection of spurious PCN-marks
   into the PCN-domain.  However, these can only enter the domain if a
   PCN-ingress-node is misconfigured.  The precise impact of any such
   misconfiguration will depend on which of the proposed PCN-boundary-
   node behaviour schemes is used, but in general spurious marks will
   lead to admitting fewer flows into the domain or potentially
   terminating too many flows.  In either case, good management should



<span class="grey">Moncaster, et al.           Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   be able to quickly spot the problem since the overall utilisation of
   the domain will rapidly fall.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Conclusions"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Conclusions</span>

   This document defines the baseline PCN encoding, utilising a
   combination of a PCN-compatible DSCP and the ECN field in the IP
   header.  This baseline encoding allows the existence of two PCN
   encoding states: Not-marked and PCN-marked.  It also allows for the
   co-existence of competing traffic within the same DSCP, so long as
   that traffic does not require ECN support within the PCN-domain.  The
   encoding scheme is conformant with [<a href="./rfc4774" title='"Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field"'>RFC4774</a>].  The working group has
   chosen not to define a single DSCP for use with PCN.  The rationale
   for this decision along with advice relating to the choice of
   suitable DSCPs can be found in <a href="#appendix-A.1">Appendix A.1</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Acknowledgements"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Acknowledgements</span>

   This document builds extensively on work done in the PCN working
   group by Kwok Ho Chan, Georgios Karagiannis, Philip Eardley, Anna
   Charny, Joe Babiarz, and others.  Thanks to Ruediger Geib and Gorry
   Fairhurst for providing detailed comments on this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20References"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3168">RFC3168</a>]  Ramakrishnan, K., Floyd, S., and D. Black, "The Addition
              of Explicit Congestion Notification (ECN) to IP",
              <a href="./rfc3168">RFC 3168</a>, September 2001.

   [<a id="ref-RFC4774">RFC4774</a>]  Floyd, S., "Specifying Alternate Semantics for the
              Explicit Congestion Notification (ECN) Field", <a href="https://www.rfc-editor.org/bcp/bcp124">BCP 124</a>,
              <a href="./rfc4774">RFC 4774</a>, November 2006.

   [<a id="ref-RFC5670">RFC5670</a>]  Eardley, P., Ed., "Metering and Marking Behaviour of PCN-
              Nodes", <a href="./rfc5670">RFC 5670</a>, November 2009.











<span class="grey">Moncaster, et al.           Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-ECN-TUN">ECN-TUN</a>]  Briscoe, B., "Tunnelling of Explicit Congestion
              Notification", Work in Progress, July 2009.

   [<a id="ref-PCN-ENC">PCN-ENC</a>]  Moncaster, T., Briscoe, B., and M. Menth, "A PCN encoding
              using 2 DSCPs to provide 3 or more states", Work
              in Progress, April 2009.

   [<a id="ref-RFC2474">RFC2474</a>]  Nichols, K., Blake, S., Baker, F., and D. Black,
              "Definition of the Differentiated Services Field (DS
              Field) in the IPv4 and IPv6 Headers", <a href="./rfc2474">RFC 2474</a>,
              December 1998.

   [<a id="ref-RFC2597">RFC2597</a>]  Heinanen, J., Baker, F., Weiss, W., and J. Wroclawski,
              "Assured Forwarding PHB Group", <a href="./rfc2597">RFC 2597</a>, June 1999.

   [<a id="ref-RFC3246">RFC3246</a>]  Davie, B., Charny, A., Bennet, J., Benson, K., Le Boudec,
              J., Courtney, W., Davari, S., Firoiu, V., and D.
              Stiliadis, "An Expedited Forwarding PHB (Per-Hop
              Behavior)", <a href="./rfc3246">RFC 3246</a>, March 2002.

   [<a id="ref-RFC3540">RFC3540</a>]  Spring, N., Wetherall, D., and D. Ely, "Robust Explicit
              Congestion Notification (ECN) Signaling with Nonces",
              <a href="./rfc3540">RFC 3540</a>, June 2003.

   [<a id="ref-RFC4301">RFC4301</a>]  Kent, S. and K. Seo, "Security Architecture for the
              Internet Protocol", <a href="./rfc4301">RFC 4301</a>, December 2005.

   [<a id="ref-RFC4594">RFC4594</a>]  Babiarz, J., Chan, K., and F. Baker, "Configuration
              Guidelines for DiffServ Service Classes", <a href="./rfc4594">RFC 4594</a>,
              August 2006.

   [<a id="ref-RFC5127">RFC5127</a>]  Chan, K., Babiarz, J., and F. Baker, "Aggregation of
              DiffServ Service Classes", <a href="./rfc5127">RFC 5127</a>, February 2008.

   [<a id="ref-RFC5559">RFC5559</a>]  Eardley, P., "Pre-Congestion Notification (PCN)
              Architecture", <a href="./rfc5559">RFC 5559</a>, June 2009.













<span class="grey">Moncaster, et al.           Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20PCN%20Deployment%20Considerations%20%28Informative%29"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  PCN Deployment Considerations (Informative)</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.1.%20%20Choice%20of%20Suitable%20DSCPs"></a><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  Choice of Suitable DSCPs</span>

   The PCN working group chose not to define a single DSCP for use with
   PCN for several reasons.  Firstly, the PCN mechanism is applicable to
   a variety of different traffic classes.  Secondly, Standards Track
   DSCPs are in increasingly short supply.  Thirdly, PCN is not a
   scheduling behaviour -- rather, it should be seen as being a marking
   behaviour similar to ECN but intended for inelastic traffic.  The
   choice of which DSCP is most suitable for a given PCN-domain is
   dependent on the nature of the traffic entering that domain and the
   link rates of all the links making up that domain.  In PCN-domains
   with sufficient aggregation, the appropriate DSCPs would currently be
   those for the Real-Time Treatment Aggregate [<a href="./rfc5127" title='"Aggregation of DiffServ Service Classes"'>RFC5127</a>].  The PCN
   working group suggests using admission control for the following
   service classes (defined in [<a href="./rfc4594" title='"Configuration Guidelines for DiffServ Service Classes"'>RFC4594</a>]):

   o  Telephony (EF)

   o  Real-time interactive (CS4)

   o  Broadcast Video (CS3)

   o  Multimedia Conferencing (AF4)

   CS5 is excluded from this list since PCN is not expected to be
   applied to signalling traffic.

   PCN-marking is intended to provide a scalable admission-control
   mechanism for traffic with a high degree of statistical multiplexing.
   PCN-marking would therefore be appropriate to apply to traffic in the
   above classes, but only within a PCN-domain containing sufficiently
   aggregated traffic.  In such cases, the above service classes may
   well all be subject to a single forwarding treatment (treatment
   aggregate [<a href="./rfc5127" title='"Aggregation of DiffServ Service Classes"'>RFC5127</a>]).  However, this does not imply all such IP
   traffic would necessarily be identified by one DSCP -- each service
   class might keep a distinct DSCP within the highly aggregated region
   [<a href="./rfc5127" title='"Aggregation of DiffServ Service Classes"'>RFC5127</a>].

   Additional service classes may be defined for which admission control
   is appropriate, whether through some future standards action or
   through local use by certain operators, e.g., the Multimedia
   Streaming service class (AF3).  This document does not preclude the
   use of PCN in more cases than those listed above.

   Note: The above discussion is informative not normative, as operators
   are ultimately free to decide whether to use admission control for



<span class="grey">Moncaster, et al.           Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   certain service classes and whether to use PCN as their mechanism of
   choice.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.%20%20Rationale%20for%20Using%20ECT%280%29%20for%20Not-Marked"></a><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  Rationale for Using ECT(0) for Not-Marked</span>

   The choice of which ECT codepoint to use for the Not-marked state was
   based on the following considerations:

   o  [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>] full-functionality tunnel within the PCN-domain: Either
      ECT is safe.

   o  Leakage of traffic into PCN-domain: Because of the lack of take-up
      of the ECN nonce [<a href="./rfc3540" title='"Robust Explicit Congestion Notification (ECN) Signaling with Nonces"'>RFC3540</a>], leakage of ECT(1) is less likely to
      occur and so might be considered safer.





































<span class="grey">Moncaster, et al.           Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   o  Leakage of traffic out of PCN-domain: Either ECT is equally unsafe
      (since this would incorrectly indicate the traffic was ECN-capable
      outside the controlled PCN-domain).

   o  Incremental deployment: Either codepoint is suitable, providing
      that the codepoints are used consistently.

   o  Conceptual consistency with other schemes: ECT(0) is conceptually
      consistent with [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>].

   Overall, this seemed to suggest that ECT(0) was most appropriate to
   use.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20%20Co-Existence%20of%20PCN%20and%20ECN%20%28Informative%29"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  Co-Existence of PCN and ECN (Informative)</span>

   This baseline encoding scheme redefines the ECN codepoints within the
   PCN-domain.  As packets with a PCN-compatible DSCP leave the PCN-
   domain, their ECN field is reset to not-ECT (00).  This is a problem
   for the operator if packets with a PCN-compatible DSCP arrive at the
   PCN-domain with any ECN codepoint other than not-ECN.  If the ECN-
   codepoint is ECT(0) (10) or ECT(1) (01), resetting the ECN field to
   00 effectively turns off end-to-end ECN.  This is undesirable as it
   removes the benefits of ECN, but [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>] states that it is no worse
   than dropping the packet.  However, if a packet was marked with CE
   (11), resetting the ECN field to 00 at the PCN egress node violates
   the rule that CE-marks must never be lost except as a result of
   packet drop [<a href="./rfc3168" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>].

   A number of options exist to overcome this issue.  The most
   appropriate option will depend on the circumstances and has to be a
   decision for the operator.  The definition of the action is beyond
   the scope of this document, but we briefly explain the four broad
   categories of solution below: tunnelling the packets, using an
   extended encoding scheme, signalling to the end systems to stop using
   ECN, or re-marking packets to a different DSCP.

   o  Tunnelling the packets across the PCN-domain (for instance, in an
      IP-in-IP tunnel from the PCN-ingress-node to the PCN-egress-node)
      preserves the original ECN marking on the inner header.

   o  An extended encoding scheme can be designed that preserves the
      original ECN codepoints.  For instance, if the PCN-egress-node can
      determine from the PCN codepoint what the original ECN codepoint
      was, then it can reset the packet to that codepoint.  [<a href="#ref-PCN-ENC" title='"A PCN encoding using 2 DSCPs to provide 3 or more states"'>PCN-ENC</a>]
      partially achieves this but is unable to recover ECN markings if
      the packet is PCN-marked in the PCN-domain.





<span class="grey">Moncaster, et al.           Standards Track                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5696">RFC 5696</a>                 Baseline PCN Encoding             November 2009</span>


   o  Explicit signalling to the end systems can indicate to the source
      that ECN cannot be used on this path (because it does not support
      ECN and PCN at the same time).  Dropping the packet can be thought
      of as a form of silent signal to the source, as it will see any
      ECT-marked packets it sends being dropped.

   o  Packets that are not part of a PCN-flow but which share a PCN-
      compatible DSCP can be re-marked to a different local-use DSCP at
      the PCN-ingress-node with the original DSCP restored at the PCN-
      egress.  This preserves the ECN codepoint on these packets but
      relies on there being spare local-use DSCPs within the PCN-domain.

Authors' Addresses

   Toby Moncaster
   BT
   B54/70, Adastral Park
   Martlesham Heath
   Ipswich  IP5 3RE
   UK

   Phone: +44 7918 901170
   EMail: toby.moncaster@bt.com


   Bob Briscoe
   BT
   B54/77, Adastral Park
   Martlesham Heath
   Ipswich  IP5 3RE
   UK

   Phone: +44 1473 645196
   EMail: bob.briscoe@bt.com


   Michael Menth
   University of Wuerzburg
   Institute of Computer Science
   Am Hubland
   Wuerzburg  D-97074
   Germany

   Phone: +49 931 318 6644
   EMail: menth@informatik.uni-wuerzburg.de






Moncaster, et al.           Standards Track                    [Page 15]
</pre>
</body></html>