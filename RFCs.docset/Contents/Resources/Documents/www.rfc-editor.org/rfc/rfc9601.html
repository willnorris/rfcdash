<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9601: Propagating Explicit Congestion Notification across IP Tunnel Headers Separated by a Shim</title>
<meta content="Bob Briscoe" name="author"/>
<meta content='
       RFC 6040 on "Tunnelling of Explicit Congestion Notification" made the
      rules for propagation of Explicit Congestion Notification (ECN) consistent for all forms of IP-in-IP
      tunnel. This specification updates RFC 6040 to clarify that its scope
      includes tunnels where two IP headers are separated by at least one shim
      header that is not sufficient on its own for wide-area packet
      forwarding. It surveys widely deployed IP tunnelling protocols that use
      such shim headers and updates the specifications of those that do not
      mention ECN propagation (including RFCs 2661, 3931, 2784, 4380
      and 7450, which specify L2TPv2, L2TPv3, Generic Routing Encapsulation (GRE), Teredo, and
      Automatic Multicast Tunneling (AMT), respectively). This specification also updates RFC 6040 with configuration
      requirements needed to make any legacy tunnel ingress safe. 
    ' name="description"/>
<meta content="xml2rfc 3.23.0" name="generator"/>
<meta content="Congestion Control and Management" name="keyword"/>
<meta content="Congestion Notification" name="keyword"/>
<meta content="Information Security" name="keyword"/>
<meta content="Tunnelling" name="keyword"/>
<meta content="Encapsulation &amp; Decapsulation" name="keyword"/>
<meta content="Protocol" name="keyword"/>
<meta content="ECN" name="keyword"/>
<meta content="Layering" name="keyword"/>
<meta content="9601" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.23.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    pydyf 0.10.0
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 62.3
-->
<link href="rfc9601.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-tsvwg-rfc6040update-shim-23" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9601" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9601</td>
<td class="center">ECN over IP-shim-(L2)-IP Tunnels</td>
<td class="right">August 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Briscoe</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9601">9601</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc2661">2661</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc2784">2784</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc3931">3931</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc4380">4380</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc6040">6040</a>, <a class="eref" href="https://www.rfc-editor.org/rfc/rfc7450">7450</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-08">August 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Briscoe</div>
<div class="org">Independent</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9601</h1>
<h1 id="title">Propagating Explicit Congestion Notification across IP Tunnel Headers Separated by a Shim</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">RFC 6040 on "Tunnelling of Explicit Congestion Notification" made the
      rules for propagation of Explicit Congestion Notification (ECN) consistent for all forms of IP-in-IP
      tunnel. This specification updates RFC 6040 to clarify that its scope
      includes tunnels where two IP headers are separated by at least one shim
      header that is not sufficient on its own for wide-area packet
      forwarding. It surveys widely deployed IP tunnelling protocols that use
      such shim headers and updates the specifications of those that do not
      mention ECN propagation (including RFCs 2661, 3931, 2784, 4380
      and 7450, which specify L2TPv2, L2TPv3, Generic Routing Encapsulation (GRE), Teredo, and
      Automatic Multicast Tunneling (AMT), respectively). This specification also updates RFC 6040 with configuration
      requirements needed to make any legacy tunnel ingress safe.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9601">https://www.rfc-editor.org/info/rfc9601</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
<p id="section-boilerplate.2-3">
            This document may contain material from IETF Documents or IETF
            Contributions published or made publicly available before November
            10, 2008. The person(s) controlling the copyright in some of this
            material may not have granted the IETF Trust the right to allow
            modifications of such material outside the IETF Standards Process.
            Without obtaining an adequate license from the person(s)
            controlling the copyright in such materials, this document may not
            be modified outside the IETF Standards Process, and derivative
            works of it may not be created outside the IETF Standards Process,
            except to format it for publication as an RFC or to translate it
            into languages other than English.<a class="pilcrow" href="#section-boilerplate.2-3">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-terminology">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-scope-of-rfc-6040">Scope of RFC 6040</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p class="keepWithNext" id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-feasibility-of-ecn-propagat">Feasibility of ECN Propagation between Tunnel Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-desirability-of-ecn-propaga">Desirability of ECN Propagation between Tunnel Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-making-a-non-ecn-tunnel-ing">Making a Non-ECN Tunnel Ingress Safe by Configuration</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-ecn-propagation-and-fragmen">ECN Propagation and Fragmentation/Reassembly</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-ip-in-ip-tunnels-with-tight">IP-in-IP Tunnels with Tightly Coupled Shim Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-specific-updates-to-protoco">Specific Updates to Protocols under IETF Change Control</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a class="auto internal xref" href="#section-6.1.1">6.1.1</a>.  <a class="internal xref" href="#name-l2tp-v2-and-v3-ecn-extensio">L2TP (v2 and v3) ECN Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a class="auto internal xref" href="#section-6.1.2">6.1.2</a>.  <a class="internal xref" href="#name-gre">GRE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.3">
                    <p id="section-toc.1-1.6.2.1.2.3.1"><a class="auto internal xref" href="#section-6.1.3">6.1.3</a>.  <a class="internal xref" href="#name-teredo">Teredo</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.4">
                    <p id="section-toc.1-1.6.2.1.2.4.1"><a class="auto internal xref" href="#section-6.1.4">6.1.4</a>.  <a class="internal xref" href="#name-amt">AMT</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-address">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="rfc6040up_Introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1"><span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> on "Tunnelling of Explicit Congestion Notification" made the rules for propagation of Explicit Congestion
      Notification (ECN) <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> consistent for all forms of
      IP-in-IP tunnel.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">A common pattern for many tunnelling protocols is to encapsulate an
      inner IP header (v4 or v6) with one or more shim headers then an outer IP header
      (v4 or v6). Some of these shim headers are designed as generic
      encapsulations, so they do not necessarily directly encapsulate an inner
      IP header. Instead, they can encapsulate headers such as link-layer (L2) protocols that, in
turn, often encapsulate IP. Thus, the abbreviation 'IP-shim-(L2)-IP' can be used
      for tunnels that are in scope of this document.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">To clear up confusion, this specification clarifies that the scope of
      <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> includes any IP-in-IP tunnel, including those with one or more shim
      headers and other encapsulations between the IP headers. Where
      necessary, it updates the specifications of the relevant encapsulation
      protocols with the specific text necessary to comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">This specification also updates <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> to state how operators ought
      to configure a legacy tunnel ingress to avoid unsafe system
      configurations.<a class="pilcrow" href="#section-1-4">¶</a></p>
</section>
</div>
<div id="rfc6040up_Reqs_Language">
<section id="section-2">
      <h2 id="name-terminology">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
      "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>", "<span class="bcp14">MAY</span>", and
      "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as described in
      BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and
      only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">This specification uses the terminology defined in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-2-2">¶</a></p>
</section>
</div>
<div id="rfc6040up_scope">
<section id="section-3">
      <h2 id="name-scope-of-rfc-6040">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-scope-of-rfc-6040">Scope of RFC 6040</a>
      </h2>
<p id="section-3-1">In <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-1.1">Section 1.1</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, its scope is defined as:<a class="pilcrow" href="#section-3-1">¶</a></p>
<blockquote id="section-3-2">
          ...ECN field processing at encapsulation and decapsulation for
          any IP-in-IP tunnelling, whether IPsec or non-IPsec tunnels. It
          applies irrespective of whether IPv4 or IPv6 is used for either the
          inner or outer headers.<a class="pilcrow" href="#section-3-2">¶</a>
</blockquote>
<p id="section-3-3">There are two problems with the above scoping statement:<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">Problem 1: It was intended to include cases where one or more shim headers sit between
      the IP headers. Many tunnelling implementers have interpreted the scope
      of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as it was intended, but it is ambiguous. Therefore, this
      specification updates <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> by adding the following scoping text
      after the sentences quoted above:<a class="pilcrow" href="#section-3-4">¶</a></p>
<blockquote id="section-3-5">
          It applies in cases where an outer IP header encapsulates an
          inner IP header either directly or indirectly by encapsulating other
          headers that in turn encapsulate (or might encapsulate) an inner IP
          header.<a class="pilcrow" href="#section-3-5">¶</a>
</blockquote>
<p id="section-3-6">Problem 2: Like many IETF
      specifications, <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> is written as a specification that
      implementations can choose to claim compliance with. This means it does
      not cover two important situations:<a class="pilcrow" href="#section-3-6">¶</a></p>
<ol class="normal type-1" id="section-3-7" start="1" type="1">
<li id="section-3-7.1">
          <p id="section-3-7.1.1">Cases where it is infeasible for an implementation to
          access an inner IP header when adding or removing an outer IP
          header<a class="pilcrow" href="#section-3-7.1.1">¶</a></p>
</li>
        <li id="section-3-7.2">
          <p id="section-3-7.2.1">Cases where implementations choose not to propagate ECN between IP
          headers<a class="pilcrow" href="#section-3-7.2.1">¶</a></p>
</li>
      </ol>
<p id="section-3-8">However, the ECN field is a non-optional part of the IP header (v4
      and v6), so any implementation that creates an outer IP header has to
      give the ECN field some value. There is only one safe value a tunnel
      ingress can use if it does not know whether the egress supports
      propagation of the ECN field; it has to clear the ECN field in any outer
      IP header to 0b00.<a class="pilcrow" href="#section-3-8">¶</a></p>
<p id="section-3-9">However, an RFC has no jurisdiction over implementations that choose
      not to comply or cannot comply with the RFC, including all
      implementations that predated it. Therefore, it would have been
      unreasonable to add such a requirement to <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>. Nonetheless, to
      ensure safe propagation of the ECN field over tunnels, it is reasonable
      to add requirements on operators to ensure they configure their tunnels
      safely (where possible). Before resolving 'Problem 2' by stating these configuration requirements
      (in <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a>), the factors that determine
      whether propagating ECN is feasible or desirable will be briefly
      introduced.<a class="pilcrow" href="#section-3-9">¶</a></p>
<div id="rfc6040up_feasibility">
<section id="section-3.1">
        <h3 id="name-feasibility-of-ecn-propagat">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-feasibility-of-ecn-propagat">Feasibility of ECN Propagation between Tunnel Headers</a>
        </h3>
<p id="section-3.1-1">In many cases, one or more shim headers and an outer IP header are
        always added to (or removed from) an inner IP packet as part of the
        same procedure. We call these tightly coupled shim headers.
        Processing a shim and outer header together is often necessary because
        a shim is not sufficient for packet forwarding in its own right; not
        unless complemented by an outer header. In these cases, it will often
        be feasible for an implementation to propagate the ECN field between
        the IP headers.<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<p id="section-3.1-2">In some cases, a tunnel adds an outer IP header and a tightly
        coupled shim header to an inner header that is not an IP header, but
        that, in turn, encapsulates an IP header (or might encapsulate an IP
        header). For instance, an inner Ethernet (or other link-layer) header
        might encapsulate an inner IP header as its payload. We call this a
        tightly coupled shim over an encapsulating header.<a class="pilcrow" href="#section-3.1-2">¶</a></p>
<p id="section-3.1-3">Digging to arbitrary depths to find an inner IP header within an
        encapsulation is strictly a layering violation, so it cannot be a
        required behaviour. 

Nonetheless, some tunnel endpoints already look
        within a Layer 2 (L2) header for an IP header, for instance, to map the Diffserv
        codepoint between an encapsulated IP header and an outer IP header
        <span>[<a class="cite xref" href="#RFC2983">RFC2983</a>]</span>. In such cases at least, it should be
        feasible to also (independently) propagate the ECN field between the
        same IP headers. Thus, access to the ECN field within an encapsulating
        header can be a useful and benign optimization. The guidelines in
        <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9599#section-5">Section 5</a> of [<a class="cite xref" href="#RFC9599">RFC9599</a>]</span> give
        the conditions for this layering violation to be benign.<a class="pilcrow" href="#section-3.1-3">¶</a></p>
</section>
</div>
<div id="rfc6040up_desirability">
<section id="section-3.2">
        <h3 id="name-desirability-of-ecn-propaga">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-desirability-of-ecn-propaga">Desirability of ECN Propagation between Tunnel Headers</a>
        </h3>
<p id="section-3.2-1">Developers and network operators are encouraged to implement and
        deploy tunnel endpoints compliant with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> (as updated by the
        present specification) in order to provide the benefits of wider ECN
        deployment <span>[<a class="cite xref" href="#RFC8087">RFC8087</a>]</span>. Nonetheless, propagation of ECN
        between IP headers, whether separated by shim headers or not, has to
        be optional to implement and to use, because:<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">legacy implementations of tunnels without any ECN support
            already exist;<a class="pilcrow" href="#section-3.2-2.1.1">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">a network might be designed so that there is usually no
            bottleneck within the tunnel; and<a class="pilcrow" href="#section-3.2-2.2.1">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.3">
            <p id="section-3.2-2.3.1">if the tunnel endpoints would have to search within an L2
            header to find an encapsulated IP header, it might not be worth
            the potential performance hit.<a class="pilcrow" href="#section-3.2-2.3.1">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="rfc6040up_sec_safe">
<section id="section-4">
      <h2 id="name-making-a-non-ecn-tunnel-ing">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-making-a-non-ecn-tunnel-ing">Making a Non-ECN Tunnel Ingress Safe by Configuration</a>
      </h2>
<p id="section-4-1">Even when no specific attempt has been made to implement propagation
      of the ECN field at a tunnel ingress, it ought to be possible for the
      operator to render a tunnel ingress safe by configuration. The main
      safety concern is to disable (clear to zero) the ECN capability in the
      outer IP header at the ingress if the egress of the tunnel does not
      implement ECN logic to propagate any ECN markings into the packet
      forwarded beyond the tunnel. Otherwise, the non-ECN egress could discard
      any ECN marking introduced within the tunnel, which would break all the
      ECN-based control loops that regulate the traffic load over the
      tunnel.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">Therefore, this specification updates <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-4.3">Section 4.3</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> by inserting the
      following text at the end of the section:<a class="pilcrow" href="#section-4-2">¶</a></p>
<blockquote id="section-4-3">
        <p id="section-4-3.1">Whether or not an ingress implementation
          claims compliance with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, <span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>, or <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>, when the outer
          tunnel header is IP (v4 or v6), if possible, the ingress <span class="bcp14">MUST</span> be
          configured to zero the outer ECN field in all of the following
          cases:<a class="pilcrow" href="#section-4-3.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.2.1">
            <p id="section-4-3.2.1.1">if it is known that the tunnel egress does not support any of
              the RFCs that define propagation of the ECN field (<span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, <span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>, or the full functionality mode of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>);<a class="pilcrow" href="#section-4-3.2.1.1">¶</a></p>
</li>
          <li class="normal" id="section-4-3.2.2">
            <p id="section-4-3.2.2.1">if the behaviour of the egress is not known or an egress
              with unknown behaviour might be dynamically paired with the
              ingress (one way for an operator of a tunnel ingress to
              determine the behaviour of an otherwise unknown egress is
              described in <span>[<a class="cite xref" href="#decap-test">decap-test</a>]</span>);<a class="pilcrow" href="#section-4-3.2.2.1">¶</a></p>
</li>
          <li class="normal" id="section-4-3.2.3">
            <p id="section-4-3.2.3.1">if an IP header might be encapsulated within a non-IP
              header that the tunnel ingress is encapsulating, but the ingress
              does not inspect within the encapsulation.<a class="pilcrow" href="#section-4-3.2.3.1">¶</a></p>
</li>
        </ul>
<p id="section-4-3.3">For the avoidance of doubt, the above only concerns the
          outer IP header. The ingress <span class="bcp14">MUST NOT</span> alter the ECN field of the
          arriving IP header that will become the inner IP header.<a class="pilcrow" href="#section-4-3.3">¶</a></p>
<p id="section-4-3.4">In order that the network operator can comply with the above
          safety rules, an implementation of a tunnel ingress:<a class="pilcrow" href="#section-4-3.4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.5.1">
            <p id="section-4-3.5.1.1"><span class="bcp14">MUST NOT</span> treat the former Type of Service (ToS) octet (IPv4) or the former
              Traffic Class octet (IPv6) as a single 8-bit field. This is because the
              resulting linkage of ECN and Diffserv field propagation between
              inner and outer headers is not consistent with the definition of the
              6-bit Diffserv field in <span>[<a class="cite xref" href="#RFC2474">RFC2474</a>]</span> and <span>[<a class="cite xref" href="#RFC3260">RFC3260</a>]</span>.<a class="pilcrow" href="#section-4-3.5.1.1">¶</a></p>
</li>
          <li class="normal" id="section-4-3.5.2">
            <p id="section-4-3.5.2.1"><span class="bcp14">SHOULD</span> be able to be configured to zero the ECN field of
              the outer header.<a class="pilcrow" href="#section-4-3.5.2.1">¶</a></p>
</li>
        </ul>
<p id="section-4-3.6">These last two rules apply even if an implementation of a tunnel ingress does not
          claim to support <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, <span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>, or the full functionality mode
          of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span><a class="pilcrow" href="#section-4-3.6">¶</a></p>
</blockquote>
<p id="section-4-4">For instance, if a tunnel ingress with no ECN-specific logic had a
      configuration capability to refer to the last 2 bits of the old ToS Byte
      of the outer (e.g., with a 0x3 mask) and set them to zero, while
      also being able to allow the DSCP to be re-mapped independently, that
      would be sufficient to satisfy both implementation
      requirements above.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">There might be concern that the above "<span class="bcp14">MUST NOT</span>" makes compliant
      implementations non-compliant at a stroke. However, by definition, it
      solely applies to equipment that provides Diffserv configuration. Any
      such Diffserv equipment that is configuring treatment of the former ToS
      octet (IPv4) or the former Traffic Class octet (IPv6) as a single 8-bit
      field must have always been non-compliant with the definition of the
      6-bit Diffserv field in <span>[<a class="cite xref" href="#RFC2474">RFC2474</a>]</span> and <span>[<a class="cite xref" href="#RFC3260">RFC3260</a>]</span>. If a tunnel ingress does not have any ECN logic,
      copying the ECN field as a side effect of copying the DSCP is a
      seriously unsafe bug that risks breaking the feedback loops that
      regulate load on a tunnel, because it omits to check the ECN capability of the tunnel egress.<a class="pilcrow" href="#section-4-5">¶</a></p>
<p id="section-4-6">Zeroing the outer ECN field of all packets in all circumstances would
      be safe, but it would not be sufficient to claim compliance with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> because it would not meet the aim of introducing ECN support to
      tunnels (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-4.3">Section 4.3</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>).<a class="pilcrow" href="#section-4-6">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-ecn-propagation-and-fragmen">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-ecn-propagation-and-fragmen">ECN Propagation and Fragmentation/Reassembly</a>
      </h2>
<p id="section-5-1">The following requirements update <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, which omitted handling of
      the ECN field during fragmentation or reassembly. These changes might
      alter how many ECN-marked packets are propagated by a tunnel that
      fragments packets, but this would not raise any backward compatibility
      issues.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">If a tunnel ingress fragments a packet, it <span class="bcp14">MUST</span> set the outer ECN
      field of all the fragments to the same value as it would have set if it
      had not fragmented the packet.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc3168#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> specifies ECN requirements
      for reassembly of sets of 'outer fragments' into packets (in 'outer
      fragmentation', the fragmentation is visible in the outer header so that
      the tunnel egress can reassemble the fragments <span>[<a class="cite xref" href="#I-D.ietf-intarea-tunnels">INTAREA-TUNNELS</a>]</span>). Additionally, the following 
      requirements apply at a tunnel egress:<a class="pilcrow" href="#section-5-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">
          During reassembly of outer fragments, the packet <span class="bcp14">MUST</span> be discarded if the ECN fields of the
          outer headers being reassembled into a single packet consist of a
          mixture of Not ECN-Capable Transport (Not-ECT) and other ECN codepoints.<a class="pilcrow" href="#section-5-4.1">¶</a>
</li>
        <li class="normal" id="section-5-4.2">
          If there is mix of ECT(0) and ECT(1) outer fragments, then the
          reassembled packet <span class="bcp14">MUST</span> be set to ECT(1).<a class="pilcrow" href="#section-5-4.2">¶</a>
</li>
      </ul>
<p id="section-5-5" style="margin-left: 1.5em">Reasoning: <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>
          originally defined ECT(0) and ECT(1) as equivalent, but <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> has been
          updated by <span>[<a class="cite xref" href="#RFC8311">RFC8311</a>]</span> to make ECT(1) available for
          congestion marking differences. The rule is independent of the
          current experimental use of ECT(1) for Low Latency, Low Loss, and Scalable throughput (L4S) <span>[<a class="cite xref" href="#RFC9331">RFC9331</a>]</span>.
          The rule is compatible with Pre-Congestion Notification (PCN) <span>[<a class="cite xref" href="#RFC6660">RFC6660</a>]</span>, which uses
          2 levels of congestion severity, with the ranking of severity from
          highest to lowest being Congestion Experienced (CE), ECT(1), ECT(0). The decapsulation rules
          in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> take a similar approach.<a class="pilcrow" href="#section-5-5">¶</a></p>
</section>
<div id="rfc6040up_IP-IP_Coupled_Shim_Tunnels">
<section id="section-6">
      <h2 id="name-ip-in-ip-tunnels-with-tight">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-ip-in-ip-tunnels-with-tight">IP-in-IP Tunnels with Tightly Coupled Shim Headers</a>
      </h2>
<p id="section-6-1">Below is a list of specifications of encapsulations with tightly coupled
shim header(s) in rough chronological order. This list is confined to
Standards Track or widely deployed protocols. So, for the avoidance of doubt,
the updated scope of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> is defined in <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a> and is not limited to this list.<a class="pilcrow" href="#section-6-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">Point-to-Point Tunneling Protocol (PPTP) <span>[<a class="cite xref" href="#RFC2637">RFC2637</a>]</span><a class="pilcrow" href="#section-6-2.1.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">Layer Two Tunneling Protocol (L2TP), specifically L2TPv2 <span>[<a class="cite xref" href="#RFC2661">RFC2661</a>]</span> and L2TPv3 <span>[<a class="cite xref" href="#RFC3931">RFC3931</a>]</span>, which not
          only includes all the L2-specific specializations of L2TP, but also
          derivatives such as the Keyed IPv6 Tunnel <span>[<a class="cite xref" href="#RFC8159">RFC8159</a>]</span><a class="pilcrow" href="#section-6-2.2.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">Generic Routing Encapsulation (GRE) <span>[<a class="cite xref" href="#RFC2784">RFC2784</a>]</span> and Network Virtualization using GRE (NVGRE) <span>[<a class="cite xref" href="#RFC7637">RFC7637</a>]</span><a class="pilcrow" href="#section-6-2.3.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.4">
          <p id="section-6-2.4.1">GPRS Tunnelling Protocol (GTP), specifically GTPv1 <span>[<a class="cite xref" href="#GTPv1">GTPv1</a>]</span>, GTP v1 User Plane <span>[<a class="cite xref" href="#GTPv1-U">GTPv1-U</a>]</span>, and GTP v2
          Control Plane <span>[<a class="cite xref" href="#GTPv2-C">GTPv2-C</a>]</span><a class="pilcrow" href="#section-6-2.4.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.5">
          <p id="section-6-2.5.1">Teredo <span>[<a class="cite xref" href="#RFC4380">RFC4380</a>]</span><a class="pilcrow" href="#section-6-2.5.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.6">
          <p id="section-6-2.6.1">Control And Provisioning of Wireless Access Points (CAPWAP) <span>[<a class="cite xref" href="#RFC5415">RFC5415</a>]</span><a class="pilcrow" href="#section-6-2.6.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.7">
          <p id="section-6-2.7.1">Locator/Identifier Separation Protocol (LISP) <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span><a class="pilcrow" href="#section-6-2.7.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.8">
          <p id="section-6-2.8.1">Automatic Multicast Tunneling (AMT) <span>[<a class="cite xref" href="#RFC7450">RFC7450</a>]</span><a class="pilcrow" href="#section-6-2.8.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.9">
          <p id="section-6-2.9.1">Virtual eXtensible Local Area Network (VXLAN) <span>[<a class="cite xref" href="#RFC7348">RFC7348</a>]</span> and Generic Protocol Extensions for VXLAN (VXLAN-GPE) <span>[<a class="cite xref" href="#I-D.ietf-nvo3-vxlan-gpe">NVO3-VXLAN-GPE</a>]</span><a class="pilcrow" href="#section-6-2.9.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.10">
          <p id="section-6-2.10.1">The Network Service Header (NSH) <span>[<a class="cite xref" href="#RFC8300">RFC8300</a>]</span> for
          Service Function Chaining (SFC)<a class="pilcrow" href="#section-6-2.10.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.11">
          <p id="section-6-2.11.1">Geneve <span>[<a class="cite xref" href="#RFC8926">RFC8926</a>]</span><a class="pilcrow" href="#section-6-2.11.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.12">
          <p id="section-6-2.12.1">Direct tunnelling of an IP packet within a UDP/IP datagram (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8085#section-3.1.11">Section 3.1.11</a> of [<a class="cite xref" href="#RFC8085">RFC8085</a>]</span>)<a class="pilcrow" href="#section-6-2.12.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.13">
          <p id="section-6-2.13.1">TCP Encapsulation of Internet Key Exchange Protocol (IKE) and IPsec Packets (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9329#section-9.5">Section 9.5</a> of [<a class="cite xref" href="#RFC9329">RFC9329</a>]</span>)<a class="pilcrow" href="#section-6-2.13.1">¶</a></p>
</li>
      </ul>
<p id="section-6-3">Some of the listed protocols enable encapsulation of a variety of
      network layer protocols as inner and/or outer. This specification
      applies to the cases where there is an inner and outer IP header as
      described in <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a>. Otherwise, <span>[<a class="cite xref" href="#RFC9599">RFC9599</a>]</span> gives guidance on how to
      design propagation of ECN into other protocols that might encapsulate
      IP.<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">Where protocols in the above list need to be updated to specify ECN
      propagation and are under IETF change control, update text is given
      in the following subsections. For those not under IETF control, it is
      <span class="bcp14">RECOMMENDED</span> that implementations of encapsulation and decapsulation
      comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>. It is also <span class="bcp14">RECOMMENDED</span> that their specifications
      are updated to add a requirement to comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> (as updated by
      the present document).<a class="pilcrow" href="#section-6-4">¶</a></p>
<p id="section-6-5">PPTP is not under the change control of the IETF, but it has been
      documented in an Informational RFC <span>[<a class="cite xref" href="#RFC2637">RFC2637</a>]</span>. However,
      there is no need for the present specification to update PPTP because
      L2TP has been developed as a standardized replacement.<a class="pilcrow" href="#section-6-5">¶</a></p>
<p id="section-6-6">NVGRE is not under the change control of the IETF, but it has been
      documented in an Informational RFC <span>[<a class="cite xref" href="#RFC7637">RFC7637</a>]</span>. NVGRE is a
      specific use case of GRE (it re-purposes the key field from the initial
      specification of GRE <span>[<a class="cite xref" href="#RFC1701">RFC1701</a>]</span> as a Virtual Subnet ID).
      Therefore, the text that updates GRE in <a class="auto internal xref" href="#rfc6040up_GRE">Section 6.1.2</a>
      below is also intended to update NVGRE.<a class="pilcrow" href="#section-6-6">¶</a></p>
<p id="section-6-7">Although the definition of the various GTP shim headers is under the
      control of the Third Generation Partnership Project (3GPP), it is hard to
      determine whether the 3GPP or the IETF controls standardization of the
      <em>process</em> of adding both a GTP and an IP
      header to an inner IP header. Nonetheless, the present specification is
      provided so that the 3GPP can refer to it from any of its own
      specifications of GTP and IP header processing.<a class="pilcrow" href="#section-6-7">¶</a></p>
<p id="section-6-8">The specification of CAPWAP already specifies <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> ECN
      propagation and ECN capability negotiation. Without modification, the
      CAPWAP specification already interworks with the backward-compatible
      updates to <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6-8">¶</a></p>
<p id="section-6-9">LISP made the ECN propagation procedures in <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> mandatory from
      the start. <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span> has since been updated by <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, but the changes
      are backwards compatible, so there is still no need for LISP tunnel
      endpoints to negotiate their ECN capabilities.<a class="pilcrow" href="#section-6-9">¶</a></p>
<p id="section-6-10">VXLAN is not under the change control of the IETF, but it has been
      documented in an Informational RFC. It is
      <span class="bcp14">RECOMMENDED</span> that VXLAN implementations comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>
      when the VXLAN header is inserted between (or removed from between)
      IP headers. The authors of any future update of the VXLAN spec are also 
      encouraged to add a requirement to comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as updated by
      the present specification. In contrast,
      VXLAN-GPE is being documented under IETF change control and it does
      require compliance with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6-10">¶</a></p>
<p id="section-6-11">The Network Service Header (NSH) <span>[<a class="cite xref" href="#RFC8300">RFC8300</a>]</span> has been
      defined as a shim-based encapsulation to identify the Service Function
      Path (SFP) in the Service Function Chaining (SFC) architecture <span>[<a class="cite xref" href="#RFC7665">RFC7665</a>]</span>. A proposal has been made for the processing of ECN
      when handling transport encapsulation <span>[<a class="cite xref" href="#I-D.ietf-sfc-nsh-ecn-support">SFC-NSH-ECN</a>]</span>.<a class="pilcrow" href="#section-6-11">¶</a></p>
<p id="section-6-12">The specification of Geneve already refers to <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> for ECN
      encapsulation.<a class="pilcrow" href="#section-6-12">¶</a></p>
<p id="section-6-13"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc8085#section-3.1.11">Section 3.1.11</a> of [<a class="cite xref" href="#RFC8085">RFC8085</a>]</span> already explains that a tunnel that
      encapsulates an IP header within a UDP/IP datagram needs to follow <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> when propagating the ECN field between inner and outer IP headers.
      <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a> of the present specification updates
      <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> to clarify that its scope includes cases with a shim header
      between the IP headers. So it indirectly updates the scope of <span>[<a class="cite xref" href="#RFC8085">RFC8085</a>]</span>
      to include cases with a shim header as well as a UDP header between the
      IP headers.<a class="pilcrow" href="#section-6-13">¶</a></p>
<p id="section-6-14">The requirements in <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a> update <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, and hence also indirectly update the UDP usage guidelines in <span>[<a class="cite xref" href="#RFC8085">RFC8085</a>]</span>
      to add the important but previously unstated requirement that, if the
      UDP tunnel egress does not, or might not, support ECN propagation, a UDP
      tunnel ingress has to clear the outer IP ECN field to 0b00, e.g., by
      configuration.<a class="pilcrow" href="#section-6-14">¶</a></p>
<p id="section-6-15"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc9329#section-9.5">Section 9.5</a> of [<a class="cite xref" href="#RFC9329">RFC9329</a>]</span> already recommends the compatibility mode of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>
      in this case because there is not a one-to-one mapping between inner
      and outer packets when TCP encapsulates IKE or IPsec.<a class="pilcrow" href="#section-6-15">¶</a></p>
<div id="rfc6040up_rfc-updates">
<section id="section-6.1">
        <h3 id="name-specific-updates-to-protoco">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-specific-updates-to-protoco">Specific Updates to Protocols under IETF Change Control</a>
        </h3>
<div id="rfc6040up_L2TPv3">
<section id="section-6.1.1">
          <h4 id="name-l2tp-v2-and-v3-ecn-extensio">
<a class="section-number selfRef" href="#section-6.1.1">6.1.1. </a><a class="section-name selfRef" href="#name-l2tp-v2-and-v3-ecn-extensio">L2TP (v2 and v3) ECN Extension</a>
          </h4>
<p id="section-6.1.1-1">The L2TP terminology used here is defined in <span>[<a class="cite xref" href="#RFC2661">RFC2661</a>]</span> and <span>[<a class="cite xref" href="#RFC3931">RFC3931</a>]</span>.<a class="pilcrow" href="#section-6.1.1-1">¶</a></p>
<p id="section-6.1.1-2">L2TPv3 <span>[<a class="cite xref" href="#RFC3931">RFC3931</a>]</span> is used as a
          shim header between any packet-switched network (PSN) header (e.g.,
          IPv4, IPv6, and MPLS) and many types of L2 headers. The L2TPv3 shim
          header encapsulates an L2-specific sub-layer, then an L2 header that
          is likely to contain an inner IP header (v4 or v6). 
Then this whole stack of headers can be encapsulated within an optional
outer UDP header and an outer PSN header that is typically IP (v4 or v6).<a class="pilcrow" href="#section-6.1.1-2">¶</a></p>
<p id="section-6.1.1-3">L2TPv2 is used as a shim header between any PSN header and a PPP
          header, which is in turn likely to encapsulate an IP header.<a class="pilcrow" href="#section-6.1.1-3">¶</a></p>
<p id="section-6.1.1-4">Even though these shims are rather fat (particularly in the case
          of L2TPv3), they still fit the definition of a tightly coupled shim
          header over an encapsulating header (<a class="auto internal xref" href="#rfc6040up_feasibility">Section 3.1</a>) because all the headers
          encapsulating the L2 header are added (or removed) together. L2TPv2
          and L2TPv3 are therefore within the scope of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, as updated by
          <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a>.<a class="pilcrow" href="#section-6.1.1-4">¶</a></p>
<p id="section-6.1.1-5">Implementation of the ECN extension to L2TPv2 and L2TPv3 defined
          in <a class="auto internal xref" href="#rfc6040up_L2TP_ECN">Section 6.1.1.2</a> is <span class="bcp14">RECOMMENDED</span> in
          order to provide the benefits of ECN <span>[<a class="cite xref" href="#RFC8087">RFC8087</a>]</span>
          whenever a node within an L2TP tunnel becomes the bottleneck for an
          end-to-end traffic flow.<a class="pilcrow" href="#section-6.1.1-5">¶</a></p>
<div id="rfc6040up_L2TP_Safe">
<section id="section-6.1.1.1">
            <h5 id="name-safe-configuration-of-a-non">
<a class="section-number selfRef" href="#section-6.1.1.1">6.1.1.1. </a><a class="section-name selfRef" href="#name-safe-configuration-of-a-non">Safe Configuration of a "Non-ECN" Ingress LCCE</a>
            </h5>
<p id="section-6.1.1.1-1">The following text is appended to both <span><a class="relref" href="https://rfc-editor.org/rfc/rfc2661#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#RFC2661">RFC2661</a>]</span> and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc3931#section-4.5">Section 4.5</a> of [<a class="cite xref" href="#RFC3931">RFC3931</a>]</span> as
            an update to the base L2TPv2 and L2TPv3 specifications:<a class="pilcrow" href="#section-6.1.1.1-1">¶</a></p>
<blockquote id="section-6.1.1.1-2">The operator of an LCCE that does not support the ECN extension in
<a class="auto internal xref" href="#rfc6040up_L2TP_ECN">Section 6.1.1.2</a> of RFC 9601
<span class="bcp14">MUST</span> follow the configuration requirements in <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a> of RFC 9601 to ensure it
clears the outer IP ECN field to 0b00 when the outer PSN header is IP (v4 or
v6).<a class="pilcrow" href="#section-6.1.1.1-2">¶</a>
</blockquote>
<p id="section-6.1.1.1-3">In particular, for an L2TP Control Connection Endpoint (LCCE)
            implementation that does not support the ECN extension, this means
            that configuration of how it propagates the ECN field between
            inner and outer IP headers <span class="bcp14">MUST</span> be independent of any
            configuration of the Diffserv extension of L2TP <span>[<a class="cite xref" href="#RFC3308">RFC3308</a>]</span>.<a class="pilcrow" href="#section-6.1.1.1-3">¶</a></p>
</section>
</div>
<div id="rfc6040up_L2TP_ECN">
<section id="section-6.1.1.2">
            <h5 id="name-ecn-extension-for-l2tp-v2-o">
<a class="section-number selfRef" href="#section-6.1.1.2">6.1.1.2. </a><a class="section-name selfRef" href="#name-ecn-extension-for-l2tp-v2-o">ECN Extension for L2TP (v2 or v3)</a>
            </h5>
<p id="section-6.1.1.2-1">When the outer PSN header and the payload inside the L2 header
            are both IP (v4 or v6), an LCCE will propagate
            the ECN field at ingress and egress by following the rules in
            <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-4">Section 4</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6.1.1.2-1">¶</a></p>
<p id="section-6.1.1.2-2">Before encapsulating any data packets, <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>
            requires an ingress LCCE to check that the egress LCCE supports
            ECN propagation as defined in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> or one of
            its compatible predecessors (<span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span> or the full functionality mode of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>). 
If the egress supports ECN
            propagation, the ingress LCCE can use the normal mode of
            encapsulation (copying the ECN field from inner to outer).
            Otherwise, the ingress LCCE has to use compatibility mode <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> (clearing the outer IP ECN
            field to 0b00).<a class="pilcrow" href="#section-6.1.1.2-2">¶</a></p>
<p id="section-6.1.1.2-3">An LCCE can determine the remote LCCE's support for ECN either
            statically (by configuration) or by dynamic discovery during setup
            of each control connection between the LCCEs using the ECN
            Capability Attribute-Value Pair (AVP) defined in <a class="auto internal xref" href="#rfc6040up_L2TP_ECN_Capability_AVP">Section 6.1.1.2.1</a>.<a class="pilcrow" href="#section-6.1.1.2-3">¶</a></p>
<p id="section-6.1.1.2-4">Where the outer PSN header is some protocol other than IP that
            supports ECN, the appropriate ECN propagation specification will
            need to be followed, e.g., <span>[<a class="cite xref" href="#RFC5129">RFC5129</a>]</span> for MPLS. Where no specification exists for
            ECN propagation by a particular PSN, <span>[<a class="cite xref" href="#RFC9599">RFC9599</a>]</span> gives general
            guidance on how to design ECN propagation into a protocol that
            encapsulates IP.<a class="pilcrow" href="#section-6.1.1.2-4">¶</a></p>
<div id="rfc6040up_L2TP_ECN_Capability_AVP">
<section id="section-6.1.1.2.1">
              <h6 id="name-ecn-capability-avp-for-nego">
<a class="section-number selfRef" href="#section-6.1.1.2.1">6.1.1.2.1. </a><a class="section-name selfRef" href="#name-ecn-capability-avp-for-nego">ECN Capability AVP for Negotiation between LCCEs</a>
              </h6>
<p id="section-6.1.1.2.1-1">The ECN Capability AVP defined here
              has Attribute Type 103. The AVP has the following format:<a class="pilcrow" href="#section-6.1.1.2.1-1">¶</a></p>
<span id="name-ecn-capability-avp-for-l2tp"></span><div id="Fig_rfc6040up_LCCE_ECN_Capabiliy_AVP">
<figure id="figure-1">
                <div class="alignLeft art-text artwork" id="section-6.1.1.2.1-2.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|M|H|0|0|0|0|      Length       |          Vendor ID            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             103               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-ecn-capability-avp-for-l2tp">ECN Capability AVP for L2TP (v2 or v3)</a>
                </figcaption></figure>
</div>
<p id="section-6.1.1.2.1-3">This AVP <span class="bcp14">MAY</span> be present in the Start-Control-Connection-Request (SCCRQ) and Start-Control-Connection-Reply (SCCRP) message types. This AVP <span class="bcp14">MAY</span> be hidden (the
              H-bit is set to 0 or 1) and is optional (the M-bit is not set). The length
              (before hiding) of this AVP is 6 octets. The Vendor ID is the
              IETF Vendor ID of 0.<a class="pilcrow" href="#section-6.1.1.2.1-3">¶</a></p>
<p id="section-6.1.1.2.1-4">When an LCCE sends an ECN Capability AVP, it indicates that
              it supports ECN propagation. When no ECN Capability AVP is
              present, it indicates that the sender does not support ECN
              propagation.<a class="pilcrow" href="#section-6.1.1.2.1-4">¶</a></p>
<p id="section-6.1.1.2.1-5">If an LCCE initiating a control connection supports ECN
              propagation, it will send an SCCRQ containing an ECN Capability AVP. If the tunnel
              terminator supports ECN, it will return an
              SCCRP that also includes an ECN
              Capability AVP. 
Then, for any sessions created by that control
              connection, both ends of the tunnel can use the normal mode of
              <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>; i.e., they can copy the IP ECN field from inner to
              outer when encapsulating data packets.<a class="pilcrow" href="#section-6.1.1.2.1-5">¶</a></p>
<p id="section-6.1.1.2.1-6">On the other hand, if the tunnel terminator does not support
              ECN, it will ignore the ECN Capability AVP and send an SCCRP to
              the tunnel initiator without an ECN Capability AVP. The tunnel
              initiator interprets the absence of the ECN Capability flag in
              the SCCRP as an indication that the tunnel terminator is
              incapable of supporting ECN. When encapsulating data packets for
              any sessions created by that control connection, the tunnel
              initiator will then use the compatibility mode of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> to
              clear the ECN field of the outer IP header to 0b00.<a class="pilcrow" href="#section-6.1.1.2.1-6">¶</a></p>
<p id="section-6.1.1.2.1-7">If the tunnel terminator does not support this ECN extension,
              the network operator is still expected to configure it to comply
              with the safety provisions set out in <a class="auto internal xref" href="#rfc6040up_L2TP_Safe">Section 6.1.1.1</a> when it acts as an ingress
              LCCE.<a class="pilcrow" href="#section-6.1.1.2.1-7">¶</a></p>
<p id="section-6.1.1.2.1-8">If ECN support by the ingress and egress LCCEs is configured
              statically, as allowed in <a class="auto internal xref" href="#rfc6040up_L2TP_ECN">Section 6.1.1.2</a>,
              they both ignore the presence or absence of any ECN capability AVP.<a class="pilcrow" href="#section-6.1.1.2.1-8">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rfc6040up_GRE">
<section id="section-6.1.2">
          <h4 id="name-gre">
<a class="section-number selfRef" href="#section-6.1.2">6.1.2. </a><a class="section-name selfRef" href="#name-gre">GRE</a>
          </h4>
<p id="section-6.1.2-1">The GRE terminology used here is defined in <span>[<a class="cite xref" href="#RFC2784">RFC2784</a>]</span>. GRE is often used as a tightly coupled shim
          header between IP headers. Sometimes, the GRE shim header
          encapsulates an L2 header, which might in turn encapsulate an IP
          header. Therefore, GRE is within the scope of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as updated by
          <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a>.<a class="pilcrow" href="#section-6.1.2-1">¶</a></p>
<p id="section-6.1.2-2">Implementation of support for <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as updated
          by the present specification is <span class="bcp14">RECOMMENDED</span> for GRE tunnel
          endpoints in order to provide the benefits of ECN <span>[<a class="cite xref" href="#RFC8087">RFC8087</a>]</span> whenever a node within a GRE tunnel becomes the
          bottleneck for an end-to-end IP traffic flow tunnelled over GRE
          using IP as the delivery protocol (outer header).<a class="pilcrow" href="#section-6.1.2-2">¶</a></p>
<p id="section-6.1.2-3">GRE itself does not support dynamic setup and configuration of
          tunnels. However, control plane protocols, such as Next Hop
          Resolution Protocol (NHRP) <span>[<a class="cite xref" href="#RFC2332">RFC2332</a>]</span>, Mobile IPv4
          (MIP4) <span>[<a class="cite xref" href="#RFC5944">RFC5944</a>]</span>, Mobile IPv6 (MIP6) <span>[<a class="cite xref" href="#RFC6275">RFC6275</a>]</span>, Proxy Mobile IP (PMIP) <span>[<a class="cite xref" href="#RFC5845">RFC5845</a>]</span>,
          and IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>, are sometimes used to set up GRE
          tunnels dynamically.<a class="pilcrow" href="#section-6.1.2-3">¶</a></p>
<p id="section-6.1.2-4">When these control protocols set up IP-in-IP or IPsec tunnels, it
          is likely that the resulting tunnels will propagate the ECN field as
          defined in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> or one of its compatible predecessors (<span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>
          or the full functionality mode of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>). However, if they use a
          GRE encapsulation, this presumption is less sound.<a class="pilcrow" href="#section-6.1.2-4">¶</a></p>
<p id="section-6.1.2-5">Therefore, if the outer delivery protocol is IP (v4 or v6), the
          operator is obliged to follow the safe configuration requirements in
          <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a>. <a class="auto internal xref" href="#rfc6040up_GRE_Safe">Section 6.1.2.1</a> updates the base GRE
          specification with this requirement to emphasize its
          importance.<a class="pilcrow" href="#section-6.1.2-5">¶</a></p>
<p id="section-6.1.2-6">Where the delivery protocol is some protocol other than IP that
          supports ECN, the appropriate ECN propagation specification will
          need to be followed, e.g., <span>[<a class="cite xref" href="#RFC5129">RFC5129</a>]</span> for MPLS. Where no specification exists for ECN
          propagation by a particular PSN, <span>[<a class="cite xref" href="#RFC9599">RFC9599</a>]</span> gives more general
          guidance on how to propagate ECN to and from protocols that
          encapsulate IP.<a class="pilcrow" href="#section-6.1.2-6">¶</a></p>
<div id="rfc6040up_GRE_Safe">
<section id="section-6.1.2.1">
            <h5 id="name-safe-configuration-of-a-non-">
<a class="section-number selfRef" href="#section-6.1.2.1">6.1.2.1. </a><a class="section-name selfRef" href="#name-safe-configuration-of-a-non-">Safe Configuration of a "Non-ECN" GRE Ingress</a>
            </h5>
<p id="section-6.1.2.1-1">The following text is appended to <span><a class="relref" href="https://rfc-editor.org/rfc/rfc2784#section-3">Section 3</a> of [<a class="cite xref" href="#RFC2784">RFC2784</a>]</span> as an update to the base GRE
            specification:<a class="pilcrow" href="#section-6.1.2.1-1">¶</a></p>
<blockquote id="section-6.1.2.1-2">     
The operator of a GRE tunnel ingress <span class="bcp14">MUST</span> follow the configuration requirements in <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a> of RFC 9601 when the outer delivery protocol is IP (v4 or v6).<a class="pilcrow" href="#section-6.1.2.1-2">¶</a>
</blockquote>
</section>
</div>
</section>
</div>
<section id="section-6.1.3">
          <h4 id="name-teredo">
<a class="section-number selfRef" href="#section-6.1.3">6.1.3. </a><a class="section-name selfRef" href="#name-teredo">Teredo</a>
          </h4>
<p id="section-6.1.3-1">Teredo <span>[<a class="cite xref" href="#RFC4380">RFC4380</a>]</span> provides a way to tunnel IPv6
          over an IPv4 network with a UDP-based shim header between the
          two.<a class="pilcrow" href="#section-6.1.3-1">¶</a></p>
<p id="section-6.1.3-2">For Teredo tunnel endpoints to provide the benefits of ECN, the
          Teredo specification would have to be updated to include negotiation
          of the ECN capability between Teredo tunnel endpoints. Otherwise, it
          would be unsafe for a Teredo tunnel ingress to copy the ECN field to
          the IPv6 outer.<a class="pilcrow" href="#section-6.1.3-2">¶</a></p>
<p id="section-6.1.3-3">Those implementations known to the authors at the time of writing
          do not support propagation of ECN, but they do safely zero the
          ECN field in the outer IPv6 header. However, the specification does
          not mention anything about this.<a class="pilcrow" href="#section-6.1.3-3">¶</a></p>
<p id="section-6.1.3-4">To make existing Teredo deployments safe, it would be possible to
          add ECN capability negotiation to those that are subject to remote
          OS update. However, for those implementations not subject to remote
          OS update, it will not be feasible to require them to be configured
          correctly because Teredo tunnel endpoints are generally deployed on
          hosts.<a class="pilcrow" href="#section-6.1.3-4">¶</a></p>
<p id="section-6.1.3-5">Therefore, until ECN support is added to the specification of
          Teredo, the only feasible further safety precaution available here
          is to update the specification of Teredo implementations with the
          following text as a new section:<a class="pilcrow" href="#section-6.1.3-5">¶</a></p>
<blockquote id="section-6.1.3-6">
            <p id="section-6.1.3-6.1">5.1.3.  Safe "Non-ECN" Teredo Encapsulation<a class="pilcrow" href="#section-6.1.3-6.1">¶</a></p>
<p id="section-6.1.3-6.2">A Teredo tunnel ingress implementation that does
              not support ECN propagation as defined in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> or one of its
              compatible predecessors (<span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span> or the full functionality mode
              of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>) <span class="bcp14">MUST</span> zero the ECN field in the outer IPv6
              header.<a class="pilcrow" href="#section-6.1.3-6.2">¶</a></p>
</blockquote>
</section>
<div id="rfc6040up_AMT">
<section id="section-6.1.4">
          <h4 id="name-amt">
<a class="section-number selfRef" href="#section-6.1.4">6.1.4. </a><a class="section-name selfRef" href="#name-amt">AMT</a>
          </h4>
<p id="section-6.1.4-1">AMT <span>[<a class="cite xref" href="#RFC7450">RFC7450</a>]</span> is a
          tightly coupled shim header that encapsulates an IP packet and is
          encapsulated within a UDP/IP datagram. Therefore, AMT is
          within the scope of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as updated by <a class="auto internal xref" href="#rfc6040up_scope">Section 3</a>.<a class="pilcrow" href="#section-6.1.4-1">¶</a></p>
<p id="section-6.1.4-2">Implementation of support for <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> as updated
          by the present specification is <span class="bcp14">RECOMMENDED</span> for AMT tunnel
          endpoints in order to provide the benefits of ECN <span>[<a class="cite xref" href="#RFC8087">RFC8087</a>]</span> whenever a node within an AMT tunnel becomes the
          bottleneck for an IP traffic flow tunnelled over AMT.<a class="pilcrow" href="#section-6.1.4-2">¶</a></p>
<p id="section-6.1.4-3">To comply with <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>, an AMT relay and gateway will follow the
          rules for propagation of the ECN field at ingress and egress,
          respectively, as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-4">Section 4</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6.1.4-3">¶</a></p>
<p id="section-6.1.4-4">Before encapsulating any data packets, <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> requires an
          ingress AMT relay to check that the egress AMT gateway supports ECN
          propagation as defined in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> or one of its compatible
          predecessors (<span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span> or the full functionality mode of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>).
          If the egress gateway supports ECN, the ingress relay can use the
          normal mode of encapsulation (copying the IP ECN field from inner to
          outer). Otherwise, the ingress relay has to use compatibility mode,
          which means it has to clear the outer ECN field to zero <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6.1.4-4">¶</a></p>
<p id="section-6.1.4-5">An AMT tunnel is created dynamically (not manually), so the relay
          will need to determine the remote gateway's support for ECN using
          the ECN capability declaration defined in <a class="auto internal xref" href="#rfc6040up_AMT_ECN_Capability">Section 6.1.4.2</a>.<a class="pilcrow" href="#section-6.1.4-5">¶</a></p>
<div id="rfc6040up_AMT_Safe">
<section id="section-6.1.4.1">
            <h5 id="name-safe-configuration-of-a-non-e">
<a class="section-number selfRef" href="#section-6.1.4.1">6.1.4.1. </a><a class="section-name selfRef" href="#name-safe-configuration-of-a-non-e">Safe Configuration of a "Non-ECN" Ingress AMT Relay</a>
            </h5>
<p id="section-6.1.4.1-1">The following text is appended to <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7450#section-4.2.2">Section 4.2.2</a> of [<a class="cite xref" href="#RFC7450">RFC7450</a>]</span> as an update to the AMT specification:<a class="pilcrow" href="#section-6.1.4.1-1">¶</a></p>
<blockquote id="section-6.1.4.1-2">       
                The operator of an AMT relay that does not support <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>
                or one of its compatible predecessors (<span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span> or the full
                functionality mode of <span>[<a class="cite xref" href="#RFC3168">RFC3168</a>]</span>) <span class="bcp14">MUST</span> follow the configuration
                requirements in <a class="auto internal xref" href="#rfc6040up_sec_safe">Section 4</a> of RFC 9601 to ensure it clears the outer IP ECN field to
                zero.<a class="pilcrow" href="#section-6.1.4.1-2">¶</a>
</blockquote>
</section>
</div>
<div id="rfc6040up_AMT_ECN_Capability">
<section id="section-6.1.4.2">
            <h5 id="name-ecn-capability-declaration-">
<a class="section-number selfRef" href="#section-6.1.4.2">6.1.4.2. </a><a class="section-name selfRef" href="#name-ecn-capability-declaration-">ECN Capability Declaration of an AMT Gateway</a>
            </h5>
<span id="name-updated-amt-request-message"></span><div id="Fig_rfc6040up_AMT_ECN_Capability_Declaration">
<figure id="figure-2">
              <div class="alignLeft art-text artwork" id="section-6.1.4.2-1.1">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  V=0  |Type=3 |  Reserved |E|P|            Reserved           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Request Nonce                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-updated-amt-request-message">Updated AMT Request Message Format</a>
              </figcaption></figure>
</div>
<p id="section-6.1.4.2-2">Bit 14 of the AMT Request Message counting from 0 (or bit 7 of
            the Reserved field counting from 1) is defined here as the AMT
            Gateway ECN Capability flag (E) as shown in <a class="auto internal xref" href="#Fig_rfc6040up_AMT_ECN_Capability_Declaration">Figure 2</a>. The
            definitions of all other fields in the AMT Request Message are
            unchanged from <span>[<a class="cite xref" href="#RFC7450">RFC7450</a>]</span>.<a class="pilcrow" href="#section-6.1.4.2-2">¶</a></p>
<p id="section-6.1.4.2-3">When the E flag is set to 1, it indicates that the sender of
            the message supports <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN propagation. When it is cleared
            to zero, it indicates the sender of the message does not support
            <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN propagation. An AMT gateway "that supports <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>
            ECN propagation" means one that propagates the ECN field to the
            forwarded data packet based on the combination of arriving inner
            and outer ECN fields as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6040#section-4">Section 4</a> of [<a class="cite xref" href="#RFC6040">RFC6040</a>]</span>.<a class="pilcrow" href="#section-6.1.4.2-3">¶</a></p>
<p id="section-6.1.4.2-4">The other bits of the Reserved field remain reserved. They will
            continue to be cleared to zero when sent and ignored when either
            received or forwarded as specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7450#section-5.1.3.3">Section 5.1.3.3</a> of [<a class="cite xref" href="#RFC7450">RFC7450</a>]</span>.<a class="pilcrow" href="#section-6.1.4.2-4">¶</a></p>
<p id="section-6.1.4.2-5">An AMT gateway that does not support <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> <span class="bcp14">MUST NOT</span> set the
            E flag of its Request Message to 1.<a class="pilcrow" href="#section-6.1.4.2-5">¶</a></p>
<p id="section-6.1.4.2-6">An AMT gateway that supports <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN propagation <span class="bcp14">MUST</span> set
            the E flag of its Relay Discovery Message to 1.<a class="pilcrow" href="#section-6.1.4.2-6">¶</a></p>
<p id="section-6.1.4.2-7">The action of the corresponding AMT relay that receives a
            Request message with the E flag set to 1 depends on whether the
            relay itself supports <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN propagation:<a class="pilcrow" href="#section-6.1.4.2-7">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.4.2-8.1">
                <p id="section-6.1.4.2-8.1.1">If the relay supports <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN propagation, it will
                store the ECN capability of the gateway along with its
                address. Then, whenever it tunnels datagrams towards this
                gateway, it <span class="bcp14">MUST</span> use the normal mode of <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> to propagate
                the ECN field when encapsulating datagrams (i.e., it
                copies the IP ECN field from inner to outer header).<a class="pilcrow" href="#section-6.1.4.2-8.1.1">¶</a></p>
</li>
              <li class="normal" id="section-6.1.4.2-8.2">
                <p id="section-6.1.4.2-8.2.1">If the discovered AMT relay does not support <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN
                propagation, it will ignore the E flag in the Reserved field
                as per <span><a class="relref" href="https://rfc-editor.org/rfc/rfc7450#section-5.1.3.3">Section 5.1.3.3</a> of [<a class="cite xref" href="#RFC7450">RFC7450</a>]</span>.<a class="pilcrow" href="#section-6.1.4.2-8.2.1">¶</a></p>
<p id="section-6.1.4.2-8.2.2">If the AMT relay does not support <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> ECN
                propagation, the network operator is still expected to
                configure it to comply with the safety provisions set out in
                <a class="auto internal xref" href="#rfc6040up_AMT_Safe">Section 6.1.4.1</a>.<a class="pilcrow" href="#section-6.1.4.2-8.2.2">¶</a></p>
</li>
            </ul>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rfc6040up_IANA_Considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-7-1">IANA has assigned the following AVP in the L2TP "Control Message Attribute Value Pairs" registry:<a class="pilcrow" href="#section-7-1">¶</a></p>
<table class="center" id="table-1">
        <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Attribute Type</th>
            <th class="text-left" colspan="1" rowspan="1">Description</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">103</td>
            <td class="text-left" colspan="1" rowspan="1">ECN Capability</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9601</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<div id="rfc6040up_Security_Considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-8-1">The Security Considerations in <span>[<a class="cite xref" href="#RFC6040">RFC6040</a>]</span> and <span>[<a class="cite xref" href="#RFC9599">RFC9599</a>]</span> apply equally to the
      scope defined for the present specification.<a class="pilcrow" href="#section-8-1">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2474">[RFC2474]</dt>
        <dd>
<span class="refAuthor">Nichols, K.</span>, <span class="refAuthor">Blake, S.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"</span>, <span class="seriesInfo">RFC 2474</span>, <span class="seriesInfo">DOI 10.17487/RFC2474</span>, <time class="refDate" datetime="1998-12">December 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2474">https://www.rfc-editor.org/info/rfc2474</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2661">[RFC2661]</dt>
        <dd>
<span class="refAuthor">Townsley, W.</span>, <span class="refAuthor">Valencia, A.</span>, <span class="refAuthor">Rubens, A.</span>, <span class="refAuthor">Pall, G.</span>, <span class="refAuthor">Zorn, G.</span>, and <span class="refAuthor">B. Palter</span>, <span class="refTitle">"Layer Two Tunneling Protocol "L2TP""</span>, <span class="seriesInfo">RFC 2661</span>, <span class="seriesInfo">DOI 10.17487/RFC2661</span>, <time class="refDate" datetime="1999-08">August 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2661">https://www.rfc-editor.org/info/rfc2661</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2784">[RFC2784]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Li, T.</span>, <span class="refAuthor">Hanks, S.</span>, <span class="refAuthor">Meyer, D.</span>, and <span class="refAuthor">P. Traina</span>, <span class="refTitle">"Generic Routing Encapsulation (GRE)"</span>, <span class="seriesInfo">RFC 2784</span>, <span class="seriesInfo">DOI 10.17487/RFC2784</span>, <time class="refDate" datetime="2000-03">March 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2784">https://www.rfc-editor.org/info/rfc2784</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3168">[RFC3168]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time class="refDate" datetime="2001-09">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3168">https://www.rfc-editor.org/info/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3931">[RFC3931]</dt>
        <dd>
<span class="refAuthor">Lau, J., Ed.</span>, <span class="refAuthor">Townsley, M., Ed.</span>, and <span class="refAuthor">I. Goyret, Ed.</span>, <span class="refTitle">"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"</span>, <span class="seriesInfo">RFC 3931</span>, <span class="seriesInfo">DOI 10.17487/RFC3931</span>, <time class="refDate" datetime="2005-03">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3931">https://www.rfc-editor.org/info/rfc3931</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4301">[RFC4301]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span> and <span class="refAuthor">K. Seo</span>, <span class="refTitle">"Security Architecture for the Internet Protocol"</span>, <span class="seriesInfo">RFC 4301</span>, <span class="seriesInfo">DOI 10.17487/RFC4301</span>, <time class="refDate" datetime="2005-12">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4301">https://www.rfc-editor.org/info/rfc4301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4380">[RFC4380]</dt>
        <dd>
<span class="refAuthor">Huitema, C.</span>, <span class="refTitle">"Teredo: Tunneling IPv6 over UDP through Network Address Translations (NATs)"</span>, <span class="seriesInfo">RFC 4380</span>, <span class="seriesInfo">DOI 10.17487/RFC4380</span>, <time class="refDate" datetime="2006-02">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4380">https://www.rfc-editor.org/info/rfc4380</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5129">[RFC5129]</dt>
        <dd>
<span class="refAuthor">Davie, B.</span>, <span class="refAuthor">Briscoe, B.</span>, and <span class="refAuthor">J. Tay</span>, <span class="refTitle">"Explicit Congestion Marking in MPLS"</span>, <span class="seriesInfo">RFC 5129</span>, <span class="seriesInfo">DOI 10.17487/RFC5129</span>, <time class="refDate" datetime="2008-01">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5129">https://www.rfc-editor.org/info/rfc5129</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6040">[RFC6040]</dt>
        <dd>
<span class="refAuthor">Briscoe, B.</span>, <span class="refTitle">"Tunnelling of Explicit Congestion Notification"</span>, <span class="seriesInfo">RFC 6040</span>, <span class="seriesInfo">DOI 10.17487/RFC6040</span>, <time class="refDate" datetime="2010-11">November 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6040">https://www.rfc-editor.org/info/rfc6040</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6660">[RFC6660]</dt>
        <dd>
<span class="refAuthor">Briscoe, B.</span>, <span class="refAuthor">Moncaster, T.</span>, and <span class="refAuthor">M. Menth</span>, <span class="refTitle">"Encoding Three Pre-Congestion Notification (PCN) States in the IP Header Using a Single Diffserv Codepoint (DSCP)"</span>, <span class="seriesInfo">RFC 6660</span>, <span class="seriesInfo">DOI 10.17487/RFC6660</span>, <time class="refDate" datetime="2012-07">July 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6660">https://www.rfc-editor.org/info/rfc6660</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7450">[RFC7450]</dt>
        <dd>
<span class="refAuthor">Bumgardner, G.</span>, <span class="refTitle">"Automatic Multicast Tunneling"</span>, <span class="seriesInfo">RFC 7450</span>, <span class="seriesInfo">DOI 10.17487/RFC7450</span>, <time class="refDate" datetime="2015-02">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7450">https://www.rfc-editor.org/info/rfc7450</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9599">[RFC9599]</dt>
      <dd>
<span class="refAuthor">Briscoe, B.</span> and <span class="refAuthor">J. Kaippallimalil</span>, <span class="refTitle">"Guidelines for Adding Congestion Notification to Protocols that Encapsulate IP"</span>, <span class="seriesInfo">RFC 9599</span>, <span class="seriesInfo">DOI 10.17487/RFC9599</span>, <time class="refDate" datetime="2024-08">August 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9599">https://www.rfc-editor.org/info/rfc9599</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="decap-test">[decap-test]</dt>
        <dd>
<span class="refAuthor">Briscoe, B.</span>, <span class="refTitle">"A Test for IP-ECN Propagation by a Remote Tunnel Endpoint"</span>, <span class="refContent">Technical Report, TR-BB-2023-003</span>, <span class="seriesInfo">DOI 10.48550/arXiv.2311.16825</span>, <time class="refDate" datetime="2023-11">November 2023</time>, <span>&lt;<a href="https://arxiv.org/abs/2311.16825">https://arxiv.org/abs/2311.16825</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GTPv1">[GTPv1]</dt>
        <dd>
<span class="refAuthor">3GPP</span>, <span class="refTitle">"General Packet Radio Service (GPRS); GPRS Tunnelling Protocol (GTP) across the Gn and Gp interface"</span>, <span class="seriesInfo">Technical Specification 29.060</span>. </dd>
<dd class="break"></dd>
<dt id="GTPv1-U">[GTPv1-U]</dt>
        <dd>
<span class="refAuthor">3GPP</span>, <span class="refTitle">"General Packet Radio System (GPRS) Tunnelling Protocol User Plane (GTPv1-U)"</span>, <span class="seriesInfo">Technical Specification 29.281</span>. </dd>
<dd class="break"></dd>
<dt id="GTPv2-C">[GTPv2-C]</dt>
        <dd>
<span class="refAuthor">3GPP</span>, <span class="refTitle">"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3"</span>, <span class="seriesInfo">Technical Specification 29.274</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-intarea-tunnels">[INTAREA-TUNNELS]</dt>
        <dd>
<span class="refAuthor">Touch, J. D.</span> and <span class="refAuthor">M. Townsley</span>, <span class="refTitle">"IP Tunnels in the Internet Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-intarea-tunnels-13</span>, <time class="refDate" datetime="2023-03-26">26 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-intarea-tunnels-13">https://datatracker.ietf.org/doc/html/draft-ietf-intarea-tunnels-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-nvo3-vxlan-gpe">[NVO3-VXLAN-GPE]</dt>
        <dd>
<span class="refAuthor">Maino, F.</span>, <span class="refAuthor">Kreeger, L.</span>, and <span class="refAuthor">U. Elzur</span>, <span class="refTitle">"Generic Protocol Extension for VXLAN (VXLAN-GPE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-nvo3-vxlan-gpe-13</span>, <time class="refDate" datetime="2023-11-04">4 November 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-nvo3-vxlan-gpe-13">https://datatracker.ietf.org/doc/html/draft-ietf-nvo3-vxlan-gpe-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1701">[RFC1701]</dt>
        <dd>
<span class="refAuthor">Hanks, S.</span>, <span class="refAuthor">Li, T.</span>, <span class="refAuthor">Farinacci, D.</span>, and <span class="refAuthor">P. Traina</span>, <span class="refTitle">"Generic Routing Encapsulation (GRE)"</span>, <span class="seriesInfo">RFC 1701</span>, <span class="seriesInfo">DOI 10.17487/RFC1701</span>, <time class="refDate" datetime="1994-10">October 1994</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1701">https://www.rfc-editor.org/info/rfc1701</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2332">[RFC2332]</dt>
        <dd>
<span class="refAuthor">Luciani, J.</span>, <span class="refAuthor">Katz, D.</span>, <span class="refAuthor">Piscitello, D.</span>, <span class="refAuthor">Cole, B.</span>, and <span class="refAuthor">N. Doraswamy</span>, <span class="refTitle">"NBMA Next Hop Resolution Protocol (NHRP)"</span>, <span class="seriesInfo">RFC 2332</span>, <span class="seriesInfo">DOI 10.17487/RFC2332</span>, <time class="refDate" datetime="1998-04">April 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2332">https://www.rfc-editor.org/info/rfc2332</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2637">[RFC2637]</dt>
        <dd>
<span class="refAuthor">Hamzeh, K.</span>, <span class="refAuthor">Pall, G.</span>, <span class="refAuthor">Verthein, W.</span>, <span class="refAuthor">Taarud, J.</span>, <span class="refAuthor">Little, W.</span>, and <span class="refAuthor">G. Zorn</span>, <span class="refTitle">"Point-to-Point Tunneling Protocol (PPTP)"</span>, <span class="seriesInfo">RFC 2637</span>, <span class="seriesInfo">DOI 10.17487/RFC2637</span>, <time class="refDate" datetime="1999-07">July 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2637">https://www.rfc-editor.org/info/rfc2637</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2983">[RFC2983]</dt>
        <dd>
<span class="refAuthor">Black, D.</span>, <span class="refTitle">"Differentiated Services and Tunnels"</span>, <span class="seriesInfo">RFC 2983</span>, <span class="seriesInfo">DOI 10.17487/RFC2983</span>, <time class="refDate" datetime="2000-10">October 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2983">https://www.rfc-editor.org/info/rfc2983</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3260">[RFC3260]</dt>
        <dd>
<span class="refAuthor">Grossman, D.</span>, <span class="refTitle">"New Terminology and Clarifications for Diffserv"</span>, <span class="seriesInfo">RFC 3260</span>, <span class="seriesInfo">DOI 10.17487/RFC3260</span>, <time class="refDate" datetime="2002-04">April 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3260">https://www.rfc-editor.org/info/rfc3260</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3308">[RFC3308]</dt>
        <dd>
<span class="refAuthor">Calhoun, P.</span>, <span class="refAuthor">Luo, W.</span>, <span class="refAuthor">McPherson, D.</span>, and <span class="refAuthor">K. Peirce</span>, <span class="refTitle">"Layer Two Tunneling Protocol (L2TP) Differentiated Services Extension"</span>, <span class="seriesInfo">RFC 3308</span>, <span class="seriesInfo">DOI 10.17487/RFC3308</span>, <time class="refDate" datetime="2002-11">November 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3308">https://www.rfc-editor.org/info/rfc3308</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5415">[RFC5415]</dt>
        <dd>
<span class="refAuthor">Calhoun, P., Ed.</span>, <span class="refAuthor">Montemurro, M., Ed.</span>, and <span class="refAuthor">D. Stanley, Ed.</span>, <span class="refTitle">"Control And Provisioning of Wireless Access Points (CAPWAP) Protocol Specification"</span>, <span class="seriesInfo">RFC 5415</span>, <span class="seriesInfo">DOI 10.17487/RFC5415</span>, <time class="refDate" datetime="2009-03">March 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5415">https://www.rfc-editor.org/info/rfc5415</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5845">[RFC5845]</dt>
        <dd>
<span class="refAuthor">Muhanna, A.</span>, <span class="refAuthor">Khalil, M.</span>, <span class="refAuthor">Gundavelli, S.</span>, and <span class="refAuthor">K. Leung</span>, <span class="refTitle">"Generic Routing Encapsulation (GRE) Key Option for Proxy Mobile IPv6"</span>, <span class="seriesInfo">RFC 5845</span>, <span class="seriesInfo">DOI 10.17487/RFC5845</span>, <time class="refDate" datetime="2010-06">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5845">https://www.rfc-editor.org/info/rfc5845</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5944">[RFC5944]</dt>
        <dd>
<span class="refAuthor">Perkins, C., Ed.</span>, <span class="refTitle">"IP Mobility Support for IPv4, Revised"</span>, <span class="seriesInfo">RFC 5944</span>, <span class="seriesInfo">DOI 10.17487/RFC5944</span>, <time class="refDate" datetime="2010-11">November 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5944">https://www.rfc-editor.org/info/rfc5944</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6275">[RFC6275]</dt>
        <dd>
<span class="refAuthor">Perkins, C., Ed.</span>, <span class="refAuthor">Johnson, D.</span>, and <span class="refAuthor">J. Arkko</span>, <span class="refTitle">"Mobility Support in IPv6"</span>, <span class="seriesInfo">RFC 6275</span>, <span class="seriesInfo">DOI 10.17487/RFC6275</span>, <time class="refDate" datetime="2011-07">July 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6275">https://www.rfc-editor.org/info/rfc6275</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7059">[RFC7059]</dt>
        <dd>
<span class="refAuthor">Steffann, S.</span>, <span class="refAuthor">van Beijnum, I.</span>, and <span class="refAuthor">R. van Rein</span>, <span class="refTitle">"A Comparison of IPv6-over-IPv4 Tunnel Mechanisms"</span>, <span class="seriesInfo">RFC 7059</span>, <span class="seriesInfo">DOI 10.17487/RFC7059</span>, <time class="refDate" datetime="2013-11">November 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7059">https://www.rfc-editor.org/info/rfc7059</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7348">[RFC7348]</dt>
        <dd>
<span class="refAuthor">Mahalingam, M.</span>, <span class="refAuthor">Dutt, D.</span>, <span class="refAuthor">Duda, K.</span>, <span class="refAuthor">Agarwal, P.</span>, <span class="refAuthor">Kreeger, L.</span>, <span class="refAuthor">Sridhar, T.</span>, <span class="refAuthor">Bursell, M.</span>, and <span class="refAuthor">C. Wright</span>, <span class="refTitle">"Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks"</span>, <span class="seriesInfo">RFC 7348</span>, <span class="seriesInfo">DOI 10.17487/RFC7348</span>, <time class="refDate" datetime="2014-08">August 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7348">https://www.rfc-editor.org/info/rfc7348</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7637">[RFC7637]</dt>
        <dd>
<span class="refAuthor">Garg, P., Ed.</span> and <span class="refAuthor">Y. Wang, Ed.</span>, <span class="refTitle">"NVGRE: Network Virtualization Using Generic Routing Encapsulation"</span>, <span class="seriesInfo">RFC 7637</span>, <span class="seriesInfo">DOI 10.17487/RFC7637</span>, <time class="refDate" datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7637">https://www.rfc-editor.org/info/rfc7637</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7665">[RFC7665]</dt>
        <dd>
<span class="refAuthor">Halpern, J., Ed.</span> and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Service Function Chaining (SFC) Architecture"</span>, <span class="seriesInfo">RFC 7665</span>, <span class="seriesInfo">DOI 10.17487/RFC7665</span>, <time class="refDate" datetime="2015-10">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7665">https://www.rfc-editor.org/info/rfc7665</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8085">[RFC8085]</dt>
        <dd>
<span class="refAuthor">Eggert, L.</span>, <span class="refAuthor">Fairhurst, G.</span>, and <span class="refAuthor">G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time class="refDate" datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8087">[RFC8087]</dt>
        <dd>
<span class="refAuthor">Fairhurst, G.</span> and <span class="refAuthor">M. Welzl</span>, <span class="refTitle">"The Benefits of Using Explicit Congestion Notification (ECN)"</span>, <span class="seriesInfo">RFC 8087</span>, <span class="seriesInfo">DOI 10.17487/RFC8087</span>, <time class="refDate" datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8087">https://www.rfc-editor.org/info/rfc8087</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8159">[RFC8159]</dt>
        <dd>
<span class="refAuthor">Konstantynowicz, M., Ed.</span>, <span class="refAuthor">Heron, G., Ed.</span>, <span class="refAuthor">Schatzmayr, R.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"Keyed IPv6 Tunnel"</span>, <span class="seriesInfo">RFC 8159</span>, <span class="seriesInfo">DOI 10.17487/RFC8159</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8159">https://www.rfc-editor.org/info/rfc8159</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8300">[RFC8300]</dt>
        <dd>
<span class="refAuthor">Quinn, P., Ed.</span>, <span class="refAuthor">Elzur, U., Ed.</span>, and <span class="refAuthor">C. Pignataro, Ed.</span>, <span class="refTitle">"Network Service Header (NSH)"</span>, <span class="seriesInfo">RFC 8300</span>, <span class="seriesInfo">DOI 10.17487/RFC8300</span>, <time class="refDate" datetime="2018-01">January 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8300">https://www.rfc-editor.org/info/rfc8300</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8311">[RFC8311]</dt>
        <dd>
<span class="refAuthor">Black, D.</span>, <span class="refTitle">"Relaxing Restrictions on Explicit Congestion Notification (ECN) Experimentation"</span>, <span class="seriesInfo">RFC 8311</span>, <span class="seriesInfo">DOI 10.17487/RFC8311</span>, <time class="refDate" datetime="2018-01">January 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8311">https://www.rfc-editor.org/info/rfc8311</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8926">[RFC8926]</dt>
        <dd>
<span class="refAuthor">Gross, J., Ed.</span>, <span class="refAuthor">Ganga, I., Ed.</span>, and <span class="refAuthor">T. Sridhar, Ed.</span>, <span class="refTitle">"Geneve: Generic Network Virtualization Encapsulation"</span>, <span class="seriesInfo">RFC 8926</span>, <span class="seriesInfo">DOI 10.17487/RFC8926</span>, <time class="refDate" datetime="2020-11">November 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8926">https://www.rfc-editor.org/info/rfc8926</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9300">[RFC9300]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Fuller, V.</span>, <span class="refAuthor">Meyer, D.</span>, <span class="refAuthor">Lewis, D.</span>, and <span class="refAuthor">A. Cabellos, Ed.</span>, <span class="refTitle">"The Locator/ID Separation Protocol (LISP)"</span>, <span class="seriesInfo">RFC 9300</span>, <span class="seriesInfo">DOI 10.17487/RFC9300</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9300">https://www.rfc-editor.org/info/rfc9300</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9329">[RFC9329]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span> and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"TCP Encapsulation of Internet Key Exchange Protocol (IKE) and IPsec Packets"</span>, <span class="seriesInfo">RFC 9329</span>, <span class="seriesInfo">DOI 10.17487/RFC9329</span>, <time class="refDate" datetime="2022-11">November 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9329">https://www.rfc-editor.org/info/rfc9329</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9331">[RFC9331]</dt>
        <dd>
<span class="refAuthor">De Schepper, K.</span> and <span class="refAuthor">B. Briscoe, Ed.</span>, <span class="refTitle">"The Explicit Congestion Notification (ECN) Protocol for Low Latency, Low Loss, and Scalable Throughput (L4S)"</span>, <span class="seriesInfo">RFC 9331</span>, <span class="seriesInfo">DOI 10.17487/RFC9331</span>, <time class="refDate" datetime="2023-01">January 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9331">https://www.rfc-editor.org/info/rfc9331</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-sfc-nsh-ecn-support">[SFC-NSH-ECN]</dt>
      <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Briscoe, B.</span>, <span class="refAuthor">Zhuang, S.</span>, <span class="refAuthor">Malis, A.</span>, and <span class="refAuthor">X. Wei</span>, <span class="refTitle">"Explicit Congestion Notification (ECN) and Congestion Feedback Using the Network Service Header (NSH) and IPFIX"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-sfc-nsh-ecn-support-13</span>, <time class="refDate" datetime="2024-04-15">15 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-sfc-nsh-ecn-support-13">https://datatracker.ietf.org/doc/html/draft-ietf-sfc-nsh-ecn-support-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">Thanks to <span class="contact-name">Ing-jyh (Inton) Tsang</span> for initial
      discussions on the need for ECN propagation in L2TP and its
      applicability. Thanks also to <span class="contact-name">Carlos Pignataro</span>,
      <span class="contact-name">Tom Herbert</span>, <span class="contact-name">Ignacio Goyret</span>,
      <span class="contact-name">Alia Atlas</span>, <span class="contact-name">Praveen       Balasubramanian</span>, <span class="contact-name">Joe Touch</span>, <span class="contact-name">Mohamed Boucadair</span>, <span class="contact-name">David Black</span>,
      <span class="contact-name">Jake Holland</span>, <span class="contact-name">Sri       Gundavelli</span>, <span class="contact-name">Gorry Fairhurst</span>, and <span class="contact-name">Martin Duke</span> for helpful advice and comments. <span>[<a class="cite xref" href="#RFC7059">RFC7059</a>]</span> helped to identify a number of
      tunnelling protocols to include within the scope of this document.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<p id="appendix-A-2"><span class="contact-name">Bob Briscoe</span>    was part-funded by the Research Council of Norway through                                 
   the TimeIn project for early drafts, and he was funded by Apple Inc. for later draft versions (from -17). The views expressed here are solely those of
      the authors.<a class="pilcrow" href="#appendix-A-2">¶</a></p>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a class="section-name selfRef" href="#name-authors-address">Author's Address</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Bob Briscoe</span></div>
<div class="left" dir="auto"><span class="org">Independent</span></div>
<div class="left" dir="auto"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ietf@bobbriscoe.net">ietf@bobbriscoe.net</a>
</div>
<div class="url">
<span>URI:</span>
<a class="url" href="https://bobbriscoe.net/">https://bobbriscoe.net/</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>