<html><head></head><body><pre>Internet Engineering Task Force (IETF)                             X. Xu
Request for Comments: 7814                           Huawei Technologies
Category: Informational                                     C. Jacquenet
ISSN: 2070-1721                                                   Orange
                                                               R. Raszuk
                                                                T. Boyes
                                                            Bloomberg LP
                                                                  B. Fee
                                                        Extreme Networks
                                                              March 2016


   <span class="h1">Virtual Subnet: A BGP/MPLS IP VPN-Based Subnet Extension Solution</span>

Abstract

   This document describes a BGP/MPLS IP VPN-based subnet extension
   solution referred to as "Virtual Subnet", which can be used for
   building Layer 3 network virtualization overlays within and/or
   between data centers.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="./rfc5741#section-2">SectionÂ 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7814">http://www.rfc-editor.org/info/rfc7814</a>.















<span class="grey">Xu, et al.                    Informational                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Solution Description  . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.1">3.1</a>.  Unicast . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
       <a href="#section-3.1.1">3.1.1</a>.  Intra-subnet Unicast  . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
       <a href="#section-3.1.2">3.1.2</a>.  Inter-subnet Unicast  . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-3.2">3.2</a>.  Multicast . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-3.3">3.3</a>.  Host Discovery  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.4">3.4</a>.  ARP/ND Proxy  . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.5">3.5</a>.  Host Mobility . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.6">3.6</a>.  Forwarding Table Scalability on Data-Center Switches  . .  <a href="#page-10">10</a>
     <a href="#section-3.7">3.7</a>.  ARP/ND Cache Table Scalability on Default Gateways  . . .  <a href="#page-10">10</a>
     <a href="#section-3.8">3.8</a>.  ARP/ND and Unknown Unicast Flood Avoidance  . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-3.9">3.9</a>.  Path Optimization . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-4">4</a>.  Limitations . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-4.1">4.1</a>.  Non-support of Non-IP Traffic . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-4.2">4.2</a>.  Non-support of IP Broadcast and Link-Local Multicast  . .  <a href="#page-11">11</a>
     <a href="#section-4.3">4.3</a>.  TTL and Traceroute  . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-5">5</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-6">6</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.1">6.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.2">6.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>










<span class="grey">Xu, et al.                    Informational                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   For business continuity purposes, Virtual Machine (VM) migration
   across data centers is commonly used in situations such as data-
   center maintenance, migration, consolidation, expansion, or disaster
   avoidance.  The IETF community has recognized that IP renumbering of
   servers (i.e., VMs) after the migration is usually complex and
   costly.  To allow the migration of a VM from one data center to
   another without IP renumbering, the subnet on which the VM resides
   needs to be extended across these data centers.

   To achieve subnet extension across multiple cloud data centers in a
   scalable way, the following requirements and challenges must be
   considered:

   a.  VPN Instance Space Scalability: In a modern cloud data-center
       environment, thousands or even tens of thousands of tenants could
       be hosted over a shared network infrastructure.  For security and
       performance isolation purposes, these tenants need to be isolated
       from one another.

   b.  Forwarding Table Scalability: With the development of server
       virtualization technologies, it's not uncommon for a single cloud
       data center to contain millions of VMs.  This number already
       implies a big challenge to the forwarding table scalability of
       data-center switches.  Provided multiple data centers of such
       scale were interconnected at Layer 2, this challenge would become
       even worse.

   c.  ARP/ND Cache Table Scalability: [<a href="./rfc6820" title='"Address Resolution Problems in Large Data Center Networks"'>RFC6820</a>] notes that the Address
       Resolution Protocol (ARP) / Neighbor Discovery (ND) cache tables
       maintained by default gateways within cloud data centers can
       raise scalability issues.  Therefore, mastering the size of the
       ARP/ND cache tables is critical as the number of data centers to
       be connected increases.

   d.  ARP/ND and Unknown Unicast Flooding: It's well-known that the
       flooding of ARP/ND broadcast/multicast messages as well as
       unknown unicast traffic within large Layer 2 networks is likely
       to affect network and host performance.  When multiple data
       centers that each host millions of VMs are interconnected at
       Layer 2, the impact of such flooding would become even worse.  As
       such, it becomes increasingly important to avoid the flooding of
       ARP/ND broadcast/multicast as well as unknown unicast traffic
       across data centers.






<span class="grey">Xu, et al.                    Informational                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   e.  Path Optimization: A subnet usually indicates a location in the
       network.  However, when a subnet has been extended across
       multiple geographically dispersed data-center locations, the
       location semantics of such a subnet is not retained any longer.
       As a result, traffic exchanged between a specific user and a
       server that would be located in different data centers may first
       be forwarded through a third data center.  This suboptimal
       routing would obviously result in unnecessary consumption of the
       bandwidth resources between data centers.  Furthermore, in the
       case where traditional Virtual Private LAN Service (VPLS)
       technology [<a href="./rfc4761" title='"Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling"'>RFC4761</a>] [<a href="./rfc4762" title='"Virtual Private LAN Service (VPLS) Using Label Distribution Protocol (LDP) Signaling"'>RFC4762</a>] is used for data-center
       interconnect, return traffic from a server may be forwarded to a
       default gateway located in a different data center due to the
       configuration of a virtual router redundancy group.  This
       suboptimal routing would also unnecessarily consume the bandwidth
       resources between data centers.

   This document describes a BGP/MPLS IP VPN-based subnet extension
   solution referred to as "Virtual Subnet", which can be used for data-
   center interconnection while addressing all of the aforementioned
   requirements and challenges.  Here, the BGP/MPLS IP VPN means both
   BGP/MPLS IPv4 VPN [<a href="./rfc4364" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>] and BGP/MPLS IPv6 VPN [<a href="./rfc4659" title='"BGP-MPLS IP Virtual Private Network (VPN) Extension for IPv6 VPN"'>RFC4659</a>].  In
   addition, since Virtual Subnet is built mainly on proven technologies
   such as BGP/MPLS IP VPN and ARP/ND proxy [<a href="./rfc925" title='"Multi-LAN address resolution"'>RFC925</a>] [<a href="./rfc1027" title='"Using ARP to implement transparent subnet gateways"'>RFC1027</a>]
   [<a href="./rfc4389" title='"Neighbor Discovery Proxies (ND Proxy)"'>RFC4389</a>], those service providers that provide Infrastructure as a
   Service (IaaS) cloud services can rely upon their existing BGP/MPLS
   IP VPN infrastructure and take advantage of their BGP/MPLS VPN
   operational experience to interconnect data centers.

   Although Virtual Subnet is described in this document as an approach
   for data-center interconnection, it can be used within data centers
   as well.

   Note that the approach described in this document is not intended to
   achieve an exact emulation of Layer 2 connectivity, and therefore it
   can only support a restricted Layer 2 connectivity service model with
   limitations that are discussed in <a href="#section-4">Section 4</a>.  The discussion about
   where this service model can apply is outside the scope of this
   document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   This memo makes use of the terms defined in [<a href="./rfc4364" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>].








<span class="grey">Xu, et al.                    Informational                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Solution%20Description"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Solution Description</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20Unicast"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Unicast</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.1.%20%20Intra-subnet%20Unicast"></a><a class="selflink" href="#section-3.1.1" id="section-3.1.1">3.1.1</a>.  Intra-subnet Unicast</span>

                           +--------------------+
    +------------------+   |                    |   +------------------+
    |VPN_A:192.0.2.1/24|   |                    |   |VPN_A:192.0.2.1/24|
    |              \   |   |                    |   |  /               |
    |    +------+   \ ++---+-+                +-+---++/   +------+     |
    |    |Host A+-----+ PE-1 |                | PE-2 +----+Host B|     |
    |    +------+\    ++-+-+-+                +-+-+-++   /+------+     |
    |     192.0.2.2/24 | | |                    | | |  192.0.2.3/24    |
    |                  | | |                    | | |                  |
    |     DC West      | | |  IP/MPLS Backbone  | | |     DC East      |
    +------------------+ | |                    | | +------------------+
                         | +--------------------+ |
                         |                        |
VRF_A :                  V                VRF_A : V
+------------+---------+--------+      +------------+---------+--------+
|   Prefix   |Next hop |Protocol|      |   Prefix   |Next hop |Protocol|
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.1/32|127.0.0.1| Direct |      |192.0.2.1/32|127.0.0.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.2/32|192.0.2.2| Direct |      |192.0.2.2/32|   PE-1  |  IBGP  |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.3/32|   PE-2  |  IBGP  |      |192.0.2.3/32|192.0.2.3| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.0/24|192.0.2.1| Direct |      |192.0.2.0/24|192.0.2.1| Direct |
+------------+---------+--------+      +------------+---------+--------+

                  Figure 1: Intra-subnet Unicast Example

   As shown in Figure 1, two hosts (i.e., Hosts A and B) belonging to
   the same subnet (i.e., 192.0.2.0/24) are located in different data
   centers (i.e., DC West and DC East), respectively.  PE routers (i.e.,
   PE-1 and PE-2) that are used for interconnecting these two data
   centers create host routes for their own local hosts respectively and
   then advertise these routes by means of the BGP/MPLS IP VPN
   signaling.  Meanwhile, an ARP proxy is enabled on Virtual Routing and
   Forwarding (VRF) attachment circuits of these PE routers.

   Let's now assume that Host A sends an ARP request for Host B before
   communicating with Host B.  Upon receiving the ARP request, PE-1
   acting as an ARP proxy returns its own MAC address as a response.
   Host A then sends IP packets for Host B to PE-1.  PE-1 tunnels such
   packets towards PE-2, which in turn forwards them to Host B.  Thus,



<span class="grey">Xu, et al.                    Informational                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   Hosts A and B can communicate with each other as if they were located
   within the same subnet.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.2.%20%20Inter-subnet%20Unicast"></a><a class="selflink" href="#section-3.1.2" id="section-3.1.2">3.1.2</a>.  Inter-subnet Unicast</span>

                           +--------------------+
    +------------------+   |                    |   +------------------+
    |VPN_A:192.0.2.1/24|   |                    |   |VPN_A:192.0.2.1/24|
    |              \   |   |                    |   |  /               |
    |  +------+     \ ++---+-+                +-+---++/     +------+   |
    |  |Host A+-------+ PE-1 |                | PE-2 +-+----+Host B|   |
    |  +------+\      ++-+-+-+                +-+-+-++ |   /+------+   |
    |   192.0.2.2/24   | | |                    | | |  | 192.0.2.3/24  |
    |   GW=192.0.2.4   | | |                    | | |  | GW=192.0.2.4  |
    |                  | | |                    | | |  |    +------+   |
    |                  | | |                    | | |  +----+  GW  +-- |
    |                  | | |                    | | |      /+------+   |
    |                  | | |                    | | |    192.0.2.4/24  |
    |                  | | |                    | | |                  |
    |     DC West      | | |  IP/MPLS Backbone  | | |      DC East     |
    +------------------+ | |                    | | +------------------+
                        | +--------------------+ |
                        |                        |
VRF_A :                 V                VRF_A : V
+------------+---------+--------+      +------------+---------+--------+
|   Prefix   |Next hop |Protocol|      |   Prefix   |Next hop |Protocol|
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.1/32|127.0.0.1| Direct |      |192.0.2.1/32|127.0.0.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.2/32|192.0.2.2| Direct |      |192.0.2.2/32|  PE-1   |  IBGP  |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.3/32|   PE-2  |  IBGP  |      |192.0.2.3/32|192.0.2.3| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.4/32|   PE-2  |  IBGP  |      |192.0.2.4/32|192.0.2.4| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.0/24|192.0.2.1| Direct |      |192.0.2.0/24|192.0.2.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
| 0.0.0.0/0  |   PE-2  |  IBGP  |      | 0.0.0.0/0  |192.0.2.4| Static |
+------------+---------+--------+      +------------+---------+--------+

                Figure 2: Inter-subnet Unicast Example (1)

   As shown in Figure 2, only one data center (i.e., DC East) is
   deployed with a default gateway (i.e., GW).  PE-2, which is connected
   to GW, would either be configured with or have learned a default
   route from GW with the next hop being pointed at GW.  Meanwhile, this
   route is distributed to other PE routers (i.e., PE-1) as per normal
   operation as described in [<a href="./rfc4364" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>].  Assume Host A sends an ARP



<span class="grey">Xu, et al.                    Informational                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   request for its default gateway (i.e., 192.0.2.4) prior to
   communicating with a destination host outside of its subnet.  Upon
   receiving this ARP request, PE-1 acting as an ARP proxy returns its
   own MAC address as a response.  Host A then sends a packet for Host B
   to PE-1.  PE-1 tunnels such a packet towards PE-2 according to the
   default route learned from PE-2, which in turn forwards that packet
   to GW.
                           +--------------------+
    +------------------+   |                    |   +------------------+
    |VPN_A:192.0.2.1/24|   |                    |   |VPN_A:192.0.2.1/24|
    |              \   |   |                    |   |  /               |
    |  +------+     \ ++---+-+                +-+---++/     +------+   |
    |  |Host A+----+--+ PE-1 |                | PE-2 +-+----+Host B|   |
    |  +------+\   |  ++-+-+-+                +-+-+-++ |   /+------+   |
    |  192.0.2.2/24 |  | | |                    | | |  | 192.0.2.3/24  |
    |  GW=192.0.2.4 |  | | |                    | | |  | GW=192.0.2.4  |
    |  +------+    |   | | |                    | | |  |    +------+   |
    |--+ GW-1 +----+   | | |                    | | |  +----+ GW-2 +-- |
    |  +------+\       | | |                    | | |      /+------+   |
    |  192.0.2.4/24    | | |                    | | |    192.0.2.4/24  |
    |                  | | |                    | | |                  |
    |     DC West      | | |  IP/MPLS Backbone  | | |      DC East     |
    +------------------+ | |                    | | +------------------+
                        | +--------------------+ |
                        |                        |
VRF_A :                 V                VRF_A : V
+------------+---------+--------+      +------------+---------+--------+
|   Prefix   |Next hop |Protocol|      |   Prefix   |Next hop |Protocol|
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.1/32|127.0.0.1| Direct |      |192.0.2.1/32|127.0.0.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.2/32|192.0.2.2| Direct |      |192.0.2.2/32|  PE-1   |  IBGP  |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.3/32|   PE-2  |  IBGP  |      |192.0.2.3/32|192.0.2.3| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.4/32|192.0.2.4| Direct |      |192.0.2.4/32|192.0.2.4| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.0/24|192.0.2.1| Direct |      |192.0.2.0/24|192.0.2.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
| 0.0.0.0/0  |192.0.2.4| Static |      | 0.0.0.0/0  |192.0.2.4| Static |
+------------+---------+--------+      +------------+---------+--------+

                Figure 3: Inter-subnet Unicast Example (2)

   As shown in Figure 3, in the case where each data center is deployed
   with a default gateway, hosts will get ARP responses directly from
   their local default gateways, rather than from their local PE routers
   when sending ARP requests for their default gateways.



<span class="grey">Xu, et al.                    Informational                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


                                  +------+
                           +------+ PE-3 +------+
    +------------------+   |      +------+      |   +------------------+
    |VPN_A:192.0.2.1/24|   |                    |   |VPN_A:192.0.2.1/24|
    |              \   |   |                    |   |  /               |
    |  +------+     \ ++---+-+                +-+---++/     +------+   |
    |  |Host A+-------+ PE-1 |                | PE-2 +------+Host B|   |
    |  +------+\      ++-+-+-+                +-+-+-++     /+------+   |
    |  192.0.2.2/24    | | |                    | | |    192.0.2.3/24  |
    |  GW=192.0.2.1    | | |                    | | |    GW=192.0.2.1  |
    |                  | | |                    | | |                  |
    |     DC West      | | |  IP/MPLS Backbone  | | |      DC East     |
    +------------------+ | |                    | | +------------------+
                         | +--------------------+ |
                         |                        |
VRF_A :                  V                VRF_A : V
+------------+---------+--------+      +------------+---------+--------+
|   Prefix   |Next hop |Protocol|      |   Prefix   |Next hop |Protocol|
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.1/32|127.0.0.1| Direct |      |192.0.2.1/32|127.0.0.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.2/32|192.0.2.2| Direct |      |192.0.2.2/32|  PE-1   |  IBGP  |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.3/32|   PE-2  |  IBGP  |      |192.0.2.3/32|192.0.2.3| Direct |
+------------+---------+--------+      +------------+---------+--------+
|192.0.2.0/24|192.0.2.1| Direct |      |192.0.2.0/24|192.0.2.1| Direct |
+------------+---------+--------+      +------------+---------+--------+
| 0.0.0.0/0  |   PE-3  |  IBGP  |      | 0.0.0.0/0  |   PE-3  |  IBGP  |
+------------+---------+--------+      +------------+---------+--------+

                Figure 4: Inter-subnet Unicast Example (3)

   Alternatively, as shown in Figure 4, PE routers themselves could be
   configured as default gateways for their locally connected hosts as
   long as these PE routers have routes to reach outside networks.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20Multicast"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Multicast</span>

   To support IP multicast between hosts of the same Virtual Subnet,
   Multicast VPN (MVPN) technologies [<a href="./rfc6513" title='"Multicast in MPLS/ BGP IP VPNs"'>RFC6513</a>] could be used without any
   change.  For example, PE routers attached to a given VPN join a
   default provider multicast distribution tree that is dedicated to
   that VPN.  Ingress PE routers, upon receiving multicast packets from
   their local hosts, forward them towards remote PE routers through the
   corresponding default provider multicast distribution tree.  Within
   this context, the IP multicast doesn't include link-local multicast.





<span class="grey">Xu, et al.                    Informational                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.3.%20%20Host%20Discovery"></a><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Host Discovery</span>

   PE routers should be able to dynamically discover their local hosts
   and keep the list of these hosts up-to-date in a timely manner to
   ensure the availability and accuracy of the corresponding host routes
   originated from them.  PE routers could accomplish local host
   discovery by some traditional host-discovery mechanisms using ARP or
   ND protocols.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.%20%20ARP%2FND%20Proxy"></a><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  ARP/ND Proxy</span>

   Acting as an ARP or ND proxy, a PE router should only respond to an
   ARP request or Neighbor Solicitation (NS) message for a target host
   when it has a best route for that target host in the associated VRF
   and the outgoing interface of that best route is different from the
   one over which the ARP request or NS message is received.  In the
   scenario where a given VPN site (i.e., a data center) is multihomed
   to more than one PE router via an Ethernet switch or an Ethernet
   network, the Virtual Router Redundancy Protocol (VRRP) [<a href="./rfc5798" title='"Virtual Router Redundancy Protocol (VRRP) Version 3 for IPv4 and IPv6"'>RFC5798</a>] is
   usually enabled on these PE routers.  In this case, only the PE
   router being elected as the VRRP Master is allowed to perform the
   ARP/ND proxy function.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.5.%20%20Host%20Mobility"></a><a class="selflink" href="#section-3.5" id="section-3.5">3.5</a>.  Host Mobility</span>

   During the VM migration process, the PE router to which the moving VM
   is now attached would create a host route for that host upon
   receiving a notification message of VM attachment (e.g., a gratuitous
   ARP or unsolicited NA message).  The PE router to which the moving VM
   was previously attached would withdraw the corresponding host route
   when noticing the detachment of that VM.  Meanwhile, the latter PE
   router could optionally broadcast a gratuitous ARP or send an
   unsolicited NA message on behalf of that host with the source MAC
   address being one of its own.  In this way, the ARP/ND entry of this
   host that moved and that has been cached on any local host would be
   updated accordingly.  In the case where there is no explicit VM
   detachment notification mechanism, the PE router could also use the
   following trick to detect the VM detachment: upon learning a route
   update for a local host from a remote PE router for the first time,
   the PE router could immediately check whether that local host is
   still attached to it by some means (e.g., ARP/ND PING and/or ICMP
   PING).  It is important to ensure that the same MAC and IP are
   associated to the default gateway active in each data center, as the
   VM would most likely continue to send packets to the same default
   gateway address after having migrated from one data center to
   another.  One possible way to achieve this goal is to configure the





<span class="grey">Xu, et al.                    Informational                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   same VRRP group on each location to ensure that the default gateway
   active in each data center shares the same virtual MAC and virtual IP
   addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.6.%20%20Forwarding%20Table%20Scalability%20on%20Data-Center%20Switches"></a><a class="selflink" href="#section-3.6" id="section-3.6">3.6</a>.  Forwarding Table Scalability on Data-Center Switches</span>

   In a Virtual Subnet environment, the MAC learning domain associated
   with a given Virtual Subnet that has been extended across multiple
   data centers is partitioned into segments, and each segment is
   confined within a single data center.  Therefore, data-center
   switches only need to learn local MAC addresses, rather than learning
   both local and remote MAC addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.7.%20%20ARP%2FND%20Cache%20Table%20Scalability%20on%20Default%20Gateways"></a><a class="selflink" href="#section-3.7" id="section-3.7">3.7</a>.  ARP/ND Cache Table Scalability on Default Gateways</span>

   When default gateway functions are implemented on PE routers as shown
   in Figure 4, the ARP/ND cache table on each PE router only needs to
   contain ARP/ND entries of local hosts.  As a result, the ARP/ND cache
   table size would not grow as the number of data centers to be
   connected increases.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.8.%20%20ARP%2FND%20and%20Unknown%20Unicast%20Flood%20Avoidance"></a><a class="selflink" href="#section-3.8" id="section-3.8">3.8</a>.  ARP/ND and Unknown Unicast Flood Avoidance</span>

   In a Virtual Subnet environment, the flooding domain associated with
   a given Virtual Subnet that was extended across multiple data
   centers, is partitioned into segments and each segment is confined
   within a single data center.  Therefore, the performance impact on
   networks and servers imposed by the flooding of ARP/ND broadcast/
   multicast and unknown unicast traffic is minimized.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.9.%20%20Path%20Optimization"></a><a class="selflink" href="#section-3.9" id="section-3.9">3.9</a>.  Path Optimization</span>

   As shown in Figure 4, to optimize the forwarding path for the traffic
   between cloud users and cloud data centers, PE routers located in
   cloud data centers (i.e., PE-1 and PE-2), which are also acting as
   default gateways, propagate host routes for their own local hosts to
   remote PE routers that are attached to cloud user sites (i.e., PE-3).
   As such, traffic from cloud user sites to a given server on the
   Virtual Subnet that has been extended across data centers would be
   forwarded directly to the data-center location where that server
   resides, since traffic is now forwarded according to the host route
   for that server, rather than the subnet route.  Furthermore, for
   traffic coming from cloud data centers and forwarded to cloud user
   sites, each PE router acting as a default gateway would forward
   traffic according to the longest-match route in the corresponding
   VRF.  As a result, traffic from data centers to cloud user sites is
   forwarded along an optimal path as well.




<span class="grey">Xu, et al.                    Informational                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Limitations"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Limitations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20Non-support%20of%20Non-IP%20Traffic"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  Non-support of Non-IP Traffic</span>

   Although most traffic within and across data centers is IP traffic,
   there may still be a few legacy clustering applications that rely on
   non-IP communications (e.g., heartbeat messages between cluster
   nodes).  Since Virtual Subnet is strictly based on L3 forwarding,
   those non-IP communications cannot be supported in the Virtual Subnet
   solution.  In order to support those few non-IP traffic (if present)
   in the environment where the Virtual Subnet solution has been
   deployed, the approach following the idea of "route all IP traffic,
   bridge non-IP traffic" could be considered.  In other words, all IP
   traffic including both intra- and inter-subnet, would be processed
   according to the Virtual Subnet design, while non-IP traffic would be
   forwarded according to a particular Layer 2 VPN approach.  Such a
   unified L2/L3 VPN approach requires ingress PE routers to classify
   packets received from hosts before distributing them to the
   corresponding L2 or L3 VPN forwarding processes.  Note that more and
   more cluster vendors are offering clustering applications based on
   Layer 3 interconnection.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Non-support%20of%20IP%20Broadcast%20and%20Link-Local%20Multicast"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Non-support of IP Broadcast and Link-Local Multicast</span>

   As illustrated before, intra-subnet traffic across PE routers is
   forwarded at Layer 3 in the Virtual Subnet solution.  Therefore, IP
   broadcast and link-local multicast traffic cannot be forwarded across
   PE routers in the Virtual Subnet solution.  In order to support the
   IP broadcast and link-local multicast traffic in the environment
   where the Virtual Subnet solution has been deployed, the unified L2/
   L3 overlay approach as described in <a href="#section-4.1">Section 4.1</a> could be considered
   as well.  That is, IP broadcast and link-local multicast messages
   would be forwarded at Layer 2 while routable IP traffic would be
   processed according to the Virtual Subnet design.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20TTL%20and%20Traceroute"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  TTL and Traceroute</span>

   As mentioned before, intra-subnet traffic is forwarded at Layer 3 in
   the Virtual Subnet context.  Since it doesn't require any change to
   the Time-To-Live (TTL) handling mechanism of the BGP/MPLS IP VPN,
   when doing a traceroute operation on one host for another host
   (assuming that these two hosts are within the same subnet but are
   attached to different sites), the traceroute output would reflect the
   fact that these two hosts within the same subnet are actually
   connected via a Virtual Subnet, rather than a Layer 2 connection
   since the PE routers to which those two hosts are connected would be
   displayed in the traceroute output.  In addition, for any other
   applications that generate intra-subnet traffic with TTL set to 1,



<span class="grey">Xu, et al.                    Informational                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   these applications may not work properly in the Virtual Subnet
   context, unless special TTL processing and loop-prevention mechanisms
   for such context have been implemented.  Details about such special
   TTL processing and loop-prevention mechanisms are outside the scope
   of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Security Considerations</span>

   Since the BGP/MPLS IP VPN signaling is reused without any change,
   those security considerations as described in [<a href="./rfc4364" title='"BGP/MPLS IP Virtual Private Networks (VPNs)"'>RFC4364</a>] are
   applicable to this document.  Meanwhile, since security issues
   associated with the NDP are inherited due to the use of NDP proxy,
   those security considerations and recommendations as described in
   [<a href="./rfc6583" title='"Operational Neighbor Discovery Problems"'>RFC6583</a>] are applicable to this document as well.

   Inter-data-center traffic often carries highly sensitive information
   at higher layers that is not directly understood (parsed) within an
   egress or ingress PE.  For example, migrating a VM will often mean
   moving private keys and other sensitive configuration information.
   For this reason, inter-data-center traffic should always be protected
   for both confidentiality and integrity using a strong security
   mechanism such as IPsec [<a href="./rfc4301" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>].  In the future, it may be feasible
   to protect that traffic within the MPLS layer [<a href="#ref-MPLS-SEC" title='"Opportunistic Security in MPLS Networks"'>MPLS-SEC</a>] though at
   the time of writing, the mechanism for that is not sufficiently
   mature to recommend.  Exactly how such security mechanisms are
   deployed will vary from case to case, so securing the inter-data-
   center traffic may or may not involve deploying security mechanisms
   on the ingress/egress PEs or further "inside" the data centers
   concerned.  Note though that if security is not deployed on the
   egress/ingress PEs, there is a substantial risk that some sensitive
   traffic may be sent in the clear and will therefore be vulnerable to
   pervasive monitoring [<a href="./rfc7258" title='"Pervasive Monitoring Is an Attack"'>RFC7258</a>] or other attacks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20References"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20Normative%20References"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Normative References</span>

   [<a id="ref-RFC925">RFC925</a>]   Postel, J., "Multi-LAN address resolution", <a href="./rfc925">RFC 925</a>,
              DOI 10.17487/RFC0925, October 1984,
              &lt;<a href="http://www.rfc-editor.org/info/rfc925">http://www.rfc-editor.org/info/rfc925</a>&gt;.

   [<a id="ref-RFC1027">RFC1027</a>]  Carl-Mitchell, S. and J. Quarterman, "Using ARP to
              implement transparent subnet gateways", <a href="./rfc1027">RFC 1027</a>,
              DOI 10.17487/RFC1027, October 1987,
              &lt;<a href="http://www.rfc-editor.org/info/rfc1027">http://www.rfc-editor.org/info/rfc1027</a>&gt;.






<span class="grey">Xu, et al.                    Informational                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   [<a id="ref-RFC4364">RFC4364</a>]  Rosen, E. and Y. Rekhter, "BGP/MPLS IP Virtual Private
              Networks (VPNs)", <a href="./rfc4364">RFC 4364</a>, DOI 10.17487/RFC4364, February
              2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4364">http://www.rfc-editor.org/info/rfc4364</a>&gt;.

   [<a id="ref-RFC4389">RFC4389</a>]  Thaler, D., Talwar, M., and C. Patel, "Neighbor Discovery
              Proxies (ND Proxy)", <a href="./rfc4389">RFC 4389</a>, DOI 10.17487/RFC4389, April
              2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4389">http://www.rfc-editor.org/info/rfc4389</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20Informative%20References"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Informative References</span>

   [<a id="ref-MPLS-SEC">MPLS-SEC</a>] Farrel, A. and S. Farrell, "Opportunistic Security in MPLS
              Networks", Work in Progress, <a href="./draft-ietf-mpls-opportunistic-encrypt-01">draft-ietf-mpls-</a>
              <a href="./draft-ietf-mpls-opportunistic-encrypt-01">opportunistic-encrypt-01</a>, March 2016.

   [<a id="ref-RFC4301">RFC4301</a>]  Kent, S. and K. Seo, "Security Architecture for the
              Internet Protocol", <a href="./rfc4301">RFC 4301</a>, DOI 10.17487/RFC4301,
              December 2005, &lt;<a href="http://www.rfc-editor.org/info/rfc4301">http://www.rfc-editor.org/info/rfc4301</a>&gt;.

   [<a id="ref-RFC4659">RFC4659</a>]  De Clercq, J., Ooms, D., Carugi, M., and F. Le Faucheur,
              "BGP-MPLS IP Virtual Private Network (VPN) Extension for
              IPv6 VPN", <a href="./rfc4659">RFC 4659</a>, DOI 10.17487/RFC4659, September 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4659">http://www.rfc-editor.org/info/rfc4659</a>&gt;.

   [<a id="ref-RFC4761">RFC4761</a>]  Kompella, K., Ed. and Y. Rekhter, Ed., "Virtual Private
              LAN Service (VPLS) Using BGP for Auto-Discovery and
              Signaling", <a href="./rfc4761">RFC 4761</a>, DOI 10.17487/RFC4761, January 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4761">http://www.rfc-editor.org/info/rfc4761</a>&gt;.

   [<a id="ref-RFC4762">RFC4762</a>]  Lasserre, M., Ed. and V. Kompella, Ed., "Virtual Private
              LAN Service (VPLS) Using Label Distribution Protocol (LDP)
              Signaling", <a href="./rfc4762">RFC 4762</a>, DOI 10.17487/RFC4762, January 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4762">http://www.rfc-editor.org/info/rfc4762</a>&gt;.

   [<a id="ref-RFC5798">RFC5798</a>]  Nadas, S., Ed., "Virtual Router Redundancy Protocol (VRRP)
              Version 3 for IPv4 and IPv6", <a href="./rfc5798">RFC 5798</a>,
              DOI 10.17487/RFC5798, March 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5798">http://www.rfc-editor.org/info/rfc5798</a>&gt;.

   [<a id="ref-RFC6513">RFC6513</a>]  Rosen, E., Ed. and R. Aggarwal, Ed., "Multicast in MPLS/
              BGP IP VPNs", <a href="./rfc6513">RFC 6513</a>, DOI 10.17487/RFC6513, February
              2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6513">http://www.rfc-editor.org/info/rfc6513</a>&gt;.

   [<a id="ref-RFC6583">RFC6583</a>]  Gashinsky, I., Jaeggli, J., and W. Kumari, "Operational
              Neighbor Discovery Problems", <a href="./rfc6583">RFC 6583</a>,
              DOI 10.17487/RFC6583, March 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6583">http://www.rfc-editor.org/info/rfc6583</a>&gt;.





<span class="grey">Xu, et al.                    Informational                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


   [<a id="ref-RFC6820">RFC6820</a>]  Narten, T., Karir, M., and I. Foo, "Address Resolution
              Problems in Large Data Center Networks", <a href="./rfc6820">RFC 6820</a>,
              DOI 10.17487/RFC6820, January 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6820">http://www.rfc-editor.org/info/rfc6820</a>&gt;.

   [<a id="ref-RFC7258">RFC7258</a>]  Farrell, S. and H. Tschofenig, "Pervasive Monitoring Is an
              Attack", <a href="https://www.rfc-editor.org/bcp/bcp188">BCP 188</a>, <a href="./rfc7258">RFC 7258</a>, DOI 10.17487/RFC7258, May
              2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7258">http://www.rfc-editor.org/info/rfc7258</a>&gt;.

Acknowledgements

   Thanks to Susan Hares, Yongbing Fan, Dino Farinacci, Himanshu Shah,
   Nabil Bitar, Giles Heron, Ronald Bonica, Monique Morrow, Rajiv Asati,
   Eric Osborne, Thomas Morin, Martin Vigoureux, Pedro Roque Marque, Joe
   Touch, Wim Henderickx, Alia Atlas, and Stephen Farrell for their
   valuable comments and suggestions on this document.  Thanks to Loa
   Andersson for his WG LC review on this document.  Thanks to Alvaro
   Retana for his AD review on this document.  Thanks to Ronald Bonica
   for his RtgDir review.  Thanks to Donald Eastlake 3rd for his Sec-DIR
   review of this document.  Thanks to Jouni Korhonen for the OPS-Dir
   review of this document.  Thanks to Roni Even for the Gen-ART review
   of this document.  Thanks to Sabrina Tanamal for the IANA review of
   this document.




























<span class="grey">Xu, et al.                    Informational                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc7814">RFC 7814</a>                     Virtual Subnet                   March 2016</span>


Authors' Addresses

   Xiaohu Xu
   Huawei Technologies
   No.156 Beiqing Rd
   Beijing  100095
   China

   Email: xuxiaohu@huawei.com


   Christian Jacquenet
   Orange
   4 rue du Clos Courtel
   Cesson-Sevigne,  35512
   France

   Email: christian.jacquenet@orange.com


   Robert Raszuk
   Bloomberg LP
   731 Lexington Avenue
   New York City, NY  10022
   United States

   Email: robert@raszuk.net


   Truman Boyes
   Bloomberg LP

   Email: tboyes@bloomberg.net


   Brendan Fee
   Extreme Networks

   Email: bfee@extremenetworks.com












Xu, et al.                    Informational                    [Page 15]
</pre>
</body></html>