<html><head></head><body><pre>Internet Engineering Task Force (IETF)                       C. Holmberg
Request for Comments: 8599                                      Ericsson
Category: Standards Track                                      M. Arnold
ISSN: 2070-1721                                      Metaswitch Networks
                                                                May 2019


      <span class="h1">Push Notification with the Session Initiation Protocol (SIP)</span>

Abstract

   This document describes how a Push Notification Service (PNS) can be
   used to wake a suspended Session Initiation Protocol (SIP) User Agent
   (UA) with push notifications, and it also describes how the UA can
   send binding-refresh REGISTER requests and receive incoming SIP
   requests in an environment in which the UA may be suspended.  The
   document defines new SIP URI parameters to exchange PNS information
   between the UA and the SIP entity that will then request that push
   notifications be sent to the UA.  It also defines the parameters to
   trigger such push notification requests.  The document also defines
   new feature-capability indicators that can be used to indicate
   support of this mechanism.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc7841#section-2">SectionÂ 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8599">https://www.rfc-editor.org/info/rfc8599</a>.















<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Conventions . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-3">3</a>.  Push Resource ID (PRID) . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-4">4</a>.  SIP User Agent (UA) Behavior  . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-4.1">4.1</a>.  REGISTER  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
       <a href="#section-4.1.1">4.1.1</a>.  Request Push Notifications  . . . . . . . . . . . . .   <a href="#page-9">9</a>
       <a href="#section-4.1.2">4.1.2</a>.  Disable Push Notifications  . . . . . . . . . . . . .  <a href="#page-11">11</a>
       <a href="#section-4.1.3">4.1.3</a>.  Receive Push Notifications  . . . . . . . . . . . . .  <a href="#page-11">11</a>
       4.1.4.  Sending Binding-Refresh Requests Using Non-push
               Mechanism . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
       <a href="#section-4.1.5">4.1.5</a>.  Query Network PNS Capabilities  . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-5">5</a>.  SIP Proxy Behavior  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-5.1">5.1</a>.  PNS Provider  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-5.2">5.2</a>.  SIP Request Push Bucket . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-5.3">5.3</a>.  SIP URI Comparison Rules  . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-5.4">5.4</a>.  Indicate Support of Type of PNS . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-5.5">5.5</a>.  Trigger Periodic Binding Refresh  . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-5.6">5.6</a>.  SIP Requests  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
       <a href="#section-5.6.1">5.6.1</a>.  REGISTER  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
       <a href="#section-5.6.2">5.6.2</a>.  Initial Request for Dialog or Standalone Request  . .  <a href="#page-20">20</a>
   <a href="#section-6">6</a>.  Support of Long-Lived SIP Dialogs . . . . . . . . . . . . . .  <a href="#page-23">23</a>
     <a href="#section-6.1">6.1</a>.  SIP UA Behavior . . . . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-6.1.1">6.1.1</a>.  Initial Request for Dialog  . . . . . . . . . . . . .  <a href="#page-25">25</a>
     <a href="#section-6.2">6.2</a>.  SIP Proxy Behavior  . . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-6.2.1">6.2.1</a>.  REGISTER  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-6.2.2">6.2.2</a>.  Initial Request for Dialog  . . . . . . . . . . . . .  <a href="#page-26">26</a>
       <a href="#section-6.2.3">6.2.3</a>.  Mid-dialog Request  . . . . . . . . . . . . . . . . .  <a href="#page-26">26</a>
   <a href="#section-7">7</a>.  Support of SIP Replaces . . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>
   <a href="#section-8">8</a>.  Grammar . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>
     8.1.  555 (Push Notification Service Not Supported) Response
           Code  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>



<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


     <a href="#section-8.2">8.2</a>.  'sip.pns' Feature-Capability Indicator  . . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-8.3">8.3</a>.  'sip.vapid' Feature-Capability Indicator  . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-8.4">8.4</a>.  'sip.pnsreg' Feature-Capability Indicator . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-8.5">8.5</a>.  'sip.pnsreg' Media Feature Tag  . . . . . . . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-8.6">8.6</a>.  'sip.pnspurr' Feature-Capability Indicator  . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-8.7">8.7</a>.  SIP URI Parameters  . . . . . . . . . . . . . . . . . . .  <a href="#page-29">29</a>
   <a href="#section-9">9</a>.  PNS Registration Requirements . . . . . . . . . . . . . . . .  <a href="#page-30">30</a>
   10. 'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for
       Apple Push Notification service . . . . . . . . . . . . . . .  <a href="#page-30">30</a>
   11. 'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for
       Google Firebase Cloud Messaging (FCM) Push Notification
       Service . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-31">31</a>
   12. 'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for
       <a href="./rfc8030">RFC 8030</a> (Generic Event Delivery Using HTTP Push) . . . . . .  <a href="#page-31">31</a>
   <a href="#section-13">13</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-32">32</a>
   <a href="#section-14">14</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
     <a href="#section-14.1">14.1</a>.  SIP URI Parameters . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
       <a href="#section-14.1.1">14.1.1</a>.  pn-provider  . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
       <a href="#section-14.1.2">14.1.2</a>.  pn-param . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
       <a href="#section-14.1.3">14.1.3</a>.  pn-prid  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
       <a href="#section-14.1.4">14.1.4</a>.  pn-purr  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-33">33</a>
     <a href="#section-14.2">14.2</a>.  SIP Response Codes . . . . . . . . . . . . . . . . . . .  <a href="#page-34">34</a>
       <a href="#section-14.2.1">14.2.1</a>.  555 (Push Notification Service Not Supported)  . . .  <a href="#page-34">34</a>
     <a href="#section-14.3">14.3</a>.  SIP Global Feature-Capability Indicator  . . . . . . . .  <a href="#page-34">34</a>
       <a href="#section-14.3.1">14.3.1</a>.  sip.pns  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-34">34</a>
       <a href="#section-14.3.2">14.3.2</a>.  sip.vapid  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-34">34</a>
       <a href="#section-14.3.3">14.3.3</a>.  sip.pnsreg . . . . . . . . . . . . . . . . . . . . .  <a href="#page-35">35</a>
       <a href="#section-14.3.4">14.3.4</a>.  sip.pnspurr  . . . . . . . . . . . . . . . . . . . .  <a href="#page-35">35</a>
     <a href="#section-14.4">14.4</a>.  SIP Media Feature Tag  . . . . . . . . . . . . . . . . .  <a href="#page-36">36</a>
       <a href="#section-14.4.1">14.4.1</a>.  sip.pnsreg . . . . . . . . . . . . . . . . . . . . .  <a href="#page-36">36</a>
     <a href="#section-14.5">14.5</a>.  PNS Subregistry Establishment  . . . . . . . . . . . . .  <a href="#page-36">36</a>
   <a href="#section-15">15</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-37">37</a>
     <a href="#section-15.1">15.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-37">37</a>
     <a href="#section-15.2">15.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-39">39</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-40">40</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-40">40</a>















<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   In order to save resources such as battery life, some devices
   (especially mobile devices) and operating systems will suspend an
   application that is not in use.  A suspended application might not be
   able to wake itself with internal timers and might not be awakened by
   incoming network traffic.  In such an environment, a Push
   Notification Service (PNS) is used to wake the application.  A PNS is
   a service that sends messages requested by other applications to a
   user application in order to wake the user application.  These
   messages are called push notifications.  Push notifications might
   contain payload data, depending on the application.  An application
   can request that a push notification be sent to a single user
   application or to multiple user applications.

   Typically, each operating system uses a dedicated PNS.  Different
   PNSs exist today.  Some are based on the standardized mechanism
   defined in [<a href="./rfc8030" title='"Generic Event Delivery Using HTTP Push"'>RFC8030</a>], while others are proprietary.  For example,
   Apple iOS devices use the Apple Push Notification service (APNs)
   while Android devices use the Firebase Cloud Messaging (FCM) service.
   Each PNS uses PNS-specific terminology and function names.  The
   terminology in this document is meant to be PNS-independent.  If the
   PNS is based on [<a href="./rfc8030" title='"Generic Event Delivery Using HTTP Push"'>RFC8030</a>], the SIP proxy takes the role of the
   application server.

   When a Session Initiation Protocol (SIP) User Agent (UA)[<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] is
   suspended in such an environment, it is unable to send binding-
   refresh SIP REGISTER requests, unable to receive incoming SIP
   requests, and might not be able to use internal timers to wake
   itself.  A suspended UA will not be able to maintain connections,
   e.g., using the SIP Outbound Mechanism [<a href="./rfc5626" title='"Managing Client-Initiated Connections in the Session Initiation Protocol (SIP)"'>RFC5626</a>], because it cannot
   send periodic keep-alive messages.  A PNS is needed to wake the SIP
   UA so that the UA can perform these functions.

   This document describes how a PNS can be used to wake a suspended UA
   using push notifications, so that the UA can send binding-refresh
   REGISTER requests and receive incoming SIP requests.  The document
   defines new SIP URI parameters and new feature-capability indicators
   [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] that can be used in SIP messages to indicate support of the
   mechanism defined in this document; be used to exchange PNS
   information between the UA and the SIP entity (realized as a SIP
   proxy in this document) that will request that push notifications are
   sent to the UA; and be used to request such push notification
   requests.







<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   NOTE: Even if a UA is able to be awakened by means other than
   receiving push notifications (e.g., by using internal timers) in
   order to send periodic binding-refresh REGISTER requests, it might
   still be useful to suspend the UA between the sending of binding-
   refresh requests (as it will save battery life) and use push
   notifications to wake the UA when an incoming SIP request UA arrives.

   When a UA registers with a PNS (Figure 1), it will receive a unique
   Push Resource ID (PRID) associated with the push notification
   registration.  The UA will use a REGISTER request to provide the PRID
   to the SIP proxy, which will then request that push notifications are
   sent to the UA.

   When the SIP proxy receives a SIP request for a new dialog or a
   standalone SIP request addressed towards a UA, or when the SIP proxy
   determines that the UA needs to send a binding-refresh REGISTER
   request, the SIP proxy will send a push request containing the PRID
   of the UA to the PNS, which will then send a push notification to the
   UA.  Once the UA receives the push notification, it will be able to
   send a binding-refresh REGISTER request.  The proxy receives the
   REGISTER request from the UA and forwards it to the SIP registrar
   [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  After accepting the REGISTER request, the SIP registrar
   sends a 2xx response to the proxy, which forwards the response to the
   UA.  If the push notification request was triggered by a SIP request
   addressed towards the UA, the proxy can then forward the SIP request
   to the UA using normal SIP routing procedures.  In some cases, the
   proxy can forward the SIP request without waiting for the SIP 2xx
   response to the REGISTER request from the SIP registrar.  Note that
   this mechanism necessarily adds delay to responding to requests
   requiring push notification.  The consequences of that delay are
   discussed in <a href="#section-5.6.2">Section 5.6.2</a>.

   If there are Network Address Translators (NATs) between the UA and
   the proxy, the REGISTER request sent by the UA will create NAT
   bindings that will allow the incoming SIP request that triggered the
   push notification to reach the UA.

   NOTE: The lifetime of any NAT binding created by the REGISTER request
   only needs to be long enough for the SIP request that triggered the
   push notification to reach the UA.

   Figure 1 shows the generic push notification architecture supported
   by the mechanism in this document.

   The SIP proxy MUST be in the signaling path of REGISTER requests sent
   by the UA towards the registrar, and of SIP requests (for a new
   dialog or a standalone) forwarded by the proxy responsible for the
   UA's domain (sometimes referred to as home proxy, Serving Call



<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   Session Control Function (S-CSCF), etc.) towards the UA.  The proxy
   can also be co-located with the proxy responsible for the UA's
   domain.  This will also ensure that the Request-URI of SIP requests
   (for a new dialog or a standalone) can be matched against contacts in
   REGISTER requests.














































<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


     +--------+      +---------+        +-----------+    +-------------+
     |        |      |         |        |           |    | SIP         |
     | SIP UA |      | Push    |        | SIP Proxy |    | Registrar / |
     |        |      | Service |        |           |    | Home Proxy  |
     +--------+      +---------+        +-----------+    +-------------+
         |                 |                  |                   |
         | Subscribe       |                  |                   |
         |----------------&gt;|                  |                   |
         |                 |                  |                   |
         | PRID            |                  |                   |
         |&lt;----------------|                  |                   |
         |                 |                  |                   |
         | SIP REGISTER (PRID)                |                   |
         |===================================&gt;|                   |
         |                 |                  |SIP REGISTER (PRID)|
         |                 |                  |==================&gt;|
         |                 |                  |                   |
         |                 |                  | SIP 200 OK        |
         |                 |                  |&lt;==================|
         | SIP 200 OK      |                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |
         |                 |                  | SIP INVITE (PRID) |
         |                 |                  |&lt;==================|
         |                 |                  |                   |
         |                 |Push Request (PRID)                   |
         |                 |&lt;-----------------|                   |
         |Push Message (PRID)                 |                   |
         |&lt;----------------|                  |                   |
         |                 |                  |                   |
         | SIP REGISTER (PRID)                |                   |
         |===================================&gt;|                   |
         |                 |                  |SIP REGISTER (PRID)|
         |                 |                  |==================&gt;|
         |                 |                  |                   |
         |                 |                  | SIP 200 OK        |
         |                 |                  |&lt;==================|
         | SIP 200 OK      |                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |
         | SIP INVITE      |                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |

         ------- Push Notification API
         ======= SIP

                    Figure 1: SIP Push Information Flow



<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


     Example of a SIP REGISTER request in the flow above:

     REGISTER sip:alice@example.com SIP/2.0
     Via: SIP/2.0/TCP alicemobile.example.com:5060;branch=z9hG4bKnashds7
     Max-Forwards: 70
     To: Alice &lt;sip:alice@example.com&gt;
     From: Alice &lt;sip:alice@example.com&gt;;tag=456248
     Call-ID: 843817637684230@998sdasdh09
     CSeq: 1826 REGISTER
     Contact: &lt;sip:alice@alicemobile.example.com;
       pn-provider=acme;
       pn-param=acme-param;
       pn-prid=ZTY4ZDJlMzODE1NmUgKi0K&gt;
     Expires: 7200
     Content-Length: 0

                      Figure 2: SIP REGISTER Example

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Conventions"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="./rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Push%20Resource%20ID%20%28PRID%29"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Push Resource ID (PRID)</span>

   When a SIP UA registers with a PNS it receives a unique Push Resource
   ID (PRID), which is a value associated with the registration that can
   be used to generate push notifications.

   The format of the PRID varies depending on the PNS.

   The details regarding discovery of the PNS, and the procedures
   regarding the push notification registration and maintenance, are
   outside the scope of this document.  The information needed to
   contact the PNS is typically preconfigured in the operating system of
   the device.












<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20SIP%20User%20Agent%20%28UA%29%20Behavior"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  SIP User Agent (UA) Behavior</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20REGISTER"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  REGISTER</span>

   This section describes how a SIP UA sends SIP REGISTER requests
   (either an initial REGISTER request for a binding or a binding-
   refresh REGISTER request) in order to request and disable push
   notifications from a SIP network, and to query the types of PNSs
   supported by the SIP network.

   Unless specified otherwise, the normal SIP UA registration procedures
   [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] apply.  The additional procedures described in this section
   apply when the REGISTER request contains a 'pn-provider' SIP URI
   parameter in the Contact header field URI (Figure 2).

   The procedures in this section apply to individual bindings
   [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  If a UA creates multiple bindings (e.g., one for IPv4 and
   one for IPv6), the UA needs to perform the procedures for each
   binding.

   NOTE: Since a push notification will trigger the UA to refresh all
   bindings, if a SIP UA has created multiple bindings, it is preferable
   if one can ensure that all bindings expire at the same time to help
   prevent some bindings from being refreshed earlier than needed.

   For privacy and security reasons, a UA MUST NOT insert the SIP URI
   parameters (except for the 'pn-purr' parameter) defined in this
   specification in non-REGISTER requests in order to prevent the PNS
   information associated with the UA from reaching the remote peer.
   For example, the UA MUST NOT insert the 'pn-prid' SIP URI parameter
   in the Contact header field URI of an INVITE request.  REGISTER
   requests will not reach the remote peer, as they will be terminated
   by the registrar of the UA.  However, the registrar MUST still ensure
   that the parameters are not sent to other users, e.g., using the
   mechanism defined by the SIP event package for registrations
   [<a href="./rfc3680" title='"A Session Initiation Protocol (SIP) Event Package for Registrations"'>RFC3680</a>].  See <a href="#section-13">Section 13</a> for more information.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.1.%20%20Request%20Push%20Notifications"></a><a class="selflink" href="#section-4.1.1" id="section-4.1.1">4.1.1</a>.  Request Push Notifications</span>

   This section describes the procedures that a SIP UA follows to
   request push notifications from the SIP network.  The procedures
   assume that the UA has retrieved a PRID from a PNS.  The procedures
   for retrieving the PRID from the PNS are PNS-specific and outside the
   scope of this specification.  See PNS-specific documentation for more
   details.






<span class="grey">Holmberg &amp; Arnold            Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   This specification does not define a mechanism to explicitly request
   push notifications from the SIP network for usages other than
   triggering binding-refresh REGISTER requests (e.g., for sending
   periodic subscription-refresh SUBSCRIBE requests [<a href="./rfc6665" title='"SIP-Specific Event Notification"'>RFC6665</a>]), nor does
   it describe how to distinguish push notifications associated with
   such usages from the push notifications used to trigger binding-
   refresh REGISTER requests.  If a SIP UA wants to use push
   notifications for other usages, the UA can perform actions associated
   with such usages (in addition to sending a binding-refresh REGISTER
   request) whenever it receives a push notification by using the same
   refresh interval that is used for the binding refreshes.

   To request push notifications from the SIP network, the UA MUST
   insert the following SIP URI parameters in the SIP Contact header
   field URI of the REGISTER request: 'pn-provider', 'pn-prid', and
   'pn-param' (if required for the specific PNS).  The 'pn-provider' URI
   parameter indicates the type of PNS to be used for the push
   notifications.

   If the UA receives a 2xx response to the REGISTER request that
   contains a Feature-Caps header field [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] with a 'sip.pns'
   feature-capability indicator, with an indicator value identifying the
   same type of PNS that was identified by the 'pn-provider' URI
   parameter in the REGISTER request, it indicates that another SIP
   Proxy in the SIP network will request that push notifications are
   sent to the UA.  In addition, if the same Feature-Caps header field
   contains a 'sip.vapid' feature-capability indicator, it indicates
   that the proxy supports use of the Voluntary Application Server
   Identification (VAPID) mechanism [<a href="./rfc8292" title='"Voluntary Application Server Identification (VAPID) for Web Push"'>RFC8292</a>] to restrict push
   notifications to the UA.

   NOTE: The VAPID-specific procedures of the SIP UA are outside the
   scope of this document.

   If the UA receives a non-2xx response to the REGISTER, or if the UA
   receives a 2xx response that does not contain a Feature-Caps header
   field [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] with a 'sip.pns' feature-capability indicator, the UA
   MUST NOT assume the proxy will request that push notifications are
   sent to the UA.  The actions taken by the UA in such cases are
   outside the scope of this document.

   If the PRID is only valid for a limited time, then the UA is
   responsible for retrieving a new PRID from the PNS and sending a
   binding-refresh REGISTER request with the updated 'pn-*' parameters.
   If a PRID is no longer valid, and the UA is not able to retrieve a
   new PRID, the UA MUST disable the push notifications associated with
   the PRID (<a href="#section-4.1.2">Section 4.1.2</a>).




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.2.%20%20Disable%20Push%20Notifications"></a><a class="selflink" href="#section-4.1.2" id="section-4.1.2">4.1.2</a>.  Disable Push Notifications</span>

   When a UA wants to disable previously requested push notifications,
   the UA SHOULD remove the binding [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>], unless the UA is no
   longer able to perform SIP procedures (e.g., due to a forced shutdown
   of the UA), in which case the registrar will remove the binding once
   it expires.  When the UA sends the REGISTER request for removing the
   binding, the UA MUST NOT insert the 'pn-prid' SIP URI parameter in
   the Contact header field URI of the REGISTER request.  The lack of
   the parameter informs the SIP network that the UA no longer wants to
   receive push notifications associated with the PRID.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.3.%20%20Receive%20Push%20Notifications"></a><a class="selflink" href="#section-4.1.3" id="section-4.1.3">4.1.3</a>.  Receive Push Notifications</span>

   When a UA receives a push notification, the UA MUST send a binding-
   refresh REGISTER request.  The UA MUST insert the same set of 'pn-*'
   SIP URI parameters in the SIP Contact header field URI of the
   REGISTER request that it inserted when it requested push
   notifications (<a href="#section-4.1.1">Section 4.1.1</a>).  Note that, in some cases, the PNS
   might update the PRID value, in which case the UA will insert the new
   value in the 'pn-prid' SIP URI parameter of the binding-refresh
   REGISTER request.

   Once the UA has received a 2xx response to the REGISTER request, the
   UA might receive a SIP request for a new dialog (e.g., a SIP INVITE)
   or a standalone SIP request (e.g., a SIP MESSAGE) if such a SIP
   request triggered the proxy to request that the push notification was
   sent to the UA.  Note that, depending on which transport protocol is
   used, the SIP request might reach the UA before the REGISTER
   response.

   If the SIP UA has created multiple bindings, the UA MUST send a
   binding-refresh REGISTER request for each of those bindings when it
   receives a push notification.

   This specification does not define any usage of push-notification
   payload.  If a SIP UA receives a push notification that contains a
   payload, the UA can discard the payload but will still send a
   binding-refresh REGISTER request.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.4.%20%20Sending%20Binding-Refresh%20Requests%20Using%20Non-push%20Mechanism"></a><a class="selflink" href="#section-4.1.4" id="section-4.1.4">4.1.4</a>.  Sending Binding-Refresh Requests Using Non-push Mechanism</span>

   If a UA is able to send binding-refresh REGISTER requests using a
   non-push mechanism (e.g., using an internal timer that periodically
   wakes the UA), the UA MUST insert a 'sip.pnsreg' media feature tag
   [<a href="./rfc3840" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>RFC3840</a>] in the Contact header field of each REGISTER request.





<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   If the UA receives a 2xx response to the REGISTER request that
   contains a Feature-Caps header field with a 'sip.pnsreq' feature-
   capability indicator, the UA MUST send a binding-refresh REGISTER
   request prior to binding expiration.  The indicator value indicates
   the minimum time (given in seconds), prior to the binding expiration
   when the UA needs to send the REGISTER request.

   If the UA receives a 2xx response to the REGISTER request that does
   not contain a Feature-Caps header field with a 'sip.pnsreq' feature-
   capability indicator, the UA SHOULD only send a binding-refresh
   REGISTER request when it receives a push notification (even if the UA
   is able to use a non-push mechanism for sending binding-refresh
   REGISTER requests) or when there are circumstances that require an
   immediate REGISTER request to be sent (e.g., if the UA is assigned
   new contact parameters due to a network configuration change).

   Even if the UA is able to send binding-refresh REGISTER requests
   using a non-push mechanism, the UA MUST still send a binding-refresh
   REGISTER request whenever it receives a push notification
   (<a href="#section-4.1.3">Section 4.1.3</a>).

   NOTE: If the UA uses a non-push mechanism to wake and send binding-
   refresh REGISTER requests, such REGISTER requests will update the
   binding expiration timer, and the proxy does not need to request that
   a push notification be sent to the UA in order to wake the UA.  The
   proxy will still request that a push notification be sent to the UA
   when the proxy receives a SIP request addressed towards the UA
   (<a href="#section-5.6.2">Section 5.6.2</a>).  This allows the UA to, e.g., use timers for sending
   binding-refresh REGISTER requests but be suspended (in order to save
   battery resources, etc.) between sending the REGISTER requests and
   using push notifications to wake the UA to process incoming calls.




















<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


     Example of a SIP REGISTER request including a 'sip.pnsreg'
     media feature tag:

     REGISTER sip:alice@example.com SIP/2.0
     Via: SIP/2.0/TCP alicemobile.example.com:5060;branch=z9hG4bKnashds7
     Max-Forwards: 70
     To: Alice &lt;sip:alice@example.com&gt;
     From: Alice &lt;sip:alice@example.com&gt;;tag=456248
     Call-ID: 843817637684230@998sdasdh09
     CSeq: 1826 REGISTER
     Contact: &lt;sip:alice@alicemobile.example.com;
       pn-provider=acme;
       pn-param=acme-param;
       pn-prid=ZTY4ZDJlMzODE1NmUgKi0K&gt;;
       +sip.pnsreg
     Expires: 7200
     Content-Length: 0

     Example of a SIP REGISTER response including a 'sip.pnsreg'
     media feature tag and a 'sip.pnsreq' feature-capability indicator:

     SIP/2.0 200 OK
     Via: SIP/2.0/TCP alicemobile.example.com:5060;branch=z9hG4bKnashds7
     To: Alice &lt;sip:alice@example.com&gt;;tag=123987
     From: Alice &lt;sip:alice@example.com&gt;;tag=456248
     Call-ID: 843817637684230@998sdasdh09
     CSeq: 1826 REGISTER
     Contact: &lt;sip:alice@alicemobile.example.com;
       pn-provider=acme;
       pn-param=acme-param;
       pn-prid=ZTY4ZDJlMzODE1NmUgKi0K&gt;;
       +sip.pnsreg
     Feature-Caps: *;+sip.pns="acme";+sip.pnsreg="121"
     Expires: 7200
     Content-Length: 0

       Figure 3: SIP REGISTER When Using Non-push Mechanism Example

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.5.%20%20Query%20Network%20PNS%20Capabilities"></a><a class="selflink" href="#section-4.1.5" id="section-4.1.5">4.1.5</a>.  Query Network PNS Capabilities</span>

   This section describes how a SIP UA can query the types of PNSs
   supported by a SIP network, and PNS-related capabilities (e.g.,
   support of the VAPID mechanism).  When a UA performs a query, it does
   not request push notifications from the SIP network.  Therefore, the
   UA can perform the query before it has registered to a PNS and
   received a PRID.





<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   In order to perform a query, the UA MUST insert a 'pn-provider' SIP
   URI parameter in the Contact header field URI of the REGISTER
   request:

   o  If the UA inserts a 'pn-provider' parameter value, indicating
      support of a type of PNS, the SIP network will only inform the UA
      whether that type of PNS is supported.

   o  If the UA does not insert a 'pn-provider' parameter value (i.e.,
      it inserts an "empty" 'pn-provider' parameter), the SIP network
      will inform the UA about all types of PNSs supported by the
      network.  This is useful, e.g., if the UA supports more than one
      type of PNS.  Note that it is not possible to insert multiple
      parameter values in the 'pn-provider' parameter.

   The UA MUST NOT insert a 'pn-prid' SIP URI parameter in the Contact
   header field URI of the REGISTER request.

   If the UA receives a 2xx response to the REGISTER request, the
   response will contain one or more Feature-Caps header fields with a
   'sip.pns' feature-capability indicator, indicating the types of PNSs
   supported by the SIP network.  If the UA inserted a 'pn-provider' SIP
   URI parameter value in the REGISTER request, the response will only
   indicate whether the SIP network supports the type of PNS supported
   by the UA.

   If the UA receives a 555 (Push Notification Service Not Supported)
   response to the REGISTER request, and if the UA inserted a
   'pn-provider' SIP URI parameter in the REGISTER request, the response
   indicates that the network does not support the type of PNS that the
   UA indicated support of.  If the UA did not insert a 'pn-provider'
   parameter in the REGISTER request, the response indicates that the
   network does not support any type of PNS while still supporting the
   555 (Push Notification Service Not Supported) response.

   NOTE: It is optional for a UA to perform a query before it requests
   push notifications from the SIP network.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20SIP%20Proxy%20Behavior"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  SIP Proxy Behavior</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20PNS%20Provider"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  PNS Provider</span>

   The type of PNS is identified by the 'pn-provider' SIP URI parameter.
   In some cases, there might only be one PNS provider for a given type
   of PNS, while in other cases there might be multiple providers.  The
   'pn-param' SIP URI parameter will provide more details associated
   with the actual PNS provider to be used.




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   The protocol and format used for the push notification requests are
   PNS-specific, and the details for constructing and sending a push
   notification request are outside the scope of this specification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20SIP%20Request%20Push%20Bucket"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  SIP Request Push Bucket</span>

   When a SIP proxy receives a SIP request addressed towards a UA, that
   will trigger the proxy to request that a push notification be sent to
   the UA.  The proxy will place the request in storage (referred to as
   the SIP Request Push Bucket) and the proxy will start a timer
   (referred to as the Bucket Timer) associated with the transaction.  A
   SIP request is removed from the bucket when one of the following has
   occurred: the proxy forwards the request towards the UA, the proxy
   sends an error response to the request, or the Bucket Timer times
   out.  The detailed procedures are described in the sections below.

   Exactly how the SIP Request Push Bucket is implemented is outside the
   scope of this document.  One option is to use the PRID as a key to
   search for SIP requests in the bucket.  Note that mid-dialog requests
   (<a href="#section-6">Section 6</a>) do not carry the PRID in the SIP request itself.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.3.%20%20SIP%20URI%20Comparison%20Rules"></a><a class="selflink" href="#section-5.3" id="section-5.3">5.3</a>.  SIP URI Comparison Rules</span>

   By default, a SIP proxy uses the URI comparison rules defined in
   [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  However, when a SIP proxy compares the Contact header
   field URI of a 2xx response to a REGISTER request with a Request-URI
   of a SIP request in the SIP Request Push Bucket (<a href="#section-5.2">Section 5.2</a>), the
   proxy uses the URI comparison rules with the following additions: the
   'pn-prid', 'pn-provider', and 'pn-param' SIP URI parameters MUST also
   match.  If a 'pn-*' parameter is present in one of the compared URIs
   but not in the other URI, there is no match.

   If only the 'pn-*' SIP URI parameters listed above match, but other
   parts of the compared URIs do not match, a proxy MAY still consider
   the comparison successful based on local policy.  This can occur in a
   race condition when the proxy compares the Contact header field URI
   of a 2xx response to a REGISTER request with a Request-URI of a SIP
   request in the SIP Request Push Bucket (<a href="#section-5.2">Section 5.2</a>) if the UA had
   modified some parts of the Contact header field URI in the REGISTER
   request but the Request-URI of the SIP request in the SIP Request
   Push Bucket still contains the old parts.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.4.%20%20Indicate%20Support%20of%20Type%20of%20PNS"></a><a class="selflink" href="#section-5.4" id="section-5.4">5.4</a>.  Indicate Support of Type of PNS</span>

   A SIP proxy uses feature-capability indicators [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] to indicate
   support of types of PNSs and additional features (e.g., VAPID)
   associated with the type of PNS.  A proxy MUST use a separate
   Feature-Cap header field for each supported type of PNS.  A feature-



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   capability indicator that indicates support of an additional feature
   associated with a given type of PNS MUST be inserted in the same
   Feature-Caps header field that is used to indicate support of the
   type of PNS.

   This specification defines the following feature-capability
   indicators that a proxy can use to indicate support of additional
   features associated with a given type of PNS: 'sip.vapid',
   'sip.pnsreg', and 'sip.pnspurr'.  These feature-capability indicators
   MUST only be inserted in a Feature-Caps header field that also
   contains a 'sip.pns' feature-capability indicator.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.5.%20%20Trigger%20Periodic%20Binding%20Refresh"></a><a class="selflink" href="#section-5.5" id="section-5.5">5.5</a>.  Trigger Periodic Binding Refresh</span>

   In order to request that a push notification be sent to a SIP UA, a
   SIP proxy needs to have information about when a binding will expire.
   The proxy needs to be able to retrieve the information from the
   registrar using some mechanism or run its own registration timers.
   Such mechanisms are outside the scope of this document but could be
   implemented, e.g., by using the SIP event package for registrations
   mechanism [<a href="./rfc3680" title='"A Session Initiation Protocol (SIP) Event Package for Registrations"'>RFC3680</a>].

   When the proxy receives an indication that the UA needs to send a
   binding-refresh REGISTER request, the proxy will request that a push
   notification be sent to the UA.

   Note that the push notification needs to be requested early enough
   for the associated binding-refresh REGISTER request to reach the
   registrar before the binding expires.  It is RECOMMENDED that the
   proxy requests the push notification at least 120 seconds before the
   binding expires.

   If the UA has indicated, using the 'sip.pnsreg' media feature tag,
   that it is able to wake itself using a non-push mechanism in order to
   send binding-refresh REGISTER requests, and if the proxy does not
   receive a REGISTER request prior to 120 seconds before the binding
   expires, the proxy MAY request that a push notification be sent to
   the UA to trigger the UA to send a binding-refresh REGISTER request.

   NOTE: As described in <a href="#section-4.1.5">Section 4.1.5</a>, a UA might send a REGISTER
   request without including a 'pn-prid' SIP URI parameter in order to
   retrieve push notification capabilities from the network before the
   UA expects to receive push notifications from the network.  A proxy
   will not request that push notifications are sent to a UA that has
   not provided a 'pn-prid' SIP URI parameter (<a href="#section-5.6.2">Section 5.6.2</a>).






<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   If the proxy receives information that a binding associated with a
   PRID has expired, or that a binding has been removed, the proxy MUST
   NOT request that further push notifications are sent to the UA using
   that PRID.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.%20%20SIP%20Requests"></a><a class="selflink" href="#section-5.6" id="section-5.6">5.6</a>.  SIP Requests</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.1.%20%20REGISTER"></a><a class="selflink" href="#section-5.6.1" id="section-5.6.1">5.6.1</a>.  REGISTER</span>

   This section describes how a SIP proxy processes SIP REGISTER
   requests (initial REGISTER request for a binding or a binding-refresh
   REGISTER request).

   The procedures in this section apply when the REGISTER request
   contains a 'pn-provider' SIP URI parameter in the Contact header
   field URI.  In other cases, the proxy MUST skip the procedures in
   this section and process the REGISTER request using normal SIP
   procedures.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.1.1.%20%20Request%20Push%20Notifications"></a><a class="selflink" href="#section-5.6.1.1" id="section-5.6.1.1">5.6.1.1</a>.  Request Push Notifications</span>

   This section describes the SIP proxy procedures when a SIP UA
   requests push notifications from the SIP network.

   The procedures in this section apply when the SIP REGISTER request
   contains, in addition to the 'pn-provider' SIP URI parameter, a
   'pn-prid' SIP URI parameter in the Contact header field URI of the
   request.

   When a proxy receives a REGISTER request that contains a Feature-Caps
   header field with a 'sip.pns' feature-capability indicator, it
   indicates that another proxy between this proxy and the UA supports
   the type of PNS supported by the UA, and will request that push
   notifications are sent to the UA.  In such case, the proxy MUST skip
   the rest of the procedures in this section and process the REGISTER
   request using normal SIP procedures.

   When a proxy receives a REGISTER request that does not contain a
   Feature-Caps header field with a 'sip.pns' feature-capability
   indicator, the proxy processes the request according to the
   procedures below:

   o  If the proxy does not support the type of PNS supported by the UA,
      or if the REGISTER request does not contain all information
      required for the type of PNS, the proxy SHOULD forward the request
      towards the registrar and skip the rest of the procedures in this
      section.  If the proxy knows (by means of local configuration)
      that no other proxies between itself and the registrar support the



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


      type of PNS supported by the UA, the proxy MAY send a SIP 555
      (Push Notification Service Not Supported) response instead of
      forwarding the request.

   o  If the proxy supports the type of PNS supported by the UA, but
      considers the requested binding expiration interval [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] to
      be too short (see below), the proxy MUST either send a 423
      (Interval Too Brief) response to the REGISTER request or forward
      the request towards the registrar and skip the rest of the
      procedures in this section.

   o  If the proxy supports the type of PNS supported by the UA, the
      proxy MUST indicate support of that type of PNS (<a href="#section-5.4">Section 5.4</a>) in
      the REGISTER request before it forwards the request towards the
      registrar.  This will inform proxies between the proxy and the
      registrar that the proxy supports the type of PNS supported by the
      UA, and that the proxy will request that push notifications are
      sent to the UA.

   A binding expiration interval MUST be considered too short if the
   binding would expire before the proxy can request that a push
   notification be sent to the UA to trigger the UA to send a binding-
   refresh REGISTER request.  The proxy MAY consider the interval too
   short based on its own policy so as to reduce load on the system.

   When a proxy receives a 2xx response to the REGISTER request, if the
   proxy indicated support of a type of PNS in the REGISTER request (see
   above), the proxy performs the following actions:

   o  If the proxy considers the binding expiration interval indicated
      by the registrar too short (see above), the proxy forwards the
      response towards the UA and MUST skip the rest of the procedures
      in this section.

   o  The proxy MUST indicate support of the same type of PNS in the
      REGISTER response.  In addition:

      *  If the proxy supports the VAPID mechanism [<a href="./rfc8292" title='"Voluntary Application Server Identification (VAPID) for Web Push"'>RFC8292</a>], the proxy
         MUST indicate support of the mechanism, using the 'sip.vapid'
         feature-capability indicator, in the REGISTER response.  The
         indicator value contains the public key identifying the proxy.
         The proxy MUST determine whether the PNS provider supports the
         VAPID mechanism before it indicates support of it.








<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


      *  If the proxy received a 'sip.pnsreg' media feature tag in the
         REGISTER request, the proxy SHOULD insert a 'sip.pnsreg'
         feature-capability indicator with an indicator value bigger
         than 120 in the response, unless the proxy always wants to
         request that push notifications are sent to the UA in order to
         trigger the UA to send a binding-refresh REGISTER request.

<span class="h5"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.1.2.%20%20Query%20Network%20PNS%20Capabilities"></a><a class="selflink" href="#section-5.6.1.2" id="section-5.6.1.2">5.6.1.2</a>.  Query Network PNS Capabilities</span>

   This section describes the SIP proxy procedures when a SIP UA queries
   about the push-notification support in the SIP network
   (<a href="#section-4.1.5">Section 4.1.5</a>).

   The procedures in this section apply when the REGISTER request
   contains a 'pn-provider' SIP URI parameter, but does not contain a
   'pn-prid' SIP URI parameter in the Contact header field URI of the
   REGISTER request.

   When a proxy receives a REGISTER request that contains a
   'pn-provider' SIP URI parameter indicating the type of PNS supported
   by the UA, the proxy MUST perform the following actions:

   o  If the proxy supports the type of PNS supported by the UA, the
      proxy MUST indicate support of that type of PNS (<a href="#section-5.4">Section 5.4</a>) in
      the REGISTER request before it forwards the request towards the
      registrar.  This will inform any other proxies between the proxy
      and the registrar that the proxy supports the type of PNS
      supported by the UA.

   o  If the proxy does not support the type of PNS supported by the UA,
      and if the REGISTER request contains Feature-Caps header fields
      indicating support of one or more types of PNSs, the proxy
      forwards the request towards the registrar.

   o  If the proxy does not support the type of PNS supported by the UA,
      and if the REGISTER request does not contain Feature-Caps header
      fields indicating support of one or more types of PNSs, the proxy
      MUST either forward the request towards the registrar or send a
      SIP 555 (Push Notification Service Not Supported) response towards
      the UA.  The proxy MUST NOT send a SIP 555 (Push Notification
      Service Not Supported) response unless it knows (by means of local
      configuration) that no other proxy supports any of the types of
      PNSs supported by the UA.

   When a proxy receives a REGISTER request, and the 'pn-provider' SIP
   URI parameter does not contain a parameter value, the proxy MUST
   indicate support of each type of PNS supported by the proxy before it
   forwards the request towards the registrar.



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   When a proxy receives a 2xx response to the REGISTER request, if the
   proxy had indicated support of one or more types of PNSs in the
   REGISTER request (see above), the proxy MUST indicate support of the
   same set of types of PNSs in the response.  In addition, if the proxy
   supports the VAPID mechanism for one or more types of PNSs, the proxy
   MUST indicate support of the mechanism for those PNSs in the
   response.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.6.2.%20%20Initial%20Request%20for%20Dialog%20or%20Standalone%20Request"></a><a class="selflink" href="#section-5.6.2" id="section-5.6.2">5.6.2</a>.  Initial Request for Dialog or Standalone Request</span>

   The procedures in this section apply when a SIP proxy has indicated
   that it will request that push notifications are sent to the SIP UA.

   When the proxy receives a SIP request for a new dialog (e.g., a SIP
   INVITE request) or a standalone SIP request (e.g., a SIP MESSAGE
   request) addressed towards a SIP UA, if the Request-URI of the
   request contains a 'pn-provider', a 'pn-prid', and a 'pn-param' (if
   required for the specific PNS provider) SIP URI parameter, the proxy
   requests that a push notification be sent to the UA using the
   information in the 'pn-*' SIP URI parameters.  The proxy then places
   the SIP request in the SIP Request Push Bucket.  The push
   notification will trigger the UA to send a binding-refresh REGISTER
   request that the proxy will process as described in <a href="#section-5.6.1">Section 5.6.1</a>.
   In addition, the proxy MUST store the Contact URI of the REGISTER
   request during the lifetime of the REGISTER transaction.

   NOTE: If the proxy receives a SIP request that does not contain the
   'pn-*' SIP URI parameters listed above, the proxy processing of the
   request is based on local policy.  If the proxy also serves requests
   for UAs that do not use the SIP push mechanism, the proxy can forward
   the request towards the UA.  Otherwise, the proxy can reject the
   request.

   When the proxy receives a 2xx response to the REGISTER request, the
   proxy performs the following actions:

   o  The proxy processes the REGISTER response as described in
      <a href="#section-5.6.1">Section 5.6.1</a>.

   o  The proxy checks whether the SIP Request Push Bucket contains a
      SIP request associated with the REGISTER transaction by comparing
      (<a href="#section-5.3">Section 5.3</a>) the Contact header field URI in the REGISTER
      response with the Request-URIs of the SIP requests in the bucket.
      If there is a match, the proxy MUST remove the SIP request from
      the bucket and forward it towards the UA.






<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   The reason the proxy needs to wait for the REGISTER response before
   forwarding a SIP request towards a UA is to make sure that the
   REGISTER request has been accepted by the registrar, and that the UA
   that initiated the REGISTER request is authorized to receive messages
   for the Request-URI.

   If the proxy receives a non-2xx response to the REGISTER request, the
   proxy compares the Contact URI stored from the REGISTER request (see
   above) with the Request-URIs of the SIP requests in the SIP Request
   Push Bucket.  If there is a match, the proxy SHOULD remove the
   associated request from the bucket and send an error response to the
   request.  It is RECOMMENDED that the proxy sends either a 404 (Not
   Found) response or a 480 (Temporarily Unavailable) response to the
   SIP request, but other response codes can be used as well.  However,
   if the REGISTER response is expected to trigger a new REGISTER
   request from the UA (e.g., if the registrar is requesting the UA to
   perform authentication), the proxy MAY keep the SIP request in the
   bucket.

   If the push notification request fails (see PNS-specific
   documentation for details), the proxy MUST remove the SIP request
   from the bucket and send an error response to the SIP request.  It is
   RECOMMENDED that the proxy sends either a 404 (Not Found) response or
   a 480 (Temporarily Unavailable) response, but other response codes
   can be used as well.

   After the proxy has requested that a push notification be sent to a
   UA, if the proxy does not receive a REGISTER response with a Contact
   URI that matches the Request-URI of the SIP request before the Bucket
   Timer (<a href="#section-5.2">Section 5.2</a>) associated with the SIP request times out, the
   proxy MUST remove the SIP request from the SIP Request Push Bucket
   (<a href="#section-5.2">Section 5.2</a>) and send a 480 (Temporarily Unavailable) response.  The
   Bucket Timer time-out value is set based on local policy, taking the
   guidelines below into consideration.

   As discussed in [<a href="./rfc4320" title="&quot;Actions Addressing Identified Issues with the Session Initiation Protocol's (SIP) Non-INVITE Transaction&quot;">RFC4320</a>] and [<a href="./rfc4321" title="&quot;Problems Identified Associated with the Session Initiation Protocol's (SIP) Non-INVITE Transaction&quot;">RFC4321</a>], non-INVITE transactions must
   complete immediately or risk losing a race, which results in stress
   on intermediaries and state misalignment at the endpoints.  The
   mechanism defined in this document inherently delays the final
   response to any non-INVITE request that requires a push notification.
   In particular, if the proxy forwards the SIP request towards the SIP
   UA, the SIP UA accepts the request, but the transaction times out at
   the sender before it receives the successful response, this will
   cause state misalignment between the endpoints (the sender considers
   the transaction a failure, while the receiver considers the
   transaction a success).  The SIP proxy needs to take this into
   account when it sets the value of the Bucket Timer associated with
   the transaction, to make sure that the error response (triggered by a



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 21]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-22"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   Bucket Timer time out) reaches the sender before the transaction
   times out.  If the accumulated delay of this mechanism combined with
   any other mechanisms in the path of processing the non-INVITE
   transaction cannot be kept short, this mechanism should not be used.
   For networks encountering such conditions, an alternative (left for
   possible future work) would be for the proxy to immediately return a
   new error code meaning "wait at least the number of seconds specified
   in this response and retry your request" before initiating the push
   notification.

   NOTE: While the work on this document was ongoing, implementation
   test results showed that the time it takes for a proxy to receive the
   REGISTER request, from when the proxy has requested a push
   notification, is typically around 2 seconds.  However, the time might
   vary depending on the characteristics and load of the SIP network and
   the PNS.

   In addition to the procedures described above, there are two cases
   where a proxy, as an optimization, can forward a SIP request towards
   a UA without either waiting for a 2xx response to a REGISTER request
   or requesting that a push notification be sent to the UA:

   o  If the proxy is able to authenticate the sender of the REGISTER
      request and verify that it is allowed by authorization policy, the
      proxy does not need to wait for the 2xx response before it
      forwards the SIP request towards the UA.  In such cases, the proxy
      will use the Contact URI of the REGISTER request when comparing it
      against the Request-URIs of the SIP requests in the SIP Request
      Push Bucket.

   o  If the proxy has knowledge that the UA is awake, and that the UA
      is able to receive the SIP request without first sending a
      binding-refresh REGISTER request, the proxy does not need to
      request that a push notification be sent to the UA (the UA will
      not send a binding-refresh REGISTER request) before it forwards
      the SIP request towards the UA.  The mechanisms for getting such
      knowledge might be dependent on implementation or deployment
      architecture, and are outside the scope of this document.

   Some PNS providers allow payload in the push notifications.  This
   specification does not define usage of such payload (in addition to
   any payload that might be required by the PNS itself).









<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 22]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-23"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Support%20of%20Long-Lived%20SIP%20Dialogs"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Support of Long-Lived SIP Dialogs</span>

   Some SIP dialogs might have a long lifetime with little activity.
   For example, when the SIP event notification mechanism [<a href="./rfc6665" title='"SIP-Specific Event Notification"'>RFC6665</a>] is
   used, there might be a long period between the sending of mid-dialog
   requests.  Because of this, a SIP UA may be suspended and may need to
   be awakened in order to be able to receive mid-dialog requests.

   SIP requests for a new dialog and standalone SIP requests addressed
   towards a UA with 'pn-*' SIP URI parameters allow the proxy to
   request that a push notification be sent to the UA (<a href="#section-5.6.2">Section 5.6.2</a>).
   However, 'pn-*' SIP URI parameters will not be present in mid-dialog
   requests addressed towards the UA.  Instead, the proxy needs to
   support a mechanism to store the information needed to request that a
   push notification be sent to the UA, and to be able to retrieve that
   information when it receives a mid-dialog request addressed towards
   the UA.  This section defines such a mechanism.  The SIP UA and SIP
   proxy procedures in this section are applied in addition to the
   generic procedures defined in this specification.

     +--------+      +---------+        +-----------+    +-------------+
     |        |      |         |        |           |    | SIP         |
     | SIP UA |      | Push    |        | SIP Proxy |    | Registrar / |
     |        |      | Service |        |           |    | Home Proxy  |
     +--------+      +---------+        +-----------+    +-------------+
         |                 |                  |                   |
         | PNS Register    |                  |                   |
         |----------------&gt;|                  |                   |
         |                 |                  |                   |
         | PRID            |                  |                   |
         |&lt;----------------|                  |                   |
         |                 |                  |                   |
         | SIP REGISTER (PRID)                |                   |
         |===================================&gt;|                   |
         |                 |                  |SIP REGISTER (PRID)|
         |                 |                  |==================&gt;|
         |                 |                  |                   |
         |                 |      +-----------------------+       |
         |                 |      | Store PRID (key=PURR) |       |
         |                 |      +-----------------------+       |
         |                 |                  |                   |
         |                 |                  | SIP 200 OK        |
         |                 |                  |&lt;==================|
         | SIP 200 OK (PURR)                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |
         |                 |                  |                   |




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 23]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-24"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


         | SIP INVITE (PURR)                  |                   |
         |===================================&gt;|                   |
         |                 |                  |SIP INVITE (PURR)  |
         |                 |                  |==================&gt;|
         |                 |                  |                   |
         |                 |                  | SIP 200 OK        |
         |                 |                  |&lt;==================|
         | SIP 200 OK      |                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |
         |                 |                  |                   |
         |                 |                  |                   |
         |                 |                  |SIP UPDATE (PURR)  |
         |                 |                  |&lt;==================|
         |                 |                  |                   |
         |                 |      +-----------------------+       |
         |                 |      | Fetch PRID (key=PURR) |       |
         |                 |      +-----------------------+       |
         |                 |                  |                   |
         |                 |Push Request (PRID)                   |
         |                 |&lt;-----------------|                   |
         |Push Message (PRID)                 |                   |
         |&lt;----------------|                  |                   |
         |                 |                  |                   |
         | SIP REGISTER (PRID)                |                   |
         |===================================&gt;|                   |
         |                 |                  |SIP REGISTER (PRID)|
         |                 |                  |==================&gt;|
         |                 |                  |                   |
         |                 |                  | SIP 200 OK        |
         |                 |                  |&lt;==================|
         | SIP 200 OK (PURR)                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |
         | SIP UPDATE      |                  |                   |
         |&lt;===================================|                   |
         |                 |                  |                   |

         ------- Push Notification API

         ======= SIP

                 Figure 4: SIP Push Long-Lived Dialog Flow








<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 24]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-25"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20SIP%20UA%20Behavior"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  SIP UA Behavior</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.1.%20%20Initial%20Request%20for%20Dialog"></a><a class="selflink" href="#section-6.1.1" id="section-6.1.1">6.1.1</a>.  Initial Request for Dialog</span>

   If the UA is willing to receive push notifications when a proxy
   receives a mid-dialog request addressed towards the UA, the UA MUST
   insert a 'pn-purr' SIP URI parameter (<a href="#section-6.2.1">Section 6.2.1</a>) in the Contact
   header field URI of the initial request for a dialog or the 2xx
   response to such requests.  The UA MUST insert a parameter value
   identical to the last 'sip.pnspurr' feature-capability indicator
   (<a href="#section-6.2.1">Section 6.2.1</a>) that it received in a REGISTER response.  If the UA
   has not received a 'sip.pnspurr' feature-capability indicator, the UA
   MUST NOT insert a 'pn-purr' SIP URI parameter in a request or
   response.

   The UA makes the decision to receive push notifications triggered by
   incoming mid-dialog requests based on local policy.  Such policy
   might be based on the type of SIP dialog, the type of media (if any)
   negotiated for the dialog [<a href="./rfc3264" title='"An Offer/Answer Model with Session Description Protocol (SDP)"'>RFC3264</a>], etc.

   NOTE: As the 'pn-purr' SIP URI parameter only applies to a given
   dialog, the UA needs to insert a 'pn-purr' parameter in the Contact
   header field URI of the request or response for each dialog in which
   the UA is willing to receive push notifications triggered by incoming
   mid-dialog requests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20SIP%20Proxy%20Behavior"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  SIP Proxy Behavior</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.1.%20%20REGISTER"></a><a class="selflink" href="#section-6.2.1" id="section-6.2.1">6.2.1</a>.  REGISTER</span>

   If the proxy supports requesting push notifications triggered by mid-
   dialog requests being sent to the registered UA, the proxy MUST store
   the information (the 'pn-*' SIP URI parameters) needed to request
   that push notifications are sent to the UA when a proxy receives an
   initial REGISTER request for a binding from the UA.  In addition, the
   proxy MUST generate a unique (within the context of the proxy) value,
   referred to as the PURR (Proxy Unique Registration Reference), that
   can be used as a key to retrieve the information.

   In order to prevent client fingerprinting, the proxy MUST
   periodically generate a new PURR value (even if 'pn-*'parameters did
   not change).  However, as long as there are ongoing dialogs
   associated with the old value, the proxy MUST store it so that it can
   request that push notifications are sent to the UA when it receives a
   mid-dialog request addressed towards the UA.  In addition, the PURR
   value MUST be generated in such a way so that it is unforgeable,
   anonymous, and unlinkable to entities other than the proxy.  It must
   not be possible for an attacker to generate a valid PURR, to



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 25]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-26"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   associate a PURR with a specific user, or to determine when two PURRs
   correspond to the same user.  It can be generated, e.g., by utilizing
   a cryptographically secure random function with an appropriately
   large output size.

   Whenever the proxy receives a 2xx response to a REGISTER request, the
   proxy MUST insert a 'sip.pnspurr' feature-capability indicator with
   the latest PURR value (see above) in the response.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.2.%20%20Initial%20Request%20for%20Dialog"></a><a class="selflink" href="#section-6.2.2" id="section-6.2.2">6.2.2</a>.  Initial Request for Dialog</span>

   When a proxy receives an initial request for a dialog from a UA that
   contains a 'pn-purr' SIP URI parameter in the Contact header field
   URI with a PURR value that the proxy has generated (<a href="#section-6.2.1">Section 6.2.1</a>),
   the proxy MUST add a Record-Route header to the request to insert
   itself in the dialog route [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] before forwarding the request.

   When the proxy receives an initial request for a dialog addressed
   towards the UA, and the proxy has generated a PURR value associated
   with the 'pn-*' parameters inserted in the SIP URI of the request
   (<a href="#section-6.2.2">Section 6.2.2</a>), the proxy MUST add a Record-Route header to the
   request to insert itself in the dialog route [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] before
   forwarding the request.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.3.%20%20Mid-dialog%20Request"></a><a class="selflink" href="#section-6.2.3" id="section-6.2.3">6.2.3</a>.  Mid-dialog Request</span>

   When the proxy receives a mid-dialog SIP request addressed towards
   the UA that contains a 'pn-purr' SIP URI parameter, and the proxy is
   able to retrieve the stored information needed to request that a push
   notification be sent to the UA (<a href="#section-6.2.1">Section 6.2.1</a>), the proxy MUST place
   the SIP request in the SIP Request Push Bucket and request that a
   push notification be sent to the UA.

   NOTE: The 'pn-purr' SIP URI parameter will either be carried in the
   Request-URI or in a Route header field [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] of the SIP request
   depending on how the route set [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] of the mid-dialog SIP
   request has been constructed.

   When the proxy receives a 2xx response to a REGISTER request, the
   proxy checks whether the SIP Request Push Bucket contains a mid-
   dialog SIP request associated with the REGISTER transaction.  If the
   bucket contains such a request, the proxy MUST remove the SIP request
   from the SIP Request Push Bucket and forward it towards the UA.

   Note that the proxy does not perform a URI comparison (<a href="#section-5.3">Section 5.3</a>)
   when processing mid-dialog requests, as a mid-dialog request will not
   contain the 'pn-prid', 'pn-provider', and 'pn-param' SIP URI




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 26]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-27"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   parameters.  The proxy only checks for a mid-dialog request that
   contains the PURR value associated with the REGISTER 2xx response.

   As described in <a href="#section-5.6.2">Section 5.6.2</a>, while waiting for the push
   notification request to succeed, and then for the associated REGISTER
   request and 2xx response, the proxy needs to take into consideration
   that the transaction associated with the mid-dialog request will
   eventually time out at the sender of the request (User Agent Client),
   and the sender will consider the transaction a failure.

   When a proxy sends an error response to a mid-dialog request (e.g.,
   due to a transaction time out), the proxy SHOULD select a response
   code that only impacts the transaction associated with the request
   [<a href="./rfc5079" title='"Rejecting Anonymous Requests in the Session Initiation Protocol (SIP)"'>RFC5079</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Support%20of%20SIP%20Replaces"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Support of SIP Replaces</span>

   [<a id="ref-RFC3891">RFC3891</a>] defines a mechanism that allows a SIP UA to replace a
   dialog with another dialog.  A UA that wants to replace a dialog with
   another one will send an initial request for the new dialog.  The
   Request-URI of the request will contain the Contact header field URI
   of the peer.

   If a SIP proxy wants to be able to request that a push notification
   be sent to a UA when it receives an initial request for a dialog that
   replaces an existing dialog, using the mechanism in [<a href="./rfc3891" title='"The Session Initiation Protocol (SIP) "'>RFC3891</a>], the
   proxy and the UA MUST perform the following actions:

   o  The proxy MUST provide a PURR to the UA during registration
      (<a href="#section-6.2.1">Section 6.2.1</a>).

   o  The UA MUST insert a 'pn-purr' SIP URI parameter in the Contact
      header field URI of either the initial request for a dialog or a
      2xx response to such requests (<a href="#section-6.1.1">Section 6.1.1</a>).  This includes
      dialogs replacing other dialogs, as those dialogs might also get
      replaced.

   o  The proxy MUST apply the mechanism defined in <a href="#section-6.2.3">Section 6.2.3</a> to
      place and retrieve the request from the SIP Request Push Bucket.

   In addition, the operator needs to make sure that the initial request
   for dialogs, addressed towards the UA using the contact of the
   replaced dialog, will be routed to the SIP proxy (in order to request
   that a push notification be sent to the UA).  The procedures for
   doing that are operator-specific and are outside the scope of this
   specification.





<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 27]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-28"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Grammar"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Grammar</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20555%20%28Push%20Notification%20Service%20Not%20Supported%29%20Response%20Code"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  555 (Push Notification Service Not Supported) Response Code</span>

   The 555 response code is added to the "Server-Error" Status-Code
   definition. 555 (Push Notification Service Not Supported) is used to
   indicate that the server does not support the push notification
   service identified in a 'pn-provider' SIP URI parameter.

   The use of the SIP 555 response code is only defined for SIP REGISTER
   responses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20%27sip.pns%27%20Feature-Capability%20Indicator"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  'sip.pns' Feature-Capability Indicator</span>

   The sip.pns feature-capability indicator, when inserted in a Feature-
   Caps header field of a SIP REGISTER request or a SIP 2xx response to
   a REGISTER request, indicates that the entity associated with the
   indicator supports the SIP push mechanism and the type of push
   notification service indicated by the indicator value.  The values
   defined for the 'pn-provider' SIP URI parameter are used as indicator
   values.

     pns-fc          = "+sip.pns" EQUAL LDQUOT pns RDQUOT
     pns             = tag-value

     tag-value = &lt;tag-value defined in [<a href="./rfc3840" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>RFC3840</a>]&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.%20%20%27sip.vapid%27%20Feature-Capability%20Indicator"></a><a class="selflink" href="#section-8.3" id="section-8.3">8.3</a>.  'sip.vapid' Feature-Capability Indicator</span>

   The sip.vapid feature-capability indicator, when inserted in a SIP
   2xx response to a SIP REGISTER request, denotes that the entity
   associated with the indicator supports the Voluntary Application
   Server Identification (VAPID) [<a href="./rfc8292" title='"Voluntary Application Server Identification (VAPID) for Web Push"'>RFC8292</a>] mechanism when the entity
   requests that a push notification be sent to a SIP UA.  The indicator
   value is a public key identifying the entity that can be used by a
   SIP UA to restrict subscriptions to that entity.

     vapid-fc          = "+sip.vapid" EQUAL LDQUOT vapid RDQUOT
     vapid             = tag-value

     tag-value = &lt;tag-value defined in [<a href="./rfc3840" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>RFC3840</a>]&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.4.%20%20%27sip.pnsreg%27%20Feature-Capability%20Indicator"></a><a class="selflink" href="#section-8.4" id="section-8.4">8.4</a>.  'sip.pnsreg' Feature-Capability Indicator</span>

   The sip.pnsreg feature-capability indicator, when inserted in a SIP
   2xx response to a SIP REGISTER request, denotes that the entity
   associated with the indicator expects to receive binding-refresh
   REGISTER requests from the SIP UA associated with the binding before



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 28]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-29"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   the binding expires, even if the entity does not request that a push
   notification be sent to the SIP UA in order to trigger the binding-
   refresh REGISTER requests.  The indicator value conveys the minimum
   time (given in seconds) prior to the binding expiration when the UA
   MUST send the REGISTER request.

     pns-fc          = "+sip.pnsreg" EQUAL LDQUOT reg RDQUOT
     reg             = 1*DIGIT

     DIGIT = &lt;DIGIT defined in [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.5.%20%20%27sip.pnsreg%27%20Media%20Feature%20Tag"></a><a class="selflink" href="#section-8.5" id="section-8.5">8.5</a>.  'sip.pnsreg' Media Feature Tag</span>

   The sip.pnsreg media feature tag, when inserted in the Contact header
   field of a SIP REGISTER request, indicates that the SIP UA associated
   with the tag is able to send binding-refresh REGISTER requests for
   the associated binding without being awakened by push notifications.
   The media feature tag has no values.

     pnsreg-mt          = "+sip.pnsreg"

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.6.%20%20%27sip.pnspurr%27%20Feature-Capability%20Indicator"></a><a class="selflink" href="#section-8.6" id="section-8.6">8.6</a>.  'sip.pnspurr' Feature-Capability Indicator</span>

   The sip.pnspurr feature-capability indicator, when inserted in a SIP
   2xx response to a SIP REGISTER request, denotes that the entity
   associated with the indicator will store information that can be used
   to associate a mid-dialog SIP request with the binding information in
   the REGISTER request.

     pnspurr-fc        = "+sip.pnspurr" EQUAL LDQUOT pnspurr RDQUOT
     pnspurr           = tag-value

     tag-value = &lt;tag-value defined in [<a href="./rfc3840" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>RFC3840</a>]&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.7.%20%20SIP%20URI%20Parameters"></a><a class="selflink" href="#section-8.7" id="section-8.7">8.7</a>.  SIP URI Parameters</span>

   This section defines new SIP URI parameters by extending the grammar
   for "uri-parameter" as defined in [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].  The ABNF [<a href="./rfc5234" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] is
   as follows:

     uri-parameter   =/ pn-provider / pn-param / pn-prid / pn-purr
     pn-provider     = "pn-provider" [EQUAL pvalue]
     pn-param        = "pn-param" EQUAL pvalue
     pn-prid         = "pn-prid" EQUAL pvalue
     pn-purr         = "pn-purr" EQUAL pvalue

     pvalue = &lt;pvalue defined in [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]&gt;
     EQUAL = &lt;EQUAL defined in [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]&gt;



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 29]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-30"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   The format and semantics of pn-prid and pn-param are specific to the
   pn-provider value.

   Parameter value characters that are not part of pvalue need to be
   escaped, as defined in <a href="./rfc3261">RFC 3261</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20PNS%20Registration%20Requirements"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  PNS Registration Requirements</span>

   When a new value is registered to the PNS subregistry, a reference to
   a specification that describes the usage of the PNS associated with
   the value is provided.  That specification MUST contain the following
   information:

   o  The value of the 'pn-provider' SIP URI parameter.

   o  How the 'pn-prid' SIP URI parameter value is retrieved and set by
      the SIP UA.

   o  How the 'pn-param' SIP URI parameter (if required for the specific
      PNS provider) value is retrieved and set by the SIP UA.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20%27pn-provider%27%2C%20%27pn-param%27%2C%20and%20%27pn-prid%27%20URI%20Parameters%20for%20Apple"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for Apple</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Push%20Notification%20service"></a>     Push Notification service</span>

   When the Apple Push Notification service (APNs) is used, the
   PNS-related SIP URI parameters are set as described below.

   For detailed information about the parameter values, see
   &lt;<a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">https://developer.apple.com/library/archive/documentation/</a>
   <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">NetworkingInternet/Conceptual/RemoteNotificationsPG/</a>
   <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">CommunicatingwithAPNs.html</a>&gt; [<a href="#ref-pns-apns" title='"Local and Remote Notification Programming Guide: Communicating with APNs"'>pns-apns</a>].

   The value of the 'pn-provider' URI parameter is "apns".

   Example: pn-provider=apns

   The value of the 'pn-param' URI parameter is a string that is
   composed of two values separated by a period (.): Team ID and Topic.
   The Team ID is provided by Apple and is unique to a development team.
   The Topic consists of the Bundle ID, which uniquely identifies an
   application, and a service value that identifies a service associated
   with the application, separated by a period (.).  For Voice over IP
   (VoIP) applications, the service value is "voip".

   Example: pn-param=DEF123GHIJ.com.example.yourexampleapp.voip






<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 30]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-31"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   NOTE: The Bundle ID might contain one or more periods (.).  Hence,
   within the 'pn-param' value, the first period will be separating the
   Team ID from the Topic, and within the Topic, the last period will be
   separating the Bundle ID from the service.

   The value of the 'pn-prid' URI parameter is the device token, which
   is a unique identifier assigned by Apple to a specific app on a
   specific device.

   Example: pn-prid=00fc13adff78512

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20%27pn-provider%27%2C%20%27pn-param%27%2C%20and%20%27pn-prid%27%20URI%20Parameters%20for%20Google"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for Google</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Firebase%20Cloud%20Messaging%20%28FCM%29%20Push%20Notification%20Service"></a>     Firebase Cloud Messaging (FCM) Push Notification Service</span>

   When Firebase Cloud Messaging (FCM) is used, the PNS-related URI
   parameters are set as described below.

   For detailed information about the parameter values, see
   &lt;<a href="https://firebase.google.com/docs/cloud-messaging/concept-options">https://firebase.google.com/docs/cloud-messaging/concept-options</a>&gt;
   [<a href="#ref-pns-fcm" title='"Firebase Cloud Messaging"'>pns-fcm</a>].

   The value of the 'pn-provider' URI parameter is "fcm".

   The value of the 'pn-param' URI parameter is the Project ID.

   The value of the 'pn-prid' URI parameter is the Registration token,
   which is generated by the FCM SDK for each client app instance.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20%27pn-provider%27%2C%20%27pn-param%27%2C%20and%20%27pn-prid%27%20URI%20Parameters%20for%20RFC"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  'pn-provider', 'pn-param', and 'pn-prid' URI Parameters for <a href="./rfc8030">RFC</a></span>
     <a href="./rfc8030">8030</a> (Generic Event Delivery Using HTTP Push)

   When Generic Event Delivery Using HTTP Push is used, the PNS-related
   URI parameters are set as described below.

   The value of the 'pn-provider' URI parameter is "webpush".

   The value of the 'pn-param' URI parameter MUST NOT be used.

   The value of the 'pn-prid' URI parameter is the push subscription
   URI.

   See <a href="./rfc8030">RFC 8030</a> [<a href="./rfc8030" title='"Generic Event Delivery Using HTTP Push"'>RFC8030</a>] for more details.

   Note that encryption for web push [<a href="./rfc8291" title='"Message Encryption for Web Push"'>RFC8291</a>] is not used; therefore,
   parameters for message encryption are not defined in this
   specification.  Web push permits the sending of a push message
   without a payload without encryption.




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 31]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-32"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Security%20Considerations"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Security Considerations</span>

   The security considerations for the use and operation of any
   particular PNS (e.g., how users and devices are authenticated and
   authorized) are out of scope for this document.  [<a href="./rfc8030" title='"Generic Event Delivery Using HTTP Push"'>RFC8030</a>] documents
   the security considerations for the PNS defined in that
   specification.  Security considerations for other PNSs are left to
   their respective specifications.

   Typically, the PNS requires the SIP proxy requesting push
   notifications to be authenticated and authorized by the PNS.  In some
   cases, the PNS also requires the SIP application (or the SIP
   application developer) to be identified in order for the application
   to request push notifications.  Unless the PNS authenticates and
   authorizes the PNS, a malicious endpoint or network entity that
   managed to get access to the parameters transported in the SIP
   signaling might be able to request that push notifications are sent
   to a UA.  Such push notifications will impact the battery life of the
   UA and trigger unnecessary SIP traffic.

   [<a id="ref-RFC8292">RFC8292</a>] defines a mechanism that allows a proxy to identify itself
   to a PNS by signing a JSON Web Token (JWT) sent to the PNS using a
   key pair.  The public key serves as an identifier of the proxy and
   can be used by devices to restrict push notifications to the proxy
   associated with the key.

   Operators MUST ensure that the SIP signaling is properly secured,
   e.g., using encryption, from malicious network entities.  TLS MUST be
   used unless the operators know that the signaling is secured using
   some other mechanism that provides strong crypto properties.

   In addition to the information that needs to be exchanged between a
   device and the PNS in order to establish a push notification
   subscription, the mechanism defined in this document does not require
   any additional information to be exchanged between the device and the
   PNS.

   The mechanism defined in this document does not require a proxy to
   insert any payload (in addition to possible payload used for the PNS
   itself) when requesting push notifications.

   Operators MUST ensure that the PNS-related SIP URI parameters
   conveyed by a user in the Contact URI of a REGISTER request are not
   sent to other users or to non-trusted network entities.  One way to
   convey contact information is by using the SIP event package for
   registrations mechanism [<a href="./rfc3680" title='"A Session Initiation Protocol (SIP) Event Package for Registrations"'>RFC3680</a>].  [<a href="./rfc3680" title='"A Session Initiation Protocol (SIP) Event Package for Registrations"'>RFC3680</a>] defines generic
   security considerations for the SIP event package for registrations.
   As the PNS-related SIP URI parameters conveyed in the REGISTER



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 32]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-33"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   request contain sensitive information, operators that support the
   event package MUST ensure that event package subscriptions are
   properly authenticated and authorized, and that the SIP URI
   parameters are not inserted in event notifications sent to other
   users or to non-trusted network entities.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-14" id="section-14">14</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.%20%20SIP%20URI%20Parameters"></a><a class="selflink" href="#section-14.1" id="section-14.1">14.1</a>.  SIP URI Parameters</span>

   This section defines new SIP URI Parameters that extend the "SIP/SIPS
   URI Parameters" subregistry [<a href="./rfc3969" title='"The Internet Assigned Number Authority (IANA) Uniform Resource Identifier (URI) Parameter Registry for the Session Initiation Protocol (SIP)"'>RFC3969</a>] under the SIP Parameters
   registry (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.1.%20%20pn-provider"></a><a class="selflink" href="#section-14.1.1" id="section-14.1.1">14.1.1</a>.  pn-provider</span>

     Parameter Name: pn-provider

     Predefined Values:  No

     Reference:  <a href="./rfc8599">RFC 8599</a>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.2.%20%20pn-param"></a><a class="selflink" href="#section-14.1.2" id="section-14.1.2">14.1.2</a>.  pn-param</span>

     Parameter Name: pn-param

     Predefined Values:  No

     Reference:  <a href="./rfc8599">RFC 8599</a>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.3.%20%20pn-prid"></a><a class="selflink" href="#section-14.1.3" id="section-14.1.3">14.1.3</a>.  pn-prid</span>

     Parameter Name: pn-prid

     Predefined Values:  No

     Reference:  <a href="./rfc8599">RFC 8599</a>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.4.%20%20pn-purr"></a><a class="selflink" href="#section-14.1.4" id="section-14.1.4">14.1.4</a>.  pn-purr</span>

     Parameter Name: pn-purr

     Predefined Values:  No

     Reference:  <a href="./rfc8599">RFC 8599</a>






<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 33]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-34"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.2.%20%20SIP%20Response%20Codes"></a><a class="selflink" href="#section-14.2" id="section-14.2">14.2</a>.  SIP Response Codes</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.2.1.%20%20555%20%28Push%20Notification%20Service%20Not%20Supported%29"></a><a class="selflink" href="#section-14.2.1" id="section-14.2.1">14.2.1</a>.  555 (Push Notification Service Not Supported)</span>

   This section defines a new SIP response code that extends the
   "Response Codes" subregistry [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] under the SIP Parameters
   registry (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

      Response Code Number:   555

      Default Reason Phrase:  Push Notification Service Not Supported

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.3.%20%20SIP%20Global%20Feature-Capability%20Indicator"></a><a class="selflink" href="#section-14.3" id="section-14.3">14.3</a>.  SIP Global Feature-Capability Indicator</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.3.1.%20%20sip.pns"></a><a class="selflink" href="#section-14.3.1" id="section-14.3.1">14.3.1</a>.  sip.pns</span>

   This section defines a new feature-capability indicator that extends
   the "SIP Feature-Capability Indicator Registration Tree" subregistry
   [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] under the SIP Parameters registry
   (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

    Name: sip.pns

    Description: This feature-capability indicator, when inserted in a
        Feature-Caps header field of a SIP REGISTER request or a SIP 2xx
        response to a REGISTER request, denotes that the entity
        associated with the indicator supports the SIP push mechanism
        and the type of push notification service conveyed by the
        indicator value.

    Reference: <a href="./rfc8599">RFC 8599</a>

    Contact: IESG (iesg@ietf.org)

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.3.2.%20%20sip.vapid"></a><a class="selflink" href="#section-14.3.2" id="section-14.3.2">14.3.2</a>.  sip.vapid</span>

   This section defines a new feature-capability indicator that extends
   the "SIP Feature-Capability Indicator Registration Tree" subregistry
   [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] under the SIP Parameters registry
   (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

     Name: sip.vapid

     Description: This feature-capability indicator, when inserted in a
          SIP 2xx response to a SIP REGISTER request, denotes that the
          entity associated with the indicator supports the Voluntary
          Application Server Identification (VAPID) mechanism when the
          entity requests that a push notification be sent to a SIP UA.



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 34]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-35"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


          The indicator value is a public key identifying the entity,
          which can be used by a SIP UA to restrict subscriptions to
          that entity.

     Reference: <a href="./rfc8599">RFC 8599</a>

     Contact: IESG (iesg@ietf.org)

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.3.3.%20%20sip.pnsreg"></a><a class="selflink" href="#section-14.3.3" id="section-14.3.3">14.3.3</a>.  sip.pnsreg</span>

   This section defines a new feature-capability indicator that extends
   the "SIP Feature-Capability Indicator Registration Tree" subregistry
   [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] under the SIP Parameters registry
   (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

    Name: sip.pnsreg

    Description: This feature-capability indicator, when inserted in a
         SIP 2xx response to a SIP REGISTER request, denotes that the
         entity associated with the indicator expects to receive
         binding-refresh REGISTER requests for the binding from the SIP
         UA associated with the binding before the binding expires, even
         if the entity does not request that a push notification be sent
         to the SIP UA in order to trigger the binding-refresh REGISTER
         requests.  The indicator value conveys the minimum time
         (given in seconds) prior to the binding expiration when the UA
         MUST send the REGISTER request.

    Reference: <a href="./rfc8599">RFC 8599</a>

    Contact: IESG (iesg@ietf.org)

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.3.4.%20%20sip.pnspurr"></a><a class="selflink" href="#section-14.3.4" id="section-14.3.4">14.3.4</a>.  sip.pnspurr</span>

   This section defines a new feature-capability indicator that extends
   the "SIP Feature-Capability Indicator Registration Tree" subregistry
   [<a href="./rfc6809" title='"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)"'>RFC6809</a>] under the SIP Parameters registry
   (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/sip-parameters</a>).

    Name: sip.pnspurr

    Description: This feature-capability indicator, when inserted in a
         SIP 2xx response to a SIP REGISTER request, conveys that
         the entity associated with the indicator will store information
         that can be used to associate a mid-dialog SIP request with the
         binding information in the REGISTER request.  The indicator
         value is an identifier that can be used as a key to retrieve
         the binding information.



<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 35]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-36"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


    Reference: <a href="./rfc8599">RFC 8599</a>

    Contact: IESG (iesg@ietf.org)

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.4.%20%20SIP%20Media%20Feature%20Tag"></a><a class="selflink" href="#section-14.4" id="section-14.4">14.4</a>.  SIP Media Feature Tag</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.4.1.%20%20sip.pnsreg"></a><a class="selflink" href="#section-14.4.1" id="section-14.4.1">14.4.1</a>.  sip.pnsreg</span>

   This section defines a new media feature tag that extends the "SIP
   Media Feature Tag Registration Tree" subregistry [<a href="./rfc3840" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>RFC3840</a>] under the
   "Media Feature Tags" registry (<a href="https://www.iana.org/assignments/media-feature-tags">https://www.iana.org/assignments/</a>
   <a href="https://www.iana.org/assignments/media-feature-tags">media-feature-tags</a>).

     Media feature tag name: sip.pnsreg

     Summary of the media feature indicated by this feature tag: This
          media feature tag, when inserted in the Contact header field
          of a SIP REGISTER request, conveys that the SIP UA
          associated with the tag is able to send binding-refresh
          REGISTER requests associated with the registration without
          being awakened by push notifications.

     Values appropriate for use with this feature tag: none

     Related standards or documents: <a href="./rfc8599">RFC 8599</a>

     Security considerations: This media feature tag does not introduce
        new security considerations, as it simply indicates support for
        a basic SIP feature.  If an attacker manages to remove the media
        feature tag, push notifications will not be requested to be sent
        to the client.

     Contact: IESG (iesg@ietf.org)


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.5.%20%20PNS%20Subregistry%20Establishment"></a><a class="selflink" href="#section-14.5" id="section-14.5">14.5</a>.  PNS Subregistry Establishment</span>

   This section creates a new subregistry, "PNS", under the SIP
   Parameters registry (<a href="https://www.iana.org/assignments/sip-parameters">https://www.iana.org/assignments/</a>
   <a href="https://www.iana.org/assignments/sip-parameters">sip-parameters</a>).

   The purpose of the subregistry is to register SIP URI 'pn-provider'
   values.

   When a SIP URI 'pn-provider' value is registered in the subregistry,
   it needs to meet the "Specification Required" policies defined in
   [<a href="./rfc8126" title="">RFC8126</a>].




<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 36]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-37"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   This subregistry is defined as a table that contains the following
   three columns:

     Value:        The token under registration

     Description:  The name of the Push Notification Service (PNS)

     Document:     A reference to the document defining the registration

   This specification registers the following values:

     Value         Description                             Document
     -------       --------------------------------------  ----------

     apns          Apple Push Notification service         <a href="./rfc8599">RFC 8599</a>
     fcm           Firebase Cloud Messaging                <a href="./rfc8599">RFC 8599</a>
     webpush       Generic Event Delivery Using HTTP Push  <a href="./rfc8599">RFC 8599</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.%20%20References"></a><a class="selflink" href="#section-15" id="section-15">15</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.1.%20%20Normative%20References"></a><a class="selflink" href="#section-15.1" id="section-15.1">15.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="./rfc3261">RFC 3261</a>,
              DOI 10.17487/RFC3261, June 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3261">https://www.rfc-editor.org/info/rfc3261</a>&gt;.

   [<a id="ref-RFC3840">RFC3840</a>]  Rosenberg, J., Schulzrinne, H., and P. Kyzivat,
              "Indicating User Agent Capabilities in the Session
              Initiation Protocol (SIP)", <a href="./rfc3840">RFC 3840</a>,
              DOI 10.17487/RFC3840, August 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3840">https://www.rfc-editor.org/info/rfc3840</a>&gt;.

   [<a id="ref-RFC3891">RFC3891</a>]  Mahy, R., Biggs, B., and R. Dean, "The Session Initiation
              Protocol (SIP) "Replaces" Header", <a href="./rfc3891">RFC 3891</a>,
              DOI 10.17487/RFC3891, September 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3891">https://www.rfc-editor.org/info/rfc3891</a>&gt;.








<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 37]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-38"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


   [<a id="ref-RFC3969">RFC3969</a>]  Camarillo, G., "The Internet Assigned Number Authority
              (IANA) Uniform Resource Identifier (URI) Parameter
              Registry for the Session Initiation Protocol (SIP)",
              <a href="https://www.rfc-editor.org/bcp/bcp99">BCP 99</a>, <a href="./rfc3969">RFC 3969</a>, DOI 10.17487/RFC3969, December 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3969">https://www.rfc-editor.org/info/rfc3969</a>&gt;.

   [<a id="ref-RFC5079">RFC5079</a>]  Rosenberg, J., "Rejecting Anonymous Requests in the
              Session Initiation Protocol (SIP)", <a href="./rfc5079">RFC 5079</a>,
              DOI 10.17487/RFC5079, December 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5079">https://www.rfc-editor.org/info/rfc5079</a>&gt;.

   [<a id="ref-RFC5234">RFC5234</a>]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, <a href="./rfc5234">RFC 5234</a>,
              DOI 10.17487/RFC5234, January 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.

   [<a id="ref-RFC6809">RFC6809</a>]  Holmberg, C., Sedlacek, I., and H. Kaplan, "Mechanism to
              Indicate Support of Features and Capabilities in the
              Session Initiation Protocol (SIP)", <a href="./rfc6809">RFC 6809</a>,
              DOI 10.17487/RFC6809, November 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6809">https://www.rfc-editor.org/info/rfc6809</a>&gt;.

   [<a id="ref-RFC8030">RFC8030</a>]  Thomson, M., Damaggio, E., and B. Raymor, Ed., "Generic
              Event Delivery Using HTTP Push", <a href="./rfc8030">RFC 8030</a>,
              DOI 10.17487/RFC8030, December 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8030">https://www.rfc-editor.org/info/rfc8030</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="./rfc2119">RFC</a>
              <a href="./rfc2119">2119</a> Key Words", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8292">RFC8292</a>]  Thomson, M. and P. Beverloo, "Voluntary Application Server
              Identification (VAPID) for Web Push", <a href="./rfc8292">RFC 8292</a>,
              DOI 10.17487/RFC8292, November 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8292">https://www.rfc-editor.org/info/rfc8292</a>&gt;.

   [<a id="ref-pns-apns">pns-apns</a>] Apple Inc., "Local and Remote Notification Programming
              Guide: Communicating with APNs", &lt;<a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">https://developer.apple.</a>
              <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">com/library/archive/documentation/NetworkingInternet/Conce</a>
              <a href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingwithAPNs.html">ptual/RemoteNotificationsPG/CommunicatingwithAPNs.html</a>&gt;.

   [<a id="ref-pns-fcm">pns-fcm</a>]  Google Inc., "Firebase Cloud Messaging",
              &lt;<a href="https://firebase.google.com/docs/cloud-messaging/concept-options">https://firebase.google.com/docs/cloud-messaging/</a>
              <a href="https://firebase.google.com/docs/cloud-messaging/concept-options">concept-options</a>&gt;.







<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 38]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-39"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/15.2.%20%20Informative%20References"></a><a class="selflink" href="#section-15.2" id="section-15.2">15.2</a>.  Informative References</span>

   [<a id="ref-RFC3264">RFC3264</a>]  Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model
              with Session Description Protocol (SDP)", <a href="./rfc3264">RFC 3264</a>,
              DOI 10.17487/RFC3264, June 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3264">https://www.rfc-editor.org/info/rfc3264</a>&gt;.

   [<a id="ref-RFC3680">RFC3680</a>]  Rosenberg, J., "A Session Initiation Protocol (SIP) Event
              Package for Registrations", <a href="./rfc3680">RFC 3680</a>,
              DOI 10.17487/RFC3680, March 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3680">https://www.rfc-editor.org/info/rfc3680</a>&gt;.

   [<a id="ref-RFC4320">RFC4320</a>]  Sparks, R., "Actions Addressing Identified Issues with the
              Session Initiation Protocol's (SIP) Non-INVITE
              Transaction", <a href="./rfc4320">RFC 4320</a>, DOI 10.17487/RFC4320, January
              2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4320">https://www.rfc-editor.org/info/rfc4320</a>&gt;.

   [<a id="ref-RFC4321">RFC4321</a>]  Sparks, R., "Problems Identified Associated with the
              Session Initiation Protocol's (SIP) Non-INVITE
              Transaction", <a href="./rfc4321">RFC 4321</a>, DOI 10.17487/RFC4321, January
              2006, &lt;<a href="https://www.rfc-editor.org/info/rfc4321">https://www.rfc-editor.org/info/rfc4321</a>&gt;.

   [<a id="ref-RFC5626">RFC5626</a>]  Jennings, C., Ed., Mahy, R., Ed., and F. Audet, Ed.,
              "Managing Client-Initiated Connections in the Session
              Initiation Protocol (SIP)", <a href="./rfc5626">RFC 5626</a>,
              DOI 10.17487/RFC5626, October 2009,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5626">https://www.rfc-editor.org/info/rfc5626</a>&gt;.

   [<a id="ref-RFC6665">RFC6665</a>]  Roach, A., "SIP-Specific Event Notification", <a href="./rfc6665">RFC 6665</a>,
              DOI 10.17487/RFC6665, July 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6665">https://www.rfc-editor.org/info/rfc6665</a>&gt;.

   [<a id="ref-RFC8126">RFC8126</a>]  Cotton, M., Leiba, B., and T. Narten, "Guidelines for
              Writing an IANA Considerations Section in RFCs", <a href="https://www.rfc-editor.org/bcp/bcp26">BCP 26</a>,
              <a href="./rfc8126">RFC 8126</a>, DOI 10.17487/RFC8126, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;.

   [<a id="ref-RFC8291">RFC8291</a>]  Thomson, M., "Message Encryption for Web Push", <a href="./rfc8291">RFC 8291</a>,
              DOI 10.17487/RFC8291, November 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8291">https://www.rfc-editor.org/info/rfc8291</a>&gt;.











<span class="grey">Holmberg &amp; Arnold            Standards Track                   [Page 39]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-40"></span>
<span class="grey"><a href="./rfc8599">RFC 8599</a>                        SIP PUSH                        May 2019</span>


Acknowledgements

   Thanks to Paul Kyzivat, Dale Worley, Ranjit Avasarala, Martin
   Thomson, Mikael Klein, Susanna Sjoholm, Kari-Pekka Perttula, Liviu
   Chircu, Roman Shpount, Yehoshua Gev, and Jean Mahoney for reading the
   text and providing useful feedback.

Authors' Addresses

   Christer Holmberg
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   Email: christer.holmberg@ericsson.com


   Michael Arnold
   Metaswitch Networks
   100 Church Street
   Enfield  EN2 6BQ
   United Kingdom

   Email: Michael.Arnold@metaswitch.com


























Holmberg &amp; Arnold            Standards Track                   [Page 40]
</pre>
</body></html>