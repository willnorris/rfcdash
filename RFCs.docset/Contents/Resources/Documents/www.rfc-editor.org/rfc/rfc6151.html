<html><head></head><body><pre>Internet Engineering Task Force (IETF)                         S. Turner
Request for Comments: 6151                                          IECA
Updates: <a href="./rfc1321">1321</a>, <a href="./rfc2104">2104</a>                                              L. Chen
Category: Informational                                             NIST
ISSN: 2070-1721                                               March 2011


                  <span class="h1">Updated Security Considerations for</span>
           <span class="h1">the MD5 Message-Digest and the HMAC-MD5 Algorithms</span>

Abstract

   This document updates the security considerations for the MD5 message
   digest algorithm.  It also updates the security considerations for
   HMAC-MD5.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="./rfc5741#section-2">SectionÂ 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6151">http://www.rfc-editor.org/info/rfc6151</a>.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





<span class="grey">Turner &amp; Chen                 Informational                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   MD5 [<a href="#ref-MD5" title='"The MD5 Message-Digest Algorithm"'>MD5</a>] is a message digest algorithm that takes as input a message
   of arbitrary length and produces as output a 128-bit "fingerprint" or
   "message digest" of the input.  The published attacks against MD5
   show that it is not prudent to use MD5 when collision resistance is
   required.  This document replaces the security considerations in <a href="./rfc1321">RFC</a>
   <a href="./rfc1321">1321</a> [<a href="#ref-MD5" title='"The MD5 Message-Digest Algorithm"'>MD5</a>].

   [<a id="ref-HMAC">HMAC</a>] defined a mechanism for message authentication using
   cryptographic hash functions.  Any message digest algorithm can be
   used, but the cryptographic strength of HMAC depends on the
   properties of the underlying hash function.  [<a href="#ref-HMAC-MD5" title='"Test Cases for HMAC-MD5 and HMAC-SHA-1"'>HMAC-MD5</a>] defined test
   cases for HMAC-MD5.  This document updates the security
   considerations in [<a href="#ref-HMAC" title='"HMAC: Keyed-Hashing for Message Authentication"'>HMAC</a>], which [<a href="#ref-HMAC-MD5" title='"Test Cases for HMAC-MD5 and HMAC-SHA-1"'>HMAC-MD5</a>] points to for its security
   considerations.

   [<a id="ref-HASH-Attack">HASH-Attack</a>] summarizes the use of hashes in many protocols and
   discusses how attacks against a message digest algorithm's one-way
   and collision-free properties affect and do not affect Internet
   protocols.  Familiarity with [<a href="#ref-HASH-Attack" title='"Attacks on Cryptographic Hashes in Internet Protocols"'>HASH-Attack</a>] is assumed.  One of the
   uses of message digest algorithms in [<a href="#ref-HASH-Attack" title='"Attacks on Cryptographic Hashes in Internet Protocols"'>HASH-Attack</a>] was integrity
   protection.  Where the MD5 checksum is used inline with the protocol
   solely to protect against errors, an MD5 checksum is still an
   acceptable use.  Applications and protocols need to clearly state in
   their security considerations what security services, if any, are
   expected from the MD5 checksum.  In fact, any application and
   protocol that employs MD5 for any purpose needs to clearly state the
   expected security services from their use of MD5.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Security%20Considerations"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Security Considerations</span>

   MD5 was published in 1992 as an Informational RFC.  Since that time,
   MD5 has been extensively studied and new cryptographic attacks have
   been discovered.  Message digest algorithms are designed to provide
   collision, pre-image, and second pre-image resistance.  In addition,
   message digest algorithms are used with a shared secret value for
   message authentication in HMAC, and in this context, some people may
   find the guidance for key lengths and algorithm strengths in
   [<a href="#ref-SP800-57" title=" Special Publication 800-57: Recommendation for Key Management - Part 1 (Revised)">SP800-57</a>] and [<a href="#ref-SP800-131" title=" Special Publication 800-131: DRAFT Recommendation for the Transitioning of Cryptographic Algorithms and Key Sizes">SP800-131</a>] useful.

   MD5 is no longer acceptable where collision resistance is required
   such as digital signatures.  It is not urgent to stop using MD5 in
   other ways, such as HMAC-MD5; however, since MD5 must not be used for
   digital signatures, new protocol designs should not employ HMAC-MD5.
   Alternatives to HMAC-MD5 include HMAC-SHA256 [<a href="#ref-HMAC" title='"HMAC: Keyed-Hashing for Message Authentication"'>HMAC</a>] [<a href="#ref-HMAC-SHA256" title='"Identifiers and Test Vectors for HMAC- SHA-224, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512"'>HMAC-SHA256</a>] and
   [<a href="#ref-AES-CMAC" title='"The AES-CMAC Algorithm"'>AES-CMAC</a>] when AES is more readily available than a hash function.




<span class="grey">Turner &amp; Chen                 Informational                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20Collision%20Resistance"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Collision Resistance</span>

   Pseudo-collisions for the compress function of MD5 were first
   described in 1993 [<a href="#ref-denBBO1993" title='"Collisions for the compression function of MD5"'>denBBO1993</a>].  In 1996, [<a href="#ref-DOB1995" title='"Cryptanalysis of MD5 Compress"'>DOB1995</a>] demonstrated a
   collision pair for the MD5 compression function with a chosen initial
   value.  The first paper that demonstrated two collision pairs for MD5
   was published in 2004 [<a href="#ref-WFLY2004" title="H. Yu">WFLY2004</a>].  The detailed attack techniques for
   MD5 were published at EUROCRYPT 2005 [<a href="#ref-WAYU2005" title="Springer">WAYU2005</a>].  Since then, a lot
   of research results have been published to improve collision attacks
   on MD5. The attacks presented in [<a href="#ref-KLIM2006" title="Report 2006/105 (2006)">KLIM2006</a>] can find MD5 collision in
   about one minute on a standard notebook PC (Intel Pentium, 1.6GHz).
   [<a href="#ref-STEV2007" title='"On Collisions for MD5"'>STEV2007</a>] claims that it takes 10 seconds or less on a 2.6Ghz
   Pentium4 to find collisions.  In [<a href="#ref-STEV2007" title='"On Collisions for MD5"'>STEV2007</a>], [<a href="#ref-SLdeW2007" title="B.">SLdeW2007</a>],
   [<a href="#ref-SSALMOdeW2009">SSALMOdeW2009</a>], and [<a href="#ref-SLdeW2009" title='"Chosen-prefix Collisions for MD5 and Applications"'>SLdeW2009</a>], the collision attacks on MD5 were
   successfully applied to X.509 certificates.

   Notice that the collision attack on MD5 can also be applied to
   password-based challenge-and-response authentication protocols such
   as the APOP (Authenticated Post Office Protocol) option in POP [<a href="#ref-POP" title='"Post Office Protocol - Version 3"'>POP</a>]
   used in post office authentication as presented in [<a href="#ref-LEUR2007" title="Message freedom in MD4 and MD5 collisions: Application to APOP. Proceedings of FSE 2007. Lecture Notes in Computer Science 4715. Springer">LEUR2007</a>].

   In fact, more delicate attacks on MD5 to improve the speed of finding
   collisions have been published recently.  However, the aforementioned
   results have provided sufficient reason to eliminate MD5 usage in
   applications where collision resistance is required such as digital
   signatures.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.%20%20Pre-Image%20and%20Second%20Pre-Image%20Resistance"></a><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Pre-Image and Second Pre-Image Resistance</span>

   Even though the best result can find a pre-image attack of MD5 faster
   than exhaustive search, as presented in [<a href="#ref-SAAO2009" title="Springer">SAAO2009</a>], the complexity
   2^123.4 is still pretty high.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.3.%20%20HMAC"></a><a class="selflink" href="#section-2.3" id="section-2.3">2.3</a>.  HMAC</span>

   The cryptanalysis of HMAC-MD5 is usually conducted together with NMAC
   (Nested MAC) since they are closely related.  NMAC uses two
   independent keys K1 and K2 such that NMAC(K1, K2, M) = H(K1, H(K2,
   M), where K1 and K2 are used as secret initialization vectors (IVs)
   for hash function H(IV, M).  If we re-write the HMAC equation using
   two secret IVs such that IV2 = H(K Xor ipad) and IV1 = H(K Xor opad),
   then HMAC(K, M) = NMAC(IV1, IV2, M).  Here it is very important to
   notice that IV1 and IV2 are not independently selected.

   The first analysis was explored on NMAC-MD5 using related keys in
   [<a href="#ref-COYI2006" title="Springer">COYI2006</a>].  The partial key recovery attack cannot be extended to
   HMAC-MD5, since for HMAC, recovering partial secret IVs can hardly
   lead to recovering (partial) key K.  Another paper presented at



<span class="grey">Turner &amp; Chen                 Informational                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


   Crypto 2007 [<a href="#ref-FLN2007" title="Nguyen">FLN2007</a>] extended results of [<a href="#ref-COYI2006" title="Springer">COYI2006</a>] to a full key
   recovery attack on NMAC-MD5.  Since it also uses related key attack,
   it does not seem applicable to HMAC-MD5.

   A EUROCRYPT 2009 paper presented a distinguishing attack on HMAC-MD5
   [<a href="#ref-WYWZZ2009" title="H. Zhang">WYWZZ2009</a>] without using related keys.  It can distinguish an
   instantiation of HMAC with MD5 from an instantiation with a random
   function with 2^97 queries with probability 0.87.  This is called
   distinguishing-H.  Using the distinguishing attack, it can recover
   some bits of the intermediate status of the second block.  However,
   as it is pointed out in [<a href="#ref-WYWZZ2009" title="H. Zhang">WYWZZ2009</a>], it cannot be used to recover the
   (partial) inner key H(K Xor ipad).  It is not obvious how the attack
   can be used to form a forgery attack either.

   The attacks on HMAC-MD5 do not seem to indicate a practical
   vulnerability when used as a message authentication code.
   Considering that the distinguishing-H attack is different from a
   distinguishing-R attack, which distinguishes an HMAC from a random
   function, the practical impact on HMAC usage as a pseudorandom
   function (PRF) such as in a key derivation function is not well
   understood.

   Therefore, it may not be urgent to remove HMAC-MD5 from the existing
   protocols.  However, since MD5 must not be used for digital
   signatures, for a new protocol design, a ciphersuite with HMAC-MD5
   should not be included.  Options include HMAC-SHA256 [<a href="#ref-HMAC" title='"HMAC: Keyed-Hashing for Message Authentication"'>HMAC</a>]
   [<a href="#ref-HMAC-SHA256" title='"Identifiers and Test Vectors for HMAC- SHA-224, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512"'>HMAC-SHA256</a>] and [<a href="#ref-AES-CMAC" title='"The AES-CMAC Algorithm"'>AES-CMAC</a>] when AES is more readily available than
   a hash function.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Acknowledgements"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Acknowledgements</span>

   Obviously, we have to thank all the cryptographers who produced the
   results we refer to in this document.  We'd also like to thank Wesley
   Eddy, Sam Hartman,  Alfred Hoenes, Martin Rex, Benne de Weger, and
   Lloyd Wood for their comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Informative%20References"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Informative References</span>

   [<a id="ref-AES-CMAC">AES-CMAC</a>]    Song, JH., Poovendran, R., Lee, J., and T. Iwata, "The
                 AES-CMAC Algorithm", <a href="./rfc4493">RFC 4493</a>, June 2006.

   [<a id="ref-COYI2006">COYI2006</a>]    S. Contini, Y.L. Yin. Forgery and partial key-recovery
                 attacks on HMAC and NMAC using hash collisions.
                 ASIACRYPT 2006.  LNCS 4284, Springer, 2006.

   [<a id="ref-denBBO1993">denBBO1993</a>]  den Boer, B. and A. Bosselaers, "Collisions for the
                 compression function of MD5", Eurocrypt 1993.




<span class="grey">Turner &amp; Chen                 Informational                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


   [<a id="ref-DOB1995">DOB1995</a>]     Dobbertin, H., "Cryptanalysis of MD5 Compress",
                 Eurocrypt 1996.

   [<a id="ref-FLN2007">FLN2007</a>]     Fouque, P.-A., Leurent, G., Nguyen, P.Q.: Full key-
                 recovery attacks on HMAC/NMAC-MD4 and NMAC-MD5.  CRYPTO
                 2007.  LNCS 4622, Springer, 2007.

   [<a id="ref-HASH-Attack">HASH-Attack</a>] Hoffman, P. and B. Schneier, "Attacks on Cryptographic
                 Hashes in Internet Protocols", <a href="./rfc4270">RFC 4270</a>, November 2005.

   [<a id="ref-HMAC">HMAC</a>]        Krawczyk, H., Bellare, M., and R. Canetti, "HMAC:
                 Keyed-Hashing for Message Authentication", <a href="./rfc2104">RFC 2104</a>,
                 February 1997.

   [<a id="ref-HMAC-MD5">HMAC-MD5</a>]    Cheng, P. and R. Glenn, "Test Cases for HMAC-MD5 and
                 HMAC-SHA-1", <a href="./rfc2202">RFC 2202</a>, September 1997.

   [<a id="ref-HMAC-SHA256">HMAC-SHA256</a>] Nystrom, M., "Identifiers and Test Vectors for HMAC-
                 SHA-224, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512",
                 <a href="./rfc4231">RFC 4231</a>, December 2005.

   [<a id="ref-KLIM2006">KLIM2006</a>]    V. Klima.  Tunnels in Hash Functions: MD5 Collisions
                 within a Minute.  Cryptology ePrint Archive, Report
                 2006/105 (2006), <a href="http://eprint.iacr.org/2006/105">http://eprint.iacr.org/2006/105</a>.

   [<a id="ref-LEUR2007">LEUR2007</a>]    G. Leurent, Message freedom in MD4 and MD5 collisions:
                 Application to APOP.  Proceedings of FSE 2007.  Lecture
                 Notes in Computer Science 4715.  Springer, 2007.

   [<a id="ref-MD5">MD5</a>]         Rivest, R., "The MD5 Message-Digest Algorithm", <a href="./rfc1321">RFC</a>
                 <a href="./rfc1321">1321</a>, April 1992.

   [<a id="ref-POP">POP</a>]         Myers, J. and M. Rose, "Post Office Protocol - Version
                 3", STD 53, <a href="./rfc1939">RFC 1939</a>, May 1996.

   [<a id="ref-SAAO2009">SAAO2009</a>]    Y. Sasaki and K. Aoki.  Finding preimages in full MD5
                 faster than exhaustive search.  Advances in Cryptology
                 - EUROCRYPT 2009, LNCS 5479 of Lecture Notes in
                 Computer Science, Springer, 2009.

   [<a id="ref-SLdeW2007">SLdeW2007</a>]   Stevens, M., Lenstra, A., de Weger, B., Chosen-prefix
                 Collisions for MD5 and Colliding X.509 Certificates for
                 Different Identities.  EuroCrypt 2007.

   [<a id="ref-SLdeW2009">SLdeW2009</a>]   Stevens, M., Lenstra, A., de Weger, B., "Chosen-prefix
                 Collisions for MD5 and Applications", Journal of
                 Cryptology, 2009.




<span class="grey">Turner &amp; Chen                 Informational                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


   [<a id="ref-SSALMOdeW2009">SSALMOdeW2009</a>]
                 Stevens, M., Sotirov, A., Appelbaum, J., Lenstra, A.,
                 Molnar, D., Osvik, D., and B. de Weger.  Short chosen-
                 prefix collisions for MD5 and the creation of a rogue
                 CA certificate, Crypto 2009.

   [<a id="ref-SP800-57">SP800-57</a>]    National Institute of Standards and Technology (NIST),
                 Special Publication 800-57: Recommendation for Key
                 Management - Part 1 (Revised), March 2007.

   [<a id="ref-SP800-131">SP800-131</a>]   National Institute of Standards and Technology (NIST),
                 Special Publication 800-131: DRAFT Recommendation for
                 the Transitioning of Cryptographic Algorithms and Key
                 Sizes, June 2010.

   [<a id="ref-STEV2007">STEV2007</a>]    Stevens, M., "On Collisions for MD5", Master's Thesis,
                 Eindhoven University of Technology,
                 <a href="http://www.win.tue.nl/hashclash/On%20Collisions%20for%20MD5%20-%20M.M.J.%20Stevens.pdf">http://www.win.tue.nl/hashclash/</a>
                 <a href="http://www.win.tue.nl/hashclash/On%20Collisions%20for%20MD5%20-%20M.M.J.%20Stevens.pdf">On%20Collisions%20for%20MD5%20-%20M.M.J.%20Stevens.pdf</a>.

   [<a id="ref-WAYU2005">WAYU2005</a>]    X. Wang and H. Yu. How to Break MD5 and other Hash
                 Functions.  LNCS 3494.  Advances in Cryptology -
                 EUROCRYPT2005, Springer, 2005.

   [<a id="ref-WFLY2004">WFLY2004</a>]    X. Wang, D. Feng, X. Lai, H. Yu, Collisions for Hash
                 Functions MD4, MD5, HAVAL-128 and RIPEMD, 2004,
                 <a href="http://eprint.iacr.org/2004/199.pdf">http://eprint.iacr.org/2004/199.pdf</a>

   [<a id="ref-WYWZZ2009">WYWZZ2009</a>]   X. Wang, H. Yu, W. Wang, H. Zhang, and T. Zhan.
                 Cryptanalysis of HMAC/NMAC-MD5 and MD5-MAC.  LNCS 5479.
                 Advances in Cryptology - EUROCRYPT2009, Springer, 2009.




















<span class="grey">Turner &amp; Chen                 Informational                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc6151">RFC 6151</a>        MD5 and HMAC-MD5 Security Considerations      March 2011</span>


Authors' Addresses

   Sean Turner
   IECA, Inc.
   3057 Nutley Street, Suite 106
   Fairfax, VA 22031
   USA

   EMail: turners@ieca.com


   Lily Chen
   National Institute of Standards and Technology
   100 Bureau Drive, Mail Stop 8930
   Gaithersburg, MD 20899-8930
   USA

   EMail: lily.chen@nist.gov

































Turner &amp; Chen                 Informational                     [Page 7]
</pre>
</body></html>