<html><head></head><body><pre>Internet Engineering Task Force (IETF)                         M. Mohali
Request for Comments: 8498                                        Orange
Updates: <a href="./rfc5502">5502</a>                                              February 2019
Category: Informational
ISSN: 2070-1721


             <span class="h1">A P-Served-User Header Field Parameter for an</span>
         <span class="h1">Originating Call Diversion (CDIV) Session Case in the</span>
                   <span class="h1">Session Initiation Protocol (SIP)</span>

Abstract

   The P-Served-User header field was defined based on a requirement
   from the 3rd Generation Partnership Project (3GPP) IMS (IP Multimedia
   Subsystem) in order to convey the identity of the served user, his/
   her registration state, and the session case that applies to that
   particular communication session and application invocation.  A
   session case is metadata that captures the status of the session of a
   served user regardless of whether or not the served user is
   registered or the session originates or terminates with the served
   user.  This document updates <a href="./rfc5502">RFC 5502</a> by defining a new P-Served-User
   header field parameter, "orig-cdiv".  The parameter conveys the
   session case used by a proxy when handling an originating session
   after Call Diversion (CDIV) services have been invoked for the served
   user.  This document also fixes the ABNF in <a href="./rfc5502">RFC 5502</a> and provides
   more guidance for using the P-Served-User header field in IP
   networks.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are candidates for any level of Internet
   Standard; see <a href="./rfc7841#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8498">https://www.rfc-editor.org/info/rfc8498</a>.







<span class="grey">Mohali                        Informational                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

























<span class="grey">Mohali                        Informational                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  General . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.2">1.2</a>.  Basic Use Case  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.3">1.3</a>.  Problem Statement . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-2">2</a>.  Conventions and Terminology . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Applicability . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Proxy Behavior and Parameter Handling . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-5">5</a>.  Clarification of <a href="./rfc5502">RFC 5502</a> Procedures  . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-6">6</a>.  Syntax  . . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-6.1">6.1</a>.  General . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-6.2">6.2</a>.  ABNF  . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-7">7</a>.  Call Flow Examples  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-7.1">7.1</a>.  Call Diversion Case . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-7.2">7.2</a>.  Call Diversion and Privacy  . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-8">8</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-9">9</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-10">10</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-10.1">10.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-10.2">10.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20General"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  General</span>

   The P-Served-User header field [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] was defined based on a
   requirement from the 3rd Generation Partnership Project (3GPP) IMS
   (IP Multimedia Subsystem) in order to convey the identity of the
   served user, his/her registration state, and the session case between
   a Serving Call Session Control Function (S-CSCF) and an Application
   Server (AS) on the IMS Service Control (ISC) interface.  A session
   case is metadata that captures the status of the session of a served
   user regardless of whether or not the served user is registered or
   the session originates or terminates with the served user.  For more
   information on session cases and the IMS, a detailed description can
   be found in [<a href="#ref-TS.3GPP.24.229">TS.3GPP.24.229</a>].

   [<a id="ref-RFC5502">RFC5502</a>] defines the originating and terminating session cases for a
   registered or unregistered user.  This document extends the P-Served-
   User header field to include the session case for a forwarded leg
   when both a CDIV service has been invoked and an originating service
   of the diverting user has to be triggered.






<span class="grey">Mohali                        Informational                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


   The sessioncase-param parameter of the P-Served-User header field is
   extended with the "orig-cdiv" parameter for this originating-after-
   CDIV session case.

   The following section defines usage of the "orig-cdiv" parameter of
   the P-Served-User header field, <a href="#section-3">Section 3</a> discusses the applicability
   and scope of this new header field parameter, and <a href="#section-4">Section 4</a> specifies
   the proxy behavior for handling the new header field parameter.
   <a href="#section-5">Section 5</a> clarifies some of the [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] procedures, <a href="#section-6">Section 6</a>
   describes the extended syntax and corrects the syntax of <a href="./rfc5502#section-7">[RFC5502],
   Section 7</a> gives some call flow examples, <a href="#section-8">Section 8</a> registers the
   P-Served-User header field parameters with IANA, and <a href="#section-9">Section 9</a>
   discusses the security properties of the environment where this new
   header field parameter is intended to be used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.2.%20%20Basic%20Use%20Case"></a><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Basic Use Case</span>

   In the 3GPP IMS (IP Multimedia Subsystem), the S-CSCF (Serving CSCF)
   is a SIP proxy that serves as a registrar and handles originating and
   terminating session states for users assigned to it.  This means that
   any call that is originated by a specific user or any call that is
   terminated to that specific user will pass through the S-CSCF that is
   assigned to that user.

   At the moment that an S-CSCF is assigned to a specific user, the user
   profile is downloaded from the Home Subscriber Server (HSS) to that
   S-CSCF; see [<a href="#ref-TS.3GPP.29.228">TS.3GPP.29.228</a>].  The user profile contains the list of
   actions to be taken by the S-CSCF for the served user depending on
   the session direction (originating or terminating) and the user state
   (registered or not) in the IMS network.  With this user profile, the
   S-CSCF determines the current case and applies the corresponding
   actions such as forwarding the request to an AS.  The AS then goes
   through a similar process of determining who is the current served
   user, what is his/her "registration state", and what is the "session
   case" of the session.  [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] defines all those parameters and in
   particular the originating and terminating session cases.

   In basic call scenarios, there is no particular issue for the S-CSCF
   and AS to know which scenario needs to be realized, but in case of
   CDIV services for which the session is re-targeted, the session cases
   defined in [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] pose some limitations as described in the
   following section.









<span class="grey">Mohali                        Informational                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.3.%20%20Problem%20Statement"></a><a class="selflink" href="#section-1.3" id="section-1.3">1.3</a>.  Problem Statement</span>

   To illustrate the problem statement, let's imagine Alice trying to
   call Bob and Bob having a CDIV service activated towards Carol's
   address.  In the case of a CDIV service, the received request is
   first treated as a terminating session case (at Bob's side), and the
   terminating filter criteria configured in the S-CSCF is performed.  A
   filter criteria is information in the user profile that determines
   whether an initial request is sent to a particular AS.  When the AS
   receives the call initiation request, the AS is able to determine the
   served user (Bob) and the session case (here "term") from the
   received P-Served-User header field content and is able to execute
   terminating services.  When the CDIV service is executed (as a
   terminating service of Bob), the AS changes the target (Request-URI)
   of the session (toward Carol's address) and a new call leg is
   created.  The served user becomes the diverting user.  This new call
   leg could be considered as an originating call leg from the diverting
   user (Bob), but this is not the case.  Indeed, the originating user
   remains the same (Alice), and some of the diverting user's
   originating services should not be triggered as if it was an
   originating call.  For instance, the originating user identity
   (Alice) should not be restricted because the diverting user (Bob) has
   a privacy service for his own identity.  The privacy of the diverting
   user should apply to information related to this user only (e.g., in
   the History-Info header field).  In the same manner, some specific
   services will need to be triggered on the outgoing leg after a CDIV.
   Without a dedicated session case for originating-after-CDIV, the
   S-CSCF cannot trigger an originating service for the diverting user,
   nor can an AS execute the procedures for this particular session
   case.

   For this use case, this document creates a new parameter
   ("orig-cdiv") for the originating-after-CDIV session case to be
   embedded in the P-Served-User header field.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Conventions%20and%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Conventions and Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in <a href="https://www.rfc-editor.org/bcp/bcp14">BCP</a>
   <a href="https://www.rfc-editor.org/bcp/bcp14">14</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="./rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.









<span class="grey">Mohali                        Informational                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Applicability"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Applicability</span>

   The use of the P-Served-User header field extensions is only
   applicable inside a Trust Domain [<a href="./rfc3324" title='"Short Term Requirements for Network Asserted Identity"'>RFC3324</a>] for the P-Served-User
   header field.  Nodes in such a Trust Domain explicitly trust each
   other to convey the served user and to be responsible for withholding
   that information outside of the Trust Domain.  The means by which the
   network determines the served user and the policies that are executed
   for a specific served user is outside the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Proxy%20Behavior%20and%20Parameter%20Handling"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Proxy Behavior and Parameter Handling</span>

   The following section illustrates how this header field parameter can
   be used in a 3GPP network.

   For a terminating call, the following steps will be followed:

   1.  The S-CSCF receives the initial INVITE request for a terminating
       call and determines that the session case is for a terminating
       user as described in [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>].

   2.  The S-CSCF determines who is the served user by looking at the
       Request-URI and saves the current Request-URI.

   3.  The S-CSCF analyzes the filter criteria.  It then sends the
       request to the AS of the served user as an INVITE that includes
       the P-Served-User header field with the "sescase" parameter set
       to "term" and the "regstate" set to the corresponding value in
       order to trigger execution of terminating services.

   4.  Based on some criteria, the AS concludes that the request has to
       be diverted to another target user or application.  The AS
       replaces the received Request-URI with the new diverted-to
       address and stores the successive Request-URI(s) values by adding
       one or two History-Info header field entry(ies) [<a href="./rfc7044" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC7044</a>] in the
       outgoing INVITE.  In the History-Info header field, the served
       user address is tagged by using the mp-param header field
       parameter added in the newly created entry that contains the
       diverted-to address.  The AS forwards the INVITE request back to
       the S-CSCF.

   5.  When receiving back the INVITE request, the S-CSCF can see that
       the topmost Route header field contains its own hostname, but the
       Request-URI does not match the saved Request-URI.  In this case,
       the S-CSCF updates the P-Served-User header field content by
       replacing the "sescase" parameter with the "orig-cdiv" parameter.
       The P-Served-User header field value remains unchanged.




<span class="grey">Mohali                        Informational                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


   6.  The S-CSCF forwards the INVITE request to an AS that hosts the
       served user's (diverting user's) originating services, which need
       to be executed on the forwarded leg after a CDIV service.

   7.  When the AS receives the INVITE request, it determines that the
       session case is for the "orig-cdiv" session case and performs the
       originating services to be executed after retargeting for the
       diverting user (i.e., served user).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Clarification%20of%20RFC%205502%20Procedures"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Clarification of <a href="./rfc5502">RFC 5502</a> Procedures</span>

   This document provides the following guidance for the handling of the
   P-Served-User header field that is missing in [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>]:

   o  The P-Served-User header field MUST NOT be repeated within a
      request for a particular session at a particular time for the
      reason that session cases are mutually exclusive.  This document
      updates [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] to clearly state that the P-Served-User header
      field MUST NOT contain multiple values either comma-separated or
      header-separated.  This document also updates the syntax of the
      header from [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] to reflect this uniqueness of parameter
      values.

   o  [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] does not clearly state what to do with the received
      P-Served-User header field when a call is diverted to another
      destination.  This document highlights that there are several ways
      of handling the P-Served-User header field: the S-CSCF could store
      the previous "regstate" value and decide that the same value
      applies, the "regstate" may no longer be relevant after a
      diverting service so the S-CSCF removes it, or the "regstate"
      could be combined with the "orig-cdiv" session case to provide
      different services depending on whether the served user is
      registered or unregistered.  These choices are implementation
      dependent.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Syntax"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Syntax</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20General"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  General</span>

   [<a id="ref-RFC5502">RFC5502</a>] defines the P-Served-User header field with the
   sessioncase-param parameter "sescase", which is specified as having
   "orig" and "term" as predefined values.  This document defines an
   additional parameter, "orig-cdiv", for the sessioncase-param.

   Because this document extends the existing sessioncase-param
   parameter, and because errors have been identified in the syntax,
   this document corrects and extends the P-Served-User header field.




<span class="grey">Mohali                        Informational                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


   The extension of the sessioncase-param parameter to add the
   "orig-cdiv" session case is done in a way that fits the parameter
   format introduced in Release 11 of the 3GPP [<a href="#ref-TS.3GPP.24.229">TS.3GPP.24.229</a>] and
   maintains backward compatibility.

   "EQUAL", "HCOLON", "SEMI", "name-addr", "addr-spec", and
   "generic-param" are defined in [<a href="./rfc3261" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

   If the "addr-spec" contains a comma, question mark, or semicolon, the
   "name-addr" form MUST be used.  The "name-addr" form requires the use
   of angle brackets (&lt; and &gt;).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20ABNF"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  ABNF</span>

   The Augmented Backus-Naur Form (ABNF) [<a href="./rfc5234" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] syntax of the
   P-Served-User header field is described in [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>].

   This document updates [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] to correct the P-Served-User header
   field ABNF syntax and extend it as the following:

   P-Served-User            = "P-Served-User" HCOLON PServedUser-value
                              *(SEMI served-user-param)
   served-user-param        = sessioncase-param
                              / registration-state-param
                              / generic-param
   PServedUser-value        = name-addr / addr-spec
   sessioncase-param        = "sescase" EQUAL ("orig"/"term")/ orig-cdiv
   registration-state-param = "regstate" EQUAL ("unreg" / "reg")
   orig-cdiv                = "orig-cdiv"

   Examples of possible P-Served-User header fields:

   P-Served-User: &lt;sip:user@example.com&gt;; orig-cdiv; regstate=reg
   or
   P-Served-User: &lt;sip:user@example.com&gt;; orig-cdiv
   or
   P-Served-User: &lt;sip:user@example.com&gt;; sescase=term; regstate=unreg

   This document allows choosing between "addr-spec" and "name-addr"
   when constructing the header field value.  As specified in <a href="./rfc8217">RFC 8217</a>,
   the "addr-spec" form MUST NOT be used if its value would contain a
   comma, semicolon, or question mark [<a href="./rfc8217" title='"Clarifications for When to Use the name-addr Production in SIP Messages"'>RFC8217</a>].









<span class="grey">Mohali                        Informational                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Call%20Flow%20Examples"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Call Flow Examples</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Call%20Diversion%20Case"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Call Diversion Case</span>

   The following call flow shows a session establishment when Alice
   calls Bob, who has a CDIV service that diverts to Carol when Bob is
   busy.

                  proxy           server            UA
Alice    Bob's...S-CSCF-B..........AS-B.............Bob            Carol
  |                |                |                |                |
  |   INVITE F1    |                |                |                |
  |---------------&gt;|   INVITE F2    |                |                |
  |                |---------------&gt;|                |                |
  |                |   INVITE F3    |                |                |
  |                |&lt;---------------|  INVITE F4     |                |
  |                |--------------------------------&gt;|                |
  |                |                486   F5         |                |
  |                |&lt;--------------------------------|                |
  |                |    486   F6    |                |                |
  |                |---------------&gt;|                |                |
  |                |   INVITE F7    |                |                |
  |                |&lt;---------------|                |                |
  |                |   INVITE F8    |                |                |
  |                |---------------&gt;|                |                |
  |                |   INVITE F9    |                |                |
  |                |&lt;---------------|      INVITE F10                 |
  |                |-------------------------------------------------&gt;|
  |                |                |                |                |
  |                |                |                |    180   F11   |
  |                |                |    180   F12   |&lt;---------------|
  |                |    180   F13   |&lt;---------------|                |
  |    180   F14   |&lt;---------------|                |                |
  |&lt;---------------|                |                |                |
  |                |                |                |                |

[Alice calls Bob]

   F1 INVITE Alice -&gt; S-CSCF-B
   INVITE sip:bob@example.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;

   F2 INVITE S-CSCF-B -&gt; AS-B
   INVITE sip:bob@example.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg



<span class="grey">Mohali                        Informational                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


   F3 INVITE AS-B -&gt; S-CSCF-B
   INVITE sip:bob@example.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg

   F4 INVITE S-CSCF-B -&gt; Bob
   INVITE sip:bob@192.0.2.4 SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg

[Bob is busy. His CDIV when busy is invoked towards Carol]

   F5-F6 486 BUSY Bob -&gt; S-CSCF-B  -&gt; AS-B
   486 BUSY
    From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;;tag=es43sd

[Alice's call is diverted to Carol]

   F7 INVITE AS-B -&gt; S-CSCF-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg

[The forwarded leg to Carol is identified as an originating call after
CDIV, which should not trigger all of Bob's originating services]

   F8 INVITE S-CSCF-B -&gt; AS-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; orig-cdiv; regstate=reg

   F9 INVITE AS-B -&gt; S-CSCF-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; orig-cdiv; regstate=reg

   F10 INVITE S-CSCF-B -&gt; Carol
   INVITE sip:carol@192.0.2.7 SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;

             Figure 1. P-Served-User During CDIV Service



<span class="grey">Mohali                        Informational                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.2.%20%20Call%20Diversion%20and%20Privacy"></a><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Call Diversion and Privacy</span>

   The following call flow shows a CDIV use case for which Alice has no
   identity restriction service and Bob has an unconditional CDIV
   service towards Carol and an identity presentation restriction
   service.

                  proxy           server            UA
Alice    Bob's...S-CSCF-B..........AS-B.............Bob            Carol
  |                |                |                |                |
  |   INVITE F1    |                |                |                |
  |---------------&gt;|   INVITE F2    |                |                |
  |                |---------------&gt;|                |                |
  |                |   INVITE F3    |                |                |
  |                |&lt;---------------|                |                |
  |                |   INVITE F4    |                |                |
  |                |---------------&gt;|                |                |
  |                |   INVITE F5    |                |                |
  |                |&lt;---------------|      INVITE F6 |                |
  |                |-------------------------------------------------&gt;|
  |                |                |                |                |
  |                |                |                |    180   F7    |
  |                |                |    180   F8    |&lt;---------------|
  |                |    180   F9    |&lt;---------------|                |
  |    180   F10   |&lt;---------------|                |                |
  |&lt;---------------|                |                |                |
  |                |                |                |                |

[Alice calls Bob]

   F1 INVITE Alice -&gt; S-CSCF-B
   INVITE sip:bob@example.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        Supported: histinfo

   F2 INVITE S-CSCF-B -&gt; AS-B
   INVITE sip:bob@example.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Bob &lt;sip:bob@example.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg










<span class="grey">Mohali                        Informational                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


[Bob's unconditional CDIV to Carol is triggered]

   F3 INVITE AS-B -&gt; S-CSCF-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Carol &lt;sip:carol@domainc.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; term; regstate=reg
        History-Info:
                &lt;sip:bob@example.com&gt;;index=1,
                &lt;sip:carol@domainc.com;cause=302&gt;;index=1.1;mp=1

[Alice's call is diverted to Carol]

   F4 INVITE S-CSCF-B -&gt; AS-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Carol &lt;sip:carol@domainc.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; orig-cdiv; regstate=reg
        History-Info:
                &lt;sip:bob@example.com&gt;;index=1,
                &lt;sip:carol@domainc.com;cause=302&gt;;index=1.1;mp=1

   F5 INVITE AS-B -&gt; S-CSCF-B
   INVITE sip:carol@domainc.com SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Carol &lt;sip:carol@domainc.com&gt;
        P-Served-User: &lt;sip:bob@example.com&gt;; orig-cdiv; regstate=reg
        History-Info:
                &lt;sip:bob@example.com?privacy=history&gt;;index=1,
                &lt;sip:carol@domainc.com;cause=302&gt;;index=1.1;mp=1

[Forwarded leg to Carol is identified as an originating call after
CDIV that allows Bob's privacy service to be applied to his
identity within the History-Info header field]

   F6 INVITE S-CSCF-B -&gt; Carol
   INVITE sip:carol@192.0.2.7 SIP/2.0
        From: Alice &lt;sip:alice@domaina.com&gt;;tag=1928301774
        To: Carol &lt;sip:carol@domainc.com&gt;
        History-Info:
                &lt;sip:bob@example.com?privacy=history&gt;;index=1,
                &lt;sip:carol@domainc.com;cause=302&gt;;index=1.1;mp=1
                &lt;sip:carol@192.0.2.7&gt;;index=1.1.1;rc=1.1

            Figure 2. P-Served-User When Privacy Requested






<span class="grey">Mohali                        Informational                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  IANA Considerations</span>

   The syntax of the P-Served-User header field [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] is updated in
   <a href="#section-4">Section 4</a> of this document.

   IANA has updated the existing row for the P-Served-User header field
   in the "Header Fields" subregistry within the "Session Initiation
   Protocol (SIP) Parameters" registry:

            Header Name        Compact Form          Reference
           -------------       ------------     ------------------
           P-Served-User          none          [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>][RFC8498]

   IANA has added new rows for the P-Served-User header field parameters
   in the "Header Field Parameters and Parameter Values" subregistry
   within the "Session Initiation Protocol (SIP) Parameters" registry
   (as per the registry created by [<a href="./rfc3968" title='"The Internet Assigned Number Authority (IANA) Header Field Parameter Registry for the Session Initiation Protocol (SIP)"'>RFC3968</a>]):

     Header Field   Parameter Name    Predefined Values    Reference
    --------------  ----------------  -----------------  -------------
    P-Served-User     sescase              Yes             [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>]
    P-Served-User     regstate             Yes             [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>]
    P-Served-User     orig-cdiv            No              [<a href="./rfc8498">RFC8498</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Security Considerations</span>

   The security considerations in [<a href="./rfc5502" title='"The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem"'>RFC5502</a>] apply.

   As the "orig-cdiv" parameter of the P-Served-User header field can be
   used to trigger applications when a call is diverted, it is important
   to ensure that the parameter has not been added to the SIP message by
   an unauthorized SIP entity.  Thus, the P-Served-User header field is
   to be used in a trusted environment, and proxies MUST NOT insert the
   header unless they have sufficient knowledge that the route set
   includes another trusted proxy.
















<span class="grey">Mohali                        Informational                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20References"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3324">RFC3324</a>]  Watson, M., "Short Term Requirements for Network Asserted
              Identity", <a href="./rfc3324">RFC 3324</a>, DOI 10.17487/RFC3324, November 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3324">https://www.rfc-editor.org/info/rfc3324</a>&gt;.

   [<a id="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and
              E. Schooler, "SIP: Session Initiation Protocol", <a href="./rfc3261">RFC 3261</a>,
              DOI 10.17487/RFC3261, June 2002,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3261">https://www.rfc-editor.org/info/rfc3261</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="./rfc2119">RFC</a>
              <a href="./rfc2119">2119</a> Key Words", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8217">RFC8217</a>]  Sparks, R., "Clarifications for When to Use the name-addr
              Production in SIP Messages", <a href="./rfc8217">RFC 8217</a>,
              DOI 10.17487/RFC8217, August 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8217">https://www.rfc-editor.org/info/rfc8217</a>&gt;.

   [<a id="ref-RFC3968">RFC3968</a>]  Camarillo, G., "The Internet Assigned Number Authority
              (IANA) Header Field Parameter Registry for the Session
              Initiation Protocol (SIP)", <a href="https://www.rfc-editor.org/bcp/bcp98">BCP 98</a>, <a href="./rfc3968">RFC 3968</a>,
              DOI 10.17487/RFC3968, December 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3968">https://www.rfc-editor.org/info/rfc3968</a>&gt;.

   [<a id="ref-RFC5234">RFC5234</a>]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, <a href="./rfc5234">RFC 5234</a>,
              DOI 10.17487/RFC5234, January 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;.

   [<a id="ref-RFC7044">RFC7044</a>]  Barnes, M., Audet, F., Schubert, S., van Elburg, J., and
              C. Holmberg, "An Extension to the Session Initiation
              Protocol (SIP) for Request History Information", <a href="./rfc7044">RFC 7044</a>,
              DOI 10.17487/RFC7044, February 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7044">https://www.rfc-editor.org/info/rfc7044</a>&gt;.







<span class="grey">Mohali                        Informational                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc8498">RFC 8498</a>         P-Served-User Parameter for CDIV in SIP   February 2019</span>


   [<a id="ref-RFC5502">RFC5502</a>]  van Elburg, J., "The SIP P-Served-User Private-Header
              (P-Header) for the 3GPP IP Multimedia (IM) Core Network
              (CN) Subsystem", <a href="./rfc5502">RFC 5502</a>, DOI 10.17487/RFC5502, April
              2009, &lt;<a href="https://www.rfc-editor.org/info/rfc5502">https://www.rfc-editor.org/info/rfc5502</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-TS.3GPP.24.229">TS.3GPP.24.229</a>]
              3GPP, "IP multimedia call control protocol based on
              Session Initiation Protocol (SIP) and Session Description
              Protocol (SDP);Stage 3", 3GPP TS 24.229 11.28.0, December
              2018.

   [<a id="ref-TS.3GPP.29.228">TS.3GPP.29.228</a>]
              3GPP, "IP Multimedia (IM) Subsystem Cx and Dx interfaces;
              Signalling flows and message contents", 3GPP TS 29.228
              15.1.0, September 2018.

Acknowledgments

   The author wishes to thank the 3GPP community for providing guidance,
   input, and comments on the document.  Thanks to Dale Worley, Jean
   Mahoney, and Ben Campbell for their careful review of the document.
   Thanks to Paul Kyzivat and Adam Roach.  A special thanks to Christer
   Holmberg.

Author's Address

   Marianne Mohali
   Orange
   Orange Gardens, 44 avenue de la Republique
   Chatillon  92326
   France

   Email: marianne.mohali@orange.com
















Mohali                        Informational                    [Page 15]
</pre>
</body></html>