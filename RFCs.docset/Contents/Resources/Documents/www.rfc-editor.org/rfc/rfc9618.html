<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9618: Updates to X.509 Policy Validation</title>
<meta content="David Benjamin" name="author"/>
<meta content="
       This document updates RFC 5280 to replace the algorithm for
    X.509 policy validation with an equivalent, more efficient algorithm. The
    original algorithm built a structure that scaled exponentially in the
    worst case, leaving implementations vulnerable to denial-of-service
    attacks. 
    " name="description"/>
<meta content="xml2rfc 3.23.0" name="generator"/>
<meta content="Certificate" name="keyword"/>
<meta content="9618" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.23.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    pydyf 0.10.0
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 62.3
-->
<link href="rfc9618.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-lamps-x509-policy-graph-05" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9618" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9618</td>
<td class="center">Updates to X.509 Policy Validation</td>
<td class="right">August 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Benjamin</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9618">9618</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc5280">5280</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-08">August 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Benjamin</div>
<div class="org">Google LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9618</h1>
<h1 id="title">Updates to X.509 Policy Validation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document updates RFC 5280 to replace the algorithm for
    X.509 policy validation with an equivalent, more efficient algorithm. The
    original algorithm built a structure that scaled exponentially in the
    worst case, leaving implementations vulnerable to denial-of-service
    attacks.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9618">https://www.rfc-editor.org/info/rfc9618</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.  <a class="internal xref" href="#name-summary-of-changes-from-rfc">Summary of Changes from RFC 5280</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-conventions-and-definitions">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-denial-of-service-vulnerabi">Denial-of-Service Vulnerability</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-policy-trees">Policy Trees</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-exponential-growth">Exponential Growth</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a class="auto internal xref" href="#section-3.3">3.3</a>.  <a class="internal xref" href="#name-attack-vector">Attack Vector</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-avoiding-exponential-growth">Avoiding Exponential Growth</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-policy-graphs">Policy Graphs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="auto internal xref" href="#section-4.2">4.2</a>.  <a class="internal xref" href="#name-verification-outputs">Verification Outputs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-updates-to-rfc-5280">Updates to RFC 5280</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-updates-to-section-61">Updates to Section 6.1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-updates-to-section-612">Updates to Section 6.1.2</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a class="auto internal xref" href="#section-5.3">5.3</a>.  <a class="internal xref" href="#name-updates-to-section-613">Updates to Section 6.1.3</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a class="auto internal xref" href="#section-5.4">5.4</a>.  <a class="internal xref" href="#name-updates-to-section-614">Updates to Section 6.1.4</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a class="auto internal xref" href="#section-5.5">5.5</a>.  <a class="internal xref" href="#name-updates-to-section-615">Updates to Section 6.1.5</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a class="auto internal xref" href="#section-5.6">5.6</a>.  <a class="internal xref" href="#name-updates-to-section-616">Updates to Section 6.1.6</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-other-mitigations">Other Mitigations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-verify-signatures-first">Verify Signatures First</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#section-6.2">6.2</a>.  <a class="internal xref" href="#name-limit-certificate-depth">Limit Certificate Depth</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a class="auto internal xref" href="#section-6.3">6.3</a>.  <a class="internal xref" href="#name-limit-policy-tree-size">Limit Policy Tree Size</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a class="auto internal xref" href="#section-6.4">6.4</a>.  <a class="internal xref" href="#name-inhibit-policy-mapping">Inhibit Policy Mapping</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a class="auto internal xref" href="#section-6.5">6.5</a>.  <a class="internal xref" href="#name-disable-policy-checking">Disable Policy Checking</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-address">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1"><span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> defines a suite of extensions for
      determining the policies that apply to a certification path. A policy
      is described by an object identifier (OID) and a set of optional
      qualifiers.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">Policy validation in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> is complex. As an
      overview, the certificate policies extension (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.4">Section 4.2.1.4</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>) describes the policies, with
      optional qualifiers, under which an individual certificate was issued.
      The policy mappings extension (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.5">Section 4.2.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>) allows a CA certificate to map
      its policy OIDs to other policy OIDs in certificates that it
      issues. Subject to these mappings and other extensions, the
      certification path's overall policy set is the intersection of policies
      asserted by each certificate in the path.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The procedure in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1">Section 6.1</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> determines this set in the course of certification
      path validation. It does so by building a policy tree containing
      policies asserted by each certificate and the mappings between
      them. This tree can grow exponentially in the depth of the certification
      path, which means an attacker, with a small input, can cause a path
      validator to consume excessive memory and computational resources. This
      cost asymmetry can lead to a denial-of-service vulnerability in
      X.509-based applications, such as <span>[<a class="cite xref" href="#CVE-2023-0464">CVE-2023-0464</a>]</span> and
      <span>[<a class="cite xref" href="#CVE-2023-23524">CVE-2023-23524</a>]</span>.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4"><a class="auto internal xref" href="#dos">Section 3</a> describes this vulnerability. <a class="auto internal xref" href="#policy-graph">Section 4.1</a> describes the primary mitigation for this
      vulnerability, a replacement for the policy tree structure.  <a class="auto internal xref" href="#updates">Section 5</a> provides updates to <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> that
      implement this change.  Finally, <a class="auto internal xref" href="#other-mitigations">Section 6</a>
      discusses alternative mitigation strategies for X.509 applications.<a class="pilcrow" href="#section-1-4">¶</a></p>
<div id="summary-of-changes-from-rfc-5280">
<section id="section-1.1">
        <h3 id="name-summary-of-changes-from-rfc">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-summary-of-changes-from-rfc">Summary of Changes from RFC 5280</a>
        </h3>
<p id="section-1.1-1">The algorithm for processing certificate policies and policy
        mappings is replaced with one that builds an equivalent but much more
        efficient structure.  This new algorithm does not change the validity
        status of any certification path or which certificate policies are
        valid for it.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-conventions-and-definitions">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
</section>
</div>
<div id="dos">
<section id="section-3">
      <h2 id="name-denial-of-service-vulnerabi">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-denial-of-service-vulnerabi">Denial-of-Service Vulnerability</a>
      </h2>
<p id="section-3-1">This section discusses how the path validation algorithm defined in
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.2">Section 6.1.2</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> can lead to a denial-of-service vulnerability in
X.509-based applications.<a class="pilcrow" href="#section-3-1">¶</a></p>
<div id="policy-trees">
<section id="section-3.1">
        <h3 id="name-policy-trees">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-policy-trees">Policy Trees</a>
        </h3>
<p id="section-3.1-1"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.2">Section 6.1.2</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>
        constructs the <code>valid_policy_tree</code>, a tree of certificate
        policies, during certification path validation.  The nodes at any
        given depth in the tree correspond to policies asserted by a
        certificate in the certification path.  A node's parent policy is the
        policy in the issuer certificate that was mapped to this policy, and a
        node's children are the policies the node was mapped to in the subject
        certificate.<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<p id="section-3.1-2">For example, suppose a certification path contains:<a class="pilcrow" href="#section-3.1-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.1">An intermediate certificate that asserts the following  policy OIDs: OID1, OID2,
          and OID5.  It contains mappings from OID1 to OID3 and from OID1 to OID4.<a class="pilcrow" href="#section-3.1-3.1">¶</a>
</li>
          <li class="normal" id="section-3.1-3.2">An end-entity certificate that asserts the following policy OIDs: OID2, OID3,
          and OID6.<a class="pilcrow" href="#section-3.1-3.2">¶</a>
</li>
        </ul>
<p id="section-3.1-4">This would result in the tree shown below.
        Note that OID5 and OID6 are not included or
        mapped across the whole path, so they do not appear in the final
        structure.<a class="pilcrow" href="#section-3.1-4">¶</a></p>
<div id="section-3.1-5">
          <div class="alignLeft art-svg artwork" id="section-3.1-5.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="336" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 424 336" width="424" xmlns="http://www.w3.org/2000/svg">
              <path d="M 152,160 L 152,224" fill="none" stroke="black"></path>
              <path d="M 152,288 L 152,320" fill="none" stroke="black"></path>
              <path d="M 200,232 L 200,280" fill="none" stroke="black"></path>
              <path d="M 232,32 L 232,96" fill="none" stroke="black"></path>
              <path d="M 256,160 L 256,224" fill="none" stroke="black"></path>
              <path d="M 256,288 L 256,320" fill="none" stroke="black"></path>
              <path d="M 312,160 L 312,224" fill="none" stroke="black"></path>
              <path d="M 312,288 L 312,320" fill="none" stroke="black"></path>
              <path d="M 328,32 L 328,96" fill="none" stroke="black"></path>
              <path d="M 360,232 L 360,280" fill="none" stroke="black"></path>
              <path d="M 416,160 L 416,224" fill="none" stroke="black"></path>
              <path d="M 416,288 L 416,320" fill="none" stroke="black"></path>
              <path d="M 232,32 L 328,32" fill="none" stroke="black"></path>
              <path d="M 232,64 L 328,64" fill="none" stroke="black"></path>
              <path d="M 232,96 L 328,96" fill="none" stroke="black"></path>
              <path d="M 152,160 L 256,160" fill="none" stroke="black"></path>
              <path d="M 312,160 L 416,160" fill="none" stroke="black"></path>
              <path d="M 152,192 L 256,192" fill="none" stroke="black"></path>
              <path d="M 312,192 L 416,192" fill="none" stroke="black"></path>
              <path d="M 152,224 L 256,224" fill="none" stroke="black"></path>
              <path d="M 312,224 L 416,224" fill="none" stroke="black"></path>
              <path d="M 152,288 L 256,288" fill="none" stroke="black"></path>
              <path d="M 312,288 L 416,288" fill="none" stroke="black"></path>
              <path d="M 152,320 L 256,320" fill="none" stroke="black"></path>
              <path d="M 312,320 L 416,320" fill="none" stroke="black"></path>
              <path d="M 324,104 L 348,152" fill="none" stroke="black"></path>
              <path d="M 220,152 L 244,104" fill="none" stroke="black"></path>
              <polygon class="arrowhead" fill="black" points="368,280 356,274.4 356,285.6" transform="rotate(90,360,280)"></polygon>
              <polygon class="arrowhead" fill="black" points="356,152 344,146.4 344,157.6" transform="rotate(63.43494882292201,348,152)"></polygon>
              <polygon class="arrowhead" fill="black" points="228,152 216,146.4 216,157.6" transform="rotate(116.56505117707799,220,152)"></polygon>
              <polygon class="arrowhead" fill="black" points="208,280 196,274.4 196,285.6" transform="rotate(90,200,280)"></polygon>
              <g class="text">
                <text x="112" y="52">Root:</text>
                <text x="280" y="52">anyPolicy</text>
                <text x="280" y="84">{anyPolicy}</text>
                <text x="80" y="180">Intermediate:</text>
                <text x="204" y="180">OID1</text>
                <text x="364" y="180">OID2</text>
                <text x="24" y="196">(OID5</text>
                <text x="92" y="196">discarded)</text>
                <text x="180" y="212">{OID3,</text>
                <text x="232" y="212">OID4}</text>
                <text x="364" y="212">{OID2}</text>
                <text x="88" y="308">End-entity:</text>
                <text x="204" y="308">OID3</text>
                <text x="364" y="308">OID2</text>
                <text x="24" y="324">(OID6</text>
                <text x="92" y="324">discarded)</text>
              </g>
            </svg><a class="pilcrow" href="#section-3.1-5.1">¶</a>
</div>
</div>
<p id="section-3.1-6">The complete algorithm for building this structure is described in
        steps (d), (e), and (f) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.3">Section 6.1.3</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>; steps (h), (i), and (j) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.4">Section 6.1.4</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>; and steps (a), (b), and (g) in
        <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.5">Section 6.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>.<a class="pilcrow" href="#section-3.1-6">¶</a></p>
</section>
</div>
<div id="exponential-growth">
<section id="section-3.2">
        <h3 id="name-exponential-growth">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-exponential-growth">Exponential Growth</a>
        </h3>
<p id="section-3.2-1">The <code>valid_policy_tree</code> grows exponentially in the worst
        case. In step (d.1) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.3">Section 6.1.3</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>, a single policy P can produce multiple child nodes
        if multiple issuer policies map to P. This can cause the tree size to
        increase in size multiplicatively at each level.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2">In particular, consider a certificate chain where every
        intermediate certificate asserts policies OID1 and OID2 and then
        contains the full Cartesian product of mappings:<a class="pilcrow" href="#section-3.2-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-3.1">
            <p id="section-3.2-3.1.1">OID1 maps to OID1<a class="pilcrow" href="#section-3.2-3.1.1">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.2">
            <p id="section-3.2-3.2.1">OID1 maps to OID2<a class="pilcrow" href="#section-3.2-3.2.1">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.3">
            <p id="section-3.2-3.3.1">OID2 maps to OID1<a class="pilcrow" href="#section-3.2-3.3.1">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.4">
            <p id="section-3.2-3.4.1">OID2 maps to OID2<a class="pilcrow" href="#section-3.2-3.4.1">¶</a></p>
</li>
        </ul>
<p id="section-3.2-4">At each depth, the tree would double in size.
For example, if there are two intermediate certificates and one end-entity certificate, the resulting tree would be as depicted in <a class="auto internal xref" href="#exponential-tree">Figure 1</a>.<a class="pilcrow" href="#section-3.2-4">¶</a></p>
<span id="name-an-example-x509-policy-tree"></span><div id="exponential-tree">
<figure id="figure-1">
          <div id="section-3.2-5.1">
            <div class="alignLeft art-svg artwork" id="section-3.2-5.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="448" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 576 448" width="576" xmlns="http://www.w3.org/2000/svg">
                <path d="M 8,400 L 8,432" fill="none" stroke="black"></path>
                <path d="M 24,288 L 24,352" fill="none" stroke="black"></path>
                <path d="M 40,360 L 40,392" fill="none" stroke="black"></path>
                <path d="M 64,400 L 64,432" fill="none" stroke="black"></path>
                <path d="M 80,400 L 80,432" fill="none" stroke="black"></path>
                <path d="M 104,160 L 104,224" fill="none" stroke="black"></path>
                <path d="M 104,360 L 104,392" fill="none" stroke="black"></path>
                <path d="M 128,288 L 128,352" fill="none" stroke="black"></path>
                <path d="M 136,400 L 136,432" fill="none" stroke="black"></path>
                <path d="M 152,400 L 152,432" fill="none" stroke="black"></path>
                <path d="M 168,288 L 168,352" fill="none" stroke="black"></path>
                <path d="M 184,360 L 184,392" fill="none" stroke="black"></path>
                <path d="M 200,32 L 200,96" fill="none" stroke="black"></path>
                <path d="M 208,160 L 208,224" fill="none" stroke="black"></path>
                <path d="M 208,400 L 208,432" fill="none" stroke="black"></path>
                <path d="M 224,400 L 224,432" fill="none" stroke="black"></path>
                <path d="M 248,360 L 248,392" fill="none" stroke="black"></path>
                <path d="M 272,288 L 272,352" fill="none" stroke="black"></path>
                <path d="M 280,400 L 280,432" fill="none" stroke="black"></path>
                <path d="M 296,400 L 296,432" fill="none" stroke="black"></path>
                <path d="M 312,288 L 312,352" fill="none" stroke="black"></path>
                <path d="M 328,360 L 328,392" fill="none" stroke="black"></path>
                <path d="M 352,400 L 352,432" fill="none" stroke="black"></path>
                <path d="M 368,400 L 368,432" fill="none" stroke="black"></path>
                <path d="M 392,32 L 392,96" fill="none" stroke="black"></path>
                <path d="M 392,160 L 392,224" fill="none" stroke="black"></path>
                <path d="M 392,360 L 392,392" fill="none" stroke="black"></path>
                <path d="M 416,288 L 416,352" fill="none" stroke="black"></path>
                <path d="M 424,400 L 424,432" fill="none" stroke="black"></path>
                <path d="M 440,400 L 440,432" fill="none" stroke="black"></path>
                <path d="M 456,288 L 456,352" fill="none" stroke="black"></path>
                <path d="M 472,360 L 472,392" fill="none" stroke="black"></path>
                <path d="M 496,160 L 496,224" fill="none" stroke="black"></path>
                <path d="M 496,400 L 496,432" fill="none" stroke="black"></path>
                <path d="M 512,400 L 512,432" fill="none" stroke="black"></path>
                <path d="M 536,360 L 536,392" fill="none" stroke="black"></path>
                <path d="M 560,288 L 560,352" fill="none" stroke="black"></path>
                <path d="M 568,400 L 568,432" fill="none" stroke="black"></path>
                <path d="M 200,32 L 392,32" fill="none" stroke="black"></path>
                <path d="M 200,64 L 392,64" fill="none" stroke="black"></path>
                <path d="M 200,96 L 392,96" fill="none" stroke="black"></path>
                <path d="M 104,160 L 208,160" fill="none" stroke="black"></path>
                <path d="M 392,160 L 496,160" fill="none" stroke="black"></path>
                <path d="M 104,192 L 208,192" fill="none" stroke="black"></path>
                <path d="M 392,192 L 496,192" fill="none" stroke="black"></path>
                <path d="M 104,224 L 208,224" fill="none" stroke="black"></path>
                <path d="M 392,224 L 496,224" fill="none" stroke="black"></path>
                <path d="M 24,288 L 128,288" fill="none" stroke="black"></path>
                <path d="M 168,288 L 272,288" fill="none" stroke="black"></path>
                <path d="M 312,288 L 416,288" fill="none" stroke="black"></path>
                <path d="M 456,288 L 560,288" fill="none" stroke="black"></path>
                <path d="M 24,320 L 128,320" fill="none" stroke="black"></path>
                <path d="M 168,320 L 272,320" fill="none" stroke="black"></path>
                <path d="M 312,320 L 416,320" fill="none" stroke="black"></path>
                <path d="M 456,320 L 560,320" fill="none" stroke="black"></path>
                <path d="M 24,352 L 128,352" fill="none" stroke="black"></path>
                <path d="M 168,352 L 272,352" fill="none" stroke="black"></path>
                <path d="M 312,352 L 416,352" fill="none" stroke="black"></path>
                <path d="M 456,352 L 560,352" fill="none" stroke="black"></path>
                <path d="M 8,400 L 64,400" fill="none" stroke="black"></path>
                <path d="M 80,400 L 136,400" fill="none" stroke="black"></path>
                <path d="M 152,400 L 208,400" fill="none" stroke="black"></path>
                <path d="M 224,400 L 280,400" fill="none" stroke="black"></path>
                <path d="M 296,400 L 352,400" fill="none" stroke="black"></path>
                <path d="M 368,400 L 424,400" fill="none" stroke="black"></path>
                <path d="M 440,400 L 496,400" fill="none" stroke="black"></path>
                <path d="M 512,400 L 568,400" fill="none" stroke="black"></path>
                <path d="M 8,432 L 64,432" fill="none" stroke="black"></path>
                <path d="M 80,432 L 136,432" fill="none" stroke="black"></path>
                <path d="M 152,432 L 208,432" fill="none" stroke="black"></path>
                <path d="M 224,432 L 280,432" fill="none" stroke="black"></path>
                <path d="M 296,432 L 352,432" fill="none" stroke="black"></path>
                <path d="M 368,432 L 424,432" fill="none" stroke="black"></path>
                <path d="M 440,432 L 496,432" fill="none" stroke="black"></path>
                <path d="M 512,432 L 568,432" fill="none" stroke="black"></path>
                <path d="M 188,232 L 212,280" fill="none" stroke="black"></path>
                <path d="M 380,104 L 404,152" fill="none" stroke="black"></path>
                <path d="M 484,232 L 508,280" fill="none" stroke="black"></path>
                <path d="M 92,280 L 116,232" fill="none" stroke="black"></path>
                <path d="M 188,152 L 212,104" fill="none" stroke="black"></path>
                <path d="M 388,280 L 412,232" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="544,392 532,386.4 532,397.6" transform="rotate(90,536,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="516,280 504,274.4 504,285.6" transform="rotate(63.43494882292201,508,280)"></polygon>
                <polygon class="arrowhead" fill="black" points="480,392 468,386.4 468,397.6" transform="rotate(90,472,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="412,152 400,146.4 400,157.6" transform="rotate(63.43494882292201,404,152)"></polygon>
                <polygon class="arrowhead" fill="black" points="400,392 388,386.4 388,397.6" transform="rotate(90,392,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="396,280 384,274.4 384,285.6" transform="rotate(116.56505117707799,388,280)"></polygon>
                <polygon class="arrowhead" fill="black" points="336,392 324,386.4 324,397.6" transform="rotate(90,328,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="256,392 244,386.4 244,397.6" transform="rotate(90,248,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="220,280 208,274.4 208,285.6" transform="rotate(63.43494882292201,212,280)"></polygon>
                <polygon class="arrowhead" fill="black" points="196,152 184,146.4 184,157.6" transform="rotate(116.56505117707799,188,152)"></polygon>
                <polygon class="arrowhead" fill="black" points="192,392 180,386.4 180,397.6" transform="rotate(90,184,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="112,392 100,386.4 100,397.6" transform="rotate(90,104,392)"></polygon>
                <polygon class="arrowhead" fill="black" points="100,280 88,274.4 88,285.6" transform="rotate(116.56505117707799,92,280)"></polygon>
                <polygon class="arrowhead" fill="black" points="48,392 36,386.4 36,397.6" transform="rotate(90,40,392)"></polygon>
                <g class="text">
                  <text x="304" y="52">anyPolicy</text>
                  <text x="304" y="84">{anyPolicy}</text>
                  <text x="156" y="180">OID1</text>
                  <text x="444" y="180">OID2</text>
                  <text x="132" y="212">{OID1,</text>
                  <text x="184" y="212">OID2}</text>
                  <text x="420" y="212">{OID1,</text>
                  <text x="472" y="212">OID2}</text>
                  <text x="76" y="308">OID1</text>
                  <text x="220" y="308">OID2</text>
                  <text x="364" y="308">OID1</text>
                  <text x="508" y="308">OID2</text>
                  <text x="52" y="340">{OID1,</text>
                  <text x="104" y="340">OID2}</text>
                  <text x="196" y="340">{OID1,</text>
                  <text x="248" y="340">OID2}</text>
                  <text x="340" y="340">{OID1,</text>
                  <text x="392" y="340">OID2}</text>
                  <text x="484" y="340">{OID1,</text>
                  <text x="536" y="340">OID2}</text>
                  <text x="36" y="420">OID1</text>
                  <text x="108" y="420">OID2</text>
                  <text x="180" y="420">OID1</text>
                  <text x="252" y="420">OID2</text>
                  <text x="324" y="420">OID1</text>
                  <text x="396" y="420">OID2</text>
                  <text x="468" y="420">OID1</text>
                  <text x="540" y="420">OID2</text>
                </g>
              </svg><a class="pilcrow" href="#section-3.2-5.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-an-example-x509-policy-tree">An Example X.509 Policy Tree with Exponential Growth</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="attack-vector">
<section id="section-3.3">
        <h3 id="name-attack-vector">
<a class="section-number selfRef" href="#section-3.3">3.3. </a><a class="section-name selfRef" href="#name-attack-vector">Attack Vector</a>
        </h3>
<p id="section-3.3-1">An attacker can use the exponential growth to mount a
        denial-of-service attack against an X.509-based application. The
        attacker sends a certificate chain as described in <a class="auto internal xref" href="#exponential-growth">Section 3.2</a> and triggers the target application's
        certificate validation process. For example, the target application
        may be a TLS server <span>[<a class="cite xref" href="#RFC8446">RFC8446</a>]</span> that performs client
        certificate validation.  The target application will consume far more
        resources processing the input than the attacker consumed to send it,
        which prevents the target application from servicing other
        clients.<a class="pilcrow" href="#section-3.3-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="avoiding-exponential-growth">
<section id="section-4">
      <h2 id="name-avoiding-exponential-growth">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-avoiding-exponential-growth">Avoiding Exponential Growth</a>
      </h2>
<p id="section-4-1">This document mitigates the denial-of-service vulnerability 
      described in <a class="auto internal xref" href="#dos">Section 3</a> by replacing the policy tree with a
      policy graph structure, which is described in this section. The policy graph grows
      linearly instead of exponentially. This removes the asymmetric cost in
      policy validation.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">X.509 implementations <span class="bcp14">SHOULD</span> perform policy validation
      by building a policy graph, following the procedure described in <a class="auto internal xref" href="#updates">Section 5</a>. This replacement procedure computes the same
      policies as in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>, but one of the outputs is in a
      different form. See <a class="auto internal xref" href="#outputs">Section 4.2</a> for details.  <a class="auto internal xref" href="#other-mitigations">Section 6</a> describes alternative mitigations for
      implementations that depend on the original, exponential-sized
      output.<a class="pilcrow" href="#section-4-2">¶</a></p>
<div id="policy-graph">
<section id="section-4.1">
        <h3 id="name-policy-graphs">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-policy-graphs">Policy Graphs</a>
        </h3>
<p id="section-4.1-1">The tree structure in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> is an unnecessarily
   inefficient representation of a certification path's policy mappings.  When
   multiple issuer policies map to a single subject policy, the subject policy
   will correspond to multiple duplicate nodes in the policy tree. Children of
   the subject policy are then duplicated recursively. This duplication is the
   source of the exponential growth described in <a class="auto internal xref" href="#exponential-growth">Section 3.2</a>.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2">A policy graph represents the same information with a directed acyclic
   graph of policy nodes.  It eliminates this duplication by using a single
   node with multiple parents.  See <a class="auto internal xref" href="#updates">Section 5</a> for the procedure
   for building this structure.  <a class="auto internal xref" href="#exponential-tree-as-graph">Figure 2</a>
   shows the updated representation of the example in <a class="auto internal xref" href="#exponential-tree">Figure 1</a>.<a class="pilcrow" href="#section-4.1-2">¶</a></p>
<span id="name-a-more-efficient-representa"></span><div id="exponential-tree-as-graph">
<figure id="figure-2">
          <div id="section-4.1-3.1">
            <div class="alignLeft art-svg artwork" id="section-4.1-3.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="576" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 248 576" width="248" xmlns="http://www.w3.org/2000/svg">
                <path d="M 8,160 L 8,224" fill="none" stroke="black"></path>
                <path d="M 8,336 L 8,400" fill="none" stroke="black"></path>
                <path d="M 8,512 L 8,544" fill="none" stroke="black"></path>
                <path d="M 48,232 L 48,328" fill="none" stroke="black"></path>
                <path d="M 48,408 L 48,504" fill="none" stroke="black"></path>
                <path d="M 80,32 L 80,96" fill="none" stroke="black"></path>
                <path d="M 112,160 L 112,224" fill="none" stroke="black"></path>
                <path d="M 112,336 L 112,400" fill="none" stroke="black"></path>
                <path d="M 112,512 L 112,544" fill="none" stroke="black"></path>
                <path d="M 136,160 L 136,224" fill="none" stroke="black"></path>
                <path d="M 136,336 L 136,400" fill="none" stroke="black"></path>
                <path d="M 136,512 L 136,544" fill="none" stroke="black"></path>
                <path d="M 176,32 L 176,96" fill="none" stroke="black"></path>
                <path d="M 192,232 L 192,328" fill="none" stroke="black"></path>
                <path d="M 192,408 L 192,504" fill="none" stroke="black"></path>
                <path d="M 240,160 L 240,224" fill="none" stroke="black"></path>
                <path d="M 240,336 L 240,400" fill="none" stroke="black"></path>
                <path d="M 240,512 L 240,544" fill="none" stroke="black"></path>
                <path d="M 80,32 L 176,32" fill="none" stroke="black"></path>
                <path d="M 80,64 L 176,64" fill="none" stroke="black"></path>
                <path d="M 80,96 L 176,96" fill="none" stroke="black"></path>
                <path d="M 8,160 L 112,160" fill="none" stroke="black"></path>
                <path d="M 136,160 L 240,160" fill="none" stroke="black"></path>
                <path d="M 8,192 L 112,192" fill="none" stroke="black"></path>
                <path d="M 136,192 L 240,192" fill="none" stroke="black"></path>
                <path d="M 8,224 L 112,224" fill="none" stroke="black"></path>
                <path d="M 136,224 L 240,224" fill="none" stroke="black"></path>
                <path d="M 8,336 L 112,336" fill="none" stroke="black"></path>
                <path d="M 136,336 L 240,336" fill="none" stroke="black"></path>
                <path d="M 8,368 L 112,368" fill="none" stroke="black"></path>
                <path d="M 136,368 L 240,368" fill="none" stroke="black"></path>
                <path d="M 8,400 L 112,400" fill="none" stroke="black"></path>
                <path d="M 136,400 L 240,400" fill="none" stroke="black"></path>
                <path d="M 8,512 L 112,512" fill="none" stroke="black"></path>
                <path d="M 136,512 L 240,512" fill="none" stroke="black"></path>
                <path d="M 8,544 L 112,544" fill="none" stroke="black"></path>
                <path d="M 136,544 L 240,544" fill="none" stroke="black"></path>
                <path d="M 100,408 L 148,504" fill="none" stroke="black"></path>
                <path d="M 100,232 L 148,328" fill="none" stroke="black"></path>
                <path d="M 172,104 L 196,152" fill="none" stroke="black"></path>
                <path d="M 60,152 L 84,104" fill="none" stroke="black"></path>
                <path d="M 100,328 L 148,232" fill="none" stroke="black"></path>
                <path d="M 100,504 L 148,408" fill="none" stroke="black"></path>
                <polygon class="arrowhead" fill="black" points="200,504 188,498.4 188,509.6" transform="rotate(90,192,504)"></polygon>
                <polygon class="arrowhead" fill="black" points="200,328 188,322.4 188,333.6" transform="rotate(90,192,328)"></polygon>
                <polygon class="arrowhead" fill="black" points="204,152 192,146.4 192,157.6" transform="rotate(63.43494882292201,196,152)"></polygon>
                <polygon class="arrowhead" fill="black" points="156,504 144,498.4 144,509.6" transform="rotate(63.43494882292201,148,504)"></polygon>
                <polygon class="arrowhead" fill="black" points="156,328 144,322.4 144,333.6" transform="rotate(63.43494882292201,148,328)"></polygon>
                <polygon class="arrowhead" fill="black" points="108,504 96,498.4 96,509.6" transform="rotate(116.56505117707799,100,504)"></polygon>
                <polygon class="arrowhead" fill="black" points="108,328 96,322.4 96,333.6" transform="rotate(116.56505117707799,100,328)"></polygon>
                <polygon class="arrowhead" fill="black" points="68,152 56,146.4 56,157.6" transform="rotate(116.56505117707799,60,152)"></polygon>
                <polygon class="arrowhead" fill="black" points="56,504 44,498.4 44,509.6" transform="rotate(90,48,504)"></polygon>
                <polygon class="arrowhead" fill="black" points="56,328 44,322.4 44,333.6" transform="rotate(90,48,328)"></polygon>
                <g class="text">
                  <text x="128" y="52">anyPolicy</text>
                  <text x="128" y="84">{anyPolicy}</text>
                  <text x="60" y="180">OID1</text>
                  <text x="188" y="180">OID2</text>
                  <text x="36" y="212">{OID1,</text>
                  <text x="88" y="212">OID2}</text>
                  <text x="164" y="212">{OID1,</text>
                  <text x="216" y="212">OID2}</text>
                  <text x="60" y="356">OID1</text>
                  <text x="188" y="356">OID2</text>
                  <text x="36" y="388">{OID1,</text>
                  <text x="88" y="388">OID2}</text>
                  <text x="164" y="388">{OID1,</text>
                  <text x="216" y="388">OID2}</text>
                  <text x="60" y="532">OID1</text>
                  <text x="188" y="532">OID2</text>
                </g>
              </svg><a class="pilcrow" href="#section-4.1-3.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-a-more-efficient-representa">A More Efficient Representation of an X.509 Policy Tree</a>
          </figcaption></figure>
</div>
<p id="section-4.1-4">This graph's size is bounded linearly by the total number of
        certificate policies (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.4">Section 4.2.1.4</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>) and policy mappings (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.5">Section 4.2.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>). The policy tree in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> is the tree of all paths from the root to a leaf in
        the policy graph, so no information is lost in the graph
        representation.<a class="pilcrow" href="#section-4.1-4">¶</a></p>
</section>
</div>
<div id="outputs">
<section id="section-4.2">
        <h3 id="name-verification-outputs">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-verification-outputs">Verification Outputs</a>
        </h3>
<p id="section-4.2-1"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.6">Section 6.1.6</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>
        describes the entire <code>valid_policy_tree</code> structure as an output
        of the verification process. However, Section 12.2 of <span>[<a class="cite xref" href="#X.509">X.509</a>]</span> only describes the following as outputs: the
        authorities-constrained policies, the user-constrained policies, and
        their associated qualifiers.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<p id="section-4.2-2">As the <code>valid_policy_tree</code> is the exponential structure,
        computing it reintroduces the denial-of-service vulnerability. X.509
        implementations <span class="bcp14">SHOULD NOT</span> output the entire
        <code>valid_policy_tree</code> structure; instead, they
        <span class="bcp14">SHOULD</span> limit output to just the set of
        authorities-constrained and/or user-constrained policies, as described
        in <span>[<a class="cite xref" href="#X.509">X.509</a>]</span>. Sections <a class="auto internal xref" href="#update-outputs">5.6</a> and <a class="auto internal xref" href="#other-mitigations">6</a> discuss other mitigations for applications where
        this option is not available.<a class="pilcrow" href="#section-4.2-2">¶</a></p>
<p id="section-4.2-3">X.509 implementations <span class="bcp14">MAY</span> omit policy qualifiers
        from the output to simplify processing. Note that <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.4">Section 4.2.1.4</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> already recommends that
        certification authorities omit policy qualifiers from policy
        information terms.<a class="pilcrow" href="#section-4.2-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="updates">
<section id="section-5">
      <h2 id="name-updates-to-rfc-5280">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-updates-to-rfc-5280">Updates to RFC 5280</a>
      </h2>
<p id="section-5-1">This section provides updates to <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>. These updates implement the changes
described in <a class="auto internal xref" href="#avoiding-exponential-growth">Section 4</a>.<a class="pilcrow" href="#section-5-1">¶</a></p>
<div id="updates-to-section-61">
<section id="section-5.1">
        <h3 id="name-updates-to-section-61">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-updates-to-section-61">Updates to Section 6.1</a>
        </h3>
<p id="section-5.1-1"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1">Section 6.1</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> is updated as follows:<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<p id="section-5.1-2">OLD:<a class="pilcrow" href="#section-5.1-2">¶</a></p>
<blockquote id="section-5.1-3">
          <p id="section-5.1-3.1">A particular certification path may not, however, be
        appropriate for all applications.  Therefore, an application
        <span class="bcp14">MAY</span> augment this algorithm to further limit the set of
        valid paths.  The path validation process also determines the set of
        certificate policies that are valid for this path, based on the
        certificate policies extension, policy mappings extension, policy
        constraints extension, and inhibit anyPolicy extension.  To achieve
        this, the path validation algorithm constructs a valid policy tree.
        If the set of certificate policies that are valid for this path is not
        empty, then the result will be a valid policy tree of depth n,
        otherwise the result will be a null valid policy
        tree.<a class="pilcrow" href="#section-5.1-3.1">¶</a></p>
</blockquote>
<p id="section-5.1-4">NEW:<a class="pilcrow" href="#section-5.1-4">¶</a></p>
<blockquote id="section-5.1-5">
          <p id="section-5.1-5.1">A particular certification path may not, however, be
        appropriate for all applications.  Therefore, an application
        <span class="bcp14">MAY</span> augment this algorithm to further limit the set of
        valid paths.  The path validation process also determines the set of
        certificate policies that are valid for this path, based on the
        certificate policies extension, policy mappings extension, policy
        constraints extension, and inhibit anyPolicy extension.  To achieve
        this, the path validation algorithm constructs a valid policy set,
        which may be empty if no certificate policies are valid for this
        path.<a class="pilcrow" href="#section-5.1-5.1">¶</a></p>
</blockquote>
</section>
</div>
<div id="updates-to-section-612">
<section id="section-5.2">
        <h3 id="name-updates-to-section-612">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-updates-to-section-612">Updates to Section 6.1.2</a>
        </h3>
<p id="section-5.2-1">The following replaces entry (a) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.2">Section 6.1.2</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>:<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<blockquote id="section-5.2-2">
          <span class="break"></span><dl class="olPercent" id="section-5.2-2.1">
<dt>(a)</dt>
<dd id="section-5.2-2.1.1">
              <p id="section-5.2-2.1.1.1"><code>valid_policy_graph</code>: A directed acyclic graph of
            certificate policies with their optional qualifiers; each of the
            leaves of the graph represents a valid policy at this stage in the
            certification path validation.  If valid policies exist at this
            stage in the certification path validation, the depth of the graph
            is equal to the number of certificates in the chain that have been
            processed.  If valid policies do not exist at this stage in the
            certification path validation, the graph is set to NULL.  Once the
            graph is set to NULL, policy processing ceases.  Implementations
            <span class="bcp14">MAY</span> omit qualifiers if not returned in the output.<a class="pilcrow" href="#section-5.2-2.1.1.1">¶</a></p>
<p id="section-5.2-2.1.1.2">Each node in the <code>valid_policy_graph</code> includes three
            data objects: the valid policy, a set of associated policy
            qualifiers, and a set of one or more expected policy values.<a class="pilcrow" href="#section-5.2-2.1.1.2">¶</a></p>
<p id="section-5.2-2.1.1.3">Nodes in the graph can be divided into depths, numbered
            starting from zero.  A node at depth x can have zero or more
            children at depth x+1 and, with the exception of depth zero, one
            or more parents at depth x-1. No other edges between nodes may
            exist.<a class="pilcrow" href="#section-5.2-2.1.1.3">¶</a></p>
<p id="section-5.2-2.1.1.4">If the node is at depth x, the components of the node have the
            following semantics:<a class="pilcrow" href="#section-5.2-2.1.1.4">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.2-2.1.1.5">
<dt>(1)</dt>
<dd id="section-5.2-2.1.1.5.1">
                  <p id="section-5.2-2.1.1.5.1.1">The <code>valid_policy</code> is a single policy OID
                representing a valid policy for the path of length x.<a class="pilcrow" href="#section-5.2-2.1.1.5.1.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(2)</dt>
<dd id="section-5.2-2.1.1.5.2">
                  <p id="section-5.2-2.1.1.5.2.1">The <code>qualifier_set</code> is a set of policy qualifiers
                associated with the valid policy in certificate x.  It is only
                necessary to maintain this field if policy qualifiers are
                returned to the application.  See Section 6.1.5, step (g).<a class="pilcrow" href="#section-5.2-2.1.1.5.2.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(3)</dt>
<dd id="section-5.2-2.1.1.5.3">
                  <p id="section-5.2-2.1.1.5.3.1">The <code>expected_policy_set</code> contains one or more
                policy OIDs that would satisfy this policy in the certificate
                x+1.<a class="pilcrow" href="#section-5.2-2.1.1.5.3.1">¶</a></p>
</dd>
              <dd class="break"></dd>
</dl>
<p id="section-5.2-2.1.1.6">The initial value of the <code>valid_policy_graph</code> is a
            single node with <code>valid_policy</code> anyPolicy, an empty
            <code>qualifier_set</code>, and an <code>expected_policy_set</code> with
            the single value anyPolicy.  This node is considered to be at
            depth zero.<a class="pilcrow" href="#section-5.2-2.1.1.6">¶</a></p>
<p id="section-5.2-2.1.1.7">The graph additionally satisfies the following invariants:<a class="pilcrow" href="#section-5.2-2.1.1.7">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1.1.8.1">
                  <p id="section-5.2-2.1.1.8.1.1">For any depth x and policy OID P-OID, there is at most one
                node at depth x whose <code>valid_policy</code> is P-OID.<a class="pilcrow" href="#section-5.2-2.1.1.8.1.1">¶</a></p>
</li>
                <li class="normal" id="section-5.2-2.1.1.8.2">
                  <p id="section-5.2-2.1.1.8.2.1">The <code>expected_policy_set</code> of a node whose
                <code>valid_policy</code> is anyPolicy is always {anyPolicy}.<a class="pilcrow" href="#section-5.2-2.1.1.8.2.1">¶</a></p>
</li>
                <li class="normal" id="section-5.2-2.1.1.8.3">
                  <p id="section-5.2-2.1.1.8.3.1">A node at depth x whose <code>valid_policy</code> is anyPolicy,
                except for the one at depth zero, always has exactly one
                parent: a node at depth x-1 whose <code>valid_policy</code> is
                also anyPolicy.<a class="pilcrow" href="#section-5.2-2.1.1.8.3.1">¶</a></p>
</li>
                <li class="normal" id="section-5.2-2.1.1.8.4">
                  <p id="section-5.2-2.1.1.8.4.1">Each node at depth greater than 0 has either one or more
                parent nodes whose <code>valid_policy</code> is not anyPolicy or
                a single parent node whose <code>valid_policy</code> is anyPolicy.
                That is, a node cannot simultaneously be a child of both
                anyPolicy and some non-anyPolicy OID.<a class="pilcrow" href="#section-5.2-2.1.1.8.4.1">¶</a></p>
</li>
              </ul>
<p id="section-5.2-2.1.1.9"><a class="auto internal xref" href="#graph-initial">Figure 3</a> is a graphic representation of
            the initial state of the <code>valid_policy_graph</code>.  Additional
            figures will use this format to describe changes in the
            <code>valid_policy_graph</code> during path processing.<a class="pilcrow" href="#section-5.2-2.1.1.9">¶</a></p>
<span id="name-initial-value-of-the-valid_"></span><div id="graph-initial">
<figure id="figure-3">
                <div id="section-5.2-2.1.1.10.1">
                  <div class="alignLeft art-svg artwork" id="section-5.2-2.1.1.10.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="160" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 376 160" width="376" xmlns="http://www.w3.org/2000/svg">
                      <path d="M 8,32 L 8,128" fill="none" stroke="black"></path>
                      <path d="M 144,32 L 144,128" fill="none" stroke="black"></path>
                      <path d="M 8,32 L 144,32" fill="none" stroke="black"></path>
                      <path d="M 176,48 L 208,48" fill="none" stroke="black"></path>
                      <path d="M 8,64 L 144,64" fill="none" stroke="black"></path>
                      <path d="M 176,80 L 208,80" fill="none" stroke="black"></path>
                      <path d="M 8,96 L 144,96" fill="none" stroke="black"></path>
                      <path d="M 176,112 L 208,112" fill="none" stroke="black"></path>
                      <path d="M 8,128 L 144,128" fill="none" stroke="black"></path>
                      <polygon class="arrowhead" fill="black" points="184,112 172,106.4 172,117.6" transform="rotate(180,176,112)"></polygon>
                      <polygon class="arrowhead" fill="black" points="184,80 172,74.4 172,85.6" transform="rotate(180,176,80)"></polygon>
                      <polygon class="arrowhead" fill="black" points="184,48 172,42.4 172,53.6" transform="rotate(180,176,48)"></polygon>
                      <g class="text">
                        <text x="72" y="52">anyPolicy</text>
                        <text x="268" y="52">valid_policy</text>
                        <text x="76" y="84">{}</text>
                        <text x="272" y="84">qualifier_set</text>
                        <text x="72" y="116">{anyPolicy}</text>
                        <text x="296" y="116">expected_policy_set</text>
                      </g>
                    </svg><a class="pilcrow" href="#section-5.2-2.1.1.10.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-initial-value-of-the-valid_">Initial Value of the <code>valid_policy_graph</code> State Variable</a>
                </figcaption></figure>
</div>
</dd>
          <dd class="break"></dd>
</dl>
</blockquote>
</section>
</div>
<div id="updates-to-section-613">
<section id="section-5.3">
        <h3 id="name-updates-to-section-613">
<a class="section-number selfRef" href="#section-5.3">5.3. </a><a class="section-name selfRef" href="#name-updates-to-section-613">Updates to Section 6.1.3</a>
        </h3>
<p id="section-5.3-1">The following replaces steps (d), (e), and (f) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.3">Section 6.1.3</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>:<a class="pilcrow" href="#section-5.3-1">¶</a></p>
<blockquote id="section-5.3-2">
          <span class="break"></span><dl class="olPercent" id="section-5.3-2.1">
<dt>(d)</dt>
<dd id="section-5.3-2.1.1">
              <p id="section-5.3-2.1.1.1">If the certificate policies extension is present in the
            certificate and the <code>valid_policy_graph</code> is not NULL,
            process the policy information by performing the following steps
            in order:<a class="pilcrow" href="#section-5.3-2.1.1.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.3-2.1.1.2">
<dt>(1)</dt>
<dd id="section-5.3-2.1.1.2.1">
                  <p id="section-5.3-2.1.1.2.1.1">For each policy P not equal to anyPolicy in the certificate
                policies extension, let P-OID denote the OID for policy P and
                P-Q denote the qualifier set for policy P.  Perform the
                following steps in order:<a class="pilcrow" href="#section-5.3-2.1.1.2.1.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.3-2.1.1.2.1.2">
<dt>(i)</dt>
<dd id="section-5.3-2.1.1.2.1.2.1">
                      <p id="section-5.3-2.1.1.2.1.2.1.1">Let <code>parent_nodes</code> be the nodes at depth i-1 in
                    the <code>valid_policy_graph</code> where P-OID is in the
                    <code>expected_policy_set</code>.  If <code>parent_nodes</code> is
                    not empty, create a child node as follows: set the
                    <code>valid_policy</code> to P-OID, set the
                    <code>qualifier_set</code> to P-Q, set the
                    <code>expected_policy_set</code> to {P-OID}, and set the
                    parent nodes to <code>parent_nodes</code>.<a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.1.1">¶</a></p>
<p id="section-5.3-2.1.1.2.1.2.1.2">For example, consider a <code>valid_policy_graph</code>
                    with a node of depth i-1 where the
                    <code>expected_policy_set</code> is {Gold, White} and a
                    second node where the <code>expected_policy_set</code> is
                    {Gold, Yellow}.  Assume the certificate policies Gold and
                    Silver appear in the certificate policies extension of
                    certificate i.  The Gold policy is matched, but the Silver
                    policy is not.  This rule will generate a child node of
                    depth i for the Gold policy.  The result is shown as <a class="auto internal xref" href="#exact-match">Figure 4</a>.<a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.1.2">¶</a></p>
<span id="name-processing-an-exact-match"></span><div id="exact-match">
<figure id="figure-4">
                        <div id="section-5.3-2.1.1.2.1.2.1.3.1">
                          <div class="alignLeft art-svg artwork" id="section-5.3-2.1.1.2.1.2.1.3.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="336" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 456 336" width="456" xmlns="http://www.w3.org/2000/svg">
                              <path d="M 8,32 L 8,128" fill="none" stroke="black"></path>
                              <path d="M 112,208 L 112,304" fill="none" stroke="black"></path>
                              <path d="M 152,32 L 152,128" fill="none" stroke="black"></path>
                              <path d="M 208,32 L 208,128" fill="none" stroke="black"></path>
                              <path d="M 256,208 L 256,304" fill="none" stroke="black"></path>
                              <path d="M 352,32 L 352,128" fill="none" stroke="black"></path>
                              <path d="M 8,32 L 152,32" fill="none" stroke="black"></path>
                              <path d="M 208,32 L 352,32" fill="none" stroke="black"></path>
                              <path d="M 8,64 L 152,64" fill="none" stroke="black"></path>
                              <path d="M 208,64 L 352,64" fill="none" stroke="black"></path>
                              <path d="M 8,96 L 152,96" fill="none" stroke="black"></path>
                              <path d="M 208,96 L 352,96" fill="none" stroke="black"></path>
                              <path d="M 8,128 L 152,128" fill="none" stroke="black"></path>
                              <path d="M 208,128 L 352,128" fill="none" stroke="black"></path>
                              <path d="M 112,208 L 256,208" fill="none" stroke="black"></path>
                              <path d="M 112,240 L 256,240" fill="none" stroke="black"></path>
                              <path d="M 112,272 L 256,272" fill="none" stroke="black"></path>
                              <path d="M 112,304 L 256,304" fill="none" stroke="black"></path>
                              <path d="M 100,136 L 132,200" fill="none" stroke="black"></path>
                              <path d="M 236,200 L 268,136" fill="none" stroke="black"></path>
                              <polygon class="arrowhead" fill="black" points="244,200 232,194.4 232,205.6" transform="rotate(116.56505117707799,236,200)"></polygon>
                              <polygon class="arrowhead" fill="black" points="140,200 128,194.4 128,205.6" transform="rotate(63.43494882292201,132,200)"></polygon>
                              <g class="text">
                                <text x="80" y="52">Red</text>
                                <text x="284" y="52">Blue</text>
                                <text x="76" y="84">{}</text>
                                <text x="276" y="84">{}</text>
                                <text x="400" y="84">depth</text>
                                <text x="440" y="84">i-1</text>
                                <text x="52" y="116">{Gold,</text>
                                <text x="108" y="116">White}</text>
                                <text x="252" y="116">{Gold,</text>
                                <text x="312" y="116">Yellow}</text>
                                <text x="180" y="228">Gold</text>
                                <text x="180" y="260">{}</text>
                                <text x="304" y="260">depth</text>
                                <text x="336" y="260">i</text>
                                <text x="180" y="292">{Gold}</text>
                              </g>
                            </svg><a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.1.3.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-processing-an-exact-match">Processing an Exact Match</a>
                        </figcaption></figure>
</div>
</dd>
                    <dd class="break"></dd>
<dt>(ii)</dt>
<dd id="section-5.3-2.1.1.2.1.2.2">
                      <p id="section-5.3-2.1.1.2.1.2.2.1">If there was no match in step (i) and the
                    <code>valid_policy_graph</code> includes a node of depth i-1
                    with the <code>valid_policy</code> anyPolicy, generate a child
                    node with the following values: set the
                    <code>valid_policy</code> to P-OID, set the
                    <code>qualifier_set</code> to P-Q, set the
                    <code>expected_policy_set</code> to {P-OID}, and set the
                    parent node to the anyPolicy node at depth i-1.<a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.2.1">¶</a></p>
<p id="section-5.3-2.1.1.2.1.2.2.2">For example, consider a <code>valid_policy_graph</code>
                    with a node of depth i-1 where the <code>valid_policy</code>
                    is anyPolicy.  Assume the certificate policies Gold and
                    Silver appear in the certificate policies extension of
                    certificate i.  The Gold policy does not have a qualifier,
                    but the Silver policy has the qualifier Q-Silver.  If Gold
                    and Silver were not matched in (i) above, this rule will
                    generate two child nodes of depth i, one for each policy.
                    The result is shown as <a class="auto internal xref" href="#unmatched-anypolicy">Figure 5</a>.<a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.2.2">¶</a></p>
<span id="name-processing-unmatched-polici"></span><div id="unmatched-anypolicy">
<figure id="figure-5">
                        <div id="section-5.3-2.1.1.2.1.2.2.3.1">
                          <div class="alignLeft art-svg artwork" id="section-5.3-2.1.1.2.1.2.2.3.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="336" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 472 336" width="472" xmlns="http://www.w3.org/2000/svg">
                              <path d="M 8,208 L 8,304" fill="none" stroke="black"></path>
                              <path d="M 120,32 L 120,128" fill="none" stroke="black"></path>
                              <path d="M 152,208 L 152,304" fill="none" stroke="black"></path>
                              <path d="M 240,208 L 240,304" fill="none" stroke="black"></path>
                              <path d="M 264,32 L 264,128" fill="none" stroke="black"></path>
                              <path d="M 384,208 L 384,304" fill="none" stroke="black"></path>
                              <path d="M 120,32 L 264,32" fill="none" stroke="black"></path>
                              <path d="M 120,64 L 264,64" fill="none" stroke="black"></path>
                              <path d="M 120,96 L 264,96" fill="none" stroke="black"></path>
                              <path d="M 120,128 L 264,128" fill="none" stroke="black"></path>
                              <path d="M 8,208 L 152,208" fill="none" stroke="black"></path>
                              <path d="M 240,208 L 384,208" fill="none" stroke="black"></path>
                              <path d="M 8,240 L 152,240" fill="none" stroke="black"></path>
                              <path d="M 240,240 L 384,240" fill="none" stroke="black"></path>
                              <path d="M 8,272 L 152,272" fill="none" stroke="black"></path>
                              <path d="M 240,272 L 384,272" fill="none" stroke="black"></path>
                              <path d="M 8,304 L 152,304" fill="none" stroke="black"></path>
                              <path d="M 240,304 L 384,304" fill="none" stroke="black"></path>
                              <path d="M 236,136 L 268,200" fill="none" stroke="black"></path>
                              <path d="M 116,200 L 148,136" fill="none" stroke="black"></path>
                              <polygon class="arrowhead" fill="black" points="276,200 264,194.4 264,205.6" transform="rotate(63.43494882292201,268,200)"></polygon>
                              <polygon class="arrowhead" fill="black" points="124,200 112,194.4 112,205.6" transform="rotate(116.56505117707799,116,200)"></polygon>
                              <g class="text">
                                <text x="192" y="52">anyPolicy</text>
                                <text x="188" y="84">{}</text>
                                <text x="312" y="100">depth</text>
                                <text x="352" y="100">i-1</text>
                                <text x="192" y="116">{anyPolicy}</text>
                                <text x="76" y="228">Gold</text>
                                <text x="308" y="228">Silver</text>
                                <text x="76" y="260">{}</text>
                                <text x="308" y="260">{Q-Silver}</text>
                                <text x="432" y="260">depth</text>
                                <text x="464" y="260">i</text>
                                <text x="76" y="292">{Gold}</text>
                                <text x="308" y="292">{Silver}</text>
                              </g>
                            </svg><a class="pilcrow" href="#section-5.3-2.1.1.2.1.2.2.3.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-processing-unmatched-polici">Processing Unmatched Policies When a Leaf Node Specifies anyPolicy</a>
                        </figcaption></figure>
</div>
</dd>
                  <dd class="break"></dd>
</dl>
</dd>
                <dd class="break"></dd>
<dt>(2)</dt>
<dd id="section-5.3-2.1.1.2.2">
                  <p id="section-5.3-2.1.1.2.2.1">If the certificate policies extension includes the policy
                anyPolicy with the qualifier set AP-Q and either (a)
                <code>inhibit_anyPolicy</code> is greater than 0 or (b) i&lt;n and
                the certificate is self-issued, then:<a class="pilcrow" href="#section-5.3-2.1.1.2.2.1">¶</a></p>
<p id="section-5.3-2.1.1.2.2.2">For each policy OID P-OID (including anyPolicy) that
                appears in the <code>expected_policy_set</code> of some node in
                the <code>valid_policy_graph</code> for depth i-1, if P-OID does
                not appear as the <code>valid_policy</code> of some node at depth
                i, create a single child node with the following values: set
                the <code>valid_policy</code> to P-OID, set the
                <code>qualifier_set</code> to AP-Q, set the
                <code>expected_policy_set</code> to {P-OID}, and set the parents
                to the nodes at depth i-1 where P-OID appears in
                <code>expected_policy_set</code>.<a class="pilcrow" href="#section-5.3-2.1.1.2.2.2">¶</a></p>
<p id="section-5.3-2.1.1.2.2.3">This is equivalent to running step (1) above as if the
                certificate policies extension contained a policy with OID
                P-OID and qualifier set AP-Q.<a class="pilcrow" href="#section-5.3-2.1.1.2.2.3">¶</a></p>
<p id="section-5.3-2.1.1.2.2.4">For example, consider a <code>valid_policy_graph</code> with a
                node of depth i-1 where the <code>expected_policy_set</code> is
                {Gold, Silver} and a second node of depth i-1 where the
                <code>expected_policy_set</code> is {Gold}.  Assume anyPolicy
                appears in the certificate policies extension of certificate i
                with policy qualifiers AP-Q, but Gold and Silver do not
                appear.  This rule will generate two child nodes of depth i,
                one for each policy.  The result is shown below as <a class="auto internal xref" href="#anypolicy-in-extension">Figure 6</a>.<a class="pilcrow" href="#section-5.3-2.1.1.2.2.4">¶</a></p>
<span id="name-processing-unmatched-policie"></span><div id="anypolicy-in-extension">
<figure id="figure-6">
                    <div id="section-5.3-2.1.1.2.2.5.1">
                      <div class="alignLeft art-svg artwork" id="section-5.3-2.1.1.2.2.5.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="368" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 432 368" width="432" xmlns="http://www.w3.org/2000/svg">
                          <path d="M 8,32 L 8,128" fill="none" stroke="black"></path>
                          <path d="M 8,240 L 8,336" fill="none" stroke="black"></path>
                          <path d="M 72,136 L 72,232" fill="none" stroke="black"></path>
                          <path d="M 152,32 L 152,128" fill="none" stroke="black"></path>
                          <path d="M 152,240 L 152,336" fill="none" stroke="black"></path>
                          <path d="M 184,32 L 184,128" fill="none" stroke="black"></path>
                          <path d="M 184,240 L 184,336" fill="none" stroke="black"></path>
                          <path d="M 256,136 L 256,232" fill="none" stroke="black"></path>
                          <path d="M 328,32 L 328,128" fill="none" stroke="black"></path>
                          <path d="M 328,240 L 328,336" fill="none" stroke="black"></path>
                          <path d="M 8,32 L 152,32" fill="none" stroke="black"></path>
                          <path d="M 184,32 L 328,32" fill="none" stroke="black"></path>
                          <path d="M 8,64 L 152,64" fill="none" stroke="black"></path>
                          <path d="M 184,64 L 328,64" fill="none" stroke="black"></path>
                          <path d="M 8,96 L 152,96" fill="none" stroke="black"></path>
                          <path d="M 184,96 L 328,96" fill="none" stroke="black"></path>
                          <path d="M 8,128 L 152,128" fill="none" stroke="black"></path>
                          <path d="M 184,128 L 328,128" fill="none" stroke="black"></path>
                          <path d="M 8,240 L 152,240" fill="none" stroke="black"></path>
                          <path d="M 184,240 L 328,240" fill="none" stroke="black"></path>
                          <path d="M 8,272 L 152,272" fill="none" stroke="black"></path>
                          <path d="M 184,272 L 328,272" fill="none" stroke="black"></path>
                          <path d="M 8,304 L 152,304" fill="none" stroke="black"></path>
                          <path d="M 184,304 L 328,304" fill="none" stroke="black"></path>
                          <path d="M 8,336 L 152,336" fill="none" stroke="black"></path>
                          <path d="M 184,336 L 328,336" fill="none" stroke="black"></path>
                          <path d="M 148,136 L 196,232" fill="none" stroke="black"></path>
                          <polygon class="arrowhead" fill="black" points="264,232 252,226.4 252,237.6" transform="rotate(90,256,232)"></polygon>
                          <polygon class="arrowhead" fill="black" points="204,232 192,226.4 192,237.6" transform="rotate(63.43494882292201,196,232)"></polygon>
                          <polygon class="arrowhead" fill="black" points="80,232 68,226.4 68,237.6" transform="rotate(90,72,232)"></polygon>
                          <g class="text">
                            <text x="80" y="52">Red</text>
                            <text x="260" y="52">Blue</text>
                            <text x="76" y="84">{}</text>
                            <text x="252" y="84">{}</text>
                            <text x="376" y="84">depth</text>
                            <text x="416" y="84">i-1</text>
                            <text x="52" y="116">{Gold,</text>
                            <text x="112" y="116">Silver}</text>
                            <text x="260" y="116">{Gold}</text>
                            <text x="76" y="260">Silver</text>
                            <text x="260" y="260">Gold</text>
                            <text x="76" y="292">{AP-Q}</text>
                            <text x="260" y="292">{AP-Q}</text>
                            <text x="376" y="292">depth</text>
                            <text x="408" y="292">i</text>
                            <text x="76" y="324">{Silver}</text>
                            <text x="260" y="324">{Gold}</text>
                          </g>
                        </svg><a class="pilcrow" href="#section-5.3-2.1.1.2.2.5.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-processing-unmatched-policie">Processing Unmatched Policies When the Certificate Policies Extension Specifies anyPolicy</a>
                    </figcaption></figure>
</div>
</dd>
                <dd class="break"></dd>
<dt>(3)</dt>
<dd id="section-5.3-2.1.1.2.3">
                  <p id="section-5.3-2.1.1.2.3.1">If there is a node in the <code>valid_policy_graph</code> of depth i-1 or less without any child nodes, delete that node.
Repeat this step until there are no nodes of depth i-1 or less without children.<a class="pilcrow" href="#section-5.3-2.1.1.2.3.1">¶</a></p>
<p id="section-5.3-2.1.1.2.3.2">
For example, consider the <code>valid_policy_graph</code> shown in <a class="auto internal xref" href="#pruning">Figure 7</a> below.
The two nodes at depth i-1 that are marked with an 'X' have no children, and they are deleted.
Applying this rule to the resulting graph will cause the nodes at depth i-2 that is marked with a 'Y' to be deleted.
In the resulting graph, there are no nodes of depth i-1 or less without children, and this step is complete.<a class="pilcrow" href="#section-5.3-2.1.1.2.3.2">¶</a></p>
<span id="name-pruning-the-valid_policy_gr"></span><div id="pruning">
<figure id="figure-7">
                    <div id="section-5.3-2.1.1.2.3.3.1">
                      <div class="alignLeft art-svg artwork" id="section-5.3-2.1.1.2.3.3.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="384" stroke-linecap="round" text-anchor="middle" version="1.1" viewBox="0 0 416 384" width="416" xmlns="http://www.w3.org/2000/svg">
                          <path d="M 8,128 L 8,160" fill="none" stroke="black"></path>
                          <path d="M 8,224 L 8,256" fill="none" stroke="black"></path>
                          <path d="M 8,320 L 8,352" fill="none" stroke="black"></path>
                          <path d="M 56,168 L 56,216" fill="none" stroke="black"></path>
                          <path d="M 104,128 L 104,160" fill="none" stroke="black"></path>
                          <path d="M 104,224 L 104,256" fill="none" stroke="black"></path>
                          <path d="M 104,320 L 104,352" fill="none" stroke="black"></path>
                          <path d="M 120,32 L 120,64" fill="none" stroke="black"></path>
                          <path d="M 120,128 L 120,160" fill="none" stroke="black"></path>
                          <path d="M 120,224 L 120,256" fill="none" stroke="black"></path>
                          <path d="M 120,320 L 120,352" fill="none" stroke="black"></path>
                          <path d="M 168,72 L 168,120" fill="none" stroke="black"></path>
                          <path d="M 168,168 L 168,216" fill="none" stroke="black"></path>
                          <path d="M 168,264 L 168,312" fill="none" stroke="black"></path>
                          <path d="M 216,32 L 216,64" fill="none" stroke="black"></path>
                          <path d="M 216,128 L 216,160" fill="none" stroke="black"></path>
                          <path d="M 216,224 L 216,256" fill="none" stroke="black"></path>
                          <path d="M 216,320 L 216,352" fill="none" stroke="black"></path>
                          <path d="M 232,128 L 232,160" fill="none" stroke="black"></path>
                          <path d="M 232,224 L 232,256" fill="none" stroke="black"></path>
                          <path d="M 232,320 L 232,352" fill="none" stroke="black"></path>
                          <path d="M 280,168 L 280,216" fill="none" stroke="black"></path>
                          <path d="M 328,128 L 328,160" fill="none" stroke="black"></path>
                          <path d="M 328,224 L 328,256" fill="none" stroke="black"></path>
                          <path d="M 328,320 L 328,352" fill="none" stroke="black"></path>
                          <path d="M 120,32 L 216,32" fill="none" stroke="black"></path>
                          <path d="M 120,64 L 216,64" fill="none" stroke="black"></path>
                          <path d="M 8,128 L 104,128" fill="none" stroke="black"></path>
                          <path d="M 120,128 L 216,128" fill="none" stroke="black"></path>
                          <path d="M 232,128 L 328,128" fill="none" stroke="black"></path>
                          <path d="M 8,160 L 104,160" fill="none" stroke="black"></path>
                          <path d="M 120,160 L 216,160" fill="none" stroke="black"></path>
                          <path d="M 232,160 L 328,160" fill="none" stroke="black"></path>
                          <path d="M 8,224 L 104,224" fill="none" stroke="black"></path>
                          <path d="M 120,224 L 216,224" fill="none" stroke="black"></path>
                          <path d="M 232,224 L 328,224" fill="none" stroke="black"></path>
                          <path d="M 8,256 L 104,256" fill="none" stroke="black"></path>
                          <path d="M 120,256 L 216,256" fill="none" stroke="black"></path>
                          <path d="M 232,256 L 328,256" fill="none" stroke="black"></path>
                          <path d="M 8,320 L 104,320" fill="none" stroke="black"></path>
                          <path d="M 120,320 L 216,320" fill="none" stroke="black"></path>
                          <path d="M 232,320 L 328,320" fill="none" stroke="black"></path>
                          <path d="M 8,352 L 104,352" fill="none" stroke="black"></path>
                          <path d="M 120,352 L 216,352" fill="none" stroke="black"></path>
                          <path d="M 232,352 L 328,352" fill="none" stroke="black"></path>
                          <path d="M 100,168 L 124,216" fill="none" stroke="black"></path>
                          <path d="M 212,264 L 236,312" fill="none" stroke="black"></path>
                          <path d="M 212,72 L 236,120" fill="none" stroke="black"></path>
                          <path d="M 100,120 L 124,72" fill="none" stroke="black"></path>
                          <path d="M 100,312 L 124,264" fill="none" stroke="black"></path>
                          <polygon class="arrowhead" fill="black" points="288,216 276,210.4 276,221.6" transform="rotate(90,280,216)"></polygon>
                          <polygon class="arrowhead" fill="black" points="244,312 232,306.4 232,317.6" transform="rotate(63.43494882292201,236,312)"></polygon>
                          <polygon class="arrowhead" fill="black" points="244,120 232,114.4 232,125.6" transform="rotate(63.43494882292201,236,120)"></polygon>
                          <polygon class="arrowhead" fill="black" points="176,312 164,306.4 164,317.6" transform="rotate(90,168,312)"></polygon>
                          <polygon class="arrowhead" fill="black" points="176,216 164,210.4 164,221.6" transform="rotate(90,168,216)"></polygon>
                          <polygon class="arrowhead" fill="black" points="176,120 164,114.4 164,125.6" transform="rotate(90,168,120)"></polygon>
                          <polygon class="arrowhead" fill="black" points="132,216 120,210.4 120,221.6" transform="rotate(63.43494882292201,124,216)"></polygon>
                          <polygon class="arrowhead" fill="black" points="108,312 96,306.4 96,317.6" transform="rotate(116.56505117707799,100,312)"></polygon>
                          <polygon class="arrowhead" fill="black" points="108,120 96,114.4 96,125.6" transform="rotate(116.56505117707799,100,120)"></polygon>
                          <polygon class="arrowhead" fill="black" points="64,216 52,210.4 52,221.6" transform="rotate(90,56,216)"></polygon>
                          <g class="text">
                            <text x="248" y="52">depth</text>
                            <text x="288" y="52">i-3</text>
                            <text x="280" y="148">Y</text>
                            <text x="360" y="148">depth</text>
                            <text x="400" y="148">i-2</text>
                            <text x="56" y="244">X</text>
                            <text x="280" y="244">X</text>
                            <text x="360" y="244">depth</text>
                            <text x="400" y="244">i-1</text>
                            <text x="360" y="340">depth</text>
                            <text x="392" y="340">i</text>
                          </g>
                        </svg><a class="pilcrow" href="#section-5.3-2.1.1.2.3.3.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-pruning-the-valid_policy_gr">Pruning the valid_policy_graph</a>
                    </figcaption></figure>
</div>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt>(e)</dt>
<dd id="section-5.3-2.1.2">
              <p id="section-5.3-2.1.2.1">If the certificate policies extension is not present, set the
            <code>valid_policy_graph</code> to NULL.<a class="pilcrow" href="#section-5.3-2.1.2.1">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt>(f)</dt>
<dd id="section-5.3-2.1.3">
              <p id="section-5.3-2.1.3.1">Verify that either <code>explicit_policy</code> is greater than 0
            or the <code>valid_policy_graph</code> is not equal to NULL.<a class="pilcrow" href="#section-5.3-2.1.3.1">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</blockquote>
<p id="section-5.3-3">The text following step (f) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.3">Section 6.1.3</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>, beginning with "If any of steps (a), (b), (c), or (f) fails", is left unmodified.<a class="pilcrow" href="#section-5.3-3">¶</a></p>
</section>
</div>
<div id="updates-to-section-614">
<section id="section-5.4">
        <h3 id="name-updates-to-section-614">
<a class="section-number selfRef" href="#section-5.4">5.4. </a><a class="section-name selfRef" href="#name-updates-to-section-614">Updates to Section 6.1.4</a>
        </h3>
<p id="section-5.4-1">The following replaces step (b) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.4">Section 6.1.4</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>:<a class="pilcrow" href="#section-5.4-1">¶</a></p>
<blockquote id="section-5.4-2">
          <span class="break"></span><dl class="olPercent" id="section-5.4-2.1">
<dt>(b)</dt>
<dd id="section-5.4-2.1.1">
              <p id="section-5.4-2.1.1.1">If a policy mappings extension is present, then for each issuerDomainPolicy ID-P in the policy mappings extension:<a class="pilcrow" href="#section-5.4-2.1.1.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.4-2.1.1.2">
<dt>(1)</dt>
<dd id="section-5.4-2.1.1.2.1">
                  <p id="section-5.4-2.1.1.2.1.1">If the <code>policy_mapping</code> variable is greater than 0 and there is a
node in the <code>valid_policy_graph</code> of depth i where ID-P is the
<code>valid_policy</code>, set <code>expected_policy_set</code> to the set of
subjectDomainPolicy values that are specified as
equivalent to ID-P by the policy mappings extension.<a class="pilcrow" href="#section-5.4-2.1.1.2.1.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(2)</dt>
<dd id="section-5.4-2.1.1.2.2">
                  <p id="section-5.4-2.1.1.2.2.1">If the <code>policy_mapping</code> variable is greater than 0 and 
no node of depth i in the <code>valid_policy_graph</code> has a
<code>valid_policy</code> of ID-P but there is a node of depth i with a
<code>valid_policy</code> of anyPolicy, then generate a child node of
the node of depth i-1 that has a <code>valid_policy</code> of anyPolicy
as follows:<a class="pilcrow" href="#section-5.4-2.1.1.2.2.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.4-2.1.1.2.2.2">
<dt>(i)</dt>
<dd id="section-5.4-2.1.1.2.2.2.1">
                      <p id="section-5.4-2.1.1.2.2.2.1.1">set the <code>valid_policy</code> to ID-P;<a class="pilcrow" href="#section-5.4-2.1.1.2.2.2.1.1">¶</a></p>
</dd>
                    <dd class="break"></dd>
<dt>(ii)</dt>
<dd id="section-5.4-2.1.1.2.2.2.2">
                      <p id="section-5.4-2.1.1.2.2.2.2.1">set the <code>qualifier_set</code> to the qualifier set of the
policy anyPolicy in the certificate policies
extension of certificate i; and<a class="pilcrow" href="#section-5.4-2.1.1.2.2.2.2.1">¶</a></p>
</dd>
                    <dd class="break"></dd>
<dt>(iii)</dt>
<dd id="section-5.4-2.1.1.2.2.2.3">
                      <p id="section-5.4-2.1.1.2.2.2.3.1">set the <code>expected_policy_set</code> to the set of
subjectDomainPolicy values that are specified as
equivalent to ID-P by the policy mappings extension.<a class="pilcrow" href="#section-5.4-2.1.1.2.2.2.3.1">¶</a></p>
</dd>
                  <dd class="break"></dd>
</dl>
</dd>
                <dd class="break"></dd>
<dt>(3)</dt>
<dd id="section-5.4-2.1.1.2.3">
                  <p id="section-5.4-2.1.1.2.3.1">If the <code>policy_mapping</code> variable is equal to 0:<a class="pilcrow" href="#section-5.4-2.1.1.2.3.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.4-2.1.1.2.3.2">
<dt>(i)</dt>
<dd id="section-5.4-2.1.1.2.3.2.1">
                      <p id="section-5.4-2.1.1.2.3.2.1.1">delete the node, if any, of depth i in the <code>valid_policy_graph</code> where ID-P is the <code>valid_policy</code>.<a class="pilcrow" href="#section-5.4-2.1.1.2.3.2.1.1">¶</a></p>
</dd>
                    <dd class="break"></dd>
<dt>(ii)</dt>
<dd id="section-5.4-2.1.1.2.3.2.2">
                      <p id="section-5.4-2.1.1.2.3.2.2.1">If there is a node in the <code>valid_policy_graph</code> of depth
i-1 or less without any child nodes, delete that
node.  Repeat this step until there are no nodes of
depth i-1 or less without children.<a class="pilcrow" href="#section-5.4-2.1.1.2.3.2.2.1">¶</a></p>
</dd>
                  <dd class="break"></dd>
</dl>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
</dl>
</blockquote>
</section>
</div>
<div id="updates-to-section-615">
<section id="section-5.5">
        <h3 id="name-updates-to-section-615">
<a class="section-number selfRef" href="#section-5.5">5.5. </a><a class="section-name selfRef" href="#name-updates-to-section-615">Updates to Section 6.1.5</a>
        </h3>
<p id="section-5.5-1">The following replaces step (g) in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.5">Section 6.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>:<a class="pilcrow" href="#section-5.5-1">¶</a></p>
<blockquote id="section-5.5-2">
          <span class="break"></span><dl class="olPercent" id="section-5.5-2.1">
<dt>(g)</dt>
<dd id="section-5.5-2.1.1">
              <p id="section-5.5-2.1.1.1">Calculate the <code>user_constrained_policy_set</code> as follows.
The <code>user_constrained_policy_set</code> is a set of policy OIDs, along with associated policy qualifiers.<a class="pilcrow" href="#section-5.5-2.1.1.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.5-2.1.1.2">
<dt>(1)</dt>
<dd id="section-5.5-2.1.1.2.1">
                  <p id="section-5.5-2.1.1.2.1.1">If the <code>valid_policy_graph</code> is NULL, set <code>valid_policy_node_set</code> to the empty set.<a class="pilcrow" href="#section-5.5-2.1.1.2.1.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(2)</dt>
<dd id="section-5.5-2.1.1.2.2">
                  <p id="section-5.5-2.1.1.2.2.1">If the <code>valid_policy_graph</code> is not NULL, set <code>valid_policy_node_set</code> to the set of policy nodes
whose <code>valid_policy</code> is not anyPolicy and
whose parent list is a single node with <code>valid_policy</code> of anyPolicy.<a class="pilcrow" href="#section-5.5-2.1.1.2.2.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(3)</dt>
<dd id="section-5.5-2.1.1.2.3">
                  <p id="section-5.5-2.1.1.2.3.1">If the <code>valid_policy_graph</code> is not NULL and contains a node of depth n with the <code>valid_policy</code> anyPolicy, add it to <code>valid_policy_node_set</code>.<a class="pilcrow" href="#section-5.5-2.1.1.2.3.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(4)</dt>
<dd id="section-5.5-2.1.1.2.4">
                  <p id="section-5.5-2.1.1.2.4.1">Compute <code>authority_constrained_policy_set</code>, a set of policy OIDs and associated qualifiers as follows. For each node in <code>valid_policy_node_set</code>:<a class="pilcrow" href="#section-5.5-2.1.1.2.4.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.5-2.1.1.2.4.2">
<dt>(i)</dt>
<dd id="section-5.5-2.1.1.2.4.2.1">
                      <p id="section-5.5-2.1.1.2.4.2.1.1">Add the node's <code>valid_policy</code> to <code>authority_constrained_policy_set</code>.<a class="pilcrow" href="#section-5.5-2.1.1.2.4.2.1.1">¶</a></p>
</dd>
                    <dd class="break"></dd>
<dt>(ii)</dt>
<dd id="section-5.5-2.1.1.2.4.2.2">
                      <p id="section-5.5-2.1.1.2.4.2.2.1">Collect all qualifiers in the node, its ancestors, and descendants and associate them with <code>valid_policy</code>. Applications that do not use policy qualifiers <span class="bcp14">MAY</span> skip this step to simplify processing.<a class="pilcrow" href="#section-5.5-2.1.1.2.4.2.2.1">¶</a></p>
</dd>
                  <dd class="break"></dd>
</dl>
</dd>
                <dd class="break"></dd>
<dt>(5)</dt>
<dd id="section-5.5-2.1.1.2.5">
                  <p id="section-5.5-2.1.1.2.5.1">Set <code>user_constrained_policy_set</code> to <code>authority_constrained_policy_set</code>.<a class="pilcrow" href="#section-5.5-2.1.1.2.5.1">¶</a></p>
</dd>
                <dd class="break"></dd>
<dt>(6)</dt>
<dd id="section-5.5-2.1.1.2.6">
                  <p id="section-5.5-2.1.1.2.6.1">If the user-initial-policy-set is not anyPolicy:<a class="pilcrow" href="#section-5.5-2.1.1.2.6.1">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-5.5-2.1.1.2.6.2">
<dt>(i)</dt>
<dd id="section-5.5-2.1.1.2.6.2.1">
                      <p id="section-5.5-2.1.1.2.6.2.1.1">Remove any elements of <code>user_constrained_policy_set</code> that do not appear in user-initial-policy-set.<a class="pilcrow" href="#section-5.5-2.1.1.2.6.2.1.1">¶</a></p>
</dd>
                    <dd class="break"></dd>
<dt>(ii)</dt>
<dd id="section-5.5-2.1.1.2.6.2.2">
                      <p id="section-5.5-2.1.1.2.6.2.2.1">If anyPolicy appears in <code>authority_constrained_policy_set</code> with qualifiers AP-Q, for each OID P-OID in user-initial-policy-set that does not appear in <code>user_constrained_policy_set</code>, add P-OID with qualifiers AP-Q to <code>user_constrained_policy_set</code>.<a class="pilcrow" href="#section-5.5-2.1.1.2.6.2.2.1">¶</a></p>
</dd>
                  <dd class="break"></dd>
</dl>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
</dl>
</blockquote>
<p id="section-5.5-3">In addition, the final paragraph in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.5">Section 6.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> is updated as follows:<a class="pilcrow" href="#section-5.5-3">¶</a></p>
<p id="section-5.5-4">OLD:<a class="pilcrow" href="#section-5.5-4">¶</a></p>
<blockquote id="section-5.5-5">
          <p id="section-5.5-5.1">If either (1) the value of <code>explicit_policy</code>
        variable is greater than zero or (2) the <code>valid_policy_tree</code> is
        not NULL, then path processing has succeeded.<a class="pilcrow" href="#section-5.5-5.1">¶</a></p>
</blockquote>
<p id="section-5.5-6">NEW:<a class="pilcrow" href="#section-5.5-6">¶</a></p>
<blockquote id="section-5.5-7">
          <p id="section-5.5-7.1">If either (1) the value of <code>explicit_policy</code> is
        greater than zero, or (2) the <code>user_constrained_policy_set</code> is
        not empty, then path processing has succeeded.<a class="pilcrow" href="#section-5.5-7.1">¶</a></p>
</blockquote>
</section>
</div>
<div id="update-outputs">
<section id="section-5.6">
        <h3 id="name-updates-to-section-616">
<a class="section-number selfRef" href="#section-5.6">5.6. </a><a class="section-name selfRef" href="#name-updates-to-section-616">Updates to Section 6.1.6</a>
        </h3>
<p id="section-5.6-1">The following replaces <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.6">Section 6.1.6</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>:<a class="pilcrow" href="#section-5.6-1">¶</a></p>
<blockquote id="section-5.6-2">
          <p id="section-5.6-2.1">If path processing succeeds, the procedure terminates, returning
          a success indication together with the final value of the
          <code>user_constrained_policy_set</code>, the
          <code>working_public_key</code>, the
          <code>working_public_key_algorithm</code>, and the
          <code>working_public_key_parameters</code>.<a class="pilcrow" href="#section-5.6-2.1">¶</a></p>
<p id="section-5.6-2.2">Note that the original procedure described in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> included a <code>valid_policy_tree</code> structure
          as part of the output. This structure grows exponentially in the
          size of the input, so computing it risks denial-of-service
          vulnerabilities in X.509-based applications, such as <span>[<a class="cite xref" href="#CVE-2023-0464">CVE-2023-0464</a>]</span> and <span>[<a class="cite xref" href="#CVE-2023-23524">CVE-2023-23524</a>]</span>. Accordingly, this output is
          deprecated. Computing this structure is <span class="bcp14">NOT RECOMMENDED</span>.<a class="pilcrow" href="#section-5.6-2.2">¶</a></p>
<p id="section-5.6-2.3">An implementation that requires <code>valid_policy_tree</code> for
          compatibility with legacy systems may compute it from
          <code>valid_policy_graph</code> by recursively duplicating every
          multi-parent node. This may be done on-demand when the calling
          application first requests this output. However, this computation
          may consume exponential time and memory, so such implementations
          <span class="bcp14">SHOULD</span> mitigate denial-of-service attacks in other ways, such
          as by limiting the depth or size of the tree.<a class="pilcrow" href="#section-5.6-2.3">¶</a></p>
</blockquote>
</section>
</div>
</section>
</div>
<div id="other-mitigations">
<section id="section-6">
      <h2 id="name-other-mitigations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-other-mitigations">Other Mitigations</a>
      </h2>
<p id="section-6-1">X.509 implementations that are unable to switch to the policy graph structure
<span class="bcp14">SHOULD</span> mitigate the denial-of-service attack in other ways. This section
describes alternate mitigation and partial mitigation strategies.<a class="pilcrow" href="#section-6-1">¶</a></p>
<div id="verify-signatures-first">
<section id="section-6.1">
        <h3 id="name-verify-signatures-first">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-verify-signatures-first">Verify Signatures First</a>
        </h3>
<p id="section-6.1-1">X.509 validators <span class="bcp14">SHOULD</span> verify signatures in certification paths before or in
conjunction with policy verification. This limits the attack to entities in
control of CA certificates. For some applications, this may be sufficient to
mitigate the attack. However, other applications may still be impacted, for
example:<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">Any application that evaluates an untrusted PKI, such as a
            hosting provider that evaluates a customer-supplied PKI<a class="pilcrow" href="#section-6.1-2.1.1">¶</a></p>
</li>
          <li class="normal" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">Any application that evaluates an otherwise trusted PKI that
            includes untrusted entities with technically constrained
            intermediate certificates. If the intermediates do not constrain
            policy mapping or path length, those entities may be able to
            perform this attack.<a class="pilcrow" href="#section-6.1-2.2.1">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="limit-certificate-depth">
<section id="section-6.2">
        <h3 id="name-limit-certificate-depth">
<a class="section-number selfRef" href="#section-6.2">6.2. </a><a class="section-name selfRef" href="#name-limit-certificate-depth">Limit Certificate Depth</a>
        </h3>
<p id="section-6.2-1">The policy tree grows exponentially in the depth of a certification
        path, so limiting the depth and certificate size can mitigate the
        attack.<a class="pilcrow" href="#section-6.2-1">¶</a></p>
<p id="section-6.2-2">However, this option may not be viable for all applications. Too
        low of a limit may reject existing paths that the application wishes
        to accept. Too high of a limit may still admit a denial-of-service attack for the
        application. By modifying the example in <a class="auto internal xref" href="#exponential-growth">Section 3.2</a> to increase the number of policies
        asserted in each certificate, an attacker could still achieve
        O(N<sup>(depth/2)</sup>) scaling.<a class="pilcrow" href="#section-6.2-2">¶</a></p>
</section>
</div>
<div id="limit-policy-tree-size">
<section id="section-6.3">
        <h3 id="name-limit-policy-tree-size">
<a class="section-number selfRef" href="#section-6.3">6.3. </a><a class="section-name selfRef" href="#name-limit-policy-tree-size">Limit Policy Tree Size</a>
        </h3>
<p id="section-6.3-1">The attack can be mitigated by limiting the number of nodes in the
        policy tree and rejecting the certification path if this limit is
        reached. This limit should be set high enough to still admit existing
        valid certification paths for the application but low enough to no
        longer admit a denial-of-service attack.<a class="pilcrow" href="#section-6.3-1">¶</a></p>
</section>
</div>
<div id="inhibit-policy-mapping">
<section id="section-6.4">
        <h3 id="name-inhibit-policy-mapping">
<a class="section-number selfRef" href="#section-6.4">6.4. </a><a class="section-name selfRef" href="#name-inhibit-policy-mapping">Inhibit Policy Mapping</a>
        </h3>
<p id="section-6.4-1">If policy mapping is disabled via the initial-policy-mapping-inhibit setting
(see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-6.1.1">Section 6.1.1</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>), the attack is mitigated. This also
significantly simplifies the X.509 implementation, which reduces the risk of
other security bugs. However, this will break compatibility with any existing
certification paths that rely on policy mapping.<a class="pilcrow" href="#section-6.4-1">¶</a></p>
<p id="section-6.4-2">To facilitate this mitigation, certificate authorities <span class="bcp14">SHOULD NOT</span> issue
certificates with the policy mappings extension (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.5">Section 4.2.1.5</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>). Applications maintaining policies for accepted trust anchors are
<span class="bcp14">RECOMMENDED</span> to forbid this extension in participating certificate authorities.<a class="pilcrow" href="#section-6.4-2">¶</a></p>
</section>
</div>
<div id="disable-policy-checking">
<section id="section-6.5">
        <h3 id="name-disable-policy-checking">
<a class="section-number selfRef" href="#section-6.5">6.5. </a><a class="section-name selfRef" href="#name-disable-policy-checking">Disable Policy Checking</a>
        </h3>
<p id="section-6.5-1">An X.509 validator can mitigate this attack by disabling policy validation
entirely. This may be viable for applications that do not require policy
validation. In this case, critical policy-related extensions, notably the policy
constraints extension (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.11">Section 4.2.1.11</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span>), <span class="bcp14">MUST</span> be treated as unrecognized
extensions as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc5280#section-4.2">Section 4.2</a> of [<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> and be rejected.<a class="pilcrow" href="#section-6.5-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-7-1"><a class="auto internal xref" href="#dos">Section 3</a> discusses how the policy
      tree algorithm in <span>[<a class="cite xref" href="#RFC5280">RFC5280</a>]</span> can lead to denial-of-service vulnerabilities in
      X.509-based applications, such as <span>[<a class="cite xref" href="#CVE-2023-0464">CVE-2023-0464</a>]</span> and
      <span>[<a class="cite xref" href="#CVE-2023-23524">CVE-2023-23524</a>]</span>.<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2"><a class="auto internal xref" href="#updates">Section 5</a> replaces this algorithm to avoid this
      issue. As discussed in <a class="auto internal xref" href="#policy-graph">Section 4.1</a>, the new structure
      scales linearly with the input. This means input limits in X.509
      validators will more naturally bound processing time, thus avoiding
      these vulnerabilities.<a class="pilcrow" href="#section-7-2">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a class="pilcrow" href="#section-8-1">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time class="refDate" datetime="2008-05">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="CVE-2023-0464">[CVE-2023-0464]</dt>
        <dd>
<span class="refAuthor">CVE</span>, <span class="refTitle">"Excessive Resource Usage Verifying X.509 Policy Constraints"</span>, <span class="refContent">CVE-2023-0464</span>, <time class="refDate" datetime="2023-03">March 2023</time>, <span>&lt;<a href="https://www.cve.org/CVERecord?id=CVE-2023-0464">https://www.cve.org/CVERecord?id=CVE-2023-0464</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CVE-2023-23524">[CVE-2023-23524]</dt>
        <dd>
<span class="refAuthor">CVE</span>, <span class="refTitle">"Processing a maliciously crafted certificate may lead to a denial-of-service"</span>, <span class="refContent">CVE-2023-23524</span>, <time class="refDate" datetime="2023-02">February 2023</time>, <span>&lt;<a href="https://www.cve.org/CVERecord?id=CVE-2023-23524">https://www.cve.org/CVERecord?id=CVE-2023-23524</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X.509">[X.509]</dt>
      <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology - Open Systems Interconnection - The Directory: Public-key and attribute certificate frameworks"</span>, <span class="seriesInfo">ITU-T Recommendation X.509</span>, <time class="refDate" datetime="2019-10">October 2019</time>, <span>&lt;<a href="https://www.itu.int/rec/T-REC-X.509">https://www.itu.int/rec/T-REC-X.509</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The author thanks <span class="contact-name">Bob Beck</span>, <span class="contact-name">Adam Langley</span>, <span class="contact-name">Matt Mueller</span>, and
      <span class="contact-name">Ryan Sleevi</span> for many valuable discussions that led
      to discovering this issue, understanding it, and developing the
      mitigation. The author also thanks <span class="contact-name">Martin Thomson</span>,
      <span class="contact-name">Job Snijders</span>, and <span class="contact-name">John       Scudder</span> for their review and feedback on this document.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a class="section-name selfRef" href="#name-authors-address">Author's Address</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">David Benjamin</span></div>
<div class="left" dir="auto"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:davidben@google.com">davidben@google.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>