<html><head></head><body><pre>Internet Engineering Task Force (IETF)                      J. Bournelle
Request for Comments: 6942                                     L. Morand
Category: Standards Track                                    Orange Labs
ISSN: 2070-1721                                               S. Decugis
                                                           INSIDE Secure
                                                                   Q. Wu
                                                                  Huawei
                                                                 G. Zorn
                                                             Network Zen
                                                                May 2013


     <span class="h1">Diameter Support for the EAP Re-authentication Protocol (ERP)</span>

Abstract

   The EAP Re-authentication Protocol (ERP) defines extensions to the
   Extensible Authentication Protocol (EAP) to support efficient
   re-authentication between the peer and an EAP Re-authentication (ER)
   server through a compatible authenticator.  This document specifies
   Diameter support for ERP.  It defines a new Diameter ERP application
   to transport ERP messages between an ER authenticator and the ER
   server, and a set of new Attribute-Value Pairs (AVPs) that can be
   used to transport the cryptographic material needed by the
   re-authentication server.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6942">http://www.rfc-editor.org/info/rfc6942</a>.












<span class="grey">Bournelle, et al.            Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-2.1">2.1</a>.  Requirements Language . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Assumptions . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Protocol Overview . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  Bootstrapping the ER Server . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-5.1">5.1</a>.  Bootstrapping during the Initial EAP Authentication . . .   <a href="#page-6">6</a>
     <a href="#section-5.2">5.2</a>.  Bootstrapping during the First Re-authentication  . . . .   <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Re-authentication . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  Application Id  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-8">8</a>.  AVPs  . . . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-8.1">8.1</a>.  ERP-RK-Request AVP  . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-8.2">8.2</a>.  ERP-Realm AVP . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-8.3">8.3</a>.  Key AVP . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-8.3.1">8.3.1</a>.  Key-Type AVP  . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-8.3.2">8.3.2</a>.  Keying-Material AVP . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-8.3.3">8.3.3</a>.  Key-Name AVP  . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
       <a href="#section-8.3.4">8.3.4</a>.  Key-Lifetime AVP  . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-9">9</a>.  Result-Code AVP Values  . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-9.1">9.1</a>.  Permanent Failures  . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-10">10</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-10.1">10.1</a>.  Diameter Application Identifier  . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-10.2">10.2</a>.  New AVPs . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-10.3">10.3</a>.  New Permanent Failures Result-Code AVP Values  . . . . .  <a href="#page-15">15</a>
   <a href="#section-11">11</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-12">12</a>. Contributors  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-13">13</a>. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-14">14</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-14.1">14.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-14.2">14.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>




<span class="grey">Bournelle, et al.            Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   Cao, et al. [<a href="./rfc6696" title='"EAP Extensions for the EAP Re-authentication Protocol (ERP)"'>RFC6696</a>] defines the EAP Re-authentication Protocol
   (ERP).  It consists of the following steps:

   Bootstrapping

      A root key for re-authentication is derived from the Extended
      Master Session Key (EMSK) created during EAP authentication
      [<a href="./rfc5295" title='"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)"'>RFC5295</a>].  This root key is transported from the EAP server to
      the ER server.

   Re-authentication

      A one-round-trip exchange between the peer and the ER server,
      resulting in mutual authentication.  To support the EAP
      re-authentication functionality, ERP defines two new EAP codes --
      EAP-Initiate and EAP-Finish.

   This document defines how Diameter transports the ERP messages during
   the re-authentication process.  For this purpose, we define a new
   Application Identifier for ERP and reuse the Diameter EAP commands
   Diameter-EAP-Request (DER) / Diameter-EAP-Answer (DEA).

   This document also discusses the distribution of the root key during
   bootstrapping, in conjunction with either the initial EAP
   authentication (implicit bootstrapping) or the first ERP exchange
   (explicit bootstrapping).  Security considerations for this key
   distribution are detailed in <a href="#section-7.4">Section 7.4</a> of Salowey, et al.
   [<a href="./rfc5295" title='"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)"'>RFC5295</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   This document uses terminology defined in Aboba, et al. [<a href="./rfc3748" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>],
   Salowey, et al. [<a href="./rfc5295" title='"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)"'>RFC5295</a>], Cao, et al. [<a href="./rfc6696" title='"EAP Extensions for the EAP Re-authentication Protocol (ERP)"'>RFC6696</a>], and Eronen, et al.
   [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].

   Following <a href="./rfc5295">RFC 5295</a>, the term "domain" herein refers to a key
   management domain unless otherwise qualified.  Similarly, the terms
   "home domain" and "local domain" have the same meaning here as in <a href="./rfc6696">RFC</a>
   <a href="./rfc6696">6696</a>.

   The re-authentication Domain-Specific Root Key (rDSRK) is a
   re-authentication Root Key (rRK) [<a href="./rfc6696" title='"EAP Extensions for the EAP Re-authentication Protocol (ERP)"'>RFC6696</a>] derived from the Domain-
   Specific Root Key (DSRK) instead of the EMSK.






<span class="grey">Bournelle, et al.            Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   "Root key" (RK) or "bootstrapping material" refers to the rRK or
   rDSRK derived from an EMSK, depending on whether the ER server is
   located in the home or a foreign domain.

   We use the notation "ERP/DER" and "ERP/DEA" in this document to refer
   to Diameter-EAP-Request and Diameter-EAP-Answer commands with the
   Application Id set to &lt;Diameter ERP&gt; (<a href="#section-10.1">Section 10.1</a>); the same
   commands are denoted "EAP/DER" and "EAP/DEA" when the Application Id
   in the message is set to &lt;Diameter EAP&gt; [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Assumptions"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Assumptions</span>

   This document assumes the existence of, at most, one logical ER
   server entity in a given domain.  If several physical servers are
   deployed for robustness, a replication mechanism must be deployed to
   synchronize the ERP state (e.g., root keys) between these servers.
   Any such replication mechanism is outside the scope of this document.
   If multiple ER servers are deployed in the domain, we assume that
   they can be used interchangeably.  If multiple ER servers are
   deployed across multiple domains, we assume that only one ER server,
   topologically close to the peer, is involved in ERP, with distance
   being measured in terms of Diameter hops.

   This document also assumes the existence of, at most, one EAP server
   entity in the home domain.  In case of multiple physical home EAP
   servers, if the ER server wants to reach the same home EAP server,
   the ER server SHOULD cache the Destination-Host AVP corresponding to
   the home EAP server it requests.

   In general, it is assumed that key management domain names and
   Diameter realm names are identical for any given domain/realm.














<span class="grey">Bournelle, et al.            Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Protocol%20Overview"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Protocol Overview</span>

   The following figure illustrates the components involved in ERP and
   their interactions.

                           Diameter                    +--------+
           +-------------+   ERP   +-----------+  (*)  |  Home  |
   Peer &lt;-&gt;|Authenticator|&lt;=======&gt;| ER server | &lt;---&gt; |  EAP   |
           +-------------+         +-----------+       | server |
                                                       +--------+
   (*) Diameter EAP application; explicit bootstrapping scenario only.

                      Figure 1: Diameter ERP Overview

   The ER server is located either in the home domain (same as the EAP
   server) or in the local domain (same as the authenticator, when it
   differs from the home domain).

   When the peer initiates an ERP exchange, the authenticator creates a
   DER message [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].  The Application Id of the message is set to
   that of the Diameter ERP application (<a href="#section-10.1">Section 10.1</a>) in the message.
   The generation of the ERP/DER message is detailed in <a href="#section-6">Section 6</a>.

   If there is an ER server in the same domain as the authenticator
   (i.e., the local domain), Diameter routing MUST be configured so that
   this ERP/DER message reaches that server, even if the Destination-
   Realm is not the same as the local domain.

   If there is no local ER server, the message is routed according to
   its Destination-Realm AVP content, extracted from the realm component
   of the keyName-NAI attribute.  As specified in <a href="./rfc6696">RFC 6696</a>, this realm
   is the home domain of the peer in the case of bootstrapping exchange
   ('B' flag is set in ERP message) or the domain of the bootstrapped ER
   server otherwise.

   If no ER server is available in the home domain either, the ERP/DER
   message cannot be delivered and an error, DIAMETER_UNABLE_TO_DELIVER,
   MUST be generated, as specified in <a href="./rfc6733">RFC 6733</a>, and returned to the
   authenticator.  The authenticator MAY cache this information (with
   limited duration) to avoid further attempts to execute ERP with this
   realm.  It MAY also fallback to full EAP authentication to
   authenticate the peer.

   When an ER server receives the ERP/DER message, it searches its local
   database for a valid, unexpired root key matching the keyName part of
   the User-Name AVP.  If such key is found, the ER server processes the





<span class="grey">Bournelle, et al.            Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   ERP message, as described in <a href="./rfc6696">RFC 6696</a>, then creates the ERP/DEA
   answer, as described in <a href="#section-6">Section 6</a>.  The re-authentication Master
   Session Key (rMSK) is included in this answer.

   Finally, the authenticator extracts the rMSK from the ERP/DEA, as
   described in <a href="./rfc6696">RFC 6696</a>, and forwards the content of the EAP-Payload
   AVP, the EAP-Finish/Re-auth message, to the peer.

   The ER server may or may not possess the root key in its local
   database.  If the EAP-Initiate/Re-auth message has its 'B' flag set
   (bootstrapping exchange) and the ER server possesses the root key,
   the ER server SHOULD respond directly to the peer that initiated the
   ERP exchange.  Otherwise, the ER server SHOULD act as a proxy and
   forward the message to the home EAP server after changing its
   Application Id to Diameter EAP and adding the ERP-RK-Request AVP to
   request the root key.  See <a href="#section-5">Section 5</a> for more detail on this process.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Bootstrapping%20the%20ER%20Server"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Bootstrapping the ER Server</span>

   The bootstrapping process involves the home EAP server and the ER
   server, but also impacts the peer and the authenticator.  In ERP, the
   peer must derive the same keying material as the ER server.  To
   achieve this, it must learn the domain name of the ER server.  How
   this information is acquired is outside the scope of this
   specification, but the authenticator might be configured to advertise
   this domain name, especially in the case of re-authentication after a
   handover.

   The bootstrapping of an ER server with a given root key happens
   either during the initial EAP authentication of the peer when the
   EMSK -- from which the root key is derived -- is created, during the
   first re-authentication, or sometime between those events.  We only
   consider the first two possibilities in this specification, in the
   following subsections.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20Bootstrapping%20during%20the%20Initial%20EAP%20Authentication"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Bootstrapping during the Initial EAP Authentication</span>

   Bootstrapping the ER server during the initial EAP authentication
   (also known as implicit bootstrapping) offers the advantage that the
   server is immediately available for re-authentication of the peer,
   thus minimizing the re-authentication delay.  On the other hand, it
   is possible that only a small number of peers will use
   re-authentication in the local domain.  Deriving and caching key
   material for all the peers (for example, for the peers that do not
   support ERP) is a waste of resources and should be avoided.






<span class="grey">Bournelle, et al.            Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   To achieve implicit bootstrapping, the ER server acts as a Diameter
   EAP Proxy, and Diameter routing MUST be configured so that Diameter
   EAP application messages are routed through this proxy.  The figure
   below illustrates this mechanism.

                            ER server &amp;
   Authenticator             EAP Proxy               Home EAP server
   =============            ===========              ===============
        -------------------------&gt;
            Diameter EAP/DER
             (EAP-Response)
                                  -------------------------&gt;
                                     Diameter EAP/DER
                                      (EAP-Response)
                                     (ERP-RK-Request)

        &lt;==================================================&gt;
           Multi-round Diameter EAP exchanges, unmodified

                                  &lt;-------------------------
                                      Diameter EAP/DEA
                                       (EAP-Success)
                                           (MSK)
                                      (Key AVP (rRK))
        &lt;-------------------------
            Diameter EAP/DEA
              (EAP-Success)
                  (MSK)
               [ERP-Realm]

        Figure 2: ERP Bootstrapping during Full EAP Authentication

   The authenticator creates the first DER of the full EAP
   authentication and sends it to the ER server.  The ER server proxies
   the first DER of the full EAP authentication and adds the
   ERP-RK-Request AVP inside, then forwards the request to the home EAP
   server.

   If the home Diameter server does not support the Diameter ERP
   extensions, it simply ignores the ERP-RK-Request AVP and continues as
   specified in <a href="./rfc4072">RFC 4072</a> [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].  If the server supports the ERP
   extensions, it saves the value of the ERP-Realm AVP found inside the
   ERP-RK-Request AVP, and continues with the EAP authentication.  When
   the authentication completes, if it is successful and the EAP method
   has generated an EMSK, the server MUST derive the rRK as specified in
   <a href="./rfc6696">RFC 6696</a>, using the saved ERP realm name.  It then includes the rRK
   inside a Key AVP (<a href="#section-8.3">Section 8.3</a>) with the Key-Type AVP set to rRK,
   before sending the DEA as usual.



<span class="grey">Bournelle, et al.            Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   When the ER server proxies a Diameter-EAP-Answer message with a
   Session-Id corresponding to a message to which it added an
   ERP-RK-Request AVP, and the Result-Code is DIAMETER_SUCCESS, it MUST
   examine the message and save and remove any Key AVP (<a href="#section-8.3">Section 8.3</a>)
   with Key-Type AVP set to rRK.  If the message does not contain such a
   Key AVP, the ER server may cache the information that
   re-authentication via ERP is not possible for the session in order to
   avoid any subsequent attempts.  In any case, the information stored
   in the ER server concerning a session should not have a lifetime
   greater than the EMSK for this session.

   If the ER server is successfully bootstrapped, it should also add the
   ERP-Realm AVP after removing the Key AVP with Key-Type of rRK in the
   EAP/DEA message.  This ERP-Realm information can be used by the
   authenticator to notify the peer that the ER server is bootstrapped,
   and for which domain.  How this information can be transmitted to the
   peer is outside the scope of this document.  This information needs
   to be sent to the peer if both implicit and explicit bootstrapping
   mechanisms are possible, because the ERP message and the root key
   used for protecting this message are different in bootstrapping
   exchanges and non-bootstrapping exchanges.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20Bootstrapping%20during%20the%20First%20Re-authentication"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  Bootstrapping during the First Re-authentication</span>

   Bootstrapping the ER server during the first re-authentication (also
   known as explicit bootstrapping) is only needed when there is no ER
   server in the local domain and there is an ER server in the home
   domain.  It is less resource intensive, since the EMSK generated
   during initial EAP authentication is reused to derive root keys.  On
   the other hand, the first re-authentication requires a one-round-trip
   exchange with the home EAP server, since the EMSK is generated during
   the initial EAP authentication and never leaves the home EAP server,
   which is less efficient than implicit bootstrapping.

   The EAP-Initiate/Re-auth message is sent to the home ER server.  The
   home ER server receives the ERP/DER message containing the
   EAP-Initiate/Re-auth message with the 'B' flag set.  It creates the
   new EAP/DER message using the received ERP/DER message and performs
   the following processing:

      Set the Application Id in the header of the message to
      &lt;Diameter EAP&gt; [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].

      Extract the ERP-RK-Request AVP from the ERP/DER message, which
      contains the name of the domain where the ER server is located,
      and add it to the newly created ERP/DER message.





<span class="grey">Bournelle, et al.            Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   Then, the newly created EAP/DER is sent and routed to the home
   Diameter EAP application server.

   If the home Diameter EAP server does not support ERP extensions, EAP
   packets with an unknown ERP-specific code (EAP-Initiate) will not be
   understood.  In such a case, the home Diameter EAP server MUST send
   an EAP/DEA with a Result-Code indicating a Permanent Failure (for
   example, DIAMETER_ERROR_EAP_CODE_UNKNOWN or
   DIAMETER_UNABLE_TO_COMPLY).  The Failed-AVP AVP MUST be included and
   contain a copy of the EAP-Payload AVP.  Otherwise, it processes the
   DSRK request, as described in <a href="./rfc6696">RFC 6696</a>.  In particular, it includes
   the Domain-Name TLV attribute with the content from the ERP-Realm
   AVP.  The server creates the EAP/DEA reply message [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>],
   including an instance of the Key AVP (<a href="#section-8.3">Section 8.3</a>) with the Key-Type
   AVP set to rRK and an instance of the Domain-Name TLV attribute with
   the content from the ERP-Realm AVP.

   The ER server receives this EAP/DEA and proxies it as follows, in
   addition to standard proxy operations:

      Set the Application Id back to Diameter ERP Application Id
      (<a href="#section-10.1">Section 10.1</a>).

      Extract and cache the content of the Key AVP with Key-Type set to
      rRK, as described in <a href="#section-5.1">Section 5.1</a>).

   The ERP/DEA message is then forwarded to the authenticator that can
   use the rMSK as described in <a href="./rfc6696">RFC 6696</a>.























<span class="grey">Bournelle, et al.            Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   The figure below captures this proxy behavior:

   Authenticator            ER server             Home Diameter server
   =============            =========             ====================
         -----------------------&gt;
             Diameter ERP/DER
              (EAP-Initiate)
                                 ------------------------&gt;
                                       Diameter EAP/DER
                                        (EAP-Response)
                                       (ERP-RK-Request)

                                 &lt;------------------------
                                       Diameter EAP/DEA
                                         (EAP-Success)
                                        (Key AVP (rRK))
                                        (Key AVP (rMSK))
         &lt;----------------------
             Diameter ERP/DEA
               (EAP-Finish)
             (Key AVP (rMSK))

             Figure 3: ERP Explicit Bootstrapping Message Flow




























<span class="grey">Bournelle, et al.            Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Re-authentication"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Re-authentication</span>

   This section describes in detail a re-authentication exchange with an
   ER server that was previously bootstrapped.  The following figure
   summarizes the re-authentication exchange.

                                                       ER server
    Peer                 Authenticator                (bootstrapped)
    ====                 =============            ======================
    [ &lt;------------------------          ]
    [optional EAP-Initiate/Re-auth-start,]
    [  possibly with ERP domain name     ]

      -----------------------&gt;
        EAP-Initiate/Re-auth
                              ===============================&gt;
                                 Diameter ERP, cmd code DER
                                   User-Name: keyName-NAI
                              EAP-Payload: EAP-Initiate/Re-auth

                              &lt;===============================
                                 Diameter ERP, cmd code DEA
                               EAP-Payload: EAP-Finish/Re-auth
                                        Key AVP: rMSK
      &lt;----------------------
         EAP-Finish/Re-auth

             Figure 4: Diameter ERP Re-authentication Exchange

   The peer sends an EAP-Initiate/Re-auth message to the ER server via
   the authenticator.  Alternatively, the authenticator may send an
   EAP-Initiate/Re-auth-Start message to the peer to trigger the
   mechanism.  In this case, the peer responds with an
   EAP-Initiate/Re-auth message.

   If the authenticator does not support ERP (pure Diameter EAP
   [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>] support), it discards the EAP packets with an unknown ERP-
   specific code (EAP-Initiate).  The peer should fall back to full EAP
   authentication in this case.

   When the authenticator receives an EAP-Initiate/Re-auth message from
   the peer, the message is processed as described in <a href="./rfc6696">RFC 6696</a>, with
   regard to the EAP state machine.  It creates a Diameter ERP/DER
   message following the general process of Diameter EAP [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>], with
   the following differences:






<span class="grey">Bournelle, et al.            Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


      The Application Id in the header is set to &lt;Diameter ERP&gt;
      (code 13).

      The value in the Auth-Application-Id AVP is also set to
      &lt;Diameter ERP&gt;.

      The keyName-NAI attribute from the ERP message is used to create
      the content of the User-Name and Destination-Realm AVPs.

      The Auth-Request-Type AVP content is set to the appropriate value.

      The EAP-Payload AVP contains the EAP-Initiate/Re-auth message.

   Then, this ERP/DER message is sent as described in <a href="#section-4">Section 4</a>.

   The ER server receives and processes this request as described in
   <a href="#section-4">Section 4</a>.  It then creates an ERP/DEA message following the general
   process described in Eronen, et al. [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>], with the following
   differences:

      The Application Id in the header is set to &lt;Diameter ERP&gt;
      (code 13).

      The value of the Auth-Application-Id AVP is also set to
      &lt;Diameter ERP&gt;.

      The EAP-Payload AVP contains the EAP-Finish/Re-auth message.

      If authentication is successful, an instance of the Key AVP
      containing the rMSK derived by ERP is included.

   When the authenticator receives this ERP/DEA answer, it processes it
   as described in the Diameter EAP Application specification [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>]
   and <a href="./rfc6696">RFC 6696</a>: the content of the EAP-Payload AVP is forwarded to the
   peer, and the contents of the Keying-Material AVP [<a href="./rfc6734" title='"Diameter Attribute- Value Pairs for Cryptographic Key Transport"'>RFC6734</a>] is used
   as a shared secret for a secure association protocol specific to the
   lower layer in use.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Application%20Id"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Application Id</span>

   We define a new Diameter application in this document, Diameter ERP,
   with an Application Id value of 13.  Diameter nodes conforming to
   this specification in the role of the ER server MUST advertise
   support by including an Auth-Application-Id AVP with a value of
   Diameter ERP in the Capabilities-Exchange-Request and
   Capabilities-Exchange-Answer commands [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>].





<span class="grey">Bournelle, et al.            Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   The primary use of the Diameter ERP Application Id is to ensure
   proper routing of the messages, and that the nodes that advertise the
   support for this application do understand the new AVPs defined in
   <a href="#section-8">Section 8</a>, although these AVPs have the 'M' flag cleared.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20AVPs"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  AVPs</span>

   The following subsections discuss the AVPs used by the Diameter ERP
   application.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20ERP-RK-Request%20AVP"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  ERP-RK-Request AVP</span>

   The ERP-RK-Request AVP (AVP Code 618) is of type Grouped AVP.  This
   AVP is used by the ER server to indicate its willingness to act as
   the ER server for a particular session.

   This AVP has the 'M' and 'V' bits cleared.

         ERP-RK-Request ::= &lt; AVP Header: 618 &gt;
                            { ERP-Realm }
                          * [ AVP ]

                       Figure 5: ERP-RK-Request ABNF

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20ERP-Realm%20AVP"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  ERP-Realm AVP</span>

   The ERP-Realm AVP (AVP Code 619) is of type DiameterIdentity.  It
   contains the name of the realm in which the ER server is located.

   This AVP has the 'M' and 'V' bits cleared.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.%20%20Key%20AVP"></a><a class="selflink" href="#section-8.3" id="section-8.3">8.3</a>.  Key AVP</span>

   The Key AVP [<a href="./rfc6734" title='"Diameter Attribute- Value Pairs for Cryptographic Key Transport"'>RFC6734</a>] is of type Grouped and is used to carry the rRK
   or rMSK and associated attributes.  The usage of the Key AVP and its
   constituent AVPs in this application is specified in the following
   subsections.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.1.%20%20Key-Type%20AVP"></a><a class="selflink" href="#section-8.3.1" id="section-8.3.1">8.3.1</a>.  Key-Type AVP</span>

   The value of the Key-Type AVP MUST be set to 1 for rRK or 2 for rMSK.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.2.%20%20Keying-Material%20AVP"></a><a class="selflink" href="#section-8.3.2" id="section-8.3.2">8.3.2</a>.  Keying-Material AVP</span>

   The Keying-Material AVP contains the rRK sent by the home EAP server
   to the ER server, in answer to a request containing an ERP-RK-Request
   AVP, or the rMSK sent by the ER server to the authenticator.  How
   this material is derived and used is specified in <a href="./rfc6696">RFC 6696</a>.



<span class="grey">Bournelle, et al.            Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.3.%20%20Key-Name%20AVP"></a><a class="selflink" href="#section-8.3.3" id="section-8.3.3">8.3.3</a>.  Key-Name AVP</span>

   This AVP contains the EMSKname that identifies the keying material.
   The derivation of this name is specified in <a href="./rfc6696">RFC 6696</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.4.%20%20Key-Lifetime%20AVP"></a><a class="selflink" href="#section-8.3.4" id="section-8.3.4">8.3.4</a>.  Key-Lifetime AVP</span>

   The Key-Lifetime AVP contains the lifetime of the keying material in
   seconds.  It MUST NOT be greater than the remaining lifetime of the
   EMSK from which the material was derived.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Result-Code%20AVP%20Values"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Result-Code AVP Values</span>

   This section defines new Result-Code [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>] values that MUST be
   supported by all Diameter implementations that conform to this
   specification.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Permanent%20Failures"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Permanent Failures</span>

   Errors that fall within the Permanent Failures category are used to
   inform the peer that the request failed and SHOULD NOT be attempted
   again.

      DIAMETER_ERROR_EAP_CODE_UNKNOWN (5048)

         This error code is used by the Diameter server to inform the
         peer that the received EAP-Payload AVP contains an EAP packet
         with an unknown EAP code.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  IANA Considerations</span>

   IANA has registered the following new elements in the Authentication,
   Authorization, and Accounting (AAA) Parameters registries
   [<a href="#ref-AAAPARAMS" title='"Authentication, Authorization, and Accounting (AAA) Parameters"'>AAAPARAMS</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Diameter%20Application%20Identifier"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Diameter Application Identifier</span>

   IANA has allocated a new value "Diameter ERP" (code: 13) in the
   "Application IDs" registry from the "Standards Action" range of
   numbers using the "Specification Required" policy [<a href="./rfc5226" title="">RFC5226</a>]; see
   <a href="./rfc3588#section-11.3">Section 11.3 of RFC 3588</a> [<a href="./rfc3588" title='"Diameter Base Protocol"'>RFC3588</a>] for further details.










<span class="grey">Bournelle, et al.            Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20New%20AVPs"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  New AVPs</span>

   IANA has allocated new values from the "AVP Codes" registry according
   to the policy specified in <a href="#section-11.1">Section 11.1</a> of Fajardo, et al. [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>]
   for the following AVPs:

      ERP-RK-Request (code: 618)

      ERP-Realm (code: 619)

   These AVPs are defined in <a href="#section-8">Section 8</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.3.%20%20New%20Permanent%20Failures%20Result-Code%20AVP%20Values"></a><a class="selflink" href="#section-10.3" id="section-10.3">10.3</a>.  New Permanent Failures Result-Code AVP Values</span>

   IANA has allocated a new value from the "Result-Code AVP Values (code
   268) - Permanent Failure" registry according to the policy specified
   in <a href="#section-11.3.2">Section 11.3.2</a> of Fajardo, et al. [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>] for the following
   Result-Code:

      DIAMETER_ERROR_EAP_CODE_UNKNOWN (code: 5048)

   This Result-Code value is defined in <a href="#section-9">Section 9</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20Security%20Considerations"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  Security Considerations</span>

   The security considerations from the following documents apply here:

   o  Eronen, et al. [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>]

   o  Salowey, et al. [<a href="./rfc5295" title='"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)"'>RFC5295</a>]

   o  Cao, et al. [<a href="./rfc6696" title='"EAP Extensions for the EAP Re-authentication Protocol (ERP)"'>RFC6696</a>]

   o  Fajardo, et al. [<a href="./rfc6733" title='"Diameter Base Protocol"'>RFC6733</a>]

   o  Zorn, et al. [<a href="./rfc6734" title='"Diameter Attribute- Value Pairs for Cryptographic Key Transport"'>RFC6734</a>]

   Because this application involves the transmission of sensitive data,
   including cryptographic keys, it MUST be protected using Transport
   Layer Security (TLS) [<a href="./rfc5246" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>], Datagram Transport Layer Security
   (DTLS) [<a href="./rfc6347" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>], or IP Encapsulating Security Payload (ESP)
   [<a href="./rfc4303" title='"IP Encapsulating Security Payload (ESP)"'>RFC4303</a>].  If TLS or DTLS is used, the bulk encryption algorithm
   negotiated MUST be non-null.  If ESP is used, the encryption
   algorithm MUST be non-null.







<span class="grey">Bournelle, et al.            Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20Contributors"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  Contributors</span>

   Hannes Tschofenig wrote the initial draft of this document.

   Lakshminath Dondeti contributed to the early drafts of the document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Acknowledgements"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Acknowledgements</span>

   Hannes Tschofenig, Zhen Cao, Benoit Claise, Elwyn Davies, Menachem
   Dodge, Vincent Roca, Stephen Farrell, Sean Turner, Pete Resnick, Russ
   Housley, Martin Stiemerling, and Jouni Korhonen provided useful
   reviews.

   Vidya Narayanan reviewed a rough draft version of the document and
   found some errors.

   Many thanks to these people!

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.%20%20References"></a><a class="selflink" href="#section-14" id="section-14">14</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.1.%20%20Normative%20References"></a><a class="selflink" href="#section-14.1" id="section-14.1">14.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3748">RFC3748</a>]   Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H.
               Levkowetz, "Extensible Authentication Protocol (EAP)",
               <a href="./rfc3748">RFC 3748</a>, June 2004.

   [<a id="ref-RFC4072">RFC4072</a>]   Eronen, P., Hiller, T., and G. Zorn, "Diameter Extensible
               Authentication Protocol (EAP) Application", <a href="./rfc4072">RFC 4072</a>,
               August 2005.

   [<a id="ref-RFC5226">RFC5226</a>]   Narten, T. and H. Alvestrand, "Guidelines for Writing an
               IANA Considerations Section in RFCs", <a href="https://www.rfc-editor.org/bcp/bcp26">BCP 26</a>, <a href="./rfc5226">RFC 5226</a>,
               May 2008.

   [<a id="ref-RFC5295">RFC5295</a>]   Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri,
               "Specification for the Derivation of Root Keys from an
               Extended Master Session Key (EMSK)", <a href="./rfc5295">RFC 5295</a>, August
               2008.

   [<a id="ref-RFC6696">RFC6696</a>]   Cao, Z., He, B., Shi, Y., Wu, Q., and G. Zorn, "EAP
               Extensions for the EAP Re-authentication Protocol (ERP)",
               <a href="./rfc6696">RFC 6696</a>, July 2012.

   [<a id="ref-RFC6733">RFC6733</a>]   Fajardo, V., Arkko, J., Loughney, J., and G. Zorn,
               "Diameter Base Protocol", <a href="./rfc6733">RFC 6733</a>, October 2012.



<span class="grey">Bournelle, et al.            Standards Track                   [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


   [<a id="ref-RFC6734">RFC6734</a>]   Zorn, G., Wu, Q., and V. Cakulev, "Diameter Attribute-
               Value Pairs for Cryptographic Key Transport", <a href="./rfc6734">RFC 6734</a>,
               October 2012.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/14.2.%20%20Informative%20References"></a><a class="selflink" href="#section-14.2" id="section-14.2">14.2</a>.  Informative References</span>

   [<a id="ref-AAAPARAMS">AAAPARAMS</a>] Internet Assigned Numbers Authority, "Authentication,
               Authorization, and Accounting (AAA) Parameters",
               &lt;<a href="http://www.iana.org/assignments/aaa-parameters/">http://www.iana.org/assignments/aaa-parameters/</a>&gt;.

   [<a id="ref-RFC3588">RFC3588</a>]   Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J.
               Arkko, "Diameter Base Protocol", <a href="./rfc3588">RFC 3588</a>, September
               2003.

   [<a id="ref-RFC4303">RFC4303</a>]   Kent, S., "IP Encapsulating Security Payload (ESP)", <a href="./rfc4303">RFC</a>
               <a href="./rfc4303">4303</a>, December 2005.

   [<a id="ref-RFC5246">RFC5246</a>]   Dierks, T. and E. Rescorla, "The Transport Layer Security
               (TLS) Protocol Version 1.2", <a href="./rfc5246">RFC 5246</a>, August 2008.

   [<a id="ref-RFC6347">RFC6347</a>]   Rescorla, E. and N. Modadugu, "Datagram Transport Layer
               Security Version 1.2", <a href="./rfc6347">RFC 6347</a>, January 2012.





























<span class="grey">Bournelle, et al.            Standards Track                   [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc6942">RFC 6942</a>                Diameter ERP Application                May 2013</span>


Authors' Addresses

   Julien Bournelle
   Orange Labs
   38-40 rue du general Leclerc
   Issy-Les-Moulineaux  92794
   France

   EMail: julien.bournelle@orange.com


   Lionel Morand
   Orange Labs
   38-40 rue du general Leclerc
   Issy-Les-Moulineaux  92794
   France

   EMail: lionel.morand@orange.com


   Sebastien Decugis
   INSIDE Secure
   41 Parc Club du Golf
   Aix-en-Provence  13856
   France

   Phone: +33 (0)4 42 39 63 00
   EMail: sdecugis@freediameter.net


   Qin Wu
   Huawei Technologies Co., Ltd.
   101 Software Avenue, Yuhua District
   Nanjing, JiangSu  210012
   China

   EMail: sunseawq@huawei.com


   Glen Zorn
   Network Zen
   227/358 Thanon Sanphawut
   Bang Na, Bangkok  10260
   Thailand

   EMail: glenzorn@gmail.com





Bournelle, et al.            Standards Track                   [Page 18]
</pre>
</body></html>