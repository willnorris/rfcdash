<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9227: Using GOST Ciphers in the Encapsulating Security Payload (ESP) and Internet Key Exchange Version 2 (IKEv2) Protocols</title>
<meta content="Valery Smyslov" name="author"/>
<meta content='
        This document defines a set of encryption transforms for use in the Encapsulating Security Payload (ESP) 
            and in the Internet Key Exchange version 2 (IKEv2) protocols, which are parts of the IP Security (IPsec) protocol suite. 
            The transforms are based on the GOST R 34.12-2015 block ciphers (which are named "Magma" and "Kuznyechik") 
            in Multilinear Galois Mode (MGM) and the external rekeying approach.
       
        This specification was developed to facilitate implementations that wish to support the GOST algorithms.  
            This document does not imply IETF endorsement of the cryptographic algorithms used in this document.
       
    ' name="description"/>
<meta content="xml2rfc 3.12.2" name="generator"/>
<meta content="AEAD" name="keyword"/>
<meta content="MGM" name="keyword"/>
<meta content="9227" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.12.2
    Python 3.6.15
    appdirs 1.4.4
    ConfigArgParse 1.4.1
    google-i18n-address 2.4.0
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.15.1
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.4.1
    requests 2.24.0
    setuptools 40.5.0
    six 1.14.0
    WeasyPrint 52.5
-->
<link href="rfc9227.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9227" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-smyslov-esp-gost-14" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9227</td>
<td class="center">GOST Ciphers in ESP and IKEv2</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Smyslov</td>
<td class="center">Informational</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Independent Submission</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9227">9227</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Informational</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2022-03">March 2022</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9227</h1>
<h1 id="title">Using GOST Ciphers in the Encapsulating Security Payload (ESP) and Internet Key Exchange Version 2 (IKEv2) Protocols</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1"> This document defines a set of encryption transforms for use in the Encapsulating Security Payload (ESP) 
            and in the Internet Key Exchange version 2 (IKEv2) protocols, which are parts of the IP Security (IPsec) protocol suite. 
            The transforms are based on the GOST R 34.12-2015 block ciphers (which are named "Magma" and "Kuznyechik") 
            in Multilinear Galois Mode (MGM) and the external rekeying approach.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
<p id="section-abstract-2"> This specification was developed to facilitate implementations that wish to support the GOST algorithms.  
            This document does not imply IETF endorsement of the cryptographic algorithms used in this document.<a class="pilcrow" href="#section-abstract-2">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for informational purposes.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This is a contribution to the RFC Series, independently of any
            other RFC stream.  The RFC Editor has chosen to publish this
            document at its discretion and makes no statement about its value
            for implementation or deployment.  Documents approved for
            publication by the RFC Editor are not candidates for any level of
            Internet Standard; see Section 2 of RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9227">https://www.rfc-editor.org/info/rfc9227</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-requirements-language">Requirements Language</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-overview">Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-description-of-transforms">Description of Transforms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="xref" href="#section-4.1">4.1</a>.  <a class="xref" href="#name-tree-based-external-rekeyin">Tree-Based External Rekeying</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="xref" href="#section-4.2">4.2</a>.  <a class="xref" href="#name-initialization-vector-forma">Initialization Vector Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="xref" href="#section-4.3">4.3</a>.  <a class="xref" href="#name-nonce-format-for-mgm">Nonce Format for MGM</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a class="xref" href="#section-4.3.1">4.3.1</a>.  <a class="xref" href="#name-mgm-nonce-format-for-transf">MGM Nonce Format for Transforms Based on the "Kuznyechik" Cipher</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a class="xref" href="#section-4.3.2">4.3.2</a>.  <a class="xref" href="#name-mgm-nonce-format-for-transfo">MGM Nonce Format for Transforms Based on the "Magma" Cipher</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="xref" href="#section-4.4">4.4</a>.  <a class="xref" href="#name-keying-material">Keying Material</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a class="xref" href="#section-4.5">4.5</a>.  <a class="xref" href="#name-integrity-check-value">Integrity Check Value</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a class="xref" href="#section-4.6">4.6</a>.  <a class="xref" href="#name-plaintext-padding">Plaintext Padding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a class="xref" href="#section-4.7">4.7</a>.  <a class="xref" href="#name-aad-construction">AAD Construction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.1">
                    <p id="section-toc.1-1.4.2.7.2.1.1"><a class="xref" href="#section-4.7.1">4.7.1</a>.  <a class="xref" href="#name-esp-aad">ESP AAD</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7.2.2">
                    <p id="section-toc.1-1.4.2.7.2.2.1"><a class="xref" href="#section-4.7.2">4.7.2</a>.  <a class="xref" href="#name-ikev2-aad">IKEv2 AAD</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a class="xref" href="#section-4.8">4.8</a>.  <a class="xref" href="#name-using-transforms">Using Transforms</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="xref" href="#section-7.1">7.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="xref" href="#section-7.2">7.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#appendix-A">Appendix A</a>.  <a class="xref" href="#name-test-vectors">Test Vectors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#appendix-B"></a><a class="xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#appendix-C"></a><a class="xref" href="#name-authors-address">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1"> The IP Security (IPsec) protocol suite consists of several protocols, of which 
            the Encapsulating Security Payload (ESP) <span>[<a class="xref" href="#RFC4303">RFC4303</a>]</span> and 
            the Internet Key Exchange version 2 (IKEv2) <span>[<a class="xref" href="#RFC7296">RFC7296</a>]</span> are most widely used.
            This document defines four transforms for ESP and IKEv2 based on Russian cryptographic standard algorithms (often referred to as "GOST" algorithms).
            These definitions are based on the recommendations <span>[<a class="xref" href="#GOST-ESP">GOST-ESP</a>]</span> established by the Federal Agency on Technical Regulating and Metrology (Rosstandart),
            which describe how Russian cryptographic standard algorithms are used in ESP and IKEv2. The transforms defined in this document are based 
            on two block ciphers from Russian cryptographic standard algorithms -- 
            "Kuznyechik" <span>[<a class="xref" href="#GOST3412-2015">GOST3412-2015</a>]</span> <span>[<a class="xref" href="#RFC7801">RFC7801</a>]</span> 
            and "Magma" <span>[<a class="xref" href="#GOST3412-2015">GOST3412-2015</a>]</span> <span>[<a class="xref" href="#RFC8891">RFC8891</a>]</span>
            in Multilinear Galois Mode (MGM) <span>[<a class="xref" href="#GOST-MGM">GOST-MGM</a>]</span> <span>[<a class="xref" href="#RFC9058">RFC9058</a>]</span>. These transforms 
            provide Authenticated Encryption with Associated Data (AEAD). An external rekeying mechanism, described in <span>[<a class="xref" href="#RFC8645">RFC8645</a>]</span>,
            is also used in these transforms to limit the load on session keys.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2"> Because the GOST specification includes the definition of both 128-bit ("Kuznyechik") and 64-bit ("Magma") 
            block ciphers, both are included in this document. Implementers should make themselves aware of the relative security 
            and other cost-benefit implications of the two ciphers. See <a class="xref" href="#security">Section 5</a> for more details.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3"> This specification was developed to facilitate implementations that wish to support the GOST algorithms.  
            This document does not imply IETF endorsement of the cryptographic algorithms used in this document.<a class="pilcrow" href="#section-1-3">¶</a></p>
</section>
</div>
<div id="req_lang">
<section id="section-2">
      <h2 id="name-requirements-language">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-requirements-language">Requirements Language</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
       "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>",
       "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>",
       "<span class="bcp14">SHOULD NOT</span>",
       "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
       "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document
       are to be interpreted as described in BCP 14
       <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> when, and only
       when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-overview">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-overview">Overview</a>
      </h2>
<p id="section-3-1"> Russian cryptographic standard algorithms, often referred to as "GOST" algorithms,
            constitute a set of cryptographic algorithms of different types -- ciphers, hash functions, digital
            signatures, etc. In particular, Russian cryptographic standard <span>[<a class="xref" href="#GOST3412-2015">GOST3412-2015</a>]</span> 
            defines two block ciphers -- "Kuznyechik" (also defined in <span>[<a class="xref" href="#RFC7801">RFC7801</a>]</span>)
            and "Magma" (also defined in <span>[<a class="xref" href="#RFC8891">RFC8891</a>]</span>). Both 
            ciphers use a 256-bit key. "Kuznyechik" has a block size of 128 bits, while "Magma"
            has a 64-bit block.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2"> Multilinear Galois Mode (MGM) is an AEAD mode defined in <span>[<a class="xref" href="#GOST-MGM">GOST-MGM</a>]</span> and <span>[<a class="xref" href="#RFC9058">RFC9058</a>]</span>. 
            It is claimed to provide defense against some attacks on well-known AEAD modes, like Galois/Counter Mode (GCM).<a class="pilcrow" href="#section-3-2">¶</a></p>
<p id="section-3-3"> <span>[<a class="xref" href="#RFC8645">RFC8645</a>]</span> defines mechanisms that can be used
            to limit the number of times any particular session key is used. One of these mechanisms,
            called external rekeying with tree-based construction (defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8645#section-5.2.3">Section 5.2.3</a> of [<a class="xref" href="#RFC8645">RFC8645</a>]</span>),
            is used in the defined transforms. For the purpose of deriving subordinate keys,
            the Key Derivation Function (KDF) KDF_GOSTR3411_2012_256, defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7836#section-4.5">Section 4.5</a> of [<a class="xref" href="#RFC7836">RFC7836</a>]</span>,
 is used. This KDF is based on a Hashed Message Authentication Code (HMAC) construction <span>[<a class="xref" href="#RFC2104">RFC2104</a>]</span> with 
            a Russian GOST hash function defined in Russian cryptographic standard <span>[<a class="xref" href="#GOST3411-2012">GOST3411-2012</a>]</span> (also defined
            in <span>[<a class="xref" href="#RFC6986">RFC6986</a>]</span>).<a class="pilcrow" href="#section-3-3">¶</a></p>
</section>
</div>
<div id="transforms">
<section id="section-4">
      <h2 id="name-description-of-transforms">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-description-of-transforms">Description of Transforms</a>
      </h2>
<p id="section-4-1"> This document defines four transforms of Type 1 (Encryption Algorithm) for use in ESP and IKEv2. All of them use MGM as the mode of operation with tree-based 
            external rekeying. The transforms differ in underlying ciphers and in cryptographic services they provide.<a class="pilcrow" href="#section-4-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">ENCR_KUZNYECHIK_MGM_KTREE (Transform ID 32) is an AEAD transform based on the "Kuznyechik" algorithm; it provides 
                confidentiality and message authentication and thus can be used in both ESP and IKEv2.<a class="pilcrow" href="#section-4-2.1">¶</a>
</li>
        <li class="normal" id="section-4-2.2">ENCR_MAGMA_MGM_KTREE (Transform ID 33) is an AEAD transform based on the "Magma" algorithm; it provides 
                confidentiality and message authentication and thus can be used in both ESP and IKEv2.<a class="pilcrow" href="#section-4-2.2">¶</a>
</li>
        <li class="normal" id="section-4-2.3">ENCR_KUZNYECHIK_MGM_MAC_KTREE (Transform ID 34) is a MAC-only transform based on the "Kuznyechik" algorithm; it provides 
                no confidentiality and thus can only be used in ESP, but not in IKEv2.<a class="pilcrow" href="#section-4-2.3">¶</a>
</li>
        <li class="normal" id="section-4-2.4">ENCR_MAGMA_MGM_MAC_KTREE (Transform ID 35) is a MAC-only transform based on the "Magma" algorithm; it provides 
                no confidentiality and thus can only be used in ESP, but not in IKEv2.<a class="pilcrow" href="#section-4-2.4">¶</a>
</li>
      </ul>
<p id="section-4-3">
            Note that transforms ENCR_KUZNYECHIK_MGM_MAC_KTREE and ENCR_MAGMA_MGM_MAC_KTREE don't provide any confidentiality,
            but they are defined as Type 1 (Encryption Algorithm) transforms because of the need to include an Initialization Vector (IV),
            which is impossible for Type 3 (Integrity Algorithm) transforms.<a class="pilcrow" href="#section-4-3">¶</a></p>
<div id="key">
<section id="section-4.1">
        <h3 id="name-tree-based-external-rekeyin">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-tree-based-external-rekeyin">Tree-Based External Rekeying</a>
        </h3>
<p id="section-4.1-1"> All four transforms use the same tree-based external rekeying mechanism. The idea is that
                the key that is provided for the transform is not directly used to protect messages. Instead, a tree of keys is derived using this key as a root.
                This tree may have several levels. The leaf keys are used for message protection, while intermediate-node keys are used to derive
                lower-level keys, including leaf keys.
 See <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8645#section-5.2.3">Section 5.2.3</a> of [<a class="xref" href="#RFC8645">RFC8645</a>]</span> for more details.
                This construction allows us to protect a large amount of data, at the same time providing a bound on a number of times any particular key 
                in the tree is used, thus defending against some side-channel attacks and also increasing the key lifetime limitations based on combinatorial properties.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<p id="section-4.1-2"> The transforms defined in this document use a three-level tree. The leaf key that protects a message is computed
                as follows:<a class="pilcrow" href="#section-4.1-2">¶</a></p>
<div class="alignCenter art-text artwork" id="section-4.1-3">
<pre>K_msg = KDF (KDF (KDF (K, l1, 0x00 | i1), l2, i2), l3, i3)
</pre><a class="pilcrow" href="#section-4.1-3">¶</a>
</div>
<p id="section-4.1-4">

                where:<a class="pilcrow" href="#section-4.1-4">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.1-5">
          <dt id="section-4.1-5.1">KDF (k, l, s)</dt>
          <dd id="section-4.1-5.2" style="margin-left: 8.0em">Key Derivation Function KDF_GOSTR3411_2012_256 (defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7836#section-4.5">Section 4.5</a> of [<a class="xref" href="#RFC7836">RFC7836</a>]</span>), which 
                    accepts three input parameters -- a key (k), a label (l), and a seed (s) -- and provides a new key as output<a class="pilcrow" href="#section-4.1-5.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-5.3">K</dt>
          <dd id="section-4.1-5.4" style="margin-left: 8.0em">the root key for the tree (see <a class="xref" href="#keymat">Section 4.4</a>)<a class="pilcrow" href="#section-4.1-5.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-5.5">l1, l2, l3</dt>
          <dd id="section-4.1-5.6" style="margin-left: 8.0em">
            <p id="section-4.1-5.6.1">labels defined as 6-octet ASCII strings without null termination:<a class="pilcrow" href="#section-4.1-5.6.1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.1-5.6.2">
              <dt id="section-4.1-5.6.2.1">l1 =</dt>
              <dd id="section-4.1-5.6.2.2" style="margin-left: 1.5em">"level1"<a class="pilcrow" href="#section-4.1-5.6.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1-5.6.2.3">l2 = </dt>
              <dd id="section-4.1-5.6.2.4" style="margin-left: 1.5em">"level2"<a class="pilcrow" href="#section-4.1-5.6.2.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1-5.6.2.5">l3 = </dt>
              <dd id="section-4.1-5.6.2.6" style="margin-left: 1.5em">"level3"<a class="pilcrow" href="#section-4.1-5.6.2.6">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-5.7">i1, i2, i3</dt>
          <dd id="section-4.1-5.8" style="margin-left: 8.0em">parameters that determine which keys out of the tree are used on each level.
                    Together, they determine a leaf key that is used for message protection; the length of i1 is one octet, and 
                    i2 and i3 are two-octet integers in network byte order<a class="pilcrow" href="#section-4.1-5.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-5.9">|</dt>
          <dd id="section-4.1-5.10" style="margin-left: 8.0em">indicates concatenation<a class="pilcrow" href="#section-4.1-5.10">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.1-6">
                This construction allows us to generate up to 2<sup>8</sup> keys on level 1 and up to 2<sup>16</sup> keys on levels 2 and 3. 
                So, the total number of possible leaf keys generated from a single Security Association (SA) key is 2<sup>40</sup>.<a class="pilcrow" href="#section-4.1-6">¶</a></p>
<p id="section-4.1-7">This specification doesn't impose any requirements on how frequently external rekeying takes place.
                It is expected that the sending application will follow its own policy dictating how many times the keys on each level must be used.<a class="pilcrow" href="#section-4.1-7">¶</a></p>
</section>
</div>
<div id="iv">
<section id="section-4.2">
        <h3 id="name-initialization-vector-forma">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-initialization-vector-forma">Initialization Vector Format</a>
        </h3>
<p id="section-4.2-1"> Each message protected by the defined transforms <span class="bcp14">MUST</span> contain an IV.
                The IV has a size of 64 bits and consists of four fields. The fields i1, i2, and i3 are
                parameters that determine the particular leaf key this message was protected with (see <a class="xref" href="#key">Section 4.1</a>).
                The fourth field is a counter, representing the message number for this key.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<span id="name-iv-format"></span><div id="iv_format">
<figure id="figure-1">
          <div class="alignCenter art-text artwork" id="section-4.2-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      i1       |               i2              |      i3       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   i3 (cont)   |                     pnum                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-iv-format">IV Format</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">
                where:<a class="pilcrow" href="#section-4.2-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.2-4">
          <dt id="section-4.2-4.1">i1 (1 octet), i2 (2 octets), i3 (2 octets):</dt>
          <dd id="section-4.2-4.2" style="margin-left: 1.5em">parameters that  determine the particular key used to protect this message;
                    2-octet parameters are integers in network byte order<a class="pilcrow" href="#section-4.2-4.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-4.3">pnum (3 octets):</dt>
          <dd id="section-4.2-4.4" style="margin-left: 1.5em">message counter in network byte order for the leaf key protecting this message; up to 2<sup>24</sup> messages may be protected using 
                    a single leaf key<a class="pilcrow" href="#section-4.2-4.4">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.2-5">
                For any given SA, the IV <span class="bcp14">MUST NOT</span> be used more than once, but there is no requirement that IV be unpredictable.<a class="pilcrow" href="#section-4.2-5">¶</a></p>
</section>
</div>
<div id="mgm_nonce">
<section id="section-4.3">
        <h3 id="name-nonce-format-for-mgm">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-nonce-format-for-mgm">Nonce Format for MGM</a>
        </h3>
<p id="section-4.3-1"> MGM requires a per-message nonce (called the Initial Counter Nonce, or ICN in <span>[<a class="xref" href="#RFC9058">RFC9058</a>]</span>) 
                that <span class="bcp14">MUST</span> be unique in the context of any leaf key. The size of the ICN
                is n-1 bits, where n is the block size of the underlying cipher. The two ciphers used in the 
                transforms defined in this document have different block sizes, so two different formats for the ICN are defined.<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<p id="section-4.3-2"> MGM specification requires that the nonce be n-1 bits in size, where n is the block size of the underlying cipher. 
                This document defines MGM nonces having n bits (the block size of the underlying cipher) in size.
                Since n is always a multiple of 8 bits, this makes MGM nonces having a whole number of octets.
                When used inside MGM, the most significant bit of the first octet of the nonce (represented as an octet string) is 
                dropped, making the effective size of the nonce equal to n-1 bits. Note that the dropped bit is a part of the "zero" field
                (see Figures <a class="xref" href="#nonce_kuznyechik_format">2</a> and <a class="xref" href="#nonce_magma_format">3</a>), which is always set to 0, 
                so no information is lost when it is dropped.<a class="pilcrow" href="#section-4.3-2">¶</a></p>
<div id="nonce_kuznyechik">
<section id="section-4.3.1">
          <h4 id="name-mgm-nonce-format-for-transf">
<a class="section-number selfRef" href="#section-4.3.1">4.3.1. </a><a class="section-name selfRef" href="#name-mgm-nonce-format-for-transf">MGM Nonce Format for Transforms Based on the "Kuznyechik" Cipher</a>
          </h4>
<p id="section-4.3.1-1"> For transforms based on the "Kuznyechik" cipher (ENCR_KUZNYECHIK_MGM_KTREE and ENCR_KUZNYECHIK_MGM_MAC_KTREE),
                    the ICN consists of a "zero" octet; a 24-bit message counter; and a 96-bit secret salt, which is fixed for the SA and is not transmitted.<a class="pilcrow" href="#section-4.3.1-1">¶</a></p>
<span id="name-nonce-format-for-transforms"></span><div id="nonce_kuznyechik_format">
<figure id="figure-2">
            <div class="alignCenter art-text artwork" id="section-4.3.1-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     zero      |                     pnum                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                             salt                              |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-nonce-format-for-transforms">Nonce Format for Transforms Based on the "Kuznyechik" Cipher</a>
            </figcaption></figure>
</div>
<p id="section-4.3.1-3">
                    where:<a class="pilcrow" href="#section-4.3.1-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.1-4">
            <dt id="section-4.3.1-4.1">zero (1 octet):</dt>
            <dd id="section-4.3.1-4.2" style="margin-left: 1.5em">set to 0<a class="pilcrow" href="#section-4.3.1-4.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.1-4.3">pnum (3 octets):</dt>
            <dd id="section-4.3.1-4.4" style="margin-left: 1.5em">the counter for the messages protected by the given leaf key; this field <span class="bcp14">MUST</span> be equal to the pnum field in the IV<a class="pilcrow" href="#section-4.3.1-4.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.1-4.5">salt (12 octets):</dt>
            <dd id="section-4.3.1-4.6" style="margin-left: 1.5em">secret salt. The salt is a string of bits that are formed when the SA is created (see <a class="xref" href="#keymat">Section 4.4</a> for details).  The salt does not change during the SA's lifetime and is not transmitted on the wire.  Every SA will have its own salt.<a class="pilcrow" href="#section-4.3.1-4.6">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="nonce_magma">
<section id="section-4.3.2">
          <h4 id="name-mgm-nonce-format-for-transfo">
<a class="section-number selfRef" href="#section-4.3.2">4.3.2. </a><a class="section-name selfRef" href="#name-mgm-nonce-format-for-transfo">MGM Nonce Format for Transforms Based on the "Magma" Cipher</a>
          </h4>
<p id="section-4.3.2-1"> For transforms based on the "Magma" cipher (ENCR_MAGMA_MGM_KTREE and ENCR_MAGMA_MGM_MAC_KTREE),
                    the ICN consists of a "zero" octet; a 24-bit message counter; and a 32-bit secret salt, which is fixed for the SA and is not transmitted.<a class="pilcrow" href="#section-4.3.2-1">¶</a></p>
<span id="name-nonce-format-for-transforms-"></span><div id="nonce_magma_format">
<figure id="figure-3">
            <div class="alignCenter art-text artwork" id="section-4.3.2-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     zero      |                     pnum                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             salt                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-nonce-format-for-transforms-">Nonce Format for Transforms Based on the "Magma" Cipher</a>
            </figcaption></figure>
</div>
<p id="section-4.3.2-3">
    
                    where:<a class="pilcrow" href="#section-4.3.2-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.3.2-4">
            <dt id="section-4.3.2-4.1">zero (1 octet):</dt>
            <dd id="section-4.3.2-4.2" style="margin-left: 1.5em">set to 0<a class="pilcrow" href="#section-4.3.2-4.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.2-4.3">pnum (3 octets):</dt>
            <dd id="section-4.3.2-4.4" style="margin-left: 1.5em">the counter for the messages protected by the given leaf key; this field <span class="bcp14">MUST</span> be equal to the pnum field in the IV<a class="pilcrow" href="#section-4.3.2-4.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-4.3.2-4.5">salt (4 octets):</dt>
            <dd id="section-4.3.2-4.6" style="margin-left: 1.5em">secret salt. The salt is a string of bits that are formed when the SA is created (see <a class="xref" href="#keymat">Section 4.4</a> for details).  The salt does not change during the SA's lifetime and is not transmitted on the wire.  Every SA will have its own salt.<a class="pilcrow" href="#section-4.3.2-4.6">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="keymat">
<section id="section-4.4">
        <h3 id="name-keying-material">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-keying-material">Keying Material</a>
        </h3>
<p id="section-4.4-1">We'll call a string of bits that is used to initialize the transforms
   defined in this specification a "transform key". The transform key is a composite entity consisting of the root key for the tree and the secret salt.<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<p id="section-4.4-2">The transform key for the ENCR_KUZNYECHIK_MGM_KTREE and ENCR_KUZNYECHIK_MGM_MAC_KTREE transforms consists of 352 bits (44 octets), of which
                the first 256 bits is a root key for the tree (denoted as K in <a class="xref" href="#key">Section 4.1</a>) and the remaining
                96 bits is a secret salt (see <a class="xref" href="#nonce_kuznyechik">Section 4.3.1</a>).<a class="pilcrow" href="#section-4.4-2">¶</a></p>
<p id="section-4.4-3">The transform key for the ENCR_MAGMA_MGM_KTREE and ENCR_MAGMA_MGM_MAC_KTREE transforms consists of 288 bits (36 octets), of which
                the first 256 bits is a root key for the tree (denoted as K in <a class="xref" href="#key">Section 4.1</a>) and the remaining
                32 bits is a secret salt (see <a class="xref" href="#nonce_magma">Section 4.3.2</a>).<a class="pilcrow" href="#section-4.4-3">¶</a></p>
<p id="section-4.4-4">In the case of ESP, the transform keys are extracted from the KEYMAT as defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.17">Section 2.17</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>.
                In the case of IKEv2, the transform keys are either SK_ei or SK_er, which are generated as defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-2.14">Section 2.14</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>.
                Note that since these transforms provide authenticated encryption, no additional keys are needed
                for authentication. This means that, in the case of IKEv2, the keys SK_ai/SK_ar are not used and <span class="bcp14">MUST</span> be treated as 
                having zero length.<a class="pilcrow" href="#section-4.4-4">¶</a></p>
</section>
</div>
<div id="icv">
<section id="section-4.5">
        <h3 id="name-integrity-check-value">
<a class="section-number selfRef" href="#section-4.5">4.5. </a><a class="section-name selfRef" href="#name-integrity-check-value">Integrity Check Value</a>
        </h3>
<p id="section-4.5-1"> The length of the authentication tag  that MGM can compute is in the range from 32 bits to the block size of the underlying cipher.
                <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9058#section-4">Section 4</a> of [<a class="xref" href="#RFC9058">RFC9058</a>]</span> states that the authentication tag length <span class="bcp14">MUST</span> be fixed for a particular protocol.
                For transforms based on the "Kuznyechik" cipher (ENCR_KUZNYECHIK_MGM_KTREE and ENCR_KUZNYECHIK_MGM_MAC_KTREE), the resulting 
                Integrity Check Value (ICV) length is set to 96 bits. For transforms based on the "Magma" cipher (ENCR_MAGMA_MGM_KTREE and ENCR_MAGMA_MGM_MAC_KTREE),
                the full ICV length is set to the block size (64 bits).<a class="pilcrow" href="#section-4.5-1">¶</a></p>
</section>
</div>
<div id="padding">
<section id="section-4.6">
        <h3 id="name-plaintext-padding">
<a class="section-number selfRef" href="#section-4.6">4.6. </a><a class="section-name selfRef" href="#name-plaintext-padding">Plaintext Padding</a>
        </h3>
<p id="section-4.6-1">The transforms defined in this document don't require any plaintext padding,
                as specified in <span>[<a class="xref" href="#RFC9058">RFC9058</a>]</span>. This means that only those
                padding requirements that are imposed by the protocol are applied (4 bytes for ESP,
                no padding for IKEv2).<a class="pilcrow" href="#section-4.6-1">¶</a></p>
</section>
</div>
<section id="section-4.7">
        <h3 id="name-aad-construction">
<a class="section-number selfRef" href="#section-4.7">4.7. </a><a class="section-name selfRef" href="#name-aad-construction">AAD Construction</a>
        </h3>
<div id="esp_aad">
<section id="section-4.7.1">
          <h4 id="name-esp-aad">
<a class="section-number selfRef" href="#section-4.7.1">4.7.1. </a><a class="section-name selfRef" href="#name-esp-aad">ESP AAD</a>
          </h4>
<p id="section-4.7.1-1"> Additional Authenticated Data (AAD) in ESP is constructed differently, depending on the 
                    transform being used and whether the Extended Sequence Number (ESN) is in use or not.
                    The ENCR_KUZNYECHIK_MGM_KTREE and ENCR_MAGMA_MGM_KTREE transforms
                    provide confidentiality, so the content of the ESP body is encrypted and the AAD
                    consists of the ESP Security Parameter Index (SPI) and (E)SN.
 The AAD is constructed similarly to the AAD in <span>[<a class="xref" href="#RFC4106">RFC4106</a>]</span>.<a class="pilcrow" href="#section-4.7.1-1">¶</a></p>
<p id="section-4.7.1-2"> On the other hand, the ENCR_KUZNYECHIK_MGM_MAC_KTREE and ENCR_MAGMA_MGM_MAC_KTREE transforms
                    don't provide confidentiality; they provide only message authentication.
                    For this purpose, the IV and the part of the ESP packet that is normally encrypted are included
                    in the AAD. For these transforms, the encryption capability provided by MGM
                    is not used. The AAD is constructed similarly to the AAD in <span>[<a class="xref" href="#RFC4543">RFC4543</a>]</span>.<a class="pilcrow" href="#section-4.7.1-2">¶</a></p>
<span id="name-aad-for-aead-transforms-wit"></span><div id="aad_aead_32">
<figure id="figure-4">
            <div class="alignCenter art-text artwork" id="section-4.7.1-3.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               SPI                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     32-bit Sequence Number                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-aad-for-aead-transforms-wit">AAD for AEAD Transforms with 32-Bit SN</a>
            </figcaption></figure>
</div>
<span id="name-aad-for-aead-transforms-with"></span><div id="aad_aead_64">
<figure id="figure-5">
            <div class="alignCenter art-text artwork" id="section-4.7.1-4.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               SPI                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 64-bit Extended Sequence Number               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-aad-for-aead-transforms-with">AAD for AEAD Transforms with 64-Bit ESN</a>
            </figcaption></figure>
</div>
<span id="name-aad-for-authentication-only"></span><div id="aad_mac_32">
<figure id="figure-6">
            <div class="alignCenter art-text artwork" id="section-4.7.1-5.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               SPI                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     32-bit Sequence Number                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               IV                              |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                     Payload Data (variable)                   ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Padding (0-255 bytes)                      |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |  Pad Length   | Next Header   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-aad-for-authentication-only">AAD for Authentication-Only Transforms with 32-Bit SN</a>
            </figcaption></figure>
</div>
<span id="name-aad-for-authentication-only-"></span><div id="aad_mac_64">
<figure id="figure-7">
            <div class="alignCenter art-text artwork" id="section-4.7.1-6.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               SPI                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 64-bit Extended Sequence Number               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               IV                              |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                     Payload Data (variable)                   ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Padding (0-255 bytes)                      |
+                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                               |  Pad Length   | Next Header   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-aad-for-authentication-only-">AAD for Authentication-Only Transforms with 64-Bit ESN</a>
            </figcaption></figure>
</div>
</section>
</div>
<div id="ikev2_aad">
<section id="section-4.7.2">
          <h4 id="name-ikev2-aad">
<a class="section-number selfRef" href="#section-4.7.2">4.7.2. </a><a class="section-name selfRef" href="#name-ikev2-aad">IKEv2 AAD</a>
          </h4>
<p id="section-4.7.2-1"> For IKEv2, the AAD consists of the IKEv2 Header, 
                    any unencrypted payloads following it (if present), and either the Encrypted payload header (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7296#section-3.14">Section 3.14</a> of [<a class="xref" href="#RFC7296">RFC7296</a>]</span>)
                    or the Encrypted Fragment payload (<span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7383#section-2.5">Section 2.5</a> of [<a class="xref" href="#RFC7383">RFC7383</a>]</span>), depending on whether IKE fragmentation is used.
 The AAD is constructed
                    similarly to the AAD in <span>[<a class="xref" href="#RFC5282">RFC5282</a>]</span>.<a class="pilcrow" href="#section-4.7.2-1">¶</a></p>
<span id="name-aad-for-ikev2-in-the-case-o"></span><div id="aad_ikev2_encr_payload_format">
<figure id="figure-8">
            <div class="alignCenter art-text artwork" id="section-4.7.2-2.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                         IKEv2 Header                          ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                   Unencrypted IKE Payloads                    ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Payload  |C|  RESERVED   |         Payload Length        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-aad-for-ikev2-in-the-case-o">AAD for IKEv2 in the Case of the Encrypted Payload</a>
            </figcaption></figure>
</div>
<span id="name-aad-for-ikev2-in-the-case-of"></span><div id="aad_ikev2_encr_frag_payload_format">
<figure id="figure-9">
            <div class="alignCenter art-text artwork" id="section-4.7.2-3.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                         IKEv2 Header                          ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                   Unencrypted IKE Payloads                    ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Payload  |C|  RESERVED   |         Payload Length        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Fragment Number        |        Total Fragments        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-aad-for-ikev2-in-the-case-of">AAD for IKEv2 in the Case of the Encrypted Fragment Payload</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
<div id="use">
<section id="section-4.8">
        <h3 id="name-using-transforms">
<a class="section-number selfRef" href="#section-4.8">4.8. </a><a class="section-name selfRef" href="#name-using-transforms">Using Transforms</a>
        </h3>
<p id="section-4.8-1">When the SA is established, the i1, i2, and i3 parameters are set to 0 by the sender and a leaf key is calculated.
                The pnum parameter starts from 0 and is incremented with each message protected by the same leaf key.
                When the sender decides that the leaf should be changed, it increments the i3 parameter and generates a new leaf key.
                The pnum parameter for the new leaf key is reset to 0, and the process continues. If the sender decides
                that a third-level key corresponding to i3 is used enough times, it increments i2, resets i3 to 0,
                and calculates a new leaf key. The pnum is reset to 0 (as with every new leaf key), and the process continues.
                A similar procedure is used when a second-level key needs to be changed.<a class="pilcrow" href="#section-4.8-1">¶</a></p>
<p id="section-4.8-2">A combination of i1, i2, i3, and pnum <span class="bcp14">MUST NOT</span> repeat for any particular SA. 
                This means that the wrapping of these counters is not allowed: when i2, i3, or pnum reaches its respective maximum value, 
                a procedure for changing a leaf key, described above, is executed, and if all four parameters reach their maximum values, 
                the IPsec SA becomes unusable.<a class="pilcrow" href="#section-4.8-2">¶</a></p>
<p id="section-4.8-3">There may be other reasons to recalculate leaf keys besides reaching maximum values for the counters. 
                For example, as described in <a class="xref" href="#security">Section 5</a>, it is <span class="bcp14">RECOMMENDED</span> that the sender count the number of
                octets protected by a particular leaf key and generate a new key when some threshold is reached, and at the latest when 
                reaching the octet limits stated in <a class="xref" href="#security">Section 5</a> for each of the ciphers.<a class="pilcrow" href="#section-4.8-3">¶</a></p>
<p id="section-4.8-4">The receiver always uses i1, i2, and i3 from the received message. If they differ from the values in previously received packets,
                a new leaf key is calculated. The pnum parameter is always used from the 
                received packet. To improve performance, implementations may cache recently used leaf keys.
                When a new leaf key is calculated (based on the values from the received message),
                the old key may be kept for some time to improve performance in the case of possible packet reordering
                (when packets protected by the old leaf key are delayed and arrive later).<a class="pilcrow" href="#section-4.8-4">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-5">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-5-1"> The most important security consideration for MGM is that the nonce <span class="bcp14">MUST NOT</span> repeat
            for a given key. For this reason, the transforms defined in this document <span class="bcp14">MUST NOT</span> be used with manual keying.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2"> Excessive use of the same key can give an attacker advantages in breaking security properties of the 
            transforms defined in this document. For this reason, the amount of data that any particular key is used to protect
            should be limited. This is especially important for algorithms with a 64-bit block size (like "Magma"),
            which currently are generally considered insecure after protecting a relatively
            small amount of data. For example, Section 3.4 of <span>[<a class="xref" href="#SP800-67">SP800-67</a>]</span> limits the number of blocks 
            that are allowed to be encrypted with the Triple DES cipher to 2<sup>20</sup> (8 MB of data).
            This document defines a rekeying mechanism that allows the mitigation of  weak security of a 64-bit block cipher
            by frequently changing the encryption key.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3"> For transforms defined in this document, <span>[<a class="xref" href="#GOST-ESP">GOST-ESP</a>]</span> recommends
            limiting the number of octets protected with a single K_msg key by the following values:<a class="pilcrow" href="#section-5-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">2<sup>41</sup> octets for transforms based on the "Kuznyechik" cipher (ENCR_KUZNYECHIK_MGM_KTREE and ENCR_KUZNYECHIK_MGM_MAC_KTREE)<a class="pilcrow" href="#section-5-4.1">¶</a>
</li>
        <li class="normal" id="section-5-4.2">2<sup>28</sup> octets for transforms based on the "Magma" cipher (ENCR_MAGMA_MGM_KTREE and ENCR_MAGMA_MGM_MAC_KTREE)<a class="pilcrow" href="#section-5-4.2">¶</a>
</li>
      </ul>
<p id="section-5-5">
            These values are based on combinatorial properties and may be further restricted if side-channel attacks are taken into consideration.
            Note that the limit for transforms based on the "Kuznyechik" cipher is unreachable because, due to the construction of the transforms,
            the number of protected messages is limited to 2<sup>24</sup> and each message (either IKEv2 messages or ESP datagrams) is limited to 2<sup>16</sup> octets in size,
            giving 2<sup>40</sup> octets as the maximum amount of data that can be protected with a single K_msg.<a class="pilcrow" href="#section-5-5">¶</a></p>
<p id="section-5-6"><span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9058#section-4">Section 4</a> of [<a class="xref" href="#RFC9058">RFC9058</a>]</span> discusses the possibility of truncating authentication tags in MGM 
            as a trade-off between message expansion and the probability of forgery. This specification truncates an authentication
            tag length for transforms based on the "Kuznyechik" cipher to 96 bits. This decreases message expansion while still providing a very low probability of forgery: 2<sup>-96</sup>.<a class="pilcrow" href="#section-5-6">¶</a></p>
<p id="section-5-7">An attacker can send a lot of packets with arbitrarily chosen i1, i2, and i3 parameters. This will 
            1) force a recipient to recalculate the leaf key for every received packet if i1, i2, and i3 are different from these values in previously received packets,
            thus consuming CPU resources and 2) force a recipient to make verification attempts (that would fail) on a large amount of data, 
            thus allowing the attacker a deeper analysis of the underlying cryptographic primitive (see <span>[<a class="xref" href="#AEAD-USAGE-LIMITS">AEAD-USAGE-LIMITS</a>]</span>).
            Implementations <span class="bcp14">MAY</span> initiate rekeying if they deem that they receive too many packets with an invalid ICV.<a class="pilcrow" href="#section-5-7">¶</a></p>
<p id="section-5-8"> Security properties of MGM are discussed in <span>[<a class="xref" href="#MGM-SECURITY">MGM-SECURITY</a>]</span>.<a class="pilcrow" href="#section-5-8">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-6-1"> IANA maintains a registry called "Internet Key Exchange Version 2 (IKEv2) Parameters" with a subregistry called "Transform Type Values".
            IANA has added the following four Transform IDs to the "Transform Type 1 - Encryption Algorithm Transform IDs" subregistry.<a class="pilcrow" href="#section-6-1">¶</a></p>
<span id="name-transform-ids"></span><div id="iana-table">
<table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-transform-ids">Transform IDs</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Number</th>
            <th class="text-left" colspan="1" rowspan="1">Name</th>
            <th class="text-left" colspan="1" rowspan="1">ESP Reference</th>
            <th class="text-left" colspan="1" rowspan="1">IKEv2 Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">32</td>
            <td class="text-left" colspan="1" rowspan="1">ENCR_KUZNYECHIK_MGM_KTREE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">33</td>
            <td class="text-left" colspan="1" rowspan="1">ENCR_MAGMA_MGM_KTREE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">34</td>
            <td class="text-left" colspan="1" rowspan="1">ENCR_KUZNYECHIK_MGM_MAC_KTREE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
            <td class="text-left" colspan="1" rowspan="1">Not allowed</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">35</td>
            <td class="text-left" colspan="1" rowspan="1">ENCR_MAGMA_MGM_MAC_KTREE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9227</td>
            <td class="text-left" colspan="1" rowspan="1">Not allowed</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<section id="section-7">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4303">[RFC4303]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span>, <span class="refTitle">"IP Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 4303</span>, <span class="seriesInfo">DOI 10.17487/RFC4303</span>, <time class="refDate" datetime="2005-12">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4303">https://www.rfc-editor.org/info/rfc4303</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7383">[RFC7383]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2) Message Fragmentation"</span>, <span class="seriesInfo">RFC 7383</span>, <span class="seriesInfo">DOI 10.17487/RFC7383</span>, <time class="refDate" datetime="2014-11">November 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7383">https://www.rfc-editor.org/info/rfc7383</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6986">[RFC6986]</dt>
        <dd>
<span class="refAuthor">Dolmatov, V., Ed.</span> and <span class="refAuthor">A. Degtyarev</span>, <span class="refTitle">"GOST R 34.11-2012: Hash Function"</span>, <span class="seriesInfo">RFC 6986</span>, <span class="seriesInfo">DOI 10.17487/RFC6986</span>, <time class="refDate" datetime="2013-08">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6986">https://www.rfc-editor.org/info/rfc6986</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7801">[RFC7801]</dt>
        <dd>
<span class="refAuthor">Dolmatov, V., Ed.</span>, <span class="refTitle">"GOST R 34.12-2015: Block Cipher "Kuznyechik""</span>, <span class="seriesInfo">RFC 7801</span>, <span class="seriesInfo">DOI 10.17487/RFC7801</span>, <time class="refDate" datetime="2016-03">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7801">https://www.rfc-editor.org/info/rfc7801</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8891">[RFC8891]</dt>
        <dd>
<span class="refAuthor">Dolmatov, V., Ed.</span> and <span class="refAuthor">D. Baryshkov</span>, <span class="refTitle">"GOST R 34.12-2015: Block Cipher "Magma""</span>, <span class="seriesInfo">RFC 8891</span>, <span class="seriesInfo">DOI 10.17487/RFC8891</span>, <time class="refDate" datetime="2020-09">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8891">https://www.rfc-editor.org/info/rfc8891</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9058">[RFC9058]</dt>
        <dd>
<span class="refAuthor">Smyshlyaev, S., Ed.</span>, <span class="refAuthor">Nozdrunov, V.</span>, <span class="refAuthor">Shishkin, V.</span>, and <span class="refAuthor">E. Griboedova</span>, <span class="refTitle">"Multilinear Galois Mode (MGM)"</span>, <span class="seriesInfo">RFC 9058</span>, <span class="seriesInfo">DOI 10.17487/RFC9058</span>, <time class="refDate" datetime="2021-06">June 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9058">https://www.rfc-editor.org/info/rfc9058</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7836">[RFC7836]</dt>
      <dd>
<span class="refAuthor">Smyshlyaev, S., Ed.</span>, <span class="refAuthor">Alekseev, E.</span>, <span class="refAuthor">Oshkin, I.</span>, <span class="refAuthor">Popov, V.</span>, <span class="refAuthor">Leontiev, S.</span>, <span class="refAuthor">Podobaev, V.</span>, and <span class="refAuthor">D. Belyavsky</span>, <span class="refTitle">"Guidelines on the Cryptographic Algorithms to Accompany the Usage of Standards GOST R 34.10-2012 and GOST R 34.11-2012"</span>, <span class="seriesInfo">RFC 7836</span>, <span class="seriesInfo">DOI 10.17487/RFC7836</span>, <time class="refDate" datetime="2016-03">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7836">https://www.rfc-editor.org/info/rfc7836</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="GOST3411-2012">[GOST3411-2012]</dt>
        <dd>
<span class="refAuthor">Federal Agency on Technical Regulating and Metrology</span>, <span class="refTitle">"Information technology. Cryptographic data security. Hash function"</span>, <span class="seriesInfo">GOST R 34.11-2012</span>, <time class="refDate" datetime="2012-08">August 2012</time>. <span class="annotation">(In Russian)</span>
        </dd>
<dd class="break"></dd>
<dt id="GOST3412-2015">[GOST3412-2015]</dt>
        <dd>
<span class="refAuthor">Federal Agency on Technical Regulating and Metrology</span>, <span class="refTitle">"Information technology. Cryptographic data security. Block ciphers"</span>, <span class="seriesInfo">GOST R 34.12-2015</span>, <time class="refDate" datetime="2015-06">June 2015</time>. <span class="annotation">(In Russian)</span>
        </dd>
<dd class="break"></dd>
<dt id="GOST-MGM">[GOST-MGM]</dt>
        <dd>
<span class="refAuthor">Federal Agency on Technical Regulating and Metrology</span>, <span class="refTitle">"Information technology. Cryptographic information security. Block Cipher Modes Implementing Authenticated Encryption"</span>, <span class="seriesInfo">R 1323565.1.026-2019</span>, <time class="refDate" datetime="2019-09">September 2019</time>. <span class="annotation">(In Russian)</span>
        </dd>
<dd class="break"></dd>
<dt id="GOST-ESP">[GOST-ESP]</dt>
        <dd>
<span class="refAuthor">Federal Agency on Technical Regulating and Metrology</span>, <span class="refTitle">"Information technology. Cryptographic information protection. The use of Russian cryptographic algorithms in the ESP information protection protocol"</span>, <span class="seriesInfo">R 1323565.1.035-2021</span>, <time class="refDate" datetime="2021-01">January 2021</time>. <span class="annotation">(In Russian)</span>
        </dd>
<dd class="break"></dd>
<dt id="RFC2104">[RFC2104]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refAuthor">Bellare, M.</span>, and <span class="refAuthor">R. Canetti</span>, <span class="refTitle">"HMAC: Keyed-Hashing for Message Authentication"</span>, <span class="seriesInfo">RFC 2104</span>, <span class="seriesInfo">DOI 10.17487/RFC2104</span>, <time class="refDate" datetime="1997-02">February 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2104">https://www.rfc-editor.org/info/rfc2104</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4106">[RFC4106]</dt>
        <dd>
<span class="refAuthor">Viega, J.</span> and <span class="refAuthor">D. McGrew</span>, <span class="refTitle">"The Use of Galois/Counter Mode (GCM) in IPsec Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 4106</span>, <span class="seriesInfo">DOI 10.17487/RFC4106</span>, <time class="refDate" datetime="2005-06">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4106">https://www.rfc-editor.org/info/rfc4106</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4543">[RFC4543]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span> and <span class="refAuthor">J. Viega</span>, <span class="refTitle">"The Use of Galois Message Authentication Code (GMAC) in IPsec ESP and AH"</span>, <span class="seriesInfo">RFC 4543</span>, <span class="seriesInfo">DOI 10.17487/RFC4543</span>, <time class="refDate" datetime="2006-05">May 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4543">https://www.rfc-editor.org/info/rfc4543</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5282">[RFC5282]</dt>
        <dd>
<span class="refAuthor">Black, D.</span> and <span class="refAuthor">D. McGrew</span>, <span class="refTitle">"Using Authenticated Encryption Algorithms with the Encrypted Payload of the Internet Key Exchange version 2 (IKEv2) Protocol"</span>, <span class="seriesInfo">RFC 5282</span>, <span class="seriesInfo">DOI 10.17487/RFC5282</span>, <time class="refDate" datetime="2008-08">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5282">https://www.rfc-editor.org/info/rfc5282</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8645">[RFC8645]</dt>
        <dd>
<span class="refAuthor">Smyshlyaev, S., Ed.</span>, <span class="refTitle">"Re-keying Mechanisms for Symmetric Keys"</span>, <span class="seriesInfo">RFC 8645</span>, <span class="seriesInfo">DOI 10.17487/RFC8645</span>, <time class="refDate" datetime="2019-08">August 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8645">https://www.rfc-editor.org/info/rfc8645</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MGM-SECURITY">[MGM-SECURITY]</dt>
        <dd>
<span class="refAuthor">Akhmetzyanova, L.</span>, <span class="refAuthor">Alekseev, E.</span>, <span class="refAuthor">Karpunin, G.</span>, and <span class="refAuthor">V. Nozdrunov</span>, <span class="refTitle">"Security of Multilinear Galois Mode (MGM)"</span>, <time class="refDate" datetime="2019">2019</time>, <span>&lt;<a href="https://eprint.iacr.org/2019/123.pdf">https://eprint.iacr.org/2019/123.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SP800-67">[SP800-67]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology</span>, <span class="refTitle">"Recommendation for the Triple Data Encryption Algorithm (TDEA) Block Cipher"</span>, <span class="seriesInfo">DOI 10.6028/NIST.SP.800-67r2</span>, <time class="refDate" datetime="2017-11">November 2017</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-67r2.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-67r2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="AEAD-USAGE-LIMITS">[AEAD-USAGE-LIMITS]</dt>
      <dd>
<span class="refAuthor">Günther, F.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Usage Limits on AEAD Algorithms"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-aead-limits-04</span>, <time class="refDate" datetime="2022-03-07">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-04">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="testvec">
<section id="appendix-A">
      <h2 id="name-test-vectors">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-test-vectors">Test Vectors</a>
      </h2>
<p id="appendix-A-1"> In the following test vectors, binary data is represented in hexadecimal format.
            The numbers in square brackets indicate the size of the corresponding data in decimal format.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<ol class="normal type-1" id="appendix-A-2" start="1" type="1">
<li id="appendix-A-2.1">
          <p id="appendix-A-2.1.1">ENCR_KUZNYECHIK_MGM_KTREE (Example 1):<a class="pilcrow" href="#appendix-A-2.1.1">¶</a></p>
<div id="appendix-A-2.1.2">
<pre class="lang-test-vectors sourcecode">transform key [44]:
    b6 18 0c 14 5c 51 2d bd 69 d9 ce a9 2c ac 1b 5c
    e1 bc fa 73 79 2d 61 af 0b 44 0d 84 b5 22 cc 38
    7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
K [32]:
    b6 18 0c 14 5c 51 2d bd 69 d9 ce a9 2c ac 1b 5c
    e1 bc fa 73 79 2d 61 af 0b 44 0d 84 b5 22 cc 38
salt [12]:
    7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
i1 = 00, i2 = 0000, i3 = 0000, pnum = 000000
K_msg [32]:
    2f f1 c9 0e de 78 6e 06 1e 17 b3 74 d7 82 af 7b
    d8 80 bd 52 7c 66 a2 ba dc 3e 56 9a ab 27 1d a4
nonce [16]:
    00 00 00 00 7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
IV [8]:
    00 00 00 00 00 00 00 00
AAD [8]:
    51 46 53 6b 00 00 00 01
plaintext [64]:
    45 00 00 3c 23 35 00 00 7f 01 ee cc 0a 6f 0a c5
    0a 6f 0a 1d 08 00 f3 5b 02 00 58 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
ciphertext [64]:
    18 9d 12 88 b7 18 f9 ea be 55 4b 23 9b ee 65 96
    c6 d4 ea fd 31 64 96 ef 90 1c ac 31 60 05 aa 07
    62 97 b2 24 bf 6d 2b e3 5f d6 f6 7e 7b 9d eb 31
    85 ff e9 17 9c a9 bf 0b db af c2 3e ae 4d a5 6f
ESP ICV [12]:
    50 b0 70 a1 5a 2b d9 73 86 89 f8 ed
ESP packet [112]:
    45 00 00 70 00 4d 00 00 ff 32 91 4f 0a 6f 0a c5
    0a 6f 0a 1d 51 46 53 6b 00 00 00 01 00 00 00 00
    00 00 00 00 18 9d 12 88 b7 18 f9 ea be 55 4b 23
    9b ee 65 96 c6 d4 ea fd 31 64 96 ef 90 1c ac 31
    60 05 aa 07 62 97 b2 24 bf 6d 2b e3 5f d6 f6 7e
    7b 9d eb 31 85 ff e9 17 9c a9 bf 0b db af c2 3e
    ae 4d a5 6f 50 b0 70 a1 5a 2b d9 73 86 89 f8 ed
</pre><a class="pilcrow" href="#appendix-A-2.1.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.2">
          <p id="appendix-A-2.2.1">ENCR_KUZNYECHIK_MGM_KTREE (Example 2):<a class="pilcrow" href="#appendix-A-2.2.1">¶</a></p>
<div id="appendix-A-2.2.2">
<pre class="lang-test-vectors sourcecode">transform key [44]:
    b6 18 0c 14 5c 51 2d bd 69 d9 ce a9 2c ac 1b 5c
    e1 bc fa 73 79 2d 61 af 0b 44 0d 84 b5 22 cc 38
    7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
K [32]:
    b6 18 0c 14 5c 51 2d bd 69 d9 ce a9 2c ac 1b 5c
    e1 bc fa 73 79 2d 61 af 0b 44 0d 84 b5 22 cc 38
salt [12]:
    7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
i1 = 00, i2 = 0001, i3 = 0001, pnum = 000000
K_msg [32]:
    9a ba c6 57 78 18 0e 6f 2a f6 1f b8 d5 71 62 36
    66 c2 f5 13 0d 54 e2 11 6c 7d 53 0e 6e 7d 48 bc
nonce [16]:
    00 00 00 00 7b 67 e6 f2 44 f9 7f 06 78 95 2e 45
IV [8]:
    00 00 01 00 01 00 00 00
AAD [8]:
    51 46 53 6b 00 00 00 10
plaintext [64]:
    45 00 00 3c 23 48 00 00 7f 01 ee b9 0a 6f 0a c5
    0a 6f 0a 1d 08 00 e4 5b 02 00 67 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
ciphertext [64]:
    78 0a 2c 62 62 32 15 7b fe 01 76 32 f3 2d b4 d0
    a4 fa 61 2f 66 c2 bf 79 d5 e2 14 9b ac 1d fc 4b
    15 4b 69 03 4d c2 1d ef 20 90 6d 59 62 81 12 7c
    ff 72 56 ab f0 0b a1 22 bb 5e 6c 71 a4 d4 9a 4d
ESP ICV [12]:
    c2 2f 87 40 83 8e 3d fa ce 91 cc b8
ESP packet [112]:
    45 00 00 70 00 5c 00 00 ff 32 91 40 0a 6f 0a c5
    0a 6f 0a 1d 51 46 53 6b 00 00 00 10 00 00 01 00
    01 00 00 00 78 0a 2c 62 62 32 15 7b fe 01 76 32
    f3 2d b4 d0 a4 fa 61 2f 66 c2 bf 79 d5 e2 14 9b
    ac 1d fc 4b 15 4b 69 03 4d c2 1d ef 20 90 6d 59
    62 81 12 7c ff 72 56 ab f0 0b a1 22 bb 5e 6c 71
    a4 d4 9a 4d c2 2f 87 40 83 8e 3d fa ce 91 cc b8
</pre><a class="pilcrow" href="#appendix-A-2.2.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.3">
          <p id="appendix-A-2.3.1">ENCR_MAGMA_MGM_KTREE (Example 1):<a class="pilcrow" href="#appendix-A-2.3.1">¶</a></p>
<div id="appendix-A-2.3.2">
<pre class="lang-test-vectors sourcecode">transform key [36]:
    5b 50 bf 33 78 87 02 38 f3 ca 74 0f d1 24 ba 6c
    22 83 ef 58 9b e6 f4 6a 89 4a a3 5d 5f 06 b2 03
    cf 36 63 12
K [32]:
    5b 50 bf 33 78 87 02 38 f3 ca 74 0f d1 24 ba 6c
    22 83 ef 58 9b e6 f4 6a 89 4a a3 5d 5f 06 b2 03
salt [4]:
    cf 36 63 12
i1 = 00, i2 = 0000, i3 = 0000, pnum = 000000
K_msg [32]:
    25 65 21 e2 70 b7 4a 16 4d fc 26 e6 bf 0c ca 76
    5e 9d 41 02 7d 4b 7b 19 76 2b 1c c9 01 dc de 7f
nonce [8]:
    00 00 00 00 cf 36 63 12
IV [8]:
    00 00 00 00 00 00 00 00
AAD [8]:
    c8 c2 b2 8d 00 00 00 01
plaintext [64]:
    45 00 00 3c 24 2d 00 00 7f 01 ed d4 0a 6f 0a c5
    0a 6f 0a 1d 08 00 de 5b 02 00 6d 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
ciphertext [64]:
    fa 08 40 33 2c 4f 3f c9 64 4d 8c 2c 4a 91 7e 0c
    d8 6f 8e 61 04 03 87 64 6b b9 df bd 91 50 3f 4a
    f5 d2 42 69 49 d3 5a 22 9e 1e 0e fc 99 ac ee 9e
    32 43 e2 3b a4 d1 1e 84 5c 91 a7 19 15 52 cc e8
ESP ICV [8]:
    5f 4a fa 8b 02 94 0f 5c
ESP packet [108]:
    45 00 00 6c 00 62 00 00 ff 32 91 3e 0a 6f 0a c5
    0a 6f 0a 1d c8 c2 b2 8d 00 00 00 01 00 00 00 00
    00 00 00 00 fa 08 40 33 2c 4f 3f c9 64 4d 8c 2c
    4a 91 7e 0c d8 6f 8e 61 04 03 87 64 6b b9 df bd
    91 50 3f 4a f5 d2 42 69 49 d3 5a 22 9e 1e 0e fc
    99 ac ee 9e 32 43 e2 3b a4 d1 1e 84 5c 91 a7 19
    15 52 cc e8 5f 4a fa 8b 02 94 0f 5c
</pre><a class="pilcrow" href="#appendix-A-2.3.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.4">
          <p id="appendix-A-2.4.1">ENCR_MAGMA_MGM_KTREE (Example 2):<a class="pilcrow" href="#appendix-A-2.4.1">¶</a></p>
<div id="appendix-A-2.4.2">
<pre class="lang-test-vectors sourcecode">transform key [36]:
    5b 50 bf 33 78 87 02 38 f3 ca 74 0f d1 24 ba 6c
    22 83 ef 58 9b e6 f4 6a 89 4a a3 5d 5f 06 b2 03
    cf 36 63 12
K [32]:
    5b 50 bf 33 78 87 02 38 f3 ca 74 0f d1 24 ba 6c
    22 83 ef 58 9b e6 f4 6a 89 4a a3 5d 5f 06 b2 03
salt [4]:
    cf 36 63 12
i1 = 00, i2 = 0001, i3 = 0001, pnum = 000000
K_msg [32]:
    20 e0 46 d4 09 83 9b 23 f0 66 a5 0a 7a 06 5b 4a
    39 24 4f 0e 29 ef 1e 6f 2e 5d 2e 13 55 f5 da 08
nonce [8]:
    00 00 00 00 cf 36 63 12
IV [8]:
    00 00 01 00 01 00 00 00
AAD [8]:
    c8 c2 b2 8d 00 00 00 10
plaintext [64]:
    45 00 00 3c 24 40 00 00 7f 01 ed c1 0a 6f 0a c5
    0a 6f 0a 1d 08 00 cf 5b 02 00 7c 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
ciphertext [64]:
    7a 71 48 41 a5 34 b7 58 93 6a 8e ab 26 91 40 a8
    25 a7 f3 5d b9 e4 37 1f e7 6c 99 9c 9b 88 db 72
    1d c7 59 f6 56 b5 b3 ea b6 b1 4d 6b d7 7a 07 1d
    4b 93 78 bd 08 97 6c 33 ed 9a 01 91 bf fe a1 dd
ESP ICV [8]:
    dd 5d 50 9a fd b8 09 98
ESP packet [108]:
    45 00 00 6c 00 71 00 00 ff 32 91 2f 0a 6f 0a c5
    0a 6f 0a 1d c8 c2 b2 8d 00 00 00 10 00 00 01 00
    01 00 00 00 7a 71 48 41 a5 34 b7 58 93 6a 8e ab
    26 91 40 a8 25 a7 f3 5d b9 e4 37 1f e7 6c 99 9c
    9b 88 db 72 1d c7 59 f6 56 b5 b3 ea b6 b1 4d 6b
    d7 7a 07 1d 4b 93 78 bd 08 97 6c 33 ed 9a 01 91
    bf fe a1 dd dd 5d 50 9a fd b8 09 98
</pre><a class="pilcrow" href="#appendix-A-2.4.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.5">
          <p id="appendix-A-2.5.1">ENCR_KUZNYECHIK_MGM_MAC_KTREE (Example 1):<a class="pilcrow" href="#appendix-A-2.5.1">¶</a></p>
<div id="appendix-A-2.5.2">
<pre class="lang-test-vectors sourcecode">transform key [44]:
    98 bd 34 ce 3b e1 9a 34 65 e4 87 c0 06 48 83 f4
    88 cc 23 92 63 dc 32 04 91 9b 64 3f e7 57 b2 be
    6c 51 cb ac 93 c4 5b ea 99 62 79 1d
K [32]:
    98 bd 34 ce 3b e1 9a 34 65 e4 87 c0 06 48 83 f4
    88 cc 23 92 63 dc 32 04 91 9b 64 3f e7 57 b2 be
salt [12]:
    6c 51 cb ac 93 c4 5b ea 99 62 79 1d
i1 = 00, i2 = 0000, i3 = 0000, pnum = 000000
K_msg [32]:
    98 f1 03 01 81 0a 04 1c da dd e1 bd 85 a0 8f 21
    8b ac b5 7e 00 35 e2 22 c8 31 e3 e4 f0 a2 0c 8f
nonce [16]:
    00 00 00 00 6c 51 cb ac 93 c4 5b ea 99 62 79 1d
IV [8]:
    00 00 00 00 00 00 00 00
AAD [80]:
    3d ac 92 6a 00 00 00 01 00 00 00 00 00 00 00 00
    45 00 00 3c 0c f1 00 00 7f 01 05 11 0a 6f 0a c5
    0a 6f 0a 1d 08 00 48 5c 02 00 03 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
plaintext [0]:
ciphertext [0]:
ESP ICV [12]:
    ca c5 8c e5 e8 8b 4b f3 2d 6c f0 4d
ESP packet [112]:
    45 00 00 70 00 01 00 00 ff 32 91 9b 0a 6f 0a c5
    0a 6f 0a 1d 3d ac 92 6a 00 00 00 01 00 00 00 00
    00 00 00 00 45 00 00 3c 0c f1 00 00 7f 01 05 11
    0a 6f 0a c5 0a 6f 0a 1d 08 00 48 5c 02 00 03 00
    61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
    71 72 73 74 75 76 77 61 62 63 64 65 66 67 68 69
    01 02 02 04 ca c5 8c e5 e8 8b 4b f3 2d 6c f0 4d
</pre><a class="pilcrow" href="#appendix-A-2.5.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.6">
          <p id="appendix-A-2.6.1">ENCR_KUZNYECHIK_MGM_MAC_KTREE (Example 2):<a class="pilcrow" href="#appendix-A-2.6.1">¶</a></p>
<div id="appendix-A-2.6.2">
<pre class="lang-test-vectors sourcecode">transform key [44]:
    98 bd 34 ce 3b e1 9a 34 65 e4 87 c0 06 48 83 f4
    88 cc 23 92 63 dc 32 04 91 9b 64 3f e7 57 b2 be
    6c 51 cb ac 93 c4 5b ea 99 62 79 1d
K [32]:
    98 bd 34 ce 3b e1 9a 34 65 e4 87 c0 06 48 83 f4
    88 cc 23 92 63 dc 32 04 91 9b 64 3f e7 57 b2 be
salt [12]:
    6c 51 cb ac 93 c4 5b ea 99 62 79 1d
i1 = 00, i2 = 0000, i3 = 0001, pnum = 000000
K_msg [32]:
    02 c5 41 87 7c c6 23 f3 f1 35 91 9a 75 13 b6 f8
    a8 a1 8c b2 63 99 86 2f 50 81 4f 52 91 01 67 84
nonce [16]:
    00 00 00 00 6c 51 cb ac 93 c4 5b ea 99 62 79 1d
IV [8]:
    00 00 00 00 01 00 00 00
AAD [80]:
    3d ac 92 6a 00 00 00 06 00 00 00 00 01 00 00 00
    45 00 00 3c 0c fb 00 00 7f 01 05 07 0a 6f 0a c5
    0a 6f 0a 1d 08 00 43 5c 02 00 08 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
plaintext [0]:
ciphertext [0]:
ESP ICV [12]:
    ba bc 67 ec 72 a8 c3 1a 89 b4 0e 91
ESP packet [112]:
    45 00 00 70 00 06 00 00 ff 32 91 96 0a 6f 0a c5
    0a 6f 0a 1d 3d ac 92 6a 00 00 00 06 00 00 00 00
    01 00 00 00 45 00 00 3c 0c fb 00 00 7f 01 05 07
    0a 6f 0a c5 0a 6f 0a 1d 08 00 43 5c 02 00 08 00
    61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
    71 72 73 74 75 76 77 61 62 63 64 65 66 67 68 69
    01 02 02 04 ba bc 67 ec 72 a8 c3 1a 89 b4 0e 91
</pre><a class="pilcrow" href="#appendix-A-2.6.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.7">
          <p id="appendix-A-2.7.1">ENCR_MAGMA_MGM_MAC_KTREE (Example 1):<a class="pilcrow" href="#appendix-A-2.7.1">¶</a></p>
<div id="appendix-A-2.7.2">
<pre class="lang-test-vectors sourcecode">transform key [36]:
    d0 65 b5 30 fa 20 b8 24 c7 57 0c 1d 86 2a e3 39
    2c 1c 07 6d fa da 69 75 74 4a 07 a8 85 7d bd 30
    88 79 8f 29
K [32]:
    d0 65 b5 30 fa 20 b8 24 c7 57 0c 1d 86 2a e3 39
    2c 1c 07 6d fa da 69 75 74 4a 07 a8 85 7d bd 30
salt [4]:
    88 79 8f 29
i1 = 00, i2 = 0000, i3 = 0000, pnum = 000000
K_msg [32]:
    4c 61 45 99 a0 a0 67 f1 94 87 24 0a e1 00 e1 b7
    ea f2 3e da f8 7e 38 73 50 86 1c 68 3b a4 04 46
nonce [8]:
    00 00 00 00 88 79 8f 29
IV [8]:
    00 00 00 00 00 00 00 00
AAD [80]:
    3e 40 69 9c 00 00 00 01 00 00 00 00 00 00 00 00
    45 00 00 3c 0e 08 00 00 7f 01 03 fa 0a 6f 0a c5
    0a 6f 0a 1d 08 00 36 5c 02 00 15 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
plaintext [0]:
ciphertext [0]:
ESP ICV [8]:
    4d d4 25 8a 25 35 95 df
ESP packet [108]:
    45 00 00 6c 00 13 00 00 ff 32 91 8d 0a 6f 0a c5
    0a 6f 0a 1d 3e 40 69 9c 00 00 00 01 00 00 00 00
    00 00 00 00 45 00 00 3c 0e 08 00 00 7f 01 03 fa
    0a 6f 0a c5 0a 6f 0a 1d 08 00 36 5c 02 00 15 00
    61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
    71 72 73 74 75 76 77 61 62 63 64 65 66 67 68 69
    01 02 02 04 4d d4 25 8a 25 35 95 df
</pre><a class="pilcrow" href="#appendix-A-2.7.2">¶</a>
</div>
</li>
        <li id="appendix-A-2.8">
          <p id="appendix-A-2.8.1">ENCR_MAGMA_MGM_MAC_KTREE (Example 2):<a class="pilcrow" href="#appendix-A-2.8.1">¶</a></p>
<div id="appendix-A-2.8.2">
<pre class="lang-test-vectors sourcecode">transform key [36]:
    d0 65 b5 30 fa 20 b8 24 c7 57 0c 1d 86 2a e3 39
    2c 1c 07 6d fa da 69 75 74 4a 07 a8 85 7d bd 30
    88 79 8f 29
K [32]:
    d0 65 b5 30 fa 20 b8 24 c7 57 0c 1d 86 2a e3 39
    2c 1c 07 6d fa da 69 75 74 4a 07 a8 85 7d bd 30
salt [4]:
    88 79 8f 29
i1 = 00, i2 = 0000, i3 = 0001, pnum = 000000
K_msg [32]:
    b4 f3 f9 0d c4 87 fa b8 c4 af d0 eb 45 49 f2 f0
    e4 36 32 b6 79 19 37 2e 1e 96 09 ea f0 b8 e2 28
nonce [8]:
    00 00 00 00 88 79 8f 29
IV [8]:
    00 00 00 00 01 00 00 00
AAD [80]:
    3e 40 69 9c 00 00 00 06 00 00 00 00 01 00 00 00
    45 00 00 3c 0e 13 00 00 7f 01 03 ef 0a 6f 0a c5
    0a 6f 0a 1d 08 00 31 5c 02 00 1a 00 61 62 63 64
    65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74
    75 76 77 61 62 63 64 65 66 67 68 69 01 02 02 04
plaintext [0]:
ciphertext [0]:
ESP ICV [8]:
    84 84 a9 23 30 a0 b1 96
ESP packet [108]:
    45 00 00 6c 00 18 00 00 ff 32 91 88 0a 6f 0a c5
    0a 6f 0a 1d 3e 40 69 9c 00 00 00 06 00 00 00 00
    01 00 00 00 45 00 00 3c 0e 13 00 00 7f 01 03 ef
    0a 6f 0a c5 0a 6f 0a 1d 08 00 31 5c 02 00 1a 00
    61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
    71 72 73 74 75 76 77 61 62 63 64 65 66 67 68 69
    01 02 02 04 84 84 a9 23 30 a0 b1 96
</pre><a class="pilcrow" href="#appendix-A-2.8.2">¶</a>
</div>
</li>
      </ol>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">The author wants to thank <span class="contact-name">Adrian Farrel</span>, <span class="contact-name">Russ Housley</span>, <span class="contact-name">Yaron Sheffer</span>, and <span class="contact-name">Stanislav Smyshlyaev</span> for valuable input during the
          publication process for this document.<a class="pilcrow" href="#appendix-B-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-address">
<a class="section-name selfRef" href="#name-authors-address">Author's Address</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Valery Smyslov</span></div>
<div class="left" dir="auto"><span class="org">ELVIS-PLUS</span></div>
<div class="left" dir="auto"><span class="street-address">PO Box 81</span></div>
<div class="left" dir="auto"><span class="locality">Moscow (Zelenograd)</span></div>
<div class="left" dir="auto"><span class="postal-code">124460</span></div>
<div class="left" dir="auto"><span class="country-name">Russian Federation</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+7%20495%20276%200211">+7 495 276 0211</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:svan@elvis.ru">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>