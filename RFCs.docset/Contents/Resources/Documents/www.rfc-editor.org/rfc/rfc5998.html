<html><head></head><body><pre>Internet Engineering Task Force (IETF)                         P. Eronen
Request for Comments: 5998                                   Independent
Updates: <a href="./rfc5996">5996</a>                                              H. Tschofenig
Category: Standards Track                         Nokia Siemens Networks
ISSN: 2070-1721                                               Y. Sheffer
                                                             Independent
                                                          September 2010


           <span class="h1">An Extension for EAP-Only Authentication in IKEv2</span>

Abstract

   IKEv2 specifies that Extensible Authentication Protocol (EAP)
   authentication must be used together with responder authentication
   based on public key signatures.  This is necessary with old EAP
   methods that provide only unilateral authentication using, e.g., one-
   time passwords or token cards.

   This document specifies how EAP methods that provide mutual
   authentication and key agreement can be used to provide extensible
   responder authentication for IKEv2 based on methods other than public
   key signatures.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc5998">http://www.rfc-editor.org/info/rfc5998</a>.














<span class="grey">Eronen, et al.               Standards Track                    [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


Copyright Notice

   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   The Extensible Authentication Protocol (EAP), defined in [<a href="./rfc3748" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>],
   is an authentication framework that supports multiple authentication
   mechanisms.  Today, EAP has been implemented at end hosts and routers
   that connect via switched circuits or dial-up lines using PPP
   [<a href="./rfc1661" title='"The Point-to-Point Protocol (PPP)"'>RFC1661</a>], IEEE 802 wired switches [<a href="#ref-IEEE8021X" title='"Local and Metropolitan Area Networks: Port-Based Network Access Control"'>IEEE8021X</a>], and IEEE 802.11
   wireless access points [<a href="#ref-IEEE80211i" title='"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless Medium Access Control (MAC) and Physical Layer (PHY) specifications: Amendment 6: Medium Access Control (MAC) Security Enhancements"'>IEEE80211i</a>].

   One of the advantages of the EAP architecture is its flexibility.
   EAP is used to select a specific authentication mechanism, typically
   after the authenticator requests more information in order to
   determine the specific authentication method to be used.  Rather than
   requiring the authenticator (e.g., wireless LAN access point) to be
   updated to support each new authentication method, EAP permits the
   use of a backend authentication server that may implement some or all
   authentication methods.







<span class="grey">Eronen, et al.               Standards Track                    [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   IKEv2 ([<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>] and [<a href="./rfc5996" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>]) is a component of IPsec used for
   performing mutual authentication and establishing and maintaining
   Security Associations (SAs) for IPsec ESP and Authentication Header
   (AH).  In addition to supporting authentication using public key
   signatures and shared secrets, IKEv2 also supports EAP
   authentication.

   IKEv2 provides EAP authentication since it was recognized that public
   key signatures and shared secrets are not flexible enough to meet the
   requirements of many deployment scenarios.  By using EAP, IKEv2 can
   leverage existing authentication infrastructure and credential
   databases, since EAP allows users to choose a method suitable for
   existing credentials, and also makes separation of the IKEv2
   responder (VPN gateway) from the EAP authentication endpoint (backend
   Authentication, Authorization, and Accounting (AAA) server) easier.

   Some older EAP methods are designed for unilateral authentication
   only (that is, EAP peer to EAP server).  These methods are used in
   conjunction with IKEv2 public-key-based authentication of the
   responder to the initiator.  It is expected that this approach is
   especially useful for "road warrior" VPN gateways that use, for
   instance, one-time passwords or token cards to authenticate the
   clients.

   However, most newer EAP methods, such as those typically used with
   IEEE 802.11i wireless LANs, provide mutual authentication and key
   agreement.  Currently, IKEv2 specifies that these EAP methods must
   also be used together with responder authentication based on public
   key signatures.

   In order for the public key signature authentication of the gateway
   to be effective, a deployment of Public Key Infrastructure (PKI) is
   required, which has to include management of trust anchors on all
   supplicants.  In many environments, this is not realistic, and the
   security of the gateway public key is the same as the security of a
   self-signed certificate.  Mutually authenticating EAP methods alone
   can provide a sufficient level of security in many circumstances, and
   in fact, in some deployments, IEEE 802.11i uses EAP without any PKI
   for authenticating the Wireless Local Area Network (WLAN) access
   points.

   This document specifies how EAP methods that offer mutual
   authentication and key agreement can be used to provide responder
   authentication in IKEv2 completely based on EAP.







<span class="grey">Eronen, et al.               Standards Track                    [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Terminology</span>

   All notation in this protocol extension is taken from [<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>].

   Numbered messages refer to the IKEv2 message sequence when using EAP.

   Thus:

   o  Message 1 is the request message of IKE_SA_INIT.

   o  Message 2 is the response message of IKE_SA_INIT.

   o  Message 3 is the first request of IKE_AUTH.

   o  Message 4 is the first response of IKE_AUTH.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Scenarios"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Scenarios</span>

   In this section, we describe two scenarios for extensible
   authentication within IKEv2.  These scenarios are intended to be
   illustrative examples rather than specifying how things should be
   done.

   Figure 1 shows a configuration where the EAP and the IKEv2 endpoints
   are co-located.  Authenticating the IKEv2 responder using both EAP
   and public key signatures is redundant.  Offering EAP-based
   authentication has the advantage that multiple different
   authentication and key exchange protocols are available with EAP with
   different security properties (such as strong password-based
   protocols, protocols offering user identity confidentiality, and many
   more).

          +------+-----+                            +------------+
     O    |   IKEv2    |                            |   IKEv2    |
    /|\   | Initiator  |&lt;---////////////////////---&gt;| Responder  |
    / \   +------------+          IKEv2             +------------+
    User  |  EAP Peer  |          Exchange          | EAP Server |
          +------------+                            +------------+

             Figure 1: EAP and IKEv2 Endpoints Are Co-Located

   Figure 2 shows a typical corporate network access scenario.  The
   initiator (client) interacts with the responder (VPN gateway) in the
   corporate network.  The EAP exchange within IKE runs between the



<span class="grey">Eronen, et al.               Standards Track                    [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   client and the home AAA server.  As a result of a successful EAP
   authentication protocol run, session keys are established and sent
   from the AAA server to the VPN gateway, and then used to authenticate
   the IKEv2 SA with AUTH payloads.

   The protocol used between the VPN gateway and AAA server could be,
   for instance, Diameter [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>] or RADIUS [<a href="./rfc3579" title='"RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)"'>RFC3579</a>].  See <a href="#section-6">Section 6</a>
   for related security considerations.

                                +-------------------------------+
                                |       Corporate network       |
                                |                               |
                           +-----------+            +--------+  |
                           |   IKEv2   |     AAA    |  Home  |  |
     IKEv2      +////-----&gt;+ Responder +&lt;----------&gt;+  AAA   |  |
     Exchange   /          | (VPN GW)  |  (RADIUS/  | Server |  |
                /          +-----------+  Diameter) +--------+  |
                /               |        carrying EAP           |
                |               |                               |
                |               +-------------------------------+
                v
         +------+-----+
     o   |   IKEv2    |
    /|\  | Initiator  |
    / \  | VPN client |
   User  +------------+

                    Figure 2: Corporate Network Access

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Solution"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Solution</span>

   IKEv2 specifies that when the EAP method establishes a shared secret
   key, that key is used by both the initiator and responder to generate
   an AUTH payload (thus authenticating the IKEv2 SA set up by messages
   1 and 2).

   When used together with public key responder authentication, the
   responder is, in effect, authenticated using two different methods:
   the public key signature AUTH payload in message 4, and the EAP-based
   AUTH payload later.

   If the initiator does not wish to use public-key-based responder
   authentication, it includes an EAP_ONLY_AUTHENTICATION notification
   payload (16417) in message 3.  The Protocol ID and Security Parameter
   Index (SPI) size fields are set to zero, and there is no additional
   data associated with this notification.





<span class="grey">Eronen, et al.               Standards Track                    [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   If the responder supports this notification and chooses to use it, it
   omits the public-key-based AUTH payload and CERT payloads from
   message 4.

   If the responder does not support the EAP_ONLY_AUTHENTICATION
   notification or does not wish to use it, it ignores the notification
   payload, and includes the AUTH payload in message 4.  In this case,
   the initiator MUST verify that payload and any associated
   certificates, as per [<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>].

   When receiving message 4, the initiator MUST verify that the proposed
   EAP method is allowed by this specification, and MUST abort the
   protocol immediately otherwise.

   Both the initiator and responder MUST verify that the EAP method
   actually used provided mutual authentication and established a shared
   secret key.  The AUTH payloads sent after EAP Success MUST use the
   EAP-generated key, and MUST NOT use SK_pi or SK_pr (see <a href="./rfc5996#section-2.15">Section 2.15
   of [RFC5996]</a>).
































<span class="grey">Eronen, et al.               Standards Track                    [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   An IKEv2 message exchange with this modification is shown below:

      Initiator                   Responder
     -----------                 -----------
      HDR, SAi1, KEi, Ni,
           [N(NAT_DETECTION_SOURCE_IP),
            N(NAT_DETECTION_DESTINATION_IP)]  --&gt;

                            &lt;--   HDR, SAr1, KEr, Nr, [CERTREQ],
                                       [N(NAT_DETECTION_SOURCE_IP),
                                        N(NAT_DETECTION_DESTINATION_IP)]

      HDR, SK { IDi, [IDr], SAi2, TSi, TSr,
                N(EAP_ONLY_AUTHENTICATION),
                [CP(CFG_REQUEST)] }  --&gt;

                            &lt;--   HDR, SK { IDr, EAP(Request) }

      HDR, SK { EAP(Response) }  --&gt;

                            &lt;--   HDR, SK { EAP(Request) }

      HDR, SK { EAP(Response) }  --&gt;

                            &lt;--   HDR, SK { EAP(Success) }

      HDR, SK { AUTH }  --&gt;

                            &lt;--   HDR, SK { AUTH, SAr2, TSi, TSr,
                                            [CP(CFG_REPLY] }

   Note: all notation in the above protocol sequence and elsewhere in
   this specification is as defined in [<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>], and see in particular
   Sec. 1.2 of [<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>] for payload types.

   The NAT detection and Configuration payloads are shown for
   informative purposes only; they do not change how EAP authentication
   works.

   An IKE SA that was set up with this extension can be resumed using
   the mechanism described in [<a href="./rfc5723" title='"Internet Key Exchange Protocol Version 2 (IKEv2) Session Resumption"'>RFC5723</a>].  However, session resumption
   does not change the authentication method.  Therefore, during the
   IKE_AUTH exchange of the resumed session, this extension MUST NOT be
   sent by the initiator.







<span class="grey">Eronen, et al.               Standards Track                    [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Safe%20EAP%20Methods"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Safe EAP Methods</span>

   EAP methods to be used with this extension MUST have the following
   properties:

   1.  The method provides mutual authentication of the peers.

   2.  The method is key-generating.

   3.  The method is resistant to dictionary attacks.

   The authors believe that the following EAP methods are secure when
   used with the current extension.  The list is not inclusive, and
   there are likely other safe methods that have not been listed here.

   +-------------------------------+-------------------+---------------+
   | Method Name                   | Allows Channel    | Reference     |
   |                               | Binding?          |               |
   +-------------------------------+-------------------+---------------+
   | EAP-SIM                       | No                | [<a href="./rfc4186" title='"Extensible Authentication Protocol Method for Global System for Mobile Communications (GSM) Subscriber Identity Modules (EAP-SIM)"'>RFC4186</a>]     |
   | EAP-AKA                       | Yes               | [<a href="./rfc4187" title='"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)"'>RFC4187</a>]     |
   | EAP-AKA'                      | Yes               | [<a href="./rfc5448" title="&quot;Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP- AKA')&quot;">RFC5448</a>]     |
   | EAP-GPSK                      | Yes               | [<a href="./rfc5433" title='"Extensible Authentication Protocol - Generalized Pre-Shared Key (EAP-GPSK) Method"'>RFC5433</a>]     |
   | EAP-pwd                       | No                | [<a href="./rfc5931" title='"Extensible Authentication Protocol (EAP) Authentication Using Only A Password"'>RFC5931</a>]     |
   | EAP-EKE                       | Yes               | [<a href="#ref-EMU-EAP-EKE" title='"An EAP Authentication Method Based on the EKE Protocol"'>EMU-EAP-EKE</a>] |
   | EAP-PAX                       | Yes               | [<a href="./rfc4746" title='"Extensible Authentication Protocol (EAP) Password Authenticated Exchange"'>RFC4746</a>]     |
   | EAP-SAKE                      | No                | [<a href="./rfc4763" title='"Extensible Authentication Protocol Method for Shared-secret Authentication and Key Establishment (EAP-SAKE)"'>RFC4763</a>]     |
   | EAP-SRP                       | No                | [<a href="#ref-EAP-SRP" title='"EAP SRP- SHA1 Authentication Protocol"'>EAP-SRP</a>]     |
   | EAP-POTP (mutual              | Yes               | [<a href="./rfc4793" title='"The EAP Protected One-Time Password Protocol (EAP-POTP)"'>RFC4793</a>]     |
   | authentication variant)       |                   |               |
   | EAP-TLS                       | No                | [<a href="./rfc5216" title='"The EAP-TLS Authentication Protocol"'>RFC5216</a>]     |
   | EAP-FAST                      | No                | [<a href="./rfc4851" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP-FAST)"'>RFC4851</a>]     |
   | EAP-TTLS                      | No                | [<a href="./rfc5281" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP- TTLSv0)"'>RFC5281</a>]     |
   +-------------------------------+-------------------+---------------+

   The "Allows channel binding?" column denotes protocols where
   protected identity information may be sent between the EAP endpoints.
   This third, optional property of the method provides protection
   against certain types of attacks (see <a href="#section-6.2">Section 6.2</a> for an
   explanation), and therefore in some scenarios, methods that allow for
   channel binding are to be preferred.  It is noted that at the time of
   writing, even when such capabilities are provided, they are not fully
   specified in an interoperable manner.  In particular, no RFC
   specifies what identities should be sent under the protection of the
   channel binding mechanism, or what policy is to be used to correlate
   identities at the different layers.





<span class="grey">Eronen, et al.               Standards Track                    [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  IANA Considerations</span>

   This document defines a new IKEv2 Notification Payload type,
   EAP_ONLY_AUTHENTICATION, described in <a href="#section-3">Section 3</a>.  This payload has
   been assigned the type number 16417 from the "Status Types" range.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Security Considerations</span>

   Security considerations applicable to all EAP methods are discussed
   in [<a href="./rfc3748" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>].  The EAP Key Management Framework [<a href="./rfc5247" title='"Extensible Authentication Protocol (EAP) Key Management Framework"'>RFC5247</a>] deals with
   issues that arise when EAP is used as a part of a larger system.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20Authentication%20of%20IKEv2%20SA"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Authentication of IKEv2 SA</span>

   It is important to note that the IKEv2 SA is not authenticated by
   just running an EAP conversation: the crucial step is the AUTH
   payload based on the EAP-generated key.  Thus, EAP methods that do
   not provide mutual authentication or establish a shared secret key
   MUST NOT be used with the modifications presented in this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20Authentication%20with%20Separated%20IKEv2%20Responder%20%2F%20EAP%20Server"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Authentication with Separated IKEv2 Responder / EAP Server</span>

   As described in <a href="#section-2">Section 2</a>, the EAP conversation can terminate either
   at the IKEv2 responder or at a backend AAA server.

   If the EAP method is terminated at the IKEv2 responder, then no key
   transport via the AAA infrastructure is required.  Pre-shared secret
   and public-key-based authentication offered by IKEv2 is then replaced
   by a wider range of authentication and key exchange methods.

   However, typically EAP will be used with a backend AAA server.  See
   [<a href="./rfc5247" title='"Extensible Authentication Protocol (EAP) Key Management Framework"'>RFC5247</a>] for a more complete discussion of the related security
   issues; here we provide only a short summary.

   When a backend server is used, there are actually two authentication
   exchanges: the EAP method between the client and the AAA server, and
   another authentication between the AAA server and IKEv2 gateway.  The
   AAA server authenticates the client using the selected EAP method,
   and they establish a session key.  The AAA server then sends this key
   to the IKEv2 gateway over a connection authenticated using, e.g.,
   IPsec or Transport Layer Security (TLS).

   Some EAP methods do not have any concept of pass-through
   authenticator (e.g., Network Access Server (NAS) or IKEv2 gateway)
   identity, and these two authentications remain quite independent of
   each other.  That is, after the client has verified the AUTH payload
   sent by the IKEv2 gateway, it knows that it is talking to SOME
   gateway trusted by the home AAA server, but not which one.  The



<span class="grey">Eronen, et al.               Standards Track                    [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   situation is somewhat similar if a single cryptographic hardware
   accelerator, containing a single private key, would be shared between
   multiple IKEv2 gateways (perhaps in some kind of cluster
   configuration).  In particular, if one of the gateways is
   compromised, it can impersonate any of the other gateways towards the
   user (until the compromise is discovered and access rights revoked).

   In some environments it is not desirable to trust the IKEv2 gateways
   this much (also known as the "Lying NAS Problem").  EAP methods that
   provide what is called "connection binding" or "channel binding"
   transport some identity or identities of the gateway (or WLAN access
   point / NAS) inside the EAP method.  Then the AAA server can check
   that it is indeed sending the key to the gateway expected by the
   client.  A potential solution is described in [<a href="#ref-EAP-SERVICE" title='"Authenticated Service Information for the Extensible Authentication Protocol (EAP)"'>EAP-SERVICE</a>], see also
   [<a href="#ref-EMU-AAAPAY" title='"EAP Method Support for Transporting AAA Payloads"'>EMU-AAAPAY</a>].

   In some deployment configurations, AAA proxies may be present between
   the IKEv2 gateway and the backend AAA server.  These AAA proxies MUST
   be trusted for secure operation, and therefore SHOULD be avoided when
   possible; see <a href="./rfc4072#section-2.3.4">Section 2.3.4 of [RFC4072]</a> and <a href="./rfc3579#section-4.3.7">Section 4.3.7 of
   [RFC3579]</a> for more discussion.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.3.%20%20Protection%20of%20EAP%20Payloads"></a><a class="selflink" href="#section-6.3" id="section-6.3">6.3</a>.  Protection of EAP Payloads</span>

   Although the EAP payloads are encrypted and integrity protected with
   SK_e/SK_a, this does not provide any protection against active
   attackers.  Until the AUTH payload has been received and verified, a
   man-in-the-middle can change the KEi/KEr payloads and eavesdrop or
   modify the EAP payloads.

   In IEEE 802.11i wireless LANs, the EAP payloads are neither encrypted
   nor integrity protected (by the link layer), so EAP methods are
   typically designed to take that into account.

   In particular, EAP methods that are vulnerable to dictionary attacks
   when used in WLANs are still vulnerable (to active attackers) when
   run inside IKEv2.

   The rules in <a href="#section-4">Section 4</a> are designed to avoid this potential
   vulnerability.











<span class="grey">Eronen, et al.               Standards Track                   [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.%20%20Identities%20and%20Authenticated%20Identities"></a><a class="selflink" href="#section-6.4" id="section-6.4">6.4</a>.  Identities and Authenticated Identities</span>

   When using this protocol, each of the peers sends two identity
   values:

   1.  An identity contained in the IKE ID payload.

   2.  An identity transferred within the specific EAP method's
       messages.

   (IKEv2 omits the EAP Identity request/response pair, see <a href="./rfc5996#section-3.16">Section 3.16
   of [RFC5996]</a>.)  The first identity value can be used by the recipient
   to route AAA messages and/or to select authentication and EAP types.
   But it is only the second identity that is directly authenticated by
   the EAP method.  The reader is referred to <a href="./rfc5996#section-2.16">Section 2.16 of [RFC5996]</a>
   regarding the need to base IPsec policy decisions on the
   authenticated identity.  In the context of the extension described
   here, this guidance on IPsec policy applies both to the
   authentication of the client by the gateway and vice versa.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.5.%20%20User%20Identity%20Confidentiality"></a><a class="selflink" href="#section-6.5" id="section-6.5">6.5</a>.  User Identity Confidentiality</span>

   IKEv2 provides confidentiality for the initiator identity against
   passive eavesdroppers, but not against active attackers.  The
   initiator announces its identity first (in message 3), before the
   responder has been authenticated.  The usage of EAP in IKEv2 does not
   change this situation, since the ID payload in message 3 is used
   instead of the EAP Identity Request/Response exchange.  This is
   somewhat unfortunate since when EAP is used with public key
   authentication of the responder, it would be possible to provide
   active user identity confidentiality for the initiator.

   IKEv2 protects the responder's identity even against active attacks.
   This property cannot be provided when using EAP.  If public key
   responder authentication is used in addition to EAP, the responder
   reveals its identity before authenticating the initiator.  If only
   EAP is used (as proposed in this document), the situation depends on
   the EAP method used (in some EAP methods, the server reveals its
   identity first).

   Hence, if active user identity confidentiality for the responder is
   required then EAP methods that offer this functionality have to be
   used (see <a href="./rfc3748#section-7.3">[RFC3748], Section 7.3</a>).








<span class="grey">Eronen, et al.               Standards Track                   [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Acknowledgments"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Acknowledgments</span>

   This document borrows some text from [<a href="./rfc3748" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>], [<a href="./rfc4306" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>], and
   [<a href="./rfc4072" title='"Diameter Extensible Authentication Protocol (EAP) Application"'>RFC4072</a>].  We would also like to thank Hugo Krawczyk for interesting
   discussions about this topic, Dan Harkins, and David Harrington for
   their comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20References"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]      Bradner, S., "Key words for use in RFCs to Indicate
                  Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3748">RFC3748</a>]      Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and
                  H. Levkowetz, "Extensible Authentication Protocol
                  (EAP)", <a href="./rfc3748">RFC 3748</a>, June 2004.

   [<a id="ref-RFC4306">RFC4306</a>]      Kaufman, C., "Internet Key Exchange (IKEv2) Protocol",
                  <a href="./rfc4306">RFC 4306</a>, December 2005.

   [<a id="ref-RFC5723">RFC5723</a>]      Sheffer, Y. and H. Tschofenig, "Internet Key Exchange
                  Protocol Version 2 (IKEv2) Session Resumption",
                  <a href="./rfc5723">RFC 5723</a>, January 2010.

   [<a id="ref-RFC5996">RFC5996</a>]      Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen,
                  "Internet Key Exchange Protocol Version 2 (IKEv2)",
                  <a href="./rfc5996">RFC 5996</a>, September 2010.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-EAP-SERVICE">EAP-SERVICE</a>]  Arkko, J. and P. Eronen, "Authenticated Service
                  Information for the Extensible Authentication Protocol
                  (EAP)", Work in Progress, October 2005.

   [<a id="ref-EAP-SRP">EAP-SRP</a>]      Carlson, J., Aboba, B., and H. Haverinen, "EAP SRP-
                  SHA1 Authentication Protocol", Work in Progress,
                  July 2001.

   [<a id="ref-EMU-AAAPAY">EMU-AAAPAY</a>]   Clancy, C., Lior, A., Zorn, G., and K. Hoeper, "EAP
                  Method Support for Transporting AAA Payloads", Work
                  in Progress, May 2010.

   [<a id="ref-EMU-EAP-EKE">EMU-EAP-EKE</a>]  Sheffer, Y., Zorn, G., Tschofenig, H., and S. Fluhrer,
                  "An EAP Authentication Method Based on the EKE
                  Protocol", Work in Progress, August 2010.





<span class="grey">Eronen, et al.               Standards Track                   [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   [<a id="ref-IEEE80211i">IEEE80211i</a>]   Institute of Electrical and Electronics Engineers,
                  "IEEE Standard for Information technology -
                  Telecommunications and information exchange between
                  systems - Local and metropolitan area networks -
                  Specific requirements - Part 11: Wireless Medium
                  Access Control (MAC) and Physical Layer (PHY)
                  specifications: Amendment 6: Medium Access Control
                  (MAC) Security Enhancements", IEEE Standard 802.11i-
                  2004, July 2004.

   [<a id="ref-IEEE8021X">IEEE8021X</a>]    Institute of Electrical and Electronics Engineers,
                  "Local and Metropolitan Area Networks: Port-Based
                  Network Access Control", IEEE Standard 802.1X-2001,
                  2001.

   [<a id="ref-RFC1661">RFC1661</a>]      Simpson, W., "The Point-to-Point Protocol (PPP)",
                  STD 51, <a href="./rfc1661">RFC 1661</a>, July 1994.

   [<a id="ref-RFC3579">RFC3579</a>]      Aboba, B. and P. Calhoun, "RADIUS (Remote
                  Authentication Dial In User Service) Support For
                  Extensible Authentication Protocol (EAP)", <a href="./rfc3579">RFC 3579</a>,
                  September 2003.

   [<a id="ref-RFC4072">RFC4072</a>]      Eronen, P., Hiller, T., and G. Zorn, "Diameter
                  Extensible Authentication Protocol (EAP) Application",
                  <a href="./rfc4072">RFC 4072</a>, August 2005.

   [<a id="ref-RFC4186">RFC4186</a>]      Haverinen, H. and J. Salowey, "Extensible
                  Authentication Protocol Method for Global System for
                  Mobile Communications (GSM) Subscriber Identity
                  Modules (EAP-SIM)", <a href="./rfc4186">RFC 4186</a>, January 2006.

   [<a id="ref-RFC4187">RFC4187</a>]      Arkko, J. and H. Haverinen, "Extensible Authentication
                  Protocol Method for 3rd Generation Authentication and
                  Key Agreement (EAP-AKA)", <a href="./rfc4187">RFC 4187</a>, January 2006.

   [<a id="ref-RFC4746">RFC4746</a>]      Clancy, T. and W. Arbaugh, "Extensible Authentication
                  Protocol (EAP) Password Authenticated Exchange",
                  <a href="./rfc4746">RFC 4746</a>, November 2006.

   [<a id="ref-RFC4763">RFC4763</a>]      Vanderveen, M. and H. Soliman, "Extensible
                  Authentication Protocol Method for Shared-secret
                  Authentication and Key Establishment (EAP-SAKE)",
                  <a href="./rfc4763">RFC 4763</a>, November 2006.

   [<a id="ref-RFC4793">RFC4793</a>]      Nystroem, M., "The EAP Protected One-Time Password
                  Protocol (EAP-POTP)", <a href="./rfc4793">RFC 4793</a>, February 2007.




<span class="grey">Eronen, et al.               Standards Track                   [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   [<a id="ref-RFC4851">RFC4851</a>]      Cam-Winget, N., McGrew, D., Salowey, J., and H. Zhou,
                  "The Flexible Authentication via Secure Tunneling
                  Extensible Authentication Protocol Method (EAP-FAST)",
                  <a href="./rfc4851">RFC 4851</a>, May 2007.

   [<a id="ref-RFC5216">RFC5216</a>]      Simon, D., Aboba, B., and R. Hurst, "The EAP-TLS
                  Authentication Protocol", <a href="./rfc5216">RFC 5216</a>, March 2008.

   [<a id="ref-RFC5247">RFC5247</a>]      Aboba, B., Simon, D., and P. Eronen, "Extensible
                  Authentication Protocol (EAP) Key Management
                  Framework", <a href="./rfc5247">RFC 5247</a>, August 2008.

   [<a id="ref-RFC5281">RFC5281</a>]      Funk, P. and S. Blake-Wilson, "Extensible
                  Authentication Protocol Tunneled Transport Layer
                  Security Authenticated Protocol Version 0 (EAP-
                  TTLSv0)", <a href="./rfc5281">RFC 5281</a>, August 2008.

   [<a id="ref-RFC5433">RFC5433</a>]      Clancy, T. and H. Tschofenig, "Extensible
                  Authentication Protocol - Generalized Pre-Shared Key
                  (EAP-GPSK) Method", <a href="./rfc5433">RFC 5433</a>, February 2009.

   [<a id="ref-RFC5448">RFC5448</a>]      Arkko, J., Lehtovirta, V., and P. Eronen, "Improved
                  Extensible Authentication Protocol Method for 3rd
                  Generation Authentication and Key Agreement (EAP-
                  AKA')", <a href="./rfc5448">RFC 5448</a>, May 2009.

   [<a id="ref-RFC5931">RFC5931</a>]      Harkins, D. and G. Zorn, "Extensible Authentication
                  Protocol (EAP) Authentication Using Only A Password",
                  <a href="./rfc5931">RFC 5931</a>, August 2010.






















<span class="grey">Eronen, et al.               Standards Track                   [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Alternative%20Approaches"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Alternative Approaches</span>

   In this section, we list alternatives that have been considered
   during the work on this document.  We concluded that the solution
   presented in <a href="#section-3">Section 3</a> seems to fit better into IKEv2.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.1.%20%20Ignore%20AUTH%20Payload%20at%20the%20Initiator"></a><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  Ignore AUTH Payload at the Initiator</span>

   With this approach, the initiator simply ignores the AUTH payload in
   message 4 (but obviously must check the second AUTH payload later!).
   The main advantage of this approach is that no protocol modifications
   are required and no signature verification is required.  A
   significant disadvantage is that the EAP method to be used cannot be
   selected to take this behavior into account.

   The initiator could signal to the responder (using a notification
   payload) that it did not verify the first AUTH payload.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.2.%20%20Unauthenticated%20Public%20Keys%20in%20AUTH%20Payload%20%28Message%204%29"></a><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  Unauthenticated Public Keys in AUTH Payload (Message 4)</span>

   Another solution approach suggests the use of unauthenticated public
   keys in the public key signature AUTH payload (for message 4).

   That is, the initiator verifies the signature in the AUTH payload,
   but does not verify that the public key indeed belongs to the
   intended party (using certificates) -- since it doesn't have a PKI
   that would allow this.  This could be used with X.509 certificates
   (the initiator ignores all other fields of the certificate except the
   public key), or "Raw RSA Key" CERT payloads.

   This approach has the advantage that initiators that wish to perform
   certificate-based responder authentication (in addition to EAP) may
   do so, without requiring the responder to handle these cases
   separately.  A disadvantage here, again, is that the EAP method
   selection cannot take into account the incomplete validation of the
   responder's certificate.

   If using RSA, the overhead of signature verification is quite small,
   compared to the g^xy calculation required by the Diffie-Hellman
   exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/A.3.%20%20Using%20EAP%20Derived%20Session%20Keys%20for%20IKEv2"></a><a class="selflink" href="#appendix-A.3" id="appendix-A.3">A.3</a>.  Using EAP Derived Session Keys for IKEv2</span>

   It has been proposed that when using an EAP method that provides
   mutual authentication and key agreement, the IKEv2 Diffie-Hellman
   exchange could also be omitted.  This would mean that the session
   keys for IPsec SAs established later would rely only on EAP-provided
   keys.



<span class="grey">Eronen, et al.               Standards Track                   [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc5998">RFC 5998</a>               Extension for EAP in IKEv2         September 2010</span>


   It seems the only benefit of this approach is saving some computation
   time (g^xy calculation).  This approach requires designing a
   completely new protocol (which would not resemble IKEv2 anymore); we
   do not believe that it should be considered.  Nevertheless, we
   include it for completeness.

Authors' Addresses

   Pasi Eronen
   Independent

   EMail: pe@iki.fi


   Hannes Tschofenig
   Nokia Siemens Networks
   Linnoitustie 6
   Espoo  02600
   Finland

   Phone: +358 (50) 4871445
   EMail: Hannes.Tschofenig@gmx.net
   URI:   <a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a>


   Yaron Sheffer
   Independent

   EMail: yaronf.ietf@gmail.com






















Eronen, et al.               Standards Track                   [Page 16]
</pre>
</body></html>