<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 8838: Trickle ICE: Incremental Provisioning of Candidates for the Interactive Connectivity Establishment (ICE) Protocol</title>
<meta content="Emil Ivov" name="author"/>
<meta content="Justin Uberti" name="author"/>
<meta content="Peter Saint-Andre" name="author"/>
<meta content='
       
        This document describes "Trickle ICE", an extension to the Interactive
        Connectivity Establishment (ICE) protocol that enables ICE agents
        to begin connectivity checks while they are still gathering 
        candidates, by incrementally exchanging candidates over time instead
        of all at once. This method can considerably accelerate the process 
        of establishing a communication session.
       
    ' name="description"/>
<meta content="xml2rfc 3.5.0" name="generator"/>
<meta content="8838" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.3.5
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.19.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 40.6.2
    six 1.14.0
    WeasyPrint 51
-->
<link href="rfc8838.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc8838" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-ice-trickle-21" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 8838</td>
<td class="center">Trickle ICE</td>
<td class="right">January 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Ivov, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc8838">8838</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2021-01">January 2021</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Ivov</div>
<div class="org">8x8 / Jitsi</div>
</div>
<div class="author">
      <div class="author-name">J. Uberti</div>
<div class="org">Google</div>
</div>
<div class="author">
      <div class="author-name">P. Saint-Andre</div>
<div class="org">Mozilla</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 8838</h1>
<h1 id="title">Trickle ICE: Incremental Provisioning of Candidates for the Interactive Connectivity Establishment (ICE) Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">
        This document describes "Trickle ICE", an extension to the Interactive
        Connectivity Establishment (ICE) protocol that enables ICE agents
        to begin connectivity checks while they are still gathering 
        candidates, by incrementally exchanging candidates over time instead
        of all at once. This method can considerably accelerate the process 
        of establishing a communication session.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc8838">https://www.rfc-editor.org/info/rfc8838</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a><a class="pilcrow" href="#section-toc.1-1.1.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-terminology">Terminology</a><a class="pilcrow" href="#section-toc.1-1.2.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p class="keepWithNext" id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-determining-support-for-tri">Determining Support for Trickle ICE</a><a class="pilcrow" href="#section-toc.1-1.3.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-generating-the-initial-ice-">Generating the Initial ICE Description</a><a class="pilcrow" href="#section-toc.1-1.4.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-handling-the-initial-ice-de">Handling the Initial ICE Description and Generating the Initial ICE Response</a><a class="pilcrow" href="#section-toc.1-1.5.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-handling-the-initial-ice-re">Handling the Initial ICE Response</a><a class="pilcrow" href="#section-toc.1-1.6.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-forming-checklists">Forming Checklists</a><a class="pilcrow" href="#section-toc.1-1.7.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#section-8">8</a>.  <a class="xref" href="#name-performing-connectivity-che">Performing Connectivity Checks</a><a class="pilcrow" href="#section-toc.1-1.8.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#section-9">9</a>.  <a class="xref" href="#name-gathering-and-conveying-new">Gathering and Conveying Newly Gathered Local Candidates</a><a class="pilcrow" href="#section-toc.1-1.9.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#section-10">10</a>. <a class="xref" href="#name-pairing-newly-gathered-loca">Pairing Newly Gathered Local Candidates</a><a class="pilcrow" href="#section-toc.1-1.10.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="xref" href="#section-11">11</a>. <a class="xref" href="#name-receiving-trickled-candidat">Receiving Trickled Candidates</a><a class="pilcrow" href="#section-toc.1-1.11.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="xref" href="#section-12">12</a>. <a class="xref" href="#name-inserting-trickled-candidat">Inserting Trickled Candidate Pairs into a Checklist</a><a class="pilcrow" href="#section-toc.1-1.12.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="xref" href="#section-13">13</a>. <a class="xref" href="#name-generating-an-end-of-candid">Generating an End-of-Candidates Indication</a><a class="pilcrow" href="#section-toc.1-1.13.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a class="xref" href="#section-14">14</a>. <a class="xref" href="#name-receiving-an-end-of-candida">Receiving an End-of-Candidates Indication</a><a class="pilcrow" href="#section-toc.1-1.14.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a class="xref" href="#section-15">15</a>. <a class="xref" href="#name-subsequent-exchanges-and-ic">Subsequent Exchanges and ICE Restarts</a><a class="pilcrow" href="#section-toc.1-1.15.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a class="xref" href="#section-16">16</a>. <a class="xref" href="#name-half-trickle">Half Trickle</a><a class="pilcrow" href="#section-toc.1-1.16.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a class="xref" href="#section-17">17</a>. <a class="xref" href="#name-preserving-candidate-order-">Preserving Candidate Order While Trickling</a><a class="pilcrow" href="#section-toc.1-1.17.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a class="xref" href="#section-18">18</a>. <a class="xref" href="#name-requirements-for-using-prot">Requirements for Using Protocols</a><a class="pilcrow" href="#section-toc.1-1.18.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a class="xref" href="#section-19">19</a>. <a class="xref" href="#name-iana-considerations">IANA Considerations</a><a class="pilcrow" href="#section-toc.1-1.19.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a class="xref" href="#section-20">20</a>. <a class="xref" href="#name-security-considerations">Security Considerations</a><a class="pilcrow" href="#section-toc.1-1.20.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a class="xref" href="#section-21">21</a>. <a class="xref" href="#name-references">References</a><a class="pilcrow" href="#section-toc.1-1.21.1">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.21.2.1">
                <p id="section-toc.1-1.21.2.1.1"><a class="xref" href="#section-21.1">21.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a><a class="pilcrow" href="#section-toc.1-1.21.2.1.1">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.21.2.2">
                <p id="section-toc.1-1.21.2.2.1"><a class="xref" href="#section-21.2">21.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a><a class="pilcrow" href="#section-toc.1-1.21.2.2.1">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.22">
            <p id="section-toc.1-1.22.1"><a class="xref" href="#section-appendix.a">Appendix A</a>.  <a class="xref" href="#name-interaction-with-regular-ic">Interaction with Regular ICE</a><a class="pilcrow" href="#section-toc.1-1.22.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.23">
            <p id="section-toc.1-1.23.1"><a class="xref" href="#section-appendix.b">Appendix B</a>.  <a class="xref" href="#name-interaction-with-ice-lite">Interaction with ICE-Lite</a><a class="pilcrow" href="#section-toc.1-1.23.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.24">
            <p id="section-toc.1-1.24.1"><a class="xref" href="#section-appendix.c"></a><a class="xref" href="#name-acknowledgements">Acknowledgements</a><a class="pilcrow" href="#section-toc.1-1.24.1">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.25">
            <p id="section-toc.1-1.25.1"><a class="xref" href="#section-appendix.d"></a><a class="xref" href="#name-authors-addresses">Authors' Addresses</a><a class="pilcrow" href="#section-toc.1-1.25.1">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">
        The Interactive Connectivity Establishment (ICE) protocol 
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> describes how an ICE agent 
        gathers candidates, exchanges candidates with a peer ICE 
        agent, and creates candidate pairs. Once the pairs have been 
        gathered, the ICE agent will perform connectivity checks and 
        eventually nominate and select pairs that will be used for 
        sending and receiving data within a communication session.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">
        Following the procedures in <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>
        can lead to somewhat lengthy establishment times for communication
        sessions, because candidate gathering often involves querying Session
        Traversal Utilities for NAT (STUN) servers <span>[<a class="xref" href="#RFC5389">RFC5389</a>]</span> and allocating relayed candidates on Traversal
        Using Relay NAT (TURN) servers <span>[<a class="xref" href="#RFC5766">RFC5766</a>]</span>. Although many ICE procedures can be completed in
        parallel, the pacing requirements from <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> still need to be followed.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">
        This document defines "Trickle ICE", a supplementary mode of ICE 
        operation in which candidates can be exchanged 
        incrementally as soon as they become available (and simultaneously 
        with the gathering of other candidates). Connectivity checks can 
        also start as soon as candidate pairs have been created. Because 
        Trickle ICE enables candidate gathering and connectivity checks
        to be done in parallel, the method can considerably accelerate
        the process of establishing a communication session.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">
        This document also defines how to discover support for
        Trickle ICE, how the procedures in <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> are 
        modified or supplemented when using Trickle ICE, and how a Trickle 
        ICE agent can interoperate with an ICE agent compliant to 
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">
        This document does not define any protocol-specific usage of Trickle 
        ICE. Instead, protocol-specific details for Trickle ICE are defined 
        in separate usage documents.
        Examples of such documents are 
        <span>[<a class="xref" href="#RFC8840">RFC8840</a>]</span> (which defines usage 
        with the Session Initiation Protocol (SIP) <span>[<a class="xref" href="#RFC3261">RFC3261</a>]</span> 
        and the Session Description Protocol (SDP) <span>[<a class="xref" href="#RFC4566">RFC4566</a>]</span>) and 
        <span>[<a class="xref" href="#XEP-0176">XEP-0176</a>]</span> (which defines usage with the Extensible Messaging and Presence Protocol (XMPP) 
        <span>[<a class="xref" href="#RFC6120">RFC6120</a>]</span>). However, some of the examples in the 
        document use SDP and the Offer/Answer model <span>[<a class="xref" href="#RFC3264">RFC3264</a>]</span> 
        to explain the underlying concepts.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">
        The following diagram illustrates a successful Trickle ICE exchange with a
        using protocol that follows the Offer/Answer model:<a class="pilcrow" href="#section-1-6">¶</a></p>
<span id="name-flow"></span><div id="fig-flow">
<figure id="figure-1">
        <div class="artwork art-text alignLeft" id="section-1-7.1">
<pre>        Alice                                            Bob
          |                     Offer                     |
          |----------------------------------------------&gt;|
          |            Additional Candidates              |
          |----------------------------------------------&gt;|
          |                     Answer                    |
          |&lt;----------------------------------------------|
          |            Additional Candidates              |
          |&lt;----------------------------------------------|
          | Additional Candidates and Connectivity Checks |
          |&lt;---------------------------------------------&gt;|
          |&lt;========== CONNECTION ESTABLISHED ===========&gt;|
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-flow">Flow</a>
        </figcaption></figure>
</div>
<p id="section-1-8">
        The main body of this document is structured to describe the behavior 
        of Trickle ICE agents in roughly the order of operations and interactions 
        during an ICE session:<a class="pilcrow" href="#section-1-8">¶</a></p>
<ol class="normal type-1" id="section-1-9" start="1" type="1">
        <li id="section-1-9.1">Determining support for Trickle ICE<a class="pilcrow" href="#section-1-9.1">¶</a>
</li>
        <li id="section-1-9.2">Generating the initial ICE description<a class="pilcrow" href="#section-1-9.2">¶</a>
</li>
        <li id="section-1-9.3">Handling the initial ICE description and generating the initial ICE response<a class="pilcrow" href="#section-1-9.3">¶</a>
</li>
        <li id="section-1-9.4">Handling the initial ICE response<a class="pilcrow" href="#section-1-9.4">¶</a>
</li>
        <li id="section-1-9.5">Forming checklists, pruning candidates, performing connectivity checks, etc.<a class="pilcrow" href="#section-1-9.5">¶</a>
</li>
        <li id="section-1-9.6">Gathering and conveying candidates after the initial ICE description and response<a class="pilcrow" href="#section-1-9.6">¶</a>
</li>
        <li id="section-1-9.7">Handling inbound trickled candidates<a class="pilcrow" href="#section-1-9.7">¶</a>
</li>
        <li id="section-1-9.8">Generating and handling the end-of-candidates indication<a class="pilcrow" href="#section-1-9.8">¶</a>
</li>
        <li id="section-1-9.9">Handling ICE restarts<a class="pilcrow" href="#section-1-9.9">¶</a>
</li>
      </ol>
<p id="section-1-10">
        There is quite a bit of operational experience with the technique behind 
        Trickle ICE, going back as far as 2005 (when the XMPP Jingle extension 
        defined a "dribble mode" as specified in <span>[<a class="xref" href="#XEP-0176">XEP-0176</a>]</span>); this 
        document incorporates feedback from those who have implemented and 
        deployed the technique over the years.<a class="pilcrow" href="#section-1-10">¶</a></p>
</section>
<section id="section-2">
      <h2 id="name-terminology">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">
        This specification makes use of all terminology defined 
        for Interactive Connectivity Establishment in
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>. In addition, it defines the following terms:<a class="pilcrow" href="#section-2-2">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-3">
        <dt id="section-2-3.1">Empty Checklist:</dt>
        <dd id="section-2-3.2" style="margin-left: 1.5em">
            A checklist that initially does not contain any candidate pairs 
            because they will be incrementally added as they are trickled.
           (This scenario does not arise with a regular ICE agent, because all 
           candidate pairs are known when the agent creates the checklist set.)<a class="pilcrow" href="#section-2-3.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">Full Trickle:</dt>
        <dd id="section-2-3.4" style="margin-left: 1.5em">
            The typical mode of operation for Trickle ICE agents, in which
            the initial ICE description can include any number of candidates (even
            zero candidates) and does not need to include a full generation
            of candidates as in half trickle.<a class="pilcrow" href="#section-2-3.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.5">Generation:</dt>
        <dd id="section-2-3.6" style="margin-left: 1.5em">
            All of the candidates conveyed within an ICE session (correlated
            with a particular Username Fragment and Password combination).<a class="pilcrow" href="#section-2-3.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.7">Half Trickle:</dt>
        <dd id="section-2-3.8" style="margin-left: 1.5em">
            A Trickle ICE mode of operation in which the initiator gathers
            a full generation of candidates strictly before creating
            and conveying the initial ICE description. Once conveyed, 
            this candidate information can be
            processed by regular ICE agents, which do not require support
            for Trickle ICE. It also allows Trickle-ICE-capable
            responders to still gather candidates and perform
            connectivity checks in a non-blocking way, thus providing roughly 
            "half" the advantages of Trickle ICE. The half-trickle mechanism
            is mostly meant for use when the responder's support for Trickle
            ICE cannot be confirmed prior to conveying the initial ICE description.<a class="pilcrow" href="#section-2-3.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.9">ICE Description:</dt>
        <dd id="section-2-3.10" style="margin-left: 1.5em">
            Any attributes related to the ICE session (other than candidates) 
            required to configure an ICE agent. These include but are not 
            limited to the Username Fragment, the Password, and other attributes.<a class="pilcrow" href="#section-2-3.10">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.11">Trickled Candidates:</dt>
        <dd id="section-2-3.12" style="margin-left: 1.5em">
            Candidates that a Trickle ICE agent conveys after conveying or responding to the initial 
            ICE description, but within 
            the same ICE session.  Trickled candidates can be conveyed in 
            parallel with candidate gathering and connectivity checks.<a class="pilcrow" href="#section-2-3.12">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.13">Trickling:</dt>
        <dd id="section-2-3.14" style="margin-left: 1.5em">
            The act of incrementally conveying trickled candidates.<a class="pilcrow" href="#section-2-3.14">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
<div id="support">
<section id="section-3">
      <h2 id="name-determining-support-for-tri">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-determining-support-for-tri">Determining Support for Trickle ICE</a>
      </h2>
<p id="section-3-1">
        To fully support Trickle ICE, using protocols
        <span class="bcp14">SHOULD</span> incorporate one of the following mechanisms so that implementations
        can determine whether Trickle ICE is supported:<a class="pilcrow" href="#section-3-1">¶</a></p>
<ol class="normal type-1" id="section-3-2" start="1" type="1">
        <li id="section-3-2.1">
            Provide a capabilities discovery method so that agents can verify 
            support of Trickle ICE prior to initiating a session (XMPP's
            <span><a class="xref" href="#XEP-0030">Service Discovery</a> [<a class="xref" href="#XEP-0030">XEP-0030</a>]</span> is 
            one such mechanism).<a class="pilcrow" href="#section-3-2.1">¶</a>
</li>
        <li id="section-3-2.2">
            Make support for Trickle ICE mandatory so that user agents
            can assume support.<a class="pilcrow" href="#section-3-2.2">¶</a>
</li>
      </ol>
<p id="section-3-3">
        If a using protocol does not provide a method of determining
        ahead of time whether Trickle ICE is supported, agents can make use of 
        the half-trickle procedure described in <a class="xref" href="#half-trickle">Section 16</a>.<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">
        Prior to conveying the initial ICE description, agents that implement using protocols
        that support capabilities discovery can attempt to verify whether or 
        not the remote party supports Trickle ICE. If an agent determines 
        that the remote party does not support Trickle ICE, it <span class="bcp14">MUST</span> fall back 
        to using regular ICE or abandon the entire session.<a class="pilcrow" href="#section-3-4">¶</a></p>
<p id="section-3-5">

        Even if a using protocol does not include a capabilities discovery 
        method, a user agent can provide an indication within the ICE description 
        that it supports Trickle ICE by communicating an ICE option of 'trickle'.  
        This token <span class="bcp14">MUST</span> be provided either at the session level or, if at the data 
        stream level, for every data stream (an agent <span class="bcp14">MUST NOT</span> specify Trickle ICE 
        support for some data streams but not others).

        Note: The encoding of the 'trickle' ICE option, and the message(s) used to 
        carry it to the peer, are protocol specific; for instance, the encoding for 
        SDP <span>[<a class="xref" href="#RFC4566">RFC4566</a>]</span> is defined in
        <span>[<a class="xref" href="#RFC8840">RFC8840</a>]</span>.<a class="pilcrow" href="#section-3-5">¶</a></p>
<p id="section-3-6">
        Dedicated discovery semantics and half trickle are needed only prior 
        to initiation of an ICE session. After an ICE session is established
        and Trickle ICE support is confirmed for both parties, either
        agent can use full trickle for subsequent exchanges (see also
        <a class="xref" href="#subsequent">Section 15</a>).<a class="pilcrow" href="#section-3-6">¶</a></p>
</section>
</div>
<div id="initial">
<section id="section-4">
      <h2 id="name-generating-the-initial-ice-">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-generating-the-initial-ice-">Generating the Initial ICE Description</a>
      </h2>
<p id="section-4-1">
        An ICE agent can start gathering candidates as soon as it has an
        indication that communication is imminent (e.g., a user-interface
        cue or an explicit request to initiate a communication session). Unlike in
        regular ICE, in Trickle ICE implementations do not need to
        gather candidates in a blocking manner. Therefore, unless half
        trickle is being used, the user experience is improved if the 
        initiating agent generates and transmits its initial ICE description 
        as early as possible (thus enabling the remote party to start 
        gathering and trickling candidates).<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">
        An initiator <span class="bcp14">MAY</span> include any mix of candidates when conveying
        the initial ICE description. This includes the possibility of conveying 
        all the candidates the initiator plans to use
        (as in half trickle), conveying only a 
        publicly reachable IP address (e.g., a candidate at a data 
        relay that is known to not be behind a firewall), or conveying 
        no candidates at all (in which case the initiator can obtain the 
        responder's initial candidate list sooner, and the responder can begin 
        candidate gathering more quickly).<a class="pilcrow" href="#section-4-2">¶</a></p>
<p id="section-4-3">
        For candidates included in the initial ICE description, the methods 
        for calculating priorities and foundations, determining redundancy 
        of candidates, and the like work just as in regular ICE 
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-4-3">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-handling-the-initial-ice-de">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-handling-the-initial-ice-de">Handling the Initial ICE Description and Generating the Initial ICE Response</a>
      </h2>
<p id="section-5-1">
        When a responder receives the initial ICE description, it will first check if
        the ICE description or initiator indicates support for Trickle ICE as explained 
        in <a class="xref" href="#support">Section 3</a>. If not, the responder <span class="bcp14">MUST</span>
        process the initial ICE description according to regular ICE procedures 
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> (or, if no ICE support is detected at all,
        according to relevant processing rules for the using
        protocol, such as Offer/Answer processing rules <span>[<a class="xref" href="#RFC3264">RFC3264</a>]</span>).
        However, if support for Trickle ICE is confirmed, a responder will 
        automatically assume support for regular ICE as well.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">
        If the initial ICE description indicates support for Trickle ICE, the 
        responder will determine its role and start gathering and prioritizing
        candidates; while doing so, it will also respond by conveying an 
        initial ICE response, so that both the initiator 
        and the responder can form checklists and begin connectivity checks.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3">
        A responder can respond to the initial ICE description at any point while
        gathering candidates. The initial ICE response <span class="bcp14">MAY</span> contain any set of
        candidates, including all candidates or no candidates. (The benefit of 
        including no candidates is to convey the initial ICE response as 
        quickly as possible, so that both parties can consider the 
        ICE session to be under active negotiation as soon as 
        possible.)<a class="pilcrow" href="#section-5-3">¶</a></p>
<p id="section-5-4">
        As noted in <a class="xref" href="#support">Section 3</a>, in using protocols that use 
        SDP, the initial ICE response can indicate support for Trickle ICE 
        by including a token of 'trickle' in the ice-options attribute.<a class="pilcrow" href="#section-5-4">¶</a></p>
</section>
<section id="section-6">
      <h2 id="name-handling-the-initial-ice-re">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-handling-the-initial-ice-re">Handling the Initial ICE Response</a>
      </h2>
<p id="section-6-1">
        When processing the initial ICE response, the initiator follows regular ICE
        procedures to determine its role, after which it
        forms checklists (<a class="xref" href="#checklists">Section 7</a>)
        and performs connectivity checks (<a class="xref" href="#checks">Section 8</a>).<a class="pilcrow" href="#section-6-1">¶</a></p>
</section>
<div id="checklists">
<section id="section-7">
      <h2 id="name-forming-checklists">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-forming-checklists">Forming Checklists</a>
      </h2>
<p id="section-7-1">
        According to regular ICE procedures <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, 
        in order for candidate pairing 
        to be possible and for redundant candidates to be pruned, the 
        candidates would need to be provided in the initial ICE description
        and initial ICE response.
        By contrast, under Trickle ICE, checklists can be empty until 
        candidates are conveyed or received. Therefore, a Trickle ICE agent
        handles checklist formation and candidate pairing in a slightly different
        way than a regular ICE agent: the agent still forms the checklists, but 
        it populates a given checklist only after it actually has candidate 
        pairs for that checklist. Every checklist is initially placed in the 
        Running state, even if the checklist is empty (this is consistent
        with <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.1">Section 6.1.2.1</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>).<a class="pilcrow" href="#section-7-1">¶</a></p>
</section>
</div>
<div id="checks">
<section id="section-8">
      <h2 id="name-performing-connectivity-che">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-performing-connectivity-che">Performing Connectivity Checks</a>
      </h2>
<p id="section-8-1">
        As specified in <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, whenever timer 
        Ta fires, only checklists in the Running state will be picked 
        when scheduling connectivity checks for candidate pairs.
        Therefore, a Trickle ICE agent <span class="bcp14">MUST</span> keep each checklist in 
        the Running state as long as it expects candidate pairs to be 
        incrementally added to the checklist. After that, the checklist 
        state is set according to the procedures in
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-8-1">¶</a></p>
<p id="section-8-2">
        Whenever timer Ta fires and an empty checklist is picked, no action 
        is performed for the list. Without waiting for timer Ta to expire 
        again, the agent selects the next checklist in the Running state, 
        in accordance with <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.4.2">Section 6.1.4.2</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-8-2">¶</a></p>
<p id="section-8-3">
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-7.2.5.4">Section 7.2.5.4</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>
        requires that agents update checklists and timer states upon 
        completing a connectivity check transaction. During such an 
        update, regular ICE agents would set the state of a checklist 
        to Failed if both of the following two conditions are satisfied:<a class="pilcrow" href="#section-8-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-4.1">
            all of the pairs in the checklist are in either the
            Failed state or the Succeeded state; and<a class="pilcrow" href="#section-8-4.1">¶</a>
</li>
        <li class="normal" id="section-8-4.2">
            there is not a pair in the valid list for each component 
            of the data stream.<a class="pilcrow" href="#section-8-4.2">¶</a>
</li>
      </ul>
<p id="section-8-5">
        With Trickle ICE, the above situation would often occur when
        candidate gathering and trickling are still in progress, even
        though it is quite possible that future checks will succeed. For
        this reason, Trickle ICE agents add the following conditions to
        the above list:<a class="pilcrow" href="#section-8-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-6.1">
            all candidate gathering has completed, and the agent
            is not expecting to discover any new local candidates; and<a class="pilcrow" href="#section-8-6.1">¶</a>
</li>
        <li class="normal" id="section-8-6.2">
            the remote agent has conveyed an end-of-candidates indication
            for that checklist as described in
            <a class="xref" href="#end-of-candidates.send">Section 13</a>.<a class="pilcrow" href="#section-8-6.2">¶</a>
</li>
      </ul>
</section>
</div>
<div id="trickle-send">
<section id="section-9">
      <h2 id="name-gathering-and-conveying-new">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-gathering-and-conveying-new">Gathering and Conveying Newly Gathered Local Candidates</a>
      </h2>
<p id="section-9-1">
        After Trickle ICE agents have conveyed initial ICE descriptions
        and initial ICE responses, they will most
        likely continue gathering new local candidates as STUN, TURN,
        and other non-host candidate gathering mechanisms begin to
        yield results. Whenever an agent discovers such a new candidate,
        it will compute its priority, type, foundation, and component ID
        according to regular ICE procedures.<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">
        The new candidate is then checked for redundancy against the
        existing list of local candidates. If its transport address and
        base match those of an existing candidate, it will be considered
        redundant and will be ignored. This would often happen for
        server-reflexive candidates that match the host addresses they
        were obtained from (e.g., when the latter are public IPv4
        addresses). Contrary to regular ICE, Trickle ICE agents will
        consider the new candidate redundant regardless of its priority.<a class="pilcrow" href="#section-9-2">¶</a></p>
<p id="section-9-3">
        Next, the agent "trickles" the newly discovered
        candidate(s) to the remote agent. The actual delivery of the new
        candidates is handled by a using protocol such as SIP or XMPP.
        Trickle ICE imposes no restrictions on the way this is done 
        (e.g., some using protocols might
        choose not to trickle updates for server-reflexive
        candidates and instead rely on the discovery of peer-reflexive ones).<a class="pilcrow" href="#section-9-3">¶</a></p>
<p id="section-9-4">
        When candidates are trickled, the using protocol <span class="bcp14">MUST</span> deliver each 
        candidate (and any end-of-candidates indication as described in
        <a class="xref" href="#end-of-candidates.send">Section 13</a>) to the receiving Trickle ICE implementation 
        exactly once
        and in the same order it was conveyed. If the using protocol 
        provides any candidate retransmissions, they need to be hidden 
        from the ICE implementation.<a class="pilcrow" href="#section-9-4">¶</a></p>
<p id="section-9-5">
        Also, candidate trickling needs to be correlated to a specific
        ICE session, so that if there is an ICE restart, any
        delayed updates for a previous session can be recognized as such
        and ignored by the receiving party.  For example, using protocols
        that signal candidates via SDP might include a Username
        Fragment value in the corresponding a=candidate line, such as:<a class="pilcrow" href="#section-9-5">¶</a></p>
<div id="section-9-6">
<pre class="sourcecode lang-sdp">  a=candidate:1 1 UDP 2130706431 2001:db8::1 5000 typ host ufrag 8hhY
</pre><a class="pilcrow" href="#section-9-6">¶</a>
</div>
<p id="section-9-7">
        Or, as another example, WebRTC implementations might include a Username
        Fragment in the JavaScript objects that represent candidates.<a class="pilcrow" href="#section-9-7">¶</a></p>
<p id="section-9-8">
        Note: The using protocol needs to provide a mechanism for both
        parties to indicate and agree on the ICE session in force
        (as identified by the Username Fragment and Password combination),
        so that they have a consistent view of which candidates are
        to be paired.  This is especially important in the case of ICE
        restarts (see <a class="xref" href="#subsequent">Section 15</a>).<a class="pilcrow" href="#section-9-8">¶</a></p>
<p id="section-9-9">
        Note: A using protocol might prefer not to
        trickle server-reflexive candidates to entities that are known
        to be publicly accessible and where sending a direct STUN
        binding request is likely to reach the destination faster than
        the trickle update that travels through the signaling path.<a class="pilcrow" href="#section-9-9">¶</a></p>
</section>
</div>
<div id="local-pairing">
<section id="section-10">
      <h2 id="name-pairing-newly-gathered-loca">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-pairing-newly-gathered-loca">Pairing Newly Gathered Local Candidates</a>
      </h2>
<p id="section-10-1">
        As a Trickle ICE agent gathers local candidates, it needs
        to form candidate pairs; this works as described in
        the ICE specification <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, with the 
        following provisos:<a class="pilcrow" href="#section-10-1">¶</a></p>
<ol class="normal type-1" id="section-10-2" start="1" type="1">
        <li id="section-10-2.1">
            A Trickle ICE agent <span class="bcp14">MUST NOT</span> pair a local candidate until it
            has been trickled to the remote party.<a class="pilcrow" href="#section-10-2.1">¶</a>
</li>
        <li id="section-10-2.2">
            Once the agent has conveyed the local candidate to the remote 
            party, the agent checks if any remote candidates are currently 
            known for this same stream and component. If not, the agent
            merely adds the new candidate to the list of local candidates
            (without pairing it).<a class="pilcrow" href="#section-10-2.2">¶</a>
</li>
        <li id="section-10-2.3">
            Otherwise, if the agent has already learned of one or more
            remote candidates for this stream and component, it attempts
            to pair the new local candidate as described in the ICE
            specification <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-10-2.3">¶</a>
</li>
        <li id="section-10-2.4">
            If a newly formed pair has a local candidate whose type is server-reflexive, 
            the agent <span class="bcp14">MUST</span> replace the local candidate with its 
            base before completing the relevant redundancy tests.<a class="pilcrow" href="#section-10-2.4">¶</a>
</li>
        <li id="section-10-2.5">
            The agent prunes redundant pairs by following the rules
            in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.4">Section 6.1.2.4</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span> but checks
            existing pairs only if they have a state of Waiting or Frozen;
            this avoids removal of pairs for which connectivity checks are 
            in flight (a state of In‑Progress) or for which connectivity 
            checks have already yielded a definitive result (a state of
            Succeeded or Failed).<a class="pilcrow" href="#section-10-2.5">¶</a>
</li>
        <li id="section-10-2.6">
            If, after completing the relevant redundancy tests, the checklist where the 
            pair is to be added already contains the maximum number of candidate 
            pairs (100 by default as per <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>), the agent
            <span class="bcp14">SHOULD</span> discard any pairs in the Failed state to make room for the 
            new pair. If there are no such pairs, the agent <span class="bcp14">SHOULD</span> discard a
            pair with a lower priority than the new pair in order to make room
            for the new pair, until the number of pairs is equal to the maximum
            number of pairs. This processing is consistent with 
            <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.5">Section 6.1.2.5</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-10-2.6">¶</a>
</li>
      </ol>
</section>
</div>
<div id="trickle-recv">
<section id="section-11">
      <h2 id="name-receiving-trickled-candidat">
<a class="section-number selfRef" href="#section-11">11. </a><a class="section-name selfRef" href="#name-receiving-trickled-candidat">Receiving Trickled Candidates</a>
      </h2>
<p id="section-11-1">
        At any time during an ICE session, a Trickle ICE agent might receive
        new candidates from the remote agent, from which it will attempt to
        form a candidate pair; this works as described in the ICE specification 
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, with the following provisos:<a class="pilcrow" href="#section-11-1">¶</a></p>
<ol class="normal type-1" id="section-11-2" start="1" type="1">
        <li id="section-11-2.1">
            The agent checks if any local candidates are currently known for 
            this same stream and component. If not, the agent merely adds the 
            new candidate to the list of remote candidates (without pairing it).<a class="pilcrow" href="#section-11-2.1">¶</a>
</li>
        <li id="section-11-2.2">
            Otherwise, if the agent has already gathered one or more
            local candidates for this stream and component, it attempts
            to pair the new remote candidate as described in the ICE
            specification <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-11-2.2">¶</a>
</li>
        <li id="section-11-2.3">
            If a newly formed pair has a local candidate whose type is server-reflexive, the agent <span class="bcp14">MUST</span> replace the local candidate with its 
            base before completing the redundancy check in the next step.<a class="pilcrow" href="#section-11-2.3">¶</a>
</li>
        <li id="section-11-2.4">
          <p id="section-11-2.4.1">
            The agent prunes redundant pairs as described below but checks
            existing pairs only if they have a state of Waiting or Frozen;
            this avoids removal of pairs for which connectivity checks are 
            in flight (a state of In-Progress) or for which connectivity 
            checks have already yielded a definitive result (a state of
            Succeeded or Failed).<a class="pilcrow" href="#section-11-2.4.1">¶</a></p>
<ol class="normal type-A" id="section-11-2.4.2" start="1" type="A">
            <li id="section-11-2.4.2.1">
                If the agent finds a redundancy between two pairs and one of 
                those pairs contains a newly received remote candidate whose 
                type is peer-reflexive, the agent <span class="bcp14">SHOULD</span> discard the
                pair containing that candidate, set the priority of the
                existing pair to the priority of the discarded pair, and
                re-sort the checklist.
                (This policy helps to eliminate
                problems with remote peer-reflexive candidates for which
                a STUN Binding request is received before signaling of the
                candidate is trickled to the receiving agent, such as a
                different view of pair priorities between the local agent
                and the remote agent, because the same candidate could be
                perceived as peer-reflexive by one agent and as server-reflexive
                by the other agent.)<a class="pilcrow" href="#section-11-2.4.2.1">¶</a>
</li>
            <li id="section-11-2.4.2.2">
                The agent then applies the rules defined in 
                 <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.4">Section 6.1.2.4</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-11-2.4.2.2">¶</a>
</li>
          </ol>
</li>
        <li id="section-11-2.5">
            If, after completing the relevant redundancy tests, the checklist where the 
            pair is to be added already contains the maximum number of candidate 
            pairs (100 by default as per <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>), the agent
            <span class="bcp14">SHOULD</span> discard any pairs in the Failed state to make room for the 
            new pair. If there are no such pairs, the agent <span class="bcp14">SHOULD</span> discard a
            pair with a lower priority than the new pair in order to make room
            for the new pair, until the number of pairs is equal to the maximum
            number of pairs. This processing is consistent with 
            <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.5">Section 6.1.2.5</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-11-2.5">¶</a>
</li>
      </ol>
</section>
</div>
<div id="trickle-insert">
<section id="section-12">
      <h2 id="name-inserting-trickled-candidat">
<a class="section-number selfRef" href="#section-12">12. </a><a class="section-name selfRef" href="#name-inserting-trickled-candidat">Inserting Trickled Candidate Pairs into a Checklist</a>
      </h2>
<p id="section-12-1">
        After a local agent has trickled a candidate and formed a candidate 
        pair from that local candidate (<a class="xref" href="#trickle-send">Section 9</a>), or after 
        a remote agent has received a trickled candidate and formed a candidate 
        pair from that remote candidate (<a class="xref" href="#trickle-recv">Section 11</a>), a Trickle 
        ICE agent adds the new candidate pair to a checklist as defined in 
        this section.<a class="pilcrow" href="#section-12-1">¶</a></p>
<p id="section-12-2">
        As an aid to understanding the procedures defined in this section, 
        consider the following tabular representation of all checklists in 
        an agent (note that initially for one of the foundations, i.e., f5, 
        there are no candidate pairs):<a class="pilcrow" href="#section-12-2">¶</a></p>
<span id="name-example-of-checklist-state"></span><div id="checklist_table">
<table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-example-of-checklist-state">Example of Checklist State</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-12-4">
        Each row in the table represents a component for a given data
        stream (e.g., s1 and s2 might be the RTP and RTP Control Protocol (RTCP) components
        for audio) and thus a single checklist in the checklist set. 
        Each column represents one foundation. Each cell represents one 
        candidate pair. In the tables shown in this section, "F" stands 
        for "frozen", "W" stands for "waiting", and "S" stands for 
        "succeeded"; in addition, "^^" is used to notate newly added 
        candidate pairs.<a class="pilcrow" href="#section-12-4">¶</a></p>
<p id="section-12-5">
        When an agent commences ICE processing, in accordance with 
         <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.6">Section 6.1.2.6</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>, for each 
        foundation it will unfreeze the pair with the lowest component 
        ID and, if the component IDs are equal, with the highest priority 
        (this is the topmost candidate pair in every column).
        This initial state is shown in the following table.<a class="pilcrow" href="#section-12-5">¶</a></p>
<span id="name-initial-checklist-state"></span><div id="fig-checklist-initial">
<table class="center" id="table-2">
        <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-initial-checklist-state">Initial Checklist State</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-12-7">
        Then, as the checks proceed (see 
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-7.2.5.4">Section 7.2.5.4</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>), for each pair 
        that enters the Succeeded state (denoted here by "S"),
        the agent will unfreeze all pairs for all data streams with the same
        foundation (e.g., if the pair in column 1, row 1 succeeds then
        the agent will unfreeze the pairs in column 1, rows 2, 3, and 4).<a class="pilcrow" href="#section-12-7">¶</a></p>
<span id="name-checklist-state-with-succee"></span><div id="fig-checklist-succeeded">
<table class="center" id="table-3">
        <caption>
<a class="selfRef" href="#table-3">Table 3</a>:
<a class="selfRef" href="#name-checklist-state-with-succee">Checklist State with Succeeded Candidate Pair</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-12-9">
        Trickle ICE preserves all of these rules as they apply to 
        "static" checklist sets. This implies that if 
        a Trickle ICE agent were to begin connectivity checks with all 
        of its pairs already present, the way that pair states change 
        is indistinguishable from that of a regular ICE agent.<a class="pilcrow" href="#section-12-9">¶</a></p>
<p id="section-12-10">
        Of course, the major difference with Trickle ICE is that checklist 
        sets can be dynamically updated because candidates can 
        arrive after connectivity checks have started. When this happens, an 
        agent sets the state of the newly formed pair as described below.<a class="pilcrow" href="#section-12-10">¶</a></p>
<p id="section-12-11">
        Rule 1: If the newly formed pair has the lowest component ID and, 
        if the component IDs are equal, the highest priority of any candidate 
        pair for this foundation (i.e., if it is the topmost pair in the 
        column), set the state to Waiting. For example, this would be the 
        case if the newly formed pair were placed in column 5, row 1. This 
        rule is consistent with <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-6.1.2.6">Section 6.1.2.6</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-12-11">¶</a></p>
<span id="name-checklist-state-with-newly-"></span><div id="fig-checklist-rule1">
<table class="center" id="table-4">
        <caption>
<a class="selfRef" href="#table-4">Table 4</a>:
<a class="selfRef" href="#name-checklist-state-with-newly-">Checklist State with Newly Formed Pair, Rule 1</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">^W^</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-12-13"> 
        Rule 2: If there is at least one pair in the Succeeded state for 
        this foundation, set the state to Waiting. For example, this would be 
        the case if the pair in column 5, row 1 succeeded and the newly formed 
        pair were placed in column 5, row 2. This rule is consistent with 
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-7.2.5.3.3">Section 7.2.5.3.3</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-12-13">¶</a></p>
<span id="name-checklist-state-with-newly-f"></span><div id="fig-checklist-rule2">
<table class="center" id="table-5">
        <caption>
<a class="selfRef" href="#table-5">Table 5</a>:
<a class="selfRef" href="#name-checklist-state-with-newly-f">Checklist State with Newly Formed Pair, Rule 2</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">^W^</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-12-15">
        Rule 3: In all other cases, set the state to Frozen. For example, 
        this would be the case if the newly formed pair were placed in
        column 3, row 3.<a class="pilcrow" href="#section-12-15">¶</a></p>
<span id="name-checklist-state-with-newly-fo"></span><div id="fig-checklist-rule3">
<table class="center" id="table-6">
        <caption>
<a class="selfRef" href="#table-6">Table 6</a>:
<a class="selfRef" href="#name-checklist-state-with-newly-fo">Checklist State with Newly Formed Pair, Rule 3</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1"></th>
            <th class="text-left" colspan="1" rowspan="1">f1</th>
            <th class="text-left" colspan="1" rowspan="1">f2</th>
            <th class="text-left" colspan="1" rowspan="1">f3</th>
            <th class="text-left" colspan="1" rowspan="1">f4</th>
            <th class="text-left" colspan="1" rowspan="1">f5</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s1 (Audio.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">S</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s2 (Audio.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">F</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s3 (Video.RTP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">^F^</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">s4 (Video.RTCP)</td>
            <td class="text-left" colspan="1" rowspan="1">W</td>
            <td class="text-left" colspan="1" rowspan="1"></td>
            <td class="text-left" colspan="1" rowspan="1">  </td>
            <td class="text-left" colspan="1" rowspan="1">
   </td>
            <td class="text-left" colspan="1" rowspan="1"></td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<div id="end-of-candidates.send">
<section id="section-13">
      <h2 id="name-generating-an-end-of-candid">
<a class="section-number selfRef" href="#section-13">13. </a><a class="section-name selfRef" href="#name-generating-an-end-of-candid">Generating an End-of-Candidates Indication</a>
      </h2>
<p id="section-13-1">
        Once all candidate gathering is completed or expires for an
        ICE session associated with a specific data stream, the agent will generate an
        "end-of-candidates" indication for that session and convey it to
        the remote agent via the signaling channel. Although the exact form of
        the indication depends on the using protocol, the indication
        <span class="bcp14">MUST</span> specify the generation (Username Fragment and Password combination), so that an agent
        can correlate the end-of-candidates indication with a particular ICE
        session. The indication can be conveyed in the following ways:<a class="pilcrow" href="#section-13-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13-2.1">As part of an initiation request (which would typically be the case with 
             the initial ICE description for half trickle)<a class="pilcrow" href="#section-13-2.1">¶</a>
</li>
        <li class="normal" id="section-13-2.2">Along with the last candidate an agent can send for a stream<a class="pilcrow" href="#section-13-2.2">¶</a>
</li>
        <li class="normal" id="section-13-2.3">As a standalone notification (e.g., after STUN Binding requests 
             or TURN Allocate requests to a server time out and the agent 
             is no longer actively gathering candidates)<a class="pilcrow" href="#section-13-2.3">¶</a>
</li>
      </ul>
<p id="section-13-3">
        Conveying an end-of-candidates indication in a timely manner is important 
        in order to avoid ambiguities and speed up the conclusion of ICE processing. 
        In particular:<a class="pilcrow" href="#section-13-3">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13-4.1">
            A controlled Trickle ICE agent <span class="bcp14">SHOULD</span> convey an end-of-candidates 
            indication after it has completed gathering for a data stream, 
            unless ICE processing terminates before the agent has had a chance 
            to complete gathering.<a class="pilcrow" href="#section-13-4.1">¶</a>
</li>
        <li class="normal" id="section-13-4.2">
            A controlling agent <span class="bcp14">MAY</span> conclude ICE processing prior to conveying 
            end-of-candidates indications for all streams.  However, it is 
            <span class="bcp14">RECOMMENDED</span> for a controlling agent to convey end-of-candidates 
            indications whenever possible for the sake of consistency and to 
            keep middleboxes and controlled agents up-to-date on the state of 
            ICE processing.<a class="pilcrow" href="#section-13-4.2">¶</a>
</li>
      </ul>
<p id="section-13-5">
        When conveying an end-of-candidates indication during trickling
        (rather than as a part of the initial ICE description or a response thereto), 
        it is the responsibility of the
        using protocol to define methods for associating the
        indication with one or more specific data streams.<a class="pilcrow" href="#section-13-5">¶</a></p>
<p id="section-13-6">
        An agent <span class="bcp14">MAY</span> also choose to generate an end-of-candidates
        indication before candidate gathering has actually completed, if the
        agent determines that gathering has continued for more than an
        acceptable period of time. However, an agent <span class="bcp14">MUST NOT</span> convey any
        more candidates after it has conveyed an end-of-candidates
        indication.<a class="pilcrow" href="#section-13-6">¶</a></p>
<p id="section-13-7">
        When performing half trickle, an agent <span class="bcp14">SHOULD</span> convey an
        end-of-candidates indication together with its initial ICE description unless
        it is planning to potentially trickle additional candidates (e.g., in
        case the remote party turns out to support Trickle ICE).<a class="pilcrow" href="#section-13-7">¶</a></p>
<p id="section-13-8">
        After an agent conveys the end-of-candidates indication, it will
        update the state of the corresponding checklist as explained
        in <a class="xref" href="#checks">Section 8</a>. Past that point, an
        agent <span class="bcp14">MUST NOT</span> trickle any new candidates within this ICE session. 
        Therefore, adding new candidates to the 
        negotiation is possible only through an ICE restart (see
        <a class="xref" href="#subsequent">Section 15</a>).<a class="pilcrow" href="#section-13-8">¶</a></p>
<p id="section-13-9">
        This specification does not
        override regular ICE semantics for concluding ICE processing.
        Therefore, even if end-of-candidates indications are conveyed,
        an agent will still need to go through pair nomination. Also, if
        pairs have been nominated for components and data streams, ICE
        processing <span class="bcp14">MAY</span> still conclude even if end-of-candidates
        indications have not been received for all streams. In all cases,
        an agent <span class="bcp14">MUST NOT</span> trickle any new candidates within an ICE session
        after nomination of a candidate pair as described in 
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-8.1.1">Section 8.1.1</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>.<a class="pilcrow" href="#section-13-9">¶</a></p>
</section>
</div>
<div id="end-of-candidates.recv">
<section id="section-14">
      <h2 id="name-receiving-an-end-of-candida">
<a class="section-number selfRef" href="#section-14">14. </a><a class="section-name selfRef" href="#name-receiving-an-end-of-candida">Receiving an End-of-Candidates Indication</a>
      </h2>
<p id="section-14-1">
        Receiving an end-of-candidates indication enables an agent to
        update checklist states and, in case valid pairs do not exist
        for every component in every data stream, determine that ICE
        processing has failed. It also enables an agent to speed up the
        conclusion of ICE processing when a candidate pair has been validated
        but uses a lower-preference transport such as
        TURN. In such situations, an implementation <span class="bcp14">MAY</span> choose to wait
        and see if higher-priority candidates are received; in this case,
        the end-of-candidates indication provides a notification that such
        candidates are not forthcoming.<a class="pilcrow" href="#section-14-1">¶</a></p>
<p id="section-14-2">
        When an agent receives an end-of-candidates indication for a 
        specific data stream, it will update the state of the relevant 
        checklist as per <a class="xref" href="#checks">Section 8</a> (which might lead to 
        some checklists being marked as Failed). 
        If the checklist is 
        still in the Running state after the update, the agent will note that an end-of-candidates indication has been
        received and take it into account in future updates
        to the checklist.<a class="pilcrow" href="#section-14-2">¶</a></p>
<p id="section-14-3">
        After an agent has received an end-of-candidates indication, it 
        <span class="bcp14">MUST</span> ignore any newly received candidates for that data 
        stream or data session.<a class="pilcrow" href="#section-14-3">¶</a></p>
</section>
</div>
<div id="subsequent">
<section id="section-15">
      <h2 id="name-subsequent-exchanges-and-ic">
<a class="section-number selfRef" href="#section-15">15. </a><a class="section-name selfRef" href="#name-subsequent-exchanges-and-ic">Subsequent Exchanges and ICE Restarts</a>
      </h2>
<p id="section-15-1">
        Before conveying an end-of-candidates indication, 
        either agent <span class="bcp14">MAY</span> convey subsequent candidate information at any time allowed
        by the using protocol. When this happens, agents will use semantics from
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> (e.g., checking of the 
        Username Fragment and Password combination) to determine whether or not
        the new candidate information requires an ICE restart.<a class="pilcrow" href="#section-15-1">¶</a></p>
<p id="section-15-2">
        If an ICE restart
        occurs, the agents can assume that Trickle ICE is still supported
        if support was determined previously; thus, they can engage in Trickle ICE 
        behavior as they would in an initial exchange of ICE descriptions where
        support was determined through a capabilities discovery method.<a class="pilcrow" href="#section-15-2">¶</a></p>
</section>
</div>
<div id="half-trickle">
<section id="section-16">
      <h2 id="name-half-trickle">
<a class="section-number selfRef" href="#section-16">16. </a><a class="section-name selfRef" href="#name-half-trickle">Half Trickle</a>
      </h2>
<p id="section-16-1">
        In half trickle, the initiator conveys the initial ICE description
        with a usable but not necessarily full generation of candidates. This 
        ensures that the ICE description can be processed by a regular ICE 
        responder and is mostly meant for use in cases where support for 
        Trickle ICE cannot be confirmed prior to conveying the initial ICE 
        description.  The initial ICE description indicates support for 
        Trickle ICE, so that the responder can respond with something less 
        than a full generation of candidates and then trickle the rest.  
        The initial ICE description for half trickle can contain 
        an end-of-candidates indication, although this is not mandatory
        because if trickle support is confirmed, then the initiator can
        choose to trickle additional candidates before it conveys an
        end-of-candidates indication.<a class="pilcrow" href="#section-16-1">¶</a></p>
<p id="section-16-2">
        The half-trickle mechanism can be used in cases where there is
        no way for an agent to verify in advance whether a remote
        party supports Trickle ICE. Because the initial ICE description contains
        a full generation of candidates, it can thus be handled by a regular
        ICE agent, while still allowing a Trickle ICE agent to use
        the optimization defined in this specification. This prevents
        negotiation from failing in the former case while still giving
        roughly half the Trickle ICE benefits in the latter.<a class="pilcrow" href="#section-16-2">¶</a></p>
<p id="section-16-3">
        Use of half trickle is only necessary during an initial
        exchange of ICE descriptions. After both parties have received 
        an ICE description from their peer, they can each reliably
        determine Trickle ICE support and use it for all subsequent
        exchanges (see <a class="xref" href="#subsequent">Section 15</a>).<a class="pilcrow" href="#section-16-3">¶</a></p>
<p id="section-16-4">
        In some instances, using half trickle might bring more than 
        just half the improvement in terms of user experience. 


        This 
        can happen when an agent starts gathering candidates upon user-interface 
        cues that the user will soon be initiating an interaction, 
        such as activity on a keypad or the phone going off hook. This 
        would mean that some or all of the candidate
        gathering could be completed before the agent actually
        needs to convey the candidate information. Because the responder will be able
        to trickle candidates, both agents will be able to start
        connectivity checks and complete ICE processing earlier than
        with regular ICE and potentially even as early as with full
        trickle.<a class="pilcrow" href="#section-16-4">¶</a></p>
<p id="section-16-5">
        However, such anticipation is not always possible. For
        example, a multipurpose user agent or a WebRTC web page where
        communication is a non-central feature (e.g., calling a support
        line in case of a problem with the main features) would not
        necessarily have a way of distinguishing between call
        intentions and other user activity. In such cases, using full
        trickle is most likely to result in an ideal user experience.
        Even so, using half trickle would be an improvement over regular
        ICE because it would result in a better experience for responders.<a class="pilcrow" href="#section-16-5">¶</a></p>
</section>
</div>
<section id="section-17">
      <h2 id="name-preserving-candidate-order-">
<a class="section-number selfRef" href="#section-17">17. </a><a class="section-name selfRef" href="#name-preserving-candidate-order-">Preserving Candidate Order While Trickling</a>
      </h2>
<p id="section-17-1">
        One important aspect of regular ICE is that connectivity checks
        for a specific foundation and component are attempted
        simultaneously by both agents, so that any firewalls or NATs
        fronting the agents would whitelist both endpoints and allow
        all except for the first ("suicide") packets to go through. This
        is also important to unfreezing candidates at the right time. While 
        not crucial, preserving this behavior in Trickle ICE is likely to 
        improve ICE performance.<a class="pilcrow" href="#section-17-1">¶</a></p>
<p id="section-17-2">
        To achieve this, when trickling candidates, agents <span class="bcp14">SHOULD</span> respect the 
        order of components as reflected by their component IDs; that is,
        candidates for a given component 
        <span class="bcp14">SHOULD NOT</span> be conveyed prior to candidates for a component with a 
        lower ID number within the same foundation. In addition, candidates 
        <span class="bcp14">SHOULD</span> be paired, following the procedures in <a class="xref" href="#trickle-insert">Section 12</a>, 
        in the same order they are conveyed.<a class="pilcrow" href="#section-17-2">¶</a></p>
<p id="section-17-3">
        For example, the following SDP description contains two
        components (RTP and RTCP) and two foundations (host and 
        server-reflexive):<a class="pilcrow" href="#section-17-3">¶</a></p>
<div id="section-17-4">
<pre class="sourcecode lang-sdp">  v=0
  o=jdoe 2890844526 2890842807 IN IP4 10.0.1.1
  s=
  c=IN IP4 10.0.1.1
  t=0 0
  a=ice-pwd:asd88fgpdd777uzjYhagZg
  a=ice-ufrag:8hhY
  m=audio 5000 RTP/AVP 0
  a=rtpmap:0 PCMU/8000
  a=candidate:1 1 UDP 2130706431 10.0.1.1 5000 typ host
  a=candidate:1 2 UDP 2130706431 10.0.1.1 5001 typ host
  a=candidate:2 1 UDP 1694498815 192.0.2.3 5000 typ srflx
      raddr 10.0.1.1 rport 8998
  a=candidate:2 2 UDP 1694498815 192.0.2.3 5001 typ srflx
      raddr 10.0.1.1 rport 8998
</pre><a class="pilcrow" href="#section-17-4">¶</a>
</div>
<p id="section-17-5">
        For this candidate information, the RTCP host candidate would not be conveyed
        prior to the RTP host candidate. Similarly, the RTP server-reflexive
        candidate would be conveyed together with or prior to the
        RTCP server-reflexive candidate.<a class="pilcrow" href="#section-17-5">¶</a></p>
</section>
<div id="reqs">
<section id="section-18">
      <h2 id="name-requirements-for-using-prot">
<a class="section-number selfRef" href="#section-18">18. </a><a class="section-name selfRef" href="#name-requirements-for-using-prot">Requirements for Using Protocols</a>
      </h2>
<p id="section-18-1">
        In order to fully enable the use of Trickle ICE, this specification
        defines the following requirements for using protocols.<a class="pilcrow" href="#section-18-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-18-2.1">
            A using protocol <span class="bcp14">SHOULD</span> provide a way for parties to advertise 
            and discover support for Trickle ICE before an ICE 
            session begins (see <a class="xref" href="#support">Section 3</a>).<a class="pilcrow" href="#section-18-2.1">¶</a>
</li>
        <li class="normal" id="section-18-2.2">
            A using protocol <span class="bcp14">MUST</span> provide methods for incrementally
            conveying (i.e., "trickling") additional candidates after 
            conveying the initial ICE description (see 
            <a class="xref" href="#trickle-send">Section 9</a>).<a class="pilcrow" href="#section-18-2.2">¶</a>
</li>
        <li class="normal" id="section-18-2.3">
            A using protocol <span class="bcp14">MUST</span> deliver each trickled candidate 
            or end-of-candidates indication exactly once
            and in the same order it was conveyed (see 
            <a class="xref" href="#trickle-send">Section 9</a>).<a class="pilcrow" href="#section-18-2.3">¶</a>
</li>
        <li class="normal" id="section-18-2.4">
            A using protocol <span class="bcp14">MUST</span> provide a mechanism for both parties 
            to indicate and agree on the ICE session in force
            (see <a class="xref" href="#trickle-send">Section 9</a>).<a class="pilcrow" href="#section-18-2.4">¶</a>
</li>
        <li class="normal" id="section-18-2.5">
            A using protocol <span class="bcp14">MUST</span> provide a way for parties to communicate the
            end-of-candidates indication, which <span class="bcp14">MUST</span> specify the particular
            ICE session to which the indication applies (see <a class="xref" href="#end-of-candidates.send">Section 13</a>).<a class="pilcrow" href="#section-18-2.5">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-19">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-19">19. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-19-1">
        IANA has registered the following ICE option in the "ICE
        Options" subregistry of the "Interactive Connectivity Establishment
        (ICE) registry", following the procedures defined in
        <span>[<a class="xref" href="#RFC6336">RFC6336</a>]</span>.<a class="pilcrow" href="#section-19-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-19-2">
        <dt id="section-19-2.1">ICE Option:</dt>
        <dd id="section-19-2.2" style="margin-left: 1.5em">trickle<a class="pilcrow" href="#section-19-2.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.3">Contact:</dt>
        <dd id="section-19-2.4" style="margin-left: 1.5em">IESG &lt;iesg@ietf.org&gt;<a class="pilcrow" href="#section-19-2.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.5">Change controller:</dt>
        <dd id="section-19-2.6" style="margin-left: 1.5em">IESG<a class="pilcrow" href="#section-19-2.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.7">Description:</dt>
        <dd id="section-19-2.8" style="margin-left: 1.5em">
            An ICE option of 'trickle' indicates support for incremental
            communication of ICE candidates.<a class="pilcrow" href="#section-19-2.8">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-19-2.9">Reference:</dt>
        <dd id="section-19-2.10" style="margin-left: 1.5em">RFC 8838<a class="pilcrow" href="#section-19-2.10">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
<section id="section-20">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-20">20. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-20-1">
        This specification inherits most of its semantics from
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, and as a result, all security
        considerations described there apply to Trickle ICE.<a class="pilcrow" href="#section-20-1">¶</a></p>
<p id="section-20-2">
        If the privacy implications of revealing host addresses on an
        endpoint device are a concern (see, for example, the discussion
        in <span>[<a class="xref" href="#RFC8828">RFC8828</a>]</span> and in 
        <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8445#section-19">Section 19</a> of [<a class="xref" href="#RFC8445">RFC8445</a>]</span>), agents can generate ICE descriptions that contain no
        candidates and then only trickle candidates that do not reveal
        host addresses (e.g., relayed candidates).<a class="pilcrow" href="#section-20-2">¶</a></p>
</section>
<section id="section-21">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-21">21. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-21.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-21.1">21.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8445">[RFC8445]</dt>
      <dd>
<span class="refAuthor">Keranen, A.</span><span class="refAuthor">, Holmberg, C.</span><span class="refAuthor">, and J. Rosenberg</span>, <span class="refTitle">"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal"</span>, <span class="seriesInfo">RFC 8445</span>, <span class="seriesInfo">DOI 10.17487/RFC8445</span>, <time class="refDate" datetime="2018-07">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8445">https://www.rfc-editor.org/info/rfc8445</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-21.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-21.2">21.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC1918">[RFC1918]</dt>
        <dd>
<span class="refAuthor">Rekhter, Y.</span><span class="refAuthor">, Moskowitz, B.</span><span class="refAuthor">, Karrenberg, D.</span><span class="refAuthor">, de Groot, G. J.</span><span class="refAuthor">, and E. Lear</span>, <span class="refTitle">"Address Allocation for Private Internets"</span>, <span class="seriesInfo">BCP 5</span>, <span class="seriesInfo">RFC 1918</span>, <span class="seriesInfo">DOI 10.17487/RFC1918</span>, <time class="refDate" datetime="1996-02">February 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1918">https://www.rfc-editor.org/info/rfc1918</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3261">[RFC3261]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span><span class="refAuthor">, Schulzrinne, H.</span><span class="refAuthor">, Camarillo, G.</span><span class="refAuthor">, Johnston, A.</span><span class="refAuthor">, Peterson, J.</span><span class="refAuthor">, Sparks, R.</span><span class="refAuthor">, Handley, M.</span><span class="refAuthor">, and E. Schooler</span>, <span class="refTitle">"SIP: Session Initiation Protocol"</span>, <span class="seriesInfo">RFC 3261</span>, <span class="seriesInfo">DOI 10.17487/RFC3261</span>, <time class="refDate" datetime="2002-06">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3261">https://www.rfc-editor.org/info/rfc3261</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3264">[RFC3264]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span><span class="refAuthor"> and H. Schulzrinne</span>, <span class="refTitle">"An Offer/Answer Model with Session Description Protocol (SDP)"</span>, <span class="seriesInfo">RFC 3264</span>, <span class="seriesInfo">DOI 10.17487/RFC3264</span>, <time class="refDate" datetime="2002-06">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3264">https://www.rfc-editor.org/info/rfc3264</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4566">[RFC4566]</dt>
        <dd>
<span class="refAuthor">Handley, M.</span><span class="refAuthor">, Jacobson, V.</span><span class="refAuthor">, and C. Perkins</span>, <span class="refTitle">"SDP: Session Description Protocol"</span>, <span class="seriesInfo">RFC 4566</span>, <span class="seriesInfo">DOI 10.17487/RFC4566</span>, <time class="refDate" datetime="2006-07">July 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4566">https://www.rfc-editor.org/info/rfc4566</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4787">[RFC4787]</dt>
        <dd>
<span class="refAuthor">Audet, F., Ed.</span><span class="refAuthor"> and C. Jennings</span>, <span class="refTitle">"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"</span>, <span class="seriesInfo">BCP 127</span>, <span class="seriesInfo">RFC 4787</span>, <span class="seriesInfo">DOI 10.17487/RFC4787</span>, <time class="refDate" datetime="2007-01">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4787">https://www.rfc-editor.org/info/rfc4787</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5389">[RFC5389]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span><span class="refAuthor">, Mahy, R.</span><span class="refAuthor">, Matthews, P.</span><span class="refAuthor">, and D. Wing</span>, <span class="refTitle">"Session Traversal Utilities for NAT (STUN)"</span>, <span class="seriesInfo">RFC 5389</span>, <span class="seriesInfo">DOI 10.17487/RFC5389</span>, <time class="refDate" datetime="2008-10">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5389">https://www.rfc-editor.org/info/rfc5389</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5766">[RFC5766]</dt>
        <dd>
<span class="refAuthor">Mahy, R.</span><span class="refAuthor">, Matthews, P.</span><span class="refAuthor">, and J. Rosenberg</span>, <span class="refTitle">"Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)"</span>, <span class="seriesInfo">RFC 5766</span>, <span class="seriesInfo">DOI 10.17487/RFC5766</span>, <time class="refDate" datetime="2010-04">April 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5766">https://www.rfc-editor.org/info/rfc5766</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6120">[RFC6120]</dt>
        <dd>
<span class="refAuthor">Saint-Andre, P.</span>, <span class="refTitle">"Extensible Messaging and Presence Protocol (XMPP): Core"</span>, <span class="seriesInfo">RFC 6120</span>, <span class="seriesInfo">DOI 10.17487/RFC6120</span>, <time class="refDate" datetime="2011-03">March 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6120">https://www.rfc-editor.org/info/rfc6120</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6336">[RFC6336]</dt>
        <dd>
<span class="refAuthor">Westerlund, M.</span><span class="refAuthor"> and C. Perkins</span>, <span class="refTitle">"IANA Registry for Interactive Connectivity Establishment (ICE) Options"</span>, <span class="seriesInfo">RFC 6336</span>, <span class="seriesInfo">DOI 10.17487/RFC6336</span>, <time class="refDate" datetime="2011-07">July 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6336">https://www.rfc-editor.org/info/rfc6336</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8828">[RFC8828]</dt>
        <dd>
<span class="refAuthor">Uberti, J.</span><span class="refAuthor"> and G. Shieh</span>, <span class="refTitle">"WebRTC IP Address Handling Requirements"</span>, <span class="seriesInfo">RFC 8828</span>, <span class="seriesInfo">DOI 10.17487/RFC8828</span>, <time class="refDate" datetime="2021-01">January 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8828">https://www.rfc-editor.org/info/rfc8828</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8840">[RFC8840]</dt>
        <dd>
<span class="refAuthor">Ivov, E.</span><span class="refAuthor">, Stach, T.</span><span class="refAuthor">, Marocco, E.</span><span class="refAuthor">, and C. Holmberg</span>, <span class="refTitle">"A Session Initiation Protocol (SIP) Usage for Incremental Provisioning of Candidates for the Interactive Connectivity Establishment (Trickle ICE)"</span>, <span class="seriesInfo">RFC 8840</span>, <span class="seriesInfo">DOI 10.17487/RFC8840</span>, <time class="refDate" datetime="2021-01">January 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8840">https://www.rfc-editor.org/info/rfc8840</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="XEP-0030">[XEP-0030]</dt>
        <dd>
<span class="refAuthor">Hildebrand, J.</span><span class="refAuthor">, Millard, P.</span><span class="refAuthor">, Eatmon, R.</span><span class="refAuthor">, and P. Saint-Andre</span>, <span class="refTitle">"XEP-0030: Service Discovery"</span>, <span class="seriesInfo">XMPP Standards Foundation, XEP-0030</span>, <time class="refDate" datetime="2008-06">June 2008</time>. </dd>
<dd class="break"></dd>
<dt id="XEP-0176">[XEP-0176]</dt>
      <dd>
<span class="refAuthor">Beda, J.</span><span class="refAuthor">, Ludwig, S.</span><span class="refAuthor">, Saint-Andre, P.</span><span class="refAuthor">, Hildebrand, J.</span><span class="refAuthor">, Egan, S.</span><span class="refAuthor">, and R. McQueen</span>, <span class="refTitle">"XEP-0176: Jingle ICE-UDP Transport Method"</span>, <span class="seriesInfo">XMPP Standards Foundation, XEP-0176</span>, <time class="refDate" datetime="2009-06">June 2009</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="interaction">
<section id="section-appendix.a">
      <h2 id="name-interaction-with-regular-ic">
<a class="section-number selfRef" href="#section-appendix.a">Appendix A. </a><a class="section-name selfRef" href="#name-interaction-with-regular-ic">Interaction with Regular ICE</a>
      </h2>
<p id="section-appendix.a-1">
        The ICE protocol was designed to be flexible enough to
        work in and adapt to as many network environments as
        possible. Despite that flexibility, ICE as specified in
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> does not by itself support Trickle 
        ICE. This section describes how trickling of candidates 
        interacts with ICE.<a class="pilcrow" href="#section-appendix.a-1">¶</a></p>
<p id="section-appendix.a-2">
        <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> describes the conditions required to
        update checklists and timer states while an ICE agent is in the
        Running state. These conditions are verified upon transaction
        completion, and one of them stipulates that:<a class="pilcrow" href="#section-appendix.a-2">¶</a></p>
<blockquote id="section-appendix.a-3">
        <p id="section-appendix.a-3.1">
   if there is not a
   valid pair in the valid list for each component of the data stream
   associated with the checklist, the state of the checklist is set to
   Failed.<a class="pilcrow" href="#section-appendix.a-3.1">¶</a></p>
</blockquote>
<p id="section-appendix.a-4">
        This could be a problem and cause ICE processing to fail
        prematurely in a number of scenarios. Consider the following
        case:<a class="pilcrow" href="#section-appendix.a-4">¶</a></p>
<ol class="normal type-1" id="section-appendix.a-5" start="1" type="1">
        <li id="section-appendix.a-5.1">
            Alice and Bob are both located in different networks with
            Network Address Translation (NAT). Alice and Bob themselves
            have different addresses, but both networks use the same
            private internet block (e.g., the "20-bit block"
            172.16/12 specified in <span>[<a class="xref" href="#RFC1918">RFC1918</a>]</span>).<a class="pilcrow" href="#section-appendix.a-5.1">¶</a>
</li>
        <li id="section-appendix.a-5.2">
            Alice conveys to Bob the candidate 172.16.0.1, which also happens
            to correspond to an existing host on Bob's network.<a class="pilcrow" href="#section-appendix.a-5.2">¶</a>
</li>
        <li id="section-appendix.a-5.3">
            Bob creates a candidate pair from his host candidate and
            172.16.0.1, puts this one pair into a checklist, and starts
            checks.<a class="pilcrow" href="#section-appendix.a-5.3">¶</a>
</li>
        <li id="section-appendix.a-5.4">
            These checks reach the host at 172.16.0.1 in Bob's network,
            which responds with an ICMP "port unreachable" error; per
            <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>, Bob marks the transaction as
            Failed.<a class="pilcrow" href="#section-appendix.a-5.4">¶</a>
</li>
      </ol>
<p id="section-appendix.a-6">
        At this point, the checklist only contains a Failed pair, and
        the valid list is empty. 
        This causes the data stream and
        potentially all ICE processing to fail, even though Trickle ICE agents
        can subsequently convey candidates that could succeed.<a class="pilcrow" href="#section-appendix.a-6">¶</a></p>
<p id="section-appendix.a-7">
        A similar race condition would occur if the initial ICE description from
        Alice contains only candidates that can be determined as
        unreachable from
        any of the candidates that Bob has gathered (e.g., this would be the
        case if Bob's candidates only contain IPv4 addresses and the
        first candidate that he receives from Alice is an IPv6 one).<a class="pilcrow" href="#section-appendix.a-7">¶</a></p>
<p id="section-appendix.a-8">
        Another potential problem could arise when a non-Trickle
        ICE implementation initiates an interaction with a Trickle ICE 
        implementation. Consider the following case:<a class="pilcrow" href="#section-appendix.a-8">¶</a></p>
<ol class="normal type-1" id="section-appendix.a-9" start="1" type="1">
        <li id="section-appendix.a-9.1">
            Alice's client has a non-Trickle ICE implementation.<a class="pilcrow" href="#section-appendix.a-9.1">¶</a>
</li>
        <li id="section-appendix.a-9.2">
            Bob's client has support for Trickle ICE.<a class="pilcrow" href="#section-appendix.a-9.2">¶</a>
</li>
        <li id="section-appendix.a-9.3">
            Alice and Bob are behind NATs with address-dependent
            filtering <span>[<a class="xref" href="#RFC4787">RFC4787</a>]</span>.<a class="pilcrow" href="#section-appendix.a-9.3">¶</a>
</li>
        <li id="section-appendix.a-9.4">
            Bob has two STUN servers, but one of them is currently
            unreachable.<a class="pilcrow" href="#section-appendix.a-9.4">¶</a>
</li>
      </ol>
<p id="section-appendix.a-10">
        After Bob's agent receives Alice's initial ICE description, it would 
        immediately start connectivity checks. It would also start gathering
        candidates, which would take a long time because of the unreachable
        STUN server. By the time Bob's answer is ready and conveyed to
        Alice, Bob's connectivity checks might have failed: until
        Alice gets Bob's answer, she won't be able to start connectivity
        checks and punch holes in her NAT. The NAT would hence be
        filtering Bob's checks as originating from an unknown endpoint.<a class="pilcrow" href="#section-appendix.a-10">¶</a></p>
</section>
</div>
<section id="section-appendix.b">
      <h2 id="name-interaction-with-ice-lite">
<a class="section-number selfRef" href="#section-appendix.b">Appendix B. </a><a class="section-name selfRef" href="#name-interaction-with-ice-lite">Interaction with ICE-Lite</a>
      </h2>
<p id="section-appendix.b-1">
        The behavior of ICE-lite agents that are capable of Trickle ICE does not
        require any particular rules other than those already defined
        in this specification and <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span>. This section
        is hence provided only for informational purposes.<a class="pilcrow" href="#section-appendix.b-1">¶</a></p>
<p id="section-appendix.b-2">
        An ICE-lite agent would generate candidate information 
        as per <span>[<a class="xref" href="#RFC8445">RFC8445</a>]</span> and 
        would indicate support for Trickle ICE. Given
        that the candidate information will contain a full generation of candidates,
        it would also be accompanied by an end-of-candidates indication.<a class="pilcrow" href="#section-appendix.b-2">¶</a></p>
<p id="section-appendix.b-3">
        When performing full trickle, a full ICE implementation could
        convey the initial ICE description or response thereto with no candidates. After receiving 
        a response that
        identifies the remote agent as an ICE-lite implementation, the
        initiator can choose to not trickle any additional
        candidates. The same is also true in the case when the ICE-lite
        agent initiates the interaction and the full ICE agent is the responder. In
        these cases, the connectivity checks would be enough for the ICE-lite
        implementation to discover all potentially useful
        candidates as peer-reflexive. The following example illustrates
        one such ICE session using SDP syntax:<a class="pilcrow" href="#section-appendix.b-3">¶</a></p>
<span id="name-example"></span><div id="fig-ice-lite">
<figure id="figure-2">
        <div class="artwork art-text alignLeft" id="section-appendix.b-4.1">
<pre>        ICE-Lite                                          Bob
         Agent
           |   Offer (a=ice-lite a=ice-options:trickle)    |
           |----------------------------------------------&gt;|
           |                                               |no cand
           |         Answer (a=ice-options:trickle)        |trickling
           |&lt;----------------------------------------------|
           |              Connectivity Checks              |
           |&lt;---------------------------------------------&gt;|
  peer rflx|                                               |
 cand disco|                                               |
           |&lt;========== CONNECTION ESTABLISHED ===========&gt;|
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-example">Example</a>
        </figcaption></figure>
</div>
<p id="section-appendix.b-5">
        In addition to reducing signaling traffic, this approach also
        removes the need to discover STUN Bindings or make TURN 
        allocations, which can considerably lighten ICE processing.<a class="pilcrow" href="#section-appendix.b-5">¶</a></p>
</section>
<section id="section-appendix.c">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="section-appendix.c-1">   
        The authors would like to thank
 <span class="contact-name">Bernard Aboba</span>,
        <span class="contact-name">Flemming Andreasen</span>,
 <span class="contact-name">Rajmohan Banavi</span>,
 <span class="contact-name">Taylor Brandstetter</span>,
 <span class="contact-name">Philipp Hancke</span>,
 <span class="contact-name">Christer Holmberg</span>,
        <span class="contact-name">Ari Keränen</span>,
 <span class="contact-name">Paul Kyzivat</span>,
 <span class="contact-name">Jonathan Lennox</span>,
 <span class="contact-name">Enrico Marocco</span>,
 <span class="contact-name">Pal Martinsen</span>,
        <span class="contact-name">Nils Ohlmeier</span>,
 <span class="contact-name">Thomas Stach</span>,
 <span class="contact-name">Peter Thatcher</span>,
 <span class="contact-name">Martin Thomson</span>,
 <span class="contact-name">Brandon Williams</span>, and
        <span class="contact-name">Dale Worley</span> for their reviews and
        suggestions on improving this document.  <span class="contact-name">Sarah         Banks</span>, <span class="contact-name">Roni Even</span>, and <span class="contact-name">David Mandelberg</span> completed OPSDIR, GenART, and security
        reviews, respectively. Thanks also to <span class="contact-name">Ari Keränen</span> and <span class="contact-name">Peter Thatcher</span>
        in their role as chairs and <span class="contact-name">Ben Campbell</span> in his role as responsible
        Area Director.<a class="pilcrow" href="#section-appendix.c-1">¶</a></p>
</section>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Emil Ivov</span></div>
<div class="left" dir="auto"><span class="org">8x8, Inc. / Jitsi</span></div>
<div class="left" dir="auto"><span class="street-address">675 Creekside Way</span></div>
<div class="left" dir="auto">
<span class="locality">Campbell</span>, <span class="region">CA</span> <span class="postal-code">95008</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+1%20512%20420%206968">+1 512 420 6968</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:emcho@jitsi.org">emcho@jitsi.org</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Justin Uberti</span></div>
<div class="left" dir="auto"><span class="org">Google</span></div>
<div class="left" dir="auto"><span class="street-address">747 6th Street S</span></div>
<div class="left" dir="auto">
<span class="locality">Kirkland</span>, <span class="region">WA</span> <span class="postal-code">98033</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+1%20857%20288%208888">+1 857 288 8888</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:justin@uberti.name">justin@uberti.name</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Peter Saint-Andre</span></div>
<div class="left" dir="auto"><span class="org">Mozilla</span></div>
<div class="left" dir="auto"><span class="street-address">P.O. Box 787</span></div>
<div class="left" dir="auto">
<span class="locality">Parker</span>, <span class="region">CO</span> <span class="postal-code">80134</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+1%20720%20256%206756">+1 720 256 6756</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:stpeter@mozilla.com">stpeter@mozilla.com</a>
</div>
<div class="url">
<span>URI:</span>
<a class="url" href="https://www.mozilla.com/">https://www.mozilla.com/</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>