<html><head></head><body><pre>Internet Engineering Task Force (IETF)                          H. Rogge
Request for Comments: 7779                               Fraunhofer FKIE
Category: Experimental                                       E. Baccelli
ISSN: 2070-1721                                                    INRIA
                                                              April 2016


    <span class="h1">Directional Airtime Metric Based on Packet Sequence Numbers for</span>
            <span class="h1">Optimized Link State Routing Version 2 (OLSRv2)</span>

Abstract

   This document specifies a Directional Airtime (DAT) link metric for
   usage in Optimized Link State Routing version 2 (OLSRv2).

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for examination, experimental implementation, and
   evaluation.

   This document defines an Experimental Protocol for the Internet
   community.  This document is a product of the Internet Engineering
   Task Force (IETF).  It represents the consensus of the IETF
   community.  It has received public review and has been approved for
   publication by the Internet Engineering Steering Group (IESG).  Not
   all documents approved by the IESG are a candidate for any level of
   Internet Standard; see <a href="./rfc5741#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7779">http://www.rfc-editor.org/info/rfc7779</a>.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Applicability Statement . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Directional Airtime Metric Rationale  . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  Metric Functioning and Overview . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-6">6</a>.  Protocol Constants  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-7">7</a>.  Protocol Parameters . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-7.1">7.1</a>.  Recommended Values  . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-8">8</a>.  Data Structures . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-8.1">8.1</a>.  Initial Values  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-9">9</a>.  Packets and Messages  . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-9.1">9.1</a>.  Definitions . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     9.2.  Requirements for Using DAT Metric in OLSRv2
           Implementations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-9.3">9.3</a>.  Link-Loss Data Gathering  . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-9.4">9.4</a>.  HELLO Message Processing  . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-10">10</a>. Timer Event Handling  . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-10.1">10.1</a>.  Packet Timeout Processing  . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-10.2">10.2</a>.  Metric Update  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-11">11</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-12">12</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-12.1">12.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-12.2">12.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#appendix-A">Appendix A</a>.  Future Work  . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   <a href="#appendix-B">Appendix B</a>.  OLSR.org Metric History  . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   <a href="#appendix-C">Appendix C</a>.  Link-Speed Stabilization . . . . . . . . . . . . . .  <a href="#page-18">18</a>
   <a href="#appendix-D">Appendix D</a>.  Packet-Loss Hysteresis . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
   <a href="#appendix-E">Appendix E</a>.  Example DAT Values . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   One of the major shortcomings of Optimized Link State Routing (OLSR)
   [<a href="./rfc3626" title='"Optimized Link State Routing Protocol (OLSR)"'>RFC3626</a>] is the lack of a granular link-cost metric between OLSR
   routers.  Operational experience with OLSR networks gathered since
   its publication has revealed that wireless networks links can have
   highly variable and heterogeneous properties.  This makes a hop-count
   metric insufficient for effective OLSR routing.

   Based on this experience, OLSRv2 [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>] integrates the concept of
   link metrics directly into the core specification of the routing
   protocol.  The OLSRv2 routing metric is an external process, and it
   can be any kind of dimensionless additive cost function that reports
   to the OLSRv2 protocol.




<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   Since 2004, the OLSR.org [<a href="#ref-OLSR.org" title='"OLSR.org Wiki"'>OLSR.org</a>] implementation of OLSR has
   included an Estimated Transmission Count (ETX) metric [<a href="#ref-MOBICOM04">MOBICOM04</a>] as
   a proprietary extension.  While this metric is not perfect, it proved
   to be sufficient for a long time for Community Mesh Networks (see
   <a href="#appendix-B">Appendix B</a>).  But the increasing maximum data rate of IEEE 802.11
   made the ETX metric less efficient than in the past, which is one
   reason to move to a different metric.

   This document describes a Directional Airtime routing metric for
   OLSRv2, a successor of the OLSR.org ETX-derived routing metric for
   OLSR.  It takes both the loss rate and the link speed into account to
   provide a more accurate picture of the links within the network.

   This specification allows OLSRv2 deployments with a metric defined by
   the IETF Mobile Ad Hoc Networks (MANET) working group.  It enables
   easier interoperability testing between implementations and targets
   to deliver a useful baseline to compare with, for experiments with
   this metric as well as other metrics.  <a href="#appendix-A">Appendix A</a> contains a few
   possible steps to improve the Directional Airtime metric.  Future
   experiments should also determine whether the DAT metric can be
   useful for other IETF protocols, both inside and outside of the MANET
   working group.  This could lead to either moving this document to the
   Standards Track or replacing it with an improved document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The terminology introduced in [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>], [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>], and [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>],
   including the terms "packet", "message" and "TLV", are to be
   interpreted as described therein.

   Additionally, this document uses the following terminology and
   notational conventions:

   DAT -  Directional Airtime (metric).  The link metric specified in
      this document, which is a directional variant of ETT.  It does not
      take reverse path loss into account.

   QUEUE -  A first in, first out queue of integers.

   QUEUE[TAIL] -  The most recent element in the queue.

   add(QUEUE, value) -  Adds a new element to the TAIL of the queue.

   remove(QUEUE) -  Removes the HEAD element of the queue.



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   sum(QUEUE) -  An operation that returns the sum of all elements in a
      QUEUE.

   diff_seqno(new, old) -  An operation that returns the positive
      distance between two elements of the circular sequence number
      space defined in <a href="./rfc5444#section-5.1">Section 5.1 of [RFC5444]</a>.  Its value is either
      (new - old) if this result is positive, or else its value is
      (new - old + 65536).

   MAX(a, b) -  The maximum of a and b.

   MIN(a, b) -  The minimum of a and b.

   UNDEFINED -  A value not in the normal value range of a variable.

   airtime -  The time a transmitted packet blocks the link layer, e.g.,
      a wireless link.

   ETX -  Expected Transmission Count.  A link metric proportional to
      the number of transmissions to successfully send an IP packet over
      a link.

   ETT -  Estimated Travel Time.  A link metric proportional to the
      amount of airtime needed to successfully transmit an IP packet
      over a link, not considering Layer 2 overhead created by preamble,
      backoff time, and queuing.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Applicability%20Statement"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Applicability Statement</span>

   The Directional Airtime metric was designed and tested (see
   [<a href="#ref-COMNET15" title='"OLSRv2 for Community Networks: Using Directional Airtime Metric with external radios"'>COMNET15</a>]) in wireless IEEE 802.11 OLSRv2 networks [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>].  These
   networks employ link-layer retransmission to increase the delivery
   probability.  A dynamic rate selection algorithm selects the unicast
   data rate independently for each neighbor.

   As specified in OLSRv2, the metric calculates only the incoming link
   cost.  It neither calculates the outgoing metric, nor decides the
   link status (heard, symmetric, lost).

   The metric works both for nodes that can send/receive [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>]
   packet sequence numbers and those that do not have this capability.
   In the absence of such sequence numbers, the metric calculates the
   packet loss based on HELLO message [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] timeouts.

   The metric must learn about the unicast data rate towards each one-
   hop neighbor from an external process, either by configuration or by
   an external measurement process.  This measurement could be done via
   gathering cross-layer data from the operating system, via an external



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   daemon like Dynamic Link Exchange Protocol [<a href="#ref-DLEP" title='"Dynamic Link Exchange Protocol (DLEP)"'>DLEP</a>], or via indirect
   Layer 3 measurements like packet-pair (see [<a href="#ref-MOBICOM04">MOBICOM04</a>]).

   The metric uses [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] multicast control traffic to determine the
   link packet loss.  The administrator should take care that link-layer
   multicast transmission do not have a higher reception probability
   than the slowest unicast transmission without retransmission.  For
   example, with 802.11g, it might be necessary to increase the data-
   rate of the multicast transmissions, e.g., set the multicast data-
   rate to 6 Mbit/s.

   The metric can only handle a certain range of packet loss and unicast
   data-rate.  The maximum packet loss that can be encoded into the
   metric is a loss of 7 of 8 packets (87.5%), without link-layer
   retransmissions.  The unicast data-rate that can be encoded by this
   metric can be between 1 kbit/s and 2 Gbit/s.  This metric has been
   designed for data-rates of 1 Mbit/s and hundreds of Mbit/s.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Directional%20Airtime%20Metric%20Rationale"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Directional Airtime Metric Rationale</span>

   The Directional Airtime metric has been inspired by the publications
   on the ETX [<a href="#ref-MOBICOM03">MOBICOM03</a>] and ETT [<a href="#ref-MOBICOM04">MOBICOM04</a>] metric, but differs from
   both of these in several ways.

   Instead of measuring the combined loss probability of a bidirectional
   transmission of a packet over a link in both directions, the
   Directional Airtime metric measures the incoming loss rate and
   integrates the incoming link speed into the metric cost.  There are
   multiple reasons for this decision:

   o  OLSRv2 [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>] defines the link metric as directional costs
      between routers.

   o  Not all link-layer implementations use acknowledgement mechanisms.
      Most link-layer implementations that do use them use less airtime
      and a more robust modulation for the acknowledgement than the data
      transmission, which makes it more likely for the data transmission
      to be disrupted compared to the acknowledgement.

   o  Incoming packet loss and link speed can be measured locally, while
      symmetric link loss would need an additional signaling TLV in the
      HELLO [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] and would delay metric calculation by up to one
      HELLO interval.

   The Directional Airtime metric does not integrate the packet size
   into the link cost.  Doing so is not feasible in most link-state
   routing protocol implementations.  The routing decision of most
   operation systems does not take packet size into account.



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   Multiplying all link costs of a topology with the size of a data-
   plane packet would never change the Dijkstra result in any way.

   The queue-based packet-loss estimator specified in this document has
   been tested extensively in the OLSR.org ETX implementation; see
   <a href="#appendix-B">Appendix B</a>.  The output is the average of the packet loss over a
   configured time period.

   The metric normally measures the loss of a link by tracking the
   incoming [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet sequence numbers.  Without these packet
   sequence numbers, the metric does calculate the loss of the link
   based on the received and lost [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] HELLO messages.  It uses the
   incoming HELLO interval time (or if not present, the validity time)
   to decide when a HELLO is lost.

   When a neighbor router resets, its packet sequence number might jump
   to a random value.  The metric tries to detect jumps in the packet
   sequence number and removes them from the data set because the
   previously gathered link-loss data should still be valid (see
   <a href="#section-9.3">Section 9.3</a>).  The link-loss data is only removed from memory when a
   link times out completely and its Link Set Tuple is removed from the
   database.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Metric%20Functioning%20and%20Overview"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Metric Functioning and Overview</span>

   The Directional Airtime metric is calculated for each Link Set entry,
   as defined in <a href="./rfc6130#section-7.1">[RFC6130], Section 7.1</a>.

   The metric processes two kinds of data into the metric value, namely
   packet-loss rate and link speed.  The link speed is taken from an
   external process not defined in this document.  The current packet-
   loss rate is defined in this document by keeping track of packet
   reception and packet-loss events.  It could also be calculated by an
   external process with a compatible output.

   Multiple incoming packet-loss/reception events must be combined into
   a loss rate to get a smooth metric.  Experiments with exponential
   weighted moving average (EWMA) lead to a highly fluctuating or a slow
   converging metric (or both).  To get a smoother and more controllable
   metric result, this metric uses two fixed-length queues to measure
   and average the incoming packet events, one queue for received
   packets and one for the estimated number of packets sent by the other
   side of the link.

   Because the rate of incoming packets is not uniform over time, the
   queue contains a number of counters, each representing a fixed time
   interval.  Incoming packet-loss and packet-reception events are
   accumulated in the current queue element until a timer adds a new



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   empty counter to both queues and removes the oldest counter from
   both.

   In addition to the packet loss stored in the queue, this metric uses
   a timer to detect a total link loss.  For every [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] HELLO
   interval in which the metric received no packet from a neighbor, it
   scales the number of received packets in the queue based on the total
   time interval the queue represents compared to the total time of the
   lost HELLO intervals.

   The average packet-loss ratio is calculated as the sum of the 'total
   packets' counters divided by the sum of the 'packets received'
   counters.  This value is then divided through the current link speed
   and then scaled into the range of metrics allowed for OLSRv2.

   The metric value is then used as L_in_metric of the Link Set (as
   defined in <a href="./rfc7181#section-8.1">Section 8.1. of [RFC7181]</a>).

   While this document does not add new [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] elements to HELLO
   [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] or TC messages [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>], it works best when both the
   INTERVAL_TIME message TLV is present in the HELLO messages and when
   each [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet contains an interface-specific sequence number.
   It also adds a number of new data entries to be stored for each
   [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] link.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Protocol%20Constants"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Protocol Constants</span>

   This specification defines the following constants, which define the
   range of metric values that can be encoded by the DAT metric (see
   Table 1).  They cannot be changed without making the metric outputs
   incomparable and should only be changed for a MANET with a very slow
   or a very fast link layer.  See <a href="#appendix-E">Appendix E</a> for example metric values.

   DAT_MAXIMUM_LOSS -  Fraction of the loss rate used in this routing
      metric.  Loss rate will be between 0/DAT_MAXIMUM_LOSS and
      (DAT_MAXIMUM_LOSS-1)/DAT_MAXIMUM_LOSS.

   DAT_MINIMUM_BITRATE -  Minimal bitrate in Bit/s used by this routing
      metric.
                      +---------------------+-------+
                      |         Name        | Value |
                      +---------------------+-------+
                      |   DAT_MAXIMUM_LOSS  |   8   |
                      |                     |       |
                      | DAT_MINIMUM_BITRATE |  1000 |
                      +---------------------+-------+

                      Table 1: DAT Protocol Constants



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Protocol%20Parameters"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Protocol Parameters</span>

   This specification defines the following parameters for this routing
   metric.  These parameters are:

   DAT_MEMORY_LENGTH -  Queue length for averaging packet loss.  All
      received and lost packets within the queue length are used to
      calculate the cost of the link.

   DAT_REFRESH_INTERVAL -  Interval in seconds between two metric
      recalculations as described in <a href="#section-10.2">Section 10.2</a>.  This value SHOULD be
      smaller than a typical HELLO interval.  The interval can be a
      fraction of a second.

   DAT_HELLO_TIMEOUT_FACTOR -  Multiplier relative to the HELLO_INTERVAL
      (see <a href="./rfc6130#section-5.3.1">Section 5.3.1 of [RFC6130]</a>) after which the DAT metric
      considers a HELLO as lost.

   DAT_SEQNO_RESTART_DETECTION -  Threshold in the number of missing
      packets (based on received packet sequence numbers) at which point
      the router considers the neighbor has restarted.  This parameter
      is only used for loss estimation based on packet sequence numbers.
      This number MUST be larger than DAT_MAXIMUM_LOSS.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.1.%20%20Recommended%20Values"></a><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Recommended Values</span>

   The proposed values of the protocol parameters are for Community Mesh
   Networks, which mostly use routers that are not mobile.  Using this
   metric for mobile networks might require shorter DAT_REFRESH_INTERVAL
   and/or DAT_MEMORY_LENGTH.

   DAT_MEMORY_LENGTH  := 64

   DAT_REFRESH_INTERVAL  := 1

   DAT_HELLO_TIMEOUT_FACTOR  := 1.2

   DAT_SEQNO_RESTART_DETECTION  := 256

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Data%20Structures"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Data Structures</span>

   This specification extends the Link Set of the Interface Information
   Base, as defined in <a href="./rfc6130#section-7.1">Section 7.1 of [RFC6130]</a>, by the adding the
   following elements to each Link Tuple:

   L_DAT_received -  A QUEUE with DAT_MEMORY_LENGTH integer elements.
      Each entry contains the number of successfully received packets
      within an interval of DAT_REFRESH_INTERVAL.



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   L_DAT_total -  A QUEUE with DAT_MEMORY_LENGTH integer elements.  Each
      entry contains the estimated number of packets transmitted by the
      neighbor, based on the received packet sequence numbers within an
      interval of DAT_REFRESH_INTERVAL.

   L_DAT_packet_time -  The time when the next [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet should
      have arrived.

   L_DAT_hello_interval -  The interval between two HELLO messages of
      the links neighbor as signaled by the INTERVAL_TIME TLV [<a href="./rfc5497" title='"Representing Multi-Value Time in Mobile Ad Hoc Networks (MANETs)"'>RFC5497</a>]
      of NHDP messages [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>].

   L_DAT_lost_packet_intervals -  The estimated number of HELLO
      intervals from this neighbor from which the metric has not
      received a single packet.

   L_DAT_rx_bitrate -  The current bitrate of incoming unicast traffic
      for this neighbor.

   L_DAT_last_pkt_seqno -  The last received packet sequence number
      received from this link.

   Methods to obtain the value of L_DAT_rx_bitrate are out of the scope
   of this specification.  Such methods may include static configuration
   via a configuration file or dynamic measurement through mechanisms
   described in a separate specification (e.g., [<a href="#ref-DLEP" title='"Dynamic Link Exchange Protocol (DLEP)"'>DLEP</a>]).  Any Link Tuple
   with L_status = HEARD or L_status = SYMMETRIC MUST have a specified
   value of L_DAT_rx_bitrate if it is to be used by this routing metric.

   The incoming bitrate value should be stabilized by a hysteresis
   filter to improve the stability of this metric.  See <a href="#appendix-D">Appendix D</a> for
   an example.

   This specification updates the L_in_metric field of the Link Set of
   the Interface Information Base, as defined in <a href="./rfc7181#section-8.1">Section 8.1. of
   [RFC7181]</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Initial%20Values"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Initial Values</span>

   When generating a new tuple in the Link Set, as defined in item 3 of
   <a href="./rfc6130#section-12.5">Section 12.5 of [RFC6130]</a>, the values of the elements specified in
   <a href="#section-8">Section 8</a> are set as follows:

   o  L_DAT_received := 0, ..., 0.  The queue always has
      DAT_MEMORY_LENGTH elements.

   o  L_DAT_total := 0, ..., 0.  The queue always has DAT_MEMORY_LENGTH
      elements.



<span class="grey">Rogge &amp; Baccelli              Experimental                      [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   o  L_DAT_packet_time := EXPIRED (no earlier [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet
      received).

   o  L_DAT_hello_interval := UNDEFINED (no earlier NHDP HELLO
      received).

   o  L_DAT_lost_packet_intervals := 0 (no HELLO interval without
      packets).

   o  L_DAT_last_pkt_seqno := UNDEFINED (no earlier [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet
      with sequence number received).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Packets%20and%20Messages"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Packets and Messages</span>

   This section describes the necessary changes of [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>]
   implementations with DAT metric for the processing and modification
   of the incoming and outgoing [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] data.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.1.%20%20Definitions"></a><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Definitions</span>

   For the purpose of this section, note the following definitions:

   o  "pkt_seqno" is defined as the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet sequence number of
      the received packet.

   o  "interval_time" is the time encoded in the INTERVAL_TIME message
      TLV of a received HELLO message [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>].

   o  "validity_time" is the time encoded in the VALIDITY_TIME message
      TLV of a received HELLO message [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.2.%20%20Requirements%20for%20Using%20DAT%20Metric%20in%20OLSRv2%20Implementations"></a><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Requirements for Using DAT Metric in OLSRv2 Implementations</span>

   An implementation of OLSRv2 using the metric specified by this
   document SHOULD include the following parts into its [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>]
   output:

   o  An INTERVAL_TIME message TLV in each HELLO message, as defined in
      <a href="./rfc6130#section-4.3.2">[RFC6130], Section 4.3.2</a>.

   o  An interface-specific packet sequence number as defined in
      <a href="./rfc5444#section-5.1">[RFC5444], Section 5.1</a> that is incremented by 1 for each outgoing
      [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet on the interface.

   An implementation of OLSRv2 using the metric specified by this
   document that inserts packet sequence numbers in some, but not all,
   outgoing [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packets will make this metric ignore all packets
   without the sequence number.  Putting the INTERVAL_TIME TLV into



<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   some, but not all, HELLO messages will make the timeout-based loss
   detection slower.  This will only matter in the absence of packet
   sequence numbers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.3.%20%20Link-Loss%20Data%20Gathering"></a><a class="selflink" href="#section-9.3" id="section-9.3">9.3</a>.  Link-Loss Data Gathering</span>

   For each incoming [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet, additional processing SHOULD be
   carried out after the packet messages have been processed as
   specified in [<a href="./rfc6130" title='"Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)"'>RFC6130</a>] and [<a href="./rfc7181" title='"The Optimized Link State Routing Protocol Version 2"'>RFC7181</a>] as described in this section.

   [<a id="ref-RFC5444">RFC5444</a>] packets without packet sequence numbers MUST NOT be
   processed in the way described in this section.

   The router updates the Link Set Tuple corresponding to the originator
   of the packet:

   1.  If L_DAT_last_pkt_seqno = UNDEFINED, then:

       *  L_DAT_received[TAIL] := 1.

       *  L_DAT_total[TAIL] := 1.

   2.  Otherwise:

       *  L_DAT_received[TAIL] := L_DAT_received[TAIL] + 1.

       *  diff := diff_seqno(pkt_seqno, L_DAT_last_pkt_seqno).

       *  If diff &gt; DAT_SEQNO_RESTART_DETECTION, then:

             diff := 1.

       *  L_DAT_total[TAIL] := L_DAT_total[TAIL] + diff.

   3.  L_DAT_last_pkt_seqno := pkt_seqno.

   4.  If L_DAT_hello_interval != UNDEFINED, then:

       *  L_DAT_packet_time := current time + (L_DAT_hello_interval *
          DAT_HELLO_TIMEOUT_FACTOR).

   5.  L_DAT_lost_packet_intervals := 0.









<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.4.%20%20HELLO%20Message%20Processing"></a><a class="selflink" href="#section-9.4" id="section-9.4">9.4</a>.  HELLO Message Processing</span>

   For each incoming HELLO Message, after it has been processed as
   defined in <a href="./rfc6130#section-12">Section 12 of [RFC6130]</a>, the Link Set Tuple corresponding
   to the incoming HELLO message MUST be updated.

   1.  If the HELLO message contains an INTERVAL_TIME message TLV, then:

          L_DAT_hello_interval := interval_time.

   2.  Otherwise:

          L_DAT_hello_interval := validity_time.

   3.  If L_DAT_last_pkt_seqno = UNDEFINED, then:

       *  L_DAT_received[TAIL] := L_DAT_received[TAIL] + 1.

       *  L_DAT_total[TAIL] := L_DAT_total[TAIL] + 1.

       *  L_DAT_packet_time := current time + (L_DAT_hello_interval *
          DAT_HELLO_TIMEOUT_FACTOR).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Timer%20Event%20Handling"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Timer Event Handling</span>

   In addition to changes in the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] processing/generation code,
   the DAT metric also uses two timer events.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.1.%20%20Packet%20Timeout%20Processing"></a><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Packet Timeout Processing</span>

   When L_DAT_packet_time has timed out, the following step MUST be
   done:

   1.  If L_DAT_last_pkt_seqno = UNDEFINED, then:

          L_DAT_total[TAIL] := L_DAT_total[TAIL] + 1.

   2.  Otherwise:

          L_DAT_lost_packet_intervals := L_DAT_lost_packet_intervals +
          1.

   3.  L_DAT_packet_time := L_DAT_packet_time + L_DAT_hello_interval.








<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.2.%20%20Metric%20Update"></a><a class="selflink" href="#section-10.2" id="section-10.2">10.2</a>.  Metric Update</span>

   Once every DAT_REFRESH_INTERVAL, all L_in_metric values in all Link
   Set entries MUST be recalculated:

   1.  sum_received := sum(L_DAT_received).

   2.  sum_total := sum(L_DAT_total).

   3.  If L_DAT_hello_interval != UNDEFINED and
       L_DAT_lost_packet_intervals &gt; 0, then:

       *  lost_time_proportion := L_DAT_hello_interval *
          L_DAT_lost_packet_intervals / DAT_MEMORY_LENGTH.

       *  sum_received := sum_received *
          MAX(0, 1 - lost_time_proportion);

   4.  If sum_received &lt; 1, then:

          L_in_metric := MAXIMUM_METRIC, as defined in <a href="./rfc7181#section-5.6.1">[RFC7181],
          Section 5.6.1</a>.

   5.  Otherwise:

       *  loss := MIN(sum_total / sum_received, DAT_MAXIMUM_LOSS).

       *  bitrate := MAX(L_DAT_rx_bitrate, DAT_MINIMUM_BITRATE).

       *  L_in_metric := (2^24 / DAT_MAXIMUM_LOSS) * loss / (bitrate /
          DAT_MINIMUM_BITRATE).

   6.  remove(L_DAT_total)

   7.  add(L_DAT_total, 0)

   8.  remove(L_DAT_received)

   9.  add(L_DAT_received, 0)

   The calculated L_in_metric value should be stabilized by a hysteresis
   function.  See <a href="#appendix-D">Appendix D</a> for an example.









<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20Security%20Considerations"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  Security Considerations</span>

   Artificial manipulation of metrics values can drastically alter
   network performance.  In particular, advertising a higher L_in_metric
   value may decrease the amount of incoming traffic, while advertising
   lower L_in_metric may increase the amount of incoming traffic.

   For example, by artificially attracting mesh routes and then dropping
   the incoming traffic, an attacker may achieve a Denial of Service
   (DoS) against other mesh nodes.  Similarly, an attacker may achieve
   Man-in-the-Middle (MITM) attacks or traffic analysis by concentrating
   traffic being routed over a node the attacker controls (and end-to-
   end encryption is not used or somehow broken).  Protection mechanisms
   against such MITM or DoS attacks are nevertheless out of scope of
   this document.

   Security threats also include potential attacks on the integrity of
   the control traffic passively monitored by DAT to measure link
   quality.  For example, an attacker might inject packets pretending to
   be somebody else and using incorrect sequence numbers.  This attack
   can be prevented by the true originator of the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packets by
   adding an ICV Packet TLV and TIMESTAMP Packet TLV [<a href="./rfc7182" title='"Integrity Check Value and Timestamp TLV Definitions for Mobile Ad Hoc Networks (MANETs)"'>RFC7182</a>] to each
   packet.  This allows the receiver to drop all incoming packets that
   have a forged packet source, both packets generated by the attacker,
   or replayed packets.  However, the security mechanism described in
   [<a href="./rfc7183" title='"Integrity Protection for the Neighborhood Discovery Protocol (NHDP) and Optimized Link State Routing Protocol Version 2 (OLSRv2)"'>RFC7183</a>] does not protect the sequence number used by the DAT metric
   because it only signs the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] messages, not the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>]
   packet header (which contains the [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet sequence number).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20References"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.1.%20%20Normative%20References"></a><a class="selflink" href="#section-12.1" id="section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5444">RFC5444</a>]  Clausen, T., Dearlove, C., Dean, J., and C. Adjih,
              "Generalized Mobile Ad Hoc Network (MANET) Packet/Message
              Format", <a href="./rfc5444">RFC 5444</a>, DOI 10.17487/RFC5444, February 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5444">http://www.rfc-editor.org/info/rfc5444</a>&gt;.

   [<a id="ref-RFC5497">RFC5497</a>]  Clausen, T. and C. Dearlove, "Representing Multi-Value
              Time in Mobile Ad Hoc Networks (MANETs)", <a href="./rfc5497">RFC 5497</a>,
              DOI 10.17487/RFC5497, March 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5497">http://www.rfc-editor.org/info/rfc5497</a>&gt;.




<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   [<a id="ref-RFC6130">RFC6130</a>]  Clausen, T., Dearlove, C., and J. Dean, "Mobile Ad Hoc
              Network (MANET) Neighborhood Discovery Protocol (NHDP)",
              <a href="./rfc6130">RFC 6130</a>, DOI 10.17487/RFC6130, April 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6130">http://www.rfc-editor.org/info/rfc6130</a>&gt;.

   [<a id="ref-RFC7181">RFC7181</a>]  Clausen, T., Dearlove, C., Jacquet, P., and U. Herberg,
              "The Optimized Link State Routing Protocol Version 2",
              <a href="./rfc7181">RFC 7181</a>, DOI 10.17487/RFC7181, April 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7181">http://www.rfc-editor.org/info/rfc7181</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.2.%20%20Informative%20References"></a><a class="selflink" href="#section-12.2" id="section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-RFC3626">RFC3626</a>]  Clausen, T., Ed. and P. Jacquet, Ed., "Optimized Link
              State Routing Protocol (OLSR)", <a href="./rfc3626">RFC 3626</a>,
              DOI 10.17487/RFC3626, October 2003,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3626">http://www.rfc-editor.org/info/rfc3626</a>&gt;.

   [<a id="ref-RFC7182">RFC7182</a>]  Herberg, U., Clausen, T., and C. Dearlove, "Integrity
              Check Value and Timestamp TLV Definitions for Mobile Ad
              Hoc Networks (MANETs)", <a href="./rfc7182">RFC 7182</a>, DOI 10.17487/RFC7182,
              April 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7182">http://www.rfc-editor.org/info/rfc7182</a>&gt;.

   [<a id="ref-RFC7183">RFC7183</a>]  Herberg, U., Dearlove, C., and T. Clausen, "Integrity
              Protection for the Neighborhood Discovery Protocol (NHDP)
              and Optimized Link State Routing Protocol Version 2
              (OLSRv2)", <a href="./rfc7183">RFC 7183</a>, DOI 10.17487/RFC7183, April 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7183">http://www.rfc-editor.org/info/rfc7183</a>&gt;.

   [<a id="ref-COMNET15">COMNET15</a>] Barz, C., Fuchs, C., Kirchhoff, J., Niewiejska, J., and H.
              Rogge, "OLSRv2 for Community Networks: Using Directional
              Airtime Metric with external radios", Elsevier Computer
              Networks 2015, DOI 10.1016/j.comnet.2015.09.022, September
              2015, &lt;<a href="http://dx.doi.org/10.1016/j.comnet.2015.09.022">http://dx.doi.org/10.1016/j.comnet.2015.09.022</a>&gt;.

   [<a id="ref-CONFINE">CONFINE</a>]  "Community Networks Testbed for the Future Internet
              (CONFINE)", &lt;<a href="http://www.confine-project.eu">http://www.confine-project.eu</a>&gt;.

   [<a id="ref-DLEP">DLEP</a>]     Ratliff, S., Berry, B., Jury, S., Satterwhite, D., and R.
              Taylor, "Dynamic Link Exchange Protocol (DLEP)", Work in
              Progress, <a href="./draft-ietf-manet-dlep-22">draft-ietf-manet-dlep-22</a>, April 2016.

   [<a id="ref-BATMAN">BATMAN</a>]   Neumann, A., Aichele, C., Lindner, M., and S. Wunderlich,
              "Better Approach To Mobile Ad-hoc Networking
              (B.A.T.M.A.N.)", Work in Progress, <a href="./draft-wunderlich-openmesh-manet-routing-00">draft-wunderlich-</a>
              <a href="./draft-wunderlich-openmesh-manet-routing-00">openmesh-manet-routing-00</a>, April 2008.






<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   [<a id="ref-MOBICOM03">MOBICOM03</a>]
              De Couto, D., Aguayo, D., Bicket, J., and R. Morris, "A
              High-Throughput Path Metric for Multi-Hop Wireless
              Routing", Proceedings of the MOBICOM Conference,
              DOI 10.1145/938985.939000, 2003.

   [<a id="ref-MOBICOM04">MOBICOM04</a>]
              Draves, R., Padhye, J., and B. Zill, "Routing in Multi-
              Radio, Multi-Hop Wireless Mesh Networks", Proceedings of
              the MOBICOM Conference, DOI 10.1145/1023720.1023732, 2004.

   [<a id="ref-OLSR.org">OLSR.org</a>] "OLSR.org Wiki", &lt;<a href="http://www.olsr.org/">http://www.olsr.org/</a>&gt;.

   [<a id="ref-FREIFUNK">FREIFUNK</a>] "Freifunk Wireless Community Networks",
              &lt;<a href="http://www.freifunk.net">http://www.freifunk.net</a>&gt;.

   [<a id="ref-FUNKFEUER">FUNKFEUER</a>]
              "Austria Wireless Community Network",
              &lt;<a href="http://www.funkfeuer.at">http://www.funkfeuer.at</a>&gt;.
































<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 16]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-17"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Future%20Work"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Future Work</span>

   As the DAT metric proved to work reasonably well for non- or slow-
   moving ad hoc networks [<a href="#ref-COMNET15" title='"OLSRv2 for Community Networks: Using Directional Airtime Metric with external radios"'>COMNET15</a>], it should be considered a solid
   first step on a way to better MANET metrics.  There are multiple
   parts of the DAT metric that need to be reviewed again in the context
   of real world deployments and can be subject to later improvements.

   The easiest part of the DAT metric to change and test would be the
   timings parameters.  A 1-minute interval for packet-loss statistics
   might be a good compromise for some MANETs, but could easily be too
   large or to small for others.  More data is needed to verify or
   improve the current parameter selection.

   The DAT metric considers only the multicast [<a href="./rfc5444" title='"Generalized Mobile Ad Hoc Network (MANET) Packet/Message Format"'>RFC5444</a>] packet loss for
   estimating the link, but it would be good to integrate the unicast
   data loss into the loss estimation.  This information could be
   provided directly from the link layer.  This could increase the
   accuracy of the loss rate estimation in scenarios where the
   assumptions regarding the ratio of multicast vs. unicast loss do not
   hold.

   The packet-loss averaging algorithm could also be improved.  While
   the DAT metric provides a stable sliding time interval to average the
   incoming packet loss and does not give the recent input too much
   influence, first experiments suggest that the algorithm tends to be
   less agile in detecting major changes of link quality.  This makes it
   less suited for mobile networks.  A more agile algorithm is needed
   for detecting major changes while filtering out random fluctuations
   regarding frame loss.  However, the current "queue of counters"
   algorithm suggested for DAT outperforms the binary queue algorithm
   and the exponential aging algorithms used for the ETX metric in the
   OLSR [<a href="./rfc3626" title='"Optimized Link State Routing Protocol (OLSR)"'>RFC3626</a>] codebase of OLSR.org.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20B.%20%20OLSR.org%20Metric%20History"></a><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  OLSR.org Metric History</span>

   The Funkfeuer [<a href="#ref-FUNKFEUER">FUNKFEUER</a>] and Freifunk networks [<a href="#ref-FREIFUNK" title='"Freifunk Wireless Community Networks"'>FREIFUNK</a>] are based
   on OLSR [<a href="./rfc3626" title='"Optimized Link State Routing Protocol (OLSR)"'>RFC3626</a>] or B.A.T.M.A.N. [<a href="#ref-BATMAN" title='"Better Approach To Mobile Ad-hoc Networking (B.A.T.M.A.N.)"'>BATMAN</a>] wireless community
   networks with hundreds of routers in permanent operation.  The Vienna
   Funkfeuer network in Austria, for instance, consists of 400 routers
   covering the whole city of Vienna and beyond, spanning roughly 40 km
   in diameter.  It has been supplying its users with Internet access
   since 2003.  A particularity of the Vienna Funkfeuer network is that
   it manages to provide Internet access through a city-wide, large-
   scale Wi-Fi MANET, with just a single Internet uplink.






<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 17]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-18"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   Operational experience of the OLSR project [<a href="#ref-OLSR.org" title='"OLSR.org Wiki"'>OLSR.org</a>] with these
   networks has revealed that the use of hop-count as a routing metric
   leads to unsatisfactory network performance.  Experiments with the
   ETX metric [<a href="#ref-MOBICOM03">MOBICOM03</a>] were therefore undertaken in parallel in the
   Berlin Freifunk network as well as in the Vienna Funkfeuer network in
   2004, and found satisfactory, i.e., sufficiently easy to implement
   and providing sufficiently good performance.  This metric has now
   been in operational use in these networks for several years.

   The ETX metric of a link is the estimated number of transmissions
   required to successfully send a packet (each packet equal to or
   smaller than MTU) over that link, until a link-layer acknowledgement
   is received.  The ETX metric is additive, i.e., the ETX metric of a
   path is the sum of the ETX metrics for each link on this path.

   While the ETX metric delivers a reasonable performance, it does not
   handle networks with heterogeneous links that have different bitrates
   well.  When using the ETX metric, since every wireless link is
   characterized only by its packet-loss ratio, long-ranged links with
   low bitrate (with low loss ratios) are preferred over short-ranged
   links with high bitrate (with higher but reasonable loss ratios).
   Such conditions, when they occur, can degrade the performance of a
   network considerably, by not taking advantage of higher capacity
   links.

   Because of this, the OLSR.org project has implemented the Directional
   Airtime metric for OLSRv2, which has been inspired by the Estimated
   Travel Time (ETT) metric [<a href="#ref-MOBICOM04">MOBICOM04</a>].  This metric uses a
   unidirectional packet loss, but also takes the bitrate into account
   to create a more accurate description of the relative costs or
   capabilities of OLSRv2 links.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20C.%20%20Link-Speed%20Stabilization"></a><a class="selflink" href="#appendix-C" id="appendix-C">Appendix C</a>.  Link-Speed Stabilization</span>

   The DAT metric specifies how to generate a reasonably stable packet-
   loss rate value based on incoming packet reception/loss events, but
   the source of the link speed used in this document is considered an
   external process.

   In the presence of a Layer 2 technology with variable link speed, it
   is likely that the raw link speed will be fluctuating too fast to be
   useful for the DAT metric.

   The amount of stabilization necessary for the link speed depends on
   the implementation of the MAC layer, especially the rate-control
   algorithm.





<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 18]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-19"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   Experiments with the Linux 802.11 Wi-Fi stack have shown that a
   simple Median filter over a series of raw link-speed measurements can
   smooth the calculated value without introducing intermediate link-
   speed values one would obtain by using averaging or an exponential
   weighted moving average.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20D.%20%20Packet-Loss%20Hysteresis"></a><a class="selflink" href="#appendix-D" id="appendix-D">Appendix D</a>.  Packet-Loss Hysteresis</span>

   While the DAT metric uses a sliding window to compute a reasonably
   stable frame loss, the implementation might choose to integrate an
   additional hysteresis to prevent undesirable oscillations between two
   values (i.e., metric flapping).

   In <a href="#section-10.2">Section 10.2</a>, DAT calculates a fractional loss rate.  The fraction
   of "loss := sum_total / sum_received" may result in minor
   fluctuations in the advertised L_in_metric due to minimal changes in
   sum_total or sum_received, which can cause undesirable protocol
   churn.

   A hysteresis function applied to the fraction could reduce the amount
   of changes in the loss rate and help to further stabilize the metric
   output.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20E.%20%20Example%20DAT%20Values"></a><a class="selflink" href="#appendix-E" id="appendix-E">Appendix E</a>.  Example DAT Values</span>

   The DAT metric value can be expressed in terms of link speed (bit/s)
   or used airtime (s).  When using the default protocol constants (see
   <a href="#section-6">Section 6</a>), DAT encodes link speeds between 119 bit/s and 2 Gbit/s.

   Table 2 contains a few examples for metric values and their meaning
   as a link speed:

                 +---------------------------+-----------+
                 |           Metric          |   bit/s   |
                 +---------------------------+-----------+
                 |     MINIMUM_METRIC (1)    |  2 Gbit/s |
                 |                           |           |
                 | MAXIMUM_METRIC (16776960) | 119 bit/s |
                 |                           |           |
                 |            2000           |  1 Mbit/s |
                 +---------------------------+-----------+

                      Table 2: DAT Link Cost Examples








<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 19]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-20"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


   A path metric value could also be expressed as a link speed, but this
   would be less intuitive.  An easier way to transform a path metric
   value into a textual representation is to divide it by the hop count
   of the path and express the path cost as the average link speed
   together with the hop count (see Table 3).

                    +---------+------+---------------+
                    |  Metric | hops | average bit/s |
                    +---------+------+---------------+
                    |    4    |  2   |    1 Gbit/s   |
                    |         |      |               |
                    | 4000000 |  6   |    3 kbit/s   |
                    +---------+------+---------------+

                      Table 3: DAT Link Cost Examples

Acknowledgements

   The authors would like to acknowledge the network administrators from
   Freifunk Berlin [<a href="#ref-FREIFUNK" title='"Freifunk Wireless Community Networks"'>FREIFUNK</a>] and Funkfeuer Vienna [<a href="#ref-FUNKFEUER">FUNKFEUER</a>] for
   endless hours of testing and suggestions to improve the quality of
   the original ETX metric for the OLSR.org routing daemon.

   This effort/activity is supported by the European Community Framework
   Program 7 within the Future Internet Research and Experimentation
   Initiative (FIRE), Community Networks Testbed for the Future Internet
   ([<a href="#ref-CONFINE" title='"Community Networks Testbed for the Future Internet (CONFINE)"'>CONFINE</a>]), contract FP7-288535.

   The authors would like to gratefully acknowledge the following people
   for intense technical discussions, early reviews, and comments on the
   specification and its components (listed alphabetically): Teco Boot
   (Infinity Networks), Juliusz Chroboczek (PPS, University of Paris 7),
   Thomas Clausen, Christopher Dearlove (BAE Systems Advanced Technology
   Centre), Ulrich Herberg (Fujitsu Laboratories of America), Markus
   Kittenberger (Funkfeuer Vienna), Joseph Macker (Naval Research
   Laboratory), Fabian Nack (Freie Universitaet Berlin), and Stan
   Ratliff (Cisco Systems).














<span class="grey">Rogge &amp; Baccelli              Experimental                     [Page 20]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-21"></span>
<span class="grey"><a href="./rfc7779">RFC 7779</a>            Directional Airtime Metric OLSRv2         April 2016</span>


Authors' Addresses

   Henning Rogge
   Fraunhofer FKIE

   Email: henning.rogge@fkie.fraunhofer.de
   URI:   <a href="http://www.fkie.fraunhofer.de">http://www.fkie.fraunhofer.de</a>


   Emmanuel Baccelli
   INRIA

   Email: Emmanuel.Baccelli@inria.fr
   URI:   <a href="http://www.emmanuelbaccelli.org/">http://www.emmanuelbaccelli.org/</a>





































Rogge &amp; Baccelli              Experimental                     [Page 21]
</pre>
</body></html>