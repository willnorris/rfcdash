<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9611: Internet Key Exchange Protocol Version 2 (IKEv2) Support for Perâ€‘Resource Child Security Associations (SAs)</title>
<meta content="Antony Antony" name="author"/>
<meta content="Tobias Brunner" name="author"/>
<meta content="Steffen Klassert" name="author"/>
<meta content="Paul Wouters" name="author"/>
<meta content="
       
   In order to increase the bandwidth of IPsec traffic between peers,
   this document defines one Notify Message Status Types and one Notify
   Message Error Types payload for the Internet Key Exchange Protocol
   Version 2 (IKEv2) to support the negotiation of multiple Child
   Security Associations (SAs) with the same Traffic Selectors used on
   different resources, such as CPUs.
       
       
       The SA_RESOURCE_INFO notification is used to convey information that the
       negotiated Child SA and subsequent new Child SAs with the same Traffic Selectors
       are a logical group of Child SAs where most or all of the Child SAs are
       bound to a specific resource, such as a specific CPU. The TS_MAX_QUEUE
       notify conveys that the peer is unwilling to create more additional Child
       SAs for this particular negotiated Traffic Selector combination.
       
       
       Using multiple Child SAs with the same Traffic Selectors has the benefit
       that each resource holding the Child SA has its own Sequence Number Counter,
       ensuring that CPUs don't have to synchronize their cryptographic state or disable
       their packet replay protection.
       
    " name="description"/>
<meta content="xml2rfc 3.22.0" name="generator"/>
<meta content="IKEv2" name="keyword"/>
<meta content="IPsec" name="keyword"/>
<meta content="9611" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.22.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    wcwidth 0.2.5
    weasyprint 62.3
-->
<link href="rfc9611.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-multi-sa-performance-09" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9611" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9611</td>
<td class="center">IKEv2 Support for Per-Resource Child SAs</td>
<td class="right">July 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Antony, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9611">9611</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-07">July 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Antony</div>
<div class="org">secunet</div>
</div>
<div class="author">
      <div class="author-name">T. Brunner</div>
<div class="org">codelabs</div>
</div>
<div class="author">
      <div class="author-name">S. Klassert</div>
<div class="org">secunet</div>
</div>
<div class="author">
      <div class="author-name">P. Wouters</div>
<div class="org">Aiven</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9611</h1>
<h1 id="title">Internet Key Exchange Protocol Version 2 (IKEv2) Support for Perâ€‘Resource Child Security Associations (SAs)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">
   In order to increase the bandwidth of IPsec traffic between peers,
   this document defines one Notify Message Status Types and one Notify
   Message Error Types payload for the Internet Key Exchange Protocol
   Version 2 (IKEv2) to support the negotiation of multiple Child
   Security Associations (SAs) with the same Traffic Selectors used on
   different resources, such as CPUs.<a class="pilcrow" href="#section-abstract-1">Â¶</a></p>
<p id="section-abstract-2">
       The SA_RESOURCE_INFO notification is used to convey information that the
       negotiated Child SA and subsequent new Child SAs with the same Traffic Selectors
       are a logical group of Child SAs where most or all of the Child SAs are
       bound to a specific resource, such as a specific CPU. The TS_MAX_QUEUE
       notify conveys that the peer is unwilling to create more additional Child
       SAs for this particular negotiated Traffic Selector combination.<a class="pilcrow" href="#section-abstract-2">Â¶</a></p>
<p id="section-abstract-3">
       Using multiple Child SAs with the same Traffic Selectors has the benefit
       that each resource holding the Child SA has its own Sequence Number Counter,
       ensuring that CPUs don't have to synchronize their cryptographic state or disable
       their packet replay protection.<a class="pilcrow" href="#section-abstract-3">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">Â¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">Â¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9611">https://www.rfc-editor.org/info/rfc9611</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">â–²</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.Â Â <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.Â Â <a class="internal xref" href="#name-requirements-language">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p class="keepWithNext" id="section-toc.1-1.1.2.2.1"><a class="auto internal xref" href="#section-1.2">1.2</a>.Â Â <a class="internal xref" href="#name-terminology">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.Â Â <a class="internal xref" href="#name-performance-bottlenecks">Performance Bottlenecks</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.Â Â <a class="internal xref" href="#name-negotiation-of-resource-spe">Negotiation of Resource-Specific Child SAs</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.Â Â <a class="internal xref" href="#name-implementation-consideratio">Implementation Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.Â Â <a class="internal xref" href="#name-payload-format">Payload Format</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.Â Â <a class="internal xref" href="#name-sa_resource_info-notify-mes">SA_RESOURCE_INFO Notify Message Status Type Payload</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.Â Â <a class="internal xref" href="#name-ts_max_queue-notify-message">TS_MAX_QUEUE Notify Message Error Type Payload</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.Â Â <a class="internal xref" href="#name-operational-considerations">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.Â Â <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.Â Â <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.Â Â <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.Â Â <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.Â Â <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">
       Most IPsec implementations are currently limited to using one
       hardware queue or a single CPU resource for a Child SA. 

Running
       packet stream encryption in parallel can be done, but there is a bottleneck of
       different parts of the hardware locking or waiting to get their
       sequence number assigned for the packet being encrypted. The
       result is that a machine with many such resources is limited to
       using only one of these resources per Child SA. This severely
       limits the throughput that can be attained. For example, at the
       time of writing, an unencrypted link of 10 Gbps or more is commonly
       reduced to 2-5 Gbps when IPsec is used to encrypt the link using
       AES-GCM. By using the implementation specified in this document,
       aggregate throughput increased from 5Gbps using 1 CPU to 40-60
       Gbps using 25-30 CPUs.<a class="pilcrow" href="#section-1-1">Â¶</a></p>
<p id="section-1-2">
       While this could be (partially) mitigated by setting up multiple
       narrowed Child SAs (for example, using Populate From Packet (PFP)
       as specified in IPsec architecture <span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>), this
       IPsec feature would cause too many Child SAs (one per network flow)
       or too few Child SAs (one network flow used on multiple CPUs). PFP is
       also not widely implemented.<a class="pilcrow" href="#section-1-2">Â¶</a></p>
<p id="section-1-3">
       To make better use of multiple network queues and CPUs, it can
       be beneficial to negotiate and install multiple Child
       SAs with identical Traffic Selectors. IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>
       already allows installing multiple Child SAs with identical Traffic
       Selectors, but it offers no method to indicate that the additional Child
       SA is being requested for performance increase reasons and is restricted
       to some resource (queue or CPU).<a class="pilcrow" href="#section-1-3">Â¶</a></p>
<p id="section-1-4">
       When an IKEv2 peer is receiving more additional Child SAs for a single
       set of Traffic Selectors than it is willing to create, it can return an
       error notify of TS_MAX_QUEUE.<a class="pilcrow" href="#section-1-4">Â¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-requirements-language">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCPÂ 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a class="pilcrow" href="#section-1.1-1">Â¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-terminology">
<a class="section-number selfRef" href="#section-1.2">1.2. </a><a class="section-name selfRef" href="#name-terminology">Terminology</a>
        </h3>
<p id="section-1.2-1">This document uses the following terms defined in IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>]</span>:
          Notification Data, Traffic Selector (TS), Traffic Selector initiator (TSi), Traffic Selector responder (TSr), Child SA,
          Configuration Payload (CP), IKE SA, CREATE_CHILD_SA, and NO_ADDITIONAL_SAS.<a class="pilcrow" href="#section-1.2-1">Â¶</a></p>
<p id="section-1.2-2">This document also uses the following terms defined in <span>[<a class="cite xref" href="#RFC4301">RFC4301</a>]</span>:
          Security Policy Database (SPD), SA.<a class="pilcrow" href="#section-1.2-2">Â¶</a></p>
</section>
</section>
<div id="performance">
<section id="section-2">
      <h2 id="name-performance-bottlenecks">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-performance-bottlenecks">Performance Bottlenecks</a>
      </h2>
<p id="section-2-1">
      There are several pragmatic reasons why most implementations must restrict a
      Child Security Association (SA) to a single specific hardware resource. A
      primary limitation arises from the challenges associated with sharing
      cryptographic states, counters, and sequence numbers among multiple CPUs. When
      these CPUs attempt to simultaneously utilize shared states, it becomes
      impractical to do so without incurring a significant performance penalty. It is
      necessary to negotiate and establish multiple Child SAs
      with identical Traffic Selector initiator (TSi) and Traffic Selector responder
      (TSr) on a per-resource basis.<a class="pilcrow" href="#section-2-1">Â¶</a></p>
</section>
</div>
<div id="neg_cpu">
<section id="section-3">
      <h2 id="name-negotiation-of-resource-spe">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-negotiation-of-resource-spe">Negotiation of Resource-Specific Child SAs</a>
      </h2>
<p id="section-3-1">
       An initial IKEv2 exchange is used to set up an IKE SA and the
       initial Child SA. If multiple Child SAs with the same Traffic
       Selectors that are bound to a single resource are desired, the
       initiator will add the SA_RESOURCE_INFO notify payload to the
       Exchange negotiating the Child SA (e.g., IKE_AUTH or CREATE_CHILD_SA).
       If this initial Child SA will be tied to a specific resource, it
       <span class="bcp14">MAY</span> indicate this by including an identifier in the Notification
       Data. 

A responder that is willing to have multiple Child SAs
       for the same Traffic Selectors will respond by also adding the
       SA_RESOURCE_INFO notify payload in which it <span class="bcp14">MAY</span> add a non-zero
       Notification Data.<a class="pilcrow" href="#section-3-1">Â¶</a></p>
<p id="section-3-2">
       Additional resource-specific Child SAs are negotiated as regular Child
       SAs using the CREATE_CHILD_SA exchange and are similarly identified by an
       accompanying SA_RESOURCE_INFO notification.<a class="pilcrow" href="#section-3-2">Â¶</a></p>
<p id="section-3-3">
       Upon installation, each resource-specific Child SA is
       associated with an additional local selector, such as the CPU.
       These resource-specific Child SAs <span class="bcp14">MUST</span> be negotiated with identical
       Child SA properties that were negotiated for the initial Child
       SA. This includes cryptographic algorithms, Traffic Selectors,
       Mode (e.g., transport mode), compression usage, etc. However, each
       Child SA does have its own keying material that is individually derived
       according to the regular IKEv2 process. The SA_RESOURCE_INFO
       notify payload <span class="bcp14">MAY</span> be empty or <span class="bcp14">MAY</span> contain some identifying data.
       This identifying data <span class="bcp14">SHOULD</span> be a unique identifier within all
       the Child SAs with the same TS payloads, and the peer <span class="bcp14">MUST</span> only
       use it for debugging purposes.<a class="pilcrow" href="#section-3-3">Â¶</a></p>
<p id="section-3-4">
       Additional Child SAs can be started on demand or can be started
       all at once. Peers may also delete specific per-resource Child
       SAs if they deem the associated resource to be idle.<a class="pilcrow" href="#section-3-4">Â¶</a></p>
<p id="section-3-5">
       During the CREATE_CHILD_SA rekey for the Child SA, the
       SA_RESOURCE_INFO notification <span class="bcp14">MAY</span> be included, but regardless of
       whether or not it is included, the rekeyed Child SA should be bound
       to the same resource(s) as the Child SA that is being rekeyed.<a class="pilcrow" href="#section-3-5">Â¶</a></p>
</section>
</div>
<div id="impl_consider">
<section id="section-4">
      <h2 id="name-implementation-consideratio">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-implementation-consideratio">Implementation Considerations</a>
      </h2>
<p id="section-4-1">
       There are various considerations that an implementation can
       use to determine the best procedure to install multiple Child SAs.<a class="pilcrow" href="#section-4-1">Â¶</a></p>
<p id="section-4-2">
       A simple procedure could be to install one additional Child SA
       on each CPU. An implementation can ensure that one Child SA can be
       used by all CPUs, so that while negotiating a new per-CPU Child SA,
       which typically takes 1 RTT delay, the CPU with no CPU-specific
       Child SA can still encrypt its packets using the Child SA that is
       available for all CPUs. Alternatively, if an implementation finds
       it needs to encrypt a packet but the current CPU does not have
       the resources to encrypt this packet, it can relay that packet
       to a specific CPU that does have the capability to encrypt the
       packet, although this will come with a performance penalty.<a class="pilcrow" href="#section-4-2">Â¶</a></p>
<p id="section-4-3">
       Performing per-CPU Child SA negotiations can result in both peers
       initiating additional Child SAs simultaneously. This is especially likely
       if per-CPU Child SAs are triggered by individual SADB_ACQUIRE messages
       <span>[<a class="cite xref" href="#RFC2367">RFC2367</a>]</span>. Responders should install the
       additional Child SA on a CPU with the least amount of additional
       Child SAs for this TSi/TSr pair.<a class="pilcrow" href="#section-4-3">Â¶</a></p>
<p id="section-4-4">
       When the number of queue or CPU resources are different between the
       peers, the peer with the least amount of resources may decide to
       not install a second outbound Child SA for the same resource, as
       it will never use it to send traffic. However, it must install
       all inbound Child SAs because it has committed to receiving traffic
       on these negotiated Child SAs.<a class="pilcrow" href="#section-4-4">Â¶</a></p>
<p id="section-4-5">
       If per-CPU packet trigger (e.g., SADB_ACQUIRE) messages are implemented
       (see <a class="auto internal xref" href="#Operations">Section 6</a>),
       the Traffic Selector (TSi) entry containing the information of the
       trigger packet should be included in the TS set similarly to
       regular Child SAs as specified in IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>], <a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-2.9">Section 2.9</a></span>.
       Based on the trigger TSi entry, an implementation can select the most
       optimal target CPU to install the additional Child SA on. For example,
       if the trigger packet was for a TCP destination to port 25 (SMTP), it
       might be able to install the Child SA on the CPU that is also running
       the mail server process. Trigger packet Traffic Selectors are
       documented in IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>], <a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-2.9">Section 2.9</a></span>.<a class="pilcrow" href="#section-4-5">Â¶</a></p>
<p id="section-4-6">
       As per IKEv2, rekeying a Child SA <span class="bcp14">SHOULD</span> use the same (or
       wider) Traffic Selectors to ensure that the new Child SA covers
       everything that the rekeyed Child SA covers. 
       This includes
       Traffic Selectors negotiated via Configuration Payloads 
       such as INTERNAL_IP4_ADDRESS, which may use the original wide TS
       set or use the narrowed TS set.<a class="pilcrow" href="#section-4-6">Â¶</a></p>
</section>
</div>
<div id="payload_formats">
<section id="section-5">
      <h2 id="name-payload-format">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-payload-format">Payload Format</a>
      </h2>
<p id="section-5-1">
 The Notify Payload format is defined in IKEv2 <span>[<a class="cite xref" href="#RFC7296">RFC7296</a>], <a class="relref" href="https://rfc-editor.org/rfc/rfc7296#section-3.10">Section 3.10</a></span>, and is copied here for convenience.<a class="pilcrow" href="#section-5-1">Â¶</a></p>
<p id="section-5-2">
      All multi-octet fields representing integers are laid out in big
      endian order (also known as "most significant byte first", or
      "network byte order").<a class="pilcrow" href="#section-5-2">Â¶</a></p>
<div id="payload_info_cpu">
<section id="section-5.1">
        <h3 id="name-sa_resource_info-notify-mes">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-sa_resource_info-notify-mes">SA_RESOURCE_INFO Notify Message Status Type Payload</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.1-1">
<pre>                    1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-------------------------------+-------------------------------+
| Next Payload  |C|  RESERVED   |         Payload Length        |
+---------------+---------------+-------------------------------+
|  Protocol ID  |   SPI Size    |      Notify Message Type      |
+---------------+---------------+-------------------------------+
|                                                               |
~               Resource Identifier (optional)                  ~
|                                                               |
+-------------------------------+-------------------------------+
</pre><a class="pilcrow" href="#section-5.1-1">Â¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-5.1-2">
          <dt id="section-5.1-2.1">(C)ritical flag -</dt>
          <dd id="section-5.1-2.2" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0.<a class="pilcrow" href="#section-5.1-2.2">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.3">Protocol ID (1 octet) -</dt>
          <dd id="section-5.1-2.4" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0. <span class="bcp14">MUST</span> be ignored if not 0.<a class="pilcrow" href="#section-5.1-2.4">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.5">SPI Size (1 octet) -</dt>
          <dd id="section-5.1-2.6" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0. <span class="bcp14">MUST</span> be ignored if not 0.<a class="pilcrow" href="#section-5.1-2.6">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.7">Notify Status Message Type value (2 octets) -</dt>
          <dd id="section-5.1-2.8" style="margin-left: 1.5em">set to 16444.<a class="pilcrow" href="#section-5.1-2.8">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.9">Resource Identifier (optional) -</dt>
          <dd id="section-5.1-2.10" style="margin-left: 1.5em">This opaque data may be set to convey the local identity of the resource.<a class="pilcrow" href="#section-5.1-2.10">Â¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="payload_max_q">
<section id="section-5.2">
        <h3 id="name-ts_max_queue-notify-message">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-ts_max_queue-notify-message">TS_MAX_QUEUE Notify Message Error Type Payload</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.2-1">
<pre>                    1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+-------------------------------+
| Next Payload  |C|  RESERVED   |         Payload Length        |
+---------------+---------------+-------------------------------+
|  Protocol ID  |   SPI Size    |      Notify Message Type      |
+---------------+---------------+-------------------------------+
</pre><a class="pilcrow" href="#section-5.2-1">Â¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-5.2-2">
          <dt id="section-5.2-2.1">(C)ritical flag -</dt>
          <dd id="section-5.2-2.2" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0.<a class="pilcrow" href="#section-5.2-2.2">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.3">Protocol ID (1 octet) -</dt>
          <dd id="section-5.2-2.4" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0. <span class="bcp14">MUST</span> be ignored if not 0.<a class="pilcrow" href="#section-5.2-2.4">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.5">SPI Size (1 octet) -</dt>
          <dd id="section-5.2-2.6" style="margin-left: 1.5em">
            <span class="bcp14">MUST</span> be 0. <span class="bcp14">MUST</span> be ignored if not 0.<a class="pilcrow" href="#section-5.2-2.6">Â¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.7">Notify Message Error Type (2 octets) -</dt>
          <dd id="section-5.2-2.8" style="margin-left: 1.5em">set to 48.<a class="pilcrow" href="#section-5.2-2.8">Â¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.2-3">There is no data associated with this Notify type.<a class="pilcrow" href="#section-5.2-3">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="Operations">
<section id="section-6">
      <h2 id="name-operational-considerations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-operational-considerations">Operational Considerations</a>
      </h2>
<p id="section-6-1">
      Implementations supporting per-CPU SAs <span class="bcp14">SHOULD</span> extend their local
      SPD selector, and the mechanism of on-demand negotiation that is
      triggered by traffic to include a CPU (or queue) identifier in
      their packet trigger (e.g., SADB_ACQUIRE) message from the SPD to
      the IKE daemon. An implementation that does not support
      receiving per-CPU packet trigger messages <span class="bcp14">MAY</span> initiate all its Child
      SAs immediately upon receiving the (only) packet trigger message it
      will receive from the IPsec stack. Such an implementation also needs
      to be careful when receiving a Delete Notify request for a per-CPU
      Child SA, as it has no method to detect when it should bring up such
      a per-CPU Child SA again later. Also, bringing the deleted per-CPU
      Child SA up again immediately after receiving the Delete Notify
      might cause an infinite loop between the peers. Another issue with
      not bringing up all its per-CPU Child SAs is that if the peer acts
      similarly, the two peers might end up with only the first Child
      SA without ever activating any per-CPU Child SAs. It is therefore
      <span class="bcp14">RECOMMENDED</span> to implement per-CPU packet trigger messages.<a class="pilcrow" href="#section-6-1">Â¶</a></p>
<p id="section-6-2">
      Peers <span class="bcp14">SHOULD</span> be flexible with the maximum number of Child SAs they
      allow for a given TSi/TSr combination in order to account for corner cases. For
      example, during Child SA rekeying, there might be a large number
      of additional Child SAs created before the old Child SAs are torn
      down. Similarly, when using on-demand Child SAs, both ends could
      trigger multiple Child SA requests as the initial packet causing
      the Child SA negotiation might have been transported to the peer
      via the first Child SA, where its reply packet might also trigger an
      on-demand Child SA negotiation to start. As additional Child SAs
      consume little additional resources, allowing at the very least double
      the number of available CPUs is <span class="bcp14">RECOMMENDED</span>. An implementation <span class="bcp14">MAY</span> allow
      unlimited additional Child SAs and only limit this number based on its
      generic resource protection strategies that are used to require COOKIES
      or refuse new IKE or Child SA negotiations. Although having a very large
      number (e.g., hundreds or thousands) of SAs may slow down per-packet SAD lookup.<a class="pilcrow" href="#section-6-2">Â¶</a></p>
<p id="section-6-3">
     Implementations might support dynamically moving a per-CPU Child
     SA from one CPU to another CPU. If this method is supported,
     implementations must be careful to move both the inbound and outbound
     SAs. If the IPsec endpoint is a gateway, it can move the inbound SA
     and outbound SA independently of each other. It is likely that
     for a gateway, IPsec traffic would be asymmetric.  If the IPsec
     endpoint is the same host responsible for generating the traffic,
     the inbound and outbound SAs <span class="bcp14">SHOULD</span> remain as a pair on the same CPU.
     If a host previously skipped installing an outbound SA because it
     would be an unused duplicate outbound SA, it will have to create
     and add the previously skipped outbound SA to the SAD with the new
     CPU ID. The inbound SA may not have a CPU ID in the SAD.  Adding the
     outbound SA to the SAD requires access to the key material, whereas
     updating the CPU selector on an existing outbound SAs might not require access
     to key material.  To support this, the IKE
     software might have to hold on to the key material longer than it
     normally would, as it might actively attempt to destroy key material
     from memory that the IKE daemon no longer needs access to.<a class="pilcrow" href="#section-6-3">Â¶</a></p>
<p id="section-6-4">
   An implementation that does not accept any further resource-specific
   Child SAs <span class="bcp14">MUST NOT</span> return the NO_ADDITIONAL_SAS error because it
   could be misinterpreted by the peer to mean that no other Child SA with
   a different TSi and/or TSr is allowed either. Instead, it <span class="bcp14">MUST</span> return TS_MAX_QUEUE.<a class="pilcrow" href="#section-6-4">Â¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-7-1">
      Similar to how an implementation should limit the number of
      half-open SAs to limit the impact of a denial-of-service attack,
      it is <span class="bcp14">RECOMMENDED</span> that an implementation limits the maximum number of additional
      Child SAs allowed per unique TSi/TSr.<a class="pilcrow" href="#section-7-1">Â¶</a></p>
<p id="section-7-2">
      Using multiple resource-specific child SAs makes sense for
      high-volume IPsec connections on IPsec gateway machines where the
      administrator has a trust relationship with the peer's
      administrator and abuse is unlikely and easily escalated to resolve.<a class="pilcrow" href="#section-7-2">Â¶</a></p>
<p id="section-7-3">
      This trust relationship is usually not present for the deployments of remote
      access VPNs, and allowing per-CPU Child SAs
      is <span class="bcp14">NOT RECOMMENDED</span> in these scenarios. Therefore, it is also <span class="bcp14">NOT RECOMMENDED</span> to allow per-CPU Child SAs by default.<a class="pilcrow" href="#section-7-3">Â¶</a></p>
<p id="section-7-4">
      The SA_RESOURCE_INFO notify contains an optional data payload that
      can be used by the peer to identify the Child SA belonging to a
      specific resource.  Notification data <span class="bcp14">SHOULD NOT</span> be an identifier that
      can be used to gain information about the hardware. For example,
      using the CPU number itself as the identifier might give an attacker
      knowledge of which packets are handled by which CPU ID, and it might
      optimize a brute-force attack against the system.<a class="pilcrow" href="#section-7-4">Â¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-8-1">
        IANA has registered one new value in the "IKEv2 Notify Message Status Types" registry.<a class="pilcrow" href="#section-8-1">Â¶</a></p>
<div id="iana_requests_i">
<table class="center" id="table-1">
        <caption><a class="selfRef" href="#table-1">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Notify Message Status Type</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">16444</td>
            <td class="text-left" colspan="1" rowspan="1">SA_RESOURCE_INFO</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9611</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-8-3">
        IANA has registered one new value in the "IKEv2 Notify Message Error Types" registry.<a class="pilcrow" href="#section-8-3">Â¶</a></p>
<div id="iana_requests_e">
<table class="center" id="table-2">
        <caption><a class="selfRef" href="#table-2">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Value</th>
            <th class="text-left" colspan="1" rowspan="1">Notify Message Error Type</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">48</td>
            <td class="text-left" colspan="1" rowspan="1">TS_MAX_QUEUE</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9611</td>
          </tr>
        </tbody>
      </table>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time class="refDate" datetime="2014-10">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC2367">[RFC2367]</dt>
        <dd>
<span class="refAuthor">McDonald, D.</span>, <span class="refAuthor">Metz, C.</span>, and <span class="refAuthor">B. Phan</span>, <span class="refTitle">"PF_KEY Key Management API, Version 2"</span>, <span class="seriesInfo">RFC 2367</span>, <span class="seriesInfo">DOI 10.17487/RFC2367</span>, <time class="refDate" datetime="1998-07">July 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2367">https://www.rfc-editor.org/info/rfc2367</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4301">[RFC4301]</dt>
      <dd>
<span class="refAuthor">Kent, S.</span> and <span class="refAuthor">K. Seo</span>, <span class="refTitle">"Security Architecture for the Internet Protocol"</span>, <span class="seriesInfo">RFC 4301</span>, <span class="seriesInfo">DOI 10.17487/RFC4301</span>, <time class="refDate" datetime="2005-12">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4301">https://www.rfc-editor.org/info/rfc4301</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acks">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The following people provided reviews and valuable feedback:
      <span class="contact-name">Roman Danyliw</span>, <span class="contact-name">Warren Kumari</span>,
      <span class="contact-name">Tero Kivinen</span>, <span class="contact-name">Murray Kucherawy</span>,
      <span class="contact-name">John Scudder</span>, <span class="contact-name">Valery Smyslov</span>,
      <span class="contact-name">Gunter van de Velde</span>, and <span class="contact-name">Ã‰ric Vyncke</span>.<a class="pilcrow" href="#appendix-A-1">Â¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Antony Antony</span></div>
<div class="left" dir="auto"><span class="org">secunet Security Networks AG</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:antony.antony@secunet.com">antony.antony@secunet.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Tobias Brunner</span></div>
<div class="left" dir="auto"><span class="org">codelabs GmbH</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:tobias@codelabs.ch">tobias@codelabs.ch</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Steffen Klassert</span></div>
<div class="left" dir="auto"><span class="org">secunet Security Networks AG</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:steffen.klassert@secunet.com">steffen.klassert@secunet.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Paul Wouters</span></div>
<div class="left" dir="auto"><span class="org">Aiven</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:paul.wouters@aiven.io">paul.wouters@aiven.io</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>