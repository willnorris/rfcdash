<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9437: Publish/Subscribe Functionality for the Locator/ID Separation Protocol (LISP)</title>
<meta content="Alberto Rodriguez-Natal" name="author"/>
<meta content="Vina Ermagan" name="author"/>
<meta content="Albert Cabellos" name="author"/>
<meta content="Sharon Barkai" name="author"/>
<meta content="Mohamed Boucadair" name="author"/>
<meta content="
       This document specifies an extension to the Locator/ID Separation
      Protocol (LISP) control plane to enable
      Publish/Subscribe (PubSub) operation.
 
    " name="description"/>
<meta content="xml2rfc 3.18.0" name="generator"/>
<meta content="lisp" name="keyword"/>
<meta content="publish" name="keyword"/>
<meta content="subscribe" name="keyword"/>
<meta content="subscription" name="keyword"/>
<meta content="sdn" name="keyword"/>
<meta content="nfv" name="keyword"/>
<meta content="9437" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.18.0
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9437.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-lisp-pubsub-15" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9437" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9437</td>
<td class="center">PubSub Functionality for LISP</td>
<td class="right">August 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rodriguez-Natal, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9437">9437</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-08">August 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Rodriguez-Natal</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">V. Ermagan</div>
<div class="org">Google</div>
</div>
<div class="author">
      <div class="author-name">A. Cabellos</div>
<div class="org">UPC/BarcelonaTech</div>
</div>
<div class="author">
      <div class="author-name">S. Barkai</div>
<div class="org">Nexar</div>
</div>
<div class="author">
      <div class="author-name">M. Boucadair</div>
<div class="org">Orange</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9437</h1>
<h1 id="title">Publish/Subscribe Functionality for the Locator/ID Separation Protocol (LISP)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document specifies an extension to the Locator/ID Separation
      Protocol (LISP) control plane to enable
      Publish/Subscribe (PubSub) operation.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9437">https://www.rfc-editor.org/info/rfc9437</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.  <a class="internal xref" href="#name-scope-of-applicability">Scope of Applicability</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-terminology-and-requirement">Terminology and Requirements Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-deployment-requirements">Deployment Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-map-request-pubsub-addition">Map-Request PubSub Additions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-mapping-request-subscribe-p">Mapping Request Subscribe Procedures</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-mapping-notification-publis">Mapping Notification Publish Procedures</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-security-association-betwee">Security Association between ITR and Map-Server</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="auto internal xref" href="#section-7.2">7.2</a>.  <a class="internal xref" href="#name-ddos-attack-mitigation">DDoS Attack Mitigation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-sample-pubsub-deployment-ex">Sample PubSub Deployment Experiences</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#appendix-A.1">A.1</a>.  <a class="internal xref" href="#name-pubsub-as-a-monitoring-tool">PubSub as a Monitoring Tool</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#appendix-A.2">A.2</a>.  <a class="internal xref" href="#name-mitigating-negative-map-cac">Mitigating Negative Map-Cache Entries</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a class="auto internal xref" href="#appendix-A.3">A.3</a>.  <a class="internal xref" href="#name-improved-mobility-latency">Improved Mobility Latency</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a class="auto internal xref" href="#appendix-A.4">A.4</a>.  <a class="internal xref" href="#name-enhanced-reachability-with-">Enhanced Reachability with Dynamic Redistribution of
        Prefixes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a class="auto internal xref" href="#appendix-A.5">A.5</a>.  <a class="internal xref" href="#name-better-serviceability">Better Serviceability</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-contributors">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-D"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">The Locator/ID Separation Protocol (LISP) <span>[<a class="cite xref" href="#RFC9300">RFC9300</a>]</span> <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> splits IP
      addresses into two different namespaces: Endpoint Identifiers (EIDs) and
      Routing Locators (RLOCs). LISP uses a map and encapsulate (a.k.a.,
      map-and-encap) approach that relies on (1) a Mapping System (basically a
      distributed database) that stores and disseminates EID-RLOC mappings and
      on (2) LISP Tunnel Routers (xTRs) that encapsulate and decapsulate data
      packets based on the content of those mappings.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">Ingress Tunnel Routers (ITRs), Re-encapsulating Tunnel Routers
      (RTRs), and Proxy Ingress Tunnel Routers (PITRs) pull EID-to-RLOC mapping
      information from the Mapping System by means of an explicit request
      message. <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-6.1">Section 6.1</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>
      indicates how Egress Tunnel Routers (ETRs) can tell ITRs/RTRs/PITRs
      about mapping changes. This document presents a Publish/Subscribe
      (PubSub) extension in which the Mapping System can notify
      ITRs/RTRs/PITRs about mapping changes. When this mechanism is used,
      mapping changes can be notified faster and can be managed in the Mapping
      System versus the LISP sites.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">In general, when an ITR/RTR/PITR wants to be notified for mapping
      changes for a given EID-Prefix, the following main steps occur:<a class="pilcrow" href="#section-1-3">¶</a></p>
<ol class="normal type-1" id="section-1-4" start="1" type="1">
 <li id="section-1-4.1">The ITR/RTR/PITR builds a Map-Request for that EID-Prefix with the
 Notification-Requested bit (N-bit) set and that also includes its
 xTR-ID and Site-ID.<a class="pilcrow" href="#section-1-4.1">¶</a>
</li>
        <li id="section-1-4.2">The Map-Request is forwarded to one of the Map-Servers that the
        EID-Prefix is registered to.<a class="pilcrow" href="#section-1-4.2">¶</a>
</li>
        <li id="section-1-4.3">The Map-Server creates subscription state for the ITR/RTR/PITR on
        the EID-Prefix.<a class="pilcrow" href="#section-1-4.3">¶</a>
</li>
        <li id="section-1-4.4">The Map-Server sends a Map-Notify to the ITR/RTR/PITR to confirm
        that the subscription has been created and then waits for an
        acknowledgement of the notification.<a class="pilcrow" href="#section-1-4.4">¶</a>
</li>
        <li id="section-1-4.5">The ITR/RTR/PITR sends back a Map-Notify-Ack to acknowledge the
        successful receipt of the Map-Notify.<a class="pilcrow" href="#section-1-4.5">¶</a>
</li>
        <li id="section-1-4.6">When there is a change in the mapping of the EID-Prefix, the
        Map-Server sends a Map-Notify message to each ITR/RTR/PITR in the
        subscription list.<a class="pilcrow" href="#section-1-4.6">¶</a>
</li>
        <li id="section-1-4.7">Each ITR/RTR/PITR sends a Map-Notify-Ack to acknowledge the
        received Map-Notify.<a class="pilcrow" href="#section-1-4.7">¶</a>
</li>
      </ol>
<p id="section-1-5">This operation is repeated for all EID-Prefixes for which ITRs/RTRs/PITRs want to be notified. An ITR/RTR/PITR can set the N-bit for several EID-Prefixes within a single Map-Request. Please note that the steps above illustrate only the simplest scenario and that details for this and other scenarios are described later in the document.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">The reader may refer to <span>[<a class="cite xref" href="#I-D.boucadair-lisp-pubsub-flow-examples">FLOW-EXAMPLES</a>]</span> for sample flows to illustrate the use of the PubSub specification.<a class="pilcrow" href="#section-1-6">¶</a></p>
<div id="app-scope">
<section id="section-1.1">
        <h3 id="name-scope-of-applicability">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-scope-of-applicability">Scope of Applicability</a>
        </h3>
<p id="section-1.1-1">The PubSub procedure specified in this document is intended for use in contexts with controlled access to the Map-Server. How a deployment controls access to a Map-Server is deployment specific and therefore out of the scope of this document. However, the Map-Resolvers and Map-Servers need to be configured with the required information to ensure at least the following:<a class="pilcrow" href="#section-1.1-1">¶</a></p>
<ol class="normal type-1" id="section-1.1-2" start="1" type="1">
   <li id="section-1.1-2.1">Map-Resolvers <span class="bcp14">MUST</span> verify that an xTR is allowed
   to (1) set the N-bit to 1 and (2) use the xTR-ID, Site-ID, and
   ITR-RLOCs included in a Map-Request.<a class="pilcrow" href="#section-1.1-2.1">¶</a>
</li>
          <li id="section-1.1-2.2">Map-Servers <span class="bcp14">MUST</span> only accept subscription
          requests from Map-Resolvers that verify Map-Requests as previously
          described.<a class="pilcrow" href="#section-1.1-2.2">¶</a>
</li>
        </ol>
</section>
</div>
</section>
<section id="section-2">
      <h2 id="name-terminology-and-requirement">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-terminology-and-requirement">Terminology and Requirements Notation</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">The document uses the terms defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9300#section-3">Section 3</a> of [<a class="cite xref" href="#RFC9300">RFC9300</a>]</span>.<a class="pilcrow" href="#section-2-2">¶</a></p>
</section>
<div id="assumptions">
<section id="section-3">
      <h2 id="name-deployment-requirements">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-deployment-requirements">Deployment Requirements</a>
      </h2>
<p id="section-3-1">In addition to the general assumptions and expectations that <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> makes for LISP deployments, this document imposes the following deployment requirements:<a class="pilcrow" href="#section-3-1">¶</a></p>
<ol class="normal type-1" id="section-3-2" start="1" type="1">
 <li id="section-3-2.1">A unique 128-bit xTR-ID (plus a 64-bit Site-ID) identifier is
 assigned to each xTR.<a class="pilcrow" href="#section-3-2.1">¶</a>
</li>
        <li id="section-3-2.2">Map-Servers are configured to proxy Map-Replying (i.e., they are
        solicited to generate and send Map-Reply messages) for the mappings
        they are serving.<a class="pilcrow" href="#section-3-2.2">¶</a>
</li>
        <li id="section-3-2.3">A security association (e.g., a PubSubKey) is required between the
        ITRs and the Map-Servers (see <a class="auto internal xref" href="#association">Section 7.1</a>).<a class="pilcrow" href="#section-3-2.3">¶</a>
</li>
      </ol>
<p id="section-3-3">If a requirement is not met, a subscription cannot be established, and the network will continue operating without this enhancement. The configuration of xTR-IDs and Site-IDs is out of the scope of this document. The reader may refer to <span>[<a class="cite xref" href="#I-D.ietf-lisp-yang">LISP-YANG</a>]</span> for an example of how these identifiers can be provisioned to LISP nodes.<a class="pilcrow" href="#section-3-3">¶</a></p>
</section>
</div>
<div id="map-request">
<section id="section-4">
      <h2 id="name-map-request-pubsub-addition">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-map-request-pubsub-addition">Map-Request PubSub Additions</a>
      </h2>
<p id="section-4-1"><a class="auto internal xref" href="#mrq-fig">Figure 1</a> shows the format of the updated Map-Request to support the PubSub functionality. In particular, this document associates a meaning with one of the reserved bits (see <a class="auto internal xref" href="#IANA">Section 8</a>).<a class="pilcrow" href="#section-4-1">¶</a></p>
<span id="name-map-request-with-i-bit-n-bi"></span><div id="mrq-fig">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-4-2.1">
<pre>     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Type=1 |A|M|P|S|p|s|R|I|  Rsvd   |L|D|   IRC   | Record Count  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Nonce . . .                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         . . . Nonce                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         Source-EID-AFI        |   Source EID Address  ...     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         ITR-RLOC-AFI 1        |    ITR-RLOC Address 1  ...    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                              ...                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         ITR-RLOC-AFI n        |    ITR-RLOC Address n  ...    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  / |N|   Reserved  | EID mask-len  |        EID-Prefix-AFI         |
Rec +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  \ |                       EID-Prefix  ...                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                   Map-Reply Record  ...                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                            xTR-ID                             +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                           Site-ID                             +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-map-request-with-i-bit-n-bi">Map-Request with I-bit, N-bit, xTR-ID, and Site-ID</a>
        </figcaption></figure>
</div>
<p id="section-4-3">The following is added to the Map-Request message defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>:<a class="pilcrow" href="#section-4-3">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4-4">
        <dt id="section-4-4.1">xTR-ID bit (I-bit):</dt>
        <dd id="section-4-4.2" style="margin-left: 1.5em">This bit is set to 1 to indicate that 128-bit xTR-ID and 64-bit
 Site-ID fields are present in the Map-Request message. For PubSub
 operation, an xTR <span class="bcp14">MUST</span> be configured with an xTR-ID and
 Site-ID, and it <span class="bcp14">MUST</span> set the I-bit to 1 and include its
 xTR-ID and Site-ID in the Map-Request messages it generates. If the
 I-bit is set but the Site-ID and/or xTR-ID are not included, a
 receiver can detect the error because, after processing that last
 EID-Record, there are no bytes left from processing the message. In
 this case, the receiver <span class="bcp14">SHOULD</span> log a malformed
 Map-Request and <span class="bcp14">MUST</span> drop the message.<a class="pilcrow" href="#section-4-4.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-4.3">Notification-Requested bit (N-bit):</dt>
        <dd id="section-4-4.4" style="margin-left: 1.5em">The N-bit of an EID-Record is set to 1 to specify that the xTR
 wants to be notified of updates for that EID-Prefix.<a class="pilcrow" href="#section-4-4.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-4.5">xTR-ID field:</dt>
        <dd id="section-4-4.6" style="margin-left: 1.5em">If the I-bit is set, this field is added to the Map-Request
 message as shown in <a class="auto internal xref" href="#mrq-fig">Figure 1</a>,
 starting right after the final Record in the message (or the Map-Reply
 Record, if present). The xTR-ID is specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.6">Section 5.6</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-4-4.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-4-4.7">Site-ID field:</dt>
        <dd id="section-4-4.8" style="margin-left: 1.5em">If the I-bit is set, this field is added to the Map-Request
 message as shown in <a class="auto internal xref" href="#mrq-fig">Figure 1</a>,
 following the xTR-ID field.  The Site-ID is defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.6">Section 5.6</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-4-4.8">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="sub">
<section id="section-5">
      <h2 id="name-mapping-request-subscribe-p">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-mapping-request-subscribe-p">Mapping Request Subscribe Procedures</a>
      </h2>
<p id="section-5-1"> The xTR subscribes for changes to a given EID-Prefix by sending a
      Map-Request to the Mapping System with the N-bit set on the
      EID-Record. The xTR builds a Map-Request according to <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> and also does the
      following:<a class="pilcrow" href="#section-5-1">¶</a></p>
<ol class="normal type-1" id="section-5-2" start="1" type="1">
 <li id="section-5-2.1">The xTR <span class="bcp14">MUST</span> set the I-bit to 1 and append its
 xTR-ID and Site-ID to the Map-Request.<a class="pilcrow" href="#section-5-2.1">¶</a>
</li>
        <li id="section-5-2.2">The xTR <span class="bcp14">MUST</span> set the N-bit to 1 for the EID-Record
        to which the xTR wants to subscribe.<a class="pilcrow" href="#section-5-2.2">¶</a>
</li>
        <li id="section-5-2.3">If the xTR has a nonce associated with the EID-Prefix, it
        <span class="bcp14">MUST</span> use this nonce increased by one in the
        Map-Request. Otherwise, it generates a nonce as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>. It is
        <span class="bcp14">RECOMMENDED</span> that the xTR use persistent storage to
        keep nonce state. If the xTR does not have persistent storage and does
        not have a nonce associated with the EID-Prefix, it
        <span class="bcp14">MUST</span> reset the nonce by using the procedure described
        in <a class="auto internal xref" href="#association">Section 7.1</a> to successfully
        create a new security association with the Map-Server.<a class="pilcrow" href="#section-5-2.3">¶</a>
</li>
      </ol>
<p id="section-5-3">The Map-Request is forwarded to the appropriate Map-Server through the Mapping System. This document does not assume that a Map-Server is pre-assigned to handle the subscription state for a given xTR. The Map-Server that receives the Map-Request will be the Map-Server responsible for notifying that specific xTR about future mapping changes for the subscribed mapping records.<a class="pilcrow" href="#section-5-3">¶</a></p>
<p id="section-5-4">Upon receipt of the Map-Request, the Map-Server processes it as
      described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.3">Section 8.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>. In addition, unless the xTR is using the procedure
      described in <a class="auto internal xref" href="#association">Section 7.1</a> to create a
      new security association, the Map-Server <span class="bcp14">MUST</span> verify that
      the nonce in the Map-Request is greater than the stored nonce (if any)
      associated with the xTR-ID (and EID-Prefix, when applicable). Otherwise,
      the Map-Server <span class="bcp14">MUST</span> silently drop the Map-Request message
      and <span class="bcp14">SHOULD</span> log the event to record that a replay attack
      could have occurred. Furthermore, upon processing, for the EID-Record
      that has the N-bit set to 1, the Map-Server proceeds to add the xTR-ID
      contained in the Map-Request to the list of xTRs that have requested to
      be subscribed to that EID-Prefix.<a class="pilcrow" href="#section-5-4">¶</a></p>
<p id="section-5-5">If an xTR-ID is successfully added to the list of subscribers for an
      EID-Prefix, the Map-Server <span class="bcp14">MUST</span> extract the nonce and
      ITR-RLOCs present in the Map-Request and store the association between
      the EID-Prefix, xTR-ID, ITR-RLOCs, and nonce. Any state that is already
      present regarding ITR-RLOCs and/or nonce for the same xTR-ID
      <span class="bcp14">MUST</span> be overwritten. When the LISP deployment has a
      single Map-Server, the Map-Server can be configured to keep a single
      nonce per xTR-ID for all EID-Prefixes (when used, this option
      <span class="bcp14">MUST</span> be enabled at the Map-Server and all xTRs).<a class="pilcrow" href="#section-5-5">¶</a></p>
<p id="section-5-6">If the xTR-ID is added to the list, the Map-Server
      <span class="bcp14">MUST</span> send a Map-Notify message back to the xTR to
      acknowledge the successful subscription. The Map-Server builds the
      Map-Notify according to Sections <a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.5">5.5</a> and <a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">5.7</a> of <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> with
      the following considerations:<a class="pilcrow" href="#section-5-6">¶</a></p>
<ol class="normal type-1" id="section-5-7" start="1" type="1">
 <li id="section-5-7.1">The Map-Server <span class="bcp14">MUST</span> use the nonce from the
 Map-Request as the nonce for the Map-Notify.<a class="pilcrow" href="#section-5-7.1">¶</a>
</li>
        <li id="section-5-7.2">The Map-Server <span class="bcp14">MUST</span> use its security association
        with the xTR (<a class="auto internal xref" href="#association">Section 7.1</a>) to sign
        the authentication data of the Map-Notify. The xTR <span class="bcp14">MUST</span>
        use the security association to verify the received authentication
        data.<a class="pilcrow" href="#section-5-7.2">¶</a>
</li>
        <li id="section-5-7.3">The Map-Server <span class="bcp14">MUST</span> send the Map-Notify to one of
        the ITR-RLOCs received in the Map-Request (which one is
        implementation specific).<a class="pilcrow" href="#section-5-7.3">¶</a>
</li>
      </ol>
<p id="section-5-8">As a reminder, the initial transmission and retransmission of
      Map-Notify messages by a Map-Server follow the procedure specified in
      <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>. Some state
      changes may trigger an overload that would impact, e.g., the outbound
      capacity of a Map-Server. A similar problem may be experienced when a
      large number of state entries are simultaneously updated. To prevent
      such phenomena, Map-Servers <span class="bcp14">SHOULD</span> be configured with
      policies to control the maximum number of subscriptions and also the
      pace of Map-Notify messages. For example, the Map-Server may be
      instructed to limit the resources that are dedicated to unsolicited
      Map-Notify messages to a small fraction (e.g., less than 10%) of its
      overall processing and forwarding capacity. The exact details to
      characterize such policies are deployment and implementation specific.
      Likewise, this document does not specify which notifications take
      precedence when these policies are enforced.<a class="pilcrow" href="#section-5-8">¶</a></p>
<p id="section-5-9">When the xTR receives a Map-Notify with a nonce that matches one in
      the list of outstanding Map-Request messages sent with an N-bit set, it
      knows that the Map-Notify is to acknowledge a successful
      subscription. The xTR processes this Map-Notify, as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> and
      <span class="bcp14">MUST</span> use the Map-Notify to populate its Map-Cache with
      the returned EID-Prefix and RLOC-set. As a reminder, following <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>, the xTR has to send
      a Map-Notify-Ack back to the Map-Server. If the Map-Server does not
      receive the Map-Notify-Ack after exhausting the Map-Notify
      retransmissions described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>, the Map-Server can remove the subscription state. If
      the Map-Server removes the subscription state, and absent explicit
      policy, it <span class="bcp14">SHOULD</span> notify the xTR by sending a single
      Map-Notify with the same nonce but with Loc-Count = 0 (and Loc-AFI = 0)
      and ACT bits set to 5 "Drop/Auth-Failure". It is <span class="bcp14">OPTIONAL</span>
      for the xTR to update its Map-Cache entry for the EID-Prefix (if any)
      based on this Map-Notify. This message is specifically useful for cases
      where Map-Notifies are successfully received by an xTR, but the
      corresponding Map-Notify-Acks are lost when forwarded to the
      Map-Server. xTR implementations can use this signal to try to reinstall
      their subscription state instead of maintaining stale mappings.<a class="pilcrow" href="#section-5-9">¶</a></p>
<p id="section-5-10">The subscription of an xTR-ID may fail for a number of reasons. For
      example, it fails because of local configuration policies (such as
      accept and drop lists of subscribers), because the Map-Server has
      exhausted the resources to dedicate to the subscription of that
      EID-Prefix (e.g., the number of subscribers excess the capacity of the
      Map-Server), or because the xTR was not successful tried but was not successful in
      establishing a new security association (<a class="auto internal xref" href="#association">Section 7.1</a>).<a class="pilcrow" href="#section-5-10">¶</a></p>
<p id="section-5-11">If the subscription request fails, the Map-Server sends a Map-Reply
      to the originator of the Map-Request, as described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.3">Section 8.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>, with the following
      considerations:<a class="pilcrow" href="#section-5-11">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-12.1">If the subscription request fails due to policy (e.g., for
        explicitly configured subscriptions, as described later in this
        section), the Map-Server <span class="bcp14">MUST</span> respond to the Map-Request
        with a Negative Map-Reply (Loc-Count = 0 and Loc-AFI = 0) with ACT
        bits set to 4 "Drop/Policy-Denied".<a class="pilcrow" href="#section-5-12.1">¶</a>
</li>
        <li class="normal" id="section-5-12.2">If the subscription request fails due to authentication (e.g., when
        a new security association is being established, as described in
        <a class="auto internal xref" href="#association">Section 7.1</a>), the Map-Server
        <span class="bcp14">MUST</span> respond to the Map-Request with a Negative
        Map-Reply (Loc-Count = 0 and Loc-AFI = 0) with ACT bits set to 5
        "Drop/Auth-Failure".<a class="pilcrow" href="#section-5-12.2">¶</a>
</li>
        <li class="normal" id="section-5-12.3">If the subscription request fails due to any other reason, the
        Map-Server <span class="bcp14">MUST</span> follow <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.3">Section 8.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> with no changes.<a class="pilcrow" href="#section-5-12.3">¶</a>
</li>
      </ul>
<p id="section-5-13">The xTR processes any Map-Reply or Negative Map-Reply as specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.1">Section 8.1</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>, with the following
      considerations: if the xTR receives a Negative Map-Reply with ACT bits
      set to 4 "Drop/Policy-Denied" or 5 "Drop/Auth-Failure" as a response to
      a subscription request, it is <span class="bcp14">OPTIONAL</span> for the xTR to
      update its Map-Cache entry for the EID-Prefix (if any). If the subscription request fails (for whichever
      reason), it is up to the implementation of the xTR to try to subscribe
      again.<a class="pilcrow" href="#section-5-13">¶</a></p>
<p id="section-5-14">If the Map-Server receives a subscription request for an EID-Prefix
      not present in the mapping database, it <span class="bcp14">SHOULD</span> follow the
      same logic described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.4">Section 8.4</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> and create a temporary subscription state for the xTR-ID
      to the least specific prefix that both matches the original query and
      does not match any EID-Prefix known to exist in the LISP-capable
      infrastructure. Alternatively, the Map-Server can determine that
      such a subscription request fails and send a Negative Map-Reply
      following <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.3">Section 8.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>. In
      both cases, the TTL of the temporary subscription state or the Negative
      Map-Reply <span class="bcp14">SHOULD</span> be configurable, with a value of
      15 minutes being <span class="bcp14">RECOMMENDED</span>.<a class="pilcrow" href="#section-5-14">¶</a></p>
<p id="section-5-15">The subscription state can also be created explicitly by
      configuration at the Map-Server (possible when a pre-shared security
      association exists, see <a class="auto internal xref" href="#security">Section 7</a>)
      using a variety of means that are outside the scope of this document. 
  If there is no nonce that can be
  used for the explicit subscription state at the time the explicit
  subscription is configured (e.g., from a different subscription
  already established with the same xTR when a single nonce is kept per
  xTR-ID), then both the xTR and Map-Server <span class="bcp14">MUST</span> be configured with the initial nonce.
      <span class="bcp14">RECOMMENDED</span> to have a configuration option to enable (or
      disable) the xTR to accept publication information for EID-Prefixes that
      the xTR did not explicitly subscribe to. By default, the xTR is allowed
      to modify explicitly configured subscription state following the
      procedures described in this section; however, this <span class="bcp14">MAY</span> be
      disabled at the Map-Server via configuration. If the Map-Server is
      instructed to not allow xTRs to modify explicitly configured
      subscriptions, and an xTR tries to do so, this triggers a Negative
      Map-Reply with ACT bits set to 4 "Drop/Policy-Denied" as described
      earlier in this section.<a class="pilcrow" href="#section-5-15">¶</a></p>
<p id="section-5-16">The following specifies the procedure to remove a subscription:<a class="pilcrow" href="#section-5-16">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-17.1">If a valid Map-Request with the N-bit set to 1 only has one
 ITR-RLOC with AFI = 0 (i.e., Unknown Address), the Map-Server
 <span class="bcp14">MUST</span> remove the subscription state for that xTR-ID
 (unless this is disabled via configuration, see previous
 paragraph).<a class="pilcrow" href="#section-5-17.1">¶</a>
</li>
        <li class="normal" id="section-5-17.2">If the subscription state is removed, the Map-Server
 <span class="bcp14">MUST</span> send a Map-Notify to the source RLOC of the
 Map-Request.<a class="pilcrow" href="#section-5-17.2">¶</a>
</li>
        <li class="normal" id="section-5-17.3">
          <p id="section-5-17.3.1">If the subscription removal fails due to configuration, this
 triggers a Negative Map-Reply with ACT bits set to 4
 "Drop/Policy-Denied" as described earlier in this section; the
 Map-Server sends the Negative Map-Reply to the source RLOC of the
 Map-Request in this case.<a class="pilcrow" href="#section-5-17.3.1">¶</a></p>
</li>
        <li class="normal" id="section-5-17.4">
          <p id="section-5-17.4.1">Removing subscription state at the Map-Server can lead to replay
 attacks. To soften this, the Map-Server <span class="bcp14">SHOULD</span> keep the
 last nonce seen per xTR-ID (and EID-Prefix, when applicable).<a class="pilcrow" href="#section-5-17.4.1">¶</a></p>
</li>
        <li class="normal" id="section-5-17.5">If the Map-Server does not keep the last nonces seen, then the
 Map-Server <span class="bcp14">MUST</span> require the xTRs to subscribe using the
 procedure described in <a class="auto internal xref" href="#association">Section 7.1</a>
 to create a new security association with the Map-Server.<a class="pilcrow" href="#section-5-17.5">¶</a>
</li>
      </ul>
<p id="section-5-18">
If the Map-Server receives a Map-Request asking to remove a
                subscription for an EID-Prefix without subscription state for that
                xTR-ID and the EID-Prefix is covered by a less-specific EID-Prefix for which
                subscription state exists for the xTR-ID, the Map-Server <span class="bcp14">SHOULD</span> stop
                publishing updates about this more-specific EID-Prefix to that xTR
                until the xTR subscribes to the more-specific EID-Prefix. The same
      considerations regarding authentication, integrity protection, and nonce
      checks, which are described in this section and <a class="auto internal xref" href="#security">Section 7</a> for Map-Requests used to update subscription state,
      apply for Map-Requests used to remove subscription state.<a class="pilcrow" href="#section-5-18">¶</a></p>
<p id="section-5-19">When an EID-Prefix is removed from the Map-Server (either when
      explicitly withdrawn or when its TTL expires), the Map-Server notifies
      its subscribers (if any) via a Map-Notify with TTL equal to 0.<a class="pilcrow" href="#section-5-19">¶</a></p>
</section>
</div>
<div id="publish">
<section id="section-6">
      <h2 id="name-mapping-notification-publis">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-mapping-notification-publis">Mapping Notification Publish Procedures</a>
      </h2>
<p id="section-6-1">The publish procedure is implemented via Map-Notify messages that the
      Map-Server sends to xTRs. The xTRs acknowledge the receipt of
      Map-Notifies by sending Map-Notify-Ack messages back to the
      Map-Server. The complete mechanism works as follows:<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2"> When a mapping stored in a Map-Server is updated (e.g., via a
      Map-Register from an ETR), the Map-Server <span class="bcp14">MUST</span> notify the
      subscribers of that mapping via sending Map-Notify messages with the
      most up to date mapping information. If subscription state in the
      Map-Server exists for a less-specific EID-Prefix and a more-specific
      EID-Prefix is updated, then the Map-Notify is sent with the
      more-specific EID-Prefix mapping to the subscribers of the less-specific
      EID-Prefix mapping. The Map-Notify message sent to each of the
      subscribers as a result of an update event follows the encoding and
      logic defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> for Map-Notify, except for the following:<a class="pilcrow" href="#section-6-2">¶</a></p>
<ol class="normal type-1" id="section-6-3" start="1" type="1">
 <li id="section-6-3.1">The Map-Notify <span class="bcp14">MUST</span> be sent to one of the ITR-RLOCs
 associated with the xTR-ID of the subscriber (which one is
 implementation specific).<a class="pilcrow" href="#section-6-3.1">¶</a>
</li>
        <li id="section-6-3.2">The Map-Server increments the nonce by one every time it sends a
        Map-Notify as publication to an xTR-ID for a particular
        EID-Prefix.<a class="pilcrow" href="#section-6-3.2">¶</a>
</li>
        <li id="section-6-3.3">The Map-Server <span class="bcp14">MUST</span> use its security association
        with the xTR to compute the authentication data of the
        Map-Notify.<a class="pilcrow" href="#section-6-3.3">¶</a>
</li>
      </ol>
<p id="section-6-4">When the xTR receives a Map-Notify with an EID that is not local  to the xTR, the xTR knows that the Map-Notify is to update an entry on its Map-Cache.
The xTR <span class="bcp14">MUST</span> keep track of the last
      nonce seen in a Map-Notify received as a publication from the Map-Server
      for the EID-Prefix. When the LISP deployment has a single Map-Server,
      the xTR can be configured to keep track of a single nonce for all
      EID-Prefixes (when used, this option <span class="bcp14">MUST</span> be enabled at
      the Map-Server and all xTRs). If a Map-Notify that is received as a
      publication has a nonce value that is not greater than the saved nonce,
      the xTR drops the Map-Notify message and logs the fact a replay attack
      could have occurred. The same considerations discussed in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.6">Section 5.6</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> regarding
      Map-Register nonces apply here for Map-Notify nonces.<a class="pilcrow" href="#section-6-4">¶</a></p>
<p id="section-6-5">The xTR processes the received Map-Notify as specified in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>, with the following
      considerations:<a class="pilcrow" href="#section-6-5">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-6.1">The xTR <span class="bcp14">MUST</span> use its security association with the
 Map-Server (<a class="auto internal xref" href="#association">Section 7.1</a>) to validate
 the authentication data on the Map-Notify.<a class="pilcrow" href="#section-6-6.1">¶</a>
</li>
        <li class="normal" id="section-6-6.2">The xTR <span class="bcp14">MUST</span> use the mapping information carried
 in the Map-Notify to update its internal Map-Cache.<a class="pilcrow" href="#section-6-6.2">¶</a>
</li>
        <li class="normal" id="section-6-6.3">If after following <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> regarding retransmission of Map-Notify messages, the
 Map-Server has not received the Map-Notify-Ack, it can try 
 sending the Map-Notify to a different ITR-RLOC for that xTR-ID.<a class="pilcrow" href="#section-6-6.3">¶</a>
</li>
        <li class="normal" id="section-6-6.4">If the Map-Server tries all the ITR-RLOCs without receiving a
 response, it may stop trying to send the
 Map-Notify.<a class="pilcrow" href="#section-6-6.4">¶</a>
</li>
      </ul>
</section>
</div>
<div id="security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-7-1">Generic security considerations related to LISP control messages are
      discussed in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-9">Section 9</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>.<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2">In the particular case of PubSub, cache poisoning via malicious
      Map-Notify messages is avoided by the use of nonce and the security
      association between the ITRs and the Map-Servers.<a class="pilcrow" href="#section-7-2">¶</a></p>
<p id="section-7-3">It is <span class="bcp14">RECOMMENDED</span> to follow guidance from the last
      paragraph of <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-9">Section 9</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> to
      ensure integrity protection of Map-Request messages (e.g., to prevent
      xTR-ID hijacking).<a class="pilcrow" href="#section-7-3">¶</a></p>
<div id="association">
<section id="section-7.1">
        <h3 id="name-security-association-betwee">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-security-association-betwee">Security Association between ITR and Map-Server</a>
        </h3>
<p id="section-7.1-1">Since Map-Notifies from the Map-Server to the ITR need to be
        authenticated, there is a need for a soft-state or hard-state security
        association (e.g., a PubSubKey) between the ITRs and the
        Map-Servers. For some controlled deployments, it might be possible to
        have a shared PubSubKey (or set of keys) between the ITRs and the
        Map-Servers. However, if pre-shared keys are not used in the
        deployment, LISP Security (LISP-SEC) <span>[<a class="cite xref" href="#RFC9303">RFC9303</a>]</span> can be used as follows to create a
        security association between the ITR and the Map-Server.<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<p id="section-7.1-2">First, when the ITR is sending a Map-Request with the N-bit set
        as described in <a class="auto internal xref" href="#sub">Section 5</a>, the ITR also performs
        the steps described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9303#section-6.4">Section 6.4</a> of [<a class="cite xref" href="#RFC9303">RFC9303</a>]</span>. The ITR can then generate a PubSubKey by deriving a
        key from the One-Time Key (OTK) and Map-Request's nonce as follows:
        PubSubKey = KDF(OTK + nonce), where KDF is the Key Derivation Function
        indicated by the OTK Wrapping ID. If the OTK Wrapping ID equals
        NULL-KEY-WRAP-128, then the PubSubKey is the OTK. Note that, as opposed
        to the pre-shared PubSubKey, this generated PubSubKey is different per
        EID-Prefix to which an ITR subscribes (since the ITR will use a
        different OTK per Map-Request).<a class="pilcrow" href="#section-7.1-2">¶</a></p>
<p id="section-7.1-3">When the Map-Server receives the Map-Request, it follows the
        procedure specified in <a class="auto internal xref" href="#sub">Section 5</a> with the
        following considerations: the Map-Server <span class="bcp14">MUST</span> verify
        that the OTK has not been used before. If the Map-Server verifies the
        OTK and cannot determine that the OTK has not been used before, the
        subscription request fails due to authentication, which triggers a
        Negative Map-Reply with ACT bits set to 5 "Drop/Auth-Failure", as
        described in <a class="auto internal xref" href="#sub">Section 5</a>. The xTR might try
        again with a different OTK upon receipt of this Negative
        Map-Reply. Note that a Map-Server implementation may decide not to keep track
   of all past OTKs and instead use some form of hash. In that case,
        hash collisions are handled as if the OTK has been reused. Such an
        implementation needs to balance the hash length with the rate of
        collisions expected for the particular deployment; this is
        implementation specific. If the Map-Server has to reply with a
        Map-Reply for any other reason (e.g., if PubSub is not supported or a
        subscription is not accepted), then it follows the normal LISP-SEC
        procedure described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9303#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9303">RFC9303</a>]</span>. No PubSubKey, security association, or subscription
        state is created when the Map-Server responds with any Map-Reply
        message.<a class="pilcrow" href="#section-7.1-3">¶</a></p>
<p id="section-7.1-4">Otherwise, if the Map-Server has to reply with a Map-Notify (e.g.,
        due to the subscription being accepted) to a received Map-Request, the
        following extra steps take place:<a class="pilcrow" href="#section-7.1-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-5.1">The Map-Server extracts the OTK and the OTK Wrapping ID from the
          LISP-SEC Encapsulated Control Message (ECM) Authentication Data.<a class="pilcrow" href="#section-7.1-5.1">¶</a>
</li>
          <li class="normal" id="section-7.1-5.2">The Map-Server generates a PubSubKey by deriving a key from the
          OTK, as described before for the ITR. This is the same PubSubKey
          derived at the ITR that is used to establish a security association
          between the ITR and the Map-Server.<a class="pilcrow" href="#section-7.1-5.2">¶</a>
</li>
          <li class="normal" id="section-7.1-5.3">The PubSubKey can now be used to sign and authenticate any
          Map-Notify between the Map-Server and the ITR for the subscribed
          EID-Prefix. This includes the Map-Notify sent as a confirmation to
          the subscription. When the ITR wants to update the security
          association for that Map-Server and EID-Prefix, it once again
          follows the procedure described in this section.<a class="pilcrow" href="#section-7.1-5.3">¶</a>
</li>
        </ul>
<p id="section-7.1-6">Note that if the Map-Server replies with a Map-Notify, none of the
        regular LISP-SEC steps regarding Map-Reply described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9303#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9303">RFC9303</a>]</span> occur.<a class="pilcrow" href="#section-7.1-6">¶</a></p>
</section>
</div>
<div id="ddos">
<section id="section-7.2">
        <h3 id="name-ddos-attack-mitigation">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-ddos-attack-mitigation">DDoS Attack Mitigation</a>
        </h3>
<p id="section-7.2-1">If PubSub is deployed under the scope of applicability defined in
        <a class="auto internal xref" href="#app-scope">Section 1.1</a>, only known nodes can
        participate on the PubSub deployment. DDoS attacks based on replayed
        messages by unknown nodes are avoided by the use of nonce and the
        security association between the ITRs and the Map-Servers. Misbehaving
        known nodes may send massive subscription requests, which may lead to
        exhausting the resources of a Map-Server. Furthermore, frequently
        changing the state of a subscription may also be considered as an
        attack vector. To mitigate such issues, <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> discusses rate-limiting
        Map-Requests, and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-5.7">Section 5.7</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> discusses rate-limiting Map-Notifies. Note that when
        the Map-Notify rate-limit threshold is met for a particular xTR-ID,
        the Map-Server will discard additional subscription requests from that
        xTR-ID and will fall back to the behavior described in <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> when receiving a Map-Request from
        that xTR-ID (i.e., the Map-Server will send a Map-Reply).<a class="pilcrow" href="#section-7.2-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-8-1">IANA has assigned the following new bit from the 
"LISP Control Plane Header Bits: Map-Request" registry within the
      "Locator/ID Separation Protocol (LISP) Parameters" group of registries <span>[<a class="cite xref" href="#IANA-LISP">IANA-LISP</a>]</span>:<a class="pilcrow" href="#section-8-1">¶</a></p>
<span id="name-addition-to-the-map-request"></span><table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-addition-to-the-map-request">Addition to the Map-Request Header Bits Registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Spec Name</th>
            <th class="text-left" colspan="1" rowspan="1">IANA Name</th>
            <th class="text-left" colspan="1" rowspan="1">Bit Position</th>
            <th class="text-left" colspan="1" rowspan="1">Description</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">I</td>
            <td class="text-left" colspan="1" rowspan="1">Map-Request-I</td>
            <td class="text-left" colspan="1" rowspan="1">11</td>
            <td class="text-left" colspan="1" rowspan="1">xTR-ID Bit</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9437</td>
          </tr>
        </tbody>
      </table>
<p id="section-8-3">IANA has also created a new registry
      entitled "LISP Control Plane Header Bits: Map-Request-Record" within the
      "Locator/ID Separation Protocol (LISP) Parameters" group of registries <span>[<a class="cite xref" href="#IANA-LISP">IANA-LISP</a>]</span>.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4">The initial content of this registry is shown in <a class="auto internal xref" href="#bits-table">Table 2</a>.<a class="pilcrow" href="#section-8-4">¶</a></p>
<span id="name-initial-content-of-lisp-con"></span><div id="bits-table">
<table class="center" id="table-2">
        <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-initial-content-of-lisp-con">Initial Content of LISP Control Plane Header Bits: Map‑Request-Record Registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" colspan="1" rowspan="1">Spec Name</th>
            <th class="text-left" colspan="1" rowspan="1">IANA Name</th>
            <th class="text-left" colspan="1" rowspan="1">Bit Position</th>
            <th class="text-left" colspan="1" rowspan="1">Description</th>
            <th class="text-left" colspan="1" rowspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" colspan="1" rowspan="1">N</td>
            <td class="text-left" colspan="1" rowspan="1">Map-Request-N</td>
            <td class="text-left" colspan="1" rowspan="1">1</td>
            <td class="text-left" colspan="1" rowspan="1">Notification-Requested Bit</td>
            <td class="text-left" colspan="1" rowspan="1">RFC 9437</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-8-6">The remaining bits (i.e., bit positions 2-8) are Unassigned.<a class="pilcrow" href="#section-8-6">¶</a></p>
<p id="section-8-7">The policy for allocating new bits in this registry is
      "Specification Required" (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc8126#section-4.6">Section 4.6</a> of [<a class="cite xref" href="#RFC8126">RFC8126</a>]</span>).<a class="pilcrow" href="#section-8-7">¶</a></p>
<p id="section-8-8">Allocation requests are evaluated on the advice of one or more designated
      experts. 
   Designated experts should consider whether the proposed registration duplicates
   existing entries and whether the registration description is
   sufficiently detailed and fits the purpose of this registry.  These
   criteria are to be considered in addition to those provided in
   <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8126#section-4.6">Section 4.6</a> of [<a class="cite xref" href="#RFC8126">RFC8126</a>]</span> (e.g., the proposed registration "must be
   documented in a permanent and readily available public
   specification"). The designated experts will either approve or
      deny the registration request, and communicate their decision to
      IANA. Denials should include an explanation and, if applicable,
      suggestions as to how to make the request successful.<a class="pilcrow" href="#section-8-8">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time class="refDate" datetime="2017-06">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9300">[RFC9300]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Fuller, V.</span>, <span class="refAuthor">Meyer, D.</span>, <span class="refAuthor">Lewis, D.</span>, and <span class="refAuthor">A. Cabellos, Ed.</span>, <span class="refTitle">"The Locator/ID Separation Protocol (LISP)"</span>, <span class="seriesInfo">RFC 9300</span>, <span class="seriesInfo">DOI 10.17487/RFC9300</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9300">https://www.rfc-editor.org/info/rfc9300</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9301">[RFC9301]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Maino, F.</span>, <span class="refAuthor">Fuller, V.</span>, and <span class="refAuthor">A. Cabellos, Ed.</span>, <span class="refTitle">"Locator/ID Separation Protocol (LISP) Control Plane"</span>, <span class="seriesInfo">RFC 9301</span>, <span class="seriesInfo">DOI 10.17487/RFC9301</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9301">https://www.rfc-editor.org/info/rfc9301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9303">[RFC9303]</dt>
      <dd>
<span class="refAuthor">Maino, F.</span>, <span class="refAuthor">Ermagan, V.</span>, <span class="refAuthor">Cabellos, A.</span>, and <span class="refAuthor">D. Saucez</span>, <span class="refTitle">"Locator/ID Separation Protocol Security (LISP-SEC)"</span>, <span class="seriesInfo">RFC 9303</span>, <span class="seriesInfo">DOI 10.17487/RFC9303</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9303">https://www.rfc-editor.org/info/rfc9303</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-lisp-eid-mobility">[EID-MOBILITY]</dt>
        <dd>
<span class="refAuthor">Portoles, M.</span>, <span class="refAuthor">Ashtaputre, V.</span>, <span class="refAuthor">Maino, F.</span>, <span class="refAuthor">Moreno, V.</span>, and <span class="refAuthor">D. Farinacci</span>, <span class="refTitle">"LISP L2/L3 EID Mobility Using a Unified Control Plane"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lisp-eid-mobility-12</span>, <time class="refDate" datetime="2023-07-04">4 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lisp-eid-mobility-12">https://datatracker.ietf.org/doc/html/draft-ietf-lisp-eid-mobility-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.boucadair-lisp-pubsub-flow-examples">[FLOW-EXAMPLES]</dt>
        <dd>
<span class="refAuthor">Boucadair, M.</span>, <span class="refTitle">"LISP PubSub Flow Examples"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-boucadair-lisp-pubsub-flow-examples-03</span>, <time class="refDate" datetime="2023-02-10">10 February 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-boucadair-lisp-pubsub-flow-examples-03">https://datatracker.ietf.org/doc/html/draft-boucadair-lisp-pubsub-flow-examples-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.haindl-lisp-gb-atn">[GB-ATN]</dt>
        <dd>
<span class="refAuthor">Haindl, B.</span>, <span class="refAuthor">Lindner, M.</span>, <span class="refAuthor">Moreno, V.</span>, <span class="refAuthor">Portoles, M.</span>, <span class="refAuthor">Maino, F.</span>, and <span class="refAuthor">B. Venkatachalapathy</span>, <span class="refTitle">"Ground-Based LISP for the Aeronautical Telecommunications Network"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-haindl-lisp-gb-atn-09</span>, <time class="refDate" datetime="2023-03-27">27 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-haindl-lisp-gb-atn-09">https://datatracker.ietf.org/doc/html/draft-haindl-lisp-gb-atn-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-LISP">[IANA-LISP]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Locator/ID Separation Protocol (LISP) Parameters"</span>, <span>&lt;<a href="https://www.iana.org/assignments/lisp-parameters/">https://www.iana.org/assignments/lisp-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lisp-yang">[LISP-YANG]</dt>
        <dd>
<span class="refAuthor">Ermagan, V.</span>, <span class="refAuthor">Rodriguez-Natal, A.</span>, <span class="refAuthor">Coras, F.</span>, <span class="refAuthor">Moberg, C.</span>, <span class="refAuthor">Rahman, R.</span>, <span class="refAuthor">Cabellos, A.</span>, and <span class="refAuthor">F. Maino</span>, <span class="refTitle">"LISP YANG Model"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lisp-yang-19</span>, <time class="refDate" datetime="2023-03-02">2 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lisp-yang-19">https://datatracker.ietf.org/doc/html/draft-ietf-lisp-yang-19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6835">[RFC6835]</dt>
        <dd>
<span class="refAuthor">Farinacci, D.</span> and <span class="refAuthor">D. Meyer</span>, <span class="refTitle">"The Locator/ID Separation Protocol Internet Groper (LIG)"</span>, <span class="seriesInfo">RFC 6835</span>, <span class="seriesInfo">DOI 10.17487/RFC6835</span>, <time class="refDate" datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6835">https://www.rfc-editor.org/info/rfc6835</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.moreno-lisp-uberlay">[UBERLAY]</dt>
      <dd>
<span class="refAuthor">Moreno, V.</span>, <span class="refAuthor">Farinacci, D.</span>, <span class="refAuthor">Rodriguez-Natal, A.</span>, <span class="refAuthor">Portoles-Comeras, M.</span>, <span class="refAuthor">Maino, F.</span>, and <span class="refAuthor">S. Hooda</span>, <span class="refTitle">"Uberlay Interconnection of Multiple LISP overlays"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-moreno-lisp-uberlay-06</span>, <time class="refDate" datetime="2022-09-28">28 September 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-moreno-lisp-uberlay-06">https://datatracker.ietf.org/doc/html/draft-moreno-lisp-uberlay-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="deployment">
<section id="appendix-A">
      <h2 id="name-sample-pubsub-deployment-ex">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-sample-pubsub-deployment-ex">Sample PubSub Deployment Experiences</a>
      </h2>
<p id="appendix-A-1">Some LISP production networks have been running different forms of PubSub for some time. The following subsections provide an inventory of some experience lessons from these deployments.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<div id="deploy-monitoring">
<section id="appendix-A.1">
        <h3 id="name-pubsub-as-a-monitoring-tool">
<a class="section-number selfRef" href="#appendix-A.1">A.1. </a><a class="section-name selfRef" href="#name-pubsub-as-a-monitoring-tool">PubSub as a Monitoring Tool</a>
        </h3>
<p id="appendix-A.1-1">Some LISP deployments are using PubSub as a way to monitor
        EID-Prefixes (particularly, EID-to-RLOC mappings). To that aim, some
        LISP implementations have extended the LISP Internet Groper ('lig')
        <span>[<a class="cite xref" href="#RFC6835">RFC6835</a>]</span> tool to use PubSub. Such an
        extension is meant to support an interactive mode with 'lig' and to
        request subscription for the EID of interest. If there are RLOC
        changes, the Map-Server sends a notification, and then the 'lig' client
        displays that change to the user.<a class="pilcrow" href="#appendix-A.1-1">¶</a></p>
</section>
</div>
<div id="deploy-nmr">
<section id="appendix-A.2">
        <h3 id="name-mitigating-negative-map-cac">
<a class="section-number selfRef" href="#appendix-A.2">A.2. </a><a class="section-name selfRef" href="#name-mitigating-negative-map-cac">Mitigating Negative Map-Cache Entries</a>
        </h3>
<p id="appendix-A.2-1"><span><a class="relref" href="https://rfc-editor.org/rfc/rfc9301#section-8.1">Section 8.1</a> of [<a class="cite xref" href="#RFC9301">RFC9301</a>]</span> suggests
        two TTL values for Negative Map-Replies: either a 15-minute TTL (if
        the EID-Prefix does not exist) or a 1-minute TTL (if the prefix exists
        but has not been registered). While these values are based on the
        original operational experience of the LISP protocol designers,
        negative cache entries have two unintended effects that were observed
        in production.<a class="pilcrow" href="#appendix-A.2-1">¶</a></p>
<p id="appendix-A.2-2">First, if the xTR keeps receiving traffic for a negative EID
        destination (i.e., an EID-Prefix with no RLOCs associated with it), it
        will try to resolve the destination again once the cached state
        expires, even if the state has not changed in the Map-Server. It was
        observed in production that this is happening often in networks that
        have a significant amount of traffic addressed for outside of the LISP
        network. This might result in excessive resolution signaling to keep
        retrieving the same state due to the cache expiring. PubSub is used to
        relax TTL values and cache negative mapping entries for longer periods
        of time, avoiding unnecessary refreshes of these forwarding entries
        and drastically reducing signaling in these scenarios. In general, a
        TTL-based schema is a "polling mechanism" that leads to more signaling
        where PubSub provides an "event-triggered mechanism" at the cost of
        state.<a class="pilcrow" href="#appendix-A.2-2">¶</a></p>
<p id="appendix-A.2-3">Second, if the state does indeed change in the Map-Server, updates
        based on TTL timeouts might prevent the cached state at the xTR from
        being updated until the TTL expires. This behavior was observed during
        configuration (or reconfiguration) periods on the network, where
        EID-Prefixes that are no longer negative do not receive the traffic
        yet, due to stale Map-Cache entries present in the network. With the
        activation of PubSub, stale caches can be updated as soon as the state
        changes.<a class="pilcrow" href="#appendix-A.2-3">¶</a></p>
</section>
</div>
<div id="deploy-mobility">
<section id="appendix-A.3">
        <h3 id="name-improved-mobility-latency">
<a class="section-number selfRef" href="#appendix-A.3">A.3. </a><a class="section-name selfRef" href="#name-improved-mobility-latency">Improved Mobility Latency</a>
        </h3>
<p id="appendix-A.3-1">An improved convergence time was observed on the presence of
        mobility events on LISP networks running PubSub as compared with
        running LISP <span>[<a class="cite xref" href="#RFC9301">RFC9301</a>]</span>. As described
        in Section 4.1.2.1 of <span>[<a class="cite xref" href="#I-D.ietf-lisp-eid-mobility">EID-MOBILITY</a>]</span>, LISP can rely on data-driven Solicit-Map-Requests
        (SMRs) to ensure eventual network convergence. Generally, PubSub offers
        faster convergence due to (1) no need to wait for a data-triggered
        event and (2) less signaling as compared with the SMR-based flow. Note
        that when a Map-Server running PubSub has to update a large number of
        subscribers at once (i.e., when a popular mapping is updated),
        SMR-based convergence may be faster for a small subset of the
        subscribers (those receiving PubSub updates last). Deployment
        experience reveals that data-driven SMRs and PubSub mechanisms
        complement each other and provide a fast and resilient network
        infrastructure in the presence of mobility events.<a class="pilcrow" href="#appendix-A.3-1">¶</a></p>
<p id="appendix-A.3-2">Furthermore, experience showed that not all LISP entities on the
        network need to implement PubSub for the network to get the
        benefits. In scenarios with significant traffic coming from outside of
        the LISP network, the experience showed that enabling PubSub in the
        border routers significantly improves mobility latency overall. Even
        if edge xTRs do not implement PubSub, and traffic is exchanged between
        EID-Prefixes at the edge, xTRs still converge based on data-driven
        events and SMR-triggered updates.<a class="pilcrow" href="#appendix-A.3-2">¶</a></p>
</section>
</div>
<div id="deploy-redistribution">
<section id="appendix-A.4">
        <h3 id="name-enhanced-reachability-with-">
<a class="section-number selfRef" href="#appendix-A.4">A.4. </a><a class="section-name selfRef" href="#name-enhanced-reachability-with-">Enhanced Reachability with Dynamic Redistribution of
        Prefixes</a>
        </h3>
<p id="appendix-A.4-1">There is a need to interconnect LISP networks with other networks
        that might or might not run LISP. Some of those scenarios are similar
        to the ones described in <span>[<a class="cite xref" href="#I-D.haindl-lisp-gb-atn">GB-ATN</a>]</span> and <span>[<a class="cite xref" href="#I-D.moreno-lisp-uberlay">UBERLAY</a>]</span>. When connecting LISP to other networks, the
        experience revealed that in many deployments the point of interaction
        with the other domains is not the Mapping System but rather the border
        router of the LISP site. For those cases, the border router needs to be
        aware of the LISP prefixes to redistribute them to the other
        networks. Over the years, different solutions have been used.<a class="pilcrow" href="#appendix-A.4-1">¶</a></p>
<p id="appendix-A.4-2">First, Map-Servers were collocated with the border routers, but
        this was hard to scale since border routers scale at a different pace
        than Map-Servers. Second, decoupled Map-Servers and border routers
        were used with static configuration of LISP entries on the border,
        which was problematic when modifications were made. Third, a routing
        protocol (e.g., BGP) can be used to redistribute LISP prefixes from
        the Map-Servers to a border router, but this comes with some
        implications; in particular, the Map-Servers need to implement an
        additional protocol, which consumes resources and needs to be properly
        configured. Therefore, once PubSub was available, deployments started
        to adapt it to enable border routers to dynamically learn the prefixes
        they need to redistribute without a need for extra protocols or extra
        configuration on the network.<a class="pilcrow" href="#appendix-A.4-2">¶</a></p>
<p id="appendix-A.4-3">In other words, PubSub can be used to discover EID-Prefixes so they
        can be imported into other routing domains that do not use
        LISP. Similarly, PubSub can also be used to discover when EID-Prefixes
        need to be withdrawn from other routing domains. That is, in a typical
        deployment, a border router will withdraw an EID-Prefix that it has
        been announcing to external routing domains if it receives a
        notification that the RLOC-set for that EID-Prefix is now empty.<a class="pilcrow" href="#appendix-A.4-3">¶</a></p>
</section>
</div>
<div id="deploy-service">
<section id="appendix-A.5">
        <h3 id="name-better-serviceability">
<a class="section-number selfRef" href="#appendix-A.5">A.5. </a><a class="section-name selfRef" href="#name-better-serviceability">Better Serviceability</a>
        </h3>
<p id="appendix-A.5-1">EID-to-RLOC mappings can have a very long TTL, sometimes on the order
        of several hours. Upon the expiry of that TTL, the xTR checks if these
        entries are being used and removes any entry that is not being
        used. The problem with a very long Map-Cache TTL is that (in the
   absence of PubSub) if a mapping changes but is not being used,
   the cache remains but is stale. This is due to no data traffic being sent to
        the old location to trigger an SMR-based Map-Cache update as described
        in Section 4.1.2.1 of <span>[<a class="cite xref" href="#I-D.ietf-lisp-eid-mobility">EID-MOBILITY</a>]</span>. If the network operator runs a show command on a
        router to track the state of the Map-Cache, the router will display
        multiple entries waiting to expire but with stale RLOC
        information. This might be confusing for operators sometimes,
        particularly when they are debugging problems. With PubSub, the
        Map-Cache is updated with the correct RLOC information, even when it
        is not being used or waiting to expire, which helps with
        debugging.<a class="pilcrow" href="#appendix-A.5-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Acknowledgments">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-B-1"> We would like to thank <span class="contact-name">Marc Portoles</span>, <span class="contact-name">Balaji Venkatachalapathy</span>, <span class="contact-name">Bernhard       Haindl</span>, <span class="contact-name">Luigi Iannone</span>, and <span class="contact-name">Padma Pillay-Esnault</span> for their great suggestions and help
      regarding this document.<a class="pilcrow" href="#appendix-B-1">¶</a></p>
<p id="appendix-B-2"> Many thanks to <span class="contact-name">Alvaro Retana</span> for the careful
      AD review.<a class="pilcrow" href="#appendix-B-2">¶</a></p>
<p id="appendix-B-3">Thanks to <span class="contact-name">Chris M. Lonvick</span> for the security
      directorate review, <span class="contact-name">Al Morton</span> for the OPS-DIR
      review, <span class="contact-name">Roni Even</span> for the Gen-ART review, <span class="contact-name">Mike McBride</span> for the rtg-dir review, <span class="contact-name">Magnus Westerlund</span> for the tsv directorate review, and
      <span class="contact-name">Sheng Jiang</span> for the int-dir review.<a class="pilcrow" href="#appendix-B-3">¶</a></p>
<p id="appendix-B-4"> Thanks to <span class="contact-name">John Scudder</span>, <span class="contact-name">Erik Kline</span>, <span class="contact-name">Lars Eggert</span>, <span class="contact-name">Warren Kumari</span>, <span class="contact-name">Martin Duke</span>, <span class="contact-name">Murray Kucherawy</span>, <span class="contact-name">Éric Vyncke</span>,
      <span class="contact-name">Robert Wilton</span>, <span class="contact-name">Zaheduzzaman       Sarker</span>, and <span class="contact-name">Roman Danyliw</span> for the IESG
      review.<a class="pilcrow" href="#appendix-B-4">¶</a></p>
<p id="appendix-B-5"> This work was partly funded by the ANR LISP-Lab project
      #ANR-13-INFR-009 <span>&lt;<a href="https://anr.fr/Projet-ANR-13-INFR-0009">https://anr.fr/Projet-ANR-13-INFR-0009</a>&gt;</span>.<a class="pilcrow" href="#appendix-B-5">¶</a></p>
</section>
</div>
<section id="appendix-C">
      <h2 id="name-contributors">
<a class="section-name selfRef" href="#name-contributors">Contributors</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Dino Farinacci</span></div>
<div class="left" dir="auto"><span class="org">lispers.net</span></div>
<div class="left" dir="auto">
<span class="locality">San Jose</span>, <span class="region">CA</span> </div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:farinacci@gmail.com">farinacci@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Johnson Leong</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:johnsonleong@gmail.com">johnsonleong@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Fabio Maino</span></div>
<div class="left" dir="auto"><span class="org">Cisco</span></div>
<div class="left" dir="auto">
<span class="locality">San Jose</span>, <span class="region">CA</span> </div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:fmaino@cisco.com">fmaino@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Christian Jacquenet</span></div>
<div class="left" dir="auto"><span class="org">Orange</span></div>
<div class="left" dir="auto"><span class="locality">Rennes</span></div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:christian.jacquenet@orange.com">christian.jacquenet@orange.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Stefano Secci</span></div>
<div class="left" dir="auto"><span class="org">Cnam</span></div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:stefano.secci@cnam.fr">stefano.secci@cnam.fr</a>
</div>
</address>
</section>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Alberto Rodriguez-Natal</span></div>
<div class="left" dir="auto"><span class="org">Cisco</span></div>
<div class="left" dir="auto">
<span class="locality">Barcelona</span> </div>
<div class="left" dir="auto"><span class="country-name">Spain</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:natal@cisco.com">natal@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Vina Ermagan</span></div>
<div class="left" dir="auto"><span class="org">Google</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ermagan@gmail.com">ermagan@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Albert Cabellos</span></div>
<div class="left" dir="auto"><span class="org">UPC/BarcelonaTech</span></div>
<div class="left" dir="auto">
<span class="locality">Barcelona</span> </div>
<div class="left" dir="auto"><span class="country-name">Spain</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:acabello@ac.upc.edu">acabello@ac.upc.edu</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Sharon Barkai</span></div>
<div class="left" dir="auto"><span class="org">Nexar</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:sharon.barkai@getnexar.com">sharon.barkai@getnexar.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mohamed Boucadair</span></div>
<div class="left" dir="auto"><span class="org">Orange</span></div>
<div class="left" dir="auto"><span class="locality">Rennes</span></div>
<div class="left" dir="auto"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mohamed.boucadair@orange.com">mohamed.boucadair@orange.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>