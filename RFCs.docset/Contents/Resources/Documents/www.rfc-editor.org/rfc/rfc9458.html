<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9458: Oblivious HTTP</title>
<meta content="Martin Thomson" name="author"/>
<meta content="Christopher A. Wood" name="author"/>
<meta content="
       This document describes Oblivious HTTP, a protocol for forwarding encrypted HTTP messages.
Oblivious HTTP allows a client to make multiple requests to an origin server without that server
being able to link those requests to the client or to identify the requests as having come from the
same client, while placing only limited trust in the nodes used to forward the messages. 
    " name="description"/>
<meta content="xml2rfc 3.19.1" name="generator"/>
<meta content="privacy" name="keyword"/>
<meta content="proxy" name="keyword"/>
<meta content="partitioning" name="keyword"/>
<meta content="tunnel" name="keyword"/>
<meta content="9458" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.19.1
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9458.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-ohai-ohttp-10" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9458" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9458</td>
<td class="center">Oblivious HTTP</td>
<td class="right">January 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Thomson &amp; Wood</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9458">9458</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-01">January 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Thomson</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9458</h1>
<h1 id="title">Oblivious HTTP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document describes Oblivious HTTP, a protocol for forwarding encrypted HTTP messages.
Oblivious HTTP allows a client to make multiple requests to an origin server without that server
being able to link those requests to the client or to identify the requests as having come from the
same client, while placing only limited trust in the nodes used to forward the messages.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9458">https://www.rfc-editor.org/info/rfc9458</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-overview">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p class="keepWithNext" id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-applicability">Applicability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p class="keepWithNext" id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-conventions-and-definitions">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-key-configuration">Key Configuration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-key-configuration-encoding">Key Configuration Encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-key-configuration-media-typ">Key Configuration Media Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-hpke-encapsulation">HPKE Encapsulation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="auto internal xref" href="#section-4.1">4.1</a>.  <a class="internal xref" href="#name-request-format">Request Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="auto internal xref" href="#section-4.2">4.2</a>.  <a class="internal xref" href="#name-response-format">Response Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="auto internal xref" href="#section-4.3">4.3</a>.  <a class="internal xref" href="#name-encapsulation-of-requests">Encapsulation of Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="auto internal xref" href="#section-4.4">4.4</a>.  <a class="internal xref" href="#name-encapsulation-of-responses">Encapsulation of Responses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a class="auto internal xref" href="#section-4.5">4.5</a>.  <a class="internal xref" href="#name-request-and-response-media-">Request and Response Media Types</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a class="auto internal xref" href="#section-4.6">4.6</a>.  <a class="internal xref" href="#name-repurposing-the-encapsulati">Repurposing the Encapsulation Format</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-http-usage">HTTP Usage</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-informational-responses">Informational Responses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-errors">Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a class="auto internal xref" href="#section-5.3">5.3</a>.  <a class="internal xref" href="#name-signaling-key-configuration">Signaling Key Configuration Problems</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-client-responsibilities">Client Responsibilities</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#section-6.2">6.2</a>.  <a class="internal xref" href="#name-relay-responsibilities">Relay Responsibilities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a class="auto internal xref" href="#section-6.2.1">6.2.1</a>.  <a class="internal xref" href="#name-differential-treatment">Differential Treatment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a class="auto internal xref" href="#section-6.2.2">6.2.2</a>.  <a class="internal xref" href="#name-denial-of-service">Denial of Service</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a class="auto internal xref" href="#section-6.2.3">6.2.3</a>.  <a class="internal xref" href="#name-traffic-analysis">Traffic Analysis</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a class="auto internal xref" href="#section-6.3">6.3</a>.  <a class="internal xref" href="#name-server-responsibilities">Server Responsibilities</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a class="auto internal xref" href="#section-6.4">6.4</a>.  <a class="internal xref" href="#name-key-management">Key Management</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a class="auto internal xref" href="#section-6.5">6.5</a>.  <a class="internal xref" href="#name-replay-attacks">Replay Attacks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5.2.1">
                    <p id="section-toc.1-1.6.2.5.2.1.1"><a class="auto internal xref" href="#section-6.5.1">6.5.1</a>.  <a class="internal xref" href="#name-use-of-date-for-anti-replay">Use of Date for Anti-replay</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5.2.2">
                    <p id="section-toc.1-1.6.2.5.2.2.1"><a class="auto internal xref" href="#section-6.5.2">6.5.2</a>.  <a class="internal xref" href="#name-correcting-clock-difference">Correcting Clock Differences</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a class="auto internal xref" href="#section-6.6">6.6</a>.  <a class="internal xref" href="#name-forward-secrecy">Forward Secrecy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a class="auto internal xref" href="#section-6.7">6.7</a>.  <a class="internal xref" href="#name-post-compromise-security">Post-Compromise Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a class="auto internal xref" href="#section-6.8">6.8</a>.  <a class="internal xref" href="#name-client-clock-exposure">Client Clock Exposure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.9">
                <p id="section-toc.1-1.6.2.9.1"><a class="auto internal xref" href="#section-6.9">6.9</a>.  <a class="internal xref" href="#name-media-type-security">Media Type Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.10">
                <p id="section-toc.1-1.6.2.10.1"><a class="auto internal xref" href="#section-6.10">6.10</a>. <a class="internal xref" href="#name-separate-gateway-and-target">Separate Gateway and Target</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-privacy-considerations">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-operational-and-deployment-">Operational and Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a class="auto internal xref" href="#section-8.1">8.1</a>.  <a class="internal xref" href="#name-performance-overhead">Performance Overhead</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a class="auto internal xref" href="#section-8.2">8.2</a>.  <a class="internal xref" href="#name-resource-mappings">Resource Mappings</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a class="auto internal xref" href="#section-8.3">8.3</a>.  <a class="internal xref" href="#name-network-management">Network Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="auto internal xref" href="#section-9.1">9.1</a>.  <a class="internal xref" href="#name-application-ohttp-keys-medi">application/ohttp-keys Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="auto internal xref" href="#section-9.2">9.2</a>.  <a class="internal xref" href="#name-message-ohttp-req-media-typ">message/ohttp-req Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a class="auto internal xref" href="#section-9.3">9.3</a>.  <a class="internal xref" href="#name-message-ohttp-res-media-typ">message/ohttp-res Media Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a class="auto internal xref" href="#section-9.4">9.4</a>.  <a class="internal xref" href="#name-registration-of-date-proble">Registration of "date" Problem Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a class="auto internal xref" href="#section-9.5">9.5</a>.  <a class="internal xref" href="#name-registration-of-ohttp-key-p">Registration of "ohttp-key" Problem Type</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#section-10.1">10.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#section-10.2">10.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-complete-example-of-a-reque">Complete Example of a Request and Response</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">HTTP requests reveal information about client identities to servers. While the
actual content of the request message is under the control of the client, other
information that is more difficult to control can still be used to identify the
client.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">Even where an IP address is not directly associated with an individual, the
requests made from it can be correlated over time to assemble a profile of
client behavior.  In particular, connection reuse improves performance but
provides servers with the ability to link requests that share a connection.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">In particular, the source IP address of the underlying connection reveals
identifying information that the client has only limited control over. While
client-configured HTTP proxies can provide a degree of protection against IP
address tracking, they present an unfortunate trade-off: if they are used without
TLS, the contents of communication are revealed to the proxy; if they are used
with TLS, a new connection needs to be used for each request to ensure that the
origin server cannot use the connection as a way to correlate requests,
incurring significant performance overheads.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">To overcome these limitations, this document defines Oblivious HTTP, a protocol
for encrypting and sending HTTP messages from a client to a gateway. This uses a
trusted relay service in a manner that mitigates the use of metadata such as IP
address and connection information for client identification, with reasonable
performance characteristics.  This document describes:<a class="pilcrow" href="#section-1-4">¶</a></p>
<ol class="normal type-1" id="section-1-5" start="1" type="1">
<li id="section-1-5.1">
          <p id="section-1-5.1.1">an algorithm for encapsulating binary HTTP messages <span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span> using Hybrid
Public Key Encryption (HPKE) <span>[<a class="cite xref" href="#HPKE">HPKE</a>]</span> to protect their contents,<a class="pilcrow" href="#section-1-5.1.1">¶</a></p>
</li>
        <li id="section-1-5.2">
          <p id="section-1-5.2.1">a method for forwarding <a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a> between <a class="internal xref" href="#dfn-client">Clients</a> and an
<a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> through a trusted <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> using
HTTP, and<a class="pilcrow" href="#section-1-5.2.1">¶</a></p>
</li>
        <li id="section-1-5.3">
          <p id="section-1-5.3.1">requirements for how the Oblivious Gateway Resource handles Encapsulated Requests and produces <a class="internal xref" href="#dfn-enc-res">Encapsulated Responses</a> for the Client.<a class="pilcrow" href="#section-1-5.3.1">¶</a></p>
</li>
      </ol>
<p id="section-1-6">The combination of encapsulation and relaying ensures that Oblivious Gateway
Resource never sees the Client's IP address and that the Oblivious Relay
Resource never sees plaintext HTTP message content.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">Oblivious HTTP allows connection reuse between the Client and Oblivious Relay
Resource, as well as between that relay and the Oblivious Gateway Resource, so this
scheme represents a performance improvement over using just one request in each
connection.  With limited trust placed in the Oblivious Relay Resource (see
<a class="auto internal xref" href="#security">Section 6</a>), Clients are assured that requests are not uniquely attributed to
them or linked to other requests.<a class="pilcrow" href="#section-1-7">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-overview">Overview</a>
      </h2>
<p id="section-2-1">An Oblivious HTTP <a class="internal xref" href="#dfn-client">Client</a> must initially know the following:<a class="pilcrow" href="#section-2-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">The identity of an <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>.  This might include some
information about what <a class="internal xref" href="#dfn-target">Target Resources</a> the Oblivious Gateway Resource
supports.<a class="pilcrow" href="#section-2-2.1.1">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1">The details of an HPKE public key for the Oblivious Gateway Resource,
including an identifier for that key and the HPKE algorithms that are used
with that key.<a class="pilcrow" href="#section-2-2.2.1">¶</a></p>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1">The identity of an <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> that will accept relay requests
carrying an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> as its content and forward the content in
these requests to a particular Oblivious Gateway Resource.  Oblivious HTTP
uses a one-to-one mapping between Oblivious Relay and Gateway Resources; see
<a class="auto internal xref" href="#proxy-state">Section 8.2</a> for more details.<a class="pilcrow" href="#section-2-2.3.1">¶</a></p>
</li>
      </ul>
<p id="section-2-3">This information allows the Client to send HTTP requests to the Oblivious
Gateway Resource for forwarding to a Target Resource.  The Oblivious Gateway
Resource does not learn the Client's IP address or any other identifying
information that might be revealed from the Client at the transport layer, nor
does the Oblivious Gateway Resource learn which of the requests it receives are
from the same Client.<a class="pilcrow" href="#section-2-3">¶</a></p>
<span id="name-overview-of-oblivious-http"></span><div id="fig-overview">
<figure id="figure-1">
        <div id="section-2-4.1">
          <div class="alignLeft art-svg artwork" id="section-2-4.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="480" text-anchor="middle" version="1.1" viewBox="0 0 560 480" width="560" xmlns="http://www.w3.org/2000/svg">
              <path d="M 8,48 L 8,96" fill="none" stroke="black"></path>
              <path d="M 48,96 L 48,464" fill="none" stroke="black"></path>
              <path d="M 88,48 L 88,96" fill="none" stroke="black"></path>
              <path d="M 152,48 L 152,96" fill="none" stroke="black"></path>
              <path d="M 192,96 L 192,464" fill="none" stroke="black"></path>
              <path d="M 240,48 L 240,96" fill="none" stroke="black"></path>
              <path d="M 288,48 L 288,96" fill="none" stroke="black"></path>
              <path d="M 312,48 L 312,96" fill="none" stroke="black"></path>
              <path d="M 360,96 L 360,464" fill="none" stroke="black"></path>
              <path d="M 400,48 L 400,96" fill="none" stroke="black"></path>
              <path d="M 440,48 L 440,96" fill="none" stroke="black"></path>
              <path d="M 480,96 L 480,464" fill="none" stroke="black"></path>
              <path d="M 528,48 L 528,96" fill="none" stroke="black"></path>
              <path d="M 552,48 L 552,96" fill="none" stroke="black"></path>
              <path d="M 304,32 L 536,32" fill="none" stroke="black"></path>
              <path d="M 8,48 L 88,48" fill="none" stroke="black"></path>
              <path d="M 152,48 L 240,48" fill="none" stroke="black"></path>
              <path d="M 312,48 L 400,48" fill="none" stroke="black"></path>
              <path d="M 440,48 L 528,48" fill="none" stroke="black"></path>
              <path d="M 8,96 L 88,96" fill="none" stroke="black"></path>
              <path d="M 152,96 L 240,96" fill="none" stroke="black"></path>
              <path d="M 312,96 L 400,96" fill="none" stroke="black"></path>
              <path d="M 440,96 L 528,96" fill="none" stroke="black"></path>
              <path d="M 304,112 L 352,112" fill="none" stroke="black"></path>
              <path d="M 368,112 L 472,112" fill="none" stroke="black"></path>
              <path d="M 488,112 L 536,112" fill="none" stroke="black"></path>
              <path d="M 48,192 L 184,192" fill="none" stroke="black"></path>
              <path d="M 192,256 L 352,256" fill="none" stroke="black"></path>
              <path d="M 360,272 L 472,272" fill="none" stroke="black"></path>
              <path d="M 368,320 L 480,320" fill="none" stroke="black"></path>
              <path d="M 200,384 L 360,384" fill="none" stroke="black"></path>
              <path d="M 56,448 L 192,448" fill="none" stroke="black"></path>
              <path d="M 304,32 C 295.16936,32 288,39.16936 288,48" fill="none" stroke="black"></path>
              <path d="M 536,32 C 544.83064,32 552,39.16936 552,48" fill="none" stroke="black"></path>
              <path d="M 304,112 C 295.16936,112 288,104.83064 288,96" fill="none" stroke="black"></path>
              <path d="M 536,112 C 544.83064,112 552,104.83064 552,96" fill="none" stroke="black"></path>
              <polygon class="arrowhead" fill="black" points="480,272 468,266.4 468,277.6" transform="rotate(0,472,272)"></polygon>
              <polygon class="arrowhead" fill="black" points="376,320 364,314.4 364,325.6" transform="rotate(180,368,320)"></polygon>
              <polygon class="arrowhead" fill="black" points="360,256 348,250.4 348,261.6" transform="rotate(0,352,256)"></polygon>
              <polygon class="arrowhead" fill="black" points="208,384 196,378.4 196,389.6" transform="rotate(180,200,384)"></polygon>
              <polygon class="arrowhead" fill="black" points="192,192 180,186.4 180,197.6" transform="rotate(0,184,192)"></polygon>
              <polygon class="arrowhead" fill="black" points="64,448 52,442.4 52,453.6" transform="rotate(180,56,448)"></polygon>
              <g class="text">
                <text x="44" y="68">Client</text>
                <text x="184" y="68">Relay</text>
                <text x="352" y="68">Gateway</text>
                <text x="476" y="68">Target</text>
                <text x="196" y="84">Resource</text>
                <text x="356" y="84">Resource</text>
                <text x="484" y="84">Resource</text>
                <text x="80" y="132">Relay</text>
                <text x="88" y="148">Request</text>
                <text x="68" y="164">[+</text>
                <text x="132" y="164">Encapsulated</text>
                <text x="112" y="180">Request</text>
                <text x="152" y="180">]</text>
                <text x="232" y="196">Gateway</text>
                <text x="232" y="212">Request</text>
                <text x="212" y="228">[+</text>
                <text x="276" y="228">Encapsulated</text>
                <text x="256" y="244">Request</text>
                <text x="296" y="244">]</text>
                <text x="400" y="260">Request</text>
                <text x="436" y="308">Response</text>
                <text x="320" y="324">Gateway</text>
                <text x="316" y="340">Response</text>
                <text x="236" y="356">[+</text>
                <text x="300" y="356">Encapsulated</text>
                <text x="300" y="372">Response</text>
                <text x="344" y="372">]</text>
                <text x="160" y="388">Relay</text>
                <text x="148" y="404">Response</text>
                <text x="68" y="420">[+</text>
                <text x="132" y="420">Encapsulated</text>
                <text x="132" y="436">Response</text>
                <text x="176" y="436">]</text>
              </g>
            </svg><a class="pilcrow" href="#section-2-4.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-overview-of-oblivious-http">Overview of Oblivious HTTP</a>
        </figcaption></figure>
</div>
<p id="section-2-5">In order to forward a request for a <a class="internal xref" href="#dfn-target">Target Resource</a> to the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a>, the following steps occur, as shown in <a class="auto internal xref" href="#fig-overview">Figure 1</a>:<a class="pilcrow" href="#section-2-5">¶</a></p>
<ol class="normal type-1" id="section-2-6" start="1" type="1">
<li id="section-2-6.1">
          <p id="section-2-6.1.1">The <a class="internal xref" href="#dfn-client">Client</a> constructs an HTTP request for a Target Resource.<a class="pilcrow" href="#section-2-6.1.1">¶</a></p>
</li>
        <li id="section-2-6.2">
          <p id="section-2-6.2.1">The Client encodes the HTTP request in a binary HTTP message and then
encapsulates that message using HPKE and the process from <a class="auto internal xref" href="#request">Section 4.3</a>.<a class="pilcrow" href="#section-2-6.2.1">¶</a></p>
</li>
        <li id="section-2-6.3">
          <p id="section-2-6.3.1">The Client sends a POST request to the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> with the
<a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> as the content of that message.<a class="pilcrow" href="#section-2-6.3.1">¶</a></p>
</li>
        <li id="section-2-6.4">
          <p id="section-2-6.4.1">The Oblivious Relay Resource forwards this request to the Oblivious Gateway
Resource.<a class="pilcrow" href="#section-2-6.4.1">¶</a></p>
</li>
        <li id="section-2-6.5">
          <p id="section-2-6.5.1">The Oblivious Gateway Resource receives this request and removes
the HPKE protection to obtain an HTTP request.<a class="pilcrow" href="#section-2-6.5.1">¶</a></p>
</li>
      </ol>
<p id="section-2-7">The Oblivious Gateway Resource then handles the HTTP request. This typically
involves making an HTTP request using the content of the Encapsulated Request. Once the
Oblivious Gateway Resource has an HTTP response for this request, the following
steps occur to return this response to the Client:<a class="pilcrow" href="#section-2-7">¶</a></p>
<ol class="normal type-1" id="section-2-8" start="1" type="1">
<li id="section-2-8.1">
          <p id="section-2-8.1.1">The Oblivious Gateway Resource encapsulates the HTTP response following the
process in <a class="auto internal xref" href="#response">Section 4.4</a> and sends this in response to the request from the
Oblivious Relay Resource.<a class="pilcrow" href="#section-2-8.1.1">¶</a></p>
</li>
        <li id="section-2-8.2">
          <p id="section-2-8.2.1">The Oblivious Relay Resource forwards this response to the Client.<a class="pilcrow" href="#section-2-8.2.1">¶</a></p>
</li>
        <li id="section-2-8.3">
          <p id="section-2-8.3.1">The Client removes the encapsulation to obtain the response to the original
 request.<a class="pilcrow" href="#section-2-8.3.1">¶</a></p>
</li>
      </ol>
<p id="section-2-9">This interaction provides authentication and confidentiality protection between
the Client and the Oblivious Gateway, but importantly not between the Client and
the Target Resource. While the Target Resource is a distinct HTTP resource from
the Oblivious Gateway Resource, they are both logically under the control of the
Oblivious Gateway, since the Oblivious Gateway Resource can unilaterally dictate
the responses returned from the Target Resource to the Client. This arrangement
is shown in <a class="auto internal xref" href="#fig-overview">Figure 1</a>.<a class="pilcrow" href="#section-2-9">¶</a></p>
<div id="applicability">
<section id="section-2.1">
        <h3 id="name-applicability">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-applicability">Applicability</a>
        </h3>
<p id="section-2.1-1">Oblivious HTTP has limited applicability.  Importantly, it requires explicit
support from a willing <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> and <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>,
thereby limiting the use of Oblivious HTTP for generic applications;
see <a class="auto internal xref" href="#server-responsibilities">Section 6.3</a> for more information.<a class="pilcrow" href="#section-2.1-1">¶</a></p>
<p id="section-2.1-2">Many uses of HTTP benefit from being able to carry state between requests, such
as with cookies <span>[<a class="cite xref" href="#COOKIES">COOKIES</a>]</span>, authentication (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-11">Section 11</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>), or even
alternative services <span>[<a class="cite xref" href="#RFC7838">RFC7838</a>]</span>.  Oblivious HTTP removes linkage at the
transport layer, which is only useful for an application that does not carry
state between requests.<a class="pilcrow" href="#section-2.1-2">¶</a></p>
<p id="section-2.1-3">Oblivious HTTP is primarily useful where the privacy risks associated with
possible stateful treatment of requests are sufficiently large that the cost of
deploying this protocol can be justified.  Oblivious HTTP is simpler and less
costly than more robust systems, like Prio <span>[<a class="cite xref" href="#PRIO">PRIO</a>]</span> or Tor <span>[<a class="cite xref" href="#DMS2004">DMS2004</a>]</span>, which
can provide stronger guarantees at higher operational costs.<a class="pilcrow" href="#section-2.1-3">¶</a></p>
<p id="section-2.1-4">Oblivious HTTP is more costly than a direct connection to a server.  Some costs,
like those involved with connection setup, can be amortized, but there are
several ways in which Oblivious HTTP is more expensive than a direct request:<a class="pilcrow" href="#section-2.1-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-5.1">
            <p id="section-2.1-5.1.1">Each request requires at least two regular HTTP requests, which could
increase latency.<a class="pilcrow" href="#section-2.1-5.1.1">¶</a></p>
</li>
          <li class="normal" id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">Each request is expanded in size with additional HTTP fields,
encryption-related metadata, and Authenticated Encryption with Associated Data
(AEAD) expansion.<a class="pilcrow" href="#section-2.1-5.2.1">¶</a></p>
</li>
          <li class="normal" id="section-2.1-5.3">
            <p id="section-2.1-5.3.1">Deriving cryptographic keys and applying them for request and
response protection takes non-negligible computational resources.<a class="pilcrow" href="#section-2.1-5.3.1">¶</a></p>
</li>
        </ul>
<p id="section-2.1-6">Examples of where preventing the linking of requests might justify these costs
include:<a class="pilcrow" href="#section-2.1-6">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-7">
          <dt id="section-2.1-7.1">DNS queries:</dt>
          <dd id="section-2.1-7.2" style="margin-left: 1.5em">
            <p id="section-2.1-7.2.1">DNS queries made to a recursive resolver reveal information about the
requester, particularly if linked to other queries.<a class="pilcrow" href="#section-2.1-7.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-7.3">Telemetry submission:</dt>
          <dd id="section-2.1-7.4" style="margin-left: 1.5em">
            <p id="section-2.1-7.4.1">Applications that submit reports about their usage to their developers might
use Oblivious HTTP for some types of moderately sensitive data.<a class="pilcrow" href="#section-2.1-7.4.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-8">These are examples of requests where there is information in a request that --
if it were connected to the identity of the user -- might allow a server to
learn something about that user even if the identity of the user were
pseudonymous.  Other examples include submitting anonymous surveys, making
search queries, or requesting location-specific content (such as retrieving
tiles of a map display).<a class="pilcrow" href="#section-2.1-8">¶</a></p>
<p id="section-2.1-9">In addition to these limitations, <a class="auto internal xref" href="#security">Section 6</a> describes operational constraints
that are necessary to realize the goals of the protocol.<a class="pilcrow" href="#section-2.1-9">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2.2">
        <h3 id="name-conventions-and-definitions">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-conventions-and-definitions">Conventions and Definitions</a>
        </h3>
<p id="section-2.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a class="pilcrow" href="#section-2.2-1">¶</a></p>
<p id="section-2.2-2">This document uses terminology from <span>[<a class="cite xref" href="#HTTP">HTTP</a>]</span> and defines several terms as
follows:<a class="pilcrow" href="#section-2.2-2">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-2.2-3">
          <dt id="section-2.2-3.1">
<div id="dfn-client">Client:</div>
          </dt>
<dd id="section-2.2-3.2" style="margin-left: 1.5em">
            <p id="section-2.2-3.2.1">A Client originates Oblivious HTTP requests.  A Client is also an HTTP client
in two ways: for the <a class="internal xref" href="#dfn-target">Target Resource</a> and for the <a class="internal xref" href="#dfn-relay">Oblivious Relay
Resource</a>. However, when referring to the HTTP definition of client (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>), the term "HTTP client" is used; see <a class="auto internal xref" href="#http-usage">Section 5</a>.<a class="pilcrow" href="#section-2.2-3.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.3">
<div id="dfn-enc-req">Encapsulated Request:</div>
          </dt>
<dd id="section-2.2-3.4" style="margin-left: 1.5em">
            <p id="section-2.2-3.4.1">An HTTP request that is encapsulated in an HPKE-encrypted message; see
<a class="auto internal xref" href="#request">Section 4.3</a>.<a class="pilcrow" href="#section-2.2-3.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.5">
<div id="dfn-enc-res">Encapsulated Response:</div>
          </dt>
<dd id="section-2.2-3.6" style="margin-left: 1.5em">
            <p id="section-2.2-3.6.1">An HTTP response that is encapsulated in an HPKE-encrypted message; see
<a class="auto internal xref" href="#response">Section 4.4</a>.<a class="pilcrow" href="#section-2.2-3.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.7">
<div id="dfn-relay">Oblivious Relay Resource:</div>
          </dt>
<dd id="section-2.2-3.8" style="margin-left: 1.5em">
            <p id="section-2.2-3.8.1">An intermediary that forwards <a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a> and <a class="internal xref" href="#dfn-enc-res">Responses</a> between
<a class="internal xref" href="#dfn-client">Clients</a> and a single <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>.  In context, this can be
referred to simply as a "relay".<a class="pilcrow" href="#section-2.2-3.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.9">
<div id="dfn-gateway">Oblivious Gateway Resource:</div>
          </dt>
<dd id="section-2.2-3.10" style="margin-left: 1.5em">
            <p id="section-2.2-3.10.1">A resource that can receive an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>, extract the contents of
that request, forward it to a <a class="internal xref" href="#dfn-target">Target Resource</a>, receive a response, encapsulate
that response, and then return the resulting <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a>.  In
context, this can be referred to simply as a "gateway".<a class="pilcrow" href="#section-2.2-3.10.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-3.11">
<div id="dfn-target">Target Resource:</div>
          </dt>
<dd id="section-2.2-3.12" style="margin-left: 1.5em">
            <p id="section-2.2-3.12.1">The resource that is the target of an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>.  This resource
logically handles only regular HTTP requests and responses, so it might be
ignorant of the use of Oblivious HTTP to reach it.<a class="pilcrow" href="#section-2.2-3.12.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.2-4">This document includes pseudocode that uses the functions and conventions
defined in <span>[<a class="cite xref" href="#HPKE">HPKE</a>]</span>.<a class="pilcrow" href="#section-2.2-4">¶</a></p>
<p id="section-2.2-5">Encoding an integer to a sequence of bytes in network byte order is described
using the function <code>encode(n, v)</code>, where <code>n</code> is the number of bytes and <code>v</code> is
the integer value.  ASCII <span>[<a class="cite xref" href="#ASCII">ASCII</a>]</span> encoding of a string <code>s</code> is
indicated using the function <code>encode_str(s)</code>.<a class="pilcrow" href="#section-2.2-5">¶</a></p>
<p id="section-2.2-6">Formats are described using notation from <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9000#section-1.3">Section 1.3</a> of [<a class="cite xref" href="#QUIC">QUIC</a>]</span>.  An extension
to that notation expresses the number of bits in a field using a simple
mathematical function.<a class="pilcrow" href="#section-2.2-6">¶</a></p>
</section>
</div>
</section>
</div>
<div id="key-configuration">
<section id="section-3">
      <h2 id="name-key-configuration">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-key-configuration">Key Configuration</a>
      </h2>
<p id="section-3-1">A <a class="internal xref" href="#dfn-client">Client</a> needs to acquire information about the key configuration of the
<a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> in order to send <a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a>.
In order to ensure that Clients do not encapsulate messages that other entities
can intercept, the key configuration <span class="bcp14">MUST</span> be authenticated and have integrity
protection.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2">This document does not define how that acquisition occurs. However, in order to
help facilitate interoperability, it does specify a format for the keys. This
ensures that different Client implementations can be configured in the same way
and also enables advertising key configurations in a consistent format.  This
format might be used, for example, with HTTPS, as part of a system for
configuring or discovering key configurations.  However, note that such a system
needs to consider the potential for key configuration to be used to compromise
Client privacy; see <a class="auto internal xref" href="#privacy">Section 7</a>.<a class="pilcrow" href="#section-3-2">¶</a></p>
<p id="section-3-3">A Client might have multiple key configurations to select from when
encapsulating a request. Clients are responsible for selecting a preferred key
configuration from those it supports. Clients need to consider both the Key
Encapsulation Method (KEM) and the combinations of the Key Derivation Function
(KDF) and AEAD in this decision.<a class="pilcrow" href="#section-3-3">¶</a></p>
<div id="key-config">
<section id="section-3.1">
        <h3 id="name-key-configuration-encoding">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-key-configuration-encoding">Key Configuration Encoding</a>
        </h3>
<p id="section-3.1-1">A single <a class="internal xref" href="#key-configuration">key configuration</a> consists of a key identifier, a public key, an
identifier for the KEM that the public key uses, and a set of HPKE symmetric
algorithms. Each symmetric algorithm consists of an identifier for a KDF and an
identifier for an AEAD.<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<p id="section-3.1-2"><a class="auto internal xref" href="#format-key-config">Figure 2</a> shows a single key configuration.<a class="pilcrow" href="#section-3.1-2">¶</a></p>
<span id="name-a-single-key-configuration"></span><div id="format-key-config">
<figure id="figure-2">
          <div class="lang-tls-presentation sourcecode" id="section-3.1-3.1">
<pre>HPKE Symmetric Algorithms {
  HPKE KDF ID (16),
  HPKE AEAD ID (16),
}

Key Config {
  Key Identifier (8),
  HPKE KEM ID (16),
  HPKE Public Key (Npk * 8),
  HPKE Symmetric Algorithms Length (16) = 4..65532,
  HPKE Symmetric Algorithms (32) ...,
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-a-single-key-configuration">A Single Key Configuration</a>
          </figcaption></figure>
</div>
<p id="section-3.1-4">That is, a key configuration consists of the following fields:<a class="pilcrow" href="#section-3.1-4">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.1-5">
          <dt id="section-3.1-5.1">Key Identifier:</dt>
          <dd id="section-3.1-5.2" style="margin-left: 1.5em">
            <p id="section-3.1-5.2.1">An 8-bit value that identifies the key used by the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>.<a class="pilcrow" href="#section-3.1-5.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.3">HPKE KEM ID:</dt>
          <dd id="section-3.1-5.4" style="margin-left: 1.5em">
            <p id="section-3.1-5.4.1">A 16-bit value that identifies the KEM used for the identified key as defined
in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-7.1">Section 7.1</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span> or the <a href="https://www.iana.org/assignments/hpke">"HPKE KEM Identifiers" registry</a>.<a class="pilcrow" href="#section-3.1-5.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.5">HPKE Public Key:</dt>
          <dd id="section-3.1-5.6" style="margin-left: 1.5em">
            <p id="section-3.1-5.6.1">The public key used by the gateway. The length of the public key is <code>Npk</code>, which is
determined by the choice of HPKE KEM as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-4">Section 4</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>.<a class="pilcrow" href="#section-3.1-5.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.7">HPKE Symmetric Algorithms Length:</dt>
          <dd id="section-3.1-5.8" style="margin-left: 1.5em">
            <p id="section-3.1-5.8.1">A 16-bit integer in network byte order that encodes the length, in bytes, of
the HPKE Symmetric Algorithms field that follows.<a class="pilcrow" href="#section-3.1-5.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-5.9">HPKE Symmetric Algorithms:</dt>
          <dd id="section-3.1-5.10" style="margin-left: 1.5em">
            <p id="section-3.1-5.10.1">One or more pairs of identifiers for the different combinations of HPKE KDF
and AEAD that the Oblivious Gateway Resource supports:<a class="pilcrow" href="#section-3.1-5.10.1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.1-5.10.2">
              <dt id="section-3.1-5.10.2.1">HPKE KDF ID:</dt>
              <dd id="section-3.1-5.10.2.2" style="margin-left: 1.5em">
                <p id="section-3.1-5.10.2.2.1">A 16-bit HPKE KDF identifier as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-7.2">Section 7.2</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span> or the <a href="https://www.iana.org/assignments/hpke">
"HPKE KDF Identifiers"
registry</a>.<a class="pilcrow" href="#section-3.1-5.10.2.2.1">¶</a></p>
</dd>
              <dd class="break"></dd>
<dt id="section-3.1-5.10.2.3">HPKE AEAD ID:</dt>
              <dd id="section-3.1-5.10.2.4" style="margin-left: 1.5em">
                <p id="section-3.1-5.10.2.4.1">A 16-bit HPKE AEAD identifier as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-7.3">Section 7.3</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span> or the <a href="https://www.iana.org/assignments/hpke">"HPKE AEAD Identifiers"  registry</a>.<a class="pilcrow" href="#section-3.1-5.10.2.4.1">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="ohttp-keys">
<section id="section-3.2">
        <h3 id="name-key-configuration-media-typ">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-key-configuration-media-typ">Key Configuration Media Type</a>
        </h3>
<p id="section-3.2-1">The "application/ohttp-keys" format is a media type that identifies a serialized
collection of <a class="internal xref" href="#key-configuration">key configurations</a>. The content of this media type comprises one
or more key configuration encodings (see <a class="auto internal xref" href="#key-config">Section 3.1</a>).  Each encoded
configuration is prefixed with a 2-byte integer in network byte order that
indicates the length of the key configuration in bytes.  The length-prefixed
encodings are concatenated to form a list.  See <a class="auto internal xref" href="#iana-keys">Section 9.1</a> for a definition
of the media type.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2">Evolution of the key configuration format is supported through the definition of
new formats that are identified by new media types.<a class="pilcrow" href="#section-3.2-2">¶</a></p>
<p id="section-3.2-3">A <a class="internal xref" href="#dfn-client">Client</a> that receives an "application/ohttp-keys" object with encoding errors
might be able to recover one or more key configurations.  Differences in how key
configurations are recovered might be exploited to segregate Clients, so Clients
          <span class="bcp14">MUST</span> discard incorrectly encoded key configuration collections.<a class="pilcrow" href="#section-3.2-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="hpke-encapsulation">
<section id="section-4">
      <h2 id="name-hpke-encapsulation">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-hpke-encapsulation">HPKE Encapsulation</a>
      </h2>
<p id="section-4-1">This document defines how a binary-encoded HTTP message <span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span> is
encapsulated using HPKE <span>[<a class="cite xref" href="#HPKE">HPKE</a>]</span>.  Separate media types are defined to
distinguish request and response messages:<a class="pilcrow" href="#section-4-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">An <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> format defined in <a class="auto internal xref" href="#req-format">Section 4.1</a> is identified by the
<span><a class="internal xref" href="#iana-req">"<code>message/ohttp-req</code>" media type</a> (<a class="auto internal xref" href="#iana-req">Section 9.2</a>)</span>.<a class="pilcrow" href="#section-4-2.1.1">¶</a></p>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">An <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a> format defined in <a class="auto internal xref" href="#res-format">Section 4.2</a> is identified by the
<span><a class="internal xref" href="#iana-res">"<code>message/ohttp-res</code>" media type</a> (<a class="auto internal xref" href="#iana-res">Section 9.3</a>)</span>.<a class="pilcrow" href="#section-4-2.2.1">¶</a></p>
</li>
      </ul>
<p id="section-4-3">Alternative encapsulations or message formats are indicated using the media
type; see Sections <a class="auto internal xref" href="#req-res-media">4.5</a> and <a class="auto internal xref" href="#repurposing">4.6</a>.<a class="pilcrow" href="#section-4-3">¶</a></p>
<div id="req-format">
<section id="section-4.1">
        <h3 id="name-request-format">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-request-format">Request Format</a>
        </h3>
<p id="section-4.1-1">A message in "<code>message/ohttp-req</code>" format protects a binary HTTP request
message; see <a class="auto internal xref" href="#fig-req-pt">Figure 3</a>.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
<span id="name-plaintext-request-structure"></span><div id="fig-req-pt">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>Request {
  Binary HTTP Message (..),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-plaintext-request-structure">Plaintext Request Structure</a>
          </figcaption></figure>
</div>
<p id="section-4.1-3">This plaintext Request structure is encapsulated into a message in
"<code>message/ohttp-req</code>" form by generating an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>.  An
Encapsulated Request comprises a key identifier; HPKE parameters for the chosen
KEM, KDF, and AEAD; the encapsulated KEM shared secret (or <code>enc</code>); and an
HPKE-protected binary HTTP request message.<a class="pilcrow" href="#section-4.1-3">¶</a></p>
<p id="section-4.1-4">An Encapsulated Request is shown in <a class="auto internal xref" href="#fig-enc-request">Figure 4</a>. <a class="auto internal xref" href="#request">Section 4.3</a> describes
the process for constructing and processing an Encapsulated Request.<a class="pilcrow" href="#section-4.1-4">¶</a></p>
<span id="name-encapsulated-request"></span><div id="fig-enc-request">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.1-5.1">
<pre>Encapsulated Request {
  Key Identifier (8),
  HPKE KEM ID (16),
  HPKE KDF ID (16),
  HPKE AEAD ID (16),
  Encapsulated KEM Shared Secret (8 * Nenc),
  HPKE-Protected Request (..),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-encapsulated-request">Encapsulated Request</a>
          </figcaption></figure>
</div>
<p id="section-4.1-6">That is, an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> comprises a Key Identifier, an HPKE KEM ID, an
HPKE KDF ID, an HPKE AEAD ID, an Encapsulated KEM Shared Secret, and an
HPKE-Protected Request.  The Key Identifier, HPKE KEM ID, HPKE KDF ID, and HPKE
AEAD ID fields are defined in <a class="auto internal xref" href="#key-config">Section 3.1</a>.  The Encapsulated KEM Shared
Secret is the output of the <code>Encap()</code> function for the KEM, which is <code>Nenc</code>
bytes in length, as defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-4">Section 4</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>.<a class="pilcrow" href="#section-4.1-6">¶</a></p>
</section>
</div>
<div id="res-format">
<section id="section-4.2">
        <h3 id="name-response-format">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-response-format">Response Format</a>
        </h3>
<p id="section-4.2-1">A message in "<code>message/ohttp-res</code>" format protects a binary HTTP response
message; see <a class="auto internal xref" href="#fig-res-pt">Figure 5</a>.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
<span id="name-plaintext-response-structur"></span><div id="fig-res-pt">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.2-2.1">
<pre>Response {
  Binary HTTP Message (..),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-plaintext-response-structur">Plaintext Response Structure</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">This plaintext Response structure is encapsulated into a message in
"<code>message/ohttp-res</code>" form by generating an <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a>.  An
Encapsulated Response comprises a nonce and the AEAD-protected binary HTTP
response message.<a class="pilcrow" href="#section-4.2-3">¶</a></p>
<p id="section-4.2-4">An Encapsulated Response is shown in <a class="auto internal xref" href="#fig-enc-response">Figure 6</a>. <a class="auto internal xref" href="#response">Section 4.4</a> describes
the process for constructing and processing an Encapsulated Response.<a class="pilcrow" href="#section-4.2-4">¶</a></p>
<span id="name-encapsulated-response"></span><div id="fig-enc-response">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-4.2-5.1">
<pre>Encapsulated Response {
  Nonce (8 * max(Nn, Nk)),
  AEAD-Protected Response (..),
}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-encapsulated-response">Encapsulated Response</a>
          </figcaption></figure>
</div>
<p id="section-4.2-6">That is, an <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a> contains a Nonce and an AEAD-Protected
Response.  The Nonce field is either <code>Nn</code> or <code>Nk</code> bytes long, whichever is
larger.  The <code>Nn</code> and <code>Nk</code> values correspond to parameters of the AEAD used in
HPKE, which is defined in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-7.3">Section 7.3</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span> or <a href="https://www.iana.org/assignments/hpke">the "HPKE AEAD
Identifiers" IANA
registry</a>.  <code>Nn</code>
and <code>Nk</code> refer to the size of the AEAD nonce and key, respectively, in bytes.<a class="pilcrow" href="#section-4.2-6">¶</a></p>
</section>
</div>
<div id="request">
<section id="section-4.3">
        <h3 id="name-encapsulation-of-requests">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-encapsulation-of-requests">Encapsulation of Requests</a>
        </h3>
<p id="section-4.3-1"><a class="internal xref" href="#dfn-client">Clients</a> encapsulate a request, identified as <code>request</code>, using values from a <a class="internal xref" href="#key-configuration">key
configuration</a>:<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">
            <p id="section-4.3-2.1.1">the key identifier from the configuration (<code>key_id</code>) with the corresponding
KEM identified by <code>kem_id</code>,<a class="pilcrow" href="#section-4.3-2.1.1">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">the public key from the configuration (<code>pkR</code>), and<a class="pilcrow" href="#section-4.3-2.2.1">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.3">
            <p id="section-4.3-2.3.1">a combination of KDF (identified by <code>kdf_id</code>) and AEAD (identified by
<code>aead_id</code>) that the Client selects from those in the key configuration.<a class="pilcrow" href="#section-4.3-2.3.1">¶</a></p>
</li>
        </ul>
<p id="section-4.3-3">The Client then constructs an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>, <code>enc_request</code>, from a binary-encoded HTTP request <span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span> (<code>request</code>) as follows:<a class="pilcrow" href="#section-4.3-3">¶</a></p>
<ol class="normal type-1" id="section-4.3-4" start="1" type="1">
<li id="section-4.3-4.1">
            <p id="section-4.3-4.1.1">Construct a message header (<code>hdr</code>) by concatenating the values of <code>key_id</code>,
<code>kem_id</code>, <code>kdf_id</code>, and <code>aead_id</code> as one 8-bit integer and three 16-bit
integers, respectively, each in network byte order.<a class="pilcrow" href="#section-4.3-4.1.1">¶</a></p>
</li>
          <li id="section-4.3-4.2">
            <p id="section-4.3-4.2.1">Build a sequence of bytes (<code>info</code>) by concatenating the ASCII-encoded string
"message/bhttp request", a zero byte, and the header.  Note: <a class="auto internal xref" href="#repurposing">Section 4.6</a>
discusses how alternative message formats might use a different <code>info</code> value.<a class="pilcrow" href="#section-4.3-4.2.1">¶</a></p>
</li>
          <li id="section-4.3-4.3">
            <p id="section-4.3-4.3.1">Create a sending HPKE context by invoking <code>SetupBaseS()</code> (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-5.1.1">Section 5.1.1</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>) with the public key of the receiver <code>pkR</code> and <code>info</code>.  This yields
the context <code>sctxt</code> and an encapsulation key <code>enc</code>.<a class="pilcrow" href="#section-4.3-4.3.1">¶</a></p>
</li>
          <li id="section-4.3-4.4">
            <p id="section-4.3-4.4.1">Encrypt <code>request</code> by invoking the <code>Seal()</code> method on <code>sctxt</code> (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>) with empty associated data <code>aad</code>, yielding ciphertext <code>ct</code>.<a class="pilcrow" href="#section-4.3-4.4.1">¶</a></p>
</li>
          <li id="section-4.3-4.5">
            <p id="section-4.3-4.5.1">Concatenate the values of <code>hdr</code>, <code>enc</code>, and <code>ct</code>. This yields an Encapsulated
Request (<code>enc_request</code>).<a class="pilcrow" href="#section-4.3-4.5.1">¶</a></p>
</li>
        </ol>
<p id="section-4.3-5">Note that <code>enc</code> is of fixed length, so there is no ambiguity in parsing this
structure.<a class="pilcrow" href="#section-4.3-5">¶</a></p>
<p id="section-4.3-6">In pseudocode, this procedure is as follows:<a class="pilcrow" href="#section-4.3-6">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.3-7">
<pre>hdr = concat(encode(1, key_id),
             encode(2, kem_id),
             encode(2, kdf_id),
             encode(2, aead_id))
info = concat(encode_str("message/bhttp request"),
              encode(1, 0),
              hdr)
enc, sctxt = SetupBaseS(pkR, info)
ct = sctxt.Seal("", request)
enc_request = concat(hdr, enc, ct)
</pre><a class="pilcrow" href="#section-4.3-7">¶</a>
</div>
<p id="section-4.3-8">An <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> decrypts an Encapsulated Request by reversing this
process. To decapsulate an Encapsulated Request, <code>enc_request</code>:<a class="pilcrow" href="#section-4.3-8">¶</a></p>
<ol class="normal type-1" id="section-4.3-9" start="1" type="1">
<li id="section-4.3-9.1">
            <p id="section-4.3-9.1.1">Parse <code>enc_request</code> into <code>key_id</code>, <code>kem_id</code>, <code>kdf_id</code>, <code>aead_id</code>, <code>enc</code>, and
<code>ct</code> (indicated using the function <code>parse()</code> in pseudocode). The Oblivious
Gateway Resource is then able to find the HPKE private key, <code>skR</code>,
corresponding to <code>key_id</code>.<a class="pilcrow" href="#section-4.3-9.1.1">¶</a></p>
<ol class="normal type-a" id="section-4.3-9.1.2" start="1" type="a">
<li id="section-4.3-9.1.2.1">
                <p id="section-4.3-9.1.2.1.1">If <code>key_id</code> does not identify a key matching the type of <code>kem_id</code>, the
Oblivious Gateway Resource returns an error.<a class="pilcrow" href="#section-4.3-9.1.2.1.1">¶</a></p>
</li>
              <li id="section-4.3-9.1.2.2">
                <p id="section-4.3-9.1.2.2.1">If <code>kdf_id</code> and <code>aead_id</code> identify a combination of KDF and AEAD that the
Oblivious Gateway Resource is unwilling to use with <code>skR</code>, the Oblivious
Gateway Resource returns an error.<a class="pilcrow" href="#section-4.3-9.1.2.2.1">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-4.3-9.2">
            <p id="section-4.3-9.2.1">Build a sequence of bytes (<code>info</code>) by concatenating the ASCII-encoded string
"message/bhttp request"; a zero byte; <code>key_id</code> as an 8-bit integer; plus
<code>kem_id</code>, <code>kdf_id</code>, and <code>aead_id</code> as three 16-bit integers.<a class="pilcrow" href="#section-4.3-9.2.1">¶</a></p>
</li>
          <li id="section-4.3-9.3">
            <p id="section-4.3-9.3.1">Create a receiving HPKE context, <code>rctxt</code>, by invoking <code>SetupBaseR()</code>
(<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-5.1.1">Section 5.1.1</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>) with <code>skR</code>, <code>enc</code>, and <code>info</code>.<a class="pilcrow" href="#section-4.3-9.3.1">¶</a></p>
</li>
          <li id="section-4.3-9.4">
            <p id="section-4.3-9.4.1">Decrypt <code>ct</code> by invoking the <code>Open()</code> method on <code>rctxt</code> (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>), with an empty associated data <code>aad</code>, yielding <code>request</code> or an error
on failure. If decryption fails, the Oblivious Gateway Resource returns an
error.<a class="pilcrow" href="#section-4.3-9.4.1">¶</a></p>
</li>
        </ol>
<p id="section-4.3-10">In pseudocode, this procedure is as follows:<a class="pilcrow" href="#section-4.3-10">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.3-11">
<pre>key_id, kem_id, kdf_id, aead_id, enc, ct = parse(enc_request)
info = concat(encode_str("message/bhttp request"),
              encode(1, 0),
              encode(1, key_id),
              encode(2, kem_id),
              encode(2, kdf_id),
              encode(2, aead_id))
rctxt = SetupBaseR(enc, skR, info)
request, error = rctxt.Open("", ct)
</pre><a class="pilcrow" href="#section-4.3-11">¶</a>
</div>
<p id="section-4.3-12">The Oblivious Gateway Resource retains the HPKE context, <code>rctxt</code>, so that it can
encapsulate a response.<a class="pilcrow" href="#section-4.3-12">¶</a></p>
</section>
</div>
<div id="response">
<section id="section-4.4">
        <h3 id="name-encapsulation-of-responses">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-encapsulation-of-responses">Encapsulation of Responses</a>
        </h3>
<p id="section-4.4-1"><a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resources</a> generate an <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a> (<code>enc_response</code>)
from a binary-encoded HTTP response <span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span> (<code>response</code>).  The Oblivious
Gateway Resource uses the HPKE receiver context (<code>rctxt</code>) as the HPKE context
(<code>context</code>) as follows:<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<ol class="normal type-1" id="section-4.4-2" start="1" type="1">
<li id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Export a secret (<code>secret</code>) from <code>context</code>, using the string "message/bhttp
response" as the <code>exporter_context</code> parameter to <code>context.Export</code>; see
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9180#section-5.3">Section 5.3</a> of [<a class="cite xref" href="#HPKE">HPKE</a>]</span>.  The length of this secret is <code>max(Nn, Nk)</code>, where
<code>Nn</code> and <code>Nk</code> are the length of the AEAD key and nonce that are associated with <code>context</code>.
Note: <a class="auto internal xref" href="#repurposing">Section 4.6</a> discusses how alternative message formats might use a
different <code>context</code> value.<a class="pilcrow" href="#section-4.4-2.1.1">¶</a></p>
</li>
          <li id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Generate a random value of length <code>max(Nn, Nk)</code> bytes, called
<code>response_nonce</code>.<a class="pilcrow" href="#section-4.4-2.2.1">¶</a></p>
</li>
          <li id="section-4.4-2.3">
            <p id="section-4.4-2.3.1">Extract a pseudorandom key (<code>prk</code>) using the <code>Extract</code> function provided by
the KDF algorithm associated with <code>context</code>. The <code>ikm</code> input to this
function is <code>secret</code>; the <code>salt</code> input is the concatenation of <code>enc</code> (from
<code>enc_request</code>) and <code>response_nonce</code>.<a class="pilcrow" href="#section-4.4-2.3.1">¶</a></p>
</li>
          <li id="section-4.4-2.4">
            <p id="section-4.4-2.4.1">Use the <code>Expand</code> function provided by the same KDF to create an AEAD key,
<code>key</code>, of length <code>Nk</code> -- the length of the keys used by the AEAD associated
with <code>context</code>. Generating <code>aead_key</code> uses a label of "key".<a class="pilcrow" href="#section-4.4-2.4.1">¶</a></p>
</li>
          <li id="section-4.4-2.5">
            <p id="section-4.4-2.5.1">Use the same <code>Expand</code> function to create a nonce, <code>nonce</code>, of length <code>Nn</code> --
the length of the nonce used by the AEAD. Generating <code>aead_nonce</code> uses a
label of "nonce".<a class="pilcrow" href="#section-4.4-2.5.1">¶</a></p>
</li>
          <li id="section-4.4-2.6">
            <p id="section-4.4-2.6.1">Encrypt <code>response</code>, passing the AEAD function Seal the values of
<code>aead_key</code>, <code>aead_nonce</code>, an empty <code>aad</code>, and a <code>pt</code> input of
<code>response</code>. This yields <code>ct</code>.<a class="pilcrow" href="#section-4.4-2.6.1">¶</a></p>
</li>
          <li id="section-4.4-2.7">
            <p id="section-4.4-2.7.1">Concatenate <code>response_nonce</code> and <code>ct</code>, yielding an Encapsulated Response,
<code>enc_response</code>. Note that <code>response_nonce</code> is of fixed length, so there is no
ambiguity in parsing either <code>response_nonce</code> or <code>ct</code>.<a class="pilcrow" href="#section-4.4-2.7.1">¶</a></p>
</li>
        </ol>
<p id="section-4.4-3">In pseudocode, this procedure is as follows:<a class="pilcrow" href="#section-4.4-3">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.4-4">
<pre>secret = context.Export("message/bhttp response", max(Nn, Nk))
response_nonce = random(max(Nn, Nk))
salt = concat(enc, response_nonce)
prk = Extract(salt, secret)
aead_key = Expand(prk, "key", Nk)
aead_nonce = Expand(prk, "nonce", Nn)
ct = Seal(aead_key, aead_nonce, "", response)
enc_response = concat(response_nonce, ct)
</pre><a class="pilcrow" href="#section-4.4-4">¶</a>
</div>
<p id="section-4.4-5"><a class="internal xref" href="#dfn-client">Clients</a> decrypt an Encapsulated Response by reversing this process.  That is,
Clients first parse <code>enc_response</code> into <code>response_nonce</code> and <code>ct</code>. Then, they
follow the same process to derive values for <code>aead_key</code> and <code>aead_nonce</code>, using
their sending HPKE context, <code>sctxt</code>, as the HPKE context, <code>context</code>.<a class="pilcrow" href="#section-4.4-5">¶</a></p>
<p id="section-4.4-6">The Client uses these values to decrypt <code>ct</code> using the AEAD function <code>Open</code>.
Decrypting might produce an error, as follows:<a class="pilcrow" href="#section-4.4-6">¶</a></p>
<div class="lang-pseudocode sourcecode" id="section-4.4-7">
<pre>response, error = Open(aead_key, aead_nonce, "", ct)
</pre><a class="pilcrow" href="#section-4.4-7">¶</a>
</div>
</section>
</div>
<div id="req-res-media">
<section id="section-4.5">
        <h3 id="name-request-and-response-media-">
<a class="section-number selfRef" href="#section-4.5">4.5. </a><a class="section-name selfRef" href="#name-request-and-response-media-">Request and Response Media Types</a>
        </h3>
<p id="section-4.5-1">Media types are used to identify Encapsulated Requests and Responses; see
Sections <a class="auto internal xref" href="#iana-req">9.2</a> and <a class="auto internal xref" href="#iana-res">9.3</a> for definitions of these media types.<a class="pilcrow" href="#section-4.5-1">¶</a></p>
<p id="section-4.5-2">Evolution of the format of Encapsulated Requests and Responses is supported
through the definition of new formats that are identified by new media types.
New media types might be defined to use a similar encapsulation with a different
HTTP message format than in <span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span>; see <a class="auto internal xref" href="#repurposing">Section 4.6</a> for guidance on
reusing this encapsulation method.  Alternatively, a new encapsulation method
might be defined.<a class="pilcrow" href="#section-4.5-2">¶</a></p>
</section>
</div>
<div id="repurposing">
<section id="section-4.6">
        <h3 id="name-repurposing-the-encapsulati">
<a class="section-number selfRef" href="#section-4.6">4.6. </a><a class="section-name selfRef" href="#name-repurposing-the-encapsulati">Repurposing the Encapsulation Format</a>
        </h3>
<p id="section-4.6-1">The encrypted payload of an Oblivious HTTP request and response is a binary HTTP message
<span>[<a class="cite xref" href="#BINARY">BINARY</a>]</span>.  The <a class="internal xref" href="#dfn-client">Client</a> and <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> agree on this encrypted
payload type by specifying the media type "message/bhttp" in the HPKE info
string and HPKE export context string for request and response encryption,
respectively.<a class="pilcrow" href="#section-4.6-1">¶</a></p>
<p id="section-4.6-2">Future specifications may repurpose the encapsulation mechanism described in
this document.  This requires that the specification define a new media type.
The encapsulation process for that content type can follow the same process,
using new constant strings for the HPKE info and exporter context inputs.<a class="pilcrow" href="#section-4.6-2">¶</a></p>
<p id="section-4.6-3">For example, a future specification might encapsulate DNS messages, which use
the "application/dns-message" media type <span>[<a class="cite xref" href="#RFC8484">RFC8484</a>]</span>.  In creating a new,
encrypted media types, specifications might define the use of string
"application/dns-message request" (plus a zero byte and the header for the full
value) for request encryption and the string "application/dns-message response"
for response encryption.<a class="pilcrow" href="#section-4.6-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="http-usage">
<section id="section-5">
      <h2 id="name-http-usage">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-http-usage">HTTP Usage</a>
      </h2>
<p id="section-5-1">A <a class="internal xref" href="#dfn-client">Client</a> interacts with the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> by constructing an
<a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>.  This Encapsulated Request is included as the content of a
POST request to the Oblivious Relay Resource.  This request only needs those
fields necessary to carry the Encapsulated Request: a method of POST, a target
URI of the Oblivious Relay Resource, a header field containing the content type
(see <a class="auto internal xref" href="#iana-req">Section 9.2</a>), and the Encapsulated Request as the request content. In the
request to the Oblivious Relay Resource, Clients <span class="bcp14">MAY</span> include additional
fields. However, additional fields <span class="bcp14">MUST</span> be independent of the Encapsulated
Request and <span class="bcp14">MUST</span> be fields that the Oblivious Relay Resource will remove before
forwarding the Encapsulated Request towards the target, such as the <code>Connection</code>
or <code>Proxy-Authorization</code> header fields <span>[<a class="cite xref" href="#HTTP">HTTP</a>]</span>.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">The Client role in this protocol acts as an HTTP client both with respect to the
Oblivious Relay Resource and the <a class="internal xref" href="#dfn-target">Target Resource</a>.  The request, which the Client
makes to the Target Resource, diverges from typical HTTP assumptions about
the use of a connection (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-3.3">Section 3.3</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>) in that the request and
response are encrypted rather than sent over a connection.  The Oblivious Relay
Resource and the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> also act as HTTP clients toward the
Oblivious Gateway Resource and Target Resource, respectively.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3">In order to achieve the privacy and security goals of the protocol, a Client
also needs to observe the guidance in <a class="auto internal xref" href="#sec-client">Section 6.1</a>.<a class="pilcrow" href="#section-5-3">¶</a></p>
<p id="section-5-4">The Oblivious Relay Resource interacts with the Oblivious Gateway Resource as an
HTTP client by constructing a request using the same restrictions as the Client
request, except that the target URI is the Oblivious Gateway Resource.  The
content of this request is copied from the Client.  An Oblivious Relay Resource <span class="bcp14">MAY</span> reject
requests that are obviously invalid, such as a request with no content. The Oblivious Relay
Resource <span class="bcp14">MUST NOT</span> add information to the request without the Client being aware of
the type of information that might be added; see <a class="auto internal xref" href="#relay-responsibilities">Section 6.2</a> for
more information on relay responsibilities.<a class="pilcrow" href="#section-5-4">¶</a></p>
<p id="section-5-5">When a response is received from the Oblivious Gateway Resource, the Oblivious
Relay Resource forwards the response according to the rules of an HTTP proxy;
see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6">Section 7.6</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>.  In case of timeout or error, the Oblivious Relay
Resource can generate a response with an appropriate status code.<a class="pilcrow" href="#section-5-5">¶</a></p>
<p id="section-5-6">In order to achieve the privacy and security goals of the protocol, an Oblivious
Relay Resource also needs to observe the guidance in <a class="auto internal xref" href="#relay-responsibilities">Section 6.2</a>.<a class="pilcrow" href="#section-5-6">¶</a></p>
<p id="section-5-7">An Oblivious Gateway Resource acts as a gateway for requests to the Target
Resource (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6">Section 7.6</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>).  The one exception is that any
information it might forward in a response <span class="bcp14">MUST</span> be encapsulated, unless it is
responding to errors that do not relate to processing the contents of the
Encapsulated Request; see <a class="auto internal xref" href="#errors">Section 5.2</a>.<a class="pilcrow" href="#section-5-7">¶</a></p>
<p id="section-5-8">An Oblivious Gateway Resource, if it receives any response from the Target
Resource, sends a single 200 response containing the <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a>.
Like the request from the Client, this response <span class="bcp14">MUST</span> only contain those fields
necessary to carry the Encapsulated Response: a 200 status code, a header field
indicating the content type, and the Encapsulated Response as the response
content.  As with requests, additional fields <span class="bcp14">MAY</span> be used to convey information
that does not reveal information about the Encapsulated Response.<a class="pilcrow" href="#section-5-8">¶</a></p>
<p id="section-5-9">An Oblivious Gateway Resource that does not receive a response can itself
generate a response with an appropriate error status code (such as 504 (Gateway
Timeout); see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-15.6.5">Section 15.6.5</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>), which is then encapsulated in the
same way as a successful response.<a class="pilcrow" href="#section-5-9">¶</a></p>
<p id="section-5-10">In order to achieve the privacy and security goals of the protocol, an Oblivious
Gateway Resource also needs to observe the guidance in
<a class="auto internal xref" href="#server-responsibilities">Section 6.3</a>.<a class="pilcrow" href="#section-5-10">¶</a></p>
<div id="informational-responses">
<section id="section-5.1">
        <h3 id="name-informational-responses">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-informational-responses">Informational Responses</a>
        </h3>
<p id="section-5.1-1">This encapsulation does not permit progressive processing of responses.
Though the binary HTTP response format does support the inclusion of
informational (1xx) status codes, the AEAD encapsulation cannot be removed until
the entire message is received.<a class="pilcrow" href="#section-5.1-1">¶</a></p>
<p id="section-5.1-2">In particular, the <code>Expect</code> header field with 100-continue (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-10.1.1">Section 10.1.1</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>) cannot be used.  <a class="internal xref" href="#dfn-client">Clients</a> <span class="bcp14">MUST NOT</span> construct a request that includes a
100-continue expectation; the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> <span class="bcp14">MUST</span> generate an error
if a 100-continue expectation is received.<a class="pilcrow" href="#section-5.1-2">¶</a></p>
</section>
</div>
<div id="errors">
<section id="section-5.2">
        <h3 id="name-errors">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-errors">Errors</a>
        </h3>
<p id="section-5.2-1">A server that receives an invalid message for any reason <span class="bcp14">MUST</span> generate an HTTP
response with a 4xx status code.<a class="pilcrow" href="#section-5.2-1">¶</a></p>
<p id="section-5.2-2">Errors detected by the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> and errors detected by the
<a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> before removing protection (including being unable to
remove encapsulation for any reason) result in the status code being sent
without protection in response to the POST request made to that resource.<a class="pilcrow" href="#section-5.2-2">¶</a></p>
<p id="section-5.2-3">Errors detected by the Oblivious Gateway Resource after successfully removing
encapsulation and errors detected by the <a class="internal xref" href="#dfn-target">Target Resource</a> <span class="bcp14">MUST</span> be sent in an
<a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a>.  This might be because the <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> is
malformed or the Target Resource does not produce a response.  In either case,
the Oblivious Gateway Resource can generate a response with an appropriate error
status code (such as 400 (Bad Request) or 504 (Gateway Timeout); see Sections <a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-15.5.1">15.5.1</a> and <a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-15.6.5">15.6.5</a> of <span>[<a class="cite xref" href="#HTTP">HTTP</a>]</span>, respectively).  This response is encapsulated in
the same way as a successful response.<a class="pilcrow" href="#section-5.2-3">¶</a></p>
<p id="section-5.2-4">Errors in the encapsulation of requests mean that responses cannot be
encapsulated.  This includes cases where the <a class="internal xref" href="#key-configuration">key configuration</a> is incorrect or
outdated.  The Oblivious Gateway Resource can generate and send a response with
a 4xx status code to the Oblivious Relay Resource.  This response <span class="bcp14">MAY</span> be
forwarded to the <a class="internal xref" href="#dfn-client">Client</a> or treated by the Oblivious Relay Resource as a failure.
If a Client receives a response that is not an Encapsulated Response, this could
indicate that the Client configuration used to construct the request is
incorrect or out of date.<a class="pilcrow" href="#section-5.2-4">¶</a></p>
</section>
</div>
<div id="ohttp-key-problem">
<section id="section-5.3">
        <h3 id="name-signaling-key-configuration">
<a class="section-number selfRef" href="#section-5.3">5.3. </a><a class="section-name selfRef" href="#name-signaling-key-configuration">Signaling Key Configuration Problems</a>
        </h3>
<p id="section-5.3-1">The problem type <span>[<a class="cite xref" href="#PROBLEM">PROBLEM</a>]</span> of
"https://iana.org/assignments/http-problem-types#ohttp-key" is defined in this
section.  An <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> <span class="bcp14">MAY</span> use this problem type in a response
to indicate that an <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> used an outdated or incorrect <a class="internal xref" href="#key-configuration">key
configuration</a>.<a class="pilcrow" href="#section-5.3-1">¶</a></p>
<p id="section-5.3-2"><a class="auto internal xref" href="#fig-key-problem">Figure 7</a> shows an example response in HTTP/1.1 format.<a class="pilcrow" href="#section-5.3-2">¶</a></p>
<span id="name-example-rejection-of-key-co"></span><div id="fig-key-problem">
<figure id="figure-7">
          <div class="lang-http-message sourcecode" id="section-5.3-3.1">
<pre>HTTP/1.1 400 Bad Request
Date: Mon, 07 Feb 2022 00:28:05 GMT
Content-Type: application/problem+json
Content-Length: 106

{"type":"https://iana.org/assignments/http-problem-types#ohttp-key",
"title": "key identifier unknown"}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-example-rejection-of-key-co">Example Rejection of Key Configuration</a>
          </figcaption></figure>
</div>
<p id="section-5.3-4">As this response cannot be encrypted, it might not reach the <a class="internal xref" href="#dfn-client">Client</a>.  A Client
cannot rely on the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> using this problem type.  A Client
might also be configured to disregard responses that are not encapsulated on the
basis that they might be subject to observation or modification by an Oblivious
Relay Resource.  A Client might manage the risk of an outdated key configuration
using a heuristic approach whereby it periodically refreshes its key
configuration if it receives a response with an error status code that has not
been encapsulated.<a class="pilcrow" href="#section-5.3-4">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security">
<section id="section-6">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-6-1">In this design, a <a class="internal xref" href="#dfn-client">Client</a> wishes to make a request to an <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a> that is forwarded to a <a class="internal xref" href="#dfn-target">Target Resource</a>. The Client wishes to make this
request without linking that request with either of the following:<a class="pilcrow" href="#section-6-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">The identity at the network and transport layer of the Client (that is, the
Client IP address and TCP or UDP port number the Client uses to create a
connection).<a class="pilcrow" href="#section-6-2.1.1">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">Any other request the Client might have made in the past or might make in the
future.<a class="pilcrow" href="#section-6-2.2.1">¶</a></p>
</li>
      </ul>
<p id="section-6-3">In order to ensure this, the Client selects a relay (that serves the
<a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a>) that it trusts will protect this information
by forwarding the Encapsulated Request and Response without passing it
to the server (that serves the Oblivious Gateway Resource).<a class="pilcrow" href="#section-6-3">¶</a></p>
<p id="section-6-4">In this section, a deployment where there are three entities is considered:<a class="pilcrow" href="#section-6-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-5.1">
          <p id="section-6-5.1.1">A Client makes requests and receives responses.<a class="pilcrow" href="#section-6-5.1.1">¶</a></p>
</li>
        <li class="normal" id="section-6-5.2">
          <p id="section-6-5.2.1">A relay operates the Oblivious Relay Resource.<a class="pilcrow" href="#section-6-5.2.1">¶</a></p>
</li>
        <li class="normal" id="section-6-5.3">
          <p id="section-6-5.3.1">A server operates both the Oblivious Gateway Resource and the Target Resource.<a class="pilcrow" href="#section-6-5.3.1">¶</a></p>
</li>
      </ul>
<p id="section-6-6"><a class="auto internal xref" href="#separate-target">Section 6.10</a> discusses the security implications for a case where
different servers operate the Oblivious Gateway Resource and Target Resource.<a class="pilcrow" href="#section-6-6">¶</a></p>
<p id="section-6-7">Requests from the Client to Oblivious Relay Resource and from Oblivious Relay
Resource to Oblivious Gateway Resource <span class="bcp14">MUST</span> use HTTPS in order to provide
unlinkability in the presence of a network observer.<a class="pilcrow" href="#section-6-7">¶</a></p>
<p id="section-6-8">To achieve the stated privacy goals, the Oblivious Relay Resource cannot be
operated by the same entity as the Oblivious Gateway Resource. However,
colocation of the Oblivious Gateway Resource and Target Resource simplifies the
interactions between those resources without affecting Client privacy.<a class="pilcrow" href="#section-6-8">¶</a></p>
<p id="section-6-9">As a consequence of this configuration, Oblivious HTTP prevents linkability
described above. Informally, this means:<a class="pilcrow" href="#section-6-9">¶</a></p>
<ol class="normal type-1" id="section-6-10" start="1" type="1">
<li id="section-6-10.1">
          <p id="section-6-10.1.1">Requests and responses are known only to Clients and Oblivious Gateway
Resources.  In particular, the Oblivious Relay Resource knows the origin and
destination of an Encapsulated Request and Response, yet it does not know the
decrypted contents.  Likewise, Oblivious Gateway Resources learn only the
Oblivious Relay Resource and the decrypted request.  No entity other than the
Client can see the plaintext request and response and can attribute them to
the Client.<a class="pilcrow" href="#section-6-10.1.1">¶</a></p>
</li>
        <li id="section-6-10.2">
          <p id="section-6-10.2.1">Oblivious Gateway Resources, and therefore Target Resources, cannot link
requests from the same Client in the absence of unique per-Client keys.<a class="pilcrow" href="#section-6-10.2.1">¶</a></p>
</li>
      </ol>
<p id="section-6-11">Traffic analysis that might affect these properties is outside the scope of this
document; see <a class="auto internal xref" href="#ta">Section 6.2.3</a>.<a class="pilcrow" href="#section-6-11">¶</a></p>
<p id="section-6-12">A formal analysis of Oblivious HTTP is in <span>[<a class="cite xref" href="#OHTTP-ANALYSIS">OHTTP-ANALYSIS</a>]</span>.<a class="pilcrow" href="#section-6-12">¶</a></p>
<div id="sec-client">
<section id="section-6.1">
        <h3 id="name-client-responsibilities">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-client-responsibilities">Client Responsibilities</a>
        </h3>
<p id="section-6.1-1">Because <a class="internal xref" href="#dfn-client">Clients</a> do not authenticate the <a class="internal xref" href="#dfn-target">Target Resource</a> when using Oblivious
HTTP, Clients <span class="bcp14">MUST</span> have some mechanism to authorize an <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a> for use with a Target Resource. One possible means of authorization is
an allowlist.  This ensures that Oblivious Gateway Resources are not misused to
forward traffic to arbitrary Target Resources. <a class="auto internal xref" href="#server-responsibilities">Section 6.3</a>
describes similar responsibilities that apply to Oblivious Gateway Resources.<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<p id="section-6.1-2">Clients <span class="bcp14">MUST</span> ensure that the <a class="internal xref" href="#key-configuration">key configuration</a> they select for generating
<a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a> is integrity protected and authenticated so that it can
be attributed to the Oblivious Gateway Resource; see <a class="auto internal xref" href="#key-configuration">Section 3</a>.<a class="pilcrow" href="#section-6.1-2">¶</a></p>
<p id="section-6.1-3">Since Clients connect directly to the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> instead of the
Target Resource, application configurations wherein Clients make policy
decisions about target connections, e.g., to apply certificate pinning, are
incompatible with Oblivious HTTP.  In such cases, alternative technologies such
as HTTP CONNECT (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6">Section 9.3.6</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>) can be used. Applications could
implement related policies on key configurations and relay connections, though
these might not provide the same properties as policies enforced directly on
target connections. Instead, when this difference is relevant, applications can
connect directly to the target at the cost of either privacy or performance.<a class="pilcrow" href="#section-6.1-3">¶</a></p>
<p id="section-6.1-4">Clients cannot carry connection-level state between requests as they only
establish direct connections to the relay responsible for the Oblivious Relay
Resource.  However, the content of requests might be used by a server to
correlate requests.  Cookies <span>[<a class="cite xref" href="#COOKIES">COOKIES</a>]</span> are the most obvious feature that might
be used to correlate requests, but any identity information and authentication
credentials might have the same effect.  Clients also need to treat information
learned from responses with similar care when constructing subsequent requests,
which includes the identity of resources.<a class="pilcrow" href="#section-6.1-4">¶</a></p>
<p id="section-6.1-5">Clients <span class="bcp14">MUST</span> generate a new HPKE context for every request, using a good source
of entropy <span>[<a class="cite xref" href="#RANDOM">RANDOM</a>]</span> for generating keys. Key reuse not only risks
requests being linked but also could expose request and response contents to the
relay.<a class="pilcrow" href="#section-6.1-5">¶</a></p>
<p id="section-6.1-6">The request the Client sends to the Oblivious Relay Resource only requires
minimal information; see <a class="auto internal xref" href="#http-usage">Section 5</a>. The request that carries the
Encapsulated Request and that is sent to the Oblivious Relay Resource <span class="bcp14">MUST NOT</span>
include identifying information unless the Client can trust that this
information is removed by the relay. A Client <span class="bcp14">MAY</span> include information only for
the Oblivious Relay Resource in header fields identified by the <code>Connection</code>
header field if it trusts the relay to remove these, as required by <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1">Section 7.6.1</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>. The Client needs to trust that the relay does not replicate the
source addressing information in the request it forwards.<a class="pilcrow" href="#section-6.1-6">¶</a></p>
<p id="section-6.1-7">Clients rely on the Oblivious Relay Resource to forward Encapsulated Requests
and Responses. However, the relay can only refuse to forward messages; it
cannot inspect or modify the contents of Encapsulated Requests or Responses.<a class="pilcrow" href="#section-6.1-7">¶</a></p>
</section>
</div>
<div id="relay-responsibilities">
<section id="section-6.2">
        <h3 id="name-relay-responsibilities">
<a class="section-number selfRef" href="#section-6.2">6.2. </a><a class="section-name selfRef" href="#name-relay-responsibilities">Relay Responsibilities</a>
        </h3>
<p id="section-6.2-1">The relay that serves the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> has a very simple function
to perform. For each request it receives, it makes a request of the <a class="internal xref" href="#dfn-gateway">Oblivious
Gateway Resource</a> that includes the same content. When it receives a response,
it sends a response to the <a class="internal xref" href="#dfn-client">Client</a> that includes the content of the response
from the Oblivious Gateway Resource.<a class="pilcrow" href="#section-6.2-1">¶</a></p>
<p id="section-6.2-2">When forwarding a request, the relay <span class="bcp14">MUST</span> follow the forwarding rules in
<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-7.6">Section 7.6</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>.  A generic HTTP intermediary implementation is suitable
for the purposes of serving an Oblivious Relay Resource, but additional care is
needed to ensure that Client privacy is maintained.<a class="pilcrow" href="#section-6.2-2">¶</a></p>
<p id="section-6.2-3">Firstly, a generic implementation will forward unknown fields.  For Oblivious
HTTP, an Oblivious Relay Resource <span class="bcp14">SHOULD NOT</span> forward unknown fields.  Though
Clients are not expected to include fields that might contain identifying
information, removing unknown fields removes this privacy risk.<a class="pilcrow" href="#section-6.2-3">¶</a></p>
<p id="section-6.2-4">Secondly, generic implementations are often configured to augment requests with
information about the Client, such as the Via field or the Forwarded field
<span>[<a class="cite xref" href="#FORWARDED">FORWARDED</a>]</span>.  A relay <span class="bcp14">MUST NOT</span> add information when forwarding
requests that might be used to identify Clients, except for information that
a Client is aware of; see <a class="auto internal xref" href="#differential">Section 6.2.1</a>.<a class="pilcrow" href="#section-6.2-4">¶</a></p>
<p id="section-6.2-5">Finally, a relay can also generate responses, though it is assumed to not be
able to examine the content of a request (other than to observe the choice of
key identifier, KDF, and AEAD); therefore, it is also assumed that it cannot
generate an <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a>.<a class="pilcrow" href="#section-6.2-5">¶</a></p>
<div id="differential">
<section id="section-6.2.1">
          <h4 id="name-differential-treatment">
<a class="section-number selfRef" href="#section-6.2.1">6.2.1. </a><a class="section-name selfRef" href="#name-differential-treatment">Differential Treatment</a>
          </h4>
<p id="section-6.2.1-1">A relay <span class="bcp14">MAY</span> add information to requests if the <a class="internal xref" href="#dfn-client">Client</a> is aware of the nature of
the information that could be added.  Any addition <span class="bcp14">MUST NOT</span> include information
that uniquely and permanently identifies the Client, including any pseudonymous identifier.
Information added by the relay -- beyond what is already revealed through
<a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a> from Clients -- can reduce the size of the anonymity set of
Clients at a gateway.<a class="pilcrow" href="#section-6.2.1-1">¶</a></p>
<p id="section-6.2.1-2">A Client does not need to be aware of the exact value added for each request
but needs to know the range of possible values the relay might use.  How
a Client might learn about added information is not defined in this document.<a class="pilcrow" href="#section-6.2.1-2">¶</a></p>
<p id="section-6.2.1-3">Moreover, relays <span class="bcp14">MAY</span> apply differential treatment to Clients that engage in
abusive behavior, e.g., by sending too many requests in comparison to other
Clients, or as a response to rate limits signaled from the gateway. Any such
differential treatment can reveal information to the gateway that would not be
revealed otherwise and therefore reduce the size of the anonymity set of Clients
using a gateway. For example, if a relay chooses to rate limit or block an
abusive Client, this means that any Client requests that are not treated this
way are known to be non-abusive by the gateway. Clients need to consider the
likelihood of such differential treatment and the privacy risks when using a
relay.<a class="pilcrow" href="#section-6.2.1-3">¶</a></p>
<p id="section-6.2.1-4">Some patterns of abuse cannot be detected without access to the request that is
made to the target. This means that only the gateway or the target is in a
position to identify abuse. A gateway <span class="bcp14">MAY</span> send signals toward the relay to
provide feedback about specific requests. For example, a gateway could respond
differently to requests it cannot decapsulate, as mentioned in <a class="auto internal xref" href="#errors">Section 5.2</a>. A
relay that acts on this feedback could -- either inadvertently or by design --
lead to Client deanonymization.<a class="pilcrow" href="#section-6.2.1-4">¶</a></p>
</section>
</div>
<div id="dos">
<section id="section-6.2.2">
          <h4 id="name-denial-of-service">
<a class="section-number selfRef" href="#section-6.2.2">6.2.2. </a><a class="section-name selfRef" href="#name-denial-of-service">Denial of Service</a>
          </h4>
<p id="section-6.2.2-1">As there are privacy benefits from having a large rate of requests forwarded by
the same relay (see <a class="auto internal xref" href="#ta">Section 6.2.3</a>), servers that operate the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>
might need an arrangement with <a class="internal xref" href="#dfn-relay">Oblivious Relay Resources</a>. This arrangement might
be necessary to prevent having the large volume of requests being classified as
an attack by the server.<a class="pilcrow" href="#section-6.2.2-1">¶</a></p>
<p id="section-6.2.2-2">If a server accepts a larger volume of requests from a relay, it needs to trust
that the relay does not allow abusive levels of request volumes from
<a class="internal xref" href="#dfn-client">Clients</a>. That is, if a server allows requests from the relay to be exempt from
rate limits, the server might want to ensure that the relay applies a
rate-limiting policy that is acceptable to the server.<a class="pilcrow" href="#section-6.2.2-2">¶</a></p>
<p id="section-6.2.2-3">Servers that enter into an agreement with a relay that enables a higher request
rate might choose to authenticate the relay to enable the higher rate.<a class="pilcrow" href="#section-6.2.2-3">¶</a></p>
</section>
</div>
<div id="ta">
<section id="section-6.2.3">
          <h4 id="name-traffic-analysis">
<a class="section-number selfRef" href="#section-6.2.3">6.2.3. </a><a class="section-name selfRef" href="#name-traffic-analysis">Traffic Analysis</a>
          </h4>
<p id="section-6.2.3-1">Using HTTPS protects information about which resources are the subject of
request and prevents a network observer from being able to trivially correlate
messages on either side of a relay.  However, using HTTPS does not prevent
traffic analysis by such network observers.<a class="pilcrow" href="#section-6.2.3-1">¶</a></p>
<p id="section-6.2.3-2">The time at which Encapsulated Request or Response messages are sent can
reveal information to a network observer. Though messages exchanged between the
<a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> and the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> might be sent in a
single connection, traffic analysis could be used to match messages that are
forwarded by the relay.<a class="pilcrow" href="#section-6.2.3-2">¶</a></p>
<p id="section-6.2.3-3">A relay could, as part of its function, delay requests before forwarding them.
Delays might increase the anonymity set into which each request is
attributed. Any delay also increases the time that a <a class="internal xref" href="#dfn-client">Client</a> waits for a
response, so delays <span class="bcp14">SHOULD</span> only be added with the consent -- or at least
awareness -- of Clients.<a class="pilcrow" href="#section-6.2.3-3">¶</a></p>
<p id="section-6.2.3-4">A relay that forwards large volumes of exchanges can provide better privacy by
providing larger sets of messages that need to be matched.<a class="pilcrow" href="#section-6.2.3-4">¶</a></p>
<p id="section-6.2.3-5">Traffic analysis is not restricted to network observers. A malicious Oblivious Relay Resource could
use traffic analysis to learn information about otherwise encrypted requests
and responses relayed between Clients and gateways. An Oblivious Relay Resource terminates
TLS connections from Clients, so they see message boundaries. This privileged
position allows for richer feature extraction from encrypted data, which might
improve traffic analysis.<a class="pilcrow" href="#section-6.2.3-5">¶</a></p>
<p id="section-6.2.3-6">Clients and Oblivious Gateway Resources can use padding to reduce the
effectiveness of traffic analysis.  Padding is a capability provided by binary
HTTP messages; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9292#section-3.8">Section 3.8</a> of [<a class="cite xref" href="#BINARY">BINARY</a>]</span>.  If the encapsulation method
described in this document is used to protect a different message type (see
<a class="auto internal xref" href="#repurposing">Section 4.6</a>), that message format might need to include padding support.
Oblivious Relay Resources can also use padding for the same reason but need to
operate at the HTTP layer since they cannot manipulate binary HTTP messages; for
example, see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9113#section-10.7">Section 10.7</a> of [<a class="cite xref" href="#HTTP2">HTTP/2</a>]</span> or <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9114#section-10.7">Section 10.7</a> of [<a class="cite xref" href="#HTTP3">HTTP/3</a>]</span>).<a class="pilcrow" href="#section-6.2.3-6">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server-responsibilities">
<section id="section-6.3">
        <h3 id="name-server-responsibilities">
<a class="section-number selfRef" href="#section-6.3">6.3. </a><a class="section-name selfRef" href="#name-server-responsibilities">Server Responsibilities</a>
        </h3>
<p id="section-6.3-1">The <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> can be operated by a different entity than the
<a class="internal xref" href="#dfn-target">Target Resource</a>.  However, this means that the <a class="internal xref" href="#dfn-client">Client</a> needs to trust the
Oblivious Gateway Resource not to modify requests or responses.  This analysis
concerns itself with a deployment scenario where a single server provides both
the Oblivious Gateway Resource and Target Resource.<a class="pilcrow" href="#section-6.3-1">¶</a></p>
<p id="section-6.3-2">A server that operates both Oblivious Gateway and Target Resources is
responsible for removing request encryption, generating a response to the
<a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>, and encrypting the response.<a class="pilcrow" href="#section-6.3-2">¶</a></p>
<p id="section-6.3-3">Servers should account for traffic analysis based on response size or generation
time.  Techniques such as padding or timing delays can help protect against such
attacks; see <a class="auto internal xref" href="#ta">Section 6.2.3</a>.<a class="pilcrow" href="#section-6.3-3">¶</a></p>
<p id="section-6.3-4">If separate entities provide the Oblivious Gateway Resource and Target Resource,
these entities might need an arrangement similar to that between server and
relay for managing denial of service; see <a class="auto internal xref" href="#dos">Section 6.2.2</a>. Moreover, the Oblivious
Gateway Resource <span class="bcp14">SHOULD</span> have some mechanism to ensure that the Oblivious Gateway
Resource is not misused as a relay for HTTP messages to an arbitrary Target
Resource, such as an allowlist.<a class="pilcrow" href="#section-6.3-4">¶</a></p>
<p id="section-6.3-5">Non-secure requests -- such as those with the "http" scheme as opposed to the
"https" scheme -- <span class="bcp14">SHOULD NOT</span> be used if the Oblivious Gateway and Target
Resources are not on the same origin.  If messages are forwarded between these
resources without the protections afforded by HTTPS, they could be inspected or
modified by a network attacker.  Note that a request could be forwarded without
protection if the two resources share an origin.<a class="pilcrow" href="#section-6.3-5">¶</a></p>
</section>
</div>
<div id="key-management">
<section id="section-6.4">
        <h3 id="name-key-management">
<a class="section-number selfRef" href="#section-6.4">6.4. </a><a class="section-name selfRef" href="#name-key-management">Key Management</a>
        </h3>
<p id="section-6.4-1">An <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> needs to have a plan for replacing keys. This
might include regular replacement of keys, which can be assigned new key
identifiers. If an Oblivious Gateway Resource receives a request that contains a
key identifier that it does not understand or that corresponds to a key that has
been replaced, the server can respond with an HTTP 422 (Unprocessable Content)
status code.<a class="pilcrow" href="#section-6.4-1">¶</a></p>
<p id="section-6.4-2">A server can also use a 422 status code if the server has a key that corresponds
to the key identifier, but the <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> cannot be successfully
decrypted using the key.<a class="pilcrow" href="#section-6.4-2">¶</a></p>
<p id="section-6.4-3">A server <span class="bcp14">MUST</span> ensure that the HPKE keys it uses are not valid for any other
protocol that uses HPKE with the "message/bhttp request" label.  Designers of
protocols that reuse this encryption format, especially new versions of this
protocol, can ensure key diversity by choosing a different label in their use of
HPKE.  The "message/bhttp response" label was chosen for symmetry only as it
provides key diversity only within the HPKE context created using the
"message/bhttp request" label; see <a class="auto internal xref" href="#repurposing">Section 4.6</a>.<a class="pilcrow" href="#section-6.4-3">¶</a></p>
</section>
</div>
<div id="replay">
<section id="section-6.5">
        <h3 id="name-replay-attacks">
<a class="section-number selfRef" href="#section-6.5">6.5. </a><a class="section-name selfRef" href="#name-replay-attacks">Replay Attacks</a>
        </h3>
<p id="section-6.5-1">A server is responsible for either rejecting replayed requests or ensuring that
the effect of replays does not adversely affect <a class="internal xref" href="#dfn-client">Clients</a> or resources.<a class="pilcrow" href="#section-6.5-1">¶</a></p>
<p id="section-6.5-2"><a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a> can be copied and replayed by the <a class="internal xref" href="#dfn-relay">Oblivious Relay
Resource</a>. The threat model for Oblivious HTTP allows the possibility that an
Oblivious Relay Resource might replay requests. Furthermore, if a Client sends
an Encapsulated Request in TLS early data (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8446#section-8">Section 8</a> of [<a class="cite xref" href="#TLS">TLS</a>]</span> and
<span>[<a class="cite xref" href="#RFC8470">RFC8470</a>]</span>), a network-based adversary might be able to cause the request to
be replayed. In both cases, the effect of a replay attack and the mitigations
that might be employed are similar to TLS early data.<a class="pilcrow" href="#section-6.5-2">¶</a></p>
<p id="section-6.5-3">It is the responsibility of the application that uses Oblivious HTTP to either
reject replayed requests or ensure that replayed requests have no adverse
effect on their operation.  This section describes some approaches that are
universally applicable and suggestions for more targeted techniques.<a class="pilcrow" href="#section-6.5-3">¶</a></p>
<p id="section-6.5-4">A Client or Oblivious Relay Resource <span class="bcp14">MUST NOT</span> automatically attempt to retry a
failed request unless it receives a positive signal indicating that the request
was not processed or forwarded. The HTTP/2 REFUSED_STREAM error code (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9113#section-8.1.4">Section 8.1.4</a> of [<a class="cite xref" href="#HTTP2">HTTP/2</a>]</span>), the HTTP/3 H3_REQUEST_REJECTED error code (<span><a class="relref" href="https://rfc-editor.org/rfc/rfc9114#section-8.1">Section 8.1</a> of [<a class="cite xref" href="#HTTP3">HTTP/3</a>]</span>), or a GOAWAY frame with a low enough identifier (in either protocol
version) are all sufficient signals that no processing occurred. HTTP/1.1
<span>[<a class="cite xref" href="#HTTP11">HTTP/1.1</a>]</span> provides no equivalent signal.  Connection failures or interruptions
are not sufficient signals that no processing occurred.<a class="pilcrow" href="#section-6.5-4">¶</a></p>
<p id="section-6.5-5">The anti-replay mechanisms described in <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8446#section-8">Section 8</a> of [<a class="cite xref" href="#TLS">TLS</a>]</span> are generally
applicable to Oblivious HTTP requests. The encapsulated keying material (or
<code>enc</code>) can be used in place of a nonce to uniquely identify a request.  This
value is a high-entropy value that is freshly generated for every request, so
two valid requests will have different values with overwhelming probability.<a class="pilcrow" href="#section-6.5-5">¶</a></p>
<p id="section-6.5-6">The mechanism used in TLS for managing differences in Client and server clocks
cannot be used as it depends on being able to observe previous interactions.
Oblivious HTTP explicitly prevents such linkability.<a class="pilcrow" href="#section-6.5-6">¶</a></p>
<p id="section-6.5-7">The considerations in <span>[<a class="cite xref" href="#RFC8470">RFC8470</a>]</span> as they relate to managing the risk of
replay also apply, though there is no option to delay the processing of a
request.<a class="pilcrow" href="#section-6.5-7">¶</a></p>
<p id="section-6.5-8">Limiting requests to those with safe methods might not be satisfactory for some
applications, particularly those that involve the submission of data to a
server. The use of idempotent methods might be of some use in managing replay
risk, though it is important to recognize that different idempotent requests
can be combined to be not idempotent.<a class="pilcrow" href="#section-6.5-8">¶</a></p>
<p id="section-6.5-9">Even without replay prevention, the server-chosen <code>response_nonce</code> field
ensures that responses have unique AEAD keys and nonces even when requests are
replayed.<a class="pilcrow" href="#section-6.5-9">¶</a></p>
<div id="use-of-date-for-anti-replay">
<section id="section-6.5.1">
          <h4 id="name-use-of-date-for-anti-replay">
<a class="section-number selfRef" href="#section-6.5.1">6.5.1. </a><a class="section-name selfRef" href="#name-use-of-date-for-anti-replay">Use of Date for Anti-replay</a>
          </h4>
<p id="section-6.5.1-1"><a class="internal xref" href="#dfn-client">Clients</a> <span class="bcp14">SHOULD</span> include a <code>Date</code> header field in <a class="internal xref" href="#dfn-enc-req">Encapsulated Requests</a>, unless
the Client has prior knowledge that indicates that the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a> does not use <code>Date</code> for anti-replay purposes.<a class="pilcrow" href="#section-6.5.1-1">¶</a></p>
<p id="section-6.5.1-2">Though HTTP requests often do not include a <code>Date</code> header field, the value of
this field might be used by a server to limit the amount of requests it needs to
track if it needs to prevent replay attacks.<a class="pilcrow" href="#section-6.5.1-2">¶</a></p>
<p id="section-6.5.1-3">An Oblivious Gateway Resource can maintain state for requests for a small window
of time over which it wishes to accept requests.  The Oblivious Gateway Resource
can store all requests it processes within this window.  Storing just the <code>enc</code>
field of a request, which should be unique to each request, is sufficient.  The
Oblivious Gateway Resource can reject any request that is the same as one that
was previously answered within that time window or if the <code>Date</code> header field
from the decrypted request is outside of the current time window.<a class="pilcrow" href="#section-6.5.1-3">¶</a></p>
<p id="section-6.5.1-4">Oblivious Gateway Resources might need to allow for the time it takes requests
to arrive from the Client, with a time window that is large enough to allow for
differences in clocks.  Insufficient tolerance of time differences could result
in valid requests being unnecessarily rejected.  Beyond allowing for multiple
round-trip times -- to account for retransmission -- network delays are unlikely
to be significant in determining the size of the window, unless all potential
Clients are known to have excellent timekeeping.  A specific window size might
need to be determined experimentally.<a class="pilcrow" href="#section-6.5.1-4">¶</a></p>
<p id="section-6.5.1-5">Oblivious Gateway Resources <span class="bcp14">MUST NOT</span> treat the time window as secret
information. An attacker can actively probe with different values for the <code>Date</code>
field to determine the time window over which the server will accept responses.<a class="pilcrow" href="#section-6.5.1-5">¶</a></p>
</section>
</div>
<div id="date-fix">
<section id="section-6.5.2">
          <h4 id="name-correcting-clock-difference">
<a class="section-number selfRef" href="#section-6.5.2">6.5.2. </a><a class="section-name selfRef" href="#name-correcting-clock-difference">Correcting Clock Differences</a>
          </h4>
<p id="section-6.5.2-1">An <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> can reject requests that contain a <code>Date</code> value
that is outside of its active window with a 400 series status code.  The problem
type <span>[<a class="cite xref" href="#PROBLEM">PROBLEM</a>]</span> of
"https://iana.org/assignments/http-problem-types#date" is defined to allow the
server to signal that the <code>Date</code> value in the request was unacceptable.<a class="pilcrow" href="#section-6.5.2-1">¶</a></p>
<p id="section-6.5.2-2"><a class="auto internal xref" href="#fig-date-reject">Figure 8</a> shows an example response in HTTP/1.1 format.<a class="pilcrow" href="#section-6.5.2-2">¶</a></p>
<span id="name-example-rejection-of-reques"></span><div id="fig-date-reject">
<figure id="figure-8">
            <div class="lang-http-message sourcecode" id="section-6.5.2-3.1">
<pre>HTTP/1.1 400 Bad Request
Date: Mon, 07 Feb 2022 00:28:05 GMT
Content-Type: application/problem+json
Content-Length: 128

{"type":"https://iana.org/assignments/http-problem-types#date",
"title": "date field in request outside of acceptable range"}
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-example-rejection-of-reques">Example Rejection of Request Date Field</a>
            </figcaption></figure>
</div>
<p id="section-6.5.2-4">Disagreements about time are unlikely if both <a class="internal xref" href="#dfn-client">Client</a> and Oblivious Gateway
Resource have a good source of time; see <span>[<a class="cite xref" href="#NTP">NTP</a>]</span>. However, clock
differences are known to be commonplace; see Section 7.1 of
<span>[<a class="cite xref" href="#CLOCKSKEW">CLOCKSKEW</a>]</span>.<a class="pilcrow" href="#section-6.5.2-4">¶</a></p>
<p id="section-6.5.2-5">Including a <code>Date</code> header field in the response allows the Client to correct
clock errors by retrying the same request using the value of the <code>Date</code> field
provided by the Oblivious Gateway Resource.  The value of the <code>Date</code> field can
be copied if the response is fresh, with an adjustment based on the <code>Age</code> field
otherwise; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9111#section-4.2">Section 4.2</a> of [<a class="cite xref" href="#HTTP-CACHING">HTTP-CACHING</a>]</span>.  When retrying a request, the
Client <span class="bcp14">MUST</span> create a fresh encryption of the modified request, using a new HPKE
context.<a class="pilcrow" href="#section-6.5.2-5">¶</a></p>
<span id="name-retrying-with-an-updated-da"></span><div id="fig-retry-date">
<figure id="figure-9">
            <div id="section-6.5.2-6.1">
              <div class="alignLeft art-svg artwork" id="section-6.5.2-6.1.1">
<svg class="diagram" font-family="monospace" font-size="13px" height="304" text-anchor="middle" version="1.1" viewBox="0 0 464 304" width="464" xmlns="http://www.w3.org/2000/svg">
                  <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                  <path d="M 48,80 L 48,288" fill="none" stroke="black"></path>
                  <path d="M 88,32 L 88,80" fill="none" stroke="black"></path>
                  <path d="M 152,32 L 152,80" fill="none" stroke="black"></path>
                  <path d="M 192,80 L 192,128" fill="none" stroke="black"></path>
                  <path d="M 192,160 L 192,192" fill="none" stroke="black"></path>
                  <path d="M 192,224 L 192,256" fill="none" stroke="black"></path>
                  <path d="M 288,80 L 288,288" fill="none" stroke="black"></path>
                  <path d="M 312,32 L 312,80" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 368,80" fill="none" stroke="black"></path>
                  <path d="M 408,80 L 408,288" fill="none" stroke="black"></path>
                  <path d="M 456,32 L 456,80" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 88,32" fill="none" stroke="black"></path>
                  <path d="M 152,32 L 312,32" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 456,32" fill="none" stroke="black"></path>
                  <path d="M 8,80 L 88,80" fill="none" stroke="black"></path>
                  <path d="M 152,80 L 312,80" fill="none" stroke="black"></path>
                  <path d="M 368,80 L 456,80" fill="none" stroke="black"></path>
                  <path d="M 48,142 L 280,142" fill="none" stroke="black"></path>
                  <path d="M 48,146 L 280,146" fill="none" stroke="black"></path>
                  <path d="M 288,144 L 400,144" fill="none" stroke="black"></path>
                  <path d="M 56,206 L 288,206" fill="none" stroke="black"></path>
                  <path d="M 56,210 L 288,210" fill="none" stroke="black"></path>
                  <path d="M 296,208 L 408,208" fill="none" stroke="black"></path>
                  <path d="M 48,270 L 280,270" fill="none" stroke="black"></path>
                  <path d="M 48,274 L 280,274" fill="none" stroke="black"></path>
                  <path d="M 288,272 L 400,272" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" fill="black" points="408,272 396,266.4 396,277.6" transform="rotate(0,400,272)"></polygon>
                  <polygon class="arrowhead" fill="black" points="408,144 396,138.4 396,149.6" transform="rotate(0,400,144)"></polygon>
                  <polygon class="arrowhead" fill="black" points="304,208 292,202.4 292,213.6" transform="rotate(180,296,208)"></polygon>
                  <polygon class="arrowhead" fill="black" points="288,272 276,266.4 276,277.6" transform="rotate(0,280,272)"></polygon>
                  <polygon class="arrowhead" fill="black" points="288,144 276,138.4 276,149.6" transform="rotate(0,280,144)"></polygon>
                  <polygon class="arrowhead" fill="black" points="64,208 52,202.4 52,213.6" transform="rotate(180,56,208)"></polygon>
                  <g class="text">
                    <text x="44" y="52">Client</text>
                    <text x="184" y="52">Relay</text>
                    <text x="224" y="52">and</text>
                    <text x="272" y="52">Gateway</text>
                    <text x="404" y="52">Target</text>
                    <text x="232" y="68">Resources</text>
                    <text x="412" y="68">Resource</text>
                    <text x="96" y="132">Request</text>
                    <text x="312" y="180">400</text>
                    <text x="364" y="180">Response</text>
                    <text x="352" y="196">+</text>
                    <text x="380" y="196">Date</text>
                    <text x="96" y="244">Request</text>
                    <text x="72" y="260">+</text>
                    <text x="112" y="260">Updated</text>
                    <text x="164" y="260">Date</text>
                    <text x="192" y="292">|</text>
                  </g>
                </svg><a class="pilcrow" href="#section-6.5.2-6.1.1">¶</a>
</div>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-retrying-with-an-updated-da">Retrying with an Updated Date Field</a>
            </figcaption></figure>
</div>
<p id="section-6.5.2-7">Retrying immediately allows the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> to measure the
round-trip time to the <a class="internal xref" href="#dfn-client">Client</a>. The observed delay might reveal something about
the location of the Client.  Clients could delay retries to add some uncertainty
to any observed delay.<a class="pilcrow" href="#section-6.5.2-7">¶</a></p>
<p id="section-6.5.2-8">Intermediaries can sometimes rewrite the <code>Date</code> field when forwarding responses.
This might cause problems if the Oblivious Gateway Resource and intermediary
clocks differ by enough to cause the retry to be rejected.  Therefore, Clients
            <span class="bcp14">MUST NOT</span> retry a request with an adjusted date more than once.<a class="pilcrow" href="#section-6.5.2-8">¶</a></p>
<p id="section-6.5.2-9">Oblivious Gateway Resources that condition their responses on the <code>Date</code> header
field <span class="bcp14">SHOULD</span> either ensure that intermediaries do not cache responses (by
including a <code>Cache-Control</code> directive of <code>no-store</code>) or designate the response
as conditional on the value of the <code>Date</code> request header field (by including the
token "date" in a <code>Vary</code> header field).<a class="pilcrow" href="#section-6.5.2-9">¶</a></p>
<p id="section-6.5.2-10">Clients <span class="bcp14">MUST NOT</span> use the date provided by the Oblivious Gateway Resource for any
other purpose, including future requests to any resource.  Any request that uses
information provided by the Oblivious Gateway Resource might be correlated using
that information.<a class="pilcrow" href="#section-6.5.2-10">¶</a></p>
</section>
</div>
</section>
</div>
<div id="forward-secrecy">
<section id="section-6.6">
        <h3 id="name-forward-secrecy">
<a class="section-number selfRef" href="#section-6.6">6.6. </a><a class="section-name selfRef" href="#name-forward-secrecy">Forward Secrecy</a>
        </h3>
<p id="section-6.6-1">This document does not provide forward secrecy for either requests or
responses during the lifetime of the <a class="internal xref" href="#key-configuration">key configuration</a>. A measure of
forward secrecy can be provided by generating a new key configuration
then deleting the old keys after a suitable period.<a class="pilcrow" href="#section-6.6-1">¶</a></p>
</section>
</div>
<div id="post-compromise-security">
<section id="section-6.7">
        <h3 id="name-post-compromise-security">
<a class="section-number selfRef" href="#section-6.7">6.7. </a><a class="section-name selfRef" href="#name-post-compromise-security">Post-Compromise Security</a>
        </h3>
<p id="section-6.7-1">This design does not provide post-compromise security for responses.<a class="pilcrow" href="#section-6.7-1">¶</a></p>
<p id="section-6.7-2">A <a class="internal xref" href="#dfn-client">Client</a> only needs to retain keying material that might be used to compromise
the confidentiality and integrity of a response until that response is consumed,
so there is negligible risk associated with a Client compromise.<a class="pilcrow" href="#section-6.7-2">¶</a></p>
<p id="section-6.7-3">A server retains a secret key that might be used to remove protection from
messages over much longer periods. A server compromise that provided access to
the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> secret key could allow an attacker to recover the
plaintext of all requests sent toward affected keys and all of the responses
that were generated.<a class="pilcrow" href="#section-6.7-3">¶</a></p>
<p id="section-6.7-4">Even if server keys are compromised, an adversary cannot access messages
exchanged by the Client with the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> as messages are
protected by TLS.  Use of a compromised key also requires that the Oblivious
Relay Resource cooperate with the attacker or that the attacker is able to
compromise these TLS connections.<a class="pilcrow" href="#section-6.7-4">¶</a></p>
<p id="section-6.7-5">The total number of messages affected by server key compromise can be limited by
regular rotation of server keys.<a class="pilcrow" href="#section-6.7-5">¶</a></p>
</section>
</div>
<div id="client-clock-exposure">
<section id="section-6.8">
        <h3 id="name-client-clock-exposure">
<a class="section-number selfRef" href="#section-6.8">6.8. </a><a class="section-name selfRef" href="#name-client-clock-exposure">Client Clock Exposure</a>
        </h3>
<p id="section-6.8-1">Including a <code>Date</code> field in requests reveals some information about the <a class="internal xref" href="#dfn-client">Client</a>
clock.  This might be used to fingerprint Clients <span>[<a class="cite xref" href="#UWT">UWT</a>]</span> or to identify Clients
that are vulnerable to attacks that depend on incorrect clocks.<a class="pilcrow" href="#section-6.8-1">¶</a></p>
<p id="section-6.8-2">Clients can randomize the value that they provide for <code>Date</code> to obscure the true
value of their clock and reduce the chance of linking requests over time.
However, this increases the risk that their request is rejected as outside the
acceptable window.<a class="pilcrow" href="#section-6.8-2">¶</a></p>
</section>
</div>
<div id="sec-media">
<section id="section-6.9">
        <h3 id="name-media-type-security">
<a class="section-number selfRef" href="#section-6.9">6.9. </a><a class="section-name selfRef" href="#name-media-type-security">Media Type Security</a>
        </h3>
<p id="section-6.9-1">The <a class="internal xref" href="#key-configuration">key configuration</a> media type defined in <a class="auto internal xref" href="#ohttp-keys">Section 3.2</a> represents keying
material.  The content of this media type is not active (see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc6838#section-4.6">Section 4.6</a> of [<a class="cite xref" href="#RFC6838">RFC6838</a>]</span>), but it governs how a <a class="internal xref" href="#dfn-client">Client</a> might interact with an <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a>.  The security implications of processing it are described in
<a class="auto internal xref" href="#sec-client">Section 6.1</a>; privacy implications are described in <a class="auto internal xref" href="#privacy">Section 7</a>.<a class="pilcrow" href="#section-6.9-1">¶</a></p>
<p id="section-6.9-2">The security implications of handling the message media types defined in
<a class="auto internal xref" href="#req-res-media">Section 4.5</a> is covered in other parts of this section in more detail.
However, these message media types are also encrypted encapsulations of HTTP
requests and responses.<a class="pilcrow" href="#section-6.9-2">¶</a></p>
<p id="section-6.9-3">HTTP messages contain content, which can use any media type.  In particular,
requests are processed by an Oblivious <a class="internal xref" href="#dfn-target">Target Resource</a>, which -- as an HTTP
resource -- defines how content is processed; see <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-3.1">Section 3.1</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span>.  HTTP
clients can also use resource identity and response content to determine how
content is processed.  Consequently, the security considerations of <span><a class="relref" href="https://rfc-editor.org/rfc/rfc9110#section-17">Section 17</a> of [<a class="cite xref" href="#HTTP">HTTP</a>]</span> also apply to the handling of the content of these media types.<a class="pilcrow" href="#section-6.9-3">¶</a></p>
</section>
</div>
<div id="separate-target">
<section id="section-6.10">
        <h3 id="name-separate-gateway-and-target">
<a class="section-number selfRef" href="#section-6.10">6.10. </a><a class="section-name selfRef" href="#name-separate-gateway-and-target">Separate Gateway and Target</a>
        </h3>
<p id="section-6.10-1">This document generally assumes that the same entity operates the <a class="internal xref" href="#dfn-gateway">Oblivious
Gateway Resource</a> and the <a class="internal xref" href="#dfn-target">Target Resource</a>.  However, as the Oblivious Gateway
Resource performs generic HTTP processing, the use of forwarding cannot be
completely precluded.<a class="pilcrow" href="#section-6.10-1">¶</a></p>
<p id="section-6.10-2">The scheme specified in the <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a> determines the security
requirements for any protocol that is used between the Oblivious Gateway and
Target Resources.  Using HTTPS is <span class="bcp14">RECOMMENDED</span>; see <a class="auto internal xref" href="#server-responsibilities">Section 6.3</a>.<a class="pilcrow" href="#section-6.10-2">¶</a></p>
<p id="section-6.10-3">A Target Resource that is operated on a different server from the Oblivious
Gateway Resource is an ordinary HTTP resource.  A Target Resource can privilege
requests that are forwarded by a given Oblivious Gateway Resource if it trusts
the operator of the Oblivious Gateway Resource to only forward requests that
meet the expectations of the Target Resource.  Otherwise, the Target Resource
treats requests from an Oblivious Gateway Resource no differently than any
other HTTP client.<a class="pilcrow" href="#section-6.10-3">¶</a></p>
<p id="section-6.10-4">For instance, an Oblivious Gateway Resource might -- possibly with the help of
<a class="internal xref" href="#dfn-relay">Oblivious Relay Resources</a> -- be trusted not to forward an excessive volume of
requests. This might allow the Target Resource to accept a greater volume of
requests from that Oblivious Gateway Resource relative to other HTTP clients.<a class="pilcrow" href="#section-6.10-4">¶</a></p>
<p id="section-6.10-5">An Oblivious Gateway Resource could implement policies that improve the ability
of the Target Resource to implement policy exemptions, such as only forwarding
requests toward specific Target Resources according to an allowlist; see <a class="auto internal xref" href="#server-responsibilities">Section 6.3</a>.<a class="pilcrow" href="#section-6.10-5">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy">
<section id="section-7">
      <h2 id="name-privacy-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-privacy-considerations">Privacy Considerations</a>
      </h2>
<p id="section-7-1">One goal of this design is that independent <a class="internal xref" href="#dfn-client">Client</a> requests are only linkable by
their content.  However, the choice of Client configuration might be used to
correlate requests.  A Client configuration includes the <a class="internal xref" href="#dfn-relay">Oblivious Relay
Resource</a> URI, the Oblivious Gateway <a class="internal xref" href="#key-configuration">key configuration</a>, and the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway
Resource</a> URI. A configuration is active if Clients can successfully use it for
interacting with a target.<a class="pilcrow" href="#section-7-1">¶</a></p>
<p id="section-7-2">Oblivious Relay and Gateway Resources can identify when requests use the same
configuration by matching the key identifier from the key configuration or the
Oblivious Gateway Resource URI.  The Oblivious Gateway Resource might use the
source address of requests to correlate requests that use an Oblivious Relay
Resource run by the same operator.  If the Oblivious Gateway Resource is willing
to use trial decryption, requests can be further separated into smaller
groupings based on active configurations that clients use.<a class="pilcrow" href="#section-7-2">¶</a></p>
<p id="section-7-3">Each active Client configuration partitions the Client anonymity set. In
practice, it is infeasible to reduce the number of active configurations to
one. Enabling diversity in choice of Oblivious Relay Resource naturally
increases the number of active configurations.  More than one configuration
might need to be active to allow for key rotation and server maintenance.<a class="pilcrow" href="#section-7-3">¶</a></p>
<p id="section-7-4">Client privacy depends on having each configuration used by many other Clients.
It is critical to prevent the use of unique Client configurations, which might
be used to track individual Clients, but it is also important to avoid
creating small groupings of Clients that might weaken privacy protections.<a class="pilcrow" href="#section-7-4">¶</a></p>
<p id="section-7-5">A specific method for a Client to acquire configurations is not included in this
specification.  Applications using this design <span class="bcp14">MUST</span> provide accommodations to
mitigate tracking using Client configurations.  <span>[<a class="cite xref" href="#CONSISTENCY">CONSISTENCY</a>]</span> provides options
for ensuring that Client configurations are consistent between Clients.<a class="pilcrow" href="#section-7-5">¶</a></p>
<p id="section-7-6">The content of requests or responses, if used in forming new requests, can be
used to correlate requests.  This includes obvious methods of linking requests,
like cookies <span>[<a class="cite xref" href="#COOKIES">COOKIES</a>]</span>, but it also includes any information in either
message that might affect how subsequent requests are formulated. For example,
<span>[<a class="cite xref" href="#FIELDING">FIELDING</a>]</span> describes how interactions that are individually stateless can be
used to build a stateful system when a Client acts on the content of a response.<a class="pilcrow" href="#section-7-6">¶</a></p>
</section>
</div>
<div id="deployment">
<section id="section-8">
      <h2 id="name-operational-and-deployment-">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-operational-and-deployment-">Operational and Deployment Considerations</a>
      </h2>
<p id="section-8-1">This section discusses various operational and deployment considerations.<a class="pilcrow" href="#section-8-1">¶</a></p>
<div id="performance-overhead">
<section id="section-8.1">
        <h3 id="name-performance-overhead">
<a class="section-number selfRef" href="#section-8.1">8.1. </a><a class="section-name selfRef" href="#name-performance-overhead">Performance Overhead</a>
        </h3>
<p id="section-8.1-1">Using Oblivious HTTP adds both cryptographic overhead and latency to requests
relative to a simple HTTP request-response exchange.  Deploying relay services
that are on path between <a class="internal xref" href="#dfn-client">Clients</a> and servers avoids adding significant
additional delay due to network topology.  A study of a similar system
<span>[<a class="cite xref" href="#ODOH-PETS">ODOH-PETS</a>]</span> found that deploying proxies close to servers was most effective
in minimizing additional latency.<a class="pilcrow" href="#section-8.1-1">¶</a></p>
</section>
</div>
<div id="proxy-state">
<section id="section-8.2">
        <h3 id="name-resource-mappings">
<a class="section-number selfRef" href="#section-8.2">8.2. </a><a class="section-name selfRef" href="#name-resource-mappings">Resource Mappings</a>
        </h3>
<p id="section-8.2-1">This protocol assumes a fixed, one-to-one mapping between the <a class="internal xref" href="#dfn-relay">Oblivious Relay
Resource</a> and the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a>. This means that any <a class="internal xref" href="#dfn-enc-req">Encapsulated
Request</a> sent to the Oblivious Relay Resource will always be forwarded to the
Oblivious Gateway Resource. This constraint was imposed to simplify relay
configuration and mitigate against the Oblivious Relay Resource being used as
a generic relay for unknown Oblivious Gateway Resources. The relay will only
forward for Oblivious Gateway Resources that it has explicitly configured and
allowed.<a class="pilcrow" href="#section-8.2-1">¶</a></p>
<p id="section-8.2-2">It is possible for a server to be configured with multiple Oblivious Relay
Resources, each for a different Oblivious Gateway Resource as needed.  If the
goal is to support a large number of Oblivious Gateway Resources, <a class="internal xref" href="#dfn-client">Clients</a> might
be provided with a URI template <span>[<a class="cite xref" href="#TEMPLATE">TEMPLATE</a>]</span>, from which multiple
Oblivious Relay Resources could be constructed.<a class="pilcrow" href="#section-8.2-2">¶</a></p>
</section>
</div>
<div id="network-management">
<section id="section-8.3">
        <h3 id="name-network-management">
<a class="section-number selfRef" href="#section-8.3">8.3. </a><a class="section-name selfRef" href="#name-network-management">Network Management</a>
        </h3>
<p id="section-8.3-1">Oblivious HTTP might be incompatible with network interception regimes, such as
those that rely on configuring <a class="internal xref" href="#dfn-client">Clients</a> with trust anchors and intercepting TLS
connections.  While TLS might be intercepted successfully, interception
middlebox devices might not receive updates that would allow Oblivious HTTP to
be correctly identified using the media types defined in Sections <a class="auto internal xref" href="#iana-req">9.2</a>
and <a class="auto internal xref" href="#iana-res">9.3</a>.<a class="pilcrow" href="#section-8.3-1">¶</a></p>
<p id="section-8.3-2">Oblivious HTTP has a simple key management design that is not trivially altered
to enable interception by intermediaries.  Clients that are configured to enable
interception might choose to disable Oblivious HTTP in order to ensure that
content is accessible to middleboxes.<a class="pilcrow" href="#section-8.3-2">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-9-1">IANA has registered the following media types in the "Media Types" registry at
<span>&lt;<a href="https://iana.org/assignments/media-types">https://iana.org/assignments/media-types</a>&gt;</span>, following the procedures of
<span>[<a class="cite xref" href="#RFC6838">RFC6838</a>]</span>: "<code>application/ohttp-keys</code>" (<a class="auto internal xref" href="#iana-keys">Section 9.1</a>), "<code>message/ohttp-req</code>"
(<a class="auto internal xref" href="#iana-req">Section 9.2</a>), and "<code>message/ohttp-res</code>" (<a class="auto internal xref" href="#iana-res">Section 9.3</a>).<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">IANA has added the following types to the "HTTP Problem Types" registry at
<span>&lt;<a href="https://iana.org/assignments/http-problem-types">https://iana.org/assignments/http-problem-types</a>&gt;</span>: "date"
(<a class="auto internal xref" href="#iana-problem-date">Section 9.4</a>) and "ohttp-key" (<a class="auto internal xref" href="#iana-problem-ohttp-key">Section 9.5</a>).<a class="pilcrow" href="#section-9-2">¶</a></p>
<div id="iana-keys">
<section id="section-9.1">
        <h3 id="name-application-ohttp-keys-medi">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-application-ohttp-keys-medi">application/ohttp-keys Media Type</a>
        </h3>
<p id="section-9.1-1">The "<code>application/ohttp-keys</code>" media type identifies a <a class="internal xref" href="#key-configuration">key configuration</a> used by
Oblivious HTTP.<a class="pilcrow" href="#section-9.1-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.1-2">
          <dt id="section-9.1-2.1">Type name:</dt>
          <dd id="section-9.1-2.2" style="margin-left: 1.5em">
            <p id="section-9.1-2.2.1">application<a class="pilcrow" href="#section-9.1-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.3">Subtype name:</dt>
          <dd id="section-9.1-2.4" style="margin-left: 1.5em">
            <p id="section-9.1-2.4.1">ohttp-keys<a class="pilcrow" href="#section-9.1-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.5">Required parameters:</dt>
          <dd id="section-9.1-2.6" style="margin-left: 1.5em">
            <p id="section-9.1-2.6.1">N/A<a class="pilcrow" href="#section-9.1-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.7">Optional parameters:</dt>
          <dd id="section-9.1-2.8" style="margin-left: 1.5em">
            <p id="section-9.1-2.8.1">N/A<a class="pilcrow" href="#section-9.1-2.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.9">Encoding considerations:</dt>
          <dd id="section-9.1-2.10" style="margin-left: 1.5em">
            <p id="section-9.1-2.10.1">"binary"<a class="pilcrow" href="#section-9.1-2.10.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.11">Security considerations:</dt>
          <dd id="section-9.1-2.12" style="margin-left: 1.5em">
            <p id="section-9.1-2.12.1">See <a class="auto internal xref" href="#sec-media">Section 6.9</a><a class="pilcrow" href="#section-9.1-2.12.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.13">Interoperability considerations:</dt>
          <dd id="section-9.1-2.14" style="margin-left: 1.5em">
            <p id="section-9.1-2.14.1">N/A<a class="pilcrow" href="#section-9.1-2.14.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.15">Published specification:</dt>
          <dd id="section-9.1-2.16" style="margin-left: 1.5em">
            <p id="section-9.1-2.16.1">RFC 9458<a class="pilcrow" href="#section-9.1-2.16.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.17">Applications that use this media type:</dt>
          <dd id="section-9.1-2.18" style="margin-left: 1.5em">
            <p id="section-9.1-2.18.1">This type identifies a key configuration as used by Oblivious HTTP and
applications that use Oblivious HTTP.<a class="pilcrow" href="#section-9.1-2.18.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.19">Fragment identifier considerations:</dt>
          <dd id="section-9.1-2.20" style="margin-left: 1.5em">
            <p id="section-9.1-2.20.1">N/A<a class="pilcrow" href="#section-9.1-2.20.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.21">Additional information:</dt>
          <dd id="section-9.1-2.22" style="margin-left: 1.5em">
            <p id="section-9.1-2.22.1"><br/></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.1-2.22.2">
              <dt id="section-9.1-2.22.2.1">Magic number(s):</dt>
              <dd id="section-9.1-2.22.2.2" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.1-2.22.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.2.3">Deprecated alias names for this type:</dt>
              <dd id="section-9.1-2.22.2.4" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.1-2.22.2.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.2.5">File extension(s):</dt>
              <dd id="section-9.1-2.22.2.6" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.1-2.22.2.6">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.1-2.22.2.7">Macintosh file type code(s):</dt>
              <dd id="section-9.1-2.22.2.8" style="margin-left: 1.5em">
                <p id="section-9.1-2.22.2.8.1">N/A<a class="pilcrow" href="#section-9.1-2.22.2.8.1">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.23">Person and email address to contact for further information:</dt>
          <dd id="section-9.1-2.24" style="margin-left: 1.5em">
            <p id="section-9.1-2.24.1"><br/>See Authors' Addresses section<a class="pilcrow" href="#section-9.1-2.24.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.25">Intended usage:</dt>
          <dd id="section-9.1-2.26" style="margin-left: 1.5em">
            <p id="section-9.1-2.26.1">COMMON<a class="pilcrow" href="#section-9.1-2.26.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.27">Restrictions on usage:</dt>
          <dd id="section-9.1-2.28" style="margin-left: 1.5em">
            <p id="section-9.1-2.28.1">N/A<a class="pilcrow" href="#section-9.1-2.28.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.29">Author:</dt>
          <dd id="section-9.1-2.30" style="margin-left: 1.5em">
            <p id="section-9.1-2.30.1">See Authors' Addresses section<a class="pilcrow" href="#section-9.1-2.30.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-2.31">Change controller:</dt>
          <dd id="section-9.1-2.32" style="margin-left: 1.5em">
            <p id="section-9.1-2.32.1">IETF<a class="pilcrow" href="#section-9.1-2.32.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-req">
<section id="section-9.2">
        <h3 id="name-message-ohttp-req-media-typ">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-message-ohttp-req-media-typ">message/ohttp-req Media Type</a>
        </h3>
<p id="section-9.2-1">The "<code>message/ohttp-req</code>" identifies an encrypted binary HTTP request.  This
is a binary format that is defined in <a class="auto internal xref" href="#request">Section 4.3</a>.<a class="pilcrow" href="#section-9.2-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.2-2">
          <dt id="section-9.2-2.1">Type name:</dt>
          <dd id="section-9.2-2.2" style="margin-left: 1.5em">
            <p id="section-9.2-2.2.1">message<a class="pilcrow" href="#section-9.2-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.3">Subtype name:</dt>
          <dd id="section-9.2-2.4" style="margin-left: 1.5em">
            <p id="section-9.2-2.4.1">ohttp-req<a class="pilcrow" href="#section-9.2-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.5">Required parameters:</dt>
          <dd id="section-9.2-2.6" style="margin-left: 1.5em">
            <p id="section-9.2-2.6.1">N/A<a class="pilcrow" href="#section-9.2-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.7">Optional parameters:</dt>
          <dd id="section-9.2-2.8" style="margin-left: 1.5em">
            <p id="section-9.2-2.8.1">N/A<a class="pilcrow" href="#section-9.2-2.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.9">Encoding considerations:</dt>
          <dd id="section-9.2-2.10" style="margin-left: 1.5em">
            <p id="section-9.2-2.10.1">"binary"<a class="pilcrow" href="#section-9.2-2.10.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.11">Security considerations:</dt>
          <dd id="section-9.2-2.12" style="margin-left: 1.5em">
            <p id="section-9.2-2.12.1">See <a class="auto internal xref" href="#sec-media">Section 6.9</a><a class="pilcrow" href="#section-9.2-2.12.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.13">Interoperability considerations:</dt>
          <dd id="section-9.2-2.14" style="margin-left: 1.5em">
            <p id="section-9.2-2.14.1">N/A<a class="pilcrow" href="#section-9.2-2.14.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.15">Published specification:</dt>
          <dd id="section-9.2-2.16" style="margin-left: 1.5em">
            <p id="section-9.2-2.16.1">RFC 9458<a class="pilcrow" href="#section-9.2-2.16.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.17">Applications that use this media type:</dt>
          <dd id="section-9.2-2.18" style="margin-left: 1.5em">
            <p id="section-9.2-2.18.1">Oblivious HTTP and applications that use Oblivious HTTP use this media type to
identify encapsulated binary HTTP requests.<a class="pilcrow" href="#section-9.2-2.18.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.19">Fragment identifier considerations:</dt>
          <dd id="section-9.2-2.20" style="margin-left: 1.5em">
            <p id="section-9.2-2.20.1">N/A<a class="pilcrow" href="#section-9.2-2.20.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.21">Additional information:</dt>
          <dd id="section-9.2-2.22" style="margin-left: 1.5em">
            <p id="section-9.2-2.22.1"><br/></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.2-2.22.2">
              <dt id="section-9.2-2.22.2.1">Magic number(s):</dt>
              <dd id="section-9.2-2.22.2.2" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.2-2.22.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.2.3">Deprecated alias names for this type:</dt>
              <dd id="section-9.2-2.22.2.4" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.2-2.22.2.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.2.5">File extension(s):</dt>
              <dd id="section-9.2-2.22.2.6" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.2-2.22.2.6">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.2-2.22.2.7">Macintosh file type code(s):</dt>
              <dd id="section-9.2-2.22.2.8" style="margin-left: 1.5em">
                <p id="section-9.2-2.22.2.8.1">N/A<a class="pilcrow" href="#section-9.2-2.22.2.8.1">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.23">Person and email address to contact for further information:</dt>
          <dd id="section-9.2-2.24" style="margin-left: 1.5em">
            <p id="section-9.2-2.24.1"><br/>See Authors' Addresses section<a class="pilcrow" href="#section-9.2-2.24.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.25">Intended usage:</dt>
          <dd id="section-9.2-2.26" style="margin-left: 1.5em">
            <p id="section-9.2-2.26.1">COMMON<a class="pilcrow" href="#section-9.2-2.26.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.27">Restrictions on usage:</dt>
          <dd id="section-9.2-2.28" style="margin-left: 1.5em">
            <p id="section-9.2-2.28.1">N/A<a class="pilcrow" href="#section-9.2-2.28.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.29">Author:</dt>
          <dd id="section-9.2-2.30" style="margin-left: 1.5em">
            <p id="section-9.2-2.30.1">See Authors' Addresses section<a class="pilcrow" href="#section-9.2-2.30.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.2-2.31">Change controller:</dt>
          <dd id="section-9.2-2.32" style="margin-left: 1.5em">
            <p id="section-9.2-2.32.1">IETF<a class="pilcrow" href="#section-9.2-2.32.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-res">
<section id="section-9.3">
        <h3 id="name-message-ohttp-res-media-typ">
<a class="section-number selfRef" href="#section-9.3">9.3. </a><a class="section-name selfRef" href="#name-message-ohttp-res-media-typ">message/ohttp-res Media Type</a>
        </h3>
<p id="section-9.3-1">The "<code>message/ohttp-res</code>" identifies an encrypted binary HTTP response. This
is a binary format that is defined in <a class="auto internal xref" href="#response">Section 4.4</a>.<a class="pilcrow" href="#section-9.3-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.3-2">
          <dt id="section-9.3-2.1">Type name:</dt>
          <dd id="section-9.3-2.2" style="margin-left: 1.5em">
            <p id="section-9.3-2.2.1">message<a class="pilcrow" href="#section-9.3-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.3">Subtype name:</dt>
          <dd id="section-9.3-2.4" style="margin-left: 1.5em">
            <p id="section-9.3-2.4.1">ohttp-res<a class="pilcrow" href="#section-9.3-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.5">Required parameters:</dt>
          <dd id="section-9.3-2.6" style="margin-left: 1.5em">
            <p id="section-9.3-2.6.1">N/A<a class="pilcrow" href="#section-9.3-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.7">Optional parameters:</dt>
          <dd id="section-9.3-2.8" style="margin-left: 1.5em">
            <p id="section-9.3-2.8.1">N/A<a class="pilcrow" href="#section-9.3-2.8.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.9">Encoding considerations:</dt>
          <dd id="section-9.3-2.10" style="margin-left: 1.5em">
            <p id="section-9.3-2.10.1">"binary"<a class="pilcrow" href="#section-9.3-2.10.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.11">Security considerations:</dt>
          <dd id="section-9.3-2.12" style="margin-left: 1.5em">
            <p id="section-9.3-2.12.1">See <a class="auto internal xref" href="#sec-media">Section 6.9</a><a class="pilcrow" href="#section-9.3-2.12.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.13">Interoperability considerations:</dt>
          <dd id="section-9.3-2.14" style="margin-left: 1.5em">
            <p id="section-9.3-2.14.1">N/A<a class="pilcrow" href="#section-9.3-2.14.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.15">Published specification:</dt>
          <dd id="section-9.3-2.16" style="margin-left: 1.5em">
            <p id="section-9.3-2.16.1">RFC 9458<a class="pilcrow" href="#section-9.3-2.16.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.17">Applications that use this media type:</dt>
          <dd id="section-9.3-2.18" style="margin-left: 1.5em">
            <p id="section-9.3-2.18.1">Oblivious HTTP and applications that use Oblivious HTTP use this media type to
identify encapsulated binary HTTP responses.<a class="pilcrow" href="#section-9.3-2.18.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.19">Fragment identifier considerations:</dt>
          <dd id="section-9.3-2.20" style="margin-left: 1.5em">
            <p id="section-9.3-2.20.1">N/A<a class="pilcrow" href="#section-9.3-2.20.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.21">Additional information:</dt>
          <dd id="section-9.3-2.22" style="margin-left: 1.5em">
            <p id="section-9.3-2.22.1"><br/></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.3-2.22.2">
              <dt id="section-9.3-2.22.2.1">Magic number(s):</dt>
              <dd id="section-9.3-2.22.2.2" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.3-2.22.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.2.3">Deprecated alias names for this type:</dt>
              <dd id="section-9.3-2.22.2.4" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.3-2.22.2.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.2.5">File extension(s):</dt>
              <dd id="section-9.3-2.22.2.6" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-9.3-2.22.2.6">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-9.3-2.22.2.7">Macintosh file type code(s):</dt>
              <dd id="section-9.3-2.22.2.8" style="margin-left: 1.5em">
                <p id="section-9.3-2.22.2.8.1">N/A<a class="pilcrow" href="#section-9.3-2.22.2.8.1">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.23">Person and email address to contact for further information:</dt>
          <dd id="section-9.3-2.24" style="margin-left: 1.5em">
            <p id="section-9.3-2.24.1"><br/>See Authors' Addresses section<a class="pilcrow" href="#section-9.3-2.24.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.25">Intended usage:</dt>
          <dd id="section-9.3-2.26" style="margin-left: 1.5em">
            <p id="section-9.3-2.26.1">COMMON<a class="pilcrow" href="#section-9.3-2.26.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.27">Restrictions on usage:</dt>
          <dd id="section-9.3-2.28" style="margin-left: 1.5em">
            <p id="section-9.3-2.28.1">N/A<a class="pilcrow" href="#section-9.3-2.28.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.29">Author:</dt>
          <dd id="section-9.3-2.30" style="margin-left: 1.5em">
            <p id="section-9.3-2.30.1">See Authors' Addresses section<a class="pilcrow" href="#section-9.3-2.30.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.3-2.31">Change controller:</dt>
          <dd id="section-9.3-2.32" style="margin-left: 1.5em">
            <p id="section-9.3-2.32.1">IETF<a class="pilcrow" href="#section-9.3-2.32.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-problem-date">
<section id="section-9.4">
        <h3 id="name-registration-of-date-proble">
<a class="section-number selfRef" href="#section-9.4">9.4. </a><a class="section-name selfRef" href="#name-registration-of-date-proble">Registration of "date" Problem Type</a>
        </h3>
<p id="section-9.4-1">IANA has added a new entry in the "HTTP Problem Types" registry established by
<span>[<a class="cite xref" href="#PROBLEM">PROBLEM</a>]</span>.<a class="pilcrow" href="#section-9.4-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.4-2">
          <dt id="section-9.4-2.1">Type URI:</dt>
          <dd id="section-9.4-2.2" style="margin-left: 1.5em">
            <p id="section-9.4-2.2.1">https://iana.org/assignments/http-problem-types#date<a class="pilcrow" href="#section-9.4-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.3">Title:</dt>
          <dd id="section-9.4-2.4" style="margin-left: 1.5em">
            <p id="section-9.4-2.4.1">Date Not Acceptable<a class="pilcrow" href="#section-9.4-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.5">Recommended HTTP Status Code:</dt>
          <dd id="section-9.4-2.6" style="margin-left: 1.5em">
            <p id="section-9.4-2.6.1">400<a class="pilcrow" href="#section-9.4-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.4-2.7">Reference:</dt>
          <dd id="section-9.4-2.8" style="margin-left: 1.5em">
            <p id="section-9.4-2.8.1"><a class="auto internal xref" href="#date-fix">Section 6.5.2</a> of RFC 9458<a class="pilcrow" href="#section-9.4-2.8.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-problem-ohttp-key">
<section id="section-9.5">
        <h3 id="name-registration-of-ohttp-key-p">
<a class="section-number selfRef" href="#section-9.5">9.5. </a><a class="section-name selfRef" href="#name-registration-of-ohttp-key-p">Registration of "ohttp-key" Problem Type</a>
        </h3>
<p id="section-9.5-1">IANA has added a new entry in the "HTTP Problem Types" registry established by
<span>[<a class="cite xref" href="#PROBLEM">PROBLEM</a>]</span>.<a class="pilcrow" href="#section-9.5-1">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-9.5-2">
          <dt id="section-9.5-2.1">Type URI:</dt>
          <dd id="section-9.5-2.2" style="margin-left: 1.5em">
            <p id="section-9.5-2.2.1">https://iana.org/assignments/http-problem-types#ohttp-key<a class="pilcrow" href="#section-9.5-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.3">Title:</dt>
          <dd id="section-9.5-2.4" style="margin-left: 1.5em">
            <p id="section-9.5-2.4.1">Oblivious HTTP key configuration not acceptable<a class="pilcrow" href="#section-9.5-2.4.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.5">Recommended HTTP Status Code:</dt>
          <dd id="section-9.5-2.6" style="margin-left: 1.5em">
            <p id="section-9.5-2.6.1">400<a class="pilcrow" href="#section-9.5-2.6.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.5-2.7">Reference:</dt>
          <dd id="section-9.5-2.8" style="margin-left: 1.5em">
            <p id="section-9.5-2.8.1"><a class="auto internal xref" href="#ohttp-key-problem">Section 5.3</a> of RFC 9458<a class="pilcrow" href="#section-9.5-2.8.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-10.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-10.1">10.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="ASCII">[ASCII]</dt>
        <dd>
<span class="refAuthor">Cerf, V.</span>, <span class="refTitle">"ASCII format for network interchange"</span>, <span class="seriesInfo">STD 80</span>, <span class="seriesInfo">RFC 20</span>, <span class="seriesInfo">DOI 10.17487/RFC0020</span>, <time class="refDate" datetime="1969-10">October 1969</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc20">https://www.rfc-editor.org/info/rfc20</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BINARY">[BINARY]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Binary Representation of HTTP Messages"</span>, <span class="seriesInfo">RFC 9292</span>, <span class="seriesInfo">DOI 10.17487/RFC9292</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9292">https://www.rfc-editor.org/info/rfc9292</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time class="refDate" datetime="2022-02">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9180">https://www.rfc-editor.org/info/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP">[HTTP]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9110">https://www.rfc-editor.org/info/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-CACHING">[HTTP-CACHING]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Caching"</span>, <span class="seriesInfo">STD 98</span>, <span class="seriesInfo">RFC 9111</span>, <span class="seriesInfo">DOI 10.17487/RFC9111</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9111">https://www.rfc-editor.org/info/rfc9111</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="PROBLEM">[PROBLEM]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">Wilde, E.</span>, and <span class="refAuthor">S. Dalal</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="seriesInfo">RFC 9457</span>, <span class="seriesInfo">DOI 10.17487/RFC9457</span>, <time class="refDate" datetime="2023-07">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9457">https://www.rfc-editor.org/info/rfc9457</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time class="refDate" datetime="2021-05">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9000">https://www.rfc-editor.org/info/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time class="refDate" datetime="2013-01">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6838">https://www.rfc-editor.org/info/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8470">[RFC8470]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">W. Tarreau</span>, <span class="refTitle">"Using Early Data in HTTP"</span>, <span class="seriesInfo">RFC 8470</span>, <span class="seriesInfo">DOI 10.17487/RFC8470</span>, <time class="refDate" datetime="2018-09">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8470">https://www.rfc-editor.org/info/rfc8470</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS">[TLS]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-10.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-10.2">10.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="CLOCKSKEW">[CLOCKSKEW]</dt>
        <dd>
<span class="refAuthor">Acer, M.</span>, <span class="refAuthor">Stark, E.</span>, <span class="refAuthor">Felt, A.</span>, <span class="refAuthor">Fahl, S.</span>, <span class="refAuthor">Bhargava, R.</span>, <span class="refAuthor">Dev, B.</span>, <span class="refAuthor">Braithwaite, M.</span>, <span class="refAuthor">Sleevi, R.</span>, and <span class="refAuthor">P. Tabriz</span>, <span class="refTitle">"Where the Wild Warnings Are: Root Causes of Chrome HTTPS Certificate Errors"</span>, <span class="refContent">Proceedings of the 2017 ACM SIGSAC Conference on
          Computer and Communications Security</span>, <span class="seriesInfo">DOI 10.1145/3133956.3134007</span>, <time class="refDate" datetime="2017-10">October 2017</time>, <span>&lt;<a href="https://doi.org/10.1145/3133956.3134007">https://doi.org/10.1145/3133956.3134007</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONSISTENCY">[CONSISTENCY]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Finkel, M.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Key Consistency and Discovery"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-key-consistency-01</span>, <time class="refDate" datetime="2023-07-10">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="COOKIES">[COOKIES]</dt>
        <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"HTTP State Management Mechanism"</span>, <span class="seriesInfo">RFC 6265</span>, <span class="seriesInfo">DOI 10.17487/RFC6265</span>, <time class="refDate" datetime="2011-04">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6265">https://www.rfc-editor.org/info/rfc6265</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DMS2004">[DMS2004]</dt>
        <dd>
<span class="refAuthor">Dingledine, R.</span>, <span class="refAuthor">Mathewson, N.</span>, and <span class="refAuthor">P. Syverson</span>, <span class="refTitle">"Tor: The Second-Generation Onion Router"</span>, <time class="refDate" datetime="2004-05">May 2004</time>, <span>&lt;<a href="https://svn.torproject.org/svn/projects/design-paper/tor-design.html">https://svn.torproject.org/svn/projects/design-paper/tor-design.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FIELDING">[FIELDING]</dt>
        <dd>
<span class="refAuthor">Fielding, R. T.</span>, <span class="refTitle">"Architectural Styles and the Design of Network-based Software Architectures"</span>, <time class="refDate" datetime="2000-01">January 2000</time>, <span>&lt;<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf">https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FORWARDED">[FORWARDED]</dt>
        <dd>
<span class="refAuthor">Petersson, A.</span> and <span class="refAuthor">M. Nilsson</span>, <span class="refTitle">"Forwarded HTTP Extension"</span>, <span class="seriesInfo">RFC 7239</span>, <span class="seriesInfo">DOI 10.17487/RFC7239</span>, <time class="refDate" datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7239">https://www.rfc-editor.org/info/rfc7239</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP11">[HTTP/1.1]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9112">https://www.rfc-editor.org/info/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP2">[HTTP/2]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9113">https://www.rfc-editor.org/info/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP3">[HTTP/3]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9114">https://www.rfc-editor.org/info/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NTP">[NTP]</dt>
        <dd>
<span class="refAuthor">Mills, D.</span>, <span class="refAuthor">Martin, J., Ed.</span>, <span class="refAuthor">Burbank, J.</span>, and <span class="refAuthor">W. Kasch</span>, <span class="refTitle">"Network Time Protocol Version 4: Protocol and Algorithms Specification"</span>, <span class="seriesInfo">RFC 5905</span>, <span class="seriesInfo">DOI 10.17487/RFC5905</span>, <time class="refDate" datetime="2010-06">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5905">https://www.rfc-editor.org/info/rfc5905</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ODOH">[ODOH]</dt>
        <dd>
<span class="refAuthor">Kinnear, E.</span>, <span class="refAuthor">McManus, P.</span>, <span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Verma, T.</span>, and <span class="refAuthor">C.A. Wood</span>, <span class="refTitle">"Oblivious DNS over HTTPS"</span>, <span class="seriesInfo">RFC 9230</span>, <span class="seriesInfo">DOI 10.17487/RFC9230</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9230">https://www.rfc-editor.org/info/rfc9230</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ODOH-PETS">[ODOH-PETS]</dt>
        <dd>
<span class="refAuthor">Singanamalla, S.</span>, <span class="refAuthor">Chunhapanya, S.</span>, <span class="refAuthor">Hoyland, J.</span>, <span class="refAuthor">Vavruša, M.</span>, <span class="refAuthor">Verma, T.</span>, <span class="refAuthor">Wu, P.</span>, <span class="refAuthor">Fayed, M.</span>, <span class="refAuthor">Heimerl, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious DNS over HTTPS (ODoH): A Practical Privacy Enhancement to DNS"</span>, <span class="refContent">PoPETS Proceedings Volume 2021, Issue 4, pp. 575-592</span>, <span class="seriesInfo">DOI 10.2478/popets-2021-0085</span>, <time class="refDate" datetime="2021-01">January 2021</time>, <span>&lt;<a href="https://www.petsymposium.org/2021/files/papers/issue4/popets-2021-0085.pdf">https://www.petsymposium.org/2021/files/papers/issue4/popets-2021-0085.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OHTTP-ANALYSIS">[OHTTP-ANALYSIS]</dt>
        <dd>
<span class="refAuthor">Hoyland, J.</span>, <span class="refTitle">"Tamarin Model of Oblivious HTTP"</span>, <span class="refContent">commit 6824eee</span>, <time class="refDate" datetime="2022-10">October 2022</time>, <span>&lt;<a href="https://github.com/cloudflare/ohttp-analysis">https://github.com/cloudflare/ohttp-analysis</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="PRIO">[PRIO]</dt>
        <dd>
<span class="refAuthor">Corrigan-Gibbs, H.</span> and <span class="refAuthor">D. Boneh</span>, <span class="refTitle">"Prio: Private, Robust, and Scalable Computation of Aggregate Statistics"</span>, <time class="refDate" datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RANDOM">[RANDOM]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time class="refDate" datetime="2005-06">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4086">https://www.rfc-editor.org/info/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7838">[RFC7838]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refAuthor">McManus, P.</span>, and <span class="refAuthor">J. Reschke</span>, <span class="refTitle">"HTTP Alternative Services"</span>, <span class="seriesInfo">RFC 7838</span>, <span class="seriesInfo">DOI 10.17487/RFC7838</span>, <time class="refDate" datetime="2016-04">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7838">https://www.rfc-editor.org/info/rfc7838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time class="refDate" datetime="2018-10">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8484">https://www.rfc-editor.org/info/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TEMPLATE">[TEMPLATE]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time class="refDate" datetime="2012-03">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6570">https://www.rfc-editor.org/info/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="UWT">[UWT]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Unsanctioned Web Tracking"</span>, <span class="refContent">W3C TAG Finding</span>, <time class="refDate" datetime="2015-07">July 2015</time>, <span>&lt;<a href="https://www.w3.org/2001/tag/doc/unsanctioned-tracking/">https://www.w3.org/2001/tag/doc/unsanctioned-tracking/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X25519">[X25519]</dt>
      <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time class="refDate" datetime="2016-01">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="complete-example-of-a-request-and-response">
<section id="appendix-A">
      <h2 id="name-complete-example-of-a-reque">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-complete-example-of-a-reque">Complete Example of a Request and Response</a>
      </h2>
<p id="appendix-A-1">A single request and response exchange is shown here. Binary values (<a class="internal xref" href="#key-configuration">key
configuration</a>, secret keys, the content of messages, and intermediate values)
are shown in hexadecimal. The request and response here are minimal; the purpose
of this example is to show the cryptographic operations.  In this example, the
<a class="internal xref" href="#dfn-client">Client</a> is configured with the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a> URI of
<code>https://proxy.example.org/request.example.net/proxy</code>, and the proxy is
configured to map requests to this URI to the <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> URI
<code>https://example.com/oblivious/request</code>. The <a class="internal xref" href="#dfn-target">Target Resource</a> URI, i.e., the
resource the Client ultimately wishes to query, is <code>https://example.com</code>.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<p id="appendix-A-2">To begin the process, the Oblivious Gateway Resource generates a key pair.
In this example, the server chooses DHKEM(X25519, HKDF-SHA256) and generates
an X25519 key pair <span>[<a class="cite xref" href="#X25519">X25519</a>]</span>. The X25519 secret key is:<a class="pilcrow" href="#appendix-A-2">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-3">
<pre>3c168975674b2fa8e465970b79c8dcf09f1c741626480bd4c6162fc5b6a98e1a
</pre><a class="pilcrow" href="#appendix-A-3">¶</a>
</div>
<p id="appendix-A-4">The Oblivious Gateway Resource constructs a key configuration that includes the
corresponding public key as follows:<a class="pilcrow" href="#appendix-A-4">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-5">
<pre>01002031e1f05a740102115220e9af918f738674aec95f54db6e04eb705aae8e
79815500080001000100010003
</pre><a class="pilcrow" href="#appendix-A-5">¶</a>
</div>
<p id="appendix-A-6">This key configuration is somehow obtained by the Client. Then, when a Client
wishes to send an HTTP GET request to the target <code>https://example.com</code>, it
constructs the following binary HTTP message:<a class="pilcrow" href="#appendix-A-6">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-7">
<pre>00034745540568747470730b6578616d706c652e636f6d012f
</pre><a class="pilcrow" href="#appendix-A-7">¶</a>
</div>
<p id="appendix-A-8">The Client then reads the Oblivious Gateway Resource key configuration and
selects a mutually supported KDF and AEAD. In this example, the Client selects
HKDF-SHA256 and AES-128-GCM. The Client then generates an HPKE sending context
that uses the server public key. This context is constructed from the following
ephemeral secret key:<a class="pilcrow" href="#appendix-A-8">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-9">
<pre>bc51d5e930bda26589890ac7032f70ad12e4ecb37abb1b65b1256c9c48999c73
</pre><a class="pilcrow" href="#appendix-A-9">¶</a>
</div>
<p id="appendix-A-10">The corresponding public key is:<a class="pilcrow" href="#appendix-A-10">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-11">
<pre>4b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad19dec96c208b472
</pre><a class="pilcrow" href="#appendix-A-11">¶</a>
</div>
<p id="appendix-A-12">The context is created with an <code>info</code> parameter of:<a class="pilcrow" href="#appendix-A-12">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-13">
<pre>6d6573736167652f626874747020726571756573740001002000010001
</pre><a class="pilcrow" href="#appendix-A-13">¶</a>
</div>
<p id="appendix-A-14">Applying the Seal operation from the HPKE context produces an encrypted
message, allowing the Client to construct the following <a class="internal xref" href="#dfn-enc-req">Encapsulated Request</a>:<a class="pilcrow" href="#appendix-A-14">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-15">
<pre>010020000100014b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad1
9dec96c208b4726374e469135906992e1268c594d2a10c695d858c40a026e796
5e7d86b83dd440b2c0185204b4d63525
</pre><a class="pilcrow" href="#appendix-A-15">¶</a>
</div>
<p id="appendix-A-16">The Client then sends this to the Oblivious Relay Resource in a POST request,
which might look like the following HTTP/1.1 request:<a class="pilcrow" href="#appendix-A-16">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-17">
<pre>POST /request.example.net/proxy HTTP/1.1
Host: proxy.example.org
Content-Type: message/ohttp-req
Content-Length: 78

&lt;content is the Encapsulated Request above&gt;
</pre><a class="pilcrow" href="#appendix-A-17">¶</a>
</div>
<p id="appendix-A-18">The Oblivious Relay Resource receives this request and forwards it to the
Oblivious Gateway Resource, which might look like:<a class="pilcrow" href="#appendix-A-18">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-19">
<pre>POST /oblivious/request HTTP/1.1
Host: example.com
Content-Type: message/ohttp-req
Content-Length: 78

&lt;content is the Encapsulated Request above&gt;
</pre><a class="pilcrow" href="#appendix-A-19">¶</a>
</div>
<p id="appendix-A-20">The <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> receives this request, selects the key it
generated previously using the key identifier from the message, and decrypts the
message. As this request is directed to the same server, the Oblivious Gateway
Resource does not need to initiate an HTTP request to the <a class="internal xref" href="#dfn-target">Target Resource</a>. The
request can be served directly by the Target Resource, which generates a minimal
response (consisting of just a 200 status code) as follows:<a class="pilcrow" href="#appendix-A-20">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-21">
<pre>0140c8
</pre><a class="pilcrow" href="#appendix-A-21">¶</a>
</div>
<p id="appendix-A-22">The response is constructed by exporting a secret from the HPKE context:<a class="pilcrow" href="#appendix-A-22">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-23">
<pre>62d87a6ba569ee81014c2641f52bea36
</pre><a class="pilcrow" href="#appendix-A-23">¶</a>
</div>
<p id="appendix-A-24">The key derivation for the <a class="internal xref" href="#dfn-enc-res">Encapsulated Response</a> uses both the encapsulated KEM
key from the request and a randomly selected nonce. This produces a salt of:<a class="pilcrow" href="#appendix-A-24">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-25">
<pre>4b28f881333e7c164ffc499ad9796f877f4e1051ee6d31bad19dec96c208b472
c789e7151fcba46158ca84b04464910d
</pre><a class="pilcrow" href="#appendix-A-25">¶</a>
</div>
<p id="appendix-A-26">The salt and secret are both passed to the <code>Extract</code> function of the selected KDF
(HKDF-SHA256) to produce a pseudorandom key of:<a class="pilcrow" href="#appendix-A-26">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-27">
<pre>979aaeae066cf211ab407b31ae49767f344e1501e475c84e8aff547cc5a683db
</pre><a class="pilcrow" href="#appendix-A-27">¶</a>
</div>
<p id="appendix-A-28">The pseudorandom key is used with the <code>Expand</code> function of the KDF and an info
field of "key" to produce a 16-byte key for the selected AEAD (AES-128-GCM):<a class="pilcrow" href="#appendix-A-28">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-29">
<pre>5d0172a080e428b16d298c4ea0db620d
</pre><a class="pilcrow" href="#appendix-A-29">¶</a>
</div>
<p id="appendix-A-30">With the same KDF and pseudorandom key, an info field of "nonce" is used to
generate a 12-byte nonce:<a class="pilcrow" href="#appendix-A-30">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-31">
<pre>f6bf1aeb88d6df87007fa263
</pre><a class="pilcrow" href="#appendix-A-31">¶</a>
</div>
<p id="appendix-A-32">The AEAD <code>Seal()</code> function is then used to encrypt the response, which is added
to the randomized nonce value to produce the Encapsulated Response:<a class="pilcrow" href="#appendix-A-32">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-33">
<pre>c789e7151fcba46158ca84b04464910d86f9013e404feea014e7be4a441f234f
857fbd
</pre><a class="pilcrow" href="#appendix-A-33">¶</a>
</div>
<p id="appendix-A-34">The <a class="internal xref" href="#dfn-gateway">Oblivious Gateway Resource</a> constructs a response with the same content:<a class="pilcrow" href="#appendix-A-34">¶</a></p>
<div class="lang-http-message sourcecode" id="appendix-A-35">
<pre>HTTP/1.1 200 OK
Date: Wed, 27 Jan 2021 04:45:07 GMT
Cache-Control: private, no-store
Content-Type: message/ohttp-res
Content-Length: 38

&lt;content is the Encapsulated Response&gt;
</pre><a class="pilcrow" href="#appendix-A-35">¶</a>
</div>
<p id="appendix-A-36">The same response might then be generated by the <a class="internal xref" href="#dfn-relay">Oblivious Relay Resource</a>, which
might change as little as the <code>Date</code> header. The <a class="internal xref" href="#dfn-client">Client</a> is then able to use the
HPKE context it created and the nonce from the Encapsulated Response to
construct the AEAD key and nonce and decrypt the response.<a class="pilcrow" href="#appendix-A-36">¶</a></p>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">This design is based on a design for Oblivious DNS (queries) over HTTPS (DoH),
described in <span>[<a class="cite xref" href="#ODOH">ODOH</a>]</span>. <span class="contact-name">David Benjamin</span>, <span class="contact-name">Mark Nottingham</span>, and
<span class="contact-name">Eric Rescorla</span> made technical contributions.  The authors also thank
<span class="contact-name">Ralph Giles</span>, <span class="contact-name">Lucas Pardue</span>, and <span class="contact-name">Tommy Pauly</span> for invaluable
assistance.<a class="pilcrow" href="#appendix-B-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Martin Thomson</span></div>
<div class="left" dir="auto"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:mt@lowentropy.net">mt@lowentropy.net</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Christopher A. Wood</span></div>
<div class="left" dir="auto"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:caw@heapingbits.net">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>