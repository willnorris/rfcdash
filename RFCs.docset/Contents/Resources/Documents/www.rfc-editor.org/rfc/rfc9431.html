<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9431: Message Queuing Telemetry Transport (MQTT) and Transport Layer Security (TLS) Profile of Authentication and Authorization for Constrained Environments (ACE) Framework</title>
<meta content="Cigdem Sengul" name="author"/>
<meta content="Anthony Kirby" name="author"/>
<meta content="
       
                This document specifies a profile for the Authentication and Authorization for Constrained
                Environments (ACE) framework to enable authorization in a publish-subscribe messaging system based on Message Queuing Telemetry Transport
                (MQTT).
                Proof-of-Possession keys, bound to OAuth 2.0 access tokens, are used to authenticate and authorize
                MQTT Clients. The protocol relies on TLS for confidentiality and MQTT server (Broker) authentication.
       
    " name="description"/>
<meta content="xml2rfc 3.17.4" name="generator"/>
<meta content="publish-subscribe" name="keyword"/>
<meta content="authorization information format" name="keyword"/>
<meta content="9431" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.17.4
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9431.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9431" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-ace-mqtt-tls-profile-17" rel="prev"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9431</td>
<td class="center">MQTT-TLS Profile of ACE</td>
<td class="right">July 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sengul &amp; Kirby</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9431">9431</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2023-07">July 2023</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Sengul</div>
<div class="org">Brunel University</div>
</div>
<div class="author">
      <div class="author-name">A. Kirby</div>
<div class="org">Oxbotica</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9431</h1>
<h1 id="title">Message Queuing Telemetry Transport (MQTT) and Transport Layer Security (TLS) Profile of Authentication and Authorization for Constrained Environments (ACE) Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">
                This document specifies a profile for the Authentication and Authorization for Constrained
                Environments (ACE) framework to enable authorization in a publish-subscribe messaging system based on Message Queuing Telemetry Transport
                (MQTT).
                Proof-of-Possession keys, bound to OAuth 2.0 access tokens, are used to authenticate and authorize
                MQTT Clients. The protocol relies on TLS for confidentiality and MQTT server (Broker) authentication.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9431">https://www.rfc-editor.org/info/rfc9431</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.  <a class="internal xref" href="#name-requirements-language">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p class="keepWithNext" id="section-toc.1-1.1.2.2.1"><a class="auto internal xref" href="#section-1.2">1.2</a>.  <a class="internal xref" href="#name-ace-related-terminology">ACE-Related Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p class="keepWithNext" id="section-toc.1-1.1.2.3.1"><a class="auto internal xref" href="#section-1.3">1.3</a>.  <a class="internal xref" href="#name-mqtt-related-terminology">MQTT-Related Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-authorizing-connection-requ">Authorizing Connection Requests</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-client-token-request-to-the">Client Token Request to the Authorization Server (AS)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-client-connection-request-t">Client Connection Request to the Broker (C)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a class="auto internal xref" href="#section-2.2.1">2.2.1</a>.  <a class="internal xref" href="#name-overview-of-client-rs-authe">Overview of Client-RS Authentication Methods over TLS and MQTT</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a class="auto internal xref" href="#section-2.2.2">2.2.2</a>.  <a class="internal xref" href="#name-authz-info-the-authorizatio">authz-info: The Authorization Information Topic</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a class="auto internal xref" href="#section-2.2.3">2.2.3</a>.  <a class="internal xref" href="#name-client-authentication-over-">Client Authentication over TLS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3.2.1">
                        <p id="section-toc.1-1.2.2.2.2.3.2.1.1"><a class="auto internal xref" href="#section-2.2.3.1">2.2.3.1</a>.  <a class="internal xref" href="#name-raw-public-key-mode">Raw Public Key Mode</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3.2.2">
                        <p id="section-toc.1-1.2.2.2.2.3.2.2.1"><a class="auto internal xref" href="#section-2.2.3.2">2.2.3.2</a>.  <a class="internal xref" href="#name-pre-shared-key-mode">Pre-Shared Key Mode</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a class="auto internal xref" href="#section-2.2.4">2.2.4</a>.  <a class="internal xref" href="#name-client-authentication-over-m">Client Authentication over MQTT</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.1">
                        <p id="section-toc.1-1.2.2.2.2.4.2.1.1"><a class="auto internal xref" href="#section-2.2.4.1">2.2.4.1</a>.  <a class="internal xref" href="#name-transporting-the-access-tok">Transporting the Access Token inside the MQTT CONNECT</a></p>
</li>
                      <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4.2.2">
                        <p id="section-toc.1-1.2.2.2.2.4.2.2.1"><a class="auto internal xref" href="#section-2.2.4.2">2.2.4.2</a>.  <a class="internal xref" href="#name-authentication-using-the-au">Authentication Using the AUTH Property</a></p>
</li>
                    </ul>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a class="auto internal xref" href="#section-2.2.5">2.2.5</a>.  <a class="internal xref" href="#name-broker-token-validation">Broker Token Validation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a class="auto internal xref" href="#section-2.3">2.3</a>.  <a class="internal xref" href="#name-token-scope-and-authorizati">Token Scope and Authorization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a class="auto internal xref" href="#section-2.4">2.4</a>.  <a class="internal xref" href="#name-broker-response-to-client-c">Broker Response to Client Connection Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.1">
                    <p id="section-toc.1-1.2.2.4.2.1.1"><a class="auto internal xref" href="#section-2.4.1">2.4.1</a>.  <a class="internal xref" href="#name-unauthorized-request-and-th">Unauthorized Request and the Optional Authorization Server Discovery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.2">
                    <p id="section-toc.1-1.2.2.4.2.2.1"><a class="auto internal xref" href="#section-2.4.2">2.4.2</a>.  <a class="internal xref" href="#name-authorization-success">Authorization Success</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-authorizing-publish-and-sub">Authorizing PUBLISH and SUBSCRIBE Packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a class="auto internal xref" href="#section-3.1">3.1</a>.  <a class="internal xref" href="#name-publish-packets-from-the-pu">PUBLISH Packets from the Publisher Client to the Broker</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a class="auto internal xref" href="#section-3.2">3.2</a>.  <a class="internal xref" href="#name-publish-packets-from-the-br">PUBLISH Packets from the Broker to the Subscriber Clients</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a class="auto internal xref" href="#section-3.3">3.3</a>.  <a class="internal xref" href="#name-authorizing-subscribe-packe">Authorizing SUBSCRIBE Packets</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-token-expiration-update-and">Token Expiration, Update, and Reauthentication</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-handling-disconnections-and">Handling Disconnections and Retained Messages</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#section-6">6</a>.  <a class="internal xref" href="#name-reduced-protocol-interactio">Reduced Protocol Interactions for MQTT v3.1.1</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a class="auto internal xref" href="#section-6.1">6.1</a>.  <a class="internal xref" href="#name-token-transport">Token Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a class="auto internal xref" href="#section-6.2">6.2</a>.  <a class="internal xref" href="#name-handling-authorization-erro">Handling Authorization Errors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#section-7">7</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a class="auto internal xref" href="#section-7.1">7.1</a>.  <a class="internal xref" href="#name-tls-exporter-labels-registr">TLS Exporter Labels Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a class="auto internal xref" href="#section-7.2">7.2</a>.  <a class="internal xref" href="#name-media-type-registration">Media Type Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a class="auto internal xref" href="#section-7.3">7.3</a>.  <a class="internal xref" href="#name-ace-oauth-profile-registrat">ACE OAuth Profile Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a class="auto internal xref" href="#section-7.4">7.4</a>.  <a class="internal xref" href="#name-aif">AIF</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="auto internal xref" href="#section-8">8</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="auto internal xref" href="#section-9">9</a>.  <a class="internal xref" href="#name-privacy-considerations">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="auto internal xref" href="#section-10">10</a>. <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="auto internal xref" href="#section-10.1">10.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="auto internal xref" href="#section-10.2">10.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="auto internal xref" href="#appendix-A">Appendix A</a>.  <a class="internal xref" href="#name-checklist-for-profile-requi">Checklist for Profile Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-acknowledgments">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="auto internal xref" href="#appendix-C"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">
                This document specifies a profile for the ACE framework <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.
                In this profile, Clients and Servers (Brokers) use MQTT to exchange Application Messages.
                The protocol relies on TLS for communication security between entities. The MQTT protocol interactions
                are described based on the <span><a class="internal xref" href="#MQTT-OASIS-Standard-v5">MQTT v5.0 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v5">MQTT-OASIS-Standard-v5</a>]</span>.
                Since it is expected that MQTT deployments will continue to support MQTT v3.1.1 Clients,
         this document also describes a reduced set of protocol interactions for the
                <span><a class="internal xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT v3.1.1 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT-OASIS-Standard-v3.1.1</a>]</span>.
         However, MQTT v5.0 is the <span class="bcp14">RECOMMENDED</span> version, as it works more naturally
                with ACE-style authentication and authorization.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">
                MQTT is a publish-subscribe protocol, and
                after connecting to the MQTT Server (Broker), a Client can publish and subscribe to multiple topics.
                The Broker, which acts as the Resource Server (RS), is responsible for distributing messages published 
                by the publishers to their subscribers. In the rest of the
                document, the terms "RS", "MQTT Server", and "Broker" are used interchangeably.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">
                Messages are published under a Topic Name,
                and subscribers subscribe to the Topic Names to receive the corresponding messages.
                The Broker uses the Topic Name in a published message to determine which
                subscribers to relay the messages to.
                In this document, topics (more specifically, Topic Names) are treated as resources.
                The Clients are assumed to have identified the publish/subscribe topics of interest out of band
                (topic discovery is not a feature of the MQTT protocol).
                A Resource Owner can preconfigure policies at the Authorization Server (AS) 
                that give Clients publish or subscribe permissions to different topics.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">
                Clients prove their permission to publish and subscribe to topics hosted on an MQTT Broker
                using an access token that is bound to a Proof-of-Possession (PoP) key.
                This document describes how to authorize the following exchanges between the
                Clients and the Broker.<a class="pilcrow" href="#section-1-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-5.1">connection requests from the Clients to the Broker<a class="pilcrow" href="#section-1-5.1">¶</a>
</li>
        <li class="normal" id="section-1-5.2">publish requests from the Clients to the Broker and from the Broker to the Clients<a class="pilcrow" href="#section-1-5.2">¶</a>
</li>
        <li class="normal" id="section-1-5.3">subscribe requests from the Clients to the Broker<a class="pilcrow" href="#section-1-5.3">¶</a>
</li>
      </ul>
<p id="section-1-6">
                Clients use the MQTT PUBLISH packet to publish to a topic.
                The mechanisms specified in this document do not protect the Payload of the PUBLISH packet from the Broker. Hence,
                the Payload is not signed or encrypted specifically for the subscribers. This functionality may 
                be implemented using the proposal outlined in the 
                <span><a class="internal xref" href="#I-D.ietf-ace-pubsub-profile">ACE Pub-Sub Profile</a> [<a class="cite xref" href="#I-D.ietf-ace-pubsub-profile">ACE-PUBSUB-PROFILE</a>]</span>.<a class="pilcrow" href="#section-1-6">¶</a></p>
<p id="section-1-7">
                To provide communication confidentiality and Broker authentication to the MQTT Clients, TLS is used, and
                TLS 1.3 <span>[<a class="cite xref" href="#RFC8446">RFC8446</a>]</span> is <span class="bcp14">RECOMMENDED</span>.
 This document makes the same assumptions as
         <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-4">Section 4</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span> regarding Client and RS
                registration with the AS for setting up the keying material.
                While the Client-Broker exchanges are only over MQTT, the required Client-AS and
                RS-AS interactions are described for HTTPS-based communication <span>[<a class="cite xref" href="#RFC9110">RFC9110</a>]</span>, 
                using the "application/ace+json"
                content type and, unless otherwise specified, JSON encoding. The token <span class="bcp14">MAY</span> be an
                opaque reference to authorization information  or a JSON Web Token (JWT) <span>[<a class="cite xref" href="#RFC7519">RFC7519</a>]</span>.
                For JWTs, this document follows <span>[<a class="cite xref" href="#RFC7800">RFC7800</a>]</span>
                for PoP semantics for JWTs, and the mechanisms for providing and verifying PoP
                are detailed in  <a class="auto internal xref" href="#connect_v5">Section 2.2</a>. The Client-AS and RS-AS exchanges <span class="bcp14">MAY</span> also use protocols other than HTTP,
                e.g., Constrained Application Protocol (CoAP) <span>[<a class="cite xref" href="#RFC7252">RFC7252</a>]</span> or MQTT. It is recommended
                that TLS is used to secure these communication channels between Client-AS and RS-AS.
                To reduce the protocol memory and bandwidth
                requirements, implementations <span class="bcp14">MAY</span> also use the "application/ace+cbor" content type, Concise Binary Object Representation (CBOR) encoding <span>[<a class="cite xref" href="#RFC8949">RFC8949</a>]</span>,
                CBOR Web Tokens (CWTs) <span>[<a class="cite xref" href="#RFC8392">RFC8392</a>]</span>, and associated PoP semantics.  For more information, see <span><a class="internal xref" href="#RFC8747">"Proof-of-Possession Key
                Semantics for CBOR Web Tokens (CWTs)"</a> [<a class="cite xref" href="#RFC8747">RFC8747</a>]</span>.
                A JWT uses JSON Object Signing and Encryption (JOSE), while a CWT uses CBOR Object Signing and Encryption (COSE) <span>[<a class="cite xref" href="#RFC9052">RFC9052</a>]</span> for security protection.<a class="pilcrow" href="#section-1-7">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-requirements-language">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-ace-related-terminology">
<a class="section-number selfRef" href="#section-1.2">1.2. </a><a class="section-name selfRef" href="#name-ace-related-terminology">ACE-Related Terminology</a>
        </h3>
<p id="section-1.2-1">
     Certain security-related terms, such as "authentication",
   "authorization", "data confidentiality", "(data) integrity", "message
   authentication code" (MAC), and "verify", are taken from <span>[<a class="cite xref" href="#RFC4949">RFC4949</a>]</span>.<a class="pilcrow" href="#section-1.2-1">¶</a></p>
<p id="section-1.2-2">
                    The terminology for entities in the architecture is defined in OAuth 2.0 <span>[<a class="cite xref" href="#RFC6749">RFC6749</a>]</span>, such as "Client" (C),
                     "Resource Server" (RS), and "Authorization Server" (AS).<a class="pilcrow" href="#section-1.2-2">¶</a></p>
<p id="section-1.2-3">
                    The term "resource" is used to refer to an MQTT Topic Name, which is defined in <a class="auto internal xref" href="#mqtt-defs">Section 1.3</a>.
                    Hence, the "Resource Owner" is any entity that can authoritatively speak for the topic.
                    This document also defines a Client Authorization Server for Clients that are not 
                    able to support HTTP.<a class="pilcrow" href="#section-1.2-3">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.2-4">
          <dt id="section-1.2-4.1">Client Authorization Server (CAS)</dt>
          <dd id="section-1.2-4.2" style="margin-left: 4.0em">
                  An entity that prepares and endorses authentication and authorization data for a Client 
                  and communicates to the AS using HTTPS.<a class="pilcrow" href="#section-1.2-4.2">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<div id="mqtt-defs">
<section id="section-1.3">
        <h3 id="name-mqtt-related-terminology">
<a class="section-number selfRef" href="#section-1.3">1.3. </a><a class="section-name selfRef" href="#name-mqtt-related-terminology">MQTT-Related Terminology</a>
        </h3>
<p id="section-1.3-1">
                    The document describes message exchanges as MQTT protocol interactions.    The Clients are MQTT Clients, which connect to the
   Broker to publish and subscribe to Application Messages (which are
   labeled with their topics). For additional information,
                    please refer to the <span><a class="internal xref" href="#MQTT-OASIS-Standard-v5">MQTT v5.0 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v5">MQTT-OASIS-Standard-v5</a>]</span> or <span><a class="internal xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT v3.1.1 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT-OASIS-Standard-v3.1.1</a>]</span>.<a class="pilcrow" href="#section-1.3-1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.3-2">
          <dt id="section-1.3-2.1">Broker</dt>
          <dd id="section-1.3-2.2" style="margin-left: 4.0em">
                            The Server in MQTT. It acts as an intermediary between the Clients that publish Application Messages
                            and the Clients that made Subscriptions. The Broker acts as the Resource Server for the Clients.<a class="pilcrow" href="#section-1.3-2.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.3">Client</dt>
          <dd id="section-1.3-2.4" style="margin-left: 4.0em">
                            A device or program that uses MQTT.<a class="pilcrow" href="#section-1.3-2.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.5">Network Connection</dt>
          <dd id="section-1.3-2.6" style="margin-left: 4.0em">
                            A construct provided by the underlying transport protocol that is being used by MQTT. 
                            It connects the Client to the Server. It provides the means to send an ordered, lossless 
                            stream of bytes in both directions. This document uses TLS as the transport protocol.<a class="pilcrow" href="#section-1.3-2.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.7">Session</dt>
          <dd id="section-1.3-2.8" style="margin-left: 4.0em">
                            A stateful interaction between a Client and a Broker.
                            Some Sessions last only as long as the Network Connection;
                            others can span multiple Network Connections.<a class="pilcrow" href="#section-1.3-2.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.9">Application Message</dt>
          <dd id="section-1.3-2.10" style="margin-left: 4.0em">
                            The data carried by the MQTT protocol. The data has an associated Quality-of-Service (QoS) level and Topic
                            Name.<a class="pilcrow" href="#section-1.3-2.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.11">MQTT Control Packet</dt>
          <dd id="section-1.3-2.12" style="margin-left: 4.0em">
                           The MQTT protocol operates by exchanging a series of MQTT Control Packets.
                           Each packet is composed of a Fixed Header, a Variable Header (depending
                           on the Control Packet type), and a Payload.<a class="pilcrow" href="#section-1.3-2.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.13">UTF-8-encoded string</dt>
          <dd id="section-1.3-2.14" style="margin-left: 4.0em">
                            A string prefixed with a two-byte-length field that gives the number of bytes in a UTF-8-encoded string itself.
                            Unless stated otherwise, all UTF-8-encoded strings can have any length in the range 0 to 65535 bytes.<a class="pilcrow" href="#section-1.3-2.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.15">Binary Data</dt>
          <dd id="section-1.3-2.16" style="margin-left: 4.0em">
                            Binary Data is represented by a two-byte-length field, which indicates the number of data bytes, followed by that number of bytes. 
                            Thus, the length of Binary Data is limited to the range of 0 to 65535 bytes.<a class="pilcrow" href="#section-1.3-2.16">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.17">Variable Byte Integer</dt>
          <dd id="section-1.3-2.18" style="margin-left: 4.0em">
                            A Variable Byte Integer is encoded using an encoding scheme that uses a single byte for values up to 127. 
                            For larger values, the least significant seven bits of each byte encode the data, 
                            and the most significant bit is used to indicate whether there are bytes following in
                            the representation. Thus, each byte encodes 128 values and a "continuation bit". 
                            The maximum number of bytes in the Variable Byte Integer field is four.<a class="pilcrow" href="#section-1.3-2.18">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.19">QoS level</dt>
          <dd id="section-1.3-2.20" style="margin-left: 4.0em">
                            The level of assurance for the delivery of an Application Message. The QoS level can be 0-2,
                            where 0 indicates "At most once delivery", 1 indicates "At least once delivery", and 2 indicates "Exactly once delivery".<a class="pilcrow" href="#section-1.3-2.20">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.21">Property</dt>
          <dd id="section-1.3-2.22" style="margin-left: 4.0em">
                            The last field of the Variable Header is a set of properties
                            for several MQTT Control Packets (e.g., CONNECT and CONNACK).
                            A property consists of an Identifier that defines its usage and data type, followed by a value.
                            The Identifier is encoded as a Variable Byte Integer. For example, the "Authentication Data" property
                            uses the identifier 22.<a class="pilcrow" href="#section-1.3-2.22">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.23">Topic Name</dt>
          <dd id="section-1.3-2.24" style="margin-left: 4.0em">
                            The label attached to an Application Message, which is matched to a Subscription.<a class="pilcrow" href="#section-1.3-2.24">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.25">Subscription</dt>
          <dd id="section-1.3-2.26" style="margin-left: 4.0em">
                            A Subscription comprises a Topic Filter and a maximum QoS. A Subscription is associated with a single Session.<a class="pilcrow" href="#section-1.3-2.26">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.27">Topic Filter</dt>
          <dd id="section-1.3-2.28" style="margin-left: 4.0em">
                            An expression that indicates interest in one or more Topic Names. Topic Filters may include
                            wildcards.<a class="pilcrow" href="#section-1.3-2.28">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.3-3">
                    MQTT sends various Control Packets across a Network Connection.
                    The following is not an exhaustive list, and the Control Packets that are not relevant for
                    authorization are not explained.
                    For instance, these include the PUBREL and PUBCOMP packets used in the 4-step handshake required
                    for QoS level 2.<a class="pilcrow" href="#section-1.3-3">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.3-4">
          <dt id="section-1.3-4.1">CONNECT</dt>
          <dd id="section-1.3-4.2" style="margin-left: 4.0em">
                            The Client requests to connect to the Broker. This is
                            the first packet sent by a Client.<a class="pilcrow" href="#section-1.3-4.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.3">CONNACK</dt>
          <dd id="section-1.3-4.4" style="margin-left: 4.0em">
                            The Broker connection acknowledgment. CONNACK packets
                            contain return codes that indicate either a success or an error state
                            in response to a Client's CONNECT packet.<a class="pilcrow" href="#section-1.3-4.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.5">AUTH</dt>
          <dd id="section-1.3-4.6" style="margin-left: 4.0em">
                            An AUTH Control Packet is sent from the Client to the Broker or
                            from the Broker to the Client as part of an extended authentication exchange.
                            AUTH properties include the Authentication Method and Authentication Data.
                            The Authentication Method is set in the CONNECT packet, and consequent
                            AUTH packets follow the same Authentication Method.
                            The contents of the Authentication Data are defined by the Authentication Method.<a class="pilcrow" href="#section-1.3-4.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.7">PUBLISH</dt>
          <dd id="section-1.3-4.8" style="margin-left: 4.0em">
                            Publish request sent from a publishing Client to the Broker or from the Broker to a
                            subscribing Client.<a class="pilcrow" href="#section-1.3-4.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.9">PUBACK</dt>
          <dd id="section-1.3-4.10" style="margin-left: 4.0em">
                            Response to a PUBLISH request with QoS level 1. PUBACK can be sent from the Broker to a
                            Client or from a Client to the Broker.<a class="pilcrow" href="#section-1.3-4.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.11">PUBREC</dt>
          <dd id="section-1.3-4.12" style="margin-left: 4.0em">
                            Response to a PUBLISH request with QoS level 2. PUBREC can be sent from the Broker to a
                            Client or from a Client to the Broker.<a class="pilcrow" href="#section-1.3-4.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.13">SUBSCRIBE</dt>
          <dd id="section-1.3-4.14" style="margin-left: 4.0em">
                            Subscribe request sent from a Client.<a class="pilcrow" href="#section-1.3-4.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.15">SUBACK</dt>
          <dd id="section-1.3-4.16" style="margin-left: 4.0em">
                            Subscribe acknowledgment from the Broker to the Client.<a class="pilcrow" href="#section-1.3-4.16">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.17">PINGREQ</dt>
          <dd id="section-1.3-4.18" style="margin-left: 4.0em">
                 A ping request sent from a Client to the Broker.  It signals to the Broker that the Client is alive and
                 is used to confirm that the Broker is also alive. The "Keep Alive" period is set in the CONNECT packet.<a class="pilcrow" href="#section-1.3-4.18">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.19">PINGRESP</dt>
          <dd id="section-1.3-4.20" style="margin-left: 4.0em">
                 Response sent by the Broker to the Client in response to PINGREQ. It indicates the Broker is alive.<a class="pilcrow" href="#section-1.3-4.20">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.21">DISCONNECT</dt>
          <dd id="section-1.3-4.22" style="margin-left: 4.0em">
                            The DISCONNECT packet is the final MQTT Control Packet 
                            sent from the Client or the Broker. 
                            It indicates the reason why the Network Connection is being closed.
                            If the Network Connection is closed without the Client first sending a 
                            DISCONNECT packet with reason code 0x00 (Normal disconnection) and 
                            the MQTT Connection has a Will Message, the Will Message is published.<a class="pilcrow" href="#section-1.3-4.22">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-4.23">Will</dt>
          <dd id="section-1.3-4.24" style="margin-left: 4.0em">
            <p id="section-1.3-4.24.1">
                            If the Network Connection is not closed normally, the Broker sends a last Will Message
                            for the Client if the Client provided one in its CONNECT packet.
                            Situations in which the Will Message is published include, but are not limited to, the following:<a class="pilcrow" href="#section-1.3-4.24.1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-4.24.2.1">an I/O error or network failure detected by the Broker,<a class="pilcrow" href="#section-1.3-4.24.2.1">¶</a>
</li>
              <li class="normal" id="section-1.3-4.24.2.2">the Client fails to communicate within the Keep Alive period,<a class="pilcrow" href="#section-1.3-4.24.2.2">¶</a>
</li>
              <li class="normal" id="section-1.3-4.24.2.3">the Client closes the Network Connection without first sending a DISCONNECT packet with reason code 0x00 (Normal disconnection), and<a class="pilcrow" href="#section-1.3-4.24.2.3">¶</a>
</li>
              <li class="normal" id="section-1.3-4.24.2.4">the Broker closes the Network Connection without first receiving a DISCONNECT packet with reason code 0x00 (Normal disconnection).<a class="pilcrow" href="#section-1.3-4.24.2.4">¶</a>
</li>
            </ul>
<p id="section-1.3-4.24.3">
                            If the Will Flag is set in the CONNECT flags, then the Payload of the CONNECT packet includes information
                            about the Will. The information consists of the Will Properties, Will Topic,
                            and Will Payload fields.<a class="pilcrow" href="#section-1.3-4.24.3">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="token_acquisition">
<section id="section-2">
      <h2 id="name-authorizing-connection-requ">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-authorizing-connection-requ">Authorizing Connection Requests</a>
      </h2>
<p id="section-2-1">
            This section specifies how Client connections are authorized by the AS 
            and verified by the MQTT Broker. <a class="auto internal xref" href="#protocol_flow">Figure 1</a> shows the basic protocol flows 
            during connection setup. The token request and response use the token endpoint 
            at the AS, specified for HTTP-based interactions in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8">Section 5.8</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>. 
            Steps (D) and (E) are optional and use the introspection endpoint specified in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9">Section 5.9</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.
            The discussion in this document assumes that the Client and the Broker use HTTPS to communicate 
            with the AS via these endpoints. The Client and the Broker use MQTT to communicate between them.
            The C-AS and Broker-AS communications <span class="bcp14">MAY</span> be implemented using protocols other than HTTPS,
            e.g., CoAP or MQTT.  Whatever protocol is used for the C-AS and Broker-AS communications <span class="bcp14">MUST</span> provide mutual
            authentication, confidentiality protection, and integrity protection.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2">
            If the Client is resource constrained or does not support HTTPS, a separate Client Authorization Server
            may carry out the token request on behalf of the Client (<a class="auto internal xref" href="#protocol_flow">Figure 1</a>, steps (A) and (B)) and, later, onboard the Client with the token.
            The interactions between a Client and its Client Authorization Server for token
            onboarding and support for MQTT-based token requests at the AS are out of the scope of this document.<a class="pilcrow" href="#section-2-2">¶</a></p>
<span id="name-connection-setup"></span><div id="protocol_flow">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-2-3.1">
<pre>                              +---------------------+
                              | Client              |
                              |                     |
   +---(A) Token request------| Client -            |
   |                          | Authorization       |
   |   +-(B) Access token-----&gt; Server Interface    |
   |   |                      |       (HTTPS)       |
   |   |                      |_____________________|
   |   |                      |                     |
+--v-------------+            |  Pub/Sub Interface  |
|  Authorization |            |   (MQTT over TLS)   |
|  Server        |            +----------------^----+
|________________|                 |           |
   |    ^                 (C) Connection   (F) Connection
   |    |                     request +        response
   |    |                     access token     |
   |    |                          |           |
   |    |                      +---v--------------+
   |    |                      |     Broker       |
   |    |                      |  (MQTT over TLS) |
   |    |                      |__________________|
   |    +(D) Introspection-----|                  |
   |         request (optional)| RS-AS interface  |
   |                           |     (HTTPS)      |
   +-(E) Introspection--------&gt;|__________________|
         response (optional)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-1">Figure 1</a>:
<a class="selfRef" href="#name-connection-setup">Connection Setup</a>
        </figcaption></figure>
</div>
<section id="section-2.1">
        <h3 id="name-client-token-request-to-the">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-client-token-request-to-the">Client Token Request to the Authorization Server (AS)</a>
        </h3>
<p id="section-2.1-1">
                The first step in the protocol flow (<a class="auto internal xref" href="#protocol_flow">Figure 1</a>, step (A)) is the token acquisition by the Client
                from the AS. The Client and the AS <span class="bcp14">MUST</span> perform mutual authentication.
                The Client requests an access token from the AS, as
                described in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.1">Section 5.8.1</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>. 
                The document follows the procedures defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.2.1">Section 3.2.1</a> of the DTLS profile [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>
                for raw public keys (RPKs) <span>[<a class="cite xref" href="#RFC7250">RFC7250</a>]</span>) and in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7250#section-3.3.1">Section 3.3.1</a> of [<a class="cite xref" href="#RFC7250">RFC7250</a>]</span> for pre-shared keys (PSKs).
                However, the content type of the request is set to "application/ace+json", 
                and the AS uses JSON in the Payload of its responses to the Client and the RS.
                As explained earlier, implementations <span class="bcp14">MAY</span> also use the  "application/ace+cbor" content type.<a class="pilcrow" href="#section-2.1-1">¶</a></p>
<p id="section-2.1-2"> On receipt of the token request, the AS verifies the request. 
                If the AS successfully verifies the access token request and authorizes the Client for the
                indicated audience (i.e., RS) and scopes (i.e., publish/subscribe permissions over topics, as described
                in <a class="auto internal xref" href="#scope">Section 2.3</a>),
                the AS issues an access token (<a class="auto internal xref" href="#protocol_flow">Figure 1</a>, step (B)).<a class="pilcrow" href="#section-2.1-2">¶</a></p>
<p id="section-2.1-3">The response includes the parameters described
                in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.2">Section 5.8.2</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.
                For RPKs, the parameters are as described 
                in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.2.1">Section 3.2.1</a> of the DTLS profile [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>. 
                For PSKs, the document follows <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.3.1">Section 3.3.1</a> of the DTLS profile [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>.
                In both cases,  if the response contains an "ace_profile" parameter, this parameter is set
                to "mqtt_tls".
                The returned token is a Proof-of-Possession (PoP) token by default.<a class="pilcrow" href="#section-2.1-3">¶</a></p>
<p id="section-2.1-4">
                This document follows <span>[<a class="cite xref" href="#RFC7800">RFC7800</a>]</span> for PoP semantics for JWTs 
                (CWTs <span class="bcp14">MAY</span> also be used). The AS includes a "cnf" (confirmation) parameter in the PoP token 
                to declare that the Client 
                possesses a particular key and the RS can cryptographically confirm that 
                the Client has possession of that key, as described in <span>[<a class="cite xref" href="#RFC9201">RFC9201</a>]</span>.<a class="pilcrow" href="#section-2.1-4">¶</a></p>
<p id="section-2.1-5">
                Note that the contents of the web tokens (including the "cnf" parameter) are to be consumed by the RS 
                and not the Client (the Client obtains the key information in a different manner).
                The RPK case is handled as described in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.2.1">Section 3.2.1</a> of the DTLS profile [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>.
                For the PSK case, the referenced procedures apply, with the following exceptions to accommodate 
                JWT and JOSE use. 
                In this case, the AS adds a "cnf" parameter to the Access Information 
                carrying  <span><a class="internal xref" href="#RFC7517">a JSON Web Key (JWK)</a> [<a class="cite xref" href="#RFC7517">RFC7517</a>]</span> object that contains 
                 either the symmetric key itself or a key identifier that can be used by the RS to 
                 determine the secret key it shares with the Client. 
                The JWT is created as explained in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7519#section-7">Section 7</a> of [<a class="cite xref" href="#RFC7519">RFC7519</a>]</span>, 
                 and the JWT <span class="bcp14">MUST</span> include <span><a class="internal xref" href="#RFC7516">a JSON Web Encryption (JWE)</a> [<a class="cite xref" href="#RFC7516">RFC7516</a>]</span>.
                If a CWT/COSE is used, this information <span class="bcp14">MUST</span> be inside the "COSE_Key" object 
                and <span class="bcp14">MUST</span> be encrypted using a "COSE_Encrypt0" structure.<a class="pilcrow" href="#section-2.1-5">¶</a></p>
<p id="section-2.1-6"> The AS returns error responses for JSON-based interactions
                following <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc6749#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC6749">RFC6749</a>]</span>.
                When CBOR is used, the interactions <span class="bcp14">MUST</span> implement the procedure described in 
                <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.8.3">Section 5.8.3</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.<a class="pilcrow" href="#section-2.1-6">¶</a></p>
</section>
<div id="connect_v5">
<section id="section-2.2">
        <h3 id="name-client-connection-request-t">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-client-connection-request-t">Client Connection Request to the Broker (C)</a>
        </h3>
<div id="auth_options">
<section id="section-2.2.1">
          <h4 id="name-overview-of-client-rs-authe">
<a class="section-number selfRef" href="#section-2.2.1">2.2.1. </a><a class="section-name selfRef" href="#name-overview-of-client-rs-authe">Overview of Client-RS Authentication Methods over TLS and MQTT</a>
          </h4>
<p id="section-2.2.1-1">
                    Unless the Client publishes and subscribes to only public topics, the Client and the Broker <span class="bcp14">MUST</span> perform mutual authentication.
                    The Client <span class="bcp14">MUST</span> authenticate to the Broker either over MQTT or TLS before performing any other action.
                    For MQTT, the options are "None" and "ace".
                    For TLS, the options are "Anon" for an anonymous client,
                    and "Known(RPK/PSK)" for RPKs and PSKs, respectively.
                    The "None" and "Anon" options do not provide client authentication but can be used either
                    during authentication or in combination with authentication at the other layer.
                    When the Client uses TLS:Anon,MQTT:None, the Client can only publish or subscribe to public topics.
                    Thus, the client authentication procedures involve the following possible combinations:<a class="pilcrow" href="#section-2.2.1-1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-2.2.1-2">
            <dt id="section-2.2.1-2.1">TLS:Anon,MQTT:None:</dt>
            <dd id="section-2.2.1-2.2" style="margin-left: 4.0em">This option is used only for the topics that do not require authorization,
                            including the "authz-info" topic. Publishing to the "authz-info" topic is described in <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a>.<a class="pilcrow" href="#section-2.2.1-2.2">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.2.1-2.3">TLS:Anon,MQTT:ace:</dt>
            <dd id="section-2.2.1-2.4" style="margin-left: 4.0em">The token is transported inside the CONNECT packet and <span class="bcp14">MUST</span> be
                            validated using one of the methods described in <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a>. This option also supports
                            a tokenless connection request for AS discovery.  As per the <span><a class="internal xref" href="#RFC9200">ACE framework</a> [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>, 
                            a separate step is needed to determine whether the discovered AS URI is authorized to act as an AS.<a class="pilcrow" href="#section-2.2.1-2.4">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.2.1-2.5">TLS:Known(RPK/PSK),MQTT:none:</dt>
            <dd id="section-2.2.1-2.6" style="margin-left: 4.0em">This specification supports client authentication with TLS with RPKs and PSKs, following the procedures 
                            described in the <span><a class="internal xref" href="#RFC9202">DTLS profile</a> [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>. 
                             For the RPK, the Client
                            <span class="bcp14">MUST</span> have published the token to the "authz-info" topic. For the PSK, the token <span class="bcp14">MAY</span> be published to the "authz-info" topic 
                            or <span class="bcp14">MAY</span> be, alternatively, 
                            provided as a  "PSK identity" (e.g., an "identity" in the "identities" field in the Client's "pre_shared_key" extension in TLS 1.3).<a class="pilcrow" href="#section-2.2.1-2.6">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-2.2.1-2.7">TLS:Known(RPK/PSK),MQTT:ace:</dt>
            <dd id="section-2.2.1-2.8" style="margin-left: 4.0em">This option <span class="bcp14">SHOULD NOT</span> be chosen as the token transported in the CONNECT packet and
                            overwrites any permissions passed during the TLS authentication.<a class="pilcrow" href="#section-2.2.1-2.8">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-2.2.1-3">
                     It is <span class="bcp14">RECOMMENDED</span> that the Client implements TLS:Anon,MQTT:ace as the first choice when working with protected topics.
                     However, MQTT v3.1.1 Clients that do not prefer to overload the User Name and Password fields 
                     for ACE (as described in <a class="auto internal xref" href="#MQTTv311">Section 6</a>) <span class="bcp14">MAY</span> implement TLS:Known(RPK/PSK),MQTT:none and,
                     consequently, TLS:Anon,MQTT:None to submit their token to "authz-info".<a class="pilcrow" href="#section-2.2.1-3">¶</a></p>
<p id="section-2.2.1-4">
                     The Broker <span class="bcp14">MUST</span> support TLS:Anon,MQTT:ace.
                     To support Clients with different capabilities, the Broker <span class="bcp14">MAY</span> provide multiple client authentication options,
                     e.g., support TLS:Known(RPK),MQTT:none and TLS:Anon,MQTT:None,
                     to enable RPK-based client authentication.<a class="pilcrow" href="#section-2.2.1-4">¶</a></p>
<p id="section-2.2.1-5">
                    The Client <span class="bcp14">MUST</span> authenticate the Broker during the TLS handshake.
                    If the Client authentication uses TLS:Known(RPK/PSK),
                    then the Broker is authenticated using the respective method.
                    Otherwise, to authenticate the Broker, the Client <span class="bcp14">MUST</span> validate a
                    public key from an X.509 certificate or an RPK from the Broker against the
                    "rs_cnf" parameter in the token response, which contains information
                    about the public key used by the RS to authenticate if the token type is "pop" 
                    and asymmetric keys are used as defined in <span>[<a class="cite xref" href="#RFC9201">RFC9201</a>]</span>.
                    The AS <span class="bcp14">MAY</span> include the thumbprint of the RS's X.509 certificate in the "rs_cnf"
                    (thumbprint, as defined in <span>[<a class="cite xref" href="#RFC9360">RFC9360</a>]</span>). In this case,
                    the Client <span class="bcp14">MUST</span> validate the RS certificate against this thumbprint.<a class="pilcrow" href="#section-2.2.1-5">¶</a></p>
</section>
</div>
<div id="app-authzinfo">
<section id="section-2.2.2">
          <h4 id="name-authz-info-the-authorizatio">
<a class="section-number selfRef" href="#section-2.2.2">2.2.2. </a><a class="section-name selfRef" href="#name-authz-info-the-authorizatio">authz-info: The Authorization Information Topic</a>
          </h4>
<p id="section-2.2.2-1">
                    In the cases when the Client must transport the token to the Broker first,
                    the Client connects to the Broker to publish its token to the "authz-info" topic.
                    The "authz-info" topic <span class="bcp14">MUST</span> only be published (i.e., the Clients are not allowed to subscribe to it).
                    "authz-info" is not protected, and hence, the Client uses the TLS:Anon,MQTT:None option over a TLS connection.
                    After publishing the token, the Client disconnects from the Broker and is expected to reconnect
                    using client authentication over TLS (i.e., TLS:Known(RPK/PSK),MQTT:none).<a class="pilcrow" href="#section-2.2.2-1">¶</a></p>
<p id="section-2.2.2-2">
                    The Broker stores and indexes all tokens received to the "authz-info" topic in its key store
                    (similar to the <span><a class="internal xref" href="#RFC9202">DTLS profile for ACE</a> [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>).
                    This profile follows the recommendation of
                    <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.10.1">Section 5.10.1</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>
                    and expects that the Broker stores only one token per PoP key, and any other
                    token linked to the same key overwrites an existing token.<a class="pilcrow" href="#section-2.2.2-2">¶</a></p>
<p id="section-2.2.2-3">
                    The Broker <span class="bcp14">MUST</span> verify the validity of the token
                    (i.e., through local validation or introspection if the token is a reference),
                    as described in <a class="auto internal xref" href="#token_validation">Section 2.2.5</a>.
                    If the token is not valid, the Broker <span class="bcp14">MUST</span> discard the token.<a class="pilcrow" href="#section-2.2.2-3">¶</a></p>
<p id="section-2.2.2-4">
                    Depending on the QoS level of the PUBLISH packet, the Broker returns
                    the error response as a PUBACK, PUBREC, or DISCONNECT packet.
                    If the QoS level is equal to 0, and the token is not valid, or if the claims
                    cannot be obtained in the case of an introspected token, the Broker <span class="bcp14">MUST</span>
                    send a DISCONNECT packet with reason code 0x87 (Not authorized).
                    If the PUBLISH Payload does not parse to a token, the Broker <span class="bcp14">MUST</span> send a DISCONNECT with
                    reason code 0x99 (Payload format invalid).<a class="pilcrow" href="#section-2.2.2-4">¶</a></p>
<p id="section-2.2.2-5">
                    If the QoS level of the PUBLISH packet is greater than or equal to 1, and the token is not valid, or
                    the claims cannot be obtained in the case of an introspected token,
                    the Broker <span class="bcp14">MUST</span> send reason code 0x87 (Not authorized) in the PUBACK or PUBREC.  If the PUBLISH Payload does not parse to a token,
                    the PUBACK/PUBREC reason code is 0x99 (Payload format invalid).<a class="pilcrow" href="#section-2.2.2-5">¶</a></p>
<p id="section-2.2.2-6">
                    When the Broker sends the "Not authorized" response, it must be noted that this corresponds
                    to the token being not valid and not that the actual PUBLISH packet was not authorized.
                    Given that the "authz-info" is a public topic, this response is not
                    expected to cause confusion.<a class="pilcrow" href="#section-2.2.2-6">¶</a></p>
</section>
</div>
<div id="auth-TLS">
<section id="section-2.2.3">
          <h4 id="name-client-authentication-over-">
<a class="section-number selfRef" href="#section-2.2.3">2.2.3. </a><a class="section-name selfRef" href="#name-client-authentication-over-">Client Authentication over TLS</a>
          </h4>
<p id="section-2.2.3-1">
                 This document supports TLS with raw public keys (RPKs) 
                <span>[<a class="cite xref" href="#RFC7250">RFC7250</a>]</span> and with pre-shared keys (PSKs).
                The TLS session setup follows the
                <span><a class="internal xref" href="#RFC9202">DTLS profile for ACE</a> [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>, 
                  as the profile applies to TLS equally well 
                  <span>[<a class="cite xref" href="#RFC9430">RFC9430</a>]</span>. 
                When there are exceptions to the DTLS profile, these are explicitly 
                stated in the document.
                If TLS 1.2 is used, <span>[<a class="cite xref" href="#RFC7925">RFC7925</a>]</span> describes 
                how TLS can be used for constrained devices, alongside recommended cipher suites. 
                Additionally, TLS 1.2 implementations <span class="bcp14">MUST</span> use the "Extended Main Secret" extension (terminology adopted 
                from <span>[<a class="cite xref" href="#I-D.ietf-tls-rfc8446bis">TLS-bis</a>]</span>)
                to incorporate the handshake transcript into the main secret  <span>[<a class="cite xref" href="#RFC7627">RFC7627</a>]</span>.  TLS implementations <span class="bcp14">SHOULD</span> use the

                Server Name Indication (SNI) <span>[<a class="cite xref" href="#RFC6066">RFC6066</a>]</span> and Application-Layer Protocol Negotiation (ALPN) 
                <span>[<a class="cite xref" href="#RFC7301">RFC7301</a>]</span> extensions so the TLS handshake authenticates as much of the protocol context as possible.<a class="pilcrow" href="#section-2.2.3-1">¶</a></p>
<div id="TLS-RPK">
<section id="section-2.2.3.1">
            <h5 id="name-raw-public-key-mode">
<a class="section-number selfRef" href="#section-2.2.3.1">2.2.3.1. </a><a class="section-name selfRef" href="#name-raw-public-key-mode">Raw Public Key Mode</a>
            </h5>
<p id="section-2.2.3.1-1">
                 This document follows the procedures defined in
                 <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.2.2">Section 3.2.2</a> of the DTLS profile for ACE [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span> with 
                 the following exceptions. 
                 The Client <span class="bcp14">MUST</span> upload the access token to the Broker using the method specified in 
                 <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a> before initiating the handshake.<a class="pilcrow" href="#section-2.2.3.1-1">¶</a></p>
</section>
</div>
<div id="TLS-PSK">
<section id="section-2.2.3.2">
            <h5 id="name-pre-shared-key-mode">
<a class="section-number selfRef" href="#section-2.2.3.2">2.2.3.2. </a><a class="section-name selfRef" href="#name-pre-shared-key-mode">Pre-Shared Key Mode</a>
            </h5>
<p id="section-2.2.3.2-1">
                 This document follows the procedures defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9202#section-3.3.2">Section 3.3.2</a> of the DTLS profile for ACE [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span> with 
                 the following exceptions.<a class="pilcrow" href="#section-2.2.3.2-1">¶</a></p>
<p id="section-2.2.3.2-2">
          To use TLS 1.3 with pre-shared keys, the Client utilizes the PSK
   extension specified in <span>[<a class="cite xref" href="#RFC8446">RFC8446</a>]</span> using the key conveyed in the "cnf"
   parameter of the AS response.
 The same key is bound to the access token 
                in the "cnf" claim. The Client can upload the token, as specified in 
                 <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a>, before initiating the handshake.
                 When using a previously uploaded token, the Client <span class="bcp14">MUST</span> indicate during the handshake which previously uploaded access token 
                 it intends to use.  To do so, it <span class="bcp14">MUST</span> create a "COSE_Key" or "JWK" structure with the "kid"
                 that was conveyed in the "rs_cnf" claim in the token response from
                 the AS and the key type "symmetric". This structure is then included as the only element 
                 in the "cnf" structure and the encoded value of that "cnf" structure used as a PSK identity in TLS.
                 As an alternative to the access token upload, the Client can provide the most recent access token, 
                 JWT or CWT, as a PSK identity.<a class="pilcrow" href="#section-2.2.3.2-2">¶</a></p>
<p id="section-2.2.3.2-3">
                In contrast to the <span><a class="internal xref" href="#RFC9202">DTLS profile for ACE</a> [<a class="cite xref" href="#RFC9202">RFC9202</a>]</span>, 
                a Client <span class="bcp14">MAY</span> omit support for the cipher suites TLS_PSK_WITH_AES_128_CCM_8 and TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8. 
                For TLS 1.2, however, a client <span class="bcp14">MUST</span> support TLS_ECDHE_PSK_WITH_AES_128_GCM_SHA256 for PSKs <span>[<a class="cite xref" href="#RFC8442">RFC8442</a>]</span> and TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 for RPKs <span>[<a class="cite xref" href="#RFC8422">RFC8422</a>]</span>, 
                as recommended in <span>[<a class="cite xref" href="#RFC9325">RFC9325</a>]</span> (and adjusted to be a PSK cipher suite as appropriate).<a class="pilcrow" href="#section-2.2.3.2-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="auth-ACE">
<section id="section-2.2.4">
          <h4 id="name-client-authentication-over-m">
<a class="section-number selfRef" href="#section-2.2.4">2.2.4. </a><a class="section-name selfRef" href="#name-client-authentication-over-m">Client Authentication over MQTT</a>
          </h4>
<div id="token-CONNECT">
<section id="section-2.2.4.1">
            <h5 id="name-transporting-the-access-tok">
<a class="section-number selfRef" href="#section-2.2.4.1">2.2.4.1. </a><a class="section-name selfRef" href="#name-transporting-the-access-tok">Transporting the Access Token inside the MQTT CONNECT</a>
            </h5>
<p id="section-2.2.4.1-1">
                    This section describes how the Client transports the token to the Broker
                    inside the CONNECT packet. If this method is used,
                    the Client TLS connection is expected to be anonymous, and the Broker is
                    authenticated during the TLS connection setup.
                    The approach described in this section is similar to an earlier proposal
                     by Fremantle, et al. <span>[<a class="cite xref" href="#Fremantle14">Fremantle14</a>]</span>.<a class="pilcrow" href="#section-2.2.4.1-1">¶</a></p>
<p id="section-2.2.4.1-2">
                    After sending the CONNECT packet, the Client <span class="bcp14">MUST</span> wait to receive the CONNACK packet from
                    the Broker. The only packets it is allowed to send are DISCONNECT
                    or AUTH that are in response to the Broker AUTH.
                    Similarly, except for a DISCONNECT and AUTH response from the Client,
                    the Broker <span class="bcp14">MUST NOT</span> process any packets before sending a CONNACK packet.<a class="pilcrow" href="#section-2.2.4.1-2">¶</a></p>
<p id="section-2.2.4.1-3">
             <a class="auto internal xref" href="#mqtt5_connect_message">Figure 2</a> shows the structure of the
                    MQTT CONNECT packet used in MQTT v5.0.
                    A CONNECT packet is composed of a Fixed Header, a Variable Header, and a Payload
                    The Fixed Header contains the Control Packet Type (CPT), Reserved, and Remaining Length fields.
                    The Remaining Length is a Variable Byte Integer that represents the number of bytes 
                    remaining within the current Control Packet, including data in the Variable Header and the Payload.
                    The Variable Header contains the Protocol Name, Protocol Level,
                    Connect flags, Keep Alive, and Properties fields.
                    The Connect flags in the Variable Header specify the properties of the MQTT Session.
                    It also indicates the presence or absence of some fields in the Payload.
                    The Payload contains one or more encoded fields, namely a unique Client
                    Identifier for the Client, a Will Topic, Will Payload, User Name, and Password.
                    All but the Client Identifier can be omitted depending on the flags in the Variable Header.
                    The Client Identifier identifies the Client to the Broker and, therefore, 
                    is unique for each Client. It must be noted that the Client Identifier is an unauthenticated identifier
                    used within the MQTT protocol and so is not bound to the access token.<a class="pilcrow" href="#section-2.2.4.1-3">¶</a></p>
<span id="name-mqtt-v5-connect-variable-he"></span><div id="mqtt5_connect_message">
<figure id="figure-2">
              <div class="alignCenter art-text artwork" id="section-2.2.4.1-4.1">
<pre>0             8             16
+---------------------------+
|Protocol name length = 4   |
+---------------------------+
|     'M'            'Q'    |
+---------------------------+
|     'T'            'T'    |
+---------------------------+
|Proto.level=5|Connect flags|
+---------------------------+
|        Keep alive         |
+---------------------------+
| CONNECT Properties Length |
|      (up to 4 bytes)      |
+---------------------------+
| ( ..Other properties..)   |
+---------------------------+
|  Authentication Method    |
|      (0x15)  |   Len      |
|      Len     |   'a'      |
|      'c'     |   'e'      |
+---------------------------+
|  Authentication Data      |
|     (0x16)   |    Len     |
|      Len     |   token    |
|  or token + PoP data      |
+---------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-2">Figure 2</a>:
<a class="selfRef" href="#name-mqtt-v5-connect-variable-he">MQTT v5 CONNECT Variable Header with Authentication Method Property for ACE</a>
              </figcaption></figure>
</div>
<p id="section-2.2.4.1-5">
                The CONNECT flags are User Name, Password, Will Retain, Will QoS, Will Flag,
                Clean Start, and Reserved.
                <a class="auto internal xref" href="#mqttv5_connect_flags">Table 1</a> shows how the
                flags <span class="bcp14">MUST</span> be set to use AUTH packets for authentication and authorization,
                i.e., the User Name Flag and Password Flag <span class="bcp14">MUST</span> be set to 0.
                An MQTT v5.0 Broker <span class="bcp14">MAY</span> also support token transport using the User Name and Password to provide
                a security option for MQTT v3.1.1 Clients, as
                described in  <a class="auto internal xref" href="#MQTTv311">Section 6</a>.<a class="pilcrow" href="#section-2.2.4.1-5">¶</a></p>
<span id="name-connect-flags-for-auth"></span><div id="mqttv5_connect_flags">
<table class="center" id="table-1">
              <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-connect-flags-for-auth">CONNECT Flags for AUTH</a>
              </caption>
<thead>
                <tr>
                  <th class="text-left" colspan="1" rowspan="1">User Name Flag</th>
                  <th class="text-left" colspan="1" rowspan="1">Password Flag</th>
                  <th class="text-left" colspan="1" rowspan="1">Will Retain</th>
                  <th class="text-left" colspan="1" rowspan="1">Will QoS</th>
                  <th class="text-left" colspan="1" rowspan="1">Will Flag</th>
                  <th class="text-left" colspan="1" rowspan="1">Clean Start</th>
                  <th class="text-left" colspan="1" rowspan="1">Reserved</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-center" colspan="1" rowspan="1">0</td>
                  <td class="text-center" colspan="1" rowspan="1">0</td>
                  <td class="text-center" colspan="1" rowspan="1">X</td>
                  <td class="text-center" colspan="1" rowspan="1">X X</td>
                  <td class="text-center" colspan="1" rowspan="1">X</td>
                  <td class="text-center" colspan="1" rowspan="1">X</td>
                  <td class="text-center" colspan="1" rowspan="1">0</td>
                </tr>
              </tbody>
            </table>
</div>
<p id="section-2.2.4.1-7">
                The Will Flag indicates that a Will Message needs to be sent. 
                The Client <span class="bcp14">MAY</span> set the Will Flag as desired (marked as "X" in <a class="auto internal xref" href="#mqttv5_connect_flags">Table 1</a>).
                If the Will Flag is set to 1,  the Broker <span class="bcp14">MUST</span> check that the token
                allows the publication of the Will Message (i.e., the Will Topic Filter is in the scope array). 
                The check is performed against the token scope
                described in <a class="auto internal xref" href="#scope">Section 2.3</a>. If the Will authorization fails, the connection 
                is refused, as described in  <a class="auto internal xref" href="#as_discovery">Section 2.4.1</a>.
                If the Broker accepts the connection request, the Broker
                stores the Will Message and  publishes it when the Network Connection is closed according to Will QoS,
             Will Retain parameters, and MQTT Will management rules.  To avoid publishing the Will Messages
                in the case of temporary network disconnections,
                the Client specifies a Will Delay Interval in the Will Properties.
                <a class="auto internal xref" href="#disconnections">Section 5</a> explains how the Broker deals with the retained messages in further detail.<a class="pilcrow" href="#section-2.2.4.1-7">¶</a></p>
<p id="section-2.2.4.1-8">
       In MQTT v5.0, the Client signals a new Session (i.e., that the Session does not continue an existing Session) by setting the Clean Start flag to 1 in the CONNECT packet. In this profile, the Client <span class="bcp14">SHOULD</span> always start with a new Session. The Broker <span class="bcp14">MAY</span> also signal that it does not support the continuation of an existing Session by setting the Session Expiry Interval to 0 in the CONNACK. If the Broker starts a new Session, the Broker <span class="bcp14">MUST</span> set the Session Present flag to 0 in the CONNACK packet to signal this to the Client.<a class="pilcrow" href="#section-2.2.4.1-8">¶</a></p>
<p id="section-2.2.4.1-9">
        The Broker <span class="bcp14">MAY</span> support continuing an existing Session, e.g., if the Broker requires it for QoS reasons. In this case, if a CONNECT packet is received with Clean Start set to 0, and there is a Session associated with the Client Identifier, the Broker <span class="bcp14">MUST</span> resume communications with the Client based on the state from the existing Session. In its response, the Broker <span class="bcp14">MUST</span> set the Session Present flag to 1 in the CONNACK packet to signal the continuation of an existing Session to the Client. The Session State stored by the Client and the Broker is described in <a class="auto internal xref" href="#disconnections">Section 5</a>.<a class="pilcrow" href="#section-2.2.4.1-9">¶</a></p>
<p id="section-2.2.4.1-10">
       When reconnecting to a Broker that supports continuing existing Sessions, the Client <span class="bcp14">MUST</span> still provide a token in addition to using the same Client Identifier and setting the Clean Start to 0. The Broker <span class="bcp14">MUST</span> still perform PoP validation on the provided token. If the token matches the stored state, the Broker <span class="bcp14">MAY</span> skip introspecting a token-by-reference and use the stored introspection result. The Broker <span class="bcp14">MUST</span> also verify the Client is authorized to receive or send MQTT packets that are pending transmission. When a Client connects with a long Session Expiry Interval, the Broker may need to maintain the Client's MQTT Session State after it disconnects for an extended period. Brokers <span class="bcp14">SHOULD</span> implement administrative policies to limit misuse.<a class="pilcrow" href="#section-2.2.4.1-10">¶</a></p>
<p id="section-2.2.4.1-11">
       Note that, according to the MQTT standard, the Broker uses the Client Identifier to identify the Session State. In the case of a Client Identifier collision, a Client may take over another Client's Session.
       Given that the Broker <span class="bcp14">MUST</span> associate the Client with a valid token, a Client will only send or receive messages to its authorized topics.
                Therefore, while this issue is not expected to affect security,
                it may affect QoS (i.e., PUBLISH or QoS messages saved for Client A may be delivered to a Client B).
                In addition, if this Client Identifier represents a Client already connected to the Broker,
                the Broker sends a DISCONNECT packet to the existing Client with reason code 0x8E (Session taken over)
                and closes the connection to the Client.<a class="pilcrow" href="#section-2.2.4.1-11">¶</a></p>
</section>
</div>
<div id="AUTH-method">
<section id="section-2.2.4.2">
            <h5 id="name-authentication-using-the-au">
<a class="section-number selfRef" href="#section-2.2.4.2">2.2.4.2. </a><a class="section-name selfRef" href="#name-authentication-using-the-au">Authentication Using the AUTH Property</a>
            </h5>
<p id="section-2.2.4.2-1"><a class="auto internal xref" href="#mqtt5_connect_message">Figure 2</a> shows the Authentication Method and Authentication Data fields when the client authenticates using the AUTH property. The Client <span class="bcp14">MUST</span> set the Authentication Method as a property of a CONNECT packet by using the property identifier 21 (0x15). This is followed by a UTF-8-encoded string containing the name of the Authentication Method, which <span class="bcp14">MUST</span> be set to "ace". If the Broker does not support this profile, it sends a CONNACK packet with reason code 0x8C (Bad authentication method).<a class="pilcrow" href="#section-2.2.4.2-1">¶</a></p>
<p id="section-2.2.4.2-2">
                The Authentication Method is followed by the Authentication Data,
                which has a property identifier 22 (0x16) and is Binary Data.
                Based on the Authentication Data, the Broker <span class="bcp14">MUST</span> support both options below:<a class="pilcrow" href="#section-2.2.4.2-2">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.4.2-3.1">proof of possession using a challenge from the TLS session<a class="pilcrow" href="#section-2.2.4.2-3.1">¶</a>
</li>
              <li class="normal" id="section-2.2.4.2-3.2">proof of possession via a Broker-generated challenge/response<a class="pilcrow" href="#section-2.2.4.2-3.2">¶</a>
</li>
            </ul>
<div id="pop_nonce">
<section id="section-2.2.4.2.1">
              <h6 id="name-proof-of-possession-using-a">
<a class="section-number selfRef" href="#section-2.2.4.2.1">2.2.4.2.1. </a><a class="section-name selfRef" href="#name-proof-of-possession-using-a">Proof of Possession Using a Challenge from the TLS Session</a>
              </h6>
<span id="name-authentication-data-for-pop"></span><div id="authdata_tlsexporter">
<figure id="figure-3">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.1-1.1">
<pre>+-----------------------------------------------------------------+
|Authentication|Token Length|Token   |MAC or Signature            |
|Data Length   |            |        |(over TLS exporter content) |
+-----------------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-3">Figure 3</a>:
<a class="selfRef" href="#name-authentication-data-for-pop">Authentication Data for PoP Based on TLS Exporter Content</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.1-2">
                For this option, the Authentication Data inside the Client's CONNECT packet <span class="bcp14">MUST</span> contain the two-byte integer token length,
                the token, and the keyed message digest (MAC) or the Client signature (as shown in 
                <a class="auto internal xref" href="#authdata_tlsexporter">Figure 3</a>).
                The Proof-of-Possession key in the token is used to calculate
                 the keyed message digest (MAC) or the Client signature
                based on the content obtained from the TLS exporter (<span>[<a class="cite xref" href="#RFC5705">RFC5705</a>]</span>
                for TLS 1.2 and <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc8446#section-7.5">Section 7.5</a> of [<a class="cite xref" href="#RFC8446">RFC8446</a>]</span> for TLS 1.3).
                This content is exported from the TLS session using the exporter label "EXPORTER-ACE-MQTT-Sign-Challenge",
                an empty context, and a length of 32 bytes.
                The token is also validated, as described in  <a class="auto internal xref" href="#token_validation">Section 2.2.5</a>,
                and the Broker responds with a CONNACK packet with the appropriate response code.
                The Client cannot reauthenticate using this method during the same TLS session (see <a class="auto internal xref" href="#reauthentication">Section 4</a>).<a class="pilcrow" href="#section-2.2.4.2.1-2">¶</a></p>
</section>
</div>
<div id="pop_challenge">
<section id="section-2.2.4.2.2">
              <h6 id="name-proof-of-possession-via-bro">
<a class="section-number selfRef" href="#section-2.2.4.2.2">2.2.4.2.2. </a><a class="section-name selfRef" href="#name-proof-of-possession-via-bro">Proof of Possession via Broker-generated Challenge/Response</a>
              </h6>
<span id="name-authentication-data-to-init"></span><div id="authdata_challenge_client">
<figure id="figure-4">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-1.1">
<pre>+------------------------------------+
|Authentication|Token Length|Token   |
|Data Length   |            |        |
+------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-4">Figure 4</a>:
<a class="selfRef" href="#name-authentication-data-to-init">Authentication Data to Initiate PoP Based on Challenge/Response</a>
                </figcaption></figure>
</div>
<span id="name-authentication-data-for-bro"></span><div id="authdata_challenge_broker_challenge">
<figure id="figure-5">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-2.1">
<pre>+--------------------------+
|Authentication|RS Nonce   |
|Data Length   |(8 bytes)  |
+--------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-5">Figure 5</a>:
<a class="selfRef" href="#name-authentication-data-for-bro">Authentication Data for Broker Challenge</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.2-3">
             For this option, the Broker follows a Broker-generated challenge/response protocol.
                If the Authentication Data inside the Client's CONNECT contains only the two-byte integer token length and
                the token (as shown in <a class="auto internal xref" href="#authdata_challenge_client">Figure 4</a>),
                the Broker <span class="bcp14">MUST</span> respond with an AUTH packet
                with the authenticated reason code set to 0x18 (Continue Authentication).
                The Broker also uses this method if the Authentication Data does not 
                contain a token, but the Broker has a token stored for the connecting Client.<a class="pilcrow" href="#section-2.2.4.2.2-3">¶</a></p>
<p id="section-2.2.4.2.2-4">
                The Broker continues authentication using an AUTH packet that contains the Authentication Method 
                and the Authentication Data. The Authentication Method <span class="bcp14">MUST</span> be set to "ace", and the Authentication Data <span class="bcp14">MUST NOT</span> be empty and 
                <span class="bcp14">MUST</span> contain an 8-byte RS nonce as a challenge for the Client (<a class="auto internal xref" href="#authdata_challenge_broker_challenge">Figure 5</a>).<a class="pilcrow" href="#section-2.2.4.2.2-4">¶</a></p>
<span id="name-authentication-data-for-the"></span><div id="authdata_challenge_client_response">
<figure id="figure-6">
                <div class="alignLeft art-text artwork" id="section-2.2.4.2.2-5.1">
<pre>+---------------------------------------------------------+
|Authentication|Client Nonce |MAC or Signature            |
|Data Length   |(8 bytes)    |(over RS nonce+Client nonce)|
+---------------------------------------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-6">Figure 6</a>:
<a class="selfRef" href="#name-authentication-data-for-the">Authentication Data for the Client Challenge Response</a>
                </figcaption></figure>
</div>
<p id="section-2.2.4.2.2-6">
                The Client responds to this with an AUTH packet
                with reason code 0x18 (Continue Authentication).
                Similarly, the Client packet sets the Authentication Method to "ace".
                The Authentication Data in the Client's response is formatted as shown
                in <a class="auto internal xref" href="#authdata_challenge_client_response">Figure 6</a> and includes the 8-byte Client nonce and
                the signature or MAC computed over the RS nonce concatenated with the Client nonce
                using PoP key in the token.<a class="pilcrow" href="#section-2.2.4.2.2-6">¶</a></p>
<p id="section-2.2.4.2.2-7">
                Next, the token is validated as described in  <a class="auto internal xref" href="#token_validation">Section 2.2.5</a>.
                The success case is illustrated in <a class="auto internal xref" href="#pop_challenge_response">Figure 7</a>.
                The Client <span class="bcp14">MAY</span> also reauthenticate using this challenge-response flow,
                as described in <a class="auto internal xref" href="#reauthentication">Section 4</a>.<a class="pilcrow" href="#section-2.2.4.2.2-7">¶</a></p>
<span id="name-pop-challenge-response-flow"></span><div id="pop_challenge_response">
<figure id="figure-7">
                <div class="alignCenter art-text artwork" id="section-2.2.4.2.2-8.1">
<pre>Client      Broker
 |             |
 |&lt;===========&gt;| TLS connection setup
 |             |
 |             |
 +------------&gt;| CONNECT with Authentication Data
 |             | contains only token
 |             |
 &lt;-------------+ AUTH 0x18 (Cont. Authentication)
 |             | 8-byte RS nonce as challenge
 |             |
 |------------&gt;| AUTH 0x18 (Cont. Authentication)
 |             | 8-byte Client nonce + signature/MAC
 |             |
 |             |---+ Token validation
 |             |   | (may involve introspection)
 |             |&lt;--+
 |             |
 |&lt;------------+ CONNACK 0x00 (Success)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-7">Figure 7</a>:
<a class="selfRef" href="#name-pop-challenge-response-flow">PoP Challenge/Response Flow - Success</a>
                </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="token_validation">
<section id="section-2.2.5">
          <h4 id="name-broker-token-validation">
<a class="section-number selfRef" href="#section-2.2.5">2.2.5. </a><a class="section-name selfRef" href="#name-broker-token-validation">Broker Token Validation</a>
          </h4>
<p id="section-2.2.5-1">
                    The Broker <span class="bcp14">MUST</span> verify the validity of the token either locally
                    (e.g., in the case of a self-contained token) or <span class="bcp14">MAY</span> send a request to the
                    introspection endpoint of the AS (as described for HTTP-based interactions in
                    <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9">Section 5.9</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>).
                    The Broker <span class="bcp14">MUST</span> verify the claims in the access token according to the rules set in
                    <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.10.1.1">Section 5.10.1.1</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.<a class="pilcrow" href="#section-2.2.5-1">¶</a></p>
<p id="section-2.2.5-2">
                    To authenticate the Client, the Broker validates the signature or the MAC, depending on how the PoP protocol is implemented.
                    For self-contained tokens, the Broker <span class="bcp14">MUST</span> process the security protection of the token first, as specified by the respective token format, 
                    i.e., a CWT uses COSE, while a JWT uses JOSE.  For a token-by-reference, the 
                    Broker uses the "cnf" structure returned as a result of token introspection, as specified in <span>[<a class="cite xref" href="#RFC7519">RFC7519</a>]</span>. 
                    HMAC-SHA-256 (HS256) <span>[<a class="cite xref" href="#RFC6234">RFC6234</a>]</span> and Ed25519 <span>[<a class="cite xref" href="#RFC8032">RFC8032</a>]</span> are mandatory to implement
                    for the Broker. The Client <span class="bcp14">MUST</span> implement at least one of them depending on the choice of symmetric or asymmetric validation.
                    Validation of the signature or MAC <span class="bcp14">MUST</span> fail if the signature algorithm is set to "none"
                    when the key used for the signature algorithm cannot be determined or
                    the computed and received signature/MAC do not match.<a class="pilcrow" href="#section-2.2.5-2">¶</a></p>
<p id="section-2.2.5-3">
                The  Broker <span class="bcp14">MUST</span> check if the access token is still valid, 
                if it is the intended destination (i.e., the audience)
                of the token, and if the token was issued by an authorized
                 Authorization Server.  If the Client is using TLS RPK mode
                 to authenticate to the Broker,  the AS constructs the access token 
                 so that the Broker can associate the access token with the 
                 Client's public key.  The "cnf" claim <span class="bcp14">MUST</span> contain either the Client's RPK or, 
                 if the key is already known by the Broker (e.g., from previous communication), 
                 a reference to it.<a class="pilcrow" href="#section-2.2.5-3">¶</a></p>
</section>
</div>
</section>
</div>
<div id="scope">
<section id="section-2.3">
        <h3 id="name-token-scope-and-authorizati">
<a class="section-number selfRef" href="#section-2.3">2.3. </a><a class="section-name selfRef" href="#name-token-scope-and-authorizati">Token Scope and Authorization</a>
        </h3>
<p id="section-2.3-1">  
            The scope field contains the publish and subscribe permissions for the Client.
            Therefore, the token or its introspection result <span class="bcp14">MUST</span> be cached 
                to allow a Client's future PUBLISH and SUBSCRIBE messages.
                 During the CONNECT, if the Will Flag is set to 1, the Broker <span class="bcp14">MUST</span> also authorize
                the publication of the Will Topic and Will Message using the token's scope field.
            The Broker uses the scope to match against the Topic Name in a PUBLISH packet
            (including Will Topic in the CONNECT) or a Topic Filter in a SUBSCRIBE packet.<a class="pilcrow" href="#section-2.3-1">¶</a></p>
<p id="section-2.3-2">
            The scope in the token is a single value. For a JWT, the single scope 
            is a base64url-encoded string with any padding characters removed, which has an internal structure of a JSON array. 

            For a CWT, this information is represented in CBOR.  
            The internal structure follows the <span><a class="internal xref" href="#RFC9237">Authorization Information 
            Format (AIF) for ACE</a> [<a class="cite xref" href="#RFC9237">RFC9237</a>]</span>.
            Using the Concise Data Definition Language (CDDL) <span>[<a class="cite xref" href="#RFC8610">RFC8610</a>]</span>,
            the specific data model for MQTT is:<a class="pilcrow" href="#section-2.3-2">¶</a></p>
<span id="name-aif-mqtt-data-model"></span><div id="MQTTaif">
<figure id="figure-8">
          <div class="lang-cddl sourcecode" id="section-2.3-3.1">
<pre> AIF-MQTT = AIF-Generic&lt;mqtt-topic-filter, mqtt-permissions&gt;
 AIF-Generic&lt;Toid, Tperm&gt; = [* [Toid, Tperm]]
 mqtt-topic-filter = tstr ; as per Section 4.7 of MQTT v5.0
 mqtt-permissions = [+permission]
 permission = "pub"/"sub"
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-8">Figure 8</a>:
<a class="selfRef" href="#name-aif-mqtt-data-model">AIF-MQTT Data Model</a>
          </figcaption></figure>
</div>
<p id="section-2.3-4">
            Topic Filters are implemented according to Section 4.7 of the
            <span><a class="internal xref" href="#MQTT-OASIS-Standard-v5">MQTT v5.0 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v5">MQTT-OASIS-Standard-v5</a>]</span>.
            By default, Wildcard Subscriptions are supported, and so, 
            the Topic Filter may include special wildcard characters.
            The multi-level wildcard, "#", matches any number of levels within a topic, and the single-level wildcard, "+",
            matches one topic level.
            The Broker <span class="bcp14">MAY</span> signal in the CONNACK explicitly whether Wildcard Subscriptions are supported
            by returning a CONNACK property "Wildcard Subscription Available". 
            A value of 0 means that Wildcard Subscriptions are not supported. 
            A value of 1 means Wildcard Subscriptions are supported.<a class="pilcrow" href="#section-2.3-4">¶</a></p>
<p id="section-2.3-5"> Following this model, an example scope may contain:<a class="pilcrow" href="#section-2.3-5">¶</a></p>
<span id="name-example-scope"></span><div id="MQTTaifex">
<figure id="figure-9">
          <div class="lang-json sourcecode" id="section-2.3-6.1">
<pre> [["topic1",["pub","sub"]],["topic2/#",["pub"]],["+/topic3",["sub"]]]
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-9">Figure 9</a>:
<a class="selfRef" href="#name-example-scope">Example Scope</a>
          </figcaption></figure>
</div>
<p id="section-2.3-7">
            This access token gives publish ("pub") and subscribe ("sub") permissions to the "topic1",
            publish permission to all the subtopics of "topic2",
            and subscribe permission to all "topic3", skipping one level.<a class="pilcrow" href="#section-2.3-7">¶</a></p>
<p id="section-2.3-8">
            If the scope is empty, the Broker records
            no permissions for the Client for any topic. In this case, the Client
            is not able to publish or subscribe to any protected topics.
            The non-empty scope is used to authorize the Will Topic, if provided, in the CONNECT packet, 
            during connection setup and, if the connection request 
            succeeds, the Topic Names or Topic Filters requested in the future PUBLISH and SUBSCRIBE packets. 
            For the authorization to succeed, the Broker <span class="bcp14">MUST</span> verify that the Topic Name or Topic Filter in question is either 
            an exact match to or a subset of at least one "topic_filter" in the scope.<a class="pilcrow" href="#section-2.3-8">¶</a></p>
</section>
</div>
<section id="section-2.4">
        <h3 id="name-broker-response-to-client-c">
<a class="section-number selfRef" href="#section-2.4">2.4. </a><a class="section-name selfRef" href="#name-broker-response-to-client-c">Broker Response to Client Connection Request</a>
        </h3>
<p id="section-2.4-1">
                 Based on the validation result (obtained either via local inspection or using the introspection
                interface of the AS), the Broker <span class="bcp14">MUST</span> send a CONNACK packet to the Client.<a class="pilcrow" href="#section-2.4-1">¶</a></p>
<div id="as_discovery">
<section id="section-2.4.1">
          <h4 id="name-unauthorized-request-and-th">
<a class="section-number selfRef" href="#section-2.4.1">2.4.1. </a><a class="section-name selfRef" href="#name-unauthorized-request-and-th">Unauthorized Request and the Optional Authorization Server Discovery</a>
          </h4>
<p id="section-2.4.1-1"> Authentication can fail for the following reasons:<a class="pilcrow" href="#section-2.4.1-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4.1-2.1">if the Client does not provide a valid token,<a class="pilcrow" href="#section-2.4.1-2.1">¶</a>
</li>
            <li class="normal" id="section-2.4.1-2.2">the Client omits the Authentication Data field and the Broker
                        has no token stored for the Client,<a class="pilcrow" href="#section-2.4.1-2.2">¶</a>
</li>
            <li class="normal" id="section-2.4.1-2.3">the token or Authentication data are malformed, or<a class="pilcrow" href="#section-2.4.1-2.3">¶</a>
</li>
            <li class="normal" id="section-2.4.1-2.4">if the Will Flag is set, the authorization checks for 
                        the Will Topic fails.<a class="pilcrow" href="#section-2.4.1-2.4">¶</a>
</li>
          </ul>
<p id="section-2.4.1-3"> 
                    The Broker responds with the CONNACK reason code 0x87 (Not Authorized) or any other applicable
                    reason code.<a class="pilcrow" href="#section-2.4.1-3">¶</a></p>
<p id="section-2.4.1-4">
                        The Broker <span class="bcp14">MAY</span> also trigger AS discovery and include a User Property (identified as property type 38 (0x26)) 
                        in the CONNACK for the AS Request Creation Hints.
                        The User Property is a UTF-8 string pair, composed of a name and a value. The name
                        of the User Property <span class="bcp14">MUST</span> be set to "ace_as_hint". The value of the User Property
                        is a UTF-8-encoded JSON object containing the mandatory "AS" parameter
                         and the optional parameters "audience", "kid", "cnonce", and "scope", as defined
                         in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.3">Section 5.3</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.<a class="pilcrow" href="#section-2.4.1-4">¶</a></p>
</section>
</div>
<div id="auth_success">
<section id="section-2.4.2">
          <h4 id="name-authorization-success">
<a class="section-number selfRef" href="#section-2.4.2">2.4.2. </a><a class="section-name selfRef" href="#name-authorization-success">Authorization Success</a>
          </h4>
<p id="section-2.4.2-1">
            On success, the reason code of the CONNACK is 0x00 (Success).
     If the Broker starts a new Session, it <span class="bcp14">MUST</span> also set Session Present to 0 in the CONNACK packet to signal a new Session to the Client. Otherwise, it <span class="bcp14">MUST</span> set Session Present to 1.<a class="pilcrow" href="#section-2.4.2-1">¶</a></p>
<p id="section-2.4.2-2">
                    Having accepted the connection, the Broker <span class="bcp14">MUST</span> be prepared to store the token
                    during the connection and after disconnection for future use. 
                    If the token is not self-contained and the Broker uses token
                    introspection, it <span class="bcp14">MAY</span> cache the validation result to authorize
                    the subsequent PUBLISH and SUBSCRIBE packets.
                    PUBLISH and SUBSCRIBE packets, which are sent after a connection
                    setup, do not contain access tokens. If the introspection result
                    is not cached, the Broker needs to introspect the saved token for
                    each request. The Broker <span class="bcp14">SHOULD</span> also use a cache timeout to introspect
                    tokens regularly. The timeout value is specific to the application and should be chosen 
       to reduce the risk of using stale introspection responses.<a class="pilcrow" href="#section-2.4.2-2">¶</a></p>
</section>
</div>
</section>
</section>
</div>
<div id="pubsub_authorization">
<section id="section-3">
      <h2 id="name-authorizing-publish-and-sub">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-authorizing-publish-and-sub">Authorizing PUBLISH and SUBSCRIBE Packets</a>
      </h2>
<p id="section-3-1">
        Using the cached token or its introspection result, the Broker uses the scope field 
        to match against the Topic Name in a PUBLISH packet or a Topic Filter in a SUBSCRIBE packet.<a class="pilcrow" href="#section-3-1">¶</a></p>
<div id="publish-packets">
<section id="section-3.1">
        <h3 id="name-publish-packets-from-the-pu">
<a class="section-number selfRef" href="#section-3.1">3.1. </a><a class="section-name selfRef" href="#name-publish-packets-from-the-pu">PUBLISH Packets from the Publisher Client to the Broker</a>
        </h3>
<p id="section-3.1-1">
                On receiving the PUBLISH packet, the Broker <span class="bcp14">MUST</span> use the type of
                packet (i.e., PUBLISH) and the Topic Name in the packet header to match against the
                scope array items in the cached token or its introspection result.
                Following the example in <a class="auto internal xref" href="#scope">Section 2.3</a>, the Client sending a PUBLISH packet for "topic2/a" would be
                allowed, as the scope array includes the ["topic2/#",["pub"]].<a class="pilcrow" href="#section-3.1-1">¶</a></p>
<p id="section-3.1-2">
                If the Client is allowed to publish to the topic,
                the Broker publishes the message to all valid subscribers of the topic.
        In the case of an authorization failure, the Broker <span class="bcp14">MUST</span> return an error if
                the Client has set the QoS level of the PUBLISH packet to greater than or equal to 1.
                Depending on the QoS level, the Broker responds with either a PUBACK or PUBREC packet with reason code
             0x87 (Not authorized).
         On receiving an acknowledgment with 0x87 (Not authorized),
                the Client <span class="bcp14">MAY</span> reauthenticate by providing a new token, as described in <a class="auto internal xref" href="#reauthentication">Section 4</a>.<a class="pilcrow" href="#section-3.1-2">¶</a></p>
<p id="section-3.1-3">
                For QoS level 0, the Broker sends a DISCONNECT packet with reason code 0x87 (Not authorized)
                and closes the Network Connection.  Note that the server-side DISCONNECT is a new feature of MQTT v5.0 (in MQTT v3.1.1,
                the server needs to drop the connection).<a class="pilcrow" href="#section-3.1-3">¶</a></p>
<p id="section-3.1-4"> For all QoS levels, the Broker <span class="bcp14">MAY</span> return 0x80 (Unspecified error) if they do not want to leak the Topic Names to unauthorized clients.<a class="pilcrow" href="#section-3.1-4">¶</a></p>
</section>
</div>
<section id="section-3.2">
        <h3 id="name-publish-packets-from-the-br">
<a class="section-number selfRef" href="#section-3.2">3.2. </a><a class="section-name selfRef" href="#name-publish-packets-from-the-br">PUBLISH Packets from the Broker to the Subscriber Clients</a>
        </h3>
<p id="section-3.2-1">
   To forward PUBLISH packets to the subscribing Clients, the Broker identifies all the subscribers that have valid matching Topic Subscriptions to the Topic Name of the PUBLISH packet (i.e., the tokens are valid, and token scopes allow a Subscription to this particular Topic Name). 
                The Broker forwards the PUBLISH packet to all the valid
                subscribers.<a class="pilcrow" href="#section-3.2-1">¶</a></p>
<p id="section-3.2-2">
                The Broker <span class="bcp14">MUST NOT</span> forward messages to unauthorized subscribers.
                To avoid silently dropping messages, the Broker <span class="bcp14">MUST</span> close the Network Connection and 
                <span class="bcp14">SHOULD</span> inform the affected subscribers.
                In this case, the only way to inform a client would be sending a DISCONNECT packet.  
                Therefore, the Broker <span class="bcp14">SHOULD</span> send a DISCONNECT packet with reason code 0x87 (Not authorized)
                before closing the Network Connection to these clients.<a class="pilcrow" href="#section-3.2-2">¶</a></p>
</section>
<section id="section-3.3">
        <h3 id="name-authorizing-subscribe-packe">
<a class="section-number selfRef" href="#section-3.3">3.3. </a><a class="section-name selfRef" href="#name-authorizing-subscribe-packe">Authorizing SUBSCRIBE Packets</a>
        </h3>
<p id="section-3.3-1">
            In MQTT, a SUBSCRIBE packet is sent from a Client to the Broker
             to create one or more Subscriptions
            to one or more topics.
            The SUBSCRIBE packet may contain multiple Topic Filters.
            The Topic Filters may include wildcard characters.<a class="pilcrow" href="#section-3.3-1">¶</a></p>
<p id="section-3.3-2">
            On receiving the SUBSCRIBE packet, the Broker <span class="bcp14">MUST</span> use the type of packet (i.e.,
            SUBSCRIBE) and the Topic Filter in the packet header to match
            against the scope field of the stored token or introspection result.
            The Topic Filters <span class="bcp14">MUST</span> be an exact match to or be a subset of at least one of the "topic_filter" fields
            in the scope array found in the Client's token. For example, if the Client sends a SUBSCRIBE request for topic "a/b/*" and has a token that permits "a/*", this is a valid SUBSCRIBE request, as "a/b/*" is a subset of "a/*". (The process is similar to a Broker matching the Topic Name in a PUBLISH packet against the Subscriptions known to the Server.)<a class="pilcrow" href="#section-3.3-2">¶</a></p>
<p id="section-3.3-3">
            As a response to the SUBSCRIBE packet, the Broker issues a SUBACK packet.
             For each Topic Filter,
            the SUBACK packet includes a return code matching the QoS level
            for the corresponding Topic Filter. In the case of failure, the return code is 0x87,
            indicating that the Client is not authorized. The Broker <span class="bcp14">MAY</span> return 0x80 (Unspecified error)
            if they do not want to leak the Topic Names to unauthorized clients. 
            A reason code is returned for each Topic Filter.
     Therefore, the Client may receive success codes for a subset of its Topic Filters while being
     unauthorized for the rest.<a class="pilcrow" href="#section-3.3-3">¶</a></p>
</section>
</section>
</div>
<div id="reauthentication">
<section id="section-4">
      <h2 id="name-token-expiration-update-and">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-token-expiration-update-and">Token Expiration, Update, and Reauthentication</a>
      </h2>
<p id="section-4-1">
            The Broker <span class="bcp14">MUST</span> check for token expiration whenever a CONNECT, PUBLISH, or SUBSCRIBE packet is received
            or sent.
     The Broker <span class="bcp14">SHOULD</span> check for token expiration on receiving a PINGREQ packet.
            The Broker <span class="bcp14">MAY</span> also check for token expiration periodically, e.g., every hour. This may allow
     for early detection of a token expiry.<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">
            The token expiration is checked by checking the "exp" claim of a JWT or introspection response
             or via performing an
            introspection request with the AS, as described in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9200#section-5.9">Section 5.9</a> of the ACE framework [<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.
            Token expirations may trigger the Broker to send PUBACK, SUBACK, and DISCONNECT packets with the return code
            set to "Not authorized". After sending a DISCONNECT packet, the Network Connection is closed, and
            no more messages can be sent.<a class="pilcrow" href="#section-4-2">¶</a></p>
<p id="section-4-3">
     The Client <span class="bcp14">MAY</span> reauthenticate a response to
            PUBACK and SUBACK, which signal loss of authorization.
            The Clients <span class="bcp14">MAY</span> also proactively update their tokens, i.e., before
            they receive a packet with a "Not authorized" return code.
            To start reauthentication, the Client <span class="bcp14">MUST</span> send an AUTH packet with reason code
            0x19 (Reauthentication). The Client <span class="bcp14">MUST</span>
     set the Authentication Method as "ace" and transport the new token in the Authentication Data.
            If reauthenticating during the current TLS session, 
            the Client <span class="bcp14">MUST NOT</span> use the method described in <a class="auto internal xref" href="#pop_nonce">Section 2.2.4.2.1</a>, i.e.,
            proof of possession using a challenge from the TLS session, to avoid reusing the same challenge value from the TLS-Exporter.  
            Note that this means that servers will either need to record in the session ticket or database entry whether
             the TLS-Exporter-derived challenge was used or always deny use of the TLS-Exporter-derived challenge
              for resumed sessions.  In TLS 1.3, the resumed connection would have a new exporter value, 
              but the requirement is phrased this way for simplicity.
            For reauthentications in the same TLS-session,  the Client <span class="bcp14">MUST</span> use the challenge-response PoP, as defined
            in <a class="auto internal xref" href="#pop_challenge">Section 2.2.4.2.2</a>. 
            The Broker accepts reauthentication requests if the Client has already submitted
            a token (may be expired), for which it performed proof of possession.
            Otherwise, the Broker <span class="bcp14">MUST</span> deny the request.
     If the reauthentication fails, the Broker
     <span class="bcp14">MUST</span> send a DISCONNECT packet with reason code 0x87 (Not Authorized).<a class="pilcrow" href="#section-4-3">¶</a></p>
</section>
</div>
<div id="disconnections">
<section id="section-5">
      <h2 id="name-handling-disconnections-and">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-handling-disconnections-and">Handling Disconnections and Retained Messages</a>
      </h2>
<p id="section-5-1">
 In the case of a Client DISCONNECT, if the Session Expiry Interval is set to 0, the Broker doesn't store the Session State but <span class="bcp14">MUST</span> keep the retained messages. If the Broker stores the Session State, the state <span class="bcp14">MAY</span> include the token and its introspection result (for reference tokens) in addition to the MQTT Session State. The MQTT Session State is identified by the Client Identifier and includes the following:<a class="pilcrow" href="#section-5-1">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">the Client Subscriptions,<a class="pilcrow" href="#section-5-2.1">¶</a>
</li>
        <li class="normal" id="section-5-2.2">messages with QoS levels 1 and 2, which have
            not been completely acknowledged or are pending transmission to the Client, and<a class="pilcrow" href="#section-5-2.2">¶</a>
</li>
        <li class="normal" id="section-5-2.3">if the Session is currently not connected, the time at which the Session will end and the Session State will be discarded.<a class="pilcrow" href="#section-5-2.3">¶</a>
</li>
      </ul>
<p id="section-5-3">
 The token/introspection state is not part of the MQTT Session State, and PoP validation is required for each new connection, regardless of whether existing MQTT Sessions are continued.<a class="pilcrow" href="#section-5-3">¶</a></p>
<p id="section-5-4">
            The messages to be retained are indicated to the Broker by setting a RETAIN flag in a PUBLISH packet.
            This way, the publisher signals to the Broker to store the most
            recent message for the associated topic.  Hence, the new subscribers can receive
            the last sent message from the publisher for that particular topic without waiting
            for the next PUBLISH packet.
            The Broker <span class="bcp14">MUST</span> continue publishing
            the retained messages as long as the associated tokens are valid.
            In the MQTT standard, if QoS is 0 for the PUBLISH packet, the Broker may discard the
            retained message any time. For QoS &gt; 1, the message expiry interval dictates how long the retained message is kept. 
            However, it is important that the Broker avoids sending messages indefinitely for the Clients that never update their tokens (i.e.,
            the Client connects briefly with a valid token, sends a PUBLISH packet with the RETAIN flag set to 1
            and QoS &gt; 1, disconnects, and never connects again). 
            Therefore, the Broker <span class="bcp14">MUST</span> use the minimum of the token expiry and message expiry interval to discard
            a retained message.<a class="pilcrow" href="#section-5-4">¶</a></p>
<p id="section-5-5">
            In case of disconnections due to network errors or server disconnection due to a protocol error
            (which includes authorization errors), the Will Message is sent if the Client supplied
            a Will in the CONNECT packet.  The Client's token scope array <span class="bcp14">MUST</span> include the Will Topic.
            The Will Message <span class="bcp14">MUST</span> be published to the Will Topic, regardless of whether the corresponding
     token has expired (as it has been validated and accepted during CONNECT).<a class="pilcrow" href="#section-5-5">¶</a></p>
</section>
</div>
<div id="MQTTv311">
<section id="section-6">
      <h2 id="name-reduced-protocol-interactio">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-reduced-protocol-interactio">Reduced Protocol Interactions for MQTT v3.1.1</a>
      </h2>
<p id="section-6-1">
        This section describes a reduced set of protocol interactions for the MQTT v3.1.1 Clients.
        An MQTT v5.0 Broker <span class="bcp14">MAY</span> implement these interactions for the MQTT v3.1.1 Clients; 
        the flows described in this section are <span class="bcp14">NOT RECOMMENDED</span> for use by MQTT v5.0 Clients. 
        Brokers that do not support MQTT v3.1.1 Clients return a CONNACK packet
        with reason code 0x84 (Unsupported Protocol Version) in response to the connection requests.<a class="pilcrow" href="#section-6-1">¶</a></p>
<div id="token_311">
<section id="section-6.1">
        <h3 id="name-token-transport">
<a class="section-number selfRef" href="#section-6.1">6.1. </a><a class="section-name selfRef" href="#name-token-transport">Token Transport</a>
        </h3>
<p id="section-6.1-1"> As in MQTT v5.0, the token <span class="bcp14">MAY</span> either be transported before, by publishing
             to the "authz-info" topic, or inside the CONNECT packet. If the Client provided
             the token via the "authz-info" topic and will not update the token in the CONNECT packet, 
             it <span class="bcp14">MUST</span> authenticate over TLS. The Broker <span class="bcp14">SHOULD</span> still be prepared to store the Client access
             token for future use (regardless of the method of transport).<a class="pilcrow" href="#section-6.1-1">¶</a></p>
<p id="section-6.1-2">In MQTT v3.1.1, after the Client has published to the "authz-info" topic,
               the Broker cannot communicate
                the result of the token validation because PUBACK reason codes or server-side DISCONNECT
                packets are not supported.
                In any case, the subsequent TLS handshake would fail without a valid token,
                 which can prompt the Client to
                obtain a valid token.<a class="pilcrow" href="#section-6.1-2">¶</a></p>
<p id="section-6.1-3">
                To transport the token to the Broker inside the CONNECT packet,
                the Client uses the User Name and Password fields.
                <a class="auto internal xref" href="#mqtt_connect_message">Figure 10</a> shows the structure of the MQTT CONNECT packet.<a class="pilcrow" href="#section-6.1-3">¶</a></p>
<span id="name-mqtt-connect-variable-heade"></span><div id="mqtt_connect_message">
<figure id="figure-10">
          <div class="alignCenter art-text artwork" id="section-6.1-4.1">
<pre>0             8             16
+---------------------------+
|Protocol name length = 4   |
+---------------------------+
|     'M'            'Q'    |
+---------------------------+
|     'T'            'T'    |
+---------------------------+
|Proto.level=5|Connect flags|
+---------------------------+
|        Keep alive         |
+---------------------------+
|        Payload            |
|  Client Identifier        |
|  (UTF-8-encoded string)   |
| User Name as access token |
|   (UTF-8-encoded string)  |
| Password for signature/MAC|
|     (Binary Data)         |
+---------------------------+
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-10">Figure 10</a>:
<a class="selfRef" href="#name-mqtt-connect-variable-heade">MQTT CONNECT Variable Header Using a User Name and Password for ACE</a>
          </figcaption></figure>
</div>
<p id="section-6.1-5">
            <a class="auto internal xref" href="#mqtt_connect_flags">Table 2</a> shows how the MQTT connect flags <span class="bcp14">MUST</span> be set to initiate
             a connection with the Broker.<a class="pilcrow" href="#section-6.1-5">¶</a></p>
<span id="name-mqtt-connect-flags-rsvd-res"></span><div id="mqtt_connect_flags">
<table class="center" id="table-2">
          <caption>
<a class="selfRef" href="#table-2">Table 2</a>:
<a class="selfRef" href="#name-mqtt-connect-flags-rsvd-res">MQTT CONNECT Flags (Rsvd. = Reserved)</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" colspan="1" rowspan="1">User Name Flag</th>
              <th class="text-left" colspan="1" rowspan="1">Password Flag</th>
              <th class="text-left" colspan="1" rowspan="1">Will Retain</th>
              <th class="text-left" colspan="1" rowspan="1">Will QoS</th>
              <th class="text-left" colspan="1" rowspan="1">Will Flag</th>
              <th class="text-left" colspan="1" rowspan="1">Clean</th>
              <th class="text-left" colspan="1" rowspan="1">Rsvd.</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" colspan="1" rowspan="1">1</td>
              <td class="text-center" colspan="1" rowspan="1">1</td>
              <td class="text-center" colspan="1" rowspan="1">X</td>
              <td class="text-center" colspan="1" rowspan="1">X X</td>
              <td class="text-center" colspan="1" rowspan="1">X</td>
              <td class="text-center" colspan="1" rowspan="1">X</td>
              <td class="text-center" colspan="1" rowspan="1">0</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-6.1-7">
   The Client <span class="bcp14">SHOULD</span> set the Clean flag to 1 to always start a new Session. If the Clean flag is set to 0, the Broker <span class="bcp14">MUST</span> resume communications with the Client based on the state from the current Session (as identified by the Client Identifier). If there is no Session associated with the Client Identifier, the Broker <span class="bcp14">MUST</span> create a new Session. The Broker <span class="bcp14">MUST</span> set the Session Present flag in the CONNACK packet accordingly, i.e., 0 to indicate a new Session to the Client and 1 to indicate that the existing Session is continued. The Broker <span class="bcp14">MUST</span> still perform PoP validation on the provided Client token. MQTT v3.1.1 does not use a Session Expiry Interval, and the Client expects that the Broker maintains the Session State after it disconnects. However, the stored Session State can be discarded as a result of administrator action or policies (e.g., defining an automated response based on storage capabilities), and Brokers <span class="bcp14">SHOULD</span> implement administrative policies to limit misuse.<a class="pilcrow" href="#section-6.1-7">¶</a></p>
<p id="section-6.1-8">
                    The Client <span class="bcp14">MAY</span> set the Will Flag as desired (marked as "X" in
                     <a class="auto internal xref" href="#mqtt_connect_flags">Table 2</a>). User Name and Password flags <span class="bcp14">MUST</span> be
                      set to 1 to  ensure that the Payload of the CONNECT packet includes both the User Name 
                      and Password fields. The MQTT User Name is a UTF-8-encoded string, and the MQTT Password is Binary Data.<a class="pilcrow" href="#section-6.1-8">¶</a></p>
<p id="section-6.1-9">
                   The CONNECT in MQTT v3.1.1 does not have a field to indicate the Authentication
                    Method. To signal that the User Name field contains an ACE token,
                    this field <span class="bcp14">MUST</span> be prefixed with the keyword "ace", 
                    i.e., the User Name field is a concatenation of 'a', 'c', 'e', and the access token
                    represented as:<a class="pilcrow" href="#section-6.1-9">¶</a></p>
<span id="name-user-name-in-connect"></span><div id="v31username">
<figure id="figure-11">
          <div class="alignCenter art-text artwork" id="section-6.1-10.1">
<pre>'U+0061'||'U+0063'||'U+0065'||UTF-8(access token)
</pre>
</div>
<figcaption><a class="selfRef" href="#figure-11">Figure 11</a>:
<a class="selfRef" href="#name-user-name-in-connect">User Name in CONNECT</a>
          </figcaption></figure>
</div>
<p id="section-6.1-11">
                    To this end, the access token <span class="bcp14">MUST</span> be encoded with base64url,
                    omitting the "=" padding characters <span>[<a class="cite xref" href="#RFC4648">RFC4648</a>]</span>.<a class="pilcrow" href="#section-6.1-11">¶</a></p>
<p id="section-6.1-12">
                    The Password field <span class="bcp14">MUST</span> be set to the keyed message digest (MAC)
                    or signature associated with the access token for PoP.
                    The Client <span class="bcp14">MUST</span> apply the PoP key on the challenge derived from the TLS
                    session, as described in <a class="auto internal xref" href="#pop_nonce">Section 2.2.4.2.1</a>.<a class="pilcrow" href="#section-6.1-12">¶</a></p>
</section>
</div>
<div id="errors_311">
<section id="section-6.2">
        <h3 id="name-handling-authorization-erro">
<a class="section-number selfRef" href="#section-6.2">6.2. </a><a class="section-name selfRef" href="#name-handling-authorization-erro">Handling Authorization Errors</a>
        </h3>
<p id="section-6.2-1">
                Error handling is more primitive in MQTT v3.1.1 due to not having appropriate error fields,
                error codes, and server-side DISCONNECTs.
 Therefore, the Broker will disconnect on almost any error and may not keep the Session State, necessitating that clients make a greater effort to ensure that tokens remain valid and do not attempt to publish to topics that they do not have permissions for.
                The following lists how the Broker responds to specific errors.<a class="pilcrow" href="#section-6.2-1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.2-2">
          <dt id="section-6.2-2.1">
                CONNECT without a token:</dt>
          <dd id="section-6.2-2.2" style="margin-left: 4.0em">The tokenless CONNECT attempt <span class="bcp14">MUST</span> fail. This is
                because the challenge-response-based PoP is not possible for MQTT v3.1.1. 
                It is also not possible to support AS discovery since a CONNACK packet in MQTT v3.1.1
                  does not include a means to provide additional information to the Client.
     Therefore, AS discovery needs to take place out of band.<a class="pilcrow" href="#section-6.2-2.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.2-2.3">
                Client-Broker PUBLISH authorization failure:</dt>
          <dd id="section-6.2-2.4" style="margin-left: 4.0em">In the case of a failure,
                  it is not possible to return an error in MQTT v3.1.1.
        Acknowledgment messages only indicate success. In the case of an authorization error,
                the Broker <span class="bcp14">MUST</span> ignore the PUBLISH packet and disconnect the Client.
          Also, as DISCONNECT packets are only sent
                from a Client to the Broker, the server disconnection needs to take place below the application layer.<a class="pilcrow" href="#section-6.2-2.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.2-2.5"> SUBSCRIBE authorization failure:</dt>
          <dd id="section-6.2-2.6" style="margin-left: 4.0em">In the  SUBACK packet, the return code is 0x80, indicating
                failure for the unauthorized topic(s). Note that, in both MQTT versions, a reason code is
                returned for each Topic Filter.<a class="pilcrow" href="#section-6.2-2.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.2-2.7">Broker-Client PUBLISH authorization failure:</dt>
          <dd id="section-6.2-2.8" style="margin-left: 4.0em">When the Broker is forwarding PUBLISH packets to the subscribed Clients,
       it may discover that some of the subscribers are no longer authorized due to expired tokens.
               These token expirations <span class="bcp14">MUST</span> lead to disconnecting the Client rather than silently dropping messages.<a class="pilcrow" href="#section-6.2-2.8">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-tls-exporter-labels-registr">
<a class="section-number selfRef" href="#section-7.1">7.1. </a><a class="section-name selfRef" href="#name-tls-exporter-labels-registr">TLS Exporter Labels Registration</a>
        </h3>
<p id="section-7.1-1">
            This document registers "EXPORTER-ACE-MQTT-Sign-Challenge" (introduced in <a class="auto internal xref" href="#pop_nonce">Section 2.2.4.2.1</a>
           in this document) in the "TLS Exporter Labels" registry <span>[<a class="cite xref" href="#RFC8447">RFC8447</a>]</span>.<a class="pilcrow" href="#section-7.1-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.1-2">
          <dt id="section-7.1-2.1">Recommended:</dt>
          <dd id="section-7.1-2.2" style="margin-left: 1.5em">N<a class="pilcrow" href="#section-7.1-2.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.1-2.3">DTLS-OK:</dt>
          <dd id="section-7.1-2.4" style="margin-left: 1.5em">N<a class="pilcrow" href="#section-7.1-2.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.1-2.5">Reference:</dt>
          <dd id="section-7.1-2.6" style="margin-left: 1.5em">RFC 9431<a class="pilcrow" href="#section-7.1-2.6">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-media-type-registration">
<a class="section-number selfRef" href="#section-7.2">7.2. </a><a class="section-name selfRef" href="#name-media-type-registration">Media Type Registration</a>
        </h3>
<p id="section-7.2-1">This document registers the "application/ace+json" media type
            for messages of the protocols defined in this document carrying
            parameters encoded in JSON.<a class="pilcrow" href="#section-7.2-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.2-2">
          <dt id="section-7.2-2.1">Type name:</dt>
          <dd id="section-7.2-2.2" style="margin-left: 1.5em">application<a class="pilcrow" href="#section-7.2-2.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.3">Subtype name:</dt>
          <dd id="section-7.2-2.4" style="margin-left: 1.5em">ace+json<a class="pilcrow" href="#section-7.2-2.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.5">Required parameters:</dt>
          <dd id="section-7.2-2.6" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-7.2-2.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.7">Optional parameters:</dt>
          <dd id="section-7.2-2.8" style="margin-left: 1.5em">N/A<a class="pilcrow" href="#section-7.2-2.8">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.9">Encoding considerations:</dt>
          <dd id="section-7.2-2.10" style="margin-left: 1.5em">Encoding considerations are identical to
those specified for the "application/json" media type.<a class="pilcrow" href="#section-7.2-2.10">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.11">Security considerations:</dt>
          <dd id="section-7.2-2.12" style="margin-left: 1.5em">
            <a class="auto internal xref" href="#Security">Section 8</a> of RFC 9431<a class="pilcrow" href="#section-7.2-2.12">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.13">Interoperability considerations:</dt>
          <dd id="section-7.2-2.14" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.14">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.15">Published specification:</dt>
          <dd id="section-7.2-2.16" style="margin-left: 1.5em">RFC 9431<a class="pilcrow" href="#section-7.2-2.16">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.17">Applications that use this media type:</dt>
          <dd id="section-7.2-2.18" style="margin-left: 1.5em">This media type is intended for
            Authorization-Server-Client and Authorization-Server-Resource-Server 
            communication as part of the ACE framework using JSON encoding, as specified in RFC 9431.<a class="pilcrow" href="#section-7.2-2.18">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.19">Fragment identifier considerations:</dt>
          <dd id="section-7.2-2.20" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.20">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.21">Additional information:</dt>
          <dd id="section-7.2-2.22" style="margin-left: 1.5em">
            <p id="section-7.2-2.22.1"><br/></p>
<span class="break"></span><dl class="dlParallel" id="section-7.2-2.22.2">
              <dt id="section-7.2-2.22.2.1">Deprecated alias names for this type:</dt>
              <dd id="section-7.2-2.22.2.2" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.22.2.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.2-2.22.2.3">Magic number(s):</dt>
              <dd id="section-7.2-2.22.2.4" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.22.2.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.2-2.22.2.5">File extension(s):</dt>
              <dd id="section-7.2-2.22.2.6" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.22.2.6">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.2-2.22.2.7">Macintosh file type code(s):</dt>
              <dd id="section-7.2-2.22.2.8" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.22.2.8">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.23">Person &amp; email address to contact for further information:</dt>
          <dd id="section-7.2-2.24" style="margin-left: 1.5em">
            <p id="section-7.2-2.24.1"><br/>Cigdem Sengul &lt;csengul@acm.org&gt;<a class="pilcrow" href="#section-7.2-2.24.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.25">Intended usage:</dt>
          <dd id="section-7.2-2.26" style="margin-left: 1.5em">COMMON<a class="pilcrow" href="#section-7.2-2.26">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.27">Restrictions on usage:</dt>
          <dd id="section-7.2-2.28" style="margin-left: 1.5em">none<a class="pilcrow" href="#section-7.2-2.28">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.29">Author:</dt>
          <dd id="section-7.2-2.30" style="margin-left: 1.5em">Cigdem Sengul &lt;csengul@acm.org&gt;<a class="pilcrow" href="#section-7.2-2.30">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.2-2.31">Change controller:</dt>
          <dd id="section-7.2-2.32" style="margin-left: 1.5em">IETF<a class="pilcrow" href="#section-7.2-2.32">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-7.3">
        <h3 id="name-ace-oauth-profile-registrat">
<a class="section-number selfRef" href="#section-7.3">7.3. </a><a class="section-name selfRef" href="#name-ace-oauth-profile-registrat">ACE OAuth Profile Registration</a>
        </h3>
<p id="section-7.3-1">The following registrations have been made in the "ACE Profiles" registry, following the procedure specified in
         <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>.<a class="pilcrow" href="#section-7.3-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7.3-2">
          <dt id="section-7.3-2.1">Name:</dt>
          <dd id="section-7.3-2.2" style="margin-left: 1.5em">mqtt_tls<a class="pilcrow" href="#section-7.3-2.2">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.3-2.3">Description:</dt>
          <dd id="section-7.3-2.4" style="margin-left: 1.5em">Profile for delegating Client authentication and authorization using MQTT for the 
            Client and Broker (RS) interactions and HTTP for the AS interactions. 
         TLS is used for confidentiality and integrity protection and server authentication. 
            Client authentication can be provided either via TLS or using in-band PoP validation at the MQTT
            application layer.<a class="pilcrow" href="#section-7.3-2.4">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.3-2.5">CBOR Value:</dt>
          <dd id="section-7.3-2.6" style="margin-left: 1.5em">3<a class="pilcrow" href="#section-7.3-2.6">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-7.3-2.7">Reference:</dt>
          <dd id="section-7.3-2.8" style="margin-left: 1.5em">RFC 9431<a class="pilcrow" href="#section-7.3-2.8">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<section id="section-7.4">
        <h3 id="name-aif">
<a class="section-number selfRef" href="#section-7.4">7.4. </a><a class="section-name selfRef" href="#name-aif">AIF</a>
        </h3>
<p id="section-7.4-1">For the media types "application/aif+cbor" and "application/aif+json",
        defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9237#section-5.1">Section 5.1</a> of [<a class="cite xref" href="#RFC9237">RFC9237</a>]</span>, IANA has
        registered the following entries for the two media type parameters Toid
        and Tperm in the respective subregistry defined in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc9237#section-5.2">Section 5.2</a> of [<a class="cite xref" href="#RFC9237">RFC9237</a>]</span> within the "Media Type Sub-Parameter Registries".<a class="pilcrow" href="#section-7.4-1">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-7.4-2">
          <dt id="section-7.4-2.1">For Toid:</dt>
          <dd id="section-7.4-2.2" style="margin-left: 1.5em">
            <span class="break"></span><dl class="dlParallel" id="section-7.4-2.2.1">
              <dt id="section-7.4-2.2.1.1">Name:</dt>
              <dd id="section-7.4-2.2.1.2" style="margin-left: 1.5em">mqtt-topic-filter<a class="pilcrow" href="#section-7.4-2.2.1.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.4-2.2.1.3">Description/Specification:</dt>
              <dd id="section-7.4-2.2.1.4" style="margin-left: 1.5em">Topic Filter, as defined in <a class="auto internal xref" href="#scope">Section 2.3</a> of RFC 9431.<a class="pilcrow" href="#section-7.4-2.2.1.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.4-2.2.1.5">Reference:</dt>
              <dd id="section-7.4-2.2.1.6" style="margin-left: 1.5em">RFC 9431, <a class="auto internal xref" href="#scope">Section 2.3</a><a class="pilcrow" href="#section-7.4-2.2.1.6">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-7.4-2.3"> For Tperm:</dt>
          <dd id="section-7.4-2.4" style="margin-left: 1.5em">
            <span class="break"></span><dl class="dlParallel" id="section-7.4-2.4.1">
              <dt id="section-7.4-2.4.1.1">Name:</dt>
              <dd id="section-7.4-2.4.1.2" style="margin-left: 1.5em">mqtt-permissions<a class="pilcrow" href="#section-7.4-2.4.1.2">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.4-2.4.1.3">Description/Specification:</dt>
              <dd id="section-7.4-2.4.1.4" style="margin-left: 1.5em">Permissions for the MQTT
                Client, as defined in <a class="auto internal xref" href="#scope">Section 2.3</a> of RFC 9431.
                Tperm is an array of one or more text strings that each have
                a value of either "pub" or "sub".<a class="pilcrow" href="#section-7.4-2.4.1.4">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-7.4-2.4.1.5">Reference:</dt>
              <dd id="section-7.4-2.4.1.6" style="margin-left: 1.5em">RFC 9431, <a class="auto internal xref" href="#scope">Section 2.3</a><a class="pilcrow" href="#section-7.4-2.4.1.6">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-8-1"> This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework
   <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>. Therefore, the security considerations outlined
   in <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span> apply to this work.<a class="pilcrow" href="#section-8-1">¶</a></p>
<p id="section-8-2"> In addition, the security considerations outlined in the <span><a class="internal xref" href="#MQTT-OASIS-Standard-v5">MQTT v5.0 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v5">MQTT-OASIS-Standard-v5</a>]</span>
   and <span><a class="internal xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT v3.1.1 OASIS Standard</a> [<a class="cite xref" href="#MQTT-OASIS-Standard-v3.1.1">MQTT-OASIS-Standard-v3.1.1</a>]</span>
    apply.  Mainly, this document provides an authorization solution for MQTT,
    the responsibility of which is left to the specific implementation in the MQTT standards.
  In the following, we comment on a few relevant issues based on the current MQTT specifications.<a class="pilcrow" href="#section-8-2">¶</a></p>
<p id="section-8-3">After the Broker validates an access token and accepts a connection from a client, it caches the token to authorize a Client's publish and subscribe requests in an ongoing Session.
      The Broker does not cache any tokens that cannot be validated.
      If a Client's permissions get revoked, but the access token has not expired,
   the Broker may still grant publish/subscribe to revoked topics.
      If the Broker caches the token introspection responses, then the Broker <span class="bcp14">SHOULD</span> use a reasonable cache timeout
       to introspect tokens regularly. The timeout value is application specific and should be chosen 
       to reduce the risk of using stale introspection responses.
   When permissions change dynamically, it is expected that the AS also
       follows a reasonable expiration strategy for the access tokens.<a class="pilcrow" href="#section-8-3">¶</a></p>
<p id="section-8-4"> The Broker may monitor Client behavior to detect potential security problems, especially those affecting availability.
   These include repeated token transfer attempts to the public "authz-info" topic, repeated connection attempts,
   abnormal terminations, and Clients that connect but do not send any data.
   If the Broker supports the public
   "authz-info" topic, described in <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a>, then this may be
   vulnerable to a DDoS attack, where many Clients use the "authz-info" 
   public topic to transport tokens that are not meant to be used 
   and that the Broker may need to store until they expire.<a class="pilcrow" href="#section-8-4">¶</a></p>
<p id="section-8-5">For MQTT v5.0, when a Client connects with a long Session Expiry Interval, the Broker may need to maintain the Client's MQTT Session State after it disconnects for an extended period. For MQTT v3.1.1, the Session State may need to be stored indefinitely, as it does not have a Session Expiry Interval feature. The Broker <span class="bcp14">SHOULD</span> implement administrative policies to limit misuse by the Client resulting from continuing existing Sessions.<a class="pilcrow" href="#section-8-5">¶</a></p>
</section>
</div>
<div id="Privacy">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-privacy-considerations">Privacy Considerations</a>
      </h2>
<p id="section-9-1">The privacy considerations outlined in <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span> apply to this work.<a class="pilcrow" href="#section-9-1">¶</a></p>
<p id="section-9-2">In MQTT, the Broker is a central trusted party and may forward potentially sensitive information
         between Clients. The mechanisms defined in this document do not protect the contents of the PUBLISH packet from the Broker, and hence,
                the content of the PUBLISH packet is not signed or encrypted separately for the subscribers.
                This functionality may be implemented using the proposal outlined in <span><a class="internal xref" href="#I-D.ietf-ace-pubsub-profile">the ACE Pub-Sub Profile</a> [<a class="cite xref" href="#I-D.ietf-ace-pubsub-profile">ACE-PUBSUB-PROFILE</a>]</span>.
         However, this solution would still not provide privacy for other fields of the packet, such as Topic Name.<a class="pilcrow" href="#section-9-2">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-10">10. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-10.1">10.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="MQTT-OASIS-Standard-v3.1.1">[MQTT-OASIS-Standard-v3.1.1]</dt>
        <dd>
<span class="refAuthor">Banks, A., Ed.</span> and <span class="refAuthor">R. Gupta, Ed.</span>, <span class="refTitle">"MQTT Version 3.1.1 Plus Errata 01"</span>, <span class="refContent">OASIS Standard</span>, <time class="refDate" datetime="2015-12">December 2015</time>, <span>&lt;<a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MQTT-OASIS-Standard-v5">[MQTT-OASIS-Standard-v5]</dt>
        <dd>
<span class="refAuthor">Banks, A., Ed.</span>, <span class="refAuthor">Briggs, E., Ed.</span>, <span class="refAuthor">Borgendale, K., Ed.</span>, and <span class="refAuthor">R. Gupta, Ed.</span>, <span class="refTitle">"MQTT Version 5.0"</span>, <span class="refContent">OASIS Standard</span>, <time class="refDate" datetime="2019-03">March 2019</time>, <span>&lt;<a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html">https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time class="refDate" datetime="2006-10">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5705">[RFC5705]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"Keying Material Exporters for Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 5705</span>, <span class="seriesInfo">DOI 10.17487/RFC5705</span>, <time class="refDate" datetime="2010-03">March 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5705">https://www.rfc-editor.org/info/rfc5705</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6066">[RFC6066]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refTitle">"Transport Layer Security (TLS) Extensions: Extension Definitions"</span>, <span class="seriesInfo">RFC 6066</span>, <span class="seriesInfo">DOI 10.17487/RFC6066</span>, <time class="refDate" datetime="2011-01">January 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6066">https://www.rfc-editor.org/info/rfc6066</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time class="refDate" datetime="2011-05">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time class="refDate" datetime="2012-10">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7250">[RFC7250]</dt>
        <dd>
<span class="refAuthor">Wouters, P., Ed.</span>, <span class="refAuthor">Tschofenig, H., Ed.</span>, <span class="refAuthor">Gilmore, J.</span>, <span class="refAuthor">Weiler, S.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7250</span>, <span class="seriesInfo">DOI 10.17487/RFC7250</span>, <time class="refDate" datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7250">https://www.rfc-editor.org/info/rfc7250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7301">[RFC7301]</dt>
        <dd>
<span class="refAuthor">Friedl, S.</span>, <span class="refAuthor">Popov, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time class="refDate" datetime="2014-07">July 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7301">https://www.rfc-editor.org/info/rfc7301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7516">[RFC7516]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">J. Hildebrand</span>, <span class="refTitle">"JSON Web Encryption (JWE)"</span>, <span class="seriesInfo">RFC 7516</span>, <span class="seriesInfo">DOI 10.17487/RFC7516</span>, <time class="refDate" datetime="2015-05">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7517">[RFC7517]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time class="refDate" datetime="2015-05">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time class="refDate" datetime="2015-05">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7627">[RFC7627]</dt>
        <dd>
<span class="refAuthor">Bhargavan, K., Ed.</span>, <span class="refAuthor">Delignat-Lavaud, A.</span>, <span class="refAuthor">Pironti, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">M. Ray</span>, <span class="refTitle">"Transport Layer Security (TLS) Session Hash and Extended Master Secret Extension"</span>, <span class="seriesInfo">RFC 7627</span>, <span class="seriesInfo">DOI 10.17487/RFC7627</span>, <time class="refDate" datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7627">https://www.rfc-editor.org/info/rfc7627</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7800">[RFC7800]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)"</span>, <span class="seriesInfo">RFC 7800</span>, <span class="seriesInfo">DOI 10.17487/RFC7800</span>, <time class="refDate" datetime="2016-04">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7800">https://www.rfc-editor.org/info/rfc7800</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time class="refDate" datetime="2017-01">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8422">[RFC8422]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Josefsson, S.</span>, and <span class="refAuthor">M. Pegourie-Gonnard</span>, <span class="refTitle">"Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier"</span>, <span class="seriesInfo">RFC 8422</span>, <span class="seriesInfo">DOI 10.17487/RFC8422</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8422">https://www.rfc-editor.org/info/rfc8422</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8442">[RFC8442]</dt>
        <dd>
<span class="refAuthor">Mattsson, J.</span> and <span class="refAuthor">D. Migault</span>, <span class="refTitle">"ECDHE_PSK with AES-GCM and AES-CCM Cipher Suites for TLS 1.2 and DTLS 1.2"</span>, <span class="seriesInfo">RFC 8442</span>, <span class="seriesInfo">DOI 10.17487/RFC8442</span>, <time class="refDate" datetime="2018-09">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8442">https://www.rfc-editor.org/info/rfc8442</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time class="refDate" datetime="2019-06">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8747">[RFC8747]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for CBOR Web Tokens (CWTs)"</span>, <span class="seriesInfo">RFC 8747</span>, <span class="seriesInfo">DOI 10.17487/RFC8747</span>, <time class="refDate" datetime="2020-03">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8747">https://www.rfc-editor.org/info/rfc8747</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9052">[RFC9052]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9052</span>, <span class="seriesInfo">DOI 10.17487/RFC9052</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9052">https://www.rfc-editor.org/info/rfc9052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time class="refDate" datetime="2022-06">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9110">https://www.rfc-editor.org/info/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9200">[RFC9200]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments Using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="seriesInfo">RFC 9200</span>, <span class="seriesInfo">DOI 10.17487/RFC9200</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9200">https://www.rfc-editor.org/info/rfc9200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9201">[RFC9201]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refTitle">"Additional OAuth Parameters for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="seriesInfo">RFC 9201</span>, <span class="seriesInfo">DOI 10.17487/RFC9201</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9201">https://www.rfc-editor.org/info/rfc9201</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9202">[RFC9202]</dt>
        <dd>
<span class="refAuthor">Gerdes, S.</span>, <span class="refAuthor">Bergmann, O.</span>, <span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Datagram Transport Layer Security (DTLS) Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="seriesInfo">RFC 9202</span>, <span class="seriesInfo">DOI 10.17487/RFC9202</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9202">https://www.rfc-editor.org/info/rfc9202</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9237">[RFC9237]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"An Authorization Information Format (AIF) for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="seriesInfo">RFC 9237</span>, <span class="seriesInfo">DOI 10.17487/RFC9237</span>, <time class="refDate" datetime="2022-08">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9237">https://www.rfc-editor.org/info/rfc9237</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9360">[RFC9360]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header Parameters for Carrying and Referencing X.509 Certificates"</span>, <span class="seriesInfo">RFC 9360</span>, <span class="seriesInfo">DOI 10.17487/RFC9360</span>, <time class="refDate" datetime="2023-02">February 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9360">https://www.rfc-editor.org/info/rfc9360</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9430">[RFC9430]</dt>
      <dd>
<span class="refAuthor">Bergmann, O.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Extension of the Datagram Transport Layer Security (DTLS) Profile for Authentication and Authorization for Constrained Environments (ACE) to Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 9430</span>, <span class="seriesInfo">DOI 10.17487/RFC9430</span>, <time class="refDate" datetime="2023-07">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9430">https://www.rfc-editor.org/info/rfc9430</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-10.2">10.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-pubsub-profile">[ACE-PUBSUB-PROFILE]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Sengul, C.</span>, and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Publish-Subscribe Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-pubsub-profile-06</span>, <time class="refDate" datetime="2023-03-13">13 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-pubsub-profile-06">https://datatracker.ietf.org/doc/html/draft-ietf-ace-pubsub-profile-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Fremantle14">[Fremantle14]</dt>
        <dd>
<span class="refAuthor">Fremantle, P.</span>, <span class="refAuthor">Aziz, B.</span>, <span class="refAuthor">Kopecky, J.</span>, and <span class="refAuthor">P. Scott</span>, <span class="refTitle">"Federated Identity and Access Management for the Internet of Things"</span>, <span class="refContent">International Workshop on Secure Internet of Things</span>, <span class="seriesInfo">DOI 10.1109/SIoT.2014.8</span>, <time class="refDate" datetime="2014-09">September 2014</time>, <span>&lt;<a href="https://dx.doi.org/10.1109/SIoT.2014.8">https://dx.doi.org/10.1109/SIoT.2014.8</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4949">[RFC4949]</dt>
        <dd>
<span class="refAuthor">Shirey, R.</span>, <span class="refTitle">"Internet Security Glossary, Version 2"</span>, <span class="seriesInfo">FYI 36</span>, <span class="seriesInfo">RFC 4949</span>, <span class="seriesInfo">DOI 10.17487/RFC4949</span>, <time class="refDate" datetime="2007-08">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4949">https://www.rfc-editor.org/info/rfc4949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time class="refDate" datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7925">[RFC7925]</dt>
        <dd>
<span class="refAuthor">Tschofenig, H., Ed.</span> and <span class="refAuthor">T. Fossati</span>, <span class="refTitle">"Transport Layer Security (TLS) / Datagram Transport Layer Security (DTLS) Profiles for the Internet of Things"</span>, <span class="seriesInfo">RFC 7925</span>, <span class="seriesInfo">DOI 10.17487/RFC7925</span>, <time class="refDate" datetime="2016-07">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7925">https://www.rfc-editor.org/info/rfc7925</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time class="refDate" datetime="2018-05">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8447">[RFC8447]</dt>
        <dd>
<span class="refAuthor">Salowey, J.</span> and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"IANA Registry Updates for TLS and DTLS"</span>, <span class="seriesInfo">RFC 8447</span>, <span class="seriesInfo">DOI 10.17487/RFC8447</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8447">https://www.rfc-editor.org/info/rfc8447</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time class="refDate" datetime="2020-12">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9325">[RFC9325]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span>, <span class="refAuthor">Saint-Andre, P.</span>, and <span class="refAuthor">T. Fossati</span>, <span class="refTitle">"Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">BCP 195</span>, <span class="seriesInfo">RFC 9325</span>, <span class="seriesInfo">DOI 10.17487/RFC9325</span>, <time class="refDate" datetime="2022-11">November 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9325">https://www.rfc-editor.org/info/rfc9325</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-rfc8446bis">[TLS-bis]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-rfc8446bis-09</span>, <time class="refDate" datetime="2023-07-07">7 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-09">https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="app-profile-requirements">
<section id="appendix-A">
      <h2 id="name-checklist-for-profile-requi">
<a class="section-number selfRef" href="#appendix-A">Appendix A. </a><a class="section-name selfRef" href="#name-checklist-for-profile-requi">Checklist for Profile Requirements</a>
      </h2>
<p id="appendix-A-1">
             Based on the requirements on profiles for the ACE framework <span>[<a class="cite xref" href="#RFC9200">RFC9200</a>]</span>, 
         this document fulfills the following:<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-2.1">Optional AS discovery: AS discovery is supported with the MQTT v5.0 described in <a class="auto internal xref" href="#connect_v5">Section 2.2</a>.<a class="pilcrow" href="#appendix-A-2.1">¶</a>
</li>
        <li class="normal" id="appendix-A-2.2">The communication protocol between the Client and Broker (RS): MQTT<a class="pilcrow" href="#appendix-A-2.2">¶</a>
</li>
        <li class="normal" id="appendix-A-2.3">The security protocol between the Client and RS: TLS<a class="pilcrow" href="#appendix-A-2.3">¶</a>
</li>
        <li class="normal" id="appendix-A-2.4">Client and RS mutual authentication: Several options are possible and described in <a class="auto internal xref" href="#auth_options">Section 2.2.1</a>.<a class="pilcrow" href="#appendix-A-2.4">¶</a>
</li>
        <li class="normal" id="appendix-A-2.5"> Proof-of-possession protocols: Both symmetric and asymmetric keys are supported, as specified in <a class="auto internal xref" href="#AUTH-method">Section 2.2.4.2</a>.<a class="pilcrow" href="#appendix-A-2.5">¶</a>
</li>
        <li class="normal" id="appendix-A-2.6">Content-Format: For the HTTPS interactions with AS, "application/ace+json".<a class="pilcrow" href="#appendix-A-2.6">¶</a>
</li>
        <li class="normal" id="appendix-A-2.7">Unique profile identifier: mqtt_tls<a class="pilcrow" href="#appendix-A-2.7">¶</a>
</li>
        <li class="normal" id="appendix-A-2.8">Token introspection: The RS uses the HTTPS introspection interface of the AS.<a class="pilcrow" href="#appendix-A-2.8">¶</a>
</li>
        <li class="normal" id="appendix-A-2.9">Token request: The Client or its Client AS uses the HTTPS token endpoint of the AS.<a class="pilcrow" href="#appendix-A-2.9">¶</a>
</li>
        <li class="normal" id="appendix-A-2.10">authz-info endpoint: It <span class="bcp14">MAY</span> be supported using the method described in <a class="auto internal xref" href="#app-authzinfo">Section 2.2.2</a> but is
                        not protected other than by the TLS channel between the Client and RS.<a class="pilcrow" href="#appendix-A-2.10">¶</a>
</li>
        <li class="normal" id="appendix-A-2.11">Token transport: Via the "authz-info" topic, TLS with PSKs (provided as a PSK identity), or in the
                      MQTT CONNECT packet for both versions of MQTT.
                      The AUTH extensions can also be used for authentication and reauthentication for
             MQTT v5.0, as described in Sections <a class="auto internal xref" href="#connect_v5">2.2</a> and <a class="auto internal xref" href="#reauthentication">4</a>.<a class="pilcrow" href="#appendix-A-2.11">¶</a>
</li>
      </ul>
</section>
</div>
<div id="Acknowledgments">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a class="section-name selfRef" href="#name-acknowledgments">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">
                The authors would like to thank <span class="contact-name">Ludwig Seitz</span> for his review and his input on the authorization information endpoint; 
                <span class="contact-name">Benjamin Kaduk</span> for his review, insightful comments, and contributions to resolving issues; and <span class="contact-name">Carsten Bormann</span> for his review and 
                revisions to the AIF-MQTT data model.
                The authors would like to thank <span class="contact-name">Paul Fremantle</span> for the initial discussions on MQTT v5.0 support.<a class="pilcrow" href="#appendix-B-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Cigdem Sengul</span></div>
<div class="left" dir="auto"><span class="org">Brunel University</span></div>
<div class="left" dir="auto"><span class="street-address">Dept. of Computer Science</span></div>
<div class="left" dir="auto"><span class="locality">Uxbridge</span></div>
<div class="left" dir="auto"><span class="postal-code">UB8 3PH</span></div>
<div class="left" dir="auto"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:csengul@acm.org">csengul@acm.org</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Anthony Kirby</span></div>
<div class="left" dir="auto"><span class="org">Oxbotica</span></div>
<div class="left" dir="auto"><span class="extended-address">1a Milford House</span></div>
<div class="left" dir="auto"><span class="street-address">Mayfield Road, Summertown</span></div>
<div class="left" dir="auto"><span class="locality">Oxford</span></div>
<div class="left" dir="auto"><span class="postal-code">OX2 7EL</span></div>
<div class="left" dir="auto"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:anthony@anthony.org">anthony@anthony.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>