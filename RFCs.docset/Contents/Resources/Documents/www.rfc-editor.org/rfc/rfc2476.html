<html><head></head><body><pre>Network Working Group                                        R. Gellens
Request for Comments: 2476                                     QUALCOMM
Category: Standards Track                                    J. Klensin
                                                                    MCI
                                                          December 1998


                           <span class="h1">Message Submission</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (1998).  All Rights Reserved.

Table of Contents

    <a href="#section-1">1</a>.  Abstract . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
    <a href="#section-2">2</a>.  Document Information  . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>.  Definitions of Terms Used in this Memo . . . . . . . . .  <a href="#page-3">3</a>
      <a href="#section-2.2">2.2</a>.  Conventions Used in this Document . . . . . . . . . . .   <a href="#page-4">4</a>
    <a href="#section-3">3</a>.  Message Submission . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
      <a href="#section-3.1">3.1</a>.  Submission Identification . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
      <a href="#section-3.2">3.2</a>.  Message Rejection and Bouncing . . . . . . . . . . . . .  <a href="#page-4">4</a>
      <a href="#section-3.3">3.3</a>.  Authorized Submission . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
      <a href="#section-3.4">3.4</a>.  Enhanced Status Codes  . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
    <a href="#section-4">4</a>.  Mandatory Actions . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
      <a href="#section-4.1">4.1</a>.  General Submission Rejection Code  . . . . . . . . . . .  <a href="#page-6">6</a>
      <a href="#section-4.2">4.2</a>.  Ensure All Domains are Fully-Qualified  . . . . . . . .   <a href="#page-6">6</a>
    <a href="#section-5">5</a>.  Recommended Actions  . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
      <a href="#section-5.1">5.1</a>.  Enforce Address Syntax  . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
      <a href="#section-5.2">5.2</a>.  Log Errors . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
    <a href="#section-6">6</a>.  Optional Actions  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
      <a href="#section-6.1">6.1</a>.  Enforce Submission Rights  . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
      <a href="#section-6.2">6.2</a>.  Require Authentication  . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
      <a href="#section-6.3">6.3</a>.  Enforce Permissions  . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
      <a href="#section-6.4">6.4</a>.  Check Message Data  . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
    <a href="#section-7">7</a>.  Interaction with SMTP Extensions . . . . . . . . . . . . . .  <a href="#page-8">8</a>
    <a href="#section-8">8</a>.  Message Modifications . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
      <a href="#section-8.1">8.1</a>.  Add 'Sender' . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
      <a href="#section-8.2">8.2</a>.  Add 'Date'  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
      <a href="#section-8.3">8.3</a>.  Add 'Message-ID' . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>



<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


      <a href="#section-8.4">8.4</a>.  Transfer Encode . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
      <a href="#section-8.5">8.5</a>.  Sign the Message . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
      <a href="#section-8.6">8.6</a>.  Encrypt the Message . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
      <a href="#section-8.7">8.7</a>.  Resolve Aliases  . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
      <a href="#section-8.8">8.8</a>.  Header Rewriting  . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
    <a href="#section-9">9</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-10">10</a>.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-11">11</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-12">12</a>.  Authors' Addresses . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
   <a href="#section-13">13</a>.  Full Copyright Statement  . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Abstract"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Abstract</span>

   SMTP was defined as a message *transfer* protocol, that is, a means
   to route (if needed) and deliver finished (complete) messages.
   Message Transfer Agents (MTAs) are not supposed to alter the message
   text, except to add 'Received', 'Return-Path', and other header
   fields as required by [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>].

   However, SMTP is now also widely used as a message *submission*
   protocol, that is, a means for message user agents (MUAs) to
   introduce new messages into the MTA routing network.  The process
   which accepts message submissions from MUAs is termed a Message
   Submission Agent (MSA).

   Messages being submitted are in some cases finished (complete)
   messages, and in other cases are unfinished (incomplete) in some
   aspect or other.  Unfinished messages need to be completed to ensure
   they conform to [<a href="#ref-MESSAGE-FORMAT" title='"Standard for the format of ARPA Internet text messages"'>MESSAGE-FORMAT</a>], and later requirements.  For
   example, the message may lack a proper 'Date' header field, and
   domains might not be fully qualified.  In some cases, the MUA may be
   unable to generate finished messages (for example, it might not know
   its time zone).  Even when submitted messages are complete, local
   site policy may dictate that the message text be examined or modified
   in some way.  Such completions or modifications have been shown to
   cause harm when performed by downstream MTAs -- that is, MTAs after
   the first-hop submission MTA -- and are in general considered to be
   outside the province of standardized MTA functionality.

   Separating messages into submissions and transfers allows developers
   and network administrators to more easily:

   *   Implement security policies and guard against unauthorized mail
       relaying or injection of unsolicited bulk mail

   *   Implement authenticated submission, including off-site submission
       by authorized users such as travelers




<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   *   Separate the relevant software code differences, thereby making
       each code base more straightforward and allowing for different
       programs for relay and submission

   *   Detect configuration problems with a site's mail clients

   *   Provide a basis for adding enhanced submission services in the
       future

   This memo describes a low cost, deterministic means for messages to
   be identified as submissions, and specifies what actions are to be
   taken by a submission server.

   Public comments should be sent to the IETF Submit mailing list,
   &lt;ietf-submit@imc.org&gt;.  To subscribe, send a message containing
   SUBSCRIBE to &lt;ietf-submit-request@imc.org&gt;.  Private comments may be
   sent to the authors.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Document%20Information"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Document Information</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.1.%20%20Definitions%20of%20Terms%20Used%20in%20this%20Memo"></a><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Definitions of Terms Used in this Memo</span>

   Fully-Qualified

   Containing or consisting of a domain which can be globally resolved
   using the global Domain Name Service; that is, not a local alias or
   partial specification.

   Message Submission Agent (MSA)

   A process which conforms to this specification, which acts as a
   submission server to accept messages from MUAs, and either delivers
   them or acts as an SMTP client to relay them to an MTA.

   Message Transfer Agent (MTA)

   A process which conforms to [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>], which acts as an SMTP server
   to accept messages from an MSA or another MTA, and either delivers
   them or acts as an SMTP client to relay them to another MTA.

   Message User Agent (MUA)

   A process which acts (usually on behalf of a user) to compose and
   submit new messages, and process delivered messages.  In the split-
   MUA model, POP or IMAP is used to access delivered messages.






<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.2.%20%20Conventions%20Used%20in%20this%20Document"></a><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Conventions Used in this Document</span>

   In examples, "C:" is used to indicate lines sent by the client, and
   "S:" indicates those sent by the server.  Line breaks within a
   command example are for editorial purposes only.

   Examples use the 'example.net' domain.

   The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY"
   in this document are to be interpreted as defined in [<a href="#ref-KEYWORDS" title='"Key words for use in RFCs to Indicate Requirement Levels"'>KEYWORDS</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Message%20Submission"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Message Submission</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.1.%20%20Submission%20Identification"></a><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Submission Identification</span>

   Port 587 is reserved for email message submission as specified in
   this document.  Messages received on this port are defined to be
   submissions.  The protocol used is ESMTP [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>, <a href="#ref-ESMTP" title='"SMTP Service Extensions"'>ESMTP</a>], with
   additional restrictions as specified here.

   While most email clients and servers can be configured to use port
   587 instead of 25, there are cases where this is not possible or
   convenient.  A site MAY choose to use port 25 for message submission,
   by designating some hosts to be MSAs and others to be MTAs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.2.%20%20Message%20Rejection%20and%20Bouncing"></a><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Message Rejection and Bouncing</span>

   MTAs and MSAs MAY implement message rejection rules that rely in part
   on whether the message is a submission or a relay.

   For example, some sites might configure their MTA to reject all RCPT
   TOs for messages that do not reference local users, and configure
   their MSA to reject all message submissions that do not come from
   authorized users, based on IP address, or authenticated identity.

   NOTE:  It is better to reject a message than to risk sending one that
   is damaged.  This is especially true for problems that are
   correctable by the MUA, for example, an invalid 'From' field.

   If an MSA is not able to determine a return path to the submitting
   user, from a valid MAIL FROM, a valid source IP address, or based on
   authenticated identity, then the MSA SHOULD immediately reject the
   message.  A message can be immediately rejected by returning a 550
   code to the MAIL FROM command.







<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   Note that a null return path, that is, MAIL FROM:&lt;&gt;, is permitted
   and MUST be accepted. (MUAs need to generate null return-path
   messages for a variety of reasons, including disposition
   notifications.)

   Except in the case where the MSA is unable to determine a valid
   return path for the message being submitted, text in this
   specification which instructs an MSA to issue a rejection code MAY be
   complied with by accepting the message and subsequently generating a
   bounce message. (That is, if the MSA is going to reject a message for
   any reason except being unable to determine a return path, it can
   optionally do an immediate rejection or accept the message and then
   mail a bounce.)

   NOTE:  In the normal case of message submission, immediately
   rejecting the message is preferred, as it gives the user and MUA
   direct feedback.  To properly handle delayed bounces the client MUA
   must maintain a queue of messages it has submitted, and match bounces
   to them.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.3.%20%20Authorized%20Submission"></a><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Authorized Submission</span>

   Numerous methods have been used to ensure that only authorized users
   are able to submit messages.  These methods include authenticated
   SMTP, IP address restrictions, secure IP, and prior POP
   authentication.

   Authenticated SMTP [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] has been proposed.  It allows the MSA
   to determine an authorization identity for the message submission,
   which is not tied to other protocols.

   IP address restrictions are very widely implemented, but do not allow
   for travellers and similar situations, and can be spoofed.

   Secure IP [<a href="#ref-IPSEC" title='"Security Architecture for the Internet Protocol"'>IPSEC</a>] can also be used, and provides additional benefits
   of protection against eavesdropping and traffic analysis.

   Requiring a POP [<a href="#ref-POP3" title='"Post Office Protocol -- Version 3"'>POP3</a>] authentication (from the same IP address)
   within some amount of time (for example, 20 minutes) prior to the
   start of a message submission session has also been used, but this
   does impose restrictions on clients as well as servers which may
   cause difficulties.  Specifically, the client must do a POP
   authentication before an SMTP submission session, and not all clients
   are capable and configured for this.  Also, the MSA must coordinate
   with the POP server, which may be difficult.  There is also a window
   during which an unauthorized user can submit messages and appear to
   be a prior authorized user.




<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.4.%20%20Enhanced%20Status%20Codes"></a><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  Enhanced Status Codes</span>

   This memo suggests several enhanced status codes [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>] for
   submission-specific rejections.  The specific codes used are:

    5.6.0  Bad content.  The content of the header or text is
           improper.

    5.6.2  Bad domain or address.  Invalid or improper domain or address
           in MAIL FROM, RCPT TO, or DATA.

    5.7.1  Not allowed.  The address in MAIL FROM appears to have
           insufficient submission rights, or is invalid, or is not
           authorized with the authentication used; the address in a
           RCPT TO command is inconsistent with the permissions given to
           the user; the message data is rejected based on the
           submitting user.

    5.7.0  Site policy.  The message appears to violate site policy in
           some way.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Mandatory%20Actions"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Mandatory Actions</span>

   An MSA MUST do all of the following:

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20General%20Submission%20Rejection%20Code"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  General Submission Rejection Code</span>

   Unless covered by a more precise response code, response code 554 is
   to be used to reject a MAIL FROM, RCPT TO, or DATA command that
   contains something improper.  Enhanced status code 5.6.0 is to be
   used if no other code is more specific.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20Ensure%20All%20Domains%20are%20Fully-Qualified"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  Ensure All Domains are Fully-Qualified</span>

   The MSA MUST ensure that all domains in the envelope are fully-
   qualified.

   If the MSA examines or alters the message text in way, except to add
   trace header fields [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>], it MUST ensure that all domains in
   address header fields are fully-qualified.

   Reply code 554 is to be used to reject a MAIL FROM, RCPT TO, or DATA
   command which contains improper domain references.

   NOTE:  A frequent local convention is to accept single-level domains
   (for example, 'sales') and then to expand the reference by adding the
   remaining portion of the domain name (for example, to




<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   'sales.example.net').  Local conventions that permit single-level
   domains SHOULD reject, rather than expand, incomplete multi-level
   domains, since such expansion is particularly risky.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Recommended%20Actions"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Recommended Actions</span>

   The MSA SHOULD do all of the following:

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.1.%20%20Enforce%20Address%20Syntax"></a><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Enforce Address Syntax</span>

   An MSA SHOULD reject messages with illegal syntax in a sender or
   recipient envelope address.

   If the MSA examines or alters the message text in way, except to add
   trace header fields, it SHOULD reject messages with illegal address
   syntax in address header fields.

   Reply code 501 is to be used to reject a MAIL FROM or RCPT TO command
   that contains a detectably improper address.

   When addresses are resolved after submission of the message body,
   reply code 554 with enhanced status code 5.6.2 is to be used after
   end-of-data, if the message contains invalid addresses in the header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.2.%20%20Log%20Errors"></a><a class="selflink" href="#section-5.2" id="section-5.2">5.2</a>.  Log Errors</span>

   The MSA SHOULD log message errors, especially apparent
   misconfigurations of client software.

   Note:  It can be very helpful to notify the administrator when
   problems are detected with local mail clients.  This is another
   advantage of distinguishing submission from relay: system
   administrators might be interested in local configuration problems,
   but not in client problems at other sites.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Optional%20Actions"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Optional Actions</span>

   The MSA MAY do any of the following:

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.1.%20%20Enforce%20Submission%20Rights"></a><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Enforce Submission Rights</span>

   The MSA MAY issue an error response to the MAIL FROM command if the
   address in MAIL FROM appears to have insufficient submission rights,
   or is not authorized with the authentication used (if the session has
   been authenticated).

   Reply code 550 with enhanced status code 5.7.1 is used for this
   purpose.



<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.2.%20%20Require%20Authentication"></a><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Require Authentication</span>

   The MSA MAY issue an error response to the MAIL FROM command if the
   session has not been authenticated.

   <a href="#section-3.3">Section 3.3</a> discusses authentication mechanisms.

   Reply code 530 [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] is used for this purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.3.%20%20Enforce%20Permissions"></a><a class="selflink" href="#section-6.3" id="section-6.3">6.3</a>.  Enforce Permissions</span>

   The MSA MAY issue an error response to the RCPT TO command if
   inconsistent with the permissions given to the user (if the session
   has been authenticated).

   Reply code 550 with enhanced status code 5.7.1 is used for this
   purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.4.%20%20Check%20Message%20Data"></a><a class="selflink" href="#section-6.4" id="section-6.4">6.4</a>.  Check Message Data</span>

   The MSA MAY issue an error response to the DATA command or send a
   failure result after end-of-data if the submitted message is
   syntactically invalid, or seems inconsistent with permissions given
   to the user (if known), or violates site policy in some way.

   Reply code 554 is used for syntactic problems in the data.  Reply
   code 501 is used if the command itself is not syntactically valid.
   Reply code 550 with enhanced status code 5.7.1 is used to reject
   based on the submitting user.  Reply code 550 with enhanced status
   code 5.7.0 is used if the message violates site policy.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Interaction%20with%20SMTP%20Extensions"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Interaction with SMTP Extensions</span>

   The following table lists the current standards-track and
   Experimental SMTP extensions.  Listed are the RFC, name, an
   indication as to the use of the extension on the submit port, and a
   reference:

   RFC   Name             Submission  Reference
   ----  ---------------  ----------  ------------------
   2197  Pipelining         SHOULD    [<a href="#ref-PIPELINING" title='"SMTP Service Extension for Command Pipelining"'>PIPELINING</a>]
   2034  Error Codes        SHOULD    [<a href="#ref-CODES-EXTENSION" title='"SMTP Service Extension for Returning Enhanced Error Codes"'>CODES-EXTENSION</a>]
   1985  ETRN              MUST NOT   [<a href="#ref-ETRN" title='"SMTP Service Extension for Remote Message Queue Starting"'>ETRN</a>]
   1893  Extended Codes     SHOULD    [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>]
   1891  DSN                SHOULD    [<a href="#ref-DSN" title='"SMTP Service Extension for Delivery Status Notifications"'>DSN</a>]
   1870  Size                MAY      [<a href="#ref-SIZE" title='"SMTP Service Extension for Message Size Declaration"'>SIZE</a>]
   1846  521               MUST NOT   [<a href="#ref-521REPLY" title='"SMTP 521 Reply Code"'>521REPLY</a>]
   1845  Checkpoint          MAY      [Checkpoint]



<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   1830  Binary              MAY      [<a href="#ref-CHUNKING" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>CHUNKING</a>]
   1652  8-bit MIME         SHOULD    [<a href="#ref-8BITMIME" title='"SMTP Service Extension for 8bit- MIMEtransport"'>8BITMIME</a>]
   ----  Authentication     ------    [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>]

   Future SMTP extensions should explicitly specify if they are valid on
   the Submission port.

   Some SMTP extensions are especially useful for message submission:

   Extended Status Codes [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>], SHOULD be supported and used
   according to [<a href="#ref-CODES-EXTENSION" title='"SMTP Service Extension for Returning Enhanced Error Codes"'>CODES-EXTENSION</a>].  This permits the MSA to notify the
   client of specific configuration or other problems in more detail
   than the response codes listed in this memo.  Because some rejections
   are related to a site's security policy, care should be used not to
   expose more detail than is needed to correct the problem.

   [<a id="ref-PIPELINING">PIPELINING</a>] SHOULD be supported by the MSA.

   [<a id="ref-SMTP-AUTH">SMTP-AUTH</a>] allows the MSA to validate the authority and determine
   the identity of the submitting user.

   Any references to the DATA command in this memo also refer to any
   substitutes for DATA, such as the BDAT command used with [<a href="#ref-CHUNKING" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>CHUNKING</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20Message%20Modifications"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  Message Modifications</span>

   Sites MAY modify submissions to ensure compliance with standards and
   site policy.  This section describes a number of such modifications
   that are often considered useful.

   NOTE:  As a matter of guidance for local decisions to implement
   message modification, a paramount rule is to limit such actions to
   remedies for specific problems that have clear solutions.  This is
   especially true with address elements.  For example, indiscriminately
   appending a domain to an address or element which lacks one typically
   results in more broken addresses.  An unqualified address must be
   verified to be a valid local part in the domain before the domain can
   be safely added.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Add%20%27Sender%27"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Add 'Sender'</span>

   The MSA MAY add or replace the 'Sender' field, if the identity of the
   sender is known and this is not given in the 'From' field.

   The MSA MUST ensure that any address it places in a 'Sender' field is
   in fact a valid mail address.





<span class="grey">Gellens &amp; Klensin           Standards Track                     [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20Add%20%27Date%27"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  Add 'Date'</span>

   The MSA MAY add a 'Date' field to the submitted message, if it lacks
   it, or correct the 'Date' field if it does not conform to [MESSAGE-
   FORMAT] syntax.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.3.%20%20Add%20%27Message-ID%27"></a><a class="selflink" href="#section-8.3" id="section-8.3">8.3</a>.  Add 'Message-ID'</span>

   The MSA MAY add or replace the 'Message-ID' field, if it lacks it, or
   it is not valid syntax (as defined by [<a href="#ref-MESSAGE-FORMAT" title='"Standard for the format of ARPA Internet text messages"'>MESSAGE-FORMAT</a>]).

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.4.%20%20Transfer%20Encode"></a><a class="selflink" href="#section-8.4" id="section-8.4">8.4</a>.  Transfer Encode</span>

   The MSA MAY apply transfer encoding to the message according to MIME
   conventions, if needed and not harmful to the MIME type.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.5.%20%20Sign%20the%20Message"></a><a class="selflink" href="#section-8.5" id="section-8.5">8.5</a>.  Sign the Message</span>

   The MSA MAY (digitally) sign or otherwise add authentication
   information to the message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.6.%20%20Encrypt%20the%20Message"></a><a class="selflink" href="#section-8.6" id="section-8.6">8.6</a>.  Encrypt the Message</span>

   The MSA MAY encrypt the message for transport to reflect
   organizational policies.

   NOTE:  To be useful, the addition of a signature and/or encryption by
   the MSA generally implies that the connection between the MUA and MSA
   must itself be secured in some other way, e.g., by operating inside
   of a secure environment, by securing the submission connection at the
   transport layer, or by using an [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] mechanism that provides
   for session integrity.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.7.%20%20Resolve%20Aliases"></a><a class="selflink" href="#section-8.7" id="section-8.7">8.7</a>.  Resolve Aliases</span>

   The MSA MAY resolve aliases (CNAME records) for domain names, in the
   envelope and optionally in address fields of the header, subject to
   local policy.

   NOTE:  Unconditionally resolving aliases could be harmful.  For
   example, if www.example.net and ftp.example.net are both aliases for
   mail.example.net, rewriting them could lose useful information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.8.%20%20Header%20Rewriting"></a><a class="selflink" href="#section-8.8" id="section-8.8">8.8</a>.  Header Rewriting</span>

   The MSA MAY rewrite local parts and/or domains, in the envelope and
   optionally in address fields of the header, according to local
   policy.  For example, a site may prefer to rewrite 'JRU' as '



<span class="grey">Gellens &amp; Klensin           Standards Track                    [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   J.Random.User' in order to hide logon names, and/or to rewrite '
   squeeky.sales.example.net' as 'zyx.example.net' to hide machine names
   and make it easier to move users.

   However, only addresses, local-parts, or domains which match specific
   local MSA configuration settings should be altered.  It would be very
   dangerous for the MSA to apply data-independent rewriting rules, such
   as always deleting the first element of a domain name.  So, for
   example, a rule which strips the left-most element of the domain if
   the complete domain matches '*.foo.example.net' would be acceptable.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" id="section-9">9</a>.  Security Considerations</span>

   Separation of submission and relay of messages can allow a site to
   implement different policies for the two types of services, including
   requiring use of additional security mechanisms for one or both.  It
   can do this in a way which is simpler, both technically and
   administratively.  This increases the likelihood that policies will
   be applied correctly.

   Separation also can aid in tracking and preventing unsolicited bulk
   email.

   For example, a site could configure its MSA to require authentication
   before accepting a message, and could configure its MTA to reject all
   RCPT TOs for non-local users.  This can be an important element in a
   site's total email security policy.

   If a site fails to require any form of authorization for message
   submissions (see <a href="#section-3.3">section 3.3</a> for discussion), it is allowing open use
   of its resources and name; unsolicited bulk email can be injected
   using its facilities.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/10.%20%20Acknowledgments"></a><a class="selflink" href="#section-10" id="section-10">10</a>.  Acknowledgments</span>

   This updated memo has been revised in part based on comments and
   discussions which took place on and off the IETF-Submit mailing list.
   The help of those who took the time to review the draft and make
   suggestions is appreciated, especially that of Dave Crocker, Ned
   Freed, Keith Moore, John Myers, and Chris Newman.

   Special thanks to Harald Alvestrand, who got this effort started.









<span class="grey">Gellens &amp; Klensin           Standards Track                    [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/11.%20%20References"></a><a class="selflink" href="#section-11" id="section-11">11</a>.  References</span>

   [<a id="ref-521REPLY">521REPLY</a>]        Durand, A. and F. Dupont, "SMTP 521 Reply Code",
                     <a href="./rfc1846">RFC 1846</a>, September 1995.

   [<a id="ref-8BITMIME">8BITMIME</a>]        Klensin, J., Freed, N., Rose, M., Stefferud, E. and
                     D.  Crocker, "SMTP Service Extension for 8bit-
                     MIMEtransport", <a href="./rfc1652">RFC 1652</a>, July 1994.

   [<a id="ref-ABNF">ABNF</a>]            Crocker, D., Ed. and P. Overell, "Augmented BNF for
                     Syntax Specifications: ABNF", <a href="./rfc2234">RFC 2234</a>, November
                     1997.

   [<a id="ref-CHECKPOINT">CHECKPOINT</a>]      Crocker, D., Freed, N. and A. Cargille, "SMTP
                     Service Extension for Checkpoint/Restart", <a href="./rfc1845">RFC</a>
                     <a href="./rfc1845">1845</a>, September 1995.

   [<a id="ref-CHUNKING">CHUNKING</a>]        Vaudreuil, G., "SMTP Service Extensions for
                     Transmission of Large and Binary MIME Messages",
                     <a href="./rfc1830">RFC 1830</a>, August 1995.

   [<a id="ref-CODES-EXTENSION">CODES-EXTENSION</a>] Freed, N., "SMTP Service Extension for Returning
                     Enhanced Error Codes", <a href="./rfc2034">RFC 2034</a>, October 1996.

   [<a id="ref-DSN">DSN</a>]             Moore, K., "SMTP Service Extension for Delivery
                     Status Notifications", <a href="./rfc1891">RFC 1891</a>, January 1996.

   [<a id="ref-ESMTP">ESMTP</a>]           Klensin, J., Freed, N., Rose, M., Stefferud, E. and
                     D. Crocker, "SMTP Service Extensions", STD 10, <a href="./rfc1869">RFC</a>
                     <a href="./rfc1869">1869</a>, November 1995.

   [<a id="ref-ETRN">ETRN</a>]            De Winter, J., "SMTP Service Extension for Remote
                     Message Queue Starting", <a href="./rfc1985">RFC 1985</a>, August 1996.

   [<a id="ref-HEADERS">HEADERS</a>]         Palme, J., "Common Internet Message Headers", <a href="./rfc2076">RFC</a>
                     <a href="./rfc2076">2076</a>, February 1997.

   [<a id="ref-IPSEC">IPSEC</a>]           Atkinson, R., "Security Architecture for the
                     Internet Protocol", <a href="./rfc1825">RFC 1825</a>, August 1995.

   [<a id="ref-KEYWORDS">KEYWORDS</a>]        Bradner, S., "Key words for use in RFCs to Indicate
                     Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.









<span class="grey">Gellens &amp; Klensin           Standards Track                    [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


   [<a id="ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>]  Crocker, D., "Standard for the format of ARPA
                     Internet text messages", STD 11, <a href="./rfc822">RFC 822</a>, August
                     1982;

                     Braden, R., Editor, "Requirements for Internet
                     Hosts -- Application and Support", STD 3, <a href="./rfc1123">RFC 1123</a>,
                     October 1989.

   [<a id="ref-PIPELINING">PIPELINING</a>]      Freed, N., "SMTP Service Extension for Command
                     Pipelining", <a href="./rfc2197">RFC 2197</a>, September 1997.

   [<a id="ref-POP3">POP3</a>]            Myers, J. and M. Rose, "Post Office Protocol --
                     Version 3", STD 53, <a href="./rfc1939">RFC 1939</a>, May 1996.

   [<a id="ref-SIZE">SIZE</a>]            Klensin, J., Freed, N. and K. Moore, "SMTP Service
                     Extension for Message Size Declaration", STD 10,
                     <a href="./rfc1870">RFC 1870</a>, November 1995.

   [<a id="ref-SMTP-AUTH">SMTP-AUTH</a>]       Myers, J., "SMTP Service Extension for
                     Authentication", Work in Progress.

   [<a id="ref-SMTP-CODES">SMTP-CODES</a>]      Vaudreuil, G., "Enhanced Mail System Status Codes",
                     <a href="./rfc1893">RFC 1893</a>, January 1996.

   [<a id="ref-SMTP-MTA">SMTP-MTA</a>]        Postel, J., "Simple Mail Transfer Protocol", STD
                     10, <a href="./rfc821">RFC 821</a>, August 1982.

                     Partridge, C., "Mail Routing and the Domain
                     System", STD 14, <a href="./rfc974">RFC 974</a>, January 1986.

                     Braden, R., Editor, "Requirements for Internet
                     Hosts -- Application and Support", STD 3, <a href="./rfc1123">RFC 1123</a>,
                     October 1989.


















<span class="grey">Gellens &amp; Klensin           Standards Track                    [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/12.%20%20Authors%27%20Addresses"></a><a class="selflink" href="#section-12" id="section-12">12</a>.  Authors' Addresses</span>

   Randall Gellens
   QUALCOMM Incorporated
   6455 Lusk Blvd.
   San Diego, CA  92121-2779
   U.S.A.

   Phone: +1 619 651 5115
   Fax:   +1 619 651 5334
   EMail: Randy@Qualcomm.Com


   John C. Klensin
   MCI Telecommunications
   800 Boylston St, 7th floor
   Boston, MA 02199
   USA

   Phone: +1 617 960 1011
   EMail: klensin@mci.net






























<span class="grey">Gellens &amp; Klensin           Standards Track                    [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc2476">RFC 2476</a>                   Message Submission              December 1998</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/13.%20%20Full%20Copyright%20Statement"></a><a class="selflink" href="#section-13" id="section-13">13</a>.  Full Copyright Statement</span>

   Copyright (C) The Internet Society (1998).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
























Gellens &amp; Klensin           Standards Track                    [Page 15]
</pre>
</body></html>