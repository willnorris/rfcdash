<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9018: Interoperable Domain Name System (DNS) Server Cookies</title>
<meta content="Ondrej Sury" name="author"/>
<meta content="Willem Toorop" name="author"/>
<meta content="Donald E. Eastlake 3rd" name="author"/>
<meta content="Mark Andrews" name="author"/>
<meta content="
       DNS Cookies, as specified in RFC 7873, are a
lightweight DNS transaction security mechanism that provide limited protection
to DNS servers and clients against a variety of denial-of-service
amplification, forgery, or cache-poisoning attacks by off-path attackers. 
       This document updates RFC 7873 with precise directions for creating Server
Cookies so that an anycast server set including diverse implementations will
interoperate with standard clients, with suggestions for constructing Client Cookies
in a privacy-preserving fashion, and with suggestions on how to update a Server
Secret.  An IANA registry listing the methods and associated pseudorandom
function suitable for creating DNS Server Cookies has been created with the method
described in this document as the first and, as of the time of publication, only entry. 
    " name="description"/>
<meta content="xml2rfc 3.6.0" name="generator"/>
<meta content="Client" name="keyword"/>
<meta content="Hash" name="keyword"/>
<meta content="9018" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.6.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.3.5
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.19.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 40.6.2
    six 1.14.0
    WeasyPrint 51
-->
<link href="rfc9018.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://dx.doi.org/10.17487/rfc9018" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <link href="https://datatracker.ietf.org/doc/draft-ietf-dnsop-server-cookies-05" rel="prev"/>
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9018</td>
<td class="center">Interoperable DNS Server Cookies</td>
<td class="right">April 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sury, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9018">9018</a></dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a class="eref" href="https://www.rfc-editor.org/rfc/rfc7873">7873</a> </dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2021-04">April 2021</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">O. Sury</div>
<div class="org">Internet Systems Consortium</div>
</div>
<div class="author">
      <div class="author-name">W. Toorop</div>
<div class="org">NLnet Labs</div>
</div>
<div class="author">
      <div class="author-name">D. Eastlake 3rd</div>
<div class="org">Futurewei Technologies</div>
</div>
<div class="author">
      <div class="author-name">M. Andrews</div>
<div class="org">Internet Systems Consortium</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9018</h1>
<h1 id="title">Interoperable Domain Name System (DNS) Server Cookies</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">DNS Cookies, as specified in RFC 7873, are a
lightweight DNS transaction security mechanism that provide limited protection
to DNS servers and clients against a variety of denial-of-service
amplification, forgery, or cache-poisoning attacks by off-path attackers.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
<p id="section-abstract-2">This document updates RFC 7873 with precise directions for creating Server
Cookies so that an anycast server set including diverse implementations will
interoperate with standard clients, with suggestions for constructing Client Cookies
in a privacy-preserving fashion, and with suggestions on how to update a Server
Secret.  An IANA registry listing the methods and associated pseudorandom
function suitable for creating DNS Server Cookies has been created with the method
described in this document as the first and, as of the time of publication, only entry.<a class="pilcrow" href="#section-abstract-2">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9018">https://www.rfc-editor.org/info/rfc9018</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.1">
            <p class="keepWithNext" id="section-toc.1-1.1.1"><a class="xref" href="#section-1">1</a>.  <a class="xref" href="#name-introduction">Introduction</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="xref" href="#section-1.1">1.1</a>.  <a class="xref" href="#name-terminology-and-definitions">Terminology and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.2">
            <p class="keepWithNext" id="section-toc.1-1.2.1"><a class="xref" href="#section-2">2</a>.  <a class="xref" href="#name-changes-to-rfc-7873">Changes to  RFC 7873</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="xref" href="#section-3">3</a>.  <a class="xref" href="#name-constructing-a-client-cooki">Constructing a Client Cookie</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="xref" href="#section-4">4</a>.  <a class="xref" href="#name-constructing-a-server-cooki">Constructing a Server Cookie</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a class="xref" href="#section-4.1">4.1</a>.  <a class="xref" href="#name-the-version-sub-field">The Version Sub-Field</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a class="xref" href="#section-4.2">4.2</a>.  <a class="xref" href="#name-the-reserved-sub-field">The Reserved Sub-Field</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a class="xref" href="#section-4.3">4.3</a>.  <a class="xref" href="#name-the-timestamp-sub-field">The Timestamp Sub-Field</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a class="xref" href="#section-4.4">4.4</a>.  <a class="xref" href="#name-the-hash-sub-field">The Hash Sub-Field</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="xref" href="#section-5">5</a>.  <a class="xref" href="#name-updating-the-server-secret">Updating the Server Secret</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="xref" href="#section-6">6</a>.  <a class="xref" href="#name-cookie-algorithms">Cookie Algorithms</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="xref" href="#section-7">7</a>.  <a class="xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a class="xref" href="#section-8">8</a>.  <a class="xref" href="#name-security-and-privacy-consid">Security and Privacy Considerations</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a class="xref" href="#section-8.1">8.1</a>.  <a class="xref" href="#name-client-cookie-construction">Client Cookie Construction</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a class="xref" href="#section-8.2">8.2</a>.  <a class="xref" href="#name-server-cookie-construction">Server Cookie Construction</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a class="xref" href="#section-9">9</a>.  <a class="xref" href="#name-references">References</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a class="xref" href="#section-9.1">9.1</a>.  <a class="xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a class="xref" href="#section-9.2">9.2</a>.  <a class="xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a class="xref" href="#section-appendix.a">Appendix A</a>.  <a class="xref" href="#name-test-vectors">Test Vectors</a></p>
<ul class="compact ulEmpty toc">
<li class="compact ulEmpty toc" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a class="xref" href="#section-a.1">A.1</a>.  <a class="xref" href="#name-learning-a-new-server-cooki">Learning a New Server Cookie</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a class="xref" href="#section-a.2">A.2</a>.  <a class="xref" href="#name-the-same-client-learning-a-">The Same Client Learning a Renewed (Fresh) Server Cookie</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a class="xref" href="#section-a.3">A.3</a>.  <a class="xref" href="#name-another-client-learning-a-r">Another Client Learning a Renewed Server Cookie</a></p>
</li>
              <li class="compact ulEmpty toc" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a class="xref" href="#section-a.4">A.4</a>.  <a class="xref" href="#name-ipv6-query-with-rolled-over">IPv6 Query with Rolled Over Secret</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a class="xref" href="#section-appendix.b">Appendix B</a>.  <a class="xref" href="#name-implementation-status">Implementation Status</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a class="xref" href="#section-appendix.c"></a><a class="xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact ulEmpty toc" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a class="xref" href="#section-appendix.d"></a><a class="xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">DNS Cookies, as specified in <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span>, are a
lightweight DNS transaction security mechanism that provide limited protection
to DNS servers and clients against a variety of denial-of-service
amplification, forgery, or cache-poisoning attacks by off-path attackers. This
document specifies a means of producing interoperable cookies so that an
anycast server set including diverse implementations can be easily configured
to interoperate with standard clients.  Also, single-implementation or
non-anycast services can benefit from a well-studied standardized algorithm
for which the behavioral and security characteristics are more widely
known.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">The threats considered for DNS Cookies and the properties of the DNS
Security features other than DNS Cookies are discussed in <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span>.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">In <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#section-6">Section 6</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span>, for simplicity, it is 
"<span class="bcp14">RECOMMENDED</span> that the same Server Secret be used by
each DNS server in a set of anycast servers." However, how precisely a
Server Cookie is calculated from this Server Secret is left to the
implementation.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">This guidance has led to a gallimaufry of DNS Cookie implementations,
calculating the Server Cookie in different ways. As a result, DNS Cookies
are impractical to deploy on multi-vendor anycast networks because even
when all DNS Software shares the same secret, as <span class="bcp14">RECOMMENDED</span> in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#section-6">Section 6</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span>, the Server Cookie constructed by one implementation
cannot generally be validated by another.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">There is no need for DNS client (resolver) Cookies to be interoperable
across different implementations. Each client need only be able to recognize
its own cookies. However, this document does contain recommendations for
constructing Client Cookies in a client-protecting fashion.<a class="pilcrow" href="#section-1-5">¶</a></p>
<div id="terminology-and-definitions">
<section id="section-1.1">
        <h3 id="name-terminology-and-definitions">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-terminology-and-definitions">Terminology and Definitions</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
    described in BCP 14 <span>[<a class="xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="xref" href="#RFC8174">RFC8174</a>]</span> 
    when, and only when, they appear in all capitals, as shown here.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
<p id="section-1.1-2">Note: "IP address" is used herein as a length-independent term covering
both IPv4 and IPv6 addresses.<a class="pilcrow" href="#section-1.1-2">¶</a></p>
</section>
</div>
</section>
</div>
<div id="changes">
<section id="section-2">
      <h2 id="name-changes-to-rfc-7873">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-changes-to-rfc-7873">Changes to  RFC 7873</a>
      </h2>
<p id="section-2-1">Appendices <a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#appendix-A.1">A.1</a> and <a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#appendix-B.1">B.1</a> of <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span> provide
example "simple" algorithms for computing Client and Server Cookies,
respectively.  These algorithms <span class="bcp14">MUST NOT</span> be used as the
resulting cookies are too weak when evaluated against modern security
standards.<a class="pilcrow" href="#section-2-1">¶</a></p>
<p id="section-2-2"><span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#appendix-B.2">Appendix B.2</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span> provides an example "more complex" server
algorithm. This algorithm is replaced by the interoperable specification in
<a class="xref" href="#serverCookie">Section 4</a> of this document, which <span class="bcp14">MUST</span> be used by Server Cookie
implementations.<a class="pilcrow" href="#section-2-2">¶</a></p>
<p id="section-2-3">This document has suggestions on Client Cookie construction in <a class="xref" href="#clientCookie">Section 3</a>.
The previous example in <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#appendix-A.2">Appendix A.2</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span> is <span class="bcp14">NOT RECOMMENDED</span>.<a class="pilcrow" href="#section-2-3">¶</a></p>
</section>
</div>
<div id="clientCookie">
<section id="section-3">
      <h2 id="name-constructing-a-client-cooki">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-constructing-a-client-cooki">Constructing a Client Cookie</a>
      </h2>
<p id="section-3-1">The Client Cookie acts as an identifier for a given client and its IP
address and needs to be unguessable. In order to provide minimal
authentication of the targeted server, a client <span class="bcp14">MUST</span> use a
different Client Cookie for each different Server IP address. This complicates
a server's ability to spoof answers for other DNS servers. The Client Cookie
<span class="bcp14">SHOULD</span> have 64 bits of entropy.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2">When a server does not support DNS Cookies, the client <span class="bcp14">MUST NOT</span> send the same
Client Cookie to that same server again. Instead, it is recommended that the
client does not send a Client Cookie to that server for a certain period
(for example, five minutes) before it retries with a new Client Cookie.<a class="pilcrow" href="#section-3-2">¶</a></p>
<p id="section-3-3">When a server does support DNS Cookies, the client should store the Client
Cookie alongside the Server Cookie it registered for that server.<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">Except for when the Client IP address changes, there is no need to change the
Client Cookie often. It is then reasonable to change the Client Cookie only if
it has been compromised or after a relatively long implementation-defined
period of time.  The time period should be no longer than a year, and in any
case, Client Cookies are not expected to survive a program restart.<a class="pilcrow" href="#section-3-4">¶</a></p>
<div id="section-3-5">
<pre class="sourcecode">Client-Cookie = 64 bits of entropy
</pre><a class="pilcrow" href="#section-3-5">¶</a>
</div>
<p id="section-3-6">Previously, the recommended algorithm to compute the Client Cookie included
the Client IP address as an input to a hashing function. However, when implementing
the DNS Cookies, several DNS vendors found it impractical to include the Client IP
as the Client Cookie is typically computed before the Client IP address is
known. Therefore, the requirement to put the Client IP address as input was
removed.<a class="pilcrow" href="#section-3-6">¶</a></p>
<p id="section-3-7">However, for privacy reasons, in order to prevent tracking of devices across
links and to not circumvent IPv6 Privacy Extensions <span>[<a class="xref" href="#RFC8981">RFC8981</a>]</span>, clients <span class="bcp14">MUST NOT</span> reuse a Client or Server Cookie after the Client IP address has changed.<a class="pilcrow" href="#section-3-7">¶</a></p>
<p id="section-3-8">One way to satisfy this requirement for non-reuse is to register the Client IP
address alongside the Server Cookie when it receives the Server Cookie.  In
subsequent queries to the server with that Server Cookie, the socket <span class="bcp14">MUST</span> be
bound to the Client IP address that was also used (and registered) when it
received the Server Cookie.  Failure to bind <span class="bcp14">MUST</span> then result in a new Client
Cookie.<a class="pilcrow" href="#section-3-8">¶</a></p>
</section>
</div>
<div id="serverCookie">
<section id="section-4">
      <h2 id="name-constructing-a-server-cooki">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-constructing-a-server-cooki">Constructing a Server Cookie</a>
      </h2>
<p id="section-4-1">The Server Cookie is effectively a Message Authentication Code (MAC). The
Server Cookie, when it occurs in a COOKIE option in a request, is intended to
weakly assure the server that the request came from a client that is both at
the source IP address of the request and using the Client Cookie included in
the option.  

 This assurance is provided by the Server Cookie that the server (or any other
 server from the anycast set) sent to that client in an earlier response and
 that appears as the Server Cookie field in the weakly authenticated request
 (see <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#section-5.2">Section 5.2</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span>).<a class="pilcrow" href="#section-4-1">¶</a></p>
<p id="section-4-2">DNS Cookies do not provide protection against "on-path"
adversaries (see <span><a class="relref" href="https://www.rfc-editor.org/rfc/rfc7873#section-9">Section 9</a> of [<a class="xref" href="#RFC7873">RFC7873</a>]</span>). An
on-path observer that has seen a Server Cookie for a client can abuse that
Server Cookie to spoof request for that client within the time span a Server
Cookie is valid (see <a class="xref" href="#timestampField">Section 4.3</a>).<a class="pilcrow" href="#section-4-2">¶</a></p>
<p id="section-4-3">



  The Server Cookie is calculated from the Client Cookie, a series of
  Sub-Fields specified below, the Client IP address, and a Server
  Secret that is known only to the server or only to the set of servers
  at the same anycast address.<a class="pilcrow" href="#section-4-3">¶</a></p>
<p id="section-4-4">For calculation of the Server Cookie, a pseudorandom function is
<span class="bcp14">RECOMMENDED</span> with the property that an attacker that does not
know the Server Secret, cannot find (any information about) the Server Secret,
and cannot create a Server Cookie for any combination of the Client Cookie,
the series of Sub-Fields specified below, and the client IP address, for which
it has not seen a Server Cookie before. 

Because DNS servers need to use the pseudorandom function in order to verify
Server Cookies, it is <span class="bcp14">RECOMMENDED</span> that it be efficient to
calculate.

The pseudorandom function described in <span>[<a class="xref" href="#SipHash-2-4">SipHash-2-4</a>]</span> and
introduced in <a class="xref" href="#hashField">Section 4.4</a> of this document fits these
recommendations.<a class="pilcrow" href="#section-4-4">¶</a></p>
<p id="section-4-5">Changing the Server Secret regularly is <span class="bcp14">RECOMMENDED</span> but,
when a secure pseudorandom function is used, it need not be changed too
frequently.  Once a month, for example, would be adequate.  See <a class="xref" href="#rollingSecret">Section 5</a> on operator and implementation guidelines for
updating a Server Secret.<a class="pilcrow" href="#section-4-5">¶</a></p>
<p id="section-4-6">The 128-bit Server Cookie consists of the following Sub-Fields: a 1-octet Version Sub-Field,
a 3-octet Reserved Sub-Field, a 4-octet Timestamp Sub-Field, and an 8-octet Hash
Sub-Field.<a class="pilcrow" href="#section-4-6">¶</a></p>
<div class="artwork art-text alignLeft art-ascii-art" id="section-4-7">
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Version    |                   Reserved                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Timestamp                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Hash                              |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a class="pilcrow" href="#section-4-7">¶</a>
</div>
<div id="the-version-sub-field">
<section id="section-4.1">
        <h3 id="name-the-version-sub-field">
<a class="section-number selfRef" href="#section-4.1">4.1. </a><a class="section-name selfRef" href="#name-the-version-sub-field">The Version Sub-Field</a>
        </h3>
<p id="section-4.1-1">The Version Sub-Field prescribes the structure and Hash calculation formula.
This document defines Version 1 to be the structure and way to calculate the
Hash Sub-Field as defined in this section.<a class="pilcrow" href="#section-4.1-1">¶</a></p>
</section>
</div>
<div id="the-reserved-sub-field">
<section id="section-4.2">
        <h3 id="name-the-reserved-sub-field">
<a class="section-number selfRef" href="#section-4.2">4.2. </a><a class="section-name selfRef" href="#name-the-reserved-sub-field">The Reserved Sub-Field</a>
        </h3>
<p id="section-4.2-1">The value of the Reserved Sub-Field is reserved for future versions of
server-side cookie construction.  On construction, it <span class="bcp14">MUST</span> be
set to zero octets.  On Server Cookie verification, the server <span class="bcp14">MUST NOT</span> enforce those fields to be zero, and the Hash should be computed
with the received value as described in <a class="xref" href="#hashField">Section 4.4</a>.<a class="pilcrow" href="#section-4.2-1">¶</a></p>
</section>
</div>
<div id="timestampField">
<section id="section-4.3">
        <h3 id="name-the-timestamp-sub-field">
<a class="section-number selfRef" href="#section-4.3">4.3. </a><a class="section-name selfRef" href="#name-the-timestamp-sub-field">The Timestamp Sub-Field</a>
        </h3>
<p id="section-4.3-1">The Timestamp value prevents Replay Attacks and <span class="bcp14">MUST</span> be
checked by the server to be within a defined period of time.  The DNS server
<span class="bcp14">SHOULD</span> allow cookies within a 1-hour period in the past and a
5-minute period into the future to allow operation of low-volume clients and
some limited time skew between the DNS servers in the anycast set.<a class="pilcrow" href="#section-4.3-1">¶</a></p>
<p id="section-4.3-2">The Timestamp value specifies a date and time in the form of a 32-bit
<strong>unsigned</strong> number of seconds elapsed since 1 January 1970
00:00:00 UTC, ignoring leap seconds, in network byte order.  All comparisons
involving these fields <span class="bcp14">MUST</span> use "Serial number
arithmetic", as defined in <span>[<a class="xref" href="#RFC1982">RFC1982</a>]</span>. <span>[<a class="xref" href="#RFC1982">RFC1982</a>]</span> specifies how the differences should be handled. This
handles any relative time window less than 68 years, at any time in the future
(2038, 2106, 2256, 22209, or later.)<a class="pilcrow" href="#section-4.3-2">¶</a></p>
<p id="section-4.3-3">The DNS server <span class="bcp14">SHOULD</span> generate a new Server Cookie at least if the received
Server Cookie from the client is more than half an hour old, but it <span class="bcp14">MAY</span>
generate a new cookie more often than that.<a class="pilcrow" href="#section-4.3-3">¶</a></p>
</section>
</div>
<div id="hashField">
<section id="section-4.4">
        <h3 id="name-the-hash-sub-field">
<a class="section-number selfRef" href="#section-4.4">4.4. </a><a class="section-name selfRef" href="#name-the-hash-sub-field">The Hash Sub-Field</a>
        </h3>
<p id="section-4.4-1">It's important that all the DNS servers use the same algorithm for computing
the Server Cookie.  This document defines the Version 1 of the server-side
algorithm to be:<a class="pilcrow" href="#section-4.4-1">¶</a></p>
<div id="section-4.4-2">
<pre class="sourcecode">Hash = SipHash-2-4(
    Client Cookie | Version | Reserved | Timestamp | Client-IP,
    Server Secret )
</pre><a class="pilcrow" href="#section-4.4-2">¶</a>
</div>
<p id="section-4.4-3">where "|" indicates concatenation.<a class="pilcrow" href="#section-4.4-3">¶</a></p>
<p id="section-4.4-4">Notice that Client-IP is used for hash generation even though it is not
included in the cookie value itself. Client-IP can be either 4 bytes for IPv4
or 16 bytes for IPv6. The length of all the concatenated elements (the input
into <span>[<a class="xref" href="#SipHash-2-4">SipHash-2-4</a>]</span>) <span class="bcp14">MUST</span> be either precisely 20 bytes in case of an IPv4
Client-IP or precisely 32 bytes in case of an IPv6 Client-IP.<a class="pilcrow" href="#section-4.4-4">¶</a></p>
<p id="section-4.4-5">When a DNS server receives a Server Cookie version 1 for validation, the length
of the received COOKIE option <span class="bcp14">MUST</span> be precisely 24 bytes: 8 bytes for the
Client Cookie plus 16 bytes for the Server Cookie. Verification of the length
of the received COOKIE option is <span class="bcp14">REQUIRED</span> to guarantee the length of the input
into <span>[<a class="xref" href="#SipHash-2-4">SipHash-2-4</a>]</span> to be precisely 20 bytes in the case of an IPv4 Client-IP and
precisely 32 bytes in the case of an IPv6 Client-IP. This ensures that the input
into <span>[<a class="xref" href="#SipHash-2-4">SipHash-2-4</a>]</span> is an injective function of the elements making up the
input, and thereby prevents data substitution attacks.  More specifically, this
prevents a 36-byte COOKIE option coming from an IPv4 Client-IP to be validated
as if it were coming from an IPv6 Client-IP.<a class="pilcrow" href="#section-4.4-5">¶</a></p>
<p id="section-4.4-6">The Server Secret <span class="bcp14">MUST</span> be configurable to make sure that servers in an anycast
network return consistent results.<a class="pilcrow" href="#section-4.4-6">¶</a></p>
</section>
</div>
</section>
</div>
<div id="rollingSecret">
<section id="section-5">
      <h2 id="name-updating-the-server-secret">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-updating-the-server-secret">Updating the Server Secret</a>
      </h2>
<p id="section-5-1">Changing the Server Secret regularly is <span class="bcp14">RECOMMENDED</span>.  All servers in an anycast
set must be able to verify the Server Cookies constructed by all other servers
in that anycast set at all times.  Therefore, it is vital that the Server Secret
is shared among all servers before it is used to generate Server Cookies on any
server.<a class="pilcrow" href="#section-5-1">¶</a></p>
<p id="section-5-2">Also, to maximize maintaining established relationships between clients and
servers, an old Server Secret should be valid for verification purposes for a
specific period.<a class="pilcrow" href="#section-5-2">¶</a></p>
<p id="section-5-3">To facilitate this, deployment of a new Server Secret <span class="bcp14">MUST</span> be done in three
stages:<a class="pilcrow" href="#section-5-3">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5-4">
        <dt id="section-5-4.1">Stage 1</dt>
        <dd id="section-5-4.2" style="margin-left: 1.5em">
          <p id="section-5-4.2.1">
The new Server Secret is deployed on all the servers in an anycast set by
the operator.<a class="pilcrow" href="#section-5-4.2.1">¶</a></p>
<p id="section-5-4.2.2">Each server learns the new Server Secret but keeps using the previous Server
Secret to generate Server Cookies.<a class="pilcrow" href="#section-5-4.2.2">¶</a></p>
<p id="section-5-4.2.3">Server Cookies constructed with both the new Server Secret and the previous
Server Secret are considered valid when verifying.<a class="pilcrow" href="#section-5-4.2.3">¶</a></p>
<p id="section-5-4.2.4">After stage 1 is completed, all the servers in the anycast set have learned the
new Server Secret and can verify Server Cookies constructed with it, but keep
generating Server Cookies with the old Server Secret.<a class="pilcrow" href="#section-5-4.2.4">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-4.3">Stage 2</dt>
        <dd id="section-5-4.4" style="margin-left: 1.5em">
          <p id="section-5-4.4.1">
This stage is initiated by the operator after the Server Cookie is present
on all members in the anycast set.<a class="pilcrow" href="#section-5-4.4.1">¶</a></p>
<p id="section-5-4.4.2">When entering Stage 2, servers start generating Server Cookies with the new
Server Secret. The previous Server Secret is not yet removed/forgotten.<a class="pilcrow" href="#section-5-4.4.2">¶</a></p>
<p id="section-5-4.4.3">Server Cookies constructed with both the new Server Secret and the
previous Server Secret are considered valid when verifying.<a class="pilcrow" href="#section-5-4.4.3">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-5-4.5">Stage 3</dt>
        <dd id="section-5-4.6" style="margin-left: 1.5em">
          <p id="section-5-4.6.1">
This stage is initiated by the operator when it can be assumed that most
clients have obtained a Server Cookie derived from the new Server Secret.<a class="pilcrow" href="#section-5-4.6.1">¶</a></p>
<p id="section-5-4.6.2">With this stage, the previous Server Secret can be removed and <span class="bcp14">MUST NOT</span> be
used anymore for verifying.<a class="pilcrow" href="#section-5-4.6.2">¶</a></p>
<p id="section-5-4.6.3">It is <span class="bcp14">RECOMMENDED</span> that the operator wait, after initiating Stage 2
  and before initiating Stage 3, at least a period of time equal to
  the longest TTL in the zones served by the server plus 1 hour.<a class="pilcrow" href="#section-5-4.6.3">¶</a></p>
<p id="section-5-4.6.4">The operator <span class="bcp14">SHOULD</span> wait at least longer than the period clients are allowed
to use the same Server Cookie, which <span class="bcp14">SHOULD</span> be 1 hour (see <a class="xref" href="#timestampField">Section 4.3</a>).<a class="pilcrow" href="#section-5-4.6.4">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="cookieAlgorithms">
<section id="section-6">
      <h2 id="name-cookie-algorithms">
<a class="section-number selfRef" href="#section-6">6. </a><a class="section-name selfRef" href="#name-cookie-algorithms">Cookie Algorithms</a>
      </h2>
<p id="section-6-1"><span>[<a class="xref" href="#SipHash-2-4">SipHash-2-4</a>]</span> is a pseudorandom function suitable as a Message Authentication
Code.  It is <span class="bcp14">REQUIRED</span> that a compliant DNS server use SipHash-2-4 as a
mandatory and default algorithm for DNS Cookies to ensure interoperability
between the DNS Implementations.<a class="pilcrow" href="#section-6-1">¶</a></p>
<p id="section-6-2">The construction method and pseudorandom function used in calculating and
verifying the Server Cookies are determined by the initial version byte and by
the length of the Server Cookie. Additional pseudorandom or construction
algorithms for Server Cookies might be added in the future.<a class="pilcrow" href="#section-6-2">¶</a></p>
</section>
</div>
<div id="ianaConsiderations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-7">7. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-7-1">IANA has created a registry under the "Domain Name System (DNS) Parameters" heading as follows:<a class="pilcrow" href="#section-7-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-7-2">
        <dt id="section-7-2.1">Registry Name:
</dt>
        <dd id="section-7-2.2" style="margin-left: 1.5em">DNS Server Cookie Methods<a class="pilcrow" href="#section-7-2.2">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-7-2.3">Assignment Policy:
</dt>
        <dd id="section-7-2.4" style="margin-left: 1.5em">Expert Review<a class="pilcrow" href="#section-7-2.4">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-7-2.5">Reference:
</dt>
        <dd id="section-7-2.6" style="margin-left: 1.5em">[RFC9018], <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span><a class="pilcrow" href="#section-7-2.6">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-7-2.7">Note:
</dt>
        <dd id="section-7-2.8" style="margin-left: 1.5em">A Server Cookie method (construction and pseudorandom algorithm) is
determined by the Version in the first byte of the cookie and by the cookie
size. Server Cookie size is limited to the inclusive range of 8 to 32 bytes.<a class="pilcrow" href="#section-7-2.8">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<span id="name-dns-server-cookie-methods"></span><table class="center" id="table-1">
        <caption>
<a class="selfRef" href="#table-1">Table 1</a>:
<a class="selfRef" href="#name-dns-server-cookie-methods">DNS Server Cookie Methods</a>
        </caption>
<thead>
          <tr>
            <th class="text-right" colspan="1" rowspan="1">Version</th>
            <th class="text-right" colspan="1" rowspan="1">Size</th>
            <th class="text-left" colspan="1" rowspan="1">Method</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">0</td>
            <td class="text-right" colspan="1" rowspan="1">8-32</td>
            <td class="text-left" colspan="1" rowspan="1">Reserved</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">1</td>
            <td class="text-right" colspan="1" rowspan="1">8-15</td>
            <td class="text-left" colspan="1" rowspan="1">Unassigned</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">1</td>
            <td class="text-right" colspan="1" rowspan="1">16</td>
            <td class="text-left" colspan="1" rowspan="1">SipHash-2-4 [RFC9018] <a class="xref" href="#serverCookie">Section 4</a>
</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">1</td>
            <td class="text-right" colspan="1" rowspan="1">17-32</td>
            <td class="text-left" colspan="1" rowspan="1">Unassigned</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">2-239</td>
            <td class="text-right" colspan="1" rowspan="1">8-32</td>
            <td class="text-left" colspan="1" rowspan="1">Unassigned</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">240-254</td>
            <td class="text-right" colspan="1" rowspan="1">8-32</td>
            <td class="text-left" colspan="1" rowspan="1">Reserved for Private Use</td>
          </tr>
          <tr>
            <td class="text-right" colspan="1" rowspan="1">255</td>
            <td class="text-right" colspan="1" rowspan="1">8-32</td>
            <td class="text-left" colspan="1" rowspan="1">Reserved</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<div id="securityConsiderations">
<section id="section-8">
      <h2 id="name-security-and-privacy-consid">
<a class="section-number selfRef" href="#section-8">8. </a><a class="section-name selfRef" href="#name-security-and-privacy-consid">Security and Privacy Considerations</a>
      </h2>
<p id="section-8-1">DNS Cookies provide limited protection to DNS servers and clients against a
variety of denial-of-service amplification, forgery, or cache-poisoning attacks
by off-path attackers. They provide no protection against on-path adversaries
that can observe the plaintext DNS traffic. An on-path adversary that can
observe a Server Cookie for a client and server interaction can use that
Server Cookie for denial-of-service amplification, forgery, or cache-poisoning
attacks directed at that client for the lifetime of the Server Cookie.<a class="pilcrow" href="#section-8-1">¶</a></p>
<div id="client-cookie-construction">
<section id="section-8.1">
        <h3 id="name-client-cookie-construction">
<a class="section-number selfRef" href="#section-8.1">8.1. </a><a class="section-name selfRef" href="#name-client-cookie-construction">Client Cookie Construction</a>
        </h3>
<p id="section-8.1-1">In <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span>, it was <span class="bcp14">RECOMMENDED</span> to construct a Client Cookie by using a
pseudorandom function of the Client IP address, the Server IP address, and a
secret quantity known only to the client. The Client IP address was included to
ensure that a client could not be tracked if its IP address changes due to
privacy mechanisms or otherwise.<a class="pilcrow" href="#section-8.1-1">¶</a></p>
<p id="section-8.1-2">In this document, we changed Client Cookie construction to be just 64 bits of
entropy newly created for each new upstream server the client connects to.
As a consequence, additional care needs to be taken to prevent tracking of
clients.  To prevent tracking, a new Client Cookie for a server <span class="bcp14">MUST</span> be created
whenever the Client IP address changes.<a class="pilcrow" href="#section-8.1-2">¶</a></p>
<p id="section-8.1-3">Unfortunately, tracking Client IP address changes is impractical with servers
that do not support DNS Cookies. To prevent tracking of clients with non-DNS
Cookie-supporting servers, a client <span class="bcp14">MUST NOT</span> send a previously sent Client
Cookie to a server not known to support DNS Cookies. To prevent the creation of
a new Client Cookie for each query to a non-DNS Cookie-supporting server, it
is <span class="bcp14">RECOMMENDED</span> to not send a Client Cookie to that server for a certain period,
for example five minutes.<a class="pilcrow" href="#section-8.1-3">¶</a></p>
<p id="section-8.1-4">Summarizing:<a class="pilcrow" href="#section-8.1-4">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-5.1">
            <p id="section-8.1-5.1.1">In order to provide minimal authentication, a client <span class="bcp14">MUST</span> use a
different Client Cookie for each different Server IP address.<a class="pilcrow" href="#section-8.1-5.1.1">¶</a></p>
</li>
          <li class="normal" id="section-8.1-5.2">
            <p id="section-8.1-5.2.1">To prevent tracking of clients, a new Client Cookie <span class="bcp14">MUST</span> be created
when the Client IP address changes.<a class="pilcrow" href="#section-8.1-5.2.1">¶</a></p>
</li>
          <li class="normal" id="section-8.1-5.3">
            <p id="section-8.1-5.3.1">To prevent tracking of clients by a non-DNS Cookie-supporting server,
a client <span class="bcp14">MUST NOT</span> send a previously sent Client Cookie to a server in the
absence of an associated Server Cookie.<a class="pilcrow" href="#section-8.1-5.3.1">¶</a></p>
</li>
        </ul>
<p id="section-8.1-6">Note that it is infeasible for a client to detect a change in the public IP
address when the client is behind a routing device performing Network Address
Translation (NAT).  A server may track the public IP address of that routing
device performing the NAT. Preventing tracking of the public IP of a
NAT-performing routing device is beyond the scope of this document.<a class="pilcrow" href="#section-8.1-6">¶</a></p>
</section>
</div>
<div id="server-cookie-construction">
<section id="section-8.2">
        <h3 id="name-server-cookie-construction">
<a class="section-number selfRef" href="#section-8.2">8.2. </a><a class="section-name selfRef" href="#name-server-cookie-construction">Server Cookie Construction</a>
        </h3>
<p id="section-8.2-1"><span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span> did not give a precise recipe for constructing Server Cookies, but
it did recommend usage of a pseudorandom function strong enough to prevent
the guessing of cookies. In this document, SipHash-2-4 is assigned as the
pseudorandom function to be used for version 1 Server Cookies. SipHash-2-4 is
considered sufficiently strong for the immediate future, but predictions about
future development in cryptography and cryptanalysis are beyond the scope of
this document.<a class="pilcrow" href="#section-8.2-1">¶</a></p>
<p id="section-8.2-2">The precise structure of version 1 Server Cookies is defined in this
document.  A portion of the structure is made up of unhashed data elements
that are exposed in cleartext to an on-path observer. These unhashed data
elements are taken along as input to the SipHash-2-4 function of which the
result is the other portion of the Server Cookie, so the unhashed portion of
the Server Cookie cannot be changed by an on-path attacker without also
recalculating the hashed portion for which the Server Secret needs to be
known.<a class="pilcrow" href="#section-8.2-2">¶</a></p>
<p id="section-8.2-3">One of the elements in the unhashed portion of version 1 Server Cookies is
a Timestamp used to prevent Replay Attacks.  Servers verifying version 1
Server Cookies need to have access to a reliable time value, one that cannot
be altered by an attacker, to compare with the Timestamp value. Furthermore,
all servers participating in an anycast set that validate version 1 Server
Cookies need to have their clocks synchronized.<a class="pilcrow" href="#section-8.2-3">¶</a></p>
<p id="section-8.2-4">
For an on-path adversary observing a Server Cookie (as mentioned in the first
paragraph of <a class="xref" href="#securityConsiderations">Section 8</a>), the cleartext Timestamp data element reveals the
lifetime during which the observed Server Cookie can be used to attack the
client.<a class="pilcrow" href="#section-8.2-4">¶</a></p>
<p id="section-8.2-5">In addition to the Security Considerations in this section, the Security
Considerations section of <span>[<a class="xref" href="#RFC7873">RFC7873</a>]</span> still applies.<a class="pilcrow" href="#section-8.2-5">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-9">9. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-9.1">9.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC1982">[RFC1982]</dt>
        <dd>
<span class="refAuthor">Elz, R.</span> and <span class="refAuthor">R. Bush</span>, <span class="refTitle">"Serial Number Arithmetic"</span>, <span class="seriesInfo">RFC 1982</span>, <span class="seriesInfo">DOI 10.17487/RFC1982</span>, <time class="refDate" datetime="1996-08">August 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1982">https://www.rfc-editor.org/info/rfc1982</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3339">[RFC3339]</dt>
        <dd>
<span class="refAuthor">Klyne, G.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"Date and Time on the Internet: Timestamps"</span>, <span class="seriesInfo">RFC 3339</span>, <span class="seriesInfo">DOI 10.17487/RFC3339</span>, <time class="refDate" datetime="2002-07">July 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3339">https://www.rfc-editor.org/info/rfc3339</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7873">[RFC7873]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">M. Andrews</span>, <span class="refTitle">"Domain Name System (DNS) Cookies"</span>, <span class="seriesInfo">RFC 7873</span>, <span class="seriesInfo">DOI 10.17487/RFC7873</span>, <time class="refDate" datetime="2016-05">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7873">https://www.rfc-editor.org/info/rfc7873</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SipHash-2-4">[SipHash-2-4]</dt>
      <dd>
<span class="refAuthor">Aumasson, J.</span> and <span class="refAuthor">D. J. Bernstein</span>, <span class="refTitle">"SipHash: A Fast Short-Input PRF"</span>, <span class="refContent">Progress in Cryptology - INDOCRYPT 2012</span>, <span class="refContent">Lecture Notes in Computer Science, vol. 7668</span>, <time class="refDate" datetime="2012-12">December 2012</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-34931-7_28">https://doi.org/10.1007/978-3-642-34931-7_28</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-9.2">9.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC8981">[RFC8981]</dt>
      <dd>
<span class="refAuthor">Gont, F.</span>, <span class="refAuthor">Krishnan, S.</span>, <span class="refAuthor">Narten, T.</span>, and <span class="refAuthor">R. Draves</span>, <span class="refTitle">"Temporary Address Extensions for Stateless Address Autoconfiguration in IPv6"</span>, <span class="seriesInfo">RFC 8981</span>, <span class="seriesInfo">DOI 10.17487/RFC8981</span>, <time class="refDate" datetime="2021-02">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8981">https://www.rfc-editor.org/info/rfc8981</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="testVectors">
<section id="section-appendix.a">
      <h2 id="name-test-vectors">
<a class="section-number selfRef" href="#section-appendix.a">Appendix A. </a><a class="section-name selfRef" href="#name-test-vectors">Test Vectors</a>
      </h2>
<div id="learning-a-new-server-cookie">
<section id="section-a.1">
        <h2 id="name-learning-a-new-server-cooki">
<a class="section-number selfRef" href="#section-a.1">A.1. </a><a class="section-name selfRef" href="#name-learning-a-new-server-cooki">Learning a New Server Cookie</a>
        </h2>
<p id="section-a.1-1">A resolver (client) sending from IPv4 address 198.51.100.100 sends a query for
<code>example.com</code> to an authoritative server listening on 192.0.2.53 from
which it has not yet learned the server cookie.<a class="pilcrow" href="#section-a.1-1">¶</a></p>
<p id="section-a.1-2">The DNS requests and replies shown in this appendix are in a "dig"-like format.
The content of the DNS COOKIE Option is shown in hexadecimal format after
<code>; COOKIE:</code>.<a class="pilcrow" href="#section-a.1-2">¶</a></p>
<div id="section-a.1-3">
<pre class="sourcecode">;; Sending:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 57406
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957
;; QUESTION SECTION:
;example.com.                IN      A

;; QUERY SIZE: 52
</pre><a class="pilcrow" href="#section-a.1-3">¶</a>
</div>
<p id="section-a.1-4">The authoritative nameserver (server) is configured with the following secret:
e5e973e5a6b2a43f48e7dc849e37bfcf (as hex data).<a class="pilcrow" href="#section-a.1-4">¶</a></p>
<p id="section-a.1-5">It receives the query on Wed Jun  5 10:53:05 UTC 2019.<a class="pilcrow" href="#section-a.1-5">¶</a></p>
<p id="section-a.1-6">The content of the DNS COOKIE Option that the server will return is shown
below in hexadecimal format after <code>; COOKIE:</code>.<a class="pilcrow" href="#section-a.1-6">¶</a></p>
<p id="section-a.1-7">The Timestamp field <a class="xref" href="#timestampField">Section 4.3</a> in the returned Server Cookie has value
1559731985. In the format described in <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, this is 2019-06-05 10:53:05+00:00.<a class="pilcrow" href="#section-a.1-7">¶</a></p>
<div id="section-a.1-8">
<pre class="sourcecode">;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 57406
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf79f111f8130c3eee29480 (good)
;; QUESTION SECTION:
;example.com.                IN      A

;; ANSWER SECTION:
example.com.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 10:53:05 UTC 2019
;; MSD SIZE  rcvd: 84
</pre><a class="pilcrow" href="#section-a.1-8">¶</a>
</div>
</section>
</div>
<div id="the-same-client-learning-a-renewed-fresh-server-cookie">
<section id="section-a.2">
        <h2 id="name-the-same-client-learning-a-">
<a class="section-number selfRef" href="#section-a.2">A.2. </a><a class="section-name selfRef" href="#name-the-same-client-learning-a-">The Same Client Learning a Renewed (Fresh) Server Cookie</a>
        </h2>
<p id="section-a.2-1">40 minutes later, the same resolver (client) queries the same server for
<code>example.org</code>. It reuses the Server Cookie it learned in the previous
query.<a class="pilcrow" href="#section-a.2-1">¶</a></p>
<p id="section-a.2-2">The Timestamp field in that previously learned Server Cookie, which is now sent
along in the request, was and is 1559731985. In the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, this is
2019-06-05 10:53:05+00:00.<a class="pilcrow" href="#section-a.2-2">¶</a></p>
<div id="section-a.2-3">
<pre class="sourcecode">;; Sending:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 50939
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf79f111f8130c3eee29480
;; QUESTION SECTION:
;example.org.                IN      A

;; QUERY SIZE: 52
</pre><a class="pilcrow" href="#section-a.2-3">¶</a>
</div>
<p id="section-a.2-4">The authoritative nameserver (server) now generates a new Server Cookie.
The server <span class="bcp14">SHOULD</span> do this because it can see the Server Cookie
sent by the client is older than half an hour (<a class="xref" href="#timestampField">Section 4.3</a>), but it is also fine for a server to generate
a new Server Cookie sooner or even for every answer.<a class="pilcrow" href="#section-a.2-4">¶</a></p>
<p id="section-a.2-5">The Timestamp field in the returned new Server Cookie has value 1559734385,
which, in the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, is 2019-06-05 11:33:05+00:00.<a class="pilcrow" href="#section-a.2-5">¶</a></p>
<div id="section-a.2-6">
<pre class="sourcecode">;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 50939
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf7a871d4a564a1442aca77 (good)
;; QUESTION SECTION:
;example.org.                IN      A

;; ANSWER SECTION:
example.org.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 11:33:05 UTC 2019
;; MSD SIZE  rcvd: 84
</pre><a class="pilcrow" href="#section-a.2-6">¶</a>
</div>
</section>
</div>
<div id="another-client-learning-a-renewed-server-cookie">
<section id="section-a.3">
        <h2 id="name-another-client-learning-a-r">
<a class="section-number selfRef" href="#section-a.3">A.3. </a><a class="section-name selfRef" href="#name-another-client-learning-a-r">Another Client Learning a Renewed Server Cookie</a>
        </h2>
<p id="section-a.3-1">Another resolver (client) with IPv4 address 203.0.113.203 sends a request to
the same server with a valid Server Cookie that it learned before
(on Wed Jun  5 09:46:25 UTC 2019).<a class="pilcrow" href="#section-a.3-1">¶</a></p>
<p id="section-a.3-2">The Timestamp field of the Server Cookie in the request has value 1559727985,
which, in the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, is 2019-06-05 09:46:25+00:00.<a class="pilcrow" href="#section-a.3-2">¶</a></p>
<p id="section-a.3-3">Note that the Server Cookie has Reserved bytes set but is still valid with the
configured secret; the Hash part is calculated taking along the Reserved bytes.<a class="pilcrow" href="#section-a.3-3">¶</a></p>
<div id="section-a.3-4">
<pre class="sourcecode">;; Sending:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34736
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: fc93fc62807ddb8601abcdef5cf78f71a314227b6679ebf5
;; QUESTION SECTION:
;example.com.                IN      A

;; QUERY SIZE: 52
</pre><a class="pilcrow" href="#section-a.3-4">¶</a>
</div>
<p id="section-a.3-5">The authoritative nameserver (server) replies with a freshly generated Server
Cookie for this client conformant with this specification, i.e., with the Reserved
bits set to zero.<a class="pilcrow" href="#section-a.3-5">¶</a></p>
<p id="section-a.3-6">The Timestamp field in the returned new Server Cookie has value 1559734700,
which, in the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, is 2019-06-05 11:38:20+00:00.<a class="pilcrow" href="#section-a.3-6">¶</a></p>
<div id="section-a.3-7">
<pre class="sourcecode">;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34736
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: fc93fc62807ddb86010000005cf7a9acf73a7810aca2381e (good)
;; QUESTION SECTION:
;example.com.                IN      A

;; ANSWER SECTION:
example.com.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 11:38:20 UTC 2019
;; MSD SIZE  rcvd: 84
</pre><a class="pilcrow" href="#section-a.3-7">¶</a>
</div>
</section>
</div>
<div id="ipv6-query-with-rolled-over-secret">
<section id="section-a.4">
        <h2 id="name-ipv6-query-with-rolled-over">
<a class="section-number selfRef" href="#section-a.4">A.4. </a><a class="section-name selfRef" href="#name-ipv6-query-with-rolled-over">IPv6 Query with Rolled Over Secret</a>
        </h2>
<p id="section-a.4-1">The query below is from a client with IPv6 address 2001:db8:220:1:59de:d0f4:8769:82b8 to a server
with IPv6 address 2001:db8:8f::53.  The client has learned a valid Server Cookie
before (on Wed Jun  5 13:36:57 UTC 2019) when the Server had the secret:
dd3bdf9344b678b185a6f5cb60fca715.  The server now uses a new secret, but it can still validate
the Server Cookie provided by the client as the old secret has not expired yet.<a class="pilcrow" href="#section-a.4-1">¶</a></p>
<p id="section-a.4-2">The Timestamp field in the Server Cookie in the request has value
1559741817, which, in the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, is 2019-06-05 13:36:57+00:00.<a class="pilcrow" href="#section-a.4-2">¶</a></p>
<div id="section-a.4-3">
<pre class="sourcecode">;; Sending:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6774
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 22681ab97d52c298010000005cf7c57926556bd0934c72f8
;; QUESTION SECTION:
;example.net.                IN      A

;; QUERY SIZE: 52
</pre><a class="pilcrow" href="#section-a.4-3">¶</a>
</div>
<p id="section-a.4-4">The authoritative nameserver (server) replies with a freshly generated server
cookie for this client with its new secret: 445536bcd2513298075a5d379663c962.<a class="pilcrow" href="#section-a.4-4">¶</a></p>
<p id="section-a.4-5">The Timestamp field in the returned new Server Cookie has value 1559741961,
which, in the format of <span>[<a class="xref" href="#RFC3339">RFC3339</a>]</span>, is
2019-06-05 13:39:21+00:00.<a class="pilcrow" href="#section-a.4-5">¶</a></p>
<div id="section-a.4-6">
<pre class="sourcecode">;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6774
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 22681ab97d52c298010000005cf7c609a6bb79d16625507a (good)
;; QUESTION SECTION:
;example.net.                IN      A

;; ANSWER SECTION:
example.net.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 2001:db8:8f::53#53(2001:db8:8f::53)
;; WHEN: Wed Jun  5 13:36:57 UTC 2019
;; MSD SIZE  rcvd: 84
</pre><a class="pilcrow" href="#section-a.4-6">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="implementation-status">
<section id="section-appendix.b">
      <h2 id="name-implementation-status">
<a class="section-number selfRef" href="#section-appendix.b">Appendix B. </a><a class="section-name selfRef" href="#name-implementation-status">Implementation Status</a>
      </h2>
<p id="section-appendix.b-1">At the time of writing, BIND from version 9.16 and Knot DNS from version 2.9.0
create Server Cookies according to the recipe described in this document. Unbound
and NSD have a Proof-of-Concept implementation that has been tested for
interoperability during the hackathon at IETF 104 in Prague.  Construction
of privacy maintaining Client Cookies according to the directions in this document
have been implemented in the getdns library and will be in the upcoming
getdns-1.6.1 release and in Stubby version 0.3.1.<a class="pilcrow" href="#section-appendix.b-1">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-appendix.c">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="section-appendix.c-1">Thanks to <span class="contact-name">Witold Krecicki</span> and <span class="contact-name">Pieter Lexis</span> for valuable input, suggestions, text, and above
all for implementing a prototype of an interoperable DNS Cookie in Bind9, Knot,
and PowerDNS during the hackathon at IETF 104 in Prague.  Thanks for valuable
input and suggestions go to <span class="contact-name">Ralph Dolmans</span>, <span class="contact-name">Bob Harold</span>, <span class="contact-name">Daniel Salzman</span>, <span class="contact-name">Martin Hoffmann</span>, <span class="contact-name">Mukund Sivaraman</span>, <span class="contact-name">Petr Spacek</span>, <span class="contact-name">Loganaden Velvindron</span>, <span class="contact-name">Bob Harold</span>, <span class="contact-name">Philip Homburg</span>, <span class="contact-name">Tim Wicinski</span>, and <span class="contact-name">Brian Dickson</span>.<a class="pilcrow" href="#section-appendix.c-1">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Ondrej Sury</span></div>
<div class="left" dir="auto"><span class="org">Internet Systems Consortium</span></div>
<div class="left" dir="auto"><span class="country-name">Czechia</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:ondrej@isc.org">ondrej@isc.org</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Willem Toorop</span></div>
<div class="left" dir="auto"><span class="org">NLnet Labs</span></div>
<div class="left" dir="auto"><span class="street-address">Science Park 400</span></div>
<div class="left" dir="auto">
<span class="postal-code">1098 XH</span> <span class="locality">Amsterdam</span>
</div>
<div class="left" dir="auto"><span class="country-name">Netherlands</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:willem@nlnetlabs.nl">willem@nlnetlabs.nl</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Donald E. Eastlake 3rd</span></div>
<div class="left" dir="auto"><span class="org">Futurewei Technologies</span></div>
<div class="left" dir="auto"><span class="street-address">2386 Panoramic Circle</span></div>
<div class="left" dir="auto">
<span class="locality">Apopka</span>,  <span class="postal-code">FL 32703</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+1-508-333-2270">+1-508-333-2270</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:d3e3e3@gmail.com">d3e3e3@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Mark Andrews</span></div>
<div class="left" dir="auto"><span class="org">Internet Systems Consortium</span></div>
<div class="left" dir="auto"><span class="street-address">950 Charter Street</span></div>
<div class="left" dir="auto">
<span class="locality">Redwood City</span>,  <span class="postal-code">CA 94063</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:marka@isc.org">marka@isc.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>