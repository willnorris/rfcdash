<!DOCTYPE html>
<html class="RFC" lang="en"><head>
<meta charset="utf-8"/>
<meta content="Common,Latin" name="scripts"/>
<meta content="initial-scale=1.0" name="viewport"/>
<title>RFC 9561: Using the Parallel NFS (pNFS) SCSI Layout to Access Non-Volatile Memory Express (NVMe) Storage Devices</title>
<meta content="Christoph Hellwig" name="author"/>
<meta content="Charles Lever" name="author"/>
<meta content="Sorin Faibish" name="author"/>
<meta content="David L. Black" name="author"/>
<meta content="
       This document specifies how to use the Parallel Network File System (pNFS)
Small Computer System Interface (SCSI) Layout Type to access storage devices
using the Non-Volatile Memory Express (NVMe) protocol family. 
    " name="description"/>
<meta content="xml2rfc 3.20.1" name="generator"/>
<meta content="NFSv4" name="keyword"/>
<meta content="9561" name="rfc.number"/>
<!-- Generator version information:
  xml2rfc 3.20.1
    Python 3.9.15
    ConfigArgParse 1.5.3
    google-i18n-address 3.0.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.0
    platformdirs 3.8.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.0
    setuptools 44.1.1
    six 1.16.0
    wcwidth 0.2.5
    weasyprint 56.1
-->
<link href="rfc9561.xml" rel="alternate" type="application/rfc+xml"/>
<link href="#copyright" rel="license"/>
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css"/>
<link href="https://datatracker.ietf.org/doc/draft-ietf-nfsv4-scsi-layout-nvme-07" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9561" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  </head>
<body class="xml2rfc">
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 9561</td>
<td class="center">pNFS SCSI Layout for NVMe</td>
<td class="right">April 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hellwig, et al.</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information" id="external-metadata"></div>
<div class="document-information" id="internal-metadata">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a class="eref" href="https://www.rfc-editor.org/rfc/rfc9561">9561</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time class="published" datetime="2024-04">April 2024</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Hellwig, <span class="editor">Ed.</span>
</div>
</div>
<div class="author">
      <div class="author-name">C. Lever</div>
<div class="org">Oracle</div>
</div>
<div class="author">
      <div class="author-name">S. Faibish</div>
<div class="org">Opendrives.com</div>
</div>
<div class="author">
      <div class="author-name">D. Black</div>
<div class="org">Dell Technologies</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 9561</h1>
<h1 id="title">Using the Parallel NFS (pNFS) SCSI Layout to Access Non-Volatile Memory Express (NVMe) Storage Devices</h1>
<section id="section-abstract">
      <h2 id="abstract"><a class="selfRef" href="#abstract">Abstract</a></h2>
<p id="section-abstract-1">This document specifies how to use the Parallel Network File System (pNFS)
Small Computer System Interface (SCSI) Layout Type to access storage devices
using the Non-Volatile Memory Express (NVMe) protocol family.<a class="pilcrow" href="#section-abstract-1">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a class="section-name selfRef" href="#name-status-of-this-memo">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a class="pilcrow" href="#section-boilerplate.1-1">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a class="pilcrow" href="#section-boilerplate.1-2">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc9561">https://www.rfc-editor.org/info/rfc9561</a></span>.<a class="pilcrow" href="#section-boilerplate.1-3">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a class="section-name selfRef" href="#name-copyright-notice">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a class="pilcrow" href="#section-boilerplate.2-1">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a class="pilcrow" href="#section-boilerplate.2-2">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a class="toplink" href="#" onclick="scroll(0,0)">▲</a><h2 id="name-table-of-contents">
<a class="section-name selfRef" href="#name-table-of-contents">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a class="auto internal xref" href="#section-1">1</a>.  <a class="internal xref" href="#name-introduction">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p class="keepWithNext" id="section-toc.1-1.1.2.1.1"><a class="auto internal xref" href="#section-1.1">1.1</a>.  <a class="internal xref" href="#name-requirements-language">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p class="keepWithNext" id="section-toc.1-1.1.2.2.1"><a class="auto internal xref" href="#section-1.2">1.2</a>.  <a class="internal xref" href="#name-general-definitions">General Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p class="keepWithNext" id="section-toc.1-1.1.2.3.1"><a class="auto internal xref" href="#section-1.3">1.3</a>.  <a class="internal xref" href="#name-numerical-conventions">Numerical Conventions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a class="auto internal xref" href="#section-2">2</a>.  <a class="internal xref" href="#name-scsi-layout-mapping-to-nvme">SCSI Layout Mapping to NVMe</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a class="auto internal xref" href="#section-2.1">2.1</a>.  <a class="internal xref" href="#name-volume-identification">Volume Identification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a class="auto internal xref" href="#section-2.2">2.2</a>.  <a class="internal xref" href="#name-client-fencing">Client Fencing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a class="auto internal xref" href="#section-2.2.1">2.2.1</a>.  <a class="internal xref" href="#name-prs-key-registration">PRs - Key Registration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a class="auto internal xref" href="#section-2.2.2">2.2.2</a>.  <a class="internal xref" href="#name-prs-mds-registration-and-re">PRs - MDS Registration and Reservation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a class="auto internal xref" href="#section-2.2.3">2.2.3</a>.  <a class="internal xref" href="#name-fencing-action">Fencing Action</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a class="auto internal xref" href="#section-2.2.4">2.2.4</a>.  <a class="internal xref" href="#name-client-recovery-after-a-fen">Client Recovery after a Fence Action</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a class="auto internal xref" href="#section-2.3">2.3</a>.  <a class="internal xref" href="#name-volatile-write-caches">Volatile Write Caches</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a class="auto internal xref" href="#section-3">3</a>.  <a class="internal xref" href="#name-security-considerations">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a class="auto internal xref" href="#section-4">4</a>.  <a class="internal xref" href="#name-iana-considerations">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a class="auto internal xref" href="#section-5">5</a>.  <a class="internal xref" href="#name-references">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a class="auto internal xref" href="#section-5.1">5.1</a>.  <a class="internal xref" href="#name-normative-references">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a class="auto internal xref" href="#section-5.2">5.2</a>.  <a class="internal xref" href="#name-informative-references">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a class="auto internal xref" href="#appendix-A"></a><a class="internal xref" href="#name-acknowledgements">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a class="auto internal xref" href="#appendix-B"></a><a class="internal xref" href="#name-authors-addresses">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sec_intro">
<section id="section-1">
      <h2 id="name-introduction">
<a class="section-number selfRef" href="#section-1">1. </a><a class="section-name selfRef" href="#name-introduction">Introduction</a>
      </h2>
<p id="section-1-1">NFSv4.1 <span>[<a class="cite xref" href="#RFC8881">RFC8881</a>]</span> includes a pNFS feature that allows
reads and writes to be performed by means other than directing read and
write operations to the server.  Through use of this feature, the server,
in the role of metadata server, is responsible for managing file and
directory metadata while separate means are provided to execute 
reads and writes.<a class="pilcrow" href="#section-1-1">¶</a></p>
<p id="section-1-2">These other means of performing file reads and writes are defined by
individual mapping types, which often have their own specifications.<a class="pilcrow" href="#section-1-2">¶</a></p>
<p id="section-1-3">The pNFS Small Computer System Interface (SCSI) layout <span>[<a class="cite xref" href="#RFC8154">RFC8154</a>]</span> is a layout
type that allows NFS clients to directly perform I⁠/⁠O to block storage devices
while bypassing the Metadata Server (MDS).  It is specified by using
concepts from the SCSI protocol family for the data path to the storage devices.<a class="pilcrow" href="#section-1-3">¶</a></p>
<p id="section-1-4">NVM Express (NVMe), or the Non-Volatile Memory Host Controller Interface
Specification, is a set of specifications to talk to storage devices over
a number of protocols such as PCI Express (PCIe), Fibre Channel (FC),
TCP/IP, or Remote Direct Memory Access (RDMA) networking.  NVMe is currently
the predominantly used protocol to access PCIe Solid State Disks (SSDs),
and it is increasingly being adopted for remote storage access to replace
SCSI-based protocols such as iSCSI.<a class="pilcrow" href="#section-1-4">¶</a></p>
<p id="section-1-5">This document defines how NVMe Namespaces using the NVM Command Set <span>[<a class="cite xref" href="#NVME-NVM">NVME-NVM</a>]</span>
exported by NVMe Controllers implementing the
NVMe Base specification <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span> are to be used as
storage devices using the SCSI Layout Type.
The definition is independent of the underlying transport used by the
NVMe Controller and thus supports Controllers implementing a wide variety
of transports, including PCIe, RDMA, TCP, and FC.<a class="pilcrow" href="#section-1-5">¶</a></p>
<p id="section-1-6">This document does not amend the existing SCSI layout document.  Rather,
it
defines how NVMe Namespaces can be used within the SCSI Layout by
establishing a mapping of the SCSI constructs used in the SCSI layout
document to corresponding NVMe constructs.<a class="pilcrow" href="#section-1-6">¶</a></p>
<div id="ssc_intro_reqlang">
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a class="section-number selfRef" href="#section-1.1">1.1. </a><a class="section-name selfRef" href="#name-requirements-language">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a class="cite xref" href="#RFC2119">RFC2119</a>]</span> <span>[<a class="cite xref" href="#RFC8174">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a class="pilcrow" href="#section-1.1-1">¶</a></p>
</section>
</div>
<div id="ssc_intro_defs">
<section id="section-1.2">
        <h3 id="name-general-definitions">
<a class="section-number selfRef" href="#section-1.2">1.2. </a><a class="section-name selfRef" href="#name-general-definitions">General Definitions</a>
        </h3>
<p id="section-1.2-1">The following definitions are included to provide context for the reader.<a class="pilcrow" href="#section-1.2-1">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.2-2">
          <dt id="section-1.2-2.1">Client:</dt>
          <dd id="section-1.2-2.2" style="margin-left: 1.5em">
            <p id="section-1.2-2.2.1">The "client" is the entity that accesses the NFS server's
resources.  The client may be an application that contains the
logic to access the NFS server directly, or it may be part of the operating
system that provides remote file system services for a set of
applications.<a class="pilcrow" href="#section-1.2-2.2.1">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.3">Metadata Server (MDS):</dt>
          <dd id="section-1.2-2.4" style="margin-left: 1.5em">
            <p id="section-1.2-2.4.1">The Metadata Server (MDS) is the entity responsible for coordinating
client access to a set of file systems and is identified by a server
owner.<a class="pilcrow" href="#section-1.2-2.4.1">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="ssc_intro_conv">
<section id="section-1.3">
        <h3 id="name-numerical-conventions">
<a class="section-number selfRef" href="#section-1.3">1.3. </a><a class="section-name selfRef" href="#name-numerical-conventions">Numerical Conventions</a>
        </h3>
<p id="section-1.3-1">Numerical values defined in the SCSI specifications (e.g., <span>[<a class="cite xref" href="#SPC5">SPC5</a>]</span>) and the
NVMe specifications (e.g., <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>) are represented using the same
conventions as those specifications wherein a 'b' suffix denotes a binary
(base 2) number (e.g., 110b = 6 decimal) and an 'h' suffix denotes a
hexadecimal (base 16) number (e.g., 1ch = 28 decimal).<a class="pilcrow" href="#section-1.3-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec_slm">
<section id="section-2">
      <h2 id="name-scsi-layout-mapping-to-nvme">
<a class="section-number selfRef" href="#section-2">2. </a><a class="section-name selfRef" href="#name-scsi-layout-mapping-to-nvme">SCSI Layout Mapping to NVMe</a>
      </h2>
<p id="section-2-1">The SCSI layout definition <span>[<a class="cite xref" href="#RFC8154">RFC8154</a>]</span> references only a
few SCSI-specific concepts directly.  This document provides a mapping
from these SCSI concepts to NVM Express concepts that are used
when using the pNFS SCSI layout with NVMe namespaces.<a class="pilcrow" href="#section-2-1">¶</a></p>
<div id="ssc_volident">
<section id="section-2.1">
        <h3 id="name-volume-identification">
<a class="section-number selfRef" href="#section-2.1">2.1. </a><a class="section-name selfRef" href="#name-volume-identification">Volume Identification</a>
        </h3>
<p id="section-2.1-1">The pNFS SCSI layout uses the Device Identification Vital Product Data (VPD)
page (page code 83h) from <span>[<a class="cite xref" href="#SPC5">SPC5</a>]</span> to identify the devices used by
a layout. Implementations that use NVMe namespaces as storage devices
map NVMe namespace identifiers to a subset of the identifiers
that the Device Identification VPD page supports for SCSI logical
units.<a class="pilcrow" href="#section-2.1-1">¶</a></p>
<p id="section-2.1-2">To be used as storage devices for the pNFS SCSI layout, NVMe namespaces
<span class="bcp14">MUST</span> support either the IEEE Extended Unique Identifier (EUI64) or
Namespace Globally Unique Identifier (NGUID) value reported in a Namespace
Identification Descriptor, the I⁠/⁠O Command Set Independent Identify
Namespace data structure, and the Identify Namespace data structure,
NVM Command Set <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>. If available, use of the NGUID value is
preferred as it is the larger identifier.<a class="pilcrow" href="#section-2.1-2">¶</a></p>
<aside id="section-2.1-3">
          <p id="section-2.1-3.1">Note: The PS_DESIGNATOR_T10 and PS_DESIGNATOR_NAME have no equivalent
in NVMe and cannot be used to identify NVMe storage devices.<a class="pilcrow" href="#section-2.1-3.1">¶</a></p>
</aside>
<p id="section-2.1-4">The pnfs_scsi_base_volume_info4 structure for an NVMe namespace
<span class="bcp14">SHALL</span> be constructed as follows:<a class="pilcrow" href="#section-2.1-4">¶</a></p>
<ol class="normal type-1" id="section-2.1-5" start="1" type="1">
<li id="section-2.1-5.1">
            <p id="section-2.1-5.1.1">The "sbv_code_set" field <span class="bcp14">SHALL</span> be set to PS_CODE_SET_BINARY.<a class="pilcrow" href="#section-2.1-5.1.1">¶</a></p>
</li>
          <li id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">The "pnfs_scsi_designator_type" field <span class="bcp14">SHALL</span> be set to
  PS_DESIGNATOR_EUI64.<a class="pilcrow" href="#section-2.1-5.2.1">¶</a></p>
</li>
          <li id="section-2.1-5.3">
            <p id="section-2.1-5.3.1">The "sbv_designator" field <span class="bcp14">SHALL</span> contain either the NGUID or
  the EUI64 identifier for the namespace.  If both NGUID and EUI64
  identifiers are available, then the NGUID identifier <span class="bcp14">SHOULD</span> be
  used as it is the larger identifier.<a class="pilcrow" href="#section-2.1-5.3.1">¶</a></p>
</li>
        </ol>
<p id="section-2.1-6">RFC 8154 <span>[<a class="cite xref" href="#RFC8154">RFC8154</a>]</span> specifies the "sbv_designator" field as an XDR variable
length opaque&lt;&gt; (refer to Section <a class="relref" href="https://rfc-editor.org/rfc/rfc4506#section-4.10">4.10</a> of RFC 4506 <span>[<a class="cite xref" href="#RFC4506">RFC4506</a>]</span>). The length of that XDR opaque&lt;&gt; value (part of
its XDR representation) indicates which NVMe identifier is present.
That length <span class="bcp14">MUST</span> be 16 octets for an NVMe NGUID identifier and
<span class="bcp14">MUST</span> be 8 octets for an NVMe EUI64 identifier.  All other lengths
<span class="bcp14">MUST NOT</span> be used with an NVMe namespace.<a class="pilcrow" href="#section-2.1-6">¶</a></p>
</section>
</div>
<div id="ssc_fencing">
<section id="section-2.2">
        <h3 id="name-client-fencing">
<a class="section-number selfRef" href="#section-2.2">2.2. </a><a class="section-name selfRef" href="#name-client-fencing">Client Fencing</a>
        </h3>
<p id="section-2.2-1">The SCSI layout uses Persistent Reservations (PRs) to provide client
fencing.  For this to be achieved, both the MDS and the Clients have to
register a key with the storage device, and the MDS has to create a
reservation on the storage device.<a class="pilcrow" href="#section-2.2-1">¶</a></p>
<p id="section-2.2-2">The following subsections provide a full mapping of the required
PERSISTENT RESERVE IN and PERSISTENT RESERVE OUT SCSI commands <span>[<a class="cite xref" href="#SPC5">SPC5</a>]</span>
to NVMe commands that <span class="bcp14">MUST</span> be used when using
NVMe namespaces as storage devices for the pNFS SCSI layout.<a class="pilcrow" href="#section-2.2-2">¶</a></p>
<div id="ssc_fencing_keys">
<section id="section-2.2.1">
          <h4 id="name-prs-key-registration">
<a class="section-number selfRef" href="#section-2.2.1">2.2.1. </a><a class="section-name selfRef" href="#name-prs-key-registration">PRs - Key Registration</a>
          </h4>
<p id="section-2.2.1-1">On NVMe namespaces, reservation keys are registered using the
Reservation Register command (refer to Section 7.3 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>)
with the Reservation Register Action
(RREGA) field set to 000b (i.e., Register Reservation Key) and
supplying the reservation key in the New Reservation Key (NRKEY)
field.<a class="pilcrow" href="#section-2.2.1-1">¶</a></p>
<p id="section-2.2.1-2">Reservation keys are unregistered using the Reservation Register
command with the Reservation Register Action (RREGA) field set to
001b (i.e., Unregister Reservation Key) and supplying the reservation
key in the Current Reservation Key (CRKEY) field.<a class="pilcrow" href="#section-2.2.1-2">¶</a></p>
<p id="section-2.2.1-3">One important difference between SCSI Persistent Reservations
and NVMe Reservations is that NVMe reservation keys always apply
to all controllers used by a host (as indicated by the NVMe Host
Identifier). This behavior is analogous to setting the ALL_TG_PT
bit when registering a SCSI Reservation Key, and it is always supported
by NVMe Reservations, unlike the ALL_TG_PT for which SCSI support is
inconsistent and cannot be relied upon.
Registering a reservation key with a namespace creates an
association between a host and a namespace. A host that is a
registrant of a namespace may use any controller with which that
host is associated (i.e., that has the same Host Identifier,
refer to Section 5.27.1.25 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>)
to access that namespace as a registrant.<a class="pilcrow" href="#section-2.2.1-3">¶</a></p>
</section>
</div>
<div id="ssc_fencing_reg">
<section id="section-2.2.2">
          <h4 id="name-prs-mds-registration-and-re">
<a class="section-number selfRef" href="#section-2.2.2">2.2.2. </a><a class="section-name selfRef" href="#name-prs-mds-registration-and-re">PRs - MDS Registration and Reservation</a>
          </h4>
<p id="section-2.2.2-1">Before returning a PNFS_SCSI_VOLUME_BASE volume to the client, the MDS
needs to prepare the volume for fencing using PRs. This is done by
registering the reservation generated for the MDS with the device
(see <a class="auto internal xref" href="#ssc_fencing_keys">Section 2.2.1</a>) followed by a Reservation Acquire
command (refer to Section 7.2 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>) with
the Reservation Acquire Action (RACQA) field set to 000b (i.e., Acquire)
and the Reservation Type (RTYPE) field set to 4h (i.e., Exclusive Access
- Registrants Only Reservation).<a class="pilcrow" href="#section-2.2.2-1">¶</a></p>
</section>
</div>
<div id="ssc_fenceaction">
<section id="section-2.2.3">
          <h4 id="name-fencing-action">
<a class="section-number selfRef" href="#section-2.2.3">2.2.3. </a><a class="section-name selfRef" href="#name-fencing-action">Fencing Action</a>
          </h4>
<p id="section-2.2.3-1">In case of a non-responding client, the MDS fences the client by
executing a Reservation Acquire command (refer to Section 7.2 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>),
with the Reservation Acquire Action
(RACQA) field set to 001b (i.e., Preempt) or 010b (i.e., Preempt and
Abort), the Current Reservation Key (CRKEY) field set to the
server's reservation key, the Preempt Reservation Key (PRKEY) field
set to the reservation key associated with the non-responding client,
and the Reservation Type (RTYPE) field set to 4h (i.e., Exclusive
Access - Registrants Only Reservation).
The client can distinguish I⁠/⁠O errors due to fencing from other
errors based on the Reservation Conflict NVMe status code.<a class="pilcrow" href="#section-2.2.3-1">¶</a></p>
</section>
</div>
<div id="ssc_recovery">
<section id="section-2.2.4">
          <h4 id="name-client-recovery-after-a-fen">
<a class="section-number selfRef" href="#section-2.2.4">2.2.4. </a><a class="section-name selfRef" href="#name-client-recovery-after-a-fen">Client Recovery after a Fence Action</a>
          </h4>
<p id="section-2.2.4-1">If an NVMe command issued by the client to the storage device returns
a non-retryable error (refer to the DNR bit defined in Figure 92 in
<span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>), the client <span class="bcp14">MUST</span> commit all layouts that
use the storage device through the MDS, return all outstanding layouts
for the device, forget the device ID, and unregister the reservation
key.<a class="pilcrow" href="#section-2.2.4-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssc_caches">
<section id="section-2.3">
        <h3 id="name-volatile-write-caches">
<a class="section-number selfRef" href="#section-2.3">2.3. </a><a class="section-name selfRef" href="#name-volatile-write-caches">Volatile Write Caches</a>
        </h3>
<p id="section-2.3-1">For NVMe controllers, a volatile write cache is enabled if bit 0 of the
Volatile Write Cache (VWC) field in the Identify Controller data
structure, I⁠/⁠O Command Set Independent (refer to Figure 275 in <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>)
is set and the Volatile Write Cache Enable (WCE) bit (i.e., bit 00) in
the Volatile Write Cache Feature (Feature Identifier 06h)
(refer to Section 5.27.1.4 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>) is set.
If a volatile write cache is enabled on an NVMe namespace used as a
storage device for the pNFS SCSI layout, the pNFS server (MDS) <span class="bcp14">MUST</span>
use the NVMe Flush command to flush the volatile write cache to
stable storage before the LAYOUTCOMMIT operation returns by using the
Flush command (refer to Section 7.1 of <span>[<a class="cite xref" href="#NVME-BASE">NVME-BASE</a>]</span>).
The NVMe Flush command is the equivalent to the SCSI SYNCHRONIZE
CACHE commands.<a class="pilcrow" href="#section-2.3-1">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec_security">
<section id="section-3">
      <h2 id="name-security-considerations">
<a class="section-number selfRef" href="#section-3">3. </a><a class="section-name selfRef" href="#name-security-considerations">Security Considerations</a>
      </h2>
<p id="section-3-1">NFSv4 clients access NFSv4 metadata servers using the NFSv4
protocol. The security considerations generally described in <span>[<a class="cite xref" href="#RFC8881">RFC8881</a>]</span>
apply to a client's interactions with
the metadata server. However, NFSv4 clients and servers access
NVMe storage devices at a lower layer than NFSv4. NFSv4 and
RPC security are not directly applicable to the I⁠/⁠Os to data servers
using NVMe.
Refer to Sections <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8154#section-2.4.6">2.4.6</a> (<a class="relref" href="https://rfc-editor.org/rfc/rfc8154#section-2.4.6">Extents Are Permissions</a>)</span> and <span><a class="relref" href="https://rfc-editor.org/rfc/rfc8154#section-4">4</a> (<a class="relref" href="https://rfc-editor.org/rfc/rfc8154#section-4">Security Considerations</a>)</span> of <span>[<a class="cite xref" href="#RFC8154">RFC8154</a>]</span> for the
security considerations of direct access to block storage from NFS clients.<a class="pilcrow" href="#section-3-1">¶</a></p>
<p id="section-3-2">pNFS with an NVMe layout can be used with NVMe transports (e.g., NVMe
over PCIe <span>[<a class="cite xref" href="#NVME-PCIE">NVME-PCIE</a>]</span>) that provide essentially no additional security
functionality. Or, pNFS may be used with storage protocols such as NVMe
over TCP <span>[<a class="cite xref" href="#NVME-TCP">NVME-TCP</a>]</span> that can provide significant transport layer
security.<a class="pilcrow" href="#section-3-2">¶</a></p>
<p id="section-3-3">It is the responsibility of those administering and deploying pNFS with
an NVMe layout to ensure that appropriate protection is deployed to that
protocol based on the deployment environment as well as the nature and
sensitivity of the data and storage devices involved.  When using IP-based
storage protocols such as NVMe over TCP, data confidentiality and
integrity <span class="bcp14">SHOULD</span> be provided for traffic between pNFS clients and NVMe
storage devices by using a secure communication protocol such as Transport
Layer Security (TLS) <span>[<a class="cite xref" href="#RFC8446">RFC8446</a>]</span>. For NVMe over TCP, TLS <span class="bcp14">SHOULD</span> be used as
described in <span>[<a class="cite xref" href="#NVME-TCP">NVME-TCP</a>]</span> to protect traffic between pNFS clients and NVMe
namespaces used as storage devices.<a class="pilcrow" href="#section-3-3">¶</a></p>
<p id="section-3-4">A secure communication protocol might not be needed for pNFS with NVMe
layouts in environments where physical and/or logical security measures
(e.g., air gaps, isolated VLANs) provide effective access control
commensurate with the sensitivity and value of the storage devices and data
involved (e.g., public website contents may be significantly less sensitive
than a database containing personal identifying information, passwords,
and other authentication credentials).<a class="pilcrow" href="#section-3-4">¶</a></p>
<p id="section-3-5">Physical security is a common means for protocols not based on IP. In environments where the security requirements for the storage
protocol cannot be met, pNFS with an NVMe layout <span class="bcp14">SHOULD NOT</span> be
deployed.<a class="pilcrow" href="#section-3-5">¶</a></p>
<p id="section-3-6">When security is available for the data server storage protocol,
it is generally at a different granularity and with a different
notion of identity than NFSv4 (e.g., NFSv4 controls user access
to files, and NVMe controls initiator access to volumes).  As
with pNFS with the block layout type <span>[<a class="cite xref" href="#RFC5663">RFC5663</a>]</span>,
the pNFS client is responsible for enforcing appropriate
correspondences between these security layers. In environments
where the security requirements are such that client-side
protection from access to storage outside of the layout is not
sufficient, pNFS with a SCSI layout on a NVMe namespace <span class="bcp14">SHOULD NOT</span> be deployed.<a class="pilcrow" href="#section-3-6">¶</a></p>
<p id="section-3-7">As with other block-oriented pNFS layout types, the metadata server
is able to fence off a client's access to the data on an NVMe namespace
used as a storage device.  If a metadata server revokes a layout, the
client's access <span class="bcp14">MUST</span> be terminated at the storage devices via fencing
as specified in <a class="auto internal xref" href="#ssc_fencing">Section 2.2</a>.  The client has a
subsequent opportunity to acquire a new layout.<a class="pilcrow" href="#section-3-7">¶</a></p>
</section>
</div>
<div id="sec_iana">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a class="section-number selfRef" href="#section-4">4. </a><a class="section-name selfRef" href="#name-iana-considerations">IANA Considerations</a>
      </h2>
<p id="section-4-1">This document has no IANA actions.<a class="pilcrow" href="#section-4-1">¶</a></p>
</section>
</div>
<section id="section-5">
      <h2 id="name-references">
<a class="section-number selfRef" href="#section-5">5. </a><a class="section-name selfRef" href="#name-references">References</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-normative-references">
<a class="section-number selfRef" href="#section-5.1">5.1. </a><a class="section-name selfRef" href="#name-normative-references">Normative References</a>
        </h3>
<dl class="references">
<dt id="NVME-BASE">[NVME-BASE]</dt>
        <dd>
<span class="refAuthor">NVM Express, Inc.</span>, <span class="refTitle">"NVM Express Base Specification"</span>, <span class="refContent">Revision 2.0d</span>, <time class="refDate" datetime="2024-01">January 2024</time>, <span>&lt;<a href="https://nvmexpress.org/wp-content/uploads/NVM-Express-Base-Specification-2.0d-2024.01.11-Ratified.pdf">https://nvmexpress.org/wp-content/uploads/NVM-Express-Base-Specification-2.0d-2024.01.11-Ratified.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NVME-NVM">[NVME-NVM]</dt>
        <dd>
<span class="refAuthor">NVM Express, Inc.</span>, <span class="refTitle">"NVM Express NVM Command Set Specification"</span>, <span class="refContent">Revision 1.0d</span>, <time class="refDate" datetime="2023-12">December 2023</time>, <span>&lt;<a href="https://nvmexpress.org/wp-content/uploads/NVM-Express-%20%20%20%20%20%20%20%20%20%20%20%20%20NVM-Command-Set-Specification-1.0d-2023.12.28-Ratified.pdf">https://nvmexpress.org/wp-content/uploads/NVM-Express-             NVM-Command-Set-Specification-1.0d-2023.12.28-Ratified.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="NVME-TCP">[NVME-TCP]</dt>
        <dd>
<span class="refAuthor">NVM Express, Inc.</span>, <span class="refTitle">"NVM Express TCP Transport Specification"</span>, <span class="refContent">Revision 1.0d</span>, <time class="refDate" datetime="2023-12">December 2023</time>, <span>&lt;<a href="https://nvmexpress.org/wp-content/uploads/NVM-Express-TCP-Transport-Specification-1.0d-2023.12.27-Ratified.pdf">https://nvmexpress.org/wp-content/uploads/NVM-Express-TCP-Transport-Specification-1.0d-2023.12.27-Ratified.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time class="refDate" datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4506">[RFC4506]</dt>
        <dd>
<span class="refAuthor">Eisler, M., Ed.</span>, <span class="refTitle">"XDR: External Data Representation Standard"</span>, <span class="seriesInfo">STD 67</span>, <span class="seriesInfo">RFC 4506</span>, <span class="seriesInfo">DOI 10.17487/RFC4506</span>, <time class="refDate" datetime="2006-05">May 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4506">https://www.rfc-editor.org/info/rfc4506</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5663">[RFC5663]</dt>
        <dd>
<span class="refAuthor">Black, D.</span>, <span class="refAuthor">Fridella, S.</span>, and <span class="refAuthor">J. Glasgow</span>, <span class="refTitle">"Parallel NFS (pNFS) Block/Volume Layout"</span>, <span class="seriesInfo">RFC 5663</span>, <span class="seriesInfo">DOI 10.17487/RFC5663</span>, <time class="refDate" datetime="2010-01">January 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5663">https://www.rfc-editor.org/info/rfc5663</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8154">[RFC8154]</dt>
        <dd>
<span class="refAuthor">Hellwig, C.</span>, <span class="refTitle">"Parallel NFS (pNFS) Small Computer System Interface (SCSI) Layout"</span>, <span class="seriesInfo">RFC 8154</span>, <span class="seriesInfo">DOI 10.17487/RFC8154</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8154">https://www.rfc-editor.org/info/rfc8154</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time class="refDate" datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time class="refDate" datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8881">[RFC8881]</dt>
        <dd>
<span class="refAuthor">Noveck, D., Ed.</span> and <span class="refAuthor">C. Lever</span>, <span class="refTitle">"Network File System (NFS) Version 4 Minor Version 1 Protocol"</span>, <span class="seriesInfo">RFC 8881</span>, <span class="seriesInfo">DOI 10.17487/RFC8881</span>, <time class="refDate" datetime="2020-08">August 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8881">https://www.rfc-editor.org/info/rfc8881</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPC5">[SPC5]</dt>
      <dd>
<span class="refAuthor">INCITS Technical Committee T10</span>, <span class="refTitle">"SCSI Primary Commands - 5 (SPC-5)"</span>, <span class="seriesInfo">INCITS 502-2019</span>, <time class="refDate" datetime="2019">2019</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-5.2">
        <h3 id="name-informative-references">
<a class="section-number selfRef" href="#section-5.2">5.2. </a><a class="section-name selfRef" href="#name-informative-references">Informative References</a>
        </h3>
<dl class="references">
<dt id="NVME-PCIE">[NVME-PCIE]</dt>
      <dd>
<span class="refAuthor">NVM Express, Inc.</span>, <span class="refTitle">"NVMe over PCIe Transport Specification"</span>, <span class="refContent">Revision 1.0d</span>, <time class="refDate" datetime="2023-12">December 2023</time>, <span>&lt;<a href="https://nvmexpress.org/wp-content/uploads/NVM-Express-PCIe-Transport-Specification-1.0d-2023.12.27-Ratified.pdf">https://nvmexpress.org/wp-content/uploads/NVM-Express-PCIe-Transport-Specification-1.0d-2023.12.27-Ratified.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a class="section-name selfRef" href="#name-acknowledgements">Acknowledgements</a>
      </h2>
<p id="appendix-A-1"><span class="contact-name">Carsten Bormann</span> converted an earlier RFCXML v2 source for this document to a markdown source format.<a class="pilcrow" href="#appendix-A-1">¶</a></p>
<p id="appendix-A-2">David Noveck provided ample feedback to various drafts of this document.<a class="pilcrow" href="#appendix-A-2">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a class="section-name selfRef" href="#name-authors-addresses">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Christoph Hellwig (<span class="role">editor</span>)</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:hch@lst.de">hch@lst.de</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Charles Lever</span></div>
<div class="left" dir="auto"><span class="org">Oracle Corporation</span></div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:chuck.lever@oracle.com">chuck.lever@oracle.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">Sorin Faibish</span></div>
<div class="left" dir="auto"><span class="org">Opendrives.com</span></div>
<div class="left" dir="auto"><span class="street-address">11 Selwyn Road</span></div>
<div class="left" dir="auto">
<span class="locality">Newton</span>, <span class="region">MA</span> <span class="postal-code">02461</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a class="tel" href="tel:+1%20617-510-0422">+1 617-510-0422</a>
</div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:s.faibish@opendrives.com">s.faibish@opendrives.com</a>
</div>
</address>
<address class="vcard">
        <div class="left" dir="auto"><span class="fn nameRole">David L. Black</span></div>
<div class="left" dir="auto"><span class="org">Dell Technologies</span></div>
<div class="left" dir="auto"><span class="street-address">176 South Street</span></div>
<div class="left" dir="auto">
<span class="locality">Hopkinton</span>, <span class="region">MA</span> <span class="postal-code">01748</span>
</div>
<div class="left" dir="auto"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a class="email" href="mailto:david.black@dell.com">david.black@dell.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>


</body></html>