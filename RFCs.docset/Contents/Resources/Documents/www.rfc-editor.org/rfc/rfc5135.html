<html><head></head><body><pre>Network Working Group                                            D. Wing
Request for Comments: 5135                                     T. Eckert
BCP: 135                                             Cisco Systems, Inc.
Category: Best Current Practice                            February 2008


    <span class="h1">IP Multicast Requirements for a Network Address Translator (NAT)</span>
              <span class="h1">and a Network Address Port Translator (NAPT)</span>

Status of This Memo

   This document specifies an Internet Best Current Practices for the
   Internet Community, and requests discussion and suggestions for
   improvements.  Distribution of this memo is unlimited.

Abstract

   This document specifies requirements for a for a Network Address
   Translator (NAT) and a Network Address Port Translator (NAPT) that
   support Any Source IP Multicast or Source-Specific IP Multicast.  An
   IP multicast-capable NAT device that adheres to the requirements of
   this document can optimize the operation of IP multicast applications
   that are generally unaware of IP multicast NAT devices.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology Used in This Document  . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-3">3</a>.  Background . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-4">4</a>.  Requirements . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-4.1">4.1</a>.  NATing IP Multicast Data Packets . . . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-4.1.1">4.1.1</a>.  Receiving Multicast Data Packets . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-4.1.2">4.1.2</a>.  Sending Multicast Data Packets . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-4.2">4.2</a>.  IGMP Version Support . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
       <a href="#section-4.2.1">4.2.1</a>.  IGMPv1 or IGMPv2 . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-4.2.2">4.2.2</a>.  IGMPv3 . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-4.3">4.3</a>.  Any Source Multicast Transmitters  . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-5">5</a>.  Requirements Summary . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
   <a href="#section-6">6</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-8">8</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-8.1">8.1</a>.  Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-8.2">8.2</a>.  Informative References . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#appendix-A">Appendix A</a>.  Application Considerations  . . . . . . . . . . . . . <a href="#page-14">14</a>







<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   In order for IP multicast applications to function well over NATs,
   multicast UDP must work as seamlessly as unicast UDP.  However, NATs
   have little consistency in IP multicast operation, which results in
   inconsistent user experiences and failed IP multicast operation.

   This document targets requirements intended to enable correct
   operations of Any Source Multicast and Source-Specific Multicast in
   devices running Internet Group Management Protocol (IGMP) proxy
   routing and NAT and without applying NAT to IP multicast group
   addresses.  This profile of functionality is the expected best
   practice for residential access routers, small branch routers, or
   similar deployments.

   Most of the principles outlined in this document do also apply when
   using protocols other than IGMP, such as Protocol Independent
   Multicast - Sparse Mode (PIM-SM), or when performing NAT between
   multiple "inside" interfaces, but explicit consideration for these
   cases is outside the scope of this document.

   This document describes the behavior of a device that functions as a
   NAT for unicast flows and also forwards IP multicast traffic in
   either direction ('inside' to 'outside', or 'outside' to 'inside').
   This allows a host 'inside' the NAT to both receive multicast traffic
   and to source multicast traffic.  Hosts on the 'inside' interface(s)
   of a NAT indicate their interest in receiving an IP multicast flow by
   sending an IGMP message to their local interface.  An IP multicast-
   capable NAT will see that IGMP message (IGMPv1 [<a href="./rfc1112" title='"Host extensions for IP multicasting"'>RFC1112</a>], IGMPv2
   [<a href="./rfc2236" title='"Internet Group Management Protocol, Version 2"'>RFC2236</a>], IGMPv3 [<a href="./rfc3376" title='"Internet Group Management Protocol, Version 3"'>RFC3376</a>]), possibly perform some functions on that
   IGMP message, and forward it to its upstream router.  This causes the
   upstream router to send that IP multicast traffic to the NAT, which
   forwards it to those 'inside' segment(s) with host(s) that had
   previously sent IGMP messages for that IP multicast traffic.

   Out of scope of this document are PIM-SM [<a href="./rfc4601" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC4601</a>] and IPv6
   [<a href="./rfc2460" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>].  The IGMP Proxy devices that are scoped in this document
   do not forward PIM-SM.  IPv6 is out of scope because NAT is not
   considered necessary with IPv6.

   This document is a companion document to "NAT Behavioral Requirements
   for Unicast UDP" [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20%20Terminology%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" id="section-2">2</a>.  Terminology Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="./rfc2119">RFC 2119</a> [<a href="./rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].



<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   In this document, the term "NAT" applies to both Network Address and
   Port Translator (NAPT) as well as a NAT that does not translate
   ports.

   The term 'inside' refers to the interface(s) on a NAT that contain
   hosts that wish to source or receive IP multicast traffic.  The term
   'outside' refers to the interface(s) that the NAT forwards IGMP
   membership messages to, and where the NAT routes IP multicast traffic
   that originates from hosts on its 'inside' interface.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20%20Background"></a><a class="selflink" href="#section-3" id="section-3">3</a>.  Background</span>

   When a NAT isn't used, a host might be connected to the Internet in a
   configuration such as this:

                            +-------------+
                 +------+   |  DSL modem  |    +------------+
                 | host +---+     or      +-//-+ WAN Router |
                 +------+   | cable modem |    +------------+
                            +-------------+

                Figure 1: Network without NATing IGMP Proxy

   If instead of a single host as shown in Figure 1, one or more LANs
   with potentially multiple hosts are to be connected, with the same
   type of service termination on the DSL or cable modem, a NAT device
   is added as shown in Figure 2.  This device, in general, perform
   routing and NAT functions such that it does look like a single host
   towards the DSL/cable modem.


          +----+   +-------------+
          |host+---+ +---------+ |  +-----------+
          +----+   | |Multicast| |  | DSL modem |    +------------+
                   | |  Proxy  | +--+    or     +-//-+ WAN Router |
         'inside'  | +---------+ |  |cable modem|    +------------+
        interfaces |             |  +-----------+
                   |  +------+   |
          +----+   |  | NAT  |   | 'outside'
          |host+---+  +------+   | interfaces
          +----+   +-------------+
                IGMP Proxy NAT Device

                 Figure 2: Network with NATing IGMP Proxy

   In IP multicast, IGMP is the protocol used by hosts, such as the one
   shown in Figure 1.  For the NAT device in Figure 2 to look like the
   single host for IP multicast services towards the DSL/cable modem and



<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   to forward IP multicast traffic from and to the multiple hosts in the
   picture, it needs to perform so called "IGMP Proxying" [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>] --
   but within the context of also performing NAT.  NAT is not covered by
   [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>].  Adding NAT to IGMP proxying does not need to change the
   processing of the IGMP messages as defined in <a href="./rfc4605">RFC 4605</a>:

      IGMP messages are never logically forwarded by the IGMP proxying
      device, but rather sourced or received by it.  In general, receipt
      of IGMP messages by the device updates the device's IGMP state.
      The updated state changes the device's forwarding of multicast
      messages or triggers the sending of IGMP messages.  "Forwarding"
      of IGMP protocol messages may thus only happen implicitly by
      implementation optimizations that create shortcuts in this
      machinery.

   This specifically means that IGMP protocol packets sent by the NAT
   device will always use the IP address of the interface ('inside' or
   'outside') from which they are sent, but because those packets are
   logically "sourced" and not "forwarded", NAT does not have any impact
   on this.

   Unlike unicast flows, packets with a multicast destination IP address
   do not have their destination IP address or destination port changed
   by a NAT.  However, their source IP address (and source UDP port, in
   some cases with a NAPT) is changed if the packet goes from an
   'inside' interface of a NAT to the 'outside' interface of a NAT --
   similar to the behavior of a unicast packet across those same
   interfaces.

   Adding NAT to IGMP proxying changes the processing of IP multicast
   data packets forwarded across the IGMP proxying device as described
   in the following sections.  These changes actually simplify the
   ability to deploy IGMP proxying over a device that does *not* perform
   NAT.

   With an IGMP Proxy NAT Device, IP multicast data traffic sourced from
   hosts on the 'inside' is NATed such that it will look like it is
   being sourced from a host directly connected to the WAN router, thus
   eliminating all non-standard PIM-SM concerns/configurations described
   in <a href="./rfc4605#section-3.2">Section 3.2 of [RFC4605]</a>.











<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20%20Requirements"></a><a class="selflink" href="#section-4" id="section-4">4</a>.  Requirements</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.%20%20NATing%20IP%20Multicast%20Data%20Packets"></a><a class="selflink" href="#section-4.1" id="section-4.1">4.1</a>.  NATing IP Multicast Data Packets</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.1.%20%20Receiving%20Multicast%20Data%20Packets"></a><a class="selflink" href="#section-4.1.1" id="section-4.1.1">4.1.1</a>.  Receiving Multicast Data Packets</span>

   REQ-1:   For IP multicast packets that are forwarded to a host(s) on
            its 'inside' interface(s), a NAT MUST NOT modify the
            destination IP address or destination port of the packets.

      If a NAT were to modify the destination IP or port addresses, the
      NAT would also need to modify session announcements (e.g.,
      electronic program guides, Session Announcement Protocol (SAP))
      and session establishment and control (e.g., SIP, Real Time
      Streaming Protocol (RTSP)) messages.  Such modifications of
      application messages are not considered a best practice.
      Furthermore, a NATed multi-homed network would need to coordinate
      such rewriting between its NATs.

   REQ-2:   A NAT MUST forward IP multicast UDP datagrams from its
            'outside' interface to multicast receivers on its 'inside'
            interface(s).

   REQ-3:   A NAT SHOULD forward IP multicast non-UDP protocols (e.g.,
            Pragmatic General Multicast (PGM) [<a href="./rfc3208" title='"PGM Reliable Transport Protocol Specification"'>RFC3208</a>], Resource
            Reservation Protocol (RSVP) [<a href="./rfc2205" title='"Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification"'>RFC2205</a>]) from its 'outside'
            interface to IP multicast receivers on its 'inside'
            interface(s).

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.1.2.%20%20Sending%20Multicast%20Data%20Packets"></a><a class="selflink" href="#section-4.1.2" id="section-4.1.2">4.1.2</a>.  Sending Multicast Data Packets</span>

   The following requirement is normal NAT behavior for unicast packets,
   as described in [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>], and is extended here to provide support
   for IP multicast senders behind the NAT.

   REQ-4:   A NAT MUST modify the source IP address of packets that
            arrive from an 'inside' interface towards the 'outside'
            interface so that those packets use the NAT's 'outside' IP
            address(es).

            a:  If the NAT also performs port translation (that is, it
                is a NAPT), the NAT MUST also create a mapping to allow
                responses to that IP multicast packet to be received by
                the appropriate host.  For Any Source Multicast, also
                see <a href="#section-4.3">Section 4.3</a>.






<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


            b:  To allow hosts to learn the NAT's 'outside' interface
                address, the NAT MUST have "Endpoint-Independent
                Mapping" behavior (REQ-1 of [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>]), no matter if the
                destination IP address is a unicast address or an IP
                multicast address.

            c:  If the NAT has multiple public IP addresses, the NAT
                SHOULD have an address pooling behavior of "Paired" (as
                described in <a href="./rfc4787#section-4.1">Section 4.1 of [RFC4787]</a>) for its IP
                multicast mappings as well as for its unicast UDP
                mappings.  This allows a multicast source to discover
                the NAT's public IP address using a unicast address
                discovery mechanism (e.g., [<a href="#ref-ICE" title='"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols"'>ICE</a>]) and communicate that
                discovered IP address to a multicast receiver.

   REQ-5:   A NAT MUST forward IP multicast UDP datagrams from its
            'inside' interface(s) to its 'outside' interface.

            a:  NATs that support the above requirement MUST also
                provide a configuration option to disable this feature.
                Otherwise, a multihomed network would cause duplicate
                instances of the multicast data traffic on the public
                network.

   As many NATs are located adjacent to bandwidth-constrained access
   links, it is important that IP multicast senders communicating with
   IP multicast receivers behind the NAT not have their flows consume
   bandwidth on the access link.  This is accomplished by applications
   using administratively scoped IP addresses.  Similarly, link-local
   multicast traffic isn't supposed to be routed off the local network.

   REQ-6:   The NAT's default configuration MUST NOT forward
            administratively scoped IP multicast traffic (239.0.0.0/8)
            [<a href="./rfc2365" title='"Administratively Scoped IP Multicast"'>RFC2365</a>] from its 'inside' interface(s) to its 'outside'
            interface.

   REQ-7:   The NAT MUST NOT forward Local Network Control Block
            (224.0.0/24) [<a href="./rfc3171" title='"IANA Guidelines for IPv4 Multicast Address Assignments"'>RFC3171</a>] (also known as "link-local
            multicast") traffic from its 'inside' interface(s) to its
            'outside' interface.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.%20%20IGMP%20Version%20Support"></a><a class="selflink" href="#section-4.2" id="section-4.2">4.2</a>.  IGMP Version Support</span>

   REQ-8:   A NAT MAY support IGMPv1 (although IGMPv1 is considered
            obsolete).






<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   REQ-9:   A NAT MUST support IGMPv2.

   REQ-10:  A NAT SHOULD support IGMPv3.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.1.%20%20IGMPv1%20or%20IGMPv2"></a><a class="selflink" href="#section-4.2.1" id="section-4.2.1">4.2.1</a>.  IGMPv1 or IGMPv2</span>

   For IGMPv1 and IGMPv2, a NAT can successfully operate by merely
   forwarding IGMP membership reports and queries between the interested
   hosts (on its internal interface) towards its external interface.

   REQ-11:  If a NAT supports IGMPv1 and/or IGMPv2 (but not IGMPv3), the
            NAT MAY simply receive IGMP membership reports on the
            'inside' interface, NAT them, and relay the IGMP membership
            report, and do the same function in the opposite direction
            to the IGMP listeners.  That is, the NAT does not need to do
            any aggregation of IGMP messages.

            a:  If a NAT relays IGMPv1 or IGMPv2 messages in this
                manner, it MUST NOT decrement the TTL of the IGMP
                messages, as they are already sent with TTL=1.

            b:  However, it is RECOMMENDED that such a NAT implement
                IGMP/MLD Proxying [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>], because IGMP aggregation
                provides a useful optimization.

<span class="h4"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.2.2.%20%20IGMPv3"></a><a class="selflink" href="#section-4.2.2" id="section-4.2.2">4.2.2</a>.  IGMPv3</span>

   When an IGMPv3 proxying device receives an IGMP membership on an
   'inside' interface, it creates its own IGMP proxying membership state
   and its own IGMP forwarding table.  It then creates an independent
   IGMP membership report on its 'outside' interface reporting the IP
   multicast groups/channels -- but there is no direct relationship or
   "forwarding" of IGMP membership reports or queries across the
   interfaces.  The NAT device will subsequently receive an IP multicast
   data packet on the 'outside' interface and forward the IP multicast
   packet to the 'inside' interface(s) based on its IGMP forwarding
   table.

   By performing NAT on IGMPv3 membership reports, the membership
   reports appear to originate from a single IGMPv3 reporter instead of
   different reporters.  Because IGMPv3 has different types of
   membership reports differentiating between status (IS_INCLUDE,
   IS_EXCLUDE) and change indication (e.g., TO_INCLUDE, TO_EXCLUDE), if
   a NAT were to interleave reports from two or more reporters (joining
   and leaving the same groups), the NAT would create a sequence of
   packets that are not compliant with an IGMPv3 reporter [<a href="./rfc3376" title='"Internet Group Management Protocol, Version 3"'>RFC3376</a>].
   For this reason, the following requirements are specified:




<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   REQ-12:  If a NAT supports IGMPv3, the NAT MUST implement IGMP/MLD
            Proxying [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>].  Such compliance causes the NAT to
            aggregate the IGMPv3 membership reports and report only the
            aggregated information upstream.

   REQ-13:  If a NAT supports IGMPv3, the NAT MUST implement Source-
            Specific Multicast (SSM) for IP [<a href="./rfc4607" title='"Source-Specific Multicast for IP"'>RFC4607</a>] and IGMPv3/MLDv2
            for SSM [<a href="./rfc4604" title='"Using Internet Group Management Protocol Version 3 (IGMPv3) and Multicast Listener Discovery Protocol Version 2 (MLDv2) for Source-Specific Multicast"'>RFC4604</a>].

   Failure to implement IGMP aggregation [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>] will cause undesired
   temporary black holing of IP multicast traffic.  For example,
   consider two hosts behind the same NAT.  If one host is joining a
   session at the same time another is leaving the session, and the NAT
   were to merely relay the join and leave upstream, the session will be
   terminated, and the join and leave announcements would not comply
   with <a href="./rfc3376#section-5">Section 5 of [RFC3376]</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/4.3.%20%20Any%20Source%20Multicast%20Transmitters"></a><a class="selflink" href="#section-4.3" id="section-4.3">4.3</a>.  Any Source Multicast Transmitters</span>

   Any Source Multicast (ASM) uses the IP addresses in the 224/8 through
   231/8, and 233/8 through 239/8 range [<a href="#ref-IANA-ALLOC" title='"Internet Multicast Addresses"'>IANA-ALLOC</a>].

   When a host both receives an ASM stream and sends traffic into it,
   using RTP [<a href="./rfc3550" title='"RTP: A Transport Protocol for Real-Time Applications"'>RFC3550</a>], there is a potential problem if a NAT merely
   followed the requirements of [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>].  The problem is that RTP uses
   the source transport address (source IP address and source UDP port)
   and the Real-time Transport Protocol / RTP Control Protocol (RTP/
   RTCP) SSRC value to identify session members.  If a session member
   sees the same SSRC arrive from a different transport address, that
   session member will perform RTP collision detection (<a href="./rfc3550#section-8.2">Section 8.2 of
   [RFC3550]</a>).  If a NAT merely followed the requirements of [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>]
   and timed out a UDP session after 2 minutes of inactivity and RTCP
   receiver reports are sent less often than every 2 minutes, RTP
   collision detection would be performed by other session members
   sharing the same SSRC, complicating diagnostic tools and potentially
   interfering with jitter buffer algorithms.  This situation can occur,
   for example, with an IP multicast group of approximately 300 members
   with a normal 50 Kbps audio RTP stream.

   Source-Specific Multicast does not need this long timer because
   application feedback reports are unicast (rather than IP multicast)
   and identifiers, rather than IP addresses and UDP ports, are used to
   identify a specific IP multicast receiver (e.g., [<a href="#ref-RTCPSSM" title='"RTCP Extensions for Single-Source Multicast Sessions with Unicast Feedback"'>RTCPSSM</a>].








<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   REQ-14:  If a host on the 'inside' interface of a NAT belongs to an
            Any Source Multicast host group and the host sends a UDP
            packet to the same group, the NAT SHOULD have a UDP mapping
            timer of 60 minutes for that mapping.

            a:  This UDP mapping SHOULD be destroyed when the host
                leaves that host group.  The NAT is aware of this
                through receipt of an IGMP message from the host.

            b:  If a NAT has exhausted its resources, the NAT MAY time
                out that mapping before 60 minutes have elapsed, but
                this is discouraged.  Note that even in a situation with
                resource exhaustion, a NAT is still required to follow
                the minimum mapping duration of 2 minutes (REQ-5 of
                [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>]).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/5.%20%20Requirements%20Summary"></a><a class="selflink" href="#section-5" id="section-5">5</a>.  Requirements Summary</span>

   This section summarizes the requirements.

   REQ-1:   For IP multicast packets that are forwarded to a host(s) on
            its 'inside' interface(s), a NAT MUST NOT modify the
            destination IP address or destination port of the packets.

   REQ-2:   A NAT MUST forward IP multicast UDP datagrams from its
            'outside' interface to multicast receivers on its 'inside'
            interface(s).

   REQ-3:   A NAT SHOULD forward IP multicast non-UDP protocols (e.g.,
            PGM [<a href="./rfc3208" title='"PGM Reliable Transport Protocol Specification"'>RFC3208</a>], RSVP [<a href="./rfc2205" title='"Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification"'>RFC2205</a>]) from its 'outside' interface
            to IP multicast receivers on its 'inside' interface(s).

   REQ-4:   A NAT MUST modify the source IP address of packets that
            arrive from an 'inside' interface towards the 'outside'
            interface so that those packets use the NAT's 'outside' IP
            address(es).

            a:  If the NAT also performs port translation (that is, it
                is a NAPT), the NAT MUST also create a mapping to allow
                responses to that IP multicast packet to be received by
                the appropriate host.  For Any Source Multicast, also
                see <a href="#section-4.3">Section 4.3</a>.

            b:  To allow hosts to learn the NAT's 'outside' interface
                address, the NAT MUST have "Endpoint-Independent
                Mapping" behavior (REQ-1 of [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>]), no matter if the
                destination IP address is a unicast address or an IP
                multicast address.



<span class="grey">Wing &amp; Eckert            Best Current Practice                  [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


            c:  If the NAT has multiple public IP addresses, the NAT
                SHOULD have an address pooling behavior of "Paired" (as
                described in <a href="./rfc4787#section-4.1">Section 4.1 of [RFC4787]</a>) for its IP
                multicast mappings as well as for its unicast UDP
                mappings.  This allows a multicast source to discover
                the NAT's public IP address using a unicast address
                discovery mechanism (e.g., [<a href="#ref-ICE" title='"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols"'>ICE</a>]) and communicate that
                discovered IP address to a multicast receiver.

   REQ-5:   A NAT MUST forward IP multicast UDP datagrams from its
            'inside' interface(s) to its 'outside' interface.

            a:  NATs that support the above requirement MUST also
                provide a configuration option to disable this feature.
                Otherwise, a multihomed network would cause duplicate
                instances of the multicast data traffic on the public
                network.

   REQ-6:   The NAT's default configuration MUST NOT forward
            administratively scoped IP multicast traffic (239.0.0.0/8)
            [<a href="./rfc2365" title='"Administratively Scoped IP Multicast"'>RFC2365</a>] from its 'inside' interface(s) to its 'outside'
            interface.

   REQ-7:   The NAT MUST NOT forward Local Network Control Block
            (224.0.0/24) [<a href="./rfc3171" title='"IANA Guidelines for IPv4 Multicast Address Assignments"'>RFC3171</a>] (also known as "link-local
            multicast") traffic from its 'inside' interface(s) to its
            'outside' interface.

   REQ-8:   A NAT MAY support IGMPv1 (although IGMPv1 is considered
            obsolete).

   REQ-9:   A NAT MUST support IGMPv2.

   REQ-10:  A NAT SHOULD support IGMPv3.

   REQ-11:  If a NAT supports IGMPv1 and/or IGMPv2 (but not IGMPv3), the
            NAT MAY simply receive IGMP membership reports on the
            'inside' interface, NAT them, and relay the IGMP membership
            report, and do the same function in the opposite direction
            to the IGMP listeners.  That is, the NAT does not need to do
            any aggregation of IGMP messages.

            a:  If a NAT relays IGMPv1 or IGMPv2 messages in this
                manner, it MUST NOT decrement the TTL of the IGMP
                messages, as they are already sent with TTL=1.






<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


            b:  However, it is RECOMMENDED that such a NAT implement
                IGMP/MLD Proxying [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>], because IGMP aggregation
                provides a useful optimization.

   REQ-12:  If a NAT supports IGMPv3, the NAT MUST implement IGMP/MLD
            Proxying [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>].  Such compliance causes the NAT to
            aggregate the IGMPv3 membership reports and report only the
            aggregated information upstream.

   REQ-13:  If a NAT supports IGMPv3, the NAT MUST implement Source-
            Specific Multicast (SSM) for IP [<a href="./rfc4607" title='"Source-Specific Multicast for IP"'>RFC4607</a>] and IGMPv3/MLDv2
            for SSM [<a href="./rfc4604" title='"Using Internet Group Management Protocol Version 3 (IGMPv3) and Multicast Listener Discovery Protocol Version 2 (MLDv2) for Source-Specific Multicast"'>RFC4604</a>].

   REQ-14:  If a host on the 'inside' interface of a NAT belongs to an
            Any Source Multicast host group and the host sends a UDP
            packet to the same group, the NAT SHOULD have a UDP mapping
            timer of 60 minutes for that mapping.

            a:  This UDP mapping SHOULD be destroyed when the host
                leaves that host group.  The NAT is aware of this
                through receipt of an IGMP message from the host.

            b:  If a NAT has exhausted its resources, the NAT MAY time
                out that mapping before 60 minutes have elapsed, but
                this is discouraged.  Note that even in a situation with
                resource exhaustion, a NAT is still required to follow
                the minimum mapping duration of 2 minutes (REQ-5 of
                [<a href="./rfc4787" title='"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"'>RFC4787</a>]).

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" id="section-6">6</a>.  Security Considerations</span>

   The Security Considerations sections of IGMPv3 [<a href="./rfc3376" title='"Internet Group Management Protocol, Version 3"'>RFC3376</a>] and IGMP
   Proxying [<a href="./rfc4605" title='"Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("'>RFC4605</a>] apply to a device complying with this document.

   When a host is using RTP and participating in an Any Source Multicast
   session, the host's periodic RTCP receiver reports cause the NAT to
   create a mapping.  When the group size is less than approximately
   300, the RTCP reports are sent frequently enough that a NAT's mapping
   will always be kept open.  When the group size is larger than
   approximately 300, the RTCP reports are sent less frequently.  The
   recommendation in <a href="#section-4.3">Section 4.3</a> causes the NAT mapping to be kept open
   for the duration of the host's participation in that IP multicast
   session no matter the size of the multicast host or periodicity of
   the host's RTCP transmissions.







<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/7.%20%20Acknowledgments"></a><a class="selflink" href="#section-7" id="section-7">7</a>.  Acknowledgments</span>

   Thanks to Jari Arkko, Yiqun Cai, Stephen Casner, Remi Denis-Courmont,
   Lars Eggert, Gorry Fairhurst, Alfred Hines, Prashant Jhingran, Bharat
   Joshi, Francois Le Faucheur, Albert Manfredi, Marcus Maranhao, Bryan
   McLaughlin, Chris Newman, Tim Polk, Pekka Savola, Mark Townsley,
   Magnus Westerlund, and Stig Venaas for their assistance in writing
   this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.%20%20References"></a><a class="selflink" href="#section-8" id="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                 Requirement Levels", <a href="https://www.rfc-editor.org/bcp/bcp14">BCP 14</a>, <a href="./rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2236">RFC2236</a>]     Fenner, W., "Internet Group Management Protocol,
                 Version 2", <a href="./rfc2236">RFC 2236</a>, November 1997.

   [<a id="ref-RFC2365">RFC2365</a>]     Meyer, D., "Administratively Scoped IP Multicast",
                 <a href="https://www.rfc-editor.org/bcp/bcp23">BCP 23</a>, <a href="./rfc2365">RFC 2365</a>, July 1998.

   [<a id="ref-RFC3171">RFC3171</a>]     Albanna, Z., Almeroth, K., Meyer, D., and M. Schipper,
                 "IANA Guidelines for IPv4 Multicast Address
                 Assignments", <a href="https://www.rfc-editor.org/bcp/bcp51">BCP 51</a>, <a href="./rfc3171">RFC 3171</a>, August 2001.

   [<a id="ref-RFC3376">RFC3376</a>]     Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A.
                 Thyagarajan, "Internet Group Management Protocol,
                 Version 3", <a href="./rfc3376">RFC 3376</a>, October 2002.

   [<a id="ref-RFC3550">RFC3550</a>]     Schulzrinne, H., Casner, S., Frederick, R., and V.
                 Jacobson, "RTP: A Transport Protocol for Real-Time
                 Applications", STD 64, <a href="./rfc3550">RFC 3550</a>, July 2003.

   [<a id="ref-RFC4604">RFC4604</a>]     Holbrook, H., Cain, B., and B. Haberman, "Using
                 Internet Group Management Protocol Version 3 (IGMPv3)
                 and Multicast Listener Discovery Protocol Version 2
                 (MLDv2) for Source-Specific Multicast", <a href="./rfc4604">RFC 4604</a>,
                 August 2006.

   [<a id="ref-RFC4605">RFC4605</a>]     Fenner, B., He, H., Haberman, B., and H. Sandick,
                 "Internet Group Management Protocol (IGMP) / Multicast
                 Listener Discovery (MLD)-Based Multicast Forwarding
                 ("IGMP/MLD Proxying")", <a href="./rfc4605">RFC 4605</a>, August 2006.

   [<a id="ref-RFC4607">RFC4607</a>]     Holbrook, H. and B. Cain, "Source-Specific Multicast
                 for IP", <a href="./rfc4607">RFC 4607</a>, August 2006.




<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


   [<a id="ref-RFC4787">RFC4787</a>]     Audet, F. and C. Jennings, "Network Address Translation
                 (NAT) Behavioral Requirements for Unicast UDP",
                 <a href="https://www.rfc-editor.org/bcp/bcp127">BCP 127</a>, <a href="./rfc4787">RFC 4787</a>, January 2007.

<span class="h3"><a class="dashAnchor" name="//apple_ref/cpp/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-IANA-ALLOC">IANA-ALLOC</a>]  Internet Assigned Numbers Authority, "Internet
                 Multicast Addresses",
                 &lt;<a href="http://www.iana.org/assignments/multicast-addresses">http://www.iana.org/assignments/multicast-addresses</a>&gt;.

   [<a id="ref-ICE">ICE</a>]         Rosenberg, J., "Interactive Connectivity Establishment
                 (ICE): A Protocol for Network Address Translator (NAT)
                 Traversal for Offer/Answer Protocols", Work
                 in Progress, October 2007.

   [<a id="ref-RFC1112">RFC1112</a>]     Deering, S., "Host extensions for IP multicasting",
                 STD 5, <a href="./rfc1112">RFC 1112</a>, August 1989.

   [<a id="ref-RFC1918">RFC1918</a>]     Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G.,
                 and E. Lear, "Address Allocation for Private
                 Internets", <a href="https://www.rfc-editor.org/bcp/bcp5">BCP 5</a>, <a href="./rfc1918">RFC 1918</a>, February 1996.

   [<a id="ref-RFC2205">RFC2205</a>]     Braden, B., Zhang, L., Berson, S., Herzog, S., and S.
                 Jamin, "Resource ReSerVation Protocol (RSVP) -- Version
                 1 Functional Specification", <a href="./rfc2205">RFC 2205</a>, September 1997.

   [<a id="ref-RFC2460">RFC2460</a>]     Deering, S. and R. Hinden, "Internet Protocol, Version
                 6 (IPv6) Specification", <a href="./rfc2460">RFC 2460</a>, December 1998.

   [<a id="ref-RFC3208">RFC3208</a>]     Speakman, T., Crowcroft, J., Gemmell, J., Farinacci,
                 D., Lin, S., Leshchiner, D., Luby, M., Montgomery, T.,
                 Rizzo, L., Tweedly, A., Bhaskar, N., Edmonstone, R.,
                 Sumanasekera, R., and L. Vicisano, "PGM Reliable
                 Transport Protocol Specification", <a href="./rfc3208">RFC 3208</a>,
                 December 2001.

   [<a id="ref-RFC4566">RFC4566</a>]     Handley, M., Jacobson, V., and C. Perkins, "SDP:
                 Session Description Protocol", <a href="./rfc4566">RFC 4566</a>, July 2006.

   [<a id="ref-RFC4601">RFC4601</a>]     Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,
                 "Protocol Independent Multicast - Sparse Mode (PIM-SM):
                 Protocol Specification (Revised)", <a href="./rfc4601">RFC 4601</a>,
                 August 2006.

   [<a id="ref-RTCPSSM">RTCPSSM</a>]     Ott, J., Chesterfield, J., and E. Schooler, "RTCP
                 Extensions for Single-Source Multicast Sessions with
                 Unicast Feedback", Work in Progress, January 2008.




<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/cpp/Section/Appendix%20A.%20%20Application%20Considerations"></a><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Application Considerations</span>

   SSM requires listeners to know the SSM channel (S,G), which is
   comprised of the IP source address (S) and the IP multicast group
   (G).  An SSM source needs to communicate its IP address in its SSM
   session establishment message (e.g., in its Session Description
   Protocol (SDP) [<a href="./rfc4566" title='"SDP: Session Description Protocol"'>RFC4566</a>]).  When the SSM sender is behind a NAT and
   the SSM receiver(s) are on the other side of that NAT, the SSM sender
   will need to determine its IP source address relevant to the SSM
   receivers; generally, this will be the 'outside' IP address of the
   NAT.  This 'outside' address needs to be included in the SSM session
   establishment message (e.g., SDP) so that listeners on the 'outside'
   of the NAT can receive the SSM channel.

   If there are SSM listeners on both the 'outside' and 'inside' of the
   NAT, it may be valuable to consider using ICE [<a href="#ref-ICE" title='"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols"'>ICE</a>] in the session
   advertisement; the full scope of the interaction between SSM and ICE
   is beyond the scope of this document.

   If multiple SSM sources on the 'inside' of a NAT choose the same
   multicast group address, those sources are uniquely identifiable
   because their IP addresses are unique.  However, if their multicast
   traffic is NATed and sent on the NAT's public interface, the traffic
   from those individual sources is no longer uniquely identifiable.
   This will cause problems for multicast receivers, which will see an
   intermixing of traffic from those sources.  Resolution of this issue
   is left for future study.  In the meantime, applications that source
   SSM multicast traffic are encouraged to allow the user to modify the
   multicast SSM address so that users can avoid this problem if that
   application is placed behind a NAT.

   A multicast source that wants its traffic to not traverse a router
   (e.g., leave a home network) may find it useful to send traffic with
   IP TTL=1.  Both ASM and SSM sources may find this useful.

   As many NATs use the same private address space (e.g.,
   192.168.0.0/16, [<a href="./rfc1918" title='"Address Allocation for Private Internets"'>RFC1918</a>]), RTP stacks are encouraged to generate
   CNAMEs properly (see end of <a href="./rfc3550#section-6.5.1">Section 6.5.1 of [RFC3550]</a>.)













<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


Authors' Addresses

   Dan Wing
   Cisco Systems, Inc.
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   EMail: dwing@cisco.com


   Toerless Eckert
   Cisco Systems, Inc.
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   EMail: eckert@cisco.com

































<span class="grey">Wing &amp; Eckert            Best Current Practice                 [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey"><a href="./rfc5135">RFC 5135</a>             NAT IP Multicast Requirements         February 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://www.rfc-editor.org/bcp/bcp78">BCP 78</a> and <a href="https://www.rfc-editor.org/bcp/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Wing &amp; Eckert            Best Current Practice                 [Page 16]
</pre>
</body></html>