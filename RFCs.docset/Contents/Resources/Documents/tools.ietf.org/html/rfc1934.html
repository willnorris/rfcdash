<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc1934 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:55 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:1934" name="DC.Identifier"/>
<meta content="This document proposes an extension to the PPP Multilink Protocol (MP)
[1]. Multilink Protocol Plus (MP+) is a new control protocol for
managing multiple data links that are bundled by MP. This memo
provides information for the Internet community. This memo does not
specify an Internet standard of any kind." name="DC.Description.Abstract"/>
<meta content="K. Smith" name="DC.Creator"/>
<meta content="April, 1996" name="DC.Date.Issued"/>
<meta content="Ascend's Multilink Protocol Plus (MP+)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 1934 - Ascend's Multilink Protocol Plus (MP+)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc1934.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc1934" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-rfced-info-smith" title="draft-rfced-info-smith">draft-rfced-inf...</a>] [<a href="https://datatracker.ietf.org/doc/rfc1934" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc1934" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc1934" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                           K. Smith
Request For Comments: 1934                         Ascend Communications
Category: Informational                                       April 1996


                 <span class="h1">Ascend's Multilink Protocol Plus (MP+)</span>

Status of This Memo

   This memo provides information for the Internet community.  This memo
   does not specify an Internet standard of any kind.  Distribution of
   this memo is unlimited.

Abstract

   This document proposes an extension to the PPP Multilink Protocol
   (MP) [<a href="#ref-1" title='"The PPP Multilink Protocol (MP)"'>1</a>]. Multilink Protocol Plus (MP+) is a new control protocol for
   managing multiple data links that are bundled by MP.

Table Of Contents

<a href="#section-1">1</a>.      Introduction.................................................<a href="#page-2">2</a>
        <a href="#section-1.1">1.1</a>     Functional Description...............................<a href="#page-2">2</a>
        <a href="#section-1.2">1.2</a>     Conventions..........................................<a href="#page-3">3</a>
<a href="#section-2">2</a>.      General Overview.............................................<a href="#page-3">3</a>
        <a href="#section-2.1">2.1</a>     Operation............................................<a href="#page-4">4</a>
<a href="#section-3">3</a>.      MP+ Frame Formats............................................<a href="#page-4">4</a>
        <a href="#section-3.1">3.1</a>     Error Control (EC) Layer.............................<a href="#page-6">6</a>
                <a href="#section-3.1.1">3.1.1</a>   Error Control State Machine..................<a href="#page-7">7</a>
        <a href="#section-3.2">3.2</a>     Multilink Plus Control Messages......................<a href="#page-9">9</a>
        <a href="#section-3.3">3.3</a>     Multilink Plus Message Formats......................<a href="#page-10">10</a>
                <a href="#section-3.3.1">3.3.1</a>   VERSION_EXCHANGE_REQ Message Format.........<a href="#page-10">10</a>
                <a href="#section-3.3.2">3.3.2</a>   VERSION_EXCHANGE_RSP Message Format.........<a href="#page-12">12</a>
                <a href="#section-3.3.3">3.3.3</a>   ADD_REQ Message Format......................<a href="#page-13">13</a>
                <a href="#section-3.3.4">3.3.4</a>   ADD_RSP Message Format......................<a href="#page-15">15</a>
                <a href="#section-3.3.5">3.3.5</a>   ADD_COMPLETE Message Format.................<a href="#page-16">16</a>
                <a href="#section-3.3.6">3.3.6</a>   REMOVE_REQ Message Format...................<a href="#page-17">17</a>
                <a href="#section-3.3.7">3.3.7</a>   REMOVE_RSP Message Format...................<a href="#page-17">17</a>
                <a href="#section-3.3.8">3.3.8</a>   REMOVE_COMPLETE Message Format..............<a href="#page-18">18</a>
                <a href="#section-3.3.9">3.3.9</a>   CLOSE_REQ Message Format....................<a href="#page-19">19</a>
                <a href="#section-3.3.10">3.3.10</a>  CLOSE_RSP Message Format....................<a href="#page-19">19</a>
                <a href="#section-3.3.11">3.3.11</a>  REMOTE_MGMT_REQ Message Format..............<a href="#page-20">20</a>
                <a href="#section-3.3.12">3.3.12</a>  REMOTE_MGMT_RSP Message Format..............<a href="#page-20">20</a>
                <a href="#section-3.3.13">3.3.13</a>  REMOTE_MGMT_RX_REQ Message Format...........<a href="#page-21">21</a>
                <a href="#section-3.3.14">3.3.14</a>  REMOTE_MGMT_TX_REQ Message Format...........<a href="#page-22">22</a>
                <a href="#section-3.3.15">3.3.15</a>  REMOTE_MGMT_TX_RSP Message Format...........<a href="#page-22">22</a>
                <a href="#section-3.3.16">3.3.16</a>  CLEAR_REQ Message Format....................<a href="#page-23">23</a>
        <a href="#section-3.4">3.4</a>     Events..............................................<a href="#page-23">23</a>



<span class="grey">Smith                        Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


        <a href="#section-3.5">3.5</a>     State Machine.......................................<a href="#page-25">25</a>
                <a href="#section-3.5.1">3.5.1</a>   States......................................<a href="#page-25">25</a>
                <a href="#section-3.5.2">3.5.2</a>   Common Actions..............................<a href="#page-26">26</a>
                <a href="#section-3.5.3">3.5.3</a>   MP+STATE_INITIAL state machine..............<a href="#page-32">32</a>
                <a href="#section-3.5.4">3.5.4</a>   MP+STATE_IDLE state machine.................<a href="#page-35">35</a>
                <a href="#section-3.5.5">3.5.5</a>   MP+STATE_ADD state machine..................<a href="#page-37">37</a>
                <a href="#section-3.5.6">3.5.6</a>   MP+STATE_REMOVE state machine...............<a href="#page-41">41</a>
                <a href="#section-3.5.7">3.5.7</a>   MP+STATE_CLOSE state machine................<a href="#page-44">44</a>
<a href="#section-4">4</a>.      PPP LCP Extensions..........................................<a href="#page-46">46</a>
<a href="#section-5">5</a>.      Security Considerations.....................................<a href="#page-47">47</a>
<a href="#section-6">6</a>.      References..................................................<a href="#page-47">47</a>
<a href="#section-7">7</a>.      Author's Address............................................<a href="#page-47">47</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>. Introduction</span>

   The PPP Multilink Protocol (MP), is a set of features that provide
   inverse multiplexing at the packet/fragment level by bundling
   multiple independent links between a fixed pair of systems, providing
   a virtual link with greater bandwidth than any of the constituent
   members.

   Once multiple channels have been established  MP is responsible for
   managing channel use to insure in-sequence delivery of user packets.

   MP+ is an extension to MP that adds an inband control channel to
   provide a new level of session management and control.

   MP+ also allows remote device management of (unconfigured) systems.
   This feature allows a network operations center to dial into an
   unconfigured system and remotely manage it, before ethernet
   interface, IP address, and other LCP and system configuration
   information is entered.  (This does require local configuration of
   the WAN interfaces to the extent required to answer an incoming
   call).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1%20Functional%20Description"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a> Functional Description</span>

   The features of MP+ include:

   * Ability to negotiate to add and subtract channels when bandwidth
     needs change.

   * Phone number management so calling stations need not know every
     possible number; answering stations can manage their own resources.

   * A simple remote management interface.





<span class="grey">Smith                        Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   To perform the above functions  MP+ is split into a call management
   layer and a reliable delivery layer.  The call management layer is
   the source and sink of  MP+ control messages.  The reliable delivery
   layer adds a simple acknowledge and retry mechanism.

   MP+ only takes network bandwidth when in the process of performing a
   user request, e.g. adding and subtracting bandwidth.

   NOTE: Neither MP, or MP+ define the process that makes the bandwidth
   requirement determination. That is outside the scope of either of
   these protocols and will likely be implementation dependent.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2%20%20Conventions"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>  Conventions</span>

   The following language conventions are used in the items of
   specification in this document:

      MUST,  SHALL or  MANDATORY -- the item is an absolute requirement
      of the specification.

      SHOULD or RECOMMENDED --   the item should generally be followed
      for all but exceptional circumstances.

      MAY or OPTIONAL --  the item is truly optional and may be followed
      or ignored according to the needs of the implementor.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20General%20Overview"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  General Overview</span>

   PPP
      In order to establish communications over a point-to-point link,
      each end of the PPP [<a href="#ref-2" title='"The Point-to-Point Protocol (PPP)"'>2</a>] link must first send LCP packets to
      configure the data link during  link establishment  phase.  After
      the link has been established, PPP provides for an  authentication
      phase.

   MP The goal of multilink operation is to  bundle  multiple
      independent links between a fixed pair of systems, providing a
      virtual link with greater bandwidth than any of the constituent
      members.

   MP+ MP+ is also negotiated during initial LCP option negotiation.  A
      system indicates to its peer that it is willing to do MP+ by
      sending the  MP+ option as part of the initial LCP option
      negotiation.  The  MP+  option MUST NOT be negotiated unless MP is
      also negotiated. When used, MP+ adds a virtual unit-to-unit
      control channel.

   A peer may elect to:



<span class="grey">Smith                        Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   Acknowledge both the MP and MP+ options, indicating that both MP and
   MP+ will be used.

   Acknowledge the MP option and reject the MP+ option. Operation will
   fall back to MP.

   Reject both options.  Standard PPP will be used for this connection.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20Operation"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>. Operation</span>

   Standard PPP
      In standard PPP the LCP negotiation phase is followed by an
      optional authentication phase, and then one or more NCPs are
      initiated.

   PPP with MP The LCP negotiation phase and authentication phase are
      identical to standard PPP.  The ability to initiate an MP
      aggregate data link is indicated by sending an MP option - as
      described in [<a href="#ref-1" title='"The PPP Multilink Protocol (MP)"'>1</a>].

   PPP with MP and MP+ When MP+ is negotiated at LCP startup, the same
      procedures are followed as when MP is negotiated alone.  The MP+
      LCP option is negotiated to indicate the ability to use the MP+
      feature.The first connection between endpoints causes the MP+
      process to be started for the connection.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20MP%2B%20Frame%20Formats"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  MP+ Frame Formats</span>

                    +---------------+---------------+
       PPP Header:  | Address 0xff  | Control 0x03  |
                    +---------------+---------------+
                    | PID(H)  0x00  | PID(L)  0x73  |
                    +-+-+-+-+-------+---------------+
       MP Header:   |1|1|0|0|0|0|0|1| seq # high    |
                    +-+-+-+-+-------+---------------+
                    |   sequence number low bits    |
                    +---------------+---------------+
                    |         control data          |
                    |               .               |
                    |               .               |
                    |               .               |
                    +---------------+---------------+
       PPP FCS:     |              FCS              |
                    +---------------+---------------+

   Figure 1: Multilink Plus Frame Format (long sequence number format)





<span class="grey">Smith                        Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


                    +---------------+---------------+
       PPP Header:  | Address 0xff  | Control 0x03  |
                    +---------------+---------------+
                    | PID(H)  0x00  | PID(L)  0x73  |
                    +-+-+-+-+-------+---------------+
       MP Header:   |1|1|0|1|  sequence number      |
                    +-+-+-+-+-------+---------------+
                    |         control data          |
                    |               .               |
                    |               .               |
                    |               .               |
                    +---------------+---------------+
       PPP FCS:     |              FCS              |
                    +---------------+---------------+

   Figure 2: Multilink Plus Frame Format (short sequence number format)

   MP+ frames use a similar structure to MP fragments.

   The MP+ assigned PID is designated 00 73.

   MP+ control uses the following two rules:

  - MP+ control frames have their own sequence number space,
    controlled by MP+.

  - MP+ control frames MUST NOT be fragmented.

NOTE: Implementations of this protocol prior to the date of submission
      of this specification to the IETF use the same PID as MP, but
      sets the LSB of the reserved bits in the MP header to 1 - this
      is how the MP+ packets are discriminated from MP fragments.
      So the header of the MP+ packet looks like:

                00 3d c1 ......

      As compared to an MP packet that looks like:

                00 3d c0 ......  or
                00 3d 80 ......  or
                00 3d 40 ......










<span class="grey">Smith                        Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20Error%20Control%20%28EC%29%20Layer%20%28MP%2B%20control%20only%29"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>. Error Control (EC) Layer (MP+ control only)</span>

   The error control layer that runs over the virtual inband channel is
   as simple as it can get, while handling the possibility of errors on
   the line.

   An assumption is made that errors are infrequent, and that at the
   same time messages are rarely, if ever, dropped on the floor. The
   implication of this is that "timing out" on retransmission of
   messages does no harm.  If a message cannot get through, then it
   simply is retried some number of times.  After giving up, the only
   recourse is to notify the call management layer (of MP) that the
   session has died.

                    +---------------+---------------+
       PPP Header:  | Address 0xff  | Control 0x03  |
                    +---------------+---------------+
                    | PID(H)  0x00  | PID(L)  0x73  |
                    +-+-+-+-+-------+---------------+
       MP+ Header:  |1|1|0|0|0|0|0|1| seq # high    |
                    +-+-+-+-+-------+---------------+
                    |   sequence number low bits    |
                    +---------------+---------------+
        EC Header:  | Error Control Message Type    |
                    |   32 bits reserved            |
                    +---------------+---------------+
         MP+ Data:  |    MP+ Message                |  May not be
                    |                               |  present.

   Figure 3: MP+ control message format (shown long sequence number
             format)

  Error Control Message Type:

   1      DATA_MSG:         This message contains MP+ data transferred
                            between the peers.

   2      ACK_MSG:          An acknowledgement of a previous data message.

   When set to DATA_MSG, the remainder of the frame contains an MP+
   Control message.

   When set to ACK_MSG, the remainder of the frame consists only of the
   PPP Frame Check Sum (FCS).







<span class="grey">Smith                        Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20Error%20Control%20State%20Machine"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>. Error Control State Machine</span>

   This layer is controlled by a simple state machine.  There are three
   states:

   Stopped        There is no connection between peers.

   Idle           There is a connection between peers;
                  no unacknowledged messages pending.

   Pending        There is a connection between peers;
                  awaiting an acknowledgement to the
                  last message sent.

   Messages from the call management layer are queued for transmission
   whenever the link is in the  pending  state.  For simplicity, only
   one outstanding message may be in the link at any given time.  The
   entire procedure is defined in table 1.

Event                           State
______________________________________________________________________
                                Stopped    Idle         Pending
======================================================================
Start                           1,Idle     -,*          -,*
______________________________________________________________________
Received ACK_MSG                **         2,Start      5,Idle|Pending
current tx sequence number
______________________________________________________________________
Received ACK_MSG                **         -,*          -,*
last tx sequence number
______________________________________________________________________
Received ACK_MSG                **         2,Start      2,Start
other tx sequence number
______________________________________________________________________
Received DATA_MSG               **         6,*          6,*
current rx sequence number
______________________________________________________________________
Received DATA_MSG               **         7,*          7,*
previous rx sequence number
______________________________________________________________________
Received DATA_MSG               **         2,Start      2,Start
other rx sequence number
______________________________________________________________________
Receive Invalid Frame           **         2,Start      2,Start
______________________________________________________________________
Retransmit Timer Expire         **         **           4,Start|*
______________________________________________________________________




<span class="grey">Smith                        Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


______________________________________________________________________
Transmit Request from call      -,*        3,Pending    8,*
management layer
______________________________________________________________________
Stop                            9,Start    9,Start      9,Start
______________________________________________________________________

                  Table 1: Error Control State Machine

Legend:

        -       No action

        *       Stay in same state

        **      Invalid or meaningless event for state, ignored.

Notes:

   [<a id="ref-1" name="ref-1">1</a>] Data from the call management layer will always be copied before
       being queued for transmission.  The call management layer is
       responsible for its own buffers.

   [<a id="ref-2" name="ref-2">2</a>] MP always copies data for transmission and returns immediately.
       Any buffers allocated to build control messages MUST be released
       immediately upon return from MP transmission requests.

Actions:

   1       Reset rx sequence number
           Reset tx sequence number
           Reset tx retransmit count
           Stop retransmit timer

   2       Report error to user
           Stop retransmit timer
           Stop frame transmit timer
           Free buffers

   3       Save call management message in pending transmit queue
           Build DATA_MSG from first message in pending transmit
           queue using current tx sequence number.
           Send message to MP for transmission.
           Reset tx retransmit count







<span class="grey">Smith                        Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   4       Increment tx retransmit count
           If tx retransmit count &gt;= RETRANSMIT_COUNT
                   Action 2 (followed by state change to the Start state)
           else
                   Build DATA_MSG from first message in pending
                   transmit queue using current tx sequence number.
                   Send message to MP for transmission.

   5       Dequeue first element on pending transmit queue and release
           its buffer
           Increment the tx sequence number
           Stop the retransmit timer
           if pending transmit queue not empty
                   Build DATA_MSG from first message in pending
                   transmit queue using current tx sequence number.
                   Send message to MP for transmission.
                   Reset tx retransmit count

   6       Build ACK_MSG using the current rx sequence number
           Send ack message to MP for transmission
           Pass message to call managment layer
           Increment rx sequence number

   7       Build ACK_MSG using the previous rx sequence number
           Send the ack message to MP for transmission

   8       Add the message to the end of the pending transmit queue

   9       Stop retransmit timer
           Free buffers

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20Multilink%20Plus%20Control%20Messages"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>. Multilink Plus Control Messages</span>

    Message Type                Value
    VERSION_EXCHANGE_REQ        1
    VERSION_EXCHANGE_RSP        2
    ADD_REQ                     3
    ADD_RSP                     4
    ADD_COMPLETE                5
    REMOVE_REQ                  6
    REMOVE_RSP                  7
    REMOVE_COMPLETE             8
    CLOSE_REQ                   9
    CLOSE_RSP                   10
    REMOTE_MGMT_REQ             11
    REMOTE_MGMT_RSP             12
    REMOTE_MGMT_RX_REQ          13
    REMOTE_MGMT_TX_REQ          14



<span class="grey">Smith                        Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


    REMOTE_MGMT_TX_RSP          15
    CLEAR_REQ                   16

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20Multilink%20Plus%20Message%20Formats"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>. Multilink Plus Message Formats</span>

   The fields of all messages defined here MUST be encoded/decoded in
   Network Byte Order (big endian).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20VERSION_EXCHANGE_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>. VERSION_EXCHANGE_REQ Message Format</span>

   The version exchange message is sent by the call originator to inform
   the answerer the version of the MP+ protocol being used as well as
   any other information that may need to be conveyed outside of the
   normal PPP parameter negotiation.

   +---------------+---------------+
   |         Message type          |
   |          0x00000001           |
   +---------------+---------------+
   |       Protocol Version        |
   +---------------+---------------+
   |      Protocol Revision        |
   +---------------+---------------+
   |       Session Identifier      |
   +---------------+---------------+
   |         Hardware Type         |
   +---------------+---------------+
   |          Nailed Mode          |
   +---------------+---------------+
   |   Use Multiple Trunk Groups   |
   +---------------+---------------+
   |       Descriptor Length       |
   +---------------+---------------+
   |          Descriptor           |
   +---------------+---------------+

   Figure 4:  Version Exchange Request

   A message sent from call originator to call answerer specifying the
   callers protocol version and other state info and requesting the
   answerer to respond with its version info.

   Protocol Version:
           caller MP+ protocol version number.
           2 octets fixed length (initially 1)






<span class="grey">Smith                        Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   Protocol Revision:
           caller MP+ protocol revision number.
           2 octets fixed length (initially 4)

   Session Identifier:
           A non-zero identifier unique to the caller.
           2 octets fixed length.

   Hardware Type:
           caller hardware type (can be vendor defined).
           2 octets fixed length.

   Nailed Mode:
           caller nailed mode from the session profile.
           2 octets fixed length.

   Use Multiple Trunk Groups:
           non-zero if the call may use channels from multiple trunk
           groups.
           2 octets fixed length

   Descriptor Length:
           length of the end point descriptor.
           2 octets fixed length

   Descriptor:
           the end point descriptor. This field allows for vendor
           specific identification of the peer.
           Variable length as defined above.






















<span class="grey">Smith                        Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20VERSION_EXCHANGE_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>. VERSION_EXCHANGE_RSP Message Format</span>

   The version exchange response message is sent by the call answerer in
   response to a version exchange request message.   The answerer uses
   the message to inform the caller the version of the MP+ protocol
   being used as well as any other information that needs to be conveyed
   outside of the normal PPP parameter negotiation.

   +---------------+---------------+
   |         Message type          |
   |          0x00000002           |
   +---------------+---------------+
   |      Protocol Version         |
   +---------------+---------------+
   |     Protocol Revision         |
   +---------------+---------------+
   |       Session Identifier      |
   +---------------+---------------+
   |         Hardware Type         |
   +---------------+---------------+
   |          Nailed Mode          |
   +---------------+---------------+
   |   Use Multiple Trunk Groups   |
   +---------------+---------------+
   |       Descriptor Length       |
   +---------------+---------------+
   |         Descriptor            |
   +---------------+---------------+

   Figure 5: Version Exchange Response

   A message sent from call answerer to the call originator specifying
   the answerers protocol version and other state info.  Sent in
   response to receiving a version exchange request.

   Protocol Version:
           caller MP+ protocol version number.
           2 octets fixed length (initially 1)

   Protocol Revision:
           caller MP+ protocol revision number.
           2 octets fixed length (initially 4)

   Session Identifier:
           A non-zero identifier unique to the answerer.
           2 octets fixed length.





<span class="grey">Smith                        Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   Hardware Type:
           caller hardware type (can be vendor defined).
           2 octets fixed length.

   Nailed Mode:
           caller nailed mode from the session profile.
           2 octets fixed length.

   Use Multiple Trunk Groups:
           non-zero if call may use channels from multiple trunk groups.
           2 octets fixed length

   Descriptor Length:
           length of the remote descriptor in 4-octet units.
           2 octets fixed length

   Descriptor:
           the remote unit descriptor. This field allows for vendor
           specific identification of the peer.
           Variable length Nx4 octets long - total length defined above.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.3.%20ADD_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.3" name="section-3.3.3">3.3.3</a>. ADD_REQ Message Format</span>

   A message of this type is sent by either caller or answerer to
   initiate an increase of bandwidth.  When sent by the caller the
   request is asking for permission to dial a certain number of
   channels; the response will contain permission and the phone numbers
   of the channels to dial.  When sent by the answerer, this message
   contains the phone numbers to dial.  The message looks like:

   +---------------+---------------+
   |         Message type          |
   |          0x00000003           |
   +---------------+---------------+
   | Number of channels requested  |
   +---------------+---------------+
   |    Number of phone numbers    |
   +---------------+---------------+
   |    A phone number list for    |
   |      each phone number        |
   |               .               |
   |               .               |
   |               .               |
   +---------------+---------------+

   Figure 6: Add Request





<span class="grey">Smith                        Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   A message sent by either caller or answerer to request that additional
   bandwidth be added to a session.

   Number of channels requested:
           The maximum number of channels to add.
           2 octets fixed length.

   Number of phone numbers:
           The number of phone numbers provided.  This
           value will always be zero when the caller
           initiates an add and will be at least
           Number of channels requested when the answerer
           initiates the add.
           2 octets fixed length.

   Phone number list:
           A list of up to 32 phone number lists
           containing the phone numbers to call.
           Each description is of fixed length as described below:

           Each phone number is represented by a phone number list.
           The format of a phone number list is:

   +---------------+---------------+
   |          in use flag          |
   +---------------+---------------+
   |        call service type      |
   +---------------+---------------+
   |         Phone number          |
   |          20 octets            |
   |     plus null terminator      |
   |       (21 octet total)        |
   |                               |
   |                               |
   |                               |
   |                               |
   |                               |
   |                               |
   |               +---------------+
   |               |  Must be 0    |
   +---------------+---------------+
   |           must be 0           |
   +---------------+---------------+

   Figure 7: Phone number list






<span class="grey">Smith                        Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   A structure containing information about a connection within the
   system.

   in use flag:
           non-zero if the phone number indicated
           in this descriptor is currently in use.
           2 octets fixed length

   call service type:
           Defines the type of service, switched, nailed,
           or other, associated with a phone number.
           1       Nailed
           2       Switched
           &gt;=3     Undefined

   Phone number:
           The null terminated phone number of this channel.
           Fixed length 21 octets. Each octet contains IA5 character
           representation of a digit (or #, *).

   Must be 0:
           Filler to force alignment to 32-bit boundary.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.4%20ADD_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.4" name="section-3.3.4">3.3.4</a> ADD_RSP Message Format</span>

   A message of this type gives permission to dial some number of
   channels and, when sent by the answerer of the original call, gives
   the phone numbers of channels to dial.

   +---------------+---------------+
   |         Message type          |
   |          0x00000004           |
   +---------------+---------------+
   |  Number of channels allowed   |
   +---------------+---------------+
   |    Number of phone numbers    |
   +---------------+---------------+
   |   A  phone number list for    |
   |      each phone number        |
   |               .               |
   |               .               |
   |               .               |
   +---------------+---------------+

   Figure 8: Add Response






<span class="grey">Smith                        Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   A message sent by either caller or answerer to indicate the number of
   channels that may be added to a session.

   Number of channels allowed:
           The actual number of channels to add.  This
           may be less than the number requested.
           2 octets fixed length.

   Number of phone numbers:
           The number of phone numbers provided.  This
           value will always be zero when sent by the
           caller and will be at least channelCount
           when sent by the answerer.
           2 octets fixed length.

   Phone number list:
           A list of up to 32 phone number lists
           containing the phone numbers to call.
           Each description is of fixed length as described above.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.5.%20ADD_COMPLETE%20Message%20Format"></a><a class="selflink" href="#section-3.3.5" name="section-3.3.5">3.3.5</a>. ADD_COMPLETE Message Format</span>

   This message is sent by the caller to the answerer after all calls
   have been placed.  The message is used to notify the answerer that
   the add transaction is complete and it may return to the idle state.

   +---------------+---------------+
   |         Message type          |
   |          0x00000005           |
   +---------------+---------------+
   |       Channels added          |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 9: Add Complete

   A message sent by caller to indicate the number of channels that were
   added successfully. This message was added in MP+ Version 1.1.

   Channels added:
           The actual number of channels added.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length




<span class="grey">Smith                        Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.6.%20REMOVE_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.6" name="section-3.3.6">3.3.6</a>. REMOVE_REQ Message Format</span>

   A message of this type is sent when a peer decides, for any reason,
   to remove channels from use.  The purpose of the message is to tell
   the remote end of the remove and give it a chance to adjust the
   number of channels to remove.

   +---------------+---------------+
   |         Message type          |
   |          0x00000006           |
   +---------------+---------------+
   | Number of channels to remove  |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 10: Remove Request

   A message sent by either caller or answerer to request that bandwidth
   be removed from a session.

   Number of channels to remove:
           The maximum number of channels to remove.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.7.%20REMOVE_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.7" name="section-3.3.7">3.3.7</a>. REMOVE_RSP Message Format</span>

   This message is sent in response to a remove request.  The responder
   specifies the number of channels that can be removed.  If the
   response specifies 0 channels the remove is cancelled.

   +---------------+---------------+
   |         Message type          |
   |          0x00000007           |
   +---------------+---------------+
   | Number of channels to remove  |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 11: Remove Response






<span class="grey">Smith                        Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   A message sent in response to a remove request specifying the number
   of channels that the peer agrees can be removed.

   Number of channels to remove:
           The maximum number of channels to remove.
           May be zero, in which case the remove is
           cancelled.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.8.%20REMOVE_COMPLETE%20Message%20Format"></a><a class="selflink" href="#section-3.3.8" name="section-3.3.8">3.3.8</a>. REMOVE_COMPLETE Message Format</span>

   This message is sent by the initiator of a remove transaction when
   the agreed upon number of channels have been removed.  The message is
   used to notify the peer that the remove transaction is complete and
   it may return to the idle state.

   +---------------+---------------+
   |         Message type          |
   |          0x00000008           |
   +---------------+---------------+
   | Number of channels removed    |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 12: Remove Complete

   A message sent by the caller or answerer to indicate how many channels
   were actually removed. This message was added in MP+ CM version 1.1.

   Number of channels removed:
           The number of channels that were removed.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length










<span class="grey">Smith                        Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.9.%20CLOSE_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.9" name="section-3.3.9">3.3.9</a>. CLOSE_REQ Message Format</span>

   This message is sent when the peer requests to close the whole
   session.  This is typically due to a configuration option that
   indicates when a system should request to close the session (an
   example being, a link has been idle for greater than a preconfigured
   time period).

   +---------------+---------------+
   |         Message type          |
   |          0x00000009           |
   +---------------+---------------+

   Figure 13: MP+ close request.

   There are no data fields associated with this message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.%20CLOSE_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.10" name="section-3.3.10">3.3.10</a>. CLOSE_RSP Message Format</span>

   If the peer agrees that closing the session is acceptable based on
   it's own configuration (an example reject reason would be that the
   peer is configured with a *minimum* number of channels to keep
   active).

   +---------------+---------------+
   |         Message type          |
   |          0x0000000a           |
   +---------------+---------------+
   |          OK To Close          |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 14: MP+ close response

   The response to a close request. May be sent by caller or answerer.

   OK To Close:
           If non-zero, peer said I can close all channels.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length







<span class="grey">Smith                        Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.%20REMOTE_MGMT_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.11" name="section-3.3.11">3.3.11</a>. REMOTE_MGMT_REQ Message Format</span>

   This message is sent from a master station to a slave station when
   the master wishes to manage the remote station.  The message is also
   used to cancel remote management once it's been started.

   +---------------+---------------+
   |         Message type          |
   |          0x0000000b           |
   +---------------+---------------+
   |              Mode             |
   +---------------+---------------+
   |          Must be zero         |
   +---------------+---------------+

   Figure 15: Remote Management Request

   A message sent from master to slave to initiate or clear a remote
   management session.

   Mode:
           One to start session. Zero to stop session.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.12.%20REMOTE_MGMT_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.12" name="section-3.3.12">3.3.12</a>. REMOTE_MGMT_RSP Message Format</span>

   The slave side of a remote management session has the opportunity to
   reject remote management.  The master side is informed of accept/deny
   status via the remote management response.

   +---------------+---------------+
   |         Message type          |
   |          0x0000000c           |
   +---------------+---------------+
   |              Mode             |
   +---------------+---------------+

   Figure 16: Remote Management Response

   A message sent from slave to master to allow or deny initiation of a
   remote management session.






<span class="grey">Smith                        Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   Mode:
           One to accept session. Zero to deny session.
           2 octets fixed length

   Must be zero:
           Padding to 32-bit boundary.
           2 octets fixed length

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.13.%20REMOTE_MGMT_RX_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.13" name="section-3.3.13">3.3.13</a>. REMOTE_MGMT_RX_REQ Message Format</span>

   This message type is used to convey keyboard input from the
   management master to be processed by the management slave.  The
   message format consists of an octet count (in network byte order) and
   then an array of octets to be processed.  It looks like:

   +---------------+---------------+
   |         Message type          |
   |          0x0000000d           |
   +---------------+---------------+
   |         character count       |
   +---------------+---------------+
   |      array of characters      |
   |               .               |
   |               .               |
   |               .               |
   +---------------+---------------+

   Figure 17: Remote Management Receive Request

   A message sent from master to slave, conveying keystrokes typed on the
   masters keyboard that will be processed by the slave.

   character count:
           Number of characters to process.
           2 octets fixed length

   array of characters:
           Array of characters to process.













<span class="grey">Smith                        Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.14.%20REMOTE_MGMT_TX_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.14" name="section-3.3.14">3.3.14</a>. REMOTE_MGMT_TX_REQ Message Format</span>

   The remote management slave conveys output to be displayed on the
   masters terminal with a remote management transmit request message.
   Only one message may be outstanding.  The next transmit request may
   not be sent until the previous has been acknowledged.

   +---------------+---------------+
   |         Message type          |
   |          0x0000000e           |
   +---------------+---------------+
   |         character count       |
   +---------------+---------------+
   |      array of characters      |
   |               .               |
   |               .               |
   |               .               |
   +---------------+---------------+

   Figure 18: Remote Management Transmit Request

   A message sent from slave to master, conveying output to be output on
   the master's display.

   Character count:
           Number of characters to process.
           2 octets fixed length

   array of characters:
           Array of characters to process.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.15.%20REMOTE_MGMT_TX_RSP%20Message%20Format"></a><a class="selflink" href="#section-3.3.15" name="section-3.3.15">3.3.15</a>. REMOTE_MGMT_TX_RSP Message Format</span>

   This message is used to acknowledge remote management transmit
   requests.  The slave may send the next transmit request once this
   message has been received.

   +---------------+---------------+
   |         Message type          |
   |          0x0000000f           |
   +---------------+---------------+

   Figure 19: Remote Management Transmit Response

   There are no data fields associated with this message.






<span class="grey">Smith                        Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.16.%20CLEAR_REQ%20Message%20Format"></a><a class="selflink" href="#section-3.3.16" name="section-3.3.16">3.3.16</a>. CLEAR_REQ Message Format</span>

   A message sent to initiate a friendly shutdown of an  MP+ link.  The
   sender will stop sending data immediately.  The receiver of the
   message will also stop sending user data and start a clean shutdown
   of all NCPs and the LCP of each member link of the bundle.  When the
   last member link terminates, the session is completely closed.

   +---------------+---------------+
   |         Message type          |
   |          0x00000010           |
   +---------------+---------------+

   Figure 20: Clear Request

   There are no data fields associated with this message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20Events"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>. Events</span>

   The MP+ state machine is event driven. Reception of an event triggers
   an action and possibly a state change. The events processed by the
   MP+ state machine can be roughly classed into two types:

      Events that originate within the unit, e.g. notification that a
      call has cleared, an  MP+ session may be started, etc.

      Events that originate with the reception of an  MP+ control
      message from the peer unit.

   Both types are processed by the state machine in the sequence they
   occurred. The events processed are:

   MP+START_SESSION:    Notification from PPP/MP that an
                        MP+ session is starting.

   MP+SESSION_DOWN:     Notification from the error-control
                        layer that end-to-end connectivity
                        has been lost and control messages can
                        not be delivered.

   MP+SESSION_TERM:     Session termination notification from
                        PPP/MP.  This event is not sent until
                        the last channel of a multi-channel
                        session is cleared.

   MP+TIMER_EXPIRED:    Timers are used in various states and
                        sub-states.  This event is signaled whenever
                        a timer expires.



<span class="grey">Smith                        Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>



   MP+CALL_COMPLETE:    A call placed during an add request has
                        completed.  The call may have succeeded or
                        failed.

   MP+UTILIZATION:      Notification from MP/PPP that link
                        utilization has crossed a threshold and that
                        channels may need to be added/removed.
                        (The number of channels to add/remove will be
                         passed with the notification).

   MP+RX_VERSION_REQ:   A Version Exchange request message has
                        been received from the peer.

   MP+RX_VERSION_RSP:   A Version Exchange response message has
                        been received from the peer.

   MP+ADD_REQ:          An Add request message has been received
                        from the peer.

   MP+ADD_RSP:          An Add response message has been received
                        from the peer.

   MP+ADD_COMP:         An Add Complete message has been received
                        from the peer.


   MP+REMOVE_REQ:       A Remove request message has been received
                        from the peer.

   MP+REMOVE_RSP:       A Remove response message has been
                        received from the peer.

   MP+REMOVE_COMP:      A Remove Complete message has been received
                        from the peer.

   MP+RX_RM_REQ:        A Remote Management request has been received
                        from the peer.

   MP+RX_RM_RSP:        A Remote Management response has been received
                        from the peer.

   MP+RX_RM_RX_REQ:     A Remote Management Receive Request has been
                        received from the far end.

   MP+RX_RM_TX_REQ:     A Remote Management Transmit Request has
                        been received from the peer.




<span class="grey">Smith                        Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   MP+RX_RM_TX_RSP:     A Remote Management Transmit Response has
                        been received from the peer.

   MP+RX_CLEAR:         A request to shut down the session has been
                        received from the peer.

   MP+CLOSE_REQ:        A Close Request message has been received
                        from the peer.

   MP+CLOSE_RSP:        A Close Response message has been received
                        from the peer.

   MP+START_RM          Request to start a remote management session
                        with this station being the master.

   MP+SEND_RMS:         Request to send data to a remote management
                        master from a slave.

   MP+SEND_RMM:         Request to send data to a remote management
                        slave from a master.

   MP+RECV_RMM:         Request to send an ack to a remote management
                        slave for data received from the slave.

   MP+STOP_RM:          Request to stop a remote management session.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20State%20Machine"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>. State Machine</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.1%20States"></a><a class="selflink" href="#section-3.5.1" name="section-3.5.1">3.5.1</a> States</span>

   To ease readability and understanding the major states are considered
   as separate state machines, each having two to four sub-states. The
   sub-states are named by the letters, A, B, C, and D. State
   information is maintained for every interface.

   The major states are:

   MP+STATE_INITIAL: The state of an unused session. Session table
                     entries are intialized to this state at startup
                     and return to this state when sessions are
                     terminated.

   MP+STATE_IDLE:    The state of an active session that is not
                     performing any MP+ function.

   MP+STATE_ADD:     The state of a session when an add transaction is
                     in progress.




<span class="grey">Smith                        Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   MP+STATE_REMOVE:  The state of a session when a remove transaction is
                     in progress.

   MP+STATE_CLOSE:   The state of a session that is in the process of
                     being closed.

   State transitions are triggered by the reception of an event.  Tables
   2 through 6 contain the state tables for the major states.  All state
   tables use the following symbols.

        -       No action

        *       Stay in same state

        +       Target state is defined by the action taken

        **      An error has occurred, log an error message but no
                state change.

   States and sub-state transitions are noted as state:sub-state, e.g.,
   initial:A.  Alternative transitions are listed on separate lines.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.2%20Common%20Actions"></a><a class="selflink" href="#section-3.5.2" name="section-3.5.2">3.5.2</a> Common Actions</span>

   Some actions are common to all states, they are defined here.

Error Close Action

        Called to close a session when an error occurs. Actions are:

        [<a id="ref-1" name="ref-1">1</a>]  Stop timer if running.

        [<a id="ref-2" name="ref-2">2</a>]  Log an error message.

        [<a id="ref-3" name="ref-3">3</a>]  Close the MP+EC layer for this session.

        [<a id="ref-4" name="ref-4">4</a>]  Close MP for this session

        [<a id="ref-5" name="ref-5">5</a>]  Clean up, restore state variables to their initial state.

Term Action

        Processed when a MP+SESSION_TERM event occurs in most states.
        Actions are:

        [<a id="ref-1" name="ref-1">1</a>]  Stop timer if running.

        [<a id="ref-2" name="ref-2">2</a>]  Close the  MP+EC layer for this session.



<span class="grey">Smith                        Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


        [<a id="ref-3" name="ref-3">3</a>]  Call the passed termination callback function if not null.

        [<a id="ref-4" name="ref-4">4</a>]  Clean up, restore state variables to their initial state.

Ignore Action

        We don't care about this event in this state.  Do nothing.

Timer Action

        This action is called when a timer expires in one of the on-line
        states. The timer is used to implement add and remove locks.  A
        lock is set when an add or remove fails and is not cleared until
        a bandwidth change or the timer expires. This keeps us from
        retrying add's and subtracts until there is a likelyhood that it
        will succeed.

        [<a id="ref-1" name="ref-1">1</a>]  Check add lock flag.

                [<a id="ref-1" name="ref-1">1</a>] If set an add lock occured last timeout period so
                triple the timeout value (to a max of 81 minutes).

                [<a id="ref-2" name="ref-2">2</a>] If not set restore the timeout value to its initial
                value of one minute.

        [<a id="ref-2" name="ref-2">2</a>]  Clear the add lock flag.

        [<a id="ref-3" name="ref-3">3</a>]  Clear the remove lock flag.

        [<a id="ref-4" name="ref-4">4</a>]  Restart the retry timer.

Enter Remove [local] Action

        The local unit is initiating a remove transaction. The desired
        bandwidth is given.

        [<a id="ref-1" name="ref-1">1</a>]  Restart the idle timer.

        [<a id="ref-2" name="ref-2">2</a>]  Calculate number of channels to remove (difference between
        number in use and number in desired).

        [<a id="ref-3" name="ref-3">3</a>]  Build and send a remove request and send to remote.

        [<a id="ref-4" name="ref-4">4</a>]  Go to REMOVE:A.







<span class="grey">Smith                        Informational                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Enter Remove [remote] Action

        The remote unit is initiating a remove transaction. The incoming
        message contains the number of channels to remove.

        [<a id="ref-1" name="ref-1">1</a>]  Restart the idle timer.

        [<a id="ref-2" name="ref-2">2</a>]  Request the number of channels required. If greater than the
        number available after removing the number of channels indicated
        in the incoming message reduce the number of channels to remove
        and set a remove lock.

        [<a id="ref-3" name="ref-3">3</a>] Build a remove response message indicating the number of
        channels we will allow the requester to remove and send to the
        remote.

        [<a id="ref-4" name="ref-4">4</a>]  Go to  REMOVE:B.

Enter Add [local] Action

        The local unit is initiating an add transaction.  We are given
        the number of channels desired.  The steps are:

        [<a id="ref-1" name="ref-1">1</a>]  Restart the idle timer.

        [<a id="ref-2" name="ref-2">2</a>]  Calculate number of channels to add (difference between
        number desired and number in use).

        [<a id="ref-3" name="ref-3">3</a>]  Reserve number of channels, retrieving their phone numbers.

        [<a id="ref-4" name="ref-4">4</a>]  If number of channels reserved less than the number desired
        set an add lock.

        [<a id="ref-5" name="ref-5">5</a>]  If number of channels reserved greater than zero.

                [<a id="ref-1" name="ref-1">1</a>] Build an add request. If the answerer the request
                includes the phone numbers for the caller to dial.

                [<a id="ref-2" name="ref-2">2</a>] If caller, go to ADD:A.

                [<a id="ref-3" name="ref-3">3</a>] If answerer, go to ADD:C.

        [<a id="ref-6" name="ref-6">6</a>]  Go to  IDLE state.








<span class="grey">Smith                        Informational                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Enter Remove [remote] Action

        The remote unit is initiating a remove transaction.  The
        incoming  message contains the number of channels to remove.

        [<a id="ref-1" name="ref-1">1</a>]  Clear the remove lock.

        [<a id="ref-2" name="ref-2">2</a>]  Restart the idle timer.

        [<a id="ref-3" name="ref-3">3</a>]  Request the number of channels required.   If  greater
        than the number available after removing the number of
        channels indicated in the incoming message reduce  the
        number of channels to remove.

        [<a id="ref-4" name="ref-4">4</a>]  Build  a remove response message indicating the number
        of channels we will allow the requester to remove  and
        send to the remote.

        [<a id="ref-5" name="ref-5">5</a>]  Go to REMOVE, sub-state B.

Enter Add [remote answerer] Action

        We've received a message from  the  remote  requesting  that
        bandwidth  be  added.   The  message  contains the number of
        channels to add.  Since the remote is the answerer, the mes-
        sage  also  contains the phone nubmers to dial.  We may dial
        less than the number requested.

        [<a id="ref-1" name="ref-1">1</a>]  Restart idle timer.

        [<a id="ref-2" name="ref-2">2</a>]  If the number of channels requested will put  us  over
        the maximum number of channels allowed for the session
        reduce the channel count.

        [<a id="ref-3" name="ref-3">3</a>]  For each channel to add,

                [<a id="ref-1" name="ref-1">1</a>] Integrate the phone  number  returned  from  the
                answerer  with the original phone number dialed.

                [<a id="ref-2" name="ref-2">2</a>] Request that a session be  extended  by  dialing
                the  integrated  phone  number.   A  callback is
                passed with the request so call success or fail-
                ure can be reported back to MP+.

        [<a id="ref-4" name="ref-4">4</a>]  Go to ADD:B.  Note:  This change must actu-
        ally occur before requesting the first outgoing  call.
        If  not,  the  callback  could be called (and ignored)
        because the session is not in the correct state.



<span class="grey">Smith                        Informational                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Enter Add [remote caller] Action

        We've  received  a  message  from the remote requesting that
        bandwidth be added.  The  message  contains  the  number  of
        channels  to  add.  Since the remote is the caller, it needs
        us to send the phone numbers to dial.   We  may  send  fewer
        phone numbers than requested

        [<a id="ref-1" name="ref-1">1</a>]  Restart idle timer.

        [<a id="ref-2" name="ref-2">2</a>]  If  the  number of channels requested will put us over
        the maximum number of channels allowed for the session
        reduce the channel count.

        [<a id="ref-3" name="ref-3">3</a>]  Reserve  the  adjusted  number of channels, retrieving
        their phone numbers.

        [<a id="ref-4" name="ref-4">4</a>]  If the number of channels reserved is  less  than  the
        adjusted number requested.

        [<a id="ref-5" name="ref-5">5</a>]  Build an add response  message,  including  the  phone
        numbers  for  the  channels we will let the caller add
        and send it to the far end.

        [<a id="ref-6" name="ref-6">6</a>]  Go to ADD:C.

Enter Idle Action

        The IDLE state is entered at the end of normal transactions.
        At  entry  the  current  status  of the connection should be
        checked and new transactions initiated if necessary.  To  be
        safe,  we  can  also  use this state as a catch all place to
        release any bandwidth reserved for adds.  The  functions  to
        perform are:

        [<a id="ref-1" name="ref-1">1</a>]  Restart  the idle timer using the current retry value.

        [<a id="ref-2" name="ref-2">2</a>]  Release any reserved bandwidth not actually in use.

        [<a id="ref-3" name="ref-3">3</a>]  Check if bandwidth change reqested during last  trans-
             action.  If change indicated:

                [<a id="ref-1" name="ref-1">1</a>]  Query channel counts.

                [<a id="ref-2" name="ref-2">2</a>]  If  current  bandwidth less than suggested band-
                     width and removes  are  not  locked,  store  the
                     requested bandwidth and initiate a remove trans-
                     action (Enter Remove Action).



<span class="grey">Smith                        Informational                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>



                [<a id="ref-3" name="ref-3">3</a>]  If  current  bandwidth  greater  than  suggested
                     bandwidth and adds are not locked:

                       [<a id="ref-1" name="ref-1">1</a>]  Store the requested bandwidth.

                       [<a id="ref-2" name="ref-2">2</a>]  Intiate  an  add  transaction  (Enter  Add
                            [local] Action).

       [<a id="ref-4" name="ref-4">4</a>]  Go to the IDLE state.

Remote Management Request Action

        We received a request to start/stop remote management.
        If this is a start request
                If we can/allow remote management:
                        Build and send a Remote management response Allow
                        message.
                Else
                        Build and send a Remote management response Deny
                        message.
        Else (this is a stop)
                Notify the remote management slave process to terminate.

Remote Management Response Action

        We received a response to our remote management start request.
        If the response was an Allow response
                Notify the remote management master process, we can
                start sending keystrokes/commands
        Else
                The peer denied the request, so notify the remote
                management master process of failure.

Remote Management Receive Data Action

        We (the slave) received data from the remote management master.
        Pass the received data to the remote management slave process.
        This is typically keystroke data received from the remote user
        interface.

Remote Management Transmit Data Action

        We (the master) received data from the remote management slave.
        Pass the received data to the remote management master process.
        This is typically screen-updates to be passed to the user
        interface.




<span class="grey">Smith                        Informational                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Remote Management Transmit Data Response Action

        We (the slave) received an ack to data we previously sent to the
        master. Notify the remote management slave process so that it
        can queue further transmissions.

Remote management (Master) start Action

        Build a REMOTE_MGMT_REQ start message and send to the far end.
        Send a proceeding message to the RM master process.

Remote management (Slave) data Action

        Build a REMOTE_MGMT_TX_REQ message with the data passed from
        the remote management slave process, send it to the far end.

Remote management (Master) data Action

        Build a REMOTE_MGMT_RX_REQ message with data passed from the
        remote management master process, send it to the far end.

Remote management data acknowledgement Action

        Build a REMOTE_MGMT_TX_RSP message and send it so the slave can
        send the next block. There is no data associated with this
        message.

Remote management (Master) stop Action

        Build a REMOTE_MGMT_REQ stop message and send to the far end.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.3.%20MP%2BSTATE_INITIAL%20state%20machine"></a><a class="selflink" href="#section-3.5.3" name="section-3.5.3">3.5.3</a>. MP+STATE_INITIAL state machine</span>

   All sessions start from this state, sub-state A. The state is not
   exited until version exchange succeeds.

   The sub-states are:

        A       Initial state
        B       Sent version request, waiting for version response.
        C       Waiting for version request.










<span class="grey">Smith                        Informational                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Event                                   Sub-state
______________________________________________________________________
                           A                    B               C
======================================================================
MP+START_SESSION           1,+                  **              **
______________________________________________________________________
MP+SESSION_DOWN            **              2,Initial:A    2,Initial:A
______________________________________________________________________
MP+SESSION_TERM            **              3,Initial:A    3,Initial:A
______________________________________________________________________
MP+TIMER_EXPIRED           **              4,Initial:A    7,Initial:B
______________________________________________________________________
MP+RX_VERSION_REQ          **              8,Initial:A         5,+
______________________________________________________________________
MP+RX_VERSION_RSP          **                  6,+             **
______________________________________________________________________
MP+START_RM               9,*                  9,*             9,*
______________________________________________________________________
All other events           **                  **              **
______________________________________________________________________

                    Table 2:  Initial State Machine

Actions:

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20%20%20%20%20%20%20Start%20timer%2C%2060%20seconds%20if%20originator%2C%2030%20seconds%20if%20answerer."></a><a class="selflink" href="#section-1" name="section-1">1</a>       Start timer, 60 seconds if originator, 30 seconds if answerer.</span>

        Start MP+

        If originator

                Build and send version exchange request

                Go to INITIAL, sub-state B.

        Go to INITIAL, sub-state C.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-2" name="section-2">2</a>       Do  </span>Error Close Action, go to INITIAL, sub-state A.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-3" name="section-3">3</a>       Do  </span>Term Action, go to INITIAL, sub-state A.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-4" name="section-4">4</a>       Do  </span>Error Close Action, go to INITIAL, sub-state A.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20%20%20%20%20%20%20Stop%20the%20idle%20timer."></a><a class="selflink" href="#section-5" name="section-5">5</a>       Stop the idle timer.</span>

        Compare protocol versions, if they do not match Do Error Close
        Action, go to  INITIAL, sub-state A.




<span class="grey">Smith                        Informational                     [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


        Store off info received from remote.

        Build a version exchange response and send to remote end.

        Do  Enter Idle Action  which causes a state change.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20%20%20%20%20%20%20Stop%20the%20retry%20timer."></a><a class="selflink" href="#section-6" name="section-6">6</a>       Stop the retry timer.</span>

        Compare protocol versions, if they do not match Do Error Close
        Action, go to INITIAL, sub-state A.

        Store off info received from remote.

        Check the base channel count in the callers profile.

        If greater than 1

                Set the requested bandwidth to the base channel count.

                Do  Enter Add Caller  action which causes a state change.

        Do  Enter Idle Action  which causes a state change.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7%20%20%20%20%20%20%20Both%20sides%20think%20they%20are%20the%20answerer.%20This%20is%20possible%20if%20both"></a><a class="selflink" href="#section-7" name="section-7">7</a>       Both sides think they are the answerer. This is possible if both</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/dial%20each%20other%20at%20the%20same%20time%20and%20the%20first%20channel%20that"></a>        dial each other at the same time and the first channel that</span>
        completed PPP negotiation happened to be the channel associated
        with the incoming call on both units. We resolve this by trying
        to become the originator.
        If both sides try to become the originator the one with the
        largest endpoint discriminator will fall back to being the
        answerer.

                Restart Idle timer at 60 seconds

                Build and send Version Exchange Request message

                Go to Initial:B

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8%20%20%20%20%20%20%20Both%20sides%20think%20they%20are%20the%20originator.%20This%20can%20happen%20if"></a><a class="selflink" href="#section-8" name="section-8">8</a>       Both sides think they are the originator. This can happen if</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/both%20dial%20each%20other%20at%20the%20same%20time%20and%20the%20first%20channel"></a>        both dial each other at the same time and the first channel</span>
        that completed PPP negotiation happened to be the channel
        associated with the originating call on both units. MP+
        determines which will be the caller and which the answerer by
        comparing the endpoind discriminator in the version exchange
        request with the local endpoint discriminator. The unit with
        the smaller endpoint is arbitrarily called the originator. The
        actions are:




<span class="grey">Smith                        Informational                     [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


        Compare local endpoint discriminator with endpoint discrimator
        in message.

        If local endpoint discriminator is less than the remote value
        we are the caller, ignore the incoming message.

        Otherwise, if local endpoint discriminator is greater than the
        remote value we are the answerer:

                Compare protocol versions, if they do not match
                Do  Error Close Action, go to INITIAL, sub-state A.

                Store off info received from remote.

                Build a version exchange response and send to remote end.

                Do  Enter Idle Action  which causes a state change.

        If the two values match, there is a problem, Do Error Close
        Action,go to INITIAL, sub-state A.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9%20%20%20%20%20%20%20Log%20an%20error%20message."></a><a class="selflink" href="#section-9" name="section-9">9</a>       Log an error message.</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Notify%20the%20user%20interface%20of%20remote%20management%20failure."></a>        Notify the user interface of remote management failure.</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.4.%20MP%2BSTATE_IDLE%20state%20machine"></a><a class="selflink" href="#section-3.5.4" name="section-3.5.4">3.5.4</a>. MP+STATE_IDLE state machine</span>

   The Idle state is the state of an active session with no call
   management activity in progress.

   There are no sub-states.

   Event                    State
   _____________________________________________
                               A
   =============================================
   MP+SESSION_DOWN         1,Initial:A
   _____________________________________________
   MP+SESSION_TERM         2,Initial:A
   _____________________________________________
   MP+TIMER_EXPIRED        3,*
   _____________________________________________
   MP+UTILIZATION          4,+
   _____________________________________________
   MP+RX_ADD_REQ           5,+
   _____________________________________________
   MP+RX_REMOVE_REQ        6,Remove:B
   _____________________________________________
   MP+RX_RM_REQ            7,+



<span class="grey">Smith                        Informational                     [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   _____________________________________________
   MP+RX_RM_RSP            8,+
   _____________________________________________
   MP+RX_RM_RX_REQ         9,+
   _____________________________________________
   MP+RX_RM_TX_REQ         10,+
   _____________________________________________
   MP+RX_RM_TX_RSP         11,+
   _____________________________________________
   MP+RX_CLOSE_REQ         12,+
   _____________________________________________
   MP+START_RM             13,*
   _____________________________________________
   MP+SEND_RMS             14,*
   _____________________________________________
   MP+SEND_RMM             15,*
   _____________________________________________
   MP+RECV_RMM             16,*
   _____________________________________________
   MP+STOP_RM              17,*
   _____________________________________________
   All other events        **
   _____________________________________________

   Table 3:  Idle State Machine

   Actions:

   1       Do Error Close Action, go to INITIAL, sub-state A.

   2       Do Term Action, go to INITIAL, sub-state A.

   3       Do Timer Action.

   4       Note that a bandwidth change has been reqested.

           Do Enter Idle Action which may cause a state change.

   5       If we are the caller:
                   Do Enter Add [remote answerer] Action.
           Else
                   Do Enter Add [remote caller] Action.

   6       Do Enter Remove [remote] Action

   7       Do Remote Management Request Action

   8       Do Remote Management Response Action



<span class="grey">Smith                        Informational                     [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   9       Do Remote Management Receive Data Action

   10      Do Remote Management Transmit Data Action

   11      Do Remote Management Transmit Data Response Action

   12      Clear remove lock.
           If local recommended channels == 0, then:
                   send a Close Response message with OK To Close
                   set to TRUE.
           Else
                   send a Close Response message with OK To Close
                   set to FALSE.
           Do Enter Idle Action.

   13      Do Remote management (Master) start Action

   14      Do Remote management (Slave) data Action

   15      Do Remote management (Master) data Action

   16      Do Remote management data acknowledgement Action

   17      Do Remote management (Master) stop Action

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.5.%20MP%2BSTATE_ADD%20state%20machine"></a><a class="selflink" href="#section-3.5.5" name="section-3.5.5">3.5.5</a>. MP+STATE_ADD state machine</span>

   The add state is used by both caller and answerer when an add
   transaction is in progress.

   The sub-states are:

        A       Add request sent to answerer, waiting for add response
                from the answerer.
        B       Caller waiting for call complete notification for calls
                placed.
        C       Answerer waiting for add complete message from caller.














<span class="grey">Smith                        Informational                     [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Event                                           Sub-state
______________________________________________________________________
                                A               B               C
======================================================================
MP+SESSION_DOWN         1,Initial:A      7,Closing:A    1,Initial:A
______________________________________________________________________
MP+SESSION_TERM         2,Initial:A      7,Closing:B    2,Initial:A
______________________________________________________________________
MP+TIMER_EXPIRED           3,+              3,+            3,+
______________________________________________________________________
MP+UTILIZATION             4,*              4,*            4,*
______________________________________________________________________
MP+CALL_COMPLETE            **            8,Idle:A         **
______________________________________________________________________
MP+RX_VERSION_REQ          -,*              **             **
______________________________________________________________________
MP+ADD_REQ                5,Add:B           **             **
______________________________________________________________________
MP+ADD_RSP                 6,+              **             **
______________________________________________________________________
MP+ADD_COMP                 **              **           9,Idle:A
______________________________________________________________________
MP+RX_RM_REQ              10,+             10,+           10,+
______________________________________________________________________
MP+RX_RM_RSP              11,+             11,+           11,+
______________________________________________________________________
MP+RX_RM_RX_REQ           12,+             12,+           12,+
______________________________________________________________________
MP+RX_RM_TX_REQ           13,+             13,+           13,+
______________________________________________________________________
MP+RX_RM_TX_RSP           14,+             14,+           14,+
______________________________________________________________________
MP+RX_REMOVE_REQ           -,*              **             **
______________________________________________________________________
MP+START_RM               15,*             15,*           15,*
______________________________________________________________________
MP+SEND_RMS               16,*             16,*           16,*
______________________________________________________________________
MP+SEND_RMM               17,*             17,*           17,*
______________________________________________________________________
MP+RECV_RMM               18,*             18,*           18,*
______________________________________________________________________
MP+STOP_RM                19,*             19,*           19,*
______________________________________________________________________
All other events            **              **             **
______________________________________________________________________

Table 4:  Add State Machine



<span class="grey">Smith                        Informational                     [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Actions:

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20%20%20%20%20%20%20Phone%20numbers%20%28may%29%20have%20been%20reserved%2C%20they%20must%20be%20released"></a><a class="selflink" href="#section-1" name="section-1">1</a>       Phone numbers (may) have been reserved, they must be released</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/before%20the%20normal%20error%20processing%20occurs."></a>        before the normal error processing occurs.</span>

                Release all reserved phone numbers

                Do  Error Close Action.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20%20%20%20%20%20Phone%20nubmers%20%28may%29%20have%20been%20reserved%2C%20they%20must%20be%20released"></a><a class="selflink" href="#section-2" name="section-2">2</a>       Phone nubmers (may) have been reserved, they must be released</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/before%20the%20normal%20close%20processing%20occurs."></a>        before the normal close processing occurs.</span>

                Release all reserved phone numbers

                Do  Term Action.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-3" name="section-3">3</a>       Do  </span>Timer Action

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20%20%20%20%20%20Note%20that%20a%20bandwidth%20change%20has%20been%20reqested.%20This%20will%20be"></a><a class="selflink" href="#section-4" name="section-4">4</a>       Note that a bandwidth change has been reqested. This will be</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/processed%20the%20next%20time%20IDLE%20state%20is%20entered."></a>        processed the next time IDLE state is entered.</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20%20%20%20%20%20%20An%20add%20collision%20has%20occured."></a><a class="selflink" href="#section-5" name="section-5">5</a>       An add collision has occured.  </span>Since the answerer has sent phone
        numbers we will try to use what he as sent, within the limits of
        the local system.

                Compare local channels to add with current channels to
                add.

                If the local channels to add is less than the remote
                channels to add

                        If the remote number of channels requested will
                        put us over the maximum number of channels
                        allowed for the session reduce the channel count
                        and set an add lock.

                        Re-reserve the channels.  If the number reserved
                        are less than the number of phone numbers
                        provided by the far end, set an add lock and
                        reduce the number of channels to add to what we
                        could reserve.

                Now treat the remote add request as if it were an add
                response and process by:

                        Integrate the phone number returned from the
                        answerer with the original phone number dialed.




<span class="grey">Smith                        Informational                     [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


                        Request that a session be extended by dialing
                        the integrated phone number.  A callback is
                        passed with the request so call success or
                        failure can be reported back to MP+.

                        Go to ADD:B.  Note:  This change must actually
                        occur before requesting the first outgoing call.
                        If not, the callback could be called (and
                        ignored) because the session is not in the
                        correct state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20%20%20%20%20%20%20If%20the%20answerer%20provided%20fewer%20phone%20numbers%20than%20requested%20set"></a><a class="selflink" href="#section-6" name="section-6">6</a>       If the answerer provided fewer phone numbers than requested set</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/an%20add%20lock."></a>        an add lock.</span>

        If the number of channels is zero send an add complete message
        (there's nothing to do) and go to the IDLE state.

        For each phone number returned

                Integrate the phone number returned from the answerer
                with the original phone number dialed.

                Request that a session be extended by dialing the
                integrated phone number.  A callback is passed with the
                request so call success or failure can be reported back
                to MP+.

        Go to ADD:B.  Note:  This change must actually occur before
        requesting the first outgoing call.  If not, the callback could
        be called (and ignored) because the session is not in the correct
        state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7%20%20%20%20%20%20%20Restart%20idle%20timer%20for%20abort."></a><a class="selflink" href="#section-7" name="section-7">7</a>       Restart idle timer for abort.</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8%20%20%20%20%20%20%20Increment%20the%20count%20of%20calls%20completed."></a><a class="selflink" href="#section-8" name="section-8">8</a>       Increment the count of calls completed.</span>

        If the call succeeded, increment the count of calls that
        succeeded.

        If the count of calls completed equals the number of calls placed

                If number of calls completed is not the same as the
                nubmer that succeeded set an add lock.

                Build an add complete message and send it to the far end.

                If at least one channel was added clear any remove lock.




<span class="grey">Smith                        Informational                     [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


                Go to the IDLE state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9%20%20%20%20%20%20%20If%20number%20of%20channels%20requested%20not%20equal%20to%20number%20connected"></a><a class="selflink" href="#section-9" name="section-9">9</a>       If number of channels requested not equal to number connected</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/set%20add%20lock."></a>        set add lock.</span>

        If at least one channel was added clear any remove lock.

        Go to the IDLE state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10%20%20%20%20%20%20Do%20Remote%20Management%20Request%20Action"></a><a class="selflink" href="#section-10" name="section-10">10</a>      Do Remote Management Request Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11%20%20%20%20%20%20Do%20Remote%20Management%20Response%20Action"></a><a class="selflink" href="#section-11" name="section-11">11</a>      Do Remote Management Response Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12%20%20%20%20%20%20Do%20Remote%20Management%20Receive%20Data%20Action"></a><a class="selflink" href="#section-12" name="section-12">12</a>      Do Remote Management Receive Data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13%20%20%20%20%20%20Do%20Remote%20Management%20Transmit%20Data%20Action"></a><a class="selflink" href="#section-13" name="section-13">13</a>      Do Remote Management Transmit Data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14%20%20%20%20%20%20Do%20Remote%20Management%20Transmit%20Data%20Response%20Action"></a><a class="selflink" href="#section-14" name="section-14">14</a>      Do Remote Management Transmit Data Response Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20start%20Action"></a><a class="selflink" href="#section-15" name="section-15">15</a>      Do Remote management (Master) start Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16%20%20%20%20%20%20Do%20Remote%20management%20%28Slave%29%20data%20Action"></a><a class="selflink" href="#section-16" name="section-16">16</a>      Do Remote management (Slave) data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/17%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20data%20Action"></a><a class="selflink" href="#section-17" name="section-17">17</a>      Do Remote management (Master) data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/18%20%20%20%20%20%20Do%20Remote%20management%20data%20acknowledgement%20Action"></a><a class="selflink" href="#section-18" name="section-18">18</a>      Do Remote management data acknowledgement Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/19%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20stop%20Action"></a><a class="selflink" href="#section-19" name="section-19">19</a>      Do Remote management (Master) stop Action</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.6.%20MP%2BSTATE_REMOVE%20state%20machine"></a><a class="selflink" href="#section-3.5.6" name="section-3.5.6">3.5.6</a>. MP+STATE_REMOVE state machine</span>

   The state of a session while processing a remove transaction.

   The sub-states are:

        A       Remove request sent, waiting for remove response
        B       Remove response sent, waiting for remove complete














<span class="grey">Smith                        Informational                     [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Event                                   Sub-state
_________________________________________________________
                                A               B
=========================================================
MP+SESSION_DOWN             1,Initial:A    1,Initial:A
_________________________________________________________
MP+SESSION_TERM             2,Initial:A    2,Initial:A
_________________________________________________________
MP+TIMER_EXPIRED               3,+            3,+
_________________________________________________________
MP+UTILIZATION                 4,*            4,*
_________________________________________________________
MP+RX_ADD_REQ                  5,+             **
_________________________________________________________
MP+RX_REMOVE_REQ               6,+             **
_________________________________________________________
MP+RX_REMOVE_RSP            7,Idle:A           **
_________________________________________________________
MP+RX_REMOVE_COMP              **           8,Idle:A
_________________________________________________________
MP+RX_CLOSE_REQ               -,*              **
_________________________________________________________
MP+RX_RM_REQ                  9,*             9,*
_________________________________________________________
MP+RX_RM_RSP                 10,*            10,*
_________________________________________________________
MP+RX_RM_RX_REQ              11,*            11,*
_________________________________________________________
MP+RX_RM_TX_REQ              12,*            12,*
_________________________________________________________
MP+RX_RM_TX_RSP              13,*            13,*
_________________________________________________________
MP+START_RM                  14,*            14,*
_________________________________________________________
MP+SEND_RMS                  15,*            15,*
_________________________________________________________
MP+SEND_RMM                  16,*            16,*
_________________________________________________________
MP+RECV_RMM                  17,*            17,*
_________________________________________________________
MP+STOP_RM                   18,*            18,*
_________________________________________________________
All other events              **               **
_________________________________________________________

Table 5: Remove State Machine





<span class="grey">Smith                        Informational                     [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


Actions:

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-1" name="section-1">1</a>       Do  </span>Error Close Action

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-2" name="section-2">2</a>       Do  </span>Term Action

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20%20%20%20%20%20Do"></a><a class="selflink" href="#section-3" name="section-3">3</a>       Do  </span>Timer Action

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20%20%20%20%20%20Note%20that%20a%20bandwidth%20change%20has%20been%20reqested.%20This%20will%20be"></a><a class="selflink" href="#section-4" name="section-4">4</a>       Note that a bandwidth change has been reqested. This will be</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/processed%20the%20next%20time%20IDLE%20state%20is%20entered."></a>        processed the next time IDLE state is entered.</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20%20%20%20%20%20%20Our%20remove%20conflicted%20with%20the%20remote%20end%20Add."></a><a class="selflink" href="#section-5" name="section-5">5</a>       Our remove conflicted with the remote end Add.  </span>The add takes
        preference.

        Set a remove lock.

        If we are the caller Do  Enter Add [remote answerer] Action  .

        Otherwise Do  Enter Add [remote caller] Action  .

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20%20%20%20%20%20%20Two%20remove%20requests%20collided."></a><a class="selflink" href="#section-6" name="section-6">6</a>       Two remove requests collided.  </span>We give preference to the caller
        (an arbitrary decision).

        If caller, ignore message.

        Else
                Check maximum number of channels needed by the local end.
                Reduce the requested remove count and set a remove lock if
                necessary.

                Build and send a remove response to the remote.

                Go to Remove:B.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7%20%20%20%20%20%20%20Compare%20the%20number%20of%20channels%20requested%20with%20the%20number%20allowed"></a><a class="selflink" href="#section-7" name="section-7">7</a>       Compare the number of channels requested with the number allowed</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/in%20the%20response.%20%20If%20fewer%20allowed%20set%20a%20remove%20lock."></a>        in the response.  If fewer allowed set a remove lock.</span>

        Look at the current bandwidth.  If the number to remove would
        bring the current bendwidth below requirements reduce the number
        of channels to remove.

        If still channels to remove:
                Remove the channels.
                Clear any add lock.
        Send a remove complete indicating the number of channels removed.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8%20%20%20%20%20%20%20If%20at%20least%20one%20channel%20was%20removed%20clear%20any%20add%20lock."></a><a class="selflink" href="#section-8" name="section-8">8</a>       If at least one channel was removed clear any add lock.</span>




<span class="grey">Smith                        Informational                     [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9%20%20%20%20%20%20%20Do%20Remote%20Management%20Request%20Action"></a><a class="selflink" href="#section-9" name="section-9">9</a>       Do Remote Management Request Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10%20%20%20%20%20%20Do%20Remote%20Management%20Response%20Action"></a><a class="selflink" href="#section-10" name="section-10">10</a>      Do Remote Management Response Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11%20%20%20%20%20%20Do%20Remote%20Management%20Receive%20Data%20Action"></a><a class="selflink" href="#section-11" name="section-11">11</a>      Do Remote Management Receive Data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12%20%20%20%20%20%20Do%20Remote%20Management%20Transmit%20Data%20Action"></a><a class="selflink" href="#section-12" name="section-12">12</a>      Do Remote Management Transmit Data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13%20%20%20%20%20%20Do%20Remote%20Management%20Transmit%20Data%20Response%20Action"></a><a class="selflink" href="#section-13" name="section-13">13</a>      Do Remote Management Transmit Data Response Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20start%20Action"></a><a class="selflink" href="#section-14" name="section-14">14</a>      Do Remote management (Master) start Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15%20%20%20%20%20%20Do%20Remote%20management%20%28Slave%29%20data%20Action"></a><a class="selflink" href="#section-15" name="section-15">15</a>      Do Remote management (Slave) data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20data%20Action"></a><a class="selflink" href="#section-16" name="section-16">16</a>      Do Remote management (Master) data Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/17%20%20%20%20%20%20Do%20Remote%20management%20data%20acknowledgement%20Action"></a><a class="selflink" href="#section-17" name="section-17">17</a>      Do Remote management data acknowledgement Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/18%20%20%20%20%20%20Do%20Remote%20management%20%28Master%29%20stop%20Action"></a><a class="selflink" href="#section-18" name="section-18">18</a>      Do Remote management (Master) stop Action</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.7.%20MP%2BSTATE_CLOSE%20state%20machine"></a><a class="selflink" href="#section-3.5.7" name="section-3.5.7">3.5.7</a>. MP+STATE_CLOSE state machine</span>

   The close state is used when we are gracefully closing a session or
   when we were notified that a session terminated mid-transaction.

   The sub-states are:

        A       Waiting for call complete after session down notification
        B       Waiting for call complete after session terminate
                notification.
        C       Waiting for close response after session close request
                sent.

Event                                     Sub-state
______________________________________________________________________
                                A               B               C
======================================================================
MP+SESSION_DOWN                **            -,*        7,Initial:A
______________________________________________________________________
MP+SESSION_TERM           1,Close:B           **        8,Initial:A
______________________________________________________________________
MP+TIMER_EXPIRED          2,Initial:A     5,Initial:A       6,*
______________________________________________________________________
MP+UTILIZATION                -,*            -,*            9,*
______________________________________________________________________
MP+CALL_COMPLETE              3,+         6,Initial:A        **
______________________________________________________________________
MP+ADD_REQ                    **             -,*           10,+



<span class="grey">Smith                        Informational                     [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


______________________________________________________________________
MP+REMOVE_REQ                 **              **        11,Remove:B
______________________________________________________________________
MP+CLOSE_REQ                  -,*            -,*           12,*
______________________________________________________________________
MP+CLOSE_RSP                  -,*            -,*           13,+
______________________________________________________________________
MP+START_RM                   4,*            4,*           4,*
______________________________________________________________________
All other events              **              **            **
______________________________________________________________________

Table 6:  Close State Machine

Actions:

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20%20%20%20%20%20%20The%20session%20was%20closed%20while%20waiting%20for%20call%20completes."></a><a class="selflink" href="#section-1" name="section-1">1</a>       The session was closed while waiting for call completes.</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Just%20go%20to%20Close%3AB."></a>        Just go to Close:B.</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20%20%20%20%20%20We%20timed%20out%20waiting%20for%20completes."></a><a class="selflink" href="#section-2" name="section-2">2</a>       We timed out waiting for completes.  </span>Just process the link down,
        now.
        Do Error Close Action.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20%20%20%20%20%20Increment%20the%20number%20of%20calls%20complete."></a><a class="selflink" href="#section-3" name="section-3">3</a>       Increment the number of calls complete.</span>

        If equal to the number of calls placed then:
                Do Error Close Action, go to Initial:A.
        Else
                No state change.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20%20%20%20%20%20Log%20an%20error%20message."></a><a class="selflink" href="#section-4" name="section-4">4</a>       Log an error message.</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Notify%20the%20user%20interface%20of%20remote%20management%20failure."></a>        Notify the user interface of remote management failure.</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20%20%20%20%20%20%20We%20didn%27t%20get%20all%20the%20notifications%20that%20we%20expect."></a><a class="selflink" href="#section-5" name="section-5">5</a>       We didn't get all the notifications that we expect.  </span>Give up and
        close the session anyway.  Do Term Action .

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20%20%20%20%20%20%20Increment%20the%20number%20of%20calls%20complete."></a><a class="selflink" href="#section-6" name="section-6">6</a>       Increment the number of calls complete.</span>

        If equal to the number of calls placed then:
                Do  Term Action, go to Initial:A.
        Else
                No state change

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7%20%20%20%20%20%20%20Do%20Error%20Close%20Action"></a><a class="selflink" href="#section-7" name="section-7">7</a>       Do Error Close Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8%20%20%20%20%20%20%20Do%20Term%20Action"></a><a class="selflink" href="#section-8" name="section-8">8</a>       Do Term Action</span>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9%20%20%20%20%20%20%20Note%20that%20a%20bandwidth%20change%20has%20been%20reqested.%20This%20will%20be"></a><a class="selflink" href="#section-9" name="section-9">9</a>       Note that a bandwidth change has been reqested. This will be</span>



<span class="grey">Smith                        Informational                     [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


        processed the next time IDLE state is entered.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10%20%20%20%20%20%20This%20is%20an%20Add%20%26%20Close%20collision.%20Add%20wins.%20Perform%20current"></a><a class="selflink" href="#section-10" name="section-10">10</a>      This is an Add &amp; Close collision. Add wins. Perform current</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/remote%20add%20action."></a>        remote add action.</span>
        If we are originator
                Do Add [Remote Answerer] Action
        else
                Do Add [Remote Caller] Action

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11%20%20%20%20%20%20This%20is%20a%20Remove%20%26%20Close%20collision%2C%20the%20Remove%20will%20win%3A"></a><a class="selflink" href="#section-11" name="section-11">11</a>      This is a Remove &amp; Close collision, the Remove will win:</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Set%20remove%20lock%20to%20FALSE"></a>                Set remove lock to FALSE</span>
                Do Remove [Remote] Action.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12%20%20%20%20%20%20This%20is%20a%20Close%20collision.%20But%20since%20we%20both%20agree%3A"></a><a class="selflink" href="#section-12" name="section-12">12</a>      This is a Close collision. But since we both agree:</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/If%20we%20are%20originator"></a>        If we are originator</span>
                Send a Close Response with okToClose set to TRUE.
        Else
                Send a Close Response with okToClose set to FALSE.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13%20%20%20%20%20%20If%20Close%20Response%20is%20received%20with%20okToClear%20is%20TRUE%20then%3A"></a><a class="selflink" href="#section-13" name="section-13">13</a>      If Close Response is received with okToClear is TRUE then:</span>
<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Do%20Term%20Action"></a>                Do Term Action</span>
        Else
                set remove lock to TRUE and do Enter Idle Action.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20PPP%20LCP%20Extensions"></a><a class="selflink" href="#section-4" name="section-4">4</a>. PPP LCP Extensions</span>

MP+ Configuration Option

   The Multilink Protocol Plus introduces the use of an additional LCP
   Configuration Option:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  type = 22    |  length = 4   |    Currently unused           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure 21: MP+ Option

   Type - 22.

   NOTE: The current implementation uses option 0. This is not an
   assigned number, so an IANA assigned official identifier has been
   obtained (22).

   The option, when sent to a peer, advises the peer that:

        the unit is capable of running the MP+ protocol;



<span class="grey">Smith                        Informational                     [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc1934.html">RFC 1934</a>                Multilink Protocol Plus               April 1996</span>


   The peer can accept or reject the option.

   NOTE:  The MP+ option MUST NOT be included unless MP is also
   negotiated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>. Security Considerations</span>

   Security issues are not discussed in this memo.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20References"></a><a class="selflink" href="#section-6" name="section-6">6</a>. References</span>

   [<a id="ref-1" name="ref-1">1</a>] K. Sklower, B. Lloyd, G. McGregor, D. Carr, "The PPP Multilink
       Protocol (MP)".

   [<a id="ref-2" name="ref-2">2</a>] Simpson, W., Editor, "The Point-to-Point Protocol (PPP)", STD
       51, <a href="rfc1661.html">RFC 1661</a>, Daydreamer, July 1994.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20Author%27s%20Address"></a><a class="selflink" href="#section-7" name="section-7">7</a>. Author's Address</span>

   Kevin Smith
   Ascend Communications
   1275 Harbor Bay Parkway
   Alameda, CA 94502

   Phone:  (510) 769-6001
   FAX:    (510) 814-2300
   EMail:  ksmith@ascend.com
























Smith                        Informational                     [Page 47]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc1934 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:55 GMT --></html>