<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7899 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-morin-bess-multicast-damping" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7899" name="DC.Identifier"/>
<meta content="June, 2016" name="DC.Date.Issued"/>
<meta content="Morin, Thomas" name="DC.Creator"/>
<meta content="Patel, Keyur" name="DC.Creator"/>
<meta content="Haas, Jeffrey" name="DC.Creator"/>
<meta content="Zhang, Zhaohui" name="DC.Creator"/>
<meta content="Litkowski, Stephane" name="DC.Creator"/>
<meta content="Kebler, Robert" name="DC.Creator"/>
<meta content="This document describes procedures to damp Multicast VPN (MVPN)
routing state changes and control the effect of the churn due to the
multicast dynamicity in customer sites. The procedures described in
this document are applicable to BGP-based multicast VPN and help avoid
uncontrolled control-plane load increase in the core routing
infrastructure. The new procedures proposed were inspired by BGP
unicast route damping principles that have been adapted to multicast." name="DC.Description.Abstract"/>
<meta content="Multicast VPN State Damping" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7899 - Multicast VPN State Damping</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7899.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7899" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-bess-multicast-damping" title="draft-ietf-bess-multicast-damping">draft-ietf-bess...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7899" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7899" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7899" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                     T. Morin, Ed.
Request for Comments: 7899                                  S. Litkowski
Updates: <a href="rfc6514.html">6514</a>                                                     Orange
Category: Standards Track                                       K. Patel
ISSN: 2070-1721                                            Cisco Systems
                                                                Z. Zhang
                                                               R. Kebler
                                                                 J. Haas
                                                        Juniper Networks
                                                               June 2016


                      <span class="h1">Multicast VPN State Damping</span>

Abstract

   This document describes procedures to damp Multicast VPN (MVPN)
   routing state changes and control the effect of the churn due to the
   multicast dynamicity in customer sites.  The procedures described in
   this document are applicable to BGP-based multicast VPN and help
   avoid uncontrolled control-plane load increase in the core routing
   infrastructure.  The new procedures proposed were inspired by BGP
   unicast route damping principles that have been adapted to multicast.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7899">http://www.rfc-editor.org/info/rfc7899</a>.














<span class="grey">Morin, et al.                Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Existing Mechanisms . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.1">4.1</a>.  Rate-Limiting Multicast Control Traffic . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.2">4.2</a>.  Existing PIM, IGMP, and MLD Timers  . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-4.3">4.3</a>.  BGP Route Damping . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-5">5</a>.  Procedures for Multicast State Damping  . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.1">5.1</a>.  PIM Procedures  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.2">5.2</a>.  Procedures for Multicast VPN State Damping  . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-6">6</a>.  Procedures for P-Tunnel State Damping . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.1">6.1</a>.  Damping MVPN P-Tunnel Change Events . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.2">6.2</a>.  Procedures for Ethernet VPNs  . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-7">7</a>.  Operational Considerations  . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.1">7.1</a>.  Enabling Multicast Damping  . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.2">7.2</a>.  Troubleshooting and Monitoring  . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-7.3">7.3</a>.  Default and Maximum Values  . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-8">8</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-9">9</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-9.1">9.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-9.2">9.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>











<span class="grey">Morin, et al.                Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   In a multicast VPN [<a href="rfc6513.html" title='"Multicast in MPLS/ BGP IP VPNs"'>RFC6513</a>] deployed with BGP-based procedures
   [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>], when receivers in VPN sites join and leave a given
   multicast group or channel through multicast membership control
   protocols (Internet Group Management Protocol (IGMP) [<a href="rfc3376.html" title='"Internet Group Management Protocol, Version 3"'>RFC3376</a>] and
   Multicast Listener Discovery (MLD) [<a href="rfc3810.html" title='"Multicast Listener Discovery Version 2 (MLDv2) for IPv6"'>RFC3810</a>]), multicast routing
   protocols accordingly adjust multicast routing states and P-multicast
   tree states to forward or prune multicast traffic to these receivers.
   Similar challenges arise in the context of the multicast
   specification for Virtual Private LAN Service (VPLS) [<a href="rfc7117.html" title='"Multicast in Virtual Private LAN Service (VPLS)"'>RFC7117</a>].

   In VPN contexts, providing isolation between customers of a shared
   infrastructure is a core requirement resulting in stringent
   expectations with regard to risks of denial-of-service attacks.

   By nature, multicast memberships change based on the behavior of
   multicast applications running on end hosts.  Hence, the frequency of
   membership changes can legitimately be much higher than the typical
   churn of unicast routing states.

   Therefore, mechanisms need to be put in place to ensure that the load
   put on the BGP control plane, and on the P-tunnel setup control
   plane, remains under control regardless of the frequency at which
   multicast membership changes are made by end hosts.

   This document describes procedures inspired by existing BGP route
   damping [<a href="rfc2439.html" title='"BGP Route Flap Damping"'>RFC2439</a>] that are aimed at offering means to set an upper
   bound to the amount of processing for the MVPN control-plane
   protocols: more precisely, the BGP control plane in [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>], the
   P-tunnel control-plane protocol in the contexts of [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>], and the
   multicast specification for VPLS [<a href="rfc7117.html" title='"Multicast in Virtual Private LAN Service (VPLS)"'>RFC7117</a>].  The goal of setting this
   upper bound is pursued simultaneous with the goal of preserving the
   service provided (delivering the multicast stream as requested by
   Customer Edge devices), although at the expense of a minimal increase
   of average bandwidth use in the provider network).  The upper bound
   to the control-plane load due to the processing of a given multicast
   state is controlled indirectly via configurable parameters.

   <a href="rfc6514.html#section-16">Section 16 of [RFC6514]</a> specifically spells out the need for damping
   the activity of C-multicast and Leaf Auto-discovery routes and
   outlines how to do it by "delaying the advertisement of withdrawals
   of C-multicast routes".  This specification provides appropriate
   detail on how to implement this approach and how to provide control
   to the operator; for this reason, it is an update to [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>].






<span class="grey">Morin, et al.                Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   The base principle of this specification is described in <a href="#section-3">Section 3</a>.
   Existing mechanisms that could be relied upon are discussed in
   <a href="#section-4">Section 4</a>.  <a href="#section-5">Section 5</a> details the procedures introduced by this
   specification.

   <a href="#section-6">Section 6</a> provides specific details related to the damping of
   multicast VPNs P-tunnel state.

   Finally, <a href="#section-7">Section 7</a> discusses operational considerations related to
   the proposed mechanism.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   This document reuses terminology from [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>] and [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>].

   In this specification, damping of a multicast state will be said to
   be "active" or "inactive".  Note that in [<a href="rfc2439.html" title='"BGP Route Flap Damping"'>RFC2439</a>], the term used for
   a unicast route that is dampened is "suppressed", but we will avoid
   this term in this specification given that the proposed solution
   consists in holding active a damped multicast state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Overview</span>

   The procedures described in this document allow the network operator
   to configure multicast VPN PEs (Provider Edge routers) so that they
   can delay the propagation of multicast state prune messages between
   PEs when faced with a rate of multicast state dynamicity exceeding a
   certain configurable threshold.  Assuming that the number of
   multicast states that can be created by a receiver is bounded,
   delaying the propagation of multicast state pruning results in
   setting up an upper bound to the average frequency at which the
   router will send state updates to an upstream router.

   From the point of view of a downstream router, such as a CE (Customer
   Edge router), this approach has no impact: the multicast routing
   state changes that it solicits to its PE will be honored without any
   additional delay.  Indeed, the propagation of Joins is not impacted
   by the procedures specified here, and having the upstream router
   delay state prune propagation to its own upstream router does not
   affect what traffic is sent to the downstream router.  In particular,
   the amount of bandwidth used on the PE-CE link downstream to a PE
   applying this damping technique is not increased.





<span class="grey">Morin, et al.                Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   This approach increases the average bandwidth utilization on a link
   upstream to a PE applying this technique, such as a PE-PE link:
   indeed, a given multicast flow will be forwarded for a longer time
   than if no damping was applied.  That said, it is expected that this
   technique will meet the goals of protecting the multicast routing
   infrastructure control plane without a significant average increase
   of bandwidth; for instance, damping events happening at a frequency
   higher than one event per X seconds can be done without increasing by
   more than X seconds the time during which a multicast flow is present
   on a link.

   That said, simulation of the exponential decay algorithm shows that
   the multicast state churn can be drastically reduced without
   significantly increasing the duration for which multicast traffic is
   forwarded.  Hence, using this technique will efficiently protect the
   multicast routing infrastructure control plane against the issues
   described here without a significant average increase of bandwidth.
   The exception will be a scenario with strict constraints on multicast
   bandwidth, where extending the time a multicast flow is forwarded
   would result in congestion.

   To be practical, such a mechanism requires configurability.  In
   particular, means are required to control when damping is triggered
   and to allow delaying the pruning of a multicast state for a time
   increasing with the churn of this multicast state.  This will let the
   operator control the trade-off made between minimizing the dynamicity
   and reducing bandwidth consumption.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Existing%20Mechanisms"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Existing Mechanisms</span>

   This section describes mechanisms that could be considered to address
   the issue but that end up appearing as not suitable or not efficient
   enough.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Rate-Limiting%20Multicast%20Control%20Traffic"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Rate-Limiting Multicast Control Traffic</span>

   The Protocol Independent Multicast - Sparse Mode (PIM-SM)
   specification [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>] examines multicast security threats and,
   among other things, the risk of denial-of-service attacks described
   in <a href="#section-1">Section 1</a>.  A mechanism relying on rate-limiting PIM messages is
   proposed in <a href="rfc4609.html#section-5.3.3">Section 5.3.3 of [RFC4609]</a> but has the identified
   drawbacks of impacting the service delivered and having side-effects
   on legitimate users.








<span class="grey">Morin, et al.                Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Existing%20PIM%2C%20IGMP%2C%20and%20MLD%20Timers"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Existing PIM, IGMP, and MLD Timers</span>

   In the context of PIM multicast routing protocols [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>], a
   mechanism exists that may offer a form of de facto damping of
   multicast states, under some conditions.  Indeed, when active, the
   prune override mechanism consists in having a PIM upstream router
   introduce a delay ("prune override interval") before taking into
   account a PIM Prune message sent by a downstream neighbor.

   This mechanism has not been designed specifically for the purpose of
   damping multicast state, but as a means to allow PIM to operate on
   multi-access networks.  See <a href="rfc7761.html#section-4.3.3">Section 4.3.3 of [RFC7761]</a>.  However,
   when active, this mechanism will prevent a downstream router from
   producing multicast routing protocol messages that would cause, for a
   given multicast state, the upstream router to send to its own
   upstream router multicast routing protocol messages at a rate higher
   than 1/[JP_Override_Interval].  This provides a form of de facto
   damping.

   Similarly, the IGMP and MLD multicast membership control protocols
   can provide a similar behavior under the right conditions.

   These mechanisms are not considered suitable to meet the goals
   spelled out in <a href="#section-1">Section 1</a>, the main reasons being that:

   o  when enabled, these mechanisms require additional bandwidth on the
      local link on which the effect of a prune is delayed (in our case,
      the PE-CE link);

   o  when enabled, these mechanisms require disabling explicit tracking
      (see <a href="rfc7761.html#section-4.3.3">Section 4.3.3 of [RFC7761]</a>), even though enabling this
      feature may otherwise be desired;

   o  on certain implementations, these mechanisms are incompatible with
      behaviors that cannot be turned off (e.g., implementation applying
      a fast-leave behavior on interfaces with only two neighbors);

   o  they do not provide a suitable level of configurability; and

   o  they do not provide a way to discriminate between multicast flows
      based on estimation of their dynamicity.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20BGP%20Route%20Damping"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  BGP Route Damping</span>

   The procedures defined in [<a href="rfc2439.html" title='"BGP Route Flap Damping"'>RFC2439</a>] and [<a href="rfc7196.html" title='"Making Route Flap Damping Usable"'>RFC7196</a>] for BGP route flap
   damping are useful for operators who want to control the impact of
   unicast route churn on the routing infrastructure and offer a
   standardized set of parameters to control damping.



<span class="grey">Morin, et al.                Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   These procedures are not directly relevant in a multicast context for
   the following reasons:

   o  they are not specified for multicast routing protocol in general,
      and

   o  even in contexts where BGP routes are used to carry multicast
      routing states (e.g., [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>]), these procedures do not allow
      the implementation of the principle described in this document;
      the main reason being that a damped route becomes suppressed while
      the target behavior would be to keep advertising when damping is
      triggered on a multicast route.

   However, the set of parameters standardized to control the thresholds
   of the exponential decay mechanism can be relevantly reused.  This is
   the approach proposed for the procedures described in this document
   (<a href="#section-5">Section 5</a>).  Motivations for doing so are to help the network
   operator deploy this feature based on consistent configuration
   parameters and to obtain predictable results without the drawbacks of
   relying on rate-limiting multicast control protocol exchanges (as is
   exposed in <a href="#section-4.1">Section 4.1</a>) or on the use of existing PIM/IGMP timers (as
   is exposed in <a href="#section-4.2">Section 4.2</a>).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Procedures%20for%20Multicast%20State%20Damping"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Procedures for Multicast State Damping</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20PIM%20Procedures"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  PIM Procedures</span>

   This section describes procedures for multicast state damping
   satisfying the goals spelled out in <a href="#section-1">Section 1</a>.  This section
   describes procedures for (S,G) states in the PIM-SM protocol
   [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>]; they apply unchanged for such states created based on
   multicast group management protocols (IGMP [<a href="rfc3376.html" title='"Internet Group Management Protocol, Version 3"'>RFC3376</a>], MLD [<a href="rfc3810.html" title='"Multicast Listener Discovery Version 2 (MLDv2) for IPv6"'>RFC3810</a>])
   on downstream interfaces.  The same procedures are applied to (*,G)
   states in the context of PIM-SM Any-Source Multicast (ASM) groups
   (damping is not applied to (S,G,Rpt) Prune state).

   The following notions of [<a href="rfc2439.html" title='"BGP Route Flap Damping"'>RFC2439</a>] are reused in these procedures:

   figure-of-merit:  A number reflecting the current estimation of
      recent past activity of an (S,G) multicast routing state, which
      increases based on routing events related to this state and
      decreases between these events following an exponential decay
      function (see below); the activation or inactivation of damping on
      the state is based on this number.  This number is associated with
      the upstream state machine for (S,G) and is initialized to a value
      of zero on state creation.





<span class="grey">Morin, et al.                Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   exponential decay function:  A mathematical function as defined in
      <a href="rfc2439.html#section-2.3">Section 2.3 of [RFC2439]</a> (ignoring the first paragraph of the
      section, as it does not apply here).

   decay-half-life:  The duration used to control how fast the
      exponential decay of the *figure-of-merit* is; this parameter of
      the exponential decay function is the time duration during which
      the *figure-of-merit* will be reduced by half when in the absence
      of a routing event (configurable parameter).

   cutoff-threshold:  The value of the *figure-of-merit* over which
      damping is applied (configurable parameter).

   reuse-threshold:  The value of the *figure-of-merit* under which
      damping stops being applied (configurable parameter).

   In addition to these values, a configurable *increment-factor*
   parameter is introduced that controls by how much the *figure-of-
   merit* is incremented on multicast state update events.

   <a href="#section-7.3">Section 7.3</a> proposes default and maximum values for the configurable
   parameters.

   On reception of updated multicast membership or routing information
   on a downstream interface I for a given (S,G) state, which results in
   a change of the state of the PIM downstream state machine (see
   <a href="rfc7761.html#section-4.5.3">Section 4.5.3 of [RFC7761]</a>), a router implementing these procedures
   MUST:

   o  apply procedures of [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>] unchanged, for everything relating
      to what multicast traffic ends up being sent on downstream
      interfaces, including interface I

   o  update the *figure-of-merit* following the exponential decay
      algorithm

   o  increase the *figure-of-merit* for the (S,G) by the *increment-
      factor*

   o  update the damping state for the (S,G) state: damping becomes
      active on the state if the recomputed *figure-of-merit* is
      strictly above the configured *cutoff-threshold*:

      *  if damping remains inactive on (S,G) state, update the upstream
         state machine as usual (as per <a href="rfc7761.html#section-4.5.7">Section 4.5.7 of [RFC7761]</a>).






<span class="grey">Morin, et al.                Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


      *  if damping becomes active for the (S,G) state:

         +  if the received message has caused the upstream state
            machine to transition to Joined state, update the upstream
            state machine for (S,G) applying usual PIM procedures in
            <a href="rfc7761.html#section-4.5.7">Section 4.5.7 of [RFC7761]</a> and including sending a PIM Join
            to the upstream neighbor

         +  if the received message has caused the upstream state
            machine to transition to NotJoined state, do not update the
            upstream state machine for (S,G)

         +  hold the upstream state machine in Joined state until the
            reuse threshold is reached: for the purpose of updating this
            state machine, events that may result in updating the state
            based on [<a href="rfc7761.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)"'>RFC7761</a>] SHOULD be ignored until the *reuse-
            threshold* is reached.  The effect is that in the meantime,
            while PIM Join messages may be sent as refreshes to the
            upstream neighbor, no PIM Prune message will be sent.

      *  if damping was already active, do not update the upstream state
         machine for (S,G); the upstream state machine was frozen after
         processing the previous message.

   Once the *figure-of-merit* for (S,G) damping state decays to a value
   strictly below the configured *reuse-threshold*, the upstream state
   machine for (S,G) is recomputed based on states of downstream state
   machines, eventually leading to a PIM Join or Prune message to be
   sent to the upstream neighbor.

   Given the specificity of multicast applications, it is REQUIRED for
   the implementation to let the operator configure the *decay-half-
   life* in seconds, rather than in minutes.

   This specification does not impose the use of a particular technique
   to update the *figure-of-merit* following the exponential decay
   controlled by the configured *decay-half-life*.  For instance, the
   same techniques as the ones described in [<a href="rfc2439.html" title='"BGP Route Flap Damping"'>RFC2439</a>] can be applied.
   The only requirement is that the *figure-of-merit* has to be updated
   prior to increasing it and that its decay below the *reuse-threshold*
   has to be reacted upon in a timely manner: in particular, if the
   recomputation is done with a fixed time granularity, this granularity
   should be low enough to not significantly delay the inactivation of
   damping on a multicast state beyond what the operator wanted to
   configure (e.g., for a *decay-half-life* of 10s, recomputing the
   *figure-of-merit* each minute would result in a multicast state
   remaining damped for a much longer time than specified).




<span class="grey">Morin, et al.                Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   PIM implementations typically follow the suggestion from <a href="rfc7761.html#section-4.1">Section 4.1
   of [RFC7761]</a> that:

      implementations will only maintain state when it is relevant to
      forwarding operations - for example, the 'NoInfo' state might be
      assumed from the lack of other state information, rather than
      being held explicitly.

   To properly implement damping procedures, an implementation MUST keep
   an explicit (S,G) state as long as damping is active on an (S,G).
   Once an (S,G) state expires, and damping becomes inactive on this
   state, its associated *figure-of-merit* and damping state are removed
   as well.

   Note that these procedures:

   o  do not impact PIM procedures related to refreshes or expiration of
      multicast routing states: PIM Prune messages triggered by the
      expiration of the (S,G) keep-alive timer are not suppressed or
      delayed, and the reception of Join messages not causing transition
      of state on the downstream interface does not lead to incrementing
      the *figure-of-merit*;

   o  do not impact the PIM Assert mechanism: in particular, PIM Prune
      messages triggered by a change of the PIM Assert winner on the
      upstream interface are not suppressed or delayed;

   o  do not impact PIM Prune messages that are sent when the RPF
      neighbor is updated for a given multicast flow; and

   o  do not impact PIM Prune messages that are sent in the context of
      switching between a Rendezvous Point Tree and a Shortest Path
      Tree.

   Note also that no action is triggered based on the reception of PIM
   Prune messages (or corresponding IGMP/MLD messages) that relate to
   non-existing (S,G) state: in particular, no *figure-of-merit* or
   damping state is created in this case.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Procedures%20for%20Multicast%20VPN%20State%20Damping"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Procedures for Multicast VPN State Damping</span>

   The procedures described in <a href="#section-5.1">Section 5.1</a> can be applied in the Virtual
   Routing and Forwarding (VRF) PIM-SM implementation (in the "C-PIM
   instance"), with the corresponding action to suppressing the emission
   of a Prune(S,G) message being to not withdraw the C-multicast Source
   Tree Join (C-S,C-G) BGP route.  An implementation of [<a href="rfc6513.html" title='"Multicast in MPLS/ BGP IP VPNs"'>RFC6513</a>]
   relying on the use of PIM to carry C-multicast routing information
   MUST support this technique to be compliant with this specification.



<span class="grey">Morin, et al.                Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   In the context of [<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>], where BGP is used to distribute
   C-multicast routing information, the following procedure is proposed
   as an alternative to the procedures in <a href="#section-5.1">Section 5.1</a> and consists in
   applying damping in the BGP implementation based on existing BGP
   damping mechanisms applied to C-multicast Source Tree Join routes and
   Shared Tree Join routes (and as well to Leaf A-D routes - see
   <a href="#section-6">Section 6</a>) and modified to implement the behavior described in
   <a href="#section-3">Section 3</a> along the following guidelines:

   o  not withdrawing (instead of not advertising) damped routes;

   o  providing means to configure the *decay-half-life* in seconds if
      that option is not already available; and

   o  using parameters for the exponential decay that are specific to
      multicast based on default values and multicast-specific
      configuration.

   While these procedures would typically be implemented on PE routers,
   in a context where BGP Route Reflectors (RRs) [<a href="rfc4456.html" title='"BGP Route Reflection: An Alternative to Full Mesh Internal BGP (IBGP)"'>RFC4456</a>] are used it
   can be considered useful to also be able to apply damping on RRs as
   well to provide additional protection against activity created behind
   multiple PEs.  Additionally, for MVPN Inter-AS deployments, it can be
   needed to protect one Autonomous System (AS) from the dynamicity of
   multicast VPN routing events from other ASes.

   The choice to implement damping based on BGP routes or the procedures
   described in <a href="#section-5.1">Section 5.1</a> is up to the implementor, but at least one
   of the two MUST be implemented.  In the perspective of allowing
   damping to be done on RRs and Autonomous System Border Routers
   (ASBRs), implementing the BGP approach is recommended.

   When not all routers in a deployment have the capability to drop
   traffic coming from the wrong PE (as spelled out in <a href="rfc6513.html#section-9.1.1">Section 9.1.1 of
   [RFC6513]</a>), then the withdrawal of a C-multicast route resulting from
   a change in the Upstream Multicast Hop or Upstream Multicast PE
   SHOULD NOT be damped.  An implementation of this specification MUST
   do at least one of the two following things:

   o  not damp these withdrawals by default, and/or

   o  provide a tuning knob to disable the damping of these withdrawals.

   Additionally, in such a deployment context, it is RECOMMENDED not to
   enable any multicast VPN route damping on RRs and ASBRs since these
   types of equipment cannot distinguish the event having caused a
   C-multicast to be withdrawn.




<span class="grey">Morin, et al.                Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   Note well that it is out of scope of this section to consider the
   application of these damping techniques on MVPN BGP routes other than
   C-multicast routes.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Procedures%20for%20P-Tunnel%20State%20Damping"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Procedures for P-Tunnel State Damping</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Damping%20MVPN%20P-Tunnel%20Change%20Events"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Damping MVPN P-Tunnel Change Events</span>

   When selective P-tunnels are used (see <a href="rfc6513.html#section-7">Section 7 of [RFC6513]</a>), the
   effect of updating the upstream state machine for a given (C-S,C-G)
   state on a PE connected to multicast receivers is not only to
   generate activity to propagate C-multicast routing information to the
   source connected PE, but also to possibly trigger changes related to
   the P-tunnels carrying (C-S,C-G) traffic.  Protecting the provider
   network from an excessive amount of change in the state of P-tunnels
   is required, and this section details how this can be done.

   A PE implementing these procedures for MVPN MUST damp Leaf A-D routes
   in the same manner as it would for C-multicast routes (see
   <a href="#section-5.2">Section 5.2</a>).

   A PE implementing these procedures for MVPN MUST damp the activity
   related to removing itself from a P-tunnel.  Possible ways to do so
   depend on the type of P-tunnel, and local implementation details are
   left up to the implementor.

   The following is proposed as an example of how the above can be
   achieved:

   o  For P-tunnels implemented with the PIM protocol, this consists in
      applying multicast state damping techniques described in
      <a href="#section-5.1">Section 5.1</a> to the P-PIM instance, at least for (S,G) states
      corresponding to P-tunnels.

   o  For P-tunnels implemented with multipoint LDP (mLDP), this
      consists in applying damping techniques completely similar to the
      one described in <a href="#section-5">Section 5</a> but generalized to apply to mLDP
      states.

   o  For root-initiated P-tunnels (P-tunnels implemented with the
      Point-to-Multipoint (P2MP) RSVP-TE, or relying on ingress
      replication), no particular action needs to be implemented to damp
      P-tunnels membership, if the activity of Leaf A-D route themselves
      is damped.







<span class="grey">Morin, et al.                Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   o  Another possibility is to base the decision to join or not join
      the P-tunnel to which a given (C-S,C-G) is bound and to advertise
      or not advertise a Leaf A-D route related to (C-S,C-G) based on
      whether or not a C-multicast Source Tree Join route is being
      advertised for (C-S,C-G) rather than by relying on the state of
      the C-PIM Upstream state machine for (C-S,C-G).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Procedures%20for%20Ethernet%20VPNs"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Procedures for Ethernet VPNs</span>

   Specifications exist to support or optimize multicast and broadcast
   in the context of Ethernet VPNs [<a href="rfc7117.html" title='"Multicast in Virtual Private LAN Service (VPLS)"'>RFC7117</a>] relying on the use of
   Selective P-Multicast Service Interface (S-PMSI) and P-tunnels.  For
   the same reasons as for IP multicast VPNs, an implementation of
   [<a href="rfc7117.html" title='"Multicast in Virtual Private LAN Service (VPLS)"'>RFC7117</a>] MUST follow the procedures described in <a href="#section-6.1">Section 6.1</a> to be
   compliant with this specification.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Operational%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Operational Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Enabling%20Multicast%20Damping"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Enabling Multicast Damping</span>

   In the context of multicast VPNs, these procedures would be enabled
   on PE routers.  Additionally, in the case of C-multicast routing
   based on BGP extensions ([<a href="rfc6514.html" title='"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"'>RFC6514</a>]), these procedures can be enabled
   on ASBRs and RRs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Troubleshooting%20and%20Monitoring"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Troubleshooting and Monitoring</span>

   Implementing the damping mechanisms described in this document should
   be complemented by appropriate tools to observe and troubleshoot
   damping activity.

   Complementing the existing interface providing information on
   multicast states with information on eventual damping of
   corresponding states (e.g., Multicast Routing Information Base (MRIB)
   states) is RECOMMENDED for C-multicast routing states and P-tunnel
   states.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Default%20and%20Maximum%20Values"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Default and Maximum Values</span>

   Considering that, by design, multicast streams will be delivered
   unchanged to the end user independent of the value chosen for the
   configurable parameters, and that the only trade-off being made is an
   increase of bandwidth use, the default and maximum values do not have
   to be perfectly tuned.

   This section proposes default and maximum values that are
   conservative, so as to not significantly impact network dimensioning
   but still prevent multicast state churn going beyond what can be



<span class="grey">Morin, et al.                Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   considered a reasonably low churn for a multicast state (see below
   for illustrations in order of magnitude of the effect of these
   values).

   The following values are RECOMMENDED to be adopted as default values:

   o  *increment-factor*: 1000

   o  *cutoff-threshold*: 3000

   o  *decay-half-life*: 10s

   o  *reuse-threshold*: 1500

   For unicast damping, it is common to set an upper bound to the time
   during which a route is suppressed.  In the case of multicast state
   damping, which relies on not withdrawing a damped route, it may be
   desirable to avoid a situation where a multicast flow would keep
   flowing in a portion of the network for a very long time in the
   absence of receivers.

   The proposed default maximum value for the *figure-of-merit* is
   20x*increment-factor*, i.e., 20000 with the proposed default
   *increment-factor* of 1000.

   As illustrations, with these values:

   o  a multicast state updated less frequently than once every 6 s will
      not be damped at all;

   o  a multicast state changing once per second for 3 s, and then not
      changing, will not be damped;

   o  a multicast state changing once per second for 4 s, and then not
      changing, will be damped after the fourth change for approximately
      13 s;

   o  a multicast state changing twice per second for 15 s, and then not
      changing, will be damped after the fourth change for approximately
      50 s; and

   o  a multicast state changing at a fast pace for a long time will
      reach the maximum of *figure-of-merit*; once the activity on this
      state stops, corresponding traffic may still flow in the network
      for approximately 37 s before dampening stops being active.






<span class="grey">Morin, et al.                Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   The following values are proposed as maximums:

   o  *decay-half-life*: 60 s

   o  *cutoff-threshold*: 50000

   More aggressive protection against the risk of denial of service can
   be achieved by increasing the *increment-factor* or the
   *decay-half-life*, or by reducing the *cutoff-threshold* and/or
   *reuse-threshold*.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Security Considerations</span>

   The procedures defined in this document do not introduce additional
   security issues not already present in the contexts addressed and
   actually aim at addressing some of the identified risks without
   introducing as much denial-of-service risk as some of the mechanisms
   already defined.

   The protection provided relates to the control plane of the multicast
   routing protocols, including the components implementing the routing
   protocols and the components responsible for updating the multicast
   forwarding plane.

   The procedures described are meant to provide some level of
   protection for the router on which they are enabled by reducing the
   amount of routing state updates that it needs to send to its upstream
   neighbor or peers but do not provide any reduction of the control-
   plane load related to processing routing information from downstream
   neighbors.  Protecting routers from an increase in control-plane load
   due to activity on downstream interfaces toward core routers (or in
   the context of BGP-based MVPN C-multicast routing, BGP peers) relies
   on the activation of damping on corresponding downstream neighbors
   (or BGP peers) and/or at the edge of the network.  Protecting routers
   from an increase in control-plane load due to activity on customer-
   facing downstream interfaces or downstream interfaces to routers in
   another administrative domain is out of the scope of this document
   and should use already defined mechanisms (see [<a href="rfc4609.html" title='"Protocol Independent Multicast - Sparse Mode (PIM-SM) Multicast Routing Security Issues and Enhancements"'>RFC4609</a>]).

   To be effective, the procedures described here must be complemented
   by configuration limiting the number of multicast states that can be
   created on a multicast router through protocol interactions with
   multicast receivers, neighbor routers in adjacent ASes, or in
   multicast VPN contexts with multicast CEs.  Note well that the two
   mechanisms may interact: the state for which Prune has been requested
   may still remain taken into account for some time if damping has been
   triggered and hence result in an otherwise acceptable new state from
   being successfully created.



<span class="grey">Morin, et al.                Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   Additionally, it is worth noting that these procedures are not meant
   to protect against peaks of control-plane load but only address
   averaged load.  For instance, assuming a set of multicast states are
   submitted to the same Join/Prune events, damping can prevent more
   than a certain number of Join/Prune messages to be sent upstream in
   the period of time that elapses between the reception of Join/Prune
   messages triggering the activation of damping on these states and
   when damping becomes inactive after decay.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2439" name="ref-RFC2439">RFC2439</a>]  Villamizar, C., Chandra, R., and R. Govindan, "BGP Route
              Flap Damping", <a href="rfc2439.html">RFC 2439</a>, DOI 10.17487/RFC2439, November
              1998, &lt;<a href="http://www.rfc-editor.org/info/rfc2439">http://www.rfc-editor.org/info/rfc2439</a>&gt;.

   [<a id="ref-RFC3376" name="ref-RFC3376">RFC3376</a>]  Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A.
              Thyagarajan, "Internet Group Management Protocol, Version
              3", <a href="rfc3376.html">RFC 3376</a>, DOI 10.17487/RFC3376, October 2002,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3376">http://www.rfc-editor.org/info/rfc3376</a>&gt;.

   [<a id="ref-RFC3810" name="ref-RFC3810">RFC3810</a>]  Vida, R., Ed. and L. Costa, Ed., "Multicast Listener
              Discovery Version 2 (MLDv2) for IPv6", <a href="rfc3810.html">RFC 3810</a>,
              DOI 10.17487/RFC3810, June 2004,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3810">http://www.rfc-editor.org/info/rfc3810</a>&gt;.

   [<a id="ref-RFC6513" name="ref-RFC6513">RFC6513</a>]  Rosen, E., Ed. and R. Aggarwal, Ed., "Multicast in MPLS/
              BGP IP VPNs", <a href="rfc6513.html">RFC 6513</a>, DOI 10.17487/RFC6513, February
              2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6513">http://www.rfc-editor.org/info/rfc6513</a>&gt;.

   [<a id="ref-RFC6514" name="ref-RFC6514">RFC6514</a>]  Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter, "BGP
              Encodings and Procedures for Multicast in MPLS/BGP IP
              VPNs", <a href="rfc6514.html">RFC 6514</a>, DOI 10.17487/RFC6514, February 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6514">http://www.rfc-editor.org/info/rfc6514</a>&gt;.

   [<a id="ref-RFC7117" name="ref-RFC7117">RFC7117</a>]  Aggarwal, R., Ed., Kamite, Y., Fang, L., Rekhter, Y., and
              C. Kodeboniya, "Multicast in Virtual Private LAN Service
              (VPLS)", <a href="rfc7117.html">RFC 7117</a>, DOI 10.17487/RFC7117, February 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7117">http://www.rfc-editor.org/info/rfc7117</a>&gt;.






<span class="grey">Morin, et al.                Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   [<a id="ref-RFC7196" name="ref-RFC7196">RFC7196</a>]  Pelsser, C., Bush, R., Patel, K., Mohapatra, P., and O.
              Maennel, "Making Route Flap Damping Usable", <a href="rfc7196.html">RFC 7196</a>,
              DOI 10.17487/RFC7196, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7196">http://www.rfc-editor.org/info/rfc7196</a>&gt;.

   [<a id="ref-RFC7761" name="ref-RFC7761">RFC7761</a>]  Fenner, B., Handley, M., Holbrook, H., Kouvelas, I.,
              Parekh, R., Zhang, Z., and L. Zheng, "Protocol Independent
              Multicast - Sparse Mode (PIM-SM): Protocol Specification
              (Revised)", STD 83, <a href="rfc7761.html">RFC 7761</a>, DOI 10.17487/RFC7761, March
              2016, &lt;<a href="http://www.rfc-editor.org/info/rfc7761">http://www.rfc-editor.org/info/rfc7761</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-RFC4456" name="ref-RFC4456">RFC4456</a>]  Bates, T., Chen, E., and R. Chandra, "BGP Route
              Reflection: An Alternative to Full Mesh Internal BGP
              (IBGP)", <a href="rfc4456.html">RFC 4456</a>, DOI 10.17487/RFC4456, April 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4456">http://www.rfc-editor.org/info/rfc4456</a>&gt;.

   [<a id="ref-RFC4609" name="ref-RFC4609">RFC4609</a>]  Savola, P., Lehtonen, R., and D. Meyer, "Protocol
              Independent Multicast - Sparse Mode (PIM-SM) Multicast
              Routing Security Issues and Enhancements", <a href="rfc4609.html">RFC 4609</a>,
              DOI 10.17487/RFC4609, October 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4609">http://www.rfc-editor.org/info/rfc4609</a>&gt;.

Acknowledgements

   We would like to thank Bruno Decraene and Lenny Giuliano for
   discussions that helped shape this proposal.  We would also like to
   thank Yakov Rekhter and Eric Rosen for their reviews and helpful
   comments.  Thanks to Wim Henderickx for his comments and support of
   this proposal.  Additionally, Martin Vigoureux, Gunter Van De Velde,
   and Alvaro Retana provided useful comments to finalize the document.

Authors' Addresses

   Thomas Morin (editor)
   Orange
   2, avenue Pierre Marzin
   Lannion  22307
   France

   Email: thomas.morin@orange.com









<span class="grey">Morin, et al.                Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7899.html">RFC 7899</a>                      MVPN Damping                     June 2016</span>


   Stephane Litkowski
   Orange
   France

   Email: stephane.litkowski@orange.com


   Keyur Patel
   Cisco Systems
   170 W. Tasman Drive
   San Jose, CA  95134
   United States of America

   Email: keyupate@cisco.com


   Zhaohui Zhang
   Juniper Networks Inc.
   10 Technology Park Drive
   Westford, MA  01886
   United States of America

   Email: zzhang@juniper.net


   Robert Kebler
   Juniper Networks Inc.
   10 Technology Park Drive
   Westford, MA  01886
   United States of America

   Email: rkebler@juniper.net


   Jeffrey Haas
   Juniper Networks

   Email: jhaas@juniper.net













Morin, et al.                Standards Track                   [Page 18]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7899 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --></html>