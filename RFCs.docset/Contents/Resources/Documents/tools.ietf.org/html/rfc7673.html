<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7673 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:20 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:7673" name="DC.Identifier"/>
<meta content="The DNS-Based Authentication of Named Entities (DANE) specification
(RFC 6698) describes how to use TLSA resource records secured by
DNSSEC (RFC 4033) to associate a server's connection endpoint with
its Transport Layer Security (TLS) certificate (thus enabling
administrators of domain names to specify the keys used in that
domain's TLS servers). However, application protocols that use SRV
records (RFC 2782) to indirectly name the target server connection
endpoints for a service domain name cannot apply the rules from RFC
6698. Therefore, this document provides guidelines that enable such
protocols to locate and use TLSA records." name="DC.Description.Abstract"/>
<meta content="Miller, Matthew" name="DC.Creator"/>
<meta content="Finch, Tony" name="DC.Creator"/>
<meta content="Saint-Andre, Peter" name="DC.Creator"/>
<meta content="October, 2015" name="DC.Date.Issued"/>
<meta content="Using DNS-Based Authentication of Named Entities (DANE) TLSA Records with SRV Records" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7673 - Using DNS-Based Authentication of Named Entities (DANE) TLSA Records with SRV Records</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7673.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7673" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-dane-srv" title="draft-ietf-dane-srv">draft-ietf-dane...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7673" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7673" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7673" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                          T. Finch
Request for Comments: 7673                       University of Cambridge
Category: Standards Track                                      M. Miller
ISSN: 2070-1721                                      Cisco Systems, Inc.
                                                          P. Saint-Andre
                                                                    &amp;yet
                                                            October 2015


        <span class="h1">Using DNS-Based Authentication of Named Entities (DANE)</span>
                     <span class="h1">TLSA Records with SRV Records</span>

Abstract

   The DNS-Based Authentication of Named Entities (DANE) specification
   (<a href="rfc6698.html">RFC 6698</a>) describes how to use TLSA resource records secured by
   DNSSEC (<a href="rfc4033.html">RFC 4033</a>) to associate a server's connection endpoint with
   its Transport Layer Security (TLS) certificate (thus enabling
   administrators of domain names to specify the keys used in that
   domain's TLS servers).  However, application protocols that use SRV
   records (<a href="rfc2782.html">RFC 2782</a>) to indirectly name the target server connection
   endpoints for a service domain name cannot apply the rules from <a href="rfc6698.html">RFC</a>
   <a href="rfc6698.html">6698</a>.  Therefore, this document provides guidelines that enable such
   protocols to locate and use TLSA records.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7673">http://www.rfc-editor.org/info/rfc7673</a>.













<span class="grey">Finch, et al.                Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. DNS Checks ......................................................<a href="#page-4">4</a>
      <a href="#section-3.1">3.1</a>. SRV Query ..................................................<a href="#page-4">4</a>
      <a href="#section-3.2">3.2</a>. Address Queries ............................................<a href="#page-5">5</a>
      <a href="#section-3.3">3.3</a>. TLSA Queries ...............................................<a href="#page-6">6</a>
      <a href="#section-3.4">3.4</a>. Impact on TLS Usage ........................................<a href="#page-6">6</a>
   <a href="#section-4">4</a>. TLS Checks ......................................................<a href="#page-7">7</a>
      <a href="#section-4.1">4.1</a>. SRV Records Only ...........................................<a href="#page-7">7</a>
      <a href="#section-4.2">4.2</a>. TLSA Records ...............................................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. Guidance for Protocol Authors ...................................<a href="#page-8">8</a>
   <a href="#section-6">6</a>. Guidance for Server Operators ...................................<a href="#page-8">8</a>
   <a href="#section-7">7</a>. Guidance for Application Developers .............................<a href="#page-9">9</a>
   <a href="#section-8">8</a>. Internationalization Considerations .............................<a href="#page-9">9</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-10">10</a>
      <a href="#section-9.1">9.1</a>. Mixed Security Status .....................................<a href="#page-10">10</a>
      <a href="#section-9.2">9.2</a>. Certificate Subject Name Matching .........................<a href="#page-10">10</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-11">11</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-11">11</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>. Examples ..............................................<a href="#page-13">13</a>
     <a href="#appendix-A.1">A.1</a>. IMAP .......................................................<a href="#page-13">13</a>
     <a href="#appendix-A.2">A.2</a>. XMPP .......................................................<a href="#page-13">13</a>
   <a href="#appendix-B">Appendix B</a>. Rationale .............................................<a href="#page-14">14</a>
   Acknowledgements ..................................................<a href="#page-15">15</a>
   Authors' Addresses ................................................<a href="#page-16">16</a>








<span class="grey">Finch, et al.                Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The base DNS-Based Authentication of Named Entities (DANE)
   specification [<a href="rfc6698.html" title='"The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA"'>RFC6698</a>] describes how to use TLSA resource records
   secured by DNSSEC [<a href="rfc4033.html" title='"DNS Security Introduction and Requirements"'>RFC4033</a>] to associate a target server's connection
   endpoint with its Transport Layer Security (TLS) certificate (thus
   enabling administrators of domain names to specify the keys used in
   that domain's TLS servers).  Some application protocols locate
   connection endpoints indirectly via SRV records [<a href="rfc2782.html" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC2782</a>].  As a
   result of this indirection, the rules specified in [<a href="rfc6698.html" title='"The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA"'>RFC6698</a>] cannot
   be directly applied to such application protocols.  (Rules for SMTP
   [<a href="rfc5321.html" title='"Simple Mail Transfer Protocol"'>RFC5321</a>], which uses MX resource records instead of SRV records, are
   described in [<a href="rfc7672.html" title='"SMTP Security via Opportunistic DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS)"'>RFC7672</a>].)

   This document describes how to use DANE TLSA records with SRV
   records.  To summarize:

   o  We rely on DNSSEC to secure SRV records that map the desired
      service, transport protocol, and service domain name to the
      corresponding target server connection endpoints (i.e., the target
      server hostnames and port numbers returned in the SRV records for
      that service type).

   o  Although in accordance with [<a href="rfc2782.html" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC2782</a>] a service domain name can
      advertise a number of SRV records (some of which might map to
      connection endpoints that do not support TLS), the intent of this
      specification is for a client to securely discover connection
      endpoints that support TLS.

   o  The TLSA records for each connection endpoint are located using
      the transport protocol, port number, and hostname for the target
      server (not the service domain name).

   o  When DNSSEC-validated TLSA records are published for a given
      connection endpoint, clients always use TLS when connecting (even
      if the connection endpoint supports cleartext communication).

   o  If there is at least one usable TLSA record for a given connection
      endpoint, the connection endpoint's TLS certificate or public key
      needs to match at least one of those usable TLSA records.

   o  If there are no usable TLSA records for a given connection
      endpoint, the target server hostname is used as one of the
      acceptable reference identifiers, as described in [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>].
      Other reference identifiers might arise through CNAME expansion of
      either the service domain name or target server hostname, as
      detailed in [<a href="rfc7671.html" title='"The DNS-Based Authentication of Named Entities (DANE) Protocol: Updates and Operational Guidance"'>RFC7671</a>].




<span class="grey">Finch, et al.                Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


   o  If there are no usable TLSA records for any connection endpoint
      (and thus the client cannot securely discover a connection
      endpoint that supports TLS), the client's behavior is a matter for
      the application protocol or client implementation; this might
      involve a fallback to non-DANE behavior using the public key
      infrastructure [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this memo are to be interpreted as described in
   [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   This document uses the definitions for "secure", "insecure", "bogus",
   and "indeterminate" from <a href="rfc4035.html#section-4.3">Section 4.3 of [RFC4035]</a>.  This document
   uses the acronyms from [<a href="rfc7218.html" title='"Adding Acronyms to Simplify Conversations about DNS-Based Authentication of Named Entities (DANE)"'>RFC7218</a>] for the values of TLSA fields where
   appropriate.

   Additionally, this document uses the following terms:

   connection endpoint:  A tuple of a fully qualified DNS hostname,
      transport protocol, and port number that a client uses to
      establish a connection to the target server.

   service domain name:  The fully qualified DNS domain name that
      identifies an application service; corresponds to the term "source
      domain" from [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>].

   This document uses the term "target server hostname" in place of the
   term "derived domain" from the so-called CertID specification
   [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20DNS%20Checks"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  DNS Checks</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20SRV%20Query"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  SRV Query</span>

   When the client makes an SRV query, a successful result will
   typically be a list of one or more SRV records (or possibly a chain
   of CNAME/DNAME aliases leading to such a list).

      NOTE: Implementers need to be aware that unsuccessful results can
      occur because of various DNS-related errors; guidance on avoiding
      downgrade attacks can be found in <a href="rfc7672.html#section-2.1">Section 2.1 of [RFC7672]</a>.







<span class="grey">Finch, et al.                Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


   For this specification to apply, the entire chain of DNS RRset(s)
   returned MUST be "secure" according to DNSSEC validation (<a href="rfc4035.html#section-5">Section 5
   of [RFC4035]</a>).  In the case where the answer is obtained via a chain
   of CNAME and/or DNAME aliases, the whole chain of CNAME and DNAME
   RRsets MUST also be secure.

   If the SRV lookup fails because the RRset is "bogus" (or the lookup
   fails for reasons other than no records), the client MUST abort its
   attempt to connect to the desired service.  If the lookup result is
   "insecure" (or no SRV records exist), this protocol does not apply
   and the client SHOULD fall back to its non-DNSSEC, non-DANE (and
   possibly non-SRV) behavior.

   When the lookup returns a "secure" RRset (possibly via a chain of
   "secure" CNAME/DNAME records), the client now has an authentic list
   of target server connection endpoints with weight and priority
   values.  It performs server ordering and selection using the weight
   and priority values without regard to the presence or absence of
   DNSSEC or TLSA records.  It also takes note of the DNSSEC validation
   status of the SRV response for use when checking certificate names
   (see <a href="#section-4">Section 4</a>).  The client can then proceed to making address
   queries on the target server hostnames as described in the following
   section.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Address%20Queries"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Address Queries</span>

   For each SRV target server connection endpoint, the client makes
   A and/or AAAA queries, performs DNSSEC validation on the address
   (A or AAAA) response, and continues as follows, based on the results:

   o  If a returned RRSet is "secure", the client MUST perform a TLSA
      query for that target server connection endpoint, as described in
      the next section.

   o  If no returned RRsets are "secure", the client MUST NOT perform a
      TLSA query for that target server connection endpoint; the TLSA
      query will most likely fail or produce spurious results.

   o  If the address record lookup fails (a validation status of either
      "bogus" or "indeterminate"), the client MUST NOT connect to this
      connection endpoint; instead, it uses the next most appropriate
      SRV target.  This helps prevent downgrade attacks.









<span class="grey">Finch, et al.                Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20TLSA%20Queries"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  TLSA Queries</span>

   The client SHALL construct the TLSA query name as described in
   <a href="rfc6698.html#section-3">Section 3 of [RFC6698]</a>, based on the fields from the SRV record: the
   port number from the SRV RDATA, the transport protocol from the SRV
   query name, and the TLSA base domain from the SRV target server
   hostname.

   For example, the following SRV record for IMAP (see [<a href="rfc6186.html" title='"Use of SRV Records for Locating Email Submission/Access Services"'>RFC6186</a>])

       _imap._tcp.example.com. 86400 IN SRV 10 0 9143 imap.example.net.

   leads to the TLSA query shown below:

       _9143._tcp.imap.example.net. IN TLSA ?

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Impact%20on%20TLS%20Usage"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Impact on TLS Usage</span>

   The client SHALL determine if the TLSA records returned in the
   previous step are usable according to <a href="rfc6698.html#section-4.1">Section 4.1 of [RFC6698]</a>.  This
   affects the use of TLS as follows:

   o  If the TLSA response is "secure" and usable, then the client MUST
      use TLS when connecting to the target server.  The TLSA records
      are used when validating the server's certificate as described in
      <a href="#section-4">Section 4</a>.

   o  If the TLSA response is "bogus" or "indeterminate" (or the lookup
      fails for reasons other than no records), then the client MUST NOT
      connect to the target server (the client can still use other SRV
      targets).

   o  If the TLSA response is "insecure" (or no TLSA records exist),
      then the client SHALL proceed as if the target server had no TLSA
      records.  It MAY connect to the target server with or without TLS,
      subject to the policies of the application protocol or client
      implementation.














<span class="grey">Finch, et al.                Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20TLS%20Checks"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  TLS Checks</span>

   When connecting to a server, the client MUST use TLS if the responses
   to the SRV and TLSA queries were "secure" as described above.  The
   rules described in the next two sections -- <a href="#section-4.2">Section 4.2</a> for cases
   where there is at least one usable TLSA record, and <a href="#section-4.1">Section 4.1</a>
   otherwise -- apply to such secure responses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20SRV%20Records%20Only"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  SRV Records Only</span>

   If the client received zero usable TLSA certificate associations, it
   SHALL validate the server's TLS certificate using the normal PKIX
   rules [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] or protocol-specific rules (e.g., following
   [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>]) without further input from the TLSA records.  In this
   case, the client uses the information in the server certificate and
   the DNSSEC validation status of the SRV query in its authentication
   checks.  It SHOULD use the Server Name Indication extension (TLS SNI)
   [<a href="rfc6066.html" title='"Transport Layer Security (TLS) Extensions: Extension Definitions"'>RFC6066</a>] or its functional equivalent in the relevant application
   protocol (e.g., in the Extensible Messaging and Presence Protocol
   (XMPP) [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>], this is the 'to' address of the initial stream
   header).  The preferred name SHALL be chosen as follows, and the
   client SHALL verify the identity asserted by the server's certificate
   according to <a href="rfc6125.html#section-6">Section 6 of [RFC6125]</a>, using a list of reference
   identifiers constructed as follows (note again that in <a href="rfc6125.html">RFC 6125</a> the
   terms "source domain" and "derived domain" refer to the same things
   as "service domain name" and "target server hostname" in this
   document).  The examples below assume a service domain name of
   "im.example.com" and a target server hostname of
   "xmpp23.hosting.example.net".

   SRV is insecure:  The reference identifiers SHALL include the service
      domain name and MUST NOT include the SRV target server hostname
      (e.g., include "im.example.com" but not
      "xmpp23.hosting.example.net").  The service domain name is the
      preferred name for TLS SNI or its equivalent.

   SRV is secure:  The reference identifiers SHALL include both the
      service domain name and the SRV target server hostname (e.g.,
      include both "im.example.com" and "xmpp23.hosting.example.net").
      The service domain name is still the preferred name for TLS SNI or
      its equivalent (this reduces code complexity and the possibility
      of interoperability problems).

   In the latter case, the client will accept either identity to ensure
   compatibility with servers that support this specification as well as
   servers that do not support this specification.





<span class="grey">Finch, et al.                Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20TLSA%20Records"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  TLSA Records</span>

   If the client received one or more usable TLSA certificate
   associations, it SHALL process them as described in <a href="rfc6698.html#section-2.1">Section 2.1 of
   [RFC6698]</a>.

   If the TLS server's certificate -- or the public key of the server's
   certificate -- matches a usable TLSA record with certificate usage
   DANE-EE, the client MUST ignore validation checks from [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] and
   reference identifier checks from [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>].  The information in such
   a TLSA record supersedes the non-key information in the certificate.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Guidance%20for%20Protocol%20Authors"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Guidance for Protocol Authors</span>

   This document describes how to use DANE with application protocols in
   which target servers are discovered via SRV records.  Although this
   document attempts to provide generic guidance applying to all such
   protocols, additional documents for particular application protocols
   could cover related topics, such as:

   o  Fallback logic in the event that a client is unable to connect
      securely to a target server by following the procedures defined in
      this document.

   o  How clients ought to behave if (1) they do not support SRV lookups
      or (2) they do support SRV lookups and encounter service domain
      names that do not offer SRV records.

   o  Whether or not the application protocol has a functional
      equivalent for TLS SNI that is preferred within that protocol.

   o  The use of SRV records with additional discovery technologies,
      such as the use of both SRV records and NAPTR records [<a href="rfc3403.html" title='"Dynamic Delegation Discovery System (DDDS) Part Three: The Domain Name System (DNS) Database"'>RFC3403</a>]
      for transport selection in the Session Initiation Protocol (SIP).

   For example, [<a href="#ref-XMPP-DNA" title='"Domain Name Associations (DNA) in the Extensible Messaging and Presence Protocol (XMPP)"'>XMPP-DNA</a>] covers such topics for XMPP.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Guidance%20for%20Server%20Operators"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Guidance for Server Operators</span>

   To conform to this specification, the published SRV records and
   subsequent address (A and AAAA) records MUST be secured with DNSSEC.
   There SHOULD also be at least one TLSA record published that
   authenticates the server's certificate.

   When using TLSA records with certificate usage DANE-EE, it is not
   necessary for the deployed certificate to contain an identifier for
   either the source domain or target server hostname.  However,
   operators need to be aware that servers relying solely on validation



<span class="grey">Finch, et al.                Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


   using certificate usage DANE-EE TLSA records might prevent clients
   that do not support this specification from successfully connecting
   with TLS.

   For TLSA records with certificate usage types other than DANE-EE, the
   certificate(s) MUST contain an identifier that matches:

   o  the service domain name (the "source domain" in [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>] terms,
      which is the SRV query domain), and/or

   o  the target server hostname (the "derived domain" in [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>]
      terms, which is the SRV target hostname).

   Servers that support multiple service domain names (i.e., so-called
   "multi-tenanted environments") can implement TLS SNI [<a href="rfc6066.html" title='"Transport Layer Security (TLS) Extensions: Extension Definitions"'>RFC6066</a>] or its
   functional equivalent to determine which certificate to offer.
   Clients that do not support this specification will indicate a
   preference for the service domain name, while clients that support
   this specification will indicate the target server hostname.
   However, the server determines what certificate to present in the TLS
   handshake; e.g., the presented certificate might only authenticate
   the target server hostname.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Guidance%20for%20Application%20Developers"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Guidance for Application Developers</span>

   Developers of application clients that depend on DANE-SRV often would
   like to prepare as quickly as possible for making a connection to the
   intended service, thus reducing the wait time for end users.  To make
   this optimization possible, a DNS library might perform the address
   queries and TLSA queries in parallel.  (Because a TLSA record can be
   ignored if it turns out that the address record on which it depends
   is not secure, performing the TLSA queries in parallel with the
   address queries is not harmful from a security perspective and can
   yield some operational benefits.)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Internationalization%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Internationalization Considerations</span>

   If any of the DNS queries are for an internationalized domain name,
   then they need to use the A-label form [<a href="rfc5890.html" title='"Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework"'>RFC5890</a>].












<span class="grey">Finch, et al.                Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Mixed%20Security%20Status"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Mixed Security Status</span>

   We do not specify that all of the target server connection endpoints
   for a service domain name need to be consistent in whether they have
   or do not have TLSA records.  This is so that partial or incremental
   deployment does not break the service.  Different levels of
   deployment are likely if a service domain name has a third-party
   fallback server, for example.

   The SRV sorting rules are unchanged; in particular, they have not
   been altered in order to prioritize secure connection endpoints over
   insecure connection endpoints.  If a site wants to be secure, it
   needs to deploy this protocol completely; a partial deployment is not
   secure, and we make no special effort to support it.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Certificate%20Subject%20Name%20Matching"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Certificate Subject Name Matching</span>

   <a href="#section-4">Section 4</a> of the TLSA specification [<a href="rfc6698.html" title='"The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA"'>RFC6698</a>] leaves the details of
   checking names in certificates to higher-level application protocols,
   though it suggests the use of [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>].

   Name checks are not necessary if the matching TLSA record is of
   certificate usage DANE-EE.  Because such a record identifies the
   specific certificate (or public key of the certificate), additional
   checks are superfluous and potentially conflicting.

   Otherwise, while DNSSEC provides a secure binding between the server
   name and the TLSA record, and the TLSA record provides a binding to a
   certificate, this latter step can be indirect via a chain of
   certificates.  For example, a certificate usage PKIX-TA TLSA record
   only authenticates the Certification Authority (CA) that issued the
   certificate, and third parties can obtain certificates from the same
   CA.  Therefore, clients need to check to see whether or not the
   server's certificate matches one of the expected reference
   identifiers to ensure that the certificate was issued by the CA to
   the server the client expects (naturally, this is in addition to
   standard certificate-related checks as specified in [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>],
   including but not limited to certificate syntax, certificate
   extensions such as name constraints and extended key usage, and
   handling of certification paths).









<span class="grey">Finch, et al.                Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2782" name="ref-RFC2782">RFC2782</a>]  Gulbrandsen, A., Vixie, P., and L. Esibov, "A DNS RR for
              specifying the location of services (DNS SRV)", <a href="rfc2782.html">RFC 2782</a>,
              DOI 10.17487/RFC2782, February 2000,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2782">http://www.rfc-editor.org/info/rfc2782</a>&gt;.

   [<a id="ref-RFC4033" name="ref-RFC4033">RFC4033</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "DNS Security Introduction and Requirements",
              <a href="rfc4033.html">RFC 4033</a>, DOI 10.17487/RFC4033, March 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4033">http://www.rfc-editor.org/info/rfc4033</a>&gt;.

   [<a id="ref-RFC4035" name="ref-RFC4035">RFC4035</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "Protocol Modifications for the DNS Security
              Extensions", <a href="rfc4035.html">RFC 4035</a>, DOI 10.17487/RFC4035, March 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4035">http://www.rfc-editor.org/info/rfc4035</a>&gt;.

   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, DOI 10.17487/RFC5280, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5280">http://www.rfc-editor.org/info/rfc5280</a>&gt;.

   [<a id="ref-RFC5890" name="ref-RFC5890">RFC5890</a>]  Klensin, J., "Internationalized Domain Names for
              Applications (IDNA): Definitions and Document Framework",
              <a href="rfc5890.html">RFC 5890</a>, DOI 10.17487/RFC5890, August 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5890">http://www.rfc-editor.org/info/rfc5890</a>&gt;.

   [<a id="ref-RFC6066" name="ref-RFC6066">RFC6066</a>]  Eastlake 3rd, D., "Transport Layer Security (TLS)
              Extensions: Extension Definitions", <a href="rfc6066.html">RFC 6066</a>,
              DOI 10.17487/RFC6066, January 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6066">http://www.rfc-editor.org/info/rfc6066</a>&gt;.

   [<a id="ref-RFC6125" name="ref-RFC6125">RFC6125</a>]  Saint-Andre, P. and J. Hodges, "Representation and
              Verification of Domain-Based Application Service Identity
              within Internet Public Key Infrastructure Using X.509
              (PKIX) Certificates in the Context of Transport Layer
              Security (TLS)", <a href="rfc6125.html">RFC 6125</a>, DOI 10.17487/RFC6125,
              March 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6125">http://www.rfc-editor.org/info/rfc6125</a>&gt;.





<span class="grey">Finch, et al.                Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


   [<a id="ref-RFC6698" name="ref-RFC6698">RFC6698</a>]  Hoffman, P. and J. Schlyter, "The DNS-Based Authentication
              of Named Entities (DANE) Transport Layer Security (TLS)
              Protocol: TLSA", <a href="rfc6698.html">RFC 6698</a>, DOI 10.17487/RFC6698,
              August 2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6698">http://www.rfc-editor.org/info/rfc6698</a>&gt;.

   [<a id="ref-RFC7218" name="ref-RFC7218">RFC7218</a>]  Gudmundsson, O., "Adding Acronyms to Simplify
              Conversations about DNS-Based Authentication of Named
              Entities (DANE)", <a href="rfc7218.html">RFC 7218</a>, DOI 10.17487/RFC7218,
              April 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7218">http://www.rfc-editor.org/info/rfc7218</a>&gt;.

   [<a id="ref-RFC7671" name="ref-RFC7671">RFC7671</a>]  Dukhovni, V. and W. Hardaker, "The DNS-Based
              Authentication of Named Entities (DANE) Protocol: Updates
              and Operational Guidance", <a href="rfc7671.html">RFC 7671</a>, DOI 10.17487/RFC7671,
              October 2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7671">http://www.rfc-editor.org/info/rfc7671</a>&gt;.

   [<a id="ref-RFC7672" name="ref-RFC7672">RFC7672</a>]  Dukhovni, V. and W. Hardaker, "SMTP Security via
              Opportunistic DNS-Based Authentication of Named Entities
              (DANE) Transport Layer Security (TLS)", <a href="rfc7672.html">RFC 7672</a>,
              DOI 10.17487/RFC7672, October 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7672">http://www.rfc-editor.org/info/rfc7672</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-RFC3403" name="ref-RFC3403">RFC3403</a>]  Mealling, M., "Dynamic Delegation Discovery System (DDDS)
              Part Three: The Domain Name System (DNS) Database",
              <a href="rfc3403.html">RFC 3403</a>, DOI 10.17487/RFC3403, October 2002,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3403">http://www.rfc-editor.org/info/rfc3403</a>&gt;.

   [<a id="ref-RFC5321" name="ref-RFC5321">RFC5321</a>]  Klensin, J., "Simple Mail Transfer Protocol", <a href="rfc5321.html">RFC 5321</a>,
              DOI 10.17487/RFC5321, October 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5321">http://www.rfc-editor.org/info/rfc5321</a>&gt;.

   [<a id="ref-RFC6120" name="ref-RFC6120">RFC6120</a>]  Saint-Andre, P., "Extensible Messaging and Presence
              Protocol (XMPP): Core", <a href="rfc6120.html">RFC 6120</a>, DOI 10.17487/RFC6120,
              March 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6120">http://www.rfc-editor.org/info/rfc6120</a>&gt;.

   [<a id="ref-RFC6186" name="ref-RFC6186">RFC6186</a>]  Daboo, C., "Use of SRV Records for Locating Email
              Submission/Access Services", <a href="rfc6186.html">RFC 6186</a>,
              DOI 10.17487/RFC6186, March 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6186">http://www.rfc-editor.org/info/rfc6186</a>&gt;.

   [<a id="ref-XMPP-DNA" name="ref-XMPP-DNA">XMPP-DNA</a>] Saint-Andre, P., Miller, M., and P. Hancke, "Domain Name
              Associations (DNA) in the Extensible Messaging and
              Presence Protocol (XMPP)", Work in Progress,
              <a href="https://tools.ietf.org/html/draft-ietf-xmpp-dna-11">draft-ietf-xmpp-dna-11</a>, September 2015.






<span class="grey">Finch, et al.                Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Examples"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Examples</span>

   In the following, most of the DNS resource data is elided for
   simplicity.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20IMAP"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  IMAP</span>

   ; mail domain
   _imap._tcp.example.com.   SRV 10 0 9143 imap.example.net.
   example.com.              RRSIG   SRV ...

   ; target server hostname
   imap.example.net.         A      192.0.2.1
   imap.example.net.         RRSIG  A ...

   imap.example.net.         AAAA   2001:db8:212:8::e:1
   imap.example.net.         RRSIG  ...

   ; TLSA resource record
   _9143._tcp.imap.example.net.  TLSA   ...
   _9143._tcp.imap.example.net.  RRSIG  TLSA ...

   Mail messages received for addresses at example.com are retrieved via
   IMAP at imap.example.net.  Connections to imap.example.net port 9143
   that use STARTTLS will get a server certificate that authenticates
   the name imap.example.net.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20XMPP"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  XMPP</span>

   ; XMPP domain
   _xmpp-client._tcp.example.com. SRV     1 0 5222 im.example.net.
   _xmpp-client._tcp.example.com. RRSIG   SRV ...

   ; target server hostname
   im.example.net.           A      192.0.2.3
   im.example.net.           RRSIG  A ...

   im.example.net.           AAAA   2001:db8:212:8::e:4
   im.example.net.           RRSIG  AAAA ...

   ; TLSA resource record
   _5222._tcp.im.example.net.  TLSA   ...
   _5222._tcp.im.example.net.  RRSIG  TLSA ...

   XMPP sessions for addresses at example.com are established at
   im.example.net.  Connections to im.example.net port 5222 that use
   STARTTLS will get a server certificate that authenticates the name
   im.example.net.



<span class="grey">Finch, et al.                Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Rationale"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Rationale</span>

   The long-term goal of this specification is to settle on TLS
   certificates that verify the target server hostname rather than the
   service domain name, since this is more convenient for servers
   hosting multiple domains (so-called "multi-tenanted environments")
   and scales up more easily to larger numbers of service domain names.

   There are a number of other reasons for doing it this way:

   o  The certificate is part of the server configuration, so it makes
      sense to associate it with the target server hostname rather than
      the service domain name.

   o  In the absence of TLS SNI, if the certificate identifies the
      target server hostname, then it does not need to list all the
      possible service domain names.

   o  When the server certificate is replaced, it is much easier if
      there is one part of the DNS that needs updating to match, instead
      of an unbounded number of hosted service domain names.

   o  The same TLSA records work with this specification, and with
      direct connections to the connection endpoint in the style of
      [<a href="rfc6698.html" title='"The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA"'>RFC6698</a>].

   o  Some application protocols, such as SMTP, allow a client to
      perform transactions with multiple service domain names in the
      same connection.  It is not, in general, feasible for the client
      to specify the service domain name using TLS SNI when the
      connection is established, and the server might not be able to
      present a certificate that authenticates all possible service
      domain names.  See [<a href="rfc7672.html" title='"SMTP Security via Opportunistic DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS)"'>RFC7672</a>] for details.

   o  It is common for SMTP servers to act in multiple roles -- for
      example, as outgoing relays or as incoming MX servers, depending
      on the client identity.  It is simpler if the server can present
      the same certificate regardless of the role in which it is to act.
      Sometimes the server does not know its role until the client has
      authenticated, which usually occurs after TLS has been
      established.  See [<a href="rfc7672.html" title='"SMTP Security via Opportunistic DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS)"'>RFC7672</a>] for details.










<span class="grey">Finch, et al.                Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


   This specification does not provide an option to put TLSA records
   under the service domain name, because that would add complexity
   without providing any benefit; security protocols are best kept
   simple.  As described above, there are real-world cases where
   authenticating the service domain name cannot be made to work, so
   there would be complicated criteria regarding when service domain
   name TLSA records might be used and when they cannot.  This is all
   avoided by putting the TLSA records under the target server hostname.

   The disadvantage is that clients that do not complete DNSSEC
   validation must, according to [<a href="rfc6125.html" title='"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"'>RFC6125</a>] rules, check the server
   certificate against the service domain name, since they have no other
   way to authenticate the server.  This means that SNI support or its
   functional equivalent is necessary for backward compatibility.

Acknowledgements

   Thanks to Mark Andrews for arguing that authenticating the target
   server hostname is the right thing, and that we ought to rely on
   DNSSEC to secure the SRV lookup.  Thanks to Stephane Bortzmeyer,
   James Cloos, Viktor Dukhovni, Ned Freed, Olafur Gudmundsson, Paul
   Hoffman, Phil Pennock, Hector Santos, Jonas Schneider, and Alessandro
   Vesely for helpful suggestions.

   Carl Wallace completed an insightful review on behalf of the Security
   Directorate.

   Ben Campbell, Brian Haberman, and Alvaro Retana provided helpful
   feedback during IESG review.

   The authors gratefully acknowledge the assistance of Olafur
   Gudmundsson and Warren Kumari as the working group chairs and Stephen
   Farrell as the sponsoring Area Director.

   Peter Saint-Andre wishes to acknowledge Cisco Systems, Inc., for
   employing him during his work on earlier draft versions of this
   document.














<span class="grey">Finch, et al.                Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7673.html">RFC 7673</a>                      TLSA and SRV                  October 2015</span>


Authors' Addresses

   Tony Finch
   University of Cambridge Information Services
   Roger Needham Building
   7 JJ Thomson Avenue
   Cambridge  CB3 0RB
   United Kingdom

   Phone: +44 797 040 1426
   Email: dot@dotat.at
   URI:   <a href="http://dotat.at/">http://dotat.at/</a>


   Matthew Miller
   Cisco Systems, Inc.
   1899 Wynkoop Street, Suite 600
   Denver, CO  80202
   United States

   Email: mamille2@cisco.com


   Peter Saint-Andre
   &amp;yet

   Email: peter@andyet.com
   URI:   <a href="https://andyet.com/">https://andyet.com/</a>























Finch, et al.                Standards Track                   [Page 16]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7673 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:20 GMT --></html>