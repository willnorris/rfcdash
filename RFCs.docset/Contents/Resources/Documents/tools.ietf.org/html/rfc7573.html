<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7573 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-saintandre-sip-xmpp-chat" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7573" name="DC.Identifier"/>
<meta content="June, 2015" name="DC.Date.Issued"/>
<meta content="Loreto, Salvatore" name="DC.Creator"/>
<meta content="Saint-Andre, Peter" name="DC.Creator"/>
<meta content="This document defines a bidirectional protocol mapping for the
exchange of instant messages in the context of a one-to-one chat
session between a user of the Session Initiation Protocol (SIP) and a
user of the Extensible Messaging and Presence Protocol (XMPP).
Specifically for SIP text chat, this document specifies a mapping to
the Message Session Relay Protocol (MSRP)." name="DC.Description.Abstract"/>
<meta content="Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): One-to-One Text Chat Sessions" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7573 - Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): One-to-One Text Chat Sessions</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7573.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7573" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-stox-chat" title="draft-ietf-stox-chat">draft-ietf-stox...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7573" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7573" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7573" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                    P. Saint-Andre
Request for Comments: 7573                                          &amp;yet
Category: Standards Track                                      S. Loreto
ISSN: 2070-1721                                                 Ericsson
                                                               June 2015


   <span class="h1">Interworking between the Session Initiation Protocol (SIP) and the</span>
           <span class="h1">Extensible Messaging and Presence Protocol (XMPP):</span>
                     <span class="h1">One-to-One Text Chat Sessions</span>

Abstract

   This document defines a bidirectional protocol mapping for the
   exchange of instant messages in the context of a one-to-one chat
   session between a user of the Session Initiation Protocol (SIP) and a
   user of the Extensible Messaging and Presence Protocol (XMPP).
   Specifically for SIP text chat, this document specifies a mapping to
   the Message Session Relay Protocol (MSRP).

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7573">http://www.rfc-editor.org/info/rfc7573</a>.

Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
   <a href="#section-2">2</a>. Intended Audience ...............................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Terminology .....................................................<a href="#page-4">4</a>
   <a href="#section-4">4</a>. XMPP to MSRP ....................................................<a href="#page-4">4</a>
   <a href="#section-5">5</a>. MSRP to XMPP ....................................................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Composing Events ...............................................<a href="#page-13">13</a>
      <a href="#section-6.1">6.1</a>. Use of the Gone Chat State ................................<a href="#page-14">14</a>
   <a href="#section-7">7</a>. Delivery Reports ...............................................<a href="#page-15">15</a>
   <a href="#section-8">8</a>. Message Size ...................................................<a href="#page-17">17</a>
   <a href="#section-9">9</a>. Internationalization Considerations ............................<a href="#page-18">18</a>
   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-18">18</a>
   <a href="#section-11">11</a>. References ....................................................<a href="#page-18">18</a>
      <a href="#section-11.1">11.1</a>. Normative References .....................................<a href="#page-18">18</a>
      <a href="#section-11.2">11.2</a>. Informative References ...................................<a href="#page-19">19</a>
   Acknowledgements ..................................................<a href="#page-20">20</a>
   Authors' Addresses ................................................<a href="#page-20">20</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Both the Session Initiation Protocol (SIP) [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] and the
   Extensible Messaging and Presence Protocol (XMPP) [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>] can be
   used for the purpose of one-to-one text chat over the Internet.  To
   ensure interworking between these technologies, it is important to
   define bidirectional protocol mappings.

   The architectural assumptions underlying such protocol mappings are
   provided in [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>], including mapping of addresses and error
   conditions.  This document specifies mappings for one-to-one text
   chat sessions (sometimes called "session-mode" messaging); in
   particular, this document specifies mappings between XMPP messages of
   type "chat" and the Message Session Relay Protocol (MSRP) [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>],
   which is commonly used in SIP-based systems for chat functionality
   (although note that MSRP is not conjoined to SIP, and can be used by
   non-SIP technologies).  Mappings for single instant messages and
   groupchat are provided in [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>] and [<a href="#ref-GROUPCHAT" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Groupchat"'>GROUPCHAT</a>].

   The approach taken here is to directly map syntax and semantics from
   one protocol to another.  The mapping described herein depends on the
   protocols defined in the following specifications:

   o  XMPP chat sessions using message stanzas of type "chat" are
      specified in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>].

   o  MSRP chat sessions using the SIP INVITE and SEND request types are
      specified in [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>].




<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   In SIP-based systems that use MSRP, a chat session is formally
   negotiated (just as any other session type is negotiated when using
   SIP).  By contrast, a one-to-one chat "session" in XMPP is an
   informal construct and is not formally negotiated: a user simply
   sends a message of type "chat" to a contact, the contact then replies
   to the message, and the sum total of such messages exchanged during a
   defined period of time is considered to be a chat session (ideally
   tied together using an XMPP &lt;thread/&gt; element as described in
   <a href="rfc6121.html#section-5.1">Section 5.1 of [RFC6121]</a>).  To overcome the disparity between these
   approaches, a gateway that wishes to map between SIP/MSRP and XMPP
   for one-to-one chat sessions needs to maintain some additional state,
   as described below.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Intended%20Audience"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Intended Audience</span>

   The documents in this series are intended for use by software
   developers who have an existing system based on one of these
   technologies (e.g., SIP) and who would like to enable communication
   from that existing system to systems based on the other technology
   (e.g., XMPP).  We assume that readers are familiar with the core
   specifications for both SIP [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] and XMPP [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>], with the
   base document for this series [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>], and with the following chat-
   related specifications:

   o  "The Message Session Relay Protocol (MSRP)" [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>]

   o  "Extensible Messaging and Presence Protocol (XMPP): Instant
      Messaging and Presence" [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>]

   o  "Indication of Message Composition for Instant Messaging"
      [<a href="rfc3994.html" title='"Indication of Message Composition for Instant Messaging"'>RFC3994</a>]

   o  "Chat State Notifications" [<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>]

   Note well that not all protocol-compliant messages are shown (such as
   SIP 100 TRYING messages), in order to focus the reader on the
   essential aspects of the protocol flows.














<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Terminology"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Terminology</span>

   A number of terms used here are explained in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>], [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>],
   [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>], and [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>].

   In flow diagrams, SIP/MSRP traffic is shown using arrows such as
   "***&gt;" whereas XMPP traffic is shown using arrows such as "...&gt;".

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20XMPP%20to%20MSRP"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  XMPP to MSRP</span>

   In XMPP, the "informal session" approach is to simply send someone a
   &lt;message/&gt; of type "chat" without starting any session negotiation
   ahead of time (as described in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>]).  The XMPP "informal
   session" approach maps very well into a SIP MESSAGE request, as
   described in [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>].  However, the XMPP informal session approach
   can also be mapped to MSRP if the XMPP-to-SIP gateway maintains
   additional state.  The order of events is as follows.


   XMPP            XMPP        XMPP-to-MSRP        SIP             SIP
   User           Server         Gateway          Server          User
    |               |               |               |               |
    | (F1) XMPP     |               |               |               |
    | message       |               |               |               |
    |..............&gt;|               |               |               |
    |               | (F2) XMPP     |               |               |
    |               | message       |               |               |
    |               |..............&gt;|               |               |
    |               |               | (F3) SIP      |               |
    |               |               | INVITE        |               |
    |               |               |**************&gt;|               |
    |               |               |               | (F4) SIP      |
    |               |               |               | INVITE        |
    |               |               |               |**************&gt;|
    |               |               |               | (F5) SIP      |
    |               |               |               | 200 OK        |
    |               |               |               |&lt;**************|
    |               |               | (F6) SIP      |               |
    |               |               | 200 OK        |               |
    |               |               |&lt;**************|               |
    |               |               | (F7) SIP ACK  |               |
    |               |               |**************&gt;|               |




<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


    |               |               |               | (F8) SIP ACK  |
    |               |               |               |**************&gt;|
    |               |               | (F9) MSRP SEND                |
    |               |               |******************************&gt;|
    .               .               .               .               .
    .               .               .               .               .
    |               |               | (F10) MSRP SEND               |
    |               |               |&lt;******************************|
    |               | (F11) XMPP    |               |               |
    |               | message       |               |               |
    |               |&lt;..............|               |               |
    | (F12) XMPP    |               |               |               |
    | message       |               |               |               |
    |&lt;..............|               |               |               |
    .               .               .               .               .
    .               .               .               .               .
    |               |               |               | (F13) SIP BYE |
    |               |               |               |&lt;**************|
    |               |               | (F14) SIP BYE |               |
    |               |               |&lt;**************|               |
    |               |               | (F15) SIP     |               |
    |               |               | 200 OK        |               |
    |               |               |**************&gt;|               |
    |               |               |               | (F16) SIP     |
    |               |               |               | 200 OK        |
    |               |               |               |**************&gt;|

                  Figure 1: XMPP to MSRP Order of Events

   The mapping of XMPP syntax to SIP syntax MUST be as specified in
   [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>].

   First, the XMPP user would generate an XMPP chat message.

   Example 1: Juliet Sends XMPP Message (F1)

   | &lt;message from='juliet@example.com/yn0cl4bnw0yr3vym'
   |          to='romeo@example.net'
   |          id='a786hjs2'
   |          type='chat'&gt;
   |   &lt;thread&gt;29377446-0CBB-4296-8958-590D79094C50&lt;/thread&gt;
   |   &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
   | &lt;/message&gt;

   Upon receiving such a message stanza, the XMPP server needs to
   determine the identity of the domainpart in the 'to' address, which
   it does by following the procedures explained in <a href="rfc7247.html#section-5">Section 5 of
   [RFC7247]</a>.  If the domain is a SIP domain, the XMPP server will hand



<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   off the message stanza to an XMPP-to-SIP gateway or connection
   manager that natively communicates with MSRP-aware SIP servers.

   The XMPP-to-SIP gateway at the XMPP server would then initiate an
   MSRP session with Romeo on Juliet's behalf (since there is no
   reliable way for the gateway to determine whether Romeo's client
   supports MSRP, if that is not the case then MSRP session initiation
   might result in an error).

   Example 2: Gateway Starts SIP Session on Behalf of Juliet (F3)

   | INVITE sip:romeo@example.net SIP/2.0
   | To: &lt;sip:romeo@example.net&gt;
   | From: &lt;sip:juliet@example.com&gt;
   | Contact: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | Subject: Open chat with Juliet?
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 1 INVITE
   | Content-Type: application/sdp
   |
   | c=IN IP4 x2s.example.com
   | m=message 7654 TCP/MSRP *
   | a=accept-types:text/plain
   | a=path:msrp://x2s.example.com:7654/jshA7weztas;tcp

   Here we assume that Romeo's client supports MSRP and that Romeo
   accepts the MSRP session request.

   Example 3: Romeo Accepts Session Request (F5)

   | SIP/2.0 200 OK
   | From: &lt;sip:juliet@example.com&gt;
   | To: &lt;sip:romeo@example.net&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 1 INVITE
   | Content-Type: application/sdp
   |
   | c=IN IP4 s2x.example.net
   | m=message 12763 TCP/MSRP *
   | a=accept-types:text/plain
   | a=path:msrp://s2x.example.net:12763/kjhd37s2s20w2a;tcp

   The XMPP-to-SIP gateway then acknowledges the session acceptance on
   behalf of Juliet.






<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 4: Gateway Sends ACK to Romeo (F7)

   | ACK sip:juliet@example.com SIP/2.0
   | To: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | From: &lt;sip:juliet@example.com&gt;
   | Contact: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 2 ACK

   The XMPP-to-SIP gateway then transforms the original XMPP chat
   message into MSRP.

   Example 5: Gateway Maps XMPP Message to MSRP (F9)

   | MSRP a786hjs2 SEND
   | From-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
   | To-Path: msrp://s2x.example.net:12763/kjhd37s2s20w2a;tcp
   | Message-ID: 54C6F4F1-A39C-47D6-8718-FA65B3D0414A
   | Byte-Range: 1-25/25
   | Content-Type: text/plain
   |
   | Art thou not Romeo, and a Montague?
   | -------a786hjs2$

   Romeo can then send a reply using his MSRP client.

   Example 6: Romeo Sends Reply (F10)

   | MSRP di2fs53v SEND
   | To-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
   | From-Path: msrp://s2x.example.net:12763/kjhd37s2s20w2a;tcp
   | Message-ID: 6480C096-937A-46E7-BF9D-1353706B60AA
   | Byte-Range: 1-25/25
   | Failure-Report: no
   | Content-Type: text/plain
   |
   | Neither, fair saint, if either thee dislike.
   | -------di2fs53v$

   The SIP-to-XMPP gateway would then transform that message into
   appropriate XMPP syntax for routing to the intended recipient.










<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 7: Gateway Maps MSRP Message to XMPP (F11)

   | &lt;message from='romeo@example.net/dr4hcr0st3lup4c'
   |          to='juliet@example.com/yn0cl4bnw0yr3vym'
   |          id='di2fs53v'
   |          type='chat'&gt;
   |   &lt;thread&gt;29377446-0CBB-4296-8958-590D79094C50&lt;/thread&gt;
   |   &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
   | &lt;/message&gt;

   When the MSRP user wishes to end the chat session, the user's MSRP
   client sends a SIP BYE.

   Example 8: Romeo Terminates Chat Session (F13)

   | BYE juliet@example.com sip: SIP/2.0
   | From: &lt;sip:juliet@example.com&gt;;tag=786
   | To: &lt;sip:romeo@example.net&gt;;tag=087js
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 3 BYE
   | Content-Length: 0

   The BYE is then acknowledged by the XMPP-to-SIP gateway.

   Example 9: Gateway Acknowledges Termination (F15)

   | SIP/2.0 200 OK
   | From: &lt;sip:juliet@example.com&gt;;tag=786
   | To: &lt;sip:romeo@example.net&gt;;tag=087js
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 3 BYE
   | Content-Length: 0

   Because there is no formal session on the XMPP side, there is no
   corresponding communication from the gateway to the XMPP user.
   However, it is reasonable for the gateway to send a "gone" chat state
   notification [<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>], as described under <a href="#section-6.1">Section 6.1</a>.

   In addition, there is no explicit method defined in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>] for an
   XMPP user to formally terminate a chat session, so a gateway would
   need to listen for a "gone" chat state notification from the XMPP
   user or institute a timer that considers the XMPP informal chat
   session to be ended after some amount of time has elapsed ([<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>]
   suggests generating a "gone" chat state if a user has not interacted
   with the chat session interface, system, or device for a relatively
   long period of time, e.g., 10 minutes).





<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20MSRP%20to%20XMPP"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  MSRP to XMPP</span>

   When an MSRP client sends messages through a gateway to an XMPP
   client, the order of events is as follows.

   SIP             SIP         MSRP-to-XMPP       XMPP            XMPP
   User           Server         Gateway         Server           User
    |               |               |               |               |
    | (F17) SIP     |               |               |               |
    | INVITE        |               |               |               |
    |**************&gt;|               |               |               |
    |               | (F18) SIP     |               |               |
    |               | INVITE        |               |               |
    |               |**************&gt;|               |               |
    |               | (F19) SIP     |               |               |
    |               | 200 OK        |               |               |
    |               |&lt;**************|               |               |
    | (F20) SIP     |               |               |               |
    | 200 OK        |               |               |               |
    |&lt;**************|               |               |               |
    | (F21) SIP ACK |               |               |               |
    |**************&gt;|               |               |               |
    |               | (F22) SIP ACK |               |               |
    |               |**************&gt;|               |               |
    | (F23) MSRP SEND               |               |               |
    |******************************&gt;|               |               |
    |               |               | (F24) XMPP    |               |
    |               |               | message       |               |
    |               |               |..............&gt;|               |
    |               |               |               | (F25) XMPP    |
    |               |               |               | message       |
    |               |               |               |..............&gt;|
    .               .               .               .               .
    .               .               .               .               .
    |               |               |               | (F26) XMPP    |
    |               |               |               | message       |
    |               |               |               |&lt;..............|
    |               |               | (F27) XMPP    |               |
    |               |               | message       |               |
    |               |               |&lt;..............|               |
    | (F28) MSRP SEND               |               |               |
    |&lt;******************************|               |               |
    .               .               .               .               .
    .               .               .               .               .
    |               |               |               |               |
    |               |               |               |               |
    | (F29) SIP BYE |               |               |               |
    |**************&gt;|               |               |               |



<span class="grey">Saint-Andre &amp; Loreto         Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


    |               | (F30) SIP BYE |               |               |
    |               |**************&gt;|               |               |
    |               | (F31) SIP     |               |               |
    |               | 200 OK        |               |               |
    |               |&lt;**************|               |               |
    | (F32) SIP     |               |               |               |
    | 200 OK        |               |               |               |
    |&lt;**************|               |               |               |

                  Figure 2: MSRP to XMPP Order of Events

   The mapping of SIP syntax to XMPP syntax MUST be as specified in
   [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>].

   The protocol flow begins when Romeo starts a chat session with
   Juliet.

   Example 10: Romeo Starts Chat Session (F17)

   | INVITE sip:juliet@example.com SIP/2.0
   | From: &lt;sip:romeo@example.net&gt;
   | To: &lt;sip:juliet@example.com&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Subject: Open chat with Romeo?
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 1 INVITE
   | Content-Type: application/sdp
   |
   | c=IN IP4 s2x.example.net
   | m=message 7313 TCP/MSRP *
   | a=accept-types:text/plain
   | a=path:msrp://s2x.example.net:7313/ansp71weztas;tcp

   Upon receiving the INVITE, the SIP (MSRP) server needs to determine
   the identity of the domain portion of the Request-URI or To header,
   which it does by following the procedures explained in <a href="rfc7247.html#section-5">Section 5 of
   [RFC7247]</a>.  If the domain is an XMPP domain, the SIP server will hand
   off the INVITE to an associated MSRP-to-XMPP gateway or connection
   manager that natively communicates with XMPP servers.












<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 11: Gateway Accepts Session on Juliet's Behalf (F19)

   | SIP/2.0 200 OK
   | From: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | To: &lt;sip:juliet@example.com&gt;
   | Contact: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 1 INVITE
   | Content-Type: application/sdp
   |
   | c=IN IP4 x2s.example.com
   | m=message 8763 TCP/MSRP *
   | a=accept-types:text/plain
   | a=path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp

   Example 12: Romeo Sends ACK (F21)

   | ACK sip:juliet@example.com SIP/2.0
   | To: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | From: &lt;sip:romeo@example.net&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 2 ACK

   Example 13: Romeo Sends Message (F23)

   | MSRP ad49kswow SEND
   | To-Path: msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
   | From-Path: msrp://s2x.example.net:7313/ansp71weztas;tcp
   | Message-ID: 676FDB92-7852-443A-8005-2A1B9FE44F4E
   | Byte-Range: 1-32/32
   | Failure-Report: no
   | Content-Type: text/plain
   |
   | I take thee at thy word ...
   | -------ad49kswow$

   Example 14: MSRP-to-XMPP Gateway Maps MSRP Message to XMPP (F24)

   | &lt;message from='romeo@example.net'
   |          to='juliet@example.com'
   |          id='ad49kswow'
   |          type='chat'&gt;
   |   &lt;thread&gt;F6989A8C-DE8A-4E21-8E07-F0898304796F&lt;/thread&gt;
   |   &lt;body&gt;I take thee at thy word ...&lt;/body&gt;
   | &lt;/message&gt;





<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 15: Juliet Sends Reply (F26)

   | &lt;message from='juliet@example.com'
   |          to='romeo@example.net'
   |          id='ms53b7z9'
   |          type='chat'&gt;
   |   &lt;thread&gt;29377446-0CBB-4296-8958-590D79094C50&lt;/thread&gt;
   |   &lt;body&gt;What man art thou ...?&lt;/body&gt;
   | &lt;/message&gt;

   Example 16: Gateway Maps XMPP Message to MSRP (F28)

   | MSRP ms53b7z9 SEND
   | To-Path: msrp://s2x.example.net:7313/jshA7weztas;tcp
   | From-Path: msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
   | Message-ID: 17EBA17B-94C0-463B-AD84-DE405C4C9D41
   | Byte-Range: 1-25/25
   | Failure-Report: no
   | Content-Type: text/plain
   |
   | What man art thou ...?
   | -------ms53b7z9$

   Example 17: Romeo Terminates Chat Session (F29)

   | BYE juliet@example.com sip: SIP/2.0
   | To: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | From: &lt;sip:romeo@example.net&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 3 BYE
   | Content-Length: 0

   Example 18: Gateway Acknowledges Termination of Session on Behalf of
   Juliet (F31)

   | SIP/2.0 200 OK
   | To: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | From: &lt;sip:romeo@example.net&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 3 BYE









<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Composing%20Events"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Composing Events</span>

   Both XMPP and MSRP enable a client to receive notifications when a
   person's conversation partner is composing an instant message within
   the context of a chat session.

   For XMPP, the Chat State Notifications specification [<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>]
   defines five states: active, inactive, gone, composing, and paused.
   Some of these states are related to the act of message composition
   (composing, paused), whereas others are related to the sender's
   involvement with the chat session (active, inactive, gone).  Note
   that the "gone" chat state is not to be confused with the &lt;gone/&gt;
   stanza error condition defined in [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>].

   For MSRP (and, in general, for so-called SIP for Instant Messaging
   and Presence Leveraging Extensions (SIMPLE) systems), the Indication
   of Message Composition for Instant Messaging specification [<a href="rfc3994.html" title='"Indication of Message Composition for Instant Messaging"'>RFC3994</a>]
   defines two states: idle and active.  Here the idle state indicates
   that the sender is not actively composing a message, and the active
   state indicates that the sender is indeed actively composing a
   message (the sending client simply toggles between the two states).

   Because XEP-0085 states can represent information that is not
   captured in <a href="rfc3994.html">RFC 3994</a>, gateways can either (a) map only the composing-
   related states or (b) map all the XEP-0085 states.

   The following mappings are suggested.

   Table 3: Mapping of SIP/SIMPLE isComposing Events to XMPP Chat states

   +-------------------+--------------------+
   | isComposing Event |  Chat State        |
   +-------------------+--------------------+
   | active            |  composing         |
   | idle              |  active            |
   +-------------------+--------------------+

   Table 4: Mapping of XMPP Chat States to SIP/SIMPLE isComposing Events

   +-------------------+--------------------+
   | Chat State        | isComposing Event  |
   +-------------------+--------------------+
   | active            |  idle              |
   | inactive          |  idle              |
   | gone              |  none (<a href="#section-6.1">Section 6.1</a>)|
   | composing         |  active            |
   | paused            |  idle              |
   +-------------------+--------------------+



<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   The XMPP Chat State Notifications specification [<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>] allows the
   sending of "standalone notifications" outside the context of a
   message, theoretically even before any messages are exchanged;
   although a gateway could thus send an &lt;active/&gt; notification to the
   XMPP user when the SIP user accepts or initiates a chat session
   (i.e., after F6 in <a href="#section-4">Section 4</a> or after F22 in <a href="#section-5">Section 5</a>), this usage
   might be unexpected by XMPP clients as a way to signal the beginning
   of an informal chat session.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Use%20of%20the%20Gone%20Chat%20State"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Use of the Gone Chat State</span>

   Although there is no direct mapping for the "gone" chat state to an
   isComposing event, receipt of the "gone" state at an XMPP-to-MSRP
   gateway can serve as a trigger for terminating the formal chat
   session within MSRP, i.e., for sending a SIP BYE for the session from
   the XMPP-to-MSRP gateway to the SIP user.  The following examples
   illustrate this indirect mapping (which would arise if, for example,
   the XMPP user were to send a "gone" chat state notification after
   step F12 in Figure 1 or step F28 in Figure 2; in either of these
   cases, the session would be terminated by the XMPP user instead of by
   the SIP user, as currently shown in Figures 1 and 2).

   Example 19: Juliet Sends Gone Chat State

   | &lt;message from='juliet@example.com'
   |          id='nx62f197'
   |          to='romeo@example.net'
   |          type='chat'&gt;
   |   &lt;thread&gt;29377446-0CBB-4296-8958-590D79094C50&lt;/thread&gt;
   |   &lt;gone xmlns='http://jabber.org/protocol/chatstates'/&gt;
   | &lt;/message&gt;

   Example 20: XMPP-to-MSRP Gateway Maps Gone Chat State to SIP BYE

   | BYE romeo@example.net sip: SIP/2.0
   | From: &lt;sip:juliet@example.com&gt;;tag=786
   | To: &lt;sip:romeo@example.net&gt;;tag=087js
   | Call-ID: 29377446-0CBB-4296-8958-590D79094C50
   | CSeq: 3 BYE
   | Content-Length: 0

   Similarly, receipt of a SIP BYE message at an MSRP-to-XMPP gateway
   can serve as a trigger for sending a "gone" chat state notification
   to the XMPP user.  The following examples illustrate this indirect
   mapping (which would occur after step F14 in Figure 1 or step F30 in
   Figure 2).





<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 21: Romeo Terminates Chat Session

   | BYE juliet@example.com sip: SIP/2.0
   | To: &lt;sip:juliet@example.com&gt;;gr=yn0cl4bnw0yr3vym
   | From: &lt;sip:romeo@example.net&gt;
   | Contact: &lt;sip:romeo@example.net&gt;;gr=dr4hcr0st3lup4c
   | Call-ID: F6989A8C-DE8A-4E21-8E07-F0898304796F
   | CSeq: 3 BYE
   | Content-Length: 0

   Example 22: MSRP-to-XMPP Gateway Generates Gone Chat State

   | &lt;message from='romeo@example.net'
   |          id='hs61v397'
   |          to='juliet@example.com'
   |          type='chat'&gt;
   |   &lt;thread&gt;F6989A8C-DE8A-4E21-8E07-F0898304796F&lt;/thread&gt;
   |   &lt;gone xmlns='http://jabber.org/protocol/chatstates'/&gt;
   | &lt;/message&gt;

   To enable these uses, gateways that support chat state notifications
   MUST support the "gone" state (which is merely recommended, not
   required, by [<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>]).

   It is also reasonable for gateways to implement timers that
   automatically trigger a "gone" chat state if the XMPP user has not
   sent a message within the "session" for a given amount of time
   ([<a href="#ref-XEP-0085" title='"Chat State Notifications"'>XEP-0085</a>] suggests generating a "gone" chat state if a user has not
   interacted with the chat session interface, system, or device for a
   relatively long period of time, e.g., 10 minutes).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Delivery%20Reports"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Delivery Reports</span>

   Both XMPP and MSRP enable a client to receive notifications when a
   message has been received by the intended recipient.

   For XMPP, the Message Receipts specification [<a href="#ref-XEP-0184" title='"Message Delivery Receipts"'>XEP-0184</a>] defines a
   method and XML namespace for requesting and returning indications
   that a message has been received by a client controlled by the
   intended recipient.

   For MSRP, a native reporting feature is included, in the form of
   REPORT chunks (see Sections <a href="#section-7.1.2">7.1.2</a> and <a href="#section-7.1.3">7.1.3</a> of [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>]).

   An XMPP Message Receipts element of &lt;request
   xmlns='urn:xmpp:receipts'/&gt; is to be mapped to an MSRP Success-Report
   header field with a value of "yes", and an XMPP Message Receipts




<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   element of &lt;received xmlns='urn:xmpp:receipts'/&gt; is to be mapped to
   an MSRP REPORT request.

   A Success-Report header field with a value of "yes" in an MSRP SEND
   request is to be mapped to an XMPP Message Receipts element of
   &lt;request xmlns='urn:xmpp:receipts'/&gt;, and an MSRP REPORT request is
   to be mapped to an XMPP message containing only a Message Receipts
   element of &lt;received xmlns='urn:xmpp:receipts'/&gt;.

   Because the XMPP Message Receipts specification does not support
   failure reports, there is no mapping for the MSRP Failure-Report
   header field and gateways SHOULD set that header field to "no".

   Examples follow.

   First, the XMPP user sends a message containing a request for
   delivery notification.

   Example 23: Juliet Sends XMPP Message with Receipt Request

   | &lt;message from='juliet@example.com'
   |          id='bf9m36d5'
   |          to='romeo@example.net'
   |          type='chat'&gt;
   |   &lt;thread&gt;29377446-0CBB-4296-8958-590D79094C50&lt;/thread&gt;
   |   &lt;body&gt;What man art thou ...?&lt;/body&gt;
   |   &lt;request xmlns='urn:xmpp:receipts'/&gt;
   | &lt;/message&gt;

   Example 24: Gateway Maps XMPP Message to MSRP

   | MSRP bf9m36d5 SEND
   | To-Path: msrp://s2x.example.net:7313/jshA7weztas;tcp
   | From-Path: msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
   | Message-ID: 6187CF9B-317A-41DA-BB6A-5E48A9C794EF
   | Byte-Range: 1-25/25
   | Success-Report: yes
   | Failure-Report: no
   | Content-Type: text/plain
   |
   | What man art thou ...?
   | -------bf9m36d5$

   Next, the recipient returns a report.







<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   Example 25: Romeo Returns MSRP Receipt

   | MSRP hx74g336 REPORT
   | To-Path: msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
   | From-Path: msrp://s2x.example.net:7313/jshA7weztas;tcp
   | Message-ID: 6187CF9B-317A-41DA-BB6A-5E48A9C794EF
   | Byte-Range: 1-106/106
   | Status: 000 200 OK
   | -------hx74g336$

   Example 26: MSRP-to-XMPP Gateway Maps Receipt to XMPP

   | &lt;message from='romeo@example.net'
   |          id='hx74g336'
   |          to='juliet@example.com'&gt;
   |   &lt;received xmlns='urn:xmpp:receipts' id='87652491'/&gt;
   | &lt;/message&gt;


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Message%20Size"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Message Size</span>

   Unlike page-mode messaging [<a href="rfc3428.html" title='"Session Initiation Protocol (SIP) Extension for Instant Messaging"'>RFC3428</a>] (which specifies that the size
   of a MESSAGE request is not allowed to exceed 1300 bytes), session-
   mode messaging [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>] can be used to send larger messages.  MSRP
   includes a chunking mechanism such that larger messages can be broken
   up into multiple MSRP SEND requests.  Because the MSRP gateway at an
   XMPP service acts as an MSRP endpoint, it is responsible for
   receiving chunked messages and reconstructing them into a single
   message for delivery toward the XMPP recipient.  (Naturally,
   implementations need to be careful about accepting very large
   messages; see <a href="rfc4975.html#section-14.5">Section 14.5 of [RFC4975]</a>.)

   Although there is no hard limit on the size of an XMPP stanza, in
   practice, most XMPP services (at least on the public Internet) are
   configured with a maximum stanza size in order to help prevent
   denial-of-service attacks.  As specified in <a href="rfc6120.html#section-13.12">Section 13.12 of
   [RFC6120]</a>, this maximum is not allowed to be less than 10,000 bytes.

   The administrators of an XMPP service need to ensure that the
   associated MSRP gateway is configured with the same or smaller
   maximum MSRP message size as the maximum XMPP stanza size; this
   enables the gateway to return an appropriate value for the Session
   Description Protocol (SDP) "max-size" attribute (see <a href="rfc4975.html#section-8.6">Section 8.6 of
   [RFC4975]</a>) and to properly handle incoming messages larger than the
   configured limits.






<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   If an MSRP-to-XMPP gateway implementation receives an MSRP message
   that exceeds its configured limit as just described, it MUST return
   an MSRP 413 error (e.g., in response to the first SEND request whose
   Byte-Range header field indicates a byte total exceeding the limit).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Internationalization%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Internationalization Considerations</span>

   Relevant discussion of internationalized text in messages can be
   found in [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   Detailed security considerations are given in the following
   documents:

   o  For instant messaging protocols in general, see [<a href="rfc2779.html" title='"Instant Messaging / Presence Protocol Requirements"'>RFC2779</a>]

   o  For MSRP chat, see [<a href="rfc4975.html" title='"The Message Session Relay Protocol (MSRP)"'>RFC4975</a>]; for when SIP is used to negotiate
      MSRP sessions, see [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]

   o  For XMPP-based instant messaging, see [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>] and also [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>]

   o  For SIP-XMPP interworking in general, see [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>]

   o  For end-to-end encryption of instant messages, see [<a href="rfc7572.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging"'>RFC7572</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
               DOI 10.17487/RFC2119, March 1997,
               &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
               A., Peterson, J., Sparks, R., Handley, M., and E.
               Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
               DOI 10.17487/RFC3261, June 2002,
               &lt;<a href="http://www.rfc-editor.org/info/rfc3261">http://www.rfc-editor.org/info/rfc3261</a>&gt;.

   [<a id="ref-RFC3994" name="ref-RFC3994">RFC3994</a>]   Schulzrinne, H., "Indication of Message Composition for
               Instant Messaging", <a href="rfc3994.html">RFC 3994</a>, DOI 10.17487/RFC3994,
               January 2005, &lt;<a href="http://www.rfc-editor.org/info/rfc3994">http://www.rfc-editor.org/info/rfc3994</a>&gt;.







<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   [<a id="ref-RFC4975" name="ref-RFC4975">RFC4975</a>]   Campbell, B., Ed., Mahy, R., Ed., and C. Jennings, Ed.,
               "The Message Session Relay Protocol (MSRP)", <a href="rfc4975.html">RFC 4975</a>,
               DOI 10.17487/RFC4975, September 2007,
               &lt;<a href="http://www.rfc-editor.org/info/rfc4975">http://www.rfc-editor.org/info/rfc4975</a>&gt;.

   [<a id="ref-RFC6120" name="ref-RFC6120">RFC6120</a>]   Saint-Andre, P., "Extensible Messaging and Presence
               Protocol (XMPP): Core", <a href="rfc6120.html">RFC 6120</a>, DOI 10.17487/RFC6120,
               March 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6120">http://www.rfc-editor.org/info/rfc6120</a>&gt;.

   [<a id="ref-RFC6121" name="ref-RFC6121">RFC6121</a>]   Saint-Andre, P., "Extensible Messaging and Presence
               Protocol (XMPP): Instant Messaging and Presence",
               <a href="rfc6121.html">RFC 6121</a>, DOI 10.17487/RFC6121, March 2011,
               &lt;<a href="http://www.rfc-editor.org/info/rfc6121">http://www.rfc-editor.org/info/rfc6121</a>&gt;.

   [<a id="ref-RFC7247" name="ref-RFC7247">RFC7247</a>]   Saint-Andre, P., Houri, A., and J. Hildebrand,
               "Interworking between the Session Initiation Protocol
               (SIP) and the Extensible Messaging and Presence Protocol
               (XMPP): Architecture, Addresses, and Error Handling",
               <a href="rfc7247.html">RFC 7247</a>, DOI 10.17487/RFC7247, May 2014,
               &lt;<a href="http://www.rfc-editor.org/info/rfc7247">http://www.rfc-editor.org/info/rfc7247</a>&gt;.

   [<a id="ref-RFC7572" name="ref-RFC7572">RFC7572</a>]   Saint-Andre, P., Houri, A., and J. Hildebrand,
               "Interworking between the Session Initiation Protocol
               (SIP) and the Extensible Messaging and Presence Protocol
               (XMPP): Instant Messaging", <a href="rfc7572.html">RFC 7572</a>,
               DOI 10.17487/RFC7572, June 2015,
               &lt;<a href="http://www.rfc-editor.org/info/rfc7572">http://www.rfc-editor.org/info/rfc7572</a>&gt;.

   [<a id="ref-XEP-0085" name="ref-XEP-0085">XEP-0085</a>] Saint-Andre, P. and D. Smith, "Chat State Notifications",
              XSF XEP 0085, September 2009.

   [<a id="ref-XEP-0184" name="ref-XEP-0184">XEP-0184</a>] Saint-Andre, P. and J. Hildebrand, "Message Delivery
              Receipts", XSF XEP 0184, March 2011.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-GROUPCHAT" name="ref-GROUPCHAT">GROUPCHAT</a>] Saint-Andre, P., Corretge, S., and S. Loreto,
               "Interworking between the Session Initiation Protocol
               (SIP) and the Extensible Messaging and Presence Protocol
               (XMPP): Groupchat", Work in Progress,
               <a href="https://tools.ietf.org/html/draft-ietf-stox-groupchat-11">draft-ietf-stox-groupchat-11</a>, March 2015.

   [<a id="ref-RFC2779" name="ref-RFC2779">RFC2779</a>]   Day, M., Aggarwal, S., Mohr, G., and J. Vincent, "Instant
               Messaging / Presence Protocol Requirements", <a href="rfc2779.html">RFC 2779</a>,
               DOI 10.17487/RFC2779, February 2000,
               &lt;<a href="http://www.rfc-editor.org/info/rfc2779">http://www.rfc-editor.org/info/rfc2779</a>&gt;.





<span class="grey">Saint-Andre &amp; Loreto         Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7573.html">RFC 7573</a>               SIP-XMPP Interworking: Chat             June 2015</span>


   [<a id="ref-RFC3428" name="ref-RFC3428">RFC3428</a>]   Campbell, B., Ed., Rosenberg, J., Schulzrinne, H.,
               Huitema, C., and D. Gurle, "Session Initiation Protocol
               (SIP) Extension for Instant Messaging", <a href="rfc3428.html">RFC 3428</a>,
               DOI 10.17487/RFC3428, December 2002,
               &lt;<a href="http://www.rfc-editor.org/info/rfc3428">http://www.rfc-editor.org/info/rfc3428</a>&gt;.

Acknowledgements

   Special thanks to Eddy Gavita and Nazin Hossain for coauthoring an
   early draft version of this document.

   Thanks to Mary Barnes, Ben Campbell, Dave Crocker, Adrian Georgescu,
   Philipp Hancke, Saul Ibarra Corretge, Tory Patnoe, and Matt Ryan for
   their feedback.

   Stephen Farrell, Brian Haberman, Joel Jaeggli, Barry Leiba, Kathleen
   Moriarty, and Pete Resnick provided helpful input during IESG review.

   The authors gratefully acknowledge the assistance of Markus Isomaki
   and Yana Stamcheva as the working group chairs and Gonzalo Camarillo
   and Alissa Cooper as the sponsoring Area Directors.

   Peter Saint-Andre wishes to acknowledge Cisco Systems, Inc., for
   employing him during his work on earlier draft versions of this
   document.

Authors' Addresses

   Peter Saint-Andre
   &amp;yet

   EMail: peter@andyet.com
   URI:   <a href="https://andyet.com/">https://andyet.com/</a>


   Salvatore Loreto
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   EMail: Salvatore.Loreto@ericsson.com









Saint-Andre &amp; Loreto         Standards Track                   [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7573 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --></html>