<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from tools.ietf.org/html/rfc6627 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:41:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129c" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Relation.Replaces" content="draft-chan-pcn-encoding-comparison" />
<meta name="DC.Identifier" content="urn:ietf:rfc:6627" />
<meta name="DC.Date.Issued" content="July, 2012" />
<meta name="DC.Creator" content="Briscoe, Bob" />
<meta name="DC.Creator" content="Chan, Kwok" />
<meta name="DC.Creator" content="Menth, Michael" />
<meta name="DC.Creator" content="Eardley, Philip" />
<meta name="DC.Creator" content="Karagiannis, Georgios" />
<meta name="DC.Creator" content="Moncaster, Toby" />
<meta name="DC.Description.Abstract" content="The objective of Pre-Congestion Notification (PCN) is to protect the
quality of service (QoS) of inelastic flows within a Diffserv domain.
On every link in the PCN-domain, the overall rate of PCN-traffic is
metered, and PCN-packets are appropriately marked when certain
configured rates are exceeded. Egress nodes provide decision points
with information about the PCN-marks of PCN-packets that allows them
to take decisions about whether to admit or block a new flow request,
and to terminate some already admitted flows during serious \%pre-
congestion.  The PCN working group explored a number of approaches for
encoding this pre-congestion information into the IP header. This
document provides details of those approaches along with an
explanation of the constraints that apply to any solution. This
document is not an Internet Standards Track specification; it is
published for informational purposes." />
<meta name="DC.Title" content="Overview of Pre-Congestion Notification Encoding" />

    <link rel="icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 6627 - Overview of Pre-Congestion Notification Encoding</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgorange"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6627.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6627" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-pcn-encoding-comparison" title="draft-ietf-pcn-encoding-comparison">draft-ietf-pcn-...</a>] [<a href='https://datatracker.ietf.org/doc/rfc6627' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6627" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6627" title="Side-by-side diff">Diff2</a>]         </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Internet Engineering Task Force (IETF)                    G. Karagiannis
Request for Comments: 6627                          University of Twente
Category: Informational                                          K. Chan
ISSN: 2070-1721                                               Consultant
                                                            T. Moncaster
                                                 University of Cambridge
                                                                M. Menth
                                                 University of Tuebingen
                                                              P. Eardley
                                                              B. Briscoe
                                                                      BT
                                                               July 2012


            <span class="h1">Overview of Pre-Congestion Notification Encoding</span>

Abstract

   The objective of Pre-Congestion Notification (PCN) is to protect the
   quality of service (QoS) of inelastic flows within a Diffserv domain.
   On every link in the PCN-domain, the overall rate of PCN-traffic is
   metered, and PCN-packets are appropriately marked when certain
   configured rates are exceeded.  Egress nodes provide decision points
   with information about the PCN-marks of PCN-packets that allows them
   to take decisions about whether to admit or block a new flow request,
   and to terminate some already admitted flows during serious
   pre-congestion.

   The PCN working group explored a number of approaches for encoding
   this pre-congestion information into the IP header.  This document
   provides details of those approaches along with an explanation of the
   constraints that apply to any solution.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6627">http://www.rfc-editor.org/info/rfc6627</a>.



<span class="grey">Karagiannis, et al.           Informational                     [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Karagiannis, et al.           Informational                     [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. General PCN Encoding Requirements ...............................<a href="#page-5">5</a>
      <a href="#section-2.1">2.1</a>. Metering and Marking Algorithms ............................<a href="#page-5">5</a>
      2.2. Approaches for PCN-Based Admission Control and Flow
           Termination ................................................<a href="#page-5">5</a>
           <a href="#section-2.2.1">2.2.1</a>. Dual Marking (DM) ...................................<a href="#page-5">5</a>
           <a href="#section-2.2.2">2.2.2</a>. Single Marking (SM) .................................<a href="#page-6">6</a>
           <a href="#section-2.2.3">2.2.3</a>. Packet-Specific Dual Marking (PSDM) .................<a href="#page-7">7</a>
           <a href="#section-2.2.4">2.2.4</a>. Preferential Packet Dropping ........................<a href="#page-8">8</a>
   <a href="#section-3">3</a>. Encoding Constraints ............................................<a href="#page-9">9</a>
      <a href="#section-3.1">3.1</a>. Structure of the DS Field ..................................<a href="#page-9">9</a>
      <a href="#section-3.2">3.2</a>. Constraints from the DS Field ..............................<a href="#page-9">9</a>
           <a href="#section-3.2.1">3.2.1</a>. General Scarcity of DSCPs ...........................<a href="#page-9">9</a>
           <a href="#section-3.2.2">3.2.2</a>. Handling of the DSCP in Tunneling Rules ............<a href="#page-10">10</a>
           <a href="#section-3.2.3">3.2.3</a>. Restoration of Original DSCPs at the Egress Node ...<a href="#page-10">10</a>
      <a href="#section-3.3">3.3</a>. Constraints from the ECN Field ............................<a href="#page-11">11</a>
           <a href="#section-3.3.1">3.3.1</a>. Structure and Use of the ECN Field .................<a href="#page-11">11</a>
           <a href="#section-3.3.2">3.3.2</a>. Redefinition of the ECN Field ......................<a href="#page-12">12</a>
           <a href="#section-3.3.3">3.3.3</a>. Handling of the ECN Field in Tunneling Rules .......<a href="#page-12">12</a>
                  <a href="#section-3.3.3.1">3.3.3.1</a>. Limited-Functionality Option ..............<a href="#page-12">12</a>
                  <a href="#section-3.3.3.2">3.3.3.2</a>. Full-Functionality Option .................<a href="#page-13">13</a>
                  <a href="#section-3.3.3.3">3.3.3.3</a>. Tunneling with IPSec ......................<a href="#page-13">13</a>
                  <a href="#section-3.3.3.4">3.3.3.4</a>. ECN Tunneling .............................<a href="#page-13">13</a>
           3.3.4. Restoration of the Original ECN Field at
                  the PCN-Egress-Node ................................<a href="#page-14">14</a>
   <a href="#section-4">4</a>. Comparison of Encoding Options .................................<a href="#page-15">15</a>
      <a href="#section-4.1">4.1</a>. Baseline Encoding .........................................<a href="#page-15">15</a>
      <a href="#section-4.2">4.2</a>. Encoding with 1 DSCP Providing 3 States ...................<a href="#page-16">16</a>
      <a href="#section-4.3">4.3</a>. Encoding with 2 DSCPs Providing 3 or More States ..........<a href="#page-16">16</a>
      <a href="#section-4.4">4.4</a>. Encoding for Packet-Specific Dual Marking (PSDM) ..........<a href="#page-16">16</a>
      <a href="#section-4.5">4.5</a>. Standardized Encodings ....................................<a href="#page-17">17</a>
   <a href="#section-5">5</a>. Conclusion .....................................................<a href="#page-17">17</a>
   <a href="#section-6">6</a>. Security Implications ..........................................<a href="#page-17">17</a>
   <a href="#section-7">7</a>. Acknowledgements ...............................................<a href="#page-17">17</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-18">18</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-18">18</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-18">18</a>












<span class="grey">Karagiannis, et al.           Informational                     [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   The objective of Pre-Congestion Notification (PCN) [<a href="rfc5559.html" title="&quot;Pre-Congestion Notification (PCN) Architecture&quot;">RFC5559</a>] is to
   protect the quality of service (QoS) of inelastic flows within a
   Diffserv domain in a simple, scalable, and robust fashion.  Two
   mechanisms are used: admission control (AC), to decide whether to
   admit or block a new flow request, and flow termination (FT), to
   terminate some existing flows during serious pre-congestion.  To
   achieve this, the overall rate of PCN-traffic is metered on every
   link in the domain, and PCN-packets are appropriately marked when
   certain configured rates are exceeded.  These configured rates are
   below the rate of the link.  Thus, boundary nodes are notified of a
   potential overload before any real congestion occurs (hence "pre-
   congestion notification").

   [<a name="ref-RFC5670" id="ref-RFC5670">RFC5670</a>] provides for two metering and marking functions that are
   configured with reference rates.  Threshold-marking marks all PCN-
   packets once their traffic rate on a link exceeds the configured
   reference rate (PCN-threshold-rate).  Excess-traffic-marking marks
   only those PCN-packets that exceed the configured reference rate
   (PCN-excess-rate).

   Egress nodes monitor the PCN-marks of received PCN-packets and
   provide information about the PCN-marks to the decision points that
   take decisions about the flow admission and termination on this basis
   [<a href="rfc6661.html" title="&quot;Pre-Congestion Notification (PCN) Boundary-Node Behavior for the Controlled Load (CL) Mode of Operation&quot;">RFC6661</a>] [<a href="rfc6662.html" title="&quot;Pre-Congestion Notification (PCN) Boundary- Node Behavior for the Single Marking (SM) Mode of Operation&quot;">RFC6662</a>].

   This PCN information has to be encoded into the IP header.  This
   requires at least three different codepoints: one for PCN-traffic
   that has not been marked, one for traffic that has been marked by the
   threshold meter, and one for traffic that has been marked by the
   excess-traffic-meter.

   Since unused codepoints are not available for that purpose in the IP
   header (versions 4 and 6), already used codepoints must be reused,
   which imposes additional constraints on the design and applicability
   of PCN-based AC and FT.  This document summarizes these issues as a
   record of the PCN working group discussions and for the benefit of
   the wider IETF community.

   In <a href="#section-2">Section 2</a>, we briefly point out the PCN encoding requirement
   imposed by metering and marking algorithms, and by special packet
   drop strategies.  The Differentiated Services field (6 bits -- see
   [<a href="rfc3260.html" title="&quot;New Terminology and Clarifications for Diffserv&quot;">RFC3260</a>] updating [<a href="rfc2474.html" title="&quot;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers&quot;">RFC2474</a>] in this respect) and the Explicit
   Congestion Notification (ECN) field (2 bits) [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>] have been
   selected to be reused for encoding of PCN-marks (PCN encoding).  In
   <a href="#section-3">Section 3</a>, we briefly explain the constraints imposed by this
   decision.  In <a href="#section-4">Section 4</a>, we review different PCN encodings considered



<span class="grey">Karagiannis, et al.           Informational                     [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


   by the PCN working group that allow different implementations of PCN-
   based AC and FT, which have different pros and cons.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  General PCN Encoding Requirements</span>

   The choice of metering and marking algorithms and the way they are
   applied to PCN-based AC and FT impose certain requirements on PCN
   encoding.

<span class="h3"><a class="selflink" name="section-2.1" href="#section-2.1">2.1</a>.  Metering and Marking Algorithms</span>

   Two different metering and marking algorithms are defined in
   [<a href="rfc5670.html" title="&quot;Metering and Marking Behaviour of PCN-Nodes&quot;">RFC5670</a>]: excess-traffic-marking and threshold-marking.  They are
   both configured with reference rates that are termed PCN-excess-rate
   and PCN-threshold-rate, respectively.  When traffic for PCN-flows
   enters a PCN-domain, the PCN-ingress-node sets a codepoint in the IP
   header indicating that the packet is subject to PCN-metering and PCN-
   marking and that it is not-marked (NM).  The two metering and marking
   algorithms possibly re-mark PCN-packets as excess-traffic-marked
   (ETM) or threshold-marked (ThM).

   Excess-traffic-marking ETM-marks all not-ETM-marked PCN-traffic that
   is in excess of the PCN-excess-rate.  To that end, the algorithm
   needs to know whether a PCN-packet has already been marked with ETM
   or not.  Threshold-marking re-marks all not-marked PCN-traffic to ThM
   when the rate of PCN-traffic exceeds the PCN-threshold-rate.
   Therefore, it does not need knowledge of the prior marking state of
   the packet for metering, but such knowledge is needed for packet
   re-marking.

<span class="h3"><a class="selflink" name="section-2.2" href="#section-2.2">2.2</a>.  Approaches for PCN-Based Admission Control and Flow Termination</span>

   We briefly review three different approaches to implement PCN-based
   AC and FT and derive their requirements for PCN encoding.

<span class="h4"><a class="selflink" name="section-2.2.1" href="#section-2.2.1">2.2.1</a>.  Dual Marking (DM)</span>

   The intuitive approach for PCN-based AC and FT requires that
   threshold and excess-traffic-marking are simultaneously activated on
   all links of a PCN-domain, and their reference rates are configured
   with the PCN-admissible-rate (AR) and the PCN-supportable-rate (SR),
   respectively.  Threshold-marking meters all PCN-traffic, but re-marks
   only NM-traffic to ThM.  Excess-traffic-marking meters only NM- and
   ThM-traffic and re-marks it to ETM.  Thus, both meters and markers
   need to identify PCN-packets and their exact PCN codepoint.  We call
   this marking behavior dual marking (DM) and Figure 1 illustrates all
   possible re-marking actions.




<span class="grey">Karagiannis, et al.           Informational                     [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


           NM -----------&gt; ThM
             \             /
              \           /
               \         /
                 &gt; ETM &lt;

     Figure 1: PCN Codepoint Re-Marking Diagram for Dual Marking (DM)

   Dual marking is used to support the Controlled-Load PCN (CL-PCN) edge
   behavior [<a href="rfc6661.html" title="&quot;Pre-Congestion Notification (PCN) Boundary-Node Behavior for the Controlled Load (CL) Mode of Operation&quot;">RFC6661</a>].  We briefly summarize the concept.  All actions
   are performed on per-ingress-egress-aggregate basis.  The egress node
   measures the rate of NM-, ThM-, and ETM-traffic in regular intervals
   and sends them as PCN egress reports to the AC and FT decision point.

   If the proportion of re-marked (ThM- and ETM-) PCN-traffic is larger
   than a defined threshold, called CLE-limit, the decision point blocks
   new flow requests until new PCN egress reports are received;
   otherwise, it admits them.  With CL-PCN, AC is rather robust with
   regard to the value chosen for the CLE-limit.  FT works as follows.
   If the ETM-traffic rate is positive, the decision point triggers the
   ingress node to send a newly measured rate of the sent PCN-traffic.
   The decision point calculates the rate of PCN-traffic that needs to
   be terminated by

      termination-rate = PCN-sent-rate -
                            (rate-of-NM-traffic + rate-of-ThM-traffic)

   and terminates an appropriate set of flows.  CL-PCN is accurate
   enough for most application scenarios and its implementation
   complexity is acceptable, therefore, it is a preferred implementation
   option for PCN-based AC and FT.

<span class="h4"><a class="selflink" name="section-2.2.2" href="#section-2.2.2">2.2.2</a>.  Single Marking (SM)</span>

   Single marking uses only excess-traffic-marking whose reference rate
   is set to the PCN-admissible-rate (AR) on all links of the PCN-
   domain.  Figure 2 illustrates all possible re-marking actions.

               NM --------&gt; ETM

     Figure 2: PCN Codepoint Re-Marking Diagram for Single Marking (SM)

   Single marking is used to support the Single-Marking PCN (SM-PCN)
   edge behavior [<a href="rfc6662.html" title="&quot;Pre-Congestion Notification (PCN) Boundary- Node Behavior for the Single Marking (SM) Mode of Operation&quot;">RFC6662</a>].  We briefly summarize the concept.







<span class="grey">Karagiannis, et al.           Informational                     [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


   AC works essentially in the same way as with CL-PCN, but AC is
   sensitive to the value of the CLE-limit.  Also FT works similarly to
   CL-PCN.  The PCN-supportable-rate (SR) is not configured on any link,
   but is implicitly

      SR=u*AR

   in the PCN-domain using a network-wide constant u.  The decision
   point triggers FT only if the rate-of-NM-traffic * u &lt; rate-of-NM-
   traffic + rate-of-ETM-traffic.  Then it requests the PCN-sent-rate
   from the corresponding PCN-ingress-node and calculates the amount of
   PCN-traffic to be terminated by

      termination-rate = PCN-sent-rate - rate-of-NM-traffic * u,

   and terminates an appropriate set of flows.

   SM-PCN requires only two PCN codepoints and only excess-traffic-
   marking is needed, which means that it might be earlier to the market
   than CL-PCN since some chipsets do not yet support threshold-marking.

   However, it only works well when ingress-egress-aggregates have a
   high PCN-packet rate, which is not always the case.  Otherwise, over-
   admission and over-termination may occur [<a href="#ref-Menth12" title="&quot;Performance of PCN-Based Admission Control under Challenging Conditions&quot;">Menth12</a>] [<a href="#ref-Menth10" title="&quot;PCN-Based Measured Rate Termination&quot;">Menth10</a>].

<span class="h4"><a class="selflink" name="section-2.2.3" href="#section-2.2.3">2.2.3</a>.  Packet-Specific Dual Marking (PSDM)</span>

   Packet-specific dual marking (PSDM) uses threshold-marking and
   excess-traffic-marking, whose reference rates are configured with the
   PCN-admissible-rate (AR) and the PCN-supportable-rate (SR),
   respectively.  There are two different types of not-marked packets:
   those that are subject to threshold-marking (not-ThM), and those that
   are subject to excess-traffic-marking (not-ETM).  Both not-ThM and
   not-ETM are used for PCN-traffic that is not yet re-marked (like NM
   with single and dual marking), and their specific use is determined
   by higher-layer information (see below).  Threshold-marking meters
   all PCN-traffic and re-marks only not-ThM packets to PCN-marked (PM).
   In contrast, excess-traffic-marking meters only not-ETM packets and
   possibly re-marks them to PM, too.  Again, both meters and markers
   need to identify PCN-packets and their exact PCN codepoint.  Figure 3
   illustrates all possible re-marking actions.










<span class="grey">Karagiannis, et al.           Informational                     [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


           not-ThM        not-ETM
               \            /
                \          /
                 \        /
                   &gt; PM &lt;

     Figure 3: PCN Codepoint Re-Marking Diagram for
               Packet-Specific Dual Marking (PSDM)

     An edge behavior for PSDM has been presented in [<a href="#ref-Menth09" title="&quot;Pre-Congestion Notification Using Packet-Specific Dual Marking&quot;">Menth09</a>] and [PCN-
     MS-AC].  We call it PSDM-PCN.  In contrast to CL-PCN and SM-PCN, AC
     is realized by reusing initial signaling messages for probing
     purposes.  The assumption is that admission requests are triggered
     by an external end-to-end signaling protocol, e.g., RSVP [<a href="rfc2205.html" title="&quot;Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification&quot;">RFC2205</a>].
     Signaling traffic for a flow is also labeled as PCN-traffic, and if
     an initial signaling message traverses the PCN-domain and is
     re-marked, then the corresponding admission request is blocked.
     This is a lightweight probing mechanism that does not generate
     extra traffic and does not introduce probing delay.  In PSDM-PCN,
     PCN-ingress-nodes label initial signaling messages as not-ThM, and
     threshold-marking configured with admissible rates possibly
     re-marks them to PM.  Data packets are labeled with not-ETM, and
     excess-traffic-marking configured with supportable rates possibly
     re-marks them to PM, too, so that the same algorithms for FT may be
     used as for CL-PCN and SM-PCN.

     PSDM has three major disadvantages.  First, signalling traffic
     needs to be marked with a PCN-enabled DSCP so that it either shares
     the same queue as data traffic, which may not be desired by some
     operators, or multiple PCN-enabled DSCPs are needed, which is not a
     pragmatic solution.  Second, reservations for PCN-flows need to be
     triggered by a path-coupled end-to-end signalling protocol, which
     restricts the choice of the signalling protocol.  And third, the
     selected signalling protocols must be adapted to take advantage of
     PCN-marked signalling messages for admission decisions, which
     incurs some extra effort before PSDM can be used.

     The advantages are that the AC algorithm is more accurate than the
     one of CL-PCN and SM-PCN [<a href="#ref-Menth12" title="&quot;Performance of PCN-Based Admission Control under Challenging Conditions&quot;">Menth12</a>], that often only a single DSCP
     is needed, and that the new tunneling rules in [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>] are not
     needed for deployment (<a href="#section-3.3.3">Section 3.3.3</a>).

<span class="h4"><a class="selflink" name="section-2.2.4" href="#section-2.2.4">2.2.4</a>.  Preferential Packet Dropping</span>

     The termination algorithms described in [<a href="rfc6661.html" title="&quot;Pre-Congestion Notification (PCN) Boundary-Node Behavior for the Controlled Load (CL) Mode of Operation&quot;">RFC6661</a>] and [<a href="rfc6662.html" title="&quot;Pre-Congestion Notification (PCN) Boundary- Node Behavior for the Single Marking (SM) Mode of Operation&quot;">RFC6662</a>]
     require the preferential dropping of ETM-marked packets to avoid
     over-termination in the case of packet loss.  An analysis
     explaining this phenomenon can be found in Section 4 of [<a href="#ref-Menth10" title="&quot;PCN-Based Measured Rate Termination&quot;">Menth10</a>].



<span class="grey">Karagiannis, et al.           Informational                     [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


     Thus, [<a href="rfc5670.html" title="&quot;Metering and Marking Behaviour of PCN-Nodes&quot;">RFC5670</a>] recommends that ETM-marked packets "SHOULD be
     preferentially dropped".  As a consequence, droppers must have
     access to the exact marking information of PCN-packets.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Encoding Constraints</span>

     The PCN working group decided to use a combination of the 6-bit
     Differentiated Services (DS) field and the ECN field for the
     encoding of the PCN-marks (see [<a href="rfc6660.html" title="&quot;Encoding Three Pre-Congestion Notification (PCN) States in the IP Header Using a Single Diffserv Codepoint (DSCP)&quot;">RFC6660</a>]).  This section describes
     the criteria that are used to compare the resulting encoding
     options described in <a href="#section-4">Section 4</a>.

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Structure of the DS Field</span>

     Figure 4 shows the structure of the DS and ECN fields.  [<a href="https://tools.ietf.org/html/rfc0793" title="&quot;Transmission Control Protocol&quot;">RFC0793</a>]
     defined the 8-bit TOS octet and [<a href="rfc2474.html" title="&quot;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers&quot;">RFC2474</a>] redefined it as the DS
     field, including the two least significant bits as currently unused
     (CU).  [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>] assigned the two CU bits to ECN and [<a href="rfc3260.html" title="&quot;New Terminology and Clarifications for Diffserv&quot;">RFC3260</a>]
     redefined the DS field as only the most significant 6-bits of the
     (former) IPv4 TOS octet, thus separating the two-bit ECN field from
     the DS field.

         0   1   2   3   4   5   6   7
       +---+---+---+---+---+---+---+---+
       |          DS           |  ECN  |
       +---+---+---+---+---+---+---+---+

       DS: Differentiated Services field [<a href="rfc2474.html" title="&quot;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers&quot;">RFC2474</a>], [<a href="rfc3260.html" title="&quot;New Terminology and Clarifications for Diffserv&quot;">RFC3260</a>]
       ECN: ECN field [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>]

       Figure 4: The Structure of the DS and ECN Fields

<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>.  Constraints from the DS Field</span>

   The Differentiated Services Codepoint (DSCP) set in the DS field
   indicates the per-hop behavior (PHB), i.e., the treatment IP packets
   receive from nodes in a DS domain.  Multiple DSCPs may indicate the
   same PHB.  PCN-traffic is high-priority traffic, which uses a DSCP
   (or DSCPs) that indicates a PHB with preferred treatment.

<span class="h4"><a class="selflink" name="section-3.2.1" href="#section-3.2.1">3.2.1</a>.  General Scarcity of DSCPs</span>

   As the number of unused DSCPs is small, PCN encoding should use only
   one additional DSCP for each DSCP originally used to indicate the PHB
   and in any case should not use more than two.  Therefore, the DSCP
   should be used to indicate that traffic is subject to PCN-metering
   and PCN-marking, but not to differentiate various PCN-markings.




<span class="grey">Karagiannis, et al.           Informational                     [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h4"><a class="selflink" name="section-3.2.2" href="#section-3.2.2">3.2.2</a>.  Handling of the DSCP in Tunneling Rules</span>

   PCN encoding must be chosen in such a way that PCN-traffic can be
   tunneled within a PCN-domain without any impact on PCN-metering and
   re-marking.  In the following, the "inner header" refers to the
   header of the encapsulated packet and the "outer header" refers to
   the encapsulating header.

   [<a name="ref-RFC2983" id="ref-RFC2983">RFC2983</a>] provides two tunneling modes for Differentiated Services
   networks.  The uniform model copies the DSCP from the inner header to
   the outer header upon encapsulation, and it copies the DSCP from the
   outer header to the inner header upon decapsulation.  This assures
   that changes applied to the DSCP field survive encapsulation and
   decapsulation.  In contrast, the pipe model ignores the content of
   the DSCP field in the outer header upon decapsulation.  Therefore,
   decapsulation erases changes applied to the DSCP along the tunnel.
   As a consequence, only the uniform model may be used for tunneling
   PCN-traffic within a PCN-domain, if PCN encoding uses more than a
   single DSCP.

<span class="h4"><a class="selflink" name="section-3.2.3" href="#section-3.2.3">3.2.3</a>.  Restoration of Original DSCPs at the Egress Node</span>

   If PCN-marking does not alter the original DSCP, the traffic leaves
   the PCN-domain with its original DSCP.  However, if the PCN-marking
   alters the DSCP, then some additional technique is needed to restore
   the original DSCP.  A few possibilities are discussed:

   1.  Each Diffserv class using PCN uses a different set of DSCPs.
       Therefore, if there are M DSCPs using PCN and PCN encoding uses N
       different DSCPs, N*M DSCPs are needed.  This solution may work
       well in IP networks.  However, when PCN is applied to MPLS
       networks or other layers restricted to 8 QoS classes and
       codepoints, this solution fails due to the extreme shortage of
       available DSCPs.

   2.  The original DSCP for the packets of a flow is signaled to the
       egress node. No suitable signaling protocol has been developed
       and, therefore, it is not clear whether this approach could work.

   3.  PCN-traffic is tunneled across the PCN-domain.  The pipe-
       tunneling model is applied, so the original DSCP is restored
       after decapsulation.  However, tunneling across a PCN-domain adds
       an additional IP header and reduces the maximum transfer unit
       (MTU) from the perspective of the user.  GRE, MPLS, or Ethernet
       using pseudowires are potential solutions that scale well in
       backbone networks.





<span class="grey">Karagiannis, et al.           Informational                    [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


   The most appropriate option depends on the specific circumstances an
   operator faces.

   o  Option 1 is most suitable unless there is a shortage of available
      DSCPs.

   o  Option 3 is suitable where the reduction of MTU is not liable to
      cause issues.

<span class="h3"><a class="selflink" name="section-3.3" href="#section-3.3">3.3</a>.  Constraints from the ECN Field</span>

   This section briefly reviews the structure and use of the ECN field.
   The ECN field may be redefined, but certain constraints apply
   [<a href="rfc4774.html" title="&quot;Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field&quot;">RFC4774</a>].  The impact on PCN deployment is discussed, as well as the
   constraints imposed by various tunneling rules on the persistence of
   PCN-marks after decapsulation and its impact on possible re-marking
   actions.

<span class="h4"><a class="selflink" name="section-3.3.1" href="#section-3.3.1">3.3.1</a>.  Structure and Use of the ECN Field</span>

   Some transport protocols, like TCP, can typically use packet drops as
   an indication of congestion in the Internet.  The idea of Explicit
   Congestion Notification (ECN) [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>] is that routers provide a
   congestion indication for incipient congestion, where the
   notification can sometimes be through ECN-marking (and re-marking)
   packets rather than dropping them.  Figure 5 summarizes the ECN
   codepoints defined [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>].

             +-----+-----+
             | ECN FIELD |
             +-----+-----+
             0     0         Not-ECT
             0     1         ECT(1)
             1     0         ECT(0)
             1     1         CE

             Figure 5: ECN Codepoints within the ECN Field

   ECT stands for "ECN-capable transport" and indicates that the senders
   and receivers of a flow understand ECN semantics.  Packets of other
   flows are labeled with Not-ECT.  To indicate congestion to a
   receiver, routers may re-mark ECT(1) or ECT(0) labeled packets to CE,
   which stands for "congestion experienced".  Two different ECT
   codepoints were introduced "to protect against accidental or
   malicious concealment of marked packets from the TCP sender", which
   may be the case with cheating receivers [<a href="rfc3540.html" title="&quot;Robust Explicit Congestion Notification (ECN) Signaling with Nonces&quot;">RFC3540</a>].





<span class="grey">Karagiannis, et al.           Informational                    [Page 11]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h4"><a class="selflink" name="section-3.3.2" href="#section-3.3.2">3.3.2</a>.  Redefinition of the ECN Field</span>

   The ECN field may be redefined for other purposes and [<a href="rfc4774.html" title="&quot;Specifying Alternate Semantics for the Explicit Congestion Notification (ECN) Field&quot;">RFC4774</a>] gives
   guidelines for that.  Essentially, Not-ECT-marked packets must never
   be re-marked to ECT or CE because Not-ECT-capable end systems do not
   reduce their transmission rate when receiving CE-marked packets.
   This is a threat to the stability of the Internet.

   Moreover, CE-marked packets must not be re-marked to Not-ECT or ECT,
   because then ECN-capable end systems cannot reduce their transmission
   rate.  The reuse of the ECN field for PCN encoding has some impact on
   the deployment of PCN.  First, routers within a PCN-domain must not
   apply ECN re-marking when the ECN field has PCN semantics.  Second,
   before a PCN-packet leaves the PCN-domain, the egress nodes must
   either: (A) reset the ECN field of the packet to the content it had
   when entering the PCN-domain or (B) reset its ECN field to Not-ECT.
   According to <a href="#section-3.3.3">Section 3.3.3</a>, tunneling ECN traffic through a PCN-
   domain may help to implement (A).  When (B) applies, CE-marked
   packets must never become PCN-packets within a PCN-domain, as the
   egress node resets their ECN field to Not-ECT.  The ingress node may
   drop such traffic instead.

<span class="h4"><a class="selflink" name="section-3.3.3" href="#section-3.3.3">3.3.3</a>.  Handling of the ECN Field in Tunneling Rules</span>

   When packets are encapsulated, the ECN field of the inner header may
   or may not be copied to the ECN field of the outer header; upon
   decapsulation, the ECN field of the outer header may or may not be
   copied from the ECN field of the outer header to the ECN field of the
   inner header.  Various tunneling rules with different treatment of
   the ECN field exist.  Two different modes are defined in [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>]
   for IP-in-IP tunnels and a third one in [<a href="rfc4301.html" title="&quot;Security Architecture for the Internet Protocol&quot;">RFC4301</a>] for IP-in-IPsec
   tunnels.  [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>] updates both of these RFCs to rationalize them
   into one consistent approach.

<span class="h5"><a class="selflink" name="section-3.3.3.1" href="#section-3.3.3.1">3.3.3.1</a>.  Limited-Functionality Option</span>

   The limited-functionality option has been defined in [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>].  Upon
   encapsulation, the ECN field of the outer header is generally set to
   Not-ECT.  Upon decapsulation, the ECN field of the inner header
   remains unchanged.

   Since this tunneling mode loses information upon encapsulation and
   decapsulation, it cannot be used for tunneling PCN-traffic within a
   PCN-domain.  However, the PCN ingress may use this mode to tunnel
   traffic with ECN semantics to the PCN egress to preserve the ECN
   field in the inner header while the ECN field of the outer header is
   used with PCN semantics within the PCN-domain.




<span class="grey">Karagiannis, et al.           Informational                    [Page 12]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h5"><a class="selflink" name="section-3.3.3.2" href="#section-3.3.3.2">3.3.3.2</a>.  Full-Functionality Option</span>

   The full-functionality option has been defined in [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>].  Upon
   encapsulation, the ECN field of the inner header is copied to the
   outer header unless the ECN field of the inner header carries CE.  In
   that case, the ECN field of the outer header is set to ECT(0).  This
   choice has been made for security reasons, to disable the ECN fields
   of the outer header as a covert channel.  Upon decapsulation, the ECN
   field of the inner header remains unchanged unless the ECN field of
   the outer header carries CE.  In that case, the ECN field of the
   inner header is also set to CE.

   This mode imposes the following constraints on PCN-metering and PCN-
   marking.  First, PCN must re-mark the ECN field only to CE, because
   any other information is not copied to the inner header upon
   decapsulation and will be lost.  Second, CE information in
   encapsulated packet headers is invisible for routers along a tunnel.
   Threshold-marking does not require information about whether PCN-
   packets have already been marked and would work when CE denotes that
   packets are marked.  In contrast, excess-traffic-marking requires
   information about already excess-traffic-marked packets and cannot be
   supported with this tunneling mode.  Furthermore, this tunneling mode
   cannot be used when marked or not-marked packets should be
   preferentially dropped, because the PCN-marking information is
   possibly not visible in the outer header of a packet.

<span class="h5"><a class="selflink" name="section-3.3.3.3" href="#section-3.3.3.3">3.3.3.3</a>.  Tunneling with IPSec</span>

   Tunneling has been defined in <a href="rfc4301.html#section-5.1.2.1">Section&nbsp;5.1.2.1 of [RFC4301]</a>.  Upon
   encapsulation, the ECN field of the inner header is copied to the ECN
   field of the outer header.  Decapsulation works as for the full-
   functionality option described in <a href="#section-3.3.3.2">Section 3.3.3.2</a>.  Tunneling with
   IPsec also requires that PCN re-mark the ECN field only to CE because
   any other information is not copied to the inner header upon
   decapsulation and is lost.  In contrast to <a href="#section-3.3.3.2">Section 3.3.3.2</a>, with
   IPsec tunnels, CE marks of tunneled PCN-traffic remain visible for
   routers along the tunnel and to their meters, markers, and droppers.

<span class="h5"><a class="selflink" name="section-3.3.3.4" href="#section-3.3.3.4">3.3.3.4</a>.  ECN Tunneling</span>

   New tunneling rules for ECN are specified in [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>], which updates
   [<a href="rfc3168.html" title="&quot;The Addition of Explicit Congestion Notification (ECN) to IP&quot;">RFC3168</a>] and [<a href="rfc4301.html" title="&quot;Security Architecture for the Internet Protocol&quot;">RFC4301</a>].  These rules provide a consistent and
   rational approach to encapsulation and decapsulation.

   With the normal mode, the ECN field of the inner header is copied to
   the ECN field of the outer header on encapsulation.  In compatibility
   mode, the ECN field of the outer header is reset to Not-ECT.




<span class="grey">Karagiannis, et al.           Informational                    [Page 13]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


   Upon decapsulation, the scheme specified in [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>] and shown in
   Figure 6 is applied.  Thus, re-marking encapsulated Not-ECT packets
   to any other codepoint would not survive decapsulation.  Therefore,
   Not-ECT cannot be used for PCN encoding.  Furthermore, re-marking
   encapsulated ECT(0) packets to ECT(1) or CE survives decapsulation,
   but not vice-versa, and re-marking encapsulated ECT(1) packets to CE
   also survives decapsulation, but not vice-versa.  Certain
   combinations of inner and outer ECN fields cannot result from any
   transition in any current or previous ECN tunneling specification.
   These currently unused (CU) combinations are indicated in Figure 6 by
   '(!!!)' or '(!)'; where '(!!!)' means the combination is CU and
   always potentially dangerous, while '(!)' means it is CU and possibly
   dangerous.

   +---------+------------------------------------------------+
   |Arriving |            Arriving Outer Header               |
   |   Inner +---------+------------+------------+------------+
   |  Header | Not-ECT | ECT(0)     | ECT(1)     |     CE     |
   +---------+---------+------------+------------+------------+
   | Not-ECT | Not-ECT |Not-ECT(!!!)|Not-ECT(!!!)| &lt;drop&gt;(!!!)|
   |  ECT(0) |  ECT(0) | ECT(0)     | ECT(1)     |     CE     |
   |  ECT(1) |  ECT(1) | ECT(1) (!) | ECT(1)     |     CE     |
   |    CE   |      CE |     CE     |     CE(!!!)|     CE     |
   +---------+---------+------------+------------+------------+

   The ECN field in the outgoing header is set to the codepoint at the
   intersection of the appropriate arriving inner header (row) and
   arriving outer header (column), or the packet is dropped where
   indicated.  Currently unused combinations are indicated by '(!!!)'
   or '(!)'.  ([<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>]; '(!!!)' means the combination is CU and always
   potentially dangerous, while '(!)' means it is CU and possibly
   dangerous.)

      Figure 6: New IP in IP Decapsulation Behavior (from [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>])

<span class="h4"><a class="selflink" name="section-3.3.4" href="#section-3.3.4">3.3.4</a>.  Restoration of the Original ECN Field at the PCN-Egress-Node</span>

   As ECN is an end-to-end service, it is desirable that the egress node
   of a PCN-domain restore the ECN field that a PCN-packet had at the
   ingress node.  There are basically two options.  PCN-traffic may be
   tunneled between ingress and egress node using limited functionality
   tunnels (see <a href="#section-3.3.3.1">Section 3.3.3.1</a>).  Then, PCN-marking is applied only to
   the outer header, and the original ECN field is restored after
   decapsulation.  However, this reduces the MTU from the perspective of
   the user.  Another option is to use some intelligent encoding that
   preserves the ECN codepoints.  However, a viable solution is not
   known.




<span class="grey">Karagiannis, et al.           Informational                    [Page 14]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Comparison of Encoding Options</span>

   The PCN working group has studied four different PCN encodings, which
   redefine the ECN field.  Figure 7 summarizes these PCN encodings.
   One, or at most two, different DSCPs are used to indicate PCN-
   traffic, and, only for these DSCPs, the semantics of the ECN field
   are redefined within the PCN-domain.

   When a PCN-ingress-node classifies a packet as a PCN-packet, it sets
   its PCN-codepoint to not-marked (NM).  Non-PCN-traffic can also use
   the PCN-specific DSCP by setting the Not-PCN codepoint.  Special per-
   hop behavior, defined in [<a href="rfc5670.html" title="&quot;Metering and Marking Behaviour of PCN-Nodes&quot;">RFC5670</a>], applies to PCN-traffic.

 -----------------------------------------------------------------------
| ECN Bits     ||    00    |    10    |    01    |    11    ||   DSCP  |
|==============++==========+==========+==========+==========++=========|
| <a href="rfc3168.html">RFC 3168</a>     || Not-ECT  |  ECT(0)  |  ECT(1)  |    CE    ||   Any   |
|==============++==========+==========+==========+==========++=========|
| Baseline     || Not-PCN  |    NM    |   EXP    |    PM    ||   PCN-n |
|==============++==========+==========+==========+==========++=========|
| 3-In-1       || Not-PCN  |    NM    |   ThM    |   ETM    ||   PCN-n |
|==============++==========+==========+==========+==========++=========|
| 3-In-2       || Not-PCN  |    NM    |    CU    |   ThM    ||   PCN-n |
|              ||----------+----------+----------+----------++---------|
|              || Not-PCN  |    CU    |    CU    |   ETM    ||   PCN-m |
|==============++==========+==========+==========+==========++=========|
| PSDM         || Not-PCN  |  Not-ETM |  Not-ThM |    PM    ||   PCN-n |
 -----------------------------------------------------------------------

   Notes: PCN-n, PCN-m under the DSCP column denotes PCN-compatible
   DSCPs, which may be chosen by the network operator.  Not-PCN means
   that packets are not PCN-enabled.  NM means not-marked.  CU means
   currently unused.

      Figure 7: Semantics of the ECN Field for Various Encoding Types

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  Baseline Encoding</span>

   With baseline encoding [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>], the NM codepoint can be re-marked
   only to PCN-marked (PM).  Excess-traffic-marking uses PM as ETM,
   threshold-marking uses PM as ThM, and only one of the two marking
   schemes can be used.  So, baseline encoding supports SM-PCN.

   The 01-codepoint is reserved for experimental purposes (EXP) and the
   other defined PCN encoding schemes can be seen as extensions of
   baseline encoding by appropriate redefinition of EXP.  Baseline
   encoding [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>] works well with IPsec tunnels (see <a href="#section-3.3.3.3">Section</a>
   <a href="#section-3.3.3.3">3.3.3.3</a>).



<span class="grey">Karagiannis, et al.           Informational                    [Page 15]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  Encoding with 1 DSCP Providing 3 States</span>

   PCN 3-state encoding uses a single DSCP (3-in-1 encoding, [<a href="rfc6660.html" title="&quot;Encoding Three Pre-Congestion Notification (PCN) States in the IP Header Using a Single Diffserv Codepoint (DSCP)&quot;">RFC6660</a>]),
   extends the baseline encoding, and supports the simultaneous use of
   both excess-traffic-marking and threshold-marking.  3-in-1 encoding
   well supports the preferred CL-PCN and also SM-PCN.

   The problem with 3-in-1 encoding is that the 10-codepoint does not
   survive decapsulation with the tunneling options in Sections <a href="#section-3.3.3.1">3.3.3.1</a>
   - 3.3.3.3.

   Therefore, the full 3-in-1 encoding may only be used for PCN-domains
   implementing the new rules for ECN tunnelling [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>] or for PCN-
   domains without tunnels.  Currently, it is not clear how fast the new
   tunnelling rules will be deployed and this affects the applicability
   of the full 3-in-1 encoding.  Where PCN-domains do contain legacy
   tunnel endpoints, a restricted subset of the full 3-in-1 encoding can
   be used that omits the '01' codepoint.

<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  Encoding with 2 DSCPs Providing 3 or More States</span>

   PCN encoding using 2 DSCPs to provide 3 or more states (3-in-2
   encoding, [<a href="#ref-PCN-3-in-2" title="&quot;A PCN Encoding Using 2 DSCPs to Provide 3 or More States&quot;">PCN-3-in-2</a>]) uses two different DSCPs to accommodate the
   three required codepoints NM, ThM, and ETM.  It leaves some
   codepoints currently unused (CU), and also proposes a way to reuse
   them to store some information about the content of the ECN field
   before the packet enters the PCN-domain.  3-in-2 encoding works well
   with IPsec tunnels (see <a href="#section-3.3.3.3">Section 3.3.3.3</a>).  This type of encoding can
   support both CL-PCN and SM-PCN schemes.

   The disadvantage of 3-in-2 encoding is that it consumes two DSCPs.
   Further, if PCN is applied to more than one Diffserv traffic class,
   then two DSCPs are needed for each.  Moreover, the direct application
   of this encoding scheme to other technologies like MPLS, where even
   fewer bits are available for the encoding of DSCPs, is more
   difficult.

<span class="h3"><a class="selflink" name="section-4.4" href="#section-4.4">4.4</a>.  Encoding for Packet-Specific Dual Marking (PSDM)</span>

   PCN encoding for packet-specific dual marking (PSDM) is designed to
   support PSDM-PCN outlined in <a href="#section-2.2.3">Section 2.2.3</a>.  It is the only proposal
   that supports PCN-based AC and FT with only a single DSCP [<a href="#ref-PCN-PSDM" title="&quot;PCN Encoding for Packet-Specific Dual Marking (PSDM Encoding)&quot;">PCN-PSDM</a>]
   in the presence of IPsec tunnels (see <a href="#section-3.3.3.3">Section 3.3.3.3</a>).  PSDM
   encoding also supports SM-PCN.







<span class="grey">Karagiannis, et al.           Informational                    [Page 16]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h3"><a class="selflink" name="section-4.5" href="#section-4.5">4.5</a>.  Standardized Encodings</span>

   The baseline encoding described in <a href="#section-4.1">Section 4.1</a> is defined in
   [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>].  The intention was to allow for experimental encodings to
   build upon this baseline.  However, following the publication of
   [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>], the working group decided to change its approach and
   instead standardize only one encoding (the 3-in-1 encoding [<a href="rfc6660.html" title="&quot;Encoding Three Pre-Congestion Notification (PCN) States in the IP Header Using a Single Diffserv Codepoint (DSCP)&quot;">RFC6660</a>]
   described in <a href="#section-4.2">Section 4.2</a>).  Rather than defining the 3-in-1 encoding
   as a Standards Track extension to the existing baseline encoding
   [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>], it was agreed that it is best to define a new Standards
   Track document that obsoletes [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>].

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Conclusion</span>

   This document summarizes the PCN working group's exploration of a
   number of approaches for encoding pre-congestion information into the
   IP header.  It is presented as an informational archive.  It provides
   details of those approaches along with an explanation of the
   constraints that apply.  The working group has concluded that the
   "3-in-1" encoding should be published as a Standards Track RFC that
   obsoletes the encoding specified in [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>].

   The reasoning is as follows.  During the early life of the working
   group, the working group decided on an approach of a standardized
   "baseline" encoding [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>], plus a series of experimental
   encodings that would all build on the baseline encoding, each of
   which would be useful in specific circumstances.  However, after the
   tunneling of ECN was standardized in [<a href="rfc6040.html" title="&quot;Tunnelling of Explicit Congestion Notification&quot;">RFC6040</a>], the PCN working group
   decided on a different approach -- to recommend just one encoding,
   the "3-in-1 encoding".

   Although in theory "3-in-1" could be specified as a Standards Track
   extension to the "baseline" encoding, the working group decided that
   it would be cleaner to obsolete [<a href="rfc5696.html" title="&quot;Baseline Encoding and Transport of Pre-Congestion Information&quot;">RFC5696</a>] and specify "3-in-1"
   encoding in a new, stand-alone RFC.

<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Security Implications</span>

   [<a name="ref-RFC5559" id="ref-RFC5559">RFC5559</a>] provides a general description of the security
   considerations for PCN.  This memo does not introduce additional
   security considerations.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Acknowledgements</span>

   We would like to acknowledge the members of the PCN working group and
   Gorry Fairhust for the discussions that generated and improved the
   contents of this memo.




<span class="grey">Karagiannis, et al.           Informational                    [Page 17]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-18" id="page-18" href="#page-18" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  References</span>

<span class="h3"><a class="selflink" name="section-8.1" href="#section-8.1">8.1</a>.  Normative References</span>

   [<a name="ref-RFC0793" id="ref-RFC0793">RFC0793</a>]     Postel, J., "Transmission Control Protocol", STD 7, <a href="rfc793.html">RFC</a>
                 <a href="rfc793.html">793</a>, September 1981.

   [<a name="ref-RFC2474" id="ref-RFC2474">RFC2474</a>]     Nichols, K., Blake, S., Baker, F., and D. Black,
                 "Definition of the Differentiated Services Field (DS
                 Field) in the IPv4 and IPv6 Headers", <a href="rfc2474.html">RFC 2474</a>,
                 December 1998.

   [<a name="ref-RFC3168" id="ref-RFC3168">RFC3168</a>]     Ramakrishnan, K., Floyd, S., and D. Black, "The
                 Addition of Explicit Congestion Notification (ECN) to
                 IP", <a href="rfc3168.html">RFC 3168</a>, September 2001.

   [<a name="ref-RFC4774" id="ref-RFC4774">RFC4774</a>]     Floyd, S., "Specifying Alternate Semantics for the
                 Explicit Congestion Notification (ECN) Field", <a href="https://tools.ietf.org/html/bcp124">BCP 124</a>,
                 <a href="rfc4774.html">RFC 4774</a>, November 2006.

<span class="h3"><a class="selflink" name="section-8.2" href="#section-8.2">8.2</a>.  Informative References</span>

   [<a name="ref-PCN-MS-AC" id="ref-PCN-MS-AC">PCN-MS-AC</a>]   Menth, M. and R. Geib, "Admission Control Using PCN-
                 Marked Signaling", Work in Progress, February 2011.

   [<a name="ref-PCN-3-in-2" id="ref-PCN-3-in-2">PCN-3-in-2</a>]  Briscoe, B., Moncaster, T., and M. Menth, "A PCN
                 Encoding Using 2 DSCPs to Provide 3 or More States",
                 Work in Progress, March 2012.

   [<a name="ref-PCN-PSDM" id="ref-PCN-PSDM">PCN-PSDM</a>]    Menth, M., Babiarz, J., Moncaster, T., and B. Briscoe,
                 "PCN Encoding for Packet-Specific Dual Marking (PSDM
                 Encoding)", Work in Progress, March 2012.

   [<a name="ref-RFC2205" id="ref-RFC2205">RFC2205</a>]     Braden, R., Ed., Zhang, L., Berson, S., Herzog, S., and
                 S. Jamin, "Resource ReSerVation Protocol (RSVP) --
                 Version 1 Functional Specification", <a href="rfc2205.html">RFC 2205</a>,
                 September 1997.

   [<a name="ref-RFC2983" id="ref-RFC2983">RFC2983</a>]     Black, D., "Differentiated Services and Tunnels", <a href="rfc2983.html">RFC</a>
                 <a href="rfc2983.html">2983</a>, October 2000.

   [<a name="ref-RFC3260" id="ref-RFC3260">RFC3260</a>]     Grossman, D., "New Terminology and Clarifications for
                 Diffserv", <a href="rfc3260.html">RFC 3260</a>, April 2002.

   [<a name="ref-RFC3540" id="ref-RFC3540">RFC3540</a>]     Spring, N., Wetherall, D., and D. Ely, "Robust Explicit
                 Congestion Notification (ECN) Signaling with Nonces",
                 <a href="rfc3540.html">RFC 3540</a>, June 2003.




<span class="grey">Karagiannis, et al.           Informational                    [Page 18]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-19" id="page-19" href="#page-19" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


   [<a name="ref-RFC4301" id="ref-RFC4301">RFC4301</a>]     Kent, S. and K. Seo, "Security Architecture for the
                 Internet Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.

   [<a name="ref-RFC5559" id="ref-RFC5559">RFC5559</a>]     Eardley, P., Ed., "Pre-Congestion Notification (PCN)
                 Architecture", <a href="rfc5559.html">RFC 5559</a>, June 2009.

   [<a name="ref-RFC5670" id="ref-RFC5670">RFC5670</a>]     Eardley, P., Ed., "Metering and Marking Behaviour of
                 PCN-Nodes", <a href="rfc5670.html">RFC 5670</a>, November 2009.

   [<a name="ref-RFC5696" id="ref-RFC5696">RFC5696</a>]     Moncaster, T., Briscoe, B., and M. Menth, "Baseline
                 Encoding and Transport of Pre-Congestion Information",
                 <a href="rfc5696.html">RFC 5696</a>, November 2009.

   [<a name="ref-RFC6040" id="ref-RFC6040">RFC6040</a>]     Briscoe, B., "Tunnelling of Explicit Congestion
                 Notification", <a href="rfc6040.html">RFC 6040</a>, November 2010.

   [<a name="ref-RFC6660" id="ref-RFC6660">RFC6660</a>]     Briscoe, B., Moncaster, T., and M. Menth, "Encoding
                 Three Pre-Congestion Notification (PCN) States in the
                 IP Header Using a Single Diffserv Codepoint (DSCP)",
                 <a href="rfc6660.html">RFC 6660</a>, July 2012.

   [<a name="ref-RFC6661" id="ref-RFC6661">RFC6661</a>]      Charny, A., Huang, F., Karagiannis, G., Menth, M., and
                 T. Taylor, Ed., "Pre-Congestion Notification (PCN)
                 Boundary-Node Behavior for the Controlled Load (CL)
                 Mode of Operation", <a href="rfc6661.html">RFC 6661</a>, July 2012.

   [<a name="ref-RFC6662" id="ref-RFC6662">RFC6662</a>]      Charny, A., Zhang, J., Karagiannis, G., Menth, M., and
                 T. Taylor, "Pre-Congestion Notification (PCN) Boundary-
                 Node Behavior for the Single Marking (SM) Mode of
                 Operation", <a href="rfc6662.html">RFC 6662</a>, July 2012.

   [<a name="ref-Menth09" id="ref-Menth09">Menth09</a>]     Menth, M., Babiarz, J., and P. Eardley, "Pre-Congestion
                 Notification Using Packet-Specific Dual Marking", IEEE
                 Proceedings of the International Workshop on the
                 Network of the Future (Future-Net), Dresden/Germany,
                 June 2009.

   [<a name="ref-Menth12" id="ref-Menth12">Menth12</a>]     Menth, M. and F. Lehrieder, "Performance of PCN-Based
                 Admission Control under Challenging Conditions",
                 IEEE/ACM Transactions on Networking, vol. 20, no. 2,
                 April 2012.

   [<a name="ref-Menth10" id="ref-Menth10">Menth10</a>]     Menth, M. and F. Lehrieder, "PCN-Based Measured Rate
                 Termination", Computer Networks Journal, vol. 54, no.
                 3, Sept. 2010






<span class="grey">Karagiannis, et al.           Informational                    [Page 19]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-20" id="page-20" href="#page-20" class="invisible"> </a>
<span class="grey"><a href="rfc6627.html">RFC 6627</a>          Pre-Congestion Notification Encoding         July 2012</span>


Authors' Addresses

   Georgios Karagiannis
   University of Twente
   P.O. Box 217
   7500 AE Enschede,
   The Netherlands
   EMail: g.karagiannis@utwente.nl


   Kwok Ho Chan
   Consultant
   EMail: khchan.work@gmail.com


   Toby Moncaster
   University of Cambridge Computer Laboratory
   William Gates Building, J J Thomson Avenue
   Cambridge, CB3 0FD
   United Kingdom
   EMail: Toby.Moncaster@cl.cam.ac.uk


   Michael Menth
   University of Tuebingen
   Sand 13
   72076 Tuebingen
   Germany

   Phone: +49-7071-2970505
   EMail: menth@uni-tuebingen.de


   Philip Eardley
   BT
   B54/77, Sirius House Adastral Park Martlesham Heath
   Ipswich, Suffolk  IP5 3RE
   United Kingdom
   EMail: philip.eardley@bt.com


   Bob Briscoe
   BT
   B54/77, Sirius House Adastral Park Martlesham Heath
   Ipswich, Suffolk  IP5 3RE
   United Kingdom
   EMail: bob.briscoe@bt.com




Karagiannis, et al.           Informational                    [Page 20]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129c, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>

<!-- Mirrored from tools.ietf.org/html/rfc6627 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:41:25 GMT -->
</html>
