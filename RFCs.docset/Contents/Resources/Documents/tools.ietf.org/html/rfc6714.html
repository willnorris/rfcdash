<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from tools.ietf.org/html/rfc6714 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:39:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129c" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Relation.Replaces" content="draft-ietf-simple-msrp-sessmatch" />
<meta name="DC.Identifier" content="urn:ietf:rfc:6714" />
<meta name="DC.Date.Issued" content="August, 2012" />
<meta name="DC.Creator" content="Holmberg, Christer" />
<meta name="DC.Creator" content="Blau, Staffan" />
<meta name="DC.Creator" content="Burger, Eric" />
<meta name="DC.Description.Abstract" content="This document defines a Message Session Relay Protocol (MSRP)
extension, Connection Establishment for Media Anchoring (CEMA).
Support of this extension is OPTIONAL. The extension allows
middleboxes to anchor the MSRP connection, without the need for
middleboxes to modify the MSRP messages; thus, it also enables secure
end-to-end MSRP communication in networks where such middleboxes are
deployed. This document also defines a Session Description Protocol
(SDP) attribute, 'msrp-cema', that MSRP endpoints use to
indicate support of the CEMA extension. [STANDARDS-TRACK]" />
<meta name="DC.Title" content="Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP)" />

    <link rel="icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 6714 - Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgblue"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6714.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6714" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-simple-msrp-cema" title="draft-ietf-simple-msrp-cema">draft-ietf-simp...</a>] [<a href='https://datatracker.ietf.org/doc/rfc6714' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6714" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6714" title="Side-by-side diff">Diff2</a>]         </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Internet Engineering Task Force (IETF)                       C. Holmberg
Request for Comments: 6714                                       S. Blau
Category: Standards Track                                       Ericsson
ISSN: 2070-1721                                                E. Burger
                                                   Georgetown University
                                                             August 2012


          <span class="h1">Connection Establishment for Media Anchoring (CEMA)</span>
             <span class="h1">for the Message Session Relay Protocol (MSRP)</span>

Abstract

   This document defines a Message Session Relay Protocol (MSRP)
   extension, Connection Establishment for Media Anchoring (CEMA).
   Support of this extension is OPTIONAL.  The extension allows
   middleboxes to anchor the MSRP connection, without the need for
   middleboxes to modify the MSRP messages; thus, it also enables secure
   end-to-end MSRP communication in networks where such middleboxes are
   deployed.  This document also defines a Session Description Protocol
   (SDP) attribute, 'msrp-cema', that MSRP endpoints use to indicate
   support of the CEMA extension.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6714">http://www.rfc-editor.org/info/rfc6714</a>.















<span class="grey">Holmberg, et al.             Standards Track                    [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Holmberg, et al.             Standards Track                    [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions .....................................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Applicability Statement .........................................<a href="#page-6">6</a>
   <a href="#section-4">4</a>. Connection Establishment for Media Anchoring Mechanism ..........<a href="#page-7">7</a>
      <a href="#section-4.1">4.1</a>. General ....................................................<a href="#page-7">7</a>
      <a href="#section-4.2">4.2</a>. MSRP SDP Offerer Procedures ................................<a href="#page-8">8</a>
      <a href="#section-4.3">4.3</a>. MSRP SDP Answerer Procedures ...............................<a href="#page-9">9</a>
      <a href="#section-4.4">4.4</a>. Address Information Matching ..............................<a href="#page-11">11</a>
      <a href="#section-4.5">4.5</a>. Usage with the Alternative Connection Model ...............<a href="#page-12">12</a>
   <a href="#section-5">5</a>. The SDP 'msrp-cema' Attribute ..................................<a href="#page-12">12</a>
      <a href="#section-5.1">5.1</a>. General ...................................................<a href="#page-12">12</a>
      <a href="#section-5.2">5.2</a>. Syntax ....................................................<a href="#page-12">12</a>
   <a href="#section-6">6</a>. Middlebox Assumptions ..........................................<a href="#page-13">13</a>
      <a href="#section-6.1">6.1</a>. General ...................................................<a href="#page-13">13</a>
      <a href="#section-6.2">6.2</a>. MSRP Awareness ............................................<a href="#page-13">13</a>
      <a href="#section-6.3">6.3</a>. TCP Connection Reuse ......................................<a href="#page-13">13</a>
      <a href="#section-6.4">6.4</a>. SDP Integrity .............................................<a href="#page-14">14</a>
      <a href="#section-6.5">6.5</a>. TLS .......................................................<a href="#page-14">14</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-14">14</a>
      <a href="#section-7.1">7.1</a>. General ...................................................<a href="#page-14">14</a>
      <a href="#section-7.2">7.2</a>. Man-in-the-Middle (MITM) Attacks ..........................<a href="#page-15">15</a>
      <a href="#section-7.3">7.3</a>. TLS Usage without Middleboxes .............................<a href="#page-16">16</a>
      <a href="#section-7.4">7.4</a>. TLS Usage with Middleboxes ................................<a href="#page-16">16</a>
      <a href="#section-7.5">7.5</a>. Authentication, Credentials, and Key Management ...........<a href="#page-16">16</a>
      <a href="#section-7.6">7.6</a>. Endpoint Procedures for TLS Negotiation ...................<a href="#page-17">17</a>
      <a href="#section-7.7">7.7</a>. Fingerprint-Based Authentication ..........................<a href="#page-18">18</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-19">19</a>
      <a href="#section-8.1">8.1</a>. IANA Registration of the SDP 'msrp-cema' Attribute ........<a href="#page-19">19</a>
   <a href="#section-9">9</a>. Acknowledgements ...............................................<a href="#page-20">20</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-20">20</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-20">20</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-21">21</a>

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   The Message Session Relay Protocol (MSRP) [<a href="rfc4975.html" title="&quot;The Message Session Relay Protocol (MSRP)&quot;">RFC4975</a>] expects to use
   MSRP relays [<a href="rfc4976.html" title="&quot;Relay Extensions for the Message Sessions Relay Protocol (MSRP)&quot;">RFC4976</a>] as a means for Network Address Translation
   (NAT) traversal and policy enforcement.  However, many Session
   Initiation Protocol (SIP) [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>] networks, which deploy MSRP,
   contain middleboxes.  These middleboxes anchor and control media;
   perform tasks such as NAT traversal, performance monitoring, and
   address domain bridging; interconnect Service Level Agreement (SLA)
   policy enforcement; and so on.  One example is the Interconnection






<span class="grey">Holmberg, et al.             Standards Track                    [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   Border Control Function (IBCF) [<a href="#ref-GPP23228" title="&quot;IP Multimedia Subsystem (IMS); Stage 2&quot;">GPP23228</a>], defined by the 3rd
   Generation Partnership Project (3GPP).  The IBCF controls a media
   relay that handles all types of SIP session media, such as voice,
   video, MSRP, etc.

   MSRP, as defined in <a href="rfc4975.html">RFC 4975</a> [<a href="rfc4975.html" title="&quot;The Message Session Relay Protocol (MSRP)&quot;">RFC4975</a>] and <a href="rfc4976.html">RFC 4976</a> [<a href="rfc4976.html" title="&quot;Relay Extensions for the Message Sessions Relay Protocol (MSRP)&quot;">RFC4976</a>], cannot
   anchor through middleboxes.  The reason is that MSRP messages have
   routing information embedded in the message.  Without an extension
   such as CEMA, middleboxes must read the message to change the routing
   information.  This occurs because middleboxes modify the address:port
   information in the Session Description Protocol (SDP) [<a href="rfc4566.html" title="&quot;SDP: Session Description Protocol&quot;">RFC4566</a>]
   c/m-line in order to anchor media.  An "active" [<a href="rfc6135.html" title="&quot;An Alternative Connection Model for the Message Session Relay Protocol (MSRP)&quot;">RFC6135</a>] MSRP User
   Agent (UA) establishes the MSRP TCP or Transport Layer Security (TLS)
   connection based on the MSRP URI of the SDP 'path' attribute.  This
   means that the MSRP connection will not be routed through the
   middlebox unless the middlebox also modifies the MSRP URI of the
   topmost SDP 'path' attribute.  In many scenarios, this will prevent
   the MSRP connection from being established.  In addition, if the
   middlebox modifies the MSRP URI of the SDP 'path' attribute, then the
   MSRP URI comparison procedure [<a href="rfc4975.html" title="&quot;The Message Session Relay Protocol (MSRP)&quot;">RFC4975</a>], which requires consistency
   between the address information in the MSRP messages and the address
   information carried in the MSRP URI of the SDP 'path' attribute,
   will fail.

   The only way to achieve interoperability in this situation is for the
   middlebox to act as an MSRP back-to-back User Agent (B2BUA).  Here,
   the MSRP B2BUA acts as the endpoint for the MSRP signaling and media,
   performs the corresponding modification in the associated MSRP
   messages, and originates a new MSRP session toward the actual remote
   endpoint.  However, the enabling of MSRP B2BUA functionality requires
   substantially more resource usage in the middlebox, which normally
   results in a negative impact on performance.  In addition, the MSRP
   message needs to be exposed in cleartext to the MSRP B2BUA, which
   violates the end-to-end principle [<a href="rfc3724.html" title="&quot;The Rise of the Middle and the Future of End-to-End: Reflections on the Evolution of the Internet Architecture&quot;">RFC3724</a>].

   This specification defines an MSRP extension, Connection
   Establishment for Media Anchoring (CEMA).  In most cases, CEMA allows
   MSRP endpoints to communicate through middleboxes as defined in
   <a href="#section-2">Section 2</a>, without a need for the middleboxes to be MSRP B2BUAs.  In
   such cases, middleboxes that want to anchor the MSRP connection
   simply modify the SDP c/m-line address information, similar to what
   the middleboxes do for non-MSRP media types.  MSRP endpoints that
   support the CEMA extension will use the SDP c/m-line address
   information for establishing the TCP or TLS connection for sending
   and receiving MSRP messages.






<span class="grey">Holmberg, et al.             Standards Track                    [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   The CEMA extension is backward compatible, meaning that CEMA-enabled
   MSRP endpoints can communicate with non-CEMA-enabled endpoints.  In
   scenarios where MSRP endpoints do not support the CEMA extension, an
   MSRP endpoint that supports the CEMA extension behaves in the same
   way as an MSRP endpoint that does not support it.  The CEMA extension
   only provides an alternative mechanism for negotiating and providing
   address information for the MSRP TCP connection.  After the creation
   of the MSRP connection, an MSRP endpoint that supports the CEMA
   extension acts according to the procedures for creating MSRP
   messages, performing checks when receiving MSRP messages defined in
   <a href="rfc4975.html">RFC 4975</a> and, when it is using a relay for MSRP communications,
   <a href="rfc4976.html">RFC 4976</a>.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>
   [<a href="rfc2119.html" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

   Definitions:

   Fingerprint-Based TLS Authentication:  An MSRP endpoint that uses a
      self-signed certificate and sends a fingerprint (i.e., a hash of
      the self-signed certificate) in SDP to the other MSRP endpoint.
      This fingerprint binds the TLS key exchange to the signaling plane
      and authenticates the other endpoint based on trust in the
      signaling plane.

   Name-Based TLS Authentication:  An MSRP endpoint that uses a
      certificate that is bound to the endpoint's hostname or SIP
      address of record.  In the TLS session setup, the other MSRP
      endpoint verifies that the identity associated with the
      certificate corresponds to that of the peer (as indicated in SIP/
      SDP) and that the binding of the identity to the public key was
      done by a party that the endpoint trusts.  This definition
      includes traditional certificates issued by a well-known
      certification authority as well as self-signed certificates
      published via the SIP Certificate Management Service [<a href="rfc6072.html" title="&quot;Certificate Management Service for the Session Initiation Protocol (SIP)&quot;">RFC6072</a>] and
      other similar mechanisms.

   B2BUA:  This is an abbreviation for back-to-back user agent.

   MSRP B2BUA:  A network element that terminates an MSRP connection
      from one MSRP endpoint and reoriginates that connection toward
      another MSRP endpoint.  Note that the MSRP B2BUA is distinct from
      a SIP B2BUA.  A SIP B2BUA terminates a SIP session and
      reoriginates that session toward another SIP endpoint.  In the



<span class="grey">Holmberg, et al.             Standards Track                    [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


      context of MSRP, a SIP endpoint initiates a SIP session toward
      another SIP endpoint.  However, that INVITE may go through, for
      example, an outbound proxy or inbound proxy to route to the remote
      SIP endpoint.  As part of that SIP session, an MSRP session that
      may follow the SIP session path is negotiated.  However, there is
      no requirement to co-locate the SIP network elements with the MSRP
      network elements.

   TLS B2BUA:  A network element that terminates security associations
      (SAs) from endpoints and establishes separate SAs between itself
      and each endpoint.

   Middlebox:  A SIP network device that modifies SDP media address:port
      information in order to steer or anchor media flows described in
      the SDP, including TCP and TLS connections used for MSRP
      communication, through a media proxy function controlled by the
      SIP endpoint.  In most cases, the media proxy function relays the
      MSRP messages without modification, while in some circumstances it
      acts as an MSRP B2BUA.  Other SIP-related functions -- such as
      those related to routing, modification of SIP information, etc. --
      performed by the Middlebox, and whether it acts as a SIP B2BUA or
      not, are outside the scope of this document.  <a href="#section-6">Section 6</a> describes
      additional assumptions regarding how the Middlebox handles MSRP in
      order to support the extension defined in this document.

   Media anchor:  An entity that performs media anchoring inserts itself
      in the media path of a media communication session between two
      entities.  The media anchor will receive, and forward, the media
      sent between the entities.

   This document reuses the terms "answer", "answerer", "offer", and
   "offerer" as defined in [<a href="rfc3264.html" title="&quot;An Offer/Answer Model with Session Description Protocol (SDP)&quot;">RFC3264</a>].

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Applicability Statement</span>

   This document defines a Message Session Relay Protocol (MSRP)
   extension, Connection Establishment for Media Anchoring (CEMA).
   Support of this extension is OPTIONAL.  The extension allows
   Middleboxes to anchor the MSRP connection, without the need for
   Middleboxes to modify the MSRP messages; thus, it also enables secure
   end-to-end MSRP communication in networks where such Middleboxes are
   deployed.  The document also defines a Session Description Protocol
   (SDP) attribute, 'msrp-cema', that MSRP endpoints use to indicate
   support of the CEMA extension.

   The CEMA extension is primarily intended for MSRP endpoints that
   operate in networks in which Middleboxes that want to anchor media
   connections are deployed, without the need for the Middleboxes to



<span class="grey">Holmberg, et al.             Standards Track                    [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   enable MSRP B2BUA functionality.  An example of such a network is the
   IP Multimedia Subsystem (IMS), defined by the 3rd Generation
   Partnership Project (3GPP), which also has the capability for all
   endpoints to use name-based TLS authentication.  The extension is
   also useful for other MSRP endpoints that operate in other networks
   but that communicate with MSRP endpoints in networks with such
   Middleboxes, unless there is a gateway between these networks that by
   default always enables MSRP B2BUA functionality.

   This document assumes certain behaviors on the part of Middleboxes,
   as described in <a href="#section-6">Section 6</a>.  These behaviors are not standardized.  If
   Middleboxes do not behave as assumed, then the CEMA extension does
   not add any value over base MSRP behavior.  MSRP endpoints that
   support CEMA are required to use <a href="rfc4975.html">RFC 4975</a> behavior in cases where
   they detect that the CEMA extension cannot be enabled.

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Connection Establishment for Media Anchoring Mechanism</span>

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  General</span>

   This section defines how an MSRP endpoint that supports the CEMA
   extension generates SDP offers and answers for MSRP, and which SDP
   information elements the MSRP endpoint uses when creating the TCP or
   TLS connection for sending and receiving MSRP messages.

   Based on the procedures described in Sections <a href="#section-4.2">4.2</a> and <a href="#section-4.3">4.3</a>, in the
   following cases the CEMA extension will not be enabled, and there
   will be a fallback to the MSRP connection establishment procedures
   defined in <a href="rfc4975.html">RFC 4975</a> and <a href="rfc4976.html">RFC 4976</a>:

   -  A non-CEMA-enabled MSRP endpoint becomes "active" [<a href="rfc6135.html" title="&quot;An Alternative Connection Model for the Message Session Relay Protocol (MSRP)&quot;">RFC6135</a>] (no
      matter whether it uses a relay for its MSRP communication or not),
      as it will always establish the MSRP connection using the SDP
      'path' attribute, which contains the address information of the
      remote MSRP endpoint, instead of using the SDP c/m-line, which
      contains the address information of the Middlebox.

   -  A non-CEMA-enabled MSRP endpoint that uses a relay for its MSRP
      communication becomes "passive" [<a href="rfc6135.html" title="&quot;An Alternative Connection Model for the Message Session Relay Protocol (MSRP)&quot;">RFC6135</a>], as it cannot be assumed
      that the MSRP endpoint inserts the address information of the
      relay in the SDP c/m-line.

   -  A CEMA-enabled MSRP endpoint that uses a relay for its MSRP
      communication becomes "active", since if it adds the received SDP
      c/m-line address information to the ToPath header field of the
      MSRP message (in order for the relay to establish the MSRP
      connection toward the Middlebox), the session matching [<a href="rfc4975.html" title="&quot;The Message Session Relay Protocol (MSRP)&quot;">RFC4975</a>]
      performed by the remote MSRP endpoint will fail.



<span class="grey">Holmberg, et al.             Standards Track                    [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  MSRP SDP Offerer Procedures</span>

   When a CEMA-enabled offerer sends an SDP offer for MSRP, it generates
   the SDP offer according to the procedures in <a href="rfc4975.html">RFC 4975</a>.  In addition,
   the offerer follows <a href="rfc4976.html">RFC 4976</a> if it is using a relay for MSRP
   communication.  The offerer also performs the following additions and
   modifications:

   1.  The offerer MUST include an SDP 'msrp-cema' attribute in the MSRP
       media description of the SDP offer.

   2.  If the offerer is not using a relay for MSRP communication, it
       MUST include an SDP 'setup' attribute in the MSRP media
       description of the SDP offer, according to the procedures in
       <a href="rfc6135.html">RFC 6135</a> [<a href="rfc6135.html" title="&quot;An Alternative Connection Model for the Message Session Relay Protocol (MSRP)&quot;">RFC6135</a>].

   3.  If the offerer is using a relay for MSRP communication, it MUST,
       in addition to including the address information of the relay in
       the topmost SDP 'path' attribute, also include the address
       information of the relay, rather than its own address
       information, in the SDP c/m-line associated with the MSRP media
       description.  In addition, it MUST include an SDP 'setup:actpass'
       attribute in the MSRP media description of the SDP offer.

   When the offerer receives an SDP answer, if the MSRP media
   description of the SDP answer does not contain an SDP 'msrp-cema'
   attribute, and if any one or more of the criteria below are met, the
   offerer MUST fall back to <a href="rfc4975.html">RFC 4975</a> behavior by sending a new SDP
   offer according to the procedures in <a href="rfc4975.html">RFC 4975</a> and <a href="rfc4976.html">RFC 4976</a>.  The new
   offer MUST NOT contain an SDP 'msrp-cema' attribute.

   1.  The SDP c/m-line address information associated with the MSRP
       media description does not match (see <a href="#section-4.4">Section 4.4</a>) the
       information in the MSRP URI of the 'path' attribute(s) (in which
       case it is assumed that the SDP c/m-line contains the address of
       a Middlebox), and the MSRP endpoint will become "passive" (if the
       MSRP media description of the SDP answer contains an SDP 'setup:
       active' attribute).

   NOTE: If an MSRP URI contains a domain name, it needs to be resolved
   into an IP address and port before it is checked against the SDP
   c/m-line address information, in order to determine whether the
   address information matches.

   2.  The offerer uses a relay for its MSRP communication, the SDP
       c/m-line address information associated with the MSRP media
       description does not match the information in the MSRP URI of the
       SDP 'path' attribute(s) (in which case it is assumed that the SDP



<span class="grey">Holmberg, et al.             Standards Track                    [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


       c/m-line contains the address of a Middlebox), and the offerer
       will become "active" (either by default or if the MSRP media
       description of the SDP answer contains an SDP 'setup:passive'
       attribute).

   3.  The remote MSRP endpoint, acting as an answerer, uses a relay for
       its MSRP communication, the SDP c/m-line address information
       associated with the MSRP media description does not match the
       information in the MSRP URI of the SDP 'path' attributes (in
       which case it is assumed that the SDP c/m-line contains the
       address of a Middlebox), and the MSRP offerer will become
       "active" (either by default or if the MSRP media description of
       the SDP answer contains an SDP 'setup:passive' attribute).

   NOTE: As described in <a href="#section-6">Section 6</a>, in the absence of the SDP
   'msrp-cema' attribute in the new offer, it is assumed that a
   Middlebox will act as an MSRP B2BUA in order to anchor MSRP media.

   The offerer can send the new offer within the existing early dialog
   [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>], or it can terminate the early dialog and establish a new
   dialog by sending the new offer in a new initial INVITE request.

   The offerer MAY choose to terminate the session establishment if it
   can detect that a Middlebox acting as an MSRP B2BUA is not the
   desired remote MSRP endpoint.

   If the answerer uses a relay for its MSRP communication, and the SDP
   c/m-line address information associated with the MSRP media
   description matches one of the SDP 'path' attributes, it is assumed
   that there is no Middlebox in the network.  In that case, the offerer
   MUST fall back to <a href="rfc4975.html">RFC 4975</a> behavior, but it does not need to send a
   new SDP offer.

   In other cases, where none of the criteria above are met, and where
   the MSRP offerer becomes "active", it MUST use the SDP c/m-line for
   establishing the MSRP TCP connection.  If the offerer becomes
   "passive", it will wait for the answerer to establish the TCP
   connection, according to the procedures in <a href="rfc4975.html">RFC 4975</a>.

<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  MSRP SDP Answerer Procedures</span>

   If the MSRP media description of the SDP offer does not contain an
   SDP 'msrp-cema' attribute, and the SDP c/m-line address information
   associated with the MSRP media description does not match the
   information in the MSRP URI of the SDP 'path' attribute(s), the
   answerer MUST either reject the offered MSRP connection (by using a





<span class="grey">Holmberg, et al.             Standards Track                    [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   zero port value number in the generated SDP answer) or reject the
   whole SIP request that carries the SDP offer with a 488 Not
   Acceptable Here [<a href="rfc3261.html" title="&quot;SIP: Session Initiation Protocol&quot;">RFC3261</a>] response.

   NOTE: The reason for the rejection is that the answerer assumes that
   a middlebox that does not support the CEMA extension has modified the
   c/m-line address information of the SDP offer without enabling MSRP
   B2BUA functionality.

   NOTE: If an MSRP URI contains a domain name, it needs to be resolved
   into an IP address and port before it is checked against the SDP
   c/m-line address information, in order to determine whether the
   address information matches.

   If any one or more of the criteria below are met, the answerer MUST
   fall back to <a href="rfc4975.html">RFC 4975</a> behavior and generate the associated SDP answer
   according to the procedures in <a href="rfc4975.html">RFC 4975</a> and <a href="rfc4976.html">RFC 4976</a>.  The answerer
   MUST NOT insert an SDP 'msrp-cema' attribute in the MSRP media
   description of the SDP answer.

   1.  Both MSRP endpoints are using relays for their MSRP
       communication.  The answerer can detect if the remote MSRP
       endpoint, acting as an offerer, is using a relay for its MSRP
       communication if the MSRP media description of the SDP offer
       contains multiple SDP 'path' attributes.

   2.  The offerer uses a relay for its MSRP communication and will
       become "active" (either by default or if the MSRP media
       description of the SDP offer contains an SDP 'setup:active'
       attribute).  Note that a CEMA-enabled offerer would include an
       SDP 'setup:actpass' attribute in the SDP offer, as described in
       <a href="#section-4.2">Section 4.2</a>.

   3.  The answerer uses a relay for MSRP communication and is not able
       to become "passive" (if the MSRP media description of the offer
       contains an SDP 'setup:passive' attribute).  Note that an offerer
       is not allowed to include an SDP 'setup:passive' attribute in an
       SDP offer, as described in <a href="rfc6135.html">RFC 6135</a>.













<span class="grey">Holmberg, et al.             Standards Track                   [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   In all other cases, the answerer generates the associated SDP answer
   according to the procedures in <a href="rfc4975.html">RFC 4975</a> and <a href="rfc4976.html">RFC 4976</a>, with the
   following additions and modifications:

   1.  The answerer MUST include an SDP 'msrp-cema' attribute in the
       MSRP media description of the SDP answer.

   2.  If the answerer is not using a relay for MSRP communication, it
       MUST include an SDP 'setup' attribute in the MSRP media
       description of the answer, according to the procedures in
       <a href="rfc6135.html">RFC 6135</a>.

   3.  If the answerer is using a relay for MSRP communication, it MUST,
       in addition to including the address information of the relay in
       the topmost SDP 'path' attribute, also include the address
       information of the relay, rather than its own address
       information, in the SDP c/m-line associated with the MSRP media
       description.  In addition, the answerer MUST include an SDP
       'setup:passive' attribute in the MSRP media description of the
       SDP answer.

   If the answerer included an SDP 'msrp-cema' attribute in the MSRP
   media description of the SDP answer, and if the answerer becomes
   "active", it MUST use the received SDP c/m-line for establishing the
   MSRP TCP or TLS connection.  If the answerer becomes "passive", it
   will wait for the offerer to establish the MSRP TCP or TLS
   connection, according to the procedures in <a href="rfc4975.html">RFC 4975</a>.

<span class="h3"><a class="selflink" name="section-4.4" href="#section-4.4">4.4</a>.  Address Information Matching</span>

   When comparing address information in the SDP c/m-line and an MSRP
   URI, for address and port equivalence, the address and port values
   are retrieved in the following ways:

   -  SDP c/m-line address information: The IP address is retrieved from
      the SDP c-line, and the port from the associated SDP m-line for
      MSRP.

   -  In case the SDP c-line contains a Fully Qualified Domain Name
      (FQDN), the IP address is retrieved using DNS.

   -  MSRP URI address information: The IP address and port are
      retrieved from the authority part of the MSRP URI.

   -  In case the authority part of the MSRP URI contains an FQDN, the
      IP address is retrieved using DNS, according to the procedures in
      <a href="rfc4975.html#section-6.2">Section&nbsp;6.2 of RFC 4975</a>.




<span class="grey">Holmberg, et al.             Standards Track                   [Page 11]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   NOTE: According to <a href="rfc4975.html">RFC 4975</a>, the authority part of the MSRP URI must
   always contain a port.

   Before IPv6 addresses are compared for equivalence, they need to be
   converted into the same representation, using the mechanism defined
   in <a href="rfc5952.html">RFC 5952</a> [<a href="rfc5952.html" title="&quot;A Recommendation for IPv6 Address Text Representation&quot;">RFC5952</a>].

   NOTE: In case the DNS returns multiple records, each needs to be
   compared against the SDP c/m-line address information, in order to
   find at least one match.

   NOTE: If the authority part of the MSRP URI contains special
   characters, they are handled according to the procedures in
   <a href="rfc4975.html#section-6.1">Section&nbsp;6.1 of RFC 4975</a>.

<span class="h3"><a class="selflink" name="section-4.5" href="#section-4.5">4.5</a>.  Usage with the Alternative Connection Model</span>

   An MSRP endpoint that supports the CEMA extension MUST support the
   mechanism defined in <a href="rfc6135.html">RFC 6135</a>, as it extends the number of scenarios
   where one can use the CEMA extension.  An example is where an MSRP
   endpoint is using a relay for MSRP communication, and it needs to be
   "passive" in order to use the CEMA extension, instead of doing a
   fallback to <a href="rfc4975.html">RFC 4975</a> behavior.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  The SDP 'msrp-cema' Attribute</span>

<span class="h3"><a class="selflink" name="section-5.1" href="#section-5.1">5.1</a>.  General</span>

   The SDP 'msrp-cema' attribute is used by MSRP entities to indicate
   support of the CEMA extension, according to the procedures in
   Sections <a href="#section-4.2">4.2</a> and <a href="#section-4.3">4.3</a>.

<span class="h3"><a class="selflink" name="section-5.2" href="#section-5.2">5.2</a>.  Syntax</span>

   This section describes the syntax extensions to the ABNF syntax
   defined in <a href="rfc4566.html">RFC 4566</a> required for the SDP 'msrp-cema' attribute.  The
   ABNF defined in this specification is conformant to <a href="rfc5234.html">RFC 5234</a>
   [<a href="rfc5234.html" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">RFC5234</a>].

      attribute          =/ msrp-cema-attr
      ;attribute defined in <a href="rfc4566.html">RFC 4566</a>
      msrp-cema-attr     = "msrp-cema"









<span class="grey">Holmberg, et al.             Standards Track                   [Page 12]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Middlebox Assumptions</span>

<span class="h3"><a class="selflink" name="section-6.1" href="#section-6.1">6.1</a>.  General</span>

   This document does not specify explicit Middlebox behavior, even
   though Middleboxes enable some of the procedures described here.
   However, as MSRP endpoints are expected to operate in networks where
   Middleboxes that want to anchor media are present, this document
   makes certain assumptions regarding how such Middleboxes behave.

<span class="h3"><a class="selflink" name="section-6.2" href="#section-6.2">6.2</a>.  MSRP Awareness</span>

   In order to support interoperability between UAs that support the
   CEMA extension and UAs that do not support the extension, the
   Middlebox is MSRP aware.  This means that it implements MSRP B2BUA
   functionality.  The Middlebox enables that functionality in cases
   where the offerer does not support the CEMA extension.  In cases
   where the SDP offer indicates support of the CEMA extension, the
   Middlebox can simply modify the SDP c/m-line address information for
   the MSRP connection.

   In cases where the Middlebox enables MSRP B2BUA functionality, it
   acts as an MSRP endpoint.  If it does not use the CEMA procedures, it
   will never forward the SDP 'msrp-cema' attribute in SDP offers and
   answers.

   If the Middlebox does not implement MSRP B2BUA functionality, or does
   not enable it when the SDP 'msrp-cema' attribute is not present in
   the SDP offer, CEMA-enabled MSRP endpoints will in some cases be
   unable to interoperate with non-CEMA-enabled endpoints across the
   Middlebox.

<span class="h3"><a class="selflink" name="section-6.3" href="#section-6.3">6.3</a>.  TCP Connection Reuse</span>

   Middleboxes do not need to parse and modify the MSRP payload when
   endpoints use the CEMA extension.  A Middlebox that does not parse
   the MSRP payload probably will not be able to reuse TCP connections
   for multiple MSRP sessions.  Instead, in order to associate an MSRP
   message with a specific session, the Middlebox often assigns a unique
   local address:port combination for each MSRP session.  Due to this,
   between two Middleboxes there might be a separate connection for each
   MSRP session.

   If the Middlebox does not assign a unique address:port combination
   for each MSRP session, and does not parse MSRP messages, it might
   end up forwarding MSRP messages toward the wrong destination.





<span class="grey">Holmberg, et al.             Standards Track                   [Page 13]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


<span class="h3"><a class="selflink" name="section-6.4" href="#section-6.4">6.4</a>.  SDP Integrity</span>

   This document assumes that Middleboxes are able to modify the SDP
   address information associated with the MSRP media.

   NOTE: Even though the CEMA extension as such works with end-to-end
   SDP protection, the main advantage of the extension is in networks
   where Middleboxes are deployed.

   If the Middlebox is unable to modify SDP payloads due to end-to-end
   integrity protection, it will be unable to anchor MSRP media, as the
   SIP signaling would fail due to integrity violations.

<span class="h3"><a class="selflink" name="section-6.5" href="#section-6.5">6.5</a>.  TLS</span>

   When UAs use the CEMA extension, this document assumes that
   Middleboxes relay MSRP media packets at the transport layer.  The TLS
   handshake and resulting security association (SA) can be established
   peer-to-peer between the MSRP endpoints.  The Middlebox will see
   encrypted MSRP media packets but is unable to inspect the cleartext
   content.

   When UAs fall back to <a href="rfc4975.html">RFC 4975</a> behavior, Middleboxes act as TLS
   B2BUAs.  The Middlebox decrypts MSRP media packets received from one
   MSRP endpoint and then re-encrypts them before sending them toward
   the other MSRP endpoint.  Middleboxes can inspect and modify the MSRP
   message content.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Security Considerations</span>

<span class="h3"><a class="selflink" name="section-7.1" href="#section-7.1">7.1</a>.  General</span>

   Unless otherwise stated, the security considerations in <a href="rfc4975.html">RFC 4975</a> and
   <a href="rfc4976.html">RFC 4976</a> still apply.  This section only describes additions and
   changes introduced by the CEMA extension.

   The purpose of CEMA is to enable MSRP communication over Middleboxes.
   These Middleboxes are commonly deployed by SIP network operators, who
   also commonly deploy firewall and routing policies that prevent media
   sessions from working unless they traverse the Middleboxes.

   CEMA makes it possible for Middleboxes to tunnel TLS to allow end-to-
   end SAs between endpoints.  This is an improvement over the status
   quo, since without CEMA, the Middleboxes would be forced to both read
   and modify the cleartext MSRP messages, which would make end-to-end
   confidentiality and integrity protection of the MSRP transport
   channel impossible.




<span class="grey">Holmberg, et al.             Standards Track                   [Page 14]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   <a href="rfc4975.html">RFC 4975</a> suggests two ways for MSRP endpoints to verify that the TLS
   connection is established end to end.  The first option is to use
   certificates from a well-known certification authority and verify
   that the SubjectAltName matches the MSRP URI of the other side.  The
   second option is to use self-signed certificates and include a
   fingerprint of the certificate in the SDP offer/answer.  Provided the
   signaling is integrity protected, both endpoints can verify that the
   TLS SA is established with the correct host by matching the received
   certificate against the received fingerprint.

   Fingerprint-based authentication is expected to be common for end
   clients.  In order to ensure the integrity of the fingerprint,
   <a href="rfc4975.html">RFC 4975</a> recommends using the SIP Identity mechanism [<a href="rfc4474.html" title="&quot;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)&quot;">RFC4474</a>].
   However, this mechanism may not be compatible with CEMA, which
   operates under the assumption that Middleboxes will modify the
   contents of SDP offers and answers.  Until a mechanism is available
   that enables a subset of the SDP to be signed, end clients that
   support CEMA and use fingerprint-based authentication are forced to
   trust the entire signaling path.  In other words, end clients must
   accept the fact that every signaling proxy could potentially replace
   the fingerprints and insert a Middlebox that acts as a TLS B2BUA.

   An alternative solution that only requires a limited trust in the
   signaling plane is to use self-signed certificates together with the
   SIP Certificate Management Service [<a href="rfc6072.html" title="&quot;Certificate Management Service for the Session Initiation Protocol (SIP)&quot;">RFC6072</a>].  The security provided
   by this solution is roughly equivalent to SIP Identity and
   fingerprint-based authentication (in fact, <a href="rfc6072.html">RFC 6072</a> is based on
   <a href="rfc4474.html">RFC 4474</a>).  <a href="#section-7.5">Section 7.5</a> discusses this approach further.

   In the remainder of this section, we will assume that fingerprint-
   based authentication is used without SIP Identity or similar
   mechanisms that protect the SDP across several hops.

<span class="h3"><a class="selflink" name="section-7.2" href="#section-7.2">7.2</a>.  Man-in-the-Middle (MITM) Attacks</span>

   If TLS is not used to protect MSRP, the CEMA extension might make it
   easier for a MITM to transparently insert itself in the communication
   between MSRP endpoints in order to monitor or record unprotected MSRP
   communication.  This can be mitigated by the use of TLS.  It is
   therefore RECOMMENDED that TLS [<a href="rfc5246.html" title="&quot;The Transport Layer Security (TLS) Protocol Version 1.2&quot;">RFC5246</a>] be used.  It is also
   recommended that TLS be used end to end, which CEMA enables even in
   the case of Middleboxes.  According to <a href="rfc4975.html">RFC 4975</a>, MSRP endpoints are
   required to support TLS.  This also applies to CEMA-enabled
   endpoints.







<span class="grey">Holmberg, et al.             Standards Track                   [Page 15]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


<span class="h3"><a class="selflink" name="section-7.3" href="#section-7.3">7.3</a>.  TLS Usage without Middleboxes</span>

   If TLS is used without Middleboxes, the security considerations in
   <a href="rfc4975.html">RFC 4975</a> and <a href="rfc4976.html">RFC 4976</a> still apply unchanged.  Note that this is not
   the main use case for the CEMA extension.

<span class="h3"><a class="selflink" name="section-7.4" href="#section-7.4">7.4</a>.  TLS Usage with Middleboxes</span>

   This is the main use case for the CEMA extension; the endpoints
   expect one or more Middleboxes.

   The CEMA extension supports the usage of both name-based
   authentication and fingerprint-based authentication for TLS in the
   presence of Middleboxes.  The use of fingerprint-based authentication
   requires signaling integrity protection.  This can, for example, be
   hop-by-hop cryptographic protection or cryptographic access
   protection combined with a suitably protected core network.  As
   stated in <a href="#section-6.4">Section 6.4</a>, this document assumes that Middleboxes are
   able to modify the SDP address information associated with the MSRP
   media.

   If a Middlebox acts as a TLS B2BUA, the security considerations are
   the same as those without the CEMA extension.  In such a case, the
   Middlebox acts as a TLS endpoint.

   If a Middlebox does not act as a TLS B2BUA, TLS is end to end and the
   Middlebox just forwards the TLS packets.  This requires that both
   peers support the CEMA extension.

   If fingerprint-based authentication is used, the MSRP endpoints might
   not be able to decide whether or not the Middlebox acts as a TLS
   B2BUA.  But this is not an issue, as the signaling network is
   considered trusted by the endpoint (a requirement to use fingerprint-
   based authentication).

<span class="h3"><a class="selflink" name="section-7.5" href="#section-7.5">7.5</a>.  Authentication, Credentials, and Key Management</span>

   One issue with the usage of TLS (not specific to CEMA) is the
   availability of a PKI.  Endpoints can always provide self-signed
   certificates and include fingerprints in the SDP offer and answer.
   However, this relies on SDP signaling being integrity protected,
   which may not always be the case.









<span class="grey">Holmberg, et al.             Standards Track                   [Page 16]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   Therefore, in addition to the authentication mechanisms defined in
   <a href="rfc4975.html">RFC 4975</a>, it is RECOMMENDED that a CEMA-enabled MSRP endpoint also
   support self-signed certificates together with the Certificate
   Management Service [<a href="rfc6072.html" title="&quot;Certificate Management Service for the Session Initiation Protocol (SIP)&quot;">RFC6072</a>], to which it publishes its self-signed
   certificate and from which it fetches on demand the self-signed
   certificates of other endpoints.

   Alternate key distribution mechanisms, such as DNS-Based
   Authentication of Named Entities (DANE) [<a href="#ref-DANE" title="&quot;DNS-Based Authentication of Named Entities (DANE) Working Group&quot;">DANE</a>], Pretty Good Privacy
   (PGP) [<a href="rfc6091.html" title="&quot;Using OpenPGP Keys for Transport Layer Security (TLS) Authentication&quot;">RFC6091</a>], Ticket-Based Modes of Key Distribution in Multimedia
   Internet KEYing (MIKEY-TICKET) [<a href="rfc6043.html" title="&quot;MIKEY-TICKET: Ticket-Based Modes of Key Distribution in Multimedia Internet KEYing (MIKEY)&quot;">RFC6043</a>], or some other technology,
   might become ubiquitous enough to solve the key distribution problem
   in the future.

   One of the target deployments for CEMA is the 3GPP IMS SIP network.
   In this environment, authentication and credential management are
   less of a problem, as the SDP signaling is mostly considered trusted,
   service providers provision signed certificates or manage signed
   certificates on behalf of their subscribers, and MIKEY-TICKET is
   available.  Some of these options require trusting the service
   provider, but those issues are beyond the scope of this document.

<span class="h3"><a class="selflink" name="section-7.6" href="#section-7.6">7.6</a>.  Endpoint Procedures for TLS Negotiation</span>

   The CEMA extension does not change the endpoint procedures for TLS
   negotiation.  As in <a href="rfc4975.html">RFC 4975</a>, the MSRP endpoint uses the negotiation
   mechanisms in SDP and then the TLS handshake to agree on mechanisms
   and algorithms that both support.  The mechanisms can be divided into
   three different security levels:

   1.  MSRPS: Security mechanisms that do not rely on trusted signaling,
       such as name-based authentication

   2.  MSRPS: Mechanisms that do rely on trusted signaling, such as
       fingerprint-based authentication

   3.  MSRP: Unprotected

   If the endpoint uses security mechanisms that do not rely on trusted
   signaling, the endpoint can detect if a Middlebox that acts as a
   B2BUA is inserted.  It is therefore RECOMMENDED that such a mechanism
   be used.

   If the endpoint uses security mechanisms that rely on trusted
   signaling, the endpoint may not be able to detect if a Middlebox that
   acts as a B2BUA is inserted (by the trusted network operator).  To be
   able to eavesdrop, a Middlebox must do an active "attack" on the
   setup signaling.  A Middlebox cannot insert itself at a later point.



<span class="grey">Holmberg, et al.             Standards Track                   [Page 17]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-18" id="page-18" href="#page-18" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   If unprotected MSRP is used, the endpoint cannot detect if a
   Middlebox that acts as a B2BUA is inserted and Middleboxes may be
   inserted at any time during the session.

   The mechanism in <a href="rfc6072.html">RFC 6072</a> [<a href="rfc6072.html" title="&quot;Certificate Management Service for the Session Initiation Protocol (SIP)&quot;">RFC6072</a>] provides end-to-end security
   without relying on trust in the signaling plane and eases the use and
   deployment of name-based authentication.

   The procedures for choosing and offering name-based authentication,
   fingerprint-based authentication, and unprotected MSRP as described
   in <a href="rfc4975.html">RFC 4975</a> still apply.

<span class="h3"><a class="selflink" name="section-7.7" href="#section-7.7">7.7</a>.  Fingerprint-Based Authentication</span>

   If the endpoint cannot use a key management protocol that does not
   rely on trust in the signaling plane, such as name-based
   authentication, the only alternative is fingerprint-based
   authentication.

   The use of fingerprint-based authentication requires integrity
   protection of the signaling plane.  This can, for example, be hop-by-
   hop cryptographic protection or cryptographic access protection
   combined with a suitably protected core network.  Unless
   cryptographic end-to-end SDP integrity protection or encryption is
   used, this may be hard for the endpoint to decide.  In the end, it is
   up to the endpoint to decide whether the signaling path is trusted
   or not.

   How this decision is done is implementation specific, but normally,
   signaling over the Internet SHOULD NOT be trusted.  Signaling over a
   local or closed network might be trusted.  Such networks can, for
   example, be a closed enterprise network or a network operated by an
   operator that the end user trusts.  In IMS, for example, the
   signaling traffic in the access network is integrity protected and
   the traffic is routed over a closed network separated from the
   Internet.  If the network is not trusted, the endpoints SHOULD NOT
   use fingerprint-based authentication.

   When an endpoint receives a fingerprint, that fingerprint represents
   a binding between the identity as established by TLS and that
   established via SDP.  As previously noted, the fingerprint is
   vulnerable to an active MITM attack from any on-path proxy.
   Endpoints SHOULD therefore locally store fingerprints associated with
   the relevant identities when first seen and SHOULD provide a warning
   when a new fingerprint is seen for what otherwise appears to be the
   same peer identity.  While there are valid reasons for keys to change
   from time to time, that ought to be the exception -- hence the
   suggested warning.



<span class="grey">Holmberg, et al.             Standards Track                   [Page 18]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-19" id="page-19" href="#page-19" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   It should, however, be noted that using fingerprint-based
   authentication over an insecure network increases the security
   compared to unencrypted MSRP.  In order to intercept the plaintext
   media when fingerprint-based authentication is used, the attacker is
   required to be present on both the signaling and media paths and
   actively modify the traffic.  It is very hard for the endpoints to
   detect when such an attack is taking place, though.  A client using
   DTLS-SRTP (a Secure Real-time Transport Protocol (SRTP) extension for
   Datagram Transport Layer Security (DTLS)) [<a href="rfc5764.html" title="&quot;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for the Secure Real-time Transport Protocol (SRTP)&quot;">RFC5764</a>] for Voice over IP
   (VoIP) media security might wish to use fingerprint-based
   authentication also for MSRP media security.

   MSRPS with fingerprint-based authentication is vulnerable to attacks
   due to vulnerabilities in the SIP signaling.  If there are weaknesses
   in the integrity protections on the SIP signaling, an attacker may
   insert malicious Middleboxes to alter, record, or otherwise harm the
   media.  With insecure signaling, it can be difficult for an endpoint
   to even be aware that the remote endpoint has any relationship to the
   expected endpoint.  Securing the SIP signaling does not solve all
   problems.  For example, in a SIP Secure (SIPS) environment, the
   endpoints have no cryptographic way of validating that one or more
   SIP proxies in the proxy chain are not, in fact, malicious.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  IANA Considerations</span>

<span class="h3"><a class="selflink" name="section-8.1" href="#section-8.1">8.1</a>.  IANA Registration of the SDP 'msrp-cema' Attribute</span>

   IANA has added an attribute to the 'att-field (media level only)'
   registry of the Session Description Protocol (SDP) Parameters
   registry, according to the information provided in this section.

   This section registers a new SDP attribute, 'msrp-cema'.  The
   required information for this registration, as specified in <a href="rfc4566.html">RFC 4566</a>,
   is as follows:

   Contact name: Christer Holmberg

   Contact email: christer.holmberg@ericsson.com

   Attribute name: msrp-cema

   Type of attribute: media level









<span class="grey">Holmberg, et al.             Standards Track                   [Page 19]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-20" id="page-20" href="#page-20" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   Purpose: This attribute is used to indicate support of
            the MSRP Connection Establishment for Media
            Anchoring (CEMA) extension defined in
            <a href="rfc6714.html">RFC 6714</a>.  When present in an MSRP media
            description of an SDP body, it indicates
            that the creator of the SDP supports the CEMA
            mechanism.

   Values: The attribute does not carry a value.

   Charset dependency: none

<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  Acknowledgements</span>

   Thanks to Ben Campbell, Remi Denis-Courmont, Nancy Greene, Hadriel
   Kaplan, Adam Roach, Robert Sparks, Salvatore Loreto, Shida Schubert,
   Ted Hardie, Richard L. Barnes, Inaki Baz Castillo, Saul Ibarra
   Corretge, Cullen Jennings, Adrian Georgescu, Miguel Garcia, and Paul
   Kyzivat for their guidance and input in order to produce this
   document.

   Thanks to John Mattsson, Oscar Ohlsson, Ben Campbell, and Stephen
   Farrell for their help in restructuring the Security Considerations
   section, based on feedback from the IESG.

<span class="h2"><a class="selflink" name="section-10" href="#section-10">10</a>.  References</span>

<span class="h3"><a class="selflink" name="section-10.1" href="#section-10.1">10.1</a>.  Normative References</span>

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-RFC3261" id="ref-RFC3261">RFC3261</a>]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
               A., Peterson, J., Sparks, R., Handley, M., and E.
               Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
               June 2002.

   [<a name="ref-RFC3264" id="ref-RFC3264">RFC3264</a>]   Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model
               with Session Description Protocol (SDP)", <a href="rfc3264.html">RFC 3264</a>,
               June 2002.

   [<a name="ref-RFC4566" id="ref-RFC4566">RFC4566</a>]   Handley, M., Jacobson, V., and C. Perkins, "SDP: Session
               Description Protocol", <a href="rfc4566.html">RFC 4566</a>, July 2006.

   [<a name="ref-RFC4975" id="ref-RFC4975">RFC4975</a>]   Campbell, B., Ed., Mahy, R., Ed., and C. Jennings, Ed.,
               "The Message Session Relay Protocol (MSRP)", <a href="rfc4975.html">RFC 4975</a>,
               September 2007.




<span class="grey">Holmberg, et al.             Standards Track                   [Page 20]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-21" id="page-21" href="#page-21" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   [<a name="ref-RFC4976" id="ref-RFC4976">RFC4976</a>]   Jennings, C., Mahy, R., and A. Roach, "Relay Extensions
               for the Message Sessions Relay Protocol (MSRP)",
               <a href="rfc4976.html">RFC 4976</a>, September 2007.

   [<a name="ref-RFC5234" id="ref-RFC5234">RFC5234</a>]   Crocker, D., Ed., and P. Overell, "Augmented BNF for
               Syntax Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>,
               January 2008.

   [<a name="ref-RFC5246" id="ref-RFC5246">RFC5246</a>]   Dierks, T. and E. Rescorla, "The Transport Layer Security
               (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>, August 2008.

   [<a name="ref-RFC6072" id="ref-RFC6072">RFC6072</a>]   Jennings, C. and J. Fischl, Ed., "Certificate Management
               Service for the Session Initiation Protocol (SIP)",
               <a href="rfc6072.html">RFC 6072</a>, February 2011.

   [<a name="ref-RFC6135" id="ref-RFC6135">RFC6135</a>]   Holmberg, C. and S. Blau, "An Alternative Connection
               Model for the Message Session Relay Protocol (MSRP)",
               <a href="rfc6135.html">RFC 6135</a>, February 2011.

<span class="h3"><a class="selflink" name="section-10.2" href="#section-10.2">10.2</a>.  Informative References</span>

   [<a name="ref-RFC3724" id="ref-RFC3724">RFC3724</a>]   Kempf, J., Ed., Austein, R., Ed., and IAB, "The Rise of
               the Middle and the Future of End-to-End: Reflections on
               the Evolution of the Internet Architecture", <a href="rfc3724.html">RFC 3724</a>,
               March 2004.

   [<a name="ref-RFC4474" id="ref-RFC4474">RFC4474</a>]   Peterson, J. and C. Jennings, "Enhancements for
               Authenticated Identity Management in the Session
               Initiation Protocol (SIP)", <a href="rfc4474.html">RFC 4474</a>, August 2006.

   [<a name="ref-RFC5764" id="ref-RFC5764">RFC5764</a>]   McGrew, D. and E. Rescorla, "Datagram Transport Layer
               Security (DTLS) Extension to Establish Keys for the
               Secure Real-time Transport Protocol (SRTP)", <a href="rfc5764.html">RFC 5764</a>,
               May 2010.

   [<a name="ref-RFC5952" id="ref-RFC5952">RFC5952</a>]   Kawamura, S. and M. Kawashima, "A Recommendation for IPv6
               Address Text Representation", <a href="rfc5952.html">RFC 5952</a>, August 2010.

   [<a name="ref-RFC6043" id="ref-RFC6043">RFC6043</a>]   Mattsson, J. and T. Tian, "MIKEY-TICKET: Ticket-Based
               Modes of Key Distribution in Multimedia Internet KEYing
               (MIKEY)", <a href="rfc6043.html">RFC 6043</a>, March 2011.

   [<a name="ref-RFC6091" id="ref-RFC6091">RFC6091</a>]   Mavrogiannopoulos, N. and D. Gillmor, "Using OpenPGP Keys
               for Transport Layer Security (TLS) Authentication",
               <a href="rfc6091.html">RFC 6091</a>, February 2011.






<span class="grey">Holmberg, et al.             Standards Track                   [Page 21]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-22" id="page-22" href="#page-22" class="invisible"> </a>
<span class="grey"><a href="rfc6714.html">RFC 6714</a>                        MSRP-CEMA                    August 2012</span>


   [<a name="ref-GPP23228" id="ref-GPP23228">GPP23228</a>]  3GPP, "IP Multimedia Subsystem (IMS); Stage 2", 3GPP
               TS 23.228 11.5.0, June 2012,
               &lt;<a href="http://www.3gpp.org/ftp/Specs/html-info/23228.htm">http://www.3gpp.org/ftp/Specs/html-info/23228.htm</a>&gt;.

   [<a name="ref-DANE" id="ref-DANE">DANE</a>]      "DNS-Based Authentication of Named Entities (DANE)
               Working Group",
               &lt;<a href="https://datatracker.ietf.org/wg/dane/charter/">https://datatracker.ietf.org/wg/dane/charter/</a>&gt;.

Authors' Addresses

   Christer Holmberg
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   EMail: christer.holmberg@ericsson.com


   Staffan Blau
   Ericsson
   Stockholm  12637
   Sweden

   EMail: staffan.blau@ericsson.com


   Eric Burger
   Georgetown University
   Department of Computer Science
   37th and O Streets, NW
   Washington, DC  20057-1232
   United States of America

   Fax:   +1 530 267 7447
   EMail: eburger@standardstrack.com
   URI:   <a href="http://www.standardstrack.com/">http://www.standardstrack.com</a>














Holmberg, et al.             Standards Track                   [Page 22]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129c, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>

<!-- Mirrored from tools.ietf.org/html/rfc6714 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:39:41 GMT -->
</html>
