<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5336 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:5336" name="DC.Identifier"/>
<meta content="This document specifies an SMTP extension for transport and delivery
of email messages with internationalized email addresses or header
information. Communication with systems that do not implement this
specification is specified in another document." name="DC.Description.Abstract"/>
<meta content="Yao, Jiankang" name="DC.Creator"/>
<meta content="Mao, Wei" name="DC.Creator"/>
<meta content="September, 2008" name="DC.Date.Issued"/>
<meta content="SMTP extension for internationalized email address" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5336 - SMTP extension for internationalized email address</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5336.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5336" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-eai-smtpext" title="draft-ietf-eai-smtpext">draft-ietf-eai-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5336" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5336" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5336" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=5336">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc6531.html">6531</a>                                          EXPERIMENTAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                        J. Yao, Ed.
Request for Comments: 5336                                   W. Mao, Ed.
Updates: <a href="rfc2821.html">2821</a>, <a href="rfc2822.html">2822</a>, <a href="rfc4952.html">4952</a>                                          CNNIC
Category: Experimental                                    September 2008


          <span class="h1">SMTP Extension for Internationalized Email Addresses</span>

Status of This Memo

   This memo defines an Experimental Protocol for the Internet
   community.  It does not specify an Internet standard of any kind.
   Discussion and suggestions for improvement are requested.
   Distribution of this memo is unlimited.

Abstract

   This document specifies an SMTP extension for transport and delivery
   of email messages with internationalized email addresses or header
   information.  Communication with systems that do not implement this
   specification is specified in another document.  This document
   updates some syntaxes and rules defined in <a href="rfc2821.html">RFC 2821</a> and <a href="rfc2822.html">RFC 2822</a>, and
   has some material updating <a href="rfc4952.html">RFC 4952</a>.




























<span class="grey">Yao &amp; Mao                     Experimental                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Role of This Specification . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.2">1.2</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Overview of Operation  . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Mail Transport-Level Protocol  . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-3.1">3.1</a>.  Framework for the Internationalization Extension . . . . .  <a href="#page-4">4</a>
     <a href="#section-3.2">3.2</a>.  The UTF8SMTP Extension . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-3.3">3.3</a>.  Extended Mailbox Address Syntax  . . . . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-3.4">3.4</a>.  The ALT-ADDRESS Parameter  . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
     <a href="#section-3.5">3.5</a>.  ALT-ADDRESS Parameter Usage and Response Codes . . . . . . <a href="#page-10">10</a>
     <a href="#section-3.6">3.6</a>.  Body Parts and SMTP Extensions . . . . . . . . . . . . . . <a href="#page-11">11</a>
     <a href="#section-3.7">3.7</a>.  Additional ESMTP Changes and Clarifications  . . . . . . . <a href="#page-11">11</a>
       <a href="#section-3.7.1">3.7.1</a>.  The Initial SMTP Exchange  . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-3.7.2">3.7.2</a>.  Mail eXchangers  . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-3.7.3">3.7.3</a>.  Trace Information  . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-3.7.4">3.7.4</a>.  UTF-8 Strings in Replies . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#section-4">4</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
   <a href="#section-5">5</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-6">6</a>.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-7">7</a>.  References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-7.1">7.1</a>.  Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
     <a href="#section-7.2">7.2</a>.  Informative References . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
   <a href="#appendix-A">Appendix A</a>.  Material Updating <a href="rfc4952.html">RFC 4952</a>  . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#appendix-A.1">A.1</a>.  Conventional Message and Internationalized Message . . . . <a href="#page-20">20</a>
     <a href="#appendix-A.2">A.2</a>.  LMTP . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#appendix-A.3">A.3</a>.  SMTP Service Extension for DSNs  . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#appendix-A.4">A.4</a>.  Implementation Advice  . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
     <a href="#appendix-A.5">A.5</a>.  Applicability of SMTP Extension to Additional Uses . . . . <a href="#page-21">21</a>





















<span class="grey">Yao &amp; Mao                     Experimental                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   An internationalized email address includes two parts, the local part
   and the domain part.  The ways email addresses are used by protocols
   are different from the ways domain names are used.  The most critical
   difference is that emails are delivered through a chain of clients
   and servers, while domain names are resolved by name servers looking
   up those names in their own tables.  In addition to this, the Simple
   Mail Transfer Protocol [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] provides a negotiation mechanism
   about service extension with which clients can discover server
   capabilities and make decisions for further processing.  An extended
   overview of the extension model for internationalized addresses and
   headers appears in [<a href="rfc4952.html" title='"Overview and Framework for Internationalized Email"'>RFC4952</a>], referred to as "the framework document"
   or just as "Framework" elsewhere in this specification.  This
   document specifies an SMTP extension to permit internationalized
   email addresses in envelopes, and UNICODE characters (encoded in
   UTF-8) [<a href="rfc3629.html" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] in headers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Role%20of%20This%20Specification"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Role of This Specification</span>

   The framework document specifies the requirements for, and describes
   components of, full internationalization of electronic mail.  A
   thorough understanding of the information in that document and in the
   base Internet email specifications [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] [<a href="rfc2822.html" title='"Internet Message Format"'>RFC2822</a>] is necessary
   to understand and implement this specification.

   This document specifies an element of the email internationalization
   work, specifically the definition of an SMTP extension [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] for
   internationalized email address transport delivery.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The terms "conventional message" and "internationalized message" are
   defined in an appendix to this specification.  The terms "UTF-8
   string" or "UTF-8 character" are used informally to refer to Unicode
   characters encoded in UTF-8 [<a href="rfc3629.html" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>].  All other specialized terms
   used in this specification are defined in the framework document or
   in the base Internet email specifications [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] [<a href="rfc2822.html" title='"Internet Message Format"'>RFC2822</a>].  In
   particular, the terms "ASCII address", "internationalized email
   address", "non-ASCII address", "i18mail address", "UTF8SMTP",
   "message", and "mailing list" are used in this document according to
   the definitions in the framework document.





<span class="grey">Yao &amp; Mao                     Experimental                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   This specification defines only those Augmented BNF (ABNF) [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>]
   syntax rules that are different from those of the base email
   specifications [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>][RFC2822] and, where the earlier rules are
   upgraded or extended, gives them new names.  When the new rule is a
   small modification to the older one, it is typically given a name
   starting with "u".  Rules that are undefined here may be found in the
   base email specifications under the same names.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Overview%20of%20Operation"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Overview of Operation</span>

   This specification describes an optional extension to the email
   transport mechanism that permits non-ASCII [<a href="#ref-ASCII" title='"USA Code for Information Interchange"'>ASCII</a>] characters in both
   the envelope and header fields of messages, which are encoded with
   UTF-8 [<a href="rfc3629.html" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] characters.  The extension is identified with the
   token "UTF8SMTP".  In order to provide information that may be needed
   in downgrading, an optional alternate ASCII address may be needed if
   an SMTP client attempts to transfer an internationalized message and
   encounters a server that does not support this extension.

   The EAI UTF-8 header specification [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>] provides the details of
   how and where non-ASCII characters are permitted in the header fields
   of messages.  The context for this specification is described in the
   framework document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Mail%20Transport-Level%20Protocol"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Mail Transport-Level Protocol</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Framework%20for%20the%20Internationalization%20Extension"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Framework for the Internationalization Extension</span>

   The following service extension is defined:

   1.   The name of the SMTP service extension is "Email Address
        Internationalization".

   2.   The EHLO keyword value associated with this extension is
        "UTF8SMTP".

   3.   No parameter values are defined for this EHLO keyword value.  In
        order to permit future (although unanticipated) extensions, the
        EHLO response MUST NOT contain any parameters for that keyword.
        Clients MUST ignore any parameters; that is, clients MUST behave
        as if the parameters do not appear.  If a server includes
        UTF8SMTP in its EHLO response, it MUST be fully compliant with
        this version of this specification.








<span class="grey">Yao &amp; Mao                     Experimental                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   4.   One optional parameter, ALT-ADDRESS, is added to the MAIL and
        RCPT commands of SMTP.  ALT-ADDRESS specifies an all-ASCII
        address which can be used as a substitute for the corresponding
        primary (i18mail) address when downgrading.  More discussion of
        the use of this parameter appears in [<a href="rfc4952.html" title='"Overview and Framework for Internationalized Email"'>RFC4952</a>] and [<a href="#ref-Downgrade" title='"Downgrading mechanism for Email Address Internationalization"'>Downgrade</a>].

   5.   One optional parameter "UTF8REPLY" is added to the VRFY and EXPN
        commands.  The parameter UTF8REPLY has no value.  The parameter
        indicates that the SMTP client can accept Unicode characters in
        UTF-8 encoding in replies from the VRFY and EXPN commands.

   6.   No additional SMTP verbs are defined by this extension.

   7.   Servers offering this extension MUST provide support for, and
        announce, the 8BITMIME extension [<a href="rfc1652.html" title='"SMTP Service Extension for 8bit- MIMEtransport"'>RFC1652</a>].

   8.   The reverse-path and forward-path of the SMTP MAIL and RCPT
        commands are extended to allow Unicode characters encoded in
        UTF-8 in mailbox names (addresses).

   9.   The mail message body is extended as specified in [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>].

   10.  The maximum length of MAIL and RCPT command lines is increased
        by 460 characters by the possible addition of the ALT-ADDRESS
        keyword and value.

   11.  The UTF8SMTP extension is valid on the submission port
        [<a href="rfc4409.html" title='"Message Submission for Mail"'>RFC4409</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20The%20UTF8SMTP%20Extension"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  The UTF8SMTP Extension</span>

   An SMTP server that announces this extension MUST be prepared to
   accept a UTF-8 string [<a href="rfc3629.html" title='"UTF-8, a transformation format of ISO 10646"'>RFC3629</a>] in any position in which <a href="rfc2821.html">RFC 2821</a>
   specifies that a mailbox can appear.  That string MUST be parsed only
   as specified in <a href="rfc2821.html">RFC 2821</a>, i.e., by separating the mailbox into source
   route, local part, and domain part, using only the characters colon
   (U+003A), comma (U+002C), and at-sign (U+0040) as specified there.
   Once isolated by this parsing process, the local part MUST be treated
   as opaque unless the SMTP server is the final delivery Mail Transfer
   Agent (MTA).  Any domain names that are to be looked up in the DNS
   MUST first be processed into the form specified in
   "Internationalizing Domain Names in Applications (IDNA)" [<a href="rfc3490.html" title='"Internationalizing Domain Names in Applications (IDNA)"'>RFC3490</a>] by
   means of the ToASCII() operation unless they are already in that
   form.  Any domain names that are to be compared to local strings
   SHOULD be checked for validity and then MUST be compared as specified
   in <a href="#section-3.4">Section 3.4</a> of IDNA.





<span class="grey">Yao &amp; Mao                     Experimental                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   An SMTP client that receives the UTF8SMTP extension keyword in
   response to the EHLO command MAY transmit mailbox names within SMTP
   commands as internationalized strings in UTF-8 form.  It MAY send a
   UTF-8 header [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>] (which may also include mailbox names in
   UTF-8).  It MAY transmit the domain parts of mailbox names within
   SMTP commands or the message header as either ACE (ASCII Compatible
   Encoding) labels (as specified in IDNA [<a href="rfc3490.html" title='"Internationalizing Domain Names in Applications (IDNA)"'>RFC3490</a>]) or UTF-8 strings.
   All labels in domain parts of mailbox names which are IDNs (either
   UTF-8 or ACE strings) MUST be valid.  If the original client submits
   a message to a Message Submission Server ("MSA") [<a href="rfc4409.html" title='"Message Submission for Mail"'>RFC4409</a>], it is the
   responsibility of the MSA that all domain labels are valid;
   otherwise, it is the original client's responsibility.  The presence
   of the UTF8SMTP extension does not change the requirement of <a href="rfc2821.html">RFC 2821</a>
   that servers relaying mail MUST NOT attempt to parse, evaluate, or
   transform the local part in any way.

   If the UTF8SMTP SMTP extension is not offered by the Server, the SMTP
   client MUST NOT transmit an internationalized address and MUST NOT
   transmit a mail message containing internationalized mail headers as
   described in [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>] at any level within its MIME structure.  (For
   this paragraph, the internationalized domain name in the form of ACE
   labels as specified in IDNA [<a href="rfc3490.html" title='"Internationalizing Domain Names in Applications (IDNA)"'>RFC3490</a>] is not considered as
   "internationalized".)  Instead, if an SMTP client (SMTP sender)
   attempts to transfer an internationalized message and encounters a
   server that does not support the extension, it MUST make one of the
   following four choices:

   1.  If and only if the SMTP client (sender) is a Message Submission
       Server ("MSA") [<a href="rfc4409.html" title='"Message Submission for Mail"'>RFC4409</a>], it MAY, consistent with the general
       provisions for changes by such servers, rewrite the envelope,
       headers, or message material to make them entirely ASCII and
       consistent with the provisions of <a href="rfc2821.html">RFC 2821</a> [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] and <a href="rfc2822.html">RFC 2822</a>
       [<a href="rfc2822.html" title='"Internet Message Format"'>RFC2822</a>].

   2.  It may either reject the message during the SMTP transaction or
       accept the message and then generate and transmit a notification
       of non-deliverability.  Such notification MUST be done as
       specified in <a href="rfc2821.html">RFC 2821</a> [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>], <a href="rfc3464.html">RFC 3464</a> [<a href="rfc3464.html" title='"An Extensible Message Format for Delivery Status Notifications"'>RFC3464</a>], and the EAI
       delivery status notification (DSN) specification [<a href="rfc5337.html" title='"Internationalized Delivery Status and Disposition Notifications"'>RFC5337</a>].

   3.  It may find an alternate route to the destination that permits
       UTF8SMTP.  That route may be discovered by trying alternate Mail
       eXchanger (MX) hosts (using preference rules as specified in <a href="rfc2821.html">RFC</a>
       <a href="rfc2821.html">2821</a>) or using other means available to the SMTP-sender.

   4.  If and only if ASCII addresses are available for all addresses
       that appear in the return path and the specific forward paths
       being attempted, it may downgrade the message to an all-ASCII



<span class="grey">Yao &amp; Mao                     Experimental                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


       form as specified in [<a href="#ref-Downgrade" title='"Downgrading mechanism for Email Address Internationalization"'>Downgrade</a>].  An ASCII address is considered
       to be "available" for a particular address if the original
       address in the envelope is in ASCII or if an ALT-ADDRESS
       parameter is specified for a UTF8SMTP address.

   The difference between choice 1 and choice 4 is that choice 1 is
   constrained by Message Submission [<a href="rfc4409.html" title='"Message Submission for Mail"'>RFC4409</a>], while choice 4 is
   constrained by [<a href="#ref-Downgrade" title='"Downgrading mechanism for Email Address Internationalization"'>Downgrade</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Extended%20Mailbox%20Address%20Syntax"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Extended Mailbox Address Syntax</span>

   <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>, defines the syntax of a mailbox entirely in
   terms of ASCII characters, using the production for a mailbox and
   those productions on which it depends.

   The key changes made by this specification are, informally, to

   o  Change the definition of "sub-domain" to permit either the
      definition above or a UTF-8 string representing a DNS label that
      is conformant with IDNA [<a href="rfc3490.html" title='"Internationalizing Domain Names in Applications (IDNA)"'>RFC3490</a>].

   o  Change the definition of "Atom" to permit either the definition
      above or a UTF-8 string.  That string MUST NOT contain any of the
      ASCII characters (either graphics or controls) that are not
      permitted in "atext"; it is otherwise unrestricted.

   According to the description above, the syntax of an
   internationalized email mailbox name (address) is defined in ABNF
   [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] as follows.






















<span class="grey">Yao &amp; Mao                     Experimental                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


           uMailbox = uLocal-part "@" uDomain
             ; Replace Mailbox in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           uLocal-part = uDot-string / uQuoted-string
             ; MAY be case-sensitive
             ; Replace Local-part in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           uDot-string = uAtom *("." uAtom)
             ; Replace Dot-string in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           uAtom = 1*ucharacter
                 ; Replace Atom in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           ucharacter = atext / UTF8-non-ascii

           atext = &lt;See <a href="rfc2822.html#section-3.2.4">Section 3.2.4 of RFC 2822</a>&gt;

           uQuoted-string = DQUOTE *uqcontent DQUOTE
             ; Replace Quoted-string in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           DQUOTE = &lt;See <a href="rfc5234.html#appendix-B.1">appendix B.1 of RFC 5234</a>&gt;

           uqcontent = qcontent / UTF8-non-ascii

           qcontent = &lt;See <a href="rfc2822.html#section-3.2.5">Section 3.2.5 of RFC 2822</a>&gt;

           uDomain = (sub-udomain 1*("." sub-udomain)) / address-literal
             ; Replace Domain in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           address-literal = &lt;See <a href="rfc2822.html#section-4.1.2">Section 4.1.2 of RFC 2822</a>&gt;

           sub-udomain = uLet-dig [uLdh-str]
             ; Replace sub-domain in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>

           uLet-dig = Let-dig / UTF8-non-ascii

           Let-dig = &lt;See <a href="rfc2821.html#section-4.1.3">Section 4.1.3 of RFC 2821</a>&gt;

           uLdh-str = *( ALPHA / DIGIT / "-" / UTF8-non-ascii) uLet-dig
             ; Replace Ldh-str in <a href="rfc2821.html#section-4.1.3">RFC 2821, Section 4.1.3</a>

           UTF8-non-ascii = UTF8-2 / UTF8-3 / UTF8-4

           UTF8-2 =  &lt;See <a href="rfc3629.html#section-4">Section 4 of RFC 3629</a>&gt;

           UTF8-3 =  &lt;See <a href="rfc3629.html#section-4">Section 4 of RFC 3629</a>&gt;

           UTF8-4 =  &lt;See <a href="rfc3629.html#section-4">Section 4 of RFC 3629</a>&gt;



<span class="grey">Yao &amp; Mao                     Experimental                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   The value of "uDomain" SHOULD be verified by applying the tests
   specified as part of IDNA [<a href="rfc3490.html" title='"Internationalizing Domain Names in Applications (IDNA)"'>RFC3490</a>].  If that verification fails, the
   email address with that uDomain MUST NOT be regarded as a valid email
   address.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20The%20ALT-ADDRESS%20Parameter"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  The ALT-ADDRESS Parameter</span>

   If the UTF8SMTP extension is offered, the syntax of the SMTP MAIL and
   RCPT commands is extended to support the optional esmtp-keyword "ALT-
   ADDRESS".  That keyword specifies an alternate all-ASCII address that
   may be used when downgrading.  If the ALT-ADDRESS esmtp-keyword is
   used, it MUST have an associated esmtp-value (ALT-ADDRESS-esmtp-
   value, which is defined below).

   While it may be tempting to consider ALT-ADDRESS as a general-purpose
   second-chance address, such behavior is not defined here.  Instead,
   in this specification ALT-ADDRESS only has meaning when the
   associated primary address is non-ASCII and the message is
   downgraded.  This restriction allows for future extension of the
   specification even though no such extensions are currently
   anticipated.

   Based on the definition of mail-parameters in [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>], the ALT-
   ADDRESS parameter usage in the commands of MAIL and RCPT is defined
   as follows.  The following definitions are given in the same format
   as used in <a href="rfc2821.html">RFC 2821</a>.

        "MAIL FROM:" ("&lt;&gt;" / uReverse-path) [ SP Mail-parameters ] CRLF
           ; Update the MAIL command in <a href="rfc2821.html#section-4.1.1.2">RFC 2821, Section 4.1.1.2</a>.
           ; A new parameter defined by the ABNF non-terminal
           ; &lt;ALT-ADDRESS-parameter&gt; is added.  It complies
           ; with the syntax specified for &lt;esmtp-param&gt; in <a href="rfc2821.html">RFC 2821</a>.

        "RCPT TO:" ("&lt;Postmaster@" uDomain "&gt;" / "&lt;Postmaster&gt;" /
              uForward-path) [ SP Rcpt-parameters ] CRLF
               ; Update RCPT command in <a href="rfc2821.html#section-4.1.1.3">RFC 2821, Section 4.1.1.3</a>.
               ; A new parameter defined by the ABNF non-terminal
               ; &lt;ALT-ADDRESS-parameter&gt; is added.  It complies
               ; with the syntax specified for &lt;esmtp-param&gt;.
               ; uDomain is defined in <a href="#section-3.3">Section 3.3</a> of this document.

        uReverse-path = uPath
           ; Replace Reverse-path in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>.

        uForward-path = uPath
           ; Replace Forward-path in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>.





<span class="grey">Yao &amp; Mao                     Experimental                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


        uPath = "&lt;" [ A-d-l ":" ] uMailbox "&gt;"
           ; Replace Path in <a href="rfc2821.html#section-4.1.2">RFC 2821, Section 4.1.2</a>.
           ; uMailbox is defined in <a href="#section-3.3">Section 3.3</a> of this document.

        A-d-l = &lt;See <a href="rfc2821.html#section-4.1.2">Section 4.1.2 of RFC 2821</a>&gt;

        ALT-ADDRESS-parameter = "ALT-ADDRESS=" ALT-ADDRESS-value

        ALT-ADDRESS-value = xtext
               ; The value is a mailbox name encoded as xtext.

        xtext = &lt;See <a href="rfc3461.html#section-4.2">Section 4.2 of RFC 3461</a>&gt;

   The ALT-ADDRESS-parameter MUST NOT appear more than once in any MAIL
   or RCPT command.  ALT-ADDRESS-esmtp-value MUST be an all-ASCII email
   address before xtext encoding.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20%20ALT-ADDRESS%20Parameter%20Usage%20and%20Response%20Codes"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>.  ALT-ADDRESS Parameter Usage and Response Codes</span>

   An "internationalized message" as defined in the appendix of this
   specification MUST NOT be sent to an SMTP server that does not
   support UTF8SMTP.  Such a message MAY be rejected by a server if it
   lacks ALT-ADDRESSes as discussed in <a href="#section-3.2">Section 3.2</a> of this
   specification.

   The three-digit reply codes used in this section are consistent with
   their meanings as defined in <a href="rfc2821.html">RFC 2821</a>.

   When messages are rejected because the RCPT command requires an ALT-
   ADDRESS, the response code 553 is used with the meaning "mailbox name
   not allowed".  When messages are rejected for other reasons, such as
   the MAIL command requiring an ALT-ADDRESS, the response code 550 is
   used with the meaning "mailbox unavailable".  When the server
   supports enhanced mail system status codes [<a href="rfc3463.html" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], response code
   "X.6.7" [<a href="rfc5248.html" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>] is used, meaning that "The ALT-ADDRESS is required
   but not specified".

   If the response code is issued after the final "." of the DATA
   command, the response code "554" is used with the meaning
   "Transaction failed".  When the server supports enhanced mail system
   status codes [<a href="rfc3463.html" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], response code "X.6.9" [<a href="rfc5248.html" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>] is used,
   meaning that "UTF8SMTP downgrade failed".









<span class="grey">Yao &amp; Mao                     Experimental                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6.%20%20Body%20Parts%20and%20SMTP%20Extensions"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a>.  Body Parts and SMTP Extensions</span>

   There is no ESMTP parameter to assert that a message is an
   internationalized message.  An SMTP server that requires accurate
   knowledge of whether a message is internationalized is required to
   parse all message header fields and MIME header fields in the message
   body.

   While this specification requires that servers support the 8BITMIME
   extension [<a href="rfc1652.html" title='"SMTP Service Extension for 8bit- MIMEtransport"'>RFC1652</a>] to ensure that servers have adequate handling
   capability for 8-bit data and to avoid a number of complex encoding
   problems, the use of internationalized addresses obviously does not
   require non-ASCII body parts in the MIME message.  The UTF8SMTP
   extension MAY be used with the BODY=8BITMIME parameter if that is
   appropriate given the body content or, with the BODY=BINARYMIME
   parameter, if the server advertises BINARYMIME [<a href="rfc3030.html" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>RFC3030</a>] and that is
   appropriate.

   Assuming that the server advertises UTF8SMTP and 8BITMIME, and
   receives at least one non-ASCII address, with or without ALT-ADDRESS,
   the precise interpretation of 'No BODY parameter', "BODY=8BITMIME",
   and "BODY=BINARYMIME" in the MAIL command is:

   1.  If there is no BODY parameter, the header contains UTF-8
       characters, but all the body parts are in ASCII (possibly as the
       result of a content-transfer-encoding).

   2.  If a BODY=8BITMIME parameter is present, the header contains
       UTF-8 characters, and some or all of the body parts contain 8-bit
       line-oriented data.

   3.  If a BODY=BINARYMIME parameter is present, the header contains
       UTF-8 characters, and some or all body parts contain binary data
       without restriction as to line lengths or delimiters.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.7.%20%20Additional%20ESMTP%20Changes%20and%20Clarifications"></a><a class="selflink" href="#section-3.7" name="section-3.7">3.7</a>.  Additional ESMTP Changes and Clarifications</span>

   The information carried in the mail transport process involves
   addresses ("mailboxes") and domain names in various contexts in
   addition to the MAIL and RCPT commands and extended alternatives to
   them.  In general, the rule is that, when <a href="rfc2821.html">RFC 2821</a> specifies a
   mailbox, this specification expects UTF-8 to be used for the entire
   string; when <a href="rfc2821.html">RFC 2821</a> specifies a domain name, the name SHOULD be in
   the form of ACE labels if its raw form is non-ASCII.

   The following subsections list and discuss all of the relevant cases.





<span class="grey">Yao &amp; Mao                     Experimental                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.7.1.%20%20The%20Initial%20SMTP%20Exchange"></a><a class="selflink" href="#section-3.7.1" name="section-3.7.1">3.7.1</a>.  The Initial SMTP Exchange</span>

   When an SMTP connection is opened, the server normally sends a
   "greeting" response consisting of the 220 response code and some
   information.  The client then sends the EHLO command.  Since the
   client cannot know whether the server supports UTF8SMTP until after
   it receives the response from EHLO, any domain names that appear in
   this dialogue, or in responses to EHLO, MUST be in the hostname form,
   i.e., internationalized ones MUST be in the form of ACE labels.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.7.2.%20%20Mail%20eXchangers"></a><a class="selflink" href="#section-3.7.2" name="section-3.7.2">3.7.2</a>.  Mail eXchangers</span>

   Organizations often authorize multiple servers to accept mail
   addressed to them.  For example, the organization may itself operate
   more than one server, and may also or instead have an agreement with
   other organizations to accept mail as a backup.  Authorized servers
   are generally listed in MX records as described in <a href="rfc2821.html">RFC 2821</a>.  When
   more than one server accepts mail for the domain-part of a mailbox,
   it is strongly advised that either all or none of them support the
   UTF8SMTP extension.  Otherwise, surprising downgrades can happen
   during temporary failures, which users might perceive as a serious
   reliability issue.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.7.3.%20%20Trace%20Information"></a><a class="selflink" href="#section-3.7.3" name="section-3.7.3">3.7.3</a>.  Trace Information</span>

   When an SMTP server receives a message for delivery or further
   processing, it MUST insert trace ("time stamp" or "Received")
   information at the beginning of the message content.  "Time stamp" or
   "Received" appears in the form of "Received:" lines.  The most
   important use of Received: lines is for debugging mail faults.  When
   the delivery SMTP server makes the "final delivery" of a message, it
   inserts a Return-path line at the beginning of the mail data.  The
   primary purpose of the Return-path is to designate the address to
   which messages indicating non-delivery or other mail system failures
   are to be sent.  For the trace information, this memo updates the
   time stamp line and the return path line [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] formally defined
   as follows:

      uReturn-path-line = "Return-Path:" FWS uReverse-path &lt;CRLF&gt;
          ; Replaces Return-path-line in <a href="rfc2821.html#section-4.4">Section 4.4 of RFC 2821</a>
          ; uReverse-path is defined in <a href="#section-3.3">Section 3.3</a> of this document

      uTime-stamp-line = "Received:" FWS uStamp &lt;CRLF&gt;
          ; Replaces Time-stamp-line in <a href="rfc2821.html#section-4.4">Section 4.4 of RFC 2821</a>

      uStamp = From-domain By-domain uOpt-info ";"  FWS date-time
          ; Replaces Stamp in <a href="rfc2821.html#section-4.4">Section 4.4 of RFC 2821</a>




<span class="grey">Yao &amp; Mao                     Experimental                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


       uOpt-info = [Via] [With] [ID] [uFor]
          ; Replaces Opt-info in <a href="rfc2821.html#section-4.4">Section 4.4 of RFC 2821</a>
          ; The protocol value for With will allow a UTF8SMTP value

         uFor = "FOR" ( FWS (uPath / uMailbox) ) CFWS
          ; Replaces For in <a href="rfc2821.html#section-4.4">Section 4.4 of RFC 2821</a>
          ; uPath and uMailbox are defined in Sections <a href="#section-2.4">2.4</a> and
          ; 2.3, respectively, of this document

   Note: The FOR parameter has been changed to match the definition in
   [<a href="#ref-RFC2821bis" title='"Simple Mail Transfer Protocol"'>RFC2821bis</a>], permitting only one address in the For clause.  The
   group working on that document reached mailing list consensus that
   the syntax in [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>] that permitted more than one address was
   simply a mistake.

   Except in the 'uFor' clause and 'uReverse-path' value where non-ASCII
   domain names may be used, internationalized domain names in Received
   fields MUST be transmitted in the form of ACE labels.  The protocol
   value of the WITH clause when this extension is used is one of the
   UTF8SMTP values specified in the "IANA Considerations" section of
   this document.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.7.4.%20%20UTF-8%20Strings%20in%20Replies"></a><a class="selflink" href="#section-3.7.4" name="section-3.7.4">3.7.4</a>.  UTF-8 Strings in Replies</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.7.4.1.%20%20MAIL%20and%20RCPT%20Commands"></a><a class="selflink" href="#section-3.7.4.1" name="section-3.7.4.1">3.7.4.1</a>.  MAIL and RCPT Commands</span>

   If the client issues a RCPT command containing non-ASCII characters,
   the SMTP server is permitted to use UTF-8 characters in the email
   address associated with 251 and 551 response codes.

   If an SMTP client follows this specification and sends any RCPT
   commands containing non-ASCII addresses, it MUST be able to accept
   and process 251 or 551 responses containing UTF-8 email addresses.
   If a given RCPT command does not include a non-ASCII envelope
   address, the server MUST NOT return a 251 or 551 response containing
   a non-ASCII mailbox.  Instead, it MUST transform such responses into
   250 or 550 responses that do not contain addresses.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.7.4.2.%20%20VRFY%20and%20EXPN%20Commands%20and%20the%20UTF8REPLY%20Parameter"></a><a class="selflink" href="#section-3.7.4.2" name="section-3.7.4.2">3.7.4.2</a>.  VRFY and EXPN Commands and the UTF8REPLY Parameter</span>

   If the VRFY and EXPN commands are transmitted with an optional
   parameter "UTF8REPLY", it indicates the client can accept UTF-8
   strings in replies from those commands.  This allows the server to
   use UTF-8 strings in mailbox names and full names that occur in
   replies without concern that the client might be confused by them.
   An SMTP client that conforms to this specification MUST accept and
   correctly process replies from the VRFY and EXPN commands that
   contain UTF-8 strings.  However, the SMTP server MUST NOT use UTF-8



<span class="grey">Yao &amp; Mao                     Experimental                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   strings in replies if the SMTP client does not specifically allow
   such replies by transmitting this parameter.  Most replies do not
   require that a mailbox name be included in the returned text, and
   therefore UTF-8 is not needed in them.  Some replies, notably those
   resulting from successful execution of the VRFY and EXPN commands, do
   include the mailbox, making the provisions of this section important.

   VERIFY (VRFY) and EXPAND (EXPN) command syntaxes are changed to:

       "VRFY" SP (uLocal-part / uMailbox) [SP "UTF8REPLY"] CRLF
              ; uLocal-part and uMailbox are defined in
              ; <a href="#section-3.3">Section 3.3</a> of this document.

       "EXPN" SP ( uLocal-part / uMailbox ) [ SP "UTF8REPLY" ] CRLF
              ; uLocal-part and uMailbox are defined in
              ; <a href="#section-3.3">Section 3.3</a> of this document.

   The "UTF8REPLY" parameter does not use a value.  If the reply to a
   VERIFY (VRFY) or EXPAND (EXPN) command requires UTF-8, but the SMTP
   client does not use the "UTF8REPLY" parameter, then the server MUST
   use either the response code 252 or 550.  Response code 252, defined
   in [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>], means "Cannot VRFY user, but will accept the message
   and attempt the delivery".  Response code 550, also defined in
   [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>], means "Requested action not taken: mailbox unavailable".
   When the server supports enhanced mail system status codes [<a href="rfc3463.html" title='"Enhanced Mail System Status Codes"'>RFC3463</a>],
   the enhanced response code as specified below is used.  Using the
   "UTF8REPLY" parameter with a VERIFY (VRFY) or EXPAND (EXPN) command
   enables UTF-8 replies for that command only.

   If a normal success response (i.e., 250) is returned, the response
   MAY include the full name of the user and MUST include the mailbox of
   the user.  It MUST be in either of the following forms:

         User Name &lt;uMailbox&gt;
            ; uMailbox is defined in <a href="#section-3.3">Section 3.3</a> of this document.
            ; User Name can contain non-ASCII characters.

         uMailbox
            ; uMailbox is defined in <a href="#section-3.3">Section 3.3</a> of this document.

   If the SMTP reply requires UTF-8 strings, but UTF-8 is not allowed in
   the reply, and the server supports enhanced mail system status codes
   [<a href="rfc3463.html" title='"Enhanced Mail System Status Codes"'>RFC3463</a>], the enhanced response code is either "X.6.8" or "X.6.10"
   [<a href="rfc5248.html" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>], meaning "A reply containing a UTF-8 string is required to
   show the mailbox name, but that form of response is not permitted by
   the client".





<span class="grey">Yao &amp; Mao                     Experimental                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   If the SMTP client does not support the UTF8SMTP extension, but
   receives a UTF-8 string in a reply, it may not be able to properly
   report the reply to the user, and some clients might crash.
   Internationalized messages in replies are only allowed in the
   commands under the situations described above.  Under any other
   circumstances, UTF-8 text MUST NOT appear in the reply.

   Although UTF-8 is needed to represent email addresses in responses
   under the rules specified in this section, this extension does not
   permit the use of UTF-8 for any other purposes.  SMTP servers MUST
   NOT include non-ASCII characters in replies except in the limited
   cases specifically permitted in this section.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  IANA Considerations</span>

   IANA has added a new value "UTF8SMTP" to the SMTP Service Extension
   subregistry of the Mail Parameters registry, according to the
   following data:

        +----------+---------------------------------+-----------+
        | Keywords | Description                     | Reference |
        +----------+---------------------------------+-----------+
        | UTF8SMTP | Internationalized email address | [<a href="rfc5336.html">RFC5336</a>] |
        +----------+---------------------------------+-----------+

   This document adds new values to the SMTP Enhanced Status Code
   subregistry of the Mail Parameters registry, following the guidance
   in Sections <a href="#section-3.5">3.5</a> and <a href="#section-3.7.4.2">3.7.4.2</a> of this document, and being based on
   [<a href="rfc5248.html" title='"A Registry for SMTP Enhanced Mail System Status Codes"'>RFC5248</a>].  The registration data is as follows:






















<span class="grey">Yao &amp; Mao                     Experimental                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


      Code:               X.6.7
      Sample Text:        The ALT-ADDRESS is required but not specified
      Associated basic status code:  553, 550
      Description:        This indicates the reception of a MAIL or RCPT
                          command that required an ALT-ADDRESS parameter
                          but such parameter was not present.
      Defined:            <a href="rfc5336.html">RFC 5336</a>  (Experimental track)
      Submitter:          Jiankang YAO
      Change controller:  IESG.


      Code:               X.6.8
      Sample Text:        UTF-8 string reply is required,
                          but not permitted by the client
      Associated basic status code:  553, 550
      Description:        This indicates that a reply containing a UTF-8
                          string is required to show the mailbox name,
                          but that form of response is not
                          permitted by the client.
      Defined:            RFC  5336.  (Experimental track)
      Submitter:          Jiankang YAO
      Change controller:  IESG.


       Code:               X.6.9
       Sample Text:        UTF8SMTP downgrade failed
       Associated basic status code:  550
       Description:        This indicates that transaction failed
                           after the final "." of the DATA command.
       Defined:            RFC  5336.  (Experimental track)
       Submitter:          Jiankang YAO
       Change controller:  IESG.


      Code:               X.6.10
      Sample Text:        UTF-8 string reply is required,
                          but not permitted by the client
      Associated basic status code:  252
      Description:        This indicates that a reply containing a UTF-8
                          string is required to show the mailbox name,
                          but that form of response is not
                          permitted by the client.
      Defined:            <a href="rfc5336.html">RFC 5336</a>.  (Experimental track)
      Submitter:          Jiankang YAO
      Change controller:  IESG.






<span class="grey">Yao &amp; Mao                     Experimental                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   The "Mail Transmission Types" registry under the Mail Parameters
   registry is requested to be updated to include the following new
   entries:

   +---------------+----------------------------+----------------------+
   | WITH protocol | Description                | Reference            |
   | types         |                            |                      |
   +---------------+----------------------------+----------------------+
   | UTF8SMTP      | UTF8SMTP with Service      | [<a href="rfc5336.html">RFC5336</a>]            |
   |               | Extensions                 |                      |
   | UTF8SMTPA     | UTF8SMTP with SMTP AUTH    | [<a href="rfc4954.html" title='"SMTP Service Extension for Authentication"'>RFC4954</a>] [<a href="rfc5336.html">RFC5336</a>]  |
   | UTF8SMTPS     | UTF8SMTP with STARTTLS     | [<a href="rfc3207.html" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="rfc5336.html">RFC5336</a>]  |
   | UTF8SMTPSA    | UTF8SMTP with both         | [<a href="rfc3207.html" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC3207</a>] [<a href="rfc4954.html" title='"SMTP Service Extension for Authentication"'>RFC4954</a>]  |
   |               | STARTTLS and SMTP AUTH     | [<a href="rfc5336.html">RFC5336</a>]            |
   +---------------+----------------------------+----------------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   See the extended security considerations discussion in the framework
   document [<a href="rfc4952.html" title='"Overview and Framework for Internationalized Email"'>RFC4952</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Acknowledgements"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Acknowledgements</span>

   Much of the text in the initial version of this specification was
   derived or copied from [<a href="#ref-Emailaddr" title='"Internationalization of Email Addresses"'>Emailaddr</a>] with the permission of the author.
   Significant comments and suggestions were received from Xiaodong LEE,
   Nai-Wen Hsu, Yangwoo KO, Yoshiro YONEYA, and other members of the JET
   team and were incorporated into the specification.  Additional
   important comments and suggestions, and often specific text, were
   contributed by many members of the WG and design team.  Those
   contributions include material from John C Klensin, Charles Lindsey,
   Dave Crocker, Harald Tveit Alvestrand, Marcos Sanz, Chris Newman,
   Martin Duerst, Edmon Chung, Tony Finch, Kari Hurtta, Randall Gellens,
   Frank Ellermann, Alexey Melnikov, Pete Resnick, S. Moonesamy, Soobok
   Lee, Shawn Steele, Alfred Hoenes, Miguel Garcia, Magnus Westerlund,
   and Lars Eggert.  Of course, none of the individuals are necessarily
   responsible for the combination of ideas represented here.














<span class="grey">Yao &amp; Mao                     Experimental                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20References"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Normative%20References"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-ASCII" name="ref-ASCII">ASCII</a>]       American National Standards Institute (formerly United
                 States of America Standards Institute), "USA Code for
                 Information Interchange", ANSI X3.4-1968, 1968.

   [<a id="ref-RFC1652" name="ref-RFC1652">RFC1652</a>]     Klensin, J., Freed, N., Rose, M., Stefferud, E., and D.
                 Crocker, "SMTP Service Extension for 8bit-
                 MIMEtransport", <a href="rfc1652.html">RFC 1652</a>, July 1994.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                 Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2821" name="ref-RFC2821">RFC2821</a>]     Klensin, J., "Simple Mail Transfer Protocol", <a href="rfc2821.html">RFC 2821</a>,
                 April 2001.

   [<a id="ref-RFC2822" name="ref-RFC2822">RFC2822</a>]     Resnick, P., "Internet Message Format", <a href="rfc2822.html">RFC 2822</a>,
                 April 2001.

   [<a id="ref-RFC3461" name="ref-RFC3461">RFC3461</a>]     Moore, K., "Simple Mail Transfer Protocol (SMTP)
                 Service Extension for Delivery Status Notifications
                 (DSNs)", <a href="rfc3461.html">RFC 3461</a>, January 2003.

   [<a id="ref-RFC3463" name="ref-RFC3463">RFC3463</a>]     Vaudreuil, G., "Enhanced Mail System Status Codes",
                 <a href="rfc3463.html">RFC 3463</a>, January 2003.

   [<a id="ref-RFC3464" name="ref-RFC3464">RFC3464</a>]     Moore, K. and G. Vaudreuil, "An Extensible Message
                 Format for Delivery Status Notifications", <a href="rfc3464.html">RFC 3464</a>,
                 January 2003.

   [<a id="ref-RFC3490" name="ref-RFC3490">RFC3490</a>]     Faltstrom, P., Hoffman, P., and A. Costello,
                 "Internationalizing Domain Names in Applications
                 (IDNA)", <a href="rfc3490.html">RFC 3490</a>, March 2003.

   [<a id="ref-RFC3629" name="ref-RFC3629">RFC3629</a>]     Yergeau, F., "UTF-8, a transformation format of ISO
                 10646", STD 63, <a href="rfc3629.html">RFC 3629</a>, November 2003.

   [<a id="ref-RFC4409" name="ref-RFC4409">RFC4409</a>]     Gellens, R. and J. Klensin, "Message Submission for
                 Mail", <a href="rfc4409.html">RFC 4409</a>, April 2006.

   [<a id="ref-RFC4952" name="ref-RFC4952">RFC4952</a>]     Klensin, J. and Y. Ko, "Overview and Framework for
                 Internationalized Email", <a href="rfc4952.html">RFC 4952</a>, July 2007.

   [<a id="ref-RFC5234" name="ref-RFC5234">RFC5234</a>]     Crocker, D. and P. Overell, "Augmented BNF for Syntax
                 Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>, January 2008.




<span class="grey">Yao &amp; Mao                     Experimental                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   [<a id="ref-RFC5248" name="ref-RFC5248">RFC5248</a>]     Hansen, T. and J. Klensin, "A Registry for SMTP
                 Enhanced Mail System Status Codes", <a href="https://tools.ietf.org/html/bcp138">BCP 138</a>, <a href="rfc5248.html">RFC 5248</a>,
                 June 2008.

   [<a id="ref-RFC5335" name="ref-RFC5335">RFC5335</a>]     Abel, Y., Ed., "Internationalized Email Headers",
                 <a href="rfc5335.html">RFC 5335</a>, September 2008.

   [<a id="ref-RFC5337" name="ref-RFC5337">RFC5337</a>]     Newman, C. and A. Melnikov, Ed., "Internationalized
                 Delivery Status and Disposition Notifications",
                 <a href="rfc5337.html">RFC 5337</a>, September 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Informative%20References"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-Downgrade" name="ref-Downgrade">Downgrade</a>]   Fujiwara, K. and Y. Yoneya, "Downgrading mechanism for
                 Email Address Internationalization", Work in Progress,
                 July 2008.

   [<a id="ref-Emailaddr" name="ref-Emailaddr">Emailaddr</a>]   Klensin, J., <a href="https://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22Internationalization+of+Email+Addresses%22" style="text-decoration: none">"Internationalization of Email Addresses"</a>,
                 Work in Progress, July 2005.

   [<a id="ref-RFC0974" name="ref-RFC0974">RFC0974</a>]     Partridge, C., "Mail routing and the domain system",
                 <a href="rfc974.html">RFC 974</a>, January 1986.

   [<a id="ref-RFC2033" name="ref-RFC2033">RFC2033</a>]     Myers, J., "Local Mail Transfer Protocol", <a href="rfc2033.html">RFC 2033</a>,
                 October 1996.

   [<a id="ref-RFC2821bis" name="ref-RFC2821bis">RFC2821bis</a>]  Klensin, J., <a href="https://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22Simple+Mail+Transfer+Protocol%22" style="text-decoration: none">"Simple Mail Transfer Protocol"</a>, Work
                 in Progress, July 2008.

   [<a id="ref-RFC3030" name="ref-RFC3030">RFC3030</a>]     Vaudreuil, G., "SMTP Service Extensions for
                 Transmission of Large and Binary MIME Messages",
                 <a href="rfc3030.html">RFC 3030</a>, December 2000.

   [<a id="ref-RFC3207" name="ref-RFC3207">RFC3207</a>]     Hoffman, P., "SMTP Service Extension for Secure SMTP
                 over Transport Layer Security", <a href="rfc3207.html">RFC 3207</a>,
                 February 2002.

   [<a id="ref-RFC4954" name="ref-RFC4954">RFC4954</a>]     Siemborski, R., Ed. and A. Melnikov, Ed., "SMTP Service
                 Extension for Authentication", <a href="rfc4954.html">RFC 4954</a>, July 2007.












<span class="grey">Yao &amp; Mao                     Experimental                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Material%20Updating%20RFC%204952"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Material Updating <a href="rfc4952.html">RFC 4952</a></span>

   <a href="rfc4952.html">RFC 4952</a>, the overview and framework document covering this set of
   extensions for internationalized email, was completed before this
   specification, which specifies a particular part of the protocol set.
   This appendix, which is normative, contains material that would have
   been incorporated into <a href="rfc4952.html">RFC 4952</a> had it been delayed until the work
   described in the rest of this specification was completed.  This
   material should be included in any update to <a href="rfc4952.html">RFC 4952</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Conventional%20Message%20and%20Internationalized%20Message"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Conventional Message and Internationalized Message</span>

   o  A conventional message is one that does not use any extension
      defined in this document or in the UTF-8 header specification
      [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>], and which is strictly conformant to <a href="rfc2822.html">RFC 2822</a> [<a href="rfc2822.html" title='"Internet Message Format"'>RFC2822</a>].

   o  An internationalized message is a message utilizing one or more of
      the extensions defined in this specification or in the UTF-8
      header specification [<a href="rfc5335.html" title='"Internationalized Email Headers"'>RFC5335</a>], so that it is no longer conformant
      to the <a href="rfc2822.html">RFC 2822</a> specification of a message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20LMTP"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  LMTP</span>

   LMTP [<a href="rfc2033.html" title='"Local Mail Transfer Protocol"'>RFC2033</a>] may be used as the final delivery agent.  In such
   cases, LMTP may be arranged to deliver the mail to the mail store.
   The mail store may not have UTF8SMTP capability.  LMTP needs to be
   updated to deal with these situations.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20SMTP%20Service%20Extension%20for%20DSNs"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  SMTP Service Extension for DSNs</span>

   The existing Draft Standard regarding delivery status notifications
   (DSNs) [<a href="rfc3461.html" title='"Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)"'>RFC3461</a>] is limited to ASCII text in the machine readable
   portions of the protocol.  "International Delivery Status and
   Disposition Notifications" [<a href="rfc5337.html" title='"Internationalized Delivery Status and Disposition Notifications"'>RFC5337</a>] adds a new address type for
   international email addresses so an original recipient address with
   non-ASCII characters can be correctly preserved even after
   downgrading.  If an SMTP server advertises both the UTF8SMTP and the
   DSN extension, that server MUST implement EAI DSN [<a href="rfc5337.html" title='"Internationalized Delivery Status and Disposition Notifications"'>RFC5337</a>] including
   support for the ORCPT parameter.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.4.%20%20Implementation%20Advice"></a><a class="selflink" href="#appendix-A.4" name="appendix-A.4">A.4</a>.  Implementation Advice</span>

   In the absence of this extension, SMTP clients and servers are
   constrained to using only those addresses permitted by <a href="rfc2821.html">RFC 2821</a>.  The
   local parts of those addresses MAY be made up of any ASCII
   characters, although some of them MUST be quoted as specified there.
   It is notable in an internationalization context that there is a long
   history on some systems of using overstruck ASCII characters (a



<span class="grey">Yao &amp; Mao                     Experimental                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


   character, a backspace, and another character) within a quoted string
   to approximate non-ASCII characters.  This form of
   internationalization SHOULD be phased out as this extension becomes
   widely deployed, but backward-compatibility considerations require
   that it continue to be supported.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.5.%20%20Applicability%20of%20SMTP%20Extension%20to%20Additional%20Uses"></a><a class="selflink" href="#appendix-A.5" name="appendix-A.5">A.5</a>.  Applicability of SMTP Extension to Additional Uses</span>

   Among other protocol changes, the SMTP extension allows an optional
   alternate address to be supplied with the MAIL and RCPT commands.
   For the purposes of this set of specifications, this alternate
   address only has meaning when the primary address contains UTF-8
   characters and the message is downgraded.  While it may be tempting
   to consider the alternate address as a general-purpose second-chance
   address to be used whenever the primary address is rejected, such
   behavior is not defined here.  This restriction allows for future
   extensions to be developed which create such a general-purpose
   second-chance address, although no specific work on such an extension
   is currently anticipated.  Note that any such extension needs to
   consider the question of what the [<a href="https://tools.ietf.org/html/rfc0974" title='"Mail routing and the domain system"'>RFC0974</a>] sequencing rules mean
   when different possible servers support different sets of ESMTP
   options (or, in this case, addresses).  The answer to this question
   may also imply updates to [<a href="rfc2821.html" title='"Simple Mail Transfer Protocol"'>RFC2821</a>].

Authors' Addresses

   Jiankang YAO (editor)
   CNNIC
   No.4 South 4th Street, Zhongguancun
   Beijing

   Phone: +86 10 58813007
   EMail: yaojk@cnnic.cn


   Wei MAO (editor)
   CNNIC
   No.4 South 4th Street, Zhongguancun
   Beijing

   Phone: +86 10 58812230
   EMail: maowei_ietf@cnnic.cn









<span class="grey">Yao &amp; Mao                     Experimental                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5336.html">RFC 5336</a>                   EAI SMTP Extension             September 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Yao &amp; Mao                     Experimental                     [Page 22]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5336 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --></html>