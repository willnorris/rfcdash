<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc8163 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:17 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-ietf-6man-6lobac" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:8163" name="DC.Identifier"/>
<meta content="May, 2017" name="DC.Date.Issued"/>
<meta content="Lynn, Kerry" name="DC.Creator"/>
<meta content="Neilson, Carl" name="DC.Creator"/>
<meta content="&gt;, Jerry Martocci &lt;jpmartocci@sbcglobal.net" name="DC.Creator"/>
<meta content="Donaldson, Stuart" name="DC.Creator"/>
<meta content="Master-Slave/Token-Passing (MS/TP) is a medium access control method
for the RS-485 physical layer and is used primarily in building
automation networks. This specification defines the frame format for
transmission of IPv6 packets and the method of forming link-local and
statelessly autoconfigured IPv6 addresses on MS/TP networks." name="DC.Description.Abstract"/>
<meta content="Transmission of IPv6 over Master-Slave/Token-Passing (MS/TP) Networks" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 8163 - Transmission of IPv6 over Master-Slave/Token-Passing (MS/TP) Networks</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc8163.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc8163" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-6lo-6lobac" title="draft-ietf-6lo-6lobac">draft-ietf-6lo-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc8163" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc8163" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc8163" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                      K. Lynn, Ed.
Request for Comments: 8163                                  Verizon Labs
Category: Standards Track                                    J. Martocci
ISSN: 2070-1721                                         Johnson Controls
                                                              C. Neilson
                                                          Delta Controls
                                                            S. Donaldson
                                                               Honeywell
                                                                May 2017


 <span class="h1">Transmission of IPv6 over Master-Slave/Token-Passing (MS/TP) Networks</span>

Abstract

   Master-Slave/Token-Passing (MS/TP) is a medium access control method
   for the RS-485 physical layer and is used primarily in building
   automation networks.  This specification defines the frame format for
   transmission of IPv6 packets and the method of forming link-local and
   statelessly autoconfigured IPv6 addresses on MS/TP networks.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc8163">http://www.rfc-editor.org/info/rfc8163</a>.

















<span class="grey">Lynn, et al.                 Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Profile for IPv6 over MS/TP . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-3">3</a>.  Addressing Modes  . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-4">4</a>.  Maximum Transmission Unit (MTU) . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-5">5</a>.  LoBAC Adaptation Layer  . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Stateless Address Autoconfiguration . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-7">7</a>.  IPv6 Link-Local Address . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-8">8</a>.  Unicast Address Mapping . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-9">9</a>.  Multicast Address Mapping . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-10">10</a>. Header Compression  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-11">11</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-12">12</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-13">13</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>.  Abstract MAC Interface . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#appendix-B">Appendix B</a>.  Consistent Overhead Byte Stuffing (COBS) . . . . . .  <a href="#page-17">17</a>
   <a href="#appendix-C">Appendix C</a>.  Encoded CRC-32K (CRC32K) . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#appendix-D">Appendix D</a>.  Example 6LoBAC Frame Decode  . . . . . . . . . . . .  <a href="#page-22">22</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>















<span class="grey">Lynn, et al.                 Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Master-Slave/Token-Passing (MS/TP) is a Medium Access Control (MAC)
   protocol for the RS-485 [<a href="#ref-TIA-485-A">TIA-485-A</a>] physical layer and is used
   primarily in building automation networks.  This specification
   defines the frame format for transmission of IPv6 [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>] packets
   and the method of forming link-local and statelessly autoconfigured
   IPv6 addresses on MS/TP networks.  The general approach is to adapt
   elements of the 6LoWPAN specifications ([<a href="rfc4944.html" title='"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"'>RFC4944</a>], [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>], and
   [<a href="rfc6775.html" title='"Neighbor Discovery Optimization for IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs)"'>RFC6775</a>]) to constrained wired networks, as noted below.

   An MS/TP device is typically based on a low-cost microcontroller with
   limited processing power and memory.  These constraints, together
   with low data rates and a small MAC address space, are similar to
   those faced in 6LoWPAN networks.  MS/TP differs significantly from
   6LoWPAN in at least three respects: a) MS/TP devices are typically
   mains powered, b) all MS/TP devices on a segment can communicate
   directly so there are no hidden node or mesh routing issues, and c)
   the latest MS/TP specification provides support for large payloads,
   eliminating the need for fragmentation and reassembly below IPv6.

   The following sections provide a brief overview of MS/TP and then
   describe how to form IPv6 addresses and encapsulate IPv6 packets in
   MS/TP frames.  This specification (subsequently referred to as
   "6LoBAC") includes a REQUIRED header compression mechanism that is
   based on LOWPAN_IPHC [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>] and improves MS/TP link utilization.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Abbreviations%20Used"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Abbreviations Used</span>

   ASHRAE:  American Society of Heating, Refrigerating, and Air-
            Conditioning Engineers &lt;<a href="http://www.ashrae.org/">http://www.ashrae.org</a>&gt;

   BACnet:  An ISO/ANSI/ASHRAE Standard Data Communication Protocol for
            Building Automation and Control Networks

   CRC:     Cyclic Redundancy Code

   MAC:     Medium Access Control

   MSDU:    MAC Service Data Unit (MAC client data)





<span class="grey">Lynn, et al.                 Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   MTU:     Maximum Transmission Unit; the size of the largest data unit
            at the network-layer protocol that can be communicated in a
            single network transaction

   UART:    Universal Asynchronous Transmitter/Receiver

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20MS%2FTP%20Overview"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  MS/TP Overview</span>

   This section provides a brief overview of MS/TP, as specified in
   Clause 9 of the ANSI/ASHRAE Standard 135-2016 [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>].  The latest
   version of [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>] integrates changes to legacy MS/TP (approved as
   [<a href="#ref-Addendum_an">Addendum_an</a>]) that provide support for larger frame sizes and
   improved error handling.  [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 also covers physical-
   layer deployment options.

   MS/TP is designed to enable multidrop networks over shielded twisted
   pair wiring.  It can support network segments up to 1000 meters in
   length at a data rate of 115.2 kbit/s or segments up to 1200 meters
   in length at lower bit rates.  An MS/TP interface requires only a
   UART, an RS-485 [<a href="#ref-TIA-485-A">TIA-485-A</a>] transceiver with a driver that can be
   disabled, and a 5 ms resolution timer.  The MS/TP MAC is typically
   implemented in software.

   The differential signaling used by [<a href="#ref-TIA-485-A">TIA-485-A</a>] requires a contention-
   free MAC.  MS/TP uses a token to control access to a multidrop bus.
   Only an MS/TP master node can initiate the unsolicited transfer of
   data, and only when it holds the token.  After sending at most a
   configured maximum number of data frames, a master node passes the
   token to the next master node (as determined by the MAC address).  If
   present on the link, legacy MS/TP implementations (including any
   slave nodes) ignore the frame format defined in this specification.

   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 defines a range of Frame Type values used to
   designate frames that contain Data and Data CRC fields encoded using
   Consistent Overhead Byte Stuffing [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>] (see <a href="#appendix-B">Appendix B</a>).  The
   purpose of COBS encoding is to eliminate preamble sequences from the
   Encoded Data and Encoded CRC-32K fields.  The Encoded Data field is
   covered by a 32-bit CRC [<a href="#ref-CRC32K" title='"32-Bit Cyclic Redundancy Codes for Internet Applications"'>CRC32K</a>] (see <a href="#appendix-C">Appendix C</a>) that is also COBS
   encoded.












<span class="grey">Lynn, et al.                 Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   MS/TP COBS-encoded frames have the following format:

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      0x55     |      0xFF     |  Frame Type   |      DA       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      SA       |    Length (MS octet first)    |   Header CRC  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                Encoded Data (2 - 1506 octets)                 .
   .                                                               .
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |  Encoded CRC-32K (5 octets)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +-+-+-+-+-+-+-+-+
   |                                               | optional 0xFF |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 1: MS/TP COBS-Encoded Frame Format

   MS/TP COBS-encoded frame fields are defined as follows:

    Preamble              two octet preamble: 0x55, 0xFF
    Frame Type            one octet
    Destination Address   one octet address
    Source Address        one octet address
    Length                two octets, most significant octet first
    Header CRC            one octet
    Encoded Data          2 - 1506 octets (see <a href="#section-4">Section 4</a> and <a href="#appendix-B">Appendix B</a>)
    Encoded CRC-32K       five octets (see <a href="#appendix-C">Appendix C</a>)
    (pad)                 (optional) at most one octet of trailer: 0xFF

   The Frame Type is used to distinguish between different types of MAC
   frames.  The types relevant to this specification (in decimal) are:

      0  Token
      1  Poll For Master
      2  Reply To Poll For Master
      3  Test_Request
      4  Test_Response
         ...
     34  IPv6 over MS/TP (LoBAC) Encapsulation

   Frame Types 8 - 31 and 35 - 127 are reserved for assignment by
   ASHRAE.  Frame Types 32 - 127 designate COBS-encoded frames that
   convey Encoded Data and Encoded CRC-32K fields.  See <a href="#section-2">Section 2</a> for
   additional details.




<span class="grey">Lynn, et al.                 Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   The Destination and Source Addresses are each one octet in length.
   See <a href="#section-3">Section 3</a> for additional details.

   For COBS-encoded frames, the Length field indicates the size of the
   [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>] Encoded Data field in octets, plus three.  (This adjustment is
   required in order for legacy MS/TP devices to ignore COBS-encoded
   frames.)  See <a href="#section-4">Section 4</a> and the Appendices for additional details.

   The Header CRC field covers the Frame Type, Destination Address,
   Source Address, and Length fields.  The Header CRC generation and
   check procedures are specified in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Annex G.1.

   Use of the optional 0xFF trailer octet is discussed in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>],
   Clause 9.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4.%20%20Goals%20and%20Constraints"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a>.  Goals and Constraints</span>

   The main goals of this specification are a) to enable IPv6 directly
   on wired end devices in building automation and control networks by
   leveraging existing standards to the greatest extent possible, and b)
   to co-exist with legacy MS/TP implementations.  Co-existence allows
   MS/TP networks to be incrementally upgraded to support IPv6.

   In order to co-exist with legacy devices, no changes are permitted to
   the MS/TP addressing modes, frame header format, control frames, or
   Master Node state machine as specified in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Profile%20for%20IPv6%20over%20MS%2FTP"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Profile for IPv6 over MS/TP</span>

   ASHRAE has assigned an MS/TP Frame Type value of 34 to indicate IPv6
   over MS/TP (LoBAC) Encapsulation.  This falls within the range of
   values that designate COBS-encoded data frames.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Mandatory%20Features"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Mandatory Features</span>

   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 specifies mandatory-to-implement features of MS/TP
   devices.  For example, it is mandatory that all MS/TP nodes respond
   to a Test_Request with a Test_Response frame.  All MS/TP master nodes
   must implement the Master Node state machine and handle Token, Poll
   For Master, and Reply To Poll For Master control frames.  6LoBAC
   nodes are MS/TP master nodes that implement a Receive Frame state
   machine capable of handling COBS-encoded frames.

   6LoBAC nodes must support a data rate of 115.2 kbit/s and may support
   lower data rates as specified in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9.  The method of
   selecting the data rate is outside the scope of this specification.





<span class="grey">Lynn, et al.                 Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Configuration%20Constants"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Configuration Constants</span>

   The following constants are used by the Receive Frame state machine.

   Nmin_COBS_length  The minimum valid Length value of any LoBAC-
                     encapsulated frame: 5

   Nmax_COBS_length  The maximum valid Length value of any LoBAC-
                     encapsulated frame: 1509

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Configuration%20Parameters"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Configuration Parameters</span>

   The following parameters are used by the Master Node state machine.

   Nmax_info_frames  The default maximum number of information frames
                     the node may send before it must pass the token: 1

   Nmax_master       The default highest allowable address for master
                     nodes: 127

   The mechanisms for setting parameters or monitoring MS/TP performance
   are outside the scope of this specification.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Addressing%20Modes"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Addressing Modes</span>

   MS/TP node (MAC) addresses are one octet in length and are assigned
   dynamically.  The method of assigning MAC addresses is outside the
   scope of this specification.  However, each MS/TP node on the link
   MUST have a unique address in order to ensure correct MAC operation.

   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 specifies that addresses 0 through 127 are valid
   for master nodes.  The method specified in <a href="#section-6">Section 6</a> for creating a
   MAC-address-derived Interface Identifier (IID) ensures that an IID of
   all zeros can never be generated.

   A Destination Address of 255 (all nodes) indicates a MAC-layer
   broadcast.  MS/TP does not support multicast; therefore, all IPv6
   multicast packets MUST be broadcast at the MAC layer and filtered at
   the IPv6 layer.  A Source Address of 255 MUST NOT be used.

   Hosts learn IPv6 prefixes via router advertisements according to
   [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>].









<span class="grey">Lynn, et al.                 Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Maximum%20Transmission%20Unit%20%28MTU%29"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Maximum Transmission Unit (MTU)</span>

   Upon transmission, the network-layer MTU is formatted according to
   <a href="#section-5">Section 5</a> and becomes the MAC service data unit (MSDU).  The MSDU is
   then COBS encoded by MS/TP.  Upon reception, the steps are reversed.
   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 supports MSDUs up to 2032 octets in length.

   IPv6 [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>] requires that every link in an internet have an MTU of
   1280 octets or greater.  Additionally, a node must be able to accept
   a fragmented packet that, after reassembly, is as large as 1500
   octets.  This specification defines an MTU length of at least 1280
   octets and at most 1500 octets.  Support for an MTU length of 1500
   octets is RECOMMENDED.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20LoBAC%20Adaptation%20Layer"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  LoBAC Adaptation Layer</span>

   This section specifies an adaptation layer to support compressed IPv6
   headers as specified in <a href="#section-10">Section 10</a>.  IPv6 header compression MUST be
   implemented on all 6LoBAC nodes.  Implementations MAY also support
   Generic Header Compression [<a href="rfc7400.html" title='"6LoWPAN-GHC: Generic Header Compression for IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs)"'>RFC7400</a>] for transport layer headers.

   The LoBAC encapsulation format defined in this section describes the
   MSDU of an IPv6 over MS/TP frame.  The LoBAC payload (i.e., an IPv6
   packet) follows an encapsulation header stack.  LoBAC is a subset of
   the LoWPAN encapsulation defined in [<a href="rfc4944.html" title='"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"'>RFC4944</a>], as updated by
   [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>], so the use of "LOWPAN" in literals below is intentional.
   The primary difference between LoWPAN and LoBAC encapsulation is
   omission of the Mesh, Broadcast, Fragmentation, and LOWPAN_HC1
   headers in the latter.

   All LoBAC-encapsulated datagrams transmitted over MS/TP are prefixed
   by an encapsulation header stack consisting of a Dispatch value
   followed by zero or more header fields.  The only sequence currently
   defined for LoBAC is the LOWPAN_IPHC header followed by payload, as
   shown below:

             +---------------+---------------+------...-----+
             | IPHC Dispatch |  IPHC Header  |    Payload   |
             +---------------+---------------+------...-----+

    Figure 2: A LoBAC-Encapsulated LOWPAN_IPHC Compressed IPv6 Datagram

   The Dispatch value is treated as an unstructured namespace.  Only a
   single pattern is used to represent current LoBAC functionality.







<span class="grey">Lynn, et al.                 Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


     Pattern      Header Type
   +------------+-----------------------------------------------------+
   | 01  1xxxxx | LOWPAN_IPHC - LOWPAN_IPHC compressed IPv6 [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>] |
   +------------+-----------------------------------------------------+

                Figure 3: LoBAC Dispatch Value Bit Pattern

   Other IANA-assigned 6LoWPAN Dispatch values do not apply to 6LoBAC
   unless otherwise specified.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Stateless%20Address%20Autoconfiguration"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Stateless Address Autoconfiguration</span>

   This section defines how to obtain an IPv6 Interface Identifier.
   This specification distinguishes between two types of IIDs, MAC-
   address-derived and semantically opaque.

   A MAC-address-derived IID is the RECOMMENDED type for use in forming
   a link-local address, as it affords the most efficient header
   compression provided by the LOWPAN_IPHC [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>] format specified in
   <a href="#section-10">Section 10</a>.  The general procedure for creating a MAC-address-derived
   IID is described in <a href="rfc4291.html#appendix-A">Appendix A of [RFC4291]</a>, "Creating Modified
   EUI-64 Format Interface Identifiers", as updated by [<a href="rfc7136.html" title='"Significance of IPv6 Interface Identifiers"'>RFC7136</a>].

   The Interface Identifier for link-local addresses SHOULD be formed by
   concatenating the node's 8-bit MS/TP MAC address to the seven octets
   0x00, 0x00, 0x00, 0xFF, 0xFE, 0x00, and 0x00.  For example, an MS/TP
   MAC address of hexadecimal value 0x4F results in the following IID:

   |0              1|1              3|3              4|4              6|
   |0              5|6              1|2              7|8              3|
   +----------------+----------------+----------------+----------------+
   |0000000000000000|0000000011111111|1111111000000000|0000000001001111|
   +----------------+----------------+----------------+----------------+

   A semantically opaque IID having 64 bits of entropy is RECOMMENDED
   for each globally scoped address and MAY be locally generated
   according to one of the methods cited in <a href="#section-12">Section 12</a>.  A node that
   generates a 64-bit semantically opaque IID MUST register the IID with
   its local router(s) by sending a Neighbor Solicitation (NS) message
   with the Address Registration Option (ARO) and process Neighbor
   Advertisements (NAs) according to [<a href="rfc6775.html" title='"Neighbor Discovery Optimization for IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs)"'>RFC6775</a>].

   An IPv6 address prefix used for stateless autoconfiguration [<a href="rfc4862.html" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>]
   of an MS/TP interface MUST have a length of 64 bits.







<span class="grey">Lynn, et al.                 Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IPv6%20Link-Local%20Address"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IPv6 Link-Local Address</span>

   The IPv6 link-local address [<a href="rfc4291.html" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>] for an MS/TP interface is
   formed by appending the Interface Identifier, as defined above, to
   the prefix FE80::/64.

     10 bits           54 bits                   64 bits
   +----------+-----------------------+----------------------------+
   |1111111010|        (zeros)        |    Interface Identifier    |
   +----------+-----------------------+----------------------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Unicast%20Address%20Mapping"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Unicast Address Mapping</span>

   The address resolution procedure for mapping IPv6 non-multicast
   addresses into MS/TP MAC-layer addresses follows the general
   description in <a href="rfc4861.html#section-7.2">Section 7.2 of [RFC4861]</a>, unless otherwise specified.

   The Source/Target Link-Layer Address option has the following form
   when the addresses are 8-bit MS/TP MAC-layer (node) addresses.

    0                   1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |    Length=1   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     0x00      | MS/TP Address |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |
   +      Padding (all zeros)      +
   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Option fields:

   Type:

      1: for Source Link-Layer address.

      2: for Target Link-Layer address.

   Length:  This is the length of this option (including the Type and
         Length fields) in units of 8 octets.  The value of this field
         is 1 for 8-bit MS/TP MAC addresses.

   MS/TP Address:  The 8-bit address in canonical bit order [<a href="rfc2469.html" title='"A Caution On The Canonical Ordering Of Link-Layer Addresses"'>RFC2469</a>].
         This is the unicast address the interface currently responds
         to.




<span class="grey">Lynn, et al.                 Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Multicast%20Address%20Mapping"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Multicast Address Mapping</span>

   All IPv6 multicast packets MUST be sent to MS/TP Destination Address
   255 (broadcast) and filtered at the IPv6 layer.  When represented as
   a 16-bit address in a compressed header (see <a href="#section-10">Section 10</a>), it MUST be
   formed by padding on the left with a zero octet:

    0                   1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     0x00      |     0xFF      |
   +-+-+-+-+-+-+-+-+---------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Header%20Compression"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Header Compression</span>

   6LoBAC REQUIRES LOWPAN_IPHC IPv6 compression, which is specified in
   [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>] and included herein by reference.  This section will simply
   identify substitutions that should be made when interpreting the text
   of [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>].

   In general, the following substitutions should be made:

   - Replace instances of "6LoWPAN" with "MS/TP network"

   - Replace instances of "IEEE 802.15.4 address" with "MS/TP address"

   When a 16-bit address is called for (i.e., an IEEE 802.15.4 "short
   address"), it MUST be formed by padding the MS/TP address to the left
   with a zero octet:

    0                   1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     0x00      | MS/TP address |
   +-+-+-+-+-+-+-+-+---------------+

   If LOWPAN_IPHC compression [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>] is used with context, the
   router(s) directly attached to the MS/TP segment MUST disseminate the
   6LoWPAN Context Option (6CO) according to <a href="rfc6775.html#section-7.2">Section 7.2 of [RFC6775]</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  IANA Considerations</span>

   This document uses values previously reserved by [<a href="rfc4944.html" title='"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"'>RFC4944</a>] and
   [<a href="rfc6282.html" title='"Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks"'>RFC6282</a>]; it does not require any IANA actions.







<span class="grey">Lynn, et al.                 Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Security%20Considerations"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Security Considerations</span>

   See [<a href="rfc8065.html" title='"Privacy Considerations for IPv6 Adaptation- Layer Mechanisms"'>RFC8065</a>] for a general discussion of privacy threats faced by
   constrained nodes.

   [<a id="ref-RFC8065" name="ref-RFC8065">RFC8065</a>] makes a distinction between "stable" and "temporary"
   addresses.  The former are long-lived and typically advertised by
   servers.  The latter are typically used by clients and SHOULD be
   changed frequently to mitigate correlation of activities over time.
   Nodes that engage in both activities SHOULD support simultaneous use
   of multiple addresses per device.

   Globally scoped addresses that contain MAC-address-derived IIDs may
   expose a network to address-scanning attacks.  For this reason, it is
   RECOMMENDED that a 64-bit semantically opaque IID be generated for
   each globally scoped address in use according to, for example,
   [<a href="rfc3315.html" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>], [<a href="rfc3972.html" title='"Cryptographically Generated Addresses (CGA)"'>RFC3972</a>], [<a href="rfc4941.html" title='"Privacy Extensions for Stateless Address Autoconfiguration in IPv6"'>RFC4941</a>], [<a href="rfc5535.html" title='"Hash-Based Addresses (HBA)"'>RFC5535</a>], or [<a href="rfc7217.html" title='"A Method for Generating Semantically Opaque Interface Identifiers with IPv6 Stateless Address Autoconfiguration (SLAAC)"'>RFC7217</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20References"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.1.%20%20Normative%20References"></a><a class="selflink" href="#section-13.1" name="section-13.1">13.1</a>.  Normative References</span>

   [<a id="ref-BACnet" name="ref-BACnet">BACnet</a>]   ASHRAE, "BACnet-A Data Communication Protocol for Building
              Automation and Control Networks", ANSI/ASHRAE Standard
              135-2016, January 2016,
              &lt;<a href="http://www.techstreet.com/ashrae/standards/ashrae-135-2016?product_id=1918140#jumps">http://www.techstreet.com/ashrae/standards/</a>
              <a href="http://www.techstreet.com/ashrae/standards/ashrae-135-2016?product_id=1918140#jumps">ashrae-135-2016?product_id=1918140#jumps</a>&gt;.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2460" name="ref-RFC2460">RFC2460</a>]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", <a href="rfc2460.html">RFC 2460</a>, DOI 10.17487/RFC2460,
              December 1998, &lt;<a href="http://www.rfc-editor.org/info/rfc2460">http://www.rfc-editor.org/info/rfc2460</a>&gt;.

   [<a id="ref-RFC3315" name="ref-RFC3315">RFC3315</a>]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", <a href="rfc3315.html">RFC 3315</a>, DOI 10.17487/RFC3315, July
              2003, &lt;<a href="http://www.rfc-editor.org/info/rfc3315">http://www.rfc-editor.org/info/rfc3315</a>&gt;.

   [<a id="ref-RFC3972" name="ref-RFC3972">RFC3972</a>]  Aura, T., "Cryptographically Generated Addresses (CGA)",
              <a href="rfc3972.html">RFC 3972</a>, DOI 10.17487/RFC3972, March 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3972">http://www.rfc-editor.org/info/rfc3972</a>&gt;.






<span class="grey">Lynn, et al.                 Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   [<a id="ref-RFC4291" name="ref-RFC4291">RFC4291</a>]  Hinden, R. and S. Deering, "IP Version 6 Addressing
              Architecture", <a href="rfc4291.html">RFC 4291</a>, DOI 10.17487/RFC4291, February
              2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4291">http://www.rfc-editor.org/info/rfc4291</a>&gt;.

   [<a id="ref-RFC4861" name="ref-RFC4861">RFC4861</a>]  Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
              "Neighbor Discovery for IP version 6 (IPv6)", <a href="rfc4861.html">RFC 4861</a>,
              DOI 10.17487/RFC4861, September 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4861">http://www.rfc-editor.org/info/rfc4861</a>&gt;.

   [<a id="ref-RFC4862" name="ref-RFC4862">RFC4862</a>]  Thomson, S., Narten, T., and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", <a href="rfc4862.html">RFC 4862</a>,
              DOI 10.17487/RFC4862, September 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4862">http://www.rfc-editor.org/info/rfc4862</a>&gt;.

   [<a id="ref-RFC4941" name="ref-RFC4941">RFC4941</a>]  Narten, T., Draves, R., and S. Krishnan, "Privacy
              Extensions for Stateless Address Autoconfiguration in
              IPv6", <a href="rfc4941.html">RFC 4941</a>, DOI 10.17487/RFC4941, September 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4941">http://www.rfc-editor.org/info/rfc4941</a>&gt;.

   [<a id="ref-RFC4944" name="ref-RFC4944">RFC4944</a>]  Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler,
              "Transmission of IPv6 Packets over IEEE 802.15.4
              Networks", <a href="rfc4944.html">RFC 4944</a>, DOI 10.17487/RFC4944, September 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4944">http://www.rfc-editor.org/info/rfc4944</a>&gt;.

   [<a id="ref-RFC5535" name="ref-RFC5535">RFC5535</a>]  Bagnulo, M., "Hash-Based Addresses (HBA)", <a href="rfc5535.html">RFC 5535</a>,
              DOI 10.17487/RFC5535, June 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5535">http://www.rfc-editor.org/info/rfc5535</a>&gt;.

   [<a id="ref-RFC6282" name="ref-RFC6282">RFC6282</a>]  Hui, J., Ed. and P. Thubert, "Compression Format for IPv6
              Datagrams over IEEE 802.15.4-Based Networks", <a href="rfc6282.html">RFC 6282</a>,
              DOI 10.17487/RFC6282, September 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6282">http://www.rfc-editor.org/info/rfc6282</a>&gt;.

   [<a id="ref-RFC6775" name="ref-RFC6775">RFC6775</a>]  Shelby, Z., Ed., Chakrabarti, S., Nordmark, E., and C.
              Bormann, "Neighbor Discovery Optimization for IPv6 over
              Low-Power Wireless Personal Area Networks (6LoWPANs)",
              <a href="rfc6775.html">RFC 6775</a>, DOI 10.17487/RFC6775, November 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6775">http://www.rfc-editor.org/info/rfc6775</a>&gt;.

   [<a id="ref-RFC7136" name="ref-RFC7136">RFC7136</a>]  Carpenter, B. and S. Jiang, "Significance of IPv6
              Interface Identifiers", <a href="rfc7136.html">RFC 7136</a>, DOI 10.17487/RFC7136,
              February 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7136">http://www.rfc-editor.org/info/rfc7136</a>&gt;.

   [<a id="ref-RFC7217" name="ref-RFC7217">RFC7217</a>]  Gont, F., "A Method for Generating Semantically Opaque
              Interface Identifiers with IPv6 Stateless Address
              Autoconfiguration (SLAAC)", <a href="rfc7217.html">RFC 7217</a>,
              DOI 10.17487/RFC7217, April 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7217">http://www.rfc-editor.org/info/rfc7217</a>&gt;.



<span class="grey">Lynn, et al.                 Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   [<a id="ref-RFC7400" name="ref-RFC7400">RFC7400</a>]  Bormann, C., "6LoWPAN-GHC: Generic Header Compression for
              IPv6 over Low-Power Wireless Personal Area Networks
              (6LoWPANs)", <a href="rfc7400.html">RFC 7400</a>, DOI 10.17487/RFC7400, November
              2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7400">http://www.rfc-editor.org/info/rfc7400</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.2.%20%20Informative%20References"></a><a class="selflink" href="#section-13.2" name="section-13.2">13.2</a>.  Informative References</span>

   [<a id="ref-Addendum_an" name="ref-Addendum_an">Addendum_an</a>]
              ANSI/ASHRAE, "Addenda: BACnet -- A Data Communication
              Protocol for Building Automation and Control Networks",
              ANSI/ASHRAE Addenda an, at, au, av, aw, ax, and az
              to ANSI/ASHRAE Standard 135-2012, July 2014,
              &lt;<a href="https://www.ashrae.org/File Library/docLib/StdsAddenda/07-31-2014_135_2012_an_at_au_av_aw_ax_az_Final.pdf">https://www.ashrae.org/File%20Library/docLib/StdsAddenda/</a>
              <a href="https://www.ashrae.org/File Library/docLib/StdsAddenda/07-31-2014_135_2012_an_at_au_av_aw_ax_az_Final.pdf">07-31-2014_135_2012_an_at_au_av_aw_ax_az_Final.pdf</a>&gt;.

   [<a id="ref-COBS" name="ref-COBS">COBS</a>]     Cheshire, S. and M. Baker, "Consistent Overhead Byte
              Stuffing", IEEE/ACM Transactions on Networking, Volume 7,
              Issue 2, DOI 10.1109/90.769765, April 1999,
              &lt;<a href="http://www.stuartcheshire.org/papers/COBSforToN.pdf">http://www.stuartcheshire.org/papers/COBSforToN.pdf</a>&gt;.

   [<a id="ref-CRC32K" name="ref-CRC32K">CRC32K</a>]   Koopman, P., "32-Bit Cyclic Redundancy Codes for Internet
              Applications", Proceedings of the International Conference
              on Dependable Systems and Networks (DSN 2002), June 2002,
              &lt;<a href="https://users.ece.cmu.edu/~koopman/networks/dsn02/dsn02_koopman.pdf">https://users.ece.cmu.edu/~koopman/networks/dsn02/</a>
              <a href="https://users.ece.cmu.edu/~koopman/networks/dsn02/dsn02_koopman.pdf">dsn02_koopman.pdf</a>&gt;.

   [<a id="ref-IEEE.802.3" name="ref-IEEE.802.3">IEEE.802.3</a>]
              IEEE, "IEEE Standard for Ethernet", IEEE 802.3-2015, DOI
              10.1109/IEEESTD.2016.7428776,
              &lt;<a href="http://standards.ieee.org/getieee802/download/802.3-2015.zip">http://standards.ieee.org/getieee802/</a>
              <a href="http://standards.ieee.org/getieee802/download/802.3-2015.zip">download/802.3-2015.zip</a>&gt;.

   [<a id="ref-RFC2469" name="ref-RFC2469">RFC2469</a>]  Narten, T. and C. Burton, "A Caution On The Canonical
              Ordering Of Link-Layer Addresses", <a href="rfc2469.html">RFC 2469</a>,
              DOI 10.17487/RFC2469, December 1998,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2469">http://www.rfc-editor.org/info/rfc2469</a>&gt;.

   [<a id="ref-RFC8065" name="ref-RFC8065">RFC8065</a>]  Thaler, D., "Privacy Considerations for IPv6 Adaptation-
              Layer Mechanisms", <a href="rfc8065.html">RFC 8065</a>, DOI 10.17487/RFC8065,
              February 2017, &lt;<a href="http://www.rfc-editor.org/info/rfc8065">http://www.rfc-editor.org/info/rfc8065</a>&gt;.

   [<a id="ref-TIA-485-A" name="ref-TIA-485-A">TIA-485-A</a>]
              TIA, "Electrical Characteristics of Generators and
              Receivers for Use in Balanced Digital Multipoint Systems",
              TIA-485-A (Revision of TIA-485), March 2003,
              &lt;<a href="https://global.ihs.com/doc_detail.cfm?item_s_key=00032964">https://global.ihs.com/</a>
              <a href="https://global.ihs.com/doc_detail.cfm?item_s_key=00032964">doc_detail.cfm?item_s_key=00032964</a>&gt;.




<span class="grey">Lynn, et al.                 Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Abstract%20MAC%20Interface"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Abstract MAC Interface</span>

   This Appendix is informative and not part of the standard.

   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 provides support for MAC-layer clients through its
   SendFrame and ReceivedDataNoReply procedures.  However, it does not
   define a network-protocol independent abstract interface for the MAC.
   This is provided below as an aid to implementation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20MA-DATA.request"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  MA-DATA.request</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.1.%20%20Function"></a><a class="selflink" href="#appendix-A.1.1" name="appendix-A.1.1">A.1.1</a>.  Function</span>

   This primitive defines the transfer of data from a MAC client entity
   to a single peer entity or multiple peer entities in the case of a
   broadcast address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.2.%20%20Semantics%20of%20the%20Service%20Primitive"></a><a class="selflink" href="#appendix-A.1.2" name="appendix-A.1.2">A.1.2</a>.  Semantics of the Service Primitive</span>

   The semantics of the primitive are as follows:

     MA-DATA.request (
                      destination_address,
                      source_address,
                      data,
                      type
                     )

   The 'destination_address' parameter may specify either an individual
   or a broadcast MAC entity address.  It must contain sufficient
   information to create the Destination Address field (see <a href="#section-1.3">Section 1.3</a>)
   that is prepended to the frame by the local MAC sublayer entity.  The
   'source_address' parameter, if present, must specify an individual
   MAC address.  If the source_address parameter is omitted, the local
   MAC sublayer entity will insert a value associated with that entity.

   The 'data' parameter specifies the MAC service data unit (MSDU) to be
   transferred by the MAC sublayer entity.  There is sufficient
   information associated with the MSDU for the MAC sublayer entity to
   determine the length of the data unit.

   The 'type' parameter specifies the value of the MS/TP Frame Type
   field that is prepended to the frame by the local MAC sublayer
   entity.







<span class="grey">Lynn, et al.                 Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.3.%20%20When%20Generated"></a><a class="selflink" href="#appendix-A.1.3" name="appendix-A.1.3">A.1.3</a>.  When Generated</span>

   This primitive is generated by the MAC client entity whenever data
   shall be transferred to a peer entity or entities.  This can be in
   response to a request from higher protocol layers or from data
   generated internally to the MAC client, such as a Token frame.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.1.4.%20%20Effect%20on%20Receipt"></a><a class="selflink" href="#appendix-A.1.4" name="appendix-A.1.4">A.1.4</a>.  Effect on Receipt</span>

   Receipt of this primitive will cause the MAC entity to insert all
   MAC-specific fields, including Destination Address, Source Address,
   Frame Type, and any fields that are unique to the particular media
   access method, and pass the properly formed frame to the lower
   protocol layers for transfer to the peer MAC sublayer entity or
   entities.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20MA-DATA.indication"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  MA-DATA.indication</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.1.%20%20Function"></a><a class="selflink" href="#appendix-A.2.1" name="appendix-A.2.1">A.2.1</a>.  Function</span>

   This primitive defines the transfer of data from the MAC sublayer
   entity to the MAC client entity or entities in the case of a
   broadcast address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.2.%20%20Semantics%20of%20the%20Service%20Primitive"></a><a class="selflink" href="#appendix-A.2.2" name="appendix-A.2.2">A.2.2</a>.  Semantics of the Service Primitive</span>

   The semantics of the primitive are as follows:

     MA-DATA.indication (
                         destination_address,
                         source_address,
                         data,
                         type
                        )

   The 'destination_address' parameter may be either an individual or a
   broadcast address as specified by the Destination Address field of
   the incoming frame.  The 'source_address' parameter is an individual
   address as specified by the Source Address field of the incoming
   frame.

   The 'data' parameter specifies the MAC service data unit (MSDU) as
   received by the local MAC entity.  There is sufficient information
   associated with the MSDU for the MAC sublayer client to determine the
   length of the data unit.

   The 'type' parameter is the value of the MS/TP Frame Type field of
   the incoming frame.



<span class="grey">Lynn, et al.                 Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.3.%20%20When%20Generated"></a><a class="selflink" href="#appendix-A.2.3" name="appendix-A.2.3">A.2.3</a>.  When Generated</span>

   The MA_DATA.indication is passed from the MAC sublayer entity to the
   MAC client entity or entities to indicate the arrival of a frame to
   the local MAC sublayer entity that is destined for the MAC client.
   Such frames are reported only if they are validly formed and received
   without error, and their Destination Address designates the local MAC
   entity.  Frames destined for the MAC Control sublayer are not passed
   to the MAC client.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.2.4.%20%20Effect%20on%20Receipt"></a><a class="selflink" href="#appendix-A.2.4" name="appendix-A.2.4">A.2.4</a>.  Effect on Receipt</span>

   The effect of receipt of this primitive by the MAC client is
   unspecified.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Consistent%20Overhead%20Byte%20Stuffing%20%28COBS%29"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Consistent Overhead Byte Stuffing (COBS)</span>

   This Appendix is informative and not part of the standard.

   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 corrects a long-standing issue with the MS/TP
   specification, namely that preamble sequences were not escaped
   whenever they appeared in the Data or Data CRC fields.  In rare
   cases, this resulted in dropped frames due to loss-of-frame
   synchronization.  The solution is to encode the Data and 32-bit Data
   CRC fields before transmission using Consistent Overhead Byte
   Stuffing [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>] and decode these fields upon reception.

   COBS is a run-length encoding method that nominally removes '0x00'
   octets from its input.  Any selected octet value may be removed by
   XOR'ing that value with each octet of the COBS output.  [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>],
   Clause 9 specifies the preamble octet '0x55' for removal.

   The minimum overhead of COBS is one octet per encoded field.  The
   worst-case overhead in long fields is bounded to one octet per 254 as
   described in [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>].

   Frame encoding proceeds logically in two passes.  The Encoded Data
   field is prepared by passing the MSDU through the COBS encoder and
   XOR'ing the preamble octet '0x55' with each octet of the output.  The
   Encoded CRC-32K field is then prepared by calculating a CRC-32K over
   the Encoded Data field and formatting it for transmission as
   described in <a href="#appendix-C">Appendix C</a>.  The combined length of these fields, minus
   two octets for compatibility with legacy MS/TP devices, is placed in
   the MS/TP header Length field before transmission.

   Example COBS encoder and decoder functions are shown below for
   illustration.  Complete examples of use and test vectors are provided
   in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Annex T.



<span class="grey">Lynn, et al.                 Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   &lt;CODE BEGINS&gt;

   #include &lt;stddef.h&gt;
   #include &lt;stdint.h&gt;

   /*
    * Encodes 'length' octets of data located at 'from' and
    * writes one or more COBS code blocks at 'to', removing any
    * 'mask' octets that may be present in the encoded data.
    * Returns the length of the encoded data.
    */

   size_t
   cobs_encode (uint8_t *to, const uint8_t *from, size_t length,
                uint8_t mask)
   {
     size_t code_index = 0;
     size_t read_index = 0;
     size_t write_index = 1;
     uint8_t code = 1;
     uint8_t data, last_code;

     while (read_index &lt; length) {
       data = from[read_index++];
       /*
        * In the case of encountering a non-zero octet in the data,
        * simply copy input to output and increment the code octet.
        */
       if (data != 0) {
         to[write_index++] = data ^ mask;
         code++;
         if (code != 255)
           continue;
       }
       /*
        * In the case of encountering a zero in the data or having
        * copied the maximum number (254) of non-zero octets, store
        * the code octet and reset the encoder state variables.
        */
       last_code = code;
       to[code_index] = code ^ mask;
       code_index = write_index++;
       code = 1;
     }
     /*
      * If the last chunk contains exactly 254 non-zero octets, then
      * this exception is handled above (and the returned length must
      * be adjusted). Otherwise, encode the last chunk normally, as if



<span class="grey">Lynn, et al.                 Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


      * a "phantom zero" is appended to the data.
      */
     if ((last_code == 255) &amp;&amp; (code == 1))
       write_index--;
     else
       to[code_index] = code ^ mask;

     return write_index;
   }


   #include &lt;stddef.h&gt;
   #include &lt;stdint.h&gt;

   /*
    * Decodes 'length' octets of data located at 'from' and
    * writes the original client data at 'to', restoring any
    * 'mask' octets that may present in the encoded data.
    * Returns the length of the encoded data or zero if error.
    */
   size_t
   cobs_decode (uint8_t *to, const uint8_t *from, size_t length,
                uint8_t mask)
   {
     size_t read_index = 0;
     size_t write_index = 0;
     uint8_t code, last_code;

     while (read_index &lt; length) {
       code = from[read_index] ^ mask;
       last_code = code;
       /*
        * Sanity check the encoding to prevent the while() loop below
        * from overrunning the output buffer.
        */
       if (read_index + code &gt; length)
         return 0;

       read_index++;
       while (--code &gt; 0)
         to[write_index++] = from[read_index++] ^ mask;
       /*
        * Restore the implicit zero at the end of each decoded block
        * except when it contains exactly 254 non-zero octets or the
        * end of data has been reached.
        */
       if ((last_code != 255) &amp;&amp; (read_index &lt; length))
         to[write_index++] = 0;



<span class="grey">Lynn, et al.                 Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


     }
     return write_index;
   }

   &lt;CODE ENDS&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20C.%20%20Encoded%20CRC-32K%20%28CRC32K%29"></a><a class="selflink" href="#appendix-C" name="appendix-C">Appendix C</a>.  Encoded CRC-32K (CRC32K)</span>

   This Appendix is informative and not part of the standard.

   Extending the payload of MS/TP to 1500 octets requires upgrading the
   Data CRC from 16 bits to 32 bits.  P. Koopman has authored several
   papers on evaluating CRC polynomials for network applications.  In
   [<a href="#ref-CRC32K" title='"32-Bit Cyclic Redundancy Codes for Internet Applications"'>CRC32K</a>], he surveyed the entire 32-bit polynomial space and noted
   some that exceed the [<a href="#ref-IEEE.802.3">IEEE.802.3</a>] polynomial in performance.
   [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Clause 9 specifies one of these, the CRC-32K (Koopman)
   polynomial.

   The specified use of the calc_crc32K() function is as follows.
   Before a frame is transmitted, 'crc_value' is initialized to all
   ones.  After passing each octet of the [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>] Encoded Data field
   through the function, the ones complement of the resulting
   'crc_value' is arranged in LSB-first order and is itself [<a href="#ref-COBS" title='"Consistent Overhead Byte Stuffing"'>COBS</a>]
   encoded.  The length of the resulting Encoded CRC-32K field is always
   five octets.

   Upon reception of a frame, 'crc_value' is initialized to all ones.
   The octets of the Encoded Data field are accumulated by the
   calc_crc32K() function before decoding.  The Encoded CRC-32K field is
   then decoded and the resulting four octets are accumulated by the
   calc_crc32K() function.  If the result is the expected residue value
   'CRC32K_RESIDUE', then the frame was received correctly.

   An example CRC-32K function is shown below for illustration.
   Complete examples of use and test vectors are provided in [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>],
   Annex G.3.















<span class="grey">Lynn, et al.                 Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   &lt;CODE BEGINS&gt;

   #include &lt;stdint.h&gt;

   /* See ANSI/ASHRAE Standard 135-2016 [<a href="#ref-BACnet" title='"BACnet-A Data Communication Protocol for Building Automation and Control Networks"'>BACnet</a>], Section G.3.2 */
   #define CRC32K_INITIAL_VALUE (0xFFFFFFFF)
   #define CRC32K_RESIDUE (0x0843323B)

   /* CRC-32K polynomial, 1 + x**1 + ... + x**30 (+ x**32) */
   #define CRC32K_POLY (0xEB31D82E)

   /*
    * Accumulate 'data_value' into the CRC in 'crc_value'.
    * Return updated CRC.
    *
    * Note: crc_value must be set to CRC32K_INITIAL_VALUE
    * before initial call.
    */
   uint32_t
   calc_crc32K (uint8_t data_value, uint32_t crc_value)
   {
     int b;

     for (b = 0; b &lt; 8; b++) {
       if ((data_value &amp; 1) ^ (crc_value &amp; 1)) {
         crc_value &gt;&gt;= 1;
         crc_value ^= CRC32K_POLY;
       } else {
         crc_value &gt;&gt;= 1;
       }
       data_value &gt;&gt;= 1;
     }
     return crc_value;
   }

   &lt;CODE ENDS&gt;















<span class="grey">Lynn, et al.                 Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20D.%20%20Example%206LoBAC%20Frame%20Decode"></a><a class="selflink" href="#appendix-D" name="appendix-D">Appendix D</a>.  Example 6LoBAC Frame Decode</span>

   This Appendix is informative and not part of the standard.

   BACnet MS/TP, Src (2), Dst (1), IPv6 Encapsulation
       Preamble 55: 0x55
       Preamble FF: 0xff
       Frame Type: IPv6 Encapsulation (34)
       Destination Address: 1
       Source Address: 2
       Length: 537
       Header CRC: 0x1c [correct]
       Extended Data CRC: 0x9e7259e2 [correct]
   6LoWPAN
       IPHC Header
           011. .... = Pattern: IP header compression (0x03)
           ...1 1... .... .... = Traffic class and flow label:
                                 Version, traffic class, and flow label
                                 compressed (0x0003)
           .... .0.. .... .... = Next header: Inline
           .... ..00 .... .... = Hop limit: Inline (0x0000)
           .... .... 1... .... = Context identifier extension: True
           .... .... .1.. .... = Source address compression: Stateful
           .... .... ..01 .... = Source address mode:
                                 64-bits inline (0x0001)
           .... .... .... 0... = Multicast address compression: False
           .... .... .... .1.. = Destination address compression:
                                 Stateful
           .... .... .... ..10 = Destination address mode:
                                 16-bits inline (0x0002)
           <a href="#section-0000">0000</a> .... = Source context identifier: 0x00
           .... 0000 = Destination context identifier: 0x00
           [Source context: aaaa:: (aaaa::)]
           [Destination context: aaaa:: (aaaa::)]
       Next header: ICMPv6 (0x3a)
       Hop limit: 63
       Source: aaaa::1 (aaaa::1)
       Destination: aaaa::ff:fe00:1 (aaaa::ff:fe00:1)













<span class="grey">Lynn, et al.                 Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   Internet Protocol Version 6, Src: aaaa::1 (aaaa::1),
                                Dst: aaaa::ff:fe00:1 (aaaa::ff:fe00:1)
       0110 .... .... .... .... .... .... .... = Version: 6
       .... 0000 0000 .... .... .... .... .... = Traffic class:
                                                 0x00000000
       .... 0000 00.. .... .... .... .... .... = Differentiated
                                                 Services Field:
                                                 Default (0x00000000)
       .... .... ..0. .... .... .... .... .... = ECN-Capable Transport
                                                 (ECT): Not set
       .... .... ...0 .... .... .... .... .... = ECN-CE: Not set
       .... .... .... 0000 0000 0000 0000 0000 = Flowlabel: 0x00000000
       Payload length: 518
       Next header: ICMPv6 (58)
       Hop limit: 63
       Source: aaaa::1 (aaaa::1)
       Destination: aaaa::ff:fe00:1 (aaaa::ff:fe00:1)
   Internet Control Message Protocol v6
       Type: Echo (ping) request (128)
       Code: 0
       Checksum: 0x783f [correct]
       Identifier: 0x2ee5
       Sequence: 2
       [Response In: 5165]
       Data (510 bytes)
           Data: e4dbe8553ba0040008090a0b0c0d0e0f1011121314151617...
           [Length: 510]
























<span class="grey">Lynn, et al.                 Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   Frame (547 bytes):
   55 ff 22 01 02 02 19 1c 56 2d 83 56 6f 6a 54 54   U.".....V-.VojTT
   54 54 54 54 57 54 56 54 d5 50 2d 6a 7b b0 5c 57   TTTTWTVT.P-j{.\W
   b1 8e bd 00 6e f5 51 ac 5d 5c 5f 5e 59 58 5b 5a   ....n.Q.]\_^YX[Z
   45 44 47 46 41 40 43 42 4d 4c 4f 4e 49 48 4b 4a   EDGFA@CBMLONIHKJ
   75 74 77 76 71 70 73 72 7d 7c 7f 7e 79 78 7b 7a   utwvqpsr}|.~yx{z
   65 64 67 66 61 60 63 62 6d 6c 6f 6e 69 68 6b 6a   edgfa`cbmlonihkj
   15 14 17 16 11 10 13 12 1d 1c 1f 1e 19 18 1b 1a   ................
   05 04 07 06 01 00 03 02 0d 0c 0f 0e 09 08 0b 0a   ................
   35 34 37 36 31 30 33 32 3d 3c 3f 3e 39 38 3b 3a   54761032=&lt;?&gt;98;:
   25 24 27 26 21 20 23 22 2d 2c 2f 2e 29 28 2b 2a   %$'&amp;! #"-,/.)(+*
   d5 d4 d7 d6 d1 d0 d3 d2 dd dc df de d9 d8 db da   ................
   c5 c4 c7 c6 c1 c0 c3 c2 cd cc cf ce c9 c8 cb ca   ................
   f5 f4 f7 f6 f1 f0 f3 f2 fd fc ff fe f9 f8 fb fa   ................
   e5 e4 e7 e6 e1 e0 e3 e2 ed ec ef ee e9 e8 eb ea   ................
   95 94 97 96 91 90 93 92 9d 9c 9f 9e 99 98 9b 9a   ................
   85 84 87 86 81 80 83 82 8d 8c 8f 8e 89 88 8b 8a   ................
   b5 b4 b7 b6 b1 b0 b3 b2 bd bc bf be b9 b8 bb ba   ................
   a5 a4 a7 a6 a1 a0 a3 a2 ad ac af ae a9 a8 ab aa   ................
   ab 54 57 56 51 50 53 52 5d 5c 5f 5e 59 58 5b 5a   .TWVQPSR]\_^YX[Z
   45 44 47 46 41 40 43 42 4d 4c 4f 4e 49 48 4b 4a   EDGFA@CBMLONIHKJ
   75 74 77 76 71 70 73 72 7d 7c 7f 7e 79 78 7b 7a   utwvqpsr}|.~yx{z
   65 64 67 66 61 60 63 62 6d 6c 6f 6e 69 68 6b 6a   edgfa`cbmlonihkj
   15 14 17 16 11 10 13 12 1d 1c 1f 1e 19 18 1b 1a   ................
   05 04 07 06 01 00 03 02 0d 0c 0f 0e 09 08 0b 0a   ................
   35 34 37 36 31 30 33 32 3d 3c 3f 3e 39 38 3b 3a   54761032=&lt;?&gt;98;:
   25 24 27 26 21 20 23 22 2d 2c 2f 2e 29 28 2b 2a   %$'&amp;! #"-,/.)(+*
   d5 d4 d7 d6 d1 d0 d3 d2 dd dc df de d9 d8 db da   ................
   c5 c4 c7 c6 c1 c0 c3 c2 cd cc cf ce c9 c8 cb ca   ................
   f5 f4 f7 f6 f1 f0 f3 f2 fd fc ff fe f9 f8 fb fa   ................
   e5 e4 e7 e6 e1 e0 e3 e2 ed ec ef ee e9 e8 eb ea   ................
   95 94 97 96 91 90 93 92 9d 9c 9f 9e 99 98 9b 9a   ................
   85 84 87 86 81 80 83 82 8d 8c 8f 8e 89 88 8b 8a   ................
   b5 b4 b7 b6 b1 b0 b3 b2 bd bc bf be b9 b8 bb ba   ................
   a5 a4 a7 a6 a1 a0 a3 a2 ad ac af ae a9 a8 50 cb   ..............P.
   27 0c b7                                          '..















<span class="grey">Lynn, et al.                 Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   Decoded Data and CRC32K (537 bytes):
   78 d6 00 3a 3f 00 00 00 00 00 00 00 01 00 01 80   x..:?...........
   00 78 3f 2e e5 00 02 e4 db e8 55 3b a0 04 00 08   .x?.......U;....
   09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18   ................
   19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28   ....... !"#$%&amp;'(
   29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38   )*+,-./012345678
   39 3a 3b 3c 3d 3e 3f 40 41 42 43 44 45 46 47 48   9:;&lt;=&gt;?@ABCDEFGH
   49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58   IJKLMNOPQRSTUVWX
   59 5a 5b 5c 5d 5e 5f 60 61 62 63 64 65 66 67 68   YZ[\]^_`abcdefgh
   69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 76 77 78   ijklmnopqrstuvwx
   79 7a 7b 7c 7d 7e 7f 80 81 82 83 84 85 86 87 88   yz{|}~..........
   89 8a 8b 8c 8d 8e 8f 90 91 92 93 94 95 96 97 98   ................
   99 9a 9b 9c 9d 9e 9f a0 a1 a2 a3 a4 a5 a6 a7 a8   ................
   a9 aa ab ac ad ae af b0 b1 b2 b3 b4 b5 b6 b7 b8   ................
   b9 ba bb bc bd be bf c0 c1 c2 c3 c4 c5 c6 c7 c8   ................
   c9 ca cb cc cd ce cf d0 d1 d2 d3 d4 d5 d6 d7 d8   ................
   d9 da db dc dd de df e0 e1 e2 e3 e4 e5 e6 e7 e8   ................
   e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7 f8   ................
   f9 fa fb fc fd fe ff 00 01 02 03 04 05 06 07 08   ................
   09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18   ................
   19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28   ....... !"#$%&amp;'(
   29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38   )*+,-./012345678
   39 3a 3b 3c 3d 3e 3f 40 41 42 43 44 45 46 47 48   9:;&lt;=&gt;?@ABCDEFGH
   49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58   IJKLMNOPQRSTUVWX
   59 5a 5b 5c 5d 5e 5f 60 61 62 63 64 65 66 67 68   YZ[\]^_`abcdefgh
   69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 76 77 78   ijklmnopqrstuvwx
   79 7a 7b 7c 7d 7e 7f 80 81 82 83 84 85 86 87 88   yz{|}~..........
   89 8a 8b 8c 8d 8e 8f 90 91 92 93 94 95 96 97 98   ................
   99 9a 9b 9c 9d 9e 9f a0 a1 a2 a3 a4 a5 a6 a7 a8   ................
   a9 aa ab ac ad ae af b0 b1 b2 b3 b4 b5 b6 b7 b8   ................
   b9 ba bb bc bd be bf c0 c1 c2 c3 c4 c5 c6 c7 c8   ................
   c9 ca cb cc cd ce cf d0 d1 d2 d3 d4 d5 d6 d7 d8   ................
   d9 da db dc dd de df e0 e1 e2 e3 e4 e5 e6 e7 e8   ................
   e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7 f8   ................
   f9 fa fb fc fd 9e 72 59 e2                        ......rY.
















<span class="grey">Lynn, et al.                 Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


   Decompressed 6LoWPAN IPHC (558 bytes):
   60 00 00 00 02 06 3a 3f aa aa 00 00 00 00 00 00   `.....:?........
   00 00 00 00 00 00 00 01 aa aa 00 00 00 00 00 00   ................
   00 00 00 ff fe 00 00 01 80 00 78 3f 2e e5 00 02   ..........x?....
   e4 db e8 55 3b a0 04 00 08 09 0a 0b 0c 0d 0e 0f   ...U;...........
   10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f   ................
   20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f    !"#$%&amp;'()*+,-./
   30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f   0123456789:;&lt;=&gt;?
   40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f   @ABCDEFGHIJKLMNO
   50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f   PQRSTUVWXYZ[\]^_
   60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f   `abcdefghijklmno
   70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f   pqrstuvwxyz{|}~.
   80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f   ................
   90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f   ................
   a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af   ................
   b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf   ................
   c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf   ................
   d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df   ................
   e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef   ................
   f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff   ................
   00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f   ................
   10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f   ................
   20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f    !"#$%&amp;'()*+,-./
   30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f   0123456789:;&lt;=&gt;?
   40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f   @ABCDEFGHIJKLMNO
   50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f   PQRSTUVWXYZ[\]^_
   60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f   `abcdefghijklmno
   70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f   pqrstuvwxyz{|}~.
   80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f   ................
   90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f   ................
   a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af   ................
   b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf   ................
   c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf   ................
   d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df   ................
   e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef   ................
   f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd         ..............















<span class="grey">Lynn, et al.                 Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc8163.html">RFC 8163</a>                IPv6 over MS/TP (6LoBAC)                May 2017</span>


Acknowledgements

   We are grateful to the authors of [<a href="rfc4944.html" title='"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"'>RFC4944</a>] and members of the IETF
   6LoWPAN working group; this document borrows liberally from their
   work.  Ralph Droms and Brian Haberman provided indispensable guidance
   and support from the outset.  Peter van der Stok, James Woodyatt,
   Carsten Bormann, and Dale Worley provided detailed reviews.  Stuart
   Cheshire invented the very clever COBS encoding.  Michael Osborne
   made the critical observation that encoding the data and CRC32K
   fields separately would allow the CRC to be calculated on the fly.
   Alexandru Petrescu, Brian Frank, Geoff Mulligan, and Don Sturek
   offered valuable comments.

Authors' Addresses

   Kerry Lynn (editor)
   Verizon Labs
   50 Sylvan Rd
   Waltham, MA  02451
   United States of America
   Phone: +1 781 296 9722
   Email: kerlyn@ieee.org


   Jerry Martocci
   Johnson Controls, Inc.
   507 E. Michigan St
   Milwaukee, WI  53202
   United States of America
   Email: jpmartocci@sbcglobal.net


   Carl Neilson
   Delta Controls, Inc.
   17850 56th Ave
   Surrey, BC  V3S 1C7
   Canada
   Phone: +1 604 575 5913
   Email: cneilson@deltacontrols.com


   Stuart Donaldson
   Honeywell Automation &amp; Control Solutions
   6670 185th Ave NE
   Redmond, WA  98052
   United States of America
   Email: stuart.donaldson@honeywell.com




Lynn, et al.                 Standards Track                   [Page 27]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc8163 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:17 GMT --></html>