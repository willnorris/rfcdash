<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3887 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:45 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:3887" name="DC.Identifier"/>
<meta content="Customers buying enterprise message systems often ask: Can I track the
messages? Message tracking is the ability to find out the path that a
particular message has taken through a messaging system and the
current routing status of that message. This document describes the
Message Tracking Query Protocol that is used in conjunction with
extensions to the ESMTP protocol to provide a complete message
tracking solution for the Internet. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Tony Hansen &lt;tony@att.com&gt;" name="DC.Creator"/>
<meta content="September, 2004" name="DC.Date.Issued"/>
<meta content="Message Tracking Query Protocol" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3887 - Message Tracking Query Protocol</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3887.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3887" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-msgtrk-mtqp" title="draft-ietf-msgtrk-mtqp">draft-ietf-msgt...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3887" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3887" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3887" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=3887">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                          T. Hansen
Request for Comments: 3887                             AT&amp;T Laboratories
Category: Standards Track                                 September 2004


                    <span class="h1">Message Tracking Query Protocol</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2004).

Abstract

   Customers buying enterprise message systems often ask: Can I track
   the messages?  Message tracking is the ability to find out the path
   that a particular message has taken through a messaging system and
   the current routing status of that message.  This document describes
   the Message Tracking Query Protocol that is used in conjunction with
   extensions to the ESMTP protocol to provide a complete message
   tracking solution for the Internet.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Message Tracking Models and Requirements document
   [<a href="#ref-RFC-MTRK-MODEL" title='"Message Tracking Models and Requirements"'>RFC-MTRK-MODEL</a>] discusses the models that message tracking solutions
   could follow, along with requirements for a message tracking solution
   that can be used with the Internet-wide message infrastructure.  This
   memo and its companions, [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>] and [<a href="#ref-RFC-MTRK-TSN" title='"The Message/Tracking-Status MIME Extension"'>RFC-MTRK-TSN</a>],
   describe a complete message tracking solution that satisfies those
   requirements.  The memo [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>] defines an extension to the
   SMTP service that provides the information necessary to track
   messages.  This memo defines a protocol that can be used to query the
   status of messages that have been transmitted on the Internet via
   SMTP.  The memo [<a href="#ref-RFC-MTRK-TSN" title='"The Message/Tracking-Status MIME Extension"'>RFC-MTRK-TSN</a>] describes the message/tracking-status
   [<a href="#ref-RFC-MIME" title='"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"'>RFC-MIME</a>] media type that is used to report tracking status
   information.  Using the model document's terminology, this solution
   uses active enabling and active requests with both request and
   chaining referrals.





<span class="grey">Hansen                      Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>
   [<a href="#ref-RFC-KEYWORDS" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC-KEYWORDS</a>].

   All syntax descriptions use the ABNF specified by [<a href="#ref-RFC-ABNF" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC-ABNF</a>].
   Terminal nodes not defined elsewhere in this document are defined in
   [<a href="#ref-RFC-ABNF" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC-ABNF</a>], [<a href="#ref-RFC-URI" title='"Uniform Resource Identifiers (URI): Generic Syntax"'>RFC-URI</a>], [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>], [<a href="#ref-RFC-SMTP" title='"Simple Mail Transfer Protocol"'>RFC-SMTP</a>], or
   [<a href="#ref-RFC-SMTPEXT" title='"SMTP Service Extension for Authentication"'>RFC-SMTPEXT</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Basic%20Operation"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Basic Operation</span>

   The Message Tracking Query Protocol (MTQP) is similar to many other
   line-oriented Internet protocols, such as [<a href="#ref-POP3" title='"Post Office Protocol - Version 3"'>POP3</a>] and [<a href="#ref-NNTP" title='"Network News Transfer Protocol"'>NNTP</a>].
   Initially, the server host starts the MTQP service by listening on
   TCP port 1038.

   When an MTQP client wishes to make use of the message tracking
   service, it establishes a TCP connection with the server host, as
   recorded from the initial message submission or as returned by a
   previous tracking request.  To find the server host, the MTQP client
   first does an SRV lookup for the server host using DNS SRV records,
   with a service name of "mtqp" and a protocol name of "tcp", as in
   _mtqp._tcp.smtp3.example.com.  (See the "Usage rules" section in
   [<a href="#ref-RFC-SRV" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC-SRV</a>] for details.)  If the SRV records do not exist, the MTQP
   client then does an address record lookup for the server host.  When
   the connection is established, the MTQP server sends a greeting.  The
   MTQP client and MTQP server then exchange commands and responses
   (respectively) until the connection is closed or aborted.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Tracking%20Service%20DNS%20Considerations"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Tracking Service DNS Considerations</span>

   Because of the ways server host lookups are performed, many different
   tracking server host configurations are supported.

   A mail system that uses a single mail server host and has the MTQP
   server host on the same server host will most likely have a single MX
   record pointing at the server host, and if not, will have an address
   record.  Both mail and MTQP clients will access that host directly.

   A mail system that uses a single mail server host, but wants tracking
   queries to be performed on a different machine, MUST have an SRV MTQP
   record pointing at that different machine.






<span class="grey">Hansen                      Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


   A mail system that uses multihomed mail servers has two choices for
   providing tracking services: either all mail servers must be running
   tracking servers that are able to retrieve information on all
   messages, or the tracking service must be performed on one (or more)
   machine(s) that are able to retrieve information on all messages.  In
   the former case, no additional DNS records are needed beyond the MX
   records already in place for the mail system.  In the latter case,
   SRV MTQP records are needed that point at the machine(s) that are
   running the tracking service.  In both cases, note that the tracking
   service MUST be able to handle the queries for all messages accepted
   by that mail system.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Commands"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Commands</span>

   Commands in MTQP consist of a case-insensitive keyword, possibly
   followed by one or more parameters.  All commands are terminated by a
   CRLF pair.  Keywords and parameters consist of printable ASCII
   characters.  Keywords and parameters are separated by whitespace (one
   or more space or tab characters).  A command line is limited to 998
   characters before the CRLF.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Responses"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Responses</span>

   Responses in MTQP consist of a status indicator that indicates
   success or failure.  Successful commands may also be followed by
   additional lines of data.  All response lines are terminated by a
   CRLF pair and are limited to 998 characters before the CRLF.  There
   are several status indicators: "+OK" indicates success; "+OK+"
   indicates a success followed by additional lines of data, a multi-
   line success response; "-TEMP" indicates a temporary failure; "-ERR"
   indicates a permanent failure; and "-BAD" indicates a protocol error
   (such as for unrecognized commands).

   A status indicator MAY be followed by a series of machine-parsable,
   case-insensitive response information giving more data about the
   errors.  These are separated from the status indicator and each other
   by a single slash character ("/", decimal code 47).  Following that,
   there MAY be white space and a human-readable text message.  The
   human-readable text message is not intended to be presented to the
   end user, but should be appropriate for putting in a log for use in
   debugging problems.

   In a multi-line success response, each subsequent line is terminated
   by a CRLF pair and limited to 998 characters before the CRLF.  When
   all lines of the response have been sent, a final line is sent
   consisting of a single period (".", decimal code 046) and a CRLF
   pair.  If any line of the multi-line response begins with a period,
   the line is "dot-stuffed" by prepending the period with a second



<span class="grey">Hansen                      Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


   period.  When examining a multi-line response, the client checks to
   see if the line begins with a period.  If so, and octets other than
   CRLF follow, the first octet of the line (the period) is stripped
   away.  If so, and if CRLF immediately follows the period, then the
   response from the MTQP server is ended and the line containing the
   ".CRLF" is not considered part of the multi-line response.

   An MTQP server MUST respond to an unrecognized, unimplemented, or
   syntactically invalid command by responding with a negative -BAD
   status indicator.  A server MUST respond to a command issued when the
   session is in an incorrect state by responding with a negative -ERR
   status indicator.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Firewall%20Considerations"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Firewall Considerations</span>

   A firewall mail gateway has two choices when receiving a tracking
   query for a host within its domain: it may return a response to the
   query that says the message has been passed on, but no further
   information is available; or it may perform a chaining operation
   itself, gathering information on the message from the mail hosts
   behind the firewall, and returning to the MTQP client the information
   for each behind-the-firewall hop, or possibly just the final hop
   information, possibly also disguising the names of any hosts behind
   the firewall.  Which option is picked is an administrative decision
   and is not further mandated by this document.

   If a server chooses to perform a chaining operation itself, it MUST
   provide a response within 2 minutes, and SHOULD return a "no further
   information is available" response if it cannot provide an answer at
   the end of that time limit.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5.%20%20Optional%20Timers"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a>.  Optional Timers</span>

   An MTQP server MAY have an inactivity autologout timer.  Such a timer
   MUST be of at least 10 minutes in duration.  The receipt of any
   command from the client during that interval should suffice to reset
   the autologout timer.  An MTQP server MAY limit the number of
   commands, unrecognized commands, or total connection time, or MAY use
   other criteria, to prevent denial of service attacks.

   An MTQP client MAY have an inactivity autologout timer while waiting
   for a response from the server.  Since an MTQP server may be a
   firewall, and may be chaining information from other servers, such a
   timer MUST be at least 2 minutes in duration.







<span class="grey">Hansen                      Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Initialization%20and%20Option%20Response"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Initialization and Option Response</span>

   Once the TCP connection has been opened by an MTQP client, the MTQP
   server issues an initial status response that indicates its
   readiness.  If the status response is positive (+OK or +OK+), the
   client may proceed with other commands.

   The initial status response MUST include the response information
   "/MTQP".  Negative responses MUST include a reason code as response
   information.  The following reason codes are defined here;
   unrecognized reason codes added in the future may be treated as
   equivalent to "unavailable".

      "/" "unavailable"
      "/" "admin"

   The reason code "/admin" SHOULD be used when the service is
   unavailable for administrative reasons.  The reason code
   "/unavailable" SHOULD be used when the service is unavailable for
   other reasons.

   If the server has any options enabled, they are listed as the multi-
   line response of the initial status response, one per line.  An
   option specification consists of an identifier, optionally followed
   by option-specific parameters.  An option specification may be
   continued onto additional lines by starting the continuation lines
   with white space.  The option identifier is case insensitive.  Option
   identifiers beginning with the characters "vnd." are reserved for
   vendor use.  (See below.)

   One option specification is defined here:

   STARTTLS [1*WSP "required"]

   This capability MUST be listed if the optional STARTTLS command is
   enabled on the MQTP server and one or more certificates have been
   properly installed.

   It has one optional parameter: the word "required" (The parameters
   for STARTTLS are case-insensitive).  If the server requires that TLS
   be used for some of the domains the server handles, the server MUST
   specify the "required" parameter.









<span class="grey">Hansen                      Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Examples"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Examples</span>

   Example #1 (no options):
   S: +OK/MTQP MTQP server ready

   Example #2 (service temporarily unavailable):
   S: -TEMP/MTQP/admin Service down for admin, call back later

   Example #3 (service permanently unavailable):
   S: -ERR/MTQP/unavailable Service down

   Example #4 (alternative for no options):
   S: +OK+/MTQP MTQP server ready
   S: .

   Example #5 (options available):
   S: +OK+/MTQP MTQP server ready
   S: starttls
   S: vnd.com.example.option2 with parameters private to example.com
   S: vnd.com.example.option3 with a very long
   S:  list of parameters
   S: .

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20TRACK%20Command"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  TRACK Command</span>

   Syntax:

   track-command = "TRACK" 1*WSP unique-envid 1*WSP mtrk-secret CRLF
     mtrk-secret = base64

   Unique-envid is defined in [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>].  Mtrk-secret is the
   secret A described in [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>], encoded using base64.

   When the client issues the TRACK command, and the user is validated,
   the MTQP server retrieves tracking information about an email
   message.  To validate the user, the value of mtrk-secret is hashed
   using SHA1, as described in [<a href="#ref-RFC-SHA1" title='"US Secure Hash Algorithm 1 (SHA1)"'>RFC-SHA1</a>].  The hash value is then
   compared with the value passed with the message when it was
   originally sent.  If the hash values match, the user is validated.

   A successful response MUST be multi-line, consisting of a [<a href="#ref-RFC-MIME" title='"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"'>RFC-MIME</a>]
   body part.  The MIME body part MUST be of type multipart/related,
   with subparts of message/tracking-status, as defined in
   [<a href="#ref-RFC-MTRK-TSN" title='"The Message/Tracking-Status MIME Extension"'>RFC-MTRK-TSN</a>].  The response contains the tracking information about
   the email message that used the given tracking-id.  A negative
   response to the TRACK command may include these reason codes:





<span class="grey">Hansen                      Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


      "/" "tls-required"
      "/" "admin"
      "/" "unavailable"
      "/" "noinfo"
      "/" "insecure"

   The reason code "/tls-required" SHOULD be used when the server has
   decided to require TLS.  The reason code "/admin" SHOULD be used when
   the server has become unavailable, due to administrative reasons,
   since the connection was initialized.  The reason code "/unavailable"
   SHOULD be used when the server has become unavailable, for other
   reasons, since the connection was initialized.  The reason code
   "/insecure" is described later.

   If a message has not been seen by the MTQP server, the server MUST
   choose between two choices: it MAY return a positive response with an
   action field of "opaque" in the tracking information, or it MAY
   return a negative response with a reason code of "noinfo".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Examples"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Examples</span>

   In each of the examples below, the unique-envid is
   "&lt;12345-20010101@example.com&gt;", the secret A is "abcdefgh", and the
   SHA1 hash B is (in hex) "734ba8b31975d0dbae4d6e249f4e8da270796c94".
   The message came from example.com and the MTQP server is
   example2.com.

Example #6      Message Delivered:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon, 1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: delivered
S: Status: 2.5.0
S:
S: --%%%%--
S: .





<span class="grey">Hansen                      Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


Example #7      Message Transferred:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: transferred
S: Remote-MTA: dns; example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S: Status:2.4.0
S:
S: --%%%%--
S: .

Example #8 Message Delayed and a Dot-Stuffed Header:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S: ..Dot-Stuffed-Header: as an example
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon, 1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: delayed
S: Status: 4.4.1 (No answer from host)
S: Remote-MTA: dns; example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S: Will-Retry-Until: Thu, 4 Jan 2001 15:15:15 -0500
S:
S: --%%%%--
S: .






<span class="grey">Hansen                      Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


Example #9 Two Users, One Relayed, One Failed:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: relayed
S: Status: 2.1.9
S: Remote-MTA: dns; example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user2@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user2@example1.com
S: Action: failed
S: Status 5.2.2 (Mailbox full)
S: Remote-MTA: dns; example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S:
S: --%%%%--
S: .

Example #10 Firewall:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: relayed
S: Status: 2.1.9
S: Remote-MTA: dns; smtp.example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S:



<span class="grey">Hansen                      Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; smtp.example3.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user2@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user4@example3.com
S: Action: delivered
S: Status: 2.5.0
S:
S: --%%%%--
S: .

Example #11 Firewall, Combining Per-Recipient Blocks:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: relayed
S: Status: 2.1.9
S: Remote-MTA: dns; smtp.example3.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user2@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user4@example3.com
S: Action: delivered
S: Status:2.5.0
S:
S: --%%%%--
S: .










<span class="grey">Hansen                      Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


Example #12 Firewall, Hiding System Names Behind the Firewall:
C: TRACK &lt;12345-20010101@example.com&gt; YWJjZGVmZ2gK
S: +OK+ Tracking information follows
S: Content-Type: multipart/related; boundary=%%%%; type=tracking-status
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user1@example1.com
S: Action: relayed
S: Status: 2.1.9
S: Remote-MTA: dns; example2.com
S: Last-Attempt-Date: Mon, 1 Jan 2001 19:15:03 -0500
S:
S: --%%%%
S: Content-Type: message/tracking-status
S:
S: Original-Envelope-Id: 12345-20010101@example.com
S: Reporting-MTA: dns; example2.com
S: Arrival-Date: Mon,  1 Jan 2001 15:15:15 -0500
S:
S: Original-Recipient: <a href="rfc822.html">rfc822</a>; user2@example1.com
S: Final-Recipient: <a href="rfc822.html">rfc822</a>; user4@example1.com
S: Action: delivered
S: Status: 2.5.0
S:
S: --%%%%--
S: .

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20COMMENT%20Command"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  COMMENT Command</span>

   Syntax:

     comment-command =  "COMMENT" opt-text CRLF
            opt-text = [WSP *(VCHAR / WSP)]

   When the client issues the COMMENT command, the MTQP server MUST
   respond with a successful response (+OK or +OK+).  All optional text
   provided with the COMMENT command are ignored.







<span class="grey">Hansen                      Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20STARTTLS%20Command"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  STARTTLS Command</span>

   Syntax:

     starttls-command = "STARTTLS" 1*WSP domain *WSP CRLF
               domain = (sub-domain 1*("." sub-domain))

   TLS [<a href="#ref-TLS" title='"The TLS Protocol Version 1.0"'>TLS</a>] is a popular mechanism for enhancing TCP communications
   with confidentiality and authentication.  All MTQP servers MUST
   implement TLS.  However, TLS MAY be disabled by a server
   administrator, either explicitly or by failing to install any
   certificates for TLS to use.  If an MTQP server supports TLS and has
   one or more certificates available it MUST include "STARTTLS" in the
   option specifications list on protocol startup.

      Note: TLS SHOULD be enabled on MQTP servers whenever possible.

   The parameter MUST be a fully qualified domain name (FQDN).  A client
   MUST specify the hostname it believes it is speaking with so that the
   server may respond with the proper TLS certificate.  This is useful
   for virtual servers that provide message tracking for multiple
   domains (i.e., virtual hosting).

   If the server returns a negative response, it MAY use one of the
   following response codes:
      "/" "unsupported"
      "/" "unavailable"
      "/" "tls-in-progress"
      "/" "bad-fqdn"

   If TLS is not supported, then a response code of "/unsupported"
   SHOULD be used.  If TLS is not available for some other reason, then
   a response code of "/unavailable" SHOULD be used.  If a TLS session
   is already in progress, then it is a protocol error and "-BAD" MUST
   be returned with a response code of "/tls-in-progress".  If there is
   a mismatch between the supplied FQDN and the FQDN found in the
   dNSName field of the subjectAltName extension of the server's
   certificate [<a href="#ref-RFC-X509" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC-X509</a>], then it is a protocol error and "-BAD" MUST
   be returned with a response code of "/bad-fqdn".

   After receiving a positive response to a STARTTLS command, the client
   MUST start the TLS negotiation before giving any other MTQP commands.

   If the MTQP client is using pipelining (see below), the STARTTLS
   command must be the last command in a group.






<span class="grey">Hansen                      Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Processing%20After%20the%20STARTTLS%20Command"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Processing After the STARTTLS Command</span>

   If the TLS handshake fails, the server SHOULD abort the connection.

   After the TLS handshake has been completed, both parties MUST
   immediately decide whether or not to continue based on the
   authentication and confidentiality achieved.  The MTQP client and
   server may decide to move ahead even if the TLS negotiation ended
   with no authentication and/or no confidentiality because most MTQP
   services are performed with no authentication and no confidentiality,
   but some MTQP clients or servers may want to continue only if a
   particular level of authentication and/or confidentiality was
   achieved.

   If the MTQP client decides that the level of authentication or
   confidentiality is not high enough for it to continue, it SHOULD
   issue an MTQP QUIT command immediately after the TLS negotiation is
   complete.

   If the MTQP server decides that the level of authentication or
   confidentiality is not high enough for it to continue, it MAY abort
   the connection.  If it decides that the level of authentication or
   confidentiality is not high enough for it to continue, and it does
   not abort the connection, it SHOULD reply to every MTQP command from
   the client (other than a QUIT command) with a negative "-ERR"
   response and a response code of "/insecure".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Result%20of%20the%20STARTTLS%20Command"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Result of the STARTTLS Command</span>

   Upon completion of the TLS handshake, the MTQP protocol is reset to
   the initial state (the state in MTQP after a server starts up).  The
   server MUST discard any knowledge obtained from the client prior to
   the TLS negotiation itself.  The client MUST discard any knowledge
   obtained from the server, such as the list of MTQP options, which was
   not obtained from the TLS negotiation itself.

   At the end of the TLS handshake, the server acts as if the connection
   had been initiated and responds with an initial status response and,
   optionally, a list of server options.  The list of MTQP server
   options received after the TLS handshake MUST be different than the
   list returned before the TLS handshake.  In particular, a server MUST
   NOT return the STARTTLS option in the list of server options after a
   TLS handshake has been completed.

   Both the client and the server MUST know if there is a TLS session
   active.  A client MUST NOT attempt to start a TLS session if a TLS
   session is already active.




<span class="grey">Hansen                      Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20QUIT%20Command"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  QUIT Command</span>

      Syntax:

        quit-command = "QUIT" CRLF

   When the client issues the QUIT command, the MTQP session terminates.
   The QUIT command has no parameters.  The server MUST respond with a
   successful response.  The client MAY close the session from its end
   immediately after issuing this command (if the client is on an
   operating system where this does not cause problems).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Pipelining"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Pipelining</span>

   The MTQP client may elect to transmit groups of MTQP commands in
   batches without waiting for a response to each individual command.
   The MTQP server MUST process the commands in the order received.

   Specific commands may place further constraints on pipelining.  For
   example, STARTTLS must be the last command in a batch of MTQP
   commands.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Examples"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Examples</span>

   The following two examples are identical:

   Example #13 :
   C: TRACK &lt;tracking-id&gt; YWJjZGVmZ2gK
   S: +OK+ Tracking information follows
   S:
   S: ... tracking details #1      go here ...
   S: .
   C: TRACK &lt;tracking-id-2&gt; QUJDREVGR0gK
   S: +OK+ Tracking information follows
   S:
   S: ... tracking details #2      go here ...
   S: .














<span class="grey">Hansen                      Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


   Example #14 :
   C: TRACK &lt;tracking-id&gt; YWJjZGVmZ2gK
   C: TRACK &lt;tracking-id-2&gt; QUJDREVGR0gK
   S: +OK+ Tracking information follows
   S:
   S: ... tracking details #1      go here ...
   S: .
   S: +OK+ Tracking information follows
   S:
   S: ... tracking details #2      go here ...
   S: .

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20The%20MTQP%20URI%20Scheme"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  The MTQP URI Scheme</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Intended%20usage"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Intended usage</span>

   The MTQP URI scheme is used to designate MTQP servers on Internet
   hosts accessible using the MTQP protocol.  It performs an MTQP query
   and returns tracking status information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20URI%20Scheme%20Name"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  URI Scheme Name</span>

   The name of the URI scheme is "mtqp".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20URI%20Scheme%20Syntax"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  URI Scheme Syntax</span>

   An MTQP URI takes one of the following forms:

      mtqp://&lt;mserver&gt;/track/&lt;unique-envid&gt;/&lt;mtrk-secret&gt;
      mtqp://&lt;mserver&gt;:&lt;port&gt;/track/&lt;unique-envid&gt;/&lt;mtrk-secret&gt;

   The first form is used to refer to an MTQP server on the standard
   port, while the second form specifies a non-standard port.  Both of
   these forms specify that the TRACK command is to be issued using the
   given tracking id (unique-envid) and authorization secret (mtrk-
   secret).  The path element "/track/" MUST BE treated case
   insensitively, but the unique-envid and mtrk-secret MUST NOT be.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.1.%20%20Formal%20Syntax"></a><a class="selflink" href="#section-9.3.1" name="section-9.3.1">9.3.1</a>.  Formal Syntax</span>

   This is an ABNF description of the MTQP URI.

   mtqp-uri = "mtqp://" authority "/track/" unique-envid "/" mtrk-secret








<span class="grey">Hansen                      Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Encoding%20Rules"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Encoding Rules</span>

   The encoding of unique-envid is discussed in [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>].
   Mtrk-secret is required to be base64 encoded.  If the "/", "?" and
   "%" octets appear in unique-envid or mtrk-secret, they are further
   required to be represented by a "%" followed by two hexadecimal
   characters.  (The two characters give the hexadecimal representation
   of that octet).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  IANA Considerations</span>

   System port number 1038 has been assigned to the Message Tracking
   Query Protocol by the Internet Assigned Numbers Authority (IANA).

   The service name "MTQP" has been registered with the IANA.

   The IANA has also registered the URI registration template found in
   <a href="#appendix-A">Appendix A</a> in accordance with [<a href="#ref-BCP35" title='"Registration Procedures for URL Scheme Names"'>BCP35</a>].

   This document requests that IANA maintain one new registry: MTQP
   options.  The registry's purpose is to register options to this
   protocol.  Options whose names do not begin with "vnd." MUST be
   defined in a standards track or IESG approved experimental RFC.  New
   MTQP options MUST include the following information as part of their
   definition:

      option identifier
      option parameters
      added commands
      standard commands affected
      specification reference
      discussion

   One MTQP option is defined in this document, with the following
   registration definition:

      option identifier: STARTTLS
      option parameters: none
      added commands: STARTTLS
      standard commands affected: none
      specification reference: <a href="rfc3887.html">RFC 3887</a>
      discussion: see <a href="rfc3887.html">RFC 3887</a>

   Additional vendor-specific options for this protocol have names that
   begin with "vnd.".  After the "vnd." would appear the reversed domain
   name of the vendor, another dot ".", and a name for the option
   itself.  For example, "vnd.com.example.extinfo" might represent a




<span class="grey">Hansen                      Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


   vendor-specific extension providing extended information by the owner
   of the "example.com" domain.  These names MAY be registered with
   IANA.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Security%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Security Considerations</span>

   If the originator of a message were to delegate his or her tracking
   request to a third party, this would be vulnerable to snooping over
   unencrypted sessions.  The user can decide on a message-by-message
   basis if this risk is acceptable.

   The security of tracking information is dependent on the randomness
   of the secret chosen for each message and the level of exposure of
   that secret.  If different secrets are used for each message, then
   the maximum exposure from tracking any message will be that single
   message for the time that the tracking information is kept on any
   MTQP server.  If this level of exposure is too much, TLS may be used
   to reduce the exposure further.

   It should be noted that message tracking is not an end-to-end
   mechanism.  Thus, if an MTQP client/server pair decide to use TLS
   confidentiality, they are not securing tracking queries with any
   prior or successive MTQP servers.

   Both the MTQP client and server must check the result of the TLS
   negotiation to see whether acceptable authentication or
   confidentiality was achieved.  Ignoring this step completely
   invalidates using TLS for security.  The decision about whether
   acceptable authentication or confidentiality was achieved is made
   locally, is implementation-dependent, and is beyond the scope of this
   document.

   The MTQP client and server should note carefully the result of the
   TLS negotiation.  If the negotiation results in no confidentiality,
   or if it results in confidentiality using algorithms or key lengths
   that are deemed not strong enough, or if the authentication is not
   good enough for either party, the client may choose to end the MTQP
   session with an immediate QUIT command, or the server may choose to
   not accept any more MTQP commands.

   A man-in-the-middle attack can be launched by deleting the "STARTTLS"
   option response from the server.  This would cause the client not to
   try to start a TLS session.  An MTQP client can protect against this
   attack by recording the fact that a particular MTQP server offers TLS
   during one session and generating an alarm if it does not appear in
   an option response for a later session.





<span class="grey">Hansen                      Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


   Similarly, the identity of the server as expressed in the server's
   certificate should be cached, and an alarm generated if they do not
   match in a later session.

   If TLS is not used, a tracking request is vulnerable to replay
   attacks, such that a snoop can later replay the same handshake again
   to potentially gain more information about a message's status.

   Before the TLS handshake has begun, any protocol interactions are
   performed in the clear and may be modified by an active attacker.
   For this reason, clients and servers MUST discard any knowledge
   obtained prior to the start of the TLS handshake upon completion of
   the TLS handshake.

   If a client/server pair successfully performs a TLS handshake and the
   server does chaining referrals, then the server SHOULD attempt to
   negotiate TLS at the same (or better) security level at the next hop.
   In a hop-by-hop scenario, STARTTLS is a request for "best effort"
   security and should be treated as such.

   SASL is not used because authentication is per message rather than
   per user.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Protocol%20Syntax"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Protocol Syntax</span>

   This is a collected ABNF description of the MTQP protocol.

mtqp-uri = "mtqp://" authority "/track/" unique-envid "/" mtrk-secret

conversation = command-response *(client-command command-response)

; client side
client-command = track-command / starttls-command / quit-command
/comment-command

track-command = "TRACK" 1*WSP unique-envid 1*WSP mtrk-secret CRLF
mtrk-secret = base64

starttls-command = "STARTTLS" 1*WSP domain *WSP CRLF
domain = (sub-domain 1*("." sub-domain))

quit-command = "QUIT" CRLF

comment-command = "COMMENT" opt-text CRLF







<span class="grey">Hansen                      Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


; server side
command-response = success-response / temp-response / error-response /
bad-response

temp-response = "-TEMP" response-info opt-text CRLF

opt-text = [WSP *(VCHAR / WSP)]

error-response = "-ERR" response-info opt-text CRLF

bad-response = "-BAD" response-info opt-text CRLF

success-response = single-line-success / multi-line-success

single-line-success = "+OK" response-info opt-text CRLF

multi-line-success = "+OK+" response-info opt-text CRLF
                               *dataline dotcrlf

dataline = *998OCTET CRLF

dotcrlf = "." CRLF

NAMECHAR = ALPHA / DIGIT / "-" / "_"

response-info = *(      "/" ( "admin" / "unavailable" / "unsupported"
/ "tls-in-progress" / "insecure" / "tls-required" / 1*NAMECHAR ) )

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Acknowledgements"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Acknowledgements</span>

   The description of STARTTLS is based on [<a href="#ref-RFC-SMTP-TLS" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>RFC-SMTP-TLS</a>].




















<span class="grey">Hansen                      Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20References"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.1.%20%20Normative%20References"></a><a class="selflink" href="#section-14.1" name="section-14.1">14.1</a>.  Normative References</span>

   [<a id="ref-RFC-MIME" name="ref-RFC-MIME">RFC-MIME</a>]         Freed, N. and N. Borenstein, "Multipurpose
                      Internet Mail Extensions (MIME) Part One: Format
                      of Internet Message Bodies", <a href="rfc2045.html">RFC 2045</a>, November
                      1996.

   [<a id="ref-RFC-ABNF" name="ref-RFC-ABNF">RFC-ABNF</a>]         Crocker, D., Ed. and P. Overell, "Augmented BNF
                      for Syntax Specifications: ABNF", <a href="rfc2234.html">RFC 2234</a>,
                      November 1997.

   [<a id="ref-RFC-SRV" name="ref-RFC-SRV">RFC-SRV</a>]          Gulbrandsen, A., Vixie, P., and L. Esibov, "A DNS
                      RR for specifying the location of services (DNS
                      SRV)", <a href="rfc2782.html">RFC 2782</a>, February 2000.

   [<a id="ref-RFC-SMTP" name="ref-RFC-SMTP">RFC-SMTP</a>]         Klensin, J., "Simple Mail Transfer Protocol", <a href="rfc2821.html">RFC</a>
                      <a href="rfc2821.html">2821</a>, April 2001.

   [<a id="ref-RFC-SMTPEXT" name="ref-RFC-SMTPEXT">RFC-SMTPEXT</a>]      Myers, J., "SMTP Service Extension for
                      Authentication", <a href="rfc2554.html">RFC 2554</a>, March 1999.

   [<a id="ref-RFC-MTRK-ESMTP" name="ref-RFC-MTRK-ESMTP">RFC-MTRK-ESMTP</a>]   Allman, E. and T. Hansen, "SMTP Service Extension
                      for Message Tracking", <a href="rfc3885.html">RFC 3885</a>, September 2004.

   [<a id="ref-RFC-MTRK-MODEL" name="ref-RFC-MTRK-MODEL">RFC-MTRK-MODEL</a>]   Hansen, T., "Message Tracking Models and
                      Requirements", <a href="rfc3885.html">RFC 3885</a>, September 2004.

   [<a id="ref-RFC-MTRK-TSN" name="ref-RFC-MTRK-TSN">RFC-MTRK-TSN</a>]     Allman, E., "The Message/Tracking-Status MIME
                      Extension", <a href="rfc3886.html">RFC 3886</a>, September 2004.

   [<a id="ref-RFC-URI" name="ref-RFC-URI">RFC-URI</a>]          Berners-Lee, T., Fielding, R. and L. Masinter,
                      "Uniform Resource Identifiers (URI): Generic
                      Syntax", <a href="rfc2396.html">RFC 2396</a>, August 1998.

   [<a id="ref-TLS" name="ref-TLS">TLS</a>]              Dierks, T. and C. Allen, "The TLS Protocol Version
                      1.0", <a href="rfc2246.html">RFC 2246</a>, January 1999.













<span class="grey">Hansen                      Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.2.%20%20Informational%20References"></a><a class="selflink" href="#section-14.2" name="section-14.2">14.2</a>.  Informational References</span>

   [<a id="ref-BCP35" name="ref-BCP35">BCP35</a>]            Petke, R. and I. King, "Registration Procedures
                      for URL Scheme Names", <a href="https://tools.ietf.org/html/bcp35">BCP 35</a>, <a href="rfc2717.html">RFC 2717</a>, November
                      1999.

   [<a id="ref-RFC-SHA1" name="ref-RFC-SHA1">RFC-SHA1</a>]         Eastlake, D. and P. Jones, "US Secure Hash
                      Algorithm 1 (SHA1)", <a href="rfc3174.html">RFC 3174</a>, September 2001.

   [<a id="ref-RFC-KEYWORDS" name="ref-RFC-KEYWORDS">RFC-KEYWORDS</a>]     Bradner, S., "Key words for use in RFCs to
                      Indicate Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
                      March 1997.

   [<a id="ref-RFC-SMTP-TLS" name="ref-RFC-SMTP-TLS">RFC-SMTP-TLS</a>]     Hoffman, P., "SMTP Service Extension for Secure
                      SMTP over Transport Layer Security", <a href="rfc3207.html">RFC 3207</a>,
                      February 2002.

   [<a id="ref-RFC-X509" name="ref-RFC-X509">RFC-X509</a>]         Housley, R., Polk, W., Ford, W. and D. Solo,
                      "Internet X.509 Public Key Infrastructure
                      Certificate and Certificate Revocation List (CRL)
                      Profile", <a href="rfc3280.html">RFC 3280</a>, April 2002.

   [<a id="ref-POP3" name="ref-POP3">POP3</a>]             Myers, J. and M. Rose, "Post Office Protocol -
                      Version 3", STD 53, <a href="rfc1939.html">RFC 1939</a>, May 1996.

   [<a id="ref-NNTP" name="ref-NNTP">NNTP</a>]             Kantor, B. and P. Lapsley, "Network News Transfer
                      Protocol", <a href="rfc977.html">RFC 977</a>, February 1986.
























<span class="grey">Hansen                      Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20MTQP%20URI%20Registration%20Template"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>. MTQP URI Registration Template</span>

   Scheme name: mtqp

   Scheme syntax: see <a href="#section-9.1">section 9.1</a>

   Character encoding considerations: see <a href="#section-9.4">section 9.4</a>

   Intended usage: see <a href="#section-9.3">section 9.3</a>

   Applications and/or protocols which use this scheme: MTQP

   Interoperability considerations: as specified for MTQP

   Security considerations: see <a href="#section-11.0">section 11.0</a>

   Relevant publications: [<a href="#ref-RFC-MTRK-ESMTP" title='"SMTP Service Extension for Message Tracking"'>RFC-MTRK-ESMTP</a>], [<a href="#ref-RFC-MTRK-MODEL" title='"Message Tracking Models and Requirements"'>RFC-MTRK-MODEL</a>],
   [<a href="#ref-RFC-MTRK-TSN" title='"The Message/Tracking-Status MIME Extension"'>RFC-MTRK-TSN</a>]

   Contact: MSGTRK Working Group

   Author/Change Controller: IESG

Author's Address

   Tony Hansen
   AT&amp;T Laboratories
   Middletown, NJ 07748
   USA

   Phone: +1.732.420.8934
   EMail: tony+msgtrk@maillennium.att.com



















<span class="grey">Hansen                      Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc3887.html">RFC 3887</a>            Message Tracking Query Protocol       September 2004</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2004).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/S HE
   REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE
   INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the IETF's procedures with respect to rights in IETF Documents can
   be found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







Hansen                      Standards Track                    [Page 23]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3887 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:45 GMT --></html>