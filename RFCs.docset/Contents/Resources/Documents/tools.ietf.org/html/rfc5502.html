<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from tools.ietf.org/html/rfc5502 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:58:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129c" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:rfc:5502" />
<meta name="DC.Description.Abstract" content="This document specifies the SIP P-Served-User P-header. This header
field addresses an issue that was found in the 3rd Generation
Partnership Project (3GPP) IMS (IP Multimedia Subsystem) between an
S-CSCF (Serving Call Session Control Function) and an AS (Application
Server) on the ISC (IMS Service Control) interface. This header field
conveys the identity of the served user and the session case that
applies to this particular communication session and application
invocation. This memo provides information for the Internet community." />
<meta name="DC.Creator" content="J. van Elburg" />
<meta name="DC.Date.Issued" content="April, 2009" />
<meta name="DC.Title" content="The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem" />

    <link rel="icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 5502 - The SIP P-Served-User Private-Header (P-Header) for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgorange"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5502.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5502" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-vanelburg-sipping-served-user" title="draft-vanelburg-sipping-served-user">draft-vanelburg...</a>] [<a href='https://datatracker.ietf.org/doc/rfc5502' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5502" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5502" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=5502&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=5502">Errata</a>]</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">Updated by: <a href="rfc8217.html">8217</a>, <a href="rfc8498.html">8498</a>                                     INFORMATIONAL</span><br />
<span class="pre noprint docinfo">                                                            <span style='color: #C00;'>Errata Exist</span></span><br />
<pre>
Network Working Group                                      J. van Elburg
Request for Comments: 5502                Ericsson Telecommunicatie B.V.
Category: Informational                                       April 2009


            <span class="h1">The SIP P-Served-User Private-Header (P-Header)</span>
      <span class="h1">for the 3GPP IP Multimedia (IM) Core Network (CN) Subsystem</span>

Status of This Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents in effect on the date of
   publication of this document (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>).
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Abstract

   This document specifies the SIP P-Served-User P-header.  This header
   field addresses an issue that was found in the 3rd Generation
   Partnership Project (3GPP) IMS (IP Multimedia Subsystem) between an
   S-CSCF (Serving Call Session Control Function) and an AS (Application
   Server) on the ISC (IMS Service Control) interface.  This header
   field conveys the identity of the served user and the session case
   that applies to this particular communication session and application
   invocation.




<span class="grey">van Elburg                   Informational                      [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions .....................................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Definitions .....................................................<a href="#page-3">3</a>
      3.1. Identity, Network Asserted Identity, Trust Domain,
           and Spec(T) ................................................<a href="#page-3">3</a>
      <a href="#section-3.2">3.2</a>. Served User ................................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. Scenarios .......................................................<a href="#page-4">4</a>
      <a href="#section-4.1">4.1</a>. General ....................................................<a href="#page-4">4</a>
      4.2. Diversion: Continue on Terminating Leg, but Finish
           Subsequent Terminating iFC First ...........................<a href="#page-5">5</a>
      4.3. Diversion: Create New Originating Leg and Provide
           Originating iFC Processing .................................<a href="#page-6">6</a>
      4.4. Call Out of the Blue: on Behalf of User B, but
           Service Profile of Service Identity C.......................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. Requirements ....................................................<a href="#page-8">8</a>
   <a href="#section-6">6</a>. P-Served-User Header Field Definition ...........................<a href="#page-9">9</a>
   <a href="#section-7">7</a>. Proxy Behavior ..................................................<a href="#page-9">9</a>
      <a href="#section-7.1">7.1</a>. Generating the P-Served-User Header ........................<a href="#page-9">9</a>
      <a href="#section-7.2">7.2</a>. Consuming the P-Served-User Header ........................<a href="#page-10">10</a>
   <a href="#section-8">8</a>. Applicability ..................................................<a href="#page-10">10</a>
   <a href="#section-9">9</a>. IANA Considerations ............................................<a href="#page-11">11</a>
   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-11">11</a>
   <a href="#section-11">11</a>. Acknowledgments ...............................................<a href="#page-11">11</a>
   <a href="#section-12">12</a>. References ....................................................<a href="#page-12">12</a>
      <a href="#section-12.1">12.1</a>. Normative References .....................................<a href="#page-12">12</a>
      <a href="#section-12.2">12.2</a>. Informative References ...................................<a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>.  Why the History-Info Header Is Not Suitable to
                Convey the Served User Information on the ISC
                Interface ............................................<a href="#page-13">13</a>
     <a href="#appendix-A.1">A.1</a>.  Semantics  ................................................<a href="#page-13">13</a>
     <a href="#appendix-A.2">A.2</a>.  Additional Observations  ..................................<a href="#page-13">13</a>
     <a href="#appendix-A.3">A.3</a>.  Conclusion ................................................<a href="#page-14">14</a>

















<span class="grey">van Elburg                   Informational                      [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   The 3rd Generation Partnership Project (3GPP) IMS (IP Multimedia
   Subsystem) uses SIP (<a href="rfc3261.html">RFC 3261</a> [<a href="#ref-2" title="&quot;SIP: Session Initiation Protocol&quot;">2</a>]) as its main signaling protocol.
   (For more information on the IMS, a detailed description can be found
   in 3GPP TS 23.228 [<a href="#ref-9" title="&quot;IP Multimedia Subsystem (IMS); Stage 2&quot;">9</a>] and 3GPP TS 24.229 [<a href="#ref-11" title="&quot;Internet Protocol (IP) multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3&quot;">11</a>].) 3GPP has identified
   issues with the linking in of a SIP application server that are most
   appropriately resolved by defining a new SIP P-header, according to
   the procedures in <a href="rfc3427.html">RFC 3427</a> [<a href="#ref-5" title="&quot;Change Process for the Session Initiation Protocol (SIP)&quot;">5</a>].

   The remainder of this document is organized as follows.  <a href="#section-4">Section 4</a>
   outlines the problem by using particular service scenarios, and
   <a href="#section-5">Section 5</a> discusses the requirements derived from these scenarios.
   <a href="#section-6">Section 6</a> defines the P-Served-User header field, which meets those
   requirements, <a href="#section-7">Section 7</a> specifies the proxy behavior for the new
   header field, and <a href="#section-8">Section 8</a> discusses the applicability and scope of
   this new header field.  <a href="#section-9">Section 9</a> registers the P-Served-User header
   field with the IANA, and <a href="#section-10">Section 10</a> discusses the security properties
   of the environment where this header field is intended to be used.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a> [<a href="#ref-1" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">1</a>].

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Definitions</span>

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Identity, Network Asserted Identity, Trust Domain, and Spec(T)</span>

   The terms Identity, Network Asserted Identity, Trust Domain, and
   Spec(T) in this document are specified in <a href="rfc3324.html">RFC 3324</a> [<a href="#ref-3" title="&quot;Short Term Requirements for Network Asserted Identity&quot;">3</a>].

<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>.  Served User</span>

   The served user to a proxy or AS (Application Server) is the user
   whose service profile is accessed by that proxy or AS when an initial
   request is received that is originated by, originated on behalf of,
   or terminated to that user.  This profile in turn provides some
   useful information (preferences or permissions) for processing at a
   proxy and, potentially, at an AS.










<span class="grey">van Elburg                   Informational                      [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Scenarios</span>

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  General</span>

   In the 3GPP IMS (IP Multimedia Subsystem), the S-CSCF (Serving CSCF)
   is a SIP proxy that serves as a registrar and handles originating and
   terminating session states for users allocated to it.  This means
   that any call that is originated by a specific user or any call that
   is terminated to that specific user will pass through the S-CSCF that
   is allocated to that user.

   At the moment that an S-CSCF is allocated for a specific user, a user
   profile is downloaded to the S-CSCF from the HSS (Home Subscriber
   Server) over the Cx interface, see 3GPP TS 29.228 [<a href="#ref-12" title="&quot;IP Multimedia (IM) Subsystem Cx and Dx interfaces; Signalling flows and message contents&quot;">12</a>].  This user
   profile tells the S-CSCF whether the user is allowed to originate or
   terminate calls or whether an AS needs to be linked in over the ISC
   interface.  The user profile information that determines whether a
   particular initial request needs to be sent to a particular AS is
   called the initial Filter Criteria (iFC), see for example 3GPP TS
   23.218 [<a href="#ref-8" title="&quot;IP Multimedia (IM) session handling; IM call model; Stage 2&quot;">8</a>].

   For an S-CSCF to be able to meet its responsibilities, it needs to
   determine on which user's behalf it is performing its tasks and which
   session case is applicable for the particular request.  (For a
   definition of session case, see 3GPP TS 29.228 [<a href="#ref-12" title="&quot;IP Multimedia (IM) Subsystem Cx and Dx interfaces; Signalling flows and message contents&quot;">12</a>]).  The session
   case distinguishes the originating and terminating call cases and
   determines whether or not the particular user is registered.

   When the S-CSCF determines that for an incoming initial request the
   originating call case applies, it determines the served user by
   looking at the P-Asserted-Identity header field (<a href="rfc3325.html">RFC 3325</a> [<a href="#ref-4" title="&quot;Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks&quot;">4</a>]), which
   carries the network asserted identity of the originating user.  When,
   after processing the iFC for this initial request, the S-CSCF decides
   to forward the request to an AS, the AS has to go through a similar
   process of determining the session case and the served user.  Since
   it should come to the same conclusion that this is an originating
   session case, it also has to look at the P-Asserted-Identity header
   field to determine the served user.

   When the S-CSCF determines that for an incoming initial request the
   terminating call case applies, it determines the served user by
   looking at the Request-URI (<a href="rfc3261.html">RFC 3261</a> [<a href="#ref-2" title="&quot;SIP: Session Initiation Protocol&quot;">2</a>]), which carries the identity
   of the intended terminating user.  When, after processing the iFC for
   this initial request, the S-CSCF decides to forward the request to an
   AS, the AS has to go through a similar process of determining the
   session case and the served user.  Since it should come to the same
   conclusion that this is a terminating session case, it also has to
   look at the Request-URI to determine the served user.



<span class="grey">van Elburg                   Informational                      [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


   In the originating case, it can be observed that while the
   P-Asserted-Identity header field just represents the originating user
   when it enters the S-CSCF, it is overloaded with another meaning when
   it is sent to an AS over the ISC interface.  This other meaning is
   that it serves as a representation of the served user.

   In the terminating case, a similar overloading happens to the
   Request-URI; while it first only represented the identity of the
   intended terminating user, it is overloaded with another meaning when
   it is sent to an AS over the ISC interface.  This other meaning is
   that it serves as a representation of the served user.

   In basic call scenarios, this does not show up as a problem, but once
   more complicated service scenarios (notably forwarding services) need
   to be realized, it poses severe limitations.  Such scenarios are
   brought forward in the following subsections.

<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  Diversion: Continue on Terminating Leg, but Finish Subsequent</span>
<span class="h3">      Terminating iFC First</span>

   Imagine a service scenario where a user B has a terminating service
   that diverts the call to a different destination but is required to
   still execute subsequent terminating services for the same user.
   This means that this particular user has multiple iFC configured that
   are applicable for an incoming initial request.  When the S-CSCF
   receives an initial INVITE request, it analyzes the request and
   determines that the session case is for a terminating registered
   user, then it determines the served user to be user B by looking at
   the Request-URI.

   Now the S-CSCF starts the iFC processing.  The first iFC that matches
   the INVITE request causes the INVITE to be forwarded over the ISC
   interface to an AS that hosts user B's diversion service by adding
   the AS and S-CSCF's own hostnames to the Route header.  The S-CSCF
   adds an Original Dialog Identifier (ODI) to the S-CSCF's own hostname
   on the Route header.  This allows the S-CSCF to correlate an INVITE
   coming from an AS over the ISC interface to the existing session that
   forwarded the INVITE to the AS in the first place.

   When the AS receives the initial INVITE request, it analyzes the
   request and determines that the session case is for a terminating
   registered user, then it determines the served user to be user B by
   looking at the Request-URI.  Based on some criteria, the diversion
   service concludes that the request needs to be diverted to another
   user or application C.  It does this by changing the Request-URI to
   C.  Optionally, it records the Request-URI history by using the
   History- Info header field (<a href="rfc4244.html">RFC 4244</a> [<a href="#ref-7" title="&quot;An Extension to the Session Initiation Protocol (SIP) for Request History Information&quot;">7</a>]).  Then the AS removes




<span class="grey">van Elburg                   Informational                      [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


   itself from the Route header and routes the INVITE request back to
   the S-CSCF by using the topmost Route header field.

   When the S-CSCF receives the INVITE over the ISC interface, it can
   see that the Route header contains its own hostname and an ODI that
   correlates to an existing terminating session for user B.  This can
   be used by the S-CSCF to analyze whether there are still unexecuted
   iFC.  (Note that the current behavior of the S-CSCF on receiving an
   INVITE with a changed Request-URI is to terminate the iFC processing
   and to route the request based on the new Request-URI value.)

   The process repeats itself.  The INVITE is forwarded to the AS that
   is associated with this particular iFC.  When the AS receives the
   initial INVITE request, it analyzes the request and determines that
   the session case is for a terminating registered user, then it
   determines the served user to be user C by looking at the Request-
   URI.  This is clearly wrong, as the user being served is still user
   B.

   This scenario clearly shows the problem that occurs when the Request-
   URI is overloaded with the meanings "intended target identity" and
   "served user" with the operation as described in <a href="#section-4.1">Section 4.1</a>.  And it
   shows that this use case can not be realized without introducing a
   mechanism that conveys information about the served user from the
   S-CSCF to the AS.  Use of the History-Info element does not solve
   this problem as it does not tell the AS which user is being served;
   it just presents a history of diversions that might not be even
   caused by the systems serving this particular user.  A more detailed
   analysis on why the History-Info header field can't be used is
   provided in <a href="#appendix-A">Appendix A</a>.

<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  Diversion: Create New Originating Leg and Provide Originating iFC</span>
<span class="h3">      Processing</span>

   Imagine a service scenario where a user B has a terminating service
   that diverts the call to a different destination.  It is required
   that a forwarded call leg is handled as an originating call leg and
   that originating services for user B are executed.  This means that
   this particular user has one or more iFC configured that are
   applicable for an outgoing initial request.

   When the S-CSCF receives an initial INVITE request, it analyzes the
   request and determines that the session case is for a terminating
   registered user, then it determines the served user to be user B by
   looking at the Request-URI.






<span class="grey">van Elburg                   Informational                      [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


   Now the S-CSCF starts the iFC processing.  The first iFC that matches
   the INVITE request causes the INVITE to be forwarded over the ISC
   interface to an AS that hosts user B's diversion service by adding
   the AS and S-CSCF's own hostnames to the Route header.  The S-CSCF
   adds an Original Dialog Identifier (ODI) to the S-CSCF's own hostname
   on the Route header.  This allows the S-CSCF to correlate an INVITE
   coming from an AS over the ISC interface to the existing session that
   forwarded the INVITE to the AS in the first place.

   When the AS receives the initial INVITE request, it analyzes the
   request and determines that the session case is for a terminating
   registered user, then it determines the served user to be user B by
   looking at the Request-URI.  Based on some criteria, the diversion
   service concludes that the request needs to be diverted to another
   user or application C.  It does this by changing the Request-URI to
   C.  Optionally, it records the Request-URI history by using the
   History-Info header field (<a href="rfc4244.html">RFC 4244</a> [<a href="#ref-7" title="&quot;An Extension to the Session Initiation Protocol (SIP) for Request History Information&quot;">7</a>]).  Then the AS removes itself
   from the Route header.  To make sure that the request is handled as a
   new originating call on behalf of user B, the AS adds the "orig"
   parameter to the topmost route header.  Then it routes the INVITE
   request back to the S-CSCF by using this topmost Route header field.

   When the S-CSCF receives the INVITE over the ISC interface, it can
   see that the topmost Route header contains its own hostname and an
   "orig" parameter.  Because the topmost Route header contains the
   "orig" parameter, the S-CSCF concludes that the INVITE should be
   handled as if a call is originated by the served user.  The served
   user is determined from the P-Asserted-Identity header to be user A.
    This is clearly wrong, as the user being served is and should be
   user B.

   For the sake of discussion, let's assume that the S-CSCF can
   determine that the served user is user B.  Then the procedure would
   continue as follows: The S-CSCF starts the originating iFC
   processing, the first iFC that matches the INVITE request causes the
   INVITE to be forwarded over the ISC interface to an AS that hosts an
   originating service of user B by adding the AS and S-CSCF's own
   hostnames to the Route header.  The S-CSCF adds an Original Dialog
   Identifier (ODI) to the S-CSCF's own hostname on the Route header.

   The INVITE is forwarded to the AS that is associated with this
   particular iFC.  When the AS receives the initial INVITE request, it
   analyzes the request and determines that the session case is for an
   originating registered user, then it determines the served user to be
   user A by looking at the P-Asserted-Identity.  This is clearly wrong,
   as the user being served is and should be user B.





<span class="grey">van Elburg                   Informational                      [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


   This scenario clearly shows the problem that occurs when the
   P-Asserted-Identity is overloaded with the meanings "call originator"
   and "served user" with the operation as described in <a href="#section-4.1">Section 4.1</a>.
   And it shows that this use case can not be realized without
   introducing a mechanism that conveys information about the served
   user from the S-CSCF to the AS and from the AS to the S-CSCF.  Use of
   the History-Info element does not solve this problem as it does not
   tell the AS which user is being served, but just presents a history
   of diversions that might not be even caused by the systems serving
   this particular user.  A more detailed analysis on why the History-
   Info header field can't be used is provided in <a href="#appendix-A">Appendix A</a>.

<span class="h3"><a class="selflink" name="section-4.4" href="#section-4.4">4.4</a>.  Call Out of the Blue: on Behalf of User B, but Service Profile of</span>
<span class="h3">      Service Identity C</span>

   There are services that need to be able to initiate a call, whereby
   the call appears to be coming from a user B but the service profile
   on behalf of service identity C needs to be executed in the S-CSCF.

   When a call needs to appear as coming from user B, that means that
   the P-Asserted-Identity needs to contain B's identity.  This is
   because the Originating Identity Presentation (OIP) service as
   defined in 3GPP TS 24.173 [<a href="#ref-10" title="&quot;IMS multimedia telephony communication service and supplementary services; Stage 3&quot;">10</a>] uses the P-Asserted-Identity to
   present the call originator.  This makes sense because that is the
   main meaning expressed by the P-Asserted-Identity header field.

   It is clear that no INVITE request can be constructed currently that
   would achieve both requirements expressed in the first paragraph,
   because the P-Asserted-Identity is overloaded with two meanings on
   the ISC interface.  When the S-CSCF will receive this request, it
   will determine that the served user is user B, which is not what we
   want to achieve.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Requirements</span>

   This section lists the requirements derived from the previous
   scenarios:

   1.  To be able to offer real-world application services, it is
       required that the identity of the served user can be conveyed on
       the ISC interface (see 3GPP TS 23.218 [<a href="#ref-8" title="&quot;IP Multimedia (IM) session handling; IM call model; Stage 2&quot;">8</a>]).

   2.  To be able to offer appropriate services to the served user, it
       is required that in addition to the served user identity the
       session case is conveyed.






<span class="grey">van Elburg                   Informational                      [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  P-Served-User Header Field Definition</span>

   This document defines the SIP P-Served-User P-header.  This header
   field can be added to initial requests for a dialog or standalone
   requests, which are routed between nodes in a Trust Domain for
   P-Served-User.  The P-Served-User P-header contains an identity of
   the user that represents the served user.  The "sescase" parameter
   may be used to convey whether the initial request is originated by or
   destined for the served user.  The "regstate" parameter may be used
   to indicate whether the initial request is for a registered or
   unregistered user.

   The augmented Backus-Naur Form (BNF) (<a href="rfc5234.html">RFC 5234</a> [<a href="#ref-6" title="&quot;Augmented BNF for Syntax Specifications: ABNF&quot;">6</a>]) syntax of the
   P-Served-User header field is as follows:

   P-Served-User            = "P-Served-User" HCOLON PServedUser-value
                              *(SEMI served-user-param)
   served-user-param        = sessioncase-param
                              / registration-state-param
                              / generic-param
   PServedUser-value        = name-addr / addr-spec
   sessioncase-param        = "sescase" EQUAL "orig" / "term"
   registration-state-param = "regstate" EQUAL "unreg" / "reg"

   EQUAL, HCOLON, SEMI, name-addr, addr-spec, and generic-param are
   defined in <a href="rfc3261.html">RFC 3261</a> [<a href="#ref-2" title="&quot;SIP: Session Initiation Protocol&quot;">2</a>].

   The following is an example of a P-Served-User header field:

   P-Served-User: &lt;sip:user@example.com&gt;; sescase=orig; regstate=reg

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Proxy Behavior</span>

<span class="h3"><a class="selflink" name="section-7.1" href="#section-7.1">7.1</a>.  Generating the P-Served-User Header</span>

   Proxies that support the header MUST only insert the header in
   initial requests for a dialog or in standalone requests when the
   following conditions hold:

   o  The proxy has the capability to determine the served user for the
      current request.

   o  The next hop is part of the same Trust Domain for P-Served-User.

   When the above conditions do not hold, the proxy MUST NOT insert the
   header.





<span class="grey">van Elburg                   Informational                      [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h3"><a class="selflink" name="section-7.2" href="#section-7.2">7.2</a>.  Consuming the P-Served-User Header</span>

   A proxy that supports the header MUST, upon receiving from a trusted
   node the P-Served-User header in initial requests for a dialog or in
   standalone requests, take the value of the P-Served-User header to
   represent the served user in operations that require such
   information.

   A proxy that supports the header MUST remove the header from requests
   or responses when the header was received from a node outside the
   Trust Domain for P-Served-User before further forwarding the message.

   A proxy that supports the header MUST remove the header from requests
   or responses when the next hop is a node outside the Trust Domain for
   P-Served-User before further forwarding the message.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  Applicability</span>

   According to <a href="rfc3427.html">RFC 3427</a> [<a href="#ref-5" title="&quot;Change Process for the Session Initiation Protocol (SIP)&quot;">5</a>], P-headers have a limited applicability.
   Specifications of P-headers, such as this RFC, need to clearly
   document the useful scope of the proposal and explain its limitations
   and why it is not suitable for the general use of SIP on the
   Internet.

   The use of the P-Served-User header field extensions is only
   applicable inside a Trust Domain for served user.  Nodes in such a
   Trust Domain explicitly trust each other to convey the served user
   and to be responsible for withholding that information outside of the
   Trust Domain.  The means by which the network determines the served
   user and the policies that are executed for a specific served user is
   outside the scope of this document.

   The served user information lacks an indication of who or what
   specifically determined the served user, and so it must be assumed
   that the Trust Domain determined the served user.  Therefore, the
   information is only meaningful when securely received from a node
   known to be a member of the Trust Domain.

   Because the served user typically only has validity in one
   administrative domain, it is in general not suitable for inter-domain
   use or use in the Internet at large.

   Despite these limitations, there are sufficiently useful specialized
   deployments that meet the assumptions described above, and that can
   accept the limitations that result, to warrant informational
   publication of this mechanism.  An example deployment would be a
   closed network like 3GPP IMS.




<span class="grey">van Elburg                   Informational                     [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  IANA Considerations</span>

   This document defines a new SIP header field: P-Served-User.  This
   header field has been registered by the IANA in the SIP Parameters
   registry under the Header Fields subregistry.

<span class="h2"><a class="selflink" name="section-10" href="#section-10">10</a>.  Security Considerations</span>

   The P-Served-User header field defined in this document is to be used
   in an environment where elements are trusted and where attackers are
   not supposed to have access to the protocol messages between those
   elements.  Traffic protection between network elements is sometimes
   achieved by using IPsec and sometimes by physically protecting the
   network.  In any case, the environment where the P-Served-User header
   field will be used ensures the integrity and the confidentiality of
   the contents of this header field.

   The Spec(T) that defines the Trust Domain for P-Served-User MUST
   require that member nodes understand the P-Served-User header
   extension.

   There is a security risk if a P-Served-User header field is allowed
   to propagate out of the Trust Domain where it was generated.  In that
   case, user-sensitive information would be revealed.  To prevent such
   a breach from happening, proxies MUST NOT insert the header when
   forwarding requests to a hop that is located outside the Trust
   Domain.  When forwarding the request to a node in the Trust Domain,
   proxies MUST NOT insert the header unless they have sufficient
   knowledge that the route set includes another proxy in the Trust
   Domain that understands the header, such as the home proxy.  There is
   no automatic mechanism to learn the support for this specification.
   Proxies MUST remove the header when forwarding requests to nodes that
   are not in the Trust Domain or when the proxy does not have knowledge
   of any other proxy included in the route set that will remove it
   before it is routed to any node that is not in the Trust Domain.

<span class="h2"><a class="selflink" name="section-11" href="#section-11">11</a>.  Acknowledgments</span>

   Alf Heidermark, Hubert Przybysz, and Erik Rolin for the discussion
   that led to the solution written down in this document.  Spencer
   Dawkins for performing the expert review.  Jon Peterson for
   performing the AD review.  Gonzalo Camarillo, Paul Kyzivat, Nils
   Haenstroem, Arunachalam Venkatraman, Mikael Forsberg, Miguel Garcia,
   Jozsef Varga, Keith Drage, Tim Polk, and Cullen Jennings for
   providing improvements.  Francis Dupont for performing the general
   area review.  Sandy Murphy for performing the security area review.





<span class="grey">van Elburg                   Informational                     [Page 11]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="section-12" href="#section-12">12</a>.  References</span>

<span class="h3"><a class="selflink" name="section-12.1" href="#section-12.1">12.1</a>.  Normative References</span>

   [<a name="ref-1" id="ref-1">1</a>]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-2" id="ref-2">2</a>]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
         Peterson, J., Sparks, R., Handley, M., and E. Schooler, "SIP:
         Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>, June 2002.

   [<a name="ref-3" id="ref-3">3</a>]   Watson, M., "Short Term Requirements for Network Asserted
         Identity", <a href="rfc3324.html">RFC 3324</a>, November 2002.

   [<a name="ref-4" id="ref-4">4</a>]   Jennings, C., Peterson, J., and M. Watson, "Private Extensions
         to the Session Initiation Protocol (SIP) for Asserted Identity
         within Trusted Networks", <a href="rfc3325.html">RFC 3325</a>, November 2002.

   [<a name="ref-5" id="ref-5">5</a>]   Mankin, A., Bradner, S., Mahy, R., Willis, D., Ott, J., and B.
         Rosen, "Change Process for the Session Initiation Protocol
         (SIP)", <a href="https://tools.ietf.org/html/bcp67">BCP 67</a>, <a href="rfc3427.html">RFC 3427</a>, December 2002.

   [<a name="ref-6" id="ref-6">6</a>]   Crocker, D. and P. Overell, "Augmented BNF for Syntax
         Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>, January 2008.

<span class="h3"><a class="selflink" name="section-12.2" href="#section-12.2">12.2</a>.  Informative References</span>

   [<a name="ref-7" id="ref-7">7</a>]   Barnes, M., "An Extension to the Session Initiation Protocol
         (SIP) for Request History Information", <a href="rfc4244.html">RFC 4244</a>,
         November 2005.

   [<a name="ref-8" id="ref-8">8</a>]   3GPP, "IP Multimedia (IM) session handling; IM call model;
         Stage 2", 3GPP TS 23.218 V7.

   [<a name="ref-9" id="ref-9">9</a>]   3GPP, "IP Multimedia Subsystem (IMS); Stage 2", 3GPP TS 23.228
         V7.

   [<a name="ref-10" id="ref-10">10</a>]  3GPP, "IMS multimedia telephony communication service and
         supplementary services; Stage 3", 3GPP TS 24.173 V7.

   [<a name="ref-11" id="ref-11">11</a>]  3GPP, "Internet Protocol (IP) multimedia call control protocol
         based on Session Initiation Protocol (SIP) and Session
         Description Protocol (SDP); Stage 3", 3GPP TS 24.229 V7.

   [<a name="ref-12" id="ref-12">12</a>]  3GPP, "IP Multimedia (IM) Subsystem Cx and Dx interfaces;
         Signalling flows and message contents", 3GPP TS 29.228 V7.





<span class="grey">van Elburg                   Informational                     [Page 12]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


<span class="h2"><a class="selflink" name="appendix-A" href="#appendix-A">Appendix A</a>.  Why the History-Info Header Is Not Suitable to Convey the</span>
             Served User Information on the ISC Interface

<span class="h3"><a class="selflink" name="appendix-A.1" href="#appendix-A.1">A.1</a>.  Semantics</span>

   The History-Info (as specified in <a href="rfc4244.html">RFC 4244</a> [<a href="#ref-7" title="&quot;An Extension to the Session Initiation Protocol (SIP) for Request History Information&quot;">7</a>]) holds a record of
   subsequent Request-URI values that are put on an initial request
   during its processing in the network.

   If it would be possible at all to use the History-Info header for the
   purpose of communicating the served user, then again the same
   overloading would occur as the one that we are trying to get rid of
   (<a href="#section-4.2">Section 4.2</a>).  In this case, we overload the particular History-Info
   header field's hi-entry with the meaning "historic target identity"
   and "served user".

   Another reason that the History-Info header can not solve the
   requirements as expressed in this document is that, in originating
   session case scenarios, the served user is currently determined from
   the P-Asserted-Identity, as that header field contains the asserted
   originating user's identity.  The History-Info header, being a record
   of Request-URIs, can never be a solution for this case.

   Looking at the call-out-of-the-blue scenario (<a href="#section-4.4">Section 4.4</a>), it is
   impossible to construct a History-Info header for an INVITE request
   on behalf of user C that appears to come from user B and targets user
   D that would express the served user C without violating the original
   semantics of the History-Info header according to (<a href="rfc4244.html">RFC 4244</a> [<a href="#ref-7" title="&quot;An Extension to the Session Initiation Protocol (SIP) for Request History Information&quot;">7</a>]).

<span class="h3"><a class="selflink" name="appendix-A.2" href="#appendix-A.2">A.2</a>.  Additional Observations</span>

   The purpose of the History-Info header is a header that has an end-
   to-end application.  For the purpose of informing an AS on the ISC
   interface, this is overkill.

   At the moment that the AS receives an initial INVITE over the ISC
   interface, this INVITE may have passed a vast number of proxies that
   may or may not have added history information.  On top of that, the
   request may have traversed several AS instances for the same served
   user.  In case several subsequent iFC are active, all these AS
   instances may perform a forwarding.  This means that it is not
   possible to define an algorithm that points out which hi-entry of a
   History-Info header should represent the served user.  In other
   words, a History-Info header field with n entries expresses a branch
   of depth n.  Any or none of these elements could be the served user
   identity.





<span class="grey">van Elburg                   Informational                     [Page 13]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc5502.html">RFC 5502</a>               The P-Served-User P-Header             April 2009</span>


   The History-Info header does not comply with the second requirement
   as expressed in <a href="#section-5">Section 5</a>, as it does not have a means to express the
   session case in a natural way.

<span class="h3"><a class="selflink" name="appendix-A.3" href="#appendix-A.3">A.3</a>.  Conclusion</span>

   Each observation in the previous subsections, alone, is enough to
   disregard the History-Info header as an information element that is
   suitable for transporting the served user information over the ISC
   interface.

   Note that this does not prohibit the use of the P-Served-User header
   and the History-Info header in the same request.  In fact that will
   be a quite likely scenario for network-based diversion services like,
   for example, the Communication Diversion service as specified in
   (3GPP TS 24.173 [<a href="#ref-10" title="&quot;IMS multimedia telephony communication service and supplementary services; Stage 3&quot;">10</a>]).

Author's Address

   Hans Erik van Elburg
   Ericsson Telecommunicatie B.V.
   Ericssonstraat 2
   Rijen  5121 ML
   Netherlands

   EMail: HansErik.van.Elburg@ericsson.com

























van Elburg                   Informational                     [Page 14]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129c, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>

<!-- Mirrored from tools.ietf.org/html/rfc5502 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:58:11 GMT -->
</html>
