<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc8302 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-yizhou-trill-arp-optimization" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:8302" name="DC.Identifier"/>
<meta content="January, 2018" name="DC.Date.Issued"/>
<meta content="Dunbar, Linda" name="DC.Creator"/>
<meta content="Perlman, Radia" name="DC.Creator"/>
<meta content="Umair, Mohammed" name="DC.Creator"/>
<meta content="This document describes mechanisms to optimize the Address Resolution
Protocol (ARP) and Neighbor Discovery (ND) traffic in a Transparent
Interconnection of Lots of Links (TRILL) campus. TRILL switches
maintain a cache of IP / Media Access Control (MAC) address / Data
Label bindings that are learned from ARP/ND requests and responses
that pass through them. In many cases, this cache allows an edge
Routing Bridge (RBridge) to avoid flooding an ARP/ND request by either
responding to it directly or encapsulating it and unicasting it. Such
optimization reduces packet flooding over a TRILL campus." name="DC.Description.Abstract"/>
<meta content="Transparent Interconnection of Lots of Links (TRILL): ARP and Neighbor Discovery (ND) Optimization" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 8302 - Transparent Interconnection of Lots of Links (TRILL): ARP and Neighbor Discovery (ND) Optimization</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc8302.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc8302" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-trill-arp-optimization" title="draft-ietf-trill-arp-optimization">draft-ietf-tril...</a>] [<a href="https://datatracker.ietf.org/doc/rfc8302" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc8302" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc8302" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=8302&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                             Y. Li
Request for Comments: 8302                               D. Eastlake 3rd
Category: Standards Track                                      L. Dunbar
ISSN: 2070-1721                                      Huawei Technologies
                                                              R. Perlman
                                                                Dell EMC
                                                                M. Umair
                                                                   Cisco
                                                            January 2018


         <span class="h1">Transparent Interconnection of Lots of Links (TRILL):</span>
              <span class="h1">ARP and Neighbor Discovery (ND) Optimization</span>

Abstract

   This document describes mechanisms to optimize the Address Resolution
   Protocol (ARP) and Neighbor Discovery (ND) traffic in a Transparent
   Interconnection of Lots of Links (TRILL) campus.  TRILL switches
   maintain a cache of IP / Media Access Control (MAC) address / Data
   Label bindings that are learned from ARP/ND requests and responses
   that pass through them.  In many cases, this cache allows an edge
   Routing Bridge (RBridge) to avoid flooding an ARP/ND request by
   either responding to it directly or encapsulating it and unicasting
   it.  Such optimization reduces packet flooding over a TRILL campus.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8302">https://www.rfc-editor.org/info/rfc8302</a>.












<span class="grey">Li, et al.                   Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  ARP/ND Optimization Requirement and Solution  . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  IP/MAC Address Mappings . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Handling ARP/ND/SEND Messages . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-4.1">4.1</a>.  SEND Considerations . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-4.2">4.2</a>.  Address Verification  . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     4.3.  Extracting Local Mapping Information for End-Station
           IP/MAC Addresses  . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-4.4">4.4</a>.  Determining How to Reply to ARP/ND  . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-4.5">4.5</a>.  Determining How to Handle the ARP/ND Response . . . . . .  <a href="#page-10">10</a>
   5.  Handling of Reverse Address Resolution Protocol (RARP)
       Messages  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  Handling of DHCP Messages . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  Handling of Duplicate IP Addresses  . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-8">8</a>.  RBridge ARP/ND Cache Liveness and MAC Mobility  . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-9">9</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-9.1">9.1</a>.  Data-Plane-Based Considerations . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-9.2">9.2</a>.  Directory-Based Considerations  . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-9.3">9.3</a>.  Use of the Confidence Level Feature . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-10">10</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-11">11</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-11.1">11.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-11.2">11.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>








<span class="grey">Li, et al.                   Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   ARP [<a href="rfc826.html" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>RFC826</a>] and ND [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] messages are normally sent by broadcast
   and multicast, respectively.  To reduce the burden on a TRILL campus
   caused by these multi-destination messages, RBridges MAY implement an
   "optimized ARP/ND response", as specified herein, when the target's
   location is known by the ingress RBridge or can be obtained from a
   directory.  This avoids ARP/ND query and answer flooding.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP</a>
   <a href="https://tools.ietf.org/html/bcp14">14</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="rfc8174.html" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

   The abbreviations and terminology in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] are used herein.  Some
   of these are listed below for convenience along with some additions:

   APPsub-TLV   Application sub-Type-Length-Value [<a href="rfc6823.html" title='"Advertising Generic Information in IS-IS"'>RFC6823</a>]

   ARP          Address Resolution Protocol [<a href="rfc826.html" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>RFC826</a>]

   Campus       A TRILL network consisting of RBridges, links, and
                possibly bridges bounded by end stations and IP routers
                [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>]

   DAD          Duplicate Address Detection [<a href="rfc3756.html" title='"IPv6 Neighbor Discovery (ND) Trust Models and Threats"'>RFC3756</a>] [<a href="rfc5227.html" title='"IPv4 Address Conflict Detection"'>RFC5227</a>]

   Data Label   VLAN or Fine-Grained Label (FGL)

   DHCP         Dynamic Host Configuration Protocol.  In this document,
                DHCP refers to both DHCP for IPv4 [<a href="rfc2131.html" title='"Dynamic Host Configuration Protocol"'>RFC2131</a>] and DHCPv6
                [<a href="rfc3315.html" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>]

   ESADI        End Station Address Distribution Information [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>]

   FGL          Fine-Grained Label [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>]

   IA           Interface Address; a TRILL APPsub-TLV [<a href="rfc7961.html" title='"Transparent Interconnection of Lots of Links (TRILL): Interface Addresses APPsub-TLV"'>RFC7961</a>]

   IP           Internet Protocol, both IPv4 and IPv6

   MAC          Media Access Control [<a href="rfc7042.html" title='"IANA Considerations and IETF Protocol and Documentation Usage for IEEE 802 Parameters"'>RFC7042</a>]

   ND           Neighbor Discovery [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>]




<span class="grey">Li, et al.                   Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   RBridge      A contraction of "Routing Bridge".  A device
                implementing the TRILL protocol.

   SEND         Secure Neighbor Discovery [<a href="rfc3971.html" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>]

   TRILL        Transparent Interconnection of Lots of Links or Tunneled
                Routing in the Link Layer [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] [<a href="rfc7780.html" title='"Transparent Interconnection of Lots of Links (TRILL): Clarifications, Corrections, and Updates"'>RFC7780</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20ARP%2FND%20Optimization%20Requirement%20and%20Solution"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  ARP/ND Optimization Requirement and Solution</span>

   IP address resolution can create significant issues in data centers
   due to flooded packets, as discussed in [<a href="rfc6820.html" title='"Address Resolution Problems in Large Data Center Networks"'>RFC6820</a>].  Such flooding can
   be avoided by a proxy ARP/ND function on edge RBridges as described
   in this document, particularly in <a href="#section-4">Section 4</a>.  This section is a
   general discussion of this problem and is not intended to be
   normative.

   To support such ARP/ND optimization, edge RBridges need to know an
   end station's IP/MAC address mapping through manual configuration
   (management), control-plane mechanisms such as directories [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>],
   or data-plane learning by snooping of messages such as ARP/ND
   (including DHCP or gratuitous ARP messages).

   When all the end station's IP/MAC address mappings are known to edge
   RBridges, provisioned through management, or learned via the control
   plane on the edge RBridges, it should be possible to completely
   suppress flooding of ARP/ND messages in a TRILL campus.  When all end
   station MAC addresses are similarly known, it should be possible to
   suppress unknown unicast flooding by dropping any unknown unicast
   received at an edge RBridge.

   An ARP/ND optimization mechanism should include provisions for an
   edge RBridge to issue an ARP/ND request to an attached end station to
   confirm or update information and should allow an end station to
   detect duplication of its IP address.

   Most of the end station hosts send either DHCP messages requesting an
   IP address or gratuitous ARP or Reverse Address Resolution Protocol
   (RARP) requests to announce themselves to the network right after
   they come online.  Thus, the local edge RBridge will immediately have
   the opportunity to snoop and learn their MAC and IP addresses and
   distribute this information to other edge RBridges through the TRILL
   control-plane End Station Address Distribution Information (ESADI)
   [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>] protocol.  Once remote RBridges receive this information
   via the control plane, they should add IP-to-MAC mapping information
   to their ARP/ND cache along with the nickname and Data Label of the
   address information.  Therefore, most active IP hosts in the TRILL




<span class="grey">Li, et al.                   Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   network can be learned by the edge RBridges through either local
   learning or control-plane-based remote learning.  As a result, ARP
   suppression can vastly reduce the network flooding caused by host ARP
   learning behavior.

   When complete directory information is available, the default data-
   plane learning of end-station MAC addresses is not only unnecessary
   but could be harmful if there is learning based on frames with forged
   source addresses.  Such data-plane learning can be suppressed because
   TRILL already provides an option to disable data-plane learning from
   the source MAC address of end-station frames (see <a href="rfc6325.html#section-5.3">Section 5.3 of
   [RFC6325]</a>).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20IP%2FMAC%20Address%20Mappings"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  IP/MAC Address Mappings</span>

   By default, an RBridge [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>] learns egress nickname
   mapping information for the MAC address and Data Label (VLAN or FGL)
   of TRILL data frames it receives and decapsulates.  No IP address
   information is learned directly from the TRILL data frame.  The IA
   APPsub-TLV [<a href="rfc7961.html" title='"Transparent Interconnection of Lots of Links (TRILL): Interface Addresses APPsub-TLV"'>RFC7961</a>] enhances the TRILL base protocol by allowing IP/
   MAC address mappings to be distributed in the control plane by any
   RBridge.  This APPsub-TLV appears inside the TRILL GENINFO TLV in
   ESADI [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>], but the value data structure it specifies may also
   occur in other application contexts.  Edge RBridge Directory Assist
   Mechanisms [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>] make use of this APPsub-TLV for its push model
   and use the value data structure it specifies in its pull model.

   An RBridge can easily know the IP/MAC address mappings of the local
   end stations that it is attached to via its access ports by receiving
   ARP [<a href="rfc826.html" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>RFC826</a>] or ND [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] messages.  If the edge RBridge has
   extracted the sender's IP/MAC address pair from the received data
   frame (either ARP or ND), it may save the information and then use
   the IA APPsub-TLV to link the IP and MAC addresses and distribute it
   to other RBridges through ESADI.  Then, the relevant remote RBridges
   (normally those interested in the same Data Label as the original
   ARP/ND messages) also receive and save such mapping information.
   There are other ways that RBridges save IP/MAC address mappings in
   advance, e.g., importing them from the management system and
   distributing them by directory servers [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>].

   The examples given above show that RBridges might have saved an end
   station's triplet of {IP address, MAC address, ingress nickname} for
   a given Data Label (VLAN or FGL) before that end station sends or
   receives any real data packet.  Note that such information might or
   might not be a complete list and might or might not exist on all
   RBridges; the information could possibly be from different sources.
   RBridges can then use the Flags field in an IA APPsub-TLV to identify




<span class="grey">Li, et al.                   Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   if the source is a directory server or local observation by the
   sender.  A different confidence level may also be used to indicate
   the reliability of the mapping information.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Handling%20ARP%2FND%2FSEND%20Messages"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Handling ARP/ND/SEND Messages</span>

   A native frame that is an ARP [<a href="rfc826.html" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>RFC826</a>] message is detected by its
   Ethertype of 0x0806.  A native frame that is an ND [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] is
   detected by being one of five different ICMPv6 packet types.  ARP/ND
   is commonly used on a link to (1) query for the MAC address
   corresponding to an IPv4 or IPv6 address, (2) test if an IPv4/IPv6
   address is already in use, or (3) announce the new or updated info on
   any of the following: IPv4/IPv6 address, MAC address, and/or point of
   attachment.

   To simplify the text, we use the following terms in this section.

   1.  IP address -- indicated protocol address that is normally an IPv4
       address in ARP or an IPv6 address in ND.

   2.  sender's IP/MAC address -- sender IP/MAC address in ARP, source
       IP address, and source link-layer address in ND.

   3.  target's IP/MAC address -- target IP/MAC address in ARP, target
       address, and target link-layer address in ND.

   When an ingress RBridge receives an ARP/ND/SEND message, it can
   perform the steps described within the subsections below.  In
   particular, <a href="#section-4.4">Section 4.4</a> describes the options for such an ingress
   handling an ARP/ND message and, in the cases where it forwards the
   message, <a href="#section-4.5">Section 4.5</a> describes how to handle any response that may be
   returned due to the forwarded message.

   <a href="#section-4.3">Section 4.3</a> describes the extraction of address information by an
   RBridge from ARP/ND messages it handles.  Under some circumstances,
   this extraction may prompt verification with an end station.
   <a href="#section-4.2">Section 4.2</a> describes an optional use of ARP/ND messages originated
   by RBridges to verify addresses or liveness.

   As described in <a href="#section-4.1">Section 4.1</a>, SEND messages are not optimized by the
   mechanisms specified in this document but are snooped on.










<span class="grey">Li, et al.                   Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20SEND%20Considerations"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  SEND Considerations</span>

   Secure Neighbor Discovery (SEND) [<a href="rfc3971.html" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>] is a method of securing ND
   that addresses the threats discussed in [<a href="rfc3756.html" title='"IPv6 Neighbor Discovery (ND) Trust Models and Threats"'>RFC3756</a>].  Typical TRILL
   campuses are inside data centers, Internet exchange points, or
   carrier facilities.  These are generally controlled and protected
   environments where these threats are of less concern.  Nevertheless,
   SEND provides an additional layer of protection.

   Secure SEND messages require knowledge of cryptographic keys.
   Methods of communicating such keys to RBridges for use in SEND are
   beyond the scope of this document.  Thus, using the optimizations in
   this document, RBridges do not attempt to construct SEND messages and
   are generally transparent to them.  RBridges only construct ARP,
   RARP, or insecure ND messages, as appropriate.  Nevertheless,
   RBridges implementing ARP/ND optimization SHOULD snoop on SEND
   messages to extract the addressing information that would be present
   if the SEND had been sent as an insecure ND message and is still
   present in the SEND message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Address%20Verification"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Address Verification</span>

   RBridges may use ARP/ND to probe directly attached or remote end
   stations for address or liveness verification.  This is typically
   most appropriate in less-managed and/or higher-mobility environments.
   In strongly managed environments, such as a typical data center,
   where a central orchestration/directory system has complete
   addressing knowledge [<a href="rfc7067.html" title='"Directory Assistance Problem and High-Level Design Proposal"'>RFC7067</a>], optimized ARP/ND responses can use
   that knowledge.  In such cases, there is little reason for
   verification except for debugging operational problems or the like.





















<span class="grey">Li, et al.                   Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Extracting%20Local%20Mapping%20Information%20for%20End-Station%20IP%2FMAC"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Extracting Local Mapping Information for End-Station IP/MAC</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/Addresses"></a>      Addresses</span>

   Edge RBridges extract and use information about the correspondence
   between local end-station IP and MAC addresses from the ARP/ND
   messages those end stations send, as described below.  An apparent
   zero source IP address means that the end station is probing for
   duplicate IP addresses, and messages with such a zero source IP
   address are not used for the extraction of IP/MAC address mapping
   information.

   o  If the sender's IP is not present in the ingress RBridge's ARP/ND
      cache, populate the information of the sender's IP/MAC address
      mapping in its ARP/ND cache table.  The ingress RBridge correlates
      its nickname and that IP/MAC address mapping information.  Such a
      triplet of {IP address, MAC address, ingress nickname} information
      is saved locally and can be distributed to other RBridges, as
      explained later.

   o  Else, if the sender's IP has been saved before but with a
      different MAC address mapped or a different ingress nickname
      associated with the same pair of IP/MAC, the RBridge SHOULD verify
      if a duplicate IP address has already been in use or an end
      station has changed its attaching RBridge.  The RBridge may use
      different strategies to do so.  For example, the RBridge might ask
      an authoritative entity like directory servers or it might
      encapsulate and unicast the ARP/ND message to the location where
      it believes the address is in use (<a href="#section-4.2">Section 4.2</a>).  RBridge SHOULD
      update the saved triplet of {IP address, MAC address, ingress
      nickname} based on the verification results.  An RBridge might not
      verify an IP address if the network manager's policy is to have
      the network behave, for each Data Label, as if it were a single
      link and just believe an ARP/ND it receives.

   The ingress RBridge MAY use the IA APPsub-TLV [<a href="rfc7961.html" title='"Transparent Interconnection of Lots of Links (TRILL): Interface Addresses APPsub-TLV"'>RFC7961</a>] with the
   Local flag set in ESADI [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>] to distribute any new or updated
   triplet of {IP address, MAC address, ingress nickname} information
   obtained.  If a Push Directory server is used, such information can
   be distributed as specified in [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>].












<span class="grey">Li, et al.                   Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Determining%20How%20to%20Reply%20to%20ARP%2FND"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Determining How to Reply to ARP/ND</span>

   The options for an edge RBridge to handle a native ARP/ND are given
   below.  For generic ARP/ND requests seeking the MAC address
   corresponding to an IP address, if the edge RBridge knows the IP
   address and corresponding MAC, behavior is as in item (a), otherwise
   behavior is as in item (b).  Behavior for gratuitous ARP and ND
   unsolicited Neighbor Advertisements (NAs) [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] is given in item
   (c).  And item (d) covers the handling of an Address Probe ARP query.
   Within each lettered item, it is an implementation decision as to
   which numbered strategy to use for any particular ARP/ND query
   falling under that item.

   a.  If the message is a generic ARP/ND request, and the ingress
       RBridge knows the target's IP address and associated MAC address,
       the ingress RBridge MUST take one or a combination of the actions
       below.  In the case of SEND [<a href="rfc3971.html" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>], cryptography would prevent
       a local reply by the ingress RBridge, since the RBridge would not
       be able to sign the response with the target's private key, and
       only action a.2 or a.5 is valid.

       a.1.  Send an ARP/ND response directly to the querier, using the
             target's MAC address present in the ingress RBridge's ARP/
             ND cache table.  Because the edge RBridge might not have an
             IPv6 address, the source IP address for such an ND response
             MUST be that of the target end station.

       a.2.  Encapsulate the ARP/ND/SEND request to the target's
             Designated RBridge and have the egress RBridge for the
             target forward the query to the target.  This behavior has
             the advantage that a response to the request is
             authoritative.  If the request does not reach the target,
             then the querier does not get a response.

       a.3.  Block ARP/ND requests that occur for some time after a
             request to the same target has been launched, and then
             respond to the querier when the response to the recently
             launched query to that target is received.

       a.4.  Reply to the querier based on directory information
             [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>] such as information obtained from a Pull
             Directory server or directory information that the ingress
             RBridge has requested to be pushed to it.

       a.5.  Flood the ARP/ND/SEND request as per [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].






<span class="grey">Li, et al.                   Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   b.  If the message is a generic ARP/ND/SEND request and the ingress
       RBridge does not know the target's IP address, the ingress
       RBridge MUST take one of the following actions.  In the case of
       SEND [<a href="rfc3971.html" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>], cryptography would prevent local reply by the
       ingress RBridge, since the RBridge would not be able to sign the
       response with the target's private key; therefore, only action
       b.1 is valid.

       b.1.  Flood the ARP/ND/SEND message as per [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

       b.2.  Use a directory server to pull the information [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>]
             and reply to the querier.

       b.3.  Drop the message if there should be no response because the
             directory server gives authoritative information that the
             address being queried is nonexistent.

   c.  If the message is a gratuitous ARP, which can be identified by
       the same sender's and target's "protocol" address fields, or an
       unsolicited Neighbor Advertisement [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>] in ND/SEND then:

       The RBridge MAY use an IA APPsub-TLV [<a href="rfc7961.html" title='"Transparent Interconnection of Lots of Links (TRILL): Interface Addresses APPsub-TLV"'>RFC7961</a>] with the Local
       flag set to distribute the sender's IP/MAC address mapping
       information.  When one or more directory servers are deployed and
       complete Push Directory information is used by all the RBridges
       in the Data Label, a gratuitous ARP or unsolicited NA SHOULD be
       discarded rather than ingressed.  Otherwise, they are either
       ingressed and flooded as per [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] or discarded depending on
       local policy.

   d.  If the message is an Address Probe ARP query [<a href="rfc5227.html" title='"IPv4 Address Conflict Detection"'>RFC5227</a>], which can
       be identified by the sender's protocol (IPv4) address field being
       zero and the target's protocol address field being the IPv4
       address to be tested or a Neighbor Solicitation for Duplicate
       Address Detection (DAD) that has the unspecified source address
       [<a href="rfc4862.html" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>], it SHOULD be handled as the generic ARP message as in
       (a) or (b) above.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20Determining%20How%20to%20Handle%20the%20ARP%2FND%20Response"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  Determining How to Handle the ARP/ND Response</span>

   If the ingress RBridge R1 decides to unicast the ARP/ND request to
   the target's egress RBridge R2 as discussed in <a href="#section-4.4">Section 4.4</a>, item a.2
   or to flood the request as per item a.5 and [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>], then R2
   decapsulates the query and initiates an ARP/ND query on the target's
   link.  If and when the target responds, R2 encapsulates and unicasts
   the response to R1, which decapsulates the response and sends it to
   the querier.  R2 SHOULD initiate a link state update to inform all
   the other RBridges of the target's location, Layer 3 address, and



<span class="grey">Li, et al.                   Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   Layer 2 address, in addition to forwarding the reply to the querier.
   The update uses an IA APPsub-TLV [<a href="rfc7961.html" title='"Transparent Interconnection of Lots of Links (TRILL): Interface Addresses APPsub-TLV"'>RFC7961</a>] (so the Layer 3 and Layer
   2 addresses can be linked) with the Local flag set in ESADI [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>]
   or as per [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>] if the Push Directory server is in use.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Handling%20of%20Reverse%20Address%20Resolution%20Protocol%20%28RARP%29%20Messages"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Handling of Reverse Address Resolution Protocol (RARP) Messages</span>

   RARP [<a href="rfc903.html" title='"A Reverse Address Resolution Protocol"'>RFC903</a>] uses the same packet format as ARP but different
   Ethertype (0x8035) and opcode values.  Its processing is similar to
   the generic ARP request/response as described in <a href="#section-4.4">Section 4.4</a>, items
   a. and b.  The difference is that it is intended to query for the
   target "protocol" (IP) address corresponding to the target "hardware"
   (MAC) address provided.  It SHOULD be handled by doing a local cache
   or directory server lookup on the target "hardware" address provided
   to find a mapping to the desired "protocol" address.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Handling%20of%20DHCP%20Messages"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Handling of DHCP Messages</span>

   When a newly connected end station exchanges messages with a DHCP
   [<a href="rfc3315.html" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>][RFC2131] server, an edge RBridge should snoop them (mainly
   the DHCPAck message) and store IP/MAC address mapping information in
   its ARP/ND cache and should also send the information out through the
   TRILL control plane using ESADI.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Handling%20of%20Duplicate%20IP%20Addresses"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Handling of Duplicate IP Addresses</span>

   Duplicate IP addresses within a Data Label can occur due to an
   attacker sending fake ARP/ND messages or due to human/configuration
   errors.  If complete, trustworthy directory information is available,
   then, by definition, the IP location information in the directory is
   correct.  Any appearance of an IP address in a different place
   (different edge RBridge or port) from other sources is not correct.

   Without complete directory information, the ARP/ND optimization
   function should support duplicate IP detection.  This is critical in
   a data center to stop an attacker from using ARP/ND spoofing to
   divert traffic from its intended destination.

   Duplicate IP addresses can be detected when an existing active IP/MAC
   address mapping gets modified.  Also, an edge RBridge may send a
   query called a Duplicate Address Detection query (DAD-query) asking
   about the IP address in question to the former owner of that IP
   address by using the MAC address formerly associated with that IP
   address.  A DAD-query is a unicast ARP/ND message with sender IP
   0.0.0.0 in case of ARP (or a configurable IP address per RBridge
   called the DAD-Query source IP) and an IPv6 Link Local Address in
   case of ND with the source MAC set to the DAD-querier RBridge's MAC.
   If the querying RBridge does not receive an answer within a given



<span class="grey">Li, et al.                   Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   time, it may be a case of mobility; in any case, the new IP entry
   will be confirmed and activated in its ARP/ND cache.

   In the case where the former owner replies, a duplicate address has
   been detected.  In this case, the querying RBridge SHOULD log the
   duplicate so that the network administrator can take appropriate
   action.

   It is an implementation choice how to respond to a query for an
   address that is duplicated in the network when authoritative
   information is not available from a directory or configuration.
   Typically, the information most recently snooped is returned.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20RBridge%20ARP%2FND%20Cache%20Liveness%20and%20MAC%20Mobility"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  RBridge ARP/ND Cache Liveness and MAC Mobility</span>

   A maintenance procedure is needed for RBridge ARP/ND caching to
   ensure IP end stations connected to ingress RBridges are still
   active.

   Some links provide a physical-layer indication of link liveness.  A
   dynamic proxy ARP/ND entry (one learned from data-plane observation)
   MUST be removed from the table if the link over which it was learned
   fails.

   Similarly, a dynamic proxy ARP/ND entry SHOULD be flushed out of the
   table if the IP/MAC address mapping has not been refreshed within a
   given age-time.  The entry is refreshed if an ARP or ND message is
   received for the same IP/MAC address mapping entry from any location.
   The IP/MAC address mapping information Ageing Timer is configurable
   per RBridge and defaults to 3/4 of the MAC address learning Ageing
   Timer [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

   For example, end station "A" is connected to edge-RBridge1 (RB1) and
   has been learned as a local entry on RB1.  If end station "A" moves
   to some other location (MAC / Virtual Machine (VM) Mobility) and gets
   connected to edge-RBridge (RB2), after learning on RB2's access port,
   RB2 advertises this entry through the TRILL control plane, and it is
   learned on RB1 as a remote entry.  The old entry on RB1 SHOULD get
   replaced, and all other edge-RBridges with end-station service
   enabled for that Data Label should update the entry to show
   reachability from RB2 instead of RB1.

   If an ARP/ND entry in the cache is not refreshed, then the RBridge
   connected to that end station MAY send periodic refresh messages
   (ARP/ND "probes") to that end station, so that the entries can be
   refreshed before they age out.  The end station would reply to the
   ARP/ND probe, and the reply resets the corresponding entry age-timer.




<span class="grey">Li, et al.                   Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   There are generally two modes of learning the address information
   that is the basis of ARP/ND optimization: data-plane mode and
   directory mode.  The data-plane mode is the traditional bridge
   address learning [<a href="#ref-IEEE802.1Q">IEEE802.1Q</a>] that is also implemented in TRILL
   switches [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] and is discussed in <a href="#section-9.1">Section 9.1</a>.  The directory
   mode uses data obtained from a directory [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>] and is discussed
   in <a href="#section-9.2">Section 9.2</a>.  The TRILL confidence-level feature, which can help
   arbitrate between conflicting address information, is discussed in
   <a href="#section-9.3">Section 9.3</a>.

   RBridges should rate limit ARP/ND queries injected into the TRILL
   campus to limit some potential denial-of-service attacks.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Data-Plane-Based%20Considerations"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Data-Plane-Based Considerations</span>

   Generally speaking, when ARP/ND optimization is operating in the
   data-plane mode, the information learned by RBridges is the same as
   that which is learned by end stations.  Thus, the answers generated
   by RBridges to the query messages being optimized are generally those
   that would be generated by end stations in the absence of
   optimization, and the security considerations are those of the
   underlying ARP/ND protocols.

   RBridges that snoop on DHCPack messages respond to ARP/ND messages in
   essentially the same way that the end stations sending those DHCPack
   messages would.  Thus, for security considerations of ARP/ND
   optimization for DHCP messages that may be snooped, see the Security
   Considerations sections of [<a href="rfc3315.html" title='"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)"'>RFC3315</a>] and [<a href="rfc2131.html" title='"Dynamic Host Configuration Protocol"'>RFC2131</a>].

   Unless SEND [<a href="rfc3971.html" title='"SEcure Neighbor Discovery (SEND)"'>RFC3971</a>] is used, ARP and ND messages can be easily
   forged.  Therefore, the learning of IP/MAC addresses by RBridges from
   ARP/ND is hackable, but this is what is available for data-plane
   learning without SEND.  See "SEND Considerations", <a href="#section-4.1">Section 4.1</a>.

   Since end stations communicate with edge RBridges using Ethernet,
   some security improvements could be obtained by the use of
   [<a href="#ref-IEEE802.1AE">IEEE802.1AE</a>] between end stations and edge RBridges.  Such link
   security is beyond the scope of this document and would impose
   requirements on edge stations, while TRILL is generally designed to
   operate with unmodified, TRILL-ignorant end stations.









<span class="grey">Li, et al.                   Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   ARP/ND address mapping information learned locally at an RBridge can
   be distributed to other RBridges using the TRILL ESADI protocol that
   can be secured as specified in [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>].  (ESADI is also used for
   Push Directories with flags in the data indicating whether data comes
   from a directory or from data-plane learning, as well as from a
   confidence level (see <a href="#section-9.3">Section 9.3</a>).)

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Directory-Based%20Considerations"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Directory-Based Considerations</span>

   ARP/ND optimization can be based on directory information [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>].
   If the directory information is known to be trustworthy and complete,
   then trustworthy responses to ARP/ND queries can be entirely based on
   this information.  This bounds the damage that forged ARP/ND messages
   can do to the local link between end stations and edge RBridges.  (In
   TRILL, such a "link" can be a bridged LAN.)

   Of course, there can also be incomplete and/or unreliable directory
   address mapping data.  The network administrator can configure their
   TRILL campus to use such directory data in place of data-plane-
   learned data.  Alternatively, such directory data can be used along
   with data-plane-learned data arbitrated by the confidence level as
   discussed in <a href="#section-9.3">Section 9.3</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Use%20of%20the%20Confidence%20Level%20Feature"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Use of the Confidence Level Feature</span>

   An RBridge can use the confidence level in IA APPsub-TLV information
   received via ESADI or Pull Directory retrievals to determine the
   configured relative reliability of IP/MAC address mapping information
   from those sources and from locally learned address information.
   Push Directory information is sent via ESADI, which can be secured as
   provided in [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>]; Pull Directory information can be secured as
   provided in [<a href="rfc8171.html" title='"Transparent Interconnection of Lots of Links (TRILL): Edge Directory Assistance Mechanisms"'>RFC8171</a>].  The implementation decides if an RBridge will
   distribute the IP and MAC address mappings received from local native
   ARP/ND messages to other RBridges in the same Data Label, and with
   what confidence level it does so.  Thus, the implementer can, to some
   extent, cause sources that they know are more reliable to dominate
   those they know to be less reliable.  How the implementer determines
   this is beyond the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  IANA Considerations</span>

   This document does not require any IANA actions.









<span class="grey">Li, et al.                   Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC826" name="ref-RFC826">RFC826</a>]   Plummer, D., "Ethernet Address Resolution Protocol: Or
              Converting Network Protocol Addresses to 48.bit Ethernet
              Address for Transmission on Ethernet Hardware", STD 37,
              <a href="rfc826.html">RFC 826</a>, DOI 10.17487/RFC0826, November 1982,
              &lt;<a href="https://www.rfc-editor.org/info/rfc826">https://www.rfc-editor.org/info/rfc826</a>&gt;.

   [<a id="ref-RFC903" name="ref-RFC903">RFC903</a>]   Finlayson, R., Mann, T., Mogul, J., and M. Theimer, "A
              Reverse Address Resolution Protocol", STD 38, <a href="rfc903.html">RFC 903</a>,
              DOI 10.17487/RFC0903, June 1984,
              &lt;<a href="https://www.rfc-editor.org/info/rfc903">https://www.rfc-editor.org/info/rfc903</a>&gt;.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2131" name="ref-RFC2131">RFC2131</a>]  Droms, R., "Dynamic Host Configuration Protocol",
              <a href="rfc2131.html">RFC 2131</a>, DOI 10.17487/RFC2131, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2131">https://www.rfc-editor.org/info/rfc2131</a>&gt;.

   [<a id="ref-RFC3315" name="ref-RFC3315">RFC3315</a>]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", <a href="rfc3315.html">RFC 3315</a>, DOI 10.17487/RFC3315, July
              2003, &lt;<a href="https://www.rfc-editor.org/info/rfc3315">https://www.rfc-editor.org/info/rfc3315</a>&gt;.

   [<a id="ref-RFC4861" name="ref-RFC4861">RFC4861</a>]  Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
              "Neighbor Discovery for IP version 6 (IPv6)", <a href="rfc4861.html">RFC 4861</a>,
              DOI 10.17487/RFC4861, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4861">https://www.rfc-editor.org/info/rfc4861</a>&gt;.

   [<a id="ref-RFC4862" name="ref-RFC4862">RFC4862</a>]  Thomson, S., Narten, T., and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", <a href="rfc4862.html">RFC 4862</a>,
              DOI 10.17487/RFC4862, September 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4862">https://www.rfc-editor.org/info/rfc4862</a>&gt;.

   [<a id="ref-RFC6325" name="ref-RFC6325">RFC6325</a>]  Perlman, R., Eastlake 3rd, D., Dutt, D., Gai, S., and A.
              Ghanwani, "Routing Bridges (RBridges): Base Protocol
              Specification", <a href="rfc6325.html">RFC 6325</a>, DOI 10.17487/RFC6325, July 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6325">https://www.rfc-editor.org/info/rfc6325</a>&gt;.








<span class="grey">Li, et al.                   Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   [<a id="ref-RFC7172" name="ref-RFC7172">RFC7172</a>]  Eastlake 3rd, D., Zhang, M., Agarwal, P., Perlman, R., and
              D. Dutt, "Transparent Interconnection of Lots of Links
              (TRILL): Fine-Grained Labeling", <a href="rfc7172.html">RFC 7172</a>,
              DOI 10.17487/RFC7172, May 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7172">https://www.rfc-editor.org/info/rfc7172</a>&gt;.

   [<a id="ref-RFC7357" name="ref-RFC7357">RFC7357</a>]  Zhai, H., Hu, F., Perlman, R., Eastlake 3rd, D., and O.
              Stokes, "Transparent Interconnection of Lots of Links
              (TRILL): End Station Address Distribution Information
              (ESADI) Protocol", <a href="rfc7357.html">RFC 7357</a>, DOI 10.17487/RFC7357,
              September 2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7357">https://www.rfc-editor.org/info/rfc7357</a>&gt;.

   [<a id="ref-RFC7780" name="ref-RFC7780">RFC7780</a>]  Eastlake 3rd, D., Zhang, M., Perlman, R., Banerjee, A.,
              Ghanwani, A., and S. Gupta, "Transparent Interconnection
              of Lots of Links (TRILL): Clarifications, Corrections, and
              Updates", <a href="rfc7780.html">RFC 7780</a>, DOI 10.17487/RFC7780, February 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7780">https://www.rfc-editor.org/info/rfc7780</a>&gt;.

   [<a id="ref-RFC7961" name="ref-RFC7961">RFC7961</a>]  Eastlake 3rd, D. and L. Yizhou, "Transparent
              Interconnection of Lots of Links (TRILL): Interface
              Addresses APPsub-TLV", <a href="rfc7961.html">RFC 7961</a>, DOI 10.17487/RFC7961,
              August 2016, &lt;<a href="https://www.rfc-editor.org/info/rfc7961">https://www.rfc-editor.org/info/rfc7961</a>&gt;.

   [<a id="ref-RFC8171" name="ref-RFC8171">RFC8171</a>]  Eastlake 3rd, D., Dunbar, L., Perlman, R., and Y. Li,
              "Transparent Interconnection of Lots of Links (TRILL):
              Edge Directory Assistance Mechanisms", <a href="rfc8171.html">RFC 8171</a>,
              DOI 10.17487/RFC8171, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8171">https://www.rfc-editor.org/info/rfc8171</a>&gt;.

   [<a id="ref-RFC8174" name="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="rfc2119.html">RFC</a>
              <a href="rfc2119.html">2119</a> Key Words", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc8174.html">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-IEEE802.1AE" name="ref-IEEE802.1AE">IEEE802.1AE</a>]
              IEEE, "IEEE Standard for Local and metropolitan area
              networks: Media Access Control (MAC) Security", IEEE
              Std 802.1AE.

   [<a id="ref-IEEE802.1Q" name="ref-IEEE802.1Q">IEEE802.1Q</a>]
              IEEE, "IEEE Standard for Local and metropolitan area
              networks -- Bridges and Bridged Networks", IEEE
              Std 802.1Q.







<span class="grey">Li, et al.                   Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


   [<a id="ref-RFC3756" name="ref-RFC3756">RFC3756</a>]  Nikander, P., Ed., Kempf, J., and E. Nordmark, "IPv6
              Neighbor Discovery (ND) Trust Models and Threats",
              <a href="rfc3756.html">RFC 3756</a>, DOI 10.17487/RFC3756, May 2004,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3756">https://www.rfc-editor.org/info/rfc3756</a>&gt;.

   [<a id="ref-RFC3971" name="ref-RFC3971">RFC3971</a>]  Arkko, J., Ed., Kempf, J., Zill, B., and P. Nikander,
              "SEcure Neighbor Discovery (SEND)", <a href="rfc3971.html">RFC 3971</a>,
              DOI 10.17487/RFC3971, March 2005,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3971">https://www.rfc-editor.org/info/rfc3971</a>&gt;.

   [<a id="ref-RFC5227" name="ref-RFC5227">RFC5227</a>]  Cheshire, S., "IPv4 Address Conflict Detection", <a href="rfc5227.html">RFC 5227</a>,
              DOI 10.17487/RFC5227, July 2008,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5227">https://www.rfc-editor.org/info/rfc5227</a>&gt;.

   [<a id="ref-RFC6820" name="ref-RFC6820">RFC6820</a>]  Narten, T., Karir, M., and I. Foo, "Address Resolution
              Problems in Large Data Center Networks", <a href="rfc6820.html">RFC 6820</a>,
              DOI 10.17487/RFC6820, January 2013,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6820">https://www.rfc-editor.org/info/rfc6820</a>&gt;.

   [<a id="ref-RFC6823" name="ref-RFC6823">RFC6823</a>]  Ginsberg, L., Previdi, S., and M. Shand, "Advertising
              Generic Information in IS-IS", <a href="rfc6823.html">RFC 6823</a>,
              DOI 10.17487/RFC6823, December 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6823">https://www.rfc-editor.org/info/rfc6823</a>&gt;.

   [<a id="ref-RFC7042" name="ref-RFC7042">RFC7042</a>]  Eastlake 3rd, D. and J. Abley, "IANA Considerations and
              IETF Protocol and Documentation Usage for IEEE 802
              Parameters", <a href="https://tools.ietf.org/html/bcp141">BCP 141</a>, <a href="rfc7042.html">RFC 7042</a>, DOI 10.17487/RFC7042,
              October 2013, &lt;<a href="https://www.rfc-editor.org/info/rfc7042">https://www.rfc-editor.org/info/rfc7042</a>&gt;.

   [<a id="ref-RFC7067" name="ref-RFC7067">RFC7067</a>]  Dunbar, L., Eastlake 3rd, D., Perlman, R., and I.
              Gashinsky, "Directory Assistance Problem and High-Level
              Design Proposal", <a href="rfc7067.html">RFC 7067</a>, DOI 10.17487/RFC7067, November
              2013, &lt;<a href="https://www.rfc-editor.org/info/rfc7067">https://www.rfc-editor.org/info/rfc7067</a>&gt;.

Acknowledgments

   The authors would like to thank Igor Gashinsky and Sue Hares for
   their contributions.













<span class="grey">Li, et al.                   Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc8302.html">RFC 8302</a>                TRILL ARP/ND Optimization           January 2018</span>


Authors' Addresses

   Yizhou Li
   Huawei Technologies
   101 Software Avenue,
   Nanjing  210012
   China
   Phone: +86-25-56625375
   Email: liyizhou@huawei.com


   Donald Eastlake 3rd
   Huawei R&amp;D USA
   155 Beaver Street
   Milford, MA  01757
   United States of America
   Phone: +1-508-333-2270
   Email: d3e3e3@gmail.com


   Linda Dunbar
   Huawei Technologies
   5430 Legacy Drive, Suite #175
   Plano, TX  75024
   United States of America
   Phone: +1-469-277-5840
   Email: ldunbar@huawei.com


   Radia Perlman
   Dell EMC
   176 South Street
   Hopkinton, MA  01748
   United States of America
   Email: Radia@alum.mit.edu


   Mohammed Umair
   Cisco
   Cessna Business Park, Kadubeesanahalli Village, Hobli,
   Sarjapur, Varthur Main Road, Marathahalli,
   Bengaluru, Karnataka  560087
   India
   Email: mohammed.umair2@gmail.com







Li, et al.                   Standards Track                   [Page 18]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc8302 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --></html>