<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7263 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:23 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-zong-p2psip-drr" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7263" name="DC.Identifier"/>
<meta content="June, 2014" name="DC.Date.Issued"/>
<meta content="Even, Roni" name="DC.Creator"/>
<meta content="Jiang, XingFeng" name="DC.Creator"/>
<meta content="Zhang, Yunfei" name="DC.Creator"/>
<meta content="Zong, Ning" name="DC.Creator"/>
<meta content="This document defines an optional extension to the REsource LOcation
And Discovery (RELOAD) protocol to support the direct response routing
mode. RELOAD recommends symmetric recursive routing for routing
messages. The new optional extension provides a shorter route for
responses, thereby reducing overhead on intermediate peers. This
document also describes potential cases where this extension can be
used." name="DC.Description.Abstract"/>
<meta content="An Extension to the REsource LOcation And Discovery (RELOAD) Protocol to Support Direct Response Routing" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7263 - An Extension to the REsource LOcation And Discovery (RELOAD) Protocol to Support Direct Response Routing</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7263.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7263" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-p2psip-drr" title="draft-ietf-p2psip-drr">draft-ietf-p2ps...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7263" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7263" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7263" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                           N. Zong
Request for Comments: 7263                                      X. Jiang
Category: Standards Track                                        R. Even
ISSN: 2070-1721                                      Huawei Technologies
                                                                Y. Zhang
                                                  CoolPad / China Mobile
                                                               June 2014


 <span class="h1">An Extension to the REsource LOcation And Discovery (RELOAD) Protocol</span>
                   <span class="h1">to Support Direct Response Routing</span>

Abstract

   This document defines an optional extension to the REsource LOcation
   And Discovery (RELOAD) protocol to support the direct response
   routing mode.  RELOAD recommends symmetric recursive routing for
   routing messages.  The new optional extension provides a shorter
   route for responses, thereby reducing overhead on intermediate peers.
   This document also describes potential cases where this extension can
   be used.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7263">http://www.rfc-editor.org/info/rfc7263</a>.
















<span class="grey">Zong, et al.                 Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Zong, et al.                 Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Overview ........................................................<a href="#page-5">5</a>
      <a href="#section-3.1">3.1</a>. SRR and DRR ................................................<a href="#page-5">5</a>
           <a href="#section-3.1.1">3.1.1</a>. Symmetric Recursive Routing (SRR) ...................<a href="#page-6">6</a>
           <a href="#section-3.1.2">3.1.2</a>. Direct Response Routing (DRR) .......................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. Scenarios Where DRR Can Be Used ............................<a href="#page-7">7</a>
           <a href="#section-3.2.1">3.2.1</a>. Managed or Closed P2P Systems .......................<a href="#page-7">7</a>
           <a href="#section-3.2.2">3.2.2</a>. Wireless Scenarios ..................................<a href="#page-8">8</a>
   <a href="#section-4">4</a>. Relationship between SRR and DRR ................................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. How DRR Works ..............................................<a href="#page-8">8</a>
      <a href="#section-4.2">4.2</a>. How SRR and DRR Work Together ..............................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. DRR Extensions to RELOAD ........................................<a href="#page-9">9</a>
      <a href="#section-5.1">5.1</a>. Basic Requirements .........................................<a href="#page-9">9</a>
      <a href="#section-5.2">5.2</a>. Modification to RELOAD Message Structure ...................<a href="#page-9">9</a>
           <a href="#section-5.2.1">5.2.1</a>. State-Keeping Flag ..................................<a href="#page-9">9</a>
           <a href="#section-5.2.2">5.2.2</a>. Extensive Routing Mode .............................<a href="#page-10">10</a>
      <a href="#section-5.3">5.3</a>. Creating a Request ........................................<a href="#page-11">11</a>
           <a href="#section-5.3.1">5.3.1</a>. Creating a Request for DRR .........................<a href="#page-11">11</a>
      <a href="#section-5.4">5.4</a>. Request and Response Processing ...........................<a href="#page-11">11</a>
           5.4.1. Destination Peer: Receiving a Request and
                  Sending a Response .................................<a href="#page-11">11</a>
           <a href="#section-5.4.2">5.4.2</a>. Sending Peer: Receiving a Response .................<a href="#page-12">12</a>
   <a href="#section-6">6</a>. Overlay Configuration Extension ................................<a href="#page-12">12</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-12">12</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-13">13</a>
      <a href="#section-8.1">8.1</a>. A New RELOAD Forwarding Option ............................<a href="#page-13">13</a>
      <a href="#section-8.2">8.2</a>. A New IETF XML Registry ...................................<a href="#page-13">13</a>
   <a href="#section-9">9</a>. Acknowledgments ................................................<a href="#page-13">13</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-13">13</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-13">13</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-14">14</a>
   <a href="#appendix-A">Appendix A</a>. Optional Methods to Investigate Peer Connectivity .....<a href="#page-15">15</a>
     <a href="#appendix-A.1">A.1</a>. Getting Addresses to Be Used as Candidates for DRR .........<a href="#page-15">15</a>
     <a href="#appendix-A.2">A.2</a>. Public Reachability Test ...................................<a href="#page-16">16</a>
   <a href="#appendix-B">Appendix B</a>. Comparison of Cost of SRR and DRR .....................<a href="#page-17">17</a>
     <a href="#appendix-B.1">B.1</a>. Closed or Managed Networks .................................<a href="#page-17">17</a>
     <a href="#appendix-B.2">B.2</a>. Open Networks ..............................................<a href="#page-19">19</a>











<span class="grey">Zong, et al.                 Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The REsource LOcation And Discovery (RELOAD) protocol [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>]
   recommends symmetric recursive routing (SRR) for routing messages and
   describes the extensions that would be required to support additional
   routing algorithms.  In addition to SRR, two other routing options --
   direct response routing (DRR) and relay peer routing (RPR) -- are
   also discussed in <a href="rfc6940.html#appendix-A">Appendix A of [RFC6940]</a>.  As we show in <a href="#section-3">Section 3</a>,
   DRR is advantageous over SRR in some scenarios in that DRR can reduce
   load (CPU and link bandwidth) on intermediate peers.  For example, in
   a closed network where every peer is in the same address realm, DRR
   performs better than SRR.  In other scenarios, using a combination of
   DRR and SRR together is more likely to provide benefits than if SRR
   is used alone.

   Note that in this document we focus on the DRR mode and its
   extensions to RELOAD to produce a standalone solution.  Please refer
   to [<a href="rfc7264.html" title='"An Extension to the REsource LOcation And Discovery (RELOAD) Protocol to Support Relay Peer Routing"'>RFC7264</a>] for details on the RPR mode.

   We first discuss the problem statement in <a href="#section-3">Section 3</a>.  How to combine
   DRR and SRR is presented in <a href="#section-4">Section 4</a>.  An extension to RELOAD to
   support DRR is defined in <a href="#section-5">Section 5</a>.  Some optional methods to check
   peer connectivity are introduced in <a href="#appendix-A">Appendix A</a>.  In <a href="#appendix-B">Appendix B</a>, we
   give a comparison of the cost of SRR and DRR in both managed and open
   networks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   We use terminology and definitions from the base RELOAD specification
   [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>] extensively in this document.  We also use terms defined in
   the NAT behavior discovery document [<a href="rfc5780.html" title='"NAT Behavior Discovery Using Session Traversal Utilities for NAT (STUN)"'>RFC5780</a>].  Other terms used in
   this document are defined inline when used and are also defined below
   for reference.

      Publicly Reachable: A peer is publicly reachable if it can receive
      unsolicited messages from any other peer in the same overlay.
      Note: "Publicly" does not mean that the peers must be on the
      public Internet, because the RELOAD protocol may be used in a
      closed network.








<span class="grey">Zong, et al.                 Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


      Direct Response Routing (DRR): "DRR" refers to a routing mode in
      which responses to Peer-to-Peer SIP (P2PSIP) requests are returned
      to the sending peer directly from the destination peer based on
      the sending peer's own local transport address(es).  For
      simplicity, the abbreviation "DRR" is used in the rest of this
      document.

      Symmetric Recursive Routing (SRR): "SRR" refers to a routing mode
      in which responses follow the reverse path of the request to get
      to the sending peer.  For simplicity, the abbreviation "SRR" is
      used in the rest of this document.

      Relay Peer Routing (RPR): "RPR" refers to a routing mode in which
      responses to P2PSIP requests are sent by the destination peer to
      the transport address of a relay peer that will forward the
      responses towards the sending peer.  For simplicity, the
      abbreviation "RPR" is used in the rest of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Overview</span>

   RELOAD is expected to work under a great number of application
   scenarios.  The situations where RELOAD is to be deployed differ
   greatly.  For instance, some deployments are global, such as a
   Skype-like system intended to provide public service, while others
   run in small-scale closed networks.  SRR works in any situation, but
   DRR may work better in some specific scenarios.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20SRR%20and%20DRR"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  SRR and DRR</span>

   RELOAD is a simple request-response protocol.  After sending a
   request, a peer waits for a response from a destination peer.  There
   are several ways for the destination peer to send a response back to
   the source peer.  In this section, we will provide detailed
   information on two routing modes: SRR and DRR.

   Some assumptions are made in the illustrations that follow:

   1)  Peer A sends a request destined to a peer who is the responsible
       peer for a Resource-ID k.

   2)  Peer X is the root peer responsible for Resource-ID k.

   3)  The intermediate peers for the path from A to X are peers B, C,
       and D.







<span class="grey">Zong, et al.                 Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20%20Symmetric%20Recursive%20Routing%20%28SRR%29"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>.  Symmetric Recursive Routing (SRR)</span>

   For SRR, when the request sent by peer A is received by an
   intermediate peer B, C, or D, each intermediate peer will insert
   information on the peer from whom they got the request in the
   Via List, as described in RELOAD [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>].  As a result, the
   destination peer X will know the exact path that the request has
   traversed.  Peer X will then send back the response in the reverse
   path by constructing a Destination List based on the Via List in the
   request.  Figure 1 illustrates SRR.

         A            B            C             D           X
         |  Request   |            |            |            |
         |-----------&gt;|            |            |            |
         |            | Request    |            |            |
         |            |-----------&gt;|            |            |
         |            |            | Request    |            |
         |            |            |-----------&gt;|            |
         |            |            |            | Request    |
         |            |            |            |-----------&gt;|
         |            |            |            |            |
         |            |            |            |  Response  |
         |            |            |            |&lt;-----------|
         |            |            |  Response  |            |
         |            |            |&lt;-----------|            |
         |            |  Response  |            |            |
         |            |&lt;-----------|            |            |
         |  Response  |            |            |            |
         |&lt;-----------|            |            |            |
         |            |            |            |            |

                            Figure 1: SRR Mode

   SRR works in any situation, especially when there are NATs or
   firewalls.  A downside of this solution is that the message takes
   several hops to return to the peer, increasing the bandwidth usage
   and CPU/battery load of multiple peers.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.%20%20Direct%20Response%20Routing%20%28DRR%29"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a>.  Direct Response Routing (DRR)</span>

   In DRR, peer X receives the request sent by peer A through
   intermediate peers B, C, and D, as in SRR.  However, peer X sends the
   response back directly to peer A based on peer A's local transport
   address.  In this case, the response is not routed through
   intermediate peers.  Figure 2 illustrates DRR.  Using a shorter route
   means less overhead on intermediate peers, especially in the case of
   wireless networks where the CPU and uplink bandwidth are limited.
   For example, in the absence of NATs, or if the NAT implements



<span class="grey">Zong, et al.                 Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   endpoint-independent filtering, this is the optimal routing
   technique.  Note that establishing a secure connection requires
   multiple round trips.  Please refer to <a href="#appendix-B">Appendix B</a> for a cost
   comparison between SRR and DRR.

           A            B            C             D           X
           |  Request   |            |            |            |
           |-----------&gt;|            |            |            |
           |            | Request    |            |            |
           |            |-----------&gt;|            |            |
           |            |            | Request    |            |
           |            |            |-----------&gt;|            |
           |            |            |            | Request    |
           |            |            |            |-----------&gt;|
           |            |            |            |            |
           |            |            |            |  Response  |
           |&lt;-----------+------------+------------+------------|
           |            |            |            |            |

                            Figure 2: DRR Mode

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Scenarios%20Where%20DRR%20Can%20Be%20Used"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Scenarios Where DRR Can Be Used</span>

   This section lists several scenarios where using DRR would work and
   identifies when the increased efficiency would be advantageous.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Managed%20or%20Closed%20P2P%20Systems"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Managed or Closed P2P Systems</span>

   The properties that make P2P technology attractive, such as the lack
   of need for centralized servers, self-organization, etc., are
   attractive for managed systems as well as unmanaged systems.  Many of
   these systems are deployed on private networks where peers are in the
   same address realm and/or can directly route to each other.  In such
   a scenario, the network administrator can indicate preference for DRR
   in the peer's configuration file.  Peers in such a system would
   always try DRR first, but peers MUST also support SRR in case DRR
   fails.  During the process of establishing a direct connection with
   the sending peer, if the responding peer receives a request with SRR
   as the preferred routing mode (or it fails to establish the direct
   connection), the responding peer SHOULD NOT use DRR but instead
   switch to SRR.  The simple policy is to try DRR and, if this fails,
   switch to SRR for all connections.  In a finer-grained policy, a peer
   would keep a list of unreachable peers based on trying DRR and then
   would use only SRR for those peers.  The advantage of using DRR is
   network stability, since it puts less overhead on the intermediate
   peers that will not route the responses.  The intermediate peers will
   need to route fewer messages and will save CPU resources as well as
   link bandwidth usage.



<span class="grey">Zong, et al.                 Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20Wireless%20Scenarios"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  Wireless Scenarios</span>

   In some mobile deployments, using DRR may help reduce radio battery
   usage and bandwidth by the intermediate peers.  The service provider
   may recommend using DRR based on his knowledge of the topology.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Relationship%20between%20SRR%20and%20DRR"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Relationship between SRR and DRR</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20How%20DRR%20Works"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  How DRR Works</span>

   DRR is very simple.  The only requirement is for the source peers to
   provide their potential (publicly reachable) transport address to the
   destination peers, so that the destination peer knows where to send
   the response.  Responses are sent directly to the requesting peer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20How%20SRR%20and%20DRR%20Work%20Together"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  How SRR and DRR Work Together</span>

   DRR is not intended to replace SRR.  It is better to use these two
   modes together to adapt to each peer's specific situation.  In this
   section, we give some informative suggestions for how to transition
   between the routing modes in RELOAD.

   According to [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>], SRR MUST be supported.  An overlay MAY be
   configured to use alternative routing algorithms, and alternative
   routing algorithms MAY be selected on a per-message basis.  That is,
   a node in an overlay that supports SRR and some other routing
   algorithm -- for example, DRR -- might use SRR some of the time and
   DRR some of the time.  A node joining the overlay should get the
   preferred routing mode from the configuration file.  If an overlay
   runs within a private network and all peers in the system can reach
   each other directly, peers MAY send most of the transactions with
   DRR.  However, DRR SHOULD NOT be used in the open Internet or if the
   administrator does not feel he has enough information about the
   overlay network topology.  A new overlay configuration element
   specifying the usage of DRR is defined in <a href="#section-6">Section 6</a>.

   Alternatively, a peer can collect statistical data on the success of
   the different routing modes based on previous transactions and keep a
   list of non-reachable addresses.  Based on this data, the peer will
   have a clearer view of the success rate of different routing modes.
   In addition to data on the success rate, the peer can also get data
   of finer granularity -- for example, the number of retransmissions
   the peer needs to achieve a desirable success rate.

   A typical strategy for the peer is as follows.  A peer chooses to
   start with DRR based on the configuration.  Based on the success rate
   as indicated by statistics on lost messages or by responses that used
   DRR, the peer can either continue to offer DRR first or switch to



<span class="grey">Zong, et al.                 Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   SRR.  Note that a peer should use the DRR success statistics to
   decide whether to continue using DRR or fall back to SRR.  Making
   such a decision per specific connection is not recommended; this
   should be an application decision.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20DRR%20Extensions%20to%20RELOAD"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  DRR Extensions to RELOAD</span>

   Adding support for DRR requires extensions to the current RELOAD
   protocol.  In this section, we define the required extensions,
   including extensions to message structure and message processing.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Basic%20Requirements"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Basic Requirements</span>

   All peers MUST be able to process requests for routing in SRR and MAY
   support DRR routing requests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Modification%20to%20RELOAD%20Message%20Structure"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Modification to RELOAD Message Structure</span>

   RELOAD provides an extensible framework to accommodate future
   extensions.  In this section, we define a ForwardingOption structure
   to support DRR mode.  Additionally, we present a state-keeping flag
   to inform intermediate peers if they are allowed to not maintain
   state for a transaction.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20State-Keeping%20Flag"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  State-Keeping Flag</span>

   RELOAD allows intermediate peers to maintain state in order to
   implement SRR -- for example, for implementing hop-by-hop
   retransmission.  If DRR is used, the response will not follow the
   reverse path, and the state in the intermediate peers will not be
   cleared until such state expires.  In order to address this issue, we
   define a new flag, state-keeping flag, in the ForwardingOption
   structure to indicate whether the state-keeping is required in the
   intermediate peers.

   Flag: 0x08 IGNORE-STATE-KEEPING

   If IGNORE-STATE-KEEPING is set, any peer receiving this message but
   who is not the destination of the message SHOULD forward the message
   with the full Via List and SHOULD NOT maintain any internal state.











<span class="grey">Zong, et al.                 Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20Extensive%20Routing%20Mode"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  Extensive Routing Mode</span>

   This document introduces a new forwarding option for an extensive
   routing mode.  This option conforms to the description in
   <a href="rfc6940.html#section-6.3.2.3">Section 6.3.2.3 of [RFC6940]</a>.

   We first define a new type to define the new option,
   extensive_routing_mode:

   The option value that defines the ExtensiveRoutingModeOption
   structure is illustrated below:

   enum {(0),DRR(1),(255)} RouteMode;
   struct {
           RouteMode               routemode;
           OverlayLinkType         transport;
           IpAddressPort           ipaddressport;
           Destination             destinations&lt;1..2^8-1&gt;;
   } ExtensiveRoutingModeOption;

   The above structure reuses the OverlayLinkType, Destination, and
   IpAddressPort structures as defined in Sections <a href="#section-6.5.1.1">6.5.1.1</a>, <a href="#section-6.3.2.2">6.3.2.2</a>, and
   6.3.1.1 of [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>], respectively.

   RouteMode: refers to which type of routing mode is indicated to the
   destination peer.

   OverlayLinkType: refers to the transport type that is used to deliver
   responses from the destination peer to the sending peer.

   IpAddressPort: refers to the transport address that the destination
   peer will use for sending responses.  This will be a sending peer
   address for DRR.

   Destination: refers to the sending peer itself.  If the routing mode
   is DRR, then the destination only contains the sending peer's
   Node-ID.














<span class="grey">Zong, et al.                 Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Creating%20a%20Request"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Creating a Request</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.1.%20%20Creating%20a%20Request%20for%20DRR"></a><a class="selflink" href="#section-5.3.1" name="section-5.3.1">5.3.1</a>.  Creating a Request for DRR</span>

   When using DRR for a transaction, the sending peer MUST set the
   IGNORE-STATE-KEEPING flag in the ForwardingHeader.  Additionally, the
   peer MUST construct and include a ForwardingOption structure in the
   ForwardingHeader.  When constructing the ForwardingOption structure,
   the fields MUST be set as follows:

   1)  The type MUST be set to extensive_routing_mode.

   2)  The ExtensiveRoutingModeOption structure MUST be used for the
       option field within the ForwardingOption structure.  The fields
       MUST be defined as follows:

       2.1)  routemode set to 0x01 (DRR).

       2.2)  transport set as appropriate for the sender.

       2.3)  ipaddressport set to the peer's associated transport
             address.

       2.4)  The destination structure MUST contain one value, defined
             as type "node" and set with the sending peer's own values.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20Request%20and%20Response%20Processing"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  Request and Response Processing</span>

   This section gives normative text for message processing after DRR is
   introduced.  Here, we only describe the additional procedures for
   supporting DRR.  Please refer to [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>] for RELOAD base
   procedures.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.4.1.%20%20Destination%20Peer%3A%20Receiving%20a%20Request%20and%20Sending%20a%20Response"></a><a class="selflink" href="#section-5.4.1" name="section-5.4.1">5.4.1</a>.  Destination Peer: Receiving a Request and Sending a Response</span>

   When the destination peer receives a request, it will check the
   options in the forwarding header.  If the destination peer cannot
   understand the extensive_routing_mode option in the request, it MUST
   attempt to use SRR to return an "Error_Unknown_Extension" response
   (defined in Sections <a href="#section-6.3.3.1">6.3.3.1</a> and <a href="#section-14.9">14.9</a> of [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>]) to the sending
   peer.

   If the routing mode is DRR, the destination peer MUST construct the
   Destination List for the response with only one entry, using the
   requesting peer's Node-ID from the Via List in the request as the
   value.





<span class="grey">Zong, et al.                 Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   In the event that the routing mode is set to DRR and there is not
   exactly one destination, the destination peer MUST try to return an
   "Error_Unknown_Extension" response (defined in Sections <a href="#section-6.3.3.1">6.3.3.1</a> and
   14.9 of [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>]) to the sending peer using SRR.

   After the peer constructs the Destination List for the response, it
   sends the response to the transport address, which is indicated in
   the ipaddressport field in the option using the specific transport
   mode in the ForwardingOption.  If the destination peer receives a
   retransmit with SRR preference on the message it is trying to respond
   to now, the responding peer SHOULD abort the DRR response and
   use SRR.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.4.2.%20%20Sending%20Peer%3A%20Receiving%20a%20Response"></a><a class="selflink" href="#section-5.4.2" name="section-5.4.2">5.4.2</a>.  Sending Peer: Receiving a Response</span>

   Upon receiving a response, the peer follows the rules in [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>].
   The peer SHOULD note if DRR worked, in order to decide whether to
   offer DRR again.  If the peer does not receive a response until the
   timeout, it SHOULD resend the request using SRR.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Overlay%20Configuration%20Extension"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Overlay Configuration Extension</span>

   This document extends the RELOAD overlay configuration (see
   <a href="rfc6940.html#section-11.1">Section 11.1 of [RFC6940]</a>) by adding one new element, "route-mode",
   inside each "configuration" element.

   The Compact Regular Language for XML Next Generation (RELAX NG)
   grammar for this element is:

      namespace route-mode = "urn:ietf:params:xml:ns:p2p:route-mode"

      parameter &amp;= element route-mode:mode { xsd:string }?

   This namespace is added into the &lt;mandatory-extension&gt; element in the
   overlay configuration file.  The defined routing modes include DRR
   and RPR.

   The mode can be DRR or RPR and, if specified in the configuration,
   should be the preferred routing mode used by the application.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security Considerations</span>

   The normative security recommendations of <a href="rfc6940.html#section-13">Section 13 of [RFC6940]</a> are
   applicable to this document.  As a routing alternative, the security
   part of DRR conforms to <a href="rfc6940.html#section-13.6">Section 13.6 of [RFC6940]</a>, which describes
   routing security.  For example, the DRR routing option provides
   information about the route back to the source.  According to




<span class="grey">Zong, et al.                 Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   <a href="rfc6940.html#section-13.6">Section 13.6 of [RFC6940]</a>, the entire DRR routing message MUST be
   digitally signed and sent over via a protected channel to protect the
   DRR routing information.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20A%20New%20RELOAD%20Forwarding%20Option"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  A New RELOAD Forwarding Option</span>

   A new RELOAD Forwarding Option type has been added to the "RELOAD
   Forwarding Option" registry defined in [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>].

   Code: 2
   Forwarding Option: extensive_routing_mode

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20A%20New%20IETF%20XML%20Registry"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  A New IETF XML Registry</span>

   IANA has registered the following URN in the "XML Namespaces" class
   of the "IETF XML Registry" in accordance with [<a href="rfc3688.html" title='"The IETF XML Registry"'>RFC3688</a>].

   URI: urn:ietf:params:xml:ns:p2p:route-mode

   Registrant Contact: The IESG

   XML: This specification

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Acknowledgments"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Acknowledgments</span>

   David Bryan helped extensively with this document and helped provide
   some of the text, analysis, and ideas contained here.  The authors
   would like to thank Ted Hardie, Narayanan Vidya, Dondeti Lakshminath,
   Bruce Lowekamp, Stephane Bryant, Marc Petit-Huguenin, and Carlos
   Jesus Bernardos Cano for their constructive comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3688" name="ref-RFC3688">RFC3688</a>]  Mealling, M., "The IETF XML Registry", <a href="https://tools.ietf.org/html/bcp81">BCP 81</a>, <a href="rfc3688.html">RFC 3688</a>,
              January 2004.

   [<a id="ref-RFC6940" name="ref-RFC6940">RFC6940</a>]  Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and
              H. Schulzrinne, "REsource LOcation And Discovery (RELOAD)
              Base Protocol", <a href="rfc6940.html">RFC 6940</a>, January 2014.





<span class="grey">Zong, et al.                 Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-Chord" name="ref-Chord">Chord</a>]    Stoica, I., Morris, R., Liben-Nowell, D., Karger, D.,
              Kaashoek, M., Dabek, F., and H. Balakrishnan, "Chord: A
              Scalable Peer-to-Peer Lookup Protocol for Internet
              Applications", IEEE/ACM Transactions on Networking
              Volume 11, Issue 1, 17-32, February 2003.

   [<a id="ref-DTLS" name="ref-DTLS">DTLS</a>]     Modadugu, N. and E. Rescorla, "The Design and
              Implementation of Datagram TLS", Proc. 11th Network and
              Distributed System Security Symposium (NDSS),
              February 2004.

   [<a id="ref-IGD2" name="ref-IGD2">IGD2</a>]     UPnP Forum, "WANIPConnection:2 Service", September 2010,
              &lt;<a href="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v2-Service.pdf">http://upnp.org/specs/gw/</a>
              <a href="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v2-Service.pdf">UPnP-gw-WANIPConnection-v2-Service.pdf</a>&gt;.

   [<a id="ref-RFC3424" name="ref-RFC3424">RFC3424</a>]  Daigle, L. and IAB, "IAB Considerations for UNilateral
              Self-Address Fixing (UNSAF) Across Network Address
              Translation", <a href="rfc3424.html">RFC 3424</a>, November 2002.

   [<a id="ref-RFC5780" name="ref-RFC5780">RFC5780</a>]  MacDonald, D. and B. Lowekamp, "NAT Behavior Discovery
              Using Session Traversal Utilities for NAT (STUN)",
              <a href="rfc5780.html">RFC 5780</a>, May 2010.

   [<a id="ref-RFC6886" name="ref-RFC6886">RFC6886</a>]  Cheshire, S. and M. Krochmal, "NAT Port Mapping Protocol
              (NAT-PMP)", <a href="rfc6886.html">RFC 6886</a>, April 2013.

   [<a id="ref-RFC7264" name="ref-RFC7264">RFC7264</a>]  Zong, N., Jiang, X., Even, R., and Y. Zhang, "An Extension
              to the REsource LOcation And Discovery (RELOAD) Protocol
              to Support Relay Peer Routing", <a href="rfc7264.html">RFC 7264</a>, June 2014.

   [<a id="ref-wikiChord" name="ref-wikiChord">wikiChord</a>]
              Wikipedia, "Chord (peer-to-peer)", 2013,
              &lt;<a href="http://en.wikipedia.org/w/index.php?title=Chord_%28peer-to-peer%29&amp;oldid=549516287">http://en.wikipedia.org/w/</a>
              <a href="http://en.wikipedia.org/w/index.php?title=Chord_%28peer-to-peer%29&amp;oldid=549516287">index.php?title=Chord_%28peer-to-peer%29&amp;oldid=549516287</a>&gt;.















<span class="grey">Zong, et al.                 Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Optional%20Methods%20to%20Investigate%20Peer%20Connectivity"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Optional Methods to Investigate Peer Connectivity</span>

   This section is for informational purposes only and provides some
   mechanisms that can be used when the configuration information does
   not specify if DRR can be used.  It summarizes some methods that can
   be used by a peer to determine its own network location compared with
   NAT.  These methods may help a peer to decide which routing mode it
   may wish to try.  Note that there is no foolproof way to determine
   whether a peer is publicly reachable, other than via out-of-band
   mechanisms.  This document addresses UNilateral Self-Address Fixing
   (UNSAF) [<a href="rfc3424.html" title='"IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation"'>RFC3424</a>] considerations by specifying a fallback plan to SRR
   [<a href="rfc6940.html" title='"REsource LOcation And Discovery (RELOAD) Base Protocol"'>RFC6940</a>].  SRR is not an UNSAF mechanism.  This document does not
   define any new UNSAF mechanisms.

   For DRR to function correctly, a peer may attempt to determine
   whether it is publicly reachable.  If it is not, the peer should fall
   back to SRR.  If the peer believes it is publicly reachable, DRR may
   be attempted.  NATs and firewalls are two major contributors to
   preventing DRR from functioning properly.  There are a number of
   techniques by which a peer can get its reflexive address on the
   public side of the NAT.  After obtaining the reflexive address, a
   peer can perform further tests to learn whether the reflexive address
   is publicly reachable.  If the address appears to be publicly
   reachable, the peer to which the address belongs can use DRR for
   responses.

   Some conditions that are unique in P2PSIP architecture could be
   leveraged to facilitate the tests.  In a P2P overlay network, each
   peer has only a partial view of the whole network and knows of a few
   peers in the overlay.  P2P routing algorithms can easily deliver a
   request from a sending peer to a peer with whom the sending peer has
   no direct connection.  This makes it easy for a peer to ask other
   peers to send unsolicited messages back to the requester.

   In the following sections, we first introduce several ways for a peer
   to get the addresses needed for further tests.  Then, a test for
   learning whether a peer may be publicly reachable is proposed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Getting%20Addresses%20to%20Be%20Used%20as%20Candidates%20for%20DRR"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Getting Addresses to Be Used as Candidates for DRR</span>

   In order to test whether a peer may be publicly reachable, the peer
   should first get one or more addresses that will be used by other
   peers to send him messages directly.  This address is either a local
   address of a peer or a translated address that is assigned by a NAT
   to the peer.






<span class="grey">Zong, et al.                 Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   Session Traversal Utilities for NAT (STUN) is used to get a reflexive
   address on the public side of a NAT with the help of STUN servers.
   NAT behavior discovery using STUN is specified in [<a href="rfc5780.html" title='"NAT Behavior Discovery Using Session Traversal Utilities for NAT (STUN)"'>RFC5780</a>].  Under
   the RELOAD architecture, a few infrastructure servers can be
   leveraged for discovering NAT behavior, such as enrollment servers,
   diagnostic servers, bootstrap servers, etc.

   The peer can use a STUN Binding request to one of the STUN servers to
   trigger a STUN Binding response, which returns the reflexive address
   from the server's perspective.  If the reflexive transport address is
   the same as the source address of the Binding request, the peer can
   determine that there is likely no NAT between it and the chosen
   infrastructure server.  (Certainly, in some rare cases, the allocated
   address happens to be the same as the source address.  Further tests
   will detect this case and rule it out in the end.)  Usually, these
   infrastructure servers are publicly reachable in the overlay, so the
   peer can be considered publicly reachable.  On the other hand, using
   the techniques in [<a href="rfc5780.html" title='"NAT Behavior Discovery Using Session Traversal Utilities for NAT (STUN)"'>RFC5780</a>], a peer can also decide whether it is
   behind a NAT with endpoint-independent mapping behavior.  If the peer
   is behind a NAT with endpoint-independent mapping behavior, the
   reflexive address should also be a candidate for further tests.

   The Universal Plug and Play Internet Gateway Device (UPnP-IGD) [<a href="#ref-IGD2" title='"WANIPConnection:2 Service"'>IGD2</a>]
   is a mechanism that a peer can use to get the assigned address from
   its residential gateway, and after obtaining this address to
   communicate it with other peers, the peer can receive unsolicited
   messages from outside, even though it is behind a NAT.  So, the
   address obtained through the UPnP mechanism should also be used for
   further tests.

   Another way that a peer behind NAT can learn its assigned address by
   NAT is via the NAT Port Mapping Protocol (NAT-PMP) [<a href="rfc6886.html" title='"NAT Port Mapping Protocol (NAT-PMP)"'>RFC6886</a>].  As
   with UPnP-IGD, the address obtained using this mechanism should also
   be tested further.

   The above techniques are not exhaustive.  These techniques can be
   used to get candidate transport addresses for further tests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Public%20Reachability%20Test"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Public Reachability Test</span>

   Using the transport addresses obtained by the above techniques, a
   peer can start a test to learn whether the candidate transport
   address is publicly reachable.  The basic idea of the test is that a
   peer sends a request and expects another peer in the overlay to send
   back a response.  If the response is successfully received by the
   sending peer and the peer giving the response has no direct





<span class="grey">Zong, et al.                 Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   connection with the sending peer, the sending peer can determine that
   the address is probably publicly reachable and hence the peer may be
   publicly reachable at the tested transport address.

   In a P2P overlay, a request is routed through the overlay and finally
   a destination peer will terminate the request and give the response.
   In a large system, there is a high probability that the destination
   peer has no direct connection with the sending peer.  Every peer
   maintains a connection table, particularly in the RELOAD
   architecture, so it is easier for a peer to see whether it has direct
   connection with another peer.

   If a peer wants to test whether its transport address is publicly
   reachable, it can send a request to the overlay.  The routing for the
   test message would be different from other kinds of requests because
   it is not for storing or fetching something to or from the overlay,
   or for locating a specific peer; instead, it is to get a peer who can
   deliver to the sending peer an unsolicited response and who has no
   direct connection with him.  Each intermediate peer receiving the
   request first checks to see whether it has a direct connection with
   the sending peer.  If there is a direct connection, the request is
   routed to the next peer.  If there is no direct connection, the
   intermediate peer terminates the request and sends the response back
   directly to the sending peer with the transport address under test.

   After performing the test, if the peer determines that it may be
   publicly reachable, it can try DRR in subsequent transactions.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Comparison%20of%20Cost%20of%20SRR%20and%20DRR"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Comparison of Cost of SRR and DRR</span>

   The major advantage of using DRR is that it reduces the number of
   intermediate peers traversed by the response.  This reduces the load,
   such as processing and communication bandwidth, on those peers'
   resources.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.1.%20%20Closed%20or%20Managed%20Networks"></a><a class="selflink" href="#appendix-B.1" name="appendix-B.1">B.1</a>.  Closed or Managed Networks</span>

   As described in <a href="#section-3">Section 3</a>, many P2P systems run in a closed or
   managed environment (e.g., carrier networks), so network
   administrators would know that they could safely use DRR.

   SRR uses more routing hops than DRR.  Assuming that there are N peers
   in the P2P system and Chord [<a href="#ref-Chord" title='"Chord: A Scalable Peer-to-Peer Lookup Protocol for Internet Applications"'>Chord</a>] [<a href="#ref-wikiChord">wikiChord</a>] is applied for
   routing, the number of hops for a response in SRR and in DRR are
   listed in the following table.  Establishing a secure connection
   between the sending peer and the responding peer with Transport Layer
   Security (TLS) or Datagram TLS (DTLS) requires multiple messages.
   Note that establishing (D)TLS secure connections for a P2P overlay is



<span class="grey">Zong, et al.                 Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


   not optimal in some cases, e.g., DRR where (D)TLS is heavy for
   temporary connections.  Therefore, in the following table we show the
   cases of 1) no (D)TLS in DRR and 2) still using DTLS in DRR as
   sub-optimal.  As the worst-cost case, seven (7) messages are used
   during DTLS handshaking [<a href="#ref-DTLS" title='"The Design and Implementation of Datagram TLS"'>DTLS</a>].  (The TLS handshake is a negotiation
   protocol that requires two (2) round trips, while the DTLS handshake
   is a negotiation protocol that requires three (3) round trips.)

            Mode       | Success | No. of Hops | No. of Msgs
            ------------------------------------------------
            SRR        |  Yes    |     log(N)  |    log(N)
            DRR        |  Yes    |     1       |    1
            DRR (DTLS) |  Yes    |     1       |    7+1

         Table 1: Comparison of SRR and DRR in Closed Networks

   From the above comparison, it is clear that:

   1)  In most cases when the number of peers (N) &gt; 2 (2^1), DRR uses
       fewer hops than SRR.  Using a shorter route means less overhead
       and resource usage on intermediate peers, which is an important
       consideration for adopting DRR in the cases where such resources
       as CPU and bandwidth are limited, e.g., the case of mobile,
       wireless networks.

   2)  In the cases when N &gt; 256 (2^8), DRR also uses fewer messages
       than SRR.

   3)  In the cases when N &lt; 256, DRR uses more messages than SRR (but
       still uses fewer hops than SRR), so the consideration of whether
       to use DRR or SRR depends on other factors such as using less
       resources (bandwidth and processing) from the intermediate peers.
       <a href="#section-4">Section 4</a> provides use cases where DRR has a better chance of
       working or where the considerations of intermediary resources are
       important.
















<span class="grey">Zong, et al.                 Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.2.%20%20Open%20Networks"></a><a class="selflink" href="#appendix-B.2" name="appendix-B.2">B.2</a>.  Open Networks</span>

   In open networks (e.g., the Internet) where DRR is not guaranteed to
   work, DRR can fall back to SRR if it fails after trial, as described
   in <a href="#section-4">Section 4</a>.  Based on the same settings as those listed in
   <a href="#appendix-B.1">Appendix B.1</a>, the number of hops, as well as the number of messages
   for a response in SRR and DRR, are listed in the following table:

    Mode       |       Success           | No. of Hops | No. of Msgs
    ----------------------------------------------------------------
    SRR        |         Yes             |   log(N)    |   log(N)
    DRR        |         Yes             |   1         |   1
               | Fail &amp; fall back to SRR |   1+log(N)  |   1+log(N)
    DRR (DTLS) |         Yes             |   1         |   7+1
               | Fail &amp; fall back to SRR |   1+log(N)  |   8+log(N)

          Table 2: Comparison of SRR and DRR in Open Networks

   From the above comparison, it can be observed that trying to first
   use DRR could still provide an overall number of hops lower than
   directly using SRR.  Suppose that P peers are publicly reachable; the
   number of hops in DRR and SRR is P*1+(N-P)*(1+logN) and N*logN,
   respectively.  The condition for fewer hops in DRR is
   P*1+(N-P)*(1+logN) &lt; N*logN, which is P/N &gt; 1/logN.  This means that
   when the number of peers (N) grows, the required ratio of publicly
   reachable peers P/N for fewer hops in DRR decreases.  Therefore, the
   chance of trying DRR with fewer hops than SRR improves as the scale
   of the network increases.























<span class="grey">Zong, et al.                 Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7263.html">RFC 7263</a>                       P2PSIP DRR                      June 2014</span>


Authors' Addresses

   Ning Zong
   Huawei Technologies

   EMail: zongning@huawei.com


   Xingfeng Jiang
   Huawei Technologies

   EMail: jiang.x.f@huawei.com


   Roni Even
   Huawei Technologies

   EMail: roni.even@mail01.huawei.com


   Yunfei Zhang
   CoolPad / China Mobile

   EMail: hishigh@gmail.com



























Zong, et al.                 Standards Track                   [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7263 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:23 GMT --></html>