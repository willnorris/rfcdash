<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc2207 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:54 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:2207" name="DC.Identifier"/>
<meta content="This document presents extensions to Version 1 of RSVP. These
extensions permit support of individual data flows using RFC 1826, IP
Authentication Header (AH) or RFC 1827, IP Encapsulating Security
Payload (ESP). [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Lou Berger &lt;lberger@fore.com&gt;" name="DC.Creator"/>
<meta content="September, 1997" name="DC.Date.Issued"/>
<meta content="RSVP Extensions for IPSEC Data Flows" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 2207 - RSVP Extensions for IPSEC Data Flows</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc2207.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc2207" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-berger-rsvp-ext" title="draft-berger-rsvp-ext">draft-berger-rs...</a>] [<a href="https://datatracker.ietf.org/doc/rfc2207" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc2207" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc2207" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                     L. Berger
Request for Comments: 2207                             FORE Systems
Category: Standards Track                               T. O'Malley
                                                                BBN
                                                     September 1997


                  <span class="h1">RSVP Extensions for IPSEC Data Flows</span>


Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.



Abstract

   This document presents extensions to Version 1 of RSVP.  These
   extensions permit support of individual data flows using <a href="rfc1826.html">RFC 1826</a>, IP
   Authentication Header (AH) or <a href="rfc1827.html">RFC 1827</a>, IP Encapsulating Security
   Payload (ESP).  RSVP Version 1 as currently specified can support the
   IPSEC protocols, but only on a per address, per protocol basis not on
   a per flow basis.  The presented extensions can be used with both
   IPv4 and IPv6.






















<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


Table of Contents

   <a href="#section-1">1</a>   Introduction . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-2">2</a>
   <a href="#section-2">2</a>   Overview of Extensions . . . . . . . . . . . . . . . . . . <a href="#page-3">3</a>
   <a href="#section-3">3</a>   Object Definition. . . . . . . . . . . . . . . . . . . . . <a href="#page-4">4</a>
       <a href="#section-3.1">3.1</a>  SESSION Class . . . . . . . . . . . . . . . . . . . . <a href="#page-5">5</a>
       <a href="#section-3.2">3.2</a>  FILTER_SPEC Class . . . . . . . . . . . . . . . . . . <a href="#page-5">5</a>
       <a href="#section-3.3">3.3</a>  SENDER_TEMPLATE Class . . . . . . . . . . . . . . . . <a href="#page-6">6</a>
   <a href="#section-4">4</a>   Processing Rules . . . . . . . . . . . . . . . . . . . . . <a href="#page-6">6</a>
       <a href="#section-4.1">4.1</a>  Required Changes. . . . . . . . . . . . . . . . . . . <a href="#page-6">6</a>
       <a href="#section-4.2">4.2</a>  Merging Flowspecs . . . . . . . . . . . . . . . . . . <a href="#page-7">7</a>
       <a href="#section-4.2.1">4.2.1</a>  FF and SE Styles. . . . . . . . . . . . . . . . . . <a href="#page-7">7</a>
       <a href="#section-4.2.2">4.2.2</a>  WF Styles . . . . . . . . . . . . . . . . . . . . . <a href="#page-8">8</a>
   <a href="#section-5">5</a>   IANA Considerations. . . . . . . . . . . . . . . . . . . . <a href="#page-8">8</a>
   <a href="#section-6">6</a>   Security Considerations. . . . . . . . . . . . . . . . . . <a href="#page-8">8</a>
   <a href="#section-7">7</a>   References . . . . . . . . . . . . . . . . . . . . . . . .<a href="#page-10">10</a>
   <a href="#section-8">8</a>   Acknowledgments . . . . . . . . . . . .  . . . . . . . . .<a href="#page-10">10</a>
   <a href="#section-9">9</a>   Authors' Addresses . . . . . . . . . . . . . . . . . . . .<a href="#page-10">10</a>
   <a href="#appendix-A">A</a>   Options Considered . . . . . . . . . . . . . . . . . . . .<a href="#page-11">11</a>
       <a href="#appendix-A.1">A.1</a>  UDP Encapsulation . . . . . . . . . . . . . . . . . .<a href="#page-11">11</a>
       <a href="#appendix-A.2">A.2</a>  FlowID Header Encapsulation . . . . . . . . . . . . .<a href="#page-12">12</a>
       <a href="#appendix-A.3">A.3</a>  IPSEC Protocol Modification . . . . . . . . . . . . .<a href="#page-12">12</a>
       <a href="#appendix-A.4">A.4</a>  AH Transparency . . . . . . . . . . . . . . . . . . .<a href="#page-13">13</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>   Introduction</span>

   Recently published Standards Track RFCs specify protocol mechanisms
   to provide IP level security.  These IP Security, or IPSEC, protocols
   support packet level authentication, [<a href="rfc1826.html">RFC 1826</a>], and integrity and
   confidentiality [<a href="rfc1827.html">RFC 1827</a>].  A number of interoperable
   implementations already exist and several vendors have announced
   commercial products that will use these mechanisms.

   The IPSEC protocols provide service by adding a new header between a
   packet's IP header and the transport (e.g. UDP) protocol header.  The
   two security headers are the Authentication Header (AH), for
   authentication, and the Encapsulating Security Payload (ESP), for
   integrity and confidentiality.

   RSVP is being developed as a resource reservation (dynamic QoS setup)
   protocol.  RSVP as currently specified [<a href="rfc2205.html">RFC 2205</a>] is tailored towards
   IP packets carrying protocols that have TCP or UDP-like ports.
   Protocols that do not have such UDP/TCP-like ports, such as the IPSEC
   protocols, can be supported, but only with limitations.
   Specifically, for flows of IPSEC data packets, flow definition can
   only be done on per IP address, per protocol basis.





<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


   This memo proposes extensions to RSVP so that data flows containing
   IPSEC protocols can be controlled at a granularity similar to what is
   already specified for UDP and TCP.  The proposed extensions can be
   used with both IPv4 and IPv6.  <a href="#section-2">Section 2</a> of this memo will provide an
   overview of extensions.  <a href="#section-3">Section 3</a> contains a description of extended
   protocol mechanisms.  <a href="#section-4">Section 4</a> presents extended protocol processing
   rules.  <a href="#section-5">Section 5</a> defines the additional RSVP data objects.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20%20%20Overview%20of%20Extensions"></a><a class="selflink" href="#section-2" name="section-2">2</a>   Overview of Extensions</span>

   The basic notion is to extend RSVP to use the IPSEC Security
   Parameter Index, or SPI, in place of the UDP/TCP-like ports.  This
   will require a new FILTER_SPEC object, which will contain the IPSEC
   SPI, and a new SESSION object.

   While SPIs are allocated based on destination address, they will
   typically be associated with a particular sender.  As a result, two
   senders to the same unicast destination will usually have different
   SPIs.  In order to support the control of multiple independent flows
   between source and destination IP addresses, the SPI will be included
   as part of the FILTER_SPEC.  When using WF, however, all flows to the
   same IP destination address using the same IP protocol ID will share
   the same reservation.  (This limitation exists because the IPSEC
   transport headers do not contain a destination demultiplexing value
   like the UDP/TCP destination port.)

   Although the RESV message format will not change, RESV processing
   will require modification.  Processing of the new IPSEC FILTER_SPEC
   will depend on the use of the new SESSION object and on the protocol
   ID contained in the session definition.  When the new FILTER_SPEC
   object is used, the complete four bytes of the SPI will need to be
   extracted from the FILTER_SPEC for use by the packet classifier.  The
   location of the SPI in the transport header of the IPSEC packets is
   dependent on the protocol ID field.

   The extension will also require a change to PATH processing,
   specifically in the usage of the port field in a session definition.
   An RSVP session is defined by the triple: (DestAddress, protocol ID,
   DstPort).  [<a href="rfc2205.html">RFC 2205</a>] includes the definition of one type of SESSION
   object, it contains UDP/TCP destination ports, specifically "a 16-bit
   quantity carried at the octet offset +2 in the transport header" or
   zero for protocols that lack such a field.  The IPSEC protocols do









<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


   not contain such a field, but there remains a requirement for
   demultiplexing sessions beyond the IP destination address.  In order
   to satisfy this requirement, a virtual destination port, or vDstPort,
   is introduced.  The vDstPort value will be carried in the new SESSION
   object but not in the IPSEC transport header.  The vDstPort allows
   for the differentiation of multiple IPSEC sessions destined to the
   same IP address.  See <a href="#section-5">Section 5</a> for a discussion of vDstPort ranges.

   In PATH messages, the SENDER_TEMPLATE for IPSEC flows will have the
   same format as the modified FILTER_SPEC.  But, a new SESSION object
   will be used to unambiguously distinguish the use of a virtual
   destination port.

   Traffic will be mapped (classified) to reservations based on SPIs in
   FILTER_SPECs.  This, of course, means that when WF is used all flows
   to the same IP destination address and with the same IP protocol ID
   will share the same reservation.

   The advantages to the described approach are that no changes to
   <a href="rfc1826.html">RFC1826</a> and 1827 are required and that there is no additional per
   data packet overhead.  <a href="#appendix-A">Appendix A</a> contains a discussion of the
   advantages of this approach compared to several other alternatives.
   This approach does not take advantage of the IPv6 Flow Label field,
   so greater efficiency may be possible for IPv6 flows.  The details of
   IPv6 Flow Label usage is left for the future.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20%20%20Object%20Definition"></a><a class="selflink" href="#section-3" name="section-3">3</a>   Object Definition</span>

   The FILTER_SPEC and SENDER_TEMPLATE used with IPSEC protocols will
   contain a four byte field that will be used to carry the SPI.  Rather
   than label the modified field with an IPSEC specific label, SPI, the
   label "Generalized Port Identifier", or GPI, will be so that these
   object may be reused for non-IPSEC uses in the future.  The name for
   these objects are the IPv4/GPI FILTER_SPEC, IPv6/GPI FILTER_SPEC,
   IPv4/GPI SENDER_TEMPLATE, and IPv6/GPI SENDER_TEMPLATE.  Similarly,
   the new SESSION objects will be the IPv4/GPI SESSION and the IPv6/GPI
   SESSION.  When referring to the new objects, IP version will not be
   included unless a specific distinction between IPv4 and IPv6 is being
   made.












<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1%20%20SESSION%20Class"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>  SESSION Class</span>


        SESSION Class = 1.

        o    IPv4/GPI SESSION object: Class = 1, C-Type = 3

        +-------------+-------------+-------------+-------------+
        |               IPv4 DestAddress (4 bytes)              |
        +-------------+-------------+-------------+-------------+
        | Protocol ID |     Flags   |         vDstPort          |
        +-------------+-------------+-------------+-------------+


        o    IPv6/GPI SESSION object:  Class = 1, C-Type = 4

        +-------------+-------------+-------------+-------------+
        |                                                       |
        +                                                       +
        |                                                       |
        +               IPv6 DestAddress (16 bytes)             +
        |                                                       |
        +                                                       +
        |                                                       |
        +-------------+-------------+-------------+-------------+
        | Protocol ID |     Flags   |         vDstPort          |
        +-------------+-------------+-------------+-------------+

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2%20%20FILTER_SPEC%20Class"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>  FILTER_SPEC Class</span>

        FILTER_SPEC class = 10.

        o    IPv4/GPI FILTER_SPEC object: Class = 10, C-Type = 4

        +-------------+-------------+-------------+-------------+
        |               IPv4 SrcAddress (4 bytes)               |
        +-------------+-------------+-------------+-------------+
        |            Generalized Port Identifier (GPI)          |
        +-------------+-------------+-------------+-------------+












<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


        o    IPv6/GPI FILTER_SPEC object: Class = 10, C-Type = 5

        +-------------+-------------+-------------+-------------+
        |                                                       |
        +                                                       +
        |                                                       |
        +               IPv6 SrcAddress (16 bytes)              +
        |                                                       |
        +                                                       +
        |                                                       |
        +-------------+-------------+-------------+-------------+
        |            Generalized Port Identifier (GPI)          |
        +-------------+-------------+-------------+-------------+

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3%20%20SENDER_TEMPLATE%20Class"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>  SENDER_TEMPLATE Class</span>

        SENDER_TEMPLATE class = 11.

        o    IPv4/GPI SENDER_TEMPLATE object: Class = 11, C-Type = 4

                 Definition same as IPv4/GPI FILTER_SPEC object.

        o    IPv6/GPI SENDER_TEMPLATE object: Class = 11, C-Type = 5

                 Definition same as IPv6/GPI FILTER_SPEC object.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20%20%20Processing%20Rules"></a><a class="selflink" href="#section-4" name="section-4">4</a>   Processing Rules</span>

   This section presents additions to the Processing Rules presented in
   [<a href="rfc2209.html">RFC 2209</a>].  These additions are required in order to properly
   process the GPI SESSION and FILTER_SPEC objects.  Values for
   referenced error codes can be found in [<a href="rfc2205.html">RFC 2205</a>].  As in with the
   other RSVP documents, values for internally reported (API) errors are
   not defined.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1%20%20Required%20Changes"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>  Required Changes</span>

   Both RESV and PATH processing will need to be changed to support the
   new objects.  The changes ensure consistency and extend port
   processing.

   The following PATH message processing changes are required:

     o  When a session is defined using the GPI SESSION object, only
        the GPI SENDER_TEMPLATE may be used.  When this condition is
        violated, end-stations should report a "Conflicting C-Type" API
        error to the application.




<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


     o  For PATH messages that contain the GPI SESSION object,
        end-stations must verify that the protocol ID corresponds to a
        protocol known to use the GPI SESSION object.  Values 51 (AH)
        or 50 (ESP) must be supported by implementations supporting
        the described IPSEC extensions.  If an unknown protocol ID is
        used, then the API should report an "API Error" to the
        application.

     o  For such messages, the vDstPort value should be recorded.
        The vDstPort value forms part of the recorded state and is used
        to match Resv messages, but it is not passed to traffic control.
        Non-zero values of vDstPort are required.  This requirement
        ensures that a non-GPI SESSION object will never merge with a
        GPI SESSION object.  Violation of this condition causes an
        "Invalid Destination Port" API error.

     The changes to RESV message processing are:

     o  When a RESV message contains a GPI FILTER_SPEC, the session
        must be defined using the GPI SESSION object. Otherwise, this is
        a message formatting error.

     o  The GPI contained in the FILTER_SPEC must match the GPI
        contained in the SENDER_TEMPLATE.  Otherwise, a "No sender
        information for this Resv message" error  is generated.

     o  When the GPI FILTER_SPEC is used, each node must create
        a data classifier for the flow described by the quadruple:
        (DestAddress, protocol ID, SrcAddress, GPI). The data classifier
        will need to look for the four byte GPI at transport header
        offset +4 for AH, and at transport header offset +0 for ESP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2%20%20Merging%20Flowspecs"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>  Merging Flowspecs</span>

   When using this extension for IPSEC data flows, RSVP sessions are
   defined by the triple: (DestAddress, protocol Id, vDstPort).
   Similarly, a sender is defined by the tuple: (SrcAddress, GPI), where
   the GPI field will be a four byte representation of a generalized
   source port.  These extensions have some ramifications depending upon
   the reservation style.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1%20%20FF%20and%20SE%20Styles"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>  FF and SE Styles</span>

   In the FF and SE Styles, the FILTER_SPEC object contains the
   (SrcAddress, GPI) pair.  This allows the receiver to uniquely
   identify senders based on both elements of the pair.  When merging
   explicit sender descriptors, the senders may only be considered
   identical when both elements are identical.



<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2%20%20WF%20Styles"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>  WF Styles</span>

   These extensions provide very limited service when used with WF style
   reservations.  As described, the SENDER_TEMPLATE and FILTER_SPEC each
   contain the GPI.  In a WF style reservation, the RESV message does
   NOT contain a FILTER_SPEC (after all, it is a wildcard filter), and
   the SENDER_TEMPLATE is ignored (again, because any sender is
   allowed).  As a result, classifiers may match all packets which
   contain both the session's destination IP address and protocol ID to
   such WF reservations.

   Although a solution for this limitation is not proposed, this issue
   is not seen as significant since IPSEC applications are less likely
   to use WF style reservations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20%20%20IANA%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>   IANA Considerations</span>

   The range of possible vDstPort values is broken down into sections,
   in a fashion similar to the UDP/TCP port ranges.

             0              Illegal Value
             1 - 10         Reserved. Contact authors.
             11 - 8191      Assigned by IANA
             8192 - 65535   Dynamic

   IANA is directed to assign the well-known vDstPorts using the
   following criteria:  Anyone who asks for an assigned vDstPort must
   provide a) a Point of Contact, b) a brief description of intended
   use, and c) a short name to be associated with the assignment (e.g.
   "ftp").

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>   Security Considerations</span>

   The same considerations stated in [<a href="rfc2205.html">RFC 2205</a>], [<a href="rfc1826.html">RFC 1826</a>], and [RFC
   1827] apply to the extensions described in this note.  There are two
   additional issue related to these extensions.

   First, the vDstPort mechanism represents another data element about
   the IP Flow that might be available to an adversary.  Such data might
   be useful to an adversary engaging in traffic analysis by monitoring
   not only the data packets of the IP Flow but also the RSVP control
   messages associated with that Flow.  Protection against traffic
   analysis attacks is outside the scope of this mechanism.  One
   possible approach to precluding such attacks would be deployment and
   use of appropriate link-layer confidentiality mechansisms, such as
   encryption.





<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


   Secondly, Changes in SPI values for a given flow will affect RSVP
   flows and reservations.  Changes will happen whenever that flow
   changes its Security Association.  Such changes will occur when a
   flow is rekeyed (i.e. to use a new key). Rekeying intervals are
   typically set based on traffic levels, key size, threat environment,
   and crypto algorithm in use.  When an SPI change occurs it will, in
   most cases, be necessary to update (send) the corresponding
   SENDER_TEMPLATEs and FILTER_SPECs.  IPSEC implementations, RSVP
   applications, and RSVP end-station implementations will need to take
   the possibility of changes of SPI into account to ensure proper
   reservation behavior.  This issue is likely to be a tolerable, since
   rekeying intervals are under the control of local administrators.

   Many, if not most, RSVP sessions will not need to deal with this
   rekeying issue.  For those applications that do need to deal with
   changes of SPIs during a session, the impact of sending new PATH and
   RESV messages will vary based on the reservation style being used.
   Builders of such applications may want to select reservation style
   based on interaction with SPI changes.

   The least impact of an SPI change will be to WF style reservations.
   For such reservations, a new SENDER_TEMPLATE will need to be sent,
   but no new RESV is required.  For SE style reservations, both a new
   SENDER_TEMPLATE and a new RESV will need to be sent.  This will
   result in changes to state, but should not affect data packet
   delivery or actual resource allocation in any way.  The FF style will
   be impacted the most.  Like with SE, both PATH and RESV messages will
   need to be sent.  But, since FF style reservations result in sender
   receiving its own resource allocation, resources will be allocated
   twice for a period of time.  Or, even worse, there won't be enough
   resources to support the new flow without first freeing the old flow.

   A way around this FF/SPI-change problem does exist.  Applications
   that want FF style reservations can use multiple SE reservations.
   Each real sender would have a separate SESSION (vDstPort) definition.
   When it came time to switch SPIs, a shared reservation could be made
   for the new SPI while the old SPI was still active.  Once the new SPI
   was in use, the old reservation could be torn down.  This is less
   than optimal, but will provide uninterrupted service for a set of
   applications.











<span class="grey">Berger &amp; O'Malley           Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7%20%20%20References"></a><a class="selflink" href="#section-7" name="section-7">7</a>   References</span>

     [<a id="ref-RFC 2205" name="ref-RFC 2205">RFC 2205</a>] Braden, R., Ed., Zhang, L., Estrin, D., Herzog, S.,
                and S. Jamin, "Resource ReSerVation Protocol (RSVP)
                -- Version 1 Functional Specification", <a href="rfc2205.html">RFC 2205</a>,
                September 1997.

     [<a id="ref-RFC 2209" name="ref-RFC 2209">RFC 2209</a>] Braden, R., Ed., Zhang, "Resource ReSerVation
                Protocol (RSVP) -- Version 1 Message Processing
                Rules", <a href="rfc2209.html">RFC 2209</a>, September 1997.

     [<a id="ref-RFC 1825" name="ref-RFC 1825">RFC 1825</a>] Atkinson, R., "Security Architecture for the Internet
                Protocol", <a href="rfc1825.html">RFC 1825</a>, NRL, August 1995.

     [<a id="ref-RFC 1826" name="ref-RFC 1826">RFC 1826</a>] Atkinson, R., "IP Authentication Header", <a href="rfc1826.html">RFC 1826</a>, NRL,
                August 1995.

     [<a id="ref-RFC 1827" name="ref-RFC 1827">RFC 1827</a>] Atkinson, R., "IP Encapsulating Security Payload", <a href="rfc1827.html">RFC</a>
                <a href="rfc1827.html">1827</a>, NRL, August 1995.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8%20%20%20Acknowledgments"></a><a class="selflink" href="#section-8" name="section-8">8</a>   Acknowledgments</span>

   This note includes ideas originated and reviewed by a number of
   individuals who did not participate in this note's writing.  The
   authors would like to acknowledge their contribution.  We thank Ran
   Atkinson &lt;rja@cisco.com&gt;, Fred Baker &lt;fred@cisco.com&gt;, Greg Troxel
   &lt;gdt@bbn.com&gt;, John Krawczyk &lt;jkrawczyk@BayNetworks.com&gt; for much
   appreciated input and feedback. Special appreciation goes to Bob
   Braden &lt;braden@isi.edu&gt; for his detailed editorial and technical
   comments.  We also thank Buz Owen, Claudio Topolcic, Andy Veitch, and
   Luis Sanchez for their help in coming up with the proposed approach.
   If any brain-damage exists in this note, it originated solely from
   the authors.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9%20%20%20Authors%27%20Addresses"></a><a class="selflink" href="#section-9" name="section-9">9</a>   Authors' Addresses</span>

   Lou Berger                           Tim O'Malley
   FORE Systems                         BBN Corporation
   6905 Rockledge Drive                 10 Moulton Street
   Suite 800                            Cambridge, MA 02138
   Bethesda, MD 20817

   Phone: 301-571-2534                  Phone: 617-873-3076
   EMail: lberger@fore.com              EMail: timo@bbn.com







<span class="grey">Berger &amp; O'Malley           Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


A   Options Considered

   This sections reviews other approaches that were explored in
   developing the described extensions.  They are included here to
   provide additional context into the general problem.  All listed
   options were rejected by the working group.

   Four other options were considered:

   1.  UDP Encapsulation
       Add a UDP header between the IP and the IPSEC AH or ESP
       headers.

   2.  FlowID Header Encapsulation
       Add a new type of header between the IP and the IPSEC AH or
       ESP headers.

   3.  IPSEC modification
       Modify IPSEC headers so that there are appropriate fields in
       same location as UDP and TCP ports.

   4.  AH Transparency
       Skip over the Authentication Header packet classifier
       processing.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1%20%20UDP%20Encapsulation"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>  UDP Encapsulation</span>

   Since current SESSION and FILTER object expect UDP or TCP ports, this
   proposal says let's just give it to them.  The basic concept is to
   add a UDP port between the IP and AH/ESP headers.  The UDP ports
   would provide the granularity of control that is need to associate
   specific flows with reservations.

   Source and destination ports would be used, as normal, in RSVP
   session definition and control.  The port fields would also need to
   be used to identify the real transport level protocol (e.g. ESP)
   being used. Also since many UDP ports are assigned as well known
   ports, use of port numbers would be limited.  So, the port fields
   would need to be used to unambiguously identify 1) the next level
   protocol, 2) the RSVP session, and 3) the RSVP reservation.

   The advantages of this option is that no RSVP changes are required.
   The disadvantages is that, since the headers aren't in the expected
   location, <a href="rfc1826.html">RFC 1826</a> and <a href="rfc1827.html">RFC 1827</a> are violated.







<span class="grey">Berger &amp; O'Malley           Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2%20%20FlowID%20Header%20Encapsulation"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>  FlowID Header Encapsulation</span>

   [This option was originally proposed by Greg Troxel &lt;gdt@bbn.com&gt;.]

   This option is very similar to option 1, but is more generic and
   could be adopted as a standard solution.  The notion is to use UDP
   like ports for the sole purpose of flow identification.  RSVP would
   treat this new protocol exactly the same as UDP.

   The difference between this and UDP encapsulation is in destination
   host processing.  The destination host would essentially ignore port
   information and use a new field, protocol ID, to identify which
   protocol should process the packet next.  Some examples of protocol
   IDs correspond to TCP, UDP, ESP, or AH.

      The format of the FlowID Header would be:

  +---------------+---------------+---------------+---------------+
  |          Source Port          |            Dest Port          |
  +---------------+---------------+---------------+---------------+
  |  Ver  |  Len  |  Protocol ID  |            Checksum           |
  +---------------+---------------+---------------+---------------+
   1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8

       2 bytes source port                 4 bits length-32 (2)
       2 bytes dest port                   8 bits protocol ID
       4 bits version (1)                  16 bits checksum

   The advantage of this protocol is that flow identification is
   separated from all other protocol processing.  The disadvantage is
   that the addition of a header violates <a href="rfc1826.html">RFC 1826</a> and 1827, and also
   that applications using RSVP will need to add this extra header on
   all data packets whose transport headers do not have UDP/TCP like
   ports.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3%20%20IPSEC%20Protocol%20Modification"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>  IPSEC Protocol Modification</span>

   The basic notion of this option is to leave RSVP as currently
   specified and use the Security Association Identifier (SPI) found in
   the IPSEC headers for flow identification.  There are two issues with
   using the SPI. The first is that the SPI is located in the wrong
   location when using Authentication (AH).  The second issue is how to
   make use of the SPI.

   The first issue is easy to fix, but violates <a href="rfc1826.html">RFC 1826</a>.  UDP and TCP
   have port assignments in the first 4 bytes of their headers, each is
   two bytes long, source comes first, then destination.  The ESP header
   has the SPI in the same location as UDP/TCP ports, the AH doesn't.



<span class="grey">Berger &amp; O'Malley           Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


   The IP Authentication Header has the following syntax:

  +---------------+---------------+---------------+---------------+
  | Next Header   | Length        |           RESERVED            |
  +---------------+---------------+---------------+---------------+
  |                    Security Parameters Index                  |
  +---------------+---------------+---------------+---------------+
  |                                                               |
  +     Authentication Data (variable number of 32-bit words)     |
  |                                                               |
  +---------------+---------------+---------------+---------------+
   1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8

   Simply reversing the first 4 bytes with the SPI we will have the SPI
   in the location that RSVP expects.  This would be non-standard, or
   require a major (i.e. not backward compatible) change to RSVP 1826.

   The second issue is how to make use of the SPI.  Per the current RSVP
   specification, the first two bytes of a flow's SPI will need to be
   carried in the PATH message and the second two bytes in the RESV
   message.  The biggest problem is that the SPI is normally selected by
   the receiver and is likely to be different for EACH sender.  (There
   is a special case where the same SPI is used by all senders in a
   multicast group.  But this is a special case.)  It is possible to
   have the SPI selected prior to starting the RSVPsession.  This will
   work for unicast and the special multicast case.  But using this
   approach means that setup time will usually be extended by at least 1
   round trip time.  Its not clear how to support SE and WF style
   reservations.

   The advantage of this approach is no change to RSVP.  The
   disadvantages are modification to <a href="rfc1827.html">RFC1827</a> and limited support of RSVP
   reservation styles.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.4%20%20AH%20Transparency"></a><a class="selflink" href="#appendix-A.4" name="appendix-A.4">A.4</a>  AH Transparency</span>

   The source of the RSVP support of IPSEC protocols problem is that the
   real transport header is not in the expected location.  With ESP
   packets, the real source and destination ports are encrypted and
   therefore useless to RSVP.  This is not the case for authentication.
   For AH, the real header just follows the Authentication Header.  So,
   it would be possible to use the real transport header for RSVP
   session definition and reservation.

   To use the transport header, all that would need to be done is for
   the flow classifier to skip over AHs before classifying packets.  No
   modification to RSVP formats or setup processing would be required.
   Applications would make reservations based on transport (i.e., UDP or



<span class="grey">Berger &amp; O'Malley           Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc2207.html">RFC 2207</a>               RSVP Extensions for IPSEC          September 1997</span>


   TCP) ports as usual.

   The advantages of this approach are no changes to either IPSEC
   protocols or RSVP formats.  The major disadvantage is that routers
   and hosts must skip all AHs before classifying packets.  The working
   group decided that it was best to have a consistent solution for both
   AH and ESP.












































Berger &amp; O'Malley           Standards Track                    [Page 14]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc2207 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:54 GMT --></html>