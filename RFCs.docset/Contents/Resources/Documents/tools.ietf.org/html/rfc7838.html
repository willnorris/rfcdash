<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7838 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-nottingham-httpbis-alt-svc" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7838" name="DC.Identifier"/>
<meta content="April, 2016" name="DC.Date.Issued"/>
<meta content="McManus, Patrick" name="DC.Creator"/>
<meta content="Reschke, Julian" name="DC.Creator"/>
<meta content="Nottingham, Mark" name="DC.Creator"/>
<meta content="This document specifies &quot;Alternative Services&quot; for HTTP, which allow
an origin's resources to be authoritatively available at a separate
network location, possibly accessed with a different protocol
configuration." name="DC.Description.Abstract"/>
<meta content="HTTP Alternative Services" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7838 - HTTP Alternative Services</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7838.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7838" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-httpbis-alt-svc" title="draft-ietf-httpbis-alt-svc">draft-ietf-http...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7838" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7838" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7838" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                     M. Nottingham
Request for Comments: 7838                                        Akamai
Category: Standards Track                                     P. McManus
ISSN: 2070-1721                                                  Mozilla
                                                              J. Reschke
                                                              greenbytes
                                                              April 2016


                       <span class="h1">HTTP Alternative Services</span>

Abstract

   This document specifies "Alternative Services" for HTTP, which allow
   an origin's resources to be authoritatively available at a separate
   network location, possibly accessed with a different protocol
   configuration.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7838">http://www.rfc-editor.org/info/rfc7838</a>.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





<span class="grey">Nottingham, et al.           Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Notational Conventions .....................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Alternative Services Concepts ...................................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. Host Authentication ........................................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. Alternative Service Caching ................................<a href="#page-6">6</a>
      <a href="#section-2.3">2.3</a>. Requiring Server Name Indication ...........................<a href="#page-6">6</a>
      <a href="#section-2.4">2.4</a>. Using Alternative Services .................................<a href="#page-6">6</a>
   <a href="#section-3">3</a>. The Alt-Svc HTTP Header Field ...................................<a href="#page-8">8</a>
      <a href="#section-3.1">3.1</a>. Caching Alt-Svc Header Field Values .......................<a href="#page-10">10</a>
   <a href="#section-4">4</a>. The ALTSVC HTTP/2 Frame ........................................<a href="#page-11">11</a>
   <a href="#section-5">5</a>. The Alt-Used HTTP Header Field .................................<a href="#page-13">13</a>
   <a href="#section-6">6</a>. The 421 (Misdirected Request) HTTP Status Code .................<a href="#page-13">13</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-13">13</a>
      <a href="#section-7.1">7.1</a>. Header Field Registrations ................................<a href="#page-13">13</a>
      <a href="#section-7.2">7.2</a>. The ALTSVC HTTP/2 Frame Type ..............................<a href="#page-14">14</a>
      <a href="#section-7.3">7.3</a>. Alt-Svc Parameter Registry ................................<a href="#page-14">14</a>
           <a href="#section-7.3.1">7.3.1</a>. Procedure ..........................................<a href="#page-14">14</a>
           <a href="#section-7.3.2">7.3.2</a>. Registrations ......................................<a href="#page-15">15</a>
   <a href="#section-8">8</a>. Internationalization Considerations ............................<a href="#page-15">15</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-15">15</a>
      <a href="#section-9.1">9.1</a>. Changing Ports ............................................<a href="#page-15">15</a>
      <a href="#section-9.2">9.2</a>. Changing Hosts ............................................<a href="#page-15">15</a>
      <a href="#section-9.3">9.3</a>. Changing Protocols ........................................<a href="#page-16">16</a>
      <a href="#section-9.4">9.4</a>. Tracking Clients Using Alternative Services ...............<a href="#page-17">17</a>
      <a href="#section-9.5">9.5</a>. Confusion regarding Request Scheme ........................<a href="#page-17">17</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-18">18</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-18">18</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-19">19</a>
   Acknowledgements ..................................................<a href="#page-19">19</a>
   Authors' Addresses ................................................<a href="#page-20">20</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   HTTP [<a href="rfc7230.html" title='"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing"'>RFC7230</a>] conflates the identification of resources with their
   location.  In other words, "http://" and "https://" URIs are used to
   both name and find things to interact with.

   In some cases, it is desirable to separate identification and
   location in HTTP; keeping the same identifier for a resource, but
   interacting with it at a different location on the network.

   For example:

   o  An origin server might wish to redirect a client to a different
      server when it is under load, or it has found a server in a
      location that is more local to the client.



<span class="grey">Nottingham, et al.           Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   o  An origin server might wish to offer access to its resources using
      a new protocol, such as HTTP/2 [<a href="rfc7540.html" title='"Hypertext Transfer Protocol version 2"'>RFC7540</a>], or one using improved
      security, such as Transport Layer Security (TLS) [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>].

   o  An origin server might wish to segment its clients into groups of
      capabilities, such as those supporting Server Name Indication
      (SNI) (<a href="rfc6066.html#section-3">Section 3 of [RFC6066]</a>), for operational purposes.

   This specification defines a new concept in HTTP, "Alternative
   Services", that allows an origin server to nominate additional means
   of interacting with it on the network.  It defines a general
   framework for this in <a href="#section-2">Section 2</a>, along with specific mechanisms for
   advertising their existence using HTTP header fields (<a href="#section-3">Section 3</a>) or
   HTTP/2 frames (<a href="#section-4">Section 4</a>), plus a way to indicate that an alternative
   service was used (<a href="#section-5">Section 5</a>).

   It also endorses the status code 421 (Misdirected Request)
   (<a href="#section-6">Section 6</a>) that origin servers or their nominated alternatives can
   use to indicate that they are not authoritative for a given origin,
   in cases where the wrong location is used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Notational%20Conventions"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Notational Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   This document uses the Augmented BNF defined in [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] and updated
   by [<a href="rfc7405.html" title='"Case-Sensitive String Support in ABNF"'>RFC7405</a>] along with the "#rule" extension defined in <a href="rfc7230.html#section-7">Section 7 of
   [RFC7230]</a>.  The rules below are defined in [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>], [<a href="rfc7230.html" title='"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing"'>RFC7230</a>], and
   [<a href="rfc7234.html" title='"Hypertext Transfer Protocol (HTTP/1.1): Caching"'>RFC7234</a>]:

   OWS           = &lt;OWS, see <a href="rfc7230.html#section-3.2.3">[RFC7230], Section 3.2.3</a>&gt;
   delta-seconds = &lt;delta-seconds; see <a href="rfc7234.html#section-1.2.1">[RFC7234], Section 1.2.1</a>&gt;
   port          = &lt;port, see <a href="rfc7230.html#section-2.7">[RFC7230], Section 2.7</a>&gt;
   quoted-string = &lt;quoted-string, see <a href="rfc7230.html#section-3.2.6">[RFC7230], Section 3.2.6</a>&gt;
   token         = &lt;token, see <a href="rfc7230.html#section-3.2.6">[RFC7230], Section 3.2.6</a>&gt;
   uri-host      = &lt;uri-host, see <a href="rfc7230.html#section-2.7">[RFC7230], Section 2.7</a>&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Alternative%20Services%20Concepts"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Alternative Services Concepts</span>

   This specification defines a new concept in HTTP, the "Alternative
   Service".  When an origin [<a href="rfc6454.html" title='"The Web Origin Concept"'>RFC6454</a>] has resources that are accessible
   through a different protocol/host/port combination, it is said to
   have an alternative service available.






<span class="grey">Nottingham, et al.           Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   An alternative service can be used to interact with the resources on
   an origin server at a separate location on the network, possibly
   using a different protocol configuration.  Alternative services are
   considered authoritative for an origin's resources, in the sense of
   <a href="rfc7230.html#section-9.1">[RFC7230], Section 9.1</a>.

   For example, an origin:

   ("http", "www.example.com", "80")

   might declare that its resources are also accessible at the
   alternative service:

   ("h2", "new.example.com", "81")

   By their nature, alternative services are explicitly at the
   granularity of an origin; they cannot be selectively applied to
   resources within an origin.

   Alternative services do not replace or change the origin for any
   given resource; in general, they are not visible to the software
   "above" the access mechanism.  The alternative service is essentially
   alternative routing information that can also be used to reach the
   origin in the same way that DNS CNAME or SRV records define routing
   information at the name resolution level.  Each origin maps to a set
   of these routes -- the default route is derived from the origin
   itself and the other routes are introduced based on alternative-
   service information.

   Furthermore, it is important to note that the first member of an
   alternative service tuple is different from the "scheme" component of
   an origin; it is more specific, identifying not only the major
   version of the protocol being used, but potentially the communication
   options for that protocol as well.

   This means that clients using an alternative service can change the
   host, port, and protocol that they are using to fetch resources, but
   these changes MUST NOT be propagated to the application that is using
   HTTP; from that standpoint, the URI being accessed and all
   information derived from it (scheme, host, and port) are the same as
   before.

   Importantly, this includes its security context; in particular, when
   TLS [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] is used to authenticate, the alternative service will
   need to present a certificate for the origin's host name, not that of
   the alternative.  Likewise, the Host header field (<a href="rfc7230.html#section-5.4">[RFC7230],
   Section 5.4</a>) is still derived from the origin, not the alternative
   service (just as it would if a CNAME were being used).



<span class="grey">Nottingham, et al.           Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   The changes MAY, however, be made visible in debugging tools,
   consoles, etc.

   Formally, an alternative service is identified by the combination of:

   o  An Application Layer Protocol Negotiation (ALPN) protocol name, as
      per [<a href="rfc7301.html" title='"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"'>RFC7301</a>]

   o  A host, as per <a href="rfc3986.html#section-3.2.2">[RFC3986], Section 3.2.2</a>

   o  A port, as per <a href="rfc3986.html#section-3.2.3">[RFC3986], Section 3.2.3</a>

   The ALPN protocol name is used to identify the application protocol
   or suite of protocols used by the alternative service.  Note that for
   the purpose of this specification, an ALPN protocol name implicitly
   includes TLS in the suite of protocols it identifies, unless
   specified otherwise in its definition.  In particular, the ALPN name
   "http/1.1", registered by <a href="rfc7301.html#section-6">Section 6 of [RFC7301]</a>, identifies HTTP/1.1
   over TLS.

   Additionally, each alternative service MUST have a freshness
   lifetime, expressed in seconds (see <a href="#section-2.2">Section 2.2</a>).

   There are many ways that a client could discover the alternative
   service(s) associated with an origin.  This document describes two
   such mechanisms: the "Alt-Svc" HTTP header field (<a href="#section-3">Section 3</a>) and the
   "ALTSVC" HTTP/2 frame type (<a href="#section-4">Section 4</a>).

   The remainder of this section describes requirements that are common
   to alternative services, regardless of how they are discovered.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Host%20Authentication"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Host Authentication</span>

   Clients MUST have reasonable assurances that the alternative service
   is under control of and valid for the whole origin.  This mitigates
   the attack described in <a href="#section-9.2">Section 9.2</a>.

   For the purposes of this document, "reasonable assurances" can be
   established through use of a TLS-based protocol with the certificate
   checks defined in [<a href="rfc2818.html" title='"HTTP Over TLS"'>RFC2818</a>].  Clients MAY impose additional criteria
   for establishing reasonable assurances.

   For example, if the origin's host is "www.example.com" and an
   alternative is offered on "other.example.com" with the "h2" protocol,
   and the certificate offered is valid for "www.example.com", the
   client can use the alternative.  However, if either is offered with
   the "h2c" protocol, the client cannot use it, because there is no




<span class="grey">Nottingham, et al.           Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   mechanism (at the time of the publication of this specification) in
   that protocol to establish the relationship between the origin and
   the alternative.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Alternative%20Service%20Caching"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Alternative Service Caching</span>

   Mechanisms for discovering alternative services also associate a
   freshness lifetime with them; for example, the Alt-Svc header field
   uses the "ma" parameter.

   Clients can choose to use an alternative service instead of the
   origin at any time when it is considered fresh; see <a href="#section-2.4">Section 2.4</a> for
   specific recommendations.

   Clients with existing connections to an alternative service do not
   need to stop using it when its freshness lifetime ends; the caching
   mechanism is intended for limiting how long an alternative service
   can be used for establishing new connections, not limiting the use of
   existing ones.

   Alternative services are fully authoritative for the origin in
   question, including the ability to clear or update cached alternative
   service entries, extend freshness lifetimes, and any other authority
   the origin server would have.

   When alternative services are used to send a client to the most
   optimal server, a change in network configuration can result in
   cached values becoming suboptimal.  Therefore, clients SHOULD remove
   from cache all alternative services that lack the "persist" flag with
   the value "1" when they detect such a change, when information about
   network state is available.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Requiring%20Server%20Name%20Indication"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Requiring Server Name Indication</span>

   A client MUST NOT use a TLS-based alternative service unless the
   client supports TLS Server Name Indication (SNI).  This supports the
   conservation of IP addresses on the alternative service host.

   Note that the SNI information provided in TLS by the client will be
   that of the origin, not the alternative (as will the Host HTTP header
   field value).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Using%20Alternative%20Services"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Using Alternative Services</span>

   By their nature, alternative services are OPTIONAL: clients do not
   need to use them.  However, it is advantageous for clients to behave
   in a predictable way when alternative services are used by servers,
   to aid in purposes like load balancing.



<span class="grey">Nottingham, et al.           Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   Therefore, if a client supporting this specification becomes aware of
   an alternative service, the client SHOULD use that alternative
   service for all requests to the associated origin as soon as it is
   available, provided the alternative service information is fresh
   (<a href="#section-2.2">Section 2.2</a>) and the security properties of the alternative service
   protocol are desirable, as compared to the existing connection.  A
   viable alternative service is then treated in every way as the
   origin; this includes the ability to advertise alternative services.

   If a client becomes aware of multiple alternative services, it
   chooses the most suitable according to its own criteria, keeping
   security properties in mind.  For example, an origin might advertise
   multiple alternative services to notify clients of support for
   multiple versions of HTTP.

   A client configured to use a proxy for a given request SHOULD NOT
   directly connect to an alternative service for this request, but
   instead route it through that proxy.

   When a client uses an alternative service for a request, it can
   indicate this to the server using the Alt-Used header field
   (<a href="#section-5">Section 5</a>).

   The client does not need to block requests on any existing
   connection; it can be used until the alternative connection is
   established.  However, if the security properties of the existing
   connection are weak (for example, cleartext HTTP/1.1), then it might
   make sense to block until the new connection is fully available in
   order to avoid information leakage.

   Furthermore, if the connection to the alternative service fails or is
   unresponsive, the client MAY fall back to using the origin or another
   alternative service.  Note, however, that this could be the basis of
   a downgrade attack, thus losing any enhanced security properties of
   the alternative service.  If the connection to the alternative
   service does not negotiate the expected protocol (for example, ALPN
   fails to negotiate h2, or an Upgrade request to h2c is not accepted),
   the connection to the alternative service MUST be considered to have
   failed.












<span class="grey">Nottingham, et al.           Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20The%20Alt-Svc%20HTTP%20Header%20Field"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  The Alt-Svc HTTP Header Field</span>

   An HTTP(S) origin server can advertise the availability of
   alternative services to clients by adding an Alt-Svc header field to
   responses.

   Alt-Svc       = clear / 1#alt-value
   clear         = %s"clear"; "clear", case-sensitive
   alt-value     = alternative *( OWS ";" OWS parameter )
   alternative   = protocol-id "=" alt-authority
   protocol-id   = token ; percent-encoded ALPN protocol name
   alt-authority = quoted-string ; containing [ uri-host ] ":" port
   parameter     = token "=" ( token / quoted-string )

   The field value consists either of a list of values, each of which
   indicates one alternative service, or the keyword "clear".

   A field value containing the special value "clear" indicates that the
   origin requests all alternatives for that origin to be invalidated
   (including those specified in the same response, in case of an
   invalid reply containing both "clear" and alternative services).

   ALPN protocol names are octet sequences with no additional
   constraints on format.  Octets not allowed in tokens (<a href="rfc7230.html#section-3.2.6">[RFC7230],
   Section 3.2.6</a>) MUST be percent-encoded as per <a href="rfc3986.html#section-2.1">Section 2.1 of
   [RFC3986]</a>.  Consequently, the octet representing the percent
   character "%" (hex 25) MUST be percent-encoded as well.

   In order to have precisely one way to represent any ALPN protocol
   name, the following additional constraints apply:

   1.  Octets in the ALPN protocol name MUST NOT be percent-encoded if
       they are valid token characters except "%", and

   2.  When using percent-encoding, uppercase hex digits MUST be used.

   With these constraints, recipients can apply simple string comparison
   to match protocol identifiers.

   The "alt-authority" component consists of an OPTIONAL uri-host
   ("host" in <a href="rfc3986.html#section-3.2.2">Section 3.2.2 of [RFC3986]</a>), a colon (":"), and a port
   number.

   For example:

   Alt-Svc: h2=":8000"





<span class="grey">Nottingham, et al.           Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   This indicates the "h2" protocol ([<a href="rfc7540.html" title='"Hypertext Transfer Protocol version 2"'>RFC7540</a>]) on the same host using
   the indicated port 8000.

   An example involving a change of host:

   Alt-Svc: h2="new.example.org:80"

   This indicates the "h2" protocol on the host "new.example.org",
   running on port 80.  Note that the "quoted-string" syntax needs to be
   used because ":" is not an allowed character in "token".

   Examples for protocol name escaping:

   +--------------------+-------------+---------------------+
   | ALPN protocol name | protocol-id | Note                |
   +--------------------+-------------+---------------------+
   | h2                 | h2          | No escaping needed  |
   +--------------------+-------------+---------------------+
   | w=x:y#z            | w%3Dx%3Ay#z | "=" and ":" escaped |
   +--------------------+-------------+---------------------+
   | x%y                | x%25y       | "%" needs escaping  |
   +--------------------+-------------+---------------------+

   Alt-Svc MAY occur in any HTTP response message, regardless of the
   status code.  Note that recipients of Alt-Svc can ignore the header
   field (and are required to in some situations; see Sections <a href="#section-2.1">2.1</a> and
   6).

   The Alt-Svc field value can have multiple values:

   Alt-Svc: h2="alt.example.com:8000", h2=":443"

   When multiple values are present, the order of the values reflects
   the server's preference (with the first value being the most
   preferred alternative).

   The value(s) advertised by Alt-Svc can be used by clients to open a
   new connection to an alternative service.  Subsequent requests can
   start using this new connection immediately or can continue using the
   existing connection while the new connection is created.

   When using HTTP/2 ([<a href="rfc7540.html" title='"Hypertext Transfer Protocol version 2"'>RFC7540</a>]), servers SHOULD instead send an ALTSVC
   frame (<a href="#section-4">Section 4</a>).  A single ALTSVC frame can be sent for a
   connection; a new frame is not needed for every request.  Note that,
   despite this recommendation, Alt-Svc header fields remain valid in
   responses delivered over HTTP/2.





<span class="grey">Nottingham, et al.           Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   Each "alt-value" is followed by an OPTIONAL semicolon-separated list
   of additional parameters, each such "parameter" comprising a name and
   a value.

   This specification defines two parameters: "ma" and "persist",
   defined in <a href="#section-3.1">Section 3.1</a>.  Unknown parameters MUST be ignored.  That
   is, the values (alt-value) they appear in MUST be processed as if the
   unknown parameter was not present.

   New parameters can be defined in extension specifications (see
   <a href="#section-7.3">Section 7.3</a> for registration details).

   Note that all field elements that allow "quoted-string" syntax MUST
   be processed as per <a href="rfc7230.html#section-3.2.6">Section 3.2.6 of [RFC7230]</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Caching%20Alt-Svc%20Header%20Field%20Values"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Caching Alt-Svc Header Field Values</span>

   When an alternative service is advertised using Alt-Svc, it is
   considered fresh for 24 hours from generation of the message.  This
   can be modified with the "ma" (max-age) parameter.

   Syntax:

   ma = delta-seconds; see <a href="rfc7234.html#section-1.2.1">[RFC7234], Section 1.2.1</a>

   The delta-seconds value indicates the number of seconds since the
   response was generated for which the alternative service is
   considered fresh.

   Alt-Svc: h2=":443"; ma=3600

   See <a href="rfc7234.html#section-4.2.3">Section 4.2.3 of [RFC7234]</a> for details on determining the
   response age.

   For example, a response:

     HTTP/1.1 200 OK
     Content-Type: text/html
     Cache-Control: max-age=600
     Age: 30
     Alt-Svc: h2=":8000"; ma=60

   indicates that an alternative service is available and usable for the
   next 60 seconds.  However, the response has already been cached for
   30 seconds (as per the Age header field value); therefore, the
   alternative service is only fresh for the 30 seconds from when this
   response was received, minus estimated transit time.




<span class="grey">Nottingham, et al.           Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   Note that the freshness lifetime for HTTP caching (here, 600 seconds)
   does not affect caching of Alt-Svc values.

   When an Alt-Svc response header field is received from an origin, its
   value invalidates and replaces all cached alternative services for
   that origin.

   By default, cached alternative services will be cleared when the
   client detects a network change.  Alternative services that are
   intended to be longer lived (such as those that are not specific to
   the client access network) can carry the "persist" parameter with a
   value "1" as a hint that the service is potentially useful beyond a
   network configuration change.

   Syntax:

   persist = "1"

   For example:

   Alt-Svc: h2=":443"; ma=2592000; persist=1

   This specification only defines a single value for "persist".
   Clients MUST ignore "persist" parameters with values other than "1".

   See <a href="#section-2.2">Section 2.2</a> for general requirements on caching alternative
   services.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20The%20ALTSVC%20HTTP%2F2%20Frame"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  The ALTSVC HTTP/2 Frame</span>

   The ALTSVC HTTP/2 frame (<a href="rfc7540.html#section-4">[RFC7540], Section 4</a>) advertises the
   availability of an alternative service to an HTTP/2 client.

   The ALTSVC frame is a non-critical extension to HTTP/2.  Endpoints
   that do not support this frame will ignore it (as per the
   extensibility rules defined in <a href="rfc7540.html#section-4.1">Section 4.1 of [RFC7540]</a>).

   An ALTSVC frame from a server to a client on a stream other than
   stream 0 indicates that the conveyed alternative service is
   associated with the origin of that stream.

   An ALTSVC frame from a server to a client on stream 0 indicates that
   the conveyed alternative service is associated with the origin
   contained in the Origin field of the frame.  An association with an
   origin that the client does not consider authoritative for the
   current connection MUST be ignored.

   The ALTSVC frame type is 0xa (decimal 10).



<span class="grey">Nottingham, et al.           Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


    +-------------------------------+-------------------------------+
    |         Origin-Len (16)       | Origin? (*)                 ...
    +-------------------------------+-------------------------------+
    |                   Alt-Svc-Field-Value (*)                   ...
    +---------------------------------------------------------------+

                           ALTSVC Frame Payload

   The ALTSVC frame contains the following fields:

   Origin-Len:  An unsigned, 16-bit integer indicating the length, in
      octets, of the Origin field.

   Origin:  An OPTIONAL sequence of characters containing the ASCII
      serialization of an origin (<a href="rfc6454.html#section-6.2">[RFC6454], Section 6.2</a>) to which the
      alternative service is applicable.

   Alt-Svc-Field-Value:  A sequence of octets (length determined by
      subtracting the length of all preceding fields from the frame
      length) containing a value identical to the Alt-Svc field value
      defined in <a href="#section-3">Section 3</a> (ABNF production "Alt-Svc").

   The ALTSVC frame does not define any flags.

   The ALTSVC frame is intended for receipt by clients.  A device acting
   as a server MUST ignore it.

   An ALTSVC frame on stream 0 with empty (length 0) "Origin"
   information is invalid and MUST be ignored.  An ALTSVC frame on a
   stream other than stream 0 containing non-empty "Origin" information
   is invalid and MUST be ignored.

   The ALTSVC frame is processed hop-by-hop.  An intermediary MUST NOT
   forward ALTSVC frames, though it can use the information contained in
   ALTSVC frames in forming new ALTSVC frames to send to its own
   clients.

   Receiving an ALTSVC frame is semantically equivalent to receiving an
   Alt-Svc header field.  As a result, the ALTSVC frame causes
   alternative services for the corresponding origin to be replaced.
   Note that it would be unwise to mix the use of Alt-Svc header fields
   with the use of ALTSVC frames, as the sequence of receipt might be
   hard to predict.








<span class="grey">Nottingham, et al.           Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20The%20Alt-Used%20HTTP%20Header%20Field"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  The Alt-Used HTTP Header Field</span>

   The Alt-Used header field is used in requests to identify the
   alternative service in use, just as the Host header field
   (<a href="rfc7230.html#section-5.4">Section 5.4 of [RFC7230]</a>) identifies the host and port of the
   origin.

   Alt-Used     = uri-host [ ":" port ]

   Alt-Used is intended to allow alternative services to detect loops,
   differentiate traffic for purposes of load balancing, and generally
   to ensure that it is possible to identify the intended destination of
   traffic, since introducing this information after a protocol is in
   use has proven to be problematic.

   When using an alternative service, clients SHOULD include an Alt-Used
   header field in all requests.

   For example:

     GET /thing HTTP/1.1
     Host: origin.example.com
     Alt-Used: alternate.example.net

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20The%20421%20%28Misdirected%20Request%29%20HTTP%20Status%20Code"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  The 421 (Misdirected Request) HTTP Status Code</span>

   The 421 (Misdirected Request) status code is defined in <a href="rfc7540.html#section-9.1.2">Section 9.1.2
   of [RFC7540]</a> to indicate that the current server instance is not
   authoritative for the requested resource.  This can be used to
   indicate that an alternative service is not authoritative; see
   <a href="#section-2">Section 2</a>).

   Clients receiving 421 (Misdirected Request) from an alternative
   service MUST remove the corresponding entry from its alternative
   service cache (see <a href="#section-2.2">Section 2.2</a>) for that origin.  Regardless of the
   idempotency of the request method, they MAY retry the request, either
   at another alternative server, or at the origin.

   An Alt-Svc header field in a 421 (Misdirected Request) response MUST
   be ignored.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Header%20Field%20Registrations"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Header Field Registrations</span>

   HTTP header fields are registered within the "Message Headers"
   registry maintained at &lt;<a href="https://www.iana.org/assignments/message-headers/">https://www.iana.org/assignments/message-</a>
   <a href="https://www.iana.org/assignments/message-headers/">headers/</a>&gt;.



<span class="grey">Nottingham, et al.           Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   This document defines the following HTTP header fields, so their
   associated registry entries have been added according to the
   permanent registrations below (see [<a href="#ref-BCP90" title='"Registration Procedures for Message Header Fields"'>BCP90</a>]):

   +-------------------+----------+----------+------------+
   | Header Field Name | Protocol | Status   | Reference  |
   +-------------------+----------+----------+------------+
   | Alt-Svc           | http     | standard | <a href="#section-3">Section 3</a>  |
   | Alt-Used          | http     | standard | <a href="#section-5">Section 5</a>  |
   +-------------------+----------+----------+------------+

   The change controller is: "IETF (iesg@ietf.org) -- Internet
   Engineering Task Force".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20The%20ALTSVC%20HTTP%2F2%20Frame%20Type"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  The ALTSVC HTTP/2 Frame Type</span>

   This document registers the ALTSVC frame type in the "HTTP/2 Frame
   Type" registry (<a href="rfc7540.html#section-11.2">[RFC7540], Section 11.2</a>).

      Frame Type: ALTSVC

      Code: 0xa

      Specification: <a href="#section-4">Section 4</a> of this document

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Alt-Svc%20Parameter%20Registry"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Alt-Svc Parameter Registry</span>

   The "Hypertext Transfer Protocol (HTTP) Alt-Svc Parameter Registry"
   defines the name space for parameters.  It has been created and will
   be maintained at &lt;<a href="http://www.iana.org/assignments/http-alt-svc-parameters">http://www.iana.org/assignments/http-alt-svc-</a>
   <a href="http://www.iana.org/assignments/http-alt-svc-parameters">parameters</a>&gt;.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.1.%20%20Procedure"></a><a class="selflink" href="#section-7.3.1" name="section-7.3.1">7.3.1</a>.  Procedure</span>

   A registration MUST include the following fields:

   o  Parameter Name

   o  Pointer to specification text

   Values to be added to this name space require Expert Review (see
   <a href="rfc5226.html#section-4.1">[RFC5226], Section 4.1</a>).









<span class="grey">Nottingham, et al.           Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.2.%20%20Registrations"></a><a class="selflink" href="#section-7.3.2" name="section-7.3.2">7.3.2</a>.  Registrations</span>

   The "Hypertext Transfer Protocol (HTTP) Alt-Svc Parameter Registry"
   has been populated with the registrations below:

   +-------------------+--------------+
   | Alt-Svc Parameter | Reference    |
   +-------------------+--------------+
   | ma                | <a href="#section-3.1">Section 3.1</a>  |
   | persist           | <a href="#section-3.1">Section 3.1</a>  |
   +-------------------+--------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Internationalization%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Internationalization Considerations</span>

   An internationalized domain name that appears in either the header
   field (<a href="#section-3">Section 3</a>) or the HTTP/2 frame (<a href="#section-4">Section 4</a>) MUST be expressed
   using A-labels (<a href="rfc5890.html#section-2.3.2.1">[RFC5890], Section 2.3.2.1</a>).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Changing%20Ports"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Changing Ports</span>

   Using an alternative service implies accessing an origin's resources
   on an alternative port, at a minimum.  Therefore, an attacker that
   can inject alternative services and listen at the advertised port is
   able to hijack an origin.  On certain servers, it is normal for users
   to be able to control some personal pages available on a shared port
   and also to accept requests on less-privileged ports.

   For example, an attacker that can add HTTP response header fields to
   some pages can redirect traffic for an entire origin to a different
   port on the same host using the Alt-Svc header field; if that port is
   under the attacker's control, they can thus masquerade as the HTTP
   server.

   This risk is mitigated by the requirements in <a href="#section-2.1">Section 2.1</a>.

   On servers, this risk can also be reduced by restricting the ability
   to advertise alternative services, and restricting who can open a
   port for listening on that host.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Changing%20Hosts"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Changing Hosts</span>

   When the host is changed due to the use of an alternative service,
   this presents an opportunity for attackers to hijack communication to
   an origin.





<span class="grey">Nottingham, et al.           Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   For example, if an attacker can convince a user agent to send all
   traffic for "innocent.example.org" to "evil.example.com" by
   successfully associating it as an alternative service, they can
   masquerade as that origin.  This can be done locally (see mitigations
   in <a href="#section-9.1">Section 9.1</a>) or remotely (e.g., by an intermediary as a man-in-
   the-middle attack).

   This is the reason for the requirement in <a href="#section-2.1">Section 2.1</a> that clients
   have reasonable assurances that the alternative service is under
   control of and valid for the whole origin; for example, presenting a
   certificate for the origin proves that the alternative service is
   authorized to serve traffic for the origin.

   Note that this assurance is only as strong as the method used to
   authenticate the alternative service.  In particular, when TLS
   authentication is used to do so, there are well-known exploits to
   make an attacker's certificate appear as legitimate.

   Alternative services could be used to persist such an attack.  For
   example, an intermediary could man-in-the-middle TLS-protected
   communication to a target and then direct all traffic to an
   alternative service with a large freshness lifetime so that the user
   agent still directs traffic to the attacker even when not using the
   intermediary.

   Implementations MUST perform any certificate-pinning validation (such
   as [<a href="rfc7469.html" title='"Public Key Pinning Extension for HTTP"'>RFC7469</a>]) on alternative services just as they would on direct
   connections to the origin.  Implementations might also choose to add
   other requirements around which certificates are acceptable for
   alternative services.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Changing%20Protocols"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Changing Protocols</span>

   When the ALPN protocol is changed due to the use of an alternative
   service, the security properties of the new connection to the origin
   can be different from that of the "normal" connection to the origin,
   because the protocol identifier itself implies this.

   For example, if an "https://" URI has a protocol advertised that does
   not use some form of end-to-end encryption (most likely, TLS), this
   violates the expectations for security that the URI scheme implies.
   Therefore, clients cannot use alternative services blindly, but
   instead evaluate the option(s) presented to ensure that security
   requirements and expectations of specifications, implementations, and
   end users are met.






<span class="grey">Nottingham, et al.           Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Tracking%20Clients%20Using%20Alternative%20Services"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Tracking Clients Using Alternative Services</span>

   Choosing an alternative service implies connecting to a new, server-
   supplied host name.  By using unique names, servers could conceivably
   track client requests.  Such tracking could follow users across
   multiple networks, when the "persist" flag is used.

   Clients that wish to prevent requests from being correlated can
   decide not to use alternative services for multiple requests that
   would not otherwise be allowed to be correlated.

   In a user agent, any alternative service information MUST be removed
   when origin-specific data is cleared (typically, when cookies
   [<a href="rfc6265.html" title='"HTTP State Management Mechanism"'>RFC6265</a>] are cleared).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.5.%20%20Confusion%20regarding%20Request%20Scheme"></a><a class="selflink" href="#section-9.5" name="section-9.5">9.5</a>.  Confusion regarding Request Scheme</span>

   Some server-side HTTP applications make assumptions about security
   based upon connection context; for example, equating being served
   upon port 443 with the use of an "https://" URI and the various
   security properties that implies.

   This affects not only the security properties of the connection
   itself, but also the state of the client at the other end of it; for
   example, a Web browser treats "https://" URIs differently than
   "http://" URIs in many ways, not just for purposes of protocol
   handling.

   Since one of the uses of Alternative Services is to allow a
   connection to be migrated to a different protocol and port, these
   applications can become confused about the security properties of a
   given connection, sending information (for example, cookies and
   content) that is intended for a secure context (such as an "https://"
   URI) to a client that is not treating it as one.

   This risk can be mitigated in servers by using the URI scheme
   explicitly carried by the protocol (such as ":scheme" in HTTP/2 or
   the "absolute form" of the request target in HTTP/1.1) as an
   indication of security context, instead of other connection
   properties (<a href="rfc7540.html#section-8.1.2.3">[RFC7540], Section 8.1.2.3</a> and <a href="rfc7230.html#section-5.3.2">[RFC7230], Section 5.3.2</a>).

   When the protocol does not explicitly carry the scheme (as is usually
   the case for HTTP/1.1 over TLS), servers can mitigate this risk by
   either assuming that all requests have an insecure context, or by
   refraining from advertising alternative services for insecure schemes
   (for example, HTTP).





<span class="grey">Nottingham, et al.           Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC2818" name="ref-RFC2818">RFC2818</a>]  Rescorla, E., "HTTP Over TLS", <a href="rfc2818.html">RFC 2818</a>,
              DOI 10.17487/RFC2818, May 2000,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2818">http://www.rfc-editor.org/info/rfc2818</a>&gt;.

   [<a id="ref-RFC3986" name="ref-RFC3986">RFC3986</a>]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              <a href="rfc3986.html">RFC 3986</a>, DOI 10.17487/RFC3986, January 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3986">http://www.rfc-editor.org/info/rfc3986</a>&gt;.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              DOI 10.17487/RFC5226, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5226">http://www.rfc-editor.org/info/rfc5226</a>&gt;.

   [<a id="ref-RFC5234" name="ref-RFC5234">RFC5234</a>]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>,
              DOI 10.17487/RFC5234, January 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5234">http://www.rfc-editor.org/info/rfc5234</a>&gt;.

   [<a id="ref-RFC5890" name="ref-RFC5890">RFC5890</a>]  Klensin, J., "Internationalized Domain Names for
              Applications (IDNA): Definitions and Document Framework",
              <a href="rfc5890.html">RFC 5890</a>, DOI 10.17487/RFC5890, August 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5890">http://www.rfc-editor.org/info/rfc5890</a>&gt;.

   [<a id="ref-RFC6066" name="ref-RFC6066">RFC6066</a>]  Eastlake, D., "Transport Layer Security (TLS) Extensions:
              Extension Definitions", <a href="rfc6066.html">RFC 6066</a>, DOI 10.17487/RFC6066,
              January 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6066">http://www.rfc-editor.org/info/rfc6066</a>&gt;.

   [<a id="ref-RFC6454" name="ref-RFC6454">RFC6454</a>]  Barth, A., "The Web Origin Concept", <a href="rfc6454.html">RFC 6454</a>,
              DOI 10.17487/RFC6454, December 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6454">http://www.rfc-editor.org/info/rfc6454</a>&gt;.

   [<a id="ref-RFC7230" name="ref-RFC7230">RFC7230</a>]  Fielding, R., Ed. and J. Reschke, Ed., "Hypertext Transfer
              Protocol (HTTP/1.1): Message Syntax and Routing",
              <a href="rfc7230.html">RFC 7230</a>, DOI 10.17487/RFC7230, June 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7230">http://www.rfc-editor.org/info/rfc7230</a>&gt;.






<span class="grey">Nottingham, et al.           Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


   [<a id="ref-RFC7234" name="ref-RFC7234">RFC7234</a>]  Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke,
              Ed., "Hypertext Transfer Protocol (HTTP/1.1): Caching",
              <a href="rfc7234.html">RFC 7234</a>, DOI 10.17487/RFC7234, June 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7234">http://www.rfc-editor.org/info/rfc7234</a>&gt;.

   [<a id="ref-RFC7301" name="ref-RFC7301">RFC7301</a>]  Friedl, S., Popov, A., Langley, A., and S. Emile,
              "Transport Layer Security (TLS) Application-Layer Protocol
              Negotiation Extension", <a href="rfc7301.html">RFC 7301</a>, DOI 10.17487/RFC7301,
              July 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7301">http://www.rfc-editor.org/info/rfc7301</a>&gt;.

   [<a id="ref-RFC7405" name="ref-RFC7405">RFC7405</a>]  Kyzivat, P., "Case-Sensitive String Support in ABNF",
              <a href="rfc7405.html">RFC 7405</a>, DOI 10.17487/RFC7405, December 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7405">http://www.rfc-editor.org/info/rfc7405</a>&gt;.

   [<a id="ref-RFC7540" name="ref-RFC7540">RFC7540</a>]  Belshe, M., Peon, R., and M. Thomson, Ed., "Hypertext
              Transfer Protocol version 2", <a href="rfc7540.html">RFC 7540</a>,
              DOI 10.17487/RFC7540, May 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7540">http://www.rfc-editor.org/info/rfc7540</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-BCP90" name="ref-BCP90">BCP90</a>]    Klyne, G., Nottingham, M., and J. Mogul, "Registration
              Procedures for Message Header Fields", <a href="https://tools.ietf.org/html/bcp90">BCP 90</a>, <a href="rfc3864.html">RFC 3864</a>,
              September 2004, &lt;<a href="http://www.rfc-editor.org/info/bcp90">http://www.rfc-editor.org/info/bcp90</a>&gt;.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>,
              DOI 10.17487/RFC5246, August 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5246">http://www.rfc-editor.org/info/rfc5246</a>&gt;.

   [<a id="ref-RFC6265" name="ref-RFC6265">RFC6265</a>]  Barth, A., "HTTP State Management Mechanism", <a href="rfc6265.html">RFC 6265</a>,
              DOI 10.17487/RFC6265, April 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6265">http://www.rfc-editor.org/info/rfc6265</a>&gt;.

   [<a id="ref-RFC7469" name="ref-RFC7469">RFC7469</a>]  Evans, C., Palmer, C., and R. Sleevi, "Public Key Pinning
              Extension for HTTP", <a href="rfc7469.html">RFC 7469</a>, DOI 10.17487/RFC7469, April
              2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7469">http://www.rfc-editor.org/info/rfc7469</a>&gt;.

Acknowledgements

   Thanks to Adam Langley, Bence Beky, Chris Lonvick, Eliot Lear, Erik
   Nygren, Guy Podjarny, Herve Ruellan, Lucas Pardue, Martin Thomson,
   Matthew Kerwin, Mike Bishop, Paul Hoffman, Richard Barnes, Richard
   Bradbury, Stephen Farrell, Stephen Ludin, and Will Chan for their
   feedback and suggestions.

   The Alt-Svc header field was influenced by the design of the
   Alternate-Protocol header field in SPDY.



<span class="grey">Nottingham, et al.           Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7838.html">RFC 7838</a>                HTTP Alternative Services             April 2016</span>


Authors' Addresses

   Mark Nottingham
   Akamai

   Email: mnot@mnot.net
   URI:   <a href="https://www.mnot.net/">https://www.mnot.net/</a>


   Patrick McManus
   Mozilla

   Email: mcmanus@ducksong.com
   URI:   <a href="https://mozillians.org/u/pmcmanus/">https://mozillians.org/u/pmcmanus/</a>


   Julian F. Reschke
   greenbytes GmbH

   Email: julian.reschke@greenbytes.de
   URI:   <a href="https://greenbytes.de/tech/webdav/">https://greenbytes.de/tech/webdav/</a>






























Nottingham, et al.           Standards Track                   [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7838 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --></html>