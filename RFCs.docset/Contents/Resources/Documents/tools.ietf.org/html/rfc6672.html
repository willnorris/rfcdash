<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6672 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:27 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="rfc2672" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:6672" name="DC.Identifier"/>
<meta content="June, 2012" name="DC.Date.Issued"/>
<meta content="Wijngaards, Wouter" name="DC.Creator"/>
<meta content="Rose, Scott" name="DC.Creator"/>
<meta content="The DNAME record provides redirection for a subtree of the domain name
tree in the DNS. That is, all names that end with a particular suffix
are redirected to another part of the DNS. This document obsoletes the
original specification in RFC 2672 as well as updates the document on
representing IPv6 addresses in DNS (RFC 3363). [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="DNAME Redirection in the DNS" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6672 - DNAME Redirection in the DNS</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6672.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6672" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-dnsext-rfc2672bis-dname" title="draft-ietf-dnsext-rfc2672bis-dname">draft-ietf-dnse...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6672" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6672" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6672" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                           S. Rose
Request for Comments: 6672                                          NIST
Obsoletes: <a href="rfc2672.html">2672</a>                                            W. Wijngaards
Updates: <a href="rfc3363.html">3363</a>                                                 NLnet Labs
Category: Standards Track                                      June 2012
ISSN: 2070-1721


                      <span class="h1">DNAME Redirection in the DNS</span>

Abstract

   The DNAME record provides redirection for a subtree of the domain
   name tree in the DNS.  That is, all names that end with a particular
   suffix are redirected to another part of the DNS.  This document
   obsoletes the original specification in <a href="rfc2672.html">RFC 2672</a> as well as updates
   the document on representing IPv6 addresses in DNS (<a href="rfc3363.html">RFC 3363</a>).

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6672">http://www.rfc-editor.org/info/rfc6672</a>.




















<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

























<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
     <a href="#section-1.1">1.1</a>.  Requirements Language  . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  The DNAME Resource Record  . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-2.1">2.1</a>.  Format . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-2.2">2.2</a>.  The DNAME Substitution . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-2.3">2.3</a>.  DNAME Owner Name Matching the QNAME  . . . . . . . . . . .  <a href="#page-6">6</a>
     <a href="#section-2.4">2.4</a>.  Names next to and below a DNAME Record . . . . . . . . . .  <a href="#page-7">7</a>
     <a href="#section-2.5">2.5</a>.  Compression of the DNAME Record  . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3">3</a>.  Processing . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-3.1">3.1</a>.  CNAME Synthesis  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-3.2">3.2</a>.  Server Algorithm . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
     <a href="#section-3.3">3.3</a>.  Wildcards  . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-3.4">3.4</a>.  Acceptance and Intermediate Storage  . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#section-3.4.1">3.4.1</a>.  Resolver Algorithm . . . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-4">4</a>.  DNAME Discussions in Other Documents . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-5">5</a>.  Other Issues with DNAME  . . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-5.1">5.1</a>.  Canonical Hostnames Cannot Be below DNAME Owners . . . . . <a href="#page-13">13</a>
     <a href="#section-5.2">5.2</a>.  Dynamic Update and DNAME . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-5.3">5.3</a>.  DNSSEC and DNAME . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-5.3.1">5.3.1</a>.  Signed DNAME, Unsigned Synthesized CNAME . . . . . . . <a href="#page-14">14</a>
       <a href="#section-5.3.2">5.3.2</a>.  DNAME Bit in NSEC Type Map . . . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-5.3.3">5.3.3</a>.  DNAME Chains as Strong as the Weakest Link . . . . . . <a href="#page-14">14</a>
       <a href="#section-5.3.4">5.3.4</a>.  Validators Must Understand DNAME . . . . . . . . . . . <a href="#page-14">14</a>
         5.3.4.1.  Invalid Name Error Response Caused by DNAME in
                   Bitmap . . . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
         5.3.4.2.  Valid Name Error Response Involving DNAME in
                   Bitmap . . . . . . . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
         <a href="#section-5.3.4.3">5.3.4.3</a>.  Response with Synthesized CNAME  . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-6">6</a>.  Examples of DNAME Use in a Zone  . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-6.1">6.1</a>.  Organizational Renaming  . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-6.2">6.2</a>.  Classless Delegation of Shorter Prefixes . . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-6.3">6.3</a>.  Network Renumbering Support  . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-7">7</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
   <a href="#section-8">8</a>.  Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
   <a href="#section-9">9</a>.  Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
   <a href="#section-10">10</a>. References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-10.1">10.1</a>. Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-10.2">10.2</a>. Informative References . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
   <a href="#appendix-A">Appendix A</a>.  Changes from <a href="rfc2672.html">RFC 2672</a> . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
     <a href="#appendix-A.1">A.1</a>.  Changes to Server Behavior . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
     <a href="#appendix-A.2">A.2</a>.  Changes to Client Behavior . . . . . . . . . . . . . . . . <a href="#page-21">21</a>








<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   DNAME is a DNS resource record type originally defined in <a href="rfc2672.html">RFC 2672</a>
   [<a href="rfc2672.html" title='"Non-Terminal DNS Name Redirection"'>RFC2672</a>].  DNAME provides redirection from a part of the DNS name
   tree to another part of the DNS name tree.

   The DNAME RR and the CNAME RR [<a href="rfc1034.html" title='"Domain names - concepts and facilities"'>RFC1034</a>] cause a lookup to
   (potentially) return data corresponding to a domain name different
   from the queried domain name.  The difference between the two
   resource records is that the CNAME RR directs the lookup of data at
   its owner to another single name, whereas a DNAME RR directs lookups
   for data at descendants of its owner's name to corresponding names
   under a different (single) node of the tree.

   For example, take looking through a zone (see <a href="rfc1034.html">RFC 1034</a> <a href="rfc1034.html#section-4.3.2">[RFC1034],
   Section 4.3.2</a>, step 3) for the domain name "foo.example.com", and a
   DNAME resource record is found at "example.com" indicating that all
   queries under "example.com" be directed to "example.net".  The lookup
   process will return to step 1 with the new query name of
   "foo.example.net".  Had the query name been "www.foo.example.com",
   the new query name would be "www.foo.example.net".

   This document is a revision of the original specification of DNAME in
   <a href="rfc2672.html">RFC 2672</a> [<a href="rfc2672.html" title='"Non-Terminal DNS Name Redirection"'>RFC2672</a>].  DNAME was conceived to help with the problem of
   maintaining address-to-name mappings in a context of network
   renumbering.  With a careful setup, a renumbering event in the
   network causes no change to the authoritative server that has the
   address-to-name mappings.  Examples in practice are classless reverse
   address space delegations.

   Another usage of DNAME lies in aliasing of name spaces.  For example,
   a zone administrator may want subtrees of the DNS to contain the same
   information.  Examples include punycode [<a href="rfc3492.html" title='"Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)"'>RFC3492</a>] alternates for
   domain spaces.

   This revision of the DNAME specification does not change the wire
   format or the handling of DNAME resource records.  Discussion is
   added on problems that may be encountered when using DNAME.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED" "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in <a href="rfc2119.html">RFC</a>
   <a href="rfc2119.html">2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].






<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20The%20DNAME%20Resource%20Record"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  The DNAME Resource Record</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Format"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Format</span>

   The DNAME RR has mnemonic DNAME and type code 39 (decimal).  It is
   CLASS-insensitive.

   Its RDATA is comprised of a single field, &lt;target&gt;, which contains a
   fully qualified domain name that MUST be sent in uncompressed form
   [<a href="rfc1035.html" title='"Domain names - implementation and specification"'>RFC1035</a>] [<a href="rfc3597.html" title='"Handling of Unknown DNS Resource Record (RR) Types"'>RFC3597</a>].  The &lt;target&gt; field MUST be present.  The
   presentation format of &lt;target&gt; is that of a domain name [<a href="rfc1035.html" title='"Domain names - implementation and specification"'>RFC1035</a>].
   The presentation format of the RR is as follows:

           &lt;owner&gt; &lt;ttl&gt; &lt;class&gt; DNAME &lt;target&gt;

   The effect of the DNAME RR is the substitution of the record's
   &lt;target&gt; for its owner name, as a suffix of a domain name.  This
   substitution is to be applied for all names below the owner name of
   the DNAME RR.  This substitution has to be applied for every DNAME RR
   found in the resolution process, which allows fairly lengthy valid
   chains of DNAME RRs.

   Details of the substitution process, methods to avoid conflicting
   resource records, and rules for specific corner cases are given in
   the following subsections.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20The%20DNAME%20Substitution"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  The DNAME Substitution</span>

   When following step 3 of the algorithm in <a href="rfc1034.html">RFC 1034</a> [<a href="rfc1034.html" title='"Domain names - concepts and facilities"'>RFC1034</a>], <a href="#section-4.3.2">Section</a>
   <a href="#section-4.3.2">4.3.2</a>, "start matching down, label by label, in the zone" and a node
   is found to own a DNAME resource record, a DNAME substitution occurs.
   The name being sought may be the original query name or a name that
   is the result of a CNAME resource record being followed or a
   previously encountered DNAME.  As in the case when finding a CNAME
   resource record or NS resource record set, the processing of a DNAME
   will happen prior to finding the desired domain name.

   A DNAME substitution is performed by replacing the suffix labels of
   the name being sought matching the owner name of the DNAME resource
   record with the string of labels in the RDATA field.  The matching
   labels end with the root label in all cases.  Only whole labels are
   replaced.  See the table of examples for common cases and corner
   cases.

   In the table below, the QNAME refers to the query name.  The owner is
   the DNAME owner domain name, and the target refers to the target of
   the DNAME record.  The result is the resulting name after performing
   the DNAME substitution on the query name. "no match" means that the



<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   query did not match the DNAME, and thus no substitution is performed
   and a possible error message is returned (if no other result is
   possible).  Thus, every line contains one example substitution.  In
   the examples below, 'cyc' and 'shortloop' contain loops.

    QNAME            owner  DNAME   target         result
    ---------------- -------------- -------------- -----------------
    com.             example.com.   example.net.   &lt;no match&gt;
    example.com.     example.com.   example.net.   [<a href="#ref-0" title='"example.com."'>0</a>]
    a.example.com.   example.com.   example.net.   a.example.net.
    a.b.example.com. example.com.   example.net.   a.b.example.net.
    ab.example.com.  b.example.com. example.net.   &lt;no match&gt;
    foo.example.com. example.com.   example.net.   foo.example.net.
    a.x.example.com. x.example.com. example.net.   a.example.net.
    a.example.com.   example.com.   y.example.net. a.y.example.net.
    cyc.example.com. example.com.   example.com.   cyc.example.com.
    cyc.example.com. example.com.   c.example.com. cyc.c.example.com.
    shortloop.x.x.   x.             .              shortloop.x.
    shortloop.x.     x.             .              shortloop.

   [<a id="ref-0" name="ref-0">0</a>] The result depends on the QTYPE.  If the QTYPE = DNAME, then
       the result is "example.com.", else "&lt;no match&gt;".

                   Table 1. DNAME Substitution Examples

   It is possible for DNAMEs to form loops, just as CNAMEs can form
   loops.  DNAMEs and CNAMEs can chain together to form loops.  A single
   corner case DNAME can form a loop.  Resolvers and servers should be
   cautious in devoting resources to a query, but be aware that fairly
   long chains of DNAMEs may be valid.  Zone content administrators
   should take care to ensure that there are no loops that could occur
   when using DNAME or DNAME/CNAME redirection.

   The domain name can get too long during substitution.  For example,
   suppose the target name of the DNAME RR is 250 octets in length
   (multiple labels), if an incoming QNAME that has a first label over 5
   octets in length, the result would be a name over 255 octets.  If
   this occurs, the server returns an RCODE of YXDOMAIN [<a href="rfc2136.html" title='"Dynamic Updates in the Domain Name System (DNS UPDATE)"'>RFC2136</a>].  The
   DNAME record and its signature (if the zone is signed) are included
   in the answer as proof for the YXDOMAIN (value 6) RCODE.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20DNAME%20Owner%20Name%20Matching%20the%20QNAME"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  DNAME Owner Name Matching the QNAME</span>

   Unlike a CNAME RR, a DNAME RR redirects DNS names subordinate to its
   owner name; the owner name of a DNAME is not redirected itself.  The
   domain name that owns a DNAME record is allowed to have other
   resource record types at that domain name, except DNAMEs, CNAMEs, or
   other types that have restrictions on what they can coexist with.



<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   When there is a match of the QTYPE to a type (or types) also owned by
   the owner name, the response is sourced from the owner name.  For
   example, a QTYPE of ANY would return the (available) types at the
   owner name, not the target name.

   DNAME RRs MUST NOT appear at the same owner name as an NS RR unless
   the owner name is the zone apex; if it is not the zone apex, then the
   NS RR signifies a delegation point, and the DNAME RR must in that
   case appear below the zone cut at the zone apex of the child zone.

   If a DNAME record is present at the zone apex, there is still a need
   to have the customary SOA and NS resource records there as well.
   Such a DNAME cannot be used to mirror a zone completely, as it does
   not mirror the zone apex.

   These rules also allow DNAME records to be queried through caches
   that are <a href="rfc1034.html">RFC 1034</a> [<a href="rfc1034.html" title='"Domain names - concepts and facilities"'>RFC1034</a>] compliant and are DNAME unaware.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Names%20next%20to%20and%20below%20a%20DNAME%20Record"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Names next to and below a DNAME Record</span>

   Resource records MUST NOT exist at any subdomain of the owner of a
   DNAME RR.  To get the contents for names subordinate to that owner
   name, the DNAME redirection must be invoked and the resulting target
   queried.  A server MAY refuse to load a zone that has data at a
   subdomain of a domain name owning a DNAME RR.  If the server does
   load the zone, those names below the DNAME RR will be occluded as
   described in <a href="rfc2136.html">RFC 2136</a> <a href="rfc2136.html#section-7.18">[RFC2136], Section 7.18</a>.  Also, a server ought
   to refuse to load a zone subordinate to the owner of a DNAME record
   in the ancestor zone.  See <a href="#section-5.2">Section 5.2</a> for further discussion related
   to dynamic update.

   DNAME is a singleton type, meaning only one DNAME is allowed per
   name.  The owner name of a DNAME can only have one DNAME RR, and no
   CNAME RRs can exist at that name.  These rules make sure that for a
   single domain name, only one redirection exists; thus, there's no
   confusion about which one to follow.  A server ought to refuse to
   load a zone that violates these rules.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5.%20%20Compression%20of%20the%20DNAME%20Record"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a>.  Compression of the DNAME Record</span>

   The DNAME owner name can be compressed like any other owner name.
   The DNAME RDATA target name MUST NOT be sent out in compressed form
   and MUST be downcased for DNS Security Extensions (DNSSEC)
   validation.







<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   Although the previous DNAME specification [<a href="rfc2672.html" title='"Non-Terminal DNS Name Redirection"'>RFC2672</a>] (that is
   obsoleted by this specification) talked about signaling to allow
   compression of the target name, such signaling has never been
   specified, nor is it specified in this document.

   <a href="rfc2672.html">RFC 2672</a> (obsoleted by this document) states that the Extended DNS
   (EDNS) version has a means for understanding DNAME and DNAME target
   name compression.  This document revises <a href="rfc2672.html">RFC 2672</a>, in that there is
   no EDNS version signaling for DNAME.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Processing"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Processing</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20CNAME%20Synthesis"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  CNAME Synthesis</span>

   When preparing a response, a server performing a DNAME substitution
   will, in all cases, include the relevant DNAME RR in the answer
   section.  Relevant cases includes the following:

   1.  The DNAME is being employed as a substitution instruction.

   2.  The DNAME itself matches the QTYPE, and the owner name matches
       QNAME.

   When the owner name matches the QNAME and the QTYPE matches another
   type owned there, the DNAME is not included in the answer.

   A CNAME RR with Time to Live (TTL) equal to the corresponding DNAME
   RR is synthesized and included in the answer section when the DNAME
   is employed as a substitution instruction.  The owner name of the
   CNAME is the QNAME of the query.  The DNSSEC specification ([<a href="rfc4033.html" title='"DNS Security Introduction and Requirements"'>RFC4033</a>]
   [<a href="rfc4034.html" title='"Resource Records for the DNS Security Extensions"'>RFC4034</a>] [<a href="rfc4035.html" title='"Protocol Modifications for the DNS Security Extensions"'>RFC4035</a>]) says that the synthesized CNAME does not have to
   be signed.  The signed DNAME has an RRSIG, and a validating resolver
   can check the CNAME against the DNAME record and validate the
   signature over the DNAME RR.

   Servers MUST be able to answer a query for a synthesized CNAME.  Like
   other query types, this invokes the DNAME, and then the server
   synthesizes the CNAME and places it into the answer section.  If the
   server in question is a cache, the synthesized CNAME's TTL SHOULD be
   equal to the decremented TTL of the cached DNAME.

   Resolvers MUST be able to handle a synthesized CNAME TTL of zero or a
   value equal to the TTL of the corresponding DNAME record (as some
   older, authoritative server implementations set the TTL of
   synthesized CNAMEs to zero).  A TTL of zero means that the CNAME can
   be discarded immediately after processing the answer.





<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Server%20Algorithm"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Server Algorithm</span>

   Below is the revised version of the server algorithm, which appears
   in <a href="rfc2672.html#section-4.1">RFC 2672, Section 4.1</a>.

   1.  Set or clear the value of recursion available in the response
       depending on whether the name server is willing to provide
       recursive service.  If recursive service is available and
       requested via the RD bit in the query, go to step 5; otherwise,
       step 2.

   2.  Search the available zones for the zone which is the nearest
       ancestor to QNAME.  If such a zone is found, go to step 3;
       otherwise, step 4.

   3.  Start matching down, label by label, in the zone.  The matching
       process can terminate several ways:

       A.  If the whole of QNAME is matched, we have found the node.

           If the data at the node is a CNAME, and QTYPE does not match
           CNAME, copy the CNAME RR into the answer section of the
           response, change QNAME to the canonical name in the CNAME RR,
           and go back to step 1.

           Otherwise, copy all RRs which match QTYPE into the answer
           section and go to step 6.

       B.  If a match would take us out of the authoritative data, we
           have a referral.  This happens when we encounter a node with
           NS RRs marking cuts along the bottom of a zone.

           Copy the NS RRs for the sub-zone into the authority section
           of the reply.  Put whatever addresses are available into the
           additional section, using glue RRs if the addresses are not
           available from authoritative data or the cache.  Go to step
           4.

       C.  If at some label, a match is impossible (i.e., the
           corresponding label does not exist), look to see whether the
           last label matched has a DNAME record.

           If a DNAME record exists at that point, copy that record into
           the answer section.  If substitution of its &lt;target&gt; for its
           &lt;owner&gt; in QNAME would overflow the legal size for a &lt;domain-
           name&gt;, set RCODE to YXDOMAIN [<a href="rfc2136.html" title='"Dynamic Updates in the Domain Name System (DNS UPDATE)"'>RFC2136</a>] and exit; otherwise,
           perform the substitution and continue.  The server MUST




<span class="grey">Rose &amp; Wijngaards            Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


           synthesize a CNAME record as described above and include it
           in the answer section.  Go back to step 1.

           If there was no DNAME record, look to see if the "*" label
           exists.

           If the "*" label does not exist, check whether the name we
           are looking for is the original QNAME in the query or a name
           we have followed due to a CNAME or DNAME.  If the name is
           original, set an authoritative name error in the response and
           exit.  Otherwise, just exit.

           If the "*" label does exist, match RRs at that node against
           QTYPE.  If any match, copy them into the answer section, but
           set the owner of the RR to be QNAME, and not the node with
           the "*" label.  If the data at the node with the "*" label is
           a CNAME, and QTYPE doesn't match CNAME, copy the CNAME RR
           into the answer section of the response changing the owner
           name to the QNAME, change QNAME to the canonical name in the
           CNAME RR, and go back to step 1.  Otherwise, go to step 6.

   4.  Start matching down in the cache.  If QNAME is found in the
       cache, copy all RRs attached to it that match QTYPE into the
       answer section.  If QNAME is not found in the cache but a DNAME
       record is present at an ancestor of QNAME, copy that DNAME record
       into the answer section.  If there was no delegation from
       authoritative data, look for the best one from the cache, and put
       it in the authority section.  Go to step 6.

   5.  Use the local resolver or a copy of its algorithm to answer the
       query.  Store the results, including any intermediate CNAMEs and
       DNAMEs, in the answer section of the response.

   6.  Using local data only, attempt to add other RRs that may be
       useful to the additional section of the query.  Exit.

   Note that there will be at most one ancestor with a DNAME as
   described in step 4 unless some zone's data is in violation of the
   no-descendants limitation in <a href="#section-3">Section 3</a>.  An implementation might take
   advantage of this limitation by stopping the search of step 3c or
   step 4 when a DNAME record is encountered.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Wildcards"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Wildcards</span>

   The use of DNAME in conjunction with wildcards is discouraged
   [<a href="rfc4592.html" title='"The Role of Wildcards in the Domain Name System"'>RFC4592</a>].  Thus, records of the form "*.example.com DNAME
   example.net" SHOULD NOT be used.




<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   The interaction between the expansion of the wildcard and the
   redirection of the DNAME is non-deterministic.  Due to the fact that
   the processing is non-deterministic, DNSSEC validating resolvers may
   not be able to validate a wildcarded DNAME.

   A server MAY give a warning that the behavior is unspecified if such
   a wildcarded DNAME is loaded.  The server MAY refuse it, refuse to
   load the zone, or refuse dynamic updates.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Acceptance%20and%20Intermediate%20Storage"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Acceptance and Intermediate Storage</span>

   Recursive caching name servers can encounter data at names below the
   owner name of a DNAME RR, due to a change at the authoritative server
   where data from before and after the change resides in the cache.
   This conflict situation is a transitional phase that ends when the
   old data times out.  The caching name server can opt to store both
   old and new data and treat each as if the other did not exist, or
   drop the old data, or drop the longer domain name.  In any approach,
   consistency returns after the older data TTL times out.

   Recursive caching name servers MUST perform CNAME synthesis on behalf
   of clients.

   If a recursive caching name server encounters a DNSSEC validated
   DNAME RR that contradicts information already in the cache (excluding
   CNAME records), it SHOULD cache the DNAME RR, but it MAY cache the
   CNAME record received along with it, subject to the rules for CNAME.
   If the DNAME RR cannot be validated via DNSSEC (i.e., not BOGUS, but
   not able to validate), the recursive caching server SHOULD NOT cache
   the DNAME RR but MAY cache the CNAME record received along with it,
   subject to the rules for CNAME.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.1.%20%20Resolver%20Algorithm"></a><a class="selflink" href="#section-3.4.1" name="section-3.4.1">3.4.1</a>.  Resolver Algorithm</span>

   Below is the revised version of the resolver algorithm, which appears
   in <a href="rfc2672.html#section-4.2">RFC 2672, Section 4.2</a>.

   1.  See if the answer is in local information or can be synthesized
       from a cached DNAME; if so, return it to the client.

   2.  Find the best servers to ask.

   3.  Send queries until one returns a response.








<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   4.  Analyze the response, either:

       A.  If the response answers the question or contains a name
           error, cache the data as well as return it back to the
           client.

       B.  If the response contains a better delegation to other
           servers, cache the delegation information, and go to step 2.

       C.  If the response shows a CNAME and that is not the answer
           itself, cache the CNAME, change the SNAME to the canonical
           name in the CNAME RR, and go to step 1.

       D.  If the response shows a DNAME and that is not the answer
           itself, cache the DNAME (upon successful DNSSEC validation if
           the client is a validating resolver).  If substitution of the
           DNAME's target name for its owner name in the SNAME would
           overflow the legal size for a domain name, return an
           implementation-dependent error to the application; otherwise,
           perform the substitution and go to step 1.

       E.  If the response shows a server failure or other bizarre
           contents, delete the server from the SLIST and go back to
           step 3.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20DNAME%20Discussions%20in%20Other%20Documents"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  DNAME Discussions in Other Documents</span>

   In <a href="rfc2181.html#section-10.3">Section 10.3 of [RFC2181]</a>, the discussion on MX and NS records
   touches on redirection by CNAMEs, but this also holds for DNAMEs.

   <a href="#section-10.3">Section 10.3</a> ("MX and NS records") of [<a href="rfc2181.html" title='"Clarifications to the DNS Specification"'>RFC2181</a>] states:

           The domain name used as the value of a NS resource record,
           or part of the value of a MX resource record must not be
           an alias.  Not only is the specification clear on this
           point, but using an alias in either of these positions
           neither works as well as might be hoped, nor well fulfills
           the ambition that may have led to this approach.  This
           domain name must have as its value one or more address
           records.  Currently those will be A records, however in
           the future other record types giving addressing
           information may be acceptable.  It can also have other
           RRs, but never a CNAME RR.

   The DNAME RR is discussed in <a href="rfc3363.html#section-4">RFC 3363, Section 4</a>, on A6 and DNAME.
   The opening premise of this section is demonstrably wrong, and so the
   conclusion based on that premise is wrong.  In particular, [<a href="rfc3363.html" title='"Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)"'>RFC3363</a>]
   deprecates the use of DNAME in the IPv6 reverse tree.  Based on the



<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   experience gained in the meantime, [<a href="rfc3363.html" title='"Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)"'>RFC3363</a>] is revised, dropping all
   constraints on having DNAME RRs in these zones [<a href="rfc6434.html" title='"IPv6 Node Requirements"'>RFC6434</a>].  This would
   greatly improve the manageability of the IPv6 reverse tree.  These
   changes are made explicit below.

   In [<a href="rfc3363.html" title='"Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)"'>RFC3363</a>], the following paragraph is updated by this document,
   and the use of DNAME RRs in the reverse tree is no longer deprecated.

     The issues for DNAME in the reverse mapping tree appears to be
     closely tied to the need to use fragmented A6 in the main tree: if
     one is necessary, so is the other, and if one isn't necessary, the
     other isn't either.  Therefore, in moving <a href="rfc2874.html">RFC 2874</a> to experimental,
     the intent of this document is that use of DNAME RRs in the reverse
     tree be deprecated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Other%20Issues%20with%20DNAME"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Other Issues with DNAME</span>

   There are several issues to be aware of about the use of DNAME.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Canonical%20Hostnames%20Cannot%20Be%20below%20DNAME%20Owners"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Canonical Hostnames Cannot Be below DNAME Owners</span>

   The names listed as target names of MX, NS, PTR, and SRV [<a href="rfc2782.html" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC2782</a>]
   records must be canonical hostnames.  This means no CNAME or DNAME
   redirection may be present during DNS lookup of the address records
   for the host.  This is discussed in <a href="rfc2181.html">RFC 2181</a> <a href="rfc2181.html#section-10.3">[RFC2181], Section 10.3</a>,
   and <a href="rfc1912.html">RFC 1912</a> <a href="rfc1912.html#section-2.4">[RFC1912], Section 2.4</a>.  For SRV, see <a href="rfc2782.html">RFC 2782</a>
   [<a href="rfc2782.html" title='"A DNS RR for specifying the location of services (DNS SRV)"'>RFC2782</a>], page 4.

   The upshot of this is that although the lookup of a PTR record can
   involve DNAMEs, the name listed in the PTR record cannot fall under a
   DNAME.  The same holds for NS, SRV, and MX records.  For example,
   when punycode [<a href="rfc3492.html" title='"Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)"'>RFC3492</a>] alternates for a zone use DNAME, then the NS,
   MX, SRV, and PTR records that point to that zone must use names that
   are not aliases in their RDATA.  Then, what must be done is to have
   the domain names with DNAME substitution already applied to it as the
   MX, NS, PTR, and SRV data.  These are valid canonical hostnames.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Dynamic%20Update%20and%20DNAME"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Dynamic Update and DNAME</span>

   DNAME records can be added, changed, and removed in a zone using
   dynamic update transactions.  Adding a DNAME RR to a zone occludes
   any domain names that may exist under the added DNAME.

   If a dynamic update message attempts to add a DNAME with a given
   owner name, but a CNAME is associated with that name, then the server
   MUST ignore the DNAME.  If a DNAME is already associated with that
   name, then it is replaced with the new DNAME.  Otherwise, add the
   DNAME.  If a CNAME is added with a given owner name, but a DNAME is



<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   associated with that name, then the CNAME MUST be ignored.  Similar
   behavior occurs for dynamic updates to an owner name of a CNAME RR
   [<a href="rfc2136.html" title='"Dynamic Updates in the Domain Name System (DNS UPDATE)"'>RFC2136</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20DNSSEC%20and%20DNAME"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  DNSSEC and DNAME</span>

   The following subsections specify the behavior of implementations
   that understand both DNSSEC and DNAME (synthesis).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.1.%20%20Signed%20DNAME%2C%20Unsigned%20Synthesized%20CNAME"></a><a class="selflink" href="#section-5.3.1" name="section-5.3.1">5.3.1</a>.  Signed DNAME, Unsigned Synthesized CNAME</span>

   In any response, a signed DNAME RR indicates a non-terminal
   redirection of the query.  There might or might not be a server-
   synthesized CNAME in the answer section; if there is, the CNAME will
   never be signed.  For a DNSSEC validator, verification of the DNAME
   RR and then that the CNAME was properly synthesized is sufficient
   proof.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.%20%20DNAME%20Bit%20in%20NSEC%20Type%20Map"></a><a class="selflink" href="#section-5.3.2" name="section-5.3.2">5.3.2</a>.  DNAME Bit in NSEC Type Map</span>

   In any negative response, the NSEC or NSEC3 [<a href="rfc5155.html" title='"DNS Security (DNSSEC) Hashed Authenticated Denial of Existence"'>RFC5155</a>] record type
   bitmap SHOULD be checked to see that there was no DNAME that could
   have been applied.  If the DNAME bit in the type bitmap is set and
   the query name is a subdomain of the closest encloser that is
   asserted, then DNAME substitution should have been done, but the
   substitution has not been done as specified.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.3.%20%20DNAME%20Chains%20as%20Strong%20as%20the%20Weakest%20Link"></a><a class="selflink" href="#section-5.3.3" name="section-5.3.3">5.3.3</a>.  DNAME Chains as Strong as the Weakest Link</span>

   A response can contain a chain of DNAME and CNAME redirections.  That
   chain can end in a positive answer or a negative reply (no name error
   or no data error).  Each step in that chain results in resource
   records being added to the answer or authority section of the
   response.  Only if all steps are secure can the AD (Authentic Data)
   bit be set for the response.  If one of the steps is bogus, the
   result is bogus.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.4.%20%20Validators%20Must%20Understand%20DNAME"></a><a class="selflink" href="#section-5.3.4" name="section-5.3.4">5.3.4</a>.  Validators Must Understand DNAME</span>

   Below are examples of why DNSSEC validators MUST understand DNAME.
   In the examples, SOA records, wildcard denial NSECs, and other
   material not under discussion have been omitted or shortened.









<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.4.1.%20%20Invalid%20Name%20Error%20Response%20Caused%20by%20DNAME%20in%20Bitmap"></a><a class="selflink" href="#section-5.3.4.1" name="section-5.3.4.1">5.3.4.1</a>.  Invalid Name Error Response Caused by DNAME in Bitmap</span>

   ;; Header: QR AA RCODE=3(NXDOMAIN)
   ;; OPT PSEUDOSECTION:
   ; EDNS: version: 0, flags: do; udp: 4096

   ;; Question
   foo.bar.example.com. IN A
   ;; Authority
   bar.example.com. NSEC dub.example.com. A DNAME
   bar.example.com. RRSIG NSEC [valid signature]

   If this is the received response, then only by understanding that the
   DNAME bit in the NSEC bitmap means that foo.bar.example.com needed to
   have been redirected by the DNAME, the validator can see that it is a
   BOGUS reply from an attacker that collated existing records from the
   DNS to create a confusing reply.

   If the DNAME bit had not been set in the NSEC record above, then the
   answer would have validated as a correct name error response.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.4.2.%20%20Valid%20Name%20Error%20Response%20Involving%20DNAME%20in%20Bitmap"></a><a class="selflink" href="#section-5.3.4.2" name="section-5.3.4.2">5.3.4.2</a>.  Valid Name Error Response Involving DNAME in Bitmap</span>

   ;; Header: QR AA RCODE=3(NXDOMAIN)
   ;; OPT PSEUDOSECTION:
   ; EDNS: version: 0, flags: do; udp: 4096

   ;; Question
   cee.example.com. IN A
   ;; Authority
   bar.example.com. NSEC dub.example.com. A DNAME
   bar.example.com. RRSIG NSEC [valid signature]

   This response has the same NSEC records as the example above, but
   with this query name (cee.example.com), the answer is validated,
   because 'cee' does not get redirected by the DNAME at 'bar'.















<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.4.3.%20%20Response%20with%20Synthesized%20CNAME"></a><a class="selflink" href="#section-5.3.4.3" name="section-5.3.4.3">5.3.4.3</a>.  Response with Synthesized CNAME</span>

   ;; Header: QR AA RCODE=0(NOERROR)
   ;; OPT PSEUDOSECTION:
   ; EDNS: version: 0, flags: do; udp: 4096

   ;; Question
   foo.bar.example.com. IN A
   ;; Answer
   bar.example.com. DNAME bar.example.net.
   bar.example.com. RRSIG DNAME [valid signature]
   foo.bar.example.com. CNAME foo.bar.example.net.

   The response shown above has the synthesized CNAME included.
   However, the CNAME has no signature, since the server does not sign
   online.  So this response cannot be trusted.  It could be altered by
   an attacker to be foo.bar.example.com CNAME bla.bla.example.  The
   DNAME record does have its signature included, since it does not
   change.  The validator must verify the DNAME signature and then
   recursively resolve further in order to query for the
   foo.bar.example.net A record.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Examples%20of%20DNAME%20Use%20in%20a%20Zone"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Examples of DNAME Use in a Zone</span>

   Below are some examples of the use of DNAME in a zone.  These
   examples are by no means exhaustive.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Organizational%20Renaming"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Organizational Renaming</span>

   If an organization with domain name FROBOZZ.EXAMPLE.NET became part
   of an organization with domain name ACME.EXAMPLE.COM, it might ease
   transition by placing information such as this in its old zone.

       frobozz.example.net.  DNAME    frobozz-division.acme.example.com.
                             MX       10       mailhub.acme.example.com.

   The response to an extended recursive query for
   www.frobozz.example.net would contain, in the answer section, the
   DNAME record shown above and the relevant RRs for www.frobozz-
   division.acme.example.com.

   If an organization wants to have aliases for names, for a different
   spelling or language, the same example applies.  Note that the MX RR
   at the zone apex is not redirected and has to be repeated in the
   target zone.  Also note that the services at mailhub or www.frobozz-
   division.acme.example.com. have to recognize and handle the aliases.





<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Classless%20Delegation%20of%20Shorter%20Prefixes"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Classless Delegation of Shorter Prefixes</span>

   The classless scheme for in-addr.arpa delegation [<a href="rfc2317.html" title='"Classless IN- ADDR.ARPA delegation"'>RFC2317</a>] can be
   extended to prefixes shorter than 24 bits by use of the DNAME record.
   For example, the prefix 192.0.8.0/22 can be delegated by the
   following records.

       $ORIGIN 0.192.in-addr.arpa.
       8/22    NS       ns.slash-22-holder.example.com.
       8       DNAME    8.8/22
       9       DNAME    9.8/22
       10      DNAME    10.8/22
       11      DNAME    11.8/22

   A typical entry in the resulting reverse zone for some host with
   address 192.0.9.33 might be as follows:

        $ORIGIN 8/22.0.192.in-addr.arpa.
        33.9    PTR     somehost.slash-22-holder.example.com.

   The advisory remarks in [<a href="rfc2317.html" title='"Classless IN- ADDR.ARPA delegation"'>RFC2317</a>] concerning the choice of the "/"
   character apply here as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Network%20Renumbering%20Support"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Network Renumbering Support</span>

   If IPv4 network renumbering were common, maintenance of address space
   delegation could be simplified by using DNAME records instead of NS
   records to delegate.

       $ORIGIN new-style.in-addr.arpa.
       189.190           DNAME    in-addr.example.net.

       $ORIGIN in-addr.example.net.
       188               DNAME    in-addr.customer.example.com.

       $ORIGIN in-addr.customer.example.
       1                 PTR      www.customer.example.com
       2                 PTR      mailhub.customer.example.com.
       ; etc ...

   This would allow the address space 190.189.0.0/16 assigned to the ISP
   "example.net" to be changed without having to alter the zone data
   describing the use of that space by the ISP and its customers.








<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


   Renumbering IPv4 networks is currently so arduous a task that
   updating the DNS is only a small part of the labor, so this scheme
   may have a low value.  But it is hoped that in IPv6 the renumbering
   task will be quite different, and the DNAME mechanism may play a
   useful part.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   The DNAME resource record type code 39 (decimal) originally was
   registered by [<a href="rfc2672.html" title='"Non-Terminal DNS Name Redirection"'>RFC2672</a>] in the DNS Resource Record (RR) Types
   registry table at <a href="http://www.iana.org/assignments/dns-parameters">http://www.iana.org/assignments/dns-parameters</a>.
   IANA has updated the DNS resource record registry to point to this
   document for RR type 39.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Security Considerations</span>

   DNAME redirects queries elsewhere, which may impact security based on
   policy and the security status of the zone with the DNAME and the
   redirection zone's security status.  For validating resolvers, the
   lowest security status of the links in the chain of CNAME and DNAME
   redirections is applied to the result.

   If a validating resolver accepts wildcarded DNAMEs, this creates
   security issues.  Since the processing of a wildcarded DNAME is non-
   deterministic and the CNAME that was substituted by the server has no
   signature, the resolver may choose a different result than what the
   server meant, and consequently end up at the wrong destination.  Use
   of wildcarded DNAMEs is discouraged in any case [<a href="rfc4592.html" title='"The Role of Wildcards in the Domain Name System"'>RFC4592</a>].

   A validating resolver MUST understand DNAME, according to [<a href="rfc4034.html" title='"Resource Records for the DNS Security Extensions"'>RFC4034</a>].
   The examples in <a href="#section-5.3.4">Section 5.3.4</a> illustrate this need.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Acknowledgments"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Acknowledgments</span>

   The authors of this document would like to acknowledge Matt Larson
   for beginning this effort to address the issues related to the DNAME
   RR type.  The authors would also like to acknowledge Paul Vixie, Ed
   Lewis, Mark Andrews, Mike StJohns, Niall O'Reilly, Sam Weiler, Alfred
   Hoenes, and Kevin Darcy for their reviews and comments on this
   document.











<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC1034" name="ref-RFC1034">RFC1034</a>]  Mockapetris, P., "Domain names - concepts and facilities",
              STD 13, <a href="rfc1034.html">RFC 1034</a>, November 1987.

   [<a id="ref-RFC1035" name="ref-RFC1035">RFC1035</a>]  Mockapetris, P., "Domain names - implementation and
              specification", STD 13, <a href="rfc1035.html">RFC 1035</a>, November 1987.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2136" name="ref-RFC2136">RFC2136</a>]  Vixie, P., Thomson, S., Rekhter, Y., and J. Bound,
              "Dynamic Updates in the Domain Name System (DNS UPDATE)",
              <a href="rfc2136.html">RFC 2136</a>, April 1997.

   [<a id="ref-RFC2181" name="ref-RFC2181">RFC2181</a>]  Elz, R. and R. Bush, "Clarifications to the DNS
              Specification", <a href="rfc2181.html">RFC 2181</a>, July 1997.

   [<a id="ref-RFC2317" name="ref-RFC2317">RFC2317</a>]  Eidnes, H., de Groot, G., and P. Vixie, "Classless IN-
              ADDR.ARPA delegation", <a href="https://tools.ietf.org/html/bcp20">BCP 20</a>, <a href="rfc2317.html">RFC 2317</a>, March 1998.

   [<a id="ref-RFC2782" name="ref-RFC2782">RFC2782</a>]  Gulbrandsen, A., Vixie, P., and L. Esibov, "A DNS RR for
              specifying the location of services (DNS SRV)", <a href="rfc2782.html">RFC 2782</a>,
              February 2000.

   [<a id="ref-RFC3597" name="ref-RFC3597">RFC3597</a>]  Gustafsson, A., "Handling of Unknown DNS Resource Record
              (RR) Types", <a href="rfc3597.html">RFC 3597</a>, September 2003.

   [<a id="ref-RFC4033" name="ref-RFC4033">RFC4033</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "DNS Security Introduction and Requirements",
              <a href="rfc4033.html">RFC 4033</a>, March 2005.

   [<a id="ref-RFC4034" name="ref-RFC4034">RFC4034</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "Resource Records for the DNS Security Extensions",
              <a href="rfc4034.html">RFC 4034</a>, March 2005.

   [<a id="ref-RFC4035" name="ref-RFC4035">RFC4035</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S.
              Rose, "Protocol Modifications for the DNS Security
              Extensions", <a href="rfc4035.html">RFC 4035</a>, March 2005.

   [<a id="ref-RFC4592" name="ref-RFC4592">RFC4592</a>]  Lewis, E., "The Role of Wildcards in the Domain Name
              System", <a href="rfc4592.html">RFC 4592</a>, July 2006.

   [<a id="ref-RFC5155" name="ref-RFC5155">RFC5155</a>]  Laurie, B., Sisson, G., Arends, R., and D. Blacka, "DNS
              Security (DNSSEC) Hashed Authenticated Denial of
              Existence", <a href="rfc5155.html">RFC 5155</a>, March 2008.



<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-RFC1912" name="ref-RFC1912">RFC1912</a>]  Barr, D., "Common DNS Operational and Configuration
              Errors", <a href="rfc1912.html">RFC 1912</a>, February 1996.

   [<a id="ref-RFC2672" name="ref-RFC2672">RFC2672</a>]  Crawford, M., "Non-Terminal DNS Name Redirection",
              <a href="rfc2672.html">RFC 2672</a>, August 1999.

   [<a id="ref-RFC3363" name="ref-RFC3363">RFC3363</a>]  Bush, R., Durand, A., Fink, B., Gudmundsson, O., and T.
              Hain, "Representing Internet Protocol version 6 (IPv6)
              Addresses in the Domain Name System (DNS)", <a href="rfc3363.html">RFC 3363</a>,
              August 2002.

   [<a id="ref-RFC3492" name="ref-RFC3492">RFC3492</a>]  Costello, A., "Punycode: A Bootstring encoding of Unicode
              for Internationalized Domain Names in Applications
              (IDNA)", <a href="rfc3492.html">RFC 3492</a>, March 2003.

   [<a id="ref-RFC6434" name="ref-RFC6434">RFC6434</a>]  Jankiewicz, E., Loughney, J., and T. Narten, "IPv6 Node
              Requirements", <a href="rfc6434.html">RFC 6434</a>, December 2011.
































<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Changes%20from%20RFC%202672"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Changes from <a href="rfc2672.html">RFC 2672</a></span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Changes%20to%20Server%20Behavior"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Changes to Server Behavior</span>

   Major changes to server behavior from the original DNAME
   specification are summarized below:

   o  The rules for DNAME substitution have been clarified in
      <a href="#section-2.2">Section 2.2</a>.

   o  The EDNS option to signal DNAME understanding and compression has
      never been specified, and this document clarifies that there is no
      signaling method (<a href="#section-2.5">Section 2.5</a>).

   o  The TTL for synthesized CNAME RRs is now set to the TTL of the
      DNAME, not zero (<a href="#section-3.1">Section 3.1</a>).

   o  Recursive caching servers MUST perform CNAME synthesis on behalf
      of clients (<a href="#section-3.4">Section 3.4</a>).

   o  The revised server algorithm is detailed in <a href="#section-3.2">Section 3.2</a>.

   o  Rules for dynamic update messages adding a DNAME or CNAME RR to a
      zone where a CNAME or DNAME already exists are detailed in
      <a href="#section-5.2">Section 5.2</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Changes%20to%20Client%20Behavior"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Changes to Client Behavior</span>

   Major changes to client behavior from the original DNAME
   specification are summarized below:

   o  Clients MUST be able to accept synthesized CNAME RR's with a TTL
      of either zero or the TTL of the DNAME RR that accompanies the
      CNAME RR.

   o  DNSSEC-aware clients SHOULD cache DNAME RRs and MAY cache
      synthesized CNAME RRs they receive in the same response.  DNSSEC-
      aware clients SHOULD also check the NSEC/NSEC3 type bitmap to
      verify that DNAME redirection is to be done.  DNSSEC validators
      MUST understand DNAME (<a href="#section-5.3">Section 5.3</a>).

   o  The revised client algorithm is detailed in <a href="#section-3.4.1">Section 3.4.1</a>.









<span class="grey">Rose &amp; Wijngaards            Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6672.html">RFC 6672</a>                    DNAME Redirection                  June 2012</span>


Authors' Addresses

   Scott Rose
   NIST
   100 Bureau Dr.
   Gaithersburg, MD  20899
   USA

   Phone: +1-301-975-8439
   Fax:   +1-301-975-6238
   EMail: scott.rose@nist.gov


   Wouter Wijngaards
   NLnet Labs
   Science Park 140
   Amsterdam  1098 XH
   The Netherlands

   Phone: +31-20-888-4551
   EMail: wouter@nlnetlabs.nl






























Rose &amp; Wijngaards            Standards Track                   [Page 22]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6672 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:27 GMT --></html>