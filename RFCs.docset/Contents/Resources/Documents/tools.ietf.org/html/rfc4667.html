<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc4667 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:4667" name="DC.Identifier"/>
<meta content="The Layer 2 Tunneling Protocol (L2TP) provides a standard method for
setting up and managing L2TP sessions to tunnel a variety of L2
protocols. One of the reference models supported by L2TP describes the
use of an L2TP session to connect two Layer 2 circuits attached to a
pair of peering L2TP Access Concentrators (LACs), which is a basic
form of Layer 2 Virtual Private Network (L2VPN). This document defines
the protocol extensions for L2TP to set up different types of L2VPNs
in a unified fashion. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Wei Luo &lt;luo@cisco.com&gt;" name="DC.Creator"/>
<meta content="September, 2006" name="DC.Date.Issued"/>
<meta content="Layer 2 Virtual Private Network (L2VPN) Extensions for Layer 2 Tunneling Protocol (L2TP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 4667 - Layer 2 Virtual Private Network (L2VPN) Extensions for Layer 2 Tunneling Protocol (L2TP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4667.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4667" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-l2tpext-l2vpn" title="draft-ietf-l2tpext-l2vpn">draft-ietf-l2tp...</a>] [<a href="https://datatracker.ietf.org/doc/rfc4667" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4667" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4667" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                             W. Luo
Request for Comments: 4667                           Cisco Systems, Inc.
Category: Standards Track                                 September 2006


          <span class="h1">Layer 2 Virtual Private Network (L2VPN) Extensions</span>
                 <span class="h1">for Layer 2 Tunneling Protocol (L2TP)</span>


Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2006).

Abstract

   The Layer 2 Tunneling Protocol (L2TP) provides a standard method for
   setting up and managing L2TP sessions to tunnel a variety of L2
   protocols.  One of the reference models supported by L2TP describes
   the use of an L2TP session to connect two Layer 2 circuits attached
   to a pair of peering L2TP Access Concentrators (LACs), which is a
   basic form of Layer 2 Virtual Private Network (L2VPN).  This document
   defines the protocol extensions for L2TP to set up different types of
   L2VPNs in a unified fashion.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Specification of Requirements ..............................<a href="#page-2">2</a>
   <a href="#section-2">2</a>. Network Reference Model .........................................<a href="#page-2">2</a>
   <a href="#section-3">3</a>. Forwarder Identifier ............................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. Protocol Components .............................................<a href="#page-4">4</a>
      <a href="#section-4.1">4.1</a>. Control Messages ...........................................<a href="#page-4">4</a>
      <a href="#section-4.2">4.2</a>. Existing AVPs for L2VPN ....................................<a href="#page-4">4</a>
      <a href="#section-4.3">4.3</a>. New AVPs for L2VPN .........................................<a href="#page-5">5</a>
      <a href="#section-4.4">4.4</a>. AVP Interoperability .......................................<a href="#page-7">7</a>
   <a href="#section-5">5</a>. Signaling Procedures ............................................<a href="#page-7">7</a>
      <a href="#section-5.1">5.1</a>. Overview ...................................................<a href="#page-7">7</a>
      <a href="#section-5.2">5.2</a>. Pseudowire Tie Detection ...................................<a href="#page-8">8</a>
      <a href="#section-5.3">5.3</a>. Generic Algorithm ..........................................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. IANA Considerations ............................................<a href="#page-12">12</a>



<span class="grey">Luo                         Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-12">12</a>
   <a href="#section-8">8</a>. Acknowledgement ................................................<a href="#page-13">13</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-13">13</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-13">13</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-13">13</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   [<a id="ref-RFC3931" name="ref-RFC3931">RFC3931</a>] defines a dynamic tunneling mechanism to carry multiple
   Layer 2 protocols besides Point-to-Point Protocol (PPP), the only
   protocol supported in [<a href="rfc2661.html" title='"Layer Two Tunneling Protocol "'>RFC2661</a>], over a packet-based network.  The
   baseline protocol supports various types of applications, which have
   been highlighted in the different Layer 2 Tunneling Protocol (L2TP)
   reference models in [<a href="rfc3931.html" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>RFC3931</a>].  An L2TP Access Concentrator (LAC) is
   an L2TP Control Connection Endpoint (LCCE) that cross-connects
   attachment circuits and L2TP sessions.  Layer 2 Virtual Private
   Network (L2VPN) applications are typically in the scope of the LAC-
   LAC reference model.

   This document discusses the commonalities and differences among L2VPN
   applications with respect to using L2TPv3 as the signaling protocol.
   In this document, the acronym "L2TP" refers to L2TPv3 or L2TP in
   general.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Specification%20of%20Requirements"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Specification of Requirements</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Network%20Reference%20Model"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Network Reference Model</span>

   In the LAC-LAC reference model, a LAC serves as a cross-connect
   between attachment circuits and L2TP sessions.  Each L2TP session
   acts as an emulated circuit, also known as pseudowire.  A pseudowire
   is used to bind two "forwarders" together.  For different L2VPN
   applications, different types of forwarders are defined.

   In the L2VPN framework [<a href="#ref-L2VPNFW" title='"Framework for Layer 2 Virtual Private Networks (L2VPNs)"'>L2VPNFW</a>], a LAC is a Provider Edge (PE)
   device.  LAC and PE are interchangeable terms in the context of this
   document.  Remote systems in the LAC-LAC reference model are Customer
   Edge (CE) devices.









<span class="grey">Luo                         Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


   +----+  L2  +----+                      +----+  L2  +----+
   | CE |------| PE |....[core network]....| PE |------| CE |
   +----+      +----+                      +----+      +----+

                    |&lt;- emulated service -&gt;|
         |&lt;----------------- L2 service --------------&gt;|

                  L2VPN Network Reference Model

   In a simple cross-connect application, an attachment circuit is a
   forwarder directly bound to a pseudowire.  It is a one-to-one
   mapping.  Traffic received from the attachment circuit on a local PE
   is forwarded to the remote PE through the pseudowire.  When the
   remote PE receives traffic from the pseudowire, it forwards the
   traffic to the corresponding attachment circuit on its end.  The
   forwarding decision is based on the attachment circuit or pseudowire
   demultiplexing identifier.

   With Virtual Private LAN Service (VPLS), a Virtual Switching Instance
   (VSI) is a forwarder connected to one or more attachment circuits and
   pseudowires.  A single pseudowire is used to connect a pair of VSIs
   on two peering PEs.  Traffic received from an attachment circuit or a
   pseudowire is first forwarded to the corresponding VSI based on the
   attachment circuit or pseudowire demultiplexing identifier.  The VSI
   performs additional lookup to determine where to further forward the
   traffic.

   With Virtual Private Wire Service (VPWS), attachment circuits are
   grouped into "colored pools".  Each pool is a forwarder and is
   connected through a network of point-to-point cross-connects.  The
   data forwarding perspective is identical to the cross-connect
   application.  However, constructing colored pools involves more
   complicated signaling procedures.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Forwarder%20Identifier"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Forwarder Identifier</span>

   A forwarder identifier is assigned to each forwarder on a given PE
   and is unique in the context of the PE.  It is defined as the
   concatenation of an Attachment Group Identifier (AGI) and an
   Attachment Individual Identifier (AII), denoted as &lt;AGI, AII&gt;.  The
   AGI is used to group a set of forwarders together for signaling
   purposes.  An AII is used to distinguish forwarders within a group.
   AII can be unique on a per-platform or per-group basis.

   As far as the signaling procedures are concerned, a forwarder
   identifier is an arbitrary string of bytes.  It is up to
   implementations to decide the values for AGI and AII.




<span class="grey">Luo                         Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


   When connecting two forwarders together, both MUST have the same AGI
   as part of their forwarder identifiers.  The AII of the source
   forwarder is known as the Source AII (SAII), and the AII of the
   target forwarder is known as the Target AII (TAII).  Therefore, the
   source forwarder and target forwarder can be denoted as &lt;AGI, SAII&gt;
   and &lt;AGI, TAII&gt;, respectively.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Protocol%20Components"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Protocol Components</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Control%20Messages"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Control Messages</span>

   L2TP defines two sets of session management procedures: incoming call
   and outgoing call.  Even though it is entirely possible to use the
   outgoing call procedures for signaling L2VPNs, the incoming call
   procedures have some advantages in terms of the relevance of the
   semantics.  [<a href="#ref-PWE3L2TP" title='"Pseudowires and L2TPv3"'>PWE3L2TP</a>] gives more details on why the incoming call
   procedures are more appropriate for setting up pseudowires.

   The signaling procedures for L2VPNs described in the following
   sections are based on the Control Connection Management and the
   Incoming Call procedures, defined in Sections <a href="#section-3.3">3.3</a> and <a href="#section-3.4.1">3.4.1</a> of
   [<a href="rfc3931.html" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>RFC3931</a>], respectively.  L2TP control message types are defined in
   <a href="rfc3931.html#section-3.1">Section 3.1 of [RFC3931]</a>.  This document references the following
   L2TP control messages:

     Start-Control-Connection-Request (SCCRQ)
     Start-Control-Connection-Reply   (SCCRP)
     Incoming-Call-Request            (ICRQ)
     Incoming-Call-Reply              (ICRP)
     Incoming-Call-Connected          (ICCN)
     Set-Link-Info                    (SLI)

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Existing%20AVPs%20for%20L2VPN"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Existing AVPs for L2VPN</span>

   The following Attribute Value Pairs (AVPs), defined in Sections
   5.4.3, 5.4.4, and 5.4.5 of [<a href="rfc3931.html" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>RFC3931</a>], are used for signaling L2VPNs.

   Router ID

      The Router ID sent in SCCRQ and SCCRP during control connection
      setup establishes the unique identity of each PE.

   Pseudowire Capabilities List

      The Pseudowire Capabilities List sent in the SCCRQ and SCCRP
      indicates the pseudowire types supported by the sending PE.  It
      merely serves as an advertisement to the receiving PE.  Its
      content should not affect the control connection setup.



<span class="grey">Luo                         Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


      Before a local PE initiates a session of a particular pseudowire
      type to a remote PE, it MUST examine whether the remote PE has
      advertised this pseudowire type in this AVP and SHOULD NOT attempt
      to initiate the session if the intended pseudowire type is not
      supported by the remote PE.

   Pseudowire Type

      The Pseudowire Type sent in ICRQ signals the intended pseudowire
      type to the receiving PE.  The receiving PE checks it against its
      local pseudowire capabilities list.  If it finds a match, it
      responds with an ICRP without a Pseudowire Type AVP, which
      implicitly acknowledges its acceptance of the intended pseudowire.
      If it does not find a match, it MUST respond with a Call-
      Disconnect-Notify (CDN), with an "unsupported pseudowire type"
      result code.

   L2-Specific Sublayer

      The L2-Specific Sublayer can be sent in ICRQ, ICRP, and ICCN.  If
      the receiving PE supports the specified L2-Specific Sublayer, it
      MUST include the identified L2-Specific Sublayer in its data
      packets sent to the sending PE.  Otherwise, it MUST reject the
      connection by sending a CDN to the sending PE.

   Circuit Status

      The Circuit Status is sent in both ICRQ and ICRP to inform the
      receiving PE about the circuit status on the sending PE.  It can
      also be sent in ICCN and SLI to update the status.

   Remote End Identifier

      The TAII value is encoded in the Remote End ID AVP and sent in
      ICRQ along with the optional AGI to instruct the receiving PE to
      bind the proposed pseudowire to the forwarder that matches the
      specified forwarder identifier.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20New%20AVPs%20for%20L2VPN"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  New AVPs for L2VPN</span>

   Attachment Group Identifier

      The AGI AVP, Attribute Type 89, is an identifier used to associate
      a forwarder to a logical group.  The AGI AVP is used in
      conjunction with the Local End ID AVP and Remote End ID AVP, which
      encode the SAII and TAII, respectively, to identify a specific
      forwarder.  When the AGI AVP is omitted in the control messages or
      contains a zero-length value, the forwarders are considered to use



<span class="grey">Luo                         Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


      the default AGI.  Note that there is only one designated default
      AGI value for all forwarders.

      The Attribute Value field for this AVP has the following format:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |M|H|0|0|0|0|    Length         |              0                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               89              |      AGI (variable length)    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      The AGI field is a variable-length field.  This AVP MAY be present
      in ICRQ.

      This AVP MAY be hidden (the H bit MAY be 0 or 1).  The hiding of
      AVP attribute values is defined in <a href="rfc3931.html#section-5.3">Section 5.3 of [RFC3931]</a>.  The
      M bit for this AVP SHOULD be set to 0.  The Length (before hiding)
      of this AVP is 6 octets plus the length of the AGI field.

   Local End ID

      The Local End ID AVP, Attribute Type 90, encodes the SAII value.
      The SAII may also be used in conjunction with the TAII to detect
      pseudowire ties.  When it is omitted in the control messages, it
      is assumed that it has the same value as the TAII.

      The Attribute Value field for this AVP has the following format:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |M|H|0|0|0|0|    Length         |              0                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               90              |       SAII (variable length)  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      The SAII field is a variable-length field.  This AVP MAY be
      present in ICRQ.

      This AVP MAY be hidden (the H bit MAY be 0 or 1).  The M bit for
      this AVP SHOULD be set to 0.  The Length (before hiding) of this
      AVP is 6 octets plus the length of the SAII field.

   Interface Maximum Transmission Unit

      The Interface Maximum Transmission Unit (MTU) AVP, Attribute Type



<span class="grey">Luo                         Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


      91, indicates the MTU in octets of a packet that can be sent out
      from the CE-facing interface.  The MTU values of a given
      pseudowire, if advertised in both directions, MUST be identical.
      If they do not match, the pseudowire SHOULD NOT be established.
      When this AVP is omitted in the control messages in either
      direction, it is assumed that the remote PE has the same interface
      MTU as the local PE for the pseudowire being signaled.

      The Attribute Value field for this AVP has the following format:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |M|H|0|0|0|0|    Length         |              0                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |               91              |          Interface MTU        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      The Interface MTU field is a 2-octet integer value.  This AVP MAY
      be present in ICRQ and ICRP.  When a PE receives an Interface MTU
      AVP with an MTU value different from its own, it MAY respond with
      a CDN with a new result code indicating the disconnect cause.

        23 - Mismatching interface MTU

      This AVP MAY be hidden (the H bit MAY be 0 or 1).  The M bit for
      this AVP SHOULD be set to 0.  The Length (before hiding) of this
      AVP is 8 octets.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20AVP%20Interoperability"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  AVP Interoperability</span>

   To ensure interoperability, the mandatory (M) bit settings of the
   existing AVPs used in L2VPN applications should be the same as those
   specified in [<a href="rfc3931.html" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>RFC3931</a>].  The generic M-bit processing is described in
   <a href="rfc3931.html#section-5.2">Section 5.2 of [RFC3931]</a>.  Setting the M-bit of the new AVPs to 1
   will impair interoperability.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20Signaling%20Procedures"></a><a class="selflink" href="#section-5" name="section-5">5</a>. Signaling Procedures</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Overview"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Overview</span>

   Assume that a PE assigns a forwarder identifier to one of its local
   forwarders and that it knows it needs to set up a pseudowire to a
   remote forwarder on a remote PE that has a certain Forwarder ID.
   This knowledge can be obtained either through manual configuration or
   some auto-discovery procedure.

   Before establishing the intended pseudowire, each pair of peering PEs



<span class="grey">Luo                         Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


   exchanges control connection messages to establish a control
   connection.  Each advertises its supported pseudowire types, as
   defined in [<a href="#ref-PWE3IANA" title='"IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)"'>PWE3IANA</a>], in the Pseudowire Capabilities List AVP.

   After the control connection is established, the local PE examines
   whether the remote PE supports the pseudowire type it intends to set
   up.  Only if the remote PE supports the intended pseudowire type
   should it initiate a pseudowire connection request.

   When the local PE receives an ICRQ for a pseudowire connection, it
   examines the forwarder identifiers encoded in the AGI, SAII, and TAII
   in order to determine the following:

     - Whether it has a local forwarder with the forwarder identifier
       value specified in the ICRQ.

     - Whether the remote forwarder with the forwarder identifier
       specified in the ICRQ is allowed to connect with this local
       forwarder.

   If both conditions are met, it sends an ICRP to the remote PE to
   accept the connection request.  If either of the two conditions
   fails, it sends a CDN to the remote PE to reject the connection
   request.

   The local PE can optionally include a result code in the CDN to
   indicate the disconnect cause.  The possible result codes are

     24 - Attempt to connect to non-existent forwarder
     25 - Attempt to connect to unauthorized forwarder

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Pseudowire%20Tie%20Detection"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Pseudowire Tie Detection</span>

   Conceivably in the network reference models, as either PE may
   initiate a pseudowire to another PE at any time, the PEs could end up
   initiating a pseudowire to each other simultaneously.  In order to
   avoid setting up duplicated pseudowires between two forwarders, each
   PE must be able to independently detect such a pseudowire tie.  The
   following procedures need to be followed to detect a tie:

   If both TAII and SAII are present in the ICRQ, the receiving PE
   compares the TAII and SAII against the SAII and TAII previously sent
   to the sending PE.  If the received TAII matches the sent SAII and
   the received SAII matches the sent TAII, a tie is detected.

   If only the TAII is present in the ICRQ, the SAII is assumed to have
   the same value as the TAII.  The receiving PE compares the received
   TAII with the SAII that it previously sent to the sending PE.  If the



<span class="grey">Luo                         Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


   SAII in that ICRQ is also omitted, then the value encoded in the sent
   TAII is used for comparison.  If they match, a tie is detected.

   If the AGI is present, it is first prepended to the TAII and SAII
   values before the tie detection occurs.

   Once a tie is discovered, the PE uses the standard L2TP tie breaking
   procedure, as described in <a href="rfc3931.html#section-5.4.4">Section 5.4.4 of [RFC3931]</a>, to disconnect
   the duplicated pseudowire.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Generic%20Algorithm"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Generic Algorithm</span>

   The following uses a generic algorithm to illustrate the protocol
   interactions when constructing an L2VPN using L2TP signaling.

   Each PE first forms a list, SOURCE_FORWARDERS, consisting of all
   local forwarders of a given VPN.  Then it puts all local forwarders
   that need to be interconnected and all remote forwarders of the same
   VPN into another list, TARGET_FORWARDERS.  The formation of the
   network topology depends on the content in the SOURCE_FORWARDERS and
   TARGET_FORWARDERS lists.  These two lists can be constructed by
   manual configuration or some auto-discovery procedure.

   The algorithm is used to set up a full mesh of interconnections
   between SOURCE_FORWARDERS and TARGET_FORWARDERS.  An L2VPN is formed
   when the algorithm is finished in every participating PE of this
   L2VPN.

     1.  Pick the next forwarder, from SOURCE_FORWARDERS.  If no
         forwarder is available for processing, the processing is
         complete.

     2.  Pick the next forwarder, from TARGET_FORWARDERS.  If no
         forwarder is available for processing, go back to step 1.

     3.  If the two forwarders are associated with different Router
         IDs, a pseudowire must be established between them.  Proceed
         to step 6.

     4.  Compare the &lt;AGI, AII&gt; values of the two forwarders.  If
         they match, the source and target forwarders are the same,
         so no more action is necessary.  Go back to step 2.

     5.  As the source and target forwarders both reside on the local
         PE, no pseudowire is needed.  The PE simply creates a local
         cross-connect between the two forwarders.  Go back to step 2.

     6.  As the source and target forwarders reside on different PEs,



<span class="grey">Luo                         Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


         a pseudowire must be established between them.  The PE first
         examines whether the source forwarder has already established a
         pseudowire to the target forwarder.  If so, go back to step 2.

     7.  If no pseudowire is already established between the source and
         target forwarders, the local PE obtains the address of the
         remote PE and establishes a control connection to the remote
         PE if one does not already exist.

     8.  The local PE sends an ICRQ to the remote PE.  The AGI, TAII,
         and SAII values are encoded in the AGI AVP, the Remote End ID
         AVP, and the Local End ID AVP, respectively.

     9.  If the local PE receives a response corresponding to the
         ICRQ it just sent, proceed to step 10.  Otherwise, if the
         local PE receives an ICRQ from the same remote PE, proceed
         to step 11.

     10. The local PE receives a response from the remote PE.  If
         it is a CDN, go back to step 2.  If it's an ICRP, the local
         PE binds the source forwarder to the pseudowire and sends
         an ICCN to the remote PE.  Go back to step 2.

     11. If the local PE receives an ICRQ from the same remote PE,
         it needs to perform session tie detection, as described in
         <a href="#section-5.2">Section 5.2</a>.  If a session tie is detected, the PE performs
         tie breaking.

     12. If the local PE loses the tie breaker, it sends a CDN with
         the result code that indicates that the disconnection is due to
         losing the tie breaker.  Proceed to step 14.

     13. If the local PE wins the tie breaker, it ignores the remote
         PE's ICRQ, but acknowledges receipt of the control message
         and continues waiting for the response from the remote PE.
         Go to step 10.

     14. The local PE determines whether it should accept the
         connection request, as described in <a href="#section-5.1">Section 5.1</a>.
         If it accepts the ICRQ, it sends an ICRP to the remote PE.

     15. The local PE receives a response from the remote PE.  If
         it is a CDN, go back to step 2.  If it is an ICCN, the local
         PE binds the source forwarder to the pseudowire, go back
         to step 2.

   The following diagram illustrates the above procedure:




<span class="grey">Luo                         Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


          ---------&gt;     Pick Next
          |           Source Forwarder
          |                 |
          |                 |
          |                 v                  N
          |        Found Source Forwarder? ----------&gt; End
          |                 |
          |              Y  |
          |                 v
          |              Pick Next     &lt;--------------------------------
          |           Target Forwarder                                 |
          |                 |                                          |
          |                 |                                          |
          |  N              v                                          |
          -------- Found Target Forwarder?                             |
                            |                                          |
                         Y  |                                          |
                            v             Y                        Y   |
                      Same Router ID? ------&gt; Same Forwarder ID? ------|
                            |                         |                |
                         N  |                      N  |                |
                            |                         v                |
                            |                      Create Local -------|
                            v                      Cross-connect       |
                    Pseudowire Already    Y                            |
                    Established Between -------------------------------|
                    Source and Target?                                 |
                            |                                          |
                         N  |                                          |
                            v                                          |
                 Local Initiates Pseudowire                            |
               Connection Request to Remote                            |
                            |                                          |
                            |                                          |
                            v                                          |
      -------&gt;    Local Wait for Message                               |
      |           ----- from Remote   --------------                   |
      |           |                                |                   |
      |           |                                |                   |
      |           v                                v                   |
      |   Local Receives Pseudowire      Local Receives Pseudowire     |
      |     Connection Request             Connection Response         |
      |       from Remote                     from Remote              |
      |           |                                |                   |
      |           |                                |                   |
      |           v                                v             N     |
      |   Perform Pseudowire              Connection Accepted? --------|
      |   Tie Detection                            |                   |



<span class="grey">Luo                         Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


      |           |                             Y  |                   |
      |           |                                v                   |
      |           |                        Local Binds Source ---------|
      |           |                      Forwarder to Pseudowire       |
      |           |                                                    |
      |           v             N                  N                   |
      |       Tie Detected?  -----&gt; Accept Remote -----&gt;  Reject ------|
      |           |             Connection Request?    Remote Request  |
      |        Y  |                        ^   |                       |
      |           v                        |   |   Y                   |
      |   Perform Tie Breaking             |   ------&gt;  Local Binds ----
      |           |                        |         Source Forwarder
      |           |                        |           to Pseudowire
      |           v             N          |
      |   Won Tie Breaking?  ------&gt;   Disconnect
      |           |                  Local Connection
      |        Y  |
      |           v
      ------ Ignore Remote
            Connection Request

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  IANA Considerations</span>

   The IANA registry procedure in this document follows that in <a href="rfc3931.html#section-10">Section</a>
   <a href="rfc3931.html#section-10">10 of [RFC3931]</a>.  The IANA has assigned the following new values for
   existing registries managed by IANA.

   This document defines three new L2TP control message Attribute Value
   Pairs (AVPs) that have been assigned by the IANA.  These are
   described in <a href="#section-4.3">Section 4.3</a> and are summarized below:

     89 - Attachment Group Identifier
     90 - Local End Identifier
     91 - Interface Maximum Transmission Unit

   Sections <a href="#section-4.3">4.3</a> and <a href="#section-5.1">5.1</a> define three new result codes for the CDN
   message that have been assigned by the IANA:

     23 - Mismatching interface MTU
     24 - Attempt to connect to non-existent forwarder
     25 - Attempt to connect to unauthorized forwarder

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security Considerations</span>

   This specification does not introduce any additional security
   considerations beyond those discussed in [<a href="rfc3931.html" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>RFC3931</a>] and [<a href="#ref-L2VPNFW" title='"Framework for Layer 2 Virtual Private Networks (L2VPNs)"'>L2VPNFW</a>].





<span class="grey">Luo                         Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgement"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgement</span>

   The author would like to thank Mark Townsley and Carlos Pignataro for
   their valuable input.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3931" name="ref-RFC3931">RFC3931</a>]  Lau, J., Townsley, M., and I. Goyret, "Layer Two Tunneling
              Protocol - Version 3 (L2TPv3)", <a href="rfc3931.html">RFC 3931</a>, March 2005.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-PWE3IANA" name="ref-PWE3IANA">PWE3IANA</a>] Martini, L., "IANA Allocations for Pseudowire Edge to Edge
              Emulation (PWE3)", <a href="https://tools.ietf.org/html/bcp116">BCP 116</a>, <a href="rfc4446.html">RFC 4446</a>, April 2006.

   [<a id="ref-L2VPNFW" name="ref-L2VPNFW">L2VPNFW</a>]  Andersson L., Ed. and E. Rosen, Ed., "Framework for Layer
              2 Virtual Private Networks (L2VPNs)", <a href="rfc4664.html">RFC 4664</a>, September
              2006.

   [<a id="ref-PWE3L2TP" name="ref-PWE3L2TP">PWE3L2TP</a>] W. Townsley, <a href="https://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22Pseudowires+and+L2TPv3%22" style="text-decoration: none">"Pseudowires and L2TPv3"</a>, Work in Progress.

   [<a id="ref-RFC2661" name="ref-RFC2661">RFC2661</a>]  Townsley, W., Valencia, A., Rubens, A., Pall, G., Zorn,
              G., and B. Palter, "Layer Two Tunneling Protocol "L2TP"",
              <a href="rfc2661.html">RFC 2661</a>, August 1999.

Author's Address

   Wei Luo
   Cisco Systems, Inc.
   170 West Tasman Drive
   San Jose, CA 95134

   EMail: luo@cisco.com













<span class="grey">Luo                         Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc4667.html">RFC 4667</a>               L2VPN Extensions for L2TP          September 2006</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2006).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).







Luo                         Standards Track                    [Page 14]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc4667 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --></html>