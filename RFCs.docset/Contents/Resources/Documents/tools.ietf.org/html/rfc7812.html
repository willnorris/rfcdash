<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7812 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-atlas-rtgwg-mrt-frr-architecture" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7812" name="DC.Identifier"/>
<meta content="June, 2016" name="DC.Date.Issued"/>
<meta content="Atlas, Alia" name="DC.Creator"/>
<meta content="Bowers, Chris" name="DC.Creator"/>
<meta content="This document defines the architecture for IP and LDP Fast Reroute
using Maximally Redundant Trees (MRT-FRR). MRT-FRR is a technology
that gives link-protection and node-protection with 100% coverage in
any network topology that is still connected after the failure." name="DC.Description.Abstract"/>
<meta content="An Architecture for IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7812 - An Architecture for IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7812.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7812" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-rtgwg-mrt-frr-architecture" title="draft-ietf-rtgwg-mrt-frr-architecture">draft-ietf-rtgw...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7812" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7812" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7812" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=7812&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                          A. Atlas
Request for Comments: 7812                                     C. Bowers
Category: Standards Track                               Juniper Networks
ISSN: 2070-1721                                                G. Enyedi
                                                                Ericsson
                                                               June 2016


                <span class="h1">An Architecture for IP/LDP Fast Reroute</span>
               <span class="h1">Using Maximally Redundant Trees (MRT-FRR)</span>

Abstract

   This document defines the architecture for IP and LDP Fast Reroute
   using Maximally Redundant Trees (MRT-FRR).  MRT-FRR is a technology
   that gives link-protection and node-protection with 100% coverage in
   any network topology that is still connected after the failure.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7812">http://www.rfc-editor.org/info/rfc7812</a>.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





<span class="grey">Atlas, et al.                Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Importance of 100% Coverage . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.2">1.2</a>.  Partial Deployment and Backwards Compatibility  . . . . .   <a href="#page-5">5</a>
   <a href="#section-2">2</a>.  Requirements Language . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-3">3</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Maximally Redundant Trees (MRT) . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-5">5</a>.  MRT and Fast Reroute  . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-6">6</a>.  Unicast Forwarding with MRT Fast Reroute  . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-6.1">6.1</a>.  Introduction to MRT Forwarding Options  . . . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-6.1.1">6.1.1</a>.  MRT LDP Labels  . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
         6.1.1.1.  Topology-Scoped FEC Encoded Using a Single Label
                   (Option 1A) . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
         6.1.1.2.  Topology and FEC Encoded Using a Two-Label Stack
                   (Option 1B) . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
         6.1.1.3.  Compatibility of MRT LDP Label Options 1A and 1B   12
         <a href="#section-6.1.1.4">6.1.1.4</a>.  Required Support for MRT LDP Label Options  . . .  <a href="#page-12">12</a>
       <a href="#section-6.1.2">6.1.2</a>.  MRT IP Tunnels (Options 2A and 2B)  . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.2">6.2</a>.  Forwarding LDP Unicast Traffic over MRT Paths . . . . . .  <a href="#page-13">13</a>
       6.2.1.  Forwarding LDP Traffic Using MRT LDP Label Option 1A   13
       6.2.2.  Forwarding LDP Traffic Using MRT LDP Label Option 1B   14
       6.2.3.  Other Considerations for Forwarding LDP Traffic Using
               MRT LDP Labels  . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
       <a href="#section-6.2.4">6.2.4</a>.  Required Support for LDP Traffic  . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-6.3">6.3</a>.  Forwarding IP Unicast Traffic over MRT Paths  . . . . . .  <a href="#page-14">14</a>
       <a href="#section-6.3.1">6.3.1</a>.  Tunneling IP Traffic Using MRT LDP Labels . . . . . .  <a href="#page-15">15</a>
         6.3.1.1.  Tunneling IP Traffic Using MRT LDP Label Option
                   1A  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
         6.3.1.2.  Tunneling IP Traffic Using MRT LDP Label Option
                   1B  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
       <a href="#section-6.3.2">6.3.2</a>.  Tunneling IP Traffic Using MRT IP Tunnels . . . . . .  <a href="#page-16">16</a>
       <a href="#section-6.3.3">6.3.3</a>.  Required Support for IP Traffic . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-7">7</a>.  MRT Island Formation  . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
     <a href="#section-7.1">7.1</a>.  IGP Area or Level . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-7.2">7.2</a>.  Support for a Specific MRT Profile  . . . . . . . . . . .  <a href="#page-17">17</a>
     7.3.  Excluding Additional Routers and Interfaces from the MRT
           Island  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
       <a href="#section-7.3.1">7.3.1</a>.  Existing IGP Exclusion Mechanisms . . . . . . . . . .  <a href="#page-18">18</a>
       <a href="#section-7.3.2">7.3.2</a>.  MRT-Specific Exclusion Mechanism  . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-7.4">7.4</a>.  Connectivity  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-7.5">7.5</a>.  Algorithm for MRT Island Identification . . . . . . . . .  <a href="#page-19">19</a>
   <a href="#section-8">8</a>.  MRT Profile . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-8.1">8.1</a>.  MRT Profile Options . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-8.2">8.2</a>.  Router-Specific MRT Parameters  . . . . . . . . . . . . .  <a href="#page-21">21</a>
     <a href="#section-8.3">8.3</a>.  Default MRT Profile . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   <a href="#section-9">9</a>.  LDP Signaling Extensions and Considerations . . . . . . . . .  <a href="#page-22">22</a>




<span class="grey">Atlas, et al.                Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   <a href="#section-10">10</a>. Inter-area Forwarding Behavior  . . . . . . . . . . . . . . .  <a href="#page-23">23</a>
     <a href="#section-10.1">10.1</a>.  ABR Forwarding Behavior with MRT LDP Label Option 1A . .  <a href="#page-23">23</a>
       <a href="#section-10.1.1">10.1.1</a>.  Motivation for Creating the Rainbow-FEC  . . . . . .  <a href="#page-24">24</a>
     <a href="#section-10.2">10.2</a>.  ABR Forwarding Behavior with IP Tunneling (Option 2) . .  <a href="#page-24">24</a>
     <a href="#section-10.3">10.3</a>.  ABR Forwarding Behavior with MRT LDP Label Option 1B . .  <a href="#page-25">25</a>
   <a href="#section-11">11</a>. Prefixes Multiply Attached to the MRT Island  . . . . . . . .  <a href="#page-26">26</a>
     11.1.  Protecting Multihomed Prefixes Using Tunnel Endpoint
            Selection  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>
     11.2.  Protecting Multihomed Prefixes Using Named Proxy-Nodes .  29
     11.3.  MRT Alternates for Destinations outside the MRT Island .  31
   <a href="#section-12">12</a>. Network Convergence and Preparing for the Next Failure  . . .  <a href="#page-32">32</a>
     <a href="#section-12.1">12.1</a>.  Micro-loop Prevention and MRTs . . . . . . . . . . . . .  <a href="#page-32">32</a>
     <a href="#section-12.2">12.2</a>.  MRT Recalculation for the Default MRT Profile  . . . . .  <a href="#page-33">33</a>
   <a href="#section-13">13</a>. Operational Considerations  . . . . . . . . . . . . . . . . .  <a href="#page-34">34</a>
     <a href="#section-13.1">13.1</a>.  Verifying Forwarding on MRT Paths  . . . . . . . . . . .  <a href="#page-34">34</a>
     <a href="#section-13.2">13.2</a>.  Traffic Capacity on Backup Paths . . . . . . . . . . . .  <a href="#page-34">34</a>
     <a href="#section-13.3">13.3</a>.  MRT IP Tunnel Loopback Address Management  . . . . . . .  <a href="#page-36">36</a>
     <a href="#section-13.4">13.4</a>.  MRT-FRR in a Network with Degraded Connectivity  . . . .  <a href="#page-36">36</a>
     <a href="#section-13.5">13.5</a>.  Partial Deployment of MRT-FRR in a Network . . . . . . .  <a href="#page-37">37</a>
   <a href="#section-14">14</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-37">37</a>
   <a href="#section-15">15</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-38">38</a>
   <a href="#section-16">16</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-38">38</a>
     <a href="#section-16.1">16.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-38">38</a>
     <a href="#section-16.2">16.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-39">39</a>
   <a href="#appendix-A">Appendix A</a>.  Inter-level Forwarding Behavior for IS-IS  . . . . .  <a href="#page-41">41</a>
   <a href="#appendix-B">Appendix B</a>.  General Issues with Area Abstraction . . . . . . . .  <a href="#page-42">42</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
   Contributors  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-44">44</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This document describes a solution for IP/LDP fast reroute [<a href="rfc5714.html" title='"IP Fast Reroute Framework"'>RFC5714</a>].
   MRT-FRR creates two alternate forwarding trees that are distinct from
   the primary next-hop forwarding used during stable operation.  These
   two trees are maximally diverse from each other, providing link and
   node protection for 100% of paths and failures as long as the failure
   does not cut the network into multiple pieces.  This document defines
   the architecture for IP/LDP fast reroute with MRT.

   [<a id="ref-RFC7811" name="ref-RFC7811">RFC7811</a>] describes how to compute maximally redundant trees using a
   specific algorithm: the MRT Lowpoint algorithm.  The MRT Lowpoint
   algorithm is used by a router that supports the Default MRT Profile,
   as specified in this document.

   IP/LDP Fast Reroute using Maximally Redundant Trees (MRT-FRR) uses
   two maximally diverse forwarding topologies to provide alternates.  A
   primary next hop should be on only one of the diverse forwarding



<span class="grey">Atlas, et al.                Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   topologies; thus, the other can be used to provide an alternate.
   Once traffic has been moved to one of the MRTs by one Point of Local
   Repair (PLR), that traffic is not subject to further repair actions
   by another PLR, even in the event of multiple simultaneous failures.
   Therefore, traffic repaired by MRT-FRR will not loop between
   different PLRs responding to different simultaneous failures.

   While MRT provides 100% protection for a single link or node failure,
   it may not protect traffic in the event of multiple simultaneous
   failures, nor does it take into account Shared Risk Link Groups
   (SRLGs).  Also, while the MRT Lowpoint algorithm is computationally
   efficient, it is also new.  In order for MRT-FRR to function
   properly, all of the other nodes in the network that support MRT must
   correctly compute next hops based on the same algorithm and install
   the corresponding forwarding state.  This is in contrast to other FRR
   methods where the calculation of backup paths generally involves
   repeated application of the simpler and widely deployed Shortest Path
   First (SPF) algorithm, and backup paths themselves reuse the
   forwarding state used for shortest path forwarding of normal traffic.
   <a href="#section-13">Section 13</a> provides operational guidance related to verification of
   MRT forwarding paths.

   In addition to supporting IP and LDP unicast fast reroute, the
   diverse forwarding topologies and guarantee of 100% coverage permit
   fast-reroute technology to be applied to multicast traffic as
   described in [<a href="#ref-MRT-ARCH">MRT-ARCH</a>].  However, the current document does not
   address the multicast applications of MRTs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Importance%20of%20100%25%20Coverage"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Importance of 100% Coverage</span>

   Fast reroute is based upon the single failure assumption: that the
   time between single failures is long enough for a network to
   reconverge and start forwarding on the new shortest paths.  That does
   not imply that the network will only experience one failure or
   change.

   It is straightforward to analyze a particular network topology for
   coverage.  However, a real network does not always have the same
   topology.  For instance, maintenance events will take links or nodes
   out of use.  Simply costing out a link can have a significant effect
   on what Loop-Free Alternates (LFAs) are available.  Similarly, after
   a single failure has happened, the topology is changed and its
   associated coverage has changed as well.  Finally, many networks have
   new routers or links added and removed; each of those changes can
   have an effect on the coverage for topology-sensitive methods such as
   LFA and Remote LFA.  If fast reroute is important for the network
   services provided, then a method that guarantees 100% coverage is
   important to accommodate natural network topology changes.



<span class="grey">Atlas, et al.                Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   When a network needs to use Ordered FIB [<a href="rfc6976.html" title='"Framework for Loop-Free Convergence Using the Ordered Forwarding Information Base (oFIB) Approach"'>RFC6976</a>] or Nearside
   Tunneling [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>] as a micro-loop prevention mechanism [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>],
   then the whole IGP area needs to have alternates available.  This
   allows the micro-loop prevention mechanism, which requires slower
   network convergence, to take the necessary time without adversely
   impacting traffic.  Without complete coverage, traffic to the
   unprotected destinations will be dropped for significantly longer
   than with current convergence -- where routers individually converge
   as fast as possible.  See <a href="#section-12.1">Section 12.1</a> for more discussion of micro-
   loop prevention and MRTs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Partial%20Deployment%20and%20Backwards%20Compatibility"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Partial Deployment and Backwards Compatibility</span>

   MRT-FRR supports partial deployment.  Routers advertise their ability
   to support MRT.  Inside the MRT-capable connected group of routers
   (referred to as an MRT Island), the MRTs are computed.  Alternates to
   destinations outside the MRT Island are computed and depend upon the
   existence of a loop-free neighbor of the MRT Island for that
   destination.  MRT Islands are discussed in detail in <a href="#section-7">Section 7</a>, and
   partial deployment is discussed in more detail in <a href="#section-13.5">Section 13.5</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Requirements%20Language"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Terminology"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Terminology</span>

   network graph:   A graph that reflects the network topology where all
      links connect exactly two nodes and broadcast links have been
      transformed into the standard pseudonode representation.

   cut-link:   A link whose removal partitions the network.  A cut-link
      by definition must be connected between two cut-vertices.  If
      there are multiple parallel links, then they are referred to as
      cut-links in this document if removing the set of parallel links
      would partition the network graph.

   cut-vertex:   A vertex whose removal partitions the network graph.

   2-connected:   A graph that has no cut-vertices.  This is a graph
      that requires two nodes to be removed before the network is
      partitioned.

   2-connected cluster:   A maximal set of nodes that are 2-connected.

   block:   Either a 2-connected cluster, a cut-edge, or a cut-vertex.



<span class="grey">Atlas, et al.                Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   Redundant Trees (RT):   A pair of trees where the path from any node
      X to the root R along the first tree is node-disjoint with the
      path from the same node X to the root along the second tree.
      Redundant trees can always be computed in 2-connected graphs.

   Maximally Redundant Trees (MRT):   A pair of trees where the path
      from any node X to the root R along the first tree and the path
      from the same node X to the root along the second tree share the
      minimum number of nodes and the minimum number of links.  Each
      such shared node is a cut-vertex.  Any shared links are cut-links.
      In graphs that are not 2-connected, it is not possible to compute
      RTs.  However, it is possible to compute MRTs.  MRTs are maximally
      redundant in the sense that they are as redundant as possible
      given the constraints of the network graph.

   Directed Acyclic Graph (DAG):   A graph where all links are directed
      and there are no cycles in it.

   Almost Directed Acyclic Graph (ADAG):   A graph with one node
      designated as the root.  The graph has the property that if all
      links incoming to the root were removed, then the resulting graph
      would be a DAG.

   Generalized ADAG (GADAG):   A graph that is the combination of the
      ADAGs of all blocks.

   MRT-Red:   MRT-Red is used to describe one of the two MRTs; it is
      used to describe the associated forwarding topology and MPLS
      Multi-Topology IDentifier (MT-ID).  Specifically, MRT-Red is the
      decreasing MRT where links in the GADAG are taken in the direction
      from a higher topologically ordered node to a lower one.

   MRT-Blue:   MRT-Blue is used to describe one of the two MRTs; it is
      used to described the associated forwarding topology and MPLS
      MT-ID.  Specifically, MRT-Blue is the increasing MRT where links
      in the GADAG are taken in the direction from a lower topologically
      ordered node to a higher one.

   Rainbow MRT:   It is useful to have an MPLS MT-ID that refers to the
      multiple MRT forwarding topologies and to the default forwarding
      topology.  This is referred to as the Rainbow MRT MPLS MT-ID and
      is used by LDP to reduce signaling and permit the same label to
      always be advertised to all peers for the same (MT-ID, Prefix).

   MRT Island:   The set of routers that support a particular MRT
      profile and the links connecting them that support MRT.





<span class="grey">Atlas, et al.                Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   Island Border Router (IBR):   A router in the MRT Island that is
      connected to a router not in the MRT Island, both of which are in
      a common area or level.

   Island Neighbor (IN):   A router that is not in the MRT Island but is
      adjacent to an IBR and in the same area/level as the IBR.

   named proxy-node:   A proxy-node can represent a destination prefix
      that can be attached to the MRT Island via at least two routers.
      It is named if there is a way that traffic can be encapsulated to
      reach specifically that proxy node; this could be because there is
      an LDP FEC (Forwarding Equivalence Class) for the associated
      prefix or because MRT-Red and MRT-Blue IP addresses are advertised
      in an undefined fashion for that proxy-node.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Maximally%20Redundant%20Trees%20%28MRT%29"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Maximally Redundant Trees (MRT)</span>

   A pair of Maximally Redundant Trees is a pair of directed spanning
   trees that provides maximally disjoint paths towards their common
   root.  Only links or nodes whose failure would partition the network
   (i.e., cut-links and cut-vertices) are shared between the trees.  The
   MRT Lowpoint algorithm is given in [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>].  This algorithm can be
   computed in O(e + n log n); it is less than three SPFs.  This
   document describes how the MRTs can be used and not how to compute
   them.

   MRT provides destination-based trees for each destination.  Each
   router stores its normal primary next hop(s) as well as MRT-Blue next
   hop(s) and MRT-Red next hop(s) toward each destination.  The
   alternate will be selected between the MRT-Blue and MRT-Red.

   The most important thing to understand about MRTs is that for each
   pair of destination-routed MRTs, there is a path from every node X to
   the destination D on the Blue MRT that is as disjoint as possible
   from the path on the Red MRT.

   For example, in Figure 1, there is a network graph that is
   2-connected in (a) and associated MRTs in (b) and (c).  One can
   consider the paths from B to R; on the Blue MRT, the paths are
   B-&gt;F-&gt;D-&gt;E-&gt;R or B-&gt;C-&gt;D-&gt;E-&gt;R.  On the Red MRT, the path is B-&gt;A-&gt;R.
   These are clearly link and node-disjoint.  These MRTs are redundant
   trees because the paths are disjoint.









<span class="grey">Atlas, et al.                Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   [E]---[D]---|           [E]&lt;--[D]&lt;--|                [E]--&gt;[D]---|
    |     |    |            |     ^    |                       |    |
    |     |    |            V     |    |                       V    V
   [R]   [F]  [C]          [R]   [F]  [C]               [R]   [F]  [C]
    |     |    |                  ^    ^                 ^     |    |
    |     |    |                  |    |                 |     V    |
   [A]---[B]---|           [A]--&gt;[B]---|                [A]&lt;--[B]&lt;--|

         (a)                     (b)                         (c)
   a 2-connected graph     Blue MRT towards R          Red MRT towards R

                      Figure 1: A 2-Connected Network

   By contrast, in Figure 2, the network in (a) is not 2-connected.  If
   C, G, or the link C&lt;-&gt;G failed, then the network would be
   partitioned.  It is clearly impossible to have two link-disjoint or
   node-disjoint paths from G, J, or H to R.  The MRTs given in (b) and
   (c) offer paths that are as disjoint as possible.  For instance, the
   paths from B to R are the same as in Figure 1 and the path from G to
   R on the Blue MRT is G-&gt;C-&gt;D-&gt;E-&gt;R and on the Red MRT is
   G-&gt;C-&gt;B-&gt;A-&gt;R.

                        [E]---[D]---|     |---[J]
                         |     |    |     |    |
                         |     |    |     |    |
                        [R]   [F]  [C]---[G]   |
                         |     |    |     |    |
                         |     |    |     |    |
                        [A]---[B]---|     |---[H]

                       (a) a graph that is not 2-connected

         [E]&lt;--[D]&lt;--|         [J]        [E]--&gt;[D]---|     |---[J]
          |     ^    |          |                |    |     |    ^
          V     |    |          |                V    V     V    |
         [R]   [F]  [C]&lt;--[G]   |         [R]   [F]  [C]&lt;--[G]   |
                ^    ^     ^    |          ^     |    |          |
                |    |     |    V          |     V    |          |
         [A]--&gt;[B]---|     |---[H]        [A]&lt;--[B]&lt;--|         [H]

          (b) Blue MRT towards R          (c) Red MRT towards R

                Figure 2: A Network That Is Not 2-Connected








<span class="grey">Atlas, et al.                Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20MRT%20and%20Fast%20Reroute"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  MRT and Fast Reroute</span>

   In normal IGP routing, each router has its Shortest Path Tree (SPT)
   to all destinations.  From the perspective of a particular
   destination, D, this looks like a reverse SPT (rSPT).  To use MRT, in
   addition, each destination D has two MRTs associated with it; by
   convention these will be called the MRT-Blue and MRT-Red.  MRT-FRR is
   realized by using multi-topology forwarding.  There is a MRT-Blue
   forwarding topology and a MRT-Red forwarding topology.

   Any IP/LDP fast-reroute technique beyond LFA requires an additional
   dataplane procedure, such as an additional forwarding mechanism.  The
   well-known options are multi-topology forwarding (used by MRT-FRR),
   tunneling (e.g., [<a href="rfc6981.html" title='"A Framework for IP and MPLS Fast Reroute Using Not-Via Addresses"'>RFC6981</a>] or [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>]), and per-interface
   forwarding (e.g., Loop-Free Failure Insensitive Routing in
   [<a href="#ref-EnyediThesis">EnyediThesis</a>]).

   When there is a link or node failure affecting, but not partitioning,
   the network, each node will still have at least one path via one of
   the MRTs to reach the destination D.  For example, in Figure 2, B
   would normally forward traffic to R across the path B-&gt;A-&gt;R.  If the
   B&lt;-&gt;A link fails, then B could use the MRT-Blue path B-&gt;F-&gt;D-&gt;E-&gt;R.

   As is always the case with fast-reroute technologies, forwarding does
   not change until a local failure is detected.  Packets are forwarded
   along the shortest path.  The appropriate alternate to use is pre-
   computed.  [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>] describes exactly how to determine whether the
   MRT-Blue next hops or the MRT-Red next hops should be the MRT
   alternate next hops for a particular primary next hop to a particular
   destination.

   MRT alternates are always available to use.  It is a local decision
   whether to use an MRT alternate, an LFA, or some other type of
   alternate.

   As described in [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>], when a worse failure than is anticipated
   happens, using LFAs that are not downstream neighbors can cause
   looping among alternates.  <a href="rfc5286.html#section-1.1">Section 1.1 of [RFC5286]</a> gives an example
   of link-protecting alternates causing a loop on node failure.  Even
   if a worse failure than anticipated happens, the use of MRT
   alternates will not cause looping.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Unicast%20Forwarding%20with%20MRT%20Fast%20Reroute"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Unicast Forwarding with MRT Fast Reroute</span>

   There are three possible types of routers involved in forwarding a
   packet along an MRT path.  At the MRT ingress router, the packet
   leaves the shortest path to the destination and follows an MRT path
   to the destination.  In an FRR application, the MRT ingress router is



<span class="grey">Atlas, et al.                Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   the PLR.  An MRT transit router takes a packet that arrives already
   associated with the particular MRT, and forwards it on that same MRT.
   In some situations (to be discussed later), the packet will need to
   leave the MRT path and return to the shortest path.  This takes place
   at the MRT egress router.  The MRT ingress and egress functionality
   may depend on the underlying type of packet being forwarded (LDP or
   IP).  The MRT transit functionality is independent of the type of
   packet being forwarded.  We first consider several MRT transit
   forwarding mechanisms.  Then, we look at how these forwarding
   mechanisms can be applied to carrying LDP and IP traffic.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Introduction%20to%20MRT%20Forwarding%20Options"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Introduction to MRT Forwarding Options</span>

   The following options for MRT forwarding mechanisms are considered.

   1.  MRT LDP Labels

       A.  Topology-scoped FEC encoded using a single label

       B.  Topology and FEC encoded using a two-label stack

   2.  MRT IP Tunnels

       A.  MRT IPv4 Tunnels

       B.  MRT IPv6 Tunnels

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.%20%20MRT%20LDP%20Labels"></a><a class="selflink" href="#section-6.1.1" name="section-6.1.1">6.1.1</a>.  MRT LDP Labels</span>

   We consider two options for the MRT forwarding mechanisms using MRT
   LDP labels.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.1.%20%20Topology-Scoped%20FEC%20Encoded%20Using%20a%20Single%20Label%20%28Option%201A%29"></a><a class="selflink" href="#section-6.1.1.1" name="section-6.1.1.1">6.1.1.1</a>.  Topology-Scoped FEC Encoded Using a Single Label (Option 1A)</span>

   [<a id="ref-RFC7307" name="ref-RFC7307">RFC7307</a>] provides a mechanism to distribute FEC-label bindings
   scoped to a given MPLS topology (represented by MPLS MT-ID).  To use
   multi-topology LDP to create MRT forwarding topologies, we associate
   two MPLS MT-IDs with the MRT-Red and MRT-Blue forwarding topologies,
   in addition to the default shortest path forwarding topology with
   MT-ID=0.

   With this forwarding mechanism, a single label is distributed for
   each topology-scoped FEC.  For a given FEC in the default topology
   (call it default-FEC-A), two additional topology-scoped FECs would be
   created, corresponding to the Red and Blue MRT forwarding topologies
   (call them red-FEC-A and blue-FEC-A).  A router supporting this MRT
   transit forwarding mechanism advertises a different FEC-label binding
   for each of the three topology-scoped FECs.  When a packet is



<span class="grey">Atlas, et al.                Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   received with a label corresponding to red-FEC-A (for example), an
   MRT transit router will determine the next hop for the MRT-Red
   forwarding topology for that FEC, swap the incoming label with the
   outgoing label corresponding to red-FEC-A learned from the MRT-Red
   next-hop router, and forward the packet.

   This forwarding mechanism has the useful property that the FEC
   associated with the packet is maintained in the labels at each hop
   along the MRT.  We will take advantage of this property when
   specifying how to carry LDP traffic on MRT paths using multi-topology
   LDP labels.

   This approach is very simple for hardware to support.  However, it
   reduces the label space for other uses, and it increases the memory
   needed to store the labels and the communication required by LDP to
   distribute FEC-label bindings.  In general, this approach will also
   increase the time needed to install the FRR entries in the Forwarding
   Information Base (FIB) and, hence, the time needed before the next
   failure can be protected.

   This forwarding option uses the LDP signaling extensions described in
   [<a href="rfc7307.html" title='"LDP Extensions for Multi-Topology"'>RFC7307</a>].  The MRT-specific LDP extensions required to support this
   option will be described elsewhere.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.2.%20%20Topology%20and%20FEC%20Encoded%20Using%20a%20Two-Label%20Stack%20%28Option%201B%29"></a><a class="selflink" href="#section-6.1.1.2" name="section-6.1.1.2">6.1.1.2</a>.  Topology and FEC Encoded Using a Two-Label Stack (Option 1B)</span>

   With this forwarding mechanism, a two-label stack is used to encode
   the topology and the FEC of the packet.  The top label (topology-id
   label) identifies the MRT forwarding topology, while the second label
   (FEC label) identifies the FEC.  The top label would be a new FEC
   type with two values corresponding to MRT Red and Blue topologies.

   When an MRT transit router receives a packet with a topology-id
   label, the router pops the top label and uses that it to guide the
   next-hop selection in combination with the next label in the stack
   (the FEC label).  The router then swaps the FEC label, using the FEC-
   label bindings learned through normal LDP mechanisms.  The router
   then pushes the topology-id label for the next hop.

   As with Option 1A, this forwarding mechanism also has the useful
   property that the FEC associated with the packet is maintained in the
   labels at each hop along the MRT.

   This forwarding mechanism has minimal usage of additional labels,
   memory and LDP communication.  It does increase the size of packets
   and the complexity of the required label operations and lookups.





<span class="grey">Atlas, et al.                Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   This forwarding option is consistent with context-specific label
   spaces, as described in [<a href="rfc5331.html" title='"MPLS Upstream Label Assignment and Context-Specific Label Space"'>RFC5331</a>].  However, the precise LDP behavior
   required to support this option for MRT has not been specified.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.3.%20%20Compatibility%20of%20MRT%20LDP%20Label%20Options%201A%20and%201B"></a><a class="selflink" href="#section-6.1.1.3" name="section-6.1.1.3">6.1.1.3</a>.  Compatibility of MRT LDP Label Options 1A and 1B</span>

   MRT transit forwarding based on MRT LDP Label options 1A and 1B can
   coexist in the same network, with a packet being forwarded along a
   single MRT path using the single label of Option 1A for some hops and
   the two-label stack of Option 1B for other hops.  However, to
   simplify the process of MRT Island formation, we require that all
   routers in the MRT Island support at least one common forwarding
   mechanism.  As an example, the Default MRT Profile requires support
   for the MRT LDP Label Option 1A forwarding mechanism.  This ensures
   that the routers in an MRT island supporting the Default MRT Profile
   will be able to establish MRT forwarding paths based on MRT LDP Label
   Option 1A.  However, an implementation supporting Option 1A may also
   support Option 1B.  If the scaling or performance characteristics for
   the two options differ in this implementation, then it may be
   desirable for a pair of adjacent routers to use Option 1B labels
   instead of the Option 1A labels.  If those routers successfully
   negotiate the use of Option 1B labels, they are free to use them.
   This can occur without any of the other routers in the MRT Island
   being made aware of it.

   Note that this document only defines the Default MRT Profile, which
   requires support for the MRT LDP Label Option 1A forwarding
   mechanism.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.4.%20%20Required%20Support%20for%20MRT%20LDP%20Label%20Options"></a><a class="selflink" href="#section-6.1.1.4" name="section-6.1.1.4">6.1.1.4</a>.  Required Support for MRT LDP Label Options</span>

   If a router supports a profile that includes the MRT LDP Label Option
   1A for the MRT transit forwarding mechanism, then it MUST support
   Option 1A, which encodes topology-scoped FECs using a single label.
   The router MAY also support Option 1B.

   If a router supports a profile that includes the MRT LDP Label Option
   1B for the MRT transit forwarding mechanism, then it MUST support
   Option 1B, which encodes the topology and FEC using a two-label
   stack.  The router MAY also support Option 1A.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.2.%20%20MRT%20IP%20Tunnels%20%28Options%202A%20and%202B%29"></a><a class="selflink" href="#section-6.1.2" name="section-6.1.2">6.1.2</a>.  MRT IP Tunnels (Options 2A and 2B)</span>

   IP tunneling can also be used as an MRT transit forwarding mechanism.
   Each router supporting this MRT transit forwarding mechanism
   announces two additional loopback addresses and their associated MRT
   color.  Those addresses are used as destination addresses for MRT-
   blue and MRT-red IP tunnels, respectively.  The special loopback



<span class="grey">Atlas, et al.                Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   addresses allow the transit nodes to identify the traffic as being
   forwarded along either the MRT-blue or MRT-red topology to reach the
   tunnel destination.  For example, an MRT ingress router can cause a
   packet to be tunneled along the MRT-red path to router X by
   encapsulating the packet using the MRT-red loopback address
   advertised by router X.  Upon receiving the packet, router X would
   remove the encapsulation header and forward the packet based on the
   original destination address.

   Either IPv4 (Option 2A) or IPv6 (Option 2B) can be used as the
   tunneling mechanism.

   Note that the two forwarding mechanisms using LDP Label options do
   not require additional loopbacks per router, as is required by the IP
   tunneling mechanism.  This is because LDP labels are used on a hop-
   by-hop basis to identify MRT-blue and MRT-red forwarding topologies.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Forwarding%20LDP%20Unicast%20Traffic%20over%20MRT%20Paths"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Forwarding LDP Unicast Traffic over MRT Paths</span>

   In the previous section, we examined several options for providing
   MRT transit forwarding functionality, which is independent of the
   type of traffic being carried.  We now look at the MRT ingress
   functionality, which will depend on the type of traffic being carried
   (IP or LDP).  We start by considering LDP traffic.

   We also simplify the initial discussion by assuming that the network
   consists of a single IGP area, and that all routers in the network
   participate in MRT.  Other deployment scenarios that require MRT
   egress functionality are considered later in this document.

   In principle, it is possible to carry LDP traffic in MRT IP tunnels.
   However, for LDP traffic, it is desirable to avoid tunneling.
   Tunneling LDP traffic to a remote node requires knowledge of remote
   FEC-label bindings so that the LDP traffic can continue to be
   forwarded properly when it leaves the tunnel.  This requires targeted
   LDP sessions, which can add management complexity.  As described
   below, the two MRT forwarding mechanisms that use LDP labels do not
   require targeted LDP sessions.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.1.%20%20Forwarding%20LDP%20Traffic%20Using%20MRT%20LDP%20Label%20Option%201A"></a><a class="selflink" href="#section-6.2.1" name="section-6.2.1">6.2.1</a>.  Forwarding LDP Traffic Using MRT LDP Label Option 1A</span>

   The MRT LDP Label Option 1A forwarding mechanism uses topology-scoped
   FECs encoded using a single label as described in <a href="#section-6.1.1.1">Section 6.1.1.1</a>.
   When a PLR receives an LDP packet that needs to be forwarded on the
   MRT-Red (for example), it does a label swap operation, replacing the
   usual LDP label for the FEC with the MRT-Red label for that FEC
   received from the next-hop router in the MRT-Red computed by the PLR.
   When the next-hop router in the MRT-Red receives the packet with the



<span class="grey">Atlas, et al.                Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   MRT-Red label for the FEC, the MRT transit forwarding functionality
   continues as described in <a href="#section-6.1.1.1">Section 6.1.1.1</a>.  In this way, the original
   FEC associated with the packet is maintained at each hop along the
   MRT.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.2.%20%20Forwarding%20LDP%20Traffic%20Using%20MRT%20LDP%20Label%20Option%201B"></a><a class="selflink" href="#section-6.2.2" name="section-6.2.2">6.2.2</a>.  Forwarding LDP Traffic Using MRT LDP Label Option 1B</span>

   The MRT LDP Label Option 1B forwarding mechanism encodes the topology
   and the FEC using a two-label stack as described in <a href="#section-6.1.1.2">Section 6.1.1.2</a>.
   When a PLR receives an LDP packet that needs to be forwarded on the
   MRT-Red, it first does a normal LDP label swap operation, replacing
   the incoming normal LDP label associated with a given FEC with the
   outgoing normal LDP label for that FEC learned from the next hop on
   the MRT-Red.  In addition, the PLR pushes the topology-id label
   associated with the MRT-Red, and forward the packet to the
   appropriate next hop on the MRT-Red.  When the next-hop router in the
   MRT-Red receives the packet with the MRT-Red label for the FEC, the
   MRT transit forwarding functionality continues as described in
   <a href="#section-6.1.1.2">Section 6.1.1.2</a>.  As with Option 1A, the original FEC associated with
   the packet is maintained at each hop along the MRT.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.3.%20%20Other%20Considerations%20for%20Forwarding%20LDP%20Traffic%20Using%20MRT%20LDP"></a><a class="selflink" href="#section-6.2.3" name="section-6.2.3">6.2.3</a>.  Other Considerations for Forwarding LDP Traffic Using MRT LDP</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Labels"></a>        Labels</span>

   Note that forwarding LDP traffic using MRT LDP Labels can be done
   without the use of targeted LDP sessions when an MRT path to the
   destination FEC is used.  The alternates selected in [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>] use
   the MRT path to the destination FEC, so targeted LDP sessions are not
   needed.  If instead one found it desirable to have the PLR use an MRT
   to reach the primary next-next-hop for the FEC, and then continue
   forwarding the LDP packet along the shortest path from the primary
   next-next-hop, this would require tunneling to the primary next-next-
   hop and a targeted LDP session for the PLR to learn the FEC-label
   binding for primary next-next-hop to correctly forward the packet.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.4.%20%20Required%20Support%20for%20LDP%20Traffic"></a><a class="selflink" href="#section-6.2.4" name="section-6.2.4">6.2.4</a>.  Required Support for LDP Traffic</span>

   For greatest hardware compatibility, routers implementing MRT fast
   reroute of LDP traffic MUST support Option 1A of encoding the MT-ID
   in the labels (See <a href="#section-9">Section 9</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Forwarding%20IP%20Unicast%20Traffic%20over%20MRT%20Paths"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Forwarding IP Unicast Traffic over MRT Paths</span>

   For IPv4 traffic, there is no currently practical alternative except
   tunneling to gain the bits needed to indicate the MRT-Blue or MRT-Red
   forwarding topology.  For IPv6 traffic, in principle, one could
   define bits in the IPv6 options header to indicate the MRT-Blue or
   MRT-Red forwarding topology.  However, in this document, we have



<span class="grey">Atlas, et al.                Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   chosen not to define a solution that would work for IPv6 traffic but
   not for IPv4 traffic.

   The choice of tunnel egress is flexible since any router closer to
   the destination than the next hop can work.  This architecture
   assumes that the original destination in the area is selected (see
   <a href="#section-11">Section 11</a> for handling of multihomed prefixes); another possible
   choice is the next-next-hop towards the destination.  As discussed in
   the previous section, for LDP traffic, using the MRT to the original
   destination simplifies MRT-FRR by avoiding the need for targeted LDP
   sessions to the next-next-hop.  For IP, that consideration doesn't
   apply.

   Some situations require tunneling IP traffic along an MRT to a tunnel
   endpoint that is not the destination of the IP traffic.  These
   situations will be discussed in detail later.  We note here that an
   IP packet with a destination in a different IGP area/level from the
   PLR should be tunneled on the MRT to the Area Border Router (ABR) or
   Level Border Router (LBR) on the shortest path to the destination.
   For a destination outside of the PLR's MRT Island, the packet should
   be tunneled on the MRT to a non-proxy-node immediately before the
   named proxy-node on that particular color MRT.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.1.%20%20Tunneling%20IP%20Traffic%20Using%20MRT%20LDP%20Labels"></a><a class="selflink" href="#section-6.3.1" name="section-6.3.1">6.3.1</a>.  Tunneling IP Traffic Using MRT LDP Labels</span>

   An IP packet can be tunneled along an MRT path by pushing the
   appropriate MRT LDP label(s).  Tunneling using LDP labels, as opposed
   to IP headers, has the advantage that more installed routers can do
   line-rate encapsulation and decapsulation using LDP than using IP.
   Also, no additional IP addresses would need to be allocated or
   signaled.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.3.1.1.%20%20Tunneling%20IP%20Traffic%20Using%20MRT%20LDP%20Label%20Option%201A"></a><a class="selflink" href="#section-6.3.1.1" name="section-6.3.1.1">6.3.1.1</a>.  Tunneling IP Traffic Using MRT LDP Label Option 1A</span>

   The MRT LDP Label Option 1A forwarding mechanism uses topology-scoped
   FECs encoded using a single label as described in <a href="#section-6.1.1.1">Section 6.1.1.1</a>.
   When a PLR receives an IP packet that needs to be forwarded on the
   MRT-Red to a particular tunnel endpoint, it does a label push
   operation.  The label pushed is the MRT-Red label for a FEC
   originated by the tunnel endpoint, learned from the next hop on the
   MRT-Red.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/6.3.1.2.%20%20Tunneling%20IP%20Traffic%20Using%20MRT%20LDP%20Label%20Option%201B"></a><a class="selflink" href="#section-6.3.1.2" name="section-6.3.1.2">6.3.1.2</a>.  Tunneling IP Traffic Using MRT LDP Label Option 1B</span>

   The MRT LDP Label Option 1B forwarding mechanism encodes the topology
   and the FEC using a two-label stack as described in <a href="#section-6.1.1.2">Section 6.1.1.2</a>.
   When a PLR receives an IP packet that needs to be forwarded on the
   MRT-Red to a particular tunnel endpoint, the PLR pushes two labels on



<span class="grey">Atlas, et al.                Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   the IP packet.  The first (inner) label is the normal LDP label
   learned from the next hop on the MRT-Red, associated with a FEC
   originated by the tunnel endpoint.  The second (outer) label is the
   topology-id label associated with the MRT-Red.

   For completeness, we note here a potential variation that uses a
   single label as opposed to two labels.  In order to tunnel an IP
   packet over an MRT to the destination of the IP packet as opposed to
   an arbitrary tunnel endpoint, one could just push a topology-id label
   directly onto the packet.  An MRT transit router would need to pop
   the topology-id label, do an IP route lookup in the context of that
   topology-id label, and push the topology-id label.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.2.%20%20Tunneling%20IP%20Traffic%20Using%20MRT%20IP%20Tunnels"></a><a class="selflink" href="#section-6.3.2" name="section-6.3.2">6.3.2</a>.  Tunneling IP Traffic Using MRT IP Tunnels</span>

   In order to tunnel over the MRT to a particular tunnel endpoint, the
   PLR encapsulates the original IP packet with an additional IP header
   using the MRT-Blue or MRT-Red loopback address of the tunnel
   endpoint.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.3.%20%20Required%20Support%20for%20IP%20Traffic"></a><a class="selflink" href="#section-6.3.3" name="section-6.3.3">6.3.3</a>.  Required Support for IP Traffic</span>

   For greatest hardware compatibility and ease in removing the MRT-
   topology marking at area/level boundaries, routers that support MPLS
   and implement IP MRT fast reroute MUST support tunneling of IP
   traffic using MRT LDP Label Option 1A (topology-scoped FEC encoded
   using a single label).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20MRT%20Island%20Formation"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  MRT Island Formation</span>

   The purpose of communicating support for MRT is to indicate that the
   MRT-Blue and MRT-Red forwarding topologies are created for transit
   traffic.  The MRT architecture allows for different, potentially
   incompatible options.  In order to create consistent MRT forwarding
   topologies, the routers participating in a particular MRT Island need
   to use the same set of options.  These options are grouped into MRT
   profiles.  In addition, the routers in an MRT Island all need to use
   the same set of nodes and links within the Island when computing the
   MRT forwarding topologies.  This section describes the information
   used by a router to determine the nodes and links to include in a
   particular MRT Island.  Some information already exists in the IGPs
   and can be used by MRT in Island formation, subject to the
   interpretation defined here.

   Other information needs to be communicated between routers for which
   there do not currently exist protocol extensions.  This new
   information needs to be shared among all routers in an IGP area, so




<span class="grey">Atlas, et al.                Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   defining extensions to existing IGPs to carry this information makes
   sense.  These new protocol extensions will be defined elsewhere.

   Deployment scenarios using multi-topology OSPF or IS-IS, or running
   both IS-IS and OSPF on the same routers is out of scope for this
   specification.  As with LFA, MRT-FRR does not support OSPF Virtual
   Links.

   At a high level, an MRT Island is defined as the set of routers
   supporting the same MRT profile, in the same IGP area/level and with
   bidirectional links interconnecting those routers.  More detailed
   descriptions of these criteria are given below.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20IGP%20Area%20or%20Level"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  IGP Area or Level</span>

   All links in an MRT Island are bidirectional and belong to the same
   IGP area or level.  For IS-IS, a link belonging to both Level-1 and
   Level-2 would qualify to be in multiple MRT Islands.  A given ABR or
   LBR can belong to multiple MRT Islands, corresponding to the areas or
   levels in which it participates.  Inter-area forwarding behavior is
   discussed in <a href="#section-10">Section 10</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Support%20for%20a%20Specific%20MRT%20Profile"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Support for a Specific MRT Profile</span>

   All routers in an MRT Island support the same MRT profile.  A router
   advertises support for a given MRT profile using an 8-bit MRT Profile
   ID value.  The "MRT Profile Identifier Registry" is defined in this
   document.  The protocol extensions for advertising the MRT Profile ID
   value will be defined in a future specification.  A given router can
   support multiple MRT profiles and participate in multiple MRT
   Islands.  The options that make up an MRT Profile, as well as the
   Default MRT Profile, are defined in <a href="#section-8">Section 8</a>.

   The process of MRT Island formation takes place independently for
   each MRT profile advertised by a given router.  For example, consider
   a network with 40 connected routers in the same area advertising
   support for MRT Profile A and MRT Profile B.  Two distinct MRT
   Islands will be formed corresponding to Profile A and Profile B, with
   each island containing all 40 routers.  A complete set of maximally
   redundant trees will be computed for each island following the rules
   defined for each profile.  If we add a third MRT Profile to this
   example, with Profile C being advertised by a connected subset of 30
   routers, there will be a third MRT Island formed corresponding to
   those 30 routers, and a third set of maximally redundant trees will
   be computed.  In this example, 40 routers would compute and install
   two sets of MRT transit forwarding entries corresponding to Profiles
   A and B, while 30 routers would compute and install three sets of MRT
   transit forwarding entries corresponding to Profiles A, B, and C.



<span class="grey">Atlas, et al.                Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Excluding%20Additional%20Routers%20and%20Interfaces%20from%20the%20MRT%20Island"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Excluding Additional Routers and Interfaces from the MRT Island</span>

   MRT takes into account existing IGP mechanisms for discouraging
   traffic from using particular links and routers, and it introduces an
   MRT-specific exclusion mechanism for links.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.1.%20%20Existing%20IGP%20Exclusion%20Mechanisms"></a><a class="selflink" href="#section-7.3.1" name="section-7.3.1">7.3.1</a>.  Existing IGP Exclusion Mechanisms</span>

   Mechanisms for discouraging traffic from using particular links
   already exist in IS-IS and OSPF.  In IS-IS, an interface configured
   with a metric of 2^24-2 (0xFFFFFE) will only be used as a last
   resort.  (An interface configured with a metric of 2^24-1 (0xFFFFFF)
   will not be advertised into the topology.)  In OSPF, an interface
   configured with a metric of 2^16-1 (0xFFFF) will only be used as a
   last resort.  These metrics can be configured manually to enforce
   administrative policy or they can be set in an automated manner as
   with LDP IGP synchronization [<a href="rfc5443.html" title='"LDP IGP Synchronization"'>RFC5443</a>].

   Mechanisms also already exist in IS-IS and OSPF to discourage or
   prevent transit traffic from using a particular router.  In IS-IS,
   the overload bit is prevents transit traffic from using a router.

   For OSPFv2 and OSPFv3, [<a href="rfc6987.html" title='"OSPF Stub Router Advertisement"'>RFC6987</a>] specifies setting all outgoing
   interface metrics to 0xFFFF to discourage transit traffic from using
   a router.  ([<a href="rfc6987.html" title='"OSPF Stub Router Advertisement"'>RFC6987</a>] defines the metric value 0xFFFF as
   MaxLinkMetric, a fixed architectural value for OSPF.)  For OSPFv3,
   [<a href="rfc5340.html" title='"OSPF for IPv6"'>RFC5340</a>] specifies that a router be excluded from the intra-area SPT
   computation if the V6-bit or R-bit of the Link State Advertisement
   (LSA) options is not set in the Router LSA.

   The following rules for MRT Island formation ensure that MRT FRR
   protection traffic does not use a link or router that is discouraged
   or prevented from carrying traffic by existing IGP mechanisms.

   1.  A bidirectional link MUST be excluded from an MRT Island if
       either the forward or reverse cost on the link is 0xFFFFFE (for
       IS-IS) or 0xFFFF for OSPF.

   2.  A router MUST be excluded from an MRT Island if it is advertised
       with the overload bit set (for IS-IS), or it is advertised with
       metric values of 0xFFFF on all of its outgoing interfaces (for
       OSPFv2 and OSPFv3).

   3.  A router MUST be excluded from an MRT Island if it is advertised
       with either the V6-bit or R-bit of the LSA options not set in the
       Router LSA.





<span class="grey">Atlas, et al.                Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/7.3.2.%20%20MRT-Specific%20Exclusion%20Mechanism"></a><a class="selflink" href="#section-7.3.2" name="section-7.3.2">7.3.2</a>.  MRT-Specific Exclusion Mechanism</span>

   This architecture also defines a means of excluding an otherwise
   usable link from MRT Islands.  The protocol extensions for
   advertising that a link is MRT-Ineligible will be defined elsewhere.
   A link with either interface advertised as MRT-Ineligible MUST be
   excluded from an MRT Island.  Note that an interface advertised as
   MRT-Ineligible by a router is ineligible with respect to all profiles
   advertised by that router.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.4.%20%20Connectivity"></a><a class="selflink" href="#section-7.4" name="section-7.4">7.4</a>.  Connectivity</span>

   All of the routers in an MRT Island MUST be connected by
   bidirectional links with other routers in the MRT Island.
   Disconnected MRT Islands will operate independently of one another.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.5.%20%20Algorithm%20for%20MRT%20Island%20Identification"></a><a class="selflink" href="#section-7.5" name="section-7.5">7.5</a>.  Algorithm for MRT Island Identification</span>

   An algorithm that allows a computing router to identify the routers
   and links in the local MRT Island satisfying the above rules is given
   in <a href="rfc7811.html#section-5.2">Section 5.2 of [RFC7811]</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20MRT%20Profile"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  MRT Profile</span>

   An MRT Profile is a set of values and options related to MRT
   behavior.  The complete set of options is designated by the
   corresponding 8-bit Profile ID value.

   This document specifies the values and options that correspond to the
   Default MRT Profile (Profile ID = 0).  Future documents may define
   other MRT Profiles by specifying the MRT Profile Options below.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20MRT%20Profile%20Options"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  MRT Profile Options</span>

   Below is a description of the values and options that define an MRT
   Profile.

   MRT Algorithm:  This identifies the particular algorithm for
      computing maximally redundant trees used by the router for this
      profile.

   MRT-Red MT-ID:  This specifies the MPLS MT-ID to be associated with
      the MRT-Red forwarding topology.  It is allocated from the MPLS
      Multi-Topology Identifiers Registry.

   MRT-Blue MT-ID:  This specifies the MPLS MT-ID to be associated with
      the MRT-Blue forwarding topology.  It is allocated from the MPLS
      Multi-Topology Identifiers Registry.



<span class="grey">Atlas, et al.                Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   GADAG Root Selection Policy:  This specifies the manner in which the
      GADAG root is selected.  All routers in the MRT Island need to use
      the same GADAG root in the calculations used construct the MRTs.
      A valid GADAG Root Selection Policy MUST be such that each router
      in the MRT Island chooses the same GADAG root based on information
      available to all routers in the MRT Island.  GADAG Root Selection
      Priority values, advertised as router-specific MRT parameters, MAY
      be used in a GADAG Root Selection Policy.

   MRT Forwarding Mechanism:  This specifies which forwarding mechanism
      the router uses to carry transit traffic along MRT paths.  A
      router that supports a specific MRT forwarding mechanism must
      program appropriate next hops into the forwarding plane.  The
      current options are MRT LDP Label Option 1A, MRT LDP Label Option
      1B, IPv4 Tunneling, IPv6 Tunneling, and None.  If IPv4 is
      supported, then both MRT-Red and MRT-Blue IPv4 loopback addresses
      SHOULD be specified.  If IPv6 is supported, both MRT-Red and MRT-
      Blue IPv6 loopback addresses SHOULD be specified.

   Recalculation:  Recalculation specifies the process and timing by
      which new MRTs are computed after the topology has been modified.

   Area/Level Border Behavior:  This specifies how traffic traveling on
      the MRT-Blue or MRT-Red in one area should be treated when it
      passes into another area.

   Other Profile-Specific Behavior:  Depending upon the use-case for the
      profile, there may be additional profile-specific behavior.

   When a new MRT Profile is defined, new and unique values should be
   allocated from the "MPLS Multi-Topology Identifiers Registry",
   corresponding to the MRT-Red and MRT-Blue MT-ID values for the new
   MRT Profile.

   If a router advertises support for multiple MRT profiles, then it
   MUST create the transit forwarding topologies for each of those,
   unless the profile specifies the None option for the MRT Forwarding
   Mechanism.

   The ability of MRT-FRR to support transit forwarding entries for
   multiple profiles can be used to facilitate a smooth transition from
   an existing deployed MRT Profile to a new MRT Profile.  The new
   profile can be activated in parallel with the existing profile,
   installing the transit forwarding entries for the new profile without
   affecting the transit forwarding entries for the existing profile.
   Once the new transit forwarding state has been verified, the router
   can be configured to use the alternates computed by the new profile
   in the event of a failure.



<span class="grey">Atlas, et al.                Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Router-Specific%20MRT%20Parameters"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Router-Specific MRT Parameters</span>

   For some profiles, additional router-specific MRT parameters may need
   to be advertised.  While the set of options indicated by the MRT
   Profile ID must be identical for all routers in an MRT Island, these
   router-specific MRT parameters may differ between routers in the same
   MRT Island.  Several such parameters are described below.

   GADAG Root Selection Priority:   A GADAG Root Selection Policy MAY
      rely on the GADAG Root Selection Priority values advertised by
      each router in the MRT Island.  A GADAG Root Selection Policy may
      use the GADAG Root Selection Priority to allow network operators
      to configure a parameter to ensure that the GADAG root is selected
      from a particular subset of routers.  An example of this use of
      the GADAG Root Selection Priority value by the GADAG Root
      Selection Policy is given in the Default MRT Profile below.

   MRT-Red Loopback Address:   This provides the router's loopback
      address to reach the router via the MRT-Red forwarding topology.
      It can be specified for either IPv4 or IPv6.  Note that this
      parameter is not needed to support the Default MRT Profile.

   MRT-Blue Loopback Address:   This provides the router's loopback
      address to reach the router via the MRT-Blue forwarding topology.
      It can be specified for either IPv4 and IPv6.  Note that this
      parameter is not needed to support the Default MRT Profile.

   Protocol extensions for advertising a router's GADAG Root Selection
   Priority value will be defined in other documents.  Protocol
   extensions for the advertising a router's MRT-Red and MRT-Blue
   loopback addresses will be defined elsewhere.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Default%20MRT%20Profile"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Default MRT Profile</span>

   The following set of options defines the Default MRT Profile.  The
   Default MRT Profile is indicated by the MRT Profile ID value of 0.

   MRT Algorithm:   MRT Lowpoint algorithm defined in [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>].

   MRT-Red MPLS MT-ID:   This temporary registration has been allocated
      from the "MPLS Multi-Topology Identifiers" registry.  The
      registration request appears in [<a href="#ref-LDP-MRT" title='"LDP Extensions to Support Maximally Redundant Trees"'>LDP-MRT</a>].

   MRT-Blue MPLS MT-ID:   This temporary registration has been allocated
      from the "MPLS Multi-Topology Identifiers" registry.  The
      registration request appears in [<a href="#ref-LDP-MRT" title='"LDP Extensions to Support Maximally Redundant Trees"'>LDP-MRT</a>].





<span class="grey">Atlas, et al.                Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   GADAG Root Selection Policy:   Among the routers in the MRT Island
      with the lowest numerical value advertised for GADAG Root
      Selection Priority, an implementation MUST pick the router with
      the highest Router ID to be the GADAG root.  Note that a lower
      numerical value for GADAG Root Selection Priority indicates a
      higher preference for selection.

   Forwarding Mechanisms:   MRT LDP Label Option 1A

   Recalculation:   Recalculation of MRTs SHOULD occur as described in
      <a href="#section-12.2">Section 12.2</a>.  This allows the MRT forwarding topologies to
      support IP/LDP fast-reroute traffic.

   Area/Level Border Behavior:   As described in <a href="#section-10">Section 10</a>, ABRs/LBRs
      SHOULD ensure that traffic leaving the area also exits the MRT-Red
      or MRT-Blue forwarding topology.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20LDP%20Signaling%20Extensions%20and%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  LDP Signaling Extensions and Considerations</span>

   The protocol extensions for LDP will be defined in another document.
   A router must indicate that it has the ability to support MRT; having
   this explicit allows the use of MRT-specific processing, such as
   special handling of FECs sent with the Rainbow MRT MT-ID.

   A FEC sent with the Rainbow MRT MT-ID indicates that the FEC applies
   to all the MRT-Blue and MRT-Red MT-IDs in supported MRT profiles.
   The FEC-label bindings for the default shortest-path-based MT-ID 0
   MUST still be sent (even though it could be inferred from the Rainbow
   FEC-label bindings) to ensure continuous operation of normal LDP
   forwarding.  The Rainbow MRT MT-ID is defined to provide an easy way
   to handle the special signaling that is needed at ABRs or LBRs.  It
   avoids the problem of needing to signal different MPLS labels to
   different LDP neighbors for the same FEC.  Because the Rainbow MRT
   MT-ID is used only by ABRs/LBRs or an LDP egress router, it is not
   MRT profile specific.

   The value of the Rainbow MRT MPLS MT-ID has been temporarily
   allocated from the "MPLS Multi-Topology Identifiers" registry.  The
   registration request appears in [<a href="#ref-LDP-MRT" title='"LDP Extensions to Support Maximally Redundant Trees"'>LDP-MRT</a>].












<span class="grey">Atlas, et al.                Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Inter-area%20Forwarding%20Behavior"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Inter-area Forwarding Behavior</span>

   An ABR/LBR has two forwarding roles.  First, it forwards traffic
   within areas.  Second, it forwards traffic from one area into
   another.  These same two roles apply for MRT transit traffic.
   Traffic on MRT-Red or MRT-Blue destined inside the area needs to stay
   on MRT-Red or MRT-Blue in that area.  However, it is desirable for
   traffic leaving the area to also exit MRT-Red or MRT-Blue and return
   to shortest path forwarding.

   For unicast MRT-FRR, the need to stay on an MRT forwarding topology
   terminates at the ABR/LBR whose best route is via a different area/
   level.  It is highly desirable to go back to the default forwarding
   topology when leaving an area/level.  There are three basic reasons
   for this.  First, the default topology uses shortest paths; the
   packet will thus take the shortest possible route to the destination.
   Second, this allows a single router failure that manifests itself in
   multiple areas (as would be the case with an ABR/LBR failure) to be
   separately identified and repaired around.  Third, the packet can be
   fast-rerouted again, if necessary, due to a second distinct failure
   in a different area.

   In OSPF, an ABR that receives a packet on MRT-Red or MRT-Blue towards
   destination Z should continue to forward the packet along MRT-Red or
   MRT-Blue only if the best route to Z is in the same OSPF area as the
   interface that the packet was received on.  Otherwise, the packet
   should be removed from MRT-Red or MRT-Blue and forwarded on the
   shortest-path default forwarding topology.

   The above description applies to OSPF.  The same essential behavior
   also applies to IS-IS if one substitutes IS-IS level for OSPF area.
   However, the analogy with OSPF is not exact.  An interface in OSPF
   can only be in one area, whereas an interface in IS-IS can be in both
   Level-1 and Level-2.  Therefore, to avoid confusion and address this
   difference, we explicitly describe the behavior for IS-IS in
   <a href="#appendix-A">Appendix A</a>.  In the following sections, only the OSPF terminology is
   used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20ABR%20Forwarding%20Behavior%20with%20MRT%20LDP%20Label%20Option%201A"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  ABR Forwarding Behavior with MRT LDP Label Option 1A</span>

   For LDP forwarding where a single label specifies (MT-ID, FEC), the
   ABR is responsible for advertising the proper label to each neighbor.
   Assume that an ABR has allocated three labels for a particular
   destination: L_primary, L_blue, and L_red.  To those routers in the
   same area as the best route to the destination, the ABR advertises
   the following FEC-label bindings: L_primary for the default topology,
   L_blue for the MRT-Blue MT-ID, and L_red for the MRT-Red MT-ID, as
   expected.  However, to routers in other areas, the ABR advertises the



<span class="grey">Atlas, et al.                Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   following FEC-label bindings: L_primary for the default topology and
   L_primary for the Rainbow MRT MT-ID.  Associating L_primary with the
   Rainbow MRT MT-ID causes the receiving routers to use L_primary for
   the MRT-Blue MT-ID and for the MRT-Red MT-ID.

   The ABR installs all next hops for the best area: primary next hops
   for L_primary, MRT-Blue next hops for L_blue, and MRT-Red next hops
   for L_red.  Because the ABR advertised (Rainbow MRT MT-ID, FEC) with
   L_primary to neighbors not in the best area, packets from those
   neighbors will arrive at the ABR with a label L_primary and will be
   forwarded into the best area along the default topology.  By
   controlling what labels are advertised, the ABR can thus enforce that
   packets exiting the area do so on the shortest-path default topology.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.1.1.%20%20Motivation%20for%20Creating%20the%20Rainbow-FEC"></a><a class="selflink" href="#section-10.1.1" name="section-10.1.1">10.1.1</a>.  Motivation for Creating the Rainbow-FEC</span>

   The desired forwarding behavior could be achieved in the above
   example without using the Rainbow-FEC.  This could be done by having
   the ABR advertise the following FEC-label bindings to neighbors not
   in the best area: L1_primary for the default topology, L1_primary for
   the MRT-Blue MT-ID, and L1_primary for the MRT-Red MT-ID.  Doing this
   would require machinery to spoof the labels used in FEC-label binding
   advertisements on a per-neighbor basis.  Such label-spoofing
   machinery does not currently exist in most LDP implementations and
   doesn't have other obvious uses.

   Many existing LDP implementations do however have the ability to
   filter FEC-label binding advertisements on a per-neighbor basis.  The
   Rainbow-FEC allows us to reuse the existing per-neighbor FEC
   filtering machinery to achieve the desired result.  By introducing
   the Rainbow FEC, we can use per-neighbor FEC-filtering machinery to
   advertise the FEC-label binding for the Rainbow-FEC (and filter those
   for MRT-Blue and MRT-Red) to non-best-area neighbors of the ABR.

   An ABR may choose to either distribute the Rainbow-FEC or distribute
   separate MRT-Blue and MRT-Red advertisements.  This is a local
   choice.  A router that supports the MRT LDP Label Option 1A
   forwarding mechanism MUST be able to receive and correctly interpret
   the Rainbow-FEC.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20ABR%20Forwarding%20Behavior%20with%20IP%20Tunneling%20%28Option%202%29"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  ABR Forwarding Behavior with IP Tunneling (Option 2)</span>

   If IP tunneling is used, then the ABR behavior is dependent upon the
   outermost IP address.  If the outermost IP address is an MRT loopback
   address of the ABR, then the packet is decapsulated and forwarded
   based upon the inner IP address, which should go on the default SPT
   topology.  If the outermost IP address is not an MRT loopback address
   of the ABR, then the packet is simply forwarded along the associated



<span class="grey">Atlas, et al.                Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   forwarding topology.  A PLR sending traffic to a destination outside
   its local area/level will pick the MRT and use the associated MRT
   loopback address of the selected ABR advertising the lowest cost to
   the external destination.

   Thus, for these two MRT forwarding mechanisms (MRT LDP Label Option
   1A and IP tunneling Option 2), there is no need for additional
   computation or per-area forwarding state.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.3.%20%20ABR%20Forwarding%20Behavior%20with%20MRT%20LDP%20Label%20Option%201B"></a><a class="selflink" href="#section-10.3" name="section-10.3">10.3</a>.  ABR Forwarding Behavior with MRT LDP Label Option 1B</span>

   The other MRT forwarding mechanism described in <a href="#section-6">Section 6</a> uses two
   labels: a topology-id label and a FEC-label.  This mechanism would
   require that any router whose MRT-Red or MRT-Blue next hop is an ABR
   would need to determine whether the ABR would forward the packet out
   of the area/level.  If so, then that router should pop off the
   topology-id label before forwarding the packet to the ABR.

   For example, in Figure 3, if node H fails, node E has to put traffic
   towards prefix p onto MRT-Red.  But since node D knows that ABR1 will
   use a best route from another area, it is safe for D to pop the
   topology-id label and just forward the packet to ABR1 along the MRT-
   Red next hop.  ABR1 will use the shortest path in Area 10.

   In all cases for IS-IS and most cases for OSPF, the penultimate
   router can determine what decision the adjacent ABR will make.  The
   one case where it can't be determined is when two ASBRs are in
   different non-backbone areas attached to the same ABR, then the
   ASBR's Area ID may be needed for tie-breaking (prefer the route with
   the largest OSPF area ID), and the Area ID isn't announced as part of
   the ASBR LSA.  In this one case, suboptimal forwarding along the MRT
   in the other area would happen.  If that becomes a realistic
   deployment scenario, protocol extensions could be developed to
   address this issue.

















<span class="grey">Atlas, et al.                Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


       +----[C]----     --[D]--[E]                --[D]--[E]
       |           \   /         \               /         \
   p--[A] Area 10 [ABR1]  Area 0 [H]--p   +-[ABR1]  Area 0 [H]-+
       |           /   \         /        |      \         /   |
       +----[B]----     --[F]--[G]        |       --[F]--[G]   |
                                          |                    |
                                          | other              |
                                          +----------[p]-------+
                                            area

         (a) Example topology        (b) Proxy node view in Area 0 nodes


                   +----[C]&lt;---       [D]-&gt;[E]
                   V           \             \
                +-[A] Area 10 [ABR1]  Area 0 [H]-+
                |  ^           /             /   |
                |  +----[B]&lt;---       [F]-&gt;[G]   V
                |                                |
                +-------------&gt;[p]&lt;--------------+

                  (c) rSPT towards destination p



             -&gt;[D]-&gt;[E]                         -&lt;[D]&lt;-[E]
            /          \                       /         \
       [ABR1]  Area 0 [H]-+             +-[ABR1]         [H]
                      /   |             |      \
               [F]-&gt;[G]   V             V       -&lt;[F]&lt;-[G]
                          |             |
                          |             |
                [p]&lt;------+             +---------&gt;[p]

     (d) MRT-Blue in Area 0           (e) MRT-Red in Area 0

                Figure 3: ABR Forwarding Behavior and MRTs

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Prefixes%20Multiply%20Attached%20to%20the%20MRT%20Island"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Prefixes Multiply Attached to the MRT Island</span>

   How a computing router S determines its local MRT Island for each
   supported MRT profile is already discussed in <a href="#section-7">Section 7</a>.

   There are two types of prefixes or FECs that may be multiply attached
   to an MRT Island.  The first type are multihomed prefixes that
   usually connect at a domain or protocol boundary.  The second type
   represent routers that do not support the profile for the MRT Island.




<span class="grey">Atlas, et al.                Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   The key difference is whether the traffic, once out of the MRT
   Island, might re-enter the MRT Island if a loop-free exit point is
   not selected.

   FRR using LFA has the useful property that it is able to protect
   multihomed prefixes against ABR failure.  For instance, if a prefix
   from the backbone is available via both ABR A and ABR B, if A fails,
   then the traffic should be redirected to B.  This can be accomplished
   with MRT FRR as well.

   If ASBR protection is desired, this has additional complexities if
   the ASBRs are in different areas.  Similarly, protecting labeled BGP
   traffic in the event of an ASBR failure has additional complexities
   due to the per-ASBR label spaces involved.

   As discussed in [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>], a multihomed prefix could be:

   o  An out-of-area prefix announced by more than one ABR,

   o  An AS-External route announced by two or more ASBRs,

   o  A prefix with iBGP multipath to different ASBRs,

   o  etc.

   See <a href="#appendix-B">Appendix B</a> for a discussion of a general issue with multihomed
   prefixes connected in two different areas.

   There are also two different approaches to protection.  The first is
   tunnel endpoint selection where the PLR picks a router to tunnel to
   where that router is loop-free with respect to the failure-point.
   Conceptually, the set of candidate routers to provide LFAs expands to
   all routers that can be reached via an MRT alternate, attached to the
   prefix.

   The second is to use a proxy-node, which can be named via MPLS label
   or IP address, and pick the appropriate label or IP address to reach
   it on either MRT-Blue or MRT-Red as appropriate to avoid the failure
   point.  A proxy-node can represent a destination prefix that can be
   attached to the MRT Island via at least two routers.  It is termed a
   named proxy-node if there is a way that traffic can be encapsulated
   to reach specifically that proxy-node; this could be because there is
   an LDP FEC for the associated prefix or because MRT-Red and MRT-Blue
   IP addresses are advertised (in an as-yet undefined fashion) for that
   proxy-node.  Traffic to a named proxy-node may take a different path
   than traffic to the attaching router; traffic is also explicitly
   forwarded from the attaching router along a predetermined interface
   towards the relevant prefixes.



<span class="grey">Atlas, et al.                Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   For IP traffic, multihomed prefixes can use tunnel endpoint
   selection.  For IP traffic that is destined to a router outside the
   MRT Island, if that router is the egress for a FEC advertised into
   the MRT Island, then the named proxy-node approach can be used.

   For LDP traffic, there is always a FEC advertised into the MRT
   Island.  The named proxy-node approach should be used, unless the
   computing router S knows the label for the FEC at the selected tunnel
   endpoint.

   If a FEC is advertised from outside the MRT Island into the MRT
   Island and the forwarding mechanism specified in the profile includes
   LDP Label Option 1A, then the routers learning that FEC MUST also
   advertise labels for (MRT-Red, FEC) and (MRT-Blue, FEC) to neighbors
   inside the MRT Island.  Any router receiving a FEC corresponding to a
   router outside the MRT Island or to a multihomed prefix MUST compute
   and install the transit MRT-Blue and MRT-Red next hops for that FEC.
   The FEC-label bindings for the topology-scoped FECs ((MT-ID 0, FEC),
   (MRT-Red, FEC), and (MRT-Blue, FEC)) MUST also be provided via LDP to
   neighbors inside the MRT Island.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Protecting%20Multihomed%20Prefixes%20Using%20Tunnel%20Endpoint%20Selection"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Protecting Multihomed Prefixes Using Tunnel Endpoint Selection</span>

   Tunnel endpoint selection is a local matter for a router in the MRT
   Island since it pertains to selecting and using an alternate and does
   not affect the transit MRT-Red and MRT-Blue forwarding topologies.

   Let the computing router be S and the next hop F be the node whose
   failure is to be avoided.  Let the destination be prefix p.  Have A
   be the router to which the prefix p is attached for S's shortest path
   to p.

   The candidates for tunnel endpoint selection are those to which the
   destination prefix is attached in the area/level.  For a particular
   candidate B, it is necessary to determine if B is loop-free to reach
   p with respect to S and F for node-protection or at least with
   respect to S and the link (S, F) for link-protection.  If B will
   always prefer to send traffic to p via a different area/level, then
   this is definitional.  Otherwise, distance-based computations are
   necessary and an SPF from B's perspective may be necessary.  The
   following equations give the checks needed; the rationale is similar
   to that given in [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>].  In the inequalities below, D_opt(X,Y)
   means the shortest distance from node X to node Y, and D_opt(X,p)
   means the shortest distance from node X to prefix p.

   Loop-Free for S: D_opt(B, p) &lt; D_opt(B, S) + D_opt(S, p)

   Loop-Free for F: D_opt(B, p) &lt; D_opt(B, F) + D_opt(F, p)



<span class="grey">Atlas, et al.                Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   The latter is equivalent to the following, which avoids the need to
   compute the shortest path from F to p.

  Loop-Free for F: D_opt(B, p) &lt; D_opt(B, F) + D_opt(S, p) - D_opt(S, F)

   Finally, the rules for Endpoint selection are given below.  The basic
   idea is to repair to the prefix-advertising router selected for the
   shortest-path and only to select and tunnel to a different endpoint
   if necessary (e.g., A=F or F is a cut-vertex or the link (S,F) is a
   cut-link).

   1.  Does S have a node-protecting alternate to A?  If so, select
       that.  Tunnel the packet to A along that alternate.  For example,
       if LDP is the forwarding mechanism, then push the label (MRT-Red,
       A) or (MRT-Blue, A) onto the packet.

   2.  If not, then is there a router B that is loop-free to reach p
       while avoiding both F and S?  If so, select B as the endpoint.
       Determine the MRT alternate to reach B while avoiding F.  Tunnel
       the packet to B along that alternate.  For example, with LDP,
       push the label (MRT-Red, B) or (MRT-Blue, B) onto the packet.

   3.  If not, then does S have a link-protecting alternate to A?  If
       so, select that.

   4.  If not, then is there a router B that is loop-free to reach p
       while avoiding S and the link from S to F?  If so, select B as
       the endpoint and the MRT alternate for reaching B from S that
       avoid the link (S,F).

   The tunnel endpoint selected will receive a packet destined to itself
   and, being the egress, will pop that MPLS label (or have signaled
   Implicit Null) and forward based on what is underneath.  This
   suffices for IP traffic since the tunnel endpoint can use the IP
   header of the original packet to continue forwarding the packet.
   However, tunneling of LDP traffic requires targeted LDP sessions for
   learning the FEC-label binding at the tunnel endpoint.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Protecting%20Multihomed%20Prefixes%20Using%20Named%20Proxy-Nodes"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Protecting Multihomed Prefixes Using Named Proxy-Nodes</span>

   Instead, the named proxy-node method works with LDP traffic without
   the need for targeted LDP sessions.  It also has a clear advantage
   over tunnel endpoint selection, in that it is possible to explicitly
   forward from the MRT Island along an interface to a loop-free island
   neighbor when that interface may not be a primary next hop.






<span class="grey">Atlas, et al.                Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   A named proxy-node represents one or more destinations and, for LDP
   forwarding, has a FEC associated with it that is signaled into the
   MRT Island.  Therefore, it is possible to explicitly label packets to
   go to (MRT-Red, FEC) or (MRT-Blue, FEC); at the border of the MRT
   Island, the label will swap to meaning (MT-ID 0, FEC).  It would be
   possible to have named proxy-nodes for IP forwarding, but this would
   require extensions to signal two IP addresses to be associated with
   MRT-Red and MRT-Blue for the proxy-node.  A named proxy-node can be
   uniquely represented by the two routers in the MRT Island to which it
   is connected.  The extensions to signal such IP addresses will be
   defined elsewhere.  The details of what label-bindings must be
   originated will be described in another document.

   Computing the MRT next hops to a named proxy-node and the MRT
   alternate for the computing router S to avoid a particular failure
   node F is straightforward.  The details of the simple constant-time
   functions, Select_Proxy_Node_NHs() and
   Select_Alternates_Proxy_Node(), are given in [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>].  A key point
   is that computing these MRT next hops and alternates can be done as
   new named proxy-nodes are added or removed without requiring a new
   MRT computation or impacting other existing MRT paths.  This maps
   very well to, for example, how OSPFv2 (see <a href="rfc2328.html#section-16.5">[RFC2328], Section 16.5</a>)
   does incremental updates for new summary-LSAs.

   The remaining question is how to attach the named proxy-node to the
   MRT Island; all the routers in the MRT Island MUST do this
   consistently.  No more than two routers in the MRT Island can be
   selected; one should only be selected if there are no others that
   meet the necessary criteria.  The named proxy-node is logically part
   of the area/level.

   There are two sources for candidate routers in the MRT Island to
   connect to the named proxy-node.  The first set is made up of those
   routers in the MRT Island that are advertising the prefix; the named-
   proxy-cost assigned to each prefix-advertising router is the
   announced cost to the prefix.  The second set is made up of those
   routers in the MRT Island that are connected to routers not in the
   MRT Island but in the same area/level; such routers will be defined
   as Island Border Routers (IBRs).  The routers connected to the IBRs
   that are not in the MRT Island and are in the same area/level as the
   MRT Island are Island Neighbors (INs).

   Since packets sent to the named proxy-node along MRT-Red or MRT-Blue
   may come from any router inside the MRT Island, it is necessary that
   whatever router to which an IBR forwards the packet be loop-free with
   respect to the whole MRT Island for the destination.  Thus, an IBR is
   a candidate router only if it possesses at least one IN whose
   shortest path to the prefix does not enter the MRT Island.  A method



<span class="grey">Atlas, et al.                Standards Track                   [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   for identifying Loop-Free Island Neighbors (LFINs) is given in
   [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>].  The named-proxy-cost assigned to each (IBR, IN) pair is
   cost(IBR, IN) + D_opt(IN, prefix).

   From the set of prefix-advertising routers and the set of IBRs with
   at least one LFIN, the two routers with the lowest named-proxy-cost
   are selected.  Ties are broken based upon the lowest Router ID.  For
   ease of discussion, the two selected routers will be referred to as
   proxy-node attachment routers.

   A proxy-node attachment router has a special forwarding role.  When a
   packet is received destined to (MRT-Red, prefix) or (MRT-Blue,
   prefix), if the proxy-node attachment router is an IBR, it MUST swap
   to the shortest path forwarding topology (e.g., swap to the label for
   (MT-ID 0, prefix) or remove the outer IP encapsulation) and forward
   the packet to the IN whose cost was used in the selection.  If the
   proxy-node attachment router is not an IBR, then the packet MUST be
   removed from the MRT forwarding topology and sent along the
   interface(s) that caused the router to advertise the prefix; this
   interface might be out of the area/level/AS.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.3.%20%20MRT%20Alternates%20for%20Destinations%20outside%20the%20MRT%20Island"></a><a class="selflink" href="#section-11.3" name="section-11.3">11.3</a>.  MRT Alternates for Destinations outside the MRT Island</span>

   A natural concern with new functionality is how to have it be useful
   when it is not deployed across an entire IGP area.  In the case of
   MRT FRR, where it provides alternates when appropriate LFAs aren't
   available, there are also deployment scenarios where it may make
   sense to only enable some routers in an area with MRT FRR.  A simple
   example of such a scenario would be a ring of six or more routers
   that is connected via two routers to the rest of the area.

   Destinations inside the local island can obviously use MRT
   alternates.  Destinations outside the local island can be treated
   like a multihomed prefix and either endpoint selection or Named
   Proxy-Nodes can be used.  Named proxy-nodes MUST be supported when
   LDP forwarding is supported and a label-binding for the destination
   is sent to an IBR.

   Naturally, there are more-complicated options to improve coverage,
   such as connecting multiple MRT Islands across tunnels, but the need
   for the additional complexity has not been justified.










<span class="grey">Atlas, et al.                Standards Track                   [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Network%20Convergence%20and%20Preparing%20for%20the%20Next%20Failure"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Network Convergence and Preparing for the Next Failure</span>

   After a failure, MRT detours ensure that packets reach their intended
   destination while the IGP has not reconverged onto the new topology.
   As link-state updates reach the routers, the IGP process calculates
   the new shortest paths.  Two things need attention: micro-loop
   prevention and MRT recalculation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20Micro-loop%20Prevention%20and%20MRTs"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  Micro-loop Prevention and MRTs</span>

   A micro-loop is a transient packet-forwarding loop among two or more
   routers that can occur during convergence of IGP forwarding state.
   [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>] discusses several techniques for preventing micro-loops.
   This section discusses how MRT-FRR relates to two of the micro-loop
   prevention techniques discussed in [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>]: Nearside and Farside
   Tunneling.

   In Nearside Tunneling, a router (PLR) adjacent to a failure performs
   local repair and informs remote routers of the failure.  The remote
   routers initially tunnel affected traffic to the nearest PLR, using
   tunnels that are unaffected by the failure.  Once the forwarding
   state for normal shortest path routing has converged, the remote
   routers return the traffic to shortest path forwarding.  MRT-FRR is
   relevant for Nearside Tunneling for the following reason.  The
   process of tunneling traffic to the PLRs and waiting a sufficient
   amount of time for IGP forwarding state convergence with Nearside
   Tunneling means that traffic will generally rely on the local repair
   at the PLR for longer than it would in the absence of Nearside
   Tunneling.  Since MRT-FRR provides 100% coverage for single link and
   node failure, it may be an attractive option to provide the local
   repair paths when Nearside Tunneling is deployed.

   MRT-FRR is also relevant for the Farside Tunneling micro-loop
   prevention technique.  In Farside Tunneling, remote routers tunnel
   traffic affected by a failure to a node downstream of the failure
   with respect to traffic destination.  This node can be viewed as
   being on the farside of the failure with respect to the node
   initiating the tunnel.  Note that the discussion of Farside Tunneling
   in [<a href="rfc5715.html" title='"A Framework for Loop-Free Convergence"'>RFC5715</a>] focuses on the case where the farside node is
   immediately adjacent to a failed link or node.  However, the farside
   node may be any node downstream of the failure with respect to
   traffic destination, including the destination itself.  The tunneling
   mechanism used to reach the farside node must be unaffected by the
   failure.  The alternative forwarding paths created by MRT-FRR have
   the potential to be used to forward traffic from the remote routers
   upstream of the failure all the way to the destination.  In the event
   of failure, either the MRT-Red or MRT-Blue path from the remote
   upstream router to the destination is guaranteed to avoid a link



<span class="grey">Atlas, et al.                Standards Track                   [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   failure or inferred node failure.  The MRT forwarding paths are also
   guaranteed to not be subject to micro-loops because they are locked
   to the topology before the failure.

   We note that the computations in [<a href="rfc7811.html" title='"An Algorithm for Computing IP/LDP Fast Reroute Using Maximally Redundant Trees (MRT-FRR)"'>RFC7811</a>] address the case of a PLR
   adjacent to a failure determining which choice of MRT-Red or MRT-Blue
   will avoid a failed link or node.  More computation may be required
   for an arbitrary remote upstream router to determine whether to
   choose MRT-Red or MRT-Blue for a given destination and failure.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20MRT%20Recalculation%20for%20the%20Default%20MRT%20Profile"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  MRT Recalculation for the Default MRT Profile</span>

   This section describes how the MRT recalculation SHOULD be performed
   for the Default MRT Profile.  This is intended to support FRR
   applications.  Other approaches are possible, but they are not
   specified in this document.

   When a failure event happens, traffic is put by the PLRs onto the MRT
   topologies.  After that, each router recomputes its SPT and moves
   traffic over to that.  Only after all the PLRs have switched to using
   their SPTs and traffic has drained from the MRT topologies should
   each router install the recomputed MRTs into the FIBs.

   At each router, therefore, the sequence is as follows:

   1.  Receive failure notification

   2.  Recompute SPT.

   3.  Install the new SPT in the FIB.

   4.  If the network was stable before the failure occurred, wait a
       configured (or advertised) period for all routers to be using
       their SPTs and traffic to drain from the MRTs.

   5.  Recompute MRTs.

   6.  Install new MRTs in the FIB.

   While the recomputed MRTs are not installed in the FIB, protection
   coverage is lowered.  Therefore, it is important to recalculate the
   MRTs and install them quickly.

   New protocol extensions for advertising the time needed to recompute
   shortest path routes and install them in the FIB will be defined
   elsewhere.





<span class="grey">Atlas, et al.                Standards Track                   [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Operational%20Considerations"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Operational Considerations</span>

   The following aspects of MRT-FRR are useful to consider when
   deploying the technology in different operational environments and
   network topologies.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.1.%20%20Verifying%20Forwarding%20on%20MRT%20Paths"></a><a class="selflink" href="#section-13.1" name="section-13.1">13.1</a>.  Verifying Forwarding on MRT Paths</span>

   The forwarding paths created by MRT-FRR are not used by normal (non-
   FRR) traffic.  They are only used to carry FRR traffic for a short
   period of time after a failure has been detected.  It is RECOMMENDED
   that an operator proactively monitor the MRT forwarding paths in
   order to be certain that the paths will be able to carry FRR traffic
   when needed.  Therefore, an implementation SHOULD provide an operator
   with the ability to test MRT paths with Operations, Administration,
   and Maintenance (OAM) traffic.  For example, when MRT paths are
   realized using LDP labels distributed for topology-scoped FECs, an
   implementation can use the MPLS ping and traceroute as defined in
   [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] and extended in [<a href="rfc7307.html" title='"LDP Extensions for Multi-Topology"'>RFC7307</a>] for topology-scoped FECs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.2.%20%20Traffic%20Capacity%20on%20Backup%20Paths"></a><a class="selflink" href="#section-13.2" name="section-13.2">13.2</a>.  Traffic Capacity on Backup Paths</span>

   During a fast-reroute event initiated by a PLR in response to a
   network failure, the flow of traffic in the network will generally
   not be identical to the flow of traffic after the IGP forwarding
   state has converged, taking the failure into account.  Therefore,
   even if a network has been engineered to have enough capacity on the
   appropriate links to carry all traffic after the IGP has converged
   after the failure, the network may still not have enough capacity on
   the appropriate links to carry the flow of traffic during a fast-
   reroute event.  This can result in more traffic loss during the fast-
   reroute event than might otherwise be expected.

   Note that there are two somewhat distinct aspects to this phenomenon.
   The first is that the path from the PLR to the destination during the
   fast-reroute event may be different from the path after the IGP
   converges.  In this case, any traffic for the destination that
   reaches the PLR during the fast-reroute event will follow a different
   path from the PLR to the destination than will be followed after IGP
   convergence.

   The second aspect is that the amount of traffic arriving at the PLR
   for affected destinations during the fast-reroute event may be larger
   than the amount of traffic arriving at the PLR for affected
   destinations after IGP convergence.  Immediately after a failure, any
   non-PLR routers that were sending traffic to the PLR before the
   failure will continue sending traffic to the PLR, and that traffic
   will be carried over backup paths from the PLR to the destinations.



<span class="grey">Atlas, et al.                Standards Track                   [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   After IGP convergence, upstream non-PLR routers may direct some
   traffic away from the PLR.

   In order to reduce or eliminate the potential for transient traffic
   loss due to inadequate capacity during fast-reroute events, an
   operator can model the amount of traffic taking different paths
   during a fast-reroute event.  If it is determined that there is not
   enough capacity to support a given fast-reroute event, the operator
   can address the issue either by augmenting capacity on certain links
   or modifying the backup paths themselves.

   The MRT Lowpoint algorithm produces a pair of diverse paths to each
   destination.  These paths are generated by following the directed
   links on a common GADAG.  The decision process for constructing the
   GADAG in the MRT Lowpoint algorithm takes into account individual IGP
   link metrics.  At any given node, links are explored in order from
   lowest IGP metric to highest IGP metric.  Additionally, the process
   for constructing the MRT-Red and Blue trees uses SPF traversals of
   the GADAG.  Therefore, the IGP link metric values affect the computed
   backup paths.  However, adjusting the IGP link metrics is not a
   generally applicable tool for modifying the MRT backup paths.
   Achieving a desired set of MRT backup paths by adjusting IGP metrics
   while at the same time maintaining the desired flow of traffic along
   the shortest paths is not possible in general.

   MRT-FRR allows an operator to exclude a link from the MRT Island, and
   thus the GADAG, by advertising it as MRT-Ineligible.  Such a link
   will not be used on the MRT forwarding path for any destination.
   Advertising links as MRT-Ineligible is the main tool provided by MRT-
   FRR for keeping backup traffic off of lower bandwidth links during
   fast-reroute events.

   Note that all of the backup paths produced by the MRT Lowpoint
   algorithm are closely tied to the common GADAG computed as part of
   that algorithm.  Therefore, it is generally not possible to modify a
   subset of paths without affecting other paths.  This precludes more
   fine-grained modification of individual backup paths when using only
   paths computed by the MRT Lowpoint algorithm.

   However, it may be desirable to allow an operator to use MRT-FRR
   alternates together with alternates provided by other FRR
   technologies.  A policy-based alternate selection process can allow
   an operator to select the best alternate from those provided by MRT
   and other FRR technologies.  As a concrete example, it may be
   desirable to implement a policy where a downstream LFA (if it exists
   for a given failure mode and destination) is preferred over a given
   MRT alternate.  This combination gives the operator the ability to
   affect where traffic flows during a fast-reroute event, while still



<span class="grey">Atlas, et al.                Standards Track                   [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   producing backup paths that use no additional labels for LDP traffic
   and will not loop under multiple failures.  This and other choices of
   alternate selection policy can be evaluated in the context of their
   effect on fast-reroute traffic flow and available capacity, as well
   as other deployment considerations.

   Note that future documents may define MRT profiles in addition to the
   default profile defined here.  Different MRT profiles will generally
   produce alternate paths with different properties.  An implementation
   may allow an operator to use different MRT profiles instead of or in
   addition to the default profile.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.3.%20%20MRT%20IP%20Tunnel%20Loopback%20Address%20Management"></a><a class="selflink" href="#section-13.3" name="section-13.3">13.3</a>.  MRT IP Tunnel Loopback Address Management</span>

   As described in <a href="#section-6.1.2">Section 6.1.2</a>, if an implementation uses IP tunneling
   as the mechanism to realize MRT forwarding paths, each node must
   advertise an MRT-Red and an MRT-Blue loopback address.  These IP
   addresses must be unique within the routing domain to the extent that
   they do not overlap with each other or with any other routing table
   entries.  It is expected that operators will use existing tools and
   processes for managing infrastructure IP addresses to manage these
   additional MRT-related loopback addresses.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.4.%20%20MRT-FRR%20in%20a%20Network%20with%20Degraded%20Connectivity"></a><a class="selflink" href="#section-13.4" name="section-13.4">13.4</a>.  MRT-FRR in a Network with Degraded Connectivity</span>

   Ideally, routers in a service provider network using MRT-FRR will be
   initially deployed in a 2-connected topology, allowing MRT-FRR to
   find completely diverse paths to all destinations.  However, a
   network can differ from an ideal 2-connected topology for many
   possible reasons, including network failures and planned maintenance
   events.

   MRT-FRR is designed to continue to function properly when network
   connectivity is degraded.  When a network contains cut-vertices or
   cut-links dividing the network into different 2-connected blocks,
   MRT-FRR will continue to provide completely diverse paths for
   destinations within the same block as the PLR.  For a destination in
   a different block from the PLR, the redundant paths created by MRT-
   FRR will be link and node diverse within each block, and the paths
   will only share links and nodes that are cut-links or cut-vertices in
   the topology.

   If a network becomes partitioned with one set of routers having no
   connectivity to another set of routers, MRT-FRR will function
   independently in each set of connected routers, providing redundant
   paths to destinations in same set of connected routers as a given
   PLR.




<span class="grey">Atlas, et al.                Standards Track                   [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.5.%20%20Partial%20Deployment%20of%20MRT-FRR%20in%20a%20Network"></a><a class="selflink" href="#section-13.5" name="section-13.5">13.5</a>.  Partial Deployment of MRT-FRR in a Network</span>

   A network operator may choose to deploy MRT-FRR only on a subset of
   routers in an IGP area.  MRT-FRR is designed to accommodate this
   partial deployment scenario.  Only routers that advertise support for
   a given MRT profile will be included in a given MRT Island.  For a
   PLR within the MRT Island, MRT-FRR will create redundant forwarding
   paths to all destinations with the MRT Island using maximally
   redundant trees all the way to those destinations.  For destinations
   outside of the MRT Island, MRT-FRR creates paths to the destination
   that use forwarding state created by MRT-FRR within the MRT Island
   and shortest path forwarding state outside of the MRT Island.  The
   paths created by MRT-FRR to non-Island destinations are guaranteed to
   be diverse within the MRT Island (if topologically possible).
   However, the part of the paths outside of the MRT Island may not be
   diverse.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  IANA Considerations</span>

   IANA has created the "MRT Profile Identifier Registry".  The range is
   0 to 255.  The Default MRT Profile defined in this document has value
   0.  Values 1-200 are allocated by Standards Action.  Values 201-220
   are for Experimental Use.  Values 221-254 are for Private Use.  Value
   255 is reserved for future registry extension.  (The allocation and
   use policies are described in [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].)

   The initial registry is shown below.

      Value    Description                               Reference
      -------  ----------------------------------------  ------------
      0        Default MRT Profile                       <a href="rfc7812.html">RFC 7812</a>
      1-200    Unassigned
      201-220  Experimental Use
      221-254  Private Use
      255      Reserved (for future registry extension)

   The "MRT Profile Identifier Registry" is a new registry in the IANA
   Matrix.  Following existing conventions, <a href="http://www.iana.org/protocols">http://www.iana.org/</a>
   <a href="http://www.iana.org/protocols">protocols</a> displays a new header: "Maximally Redundant Tree (MRT)
   Parameters".  Under that header, there is an entry for "MRT Profile
   Identifier Registry", which links to the registry itself at
   <a href="http://www.iana.org/assignments/mrt-parameters">http://www.iana.org/assignments/mrt-parameters</a>.









<span class="grey">Atlas, et al.                Standards Track                   [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20Security%20Considerations"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  Security Considerations</span>

   In general, MRT forwarding paths do not follow shortest paths.  The
   transit forwarding state corresponding to the MRT paths is created
   during normal operations (before a failure occurs).  Therefore, a
   malicious packet with an appropriate header injected into the network
   from a compromised location would be forwarded to a destination along
   a non-shortest path.  When this technology is deployed, a network
   security design should not rely on assumptions about potentially
   malicious traffic only following shortest paths.

   It should be noted that the creation of non-shortest forwarding paths
   is not unique to MRT.

   MRT-FRR requires that routers advertise information used in the
   formation of MRT backup paths.  While this document does not specify
   the protocol extensions used to advertise this information, we
   discuss security considerations related to the information itself.
   Injecting false MRT-related information could be used to direct some
   MRT backup paths over compromised transmission links.  Combined with
   the ability to generate network failures, this could be used to send
   traffic over compromised transmission links during a fast-reroute
   event.  In order to prevent this potential exploit, a receiving
   router needs to be able to authenticate MRT-related information that
   claims to have been advertised by another router.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16.%20%20References"></a><a class="selflink" href="#section-16" name="section-16">16</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/16.1.%20%20Normative%20References"></a><a class="selflink" href="#section-16.1" name="section-16.1">16.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              DOI 10.17487/RFC5226, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5226">http://www.rfc-editor.org/info/rfc5226</a>&gt;.

   [<a id="ref-RFC7307" name="ref-RFC7307">RFC7307</a>]  Zhao, Q., Raza, K., Zhou, C., Fang, L., Li, L., and D.
              King, "LDP Extensions for Multi-Topology", <a href="rfc7307.html">RFC 7307</a>,
              DOI 10.17487/RFC7307, July 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7307">http://www.rfc-editor.org/info/rfc7307</a>&gt;.







<span class="grey">Atlas, et al.                Standards Track                   [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   [<a id="ref-RFC7811" name="ref-RFC7811">RFC7811</a>]  Enyedi, G., Ed., Csaszar, A., Atlas, A., Ed., Bowers, C.,
              and A. Gopalan, "An Algorithm for Computing IP/LDP Fast
              Reroute Using Maximally Redundant Trees (MRT-FRR)",
              <a href="rfc7811.html">RFC 7811</a>, DOI 10.17487/RFC7811, June 2016,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7811">http://www.rfc-editor.org/info/rfc7811</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/16.2.%20%20Informative%20References"></a><a class="selflink" href="#section-16.2" name="section-16.2">16.2</a>.  Informative References</span>

   [<a id="ref-EnyediThesis" name="ref-EnyediThesis">EnyediThesis</a>]
              Enyedi, G., "Novel Algorithms for IP Fast Reroute",
              Department of Telecommunications and Media Informatics,
              Budapest University of Technology and Economics Ph.D.
              Thesis, February 2011,
              &lt;<a href="https://repozitorium.omikk.bme.hu/bitstream/handle/10890/1040/ertekezes.pdf">https://repozitorium.omikk.bme.hu/bitstream/</a>
              <a href="https://repozitorium.omikk.bme.hu/bitstream/handle/10890/1040/ertekezes.pdf">handle/10890/1040/ertekezes.pdf</a>&gt;.

   [<a id="ref-LDP-MRT" name="ref-LDP-MRT">LDP-MRT</a>]  Atlas, A., Tiruveedhula, K., Bowers, C., Tantsura, J., and
              IJ. Wijnands, "LDP Extensions to Support Maximally
              Redundant Trees", Work in Progress, <a href="https://tools.ietf.org/html/draft-ietf-mpls-ldp-mrt-03">draft-ietf-mpls-ldp-</a>
              <a href="https://tools.ietf.org/html/draft-ietf-mpls-ldp-mrt-03">mrt-03</a>, May 2016.

   [<a id="ref-MRT-ARCH" name="ref-MRT-ARCH">MRT-ARCH</a>]
              Atlas, A., Kebler, R., Wijnands, IJ., Csaszar, A., and G.
              Enyedi, "An Architecture for Multicast Protection Using
              Maximally Redundant Trees", Work in Progress, <a href="https://tools.ietf.org/html/draft-atlas-rtgwg-mrt-mc-arch-02">draft-atlas-</a>
              <a href="https://tools.ietf.org/html/draft-atlas-rtgwg-mrt-mc-arch-02">rtgwg-mrt-mc-arch-02</a>, July 2013.

   [<a id="ref-RFC2328" name="ref-RFC2328">RFC2328</a>]  Moy, J., "OSPF Version 2", STD 54, <a href="rfc2328.html">RFC 2328</a>,
              DOI 10.17487/RFC2328, April 1998,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2328">http://www.rfc-editor.org/info/rfc2328</a>&gt;.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]  Kompella, K. and G. Swallow, "Detecting Multi-Protocol
              Label Switched (MPLS) Data Plane Failures", <a href="rfc4379.html">RFC 4379</a>,
              DOI 10.17487/RFC4379, February 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4379">http://www.rfc-editor.org/info/rfc4379</a>&gt;.

   [<a id="ref-RFC5286" name="ref-RFC5286">RFC5286</a>]  Atlas, A., Ed. and A. Zinin, Ed., "Basic Specification for
              IP Fast Reroute: Loop-Free Alternates", <a href="rfc5286.html">RFC 5286</a>,
              DOI 10.17487/RFC5286, September 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5286">http://www.rfc-editor.org/info/rfc5286</a>&gt;.

   [<a id="ref-RFC5331" name="ref-RFC5331">RFC5331</a>]  Aggarwal, R., Rekhter, Y., and E. Rosen, "MPLS Upstream
              Label Assignment and Context-Specific Label Space",
              <a href="rfc5331.html">RFC 5331</a>, DOI 10.17487/RFC5331, August 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5331">http://www.rfc-editor.org/info/rfc5331</a>&gt;.






<span class="grey">Atlas, et al.                Standards Track                   [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   [<a id="ref-RFC5340" name="ref-RFC5340">RFC5340</a>]  Coltun, R., Ferguson, D., Moy, J., and A. Lindem, "OSPF
              for IPv6", <a href="rfc5340.html">RFC 5340</a>, DOI 10.17487/RFC5340, July 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5340">http://www.rfc-editor.org/info/rfc5340</a>&gt;.

   [<a id="ref-RFC5443" name="ref-RFC5443">RFC5443</a>]  Jork, M., Atlas, A., and L. Fang, "LDP IGP
              Synchronization", <a href="rfc5443.html">RFC 5443</a>, DOI 10.17487/RFC5443, March
              2009, &lt;<a href="http://www.rfc-editor.org/info/rfc5443">http://www.rfc-editor.org/info/rfc5443</a>&gt;.

   [<a id="ref-RFC5714" name="ref-RFC5714">RFC5714</a>]  Shand, M. and S. Bryant, "IP Fast Reroute Framework",
              <a href="rfc5714.html">RFC 5714</a>, DOI 10.17487/RFC5714, January 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5714">http://www.rfc-editor.org/info/rfc5714</a>&gt;.

   [<a id="ref-RFC5715" name="ref-RFC5715">RFC5715</a>]  Shand, M. and S. Bryant, "A Framework for Loop-Free
              Convergence", <a href="rfc5715.html">RFC 5715</a>, DOI 10.17487/RFC5715, January
              2010, &lt;<a href="http://www.rfc-editor.org/info/rfc5715">http://www.rfc-editor.org/info/rfc5715</a>&gt;.

   [<a id="ref-RFC6976" name="ref-RFC6976">RFC6976</a>]  Shand, M., Bryant, S., Previdi, S., Filsfils, C.,
              Francois, P., and O. Bonaventure, "Framework for Loop-Free
              Convergence Using the Ordered Forwarding Information Base
              (oFIB) Approach", <a href="rfc6976.html">RFC 6976</a>, DOI 10.17487/RFC6976, July
              2013, &lt;<a href="http://www.rfc-editor.org/info/rfc6976">http://www.rfc-editor.org/info/rfc6976</a>&gt;.

   [<a id="ref-RFC6981" name="ref-RFC6981">RFC6981</a>]  Bryant, S., Previdi, S., and M. Shand, "A Framework for IP
              and MPLS Fast Reroute Using Not-Via Addresses", <a href="rfc6981.html">RFC 6981</a>,
              DOI 10.17487/RFC6981, August 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6981">http://www.rfc-editor.org/info/rfc6981</a>&gt;.

   [<a id="ref-RFC6987" name="ref-RFC6987">RFC6987</a>]  Retana, A., Nguyen, L., Zinin, A., White, R., and D.
              McPherson, "OSPF Stub Router Advertisement", <a href="rfc6987.html">RFC 6987</a>,
              DOI 10.17487/RFC6987, September 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6987">http://www.rfc-editor.org/info/rfc6987</a>&gt;.

   [<a id="ref-RFC7490" name="ref-RFC7490">RFC7490</a>]  Bryant, S., Filsfils, C., Previdi, S., Shand, M., and N.
              So, "Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)",
              <a href="rfc7490.html">RFC 7490</a>, DOI 10.17487/RFC7490, April 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7490">http://www.rfc-editor.org/info/rfc7490</a>&gt;.















<span class="grey">Atlas, et al.                Standards Track                   [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Inter-level%20Forwarding%20Behavior%20for%20IS-IS"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Inter-level Forwarding Behavior for IS-IS</span>

   In the description below, we use the terms "Level-1-only interface",
   "Level-2-only interface", and "Level-1-and-Level-2 interface" to mean
   an interface that has formed only a Level-1 adjacency, only a Level-2
   adjacency, or both Level-1 and Level-2 adjacencies.  Note that IS-IS
   also defines the concept of areas.  A router is configured with an
   IS-IS area identifier, and a given router may be configured with
   multiple IS-IS area identifiers.  For an IS-IS Level-1 adjacency to
   form between two routers, at least one IS-IS area identifier must
   match.  IS-IS Level-2 adjacencies do not require any area identifiers
   to match.  The behavior described below does not explicitly refer to
   IS-IS area identifiers.  However, IS-IS area identifiers will
   indirectly affect the behavior by affecting the formation of Level-1
   adjacencies.

   First, consider a packet destined to Z on MRT-Red or MRT-Blue
   received on a Level-1-only interface.  If the best shortest path
   route to Z was learned from a Level-1 advertisement, then the packet
   should continue to be forwarded along MRT-Red or MRT-Blue.  If,
   instead, the best route was learned from a Level-2 advertisement,
   then the packet should be removed from MRT-Red or MRT-Blue and
   forwarded on the shortest-path default forwarding topology.

   Now consider a packet destined to Z on MRT-Red or MRT-Blue received
   on a Level-2-only interface.  If the best route to Z was learned from
   a Level-2 advertisement, then the packet should continue to be
   forwarded along MRT-Red or MRT-Blue.  If, instead, the best route was
   learned from a Level-1 advertisement, then the packet should be
   removed from MRT-Red or MRT-Blue and forwarded on the shortest-path
   default forwarding topology.

   Finally, consider a packet destined to Z on MRT-Red or MRT-Blue
   received on a Level-1-and-Level-2 interface.  This packet should
   continue to be forwarded along MRT-Red or MRT-Blue, regardless of
   which level the route was learned from.

   An implementation may simplify the decision-making process above by
   using the interface of the next hop for the route to Z to determine
   the level from which the best route to Z was learned.  If the next
   hop points out a Level-1-only interface, then the route was learned
   from a Level-1 advertisement.  If the next hop points out a Level-
   2-only interface, then the route was learned from a Level-2
   advertisement.  A next hop that points out a Level-1-and-Level-2
   interface does not provide enough information to determine the source
   of the best route.  With this simplification, an implementation would
   need to continue forwarding along MRT-Red or MRT-Blue when the next-
   hop points out a Level-1-and-Level-2 interface.  Therefore, a packet



<span class="grey">Atlas, et al.                Standards Track                   [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


   on MRT-Red or MRT-Blue going from Level-1 to Level-2 (or vice versa)
   that traverses a Level-1-and-Level-2 interface in the process will
   remain on MRT-Red or MRT-Blue.  This simplification may not always
   produce the optimal forwarding behavior, but it does not introduce
   interoperability problems.  The packet will stay on an MRT backup
   path longer than necessary, but it will still reach its destination.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20General%20Issues%20with%20Area%20Abstraction"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  General Issues with Area Abstraction</span>

   When a multihomed prefix is connected in two different areas, it may
   be impractical to protect them without adding the complexity of
   explicit tunneling.  This is also a problem for LFA and Remote-LFA.

          50
        |----[ASBR Y]---[B]---[ABR 2]---[C]      Backbone Area 0:
        |                                |           ABR 1, ABR 2, C, D
        |                                |
        |                                |       Area 20:  A, ASBR X
        |                                |
        p ---[ASBR X]---[A]---[ABR 1]---[D]      Area 10: B, ASBR Y
           5                                  p is a Type 1 AS-external


             Figure 4: AS External Prefixes in Different Areas

   Consider the network in Figure 4 and assume there is a richer
   connective topology that isn't shown, where the same prefix is
   announced by ASBR X and ASBR Y, which are in different non-backbone
   areas.  If the link from A to ASBR X fails, then an MRT alternate
   could forward the packet to ABR 1 and ABR 1 could forward it to D,
   but then D would find the shortest route is back via ABR 1 to Area
   20.  This problem occurs because the routers, including the ABR, in
   one area are not yet aware of the failure in a different area.

   The only way to get it from A to ASBR Y is to explicitly tunnel it to
   ASBR Y.  If the traffic is unlabeled or the appropriate MPLS labels
   are known, then explicit tunneling MAY be used as long as the
   shortest path of the tunnel avoids the failure point.  In that case,
   A must determine that it should use an explicit tunnel instead of an
   MRT alternate.











<span class="grey">Atlas, et al.                Standards Track                   [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


Acknowledgements

   The authors would like to thank Mike Shand for his valuable review
   and contributions.

   The authors would like to thank Joel Halpern, Hannes Gredler, Ted
   Qian, Kishore Tiruveedhula, Shraddha Hegde, Santosh Esale, Nitin
   Bahadur, Harish Sitaraman, Raveendra Torvi, Anil Kumar SN, Bruno
   Decraene, Eric Wu, Janos Farkas, Rob Shakir, Stewart Bryant, and
   Alvaro Retana for their suggestions and review.

Contributors

   Robert Kebler
   Juniper Networks
   10 Technology Park Drive
   Westford, MA  01886
   United States
   Email: rkebler@juniper.net

   Andras Csaszar
   Ericsson
   Konyves Kalman krt 11
   Budapest  1097
   Hungary
   Email: Andras.Csaszar@ericsson.com

   Jeff Tantsura
   Ericsson
   300 Holger Way
   San Jose, CA  95134
   United States
   Email: jeff.tantsura@ericsson.com

   Russ White
   VCE
   Email: russw@riw.us














<span class="grey">Atlas, et al.                Standards Track                   [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc7812.html">RFC 7812</a>              MRT Unicast FRR Architecture             June 2016</span>


Authors' Addresses

   Alia Atlas
   Juniper Networks
   10 Technology Park Drive
   Westford, MA  01886
   United States

   Email: akatlas@juniper.net


   Chris Bowers
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   United States

   Email: cbowers@juniper.net


   Gabor Sandor Enyedi
   Ericsson
   Konyves Kalman krt 11.
   Budapest  1097
   Hungary

   Email: Gabor.Sandor.Enyedi@ericsson.com
























Atlas, et al.                Standards Track                   [Page 44]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7812 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --></html>