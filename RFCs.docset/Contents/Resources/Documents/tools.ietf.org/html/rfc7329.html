<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7329 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:22 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-kaplan-dispatch-session-id" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7329" name="DC.Identifier"/>
<meta content="August, 2014" name="DC.Date.Issued"/>
<meta content="Hadriel Kaplan &lt;hadriel.kaplan@oracle.com&gt;" name="DC.Creator"/>
<meta content="There is a need for having a globally unique session identifier for
the same SIP session that can be consistently maintained across SIP
Proxies, Back-to-Back User Agents (B2BUAs), and other SIP middleboxes,
for the purpose of troubleshooting. This document proposes a new SIP
header to carry such a value: Session-ID.  The mechanism defined in
this document has been widely deployed, and is being followed in a
backward-compatible fashion for a new Standards Track document
produced by the INSIPID Working Group." name="DC.Description.Abstract"/>
<meta content="A Session Identifier for the Session Initiation Protocol (SIP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7329 - A Session Identifier for the Session Initiation Protocol (SIP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7329.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7329" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-kaplan-insipid-session-id" title="draft-kaplan-insipid-session-id">draft-kaplan-in...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7329" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7329" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7329" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=7329&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc7989.html">7989</a>                                         INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                         H. Kaplan
Request for Comments: 7329                                        Oracle
Category: Informational                                      August 2014
ISSN: 2070-1721


     <span class="h1">A Session Identifier for the Session Initiation Protocol (SIP)</span>

Abstract

   There is a need for having a globally unique session identifier for
   the same SIP session that can be consistently maintained across SIP
   Proxies, Back-to-Back User Agents (B2BUAs), and other SIP
   middleboxes, for the purpose of troubleshooting.  This document
   proposes a new SIP header to carry such a value: Session-ID.

   The mechanism defined in this document has been widely deployed, and
   is being followed in a backward-compatible fashion for a new
   Standards Track document produced by the INSIPID Working Group.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7329">http://www.rfc-editor.org/info/rfc7329</a>.
















<span class="grey">Kaplan                        Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Requirements ...............................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Overview of Operation ...........................................<a href="#page-4">4</a>
   <a href="#section-4">4</a>. Session-ID Behavior .............................................<a href="#page-5">5</a>
      <a href="#section-4.1">4.1</a>. Generating a Session-ID Value ..............................<a href="#page-5">5</a>
      <a href="#section-4.2">4.2</a>. UAC Behavior ...............................................<a href="#page-6">6</a>
      <a href="#section-4.3">4.3</a>. UAS Behavior ...............................................<a href="#page-6">6</a>
      <a href="#section-4.4">4.4</a>. Proxy Behavior .............................................<a href="#page-6">6</a>
      <a href="#section-4.5">4.5</a>. B2BUA Behavior .............................................<a href="#page-7">7</a>
           <a href="#section-4.5.1">4.5.1</a>. B2BUA Generation of New Session-ID ..................<a href="#page-8">8</a>
           <a href="#section-4.5.2">4.5.2</a>. B2BUA Insertion of Saved Session-ID .................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. Handling SIP Transfer Scenarios .................................<a href="#page-8">8</a>
      <a href="#section-5.1">5.1</a>. Out-of-Dialog REFER ........................................<a href="#page-9">9</a>
      <a href="#section-5.2">5.2</a>. Refer-To URI ...............................................<a href="#page-9">9</a>
      <a href="#section-5.3">5.3</a>. Out-of-Dialog INVITE with Replaces .........................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Session-ID Migration and Failure Scenarios .....................<a href="#page-10">10</a>
   <a href="#section-7">7</a>. New 'Session-ID' Header ........................................<a href="#page-11">11</a>
      <a href="#section-7.1">7.1</a>. Augmented BNF Definitions .................................<a href="#page-11">11</a>
   <a href="#section-8">8</a>. Example Exchange ...............................................<a href="#page-11">11</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-11">11</a>
      <a href="#section-9.1">9.1</a>. Security Considerations for Administrators ................<a href="#page-12">12</a>
      <a href="#section-9.2">9.2</a>. Security Considerations for Session-ID Extensions .........<a href="#page-12">12</a>
   <a href="#section-10">10</a>. IANA Considerations ...........................................<a href="#page-13">13</a>
   <a href="#section-11">11</a>. Acknowledgments ...............................................<a href="#page-13">13</a>
   <a href="#section-12">12</a>. References ....................................................<a href="#page-13">13</a>
      <a href="#section-12.1">12.1</a>. Normative References .....................................<a href="#page-13">13</a>
      <a href="#section-12.2">12.2</a>. Informative References ...................................<a href="#page-14">14</a>
   <a href="#appendix-A">Appendix A</a>. Use Cases Not in Scope for Session-ID .................<a href="#page-15">15</a>
      <a href="#appendix-A.1">A.1</a>. Dialog Correlation for SIP ................................<a href="#page-15">15</a>




<span class="grey">Kaplan                        Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This RFC, which contains the text of an individual Internet-Draft
   that was submitted originally to the DISPATCH Working Group, is being
   published now as an Informational document to provide a reference for
   later RFCs.  The mechanism defined in this document has been widely
   deployed and is being followed in a backward-compatible fashion for a
   new Standards Track document produced by the INSIPID Working Group.

   The SIP [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] Call-ID header value is a globally unique
   identifier, which is mandatory in all requests/responses and
   identifies SIP messages belonging to the same dialog or registration.
   It provides a portion of the SIP message dialog-matching criteria and
   is used in such things as "Replaces" headers [<a href="rfc3891.html" title='"The Session Initiation Protocol (SIP) "'>RFC3891</a>] and dialog-
   event packages [<a href="rfc4235.html" title='"An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)"'>RFC4235</a>] for matching to dialogs, and in SIP Identity
   [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] and Connected Identity [<a href="rfc4916.html" title='"Connected Identity in the Session Initiation Protocol (SIP)"'>RFC4916</a>] as one of the inputs for
   signing.

   In practice, the Call-ID is often changed by SIP Back-to-Back User
   Agents (B2BUAs) and other such middleboxes in the logical end-to-end
   message path.  A B2BUA logically represents a SIP User Agent Server
   (UAS) and User Agent Client (UAC), and as such generates a new
   Call-ID value for the dialog it creates on its UAC side; in fact, for
   some B2BUA scenarios the Call-ID *must* be changed for SIP to
   function properly.

   At the same time, there is a need for a unique, common, consistent
   end-to-end identifier to help troubleshoot SIP sessions and message
   flows as they cross SIP nodes.  Troubleshooting is more complicated
   if multiple legs of the session are on different sides of B2BUAs, due
   to the lack of a common identifier such as a Call-ID to tie the legs
   together.  Proprietary mechanisms are currently used to achieve this
   goal.

   Therefore, in order to provide an identifier that will not be
   modified/replaced by B2BUAs, this document proposes a new SIP Header
   "Session-ID" and mandatory rules for the value of such a header.  The
   rules are designed to be such that the value in the Session-ID header
   is not considered unsafe or private and does not have any property
   that would cause B2BUAs to change it.  The goal of this document is
   to enable troubleshooting by providing a unique identifier for a
   given session that can successfully cross B2BUAs, such as Application
   Servers, softswitches, Private Branch Exchanges (PBXs), Session
   Border Controllers (SBCs), feature servers, etc.







<span class="grey">Kaplan                        Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements</span>

   The following requirements drive the need for Session-ID:

   REQ1: It must be possible for an administrator to use the identifier
         to identify a set of dialogs that have a direct correlation
         with each other such that they represent the same SIP session,
         with as high a probability as possible.

   REQ2: It must be possible to pass the identifier through SIP B2BUAs,
         with as high a probability as possible.  This requirement
         drives the following requirements:

         REQ2a: The identifier must not reveal any information related
                to any SIP device or domain identity, including IP
                address, port, hostname, domain name, username, Address-
                of-Record (AoR), MAC address, IP address family,
                transport type, etc.

         REQ2b: The identifier must not reveal to the receiver of it
                that the Call-ID, tags, or any other SIP header or body
                portion have been changed by middleboxes, with as high a
                probability as possible.

         REQ2c: The identifier must not be used for anything at a SIP
                layer to change the behavior of the SIP protocol.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   This document uses the terms "header field" and "header field value"
   following the definition of those terms in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]; they are not
   interchangeable.  The "header field" is the entire SIP header's
   contents, including any parameters.  The "header field value" is only
   the field-value portion, which does not include header parameters.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Overview%20of%20Operation"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Overview of Operation</span>

   The general concept is that the UAC generating an out-of-dialog
   request generates a new, pseudorandom, unique value that remains
   constant for the duration of the transaction, any dialog created from
   that request, or for a registration.  The value is inserted in a new
   Session-ID header field defined in this document.  The UAC and UAS
   then reflect this header field value in all messages for the duration
   of the dialog.  In other words, the Session-ID provides a value



<span class="grey">Kaplan                        Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   similar in nature to Call-ID, except one that crosses B2BUAs and that
   has no sensitive information in it.

   To aid in migration of deployments, a B2BUA or Proxy MAY also
   generate and/or insert the value on behalf of a UAC or UAS, if one or
   the other does not support this document's mechanism.

   Although the Session-ID concept is similar to that of Call-ID, it is
   not used for message dialog-matching rules in <a href="rfc3261.html">RFC 3261</a>, nor does it
   change the Call-ID usage, nor does it replace the Call-ID value.
   Instead, this new header field provides an identifier for
   troubleshooting uses only.

   The format of the Session-ID value is restricted, both to avoid
   detection of the system type that generated it and to keep it a
   hexadecimal representation such that it can be stored as a 128-bit
   binary value in log records.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Session-ID%20Behavior"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Session-ID Behavior</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Generating%20a%20Session-ID%20Value"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Generating a Session-ID Value</span>

   This document proposes the Session-ID header value be generated based
   on a defined hash mechanism for creating a 128-bit pseudorandom value
   and be encoded as its lowercase hex representation.  The reason for
   specifying the mechanism is twofold: to make it impossible to
   determine the manufacturer of the device that generated it by looking
   at its format or value, and to allow devices to generate the same
   value if they have the same private key.

   The Session-ID value is generated by taking the Call-ID header value
   and SHA-1 hashing it based on HMAC (as defined in [<a href="rfc2104.html" title='"HMAC: Keyed- Hashing for Message Authentication"'>RFC2104</a>]) using a
   locally generated pseudorandom 128-bit system secret key to create a
   128-bit resultant HMAC value.  The secret key makes the resultant
   HMAC value not re-creatable by other parties; this is necessary to
   prevent detection of Call-IDs being changed, as required by REQ2b.
   Otherwise, middleboxes may have motivation to remove the Session-ID
   in order to hide the fact that they changed the Call-ID.

   Per [<a href="rfc2104.html" title='"HMAC: Keyed- Hashing for Message Authentication"'>RFC2104</a>], the algorithm is thus HMAC-SHA-1-128(Call-ID_value,
   secret_key), and the 128-bit result is encoded using lowercase
   alphanumeric hex representation, as defined in <a href="#section-7.1">Section 7.1</a>
   ("Augmented BNF Definitions").

   In order to enable troubleshooting of in-dialog messages, a generator
   needs to remember or re-create the same Session-ID value for the
   duration of a given dialog(s).  This is described in more detail in
   the subsequent sections of this document.



<span class="grey">Kaplan                        Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20UAC%20Behavior"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  UAC Behavior</span>

   The rules for when a UAC generates a new Session-ID value are similar
   as those for Call-ID value: a UAC supporting this document's
   mechanism MUST generate a new unique Session-ID value when it
   generates an out-of-dialog request or when there is a new
   Registration.  The exception to this rule is for out-of-dialog REFER
   requests or for an INVITE with a Replaces header field (see
   [<a href="rfc3891.html" title='"The Session Initiation Protocol (SIP) "'>RFC3891</a>]), as described in <a href="#section-5">Section 5</a>.

   The UAC MUST reuse the same Session-ID value for in-dialog messages
   as that of the original dialog-creating request, and for any out-of-
   dialog request that it retransmits or re-generates in response to a
   3xx that it reformulates due to failure responses.  This follows the
   rules in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] for Call-ID generation.

   Session-ID values in Registration "refreshes" -- REGISTER requests
   that are used to update the expiry time but not to register a new
   contact -- MUST use the same Session-ID value as previous REGISTER
   requests.  New Registrations, which add or change the Contact URI for
   the AoR, but do not simply delete them, MUST use a new Session-ID
   value.  This follows the behavior of Call-ID per <a href="rfc3261.html">RFC 3261</a>; it is
   reiterated here because some devices incorrectly change their Call-ID
   value for every re-Registration, and they MUST NOT do the same to the
   Session-ID.

   The UAC MUST include the Session-ID header field in every SIP message
   it transmits.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20UAS%20Behavior"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  UAS Behavior</span>

   A UAS compliant with this document MUST copy a Session-ID header
   field (received in a request) into responses and subsequent upstream
   requests sent within the dialog.

   If an out-of-dialog request is received without a Session-ID header
   field, the UAS SHOULD generate a new one for subsequent use in the
   transaction and dialog, as defined for a UAC, and use the same value
   in all responses and upstream in-dialog requests for the same dialog.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Proxy%20Behavior"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Proxy Behavior</span>

   A Proxy MUST NOT remove or modify the Session-ID header field it
   receives, if one is in the message.  By definition, a Proxy that is
   compliant with <a href="rfc3261.html">RFC 3261</a> would not modify or remove such a header.






<span class="grey">Kaplan                        Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   If the Proxy forks a request, it MUST copy the same Session-ID header
   field into all the forked request copies.  If the Proxy recurses
   requests due to 3xx redirection, or regenerates requests due to
   failures, it MUST use the same Session-ID header field as the
   original request, just as the UAC does.

   If the Proxy locally generates any response or request based on a
   received request, including 100 Trying, it MUST insert any received
   Session-ID header field from the original request into the response
   message it locally creates.  This is necessary for troubleshooting
   purposes.

   A Proxy compliant with this document MAY generate a new Session-ID or
   insert a previously saved one if and only if none existed in a
   received message, following the rules for doing so as a B2BUA as
   defined in <a href="#section-4.5">Section 4.5</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20B2BUA%20Behavior"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  B2BUA Behavior</span>

   A B2BUA compliant with this document MUST copy:

   -  the Session-ID header field it receives in requests as a UAS into
      the related requests it generates as a UAC, and

   -  any Session-ID header field it receives in responses as a UAC into
      the correlated responses it generates as a UAS.

   If the B2BUA forks or creates multiple requests as a UAC, from a
   request it received as a UAS, the B2BUA MUST copy the same Session-ID
   header field it received into all the forks/requests.  If the B2BUA
   recurses on 3xx responses, or regenerates requests due to failures,
   it MUST use the same Session-ID field, just as the UAC does.

   If the B2BUA locally generates any response or request based on a
   received request, including 100 Trying, it MUST insert any received
   Session-ID field from the original request into the response message
   it locally creates.

   A B2BUA MAY remember the received Session-ID value for the duration
   of the transaction and dialog, for the purpose of reinsertion, in
   case the far end does not support this document.

   In all cases, if the SIP message received by a B2BUA contains a
   Session-ID header field, a B2BUA compliant with this document MUST
   NOT remove, modify, or replace it as it "forwards" the message on the
   other logical UA "side" of itself.





<span class="grey">Kaplan                        Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.5.1.%20%20B2BUA%20Generation%20of%20New%20Session-ID"></a><a class="selflink" href="#section-4.5.1" name="section-4.5.1">4.5.1</a>.  B2BUA Generation of New Session-ID</span>

   If an out-of-dialog request is received by a B2BUA compliant with
   this document, and the request does *not* contain a Session-ID header
   field, the B2BUA MAY generate a new one.  The new Session-ID value
   MUST be calculated based on the received Call-ID of the received
   request, even if the B2BUA uses a different Call-ID value for
   requests generated on its other "side(s)".  It MUST then insert the
   new Session-ID in any requests or responses it generates, as if it
   had actually received the new Session-ID from the UAC, following the
   rules previously defined for a B2BUA.  This allows for a B2BUA to
   provide a migration to Session-ID deployment, on behalf of upstream
   nodes that do not yet support it.

   As defined previously, if any received message already had a
   Session-ID, a B2BUA compliant with this document would not replace
   it.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.5.2.%20%20B2BUA%20Insertion%20of%20Saved%20Session-ID"></a><a class="selflink" href="#section-4.5.2" name="section-4.5.2">4.5.2</a>.  B2BUA Insertion of Saved Session-ID</span>

   If a Session-ID was received in an out-of-dialog request, or the
   B2BUA locally generated one because none existed, the B2BUA SHOULD
   insert the same Session-ID field into all responses and upstream
   in-dialog requests if and only if a Session-ID is not already in
   them.  This allows for a B2BUA to provide a migration to Session-ID
   deployment on behalf of downstream nodes that do not yet support it.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Handling%20SIP%20Transfer%20Scenarios"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Handling SIP Transfer Scenarios</span>

   The transfer or movement of SIP sessions represents a complication
   for a mechanism like Session-ID.  On the one hand, the replacement
   SIP session represents a new one and could reasonably be expected to
   use a new Session-ID value; on the other hand, from a troubleshooting
   and human-user perspective, it is clearly related to, if not just a
   continuation of, the previous session.  Since the purpose of this
   document's mechanism is to aid monitoring and troubleshooting, and
   it's not used for actual SIP protocol mechanics, the behavior defined
   in this section is to reuse the same Session-ID value for the
   replacement SIP session.

   In order to do so, the Session-ID of the "original" session is
   transferred as well, in the Refer-To URI of a REFER request as
   described in [<a href="rfc3515.html" title='"The Session Initiation Protocol (SIP) Refer Method"'>RFC3515</a>].  Furthermore, out-of-dialog REFER and INVITE
   with Replaces requests as described in [<a href="rfc3891.html" title='"The Session Initiation Protocol (SIP) "'>RFC3891</a>] use the appropriate
   Session-ID values.  This assumes, of course, that the UAs involved
   support the Session-ID mechanism.  If they do not, then it is
   possible for the Session-ID to not be "carried forward" to the new




<span class="grey">Kaplan                        Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   SIP dialog.  Unfortunately, this means troubleshooting such dialogs
   is not improved or aided by this document's mechanism; but, it would
   not "break" anything at a SIP layer.

   It should also be noted that using the same Session-ID for the
   transferred-to dialog means the same Session-ID now exists in two
   independent dialogs, because the original one may well continue due
   to the implicit Subscription usage created by a REFER.  That implicit
   Subscription-based usage will continue to use the same Session-ID as
   the new dialog created to the transferred-to party.

   In the following subsections, the term "UA" is used for User Agent.
   The language applies to the SIP device that creates the request,
   whether it be a UA or B2BUA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Out-of-Dialog%20REFER"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Out-of-Dialog REFER</span>

   A UA compliant with this document MUST use the same Session-ID header
   field value for an out-of-dialog REFER request it generates, as the
   original dialog the REFER is targeted to (i.e., as if the REFER had
   been in-dialog).  For example, if UA Bob has a SIP dialog X to Alice,
   and Bob sends an out-of-dialog REFER to Alice to refer her to
   Charlie, the Session-ID header field value of the REFER request would
   be the same as that used in dialog X.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Refer-To%20URI"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Refer-To URI</span>

   A UA compliant with this document MUST add the Session-ID header
   field as an embedded header in the Refer-To header field URI of any
   REFER request it generates, using the value of the session it is
   referring to.  For example, if UA Bob has a SIP dialog X to Alice and
   dialog Y to Charlie, and Bob sends a REFER request to Alice to refer
   her to Charlie, the Session-ID header field value embedded in the
   Refer-To URI of the REFER request would be the same as that used in
   dialog Y.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Out-of-Dialog%20INVITE%20with%20Replaces"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Out-of-Dialog INVITE with Replaces</span>

   When generating an out-of-dialog INVITE with a Replaces header field
   as described in [<a href="rfc3891.html" title='"The Session Initiation Protocol (SIP) "'>RFC3891</a>], a UA compliant with this document MUST use
   the same Session-ID header field value for the INVITE request as that
   used for the dialog it is replacing, if it knows the value.
   Typically, the UA would know the value by having received it in the
   Refer-To header field of a REFER, as described previously.  For
   example, if UA Bob has a SIP dialog X to Alice and dialog Y to
   Charlie, and Bob sends a REFER request to Alice to refer her to
   Charlie, the Session-ID header field value embedded in the Refer-To




<span class="grey">Kaplan                        Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   URI of the REFER request would be the one used in dialog Y, which
   Alice would use as the Session-ID header field value for her INVITE
   to Charlie.

   If the UA does not know the Session-ID of the dialog it is replacing,
   for example, because it is not embedded in the Refer-To URI of a
   received REFER, then it MUST use a new Session-ID value, calculated
   using the mechanism as defined in <a href="#section-4.1">Section 4.1</a> with the Call-ID of the
   INVITE.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Session-ID%20Migration%20and%20Failure%20Scenarios"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Session-ID Migration and Failure Scenarios</span>

   SIP is already widely deployed on the Internet, and it is impractical
   to expect all UAs to be upgraded to support this document's mechanism
   in the near future.  A solution for gradual migration is necessary
   and is provided by this document by allowing B2BUAs or Proxies to
   perform the Session-ID generator and inserter role.  Even within
   those device types, it is impractical to expect all B2BUAs to support
   this mechanism all at once or any time in the near future.
   Therefore, it is expected that some B2BUAs and/or UAs will support
   generating and inserting Session-ID, while others will not support
   Session-ID at all.

   Due to the varying types of B2BUAs (such as PBXs, SBCs, Application
   Servers, feature servers, and softswitches of various flavors) and
   the numerous SIP deployment models in use, there are going to be
   cases in which Session-ID will fail to be a consistent value for all
   related dialogs or fail to successfully match.  The goal of this
   document is to improve troubleshooting of current deployments as much
   as possible -- and, in this author's opinion, that is the best that
   can be done given the constraints.

   One example is for forked requests: if a UAC that does not support
   this mechanism sends a request to a Proxy or B2BUA that also does not
   support this mechanism, each fork could reach B2BUAs or UASs that
   *do* support this mechanism.  In such a case, each of those forked-to
   B2BUA/UAS will generate unique Session-IDs and put them in their
   responses, temporarily leading to multiple, different Session-ID
   values for the same related early dialogs.  Typically, the UAC would
   eventually only accept one of the dialogs, and only one Session-ID
   would remain.










<span class="grey">Kaplan                        Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20New%20%27Session-ID%27%20Header"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  New 'Session-ID' Header</span>

   This document adds the "Session-ID" token to the definition of the
   element "message-header" in the SIP message grammar.  The Session-ID
   header is a single-instance header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Augmented%20BNF%20Definitions"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Augmented BNF Definitions</span>

    Session-ID           =  "Session-ID" HCOLON sess-id
                            *( SEMI generic-param )
    sess-id              =  32(DIGIT / %x61-66)  ; 32 chars of [0-9a-f]

   NOTE: The sess-id value is technically case-INSENSITIVE, but only
   lowercase characters are allowed.

   See the Security Considerations section for discussion about using
   header parameters in Session-ID header fields.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Example%20Exchange"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Example Exchange</span>

   In the following example, Alice initiates a call to Bob.  Alice
   generates a Session-ID header in the out-of-dialog INVITE.

   Alice generates the following.  (Note: much has been left out for
   simplicity.)

      INVITE sip:bob@example.com SIP/2.0
      Via: SIP/2.0/UDP 192.0.2.1:5060;branch=z9hG4bKnashds10
      From: Alice &lt;sip:alice@example.net&gt;;tag=1234567
      To: Bob &lt;sip:bob@example.com&gt;
      Call-Id: 123456mcmxcix@1.2.3.4
      Session-ID: f81d4fae7dec11d0a76500a0c91e6bf6
      CSeq: 1 INVITE
      Contact: &lt;sip:alice@192.168.1.1&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   There are several security considerations surrounding this document's
   mechanism.

   The Session-ID generation algorithm should provide a reasonably
   random 32-character Session-ID value to avoid collisions and should
   not let one re-create the original Call-ID.

   There is no known security issue with viewing or modifying the
   Session-ID, other than to hamper troubleshooting efforts.





<span class="grey">Kaplan                        Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Security%20Considerations%20for%20Administrators"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Security Considerations for Administrators</span>

   The requirement for the Session-ID is to be an identifier which
   cannot be used by a recipient to identify if the Call-ID has been
   changed by middleboxes.  As such, a UAS/UAC cannot detect the
   original Call-ID, nor whether it has been changed; thus,
   administrators should not be concerned if the Session-ID header field
   is "passed through".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Security%20Considerations%20for%20Session-ID%20Extensions"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Security Considerations for Session-ID Extensions</span>

   The Session-ID's value is created from the Call-ID using a hashing
   mechanism based on [<a href="rfc2104.html" title='"HMAC: Keyed- Hashing for Message Authentication"'>RFC2104</a>], using SHA-1 and a secret key known only
   to the system generating the Session-ID.  Because the algorithm is
   defined in this document, it should be fairly secure from detecting
   the generator of the Session-ID, in terms of manufacturer or code
   base.

   The Session-ID generation algorithm should provide a reasonably
   random 128-bit Session-ID value, to avoid collisions, and should not
   let one re-create the original Call-ID.  The secret key MUST only be
   used for the Session-ID mechanism, in case a weakness is found that
   reveals the key.  One such weakness may be that a UAC generates one
   or more Call-IDs that have a property that makes determining the key
   more likely.

   In general, B2BUA behavior cannot be dictated by standards.  They do
   whatever their owners/operators wish them to do, or whatever is
   necessary to make their applications work.  This document attempts to
   normatively specify some B2BUA behavior, by creating a SIP header
   value for which the properties are such that B2BUAs should have no
   legitimate reason to interfere.  This effectively creates a "promise"
   that future uses of this Session-ID header field, including its value
   *and* any future defined parameters, maintain this benign property.
   Any future extensions to the Session-ID mechanism and header field
   MUST maintain this property, or else B2BUAs will begin to modify it
   again or remove it, and its value will be lost.

   Manufacturers of SIP devices should note that a B2BUA may inspect the
   Session-ID header field and may remove it if it does not comply with
   this document's value restrictions.  Any Session-ID header parameters
   MUST be registered with IANA and documented in RFCs from the IETF
   stream, pursuant to the requirements of [<a href="rfc3968.html" title='"The Internet Assigned Number Authority (IANA) Header Field Parameter Registry for the Session Initiation Protocol (SIP)"'>RFC3968</a>].








<span class="grey">Kaplan                        Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  IANA Considerations</span>

   IANA has registered a new SIP header field named 'Session-ID',
   pursuant to the registration policies for such in [<a href="rfc5727.html" title='"Change Process for the Session Initiation Protocol (SIP) and the Real- time Applications and Infrastructure Area"'>RFC5727</a>].  This is
   a single-instance header field and is appropriate for any SIP
   message, of any Method type, in any request or response.

   The ABNF rules [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] for this new header allow for header
   parameters; however, they must be registered following the rules of
   [<a href="rfc3968.html" title='"The Internet Assigned Number Authority (IANA) Header Field Parameter Registry for the Session Initiation Protocol (SIP)"'>RFC3968</a>], as required by [<a href="rfc5727.html" title='"Change Process for the Session Initiation Protocol (SIP) and the Real- time Applications and Infrastructure Area"'>RFC5727</a>].

   This registration is intended to be temporary.  The author expects
   that a Standards Track definition of Session-ID will be published at
   a future date.  Assuming such a document is published, it will
   replace this registration with a reference to itself, at which point
   this document will no longer be referenced by IANA.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Acknowledgments"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Acknowledgments</span>

   Thanks to Raphael Coeffic, Bob Penfield, Dale Worley, Paul Kyzivat,
   Ian Elz, Marco Stura, Martin Dolly, Martin Huelsemann, Laura Liess,
   and Adam Roach for their input.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20References"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20Normative%20References"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-RFC2104" name="ref-RFC2104">RFC2104</a>]  Krawczyk, H., Bellare, M., and R. Canetti, "HMAC: Keyed-
              Hashing for Message Authentication", <a href="rfc2104.html">RFC 2104</a>, February
              1997.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

   [<a id="ref-RFC3515" name="ref-RFC3515">RFC3515</a>]  Sparks, R., "The Session Initiation Protocol (SIP) Refer
              Method", <a href="rfc3515.html">RFC 3515</a>, April 2003.

   [<a id="ref-RFC3891" name="ref-RFC3891">RFC3891</a>]  Mahy, R., Biggs, B., and R. Dean, "The Session Initiation
              Protocol (SIP) "Replaces" Header", <a href="rfc3891.html">RFC 3891</a>, September
              2004.






<span class="grey">Kaplan                        Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   [<a id="ref-RFC3968" name="ref-RFC3968">RFC3968</a>]  Camarillo, G., "The Internet Assigned Number Authority
              (IANA) Header Field Parameter Registry for the Session
              Initiation Protocol (SIP)", <a href="https://tools.ietf.org/html/bcp98">BCP 98</a>, <a href="rfc3968.html">RFC 3968</a>, December
              2004.

   [<a id="ref-RFC5234" name="ref-RFC5234">RFC5234</a>]  Crocker, D., Ed., and P. Overell, "Augmented BNF for
              Syntax Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>, January
              2008.

   [<a id="ref-RFC5727" name="ref-RFC5727">RFC5727</a>]  Peterson, J., Jennings, C., and R. Sparks, "Change Process
              for the Session Initiation Protocol (SIP) and the Real-
              time Applications and Infrastructure Area", <a href="https://tools.ietf.org/html/bcp67">BCP 67</a>, <a href="rfc5727.html">RFC</a>
              <a href="rfc5727.html">5727</a>, March 2010.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20Informative%20References"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-RFC4235" name="ref-RFC4235">RFC4235</a>]  Rosenberg, J., Schulzrinne, H., and R. Mahy, Ed., "An
              INVITE-Initiated Dialog Event Package for the Session
              Initiation Protocol (SIP)", <a href="rfc4235.html">RFC 4235</a>, November 2005.

   [<a id="ref-RFC4474" name="ref-RFC4474">RFC4474</a>]  Peterson, J. and C. Jennings, "Enhancements for
              Authenticated Identity Management in the Session
              Initiation Protocol (SIP)", <a href="rfc4474.html">RFC 4474</a>, August 2006.

   [<a id="ref-RFC4916" name="ref-RFC4916">RFC4916</a>]  Elwell, J., "Connected Identity in the Session Initiation
              Protocol (SIP)", <a href="rfc4916.html">RFC 4916</a>, June 2007.

























<span class="grey">Kaplan                        Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Use%20Cases%20Not%20in%20Scope%20for%20Session-ID"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Use Cases Not in Scope for Session-ID</span>

   It is very tempting to use a header field value such as that provided
   by Session-ID, for other purposes than troubleshooting.  In a
   previous document for this same Session-ID concept, the proposal
   included other uses; however, these were removed because any use case
   other than troubleshooting can easily lead to a B2BUA needing to
   change the value, in certain cases.  That would defeat the
   troubleshooting value of Session-ID.  This section discusses such use
   cases and explains why they are potentially harmful.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Dialog%20Correlation%20for%20SIP"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Dialog Correlation for SIP</span>

   Although Session-ID does provide a means to correlate separate SIP
   dialogs, messages, and transactions, it does so at a higher layer
   than SIP.  It does not replace the mechanics of SIP using the Call-ID
   and To/From tags of SIP messages to correlate SIP dialogs, nor in
   other uses such as Replaces headers or dialog-event packages.  It is
   tempting, however, to use it for exactly that purpose in certain
   cases.

   For example, suppose a call transfer case where Alice calls Bob
   through B2BUA-1.  Bob then calls Charlie and sends Charlie a REFER
   with embedded Replaces to make Charlie send an INVITE with a Replaces
   header to Alice, to replace the Alice-Bob session.  If Charlie uses a
   different B2BUA-2 to reach Alice, the INVITE with Replaces will fail
   because the Call-ID/tags won't match anything B2BUA-2 or Alice knows
   about.























<span class="grey">Kaplan                        Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   +-----+     +-------+    +-------+    +-----+     +-------+
   |Alice|     |B2BUA-1|    |B2BUA-2|    | Bob |     |Charlie|
   +-----+     +-------+    +-------+    +-----+     +-------+
      |            |            |           |            |
      |INVITE      |            |           |            |
      |callid:1a   |callid:1b   |           |            |
      |-----------&gt;|-----------------------&gt;|INVITE      |
      |sessid:1    |sessid:1    |           |callid:2a   |
      |            |            |           |-----------&gt;|
      |            |            |           |sessid:2    |
      |            |            |           |            |
      |            |            |           |REFER       |
      |            |            |           |referto:1b  |
      |            |            |           |-----------&gt;|
      |            |            |           |            |
      |            |            |           |      INVITE|
      |            |            |           | replaces:1b|
      |            |            X&lt;-----------------------|
      |            |      INVITE|           |    sessid:1|
      |            | replaces:1b|           |            |
      X&lt;------------------------|           |            |
      |            |    sessid:1|           |            |

                 Example 1: Call Transfer Case

   If, on the other hand, Alice were to use the Session-ID value for
   correlation, she would see it matches her dialog with Bob (assuming
   the Session-ID were passed along in the Refer-To and Replaces info).

   There are problems with this approach, however.  The first problem
   is, by not sending the INVITE with Replaces to B2BUA-1, B2BUA-1 is in
   an incorrect state; the dialog is getting replaced, and the B2BUA
   doesn't know it.

   A second issue is the Session-ID doesn't identify enough information
   to replace a dialog.  Imagine there were a third B2BUA, such as a
   softswitch, between Alice and B2BUA-1 and B2BUA-2, and the INVITE
   with Replaces reached the softswitch before Alice.  The softswitch
   won't know which "side" the INVITE is replacing.  The To/From tags no
   longer match anything the softswitch knows about, so it can't figure
   out if the INVITE with Replaces is replacing the dialog from
   softswitch to Alice, or the one to Bob.  If we try to fix this by
   creating a tag-type value pair for Session-ID, we're back to devices
   changing those tag values and defeating the matching property.







<span class="grey">Kaplan                        Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7329.html">RFC 7329</a>                 SIP Session Identifier              August 2014</span>


   Another example is based on 3GPP 24.605 Annex A.2.2.  Alice has a
   call with Bob through multiple B2BUAs and an Application Server.  The
   dialogs of that call all have the same Session-ID, but unique
   Call-ID/tags.

   Alice wants to invoke a third-party conference facility in the AS and
   to reference the call she has with Bob for that.  In this particular
   3GPP scenario, to do that Alice sends a new INVITE to the AS with a
   resource-list body (a la <a href="rfc5366.html">RFC 5366</a>) containing the call information
   for the original call.  This is the "RL&lt;sessid:1&gt;" piece in the
   diagram.  It has the Call-ID/tags as well, but they'll be wrong when
   received at the AS.

   The AS processes that list, can't match the Call-ID/tags in the
   resource-lit but does match the Session-ID, and sends a re-INVITE to
   party B within the original call's dialog.

   +-----+     +-------+      +----+    +-------+     +-----+
   |Alice|     |B2BUA-1|      | AS |    |B2BUA-2|     | Bob |
   +-----+     +-------+      +----+    +-------+     +-----+
      |            |            |           |            |
      |INVITE      |            |           |            |
      |callid:1a   |callid:1b   |callid:1c  |callid:1d   |
      |-----------&gt;|-----------&gt;|----------&gt;|-----------&gt;|
      |sessid:1    |sessid:1    |sessid:1   |sessid:1    |
      |            |            |           |            |
      |INVITE      |            |           |            |
      |callid:2a   |callid:2b   |           |            |
      |-----------&gt;|-----------&gt;|           |            |
      |sessid:2    |sessid:2    |re-INVITE  |            |
      |RL&lt;sessid:1&gt;|RL&lt;sessid:1&gt;|callid:1c  |callid:1d   |
      |            |            |----------&gt;|-----------&gt;|
      |            |            |sessid:1   |sessid:1    |
      |            |            |           |            |

                    Example 2: Resource List

Author's Address

   Hadriel Kaplan
   Oracle
   EMail: hadrielk@yahoo.com









Kaplan                        Informational                    [Page 17]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7329 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:22 GMT --></html>