<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7191 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:25 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:7191" name="DC.Identifier"/>
<meta content="This document defines the syntax for two Cryptographic Message Syntax
(CMS) content types: one for key package receipts and another for key
package errors. The key package receipt content type is used to
confirm receipt of an identified key package or collection of key
packages. The key package error content type is used to indicate an
error occurred during the processing of a key package. CMS can be used
to digitally sign, digest, authenticate, or encrypt these content
types." name="DC.Description.Abstract"/>
<meta content="Russ Housley &lt;housley@vigilsec.com&gt;" name="DC.Creator"/>
<meta content="April, 2014" name="DC.Date.Issued"/>
<meta content="Cryptographic Message Syntax (CMS) Key Package Receipt and Error Content Types" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7191 - Cryptographic Message Syntax (CMS) Key Package Receipt and Error Content Types</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7191.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7191" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-housley-ct-keypackage-receipt-n-error" title="draft-housley-ct-keypackage-receipt-n-error">draft-housley-c...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7191" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7191" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7191" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                        R. Housley
Request for Comments: 7191                                Vigil Security
Category: Standards Track                                     April 2014
ISSN: 2070-1721


                   <span class="h1">Cryptographic Message Syntax (CMS)</span>
              <span class="h1">Key Package Receipt and Error Content Types</span>

Abstract

   This document defines the syntax for two Cryptographic Message Syntax
   (CMS) content types: one for key package receipts and another for key
   package errors.  The key package receipt content type is used to
   confirm receipt of an identified key package or collection of key
   packages.  The key package error content type is used to indicate an
   error occurred during the processing of a key package.  CMS can be
   used to digitally sign, digest, authenticate, or encrypt these
   content types.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7191">http://www.rfc-editor.org/info/rfc7191</a>.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



<span class="grey">Housley                      Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Requirements Terminology ...................................<a href="#page-2">2</a>
      <a href="#section-1.2">1.2</a>. ASN.1 Syntax Notation ......................................<a href="#page-2">2</a>
      <a href="#section-1.3">1.3</a>. Processing Key Package Receipt Requests ....................<a href="#page-3">3</a>
      <a href="#section-1.4">1.4</a>. Processing Key Packages with Errors ........................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. SIR Entity Name .................................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Key Package Identifier and Receipt Request Attribute ............<a href="#page-4">4</a>
   <a href="#section-4">4</a>. Key Package Receipt CMS Content Type ............................<a href="#page-6">6</a>
   <a href="#section-5">5</a>. Key Package Error CMS Content Type ..............................<a href="#page-8">8</a>
   <a href="#section-6">6</a>. Protecting the KeyPackageReceipt and KeyPackageError ...........<a href="#page-17">17</a>
   <a href="#section-7">7</a>. Using the application/cms Media Type ...........................<a href="#page-17">17</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-17">17</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-17">17</a>
   <a href="#section-10">10</a>. Acknowledgements ..............................................<a href="#page-18">18</a>
   <a href="#section-11">11</a>. References ....................................................<a href="#page-18">18</a>
      <a href="#section-11.1">11.1</a>. Normative References .....................................<a href="#page-18">18</a>
      <a href="#section-11.2">11.2</a>. Informative References ...................................<a href="#page-20">20</a>
   <a href="#appendix-A">Appendix A</a>. ASN.1 Module ..........................................<a href="#page-21">21</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This document defines the syntax for two Cryptographic Message Syntax
   (CMS) [<a href="rfc5652.html" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>] content types: one for key package receipts and
   another for key package errors.  The key package receipt content type
   is used to confirm receipt of an identified key package or collection
   of key packages.  The key package error content type is used to
   indicate an error occurred during the processing of a key package.
   CMS can be used to digitally sign, digest, authenticate, or encrypt
   these content types.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20ASN.1%20Syntax%20Notation"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  ASN.1 Syntax Notation</span>

   The content types defined herein use ASN.1 ([<a href="#ref-X.680">X.680</a>], [<a href="#ref-X.681">X.681</a>],
   [<a href="#ref-X.682">X.682</a>], and [<a href="#ref-X.683">X.683</a>]).

   The CONTENT-TYPE definition was updated to the 2008 version of ASN.1
   by [<a href="rfc6268.html" title='"Additional New ASN.1 Modules for the Cryptographic Message Syntax (CMS) and the Public Key Infrastructure Using X.509 (PKIX)"'>RFC6268</a>]; however, none of the new 2008 ASN.1 tokens are used in
   this specification, which allows compilers that only support the 2002
   version of ASN.1 to compile the module in <a href="#appendix-A">Appendix A</a>.




<span class="grey">Housley                      Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20Processing%20Key%20Package%20Receipt%20Requests"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  Processing Key Package Receipt Requests</span>

   The key package or collection of key packages [<a href="rfc4073.html" title='"Protecting Multiple Contents with the Cryptographic Message Syntax (CMS)"'>RFC4073</a>] [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>]
   [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>] [<a href="rfc6032.html" title='"Cryptographic Message Syntax (CMS) Encrypted Key Package Content Type"'>RFC6032</a>] for which the receipt is being generated MUST be
   signed, and the key package MUST include the key-package-identifier-
   and-receipt-request attribute specified in <a href="#section-3">Section 3</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4.%20%20Processing%20Key%20Packages%20with%20Errors"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a>.  Processing Key Packages with Errors</span>

   The key package or collection of key packages [<a href="rfc4073.html" title='"Protecting Multiple Contents with the Cryptographic Message Syntax (CMS)"'>RFC4073</a>] [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>]
   [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>] [<a href="rfc6032.html" title='"Cryptographic Message Syntax (CMS) Encrypted Key Package Content Type"'>RFC6032</a>] for which the error is being generated might be
   signed.  The key package can be identified by a key-package-
   identifier-and-receipt-request attribute specified in <a href="#section-3">Section 3</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20SIR%20Entity%20Name"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  SIR Entity Name</span>

   Within a key distribution system, the source, intermediary, and
   receiver entities are identified by a Source Intermediary Recipient
   (SIR) entity name.  The syntax for the SIR entity name does not
   impose any particular structure, and it accommodates straightforward
   registration of additional SIR entity name types.

   The inclusion of the nameType object identifier ensures that two
   identifiers of different types that happen to contain the same values
   are not interpreted as equivalent.  Additional SIR entity name types
   are expected to be registered that represent different granularities.
   For example, one SIR entity name type might represent the receiver
   organization, and at a finer granularity, another SIR entity name
   type might identify a specific device, perhaps using a manufacturer
   identifier and serial number.  The use of an object identifier avoids
   the need for a central registry of SIR entity name types.

   The nameValue is an OCTET STRING, which allows the canonical form of
   any name to be carried.  Two names of the same type are considered
   equal if the octet strings are the same length and contain the same
   string of octets.















<span class="grey">Housley                      Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   SIREntityNames and SIREntityName have the following syntax:

      SIREntityNames ::= SEQUENCE SIZE (1..MAX) OF SIREntityName

      SIR-ENTITY-NAME ::= CLASS {
          &amp;sIRENType OBJECT IDENTIFIER UNIQUE,
          &amp;SIRENValue
          } WITH SYNTAX {
          SYNTAX &amp;SIRENValue IDENTIFIED BY &amp;sIRENType }

      SIREntityName ::= SEQUENCE {
          sirenType    SIR-ENTITY-NAME.&amp;sIRENType({SIREntityNameTypes}),
          sirenValue   OCTET STRING (CONTAINING
                         SIR-ENTITY-NAME.&amp;SIRENValue(
                           {SIREntityNameTypes}{@sirenType}) ) }

   This document defines one SIR entity name type: the DN type.  The DN
   type uses a nameType of id-dn and a nameValue of a Distinguished Name
   (DN).  The nameValue OCTET STRING carries an ASN.1 encoded Name as
   specified in [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>].  Note that other documents may define
   additional types.

      SIREntityNameTypes SIR-ENTITY-NAME ::= {
          siren-dn,
          ... -- Expect additional SIR Entity Name types -- }

      siren-dn SIR-ENTITY-NAME ::= {
          SYNTAX DistinguishedName
          IDENTIFIED BY id-dn }

      id-dn OBJECT IDENTIFIER ::= {
          joint-iso-ccitt(2) country(16) us(840) organization(1)
          gov(101) dod(2) infosec(1) sir-name-types(16) 0 }

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Key%20Package%20Identifier%20and%20Receipt%20Request%20Attribute"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Key Package Identifier and Receipt Request Attribute</span>

   The key-package-identifier-and-receipt-request attribute, as its name
   implies, allows the originator to identify the key package and,
   optionally, request receipts.  This attribute can appear as a signed,
   authenticated, and content attribute.  Signed attributes are carried
   in the CMS Signed-data content type described in <a href="rfc5652.html#section-5">Section 5 of
   [RFC5652]</a>.  Authenticated attributes are carried in the CMS
   Authenticated-data content type described in <a href="rfc5652.html#section-9">Section 9 of [RFC5652]</a>
   or in the CMS Authenticated-enveloped-data content type described in
   <a href="rfc5083.html#section-2">Section 2 of [RFC5083]</a>.  Content attributes are carried in the
   Content-with-attributes content type described in <a href="rfc4073.html#section-3">Section 3 of
   [RFC4073]</a>.




<span class="grey">Housley                      Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   The key-package-identifier-and-receipt-request attribute has the
   following syntax:

     aa-keyPackageIdentifierAndReceiptRequest ATTRIBUTE ::= {
         TYPE KeyPkgIdentifierAndReceiptReq
         IDENTIFIED BY id-aa-KP-keyPkgIdAndReceiptReq }

     id-aa-KP-keyPkgIdAndReceiptReq OBJECT IDENTIFIER ::= {
         joint-iso-itu-t(2) country(16) us(840) organization(1)
         gov(101) dod(2) infosec(1) attributes(5) 65 }

     KeyPkgIdentifierAndReceiptReq ::= SEQUENCE {
         pkgID       KeyPkgID,
         receiptReq  KeyPkgReceiptReq OPTIONAL }

     KeyPkgID ::= OCTET STRING

     KeyPkgReceiptReq ::= SEQUENCE {
         encryptReceipt     BOOLEAN DEFAULT FALSE,
         receiptsFrom   [0] SIREntityNames OPTIONAL,
         receiptsTo         SIREntityNames }

   Even though the ATTRIBUTE syntax is defined as a SET OF
   AttributeValue, a key-package-identifier-and-receipt-request
   attribute MUST have a single attribute value; zero or multiple
   instances of AttributeValue are not permitted.

   The fields in the key-package-identifier-and-receipt-request
   attribute have the following semantics:

      o pkgID contains an octet string, and this syntax does not impose
        any particular structure on the identifier.

      o receiptReq is OPTIONAL, and when it is present, it includes an
        encryption receipt flag, an OPTIONAL indication of which
        receivers should generate receipts, and an indication of where
        the receipts are to be sent.

        * The encryption receipt flag indicates whether the key package
          originator wants the receipt to be encrypted.  If the boolean
          is set, then the receipt SHOULD be encrypted.

        * The OPTIONAL ReceiptsFrom field provides an indication of
          which receivers SHOULD generate receipts.  When the
          ReceiptsFrom field is absent, all receivers of the key package
          are expected to return receipts.  When the ReceiptsFrom field
          is present, a list of SIR entity names indicates which
          receivers of the key package are requested to return receipts.



<span class="grey">Housley                      Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          In this case, the receiver SHOULD return a receipt only if
          their SIR entity name appears on the list.

        * The receipt request does not include any key management
          information; however, the list of SIR entity names in the
          receiptsTo field can be used to select symmetric or asymmetric
          keying material for the receipt receivers.

   A receiver SHOULD ignore the nameValue associated with any
   unrecognized nameType in either the receiptsFrom field or the
   receiptsTo field.

   When the key-package-identifier-and-receipt-request attribute appears
   in more than one location in the overall key package, each occurrence
   is evaluated independently.  That is, the receiver may generate more
   than one receipt for a single key package.  However, the time at
   which the receipts are sent will depend on policies that are beyond
   the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Key%20Package%20Receipt%20CMS%20Content%20Type"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Key Package Receipt CMS Content Type</span>

   The key package receipt content type is used to confirm receipt of an
   identified key package or collection of key packages.  This content
   type MUST be encoded using the Distinguished Encoding Rules (DER)
   [<a href="#ref-X.690">X.690</a>].

   The key package receipt content type has the following syntax:

     ct-key-package-receipt CONTENT-TYPE ::= {
         TYPE KeyPackageReceipt
         IDENTIFIED BY id-ct-KP-keyPackageReceipt }

     id-ct-KP-keyPackageReceipt OBJECT IDENTIFIER ::= {
         joint-iso-itu-t(2) country(16) us(840) organization(1)
         gov(101) dod(2) infosec(1) formats(2)
         key-package-content-types(78) 3 }

     KeyPackageReceipt ::= SEQUENCE {
         version          KeyPkgVersion DEFAULT v2,
         receiptOf        KeyPkgIdentifier,
         receivedBy       SIREntityName }

     -- Revised definition of KeyPkgVersion from [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>]
     KeyPkgVersion ::= INTEGER  { v1(1), v2(2) } (1 .. 65535)

     KeyPkgIdentifier ::= CHOICE {
         pkgID            KeyPkgID,
         attribute        SingleAttribute {{ KeyPkgIdentifiers }} }



<span class="grey">Housley                      Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


     KeyPkgID ::= OCTET STRING

     KeyPkgIdentifiers ATTRIBUTE ::= { ... }

   The KeyPackageReceipt fields are used as follows:

      o version identifies version of the key package receipt content.
        For this version of the specification, the default value, v2,
        MUST be used.  Note that v1 was defined in an earlier version,
        but the use of v1 is deprecated.

      o receiptOf offers two alternatives for identifying the key
        package for which the receipt is being generated.  The first
        alternative, pkgID, MUST be supported, and pkgID provides the
        key package identifier of the key package or collection of key
        packages for which this receipt is being generated.  This key
        package identifier value MUST exactly match the key package
        identifier value of the key-package-identifier-and-receipt-
        request attribute in the received key package or collection.
        The key-package-identifier-and-receipt-request attribute is
        described <a href="#section-3">Section 3</a>.  The second alternative allows alternate
        attributes to be used to define the identifier.

      o receivedBy identifies the entity that received the key package.
        The entity is named by an SIR entity name as specified in
        <a href="#section-2">Section 2</a>.

   Key package receipts MUST be encapsulated in a CMS SignedData content
   type to carry the signature of the entity that is confirming receipt
   of the identified key package or collection of key packages.  Key
   package receipts MAY be encrypted by encapsulating them in the CMS
   EncryptedData content type, the CMS EnvelopedData content type, or
   the AuthEnvelopedData content type.  When the key package receipt is
   signed and encrypted, it MUST be signed prior to being encrypted.

   Note that delivery assurance is the responsibility of the protocol
   that is used to transport and track key packages.  The key package
   receipt content type can be used in conjunction with that protocol as
   part of an overall delivery assurance solution.

   Because the receipts are signed, all recipients that generate key
   package receipts MUST have a private signature key to sign the
   receipt as well as store their own certificate or have a means of
   obtaining the key identifier of their public key.  If memory is a
   concern, the public key identifier can be computed from the public
   key.





<span class="grey">Housley                      Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   If the receipt signer has access to a real-time clock, then the
   binary-signing-time [<a href="rfc6019.html" title='"BinaryTime: An Alternate Format for Representing Date and Time in ASN.1"'>RFC6019</a>] signed attribute SHOULD be included in
   the key package receipt to provide the date and time when it was
   generated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Key%20Package%20Error%20CMS%20Content%20Type"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Key Package Error CMS Content Type</span>

   The key package error content type provides an indication of the
   reason for rejection of a key package or collection of key packages.
   This content type MUST be encoded using the Distinguished Encoding
   Rules (DER) [<a href="#ref-X.690">X.690</a>].

   The key package error content type has the following syntax:

     ct-key-package-error CONTENT-TYPE ::= {
         TYPE KeyPackageError IDENTIFIED BY id-ct-KP-keyPackageError }

     id-ct-KP-keyPackageError OBJECT IDENTIFIER ::= {
         joint-iso-itu-t(2) country(16) us(840) organization(1)
         gov(101) dod(2) infosec(1) formats(2)
         key-package-content-types(78) 6 }

     KeyPackageError ::= SEQUENCE {
         version        KeyPkgVersion DEFAULT v2,
         errorOf    [0] KeyPkgIdentifier OPTIONAL,
         errorBy        SIREntityName,
         errorCode      ErrorCodeChoice }

     KeyPkgVersion ::= INTEGER  { v1(1), v2(2) } (1 .. 65535)

     KeyPkgIdentifier ::= CHOICE {
         pkgID            KeyPkgID,
         attribute        SingleAttribute {{ KeyPkgIdentifiers }} }

     KeyPkgID ::= OCTET STRING

     KeyPkgIdentifiers ATTRIBUTE ::= { ... }

     ErrorCodeChoice ::= CHOICE {
         enum           EnumeratedErrorCode,
         oid            OBJECT IDENTIFIER }

     EnumeratedErrorCode ::= ENUMERATED {
         decodeFailure                     (1),
         badContentInfo                    (2),
         badSignedData                     (3),
         badEncapContent                   (4),
         badCertificate                    (5),



<span class="grey">Housley                      Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


         badSignerInfo                     (6),
         badSignedAttrs                    (7),
         badUnsignedAttrs                  (8),
         missingContent                    (9),
         noTrustAnchor                    (10),
         notAuthorized                    (11),
         badDigestAlgorithm               (12),
         badSignatureAlgorithm            (13),
         unsupportedKeySize               (14),
         unsupportedParameters            (15),
         signatureFailure                 (16),
         insufficientMemory               (17),
         incorrectTarget                  (23),
         missingSignature                 (29),
         resourcesBusy                    (30),
         versionNumberMismatch            (31),
         revokedCertificate               (33),

     --  Error codes with values &lt;= 33 are aligned with [<a href="rfc5934.html" title='"Trust Anchor Management Protocol (TAMP)"'>RFC5934</a>]

         ambiguousDecrypt                 (60),
         noDecryptKey                     (61),
         badEncryptedData                 (62),
         badEnvelopedData                 (63),
         badAuthenticatedData             (64),
         badAuthEnvelopedData             (65),
         badKeyAgreeRecipientInfo         (66),
         badKEKRecipientInfo              (67),
         badEncryptContent                (68),
         badEncryptAlgorithm              (69),
         missingCiphertext                (70),
         decryptFailure                   (71),
         badMACAlgorithm                  (72),
         badAuthAttrs                     (73),
         badUnauthAttrs                   (74),
         invalidMAC                       (75),
         mismatchedDigestAlg              (76),
         missingCertificate               (77),
         tooManySigners                   (78),
         missingSignedAttributes          (79),
         derEncodingNotUsed               (80),
         missingContentHints              (81),
         invalidAttributeLocation         (82),
         badMessageDigest                 (83),
         badKeyPackage                    (84),
         badAttributes                    (85),
         attributeComparisonFailure       (86),
         unsupportedSymmetricKeyPackage   (87),



<span class="grey">Housley                      Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


         unsupportedAsymmetricKeyPackage  (88),
         constraintViolation              (89),
         ambiguousDefaultValue            (90),
         noMatchingRecipientInfo          (91),
         unsupportedKeyWrapAlgorithm      (92),
         badKeyTransRecipientInfo         (93),
         other                           (127),
         ... -- Expect additional error codes  -- }

   The KeyPackageError fields are used as follows:

      o version identifies version of the key package error content
        structure.  For this version of the specification, the default
        value, v2, MUST be used.  Note that v1 was defined in an earlier
        version, but the use of v1 is deprecated.

      o errorOf is OPTIONAL, and it provides the identifier of the
        keying material for which this error is being generated.  This
        is omitted if the receiver or intermediary cannot parse the
        received data to determine the package identifier.  Also,
        encryption may prevent an intermediary from obtaining any of the
        identifiers.  Two alternatives for identifying the keying
        material are possible; see KeyPkgIdentifier as described in
        <a href="#section-4">Section 4</a>.  The value MUST exactly match the value of the key-
        package-identifier-and-receipt-request attribute in the received
        key package or collection.  The key-package-identifier-and-
        receipt-request attribute is described in <a href="#section-3">Section 3</a>.

      o errorBy identifies the entity that received the key package.
        The entity is named by an SIR entity name as specified in
        <a href="#section-2">Section 2</a>.

      o errorCode contains a code that indicates the reason for the
        error.  It contains either an enumerated error code from the
        list below or an extended error code represented by an object
        identifier.  The enumerated error code alternative MUST be
        supported.  The object identifier error code MAY be supported.

          * decodeFailure is used to indicate that the key package
            intermediary or receiver was unable to successfully decode
            the provided package.  The specified content type and the
            provided content do not match.

          * badContentInfo is used to indicate that the ContentInfo
            syntax is invalid or that the contentType carried within the
            ContentInfo is unknown or unsupported.





<span class="grey">Housley                      Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * badSignedData is used to indicate that the SignedData syntax
            is invalid, the version is unknown or unsupported, or more
            than one entry is present in digestAlgorithms.

          * badEncapContent is used to indicate that the
            EncapsulatedContentInfo syntax is invalid within a
            SignedData or an AuthenticatedData or the
            EncryptedContentInfo syntax is invalid within an
            AuthEnvelopedData.

          * badCertificate is used to indicate that the syntax for one
            or more certificates in CertificateSet or elsewhere is
            invalid or unsupported.

          * badSignerInfo is used to indicate that the SignerInfo syntax
            is invalid or the version is unknown or unsupported.

          * badSignedAttrs is used to indicate that the signedAttrs
            syntax within SignerInfo is invalid.

          * badUnsignedAttrs is used to indicate that the unsignedAttrs
            within SignerInfo contains one or more attributes.  Since
            unrecognized attributes are ignored, this error code is used
            when the object identifier for the attribute is recognized,
            but the value is malformed or internally inconsistent.  In
            addition, this error code can be used when policy prohibits
            an implementation from supporting unsigned attributes.

          * missingContent is used to indicate that the optional
            eContent is missing in EncapsulatedContentInfo, which is
            required when including an asymmetric key package, a
            symmetric key package, and an encrypted key package.  This
            error can be generated due to problems located in SignedData
            or AuthenticatedData.

            Note that CMS EncapsulatedContentInfo eContent field is
            optional [<a href="rfc5652.html" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>]; however, [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>], [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>], and
            [<a href="rfc6032.html" title='"Cryptographic Message Syntax (CMS) Encrypted Key Package Content Type"'>RFC6032</a>] require that the eContent be present.

          * noTrustAnchor is used to indicate that the
            subjectKeyIdentifier does not identify the public key of a
            trust anchor or a certification path that terminates with an
            installed trust anchor.

          * notAuthorized is used to indicate that the sid within
            SignerInfo leads to an installed trust anchor, but that
            trust anchor is not an authorized signer for the received
            content type.



<span class="grey">Housley                      Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * badDigestAlgorithm is used to indicate that the
            digestAlgorithm in either SignerInfo, SignedData, or
            AuthenticatedData is unknown or unsupported.

          * badSignatureAlgorithm is used to indicate that the
            signatureAlgorithm in SignerInfo is unknown or unsupported.

          * unsupportedKeySize is used to indicate that the
            signatureAlgorithm in SignerInfo is known and supported, but
            the digital signature could not be validated because an
            unsupported key size was employed by the signer.
            Alternatively, the algorithm used in EnvelopedData,
            AuthenticatedData, or AuthEnvelopedData to generate the key-
            encryption key is known and supported, but an unsupported
            key size was employed by the originator.

          * unsupportedParameters is used to indicate that the
            signatureAlgorithm in SignerInfo is known, but the digital
            signature could not be validated because unsupported
            parameters were employed by the signer.  Alternatively, the
            algorithm used in EnvelopedData, AuthenticatedData, or
            AuthEnvelopedData to generate the key-encryption key is
            known and supported, but unsupported parameters were
            employed by the originator.

          * signatureFailure is used to indicate that the
            signatureAlgorithm in SignerInfo is known and supported, but
            the digital signature in the signature field within
            SignerInfo could not be validated.

          * insufficientMemory indicates that the key package could not
            be processed because the intermediary or receiver did not
            have sufficient memory to store the keying material.

          * incorrectTarget indicates that a receiver is not the
            intended recipient.

          * missingSignature indicates that the receiver requires the
            key package to be signed or authenticated with a Message
            Authentication Code (MAC), but the received key package was
            not signed or authenticated.

          * resourcesBusy indicates that the resources necessary to
            process the key package are not available at the present
            time, but the resources might be available at some point in
            the future.





<span class="grey">Housley                      Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * versionNumberMismatch indicates that the version number in a
            received key package is not acceptable.

          * revokedCertificate indicates that one or more of the
            certificates needed to properly process the key package has
            been revoked.

          * ambiguousDecrypt indicates that the EncryptedData content
            type was used, and the key package receiver could not
            determine the appropriate keying material to perform the
            decryption.

          * noDecryptKey indicates that the receiver does not have the
            key named in the content-decryption-key-identifier attribute
            (see [<a href="rfc6032.html" title='"Cryptographic Message Syntax (CMS) Encrypted Key Package Content Type"'>RFC6032</a>]).

          * badEncryptedData indicates that the EncryptedData syntax is
            invalid or the version is unknown or unsupported.

          * badEnvelopedData indicates that the EnvelopedData syntax is
            invalid or the version is unknown or unsupported.

          * badAuthenticatedData indicates that the AuthenticatedData
            syntax is invalid or the version is unknown or unsupported.

          * badAuthEnvelopedData indicates that the AuthEnvelopedData
            syntax is invalid or the version is unknown or unsupported.

          * badKeyAgreeRecipientInfo indicates that the
            KeyAgreeRecipientInfo syntax is invalid or the version is
            unknown or unsupported.

          * badKEKRecipientInfo indicates that the KEKRecipientInfo
            syntax is invalid or the version is unknown or unsupported.

          * badEncryptContent indicates that the EncryptedContentInfo
            syntax is invalid, or that the content type carried within
            the contentType is unknown or unsupported.

          * badEncryptAlgorithm indicates that the encryption algorithm
            identified by contentEncryptionAlgorithm in
            EncryptedContentInfo is unknown or unsupported.  This can
            result from EncryptedData, EnvelopedData, or
            AuthEnvelopedData.







<span class="grey">Housley                      Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * missingCiphertext indicates that the optional
            encryptedContent is missing in EncryptedContentInfo, which
            is required when including an asymmetric key package, a
            symmetric key package, and an encrypted key package.

          * decryptFailure indicates that the encryptedContent in
            EncryptedContentInfo did not decrypt properly.

          * badMACAlgorithm indicates that the MAC algorithm identified
            by MessageAuthenticationCodeAlgorithm in AuthenticatedData
            is unknown or unsupported.

          * badAuthAttrs is used to indicate that the authAttrs syntax
            within AuthenticatedData or AuthEnvelopedData is invalid.
            Since unrecognized attributes are ignored, this error code
            is used when the object identifier for the attribute is
            recognized, but the value is malformed or internally
            inconsistent.

          * badUnauthAttrs is used to indicate that the unauthAttrs
            syntax within AuthenticatedData or AuthEnvelopedData is
            invalid.  Since unrecognized attributes are ignored, this
            error code is used when the object identifier for the
            attribute is recognized, but the value is malformed or
            internally inconsistent.

          * invalidMAC is used to indicate that the message
            authentication code value within AuthenticatedData or
            AuthEnvelopedData did not validate properly.

          * mismatchedDigestAlg is used to indicate that the digest
            algorithm in digestAlgorithms field within SignedData does
            not match the digest algorithm used in the signature
            algorithm.

          * missingCertificate indicates that a signature could not be
            verified using a trust anchor or a certificate from the
            certificates field within SignedData.  Similarly, this error
            code can indicate that a needed certificate is missing when
            processing EnvelopedData, AuthEnvelopedData, or
            AuthenticatedData.

          * tooManySigners indicates that a SignedData content contained
            more than one SignerInfo for a content type that requires
            only one signer.






<span class="grey">Housley                      Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * missingSignedAttributes indicates that a SignedInfo within a
            SignedData content did not contain any signed attributes; at
            a minimum, the content-type and message-digest must be
            present, as per [<a href="rfc5652.html" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>].  Similarly, this error code can
            indicate that required authenticated attributes are missing
            when processing AuthEnvelopedData or AuthenticatedData.

          * derEncodingNotUsed indicates that the content contained BER
            encoding, or some other encoding, where DER encoding was
            required.

          * missingContentHints indicates that a SignedData content
            encapsulates a content other than a key package or an
            encrypted key package; however, the content-hints attribute
            [<a href="rfc2634.html" title='"Enhanced Security Services for S/MIME"'>RFC2634</a>] is not included.  Similarly, this error code can
            indicate that the content-hints attribute was missing when
            processing AuthEnvelopedData or AuthenticatedData.

          * invalidAttributeLocation indicates that an attribute
            appeared in an unacceptable location.

          * badMessageDigest indicates that the value of the message-
            digest attribute [<a href="rfc5652.html" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>] did not match the calculated
            value.

          * badKeyPackage indicates that the SymmetricKeyPackage
            [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>] or AsymmetricKeyPackage [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>] syntax is
            invalid or that the version is unknown.

          * badAttributes indicates that an attribute collection either
            contained multiple instances of the same attribute type that
            allows only one instance or contained an attribute instance
            with multiple values in an attribute that allows only one
            value.

          * attributeComparisonFailure indicates that multiple instances
            of an attribute failed the comparison rules for the type of
            attribute.

          * unsupportedSymmetricKeyPackage indicates that the
            implementation does not support symmetric key packages
            [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>].

          * unsupportedAsymmetricKeyPackage indicates that the
            implementation does not support asymmetric key packages
            [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>].





<span class="grey">Housley                      Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


          * constraintViolation indicates that one or more of the
            attributes has a value that is not in the authorized set of
            values for the signer [<a href="rfc6010.html" title='"Cryptographic Message Syntax (CMS) Content Constraints Extension"'>RFC6010</a>].  That is, the value is in
            conflict with the constraints imposed on the signer.

          * ambiguousDefaultValue indicates that one or more of the
            attributes that is part of the signer's constraints is
            omitted from the key package, and the constraint permits
            more than one value; therefore, the appropriate default
            value for that attribute or attribute cannot be determined.

          * noMatchingRecipientInfo indicates that a recipientInfo could
            not be found for the recipient.  This can result from a ktri
            or kari found in EncryptedData, EnvelopedData, or
            AuthEnvelopedData.

          * unsupportedKeyWrapAlgorithm indicates that the key wrap
            algorithm is not supported.

          * badKeyTransRecipientInfo indicates that the
            KeyTransRecipientInfo syntax is invalid or the version is
            unknown or unsupported.

          * other indicates that the key package could not be processed,
            but the reason is not covered by any of the assigned status
            codes.  Use of this status code SHOULD be avoided.

   The key package error content type MUST be signed if the entity
   generating it is capable of signing it.  For example, a device will
   be incapable of signing when it is in early stages of deployment and
   it has not been configured with a private signing key or a device has
   an internal error that prevents use of its private signing key.  When
   it is signed, the key package error MUST be encapsulated in a CMS
   SignedData content type to carry the signature of the party that is
   indicating an error.  When it is encrypted, the key package error
   MUST be encapsulated in a CMS EnvelopedData content type, a CMS
   EncryptedData content type, or a CMS AuthEnvelopedData content type.
   When a key package error is signed and encrypted, it MUST be signed
   prior to being encrypted.

   All devices that generate signed key package error reports MUST store
   their own certificate or have a means of obtaining the key identifier
   of their public key.  If memory is a concern, the public key
   identifier can be computed from the public key.

   If the error report signer has access to a real-time clock, then the
   binary-signing-time attribute [<a href="rfc6019.html" title='"BinaryTime: An Alternate Format for Representing Date and Time in ASN.1"'>RFC6019</a>] SHOULD be included in the key
   package error to provide the date and time when it was generated.



<span class="grey">Housley                      Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Protecting%20the%20KeyPackageReceipt%20and%20KeyPackageError"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Protecting the KeyPackageReceipt and KeyPackageError</span>

   CMS protecting content types, [<a href="rfc5652.html" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>] and [<a href="rfc5083.html" title='"Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type"'>RFC5083</a>], can be used to
   provide security to the KeyPackageReceipt and KeyPackageError content
   types:

      o SignedData can be used to apply a digital signature.

      o EncryptedData can be used to encrypt the content type with
        simple symmetric encryption, where the sender and the receiver
        already share the necessary encryption key.

      o EnvelopedData can be used to encrypt the content type with
        symmetric encryption, where the sender and the receiver do not
        already share the necessary encryption key.

      o AuthenticatedData can be used to integrity protect the content
        type with message authentication algorithms that support
        authenticated encryption, where key management information is
        handled in a manner similar to EnvelopedData.

      o AuthEnvelopedData can be used to protect the content types with
        algorithms that support authenticated encryption, where key
        management information is handled in a manner similar to
        EnvelopedData.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Using%20the%20application%2Fcms%20Media%20Type"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Using the application/cms Media Type</span>

   The media type and parameters for carrying a key package receipt or a
   key package error content type are specified in [<a href="rfc7193.html" title='"The application/cms Media Type"'>RFC7193</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  IANA Considerations</span>

   IANA has updated the reference for the following registration in the
   "SMI Security for S/MIME Module Identifier (1.2.840.113549.1.9.16.0)"
   registry:

      63  id-mod-keyPkgReceiptAndErrV2  [<a href="rfc7191.html">RFC7191</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   The key package receipt and key package error contents are not
   necessarily protected.  These content types can be combined with a
   security protocol to protect the contents of the package.

   The KeyPkgReceiptReq structure includes a receiptsFrom list and a
   receiptsTo list.  Both lists contain SIREntityNames.  The syntax does
   not specify a limit on the number of SIREntityNames that may be



<span class="grey">Housley                      Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   included in either of these lists.  In addition, there is
   purposefully no requirement that the receiptTo entries have any
   relation to the sender of the key package.  To avoid these features
   being used as part of a denial-of-service amplification, receipts
   should only be returned for key packages with a valid signature from
   a trusted signer.

   If an implementation is willing to accept key packages from more than
   one source, then there is a possibility that the same key package
   identifier could be used by more than one source.  As a result, there
   is the potential for a receipt for one key package to be confused
   with the receipt for another, potentially leading to confusion about
   the keying material that is available to the recipient.  In
   environments with multiple key sources, a convention for assignment
   of key package identifiers can avoid this potential confusion
   altogether.

   In some situations, returning very detailed error information can
   provide an attacker with insight into the security processing.  Where
   this is a concern, the implementation should return the most generic
   error code that is appropriate.  However, detailed error codes are
   very helpful during development, debugging, and interoperability
   testing.  For this reason, implementations may want to have a way to
   configure the use of a generic error code or a detailed one.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Acknowledgements"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Acknowledgements</span>

   Many thanks to Radia Perlman, Sean Turner, Jim Schaad, and Carl
   Wallace for their insightful review.  Thanks to Robert Sparks for
   improved wording.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2634" name="ref-RFC2634">RFC2634</a>]  Hoffman, P., Ed., "Enhanced Security Services for S/MIME",
              <a href="rfc2634.html">RFC 2634</a>, June 1999.

   [<a id="ref-RFC4073" name="ref-RFC4073">RFC4073</a>]  Housley, R., "Protecting Multiple Contents with the
              Cryptographic Message Syntax (CMS)", <a href="rfc4073.html">RFC 4073</a>, May 2005.

   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, May 2008.



<span class="grey">Housley                      Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   [<a id="ref-RFC5652" name="ref-RFC5652">RFC5652</a>]  Housley, R., "Cryptographic Message Syntax (CMS)", STD 70,
              <a href="rfc5652.html">RFC 5652</a>, September 2009.

   [<a id="ref-RFC5912" name="ref-RFC5912">RFC5912</a>]  Hoffman, P. and J. Schaad, "New ASN.1 Modules for the
              Public Key Infrastructure Using X.509 (PKIX)", <a href="rfc5912.html">RFC 5912</a>,
              June 2010.

   [<a id="ref-RFC5958" name="ref-RFC5958">RFC5958</a>]  Turner, S., "Asymmetric Key Packages", <a href="rfc5958.html">RFC 5958</a>, August
              2010.

   [<a id="ref-RFC6010" name="ref-RFC6010">RFC6010</a>]  Housley, R., Ashmore, S., and C. Wallace, "Cryptographic
              Message Syntax (CMS) Content Constraints Extension", <a href="rfc6010.html">RFC</a>
              <a href="rfc6010.html">6010</a>, September 2010.

   [<a id="ref-RFC6019" name="ref-RFC6019">RFC6019</a>]  Housley, R., "BinaryTime: An Alternate Format for
              Representing Date and Time in ASN.1", <a href="rfc6019.html">RFC 6019</a>, September
              2010.

   [<a id="ref-RFC6031" name="ref-RFC6031">RFC6031</a>]  Turner, S. and R. Housley, "Cryptographic Message Syntax
              (CMS) Symmetric Key Package Content Type", <a href="rfc6031.html">RFC 6031</a>,
              December 2010.

   [<a id="ref-RFC6032" name="ref-RFC6032">RFC6032</a>]  Turner, S. and R. Housley, "Cryptographic Message Syntax
              (CMS) Encrypted Key Package Content Type", <a href="rfc6032.html">RFC 6032</a>,
              December 2010.

   [<a id="ref-RFC6268" name="ref-RFC6268">RFC6268</a>]  Schaad, J. and S. Turner, "Additional New ASN.1 Modules
              for the Cryptographic Message Syntax (CMS) and the Public
              Key Infrastructure Using X.509 (PKIX)", <a href="rfc6268.html">RFC 6268</a>, July
              2011.

   [<a id="ref-RFC7193" name="ref-RFC7193">RFC7193</a>]  Turner, S., Housley, R., and J. Schaad, "The
              application/cms Media Type", <a href="rfc7193.html">RFC 7193</a>, April 2014.

   [<a id="ref-X.680" name="ref-X.680">X.680</a>]    ITU-T Recommendation X.680 (2002) | ISO/IEC 8824-1:2002.
              Information Technology - Abstract Syntax Notation One.

   [<a id="ref-X.681" name="ref-X.681">X.681</a>]    ITU-T Recommendation X.681 (2002) | ISO/IEC 8824-2:2002.
              Information Technology - Abstract Syntax Notation One:
              Information Object Specification.

   [<a id="ref-X.682" name="ref-X.682">X.682</a>]    ITU-T Recommendation X.682 (2002) | ISO/IEC 8824-3:2002.
              Information Technology - Abstract Syntax Notation One:
              Constraint Specification.

   [<a id="ref-X.683" name="ref-X.683">X.683</a>]    ITU-T Recommendation X.683 (2002) | ISO/IEC 8824-4:2002.
              Information Technology - Abstract Syntax Notation One:
              Parameterization of ASN.1 Specifications.



<span class="grey">Housley                      Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   [<a id="ref-X.690" name="ref-X.690">X.690</a>]    ITU-T Recommendation X.690 (2002) | ISO/IEC 8825- 1:2002.
              Information Technology - ASN.1 encoding rules:
              Specification of Basic Encoding Rules (BER), Canonical
              Encoding Rules (CER) and Distinguished Encoding Rules
              (DER).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-RFC5083" name="ref-RFC5083">RFC5083</a>]  Housley, R., "Cryptographic Message Syntax (CMS)
              Authenticated-Enveloped-Data Content Type", <a href="rfc5083.html">RFC 5083</a>,
              November 2007.

   [<a id="ref-RFC5934" name="ref-RFC5934">RFC5934</a>]  Housley, R., Ashmore, S., and C. Wallace, "Trust Anchor
              Management Protocol (TAMP)", <a href="rfc5934.html">RFC 5934</a>, August 2010.





































<span class="grey">Housley                      Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20ASN.1%20Module"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  ASN.1 Module</span>

   This annex provides the normative ASN.1 definitions for the
   structures described in this specification using ASN.1 as defined in
   [<a href="#ref-X.680">X.680</a>], [<a href="#ref-X.681">X.681</a>], [<a href="#ref-X.682">X.682</a>], and [<a href="#ref-X.683">X.683</a>].

   KeyPackageReceiptAndErrorModuleV2
     { iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9)
       smime(16) modules(0) id-mod-keyPkgReceiptAndErrV2(63) }

   DEFINITIONS IMPLICIT TAGS ::=

   BEGIN

   -- EXPORTS ALL

   IMPORTS

   -- FROM New SMIME ASN.1 [<a href="rfc6268.html" title='"Additional New ASN.1 Modules for the Cryptographic Message Syntax (CMS) and the Public Key Infrastructure Using X.509 (PKIX)"'>RFC6268</a>]

   CONTENT-TYPE
     FROM CryptographicMessageSyntax-2010
       { iso(1) member-body(2) us(840) rsadsi(113549)
         pkcs(1) pkcs-9(9) smime(16) modules(0) id-mod-cms-2009(58) }

   -- From New PKIX ASN.1 [<a href="rfc5912.html" title='"New ASN.1 Modules for the Public Key Infrastructure Using X.509 (PKIX)"'>RFC5912</a>]

   ATTRIBUTE, SingleAttribute {}
     FROM PKIX-CommonTypes-2009
       { iso(1) identified-organization(3) dod(6) internet(1)
         security(5) mechanisms(5) pkix(7) id-mod(0)
         id-mod-pkixCommon-02(57) }

   DistinguishedName
     FROM PKIX1Explicit-2009
       { iso(1) identified-organization(3) dod(6) internet(1)
         security(5) mechanisms(5) pkix(7) id-mod(0)
         id-mod-pkix1-explicit-02(51)}
   ;

   ---
   --- Key Package Version Number (revised from [<a href="rfc6031.html" title='"Cryptographic Message Syntax (CMS) Symmetric Key Package Content Type"'>RFC6031</a>])
   ---

   KeyPkgVersion ::= INTEGER  { v1(1), v2(2) } (1 .. 65535)






<span class="grey">Housley                      Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   --
   -- SIR Entity Name
   --

   SIREntityNames ::= SEQUENCE SIZE (1..MAX) OF SIREntityName

   SIREntityNameTypes SIR-ENTITY-NAME ::= {
       siren-dn,
       ... -- Expect additional SIR Entity Name types -- }

   SIR-ENTITY-NAME ::= CLASS {
       &amp;sIRENType OBJECT IDENTIFIER UNIQUE,
       &amp;SIRENValue
       } WITH SYNTAX {
       SYNTAX &amp;SIRENValue IDENTIFIED BY &amp;sIRENType }

   SIREntityName ::= SEQUENCE {
       sirenType      SIR-ENTITY-NAME.&amp;sIRENType({SIREntityNameTypes}),
       sirenValue     OCTET STRING (CONTAINING
                        SIR-ENTITY-NAME.&amp;SIRENValue(
                          {SIREntityNameTypes}{@sirenType}) ) }

   siren-dn SIR-ENTITY-NAME ::= {
       SYNTAX DistinguishedName
       IDENTIFIED BY id-dn }

   id-dn OBJECT IDENTIFIER ::= {
       joint-iso-ccitt(2) country(16) us(840) organization(1)
       gov(101) dod(2) infosec(1) sir-name-types(16) 0 }

   --
   -- Attribute Definitions
   --

   aa-keyPackageIdentifierAndReceiptRequest ATTRIBUTE ::= {
       TYPE KeyPkgIdentifierAndReceiptReq
       IDENTIFIED BY id-aa-KP-keyPkgIdAndReceiptReq }
   id-aa-KP-keyPkgIdAndReceiptReq OBJECT IDENTIFIER ::= {
       joint-iso-itu-t(2) country(16) us(840) organization(1)
       gov(101) dod(2) infosec(1) attributes(5) 65 }

   KeyPkgIdentifierAndReceiptReq ::= SEQUENCE {
       pkgID       KeyPkgID,
       receiptReq  KeyPkgReceiptReq OPTIONAL }

   KeyPkgID ::= OCTET STRING





<span class="grey">Housley                      Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   KeyPkgReceiptReq ::= SEQUENCE {
       encryptReceipt     BOOLEAN DEFAULT FALSE,
       receiptsFrom   [0] SIREntityNames OPTIONAL,
       receiptsTo         SIREntityNames }

   --
   -- Content Type Definitions
   --

   KeyPackageContentTypes CONTENT-TYPE ::= {
     ct-key-package-receipt |
     ct-key-package-error,
     ... -- Expect additional content types -- }

   -- Key Package Receipt CMS Content Type

   ct-key-package-receipt CONTENT-TYPE ::= {
       TYPE KeyPackageReceipt
       IDENTIFIED BY id-ct-KP-keyPackageReceipt }

   id-ct-KP-keyPackageReceipt OBJECT IDENTIFIER ::= {
       joint-iso-itu-t(2) country(16) us(840) organization(1)
       gov(101) dod(2) infosec(1) formats(2)
       key-package-content-types(78) 3 }

   KeyPackageReceipt ::= SEQUENCE {
       version          KeyPkgVersion DEFAULT v2,
       receiptOf        KeyPkgIdentifier,
       receivedBy       SIREntityName }

   KeyPkgIdentifier ::= CHOICE {
       pkgID            KeyPkgID,
       attribute        SingleAttribute {{ KeyPkgIdentifiers }} }

   KeyPkgIdentifiers ATTRIBUTE ::= { ... }

   -- Key Package Receipt CMS Content Type

   ct-key-package-error CONTENT-TYPE ::= {
       TYPE KeyPackageError IDENTIFIED BY id-ct-KP-keyPackageError }

   id-ct-KP-keyPackageError OBJECT IDENTIFIER ::= {
       joint-iso-itu-t(2) country(16) us(840) organization(1)
       gov(101) dod(2) infosec(1) formats(2)
       key-package-content-types(78) 6 }






<span class="grey">Housley                      Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


   KeyPackageError ::= SEQUENCE {
       version        KeyPkgVersion DEFAULT v2,
       errorOf    [0] KeyPkgIdentifier OPTIONAL,
       errorBy        SIREntityName,
       errorCode      ErrorCodeChoice }

   ErrorCodeChoice ::= CHOICE {
       enum           EnumeratedErrorCode,
       oid            OBJECT IDENTIFIER }

   EnumeratedErrorCode ::= ENUMERATED {
       decodeFailure                     (1),
       badContentInfo                    (2),
       badSignedData                     (3),
       badEncapContent                   (4),
       badCertificate                    (5),
       badSignerInfo                     (6),
       badSignedAttrs                    (7),
       badUnsignedAttrs                  (8),
       missingContent                    (9),
       noTrustAnchor                    (10),
       notAuthorized                    (11),
       badDigestAlgorithm               (12),
       badSignatureAlgorithm            (13),
       unsupportedKeySize               (14),
       unsupportedParameters            (15),
       signatureFailure                 (16),
       insufficientMemory               (17),
       incorrectTarget                  (23),
       missingSignature                 (29),
       resourcesBusy                    (30),
       versionNumberMismatch            (31),
       revokedCertificate               (33),

   --  Error codes with values &lt;= 33 are aligned with [<a href="rfc5934.html" title='"Trust Anchor Management Protocol (TAMP)"'>RFC5934</a>]

       ambiguousDecrypt                 (60),
       noDecryptKey                     (61),
       badEncryptedData                 (62),
       badEnvelopedData                 (63),
       badAuthenticatedData             (64),
       badAuthEnvelopedData             (65),
       badKeyAgreeRecipientInfo         (66),
       badKEKRecipientInfo              (67),
       badEncryptContent                (68),
       badEncryptAlgorithm              (69),
       missingCiphertext                (70),
       decryptFailure                   (71),



<span class="grey">Housley                      Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc7191.html">RFC 7191</a>             Key Package Receipts and Errors          April 2014</span>


       badMACAlgorithm                  (72),
       badAuthAttrs                     (73),
       badUnauthAttrs                   (74),
       invalidMAC                       (75),
       mismatchedDigestAlg              (76),
       missingCertificate               (77),
       tooManySigners                   (78),
       missingSignedAttributes          (79),
       derEncodingNotUsed               (80),
       missingContentHints              (81),
       invalidAttributeLocation         (82),
       badMessageDigest                 (83),
       badKeyPackage                    (84),
       badAttributes                    (85),
       attributeComparisonFailure       (86),
       unsupportedSymmetricKeyPackage   (87),
       unsupportedAsymmetricKeyPackage  (88),
       constraintViolation              (89),
       ambiguousDefaultValue            (90),
       noMatchingRecipientInfo          (91),
       unsupportedKeyWrapAlgorithm      (92),
       badKeyTransRecipientInfo         (93),
       other                           (127),
       ... -- Expect additional error codes  -- }

   END

Author's Address

   Russ Housley
   Vigil Security, LLC
   918 Spring Knoll Drive
   Herndon, VA 20170
   USA

   EMail: housley@vigilsec.com















Housley                      Standards Track                   [Page 25]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7191 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:25 GMT --></html>