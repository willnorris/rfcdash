<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6631 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:14:20 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.127" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6631" name="DC.Identifier"/>
<meta content="The Internet Key Exchange protocol version 2 (IKEv2) does not allow
secure peer authentication when using short credential strings, i.e.,
passwords. Several proposals have been made to integrate password-
authentication protocols into IKE. This document provides an
adaptation of Password Authenticated Connection Establishment (PACE)
to the setting of IKEv2 and demonstrates the advantages of this
integration. This document defines an Experimental Protocol for the
Internet community." name="DC.Description.Abstract"/>
<meta content="Sheffer, Yaron" name="DC.Creator"/>
<meta content="Kuegler, Dennis" name="DC.Creator"/>
<meta content="June, 2012" name="DC.Date.Issued"/>
<meta content="Password Authenticated Connection Establishment with the Internet Key Exchange Protocol version 2 (IKEv2)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6631 - Password Authenticated Connection Establishment with the Internet Key Exchange Protocol version 2 (IKEv2)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgyellow" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6631.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6631" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-kuegler-ipsecme-pace-ikev2" title="draft-kuegler-ipsecme-pace-ikev2">draft-kuegler-i...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6631" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6631" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6631" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                            EXPERIMENTAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                        D. Kuegler
Request for Comments: 6631                                           BSI
Category: Experimental                                        Y. Sheffer
ISSN: 2070-1721                                                 Porticor
                                                               June 2012


            <span class="h1">Password Authenticated Connection Establishment</span>
       <span class="h1">with the Internet Key Exchange Protocol version 2 (IKEv2)</span>

Abstract

   The Internet Key Exchange protocol version 2 (IKEv2) does not allow
   secure peer authentication when using short credential strings, i.e.,
   passwords.  Several proposals have been made to integrate password-
   authentication protocols into IKE.  This document provides an
   adaptation of Password Authenticated Connection Establishment (PACE)
   to the setting of IKEv2 and demonstrates the advantages of this
   integration.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for examination, experimental implementation, and
   evaluation.

   This document defines an Experimental Protocol for the Internet
   community.  This document is a product of the Internet Engineering
   Task Force (IETF).  It represents the consensus of the IETF
   community.  It has received public review and has been approved for
   publication by the Internet Engineering Steering Group (IESG).  Not
   all documents approved by the IESG are a candidate for any level of
   Internet Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6631">http://www.rfc-editor.org/info/rfc6631</a>.














<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


Copyright Notice

   Copyright (c) 2012 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Terminology ................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Overview ........................................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Protocol Sequence ...............................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. The IKE_SA_INIT Exchange ...................................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. The IKE_AUTH Exchange, Round #1 ............................<a href="#page-7">7</a>
      <a href="#section-3.3">3.3</a>. The IKE_AUTH Exchange, Round #2 ............................<a href="#page-7">7</a>
      <a href="#section-3.4">3.4</a>. Public Key Validation ......................................<a href="#page-8">8</a>
      <a href="#section-3.5">3.5</a>. Creating a Long-Term Shared Secret .........................<a href="#page-9">9</a>
      <a href="#section-3.6">3.6</a>. Using the Long-Term Shared Secret .........................<a href="#page-11">11</a>
   <a href="#section-4">4</a>. Encrypting and Mapping the Nonce ...............................<a href="#page-11">11</a>
      <a href="#section-4.1">4.1</a>. Encrypting the Nonce ......................................<a href="#page-11">11</a>
      <a href="#section-4.2">4.2</a>. Mapping the Nonce .........................................<a href="#page-12">12</a>
           <a href="#section-4.2.1">4.2.1</a>. Modular Diffie-Hellman .............................<a href="#page-13">13</a>
           <a href="#section-4.2.2">4.2.2</a>. Elliptic Curve Diffie-Hellman ......................<a href="#page-13">13</a>
   <a href="#section-5">5</a>. Protocol Details ...............................................<a href="#page-13">13</a>
      <a href="#section-5.1">5.1</a>. Password Processing .......................................<a href="#page-13">13</a>
      <a href="#section-5.2">5.2</a>. The SECURE_PASSWORD_METHODS Notification ..................<a href="#page-14">14</a>
      <a href="#section-5.3">5.3</a>. The PSK_PERSIST Notification ..............................<a href="#page-15">15</a>
      <a href="#section-5.4">5.4</a>. The PSK_CONFIRM Notification ..............................<a href="#page-15">15</a>
      <a href="#section-5.5">5.5</a>. The GSPM(ENONCE) Payload ..................................<a href="#page-15">15</a>
      <a href="#section-5.6">5.6</a>. The KE (KEi2/KEr2) Payloads in PACE .......................<a href="#page-16">16</a>
      <a href="#section-5.7">5.7</a>. PACE and Session Resumption ...............................<a href="#page-16">16</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-16">16</a>
      <a href="#section-6.1">6.1</a>. Credential Security Assumptions ...........................<a href="#page-16">16</a>
      <a href="#section-6.2">6.2</a>. Vulnerability to Passive and Active Attacks ...............<a href="#page-16">16</a>
      <a href="#section-6.3">6.3</a>. Perfect Forward Secrecy ...................................<a href="#page-17">17</a>
      <a href="#section-6.4">6.4</a>. Randomness ................................................<a href="#page-17">17</a>
      <a href="#section-6.5">6.5</a>. Identity Protection .......................................<a href="#page-17">17</a>
      <a href="#section-6.6">6.6</a>. Denial of Service .........................................<a href="#page-17">17</a>




<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


      <a href="#section-6.7">6.7</a>. Choice of Encryption Algorithms ...........................<a href="#page-17">17</a>
      <a href="#section-6.8">6.8</a>. Security Model and Security Proof .........................<a href="#page-18">18</a>
      <a href="#section-6.9">6.9</a>. Long-Term Credential Storage ..............................<a href="#page-18">18</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-19">19</a>
   <a href="#section-8">8</a>. Acknowledgments ................................................<a href="#page-19">19</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-19">19</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-19">19</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-20">20</a>
   <a href="#appendix-A">Appendix A</a>. Protocol Selection Criteria ...........................<a href="#page-22">22</a>
     <a href="#appendix-A.1">A.1</a>. Security Criteria ..........................................<a href="#page-22">22</a>
     <a href="#appendix-A.2">A.2</a>. Intellectual Property Criteria .............................<a href="#page-22">22</a>
     <a href="#appendix-A.3">A.3</a>. Miscellaneous Criteria .....................................<a href="#page-22">22</a>
   <a href="#appendix-B">Appendix B</a>. Password Salting ......................................<a href="#page-23">23</a>
     <a href="#appendix-B.1">B.1</a>. Solving the Asymmetric Case with Symmetric Cryptography ....<a href="#page-24">24</a>
     B.2. Solving the Fully Symmetric Case with Asymmetric
          Cryptography ...............................................<a href="#page-25">25</a>
     <a href="#appendix-B.3">B.3</a>. Generation of a Strong, Long-Term, Shared Secret ...........<a href="#page-26">26</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   PACE [<a href="#ref-TR03110" title='"TR-03110, Advanced Security Mechanisms for Machine Readable Travel Documents, Part 2 - Extended Access Control Version 2 (EACv2), Password Authenticated Connection Establishment (PACE), and Restricted Identification (RI)"'>TR03110</a>] is a security protocol that establishes a mutually
   authenticated (and encrypted) channel between two parties based on
   weak (short) passwords.  PACE provides strong session keys that are
   independent of the strength of the password.  PACE belongs to a
   family of protocols often referred to as Zero-Knowledge Password
   Proof (ZKPP) protocols, all of which amplify weak passwords into
   strong session keys.  This document describes the integration of PACE
   into IKEv2 [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>] as a new authentication mode, analogous to the
   existing certificate and Pre-Shared Key (PSK) authentication modes.

   Some of the advantages of our approach, compared to the existing
   IKEv2, include the following:

   o  The current best practice to implement password authentication in
      IKE involves certificate-based authentication of the server plus
      some Extensible Authentication Protocol (EAP) method to
      authenticate the client.  This involves two non-trivial
      infrastructure components (PKI and EAP/AAA).  Moreover,
      certificate authentication is hard to get right and often depends
      on unreliable user behavior for its security.

   o  Alternatively, native IKEv2 shared secret authentication can be
      used with passwords.  However, this usage is insecure;
      specifically, it is vulnerable to active attackers.







<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   o  Some newer EAP methods can be used for mutual authentication and,
      combined with [<a href="rfc5998.html" title='"An Extension for EAP-Only Authentication in IKEv2"'>RFC5998</a>], can be well integrated into IKEv2.  This
      is certainly an option in some cases, but the current proposal may
      be simpler to implement.

   Compared to other protocols aiming at similar goals, PACE has several
   advantages.  PACE was designed to allow for a high level of
   flexibility with respect to cryptographic algorithms; e.g., it can be
   implemented based on Modular Diffie-Hellman as well as Elliptic Curve
   Diffie-Hellman without any restrictions on the mathematical group to
   be used, other than the requirement that the group be
   cryptographically secure.  The protocol itself is also proven to be
   cryptographically secure [<a href="#ref-PACEsec" title='"Security Analysis of the PACE Key-Agreement Protocol"'>PACEsec</a>].  The PACE protocol is currently
   used in an international standard for digital travel documents
   [<a href="#ref-ICAO" title='"Supplemental Access Control for Machine Readable Travel Documents"'>ICAO</a>].

   The integration aims at keeping IKEv2 unchanged as much as possible;
   e.g., the mechanisms used to establish Child security associations
   (SAs) as provided by IKEv2 would be maintained with no change.

   The Password-Authenticated Key Exchange (PAKE) framework document
   [<a href="rfc6467.html" title='"Secure Password Framework for Internet Key Exchange Version 2 (IKEv2)"'>RFC6467</a>] defines a set of payloads for different types of PAKE
   methods within IKEv2.  This document reuses this framework.  Note
   that the current document is self-contained; i.e., all relevant
   payloads and semantics are redefined here.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The following notation is used in this document:

      E()      Symmetric encryption
      D()      Symmetric decryption
      KA()     Key agreement
      Map()    Mapping function
      Pwd      Shared password
      SPwd     Stored password
      KPwd     Symmetric key derived from a password Pwd
      G        Static group generator
      GE       Ephemeral group generator
      ENONCE   Encrypted nonce
      PKEi     Ephemeral public key of the initiator
      SKEi     Ephemeral secret key of the initiator





<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


      PKEr     Ephemeral public key of the responder
      SKEr     Ephemeral secret key of the responder
      AUTH     Authentication payload

   Any other notation used here is defined in [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Overview"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Overview</span>

   At a high level, the following steps are performed by the initiator
   and the responder.  They result in a two-round IKE_AUTH exchange,
   described in <a href="#section-3">Section 3</a> below.

   1.  The initiator randomly and uniformly chooses a nonce s, encrypts
       the nonce using the password, and sends the ciphertext

          ENONCE = E(KPwd, s)

       to the responder.  The responder recovers the plaintext nonce s
       with the help of the shared password Pwd.

   2.  The nonce s is mapped to an ephemeral generator

          GE = G^s * SASharedSecret,

       where G is the generator of the selected Modular Exponential
       (MODP) group and SASharedSecret is a shared secret that has been
       generated in the IKE_SA_INIT step.

   3.  Both the initiator and the responder each calculate an ephemeral
       key pair

          (SKEi, PKEi = GE^SKEi) and (SKEr, PKEr=GE^SKEr),

       respectively, based on the ephemeral generator GE, and exchange
       the public keys.

   4.  Finally, they compute the shared secret

          PACESharedSecret = PKEi^SKEr = PKEr^SKEi

       and generate, exchange, and verify the IKE authentication token
       AUTH using the shared secret PACESharedSecret.

   The encryption function E() must be carefully chosen to prevent
   dictionary attacks that would otherwise allow an attacker to recover
   the password.  Those restrictions are described in <a href="#section-4.1">Section 4.1</a>.
   Details on the mapping function, including the elliptic curve
   variant, can be found in <a href="#section-4.2">Section 4.2</a>.



<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   To avoid the risks inherent in storing a short password (e.g., the
   fact that passwords are often reused for different applications),
   this protocol allows the peers to jointly convert the password into a
   cryptographically stronger shared secret.  This shared secret can
   then be stored by both peers, in lieu of the original password or its
   salted variants.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Protocol%20Sequence"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Protocol Sequence</span>

   The protocol consists of three round trips -- an IKE_SA_INIT exchange
   and a 2-round IKE_AUTH exchange -- as shown in the next figure.  An
   optional Informational exchange may follow (see <a href="#section-3.5">Section 3.5</a>).

     Initiator                      Responder
     ---------                      ---------

     IKE_SA_INIT:

     HDR, SAi1, KEi, Ni, N(SECURE_PASSWORD_METHODS)  -&gt;

                      &lt;- HDR, SAr1, KEr, Nr, N(SECURE_PASSWORD_METHODS)

     IKE_AUTH round #1:

     HDR, SK{IDi, [IDr,], SAi2,
             TSi, TSr, GSPM(ENONCE), KEi2} -&gt;

                                                  &lt;- HDR, SK{IDr, KEr2}

     IKE_AUTH round #2:

     HDR, SK{AUTH [, N(PSK_PERSIST)] } -&gt;

                   &lt;- HDR, SK{AUTH, SAr2, TSi, TSr [, N(PSK_PERSIST)] }

                     Figure 1: IKE SA Setup with PACE

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20The%20IKE_SA_INIT%20Exchange"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  The IKE_SA_INIT Exchange</span>

   The initiator sends a SECURE_PASSWORD_METHODS notification that
   indicates its support of this extension and its wish to authenticate
   using a password.  The following text assumes that the responder sent
   back a SECURE_PASSWORD_METHODS notification that indicates its
   preference for PACE.







<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   If PACE was chosen, the algorithms negotiated in SAi1 and SAr1 are
   also used for the execution of PACE, i.e., the key agreement protocol
   (Modular Diffie-Hellman or Elliptic Curve Diffie-Hellman), the group
   to be used, and the encryption algorithm.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20The%20IKE_AUTH%20Exchange%2C%20Round%20%231"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  The IKE_AUTH Exchange, Round #1</span>

   This is the first part of the PACE authentication of the peers.  This
   exchange MUST NOT be used unless both peers indicated support of this
   protocol.

   The initiator selects a random nonce s and encrypts it to form ENONCE
   using the password Pwd, as described in <a href="#section-4.1">Section 4.1</a>.  Then, the
   initiator maps the nonce to an ephemeral generator GE of the group as
   described in <a href="#section-4.2">Section 4.2</a>, chooses randomly and uniformly an ephemeral
   key pair (SKEi,PKEi) based on the ephemeral generator, and finally
   generates the payloads GSPM(ENONCE) containing the encrypted nonce
   and KEi2 containing the ephemeral public key.

   The responder decrypts the received encrypted nonce s = D(KPwd,
   ENONCE), performs the mapping, and randomly and uniformly chooses an
   ephemeral key pair (SKEr,PKEr) based on the ephemeral generator GE.
   The responder generates the KEr2 payload containing the ephemeral
   public key.

   The request is equivalent to the IKE_AUTH request in a normal IKEv2
   exchange; i.e., any payload that is valid in an IKE_AUTH request is
   valid (with the same semantics) in this round's request.  In
   particular, certificate-related payloads are allowed, even though
   their use may not be practical within this mode.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20The%20IKE_AUTH%20Exchange%2C%20Round%20%232"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  The IKE_AUTH Exchange, Round #2</span>

   This is the second part of the PACE authentication of the peers.

   The initiator and the responder calculate the shared secret
   PACESharedSecret

      PACESharedSecret = KA(SKEi, PKEr, GE) = KA(SKEr, PKEi, GE),

   where KA denotes the Diffie-Hellman key agreement, e.g., (for MODP
   groups), modular exponentiation.  Then, they calculate the
   authentication tokens AUTHi and AUTHr.

   The initiator calculates

      AUTHi = prf(prf+(Ni | Nr, PACESharedSecret),
      &lt;InitiatorSignedOctets&gt; | PKEr)



<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   See <a href="rfc5996.html#section-2.15">Section 2.15 of [RFC5996]</a> for the definition of signed octets.

   The responder calculates

      AUTHr = prf(prf+(Ni | Nr, PACESharedSecret),
      &lt;ResponderSignedOctets&gt; | PKEi)

   Both AUTH payloads MUST indicate as their authentication method the
   Generic Secure Password Authentication Method [<a href="rfc6467.html" title='"Secure Password Framework for Internet Key Exchange Version 2 (IKEv2)"'>RFC6467</a>], whose value
   is 12.  The authentication tokens are exchanged, and each of them
   MUST be verified by the other party.  The behavior when this
   verification fails is unchanged from [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>].

   Each of the peers MAY generate a long-term credential at this point,
   after it has verified the opposite peer's identity.  The shared
   secret is

      LongTermSecret = prf(Ni | Nr, "PACE Generated PSK" |
      PACESharedSecret),

   where the literal string is ASCII-encoded, with no zero terminator.
   The generated secret MUST be persisted to stable memory before
   sending the response.  See <a href="#section-3.5">Section 3.5</a> for more details about this
   facility.

   This round's response is equivalent to the IKE_AUTH response in a
   normal IKEv2 exchange; i.e., any payload that is valid in an IKE_AUTH
   response is valid (with the same semantics) in the second round's
   response.

   Following authentication, all temporary values MUST be deleted by the
   peers, including in particular s, the ephemeral generator, the
   ephemeral key pairs, and PACESharedSecret.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Public%20Key%20Validation"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Public Key Validation</span>

   The security of the protocol relies on the entanglement of a weak
   password with cryptographically strong shared secrets, SASharedSecret
   and PACESharedSecret, mutually and randomly generated by the
   initiator and the responder.  If an attacker can influence the
   randomness of those shared secrets, the confidentiality of the
   password may be directly affected.

   Implementations MUST therefore verify that the shared secrets
   SASharedSecret and PACESharedSecret are random elements of the group
   generated by G to prevent small subgroup attacks.  This can be
   achieved by a validation of the public keys (i.e., KEi, PKEi, and
   KEr, PKEr).



<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   First of all, each party MUST check that the public keys PKEi, PKEr,
   KEi, and KEr differ.  Otherwise, it MUST abort the protocol.

   For each received public key PK, the following tests SHOULD be
   performed.  Any failure in the validation MUST be interpreted as an
   attack, and the protocol SHALL be aborted.

   o  Verify that PK is an element of the Diffie-Hellman Group.

      *  For Modular Diffie-Hellman, check that PK lies within the
         interval [2,p-2].

      *  For Elliptic Curve Diffie-Hellman, check that PK is a point on
         the Elliptic Curve and not the point at infinity.

   o  Verify that PK is an element of the cryptographic subgroup of
      order q.

      *  For Modular Diffie-Hellman, check that PK^q = 1 (mod p).

      *  For Elliptic Curve Diffie-Hellman, check that q * PK = 0.

   Note that for most of the MODP groups, the order q = (p-1)/2.  This
   applies in particular to the standard groups #2, #5, and #14,
   commonly used in IKE.  For ECP and MODP groups not based on safe
   primes, the order q is explictly stated in the parameters.

   As an alternative to the public key validation, the compatible
   cofactor exponentiation/multiplication may be used, which is often
   more efficient but requires changes to the implementation of the key
   agreement.  Details on the implementation can be found in [<a href="rfc2785.html" title='"Methods for Avoiding the "'>RFC2785</a>]
   and in [<a href="#ref-TR03111" title='"TR-03111, Elliptic Curve Cryptography"'>TR03111</a>] for Modular Diffie-Hellman and Elliptic Curve
   Diffie-Hellman, respectively.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20%20Creating%20a%20Long-Term%20Shared%20Secret"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>.  Creating a Long-Term Shared Secret</span>

   To reduce the time that the peers store a hashed password, it is
   RECOMMENDED that the password be replaced by a dedicated shared
   secret, according to the method described in this section.  See
   <a href="#appendix-B">Appendix B</a> for more discussion of the security threats involved.

   Both peers generate the value LongTermSecret during round #2 of
   IKE_AUTH, as shown above.  Later on, they exchange a PERSIST_PSK
   notification.  Assume that both peers support this mechanism (e.g.,
   the IKE implementation is able to modify its own credential store).
   Then, each of the peers, when receiving the notification, permanently





<span class="grey">Kuegler &amp; Sheffer             Experimental                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   deletes the stored password and replaces it with LongTermSecret.
   These credentials are stored in the Peer Authorization Database (PAD)
   [<a href="rfc4301.html" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>] and are associated with the identity of the opposite peer.

   This solution is designed as a two-phase commitment, so that failure
   at any time cannot result in the peers not having any shared secret.

     Initiator                      Responder
     ---------                      ---------

     IKE_AUTH round #2:

     HDR, SK{..., N(PSK_PERSIST)} ----------&gt;
                                 Responder computes and stores PSK

                           &lt;------- HDR, SK{..., N(PSK_PERSIST)}

     Initiator computes and stores PSK

     HDR, SK{N(PSK_CONFIRM)} --------------&gt;

                                 Responder deletes the short password

                           &lt;-------------- HDR, SK{N(PSK_CONFIRM)}

     Initiator deletes the short password

            Figure 2: IKE SA Setup with PACE and PSK Generation

   In the second round of IKE_AUTH, the initiator MAY send a PSK_PERSIST
   notification if it wishes to use this mechanism.  If the responder
   agrees, and only after it has authenticated the initiator, it MUST
   generate a new PSK, save it to stable storage (e.g., to disk), and
   MUST respond with a PSK_PERSIST notification.  Otherwise, it simply
   does not include the notification in its reply.  When receiving the
   reply, and after authenticating the responder, the initiator MUST
   also generate the PSK and save it in stable storage.

   If the peers have negotiated this mechanism, the initiator MUST send
   the PSK_CONFIRM notification in an Informational exchange shortly
   after the IKE SA has been set up.  When the responder receives it, it
   MUST delete the stored short password from its credential database
   and respond with a PSK_CONFIRM notification.  Upon receiving this
   notification, the initiator deletes its copy of the short password.

   If not saved to persistent storage, the LongTermSecret MUST be
   deleted when the IKE SA is rekeyed or when it is torn down.  It
   SHOULD be deleted 1 hour after the initial IKE SA has been set up.



<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6.%20%20Using%20the%20Long-Term%20Shared%20Secret"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a>.  Using the Long-Term Shared Secret</span>

   The LongTermSecret MUST be used as a regular IKE Pre-Shared Key
   (PSK), rather than with PACE or any other password-based
   authentication method.

   Normally, at the completion of this protocol, both peers will have
   either a shared password or a shared PSK.  The protocol is designed
   so that the peers will have a shared credential, regardless of any
   protocol failures.  However, in some failure cases, the initiator may
   find itself with both a short password and a PSK for a particular
   peer.  In that case, it MUST first try to authenticate with a
   password and, upon success, MUST attempt to convert it to a PSK.  If
   password authentication fails, it MUST use the PSK and upon
   successful setup of the IKE SA MUST permanently delete the password.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Encrypting%20and%20Mapping%20the%20Nonce"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Encrypting and Mapping the Nonce</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Encrypting%20the%20Nonce"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Encrypting the Nonce</span>

   The shared password is not used as is.  Instead, it SHOULD be
   converted into a "stored password" SPwd, so that the plaintext
   password does not need to be stored for long periods.  SPwd is
   defined as

      SPwd = prf("IKE with PACE", Pwd),

   where the literal string consists of ASCII characters with no zero
   terminator.  If the negotiated pseudorandom function (prf) requires a
   fixed-size key, the literal string is either truncated or padded with
   zero octets on the right, as needed.  Multiple copies of SPwd MAY be
   stored, if the prf function is not known in advance.

      KPwd = prf+(Ni | Nr, SPwd),

   where Ni and Nr are the regular IKE nonces, stripped of any headers.
   If the negotiated prf takes a fixed-length key and the lengths of Ni
   and Nr do not add up to that length, half the bits must come from Ni
   and half from Nr, taking the first bits of each.  "prf+" is defined
   in <a href="rfc5996.html#section-2.13">Section 2.13 of [RFC5996]</a>.  The length of KPwd is determined by
   the key length of the negotiated encryption algorithm.

   A nonce s is randomly selected by the initiator (see <a href="#section-6.4">Section 6.4</a> for
   additional considerations).  The length of s MUST be exactly
   32 octets.






<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   KPwd is now used with the encryption transform to encrypt the nonce:

      ENONCE = E(KPwd, s)

   If an Initialization Vector (IV) is required by the cipher, it MUST
   be included in the GSPM(ENONCE) payload.  It is RECOMMENDED that the
   IV be chosen both randomly and uniformly distributed, even though
   this condition is not necessary for the cryptographic security of the
   protocol.

   Note: Padding MUST NOT be used when encrypting the nonce.  The size
   of the nonce has been chosen such that it can be encrypted with block
   ciphers having block sizes of 32, 64, and 128 bits without any
   padding.

   If an authenticated encryption cipher [<a href="rfc5282.html" title='"Using Authenticated Encryption Algorithms with the Encrypted Payload of the Internet Key Exchange version 2 (IKEv2) Protocol"'>RFC5282</a>] has been negotiated
   for the IKE SA, it MUST NOT be used as is because such use would be
   vulnerable to dictionary attacks.  Instead, the corresponding
   unauthenticated mode MUST be used.  All Galois/Counter Mode (GCM) and
   all Counter with CBC-MAC (CCM) encryption algorithms are mapped to
   the corresponding counter-mode algorithm.  For example, if the
   negotiated encryption algorithm (Transform Type 1) is "AES-GCM with
   an 8-octet Integrity Check Value (ICV)", then ENCR_AES_CTR (with the
   same key length) is used to encrypt the nonce.  If such a mapping
   does not exist for a particular cipher, then it MUST NOT be used
   within the current protocol.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Mapping%20the%20Nonce"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Mapping the Nonce</span>

   The mapping is based on a second anonymous Diffie-Hellman key
   agreement protocol to create a shared secret that is used together
   with the exchanged nonce to calculate a common secret generator of
   the group.

   While in [<a href="#ref-TR03110" title='"TR-03110, Advanced Security Mechanisms for Machine Readable Travel Documents, Part 2 - Extended Access Control Version 2 (EACv2), Password Authenticated Connection Establishment (PACE), and Restricted Identification (RI)"'>TR03110</a>] the generation of the shared secret is part of the
   mapping, in the setting of IKEv2, a shared secret SASharedSecret has
   already been generated as part of the IKE_SA_INIT step.  Using the
   notation of [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>],

      SASharedSecret = g^ir

   Let G and GE be the generator of the negotiated Diffie-Hellman group,
   and the calculated ephemeral generator, respectively.  The following
   subsections describe the mapping for different Diffie-Hellman
   variants.






<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Modular%20Diffie-Hellman"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Modular Diffie-Hellman</span>

   The function Map:G-&gt;GE is defined as GE = G^s * SASharedSecret.

   Note that the protocol will fail if G^s = 1/SASharedSecret.  If s is
   chosen randomly, this event occurs with negligible probability.  In
   implementations that detect such a failure, the initiator SHOULD
   choose s again.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20Elliptic%20Curve%20Diffie-Hellman"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  Elliptic Curve Diffie-Hellman</span>

   The function Map:G-&gt;GE is defined as GE = s*G + SASharedSecret.

   Note that the protocol will fail if s*G = -SharedSecret.  If s is
   chosen randomly, this event occurs with negligible probability.  In
   implementations that detect such a failure, the initiator SHOULD
   choose s again.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Protocol%20Details"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Protocol Details</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Password%20Processing"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Password Processing</span>

   The input password string SHOULD be processed according to the rules
   of the [<a href="rfc4013.html" title='"SASLprep: Stringprep Profile for User Names and Passwords"'>RFC4013</a>] profile of [<a href="rfc3454.html" title='"Preparation of Internationalized Strings ("'>RFC3454</a>].  A password SHOULD be
   considered a "stored string" per [<a href="rfc3454.html" title='"Preparation of Internationalized Strings ("'>RFC3454</a>]; therefore, unassigned
   code points are prohibited.  The output is the binary representation
   of the processed UTF-8 character string.  Prohibited output and
   unassigned codepoints encountered in SASLprep preprocessing SHOULD
   cause a preprocessing failure, and the output SHOULD NOT be used.  A
   compliant implementation MUST NOT apply any other form of processing
   to the input password, other than as described in this section.

   See <a href="rfc4013.html#section-3">Section 3 of [RFC4013]</a> for examples of SASLprep processing.


















<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20The%20SECURE_PASSWORD_METHODS%20Notification"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  The SECURE_PASSWORD_METHODS Notification</span>

   [<a id="ref-RFC6467" name="ref-RFC6467">RFC6467</a>] defines a new type of Notify payload to indicate support
   for Secure Password Methods (SPMs) in the IKE_SA_INIT exchange.  The
   SPM Notify payload is defined as follows:

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Next Payload  |C|  RESERVED   |         Payload Length        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |  Protocol ID  |   SPI Size    |      Notify Message Type      |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                                                               |
     ~                Security Parameter Index (SPI)                 ~
     |                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                                                               |
     ~                       Notification Data                       ~
     |                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 3: SECURE_PASSWORD_METHODS Payload Structure

   The Protocol ID is zero, and the SPI Size is also zero, indicating
   that the SPI field is empty.  The Notify Message Type is
   SECURE_PASSWORD_METHODS (value 16424).

   The Notification Data contains the list of the 16-bit secure password
   method numbers:

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Secure Password Method #1     | Secure Password Method #2     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Secure Password Method #3     | ...                           |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

              Figure 4: SECURE_PASSWORD_METHODS Payload Data

   For the current method, the list of proposed methods MUST include the
   value PACE (1).








<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20The%20PSK_PERSIST%20Notification"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  The PSK_PERSIST Notification</span>

   This document defines the PSK_PERSIST notification type, whose value
   is 16425.  This notification MUST be sent with no data.  However, for
   future extensibility, the receiver MUST ignore any notification data
   if such data is present.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20The%20PSK_CONFIRM%20Notification"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  The PSK_CONFIRM Notification</span>

   This document defines the PSK_CONFIRM notification type, whose value
   is 16426.  This notification MUST be sent with no data.  However, for
   future extensibility, the receiver MUST ignore any notification data
   if such data is present.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.5.%20%20The%20GSPM%28ENONCE%29%20Payload"></a><a class="selflink" href="#section-5.5" name="section-5.5">5.5</a>.  The GSPM(ENONCE) Payload</span>

   This protocol defines the ENONCE (encrypted nonce) payload, which
   reuses the Generic SPM (GSPM) payload type [<a href="rfc6467.html" title='"Secure Password Framework for Internet Key Exchange Version 2 (IKEv2)"'>RFC6467</a>] (value 49).  Its
   format is as follows:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Next Payload  |C|  RESERVED   |         Payload Length        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | PACE-RESERVED |     Initialization Vector                     |
     +-+-+-+-+-+-+-+-+                                               +
     |     (optional, length depends on the encryption algorithm)    |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                        Encrypted Nonce                        ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 5: ENONCE Payload Structure

   See <a href="#section-4.1">Section 4.1</a> for further details about the encrypted nonce.  Note
   that the protocol -- and in particular this payload's format -- does
   not support any padding of the encrypted data.

   The PACE-RESERVED field must be sent as zero, and it must be rejected
   by the receiver if it is not 0.









<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.6.%20%20The%20KE%20%28KEi2%2FKEr2%29%20Payloads%20in%20PACE"></a><a class="selflink" href="#section-5.6" name="section-5.6">5.6</a>.  The KE (KEi2/KEr2) Payloads in PACE</span>

   PACE reuses the Key Exchange (KE) payload for its Diffie-Hellman
   exchange, with the new payloads being sent within the IKE_AUTH
   exchange.  Since only one Diffie-Hellman group is negotiated, the
   group denoted by these payloads MUST be identical to the one used in
   the "regular" KE payloads in IKE_SA_INIT.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.7.%20%20PACE%20and%20Session%20Resumption"></a><a class="selflink" href="#section-5.7" name="section-5.7">5.7</a>.  PACE and Session Resumption</span>

   A session resumption [<a href="rfc5723.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2) Session Resumption"'>RFC5723</a>] ticket may be requested during the
   IKE_AUTH exchange.  The request MUST be sent in the request of the
   first round, and any response MUST be sent in the response of the
   second one.

   PACE should be considered an "authentication method", in the sense of
   <a href="rfc5723.html#section-5">Section 5 of [RFC5723]</a>, which means that its use MUST be noted in the
   protected ticket.  The format of the ticket is not standardized;
   however, it is RECOMMENDED that this indication distinguish between
   the different secure password authentication methods defined for IKE.

   Note that even if the initial authentication used PACE and its
   extended IKE_AUTH, session resumption will still include the normal
   IKE_AUTH exchange.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   A major goal of this protocol has been to maintain the level of
   security provided by IKEv2.  What follows is an analysis of this
   protocol.  The reader is referred to [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>] for the generic IKEv2
   security considerations.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Credential%20Security%20Assumptions"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Credential Security Assumptions</span>

   This protocol makes no assumption on the strength of the shared
   credential.  Best common practices regarding minimal password length,
   use of multiple character classes, etc. SHOULD be followed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Vulnerability%20to%20Passive%20and%20Active%20Attacks"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Vulnerability to Passive and Active Attacks</span>

   The protocol is secure against both passive and active attackers.
   See <a href="#section-6.8">Section 6.8</a> for a security proof.

   While not attacking the cryptography, an attacker can still perform a
   standard password-guessing attack.  To mitigate such attacks, an
   implementation MUST include standard protections, such as rate-
   limiting the number of allowed password-guessing attempts, possibly




<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   locking identities out after a certain number of failed attempts,
   etc.  Note that the protocol is symmetric; therefore, this guidance
   applies to client-side implementations as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Perfect%20Forward%20Secrecy"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Perfect Forward Secrecy</span>

   The key derivation for the IKE SA and any Child SAs is performed as
   part of IKEv2 and remains unchanged.  It directly follows that
   perfect forward security is provided independent of the
   authentication additionally performed by PACE.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20Randomness"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  Randomness</span>

   The security of this protocol depends on the quality generation of
   random quantities; see <a href="rfc5996.html#section-5">Section 5 of [RFC5996]</a> for more details.
   Specifically, any deviation from randomness of the nonce s might
   compromise the password.  Therefore, it is strongly RECOMMENDED that
   the initiator pass the raw random material through a strong prf to
   ensure the statistical qualities of the nonce.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20Identity%20Protection"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  Identity Protection</span>

   This protocol is identical to IKEv2 in the quality of identity
   protection it provides.  Both peers' identities are secure from
   passive attackers, and both peers' identities are exposed to active,
   man-in-the-middle attackers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.6.%20%20Denial%20of%20Service"></a><a class="selflink" href="#section-6.6" name="section-6.6">6.6</a>.  Denial of Service</span>

   We are not aware of any new denial-of-service attack vector enabled
   by this protocol.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.7.%20%20Choice%20of%20Encryption%20Algorithms"></a><a class="selflink" href="#section-6.7" name="section-6.7">6.7</a>.  Choice of Encryption Algorithms</span>

   Any transforms negotiated for IKEv2 may be used by this protocol.
   Please refer to <a href="#section-4.1">Section 4.1</a> for the considerations regarding
   authenticated encryption ("combined mode") algorithms.














<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.8.%20%20Security%20Model%20and%20Security%20Proof"></a><a class="selflink" href="#section-6.8" name="section-6.8">6.8</a>.  Security Model and Security Proof</span>

   PACE is cryptographically proven secure in [<a href="#ref-PACEsec" title='"Security Analysis of the PACE Key-Agreement Protocol"'>PACEsec</a>] in the model of
   Bellare, Pointcheval, and Rogaway [<a href="#ref-BPRmodel" title='"Authenticated Key Exchange Secure against Dictionary Attacks"'>BPRmodel</a>].  The setting in which
   PACE is proven secure is, however, slightly different from the
   setting used in IKEv2.  The differences are described in the
   following:

   o  Part of the mapping is already performed within IKEv2 before PACE
      is started.  This rearrangement does not affect the proof, as the
      resulting PACESharedSecret remains close to uniformly distributed
      in the group generated by G.

   o  The keys for the IKE SA and any Child SAs are already generated
      within IKEv2 before PACE is started.  While those session keys
      could also be derived in PACE, only the keys for the
      authentication token are considered in the proof, which explicitly
      recommends a separate key for this purpose.

   o  IKEv2 allows the negotiation of a stream cipher for PACE, while
      the proven variant always uses a block cipher.  The ideal cipher
      is replaced in the proof by a lazy-sampling technique that is
      similarly applicable to the stream-cipher-based construction.

   The differences in the setting therefore have no impact on the
   validity of the proof.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.9.%20%20Long-Term%20Credential%20Storage"></a><a class="selflink" href="#section-6.9" name="section-6.9">6.9</a>.  Long-Term Credential Storage</span>

   This protocol does not require that peers store the plaintext
   password.  Instead, the value SPwd SHOULD be stored by both peers.

   In addition, the protocol allows both peers to replace the password
   by a crypto-strength shared secret.  This solution improves the
   system's security (since passwords are often used for multiple
   applications), but at the cost of implementation complexity.  In
   particular, if this optional mechanism is to be used, the credential
   database would need to be writable by the key management subsystem.

   See <a href="#appendix-B">Appendix B</a> for alternatives to this approach.











<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   IANA has allocated the following values:

   o  A PACE value of 1 from the "IKEv2 Secure Password Methods"
      registry [<a href="rfc6467.html" title='"Secure Password Framework for Internet Key Exchange Version 2 (IKEv2)"'>RFC6467</a>].

   o  A PSK_PERSIST value of 16425 and a PSK_CONFIRM value of 16426 from
      the "IKEv2 Notify Message Types - Status Types" registry.  We note
      that these notification types are generic and that other password
      authentication methods may also choose to use them.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgments"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgments</span>

   We would like to thank Dan Harkins for pointing out a security issue
   with our use of combined-mode algorithms in a previous version of the
   protocol.  We thank Tero Kivinen for his generic framework document,
   and for a thorough and fruitful review.  Hugo Krawczyk proposed that
   the password be amplified into a persistent shared secret.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                 Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2785" name="ref-RFC2785">RFC2785</a>]     Zuccherato, R., "Methods for Avoiding the "Small-
                 Subgroup" Attacks on the Diffie-Hellman Key Agreement
                 Method for S/MIME", <a href="rfc2785.html">RFC 2785</a>, March 2000.

   [<a id="ref-RFC3454" name="ref-RFC3454">RFC3454</a>]     Hoffman, P. and M. Blanchet, "Preparation of
                 Internationalized Strings ("stringprep")", <a href="rfc3454.html">RFC 3454</a>,
                 December 2002.

   [<a id="ref-RFC4013" name="ref-RFC4013">RFC4013</a>]     Zeilenga, K., "SASLprep: Stringprep Profile for User
                 Names and Passwords", <a href="rfc4013.html">RFC 4013</a>, February 2005.

   [<a id="ref-RFC4301" name="ref-RFC4301">RFC4301</a>]     Kent, S. and K. Seo, "Security Architecture for the
                 Internet Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.

   [<a id="ref-RFC5996" name="ref-RFC5996">RFC5996</a>]     Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen,
                 "Internet Key Exchange Protocol Version 2 (IKEv2)",
                 <a href="rfc5996.html">RFC 5996</a>, September 2010.







<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-BPRmodel" name="ref-BPRmodel">BPRmodel</a>]    Bellare, M., Pointcheval, D., and P. Rogaway,
                 "Authenticated Key Exchange Secure against Dictionary
                 Attacks", EUROCRYPT 2000, LNCS 1807, pp. 139-155,
                 Springer-Verlag, 2000, &lt;<a href="http://www.iacr.org/cryptodb/archive/2000/EUROCRYPT/18070139.pdf">http://www.iacr.org/cryptodb/</a>
                 <a href="http://www.iacr.org/cryptodb/archive/2000/EUROCRYPT/18070139.pdf">archive/2000/EUROCRYPT/18070139.pdf</a>&gt;.

   [<a id="ref-ICAO" name="ref-ICAO">ICAO</a>]        ISO/IEC JTC1 SC17 WG3/TF5 for the International Civil
                 Aviation Organization (ICAO), "Supplemental Access
                 Control for Machine Readable Travel Documents",
                 Version 1.01, November 2010.

   [<a id="ref-IKEv2-CONS" name="ref-IKEv2-CONS">IKEv2-CONS</a>]  Harkins, D., "Password-Based Authentication in IKEv2:
                 Selection Criteria and Considerations", Work
                 in Progress, October 2010.

   [<a id="ref-PACEsec" name="ref-PACEsec">PACEsec</a>]     Bender, J., Fischlin, M., and D. Kuegler, "Security
                 Analysis of the PACE Key-Agreement Protocol",
                 LNCS 5735, pp. 33-48, Springer-Verlag (the extended
                 abstract appeared in Information Security Conference
                 (ISC) 2009), December 2009,
                 &lt;<a href="http://eprint.iacr.org/2009/624">http://eprint.iacr.org/2009/624</a>&gt;.

   [<a id="ref-RFC5282" name="ref-RFC5282">RFC5282</a>]     Black, D. and D. McGrew, "Using Authenticated
                 Encryption Algorithms with the Encrypted Payload of the
                 Internet Key Exchange version 2 (IKEv2) Protocol",
                 <a href="rfc5282.html">RFC 5282</a>, August 2008.

   [<a id="ref-RFC5723" name="ref-RFC5723">RFC5723</a>]     Sheffer, Y. and H. Tschofenig, "Internet Key Exchange
                 Protocol Version 2 (IKEv2) Session Resumption",
                 <a href="rfc5723.html">RFC 5723</a>, January 2010.

   [<a id="ref-RFC5998" name="ref-RFC5998">RFC5998</a>]     Eronen, P., Tschofenig, H., and Y. Sheffer, "An
                 Extension for EAP-Only Authentication in IKEv2",
                 <a href="rfc5998.html">RFC 5998</a>, September 2010.

   [<a id="ref-RFC6467" name="ref-RFC6467">RFC6467</a>]     Kivinen, T., "Secure Password Framework for Internet
                 Key Exchange Version 2 (IKEv2)", <a href="rfc6467.html">RFC 6467</a>,
                 December 2011.











<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   [<a id="ref-TR03110" name="ref-TR03110">TR03110</a>]     BSI, "TR-03110, Advanced Security Mechanisms for
                 Machine Readable Travel Documents, Part 2 - Extended
                 Access Control Version 2 (EACv2), Password
                 Authenticated Connection Establishment (PACE), and
                 Restricted Identification (RI)", Version 2.10,
                 March 2012.

   [<a id="ref-TR03111" name="ref-TR03111">TR03111</a>]     BSI, "TR-03111, Elliptic Curve Cryptography",
                 Version 1.11, April 2009.










































<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Protocol%20Selection%20Criteria"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Protocol Selection Criteria</span>

   To support the selection of a password-based protocol for inclusion
   in IKEv2, a number of criteria are provided in [<a href="#ref-IKEv2-CONS" title='"Password-Based Authentication in IKEv2: Selection Criteria and Considerations"'>IKEv2-CONS</a>].  In the
   following sections, those criteria are applied to the PACE protocol.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Security%20Criteria"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Security Criteria</span>

   SEC1:  PACE is a zero-knowledge protocol.

   SEC2:  The protocol supports perfect forward secrecy and is resistant
          to replay attacks.

   SEC3:  The identity protection provided by IKEv2 remains unchanged.

   SEC4:  Any cryptographically secure Diffie-Hellman group can be used.

   SEC5:  The protocol is proven secure in the Bellare-Pointcheval-
          Rogaway model.

   SEC6:  Strong session keys are generated.

   SEC7:  A transform of the password can be used instead of the
          password itself.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Intellectual%20Property%20Criteria"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Intellectual Property Criteria</span>

   IPR1:  The first version of [<a href="#ref-TR03110" title='"TR-03110, Advanced Security Mechanisms for Machine Readable Travel Documents, Part 2 - Extended Access Control Version 2 (EACv2), Password Authenticated Connection Establishment (PACE), and Restricted Identification (RI)"'>TR03110</a>] was published on May 21, 2007.

   IPR2:  BSI has developed PACE aiming to be free of patents.  BSI has
          not applied for a patent on PACE.

   IPR3:  The protocol itself is believed to be free of IPR.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20Miscellaneous%20Criteria"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Miscellaneous Criteria</span>

   MISC1:   One additional exchange is required.

   MISC2:   The protocol requires the following operations per entity:

            *  one key derivation from the password,

            *  one symmetric encryption or decryption,

            *  one multi-exponentiation for the mapping,






<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


            *  one exponentiation for the key pair generation,

            *  one exponentiation for the shared secret calculation, and

            *  two symmetric authentications (generation and
               verification).

   MISC3:   The performance is independent of the type/size of password.

   MISC4:   Internationalization of character-based passwords is
            supported.

   MISC5:   The protocol uses the same group as that negotiated for
            IKEv2.

   MISC6:   The protocol fits into the request/response nature of IKE.

   MISC7:   The password-based symmetric encryption must be additionally
            negotiated.

   MISC8:   Neither trusted third parties nor clock synchronization are
            required.

   MISC9:   Only general cryptographic primitives are required.

   MISC10:  Any secure variant of Diffie-Hellman (e.g., Modular or
            Elliptic Curve) can be used.

   MISC11:  The protocol can be implemented easily based on existing
            cryptographic primitives.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Password%20Salting"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Password Salting</span>

   This protocol requires that passwords not be stored in plaintext.
   Instead, we store a hash of the password with a fixed hash.  This
   value is then used in the ZKPP protocol, replacing the original
   password and acting as a "password equivalent".  The main benefit of
   this solution is that a system administrator or an undetermined
   attacker does not get immediate access to the passwords.  We believe
   this is sufficiently secure for the main usage scenario of the
   protocol.










<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   However, the common practice of password salting is clearly more
   powerful, and this appendix presents a few ideas on how password
   salting can be applied and/or adapted to fit into a symmetric
   protocol such as IKE.  First, let us list the threats that we expect
   salting to handle, as well as the non-threats:

   o  The plain password should not be visible to a casual onlooker, as
      noted above.  It is assumed that very often the same password is
      used for multiple applications, and so a password exposed allows
      an attacker a starting point for further attacks.

   o  An attacker must not be able to construct lookup tables (such as
      the famous "rainbow tables") that enable her to discover the plain
      password.

   o  IKE is a symmetric protocol, in the sense that any of the peers
      might initiate an IKE exchange to another peer.  As a result, all
      peers must have stored credentials (passwords or password
      equivalents) that would enable them to set up an IKE exchange.
      So, an attacker that reaches the credential store would in fact be
      able to impersonate IKE to another peer.  We believe that this
      reduces, but does not invalidate, the importance of salting,
      because of the other threats that remain.

   Below we present different scenarios and solutions that support
   password salting in this setting.

   We assume that each credential is used to authenticate exactly two
   peers to one another; i.e., (as per the best practice), group
   credentials are not allowed.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.1.%20%20Solving%20the%20Asymmetric%20Case%20with%20Symmetric%20Cryptography"></a><a class="selflink" href="#appendix-B.1" name="appendix-B.1">B.1</a>.  Solving the Asymmetric Case with Symmetric Cryptography</span>

   Despite the protocol's symmetry, there are use cases that are
   somewhat asymmetric.  Consider the case of an organization that
   consists of a headquarters and branches, using a hub-and-spoke
   architecture.  Communication sessions can be initiated by the center
   or by any of the branches, but only the center holds a large
   credential database.

   Here it would be possible to use traditional password salting,

      stored password = hash(salt, password),

   where the hash function is a symmetric hash (e.g., HMAC-SHA-256,
   using the salt as its key), and the salt is picked at random for each
   password.  The salt would need to be sent in the first exchange of
   the protocol, regardless of which side initiates the session.  Unlike



<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   the normal use of salted passwords, here it is the stored password,
   rather than the original password, that is used by the follow-on ZKPP
   protocol.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.2.%20%20Solving%20the%20Fully%20Symmetric%20Case%20with%20Asymmetric%20Cryptography"></a><a class="selflink" href="#appendix-B.2" name="appendix-B.2">B.2</a>.  Solving the Fully Symmetric Case with Asymmetric Cryptography</span>

   For the fully symmetric case, we propose a salting method based on a
   commutative one-way function.  This is essentially a novel variant of
   the RSA protocol.  Using this solution, all protocol peers can store
   the password in a salted form.

   The implementation proposed here requires a composite number n that
   is common to all peers.  The composite number n can be generated by a
   trusted (third) party as n = p * q, where p and q are strong primes
   (i.e., p = 2 * p' + 1 and q = 2 * q' + 1, where p' and q' are also
   primes), and the trusted party promises not to retain a copy of the
   primes.  Alternatively, n can be chosen randomly and tested for
   "small" prime factors.  In the latter case, it is certainly not
   guaranteed that n is composed of only two primes.  While this has the
   advantage that no one knows the factorization of n, the disadvantage
   is that n is likely to be significantly easier to factor.

   Each peer then chooses a public encryption key "e".  In a simple
   implementation, the encryption key is generated randomly by each
   peer, picking a different value for each of the passwords that it
   stores.

   Note that although the pair (n,e) is similar to an RSA public key,
   the usual rules for generating "e" for the RSA protocol do not apply
   here, and a random "e" is sufficient.  The password is hashed by a
   symmetric hash function H (e.g., SHA-256).  Each peer i stores the
   two values

      e_i, H(P)^e_i (mod n),

   where P is the original password.  The values e_i are exchanged by
   the peers before the ZKPP protocol commences (in IKEv2-PACE, this
   would be in IKE_SA_INIT), and the following value is used in the ZKPP
   protocol run that follows, in lieu of the original password:

      H(P) ^ (e_i * e_j) (mod n).

   This transformation is used as a salting mechanism only, and the
   salted values themselves are never sent on the wire.







<span class="grey">Kuegler &amp; Sheffer             Experimental                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6631.html">RFC 6631</a>                     IKEv2 with PACE                   June 2012</span>


   This scheme can be enhanced by basing the value "e" on each peer's
   identity (IDi, IDr), e.g., making it a simple hash of the identity.
   This eliminates the need to send "e" explicitly and additionally
   binds the identity of the peer with its secret.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.3.%20%20Generation%20of%20a%20Strong%2C%20Long-Term%2C%20Shared%20Secret"></a><a class="selflink" href="#appendix-B.3" name="appendix-B.3">B.3</a>.  Generation of a Strong, Long-Term, Shared Secret</span>

   An alternative to salting is to store the plain passwords, but only
   for a short while.  As soon as the first IKE SA is set up between two
   peers, the peers exchange nonces and generate a strong shared secret,
   based on IKE's SK_d.  They now destroy the short password and replace
   it with the new secret.

   This method has been added to the current protocol as an optional
   mechanism.

Authors' Addresses

   Dennis Kuegler
   Bundesamt fuer Sicherheit in der Informationstechnik (BSI)
   Postfach 200363
   Bonn  53133
   Germany

   EMail: dennis.kuegler@bsi.bund.de


   Yaron Sheffer
   Porticor

   EMail: yaronf.ietf@gmail.com




















Kuegler &amp; Sheffer             Experimental                     [Page 26]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.127, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6631 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:14:20 GMT --></html>