<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6391 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:20:07 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.127" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6391" name="DC.Identifier"/>
<meta content="Where the payload of a pseudowire comprises a number of distinct
flows, it can be desirable to carry those flows over the Equal Cost
Multiple Paths (ECMPs) that exist in the packet switched network. Most
forwarding engines are able to generate a hash of the MPLS label stack
and use this mechanism to balance MPLS flows over ECMPs.  This
document describes a method of identifying the flows, or flow groups,
within pseudowires such that Label Switching Routers can balance flows
at a finer granularity than individual pseudowires. The mechanism uses
an additional label in the MPLS label stack. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Regan, Joe" name="DC.Creator"/>
<meta content="Bryant, Stewart" name="DC.Creator"/>
<meta content="Filsfils, Clarence" name="DC.Creator"/>
<meta content="Drafz, Ulrich" name="DC.Creator"/>
<meta content="Kompella, Vach" name="DC.Creator"/>
<meta content="Amante, Shane" name="DC.Creator"/>
<meta content="November, 2011" name="DC.Date.Issued"/>
<meta content="Flow-Aware Transport of Pseudowires over an MPLS Packet Switched Network" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6391 - Flow-Aware Transport of Pseudowires over an MPLS Packet Switched Network</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6391.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6391" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-pwe3-fat-pw" title="draft-ietf-pwe3-fat-pw">draft-ietf-pwe3...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6391" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6391" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6391" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6391&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Updated by: <a href="rfc7274.html">7274</a>                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                    S. Bryant, Ed.
Request for Comments: 6391                                   C. Filsfils
Category: Standards Track                                  Cisco Systems
ISSN: 2070-1721                                                 U. Drafz
                                                        Deutsche Telekom
                                                             V. Kompella
                                                                J. Regan
                                                          Alcatel-Lucent
                                                               S. Amante
                                             Level 3 Communications, LLC
                                                           November 2011


Flow-Aware Transport of Pseudowires over an MPLS Packet Switched Network

Abstract

   Where the payload of a pseudowire comprises a number of distinct
   flows, it can be desirable to carry those flows over the Equal Cost
   Multiple Paths (ECMPs) that exist in the packet switched network.
   Most forwarding engines are able to generate a hash of the MPLS label
   stack and use this mechanism to balance MPLS flows over ECMPs.

   This document describes a method of identifying the flows, or flow
   groups, within pseudowires such that Label Switching Routers can
   balance flows at a finer granularity than individual pseudowires.
   The mechanism uses an additional label in the MPLS label stack.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">SectionÂ 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6391">http://www.rfc-editor.org/info/rfc6391</a>.










<span class="grey">Bryant, et al.               Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Requirements Language ......................................<a href="#page-4">4</a>
      <a href="#section-1.2">1.2</a>. ECMP in Label Switching Routers ............................<a href="#page-4">4</a>
      <a href="#section-1.3">1.3</a>. Flow Label .................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Native Service Processing Function ..............................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Pseudowire Forwarder ............................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Encapsulation ..............................................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Signalling the Presence of the Flow Label .......................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. Structure of Flow Label Sub-TLV ............................<a href="#page-9">9</a>
   <a href="#section-5">5</a>. Static Pseudowires ..............................................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Multi-Segment Pseudowires .......................................<a href="#page-9">9</a>
   <a href="#section-7">7</a>. Operations, Administration, and Maintenance (OAM) ..............<a href="#page-10">10</a>
   <a href="#section-8">8</a>. Applicability of PWs Using Flow Labels .........................<a href="#page-11">11</a>
      <a href="#section-8.1">8.1</a>. Equal Cost Multiple Paths .................................<a href="#page-12">12</a>
      <a href="#section-8.2">8.2</a>. Link Aggregation Groups ...................................<a href="#page-13">13</a>
      <a href="#section-8.3">8.3</a>. Multiple RSVP-TE Paths ....................................<a href="#page-13">13</a>
      <a href="#section-8.4">8.4</a>. The Single Large Flow Case ................................<a href="#page-14">14</a>
      <a href="#section-8.5">8.5</a>. Applicability to MPLS-TP ..................................<a href="#page-15">15</a>
      <a href="#section-8.6">8.6</a>. Asymmetric Operation ......................................<a href="#page-15">15</a>
   <a href="#section-9">9</a>. Applicability to MPLS LSPs .....................................<a href="#page-15">15</a>
   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-16">16</a>
   <a href="#section-11">11</a>. IANA Considerations ...........................................<a href="#page-16">16</a>
   <a href="#section-12">12</a>. Congestion Considerations .....................................<a href="#page-16">16</a>
   <a href="#section-13">13</a>. Acknowledgements ..............................................<a href="#page-17">17</a>
   <a href="#section-14">14</a>. References ....................................................<a href="#page-17">17</a>
      <a href="#section-14.1">14.1</a>. Normative References .....................................<a href="#page-17">17</a>
      <a href="#section-14.2">14.2</a>. Informative References ...................................<a href="#page-18">18</a>







<span class="grey">Bryant, et al.               Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   A pseudowire (PW) [<a href="rfc3985.html" title='"Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture"'>RFC3985</a>] is normally transported over one single
   network path, even if multiple Equal Cost Multiple Paths (ECMPs)
   exist between the ingress and egress PW provider edge (PE) equipment
   [<a href="rfc4385.html" title='"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"'>RFC4385</a>] [<a href="rfc4928.html" title='"Avoiding Equal Cost Multipath Treatment in MPLS Networks"'>RFC4928</a>].  This is required to preserve the
   characteristics of the emulated service (e.g., to avoid misordering
   Structure-Agnostic Time Division Multiplexing over Packet (SAToP) PW
   packets [<a href="rfc4553.html" title='"Structure- Agnostic Time Division Multiplexing (TDM) over Packet (SAToP)"'>RFC4553</a>] or subjecting the packets to unusable inter-arrival
   times).  The use of a single path to preserve order remains the
   default mode of operation of a PW.  The new capability proposed in
   this document is an OPTIONAL mode that may be used when the use of
   ECMPs is known to be beneficial (and not harmful) to the operation of
   the PW.

   Some PWs are used to transport large volumes of IP traffic between
   routers.  One example of this is the use of an Ethernet PW to create
   a virtual direct link between a pair of routers.  Such PWs may carry
   from hundreds of Mbps to Gbps of traffic.  These PWs only require
   packet ordering to be preserved within the context of each individual
   transported IP flow.  They do not require packet ordering to be
   preserved between all packets of all IP flows within the pseudowire.

   The ability to explicitly configure such a PW to leverage the
   availability of multiple ECMPs allows for better capacity planning,
   as the statistical multiplexing of a larger number of smaller flows
   is more efficient than with a smaller set of larger flows.

   Typically, forwarding hardware can deduce that an IP payload is being
   directly carried by an MPLS label stack, and it is capable of looking
   at some fields in packets to construct hash buckets for conversations
   or flows.  However, when the MPLS payload is a PW, an intermediate
   node has no information on the type of PW being carried in the
   packet.  This limits the forwarder at the intermediate node to only
   being able to make an ECMP choice based on a hash of the MPLS label
   stack.  In the case of a PW emulating a high-bandwidth trunk, the
   granularity obtained by hashing the label stack is inadequate for
   satisfactory load balancing.  The ingress node, however, is in the
   special position of being able to understand the unencapsulated
   packet header to assist with spreading flows among any available
   ECMPs, or even any Loop-Free Alternates [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>].  This document
   defines a method to introduce granularity on the hashing of traffic
   running over PWs by introducing an additional label, chosen by the
   ingress node, and placed at the bottom of the label stack.







<span class="grey">Bryant, et al.               Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   In addition to providing an indication of the flow structure for use
   in ECMP forwarding decisions, the mechanism described in the document
   may also be used to select flows for distribution over an IEEE
   802.1AX-2008 (originally specified as IEEE 802.3ad-2000) Link
   Aggregation Group (LAG) that has been used in an MPLS network.

   NOTE: Although Ethernet is frequently referenced as a use case in
   this RFC, the mechanisms described in this document are general
   mechanisms that may be applied to any PW type in which there are
   identifiable flows, and in which there is no requirement to preserve
   the order between those flows.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20ECMP%20in%20Label%20Switching%20Routers"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  ECMP in Label Switching Routers</span>

   Label Switching Routers (LSRs) commonly generate a hash of the label
   stack or some elements of the label stack as a method of
   discriminating between flows and use this to distribute those flows
   over the available ECMPs that exist in the network.  Since the label
   at the bottom of the stack is usually the label most closely
   associated with the flow, this normally provides the greatest
   entropy, and hence is usually included in the hash.  This document
   describes a method of adding an additional Label Stack Entry (LSE) at
   the bottom of the stack in order to facilitate the load balancing of
   the flows within a PW over the available ECMPs.  A similar design for
   general MPLS use has also been proposed [<a href="#ref-MPLS-ENTROPY" title='"The Use of Entropy Labels in MPLS Forwarding"'>MPLS-ENTROPY</a>]; see <a href="#section-9">Section 9</a>
   of this document.

   An alternative method of load balancing by creating a number of PWs
   and distributing the flows amongst them was considered, but was
   rejected because:

   o  It did not introduce as much entropy as can be introduced by
      adding an additional LSE.

   o  It required additional PWs to be set up and maintained.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20Flow%20Label"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  Flow Label</span>

   An additional LSE [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>] is interposed between the PW LSE and the
   control word, or if the control word is not present, between the PW
   LSE and the PW payload.  This additional LSE is called the flow LSE,
   and the label carried by the flow LSE is called the flow label.



<span class="grey">Bryant, et al.               Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   Indivisible flows within the PW MUST be mapped to the same flow label
   by the ingress PE.  The flow label stimulates the correct ECMP load-
   balancing behaviour in the packet switched network (PSN).  On receipt
   of the PW packet at the egress PE (which knows a flow LSE is
   present), the flow LSE is discarded without processing.

   Note that the flow label MUST NOT be an MPLS reserved label (values
   in the range 0..15) [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>], but is otherwise unconstrained by the
   protocol.

   It is useful to give consideration to the choice of Time to Live
   (TTL) value in the flow LSE [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>].  The flow LSE is at the bottom
   of the label stack; therefore, even when penultimate hop popping is
   employed, it will always be preceded by the PW label on arrival at
   the PE.  If, due to an error condition, the flow LSE becomes the top
   of the stack, it might be examined as if it were a normal LSE, and
   the packet might then be forwarded.  This can be prevented by setting
   the flow LSE TTL to 1, thereby forcing the packet to be discarded by
   the forwarder.  Note that setting the TTL to 1 regardless of the
   payload may be considered a departure from the TTL procedures defined
   in [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>] that apply to the general MPLS case.

   This document does not define a use for the Traffic Class (TC) field
   [<a href="rfc5462.html" title='"Multiprotocol Label Switching (MPLS) Label Stack Entry: "'>RFC5462</a>] (formerly known as the Experimental Use (EXP) bits
   [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>]) in the flow label.  Future documents may define a use for
   these bits; therefore, implementations conforming to this
   specification MUST set the TC field to zero at the ingress and MUST
   ignore them at the egress.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Native%20Service%20Processing%20Function"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Native Service Processing Function</span>

   The Native Service Processing (NSP) function [<a href="rfc3985.html" title='"Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture"'>RFC3985</a>] is a component
   of a PE that has knowledge of the structure of the emulated service
   and is able to take action on the service outside the scope of the
   PW.  In this case, it is REQUIRED that the NSP in the ingress PE
   identify flows, or groups of flows within the service, and indicate
   the flow (group) identity of each packet as it is passed to the
   pseudowire forwarder.  As an example, where the PW type is an
   Ethernet, the NSP might parse the ingress Ethernet traffic and
   consider all of the IP traffic.  This traffic could then be
   categorised into flows by considering all traffic with the same
   source and destination address pair to be a single indivisible flow.
   Since this is an NSP function, by definition, the method used to
   identify a flow is outside the scope of the PW design.  Similarly,
   since the NSP is internal to the PE, the method of flow indication to
   the PW forwarder is outside the scope of this document.





<span class="grey">Bryant, et al.               Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Pseudowire%20Forwarder"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Pseudowire Forwarder</span>

   The PW forwarder must be provided with a method of mapping flows to
   load-balanced paths.

   The forwarder must generate a label for the flow or group of flows.
   How the flow label values are determined is outside the scope of this
   document; however, the flow label allocated to a flow MUST NOT be an
   MPLS reserved label and SHOULD remain constant for the life of the
   flow.  It is RECOMMENDED that the method chosen to generate the load-
   balancing labels introduce a high degree of entropy in their values,
   to maximise the entropy presented to the ECMP selection mechanism in
   the LSRs in the PSN, and hence distribute the flows as evenly as
   possible over the available PSN ECMP.  The forwarder at the ingress
   PE prepends the PW control word (if applicable), and then pushes the
   flow label, followed by the PW label.

   NOTE: Although this document does not attempt to specify any hash
   algorithms, it is suggested that any such algorithm should be based
   on the assumption that there will be a high degree of entropy in the
   values assigned to the flow labels.

   The forwarder at the egress PE uses the pseudowire label to identify
   the pseudowire.  From the context associated with the pseudowire
   label, the egress PE can determine whether a flow LSE is present.  If
   a flow LSE is present, it MUST be checked to determine whether it
   carries a reserved label.  If it is a reserved label, the packet is
   processed according to the rules associated with that reserved label;
   otherwise, the LSE is discarded.

   All other PW forwarding operations are unmodified by the inclusion of
   the flow LSE.



















<span class="grey">Bryant, et al.               Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Encapsulation"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Encapsulation</span>

   The PWE3 Protocol Stack Reference Model modified to include flow LSE
   is shown in Figure 1.

      +-------------+                                +-------------+
      |  Emulated   |                                |  Emulated   |
      |  Ethernet   |                                |  Ethernet   |
      | (including  |         Emulated Service       | (including  |
      |  VLAN)      |&lt;==============================&gt;|  VLAN)      |
      |  Services   |                                |  Services   |
      +-------------+                                +-------------+
      |    Flow     |                                |    Flow     |
      +-------------+            Pseudowire          +-------------+
      |Demultiplexer|&lt;==============================&gt;|Demultiplexer|
      +-------------+                                +-------------+
      |    PSN      |            PSN Tunnel          |    PSN      |
      |   MPLS      |&lt;==============================&gt;|   MPLS      |
      +-------------+                                +-------------+
      |  Physical   |                                |  Physical   |
      +-----+-------+                                +-----+-------+

               Figure 1: PWE3 Protocol Stack Reference Model

   The encapsulation of a PW with a flow LSE is shown in Figure 2.

       +---------------------------+
       |                           |
       |  Payload                  |
       |                           |  n octets
       |                           |
       +---------------------------+
       |  Optional Control Word    |  4 octets
       +---------------------------+
       |  Flow LSE                 |  4 octets
       +---------------------------+
       |  PW LSE                   |  4 octets
       +---------------------------+
       |  MPLS Tunnel LSE (s)      |  n*4 octets (four octets per LSE)
       +---------------------------+

    Figure 2: Encapsulation of a Pseudowire with a Pseudowire Flow LSE









<span class="grey">Bryant, et al.               Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Signalling%20the%20Presence%20of%20the%20Flow%20Label"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Signalling the Presence of the Flow Label</span>

   When using the signalling procedures in [<a href="rfc4447.html" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>], a new Pseudowire
   Interface Parameter Sub-TLV, the Flow Label Sub-TLV (FL Sub-TLV), is
   used to synchronise the flow label states between the ingress and
   egress PEs.

   The absence of an FL Sub-TLV indicates that the PE is unable to
   process flow labels.  An ingress PE that is using PW signalling and
   that does not send an FL Sub-TLV MUST NOT include a flow label in the
   PW packet.  An ingress PE that is using PW signalling and that does
   not receive an FL Sub-TLV from its egress peer MUST NOT include a
   flow label in the PW packet.  This preserves backwards compatibility
   with existing PW specifications.

   A PE that wishes to send a flow label in a PW packet MUST include in
   its label mapping message an FL Sub-TLV with T = 1 (see <a href="#section-4.1">Section 4.1</a>).

   A PE that is willing to receive a flow label MUST include in its
   label mapping message an FL Sub-TLV with R = 1 (see <a href="#section-4.1">Section 4.1</a>).

   A PE that receives a label mapping message containing an FL Sub-TLV
   with R = 0 MUST NOT include a flow label in the PW packet.

   Thus, a PE sending an FL Sub-TLV with T = 1 and receiving an FL
   Sub-TLV with R = 1 MUST include a flow label in the PW packet.  Under
   all other combinations of FL Sub-TLV signalling, a PE MUST NOT
   include a flow label in the PW packet.

   The signalling procedures in [<a href="rfc4447.html" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>] state that "Processing of the
   interface parameters should continue when unknown interface
   parameters are encountered, and they MUST be silently ignored".  The
   signalling procedure described here is therefore backwards compatible
   with existing implementations.

   Note that what is signalled is the desire to include the flow LSE in
   the label stack.  The value of the flow label is a local matter for
   the ingress PE, and the label value itself is not signalled.













<span class="grey">Bryant, et al.               Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Structure%20of%20Flow%20Label%20Sub-TLV"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Structure of Flow Label Sub-TLV</span>

   The structure of the Flow Label Sub-TLV is shown in Figure 3.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | FL=0x17       |    Length     |T|R|      Reserved             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                       Figure 3: Flow Label Sub-TLV

   Where:

   o  FL (value 0x17) is the Flow Label Sub-TLV identifier assigned by
      IANA (see <a href="#section-11">Section 11</a>).

   o  Length is the length of the Sub-TLV in octets and is 4.

   o  When T = 1, the PE is requesting the ability to send a PW packet
      that includes a flow label.  When T = 0, the PE is indicating that
      it will not send a PW packet containing a flow label.

   o  When R = 1, the PE is able to receive a PW packet with a flow
      label present.  When R = 0, the PE is unable to receive a PW
      packet with the flow label present.

   o  Reserved bits MUST be zero on transmit and MUST be ignored on
      receive.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Static%20Pseudowires"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Static Pseudowires</span>

   If PWE3 signalling [<a href="rfc4447.html" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>RFC4447</a>] is not in use for a PW, then whether the
   flow label is used MUST be identically provisioned in both PEs at the
   PW endpoints.  If there is no provisioning support for this option,
   the default behaviour is not to include the flow label.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Multi-Segment%20Pseudowires"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Multi-Segment Pseudowires</span>

   The flow label mechanism described in this document works on
   multi-segment PWs without requiring modification to the Switching PEs
   (S-PEs).  This is because the flow LSE is transparent to the label
   swap operation, and because interface parameter Sub-TLV signalling is
   transitive.







<span class="grey">Bryant, et al.               Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Operations%2C%20Administration%2C%20and%20Maintenance%20%28OAM%29"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Operations, Administration, and Maintenance (OAM)</span>

   The following OAM considerations apply to this method of load
   balancing.

   Where the OAM is only to be used to perform a basic test to verify
   that the PWs have been configured at the PEs, Virtual Circuit
   Connectivity Verification (VCCV) [<a href="rfc5085.html" title='"Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires"'>RFC5085</a>] messages may be sent using
   any load balance PW path, i.e., using any value for the flow label.

   Where it is required to verify that a pseudowire is fully functional
   for all flows, a VCCV [<a href="rfc5085.html" title='"Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires"'>RFC5085</a>] connectivity verification message
   MUST be sent over each ECMP path to the pseudowire egress PE.  This
   solution may be difficult to achieve and scales poorly.  Under these
   circumstances, it may be sufficient to send VCCV messages using any
   load balance pseudowire path, because if a failure occurs within the
   PSN, the failure will normally be detected and repaired by the PSN.
   That is, the PSN's Interior Gateway Protocol (IGP) link/node failure
   detection mechanism (loss of light, bidirectional forwarding
   detection [<a href="rfc5880.html" title='"Bidirectional Forwarding Detection (BFD)"'>RFC5880</a>], or IGP hello detection) and the IGP convergence
   will naturally modify the ECMP set of network paths between the
   ingress and egress PEs.  Hence, the PW is only impacted during the
   normal IGP convergence time.  Note that this period may be reduced if
   a fast re-route or fast convergence technology is deployed in the
   network [<a href="rfc4090.html" title='"Fast Reroute Extensions to RSVP-TE for LSP Tunnels"'>RFC4090</a>] [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>].

   If the failure is related to the individual corruption of a Label
   Forwarding Information Base (LFIB) entry in a router, then only the
   network path using that specific entry is impacted.  If the PW is
   load-balanced over multiple network paths, then this failure can only
   be detected if, by chance, the transported OAM flow is mapped onto
   the impacted network path, or if all paths are tested.  Since testing
   all paths may present problems as noted above, other mechanisms to
   detect this type of error may need to be developed, such as a Label
   Switched Path (LSP) self-test technology.

   To troubleshoot the MPLS PSN, including multiple paths, the
   techniques described in [<a href="rfc4378.html" title='"A Framework for Multi-Protocol Label Switching (MPLS) Operations and Management (OAM)"'>RFC4378</a>] and [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] can be used.

   Where the PW OAM is carried out of band (VCCV Type 2) [<a href="rfc5085.html" title='"Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires"'>RFC5085</a>], it
   is necessary to insert an "MPLS Router Alert Label" in the label
   stack.  The resultant label stack is as follows:









<span class="grey">Bryant, et al.               Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   +-------------------------------+
   |                               |
   |      VCCV Message             |  n octets
   |                               |
   +-------------------------------+
   |   Optional Control Word       |  4 octets
   +-------------------------------+
   |      Flow LSE                 |  4 octets
   +-------------------------------+
   |      PW LSE                   |  4 octets
   +-------------------------------+
   |      Router Alert LSE         |  4 octets
   +-------------------------------+
   |      MPLS Tunnel LSE(s)       |  n*4 octets (four octets per label)
   +-------------------------------+

                    Figure 4: Use of Router Alert Label

   Note that, depending on the number of labels hashed by the LSR, the
   inclusion of the Router Alert label may cause the OAM packet to be
   load-balanced to a different path from that taken by the data packets
   with identical flow and PW labels.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Applicability%20of%20PWs%20Using%20Flow%20Labels"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Applicability of PWs Using Flow Labels</span>

   A node within the PSN is not able to perform deep packet inspection
   (DPI) of the PW, as the PW technology is not self-describing: the
   structure of the PW payload is only known to the ingress and egress
   PE devices.  The method proposed in this document provides a
   statistical mitigation of the problem of load balance in those cases
   where a PE is able to discern flows embedded in the traffic received
   on the attachment circuit.

   The methods described in this document are transparent to the PSN and
   as such do not require any new capability from the PSN.

   The requirement to load-balance over multiple PSN paths occurs when
   the ratio between the PW access speed and the PSN's core link
   bandwidth is large (e.g., &gt;= 10%).  ATM and Frame Relay are unlikely
   to meet this property.  Ethernet may have this property, and for that
   reason this document focuses on Ethernet.  Applications for other
   high-access-bandwidth PWs may be defined in the future.

   This design applies to MPLS PWs where it is meaningful to
   de-construct the packets presented to the ingress PE into flows.  The
   mechanism described in this document promotes the distribution of
   flows within the PW over different network paths.  In turn, this
   means that whilst packets within a flow are delivered in order



<span class="grey">Bryant, et al.               Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   (subject to normal IP delivery perturbations due to topology
   variation), order is no longer maintained for all packets sent over
   the PW.  It is not proposed to associate a different sequence number
   with each flow.  If sequence number support is required, the flow
   label mechanism MUST NOT be used.

   Where it is known that the traffic carried by the Ethernet PW is IP,
   the flows can be identified and mapped to an ECMP.  Such methods
   typically include hashing on the source and destination addresses,
   the protocol ID and higher-layer flow-dependent fields such as
   TCP/UDP ports, Layer 2 Tunneling Protocol version 3 (L2TPv3) Session
   IDs, etc.

   Where it is known that the traffic carried by the Ethernet PW is
   non-IP, techniques used for link bundling between Ethernet switches
   may be reused.  In this case, however, the latency distribution would
   be larger than is found in the link bundle case.  The acceptability
   of the increased latency is for further study.  Of particular
   importance, the Ethernet control frames SHOULD always be mapped to
   the same PSN path to ensure in-order delivery.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Equal%20Cost%20Multiple%20Paths"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Equal Cost Multiple Paths</span>

   ECMP in packet switched networks is statistical in nature.  The
   mapping of flows to a particular path does not take into account the
   bandwidth of the flow being mapped or the current bandwidth usage of
   the members of the ECMP set.  This simplification works well when the
   distribution of flows is evenly spread over the ECMP set and there
   are a large number of flows that have low bandwidth relative to the
   paths.  The random allocation of a flow to a path provides a good
   approximation to an even spread of flows, provided that polarisation
   effects are avoided.  The method defined in this document has the
   same statistical properties as an IP PSN.

   ECMP is a load-sharing mechanism that is based on sharing the load
   over a number of layer 3 paths through the PSN.  Often, however,
   multiple links exist between a pair of LSRs that are considered by
   the IGP to be a single link.  These are known as link bundles.  The
   mechanism described in this document can also be used to distribute
   the flows within a PW over the members of the link bundle by using
   the flow label value to identify candidate flows.  How that mapping
   takes place is outside the scope of this specification.  Similar
   considerations apply to Link Aggregation Groups.

   There is no mechanism currently defined to indicate the bandwidths in
   use by specific flows using the fields of the MPLS shim header.
   Furthermore, since the semantics of the MPLS shim header are fully
   defined in [<a href="rfc3032.html" title='"MPLS Label Stack Encoding"'>RFC3032</a>] and [<a href="rfc5462.html" title='"Multiprotocol Label Switching (MPLS) Label Stack Entry: "'>RFC5462</a>], those fields cannot be assigned



<span class="grey">Bryant, et al.               Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   semantics to carry this information.  This document does not define
   any semantic for use in the TTL or TC fields of the label entry that
   carries the flow label, but requires that the flow label itself be
   selected with a high degree of entropy suggesting that the label
   value should not be overloaded with additional meaning in any
   subsequent specification.

   A different type of load balancing is the desire to carry a PW over a
   set of PSN links in which the bandwidth of members of the link set is
   less than the bandwidth of the PW.  Proposals to address this problem
   have been made in the past [<a href="#ref-PWBONDING" title='"PW Bonding"'>PWBONDING</a>].  Such a mechanism can be
   considered complementary to this mechanism.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Link%20Aggregation%20Groups"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Link Aggregation Groups</span>

   A Link Aggregation Group (LAG) is used to bond together several
   physical circuits between two adjacent nodes so they appear to
   higher-layer protocols as a single, higher-bandwidth "virtual" pipe.
   These may coexist in various parts of a given network.  An advantage
   of LAGs is that they reduce the number of routing and signalling
   protocol adjacencies between devices, reducing control plane
   processing overhead.  As with ECMP, the key problem related to LAGs
   is that due to inefficiencies in LAG load-distribution algorithms, a
   particular component of a LAG may experience congestion.  The
   mechanism proposed here may be able to assist in producing a more
   uniform flow distribution.

   The same considerations requiring a flow to go over a single member
   of an ECMP set apply to a member of a LAG.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Multiple%20RSVP-TE%20Paths"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Multiple RSVP-TE Paths</span>

   In some networks, it is desirable for a Label Edge Router (LER) to be
   able to load-balance a PW across multiple Resource Reservation
   Protocol - Traffic Engineering (RSVP-TE) tunnels.  The flow label
   mechanism described in this document may be used to provide the LER
   with the required flow information and necessary entropy to provide
   this type of load balancing.  An example of such a case is the use of
   the flow label mechanism in networks using a link bundle with the all
   ones component [<a href="rfc4201.html" title='"Link Bundling in MPLS Traffic Engineering (TE)"'>RFC4201</a>].

   Methods by which the LER is configured to apply this type of ECMP are
   outside the scope of this document.








<span class="grey">Bryant, et al.               Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.4.%20%20The%20Single%20Large%20Flow%20Case"></a><a class="selflink" href="#section-8.4" name="section-8.4">8.4</a>.  The Single Large Flow Case</span>

   Clearly, the operator should make sure that the service offered using
   PW technology and the method described in this document do not exceed
   the maximum planned link capacity, unless it can be guaranteed that
   they conform to the Internet traffic profile of a very large number
   of small flows.

   If the NSP cannot access sufficient information to distinguish flows,
   perhaps because the protocol stack required parsing further into the
   packet than it is able, then the functionality described in this
   document does not give any benefits.  The most common case where a
   single flow dominates the traffic on a PW is when it is used to
   transport enterprise traffic.  Enterprise traffic may well consist of
   a single, large TCP flow, or encrypted flows that cannot be handled
   by the methods described in this document.

   An operator has four options under these circumstances:

   1.  The operator can choose to do nothing, and the system will work
       as it does without the flow label.

   2.  The operator can make the customer aware that the service
       offering has a restriction on flow bandwidth and police flows to
       that restriction.  This would allow customers offering multiple
       flows to use a larger fraction of their access bandwidth, whilst
       preventing a single flow from consuming a fraction of internal
       link bandwidth that the operator considered excessive.

   3.  The operator could configure the ingress PE to assign a constant
       flow label to all high-bandwidth flows so that only one path was
       affected by these flows.

   4.  The operator could configure the ingress PE to assign a random
       flow label to all high-bandwidth flows so as to minimise the
       disruption to the network at the cost of out-of-order traffic to
       the user.

   The issues described above are mitigated by the following two
   factors:

   o  Firstly, the customer of a high-bandwidth PW service has an
      incentive to get the best transport service, because an
      inefficient use of the PSN leads to jitter and eventually to loss
      to the PW's payload.






<span class="grey">Bryant, et al.               Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   o  Secondly, the customer is usually able to tailor their
      applications to generate many flows in the PSN.  A well-known
      example is massive data transport between servers that use many
      parallel TCP sessions.  This same technique can be used by any
      transport protocol: multiple UDP ports, multiple L2TPv3 Session
      IDs, or multiple Generic Routing Encapsulation (GRE) keys may be
      used to decompose a large flow into smaller components.  This
      approach may be applied to IPsec [<a href="rfc4301.html" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>] where multiple Security
      Parameter Indexes (SPIs) may be allocated to the same security
      association.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.5.%20%20Applicability%20to%20MPLS-TP"></a><a class="selflink" href="#section-8.5" name="section-8.5">8.5</a>.  Applicability to MPLS-TP</span>

   The MPLS Transport Profile (MPLS-TP) [<a href="rfc5654.html" title='"Requirements of an MPLS Transport Profile"'>RFC5654</a>] Requirement 44 states
   that "MPLS-TP MUST support mechanisms that ensure the integrity of
   the transported customer's service traffic as required by its
   associated Service Level Agreement (SLA).  Loss of integrity may be
   defined as packet corruption, reordering, or loss during normal
   network conditions".  In addition, MPLS-TP makes extensive use of the
   fate sharing between OAM and data packets, which is defeated by the
   flow LSE.  The flow-aware transport of a PW reorders packets and
   therefore MUST NOT be deployed in a network conforming to MPLS-TP,
   unless these integrity requirements specified in the SLA can be
   satisfied.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.6.%20%20Asymmetric%20Operation"></a><a class="selflink" href="#section-8.6" name="section-8.6">8.6</a>.  Asymmetric Operation</span>

   The protocol defined in this document supports the asymmetric
   inclusion of the flow LSE.  Asymmetric operation can be expected when
   there is asymmetry in the bandwidth requirements making it
   unprofitable for one PE to perform the flow classification, or when
   that PE is otherwise unable to perform the classification but is able
   to receive flow labeled packets from its peer.  Asymmetric operation
   of the PW may also be required when one PE has a high transmission
   bandwidth requirement, but has a need to receive the entire PW on a
   single interface in order to perform a processing operation that
   requires the context of the complete PW (for example, policing of the
   egress traffic).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Applicability%20to%20MPLS%20LSPs"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Applicability to MPLS LSPs</span>

   An extension of this technique is to create a basis for hash
   diversity without having to peek below the label stack for IP traffic
   carried over Label Distribution Protocol (LDP) LSPs.  The
   generalisation of this extension to MPLS has been described in
   [<a href="#ref-MPLS-ENTROPY" title='"The Use of Entropy Labels in MPLS Forwarding"'>MPLS-ENTROPY</a>].  This generalisation can be regarded as a





<span class="grey">Bryant, et al.               Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


   complementary, but distinct, approach from the technique described in
   this document.  While similar consideration may apply to the
   identification of flows and the allocation of flow label values, the
   flow labels are imposed by different network components, and the
   associated signalling mechanisms are different.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   The PW generic security considerations described in [<a href="rfc3985.html" title='"Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture"'>RFC3985</a>] and the
   security considerations applicable to a specific PW type (for
   example, in the case of an Ethernet PW [<a href="rfc4448.html" title='"Encapsulation Methods for Transport of Ethernet over MPLS Networks"'>RFC4448</a>]) apply.  The
   security considerations in [<a href="rfc5920.html" title='"Security Framework for MPLS and GMPLS Networks"'>RFC5920</a>] also apply.

   <a href="#section-1.3">Section 1.3</a> describes considerations that apply to the TTL value used
   in the flow LSE.  The use of a TTL value of one prevents the
   accidental forwarding of a packet based on the label value in the
   flow LSE.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  IANA Considerations</span>

   IANA maintains the registry "Pseudowire Name Spaces (PWE3)" with
   sub-registry "Pseudowire Interface Parameters Sub-TLV type Registry".
   IANA has registered the Flow Label Sub-TLV type in this registry.

      Parameter     ID Length     Description      Reference
      ------------------------------------------------------
      0x17             4           Flow Label       <a href="rfc6391.html">RFC 6391</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Congestion%20Considerations"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Congestion Considerations</span>

   The congestion considerations applicable to PWs as described in
   [<a href="rfc3985.html" title='"Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture"'>RFC3985</a>] apply to this design.

   The ability to explicitly configure a PW to leverage the availability
   of multiple ECMPs is beneficial to capacity planning as, all other
   parameters being constant, the statistical multiplexing of a larger
   number of smaller flows is more efficient than with a smaller number
   of larger flows.

   Note that if the classification into flows is only performed on IP
   packets, the behaviour of those flows in the face of congestion will
   be as already defined by the IETF for packets of that type, and no
   additional congestion processing is required.

   Where flows that are not IP are classified, PW congestion avoidance
   must be applied to each non-IP load balance group.





<span class="grey">Bryant, et al.               Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Acknowledgements"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Acknowledgements</span>

   The authors wish to thank Mary Barnes, Eric Grey, Kireeti Kompella,
   Joerg Kuechemann, Wilfried Maas, Luca Martini, Mark Townsley, Rolf
   Winter, and Lucy Yong for valuable comments on this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20References"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.1.%20%20Normative%20References"></a><a class="selflink" href="#section-14.1" name="section-14.1">14.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3032" name="ref-RFC3032">RFC3032</a>]   Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,
               Farinacci, D., Li, T., and A. Conta, "MPLS Label Stack
               Encoding", <a href="rfc3032.html">RFC 3032</a>, January 2001.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]   Kompella, K. and G. Swallow, "Detecting Multi-Protocol
               Label Switched (MPLS) Data Plane Failures", <a href="rfc4379.html">RFC 4379</a>,
               February 2006.

   [<a id="ref-RFC4385" name="ref-RFC4385">RFC4385</a>]   Bryant, S., Swallow, G., Martini, L., and D. McPherson,
               "Pseudowire Emulation Edge-to-Edge (PWE3) Control Word
               for Use over an MPLS PSN", <a href="rfc4385.html">RFC 4385</a>, February 2006.

   [<a id="ref-RFC4447" name="ref-RFC4447">RFC4447</a>]   Martini, L., Ed., Rosen, E., El-Aawar, N., Smith, T., and
               G. Heron, "Pseudowire Setup and Maintenance Using the
               Label Distribution Protocol (LDP)", <a href="rfc4447.html">RFC 4447</a>, April 2006.

   [<a id="ref-RFC4448" name="ref-RFC4448">RFC4448</a>]   Martini, L., Ed., Rosen, E., El-Aawar, N., and G. Heron,
               "Encapsulation Methods for Transport of Ethernet over
               MPLS Networks", <a href="rfc4448.html">RFC 4448</a>, April 2006.

   [<a id="ref-RFC4553" name="ref-RFC4553">RFC4553</a>]   Vainshtein, A., Ed., and YJ. Stein, Ed., "Structure-
               Agnostic Time Division Multiplexing (TDM) over Packet
               (SAToP)", <a href="rfc4553.html">RFC 4553</a>, June 2006.

   [<a id="ref-RFC4928" name="ref-RFC4928">RFC4928</a>]   Swallow, G., Bryant, S., and L. Andersson, "Avoiding
               Equal Cost Multipath Treatment in MPLS Networks",
               <a href="https://tools.ietf.org/html/bcp128">BCP 128</a>, <a href="rfc4928.html">RFC 4928</a>, June 2007.

   [<a id="ref-RFC5085" name="ref-RFC5085">RFC5085</a>]   Nadeau, T., Ed., and C. Pignataro, Ed., "Pseudowire
               Virtual Circuit Connectivity Verification (VCCV): A
               Control Channel for Pseudowires", <a href="rfc5085.html">RFC 5085</a>,
               December 2007.






<span class="grey">Bryant, et al.               Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.2.%20%20Informative%20References"></a><a class="selflink" href="#section-14.2" name="section-14.2">14.2</a>.  Informative References</span>

   [<a id="ref-MPLS-ENTROPY" name="ref-MPLS-ENTROPY">MPLS-ENTROPY</a>]
               Kompella, K., Drake, J., Amante, S., Henderickx, W., and
               L. Yong, "The Use of Entropy Labels in MPLS Forwarding",
               Work in Progress, October 2011.

   [<a id="ref-PWBONDING" name="ref-PWBONDING">PWBONDING</a>] Stein, Y(J)., Mendelsohn, I., and R. Insler, "PW
               Bonding", Work in Progress, November 2008.

   [<a id="ref-RFC3985" name="ref-RFC3985">RFC3985</a>]   Bryant, S., Ed., and P. Pate, Ed., "Pseudo Wire Emulation
               Edge-to-Edge (PWE3) Architecture", <a href="rfc3985.html">RFC 3985</a>, March 2005.

   [<a id="ref-RFC4090" name="ref-RFC4090">RFC4090</a>]   Pan, P., Ed., Swallow, G., Ed., and A. Atlas, Ed., "Fast
               Reroute Extensions to RSVP-TE for LSP Tunnels", <a href="rfc4090.html">RFC 4090</a>,
               May 2005.

   [<a id="ref-RFC4201" name="ref-RFC4201">RFC4201</a>]   Kompella, K., Rekhter, Y., and L. Berger, "Link Bundling
               in MPLS Traffic Engineering (TE)", <a href="rfc4201.html">RFC 4201</a>,
               October 2005.

   [<a id="ref-RFC4301" name="ref-RFC4301">RFC4301</a>]   Kent, S. and K. Seo, "Security Architecture for the
               Internet Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.

   [<a id="ref-RFC4378" name="ref-RFC4378">RFC4378</a>]   Allan, D., Ed., and T. Nadeau, Ed., "A Framework for
               Multi-Protocol Label Switching (MPLS) Operations and
               Management (OAM)", <a href="rfc4378.html">RFC 4378</a>, February 2006.

   [<a id="ref-RFC5286" name="ref-RFC5286">RFC5286</a>]   Atlas, A., Ed., and A. Zinin, Ed., "Basic Specification
               for IP Fast Reroute: Loop-Free Alternates", <a href="rfc5286.html">RFC 5286</a>,
               September 2008.

   [<a id="ref-RFC5462" name="ref-RFC5462">RFC5462</a>]   Andersson, L. and R. Asati, "Multiprotocol Label
               Switching (MPLS) Label Stack Entry: "EXP" Field Renamed
               to "Traffic Class" Field", <a href="rfc5462.html">RFC 5462</a>, February 2009.

   [<a id="ref-RFC5654" name="ref-RFC5654">RFC5654</a>]   Niven-Jenkins, B., Ed., Brungard, D., Ed., Betts, M.,
               Ed., Sprecher, N., and S. Ueno, "Requirements of an MPLS
               Transport Profile", <a href="rfc5654.html">RFC 5654</a>, September 2009.

   [<a id="ref-RFC5880" name="ref-RFC5880">RFC5880</a>]   Katz, D. and D. Ward, "Bidirectional Forwarding Detection
               (BFD)", <a href="rfc5880.html">RFC 5880</a>, June 2010.

   [<a id="ref-RFC5920" name="ref-RFC5920">RFC5920</a>]   Fang, L., Ed., "Security Framework for MPLS and GMPLS
               Networks", <a href="rfc5920.html">RFC 5920</a>, July 2010.






<span class="grey">Bryant, et al.               Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6391.html">RFC 6391</a>                         FAT-PW                    November 2011</span>


Authors' Addresses

   Stewart Bryant (editor)
   Cisco Systems
   250 Longwater Ave.
   Reading  RG2 6GB
   United Kingdom

   Phone: +44-208-824-8828
   EMail: stbryant@cisco.com


   Clarence Filsfils
   Cisco Systems
   Brussels
   Belgium

   EMail: cfilsfil@cisco.com


   Ulrich Drafz
   Deutsche Telekom
   Muenster
   Germany

   EMail: Ulrich.Drafz@telekom.de


   Vach Kompella
   Alcatel-Lucent

   EMail: vach.kompella@alcatel-lucent.com


   Joe Regan
   Alcatel-Lucent

   EMail: joe.regan@alcatel-lucent.com


   Shane Amante
   Level 3 Communications, LLC
   1025 Eldorado Blvd.
   Broomfield, CO  80021
   USA

   EMail: shane@level3.net




Bryant, et al.               Standards Track                   [Page 19]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.127, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6391 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:20:07 GMT --></html>