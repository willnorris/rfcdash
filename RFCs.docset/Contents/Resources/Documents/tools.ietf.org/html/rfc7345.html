<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7345 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:22 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-holmberg-mmusic-udptl-dtls" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7345" name="DC.Identifier"/>
<meta content="August, 2014" name="DC.Date.Issued"/>
<meta content="Holmberg, Christer" name="DC.Creator"/>
<meta content="Sedlacek, Ivo" name="DC.Creator"/>
<meta content="Salgueiro, Gonzalo" name="DC.Creator"/>
<meta content="This document specifies how the UDP Transport Layer (UDPTL) protocol,
the predominant transport protocol for T.38 fax, can be transported
over the Datagram Transport Layer Security (DTLS) protocol, how the
usage of UDPTL over DTLS is indicated in the Session Description
Protocol (SDP), and how UDPTL over DTLS is negotiated in a session
established using the Session Initiation Protocol (SIP)." name="DC.Description.Abstract"/>
<meta content="UDP Transport Layer (UDPTL) over Datagram Transport Layer Security (DTLS)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7345 - UDP Transport Layer (UDPTL) over Datagram Transport Layer Security (DTLS)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7345.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7345" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mmusic-udptl-dtls" title="draft-ietf-mmusic-udptl-dtls">draft-ietf-mmus...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7345" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7345" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7345" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                       C. Holmberg
Request for Comments: 7345                                   I. Sedlacek
Category: Standards Track                                       Ericsson
ISSN: 2070-1721                                             G. Salgueiro
                                                                   Cisco
                                                             August 2014


                      <span class="h1">UDP Transport Layer (UDPTL)</span>
             <span class="h1">over Datagram Transport Layer Security (DTLS)</span>

Abstract

   This document specifies how the UDP Transport Layer (UDPTL) protocol,
   the predominant transport protocol for T.38 fax, can be transported
   over the Datagram Transport Layer Security (DTLS) protocol, how the
   usage of UDPTL over DTLS is indicated in the Session Description
   Protocol (SDP), and how UDPTL over DTLS is negotiated in a session
   established using the Session Initiation Protocol (SIP).

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7345">http://www.rfc-editor.org/info/rfc7345</a>.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



<span class="grey">Holmberg, et al.             Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions .....................................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Secure Channel ..................................................<a href="#page-5">5</a>
   <a href="#section-4">4</a>. SDP Offerer/Answerer Procedures .................................<a href="#page-6">6</a>
      <a href="#section-4.1">4.1</a>. General ....................................................<a href="#page-6">6</a>
      <a href="#section-4.2">4.2</a>. Generating the Initial Offer ...............................<a href="#page-7">7</a>
      <a href="#section-4.3">4.3</a>. Generating the Answer ......................................<a href="#page-7">7</a>
      <a href="#section-4.4">4.4</a>. Offerer Processing of the Answer ...........................<a href="#page-7">7</a>
      <a href="#section-4.5">4.5</a>. Modifying the Session ......................................<a href="#page-7">7</a>
   <a href="#section-5">5</a>. Miscellaneous Considerations ....................................<a href="#page-8">8</a>
      <a href="#section-5.1">5.1</a>. Anonymous Calls ............................................<a href="#page-8">8</a>
      <a href="#section-5.2">5.2</a>. NAT Traversal ..............................................<a href="#page-8">8</a>
           <a href="#section-5.2.1">5.2.1</a>. ICE Usage ...........................................<a href="#page-8">8</a>
           <a href="#section-5.2.2">5.2.2</a>. STUN Interaction ....................................<a href="#page-8">8</a>
      <a href="#section-5.3">5.3</a>. Rekeying ...................................................<a href="#page-9">9</a>
      <a href="#section-5.4">5.4</a>. Compatibility with UDPTL over UDP ..........................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Security Considerations .........................................<a href="#page-9">9</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-10">10</a>
   <a href="#section-8">8</a>. Acknowledgments ................................................<a href="#page-10">10</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-11">11</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-11">11</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>.  Examples .............................................<a href="#page-13">13</a>
     <a href="#appendix-A.1">A.1</a>.  General ...................................................<a href="#page-13">13</a>
     <a href="#appendix-A.2">A.2</a>.  Basic Message Flow ........................................<a href="#page-13">13</a>
     A.3.  Message Flow of T.38 Fax Replacing Audio Media Stream in
           an Existing Audio-Only Session ............................<a href="#page-20">20</a>






















<span class="grey">Holmberg, et al.             Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   While it is possible to transmit highly sensitive documents using
   traditional telephony encryption devices, secure fax on the Public
   Switched Telephone Network (PSTN) was never widely considered or
   prioritized.  This was mainly because of the challenges involved with
   malevolent physical access to telephony equipment.  As real-time
   communications transition to IP networks, where information might
   potentially be intercepted or spoofed, an appropriate level of
   security for fax that offers integrity and confidentiality protection
   is vital.

   The overwhelmingly predominant fax transport protocol is UDPTL-based,
   as described in Section 9.1 of [<a href="#ref-ITU.T38.2010">ITU.T38.2010</a>].  The protocol stack
   for fax transport using UDPTL is shown in Figure 1.

                         +-----------------------------+
                         | Internet facsimile protocol |
                         +-----------------------------+
                         |            UDPTL            |
                         +-----------------------------+
                         |            UDP              |
                         +-----------------------------+
                         |            IP               |
                         +-----------------------------+

                Figure 1: Protocol Stack for UDPTL over UDP

   The following mechanisms are available for securing fax:

   o  Annex H of [<a href="#ref-ITU.T30.2005">ITU.T30.2005</a>] specifies an application-layer integrity
      and confidentiality protection of fax that is independent of the
      transport protocol and is based on the RSA algorithm for use with
      the T.30 telephony protocol by Group 3 facsimile equipment (G3FE).

   o  [<a href="#ref-ITU.T38.2010">ITU.T38.2010</a>] specifies fax transport over RTP/SAVP, which
      enables integrity and confidentiality protection of fax in IP
      networks.

   Both of these mechanisms have been available for many years and never
   gained any significant adoption in the market.  This has prompted an
   effort to develop an approach, based on open standards, for securing
   fax communications over an IP-based transport.

   Telephony-based protocols like T.30 offer application-level security
   options like the RSA-based approach detailed in Annex H of the T.30
   specification [<a href="#ref-ITU.T30.2005">ITU.T30.2005</a>].  The problem is that it is very
   sparingly implemented and not enforced at the transport level.



<span class="grey">Holmberg, et al.             Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   It is worth noting that while T.38 over RTP offers a very viable
   option for such standards-based IP security solution using Secure
   Realtime Transport Protocol (SRTP), this fax-over-IP transport never
   gained any traction in the marketplace and accounts for a negligible
   percentage of fax-over-IP implementations.

   Thus, security mechanisms offering integrity and confidentiality
   protection should be limited to UDPTL-based fax transport, which is
   the only broad-based fax-over-IP solution.  The 3rd Generation
   Partnership Project (3GPP) launched a study on how best to provide
   secure fax in the IP Multimedia Subsystem (IMS) for UDPTL.  Results
   of the study confirmed that this security was best achieved by using
   UDPTL over DTLS.

   This document specifies fax transport using UDPTL over DTLS
   [<a href="rfc6347.html" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>], which enables integrity and confidentiality protection of
   fax in IP networks.  The protocol stack that enhances fax transport
   to offer integrity and confidentiality using UDPTL over DTLS is shown
   in Figure 2.

                         +-----------------------------+
                         | Internet facsimile protocol |
                         +-----------------------------+
                         |            UDPTL            |
                         +-----------------------------+
                         |            DTLS             |
                         +-----------------------------+
                         |            UDP              |
                         +-----------------------------+
                         |            IP               |
                         +-----------------------------+

           Figure 2: Protocol Stack for UDPTL over DTLS over UDP

   The primary motivations for the mechanism in this document are:

   o  The design of DTLS [<a href="rfc6347.html" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>] is clearly defined and well
      understood, and implementations are widely available.

   o  No DTLS extensions are required in order to enable UDPTL transport
      over DTLS.

   o  Fax transport using UDPTL over DTLS only requires insertion of the
      DTLS layer between the UDPTL layer and the UDP layer, as shown in
      Figure 2.  The UDPTL layer and the layers above the UDPTL layer
      require no modifications.





<span class="grey">Holmberg, et al.             Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   o  UDPTL [<a href="#ref-ITU.T38.2010">ITU.T38.2010</a>] is by far the most widely deployed fax
      transport protocol in IP networks.

   o  3GPP and the IP fax community need a mechanism to transport UDPTL
      over DTLS in order to provide secure fax in SIP-based networks
      (including IMS).

   This document specifies the transport of UDPTL over DTLS using the
   DTLS record layer "application_data" packets [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] [<a href="rfc6347.html" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>].

   Since the DTLS record layer "application_data" packet does not
   indicate whether it carries UDPTL or some other protocol, the usage
   of a dedicated DTLS association for transport of UDPTL needs to be
   negotiated, e.g., using the Session Description Protocol (SDP)
   [<a href="rfc4566.html" title='"SDP: Session Description Protocol"'>RFC4566</a>] and the SDP offer/answer mechanism [<a href="rfc3264.html" title='"An Offer/Answer Model with Session Description Protocol (SDP)"'>RFC3264</a>].

   Therefore, this document specifies a new &lt;proto&gt; value [<a href="rfc4566.html" title='"SDP: Session Description Protocol"'>RFC4566</a>] for
   the SDP media description ("m=" line) [<a href="rfc3264.html" title='"An Offer/Answer Model with Session Description Protocol (SDP)"'>RFC3264</a>], in order to indicate
   UDPTL over DTLS in SDP messages [<a href="rfc4566.html" title='"SDP: Session Description Protocol"'>RFC4566</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Conventions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>
   [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   DTLS uses the term "session" to refer to a long-lived set of keying
   material that spans DTLS associations.  In this document, in order to
   be consistent with SIP/SDP usage of "session" terminology, we use
   "session" to refer to a multimedia session and use the term "DTLS
   session" to refer to the DTLS construct.  We use the term "DTLS
   association" to refer to a particular DTLS cipher suite and keying
   material set that is associated with a single host/port quartet.  The
   same DTLS session can be used to establish the keying material for
   multiple DTLS associations.  For consistency with other SIP/SDP
   usage, we use the term "connection" when what's being referred to is
   a multimedia stream that is not specifically DTLS.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Secure%20Channel"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Secure Channel</span>

   The UDPTL-over-DTLS media stream is negotiated using the SDP offer/
   answer mechanism [<a href="rfc3264.html" title='"An Offer/Answer Model with Session Description Protocol (SDP)"'>RFC3264</a>].  See <a href="#section-4">Section 4</a> for more details.

   DTLS is used as specified in [<a href="rfc6347.html" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>].  Once the DTLS handshake is
   successfully completed (in order to prevent facsimile data from being
   transmitted insecurely), the UDPTL packets MUST be transported in
   DTLS record layer "application_data" packets.



<span class="grey">Holmberg, et al.             Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20SDP%20Offerer%2FAnswerer%20Procedures"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  SDP Offerer/Answerer Procedures</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20General"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  General</span>

   An endpoint (i.e., both the offerer and the answerer) MUST create an
   SDP media description ("m=" line) for each UDPTL-over-DTLS media
   stream and MUST assign a UDP/TLS/UDPTL value (see Table 1) to the
   "proto" field of the "m=" line.

   The procedures in this section apply to an "m=" line associated with
   a UDPTL-over-DTLS media stream.

   In order to negotiate a UDPTL-over-DTLS media stream, the following
   SDP attributes are used:

   o  The SDP attributes defined for UDPTL over UDP, as described in
      [<a href="#ref-ITU.T38.2010">ITU.T38.2010</a>]; and

   o  The SDP attributes, defined in [<a href="rfc4145.html" title='"TCP-Based Media Transport in the Session Description Protocol (SDP)"'>RFC4145</a>] and [<a href="rfc4572.html" title='"Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP)"'>RFC4572</a>], as
      described in this section.

   The endpoint MUST NOT use the SDP "connection" attribute [<a href="rfc4145.html" title='"TCP-Based Media Transport in the Session Description Protocol (SDP)"'>RFC4145</a>].

   In order to negotiate the TLS roles for the UDPTL-over-DTLS transport
   connection, the endpoint MUST use the SDP "setup" attribute
   [<a href="rfc4145.html" title='"TCP-Based Media Transport in the Session Description Protocol (SDP)"'>RFC4145</a>].

   If the endpoint supports, and is willing to use, a cipher suite with
   an associated certificate, the endpoint MUST include an SDP
   "fingerprint" attribute [<a href="rfc4572.html" title='"Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP)"'>RFC4572</a>].  The endpoint MUST support SHA-256
   for generating and verifying the SDP "fingerprint" attribute value.
   The use of SHA-256 is preferred.  UDPTL over DTLS, at a minimum, MUST
   support TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 and MUST support
   TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256.  UDPTL over DTLS MUST prefer
   TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 and any other Perfect Forward
   Secrecy (PFS) cipher suites over non-PFS cipher suites.
   Implementations SHOULD disable TLS-level compression.

   If a cipher suite with an associated certificate is selected during
   the DTLS handshake, the certificate received during the DTLS
   handshake MUST match the fingerprint received in the SDP
   "fingerprint" attribute.  If the fingerprint does not match the
   hashed certificate, then the endpoint MUST tear down the media
   session immediately.  Note that it is permissible to wait until the
   other side's fingerprint has been received before establishing the
   connection; however, this may have undesirable latency effects.





<span class="grey">Holmberg, et al.             Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Generating%20the%20Initial%20Offer"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Generating the Initial Offer</span>

   The offerer SHOULD assign the SDP "setup" attribute with a value of
   "actpass", unless the offerer insists on being either the sender or
   receiver of the DTLS ClientHello message, in which case the offerer
   can use either a value of "active" (the offerer will be the sender of
   ClientHello) or "passive" (the offerer will be the receiver of
   ClientHello).  The offerer MUST NOT assign an SDP "setup" attribute
   with a "holdconn" value.

   If the offerer assigns the SDP "setup" attribute with a value of
   "actpass" or "passive", the offerer MUST be prepared to receive a
   DTLS ClientHello message before it receives the SDP answer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Generating%20the%20Answer"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Generating the Answer</span>

   If the answerer accepts the offered UDPTL-over-DTLS transport
   connection, in the associated SDP answer, the answerer MUST assign an
   SDP "setup" attribute with a value of either "active" or "passive",
   according to the procedures in [<a href="rfc4145.html" title='"TCP-Based Media Transport in the Session Description Protocol (SDP)"'>RFC4145</a>].  The answerer MUST NOT
   assign an SDP "setup" attribute with a value of "holdconn".

   If the answerer assigns an SDP "setup" attribute with a value of
   "active" value, the answerer MUST initiate a DTLS handshake by
   sending a DTLS ClientHello message on the negotiated media stream,
   towards the IP address and port of the offerer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Offerer%20Processing%20of%20the%20Answer"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Offerer Processing of the Answer</span>

   When the offerer receives an SDP answer, if the offerer ends up being
   active it MUST initiate a DTLS handshake by sending a DTLS
   ClientHello message on the negotiated media stream, towards the IP
   address and port of the answerer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20Modifying%20the%20Session"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  Modifying the Session</span>

   Once an offer/answer exchange has been completed, either endpoint MAY
   send a new offer in order to modify the session.  The endpoints can
   reuse the existing DTLS association if the key fingerprint values and
   transport parameters indicated by each endpoint are unchanged.
   Otherwise, following the rules for the initial offer/answer exchange,
   the endpoints can negotiate and create a new DTLS association and,
   once created, delete the previous DTLS association, following the
   same rules for the initial offer/answer exchange.  Each endpoint
   needs to be prepared to receive data on both the new and old DTLS
   associations as long as both are alive.





<span class="grey">Holmberg, et al.             Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Miscellaneous%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Miscellaneous Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Anonymous%20Calls"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Anonymous Calls</span>

   When making anonymous calls, a new self-signed certificate SHOULD be
   used for each call, and attributes inside the certificate MUST NOT
   contain information that allows either correlation or identification
   of the user making anonymous calls.  This is particularly important
   for the "subjectAltName" and "commonName" attributes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20NAT%20Traversal"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  NAT Traversal</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20ICE%20Usage"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  ICE Usage</span>

   When Interactive Connectivity Establishment (ICE) [<a href="rfc5245.html" title='"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols"'>RFC5245</a>] is being
   used, the ICE connectivity checks are performed before the DTLS
   handshake begins.  Note that if aggressive nomination mode is used,
   multiple candidate pairs may be marked valid before ICE finally
   converges on a single candidate pair.  User Agents (UAs) MUST treat
   all ICE candidate pairs associated with a single component as part of
   the same DTLS association.  Thus, there will be only one DTLS
   handshake even if there are multiple valid candidate pairs.  Note
   that this may mean adjusting the endpoint IP addresses if the
   selected candidate pair shifts, just as if the DTLS packets were an
   ordinary media stream.  In the case of an ICE restart, the DTLS
   handshake procedure is repeated, and a new DTLS association is
   created.  Once the DTLS handshake is completed and the new DTLS
   association has been created, the previous DTLS association is
   deleted.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20STUN%20Interaction"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  STUN Interaction</span>

   The UA MUST send the Session Traversal Utilities for NAT (STUN)
   packets [<a href="rfc5389.html" title='"Session Traversal Utilities for NAT (STUN)"'>RFC5389</a>] directly over UDP, not over DTLS.

   The UA MUST support the following mechanism for demultiplexing
   packets arriving on the IP address and port associated with the DTLS
   association:

   o  If the value of the first byte of the packet is 0 or 1, then the
      packet is STUN.

   o  If the value of the first byte of the packet is between 20 and 63
      (inclusive), the packet is DTLS.







<span class="grey">Holmberg, et al.             Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Rekeying"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Rekeying</span>

   During rekeying, packets protected by the previous set of keys can
   arrive after the DTLS handshake caused by rekeying has completed,
   because packets can be reordered on the wire.  To compensate for this
   fact, receivers MUST maintain both sets of keys for some time in
   order to be able to decrypt and verify older packets.  The duration
   of maintaining the previous set of keys after the finish of the DTLS
   handshake is out of the scope of this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20Compatibility%20with%20UDPTL%20over%20UDP"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  Compatibility with UDPTL over UDP</span>

   If a user requires fax to be transported securely using UDPTL over
   DTLS, and if the remote user does not support UDPTL over DTLS, then a
   fax media stream cannot be established.

   If a user prefers fax to be transported securely using UDPTL over
   DTLS but is willing to transport the fax insecurely in case the
   remote user does not support UDPTL over DTLS, then the SDP Capability
   Negotiation mechanism [<a href="rfc5939.html" title='"Session Description Protocol (SDP) Capability Negotiation"'>RFC5939</a>] can be used to offer both UDPTL over
   DTLS and UDPTL over UDP.  Alternatively, if the remote user rejects
   an SDP offer for UDPTL over DTLS, a new SDP offer for a UDPTL-over-
   UDP media stream can be sent.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   Fax may be used to transmit a wide range of sensitive data, including
   personal, corporate, and governmental information.  It is therefore
   critical to be able to protect against threats to the confidentiality
   and integrity of the transmitted data.

   The mechanism in this document provides integrity and confidentiality
   protection for fax by specifying fax transport using UDPTL over DTLS
   [<a href="rfc6347.html" title='"Datagram Transport Layer Security Version 1.2"'>RFC6347</a>].

   DTLS media stream negotiated using SIP/SDP requires a mechanism to
   ensure that the certificate received via DTLS was issued by the
   remote party of the SIP session.

   The standard DTLS strategy for authenticating the communicating
   parties is to give the server (and optionally the client) a PKIX
   [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] certificate.  The client then verifies the certificate and
   checks that the name in the certificate matches the server's domain
   name.  This works because there are a relatively small number of
   servers and the cost for issuing and deploying PKIX certificates can
   be justified.  Issuing and deploying PKIX certificates to all clients
   is not realistic in most deployment scenarios.




<span class="grey">Holmberg, et al.             Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   The design described in this document is intended to leverage the
   integrity protection of the SIP signaling, while not requiring
   confidentiality.  As long as each side of the connection can verify
   the integrity of the SDP received from the other side, then the DTLS
   handshake cannot be hijacked via a man-in-the-middle attack.  This
   integrity protection is easily provided by the caller to the callee
   via the SIP Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] mechanism.  Other mechanisms, such as
   the S/MIME mechanism [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] or perhaps future mechanisms yet to be
   specified, could also serve this purpose.

   While this mechanism can still be used without such integrity
   mechanisms, the security provided is limited to defense against
   passive attack by intermediaries.  An active attack on the signaling
   plus an active attack on the media plane can allow an attacker to
   attack the connection (R-SIG-MEDIA in the notation of [<a href="rfc5479.html" title='"Requirements and Analysis of Media Security Management Protocols"'>RFC5479</a>]).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   This document updates the "Session Description Protocol (SDP)
   Parameters" registry as specified in <a href="rfc4566.html#section-8.2.2">Section 8.2.2 of [RFC4566]</a>.
   Specifically, the values in Table 1 have been added to the SDP
   "proto" field registry.

                   +-------+---------------+-----------+
                   |  Type |    SDP Name   | Reference |
                   +-------+---------------+-----------+
                   | proto | UDP/TLS/UDPTL | [<a href="rfc7345.html">RFC7345</a>] |
                   +-------+---------------+-----------+

                     Table 1: SDP "proto" Field Values

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgments"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgments</span>

   Special thanks to Peter Dawes, who provided comments on the initial
   draft version of the document, and to Paul E. Jones, James Rafferty,
   Albrecht Schwarz, Oscar Ohlsson, David Hanes, Adam Gensler, Ari
   Keranen, Flemming Andreasen, John Mattsson, and Marc Petit-Huguenin,
   who provided valuable feedback and input.  Barry Leiba, Spencer
   Dawkins, Pete Resnick, Kathleen Moriarty, and Stephen Farrell
   provided valuable feedback during the IESG review.  Thanks to Scott
   Brim for performing the Gen-ART review.  Thanks to Alissa Cooper for
   her help as sponsoring Area Director.









<span class="grey">Holmberg, et al.             Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-ITU.T30.2005" name="ref-ITU.T30.2005">ITU.T30.2005</a>]
              International Telecommunications Union, "Procedures for
              document facsimile transmission in the general switched
              telephone network", ITU-T Recommendation T.30, September
              2005.

   [<a id="ref-ITU.T38.2010" name="ref-ITU.T38.2010">ITU.T38.2010</a>]
              International Telecommunications Union, "Procedures for
              real-time Group 3 facsimile communication over IP
              networks", ITU-T Recommendation T.38, September 2010.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

   [<a id="ref-RFC3264" name="ref-RFC3264">RFC3264</a>]  Rosenberg, J. and H. Schulzrinne, "An Offer/Answer Model
              with Session Description Protocol (SDP)", <a href="rfc3264.html">RFC 3264</a>, June
              2002.

   [<a id="ref-RFC4145" name="ref-RFC4145">RFC4145</a>]  Yon, D. and G. Camarillo, "TCP-Based Media Transport in
              the Session Description Protocol (SDP)", <a href="rfc4145.html">RFC 4145</a>,
              September 2005.

   [<a id="ref-RFC4474" name="ref-RFC4474">RFC4474</a>]  Peterson, J. and C. Jennings, "Enhancements for
              Authenticated Identity Management in the Session
              Initiation Protocol (SIP)", <a href="rfc4474.html">RFC 4474</a>, August 2006.

   [<a id="ref-RFC4566" name="ref-RFC4566">RFC4566</a>]  Handley, M., Jacobson, V., and C. Perkins, "SDP: Session
              Description Protocol", <a href="rfc4566.html">RFC 4566</a>, July 2006.

   [<a id="ref-RFC4572" name="ref-RFC4572">RFC4572</a>]  Lennox, J., "Connection-Oriented Media Transport over the
              Transport Layer Security (TLS) Protocol in the Session
              Description Protocol (SDP)", <a href="rfc4572.html">RFC 4572</a>, July 2006.

   [<a id="ref-RFC5245" name="ref-RFC5245">RFC5245</a>]  Rosenberg, J., "Interactive Connectivity Establishment
              (ICE): A Protocol for Network Address Translator (NAT)
              Traversal for Offer/Answer Protocols", <a href="rfc5245.html">RFC 5245</a>, April
              2010.





<span class="grey">Holmberg, et al.             Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, May 2008.

   [<a id="ref-RFC5389" name="ref-RFC5389">RFC5389</a>]  Rosenberg, J., Mahy, R., Matthews, P., and D. Wing,
              "Session Traversal Utilities for NAT (STUN)", <a href="rfc5389.html">RFC 5389</a>,
              October 2008.

   [<a id="ref-RFC6347" name="ref-RFC6347">RFC6347</a>]  Rescorla, E. and N. Modadugu, "Datagram Transport Layer
              Security Version 1.2", <a href="rfc6347.html">RFC 6347</a>, January 2012.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>, August 2008.

   [<a id="ref-RFC5479" name="ref-RFC5479">RFC5479</a>]  Wing, D., Fries, S., Tschofenig, H., and F. Audet,
              "Requirements and Analysis of Media Security Management
              Protocols", <a href="rfc5479.html">RFC 5479</a>, April 2009.

   [<a id="ref-RFC5939" name="ref-RFC5939">RFC5939</a>]  Andreasen, F., "Session Description Protocol (SDP)
              Capability Negotiation", <a href="rfc5939.html">RFC 5939</a>, September 2010.




























<span class="grey">Holmberg, et al.             Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Examples"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Examples</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20General"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  General</span>

   Prior to establishing the session, both Alice and Bob generate self-
   signed certificates that are used for a single session or, more
   likely, reused for multiple sessions.

   The SIP signaling from Alice to her proxy is transported over TLS to
   ensure an integrity-protected channel between Alice and her identity
   service.  Alice's identity service asserts identity of Alice and
   protects the SIP message, e.g., using SIP Identity.  Transport
   between proxies should also be protected, e.g., by use of TLS.

   In order to simplify the flow, only one element is shown for Alice's
   and Bob's proxies.

   For the sake of brevity and simplicity, only the mandatory SDP T.38
   attributes are shown.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Basic%20Message%20Flow"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Basic Message Flow</span>

   Figure 3 shows an example message flow of session establishment for
   T.38 fax securely transported using UDPTL over DTLS.

   In this example flow, Alice acts as the passive endpoint of the DTLS
   association, and Bob acts as the active endpoint of the DTLS
   association.























<span class="grey">Holmberg, et al.             Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


         Alice                    Proxies                   Bob
           | (1) SIP INVITE         |                        |
           |-----------------------&gt;|                        |
           |                        | (2) SIP INVITE         |
           |                        |-----------------------&gt;|
           |                        |   (3) DTLS ClientHello |
           |&lt;------------------------------------------------|
           |    (4) remaining messages of DTLS handshake     |
           |&lt;-----------------------------------------------&gt;|
           |                        |                        |
           |                        |                        |
           |                        |         (5) SIP 200 OK |
           |                        |&lt;-----------------------|
           |         (6) SIP 200 OK |                        |
           |&lt;-----------------------|                        |
           | (7) SIP ACK            |                        |
           |------------------------------------------------&gt;|
           |      (8) T.38 message using UDPTL over DTLS     |
           |&lt;-----------------------------------------------&gt;|
           |                        |                        |

                       Figure 3: Basic Message Flow





























<span class="grey">Holmberg, et al.             Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   Message (1):

      Figure 4 shows the initial INVITE request sent by Alice to Alice's
      proxy.  The initial INVITE request contains an SDP offer.

      The "m=" line in the SDP offer indicates T.38 fax using UDPTL over
      DTLS.

      The SDP "setup" attribute with a value of "actpass" in the SDP
      offer indicates that Alice has requested to be either the active
      or passive endpoint.

      The SDP "fingerprint" attribute in the SDP offer contains the
      certificate fingerprint computed from Alice's self-signed
      certificate.

   INVITE sip:bob@example.com SIP/2.0
   To: &lt;sip:bob@example.com&gt;
   From: "Alice"&lt;sip:alice@example.com&gt;;tag=843c7b0b
   Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
   Contact: &lt;sip:alice@ua1.example.com&gt;
   Call-ID: 6076913b1c39c212@REVMTEpG
   CSeq: 1 INVITE
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, UPDATE
   Max-Forwards: 70
   Content-Type: application/sdp
   Content-Length: xxxx
   Supported: from-change

   v=0
   o=- 1181923068 1181923196 IN IP4 ua1.example.com
   s=-
   c=IN IP4 ua1.example.com
   t=0 0
   m=image 6056 UDP/TLS/UDPTL t38
   a=setup:actpass
   a=fingerprint: SHA-1 \
     4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                           Figure 4: Message (1)










<span class="grey">Holmberg, et al.             Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   Message (2):

      Figure 5 shows the SIP INVITE request sent by Bob's proxy to Bob.

      When received, Bob verifies the identity provided in the SIP
      INVITE request.

   INVITE sip:bob@ua2.example.com SIP/2.0
   To: &lt;sip:bob@example.com&gt;
   From: "Alice"&lt;sip:alice@example.com&gt;;tag=843c7b0b
   Via: SIP/2.0/TLS proxy.example.com;branch=z9hG4bK-0e53sadfkasldk
   Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
   Record-Route: &lt;sip:proxy.example.com;lr&gt;
   Contact: &lt;sip:alice@ua1.example.com&gt;
   Call-ID: 6076913b1c39c212@REVMTEpG
   CSeq: 1 INVITE
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, UPDATE
   Max-Forwards: 69
   Content-Type: application/sdp
   Content-Length: xxxx
   Supported: from-change

   v=0
   o=- 1181923068 1181923196 IN IP4 ua1.example.com
   s=-
   c=IN IP4 ua1.example.com
   t=0 0
   m=image 6056 UDP/TLS/UDPTL t38
   a=setup:actpass
   a=fingerprint: SHA-1 \
     4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                           Figure 5: Message (2)

















<span class="grey">Holmberg, et al.             Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   Message (3):

      Assuming that Alice's identity is valid, Bob sends a DTLS
      ClientHello directly to Alice.

   Message (4):

      Alice and Bob exchange further messages of DTLS handshake
      (HelloVerifyRequest, ClientHello, ServerHello, Certificate,
      ServerKeyExchange, CertificateRequest, ServerHelloDone,
      Certificate, ClientKeyExchange, CertificateVerify,
      ChangeCipherSpec, and Finished).

      When Bob receives the certificate of Alice via DTLS, Bob checks
      whether the certificate fingerprint calculated from Alice's
      certificate received via DTLS matches the certificate fingerprint
      received in the a=fingerprint SDP attribute of Figure 5.  In this
      message flow, the check is successful; thus, session setup
      continues.

      Note that, unlike in this example, it is not necessary to wait for
      the DTLS handshake to finish before the SDP answer is sent.  If
      Bob has sent the SIP 200 (OK) response and later detects that the
      certificate fingerprints do not match, he will terminate the
      session.

   Message (5):

      Figure 6 shows a SIP 200 (OK) response to the initial SIP INVITE
      request, sent by Bob to Bob's proxy.  The SIP 200 (OK) response
      contains an SDP answer.

      The "m=" line in the SDP answer indicates T.38 fax using UDPTL
      over DTLS.

      The SDP "setup" attribute with a value of "active" in the SDP
      answer indicates that Bob has requested to be the active endpoint.

      The SDP "fingerprint" attribute in the SDP answer contains the
      certificate fingerprint computed from Bob's self-signed
      certificate.










<span class="grey">Holmberg, et al.             Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   SIP/2.0 200 OK
   To: &lt;sip:bob@example.com&gt;;tag=6418913922105372816
   From: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
   Via: SIP/2.0/TLS proxy.example.com:5061;branch=z9hG4bK-0e53sadfkasldk
   Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
   Record-Route: &lt;sip:proxy.example.com;lr&gt;
   Call-ID: 6076913b1c39c212@REVMTEpG
   CSeq: 1 INVITE
   Contact: &lt;sip:bob@ua2.example.com&gt;
   Content-Type: application/sdp
   Content-Length: xxxx
   Supported: from-change

   v=0
   o=- 8965454521 2105372818 IN IP4 ua2.example.com
   s=-
   c=IN IP4 ua2.example.com
   t=0 0
   m=image 12000 UDP/TLS/UDPTL t38
   a=setup:active
   a=fingerprint: SHA-1 \
     FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                           Figure 6: Message (5)


























<span class="grey">Holmberg, et al.             Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   Message (6):

      Figure 7 shows a SIP 200 (OK) response to the initial SIP INVITE
      request, sent by Alice's proxy to Alice.  Alice checks if the
      certificate fingerprint calculated from the Bob's certificate
      received via DTLS is the same as the certificate fingerprint
      received in the a=fingerprint SDP attribute of Figure 7.  In this
      message flow, the check is successful; thus, the session setup
      continues.

   SIP/2.0 200 OK
   To: &lt;sip:bob@example.com&gt;;tag=6418913922105372816
   From: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
   Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
   Record-Route: &lt;sip:proxy.example.com;lr&gt;
   Call-ID: 6076913b1c39c212@REVMTEpG
   CSeq: 1 INVITE
   Contact: &lt;sip:bob@ua2.example.com&gt;
   Content-Type: application/sdp
   Content-Length: xxxx
   Supported: from-change

   v=0
   o=- 8965454521 2105372818 IN IP4 ua2.example.com
   s=-
   c=IN IP4 ua2.example.com
   t=0 0
   m=image 12000 UDP/TLS/UDPTL t38
   a=setup:active
   a=fingerprint: SHA-1 \
     FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                           Figure 7: Message (6)

   Message (7):

      Alice sends the SIP ACK request to Bob.

   Message (8):

      At this point, Bob and Alice can exchange T.38 fax securely
      transported using UDPTL over DTLS.








<span class="grey">Holmberg, et al.             Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20Message%20Flow%20of%20T.38%20Fax%20Replacing%20Audio%20Media%20Stream%20in%20an"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Message Flow of T.38 Fax Replacing Audio Media Stream in an</span>
      Existing Audio-Only Session

   Traditionally, most sessions with non-secure transport of T.38 fax,
   transported using UDPTL, are established by modifying an ongoing
   audio session into a fax session.  Figure 8 shows an example message
   flow of modifying an existing audio session into a session with T.38
   fax securely transported using UDPTL over DTLS.

   In this example flow, Alice acts as the passive endpoint of the DTLS
   association, and Bob acts as the active endpoint of the DTLS
   association.

         Alice                    Proxies                   Bob
           |                        |                        |
           |        (1) Audio-only session initiation        |
           |&lt;-----------------------+-----------------------&gt;|
           |                        |                        |
           | (2) SIP re-INVITE      |                        |
           |------------------------------------------------&gt;|
           |                        |   (3) DTLS ClientHello |
           |&lt;------------------------------------------------|
           |    (4) remaining messages of DTLS handshake     |
           |&lt;-----------------------------------------------&gt;|
           |                        |                        |
           |                        |                        |
           |                        |         (5) SIP 200 OK |
           |&lt;------------------------------------------------|
           | (6) SIP ACK            |                        |
           |------------------------------------------------&gt;|
           |      (7) T.38 message using UDPTL over DTLS     |
           |&lt;-----------------------------------------------&gt;|
           |                        |                        |

   Figure 8: Message Flow of T.38 Fax Replacing Audio Media Stream in an
                        Existing Audio-Only Session

   Message (1):

      Session establishment of audio-only session.  The proxies decide
      not to record-route.

   Message (2):

      Alice sends SIP re-INVITE request.  The SDP offer included in the
      SIP re-INVITE request is shown in Figure 9.





<span class="grey">Holmberg, et al.             Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


      The first "m=" line in the SDP offer indicates audio media stream
      being removed.  The second "m=" line in the SDP offer indicates
      T.38 fax using UDPTL over DTLS being added.

      The SDP "setup" attribute with a value of "actpass" in the SDP
      offer indicates that Alice has requested to be either the active
      or passive endpoint.

      The SDP "fingerprint" attribute in the SDP offer contains the
      certificate fingerprint computed from Alice's self-signed
      certificate.

   v=0
   o=- 2465353433 3524244442 IN IP4 ua1.example.com
   s=-
   c=IN IP4 ua1.example.com
   t=0 0
   m=audio 0 UDP/TLS/RTP/SAVP 0
   m=image 46056 UDP/TLS/UDPTL t38
   a=setup:actpass
   a=fingerprint: SHA-1 \
     4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                    Figure 9: SDP Offer of Message (2)

   Message (3):

      Bob sends a DTLS ClientHello directly to Alice.

   Message (4):

      Alice and Bob exchange further messages of DTLS handshake
      (HelloVerifyRequest, ClientHello, ServerHello, Certificate,
      ServerKeyExchange, CertificateRequest, ServerHelloDone,
      Certificate, ClientKeyExchange, CertificateVerify,
      ChangeCipherSpec, and Finished).

      When Bob receives the certificate of Alice via DTLS, Bob checks
      whether the certificate fingerprint calculated from Alice's
      certificate received via DTLS matches the certificate fingerprint
      received in the SDP "fingerprint" attribute of Figure 9.  In this
      message flow, the check is successful; thus, session setup
      continues.







<span class="grey">Holmberg, et al.             Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


   Message (5):

      Bob sends a SIP 200 (OK) response to the SIP re-INVITE request.
      The SIP 200 (OK) response contains an SDP answer shown in
      Figure 10.

      The first "m=" line in the SDP offer indicates audio media stream
      being removed.  The second "m=" line in the SDP answer indicates
      T.38 fax using UDPTL over DTLS being added.

      The SDP "setup" attribute with a value of "active" in the SDP
      answer indicates that Bob has requested to be the active endpoint.

      The SDP "fingerprint" attribute in the SDP answer contains the
      certificate fingerprint computed from Bob's self-signed
      certificate.

   v=0
   o=- 4423478999 5424222292 IN IP4 ua2.example.com
   s=-
   c=IN IP4 ua2.example.com
   t=0 0
   m=audio 0 UDP/TLS/RTP/SAVP 0
   m=image 32000 UDP/TLS/UDPTL t38
   a=setup:active
   a=fingerprint: SHA-1 \
     FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
   a=T38FaxRateManagement:transferredTCF

                   Figure 10: SDP Answer of Message (5)

   Message (6):

      Alice sends the SIP ACK request to Bob.

   Message (7):

      At this point, Bob and Alice can exchange T.38 fax securely
      transported using UDPTL over DTLS.












<span class="grey">Holmberg, et al.             Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7345.html">RFC 7345</a>                     UDPTL over DTLS                 August 2014</span>


Authors' Addresses

   Christer Holmberg
   Ericsson
   Hirsalantie 11
   Jorvas  02420
   Finland

   EMail: christer.holmberg@ericsson.com


   Ivo Sedlacek
   Ericsson
   Sokolovska 79
   Praha  18600
   Czech Republic

   EMail: ivo.sedlacek@ericsson.com


   Gonzalo Salgueiro
   Cisco Systems, Inc.
   7200-12 Kit Creek Road
   Research Triangle Park, NC  27709
   US

   EMail: gsalguei@cisco.com
























Holmberg, et al.             Standards Track                   [Page 23]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7345 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:22 GMT --></html>