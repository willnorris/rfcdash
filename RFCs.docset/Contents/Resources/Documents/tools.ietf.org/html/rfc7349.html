<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from tools.ietf.org/html/rfc7349 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:31:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129c" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Relation.Replaces" content="draft-zheng-mpls-ldp-hello-crypto-auth" />
<meta name="DC.Identifier" content="urn:ietf:rfc:7349" />
<meta name="DC.Date.Issued" content="August, 2014" />
<meta name="DC.Creator" content="Chen, Mach" />
<meta name="DC.Creator" content="Zheng, Lianshu" />
<meta name="DC.Creator" content="Bhatia, Manav" />
<meta name="DC.Description.Abstract" content="This document introduces a new optional Cryptographic Authentication
TLV that LDP can use to secure its Hello messages. It secures the
Hello messages against spoofing attacks and some well-known attacks
against the IP header. This document describes a mechanism to secure
the LDP Hello messages using Hashed Message Authentication Code (HMAC)
with the National Institute of Standards and Technology (NIST) Secure
Hash Standard family of algorithms." />
<meta name="DC.Title" content="LDP Hello Cryptographic Authentication" />

    <link rel="icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 7349 - LDP Hello Cryptographic Authentication</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bgblue"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7349.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7349" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mpls-ldp-hello-crypto-auth" title="draft-ietf-mpls-ldp-hello-crypto-auth">draft-ietf-mpls...</a>] [<a href='https://datatracker.ietf.org/doc/rfc7349' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7349" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7349" title="Side-by-side diff">Diff2</a>]         </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Internet Engineering Task Force (IETF)                          L. Zheng
Request for Comments: 7349                                       M. Chen
Category: Standards Track                            Huawei Technologies
ISSN: 2070-1721                                                M. Bhatia
                                                          Ionos Networks
                                                             August 2014


                 <span class="h1">LDP Hello Cryptographic Authentication</span>

Abstract

   This document introduces a new optional Cryptographic Authentication
   TLV that LDP can use to secure its Hello messages.  It secures the
   Hello messages against spoofing attacks and some well-known attacks
   against the IP header.  This document describes a mechanism to secure
   the LDP Hello messages using Hashed Message Authentication Code
   (HMAC) with the National Institute of Standards and Technology (NIST)
   Secure Hash Standard family of algorithms.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7349">http://www.rfc-editor.org/info/rfc7349</a>.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



<span class="grey">Zheng, et al.                Standards Track                    [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
     <a href="#section-1.1">1.1</a>.  Requirements Language . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Cryptographic Authentication TLV  . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-2.1">2.1</a>.  Optional Parameter for Hello Message  . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-2.2">2.2</a>.  LDP Security Association  . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-2.3">2.3</a>.  Cryptographic Authentication TLV Encoding . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-2.4">2.4</a>.  Sequence Number Wrap  . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-3">3</a>.  Cryptographic Authentication Procedure  . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-4">4</a>.  Cross-Protocol Attack Mitigation  . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-5">5</a>.  Cryptographic Aspects . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-5.1">5.1</a>.  Preparing the Cryptographic Key . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-5.2">5.2</a>.  Computing the Hash  . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-5.3">5.3</a>.  Result  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   6.  Processing Hello Message Using Cryptographic Authentication .  10
     <a href="#section-6.1">6.1</a>.  Transmission Using Cryptographic Authentication . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.2">6.2</a>.  Receipt Using Cryptographic Authentication  . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-7">7</a>.  Operational Considerations  . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-8">8</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-9">9</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-10">10</a>. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#section-11">11</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-11.1">11.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-11.2">11.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   The Label Distribution Protocol (LDP) [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>] sets up LDP sessions
   that run between LDP peers.  The peers could either be directly
   connected at the link level or be multiple hops away.  An LDP Label
   Switching Router (LSR) could either be configured with the identity
   of its peers or could discover them using LDP Hello messages.  These
   messages are sent encapsulated in UDP addressed to "all routers on
   this subnet" or to a specific IP address.  Periodic Hello messages
   are also used to maintain the relationship between LDP peers
   necessary to keep the LDP session active.

   Since the Hello messages are sent using UDP and not TCP, these
   messages cannot use the security mechanisms defined for TCP
   [<a href="rfc5926.html" title="&quot;Cryptographic Algorithms for the TCP Authentication Option (TCP-AO)&quot;">RFC5926</a>].  While some configuration guidance is given in [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>]
   to help protect against false discovery messages, it does not provide
   an explicit security mechanism to protect the Hello messages.

   Spoofing a Hello message for an existing adjacency can cause the
   valid adjacency to time out and in turn can result in termination of
   the associated session.  This can occur when the spoofed Hello
   specifies a smaller Hold Time, causing the receiver to expect Hellos



<span class="grey">Zheng, et al.                Standards Track                    [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   within this smaller interval, while the true neighbor continues
   sending Hellos at the previously agreed lower frequency.  Spoofing a
   Hello message can also cause the LDP session to be terminated
   directly, which can occur when the spoofed Hello specifies a
   different Transport Address, other than the previously agreed one
   between neighbors.  Spoofed Hello messages have been observed and
   reported as a real problem in production networks [<a href="rfc6952.html" title="&quot;Analysis of BGP, LDP, PCEP, and MSDP Issues According to the Keying and Authentication for Routing Protocols (KARP) Design Guide&quot;">RFC6952</a>].

   For Link Hello, [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>] states that the threat of spoofed Hellos
   can be reduced by accepting Hellos only on interfaces to which LSRs
   that can be trusted are directly connected and ignoring Hellos not
   addressed to the "all routers on this subnet" multicast group.  The
   Generalized TTL Security Mechanism (GTSM) provides a simple and
   reasonably robust defense mechanism for Link Hello [<a href="rfc6720.html" title="&quot;The Generalized TTL Security Mechanism (GTSM) for the Label Distribution Protocol (LDP)&quot;">RFC6720</a>], but it
   does not secure against packet spoofing attacks or replay attacks
   [<a href="rfc5082.html" title="&quot;The Generalized TTL Security Mechanism (GTSM)&quot;">RFC5082</a>].

   Spoofing attacks via Targeted Hellos are a potentially more serious
   threat.  [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>] states that an LSR can reduce the threat of
   spoofed Targeted Hellos by filtering them and accepting only those
   originating at sources permitted by an access list.  However,
   filtering using access lists requires LSR resources and does not
   prevent IP-address spoofing.

   This document introduces a new Cryptographic Authentication TLV that
   is used in LDP Hello messages as an optional parameter.  It enhances
   the authentication mechanism for LDP by securing the Hello message
   against spoofing attacks.  It also introduces a cryptographic
   sequence number carried in the Hello messages that can be used to
   protect against replay attacks.

   Using this Cryptographic Authentication TLV, one or more secret keys
   (with corresponding Security Association (SA) IDs) are configured in
   each system.  For each LDP Hello message, the key is used to generate
   and verify an HMAC Hash that is stored in the LDP Hello message.  For
   the cryptographic hash function, this document proposes to use SHA-1,
   SHA-256, SHA-384, and SHA-512 defined in US NIST Secure Hash Standard
   (SHS) [<a href="#ref-FIPS-180-4" title="&quot;Secure Hash Standard (SHS)&quot;">FIPS-180-4</a>].  The HMAC authentication mode defined in
   [<a href="rfc2104.html" title="&quot;HMAC: Keyed- Hashing for Message Authentication&quot;">RFC2104</a>] is used.  Of the above, implementations MUST include
   support for at least HMAC-SHA-256, SHOULD include support for HMAC-
   SHA-1, and MAY include support for HMAC-SHA-384 and HMAC-SHA-512.

<span class="h3"><a class="selflink" name="section-1.1" href="#section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].




<span class="grey">Zheng, et al.                Standards Track                    [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Cryptographic Authentication TLV</span>

<span class="h3"><a class="selflink" name="section-2.1" href="#section-2.1">2.1</a>.  Optional Parameter for Hello Message</span>

   [<a name="ref-RFC5036" id="ref-RFC5036">RFC5036</a>] defines the encoding for the Hello message.  Each Hello
   message contains zero or more Optional Parameters, each encoded as a
   TLV.  Three Optional Parameters are defined by [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>].  This
   document defines a new Optional Parameter: the Cryptographic
   Authentication parameter.

   Optional Parameter                Type
   --------------------------------  --------
   IPv4 Transport Address            0x0401 (<a href="rfc5036.html">RFC 5036</a>)
   Configuration Sequence Number     0x0402 (<a href="rfc5036.html">RFC 5036</a>)
   IPv6 Transport Address            0x0403 (<a href="rfc5036.html">RFC 5036</a>)
   Cryptographic Authentication TLV  0x0405 (this document)

   The encoding for the Cryptographic Authentication TLV is described in
   <a href="#section-2.3">Section 2.3</a>.

<span class="h3"><a class="selflink" name="section-2.2" href="#section-2.2">2.2</a>.  LDP Security Association</span>

   An LDP Security Association (SA) contains a set of parameters shared
   between any two legitimate LDP speakers.

   Parameters associated with an LDP SA are as follows:

   o  Security Association Identifier (SA ID)

      This is a 32-bit unsigned integer used to uniquely identify an LDP
      SA between two LDP peers, as manually configured by the network
      operator (or, possibly by some key management protocol specified
      by the IETF in the future).

      The receiver determines the active SA by looking at the SA ID
      field in the incoming Hello message.

      The sender, based on the active configuration, selects an SA to
      use and puts the correct SA ID value associated with the SA in the
      LDP Hello message.  If multiple valid and active LDP SAs exist for
      a given interface, the sender may use any of those SAs to protect
      the packet.

      Using SA IDs makes changing keys while maintaining protocol
      operation convenient.  Each SA ID specifies two independent parts,
      the authentication algorithm and the authentication key, as
      explained below.




<span class="grey">Zheng, et al.                Standards Track                    [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


      Normally, an implementation would allow the network operator to
      configure a set of keys in a key chain, with each key in the chain
      having a fixed lifetime.  The actual operation of these mechanisms
      is outside the scope of this document.

      Note that each SA ID can indicate a key with a different
      authentication algorithm.  This allows the introduction of new
      authentication mechanisms without disrupting existing LDP
      sessions.

   o  Authentication Algorithm

      This signifies the authentication algorithm to be used with the
      LDP SA.  This information is never sent in clear text over the
      wire.  Because this information is not sent on the wire, the
      implementer chooses an implementation-specific representation for
      this information.

      Currently, the following algorithms are supported:

      HMAC-SHA-1, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512.

   o  Authentication Key

      This value denotes the cryptographic authentication key associated
      with the LDP SA.  The length of this key is variable and depends
      upon the authentication algorithm specified by the LDP SA.

   o  KeyStartAccept

      The time that this LDP router will accept packets that have been
      created with this LDP Security Association.

   o  KeyStartGenerate

      The time that this LDP router will begin using this LDP Security
      Association for LDP Hello message generation.

   o  KeyStopGenerate

      The time that this LDP router will stop using this LDP Security
      Association for LDP Hello message generation.

   o  KeyStopAccept

      The time that this LDP router will stop accepting packets
      generated with this LDP Security Association.




<span class="grey">Zheng, et al.                Standards Track                    [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   In order to achieve smooth key transition, KeyStartAccept SHOULD be
   less than KeyStartGenerate, and KeyStopGenerate SHOULD be less than
   KeyStopAccept.  If KeyStartGenerate or KeyStartAccept are left
   unspecified, the time will default to 0, and the key will be used
   immediately.  If KeyStopGenerate or KeyStopAccept are left
   unspecified, the time will default to infinity, and the key's
   lifetime will be infinite.  When a new key replaces an old, the
   KeyStartGenerate time for the new key MUST be less than or equal to
   the KeyStopGenerate time of the old key.  Any unspecified values are
   encoded as zero.

   Key storage SHOULD persist across a system restart, warm or cold, to
   avoid operational issues.  In the event that the last key associated
   with an interface expires, it is unacceptable to revert to an
   unauthenticated condition and not advisable to disrupt routing.
   Therefore, the router SHOULD send a "last Authentication Key
   expiration" notification to the network manager and treat the key as
   having an infinite lifetime until the lifetime is extended, the key
   is deleted by network management, or a new key is configured.

<span class="h3"><a class="selflink" name="section-2.3" href="#section-2.3">2.3</a>.  Cryptographic Authentication TLV Encoding</span>

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0|0|        Auth (0x0405)      |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                  Security Association ID                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Cryptographic Sequence Number (High-Order 32 Bits)      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Cryptographic Sequence Number (Low-Order 32 Bits)       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                Authentication Data (Variable)                 |
    ~                                                               ~
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   o  Type: 0x0405, Cryptographic Authentication

   o  Length: The length in octets of the value field, including the
      Security Association ID and Cryptographic Sequence Number fields.

   o  Security Association ID: The 32-bit field that maps to the
      authentication algorithm and the secret key used to create the
      message digest carried in LDP payload.



<span class="grey">Zheng, et al.                Standards Track                    [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


      Though the SA ID implies the algorithm, the HMAC output size
      should not be used by implementers as an implicit hint because
      additional algorithms may be defined in the future that have the
      same output size.

   o  Cryptographic Sequence Number: The 64-bit, strictly increasing
      sequence number that is used to guard against replay attacks.  The
      64-bit sequence number MUST be incremented for every LDP Hello
      message sent by the LDP router.  Upon reception, the sequence
      number MUST be greater than the sequence number in the last LDP
      Hello message accepted from the sending LDP neighbor.  Otherwise,
      the LDP message is considered a replayed packet and is dropped.
      The Cryptographic Sequence Number is a single space per LDP
      router.

      LDP routers implementing this specification MUST use existing
      mechanisms to preserve the sequence number's strictly increasing
      property for the deployed life of the LDP router (including cold
      restarts).  One mechanism for accomplishing this could be to use
      the high-order 32 bits of the sequence number as a boot count that
      is incremented anytime the LDP router loses its sequence number
      state.  Techniques such as sequence number space partitioning
      described above or non-volatile storage preservation can be used
      but are beyond the scope of this specification.  Sequence number
      wrap is described in <a href="#section-2.4">Section 2.4</a>.

   o  Authentication Data: This field carries the digest computed by the
      Cryptographic Authentication algorithm in use.  The length of the
      Authentication Data varies based on the cryptographic algorithm in
      use, which is shown below:

      Auth type        Length
      ---------------  ----------
      HMAC-SHA1        20 bytes
      HMAC-SHA-256     32 bytes
      HMAC-SHA-384     48 bytes
      HMAC-SHA-512     64 bytes

<span class="h3"><a class="selflink" name="section-2.4" href="#section-2.4">2.4</a>.  Sequence Number Wrap</span>

   When incrementing the sequence number for each transmitted LDP
   message, the sequence number should be treated as an unsigned 64-bit
   value.  If the lower-order 32-bit value wraps, the higher-order
   32-bit value should be incremented and saved in non-volatile storage.
   If the LDP router is deployed long enough that the 64-bit sequence
   number wraps, all keys, independent of the key distribution





<span class="grey">Zheng, et al.                Standards Track                    [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   mechanism, MUST be reset.  This is done to avoid the possibility of
   replay attacks.  Once the keys have been changed, the higher-order
   sequence number can be reset to 0 and saved to non-volatile storage.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Cryptographic Authentication Procedure</span>

   As noted earlier, the Security Association ID maps to the
   authentication algorithm and the secret key used to generate and
   verify the message digest.  This specification discusses the
   computation of LDP Cryptographic Authentication data when any of the
   NIST SHS family of algorithms is used in the Hashed Message
   Authentication Code (HMAC) mode.

   The currently valid algorithms (including mode) for LDP Cryptographic
   Authentication include:

   HMAC-SHA-1, HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512

   Of the above, implementations of this specification MUST include
   support for at least HMAC-SHA-256, SHOULD include support for HMAC-
   SHA-1, and MAY also include support for HMAC-SHA-384 and HMAC-SHA-
   512.

   Implementations of this standard MUST use HMAC-SHA-256 as the default
   authentication algorithm.

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Cross-Protocol Attack Mitigation</span>

   In order to prevent cross-protocol replay attacks for protocols
   sharing common keys, the 2-octet LDP Cryptographic Protocol ID is
   appended to the authentication key prior to use (refer to <a href="#section-8">Section 8</a>).
   Other protocols using the common key similarly append their own
   Cryptographic Protocol IDs to their keys prior to use, thus ensuring
   that a different key value is used for each protocol.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  Cryptographic Aspects</span>

   In the algorithm description below, the following nomenclature is
   used:

   o  H is the specific hashing algorithm (e.g., SHA-256).

   o  K is the Authentication Key from the LDP Security Association.

   o  Ks is a Protocol-Specific Authentication Key obtained by appending
      Authentication Key (K) with the 2-octet LDP Cryptographic Protocol
      ID.




<span class="grey">Zheng, et al.                Standards Track                    [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   o  Ko is the cryptographic key used with the hash algorithm.

   o  L is the length of the hash, measured in octets rather than bits.

   o  AuthTag is a value that is the same length as the hash output.  In
      the case of IPv4, the first 4 octets contain the IPv4 source
      address followed by the hexadecimal value 0x878FE1F3 repeated
      (L-4)/4 times.  In the case of IPv6, the first 16 octets contain
      the IPv6 source address followed by the hexadecimal value
      0x878FE1F3 repeated (L-16)/4 times.  This implies that hash output
      is always a length of at least 16 octets.

<span class="h3"><a class="selflink" name="section-5.1" href="#section-5.1">5.1</a>.  Preparing the Cryptographic Key</span>

   The LDP Cryptographic Protocol ID is appended to the Authentication
   Key (K) yielding a Protocol-Specific Authentication Key (Ks).  In
   this application, Ko is always L octets long.  Keys that are longer
   than the bit length of the hash function are hashed to force them to
   this length, as we describe below.  Ks is computed as follows.

   If the Protocol-Specific Authentication Key (Ks) is L octets long,
   then Ko is equal to Ks.  If the Protocol-Specific Authentication Key
   (Ks) is more than L octets long, then Ko is set to H(Ks).  If the
   Protocol-Specific Authentication Key (Ks) is less than L octets long,
   then Ko is set to the Protocol-Specific Authentication Key (Ks) with
   zeros appended to the end of the Protocol-Specific Authentication Key
   (Ks) such that Ko is L octets long.

   For higher entropy, it is RECOMMENDED that Key Ks should be at least
   L octets long.

<span class="h3"><a class="selflink" name="section-5.2" href="#section-5.2">5.2</a>.  Computing the Hash</span>

   First, the Authentication Data field in the Cryptographic
   Authentication TLV is filled with the value AuthTag.  Then, to
   compute HMAC over the Hello message it performs:

   AuthData = HMAC(Ko, Hello Message)

   Hello Message refers to the LDP Hello message excluding the IP and
   the UDP headers.










<span class="grey">Zheng, et al.                Standards Track                    [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


<span class="h3"><a class="selflink" name="section-5.3" href="#section-5.3">5.3</a>.  Result</span>

   The resultant Hash becomes the Authentication Data that is sent in
   the Authentication Data field of the Cryptographic Authentication
   TLV.  The length of the Authentication Data field is always identical
   to the message digest size of the specific hash function H that is
   being used.

   This also means that the use of hash functions with larger output
   sizes will also increase the size of the LDP message as transmitted
   on the wire.

<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Processing Hello Message Using Cryptographic Authentication</span>

<span class="h3"><a class="selflink" name="section-6.1" href="#section-6.1">6.1</a>.  Transmission Using Cryptographic Authentication</span>

   Prior to transmitting the LDP Hello message, the Length in the
   Cryptographic Authentication TLV header is set as per the
   authentication algorithm that is being used.  It is set to 24 for
   HMAC-SHA-1, 36 for HMAC-SHA-256, 52 for HMAC-SHA-384, and 68 for
   HMAC-SHA-512.

   The Security Association ID field is set to the ID of the current
   authentication key.  The HMAC Hash is computed as explained in
   <a href="#section-5">Section 5</a>.  The resulting Hash is stored in the Authentication Data
   field prior to transmission.  The authentication key MUST NOT be
   carried in the packet.

<span class="h3"><a class="selflink" name="section-6.2" href="#section-6.2">6.2</a>.  Receipt Using Cryptographic Authentication</span>

   The receiving LSR applies acceptability criteria for received Hellos
   using cryptographic authentication.  If the Cryptographic
   Authentication TLV is unknown to the receiving LSR, the received
   packet MUST be discarded according to <a href="rfc5036.html#section-3.5.1.2.2">Section&nbsp;3.5.1.2.2 of [RFC5036]</a>.

   The receiving router MUST determine whether or not to accept a Hello
   message from a particular source IP address as follows.  First, if
   the router has, for that source IP address, a stored LDP Hello
   cryptographic sequence number or is configured to require LDP Hello
   authentication, then the router MUST discard any unauthenticated
   Hello packets.  As specified later in this section, a cryptographic
   sequence number is only stored for a source IP address as a result of
   receiving a valid authenticated Hello.








<span class="grey">Zheng, et al.                Standards Track                   [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   The receiving LSR locates the LDP SA using the Security Association
   ID field carried in the message.  If the SA is not found or if the SA
   is not valid for reception (i.e., current time &lt; KeyStartAccept or
   current time &gt;= KeyStopAccept), the LDP Hello message MUST be
   discarded, and an error event SHOULD be logged.

   If the cryptographic sequence number in the LDP Hello message is less
   than or equal to the last sequence number received from the same
   neighbor, the LDP Hello message MUST be discarded, and an error event
   SHOULD be logged.

   Before the receiving LSR performs any processing, it needs to save
   the values of the Authentication Data field.  The receiving LSR then
   replaces the contents of the Authentication Data field with AuthTag
   and computes the Hash using the authentication key specified by the
   received Security Association ID field, as explained in <a href="#section-3">Section 3</a>.
   If the locally computed Hash is equal to the received value of the
   Authentication Data field, the received packet is accepted for other
   normal checks and processing as described in [<a href="rfc5036.html" title="&quot;LDP Specification&quot;">RFC5036</a>].  Otherwise,
   if the locally computed Hash is not equal to the received value of
   the Authentication Data field, the received LDP Hello message MUST be
   discarded, and an error event SHOULD be logged.  The aforesaid
   logging needs to be carefully rate limited, because while a LDP
   router is under attack by a storm of spoofed Hellos, the resources
   required for logging could be overwhelming.

   After the LDP Hello message has been successfully authenticated,
   implementations MUST store the 64-bit cryptographic sequence number
   for the LDP Hello message received from the source IP address.  The
   saved cryptographic sequence numbers will be used for replay checking
   for subsequent packets received from the source IP address.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Operational Considerations</span>

   Careful consideration must be given to when and how to enable and
   disable authentication on LDP Hellos.  On the one hand, it is
   critical that an attack cannot cause the authentication to be
   disabled.  On the other hand, it is equally important that an
   operator can change the hardware and/or software associated with a
   neighbor's IP address and successfully bring up an LDP adjacency with
   the desired level of authentication, which may be with different or
   no authentication due to software restrictions.

   LDP Hello authentication information (e.g., whether authentication is
   enabled and what the last cryptographic sequence number is)
   associated with an IP address is learned via a set of interfaces.  If
   an interface is administratively disabled, the LDP Hello
   authentication information learned via that interface MAY be



<span class="grey">Zheng, et al.                Standards Track                   [Page 11]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


   forgotten.  This enables an operator that is not specifically
   manipulating LDP Hello authentication configurations to easily bring
   up an LDP adjacency.  An implementation of this standard SHOULD
   provide a configuration mechanism by which the LDP Hello
   authentication information associated with an IP address can be shown
   and can be forgotten; configuration mechanisms are assumed to be
   accessed via an authenticated channel.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  Security Considerations</span>

   <a href="#section-1">Section 1</a> of this document describes the security issues arising from
   the use of unauthenticated LDP Hello messages.  In order to address
   those issues, it is RECOMMENDED that all deployments use the
   Cryptographic Authentication TLV to authenticate the Hello messages.

   The quality of the security provided by the Cryptographic
   Authentication TLV depends completely on the strength of the
   cryptographic algorithm in use, the strength of the key being used,
   and the correct implementation of the security mechanism in
   communicating LDP implementations.  Also, the level of security
   provided by the Cryptographic Authentication TLV varies based on the
   authentication type used.

   It should be noted that the authentication method described in this
   document is not being used to authenticate the specific originator of
   a packet but is rather being used to confirm that the packet has
   indeed been issued by a router that has access to the authentication
   key.

   Deployments SHOULD use sufficiently long and random values for the
   authentication key so that guessing and other cryptographic attacks
   on the key are not feasible in their environments.  In support of
   these recommendations, management systems SHOULD support hexadecimal
   input of authentication keys.

   The mechanism described herein is not perfect.  However, this
   mechanism introduces a significant increase in the effort required
   for an adversary to successfully attack the LDP Hello protocol while
   not causing undue implementation, deployment, or operational
   complexity.











<span class="grey">Zheng, et al.                Standards Track                   [Page 12]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  IANA Considerations</span>

   The IANA has assigned a new TLV from the "Label Distribution Protocol
   (LDP) Parameters" registry, "TLV Type Name Space".

   Value   Description                       Reference
   ------  --------------------------------  ---------------------------
   0x0405  Cryptographic Authentication TLV  this document (<a href="#section-2.3">Section 2.3</a>)

   The IANA has also assigned a value from the "Authentication
   Cryptographic Protocol ID" registry under the "Keying and
   Authentication for Routing Protocols (KARP) Parameters" category.

   Value   Description                       Reference
   -----   --------------------------------  -------------------------
     2     LDP Cryptographic Protocol ID     this document (<a href="#section-4">Section 4</a>)

<span class="h2"><a class="selflink" name="section-10" href="#section-10">10</a>.  Acknowledgements</span>

   We are indebted to Yaron Sheffer who helped us enormously in
   rewriting the document to get rid of the redundant crypto mathematics
   that we had added here.

   We would also like to thank Liu Xuehu for his work on background and
   motivation for LDP Hello authentication.  Last but not least, we
   would also thank Adrian Farrel, Eric Rosen, Sam Hartman, Stephen
   Farrell, Eric Gray, Kamran Raza, and Acee Lindem for their valuable
   comments.

<span class="h2"><a class="selflink" name="section-11" href="#section-11">11</a>.  References</span>

<span class="h3"><a class="selflink" name="section-11.1" href="#section-11.1">11.1</a>.  Normative References</span>

   [<a name="ref-FIPS-180-4" id="ref-FIPS-180-4">FIPS-180-4</a>]
              National Institute of Standards and Technology (NIST),
              "Secure Hash Standard (SHS)", FIPS 180-4, March 2012.

   [<a name="ref-RFC2104" id="ref-RFC2104">RFC2104</a>]  Krawczyk, H., Bellare, M., and R. Canetti, "HMAC: Keyed-
              Hashing for Message Authentication", <a href="rfc2104.html">RFC 2104</a>, February
              1997.

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-RFC5036" id="ref-RFC5036">RFC5036</a>]  Andersson, L., Minei, I., and B. Thomas, "LDP
              Specification", <a href="rfc5036.html">RFC 5036</a>, October 2007.





<span class="grey">Zheng, et al.                Standards Track                   [Page 13]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc7349.html">RFC 7349</a>         LDP Hello Cryptographic Authentication      August 2014</span>


<span class="h3"><a class="selflink" name="section-11.2" href="#section-11.2">11.2</a>.  Informative References</span>

   [<a name="ref-RFC5082" id="ref-RFC5082">RFC5082</a>]  Gill, V., Heasley, J., Meyer, D., Savola, P., and C.
              Pignataro, "The Generalized TTL Security Mechanism
              (GTSM)", <a href="rfc5082.html">RFC 5082</a>, October 2007.

   [<a name="ref-RFC5926" id="ref-RFC5926">RFC5926</a>]  Lebovitz, G. and E. Rescorla, "Cryptographic Algorithms
              for the TCP Authentication Option (TCP-AO)", <a href="rfc5926.html">RFC 5926</a>,
              June 2010.

   [<a name="ref-RFC6720" id="ref-RFC6720">RFC6720</a>]  Pignataro, C. and R. Asati, "The Generalized TTL Security
              Mechanism (GTSM) for the Label Distribution Protocol
              (LDP)", <a href="rfc6720.html">RFC 6720</a>, August 2012.

   [<a name="ref-RFC6952" id="ref-RFC6952">RFC6952</a>]  Jethanandani, M., Patel, K., and L. Zheng, "Analysis of
              BGP, LDP, PCEP, and MSDP Issues According to the Keying
              and Authentication for Routing Protocols (KARP) Design
              Guide", <a href="rfc6952.html">RFC 6952</a>, May 2013.

Authors' Addresses

   Lianshu Zheng
   Huawei Technologies
   China

   EMail: vero.zheng@huawei.com


   Mach(Guoyi) Chen
   Huawei Technologies
   China

   EMail: mach.chen@huawei.com


   Manav Bhatia
   Ionos Networks
   India

   EMail: manav@ionosnetworks.com











Zheng, et al.                Standards Track                   [Page 14]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129c, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>

<!-- Mirrored from tools.ietf.org/html/rfc7349 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:31:03 GMT -->
</html>
