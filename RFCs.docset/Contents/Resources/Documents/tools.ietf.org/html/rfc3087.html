<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3087 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:49 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:3087" name="DC.Identifier"/>
<meta content="This memo describes a useful way to conceptualize the use of the
standard SIP (Session Initiation Protocol) Request-URI (Uniform
Resource Identifier) that the authors and many members of the SIP
community think is suitable as a convention. It does not define any
new protocol with respect to RFC 2543. This memo provides information
for the Internet community." name="DC.Description.Abstract"/>
<meta content="Campbell, Ben" name="DC.Creator"/>
<meta content="Sparks, Robert J." name="DC.Creator"/>
<meta content="April, 2001" name="DC.Date.Issued"/>
<meta content="Control of Service Context using SIP Request-URI" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3087 - Control of Service Context using SIP Request-URI</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3087.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3087" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-campbell-sip-service-control" title="draft-campbell-sip-service-control">draft-campbell-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3087" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3087" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3087" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                        B. Campbell
Request for Comments: 3087                                     R. Sparks
Category: Informational                                      dynamicsoft
                                                              April 2001


            <span class="h1">Control of Service Context using SIP Request-URI</span>

Status of this Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2001).  All Rights Reserved.

Abstract

   This memo provides information for the Internet community.  It
   describes a useful way to conceptualize the use of the standard SIP
   (Session Initiation Protocol) Request-URI (Uniform Resource
   Identifier) that the authors and many members of the SIP community
   think is suitable as a convention.  It does not define any new
   protocol with respect to <a href="rfc2543.html">RFC 2543</a>.

   In a conventional telephony environment, extended service
   applications often use call state information, such as calling party,
   called party, reason for forward, etc, to infer application context.
   In a SIP/2.0 call, much of this information may be either non-
   existent or unreliable.  This document proposes a mechanism to
   communicate context information to an application.  Under this
   proposal, a client or proxy can communicate context through the use
   of a distinctive Request-URI.  This document continues with examples
   of how this mechanism could be used in a voice mail application.















<span class="grey">Campbell &amp; Sparks            Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


Table of Contents

   <a href="#section-1">1</a>.      Introduction . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.      Example Application  . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2.1">2.1</a>     Using URIs to Control Voice Mail Service Behavior  . . . .  <a href="#page-3">3</a>
   <a href="#section-3">3</a>.      Voice Mail Scenario Descriptions . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-3.1">3.1</a>     Deposits . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-3.1.1">3.1.1</a>   Direct Request to Deposit to a particular mailbox  . . . .  <a href="#page-5">5</a>
   <a href="#section-3.1.1.1">3.1.1.1</a> SIP source . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-3.1.1.2">3.1.1.2</a> Arbitrary PSTN source  . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-3.1.1.3">3.1.1.3</a> Recognized PSTN source . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-3.1.2">3.1.2</a>   Direct Request to Deposit, mailbox to be determined  . . .  <a href="#page-6">6</a>
   <a href="#section-3.1.2.1">3.1.2.1</a> SIP source . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-3.1.2.2">3.1.2.2</a> PSTN source  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   3.1.2.3 Indirect Request to Deposit, due to find-me proxy decision  6
   <a href="#section-3.2">3.2</a>     Retrievals . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.1">3.2.1</a>   Request to Retrieve from a particular mailbox  . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.1.1">3.2.1.1</a> Trusted SIP source . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.1.2">3.2.1.2</a> Authenticated SIP source . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.1.3">3.2.1.3</a> Unauthenticated SIP source . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.1.4">3.2.1.4</a> PSTN source  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.2">3.2.2</a>   Request to Retrieve, mailbox to be determined  . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.2.1">3.2.2.1</a> SIP source . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-3.2.2.2">3.2.2.2</a> Arbitrary PSTN source  . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-3.2.2.3">3.2.2.3</a> Recognized PSTN source . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-4">4</a>.      Voice Mail Call Flow Examples  . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-4.1">4.1</a>     Generic Scenario . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-4.1.1">4.1.1</a>   Direct call to the voice mail system . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-4.2">4.2</a>     Message Deposit Scenarios  . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#section-4.2.1">4.2.1</a>   Call to known subscriber forwarded on no answer  . . . . . <a href="#page-13">13</a>
   <a href="#section-4.2.2">4.2.2</a>   Call to known subscriber forwarded on busy . . . . . . . . <a href="#page-19">19</a>
   <a href="#section-4.2.3">4.2.3</a>   Direct call to a subscriber's mailbox  . . . . . . . . . . <a href="#page-24">24</a>
   <a href="#section-4.3">4.3</a>     Message Retrieval Scenarios  . . . . . . . . . . . . . . . <a href="#page-29">29</a>
   4.3.1   Call to retrieve messages believed to be from a known
           subscriber . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
   4.3.2   Call to retrieve messages from an authenticated subscriber 33
   <a href="#section-5">5</a>.      Security Considerations  . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
   <a href="#section-6">6</a>.      Acknowledgments  . . . . . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
           References . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
           Authors' Addresses . . . . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
           Full Copyright Statement . . . . . . . . . . . . . . . . . <a href="#page-39">39</a>










<span class="grey">Campbell &amp; Sparks            Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>. Introduction</span>

   A communication service should make use of the information it has at
   hand when being accessed.  For example, in most current voice mail
   implementations, a subscriber retrieving messages from his own desk
   does not have to reenter his voice mailbox number - the service
   assumes that the store being accessed is the one associated with the
   endpoint being used to access the service.  Some services allow the
   user to validate this assumption using IVR techniques before
   prompting for a PIN.

   This concept of context-awareness can be captured in a voice mail
   service implementing SIP as defined in <a href="rfc2543.html">RFC 2543</a>[<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>], without
   modification, through the standard use of that protocol's Request-
   URI.  Furthermore, the concept is applicable to any SIP-based service
   where initial application state should be determined from context.

   This concept is a usage convention of standard SIP as defined in <a href="rfc2543.html">RFC</a>
   <a href="rfc2543.html">2543</a>[<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>] and does not modify or extend that protocol in any way.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20Example%20Application"></a><a class="selflink" href="#section-2" name="section-2">2</a>. Example Application</span>

   In this document, we use the example of voice mail to illustrate the
   technique.  One motivation for applying this technique to this
   problem is allowing a proxy or location server to control the initial
   state of a voice service.  For example, a voice client might register
   a contact list ending with the URL that would accept voice messages
   for the client.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1%20Using%20URIs%20to%20Control%20Voice%20Mail%20Service%20Behavior"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a> Using URIs to Control Voice Mail Service Behavior</span>

   Many conventional voice mail systems use call state information, such
   as the calling party, called party, reason for forward, etc, to
   decide the initial application state.  For example, it might play one
   outgoing message if the call reached voice mail because the called
   party did not answer and another if the line was busy.  It decides
   whom the message is for based on the called party information.  If
   the call originated from a subscriber's phone number, it might
   authenticate the caller and then go directly to the message retrieval
   and account maintenance menu.

   When a new subscriber is added to a system, a set of identities could
   be generated, each given a unique sip URI.  The following tables show
   some of the identities that might be generated (it is not
   exhaustive).  The example schemes show that the URIs could, but don't
   necessarily have to, have mnemonic value.





<span class="grey">Campbell &amp; Sparks            Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


   In practical applications, it is important that an application does
   not apply semantic rules to the various URIs.  Instead, it should
   allow any arbitrary string to be provisioned, and map the string to
   the desired behavior.  The owner of the system may choose to
   provision mnemonic strings, but the application should not require
   it.  In any large installation, the system owner is likely to have
   pre-existing rules for mnemonic URIs, and any attempt by an
   application to define its own rules may create a conflict.  For our
   example, this means a voice mail system should allow an arbitrary mix
   of URLs from these schemes, or any other scheme that renders valid
   SIP URIs to be provisioned, rather than enforce one particular
   scheme.

      URI Identity       Example Scheme 1
                              Example Scheme 2
                                   Example Scheme 3

      Deposit with       sip:sub-rjs-deposit@vm.wcom.com
      standard greeting       sip:677283@vm.wcom.com
                                   sip:rjs@vm.wcom.com;mode=deposit


      Deposit with on    sip:sub-rjs-deposit-busy.vm.wcom.com
      phone greeting          sip:677372@vm.wcom.com
                                   sip:rjs@vm.wcom.com;mode=3991243

      Deposit with       sip:sub-rjs-deposit-sg@vm.wcom.com
      special greeting        sip:677384@vm.wcom.com
                                   sip:rjs@vm.wcom.com;mode=sg

      Retrieve - SIP     sip:sub-rjs-retrieve@vm.wcom.com
      authentication          sip:677405@vm.wcom.com
                                   sip:rjs@vm.wcom.com;mode=retrieve

      Retrieve - prompt  sip:sub-rjs-retrieve-inpin.vm.wcom.com
      for PIN in-band         sip:677415@vm.wcom.com
                                   sip:rjs@vm.wcom.com;mode=inpin

   When a service is first set up, identities such as the following
   could be created.

      URI Identity       Example Scheme 1
                              Example Scheme 2
                                   Example Scheme 3

      Deposit -          sip:deposit@vm.wcom.com
      identify target         sip:670001@vm.wcom.com
      mailbox by To:               sip:deposit@vm.wcom.com



<span class="grey">Campbell &amp; Sparks            Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


      Retrieve -         sip:retrieve@vm.wcom.com
      identify target         sip:670002@vm.wcom.com
      mailbox by SIP               sip:retrieve@vm.wcom.com
      authentication

      Deposit - prompt   sip:deposit-in@vm.wcom.com
      for target              sip:670003@vm.wcom.com
      mailbox in-band              sip:deposit@vm.wcom.com;mode=inband

      Retrieve - prompt  sip:retrieve-in@vm.wcom.com
      for target              sip:670004@vm.wcom.com
      mailbox and PIN              sip:retrieve@vm.wcom.com;mode=inband
      in-band

   In addition to providing this set of URIs to the subscriber (to use
   as he sees fit), an integrated service provider could add these to
   the set of contacts in a find-me proxy.  The proxy could then route
   calls to the appropriate URI based on the origin of the request, the
   subscriber's preferences and current state.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20Voice%20Mail%20Scenario%20Descriptions"></a><a class="selflink" href="#section-3" name="section-3">3</a>. Voice Mail Scenario Descriptions</span>

   In each of these scenarios, the PSTN gateway is configured to
   communicate only with a particular proxy-registrar.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1%20Deposits"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a> Deposits</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1%20Direct%20Request%20to%20Deposit%20to%20a%20particular%20mailbox"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a> Direct Request to Deposit to a particular mailbox</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.1%20SIP%20source"></a><a class="selflink" href="#section-3.1.1.1" name="section-3.1.1.1">3.1.1.1</a> SIP source</span>

   A SIP client that knew the URI for a particular deposit mailbox
   (sip:sub-rjs-deposit@vm.wcom.com) could place a direct invitation to
   the voicemail service, or through a protecting proxy.  The proxy
   could restrict access to deposit identities with special greetings by
   authenticating the requester.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.2%20Arbitrary%20PSTN%20source"></a><a class="selflink" href="#section-3.1.1.2" name="section-3.1.1.2">3.1.1.2</a> Arbitrary PSTN source</span>

   The gateway's proxy would map a call from an unrecognized PSTN number
   to a number associated with a subscriber's mailbox into an invite to
   the deposit with standard greeting URI (sip:sub-rjs-
   deposit@vm.wcom.com).








<span class="grey">Campbell &amp; Sparks            Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.3%20Recognized%20PSTN%20source"></a><a class="selflink" href="#section-3.1.1.3" name="section-3.1.1.3">3.1.1.3</a> Recognized PSTN source</span>

   The gateway's proxy would map a call from a recognized (exact or
   pattern match) PSTN number to a number associated with a subscriber's
   mailbox into an invite to the appropriate special greeting URI
   (sip:sub-rjs-deposit-sg@vm.wcom.com).  The gateway's ability to
   identify the calling party (using calling party number) is trusted,
   so no further authentication of the requester is performed.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2%20Direct%20Request%20to%20Deposit%2C%20mailbox%20to%20be%20determined"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a> Direct Request to Deposit, mailbox to be determined</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.1%20SIP%20source"></a><a class="selflink" href="#section-3.1.2.1" name="section-3.1.2.1">3.1.2.1</a> SIP source</span>

   A voice mail service or its protecting proxy could expose a generic
   deposit URL for use when a caller wished to go directly to voice
   mail.  The service would likely play an IVR dialog to determine what
   message store to deposit a message into.

   An application designer may be tempted to attempt to match the To:
   and From: headers on a call to infer information.  However, this
   approach could cause complications when multiple proxy forwards occur
   in a call.  For example, A calls B, who has all calls forwarded to C.
   C forwards the call to her voice mail service.  If the voice mail
   service matches the To: header to determine the message store, it
   will get the information for B instead of C.  But there is no reason
   to assume that C's voice mail service has any knowledge of B.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.2%20PSTN%20source"></a><a class="selflink" href="#section-3.1.2.2" name="section-3.1.2.2">3.1.2.2</a> PSTN source</span>

   The gateway's proxy would map a call from an unrecognized PSTN number
   to the top level voice mail service access number to an invite to the
   Deposit - prompt for target mailbox in-band URI (sip:deposit-
   in@vm.wcom.com for example).  Getting the call to the target mailbox
   would proceed as in the SIP source case.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.3%20Indirect%20Request%20to%20Deposit%2C%20due%20to%20find-me%20proxy%20decision"></a><a class="selflink" href="#section-3.1.2.3" name="section-3.1.2.3">3.1.2.3</a> Indirect Request to Deposit, due to find-me proxy decision</span>

   A find-me proxy could map an invitation to a subscriber
   (sip:rjs@wcom.com) to the appropriate voice mail service URI
   depending on the subscriber's current state.  The normal deposit URI
   could be chosen if the subscriber's contact list has been otherwise
   exhausted with no answer.  The busy-announcement URI would be chosen
   when a busy everywhere response is received from one of the contacts.
   A DND announcement URI could be selected if the subscriber had
   activated DND. Calls to sip:receptionist@wcom.com could be configured
   to roll to sip:deposit@wcom.com





<span class="grey">Campbell &amp; Sparks            Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2%20Retrievals"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a> Retrievals</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1%20Request%20to%20Retrieve%20from%20a%20particular%20mailbox"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a> Request to Retrieve from a particular mailbox</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.1%20Trusted%20SIP%20source"></a><a class="selflink" href="#section-3.2.1.1" name="section-3.2.1.1">3.2.1.1</a> Trusted SIP source</span>

   A request to retrieve the contents of a particular mailbox (sip:sub-
   rjs-retrieve@vm.wcom.com) coming from a trusted source could be
   honored without further authentication checks.  A trusted source is
   one with which the voice mail service has secure communications, and
   to which it is willing to delegate authentication.  This could be the
   service's protecting proxy for example.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.2%20Authenticated%20SIP%20source"></a><a class="selflink" href="#section-3.2.1.2" name="section-3.2.1.2">3.2.1.2</a> Authenticated SIP source</span>

   A service, or its protecting proxy, could choose to honor a retrieve
   request for a particular mailbox (sip:sub-rjs-retrieve@vm.wcom.com)
   based on SIP authentication.  If SIP level authentication failed, the
   service or proxy could be configured to send the call to the in-band
   pin prompting URI (sip:sub-rjs-retrieve-inpin@vm.wcom.com).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.3%20Unauthenticated%20SIP%20source"></a><a class="selflink" href="#section-3.2.1.3" name="section-3.2.1.3">3.2.1.3</a> Unauthenticated SIP source</span>

   A service, or its protecting proxy, receiving a retrieve request for
   a particular mailbox (sip:sub-rjs-retrieve@vm.wcom.com) with no other
   method of authenticating the requestor could send the request to the
   in-band pin prompting URI (sip:sub-rjs-retrieve-inpin@vm.wcom.com).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.4%20PSTN%20source"></a><a class="selflink" href="#section-3.2.1.4" name="section-3.2.1.4">3.2.1.4</a> PSTN source</span>

   This scenario assumes that the service provider's network has been
   configured such that a PSTN number could be dialed explicitly for
   retrieving messages from a particular mailbox.  Such services
   currently exist, but are not common.  In such a network, the
   gateway's proxy would map the call to the in-band pin prompting URI
   (sip:sub-rjs-retrieve-inpin@vm.wcom.com).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2%20Request%20to%20Retrieve%2C%20mailbox%20to%20be%20determined"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a> Request to Retrieve, mailbox to be determined</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.1%20SIP%20source"></a><a class="selflink" href="#section-3.2.2.1" name="section-3.2.2.1">3.2.2.1</a> SIP source</span>

   As in the Request to Deposit scenario, when a service receives a
   request for the top level retrieve URI it would most likely need to
   use in-band IVR techniques to determine the target mailbox and
   authenticate the caller.






<span class="grey">Campbell &amp; Sparks            Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.2%20Arbitrary%20PSTN%20source"></a><a class="selflink" href="#section-3.2.2.2" name="section-3.2.2.2">3.2.2.2</a> Arbitrary PSTN source</span>

   This scenario assumes there is a single PSTN number that subscribers
   dial to access the voice mail service to retrieve messages.  This is
   the most common access method provided by current voice mail
   services.

   The gateway's proxy would map a call to the top level PSTN number to
   the top level retrieve in-band prompting URI (sip:retrieve-
   in@vm.wcom.com).  Once the system identifies the target mailbox, the
   call would be transferred to the appropriate in-band pin prompting
   URI (sip:sub-rjs-retrieve-inpin@vm.wcom.com).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.3%20Recognized%20PSTN%20source"></a><a class="selflink" href="#section-3.2.2.3" name="section-3.2.2.3">3.2.2.3</a> Recognized PSTN source</span>

   This scenario also assumes there is a single PSTN number that
   subscribers dial to access the voice mail service to retrieve
   messages.

   The gateway's proxy would recognize the calling party number as a
   subscriber, and map the call to the subscriber's in-band prompting
   URI (sip:sub-rjs-retrieve-inpin@vm.wcom.com)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20Voice%20Mail%20Call%20Flow%20Examples"></a><a class="selflink" href="#section-4" name="section-4">4</a>. Voice Mail Call Flow Examples</span>

   The following section describes some example call flows for a
   hypothetical voice mail service, with the host name of vm.wcom.com.
   All the call flows assume that a proxy protects the voice mail
   service and that a trust relationship exists between the voice mail
   service and the proxy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1%20Generic%20Scenario"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a> Generic Scenario</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.1%20Direct%20call%20to%20the%20voice%20mail%20system"></a><a class="selflink" href="#section-4.1.1" name="section-4.1.1">4.1.1</a> Direct call to the voice mail system</span>

   User A calls the voice mail system directly.  The voice mail system
   invokes the top-level menu, which might prompt the caller for an
   extension or the first few letters of a name.













<span class="grey">Campbell &amp; Sparks            Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


            User A              Proxy               VM Service
              |                   |                       |
              |  INVITE F1        |                       |
              |------------------&gt;|                       |
              |                   |  INVITE F2            |
              | (100 Trying) F3   |----------------------&gt;|
              |&lt;------------------|                       |
              |                   |  180 Ringing F4       |
              |  180 Ringing F5   |&lt;----------------------|
              |&lt;------------------|                       |
              |                   |  200 OK F6            |
              |  200 OK F6        |&lt;----------------------|
              |&lt;------------------|                       |
              |                   |                       |
              |  ACK F8           |                       |
              |------------------&gt;|  ACK F9               |
              |                   |----------------------&gt;|
              |                   |                       |
              |      RTP Established- Play top level menu |
              |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
              |                   |                       |
              |  BYE F10          |                       |
              |------------------&gt;|  BYE F11              |
              |                   |----------------------&gt;|
              |                   |                       |
              |                   |  200 OK F12           |
              |                   |&lt;----------------------|
              |  200 OK F13       |                       |
              |&lt;------------------|                       |
              |                   |                       |


     Flow Id                            Comments

    INVITE F1     INVITE sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserA",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cc4e341ae6cbe5a359", opaque="",
                  uri="sip:VoiceMail@wcom.com", response=&lt;appropriately
                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;



<span class="grey">Campbell &amp; Sparks            Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:top@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    180 Ringing   SIP/2.0 180 Ringing
    F4            Via: SIP/2.0/UDP wcom.com:5060; branch=1
    VM-&gt;Proxy     Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0




<span class="grey">Campbell &amp; Sparks            Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    180 Ringing   SIP/2.0 180 Ringing
    F5            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A      From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    200 OK F6     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: VoiceMailSystem &lt;sip:top@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000


    200 OK F7     SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact VoiceMailSystem &lt;sip:top@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000




<span class="grey">Campbell &amp; Sparks            Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    ACK F8        ACK sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:top@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F9        ACK sip:top@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;; tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

                  /* RTP streams are established between A and VM.  VM
                  system starts IVR dialog for top level menu */

                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F10       BYE sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip: top@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F11       BYE sip: top@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F12    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F13    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2%20Message%20Deposit%20Scenarios"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a> Message Deposit Scenarios</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1%20Call%20to%20known%20subscriber%20forwarded%20on%20no%20answer"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a> Call to known subscriber forwarded on no answer</span>

   User A attempts to call UserB, who does not answer.  The call is
   forwarded to UserB's mailbox, and the voice mail system plays UserB's
   outgoing message for a ring-no-answer.  The flow assumes that the URL
   of "sip:UserB-dep-fna@vm.wcom.com maps" to the desired behavior for
   depositing a message on a forward-no-answer.































<span class="grey">Campbell &amp; Sparks            Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


      User A            Proxy              User B         VM System
        |                 |                  |                |
        |  INVITE F1      |                  |                |
        |----------------&gt;|  INVITE F2       |                |
        |                 |-----------------&gt;|                |
        | (100 Trying) F3 |                  |                |
        |&lt;----------------| 180 Ringing F4   |                |
        |                 |&lt;-----------------|                |
        |  180 Ringing F5 |                  |                |
        |&lt;----------------| (Request Timeout)|                |
        |                 |                  |                |
        |                 | Cancel F6        |                |
        |                 |-----------------&gt;|                |
        |                 |                  |                |
        |                 | 200 OK F7        |                |
        |                 |&lt;-----------------|                |
        |                 |                  |                |
        |                 |         INVITE F8                 |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |                 |         200 OK F9|                |
        |  200 OK F10     |&lt;----------------------------------|
        |&lt;----------------|                  |                |
        |                 |                  |                |
        |  ACK F11        |                  |                |
        |----------------&gt;|         ACK F12  |                |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |    RTP Established Both Ways-Deposit Msg for B      |
        |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
        |                 |                  |                |
        |  BYE F13        |                  |                |
        |----------------&gt;|         BYE F14  |                |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |                 |         OK F15   |                |
        |  OK F16         |&lt;----------------------------------|
        |&lt;----------------|                  |                |
        |                 |                  |                |


     Flow Id                            Comments

    INVITE F1     INVITE sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserA",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
                  uri="sip:UserB@wcom.com", response=&lt;appropriately
                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:UserB1@somewhere.wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    180 Ringing   SIP/2.0 180 Ringing
    F4            Via: SIP/2.0/UDP wcom.com:5060; branch=1
    B1-&gt;Proxy     Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    180 Ringing   SIP/2.0 180 Ringing
    F5            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A      From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

                  /* B1 rings for 9 seconds, this duration is a
                  configurable parameter in the Proxy Server.  Proxy
                  sends Cancel and proceeds down the list of routes,
                  eventually hitting the voice mail URI for forward no
                  answer */

    CANCEL F6     CANCEL sip:UserB1@wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 CANCEL
                  Content-Length: 0

    200 OK F7     SIP/2.0 200 OK
    B1-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 CANCEL
                  Content-Length: 0


    INVITE F8     INVITE sip:UserB-dep-fna@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060;branch=2
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F9     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=2
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheLittleGuyVoiceMail &lt;sip:UserB-dep-
                  fna@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000


    200 OK F10    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheLittleGuyVoiceMail &lt;sip:UserB-dep-
                  fna@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    ACK F11       ACK sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip: UserB-dep-fna@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F12       ACK sip:UserB-dep-fna@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

                  /* RTP streams are established between A and B2.  VM
                  system starts IVR dialog for message-deposit on no-
                  answer for UserB */

                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F13       BYE sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip: UserB-dep-fna@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F14       BYE sip: UserB-dep-fna@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    200 OK F15    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F16    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2%20Call%20to%20known%20subscriber%20forwarded%20on%20busy"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a> Call to known subscriber forwarded on busy</span>

   User A attempts to call UserB, who is busy.  The call is forwarded to
   UserB's mailbox, and the voice mail system plays UserB's outgoing
   message for a busy.  This flow assumes that "sip:UserB-dep-
   fb@vm.wcom.com" maps to UserB's mailbox and the behavior of "deposit
   message on busy."



























<span class="grey">Campbell &amp; Sparks            Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


      User A            Proxy              User B         VM System
        |                 |                  |                |
        |  INVITE F1      |                  |                |
        |----------------&gt;|  INVITE F2       |                |
        |                 |-----------------&gt;|                |
        | (100 Trying) F3 |                  |                |
        |&lt;----------------| 486 Busy Here F4 |                |
        |                 |&lt;-----------------|                |
        |                 |                  |                |
        |                 |  ACK F5          |                |
        |                 |-----------------&gt;|                |
        |                 |                  |                |
        |                 |         INVITE F6                 |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |                 |         200 OK F7|                |
        |  200 OK F8      |&lt;----------------------------------|
        |&lt;----------------|                  |                |
        |                 |                  |                |
        |  ACK F9         |                  |                |
        |----------------&gt;|         ACK F10  |                |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |    RTP Established Both Ways-Deposit Msg for B      |
        |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
        |                 |                  |                |
        |  BYE F11        |                  |                |
        |----------------&gt;|         BYE F12  |                |
        |                 |----------------------------------&gt;|
        |                 |                  |                |
        |                 |         OK F13   |                |
        |  OK F14         |&lt;----------------------------------|
        |&lt;----------------|                  |                |
        |                 |                  |                |

     Flow Id                            Comments

    INVITE F1     INVITE sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserA",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
                  uri="sip:UserB@wcom.com", response=&lt;appropriately



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:UserB1@somewhere.wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    486 Busy      SIP/2.0 486 Busy Here
    Here F4       Via: SIP/2.0/UDP wcom.com:5060;branch=1
    B1-&gt;Proxy     Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    ACK F5        ACK sip: UserB1@wcom.com SIP/2.0
    Proxy-&gt;B      Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=123456
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    INVITE F6     INVITE sip:UserB-dep-fb@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060;branch=2
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F7     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=2
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheLittleGuyVoiceMail &lt;sip:UserB-dep-
                  fb@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F8     SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact TheLittleGuyVoiceMail &lt;sip:UserB-dep-
                  fb@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    ACK F9        ACK sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserB-dep-fb@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F10       ACK sip:UserB-dep-fb@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

                  /* RTP streams are established between A and B2.  VM
                  system starts IVR dialog for message-deposit on busy
                  for UserB */





<span class="grey">Campbell &amp; Sparks            Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F11       BYE sip:UserB@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route: &lt;sip:UserB-dep-fnb@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F12       BYE sip: UserB-dep-fnb@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F13    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F14    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuy &lt;sip:UserB@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.3%20Direct%20call%20to%20a%20subscriber%27s%20mailbox"></a><a class="selflink" href="#section-4.2.3" name="section-4.2.3">4.2.3</a> Direct call to a subscriber's mailbox</span>

   User A calls UserB's mailbox directly.  This flow assumes that
   "sip:UserB-dep@vm.wcom.com" maps to UserB's mailbox and the behavior
   of "generic message deposit"








<span class="grey">Campbell &amp; Sparks            Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


            User A              Proxy                VM Service
              |                   |                       |
              |  INVITE F1        |                       |
              |------------------&gt;|                       |
              |                   |  INVITE F2            |
              | (100 Trying) F3   |----------------------&gt;|
              |&lt;------------------|                       |
              |                   |  200 OK F4            |
              |  200 OK F5        |&lt;----------------------|
              |&lt;------------------|                       |
              |                   |                       |
              |  ACK F6           |                       |
              |------------------&gt;|  ACK F7               |
              |                   |----------------------&gt;|
              |                   |                       |
              |      RTP Both Ways - Deposit Msg for B    |
              |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
              |                   |                       |
              |  BYE F8           |                       |
              |------------------&gt;|  BYE F9               |
              |                   |----------------------&gt;|
              |                   |                       |
              |                   |  200 OK F10           |
              |                   |&lt;----------------------|
              |  200 OK F11       |                       |
              |&lt;------------------|                       |
              |                   |                       |

     Flow Id                            Comments

    INVITE F1     INVITE sip:UserB-VM@vm.wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-VM@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserA",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
                  uri="sip:UserB-VM@wcom.com", response=&lt;appropriately
                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:UserB-dep@vm.wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB-VM@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-VM@vm.wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-VM@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    200 OK F4     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB-VM@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheLittleGuyVoiceMail &lt;sip:UserB-
                  dep@vm.wcom.com&gt;
                  Content-Type: application/sdp



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  Content-Length: &lt;appropriate value&gt;
                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F5     SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:UserB-VM@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact TheLittleGuyVoiceMail &lt;sip:UserB-
                  dep@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    ACK F6        ACK sip:UserB-VM@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserB-dep@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F7        ACK sip:UserB-dep@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  Content-Length: 0
                  /* RTP streams are established between A and VM.  VM
                  system starts IVR dialog for generic message-deposit
                  for UserB */

                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F8        BYE sip:UserB-VM@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserB-dep@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F9        BYE sip: UserB-dep@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F10    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F11    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: TheLittleGuyVoiceMail &lt;sip:UserB-
                  VM@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0





<span class="grey">Campbell &amp; Sparks            Informational                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3%20Message%20Retrieval%20Scenarios"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a> Message Retrieval Scenarios</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1%20Call%20to%20retrieve%20messages%20believed%20to%20be%20from%20a%20known%20subscriber"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a> Call to retrieve messages believed to be from a known subscriber</span>

   Some user uses a SIP client on UserA's desk to call the voice mail
   system to retrieve messages.  The SIP client has authenticated itself
   to the proxy using credentials assigned to the device.  The proxy can
   make a weak assumption that the caller is the device owner.  The URI
   of "sip:UserA-retrieve@vm.wcom.com" maps to UserA's mailbox and the
   behavior of "retrieve messages after prompting for and verifying
   PIN." The VM System trusts the proxy, and will not accept calls from
   an untrusted source.  The proxy will not allow direct calls to
   UserA-retrieve@vm.wcom.com.  The proxy will forward calls placed to
   VoiceMail@wcom.com to UserA-retrieve@vm.wcom.com only for calls
   placed from a client device assigned to UserA.

            User A              Proxy                VM Service
              |                   |                       |
              |  INVITE F1        |                       |
              |------------------&gt;|                       |
              |                   |  INVITE F2            |
              | (100 Trying) F3   |----------------------&gt;|
              |&lt;------------------|                       |
              |                   |  200 OK F4            |
              |  200 OK F5        |&lt;----------------------|
              |&lt;------------------|                       |
              |                   |                       |
              |  ACK F6           |                       |
              |------------------&gt;|  ACK F7               |
              |                   |----------------------&gt;|
              |                   |                       |
              |      RTP Both Ways - VM prompts for PIN
              |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
              |                   |                       |
              |  BYE F8           |                       |
              |------------------&gt;|  BYE F9               |
              |                   |----------------------&gt;|
              |                   |                       |
              |                   |  200 OK F10           |
              |                   |&lt;----------------------|
              |  200 OK F11       |                       |
              |&lt;------------------|                       |
              |                   |                       |








<span class="grey">Campbell &amp; Sparks            Informational                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


     Flow Id                            Comments

    INVITE F1     INVITE sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserAPhone",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
                  uri="sip:VoiceMail@wcom.com", response=&lt;appropriately
                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:UserA-retrieve@vm.wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000




<span class="grey">Campbell &amp; Sparks            Informational                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    200 OK F4     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: VoiceMailSystem &lt;sip:UserA-
                  retrieve@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F5     SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact VoiceMailSystem &lt;sip: UserA-
                  retrieve@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


    ACK F6        ACK sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserA-retrieve@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F7        ACK sip:UserA-retrieve@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;; tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

                  /* RTP streams are established between A and VM.  VM
                  determines that the call is likely from UserA, and
                  starts a message retrieval session, prompting for
                  PIN*/

                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F8        BYE sip: VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserA-retrieve@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F9        BYE sip: UserA-retrieve@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F10    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F11    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2%20Call%20to%20retrieve%20messages%20from%20an%20authenticated%20subscriber"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a> Call to retrieve messages from an authenticated subscriber</span>

   UserA to call the voice mail system to retrieve messages.
   Assumptions: The caller is authenticated using UserA's credentials.
   "sip:UserA-retrieve-auth@vm.wcom.com" maps to UserA's mailbox and the
   behavior of "retrieve messages." The voice mail service trusts the
   proxy not to forward any calls to that URI unless the call is
   authenticated to be from UserA.

   Given these assumptions, The VM service may choose not require a PIN
   for calls to this URI.



























<span class="grey">Campbell &amp; Sparks            Informational                     [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


            User A              Proxy                VM Service
              |                   |                       |
              |  INVITE F1        |                       |
              |------------------&gt;|                       |
              |                   |  INVITE F2            |
              | (100 Trying) F3   |----------------------&gt;|
              |&lt;------------------|                       |
              |                   |  200 OK F4            |
              |  200 OK F5        |&lt;----------------------|
              |&lt;------------------|                       |
              |                   |                       |
              |  ACK F6           |                       |
              |------------------&gt;|  ACK F7               |
              |                   |----------------------&gt;|
              |                   |                       |
              |      RTP Both Ways - Deposit Msg for B    |
              |&lt;-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-m-&gt;|
              |                   |                       |
              |  BYE F8           |                       |
              |------------------&gt;|  BYE F9               |
              |                   |----------------------&gt;|
              |                   |                       |
              |                   |  200 OK F10           |
              |                   |&lt;----------------------|
              |  200 OK F11       |                       |
              |&lt;------------------|                       |
              |                   |                       |

     Flow Id                            Comments

    INVITE F1     INVITE sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Proxy-Authorization:Digest username="UserA",
                  realm="MCI WorldCom SIP",
                  nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
                  uri="sip:VoiceMail@wcom.com", response=&lt;appropriately
                  calculated hash goes here&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

                  /*Client for A prepares to receive data on port 49170
                  from the network. */

    INVITE F2     INVITE sip:UserA-retrieve-auth@vm.wcom.com SIP/2.0
    Proxy-&gt;B1     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: TheBigGuy &lt;sip:UserA@here.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserA 2890844526 2890844526 IN IP4 client.here.com
                  s=Session SDP
                  c=IN IP4 100.101.102.103
                  t=0 0
                  m=audio 49170 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    (100 Trying   SIP/2.0 100 Trying
    F3            Via: SIP/2.0/UDP here.com:5060
    Proxy-&gt;A)     From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Content-Length: 0

    200 OK F4     SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060; branch=1
                  Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact: VoiceMailSystem &lt;sip:UserA-retrieve-
                  auth@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;



<span class="grey">Campbell &amp; Sparks            Informational                     [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    200 OK F5     SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  Record-Route: &lt;sip:VoiceMail@wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 INVITE
                  Contact VoiceMailSystem &lt;sip: UserA-retrieve-
                  auth@vm.wcom.com&gt;
                  Content-Type: application/sdp
                  Content-Length: &lt;appropriate value&gt;

                  v=0
                  o=UserB 2890844527 2890844527 IN IP4 vm.wcom.com
                  s=Session SDP
                  c=IN IP4 110.111.112.114
                  t=0 0
                  m=audio 3456 RTP/AVP 0
                  a=rtpmap:0 PCMU/8000

    ACK F6        ACK sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route: &lt;sip:UserA-retrieve-auth@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0

    ACK F7        ACK sip:UserA-retrieve-auth@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;; tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 1 ACK
                  Content-Length: 0






<span class="grey">Campbell &amp; Sparks            Informational                     [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


                  /* RTP streams are established between A and VM.  VM
                  determines that the call is likely from UserA, and
                  starts a message retrieval session.  Since the proxy
                  has already authenticated the identity of UserA, the
                  VM does not need to prompt for PIN. */

                  /* User A Hangs Up with VM system.  Alternatively, the
                  VM system could initiate the BYE*/

    BYE F8        BYE sip:VoiceMail@wcom.com SIP/2.0
    A-&gt;Proxy      Via: SIP/2.0/UDP here.com:5060
                  Route:&lt;sip:UserA-retrieve-auth@vm.wcom.com&gt;
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    BYE F9        BYE sip: UserA-retrieve-auth@vm.wcom.com SIP/2.0
    Proxy-&gt;VM     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F10    SIP/2.0 200 OK
    VM-&gt;Proxy     Via: SIP/2.0/UDP wcom.com:5060
                  Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq: 2 BYE
                  Content-Length: 0

    200 OK F11    SIP/2.0 200 OK
    Proxy-&gt;A      Via: SIP/2.0/UDP here.com:5060
                  From: TheBigGuy &lt;sip:UserA@here.com&gt;
                  To: VoiceMail &lt;sip:VoiceMail@wcom.com&gt;;tag=3145678
                  Call-Id: 12345600@here.com
                  CSeq:  2 BYE
                  Content-Length: 0








<span class="grey">Campbell &amp; Sparks            Informational                     [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>. Security Considerations</span>

   This document discusses a usage of SIP/2.0 as defined by <a href="rfc2543.html">RFC 2543</a>[<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].
   It introduces no additions, modifications, or restrictions to the
   protocol defined therein.  Any implementation of the concepts in this
   document is subject to the issues discussed there.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20Acknowledgments"></a><a class="selflink" href="#section-6" name="section-6">6</a>. Acknowledgments</span>

   The authors would like to thank Chris Cunningham, Steve Donovan, Alan
   Johnston, Henry Sinnreich, Kevin Summers, John Truetken, and Dean
   Willis for their discussion of and contribution to this work.

References

   [<a id="ref-1" name="ref-1">1</a>] Handley, M., Schulzrinne, H., Schooler, E. and J. Rosenberg,
       "SIP: Session Initiation Protocol", <a href="rfc2543.html">RFC 2543</a>, March 1999.

Authors' Addresses

   Ben Campbell
   dynamicsoft
   5100 Tennyson Parkway
   Suite 1200
   Plano, TX  75024

   EMail: bcampbell@dynamicsoft.com


   Robert J. Sparks
   dynamicsoft
   5100 Tennyson Parkway
   Suite 1200
   Plano, TX  75024

   EMail: rsparks@dynamicsoft.com















<span class="grey">Campbell &amp; Sparks            Informational                     [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc3087.html">RFC 3087</a>                  SIP Service Control                 April 2001</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2001).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Campbell &amp; Sparks            Informational                     [Page 39]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3087 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:49 GMT --></html>