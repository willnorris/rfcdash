<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5806 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:33 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:5806" name="DC.Identifier"/>
<meta content="This document proposes an extension to the Session Initiation Protocol
(SIP). This extension provides the ability for the called SIP user
agent to identify from whom the call was diverted and why the call was
diverted.  The extension defines a general header, Diversion, which
conveys the diversion information from other SIP user agents and
proxies to the called user agent.  This extension allows enhanced
support for various features, including Unified Messaging, Third-Party
Voicemail, and Automatic Call Distribution (ACD). SIP user agents and
SIP proxies which receive diversion information may use this as
supplemental information for feature invocation decisions." name="DC.Description.Abstract"/>
<meta content="Steve Levy &lt;stlevy@cisco.com&gt;" name="DC.Creator"/>
<meta content="March, 2010" name="DC.Date.Issued"/>
<meta content="Diversion Indication in SIP" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5806 - Diversion Indication in SIP</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bggrey" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5806.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5806" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-levy-sip-diversion" title="draft-levy-sip-diversion">draft-levy-sip-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5806" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5806" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5806" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=5806">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                                HISTORIC</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Independent Submission                                           S. Levy
Request for Comments: 5806                                 Cisco Systems
Category: Historic                                        M. Mohali, Ed.
ISSN: 2070-1721                                              Orange Labs
                                                              March 2010


                      <span class="h1">Diversion Indication in SIP</span>

Abstract

   This RFC, which contains the text of an Internet Draft that was
   submitted originally to the SIP Working Group, is being published now
   for the historical record and to provide a reference for later
   Informational RFCs.  The original Abstract follows.

   This document proposes an extension to the Session Initiation
   Protocol (SIP).  This extension provides the ability for the called
   SIP user agent to identify from whom the call was diverted and why
   the call was diverted.  The extension defines a general header,
   Diversion, which conveys the diversion information from other SIP
   user agents and proxies to the called user agent.

   This extension allows enhanced support for various features,
   including Unified Messaging, Third-Party Voicemail, and Automatic
   Call Distribution (ACD).  SIP user agents and SIP proxies that
   receive diversion information may use this as supplemental
   information for feature invocation decisions.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for the historical record.

   This document defines a Historic Document for the Internet community.
   This is a contribution to the RFC Series, independently of any other
   RFC stream.  The RFC Editor has chosen to publish this document at
   its discretion and makes no statement about its value for
   implementation or deployment.  Documents approved for publication by
   the RFC Editor are not a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc5806">http://www.rfc-editor.org/info/rfc5806</a>.






<span class="grey">Levy &amp; Mohali                   Historic                        [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


IESG Note

   This document contains an early proposal to the IETF SIP Working
   Group that was not chosen for standardization.  Discussions on the
   topic resulted in the informational <a href="rfc3325.html">RFC 3325</a>, "Private Extensions to
   the Session Initiation Protocol (SIP) for Asserted Identity within
   Trusted Networks", and the standard solution that was chosen can be
   found in <a href="rfc4244.html">RFC 4244</a>, "An Extension to the Session Initiation Protocol
   (SIP) for Request History Information".

Copyright Notice

   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.






























<span class="grey">Levy &amp; Mohali                   Historic                        [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
      <a href="#section-2.1">2.1</a>. Requirements Language ......................................<a href="#page-4">4</a>
      <a href="#section-2.2">2.2</a>. Definitions ................................................<a href="#page-4">4</a>
      <a href="#section-2.3">2.3</a>. Abbreviations ..............................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Overview ........................................................<a href="#page-5">5</a>
      <a href="#section-3.1">3.1</a>. When Is the Diversion Header Used? .........................<a href="#page-6">6</a>
   <a href="#section-4">4</a>. Extension Syntax ................................................<a href="#page-6">6</a>
   <a href="#section-5">5</a>. Detailed Semantics ..............................................<a href="#page-7">7</a>
      <a href="#section-5.1">5.1</a>. UAS Behavior ...............................................<a href="#page-7">7</a>
      <a href="#section-5.2">5.2</a>. UAC Behavior ...............................................<a href="#page-7">7</a>
      <a href="#section-5.3">5.3</a>. Redirect Server Behavior ...................................<a href="#page-7">7</a>
      <a href="#section-5.4">5.4</a>. Proxy Server Behavior ......................................<a href="#page-7">7</a>
   <a href="#section-6">6</a>. Examples Using Diversion Header .................................<a href="#page-8">8</a>
      <a href="#section-6.1">6.1</a>. Call Forward Unconditional .................................<a href="#page-8">8</a>
      <a href="#section-6.2">6.2</a>. Call Forward on Busy ......................................<a href="#page-13">13</a>
      <a href="#section-6.3">6.3</a>. Call Forward on No-Answer .................................<a href="#page-17">17</a>
      <a href="#section-6.4">6.4</a>. Call Forward on Unavailable ...............................<a href="#page-21">21</a>
      <a href="#section-6.5">6.5</a>. Multiple Diversions .......................................<a href="#page-24">24</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-27">27</a>
   <a href="#section-8">8</a>. Further Examples ...............................................<a href="#page-27">27</a>
      8.1. Night Service/Automatic Call Distribution (ACD)
           Using Diversion Header ....................................<a href="#page-27">27</a>
      <a href="#section-8.2">8.2</a>. Voicemail Service Using Diversion Header ..................<a href="#page-36">36</a>
      <a href="#section-8.3">8.3</a>. Questions and Answers on Alternative Approaches ...........<a href="#page-41">41</a>
 9. Mapping ISUP/ISDN Redirection Information to SIP
      Diversion Header ...............................................<a href="#page-42">42</a>
      <a href="#section-9.1">9.1</a>. Mapping ISUP/ISDN Diversion Reason Codes ..................<a href="#page-42">42</a>
      9.2. Mapping ISUP Redirection Information to SIP
           Diversion Header ..........................................<a href="#page-43">43</a>
      9.3. Mapping ISDN Redirection Information to SIP
           Diversion Header ..........................................<a href="#page-47">47</a>
      <a href="#section-9.4">9.4</a>. Information Loss in SIP to ISUP/ISDN Translation ..........<a href="#page-52">52</a>
   <a href="#section-10">10</a>. Contributors ..................................................<a href="#page-53">53</a>
   <a href="#section-11">11</a>. Acknowledgements ..............................................<a href="#page-53">53</a>
   <a href="#section-12">12</a>. Normative References ..........................................<a href="#page-53">53</a>













<span class="grey">Levy &amp; Mohali                   Historic                        [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This RFC, which contains the text of an Internet Draft that was
   submitted originally to the SIP Working Group, is being published now
   for the historical record and to provide a reference for later
   Informational RFCs.

   In the legacy telephony network, redirection information is passed
   through the network in ISDN/ISUP (ISDN User Part) signaling messages.
   This information is used by various service providers and business
   applications to support enhanced features for the end user.

   An analogous mechanism of providing redirection information would
   enable such enhanced features for SIP users.

   The Diversion header allows implementation of feature logic based on
   from whom the call was diverted.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Definitions"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Definitions</span>

   diversion:

      A change to the ultimate destination endpoint of a request.  A
      change in the Request-URI of a request that was not caused by a
      routing decision.  This is also sometimes called a deflection or
      redirection.

      A diversion can occur when the "user" portion of the Request-URI
      is changed for a reason other than expansion or translation.

      A diversion can occur when only the "host" portion of the Request-
      URI has changed if the change was due to a non-routing decision.

   divertor:

      The entity that diverted the call.







<span class="grey">Levy &amp; Mohali                   Historic                        [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   recursing:

      A SIP proxy or user agent that handles a received or internally
      generated 3xx response by forking new request(s) itself.

   non-recursing:

      A SIP proxy or user agent that handles a received or internally
      generated 3xx response by forwarding it upstream.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Abbreviations"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Abbreviations</span>

   CFUNC: Call Forward Unconditional

   CFTOD: Call Forward Time-of-Day

   CFB:   Call Forward on Busy

   CFNA:  Call Forward on No Answer

   CFUNV: Call Forward Unavailable

   ACD:   Automatic Call Distribution

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Overview</span>

   In order to implement certain third-party features such as Third-
   Party Voicemail and Automatic Call Distribution (ACD) applications,
   diversion information needs to be given to the called third party so
   that he may respond to the caller intelligently.  In these
   situations, the party receiving a diverted call needs answers for two
   questions:

   Question 1: From whom was the request diverted?

   Question 2: Why was the request diverted?

   This document proposes usage of the Diversion header to answer these
   questions for the party receiving the diverted call.

   Insertion of the previous Request-URI (before the diversion occurred)
   into the Diversion header answers question 1.

   Insertion of the "reason" tag into the Diversion header (by the
   divertor) answers question 2.






<span class="grey">Levy &amp; Mohali                   Historic                        [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20When%20Is%20the%20Diversion%20Header%20Used%3F"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  When Is the Diversion Header Used?</span>

   The Diversion header SHOULD be added when a SIP proxy server, SIP
   redirect server, or SIP user agent changes the ultimate endpoint that
   will receive the call.

   Diversion information SHOULD NOT be added for normal call routing
   changes to the Request-URI.  Thus, the Diversion header is not added
   when features such as speed dial change the Request-URI.

   When a diversion occurs, a Diversion header SHOULD be added to the
   forwarded request or forwarded 3xx response.  The Diversion header
   MUST contain the Request-URI of the request prior to the diversion.
   The Diversion header SHOULD contain a reason that the diversion
   occurred.

   Existing Diversion headers received in an incoming request MUST NOT
   be removed or changed in forwarded requests.

   Existing Diversion headers received in an incoming response MUST NOT
   be removed or changed in the forwarded response.

   A Diversion header is added when features such as call forwarding or
   call deflection change the Request-URI.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Extension%20Syntax"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Extension Syntax</span>

   The syntax of the Diversion header is:

   Diversion = "Diversion" ":" 1# (name-addr *( ";" diversion_params ))
   diversion-params = diversion-reason | diversion-counter |
                      diversion-limit | diversion-privacy |
                      diversion-screen | diversion-extension
   diversion-reason = "reason" "="
                   ( "unknown" | "user-busy" | "no-answer" |
                     "unavailable" | "unconditional" |
                     "time-of-day" | "do-not-disturb" |
                     "deflection" | "follow-me" |
                     "out-of-service" | "away" |
                     token | quoted-string )
   diversion-counter = "counter" "=" 1*2DIGIT
   diversion-limit = "limit" "=" 1*2DIGIT
   diversion-privacy = "privacy" "=" ( "full" | "name" |
                       "uri" | "off" | token | quoted-string )
   diversion-screen = "screen" "=" ( "yes" | "no" | token |
                                        quoted-string )
   diversion-extension = token ["=" (token | quoted-string)]




<span class="grey">Levy &amp; Mohali                   Historic                        [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   The following is an extension of tables 4 and 5 in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] for the
   Diversion header:
                       where  enc.  e-e ACK BYE CAN INV OPT REG
   _____________________________________________________________
   Diversion              R           h   -   -   -   o   -   -
   Diversion             3xx          h   -   -   -   o   -   -

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Detailed%20Semantics"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Detailed Semantics</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20UAS%20Behavior"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  UAS Behavior</span>

   A SIP User Agent Service (UAS) that receives a request and returns a
   3xx SHOULD add a Diversion header containing the previous Request-URI
   and the reason for the diversion.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20UAC%20Behavior"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  UAC Behavior</span>

   A SIP UAC that receives a 3xx containing a Diversion header SHOULD
   copy the Diversion header into each downstream forked request that
   resulted from the 3xx.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Redirect%20Server%20Behavior"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Redirect Server Behavior</span>

   A SIP redirect server that receives a request and returns a 3xx
   containing a Contact that diverts the request to a different endpoint
   SHOULD add a Diversion header containing the Request-URI from the
   incoming request and the reason for the diversion.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20Proxy%20Server%20Behavior"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  Proxy Server Behavior</span>

   A non-recursing SIP proxy that receives a 3xx containing a Diversion
   header SHOULD forward the 3xx containing the Diversion header
   upstream unchanged.

   A SIP proxy that receives a request and invokes a feature that
   changes the Request-URI of the forwarded request in order to divert
   the request to a different endpoint SHOULD add a Diversion header
   containing the Request-URI from the incoming request and the reason
   for the diversion.

   A SIP proxy that receives a request and returns a 3xx containing a
   Contact that diverts the request to a different endpoint SHOULD add a
   Diversion header containing the Request-URI from the incoming request
   and the reason for the diversion.







<span class="grey">Levy &amp; Mohali                   Historic                        [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.4.1.%20%20Proxy%20Logic%20for%20Diversion%20Header"></a><a class="selflink" href="#section-5.4.1" name="section-5.4.1">5.4.1</a>.  Proxy Logic for Diversion Header</span>

      if (pdu.is_request()) {
          if (request-URI is changed due to a called feature) {
              if (proxy.is_recursing()) {
                  Add the Diversion header (indicating the reason
                    that the call has been diverted) to
                    the downstream forwarded request(s).
              } else {
                  Add the Diversion header (indicating the reason
                    that the call has been diverted) to
                    the upstream forwarded 3xx response.
              }
          }
      } else if (pdu.is_response()) {
          if (pdu.is_3xx()) {
              if (proxy.is_recursing()) {
                Copy Diversion header into forwarded INVITE(s).
              } else {
                Forward response upstream.
              }
          }
      }

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Examples%20Using%20Diversion%20Header"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Examples Using Diversion Header</span>

   There are several implementations of call forwarding features that
   can be implemented by either recursing or non-recursing SIP proxies
   or SIP user agents.

   A SIP proxy or user agent that generates or forwards 3xxs upstream is
   non-recursing.  A SIP proxy or user agent that handles received (or
   internally generated) 3xxs itself is recursing.

   The following examples illustrate usage of the Diversion header for
   some of the variants of recursing and non-recursing proxies and user
   agents.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Call%20Forward%20Unconditional"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Call Forward Unconditional</span>

   Usage of the Diversion header is shown below for several variant
   implementations of Call Forward Unconditional.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.%20%20Network%20Call%20Forward%20Unconditional%20%28P2%20Recursing%29"></a><a class="selflink" href="#section-6.1.1" name="section-6.1.1">6.1.1</a>.  Network Call Forward Unconditional (P2 Recursing)</span>

   In this message flow, the call would normally be routed to Bob@B.
   However, Proxy 2 (P2) recursively implements Call Forward
   Unconditional (CFUNC) to Carol@C.



<span class="grey">Levy &amp; Mohali                   Historic                        [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


                     +------------------------+
                     | Bob@P2: CFUNC-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A             P1              P2            B          C
                            recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INVITE Carol@C-------&gt;|
|              |              |  Diversion: Bob@P2     |
|              |              |    ;reason=unconditional
|              |              |             |          |
|              |              |&lt;-200-------------------|
|              |              |             |          |
|              |&lt;-200---------|             |          |
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |


























<span class="grey">Levy &amp; Mohali                   Historic                        [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.2.%20%20Network%20Call%20Forward%20Unconditional%20%28P1%20Non-Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.1.2" name="section-6.1.2">6.1.2</a>.  Network Call Forward Unconditional (P1 Non-Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward Unconditional (CFUNC) to Carol@C.  Proxy 1 (P1) is non-
   recursing.

                     +------------------------+
                     | Bob@P2: CFUNC-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A              P1             P2            B          C
            non-recursing  non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unconditional   |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|&lt;-302---------|              |             |          |
|  Contact: Carol@C           |             |          |
|  Diversion: Bob@P2          |             |          |
|    ;reason=unconditional    |             |          |
|              |              |             |          |
|--ACK--------&gt;|              |             |          |
|              |              |             |          |
|--INVITE Carol@C-------------------------------------&gt;|
|  Diversion: Bob@P2          |             |          |
|    ;reason=unconditional    |             |          |
|              |              |             |          |
|&lt;-200-------------------------------------------------|
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |









<span class="grey">Levy &amp; Mohali                   Historic                       [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.3.%20%20Network%20Call%20Forward%20Unconditional%20%28P1%20Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.1.3" name="section-6.1.3">6.1.3</a>.  Network Call Forward Unconditional (P1 Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward Unconditional (CFUNC) to Carol@C.  Proxy 1 (P1) is recursing.

                     +------------------------+
                     | Bob@P2: CFUNC-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unconditional   |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unconditional   |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |















<span class="grey">Levy &amp; Mohali                   Historic                       [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.4.%20%20Endpoint%20Call%20Forward%20Unconditional%20%28P1%20Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.1.4" name="section-6.1.4">6.1.4</a>.  Endpoint Call Forward Unconditional (P1 Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, user agent server B (B) non-recursively
   implements Call Forward Unconditional (CFUNC) to Carol@C.  Proxy 2
   (P2) is non-recursing.  Proxy 1 (P1) is recursing.

                                    +-----------------------+
                                    | Bob@B: CFUNC-&gt;Carol@C |
                                    +------+----------------+
                                            \
                                             \
A              P1             P2              B          C
            recursing      non-recursing
|              |              |               |          |
|--INV Bob@P1-&gt;|              |               |          |
|              |              |               |          |
|              |--INV Bob@P2-&gt;|               |          |
|              |              |--INV Bob@B---&gt;|          |
|              |              |               |          |
|              |              |&lt;-302----------|          |
|              |              |  Contact: Carol@C        |
|              |              |  Diversion: Bob@B        |
|              |              |    ;reason=unconditional
|              |              |               |          |
|              |              |--ACK---------&gt;|          |
|              |              |               |          |
|              |&lt;-302---------|               |          |
|              |  Contact: Carol@C            |          |
|              |  Diversion: Bob@B            |          |
|              |    ;reason=unconditional     |          |
|              |              |               |          |
|              |--ACK--------&gt;|               |          |
|              |              |               |          |
|              |--INVITE Carol@C------------------------&gt;|
|              |  Diversion: Bob@B            |          |
|              |    ;reason=unconditional     |          |
|              |              |               |          |
|              |&lt;-200------------------------------------|
|              |              |               |          |
|&lt;-200---------|              |               |          |
|              |              |               |          |
|--ACK--------------------------------------------------&gt;|
|              |              |               |          |
|              |              |               |          |






<span class="grey">Levy &amp; Mohali                   Historic                       [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Call%20Forward%20on%20Busy"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Call Forward on Busy</span>

   Usage of the Diversion header is shown below for several variant
   implementations of Call Forward on Busy.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.1.%20%20Network%20Call%20Forward%20on%20Busy%20%28P2%20Recursing%29"></a><a class="selflink" href="#section-6.2.1" name="section-6.2.1">6.2.1</a>.  Network Call Forward on Busy (P2 Recursing)</span>

   In this message flow, Proxy 2 (P2) recursively implements Call
   Forward on Busy (CFB) to Carol@C.

                     +----------------------+
                     | Bob@P2: CFB-&gt;Carol@C |
                     +------+---------------+
                             \
                              \
A              P1             P2            B          C
                           recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-486--------|          |
|              |              |             |          |
|              |              |--ACK-------&gt;|          |
|              |              |             |          |
|              |              |--INVITE Carol@C-------&gt;|
|              |              |  Diversion: Bob@P2     |
|              |              |    ;reason=user-busy   |
|              |              |             |          |
|              |              |&lt;-200-------------------|
|              |              |             |          |
|              |&lt;-200---------|             |          |
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |










<span class="grey">Levy &amp; Mohali                   Historic                       [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.2.%20%20Network%20Call%20Forward%20on%20Busy%20%28P1%20Non-Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.2.2" name="section-6.2.2">6.2.2</a>.  Network Call Forward on Busy (P1 Non-Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on Busy (CFB) to Carol@C.  Proxy 1 (P1) is non-recursing.

                     +----------------------+
                     | Bob@P2: CFB-&gt;Carol@C |
                     +------+---------------+
                             \
                              \
A              P1             P2            B          C
            non-recursing  non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-486--------|          |
|              |              |             |          |
|              |              |--ACK-------&gt;|          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=user-busy       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|&lt;-302---------|              |             |          |
|  Contact: Carol@C           |             |          |
|  Diversion: Bob@P2          |             |          |
|    ;reason=user-busy        |             |          |
|              |              |             |          |
|--ACK--------&gt;|              |             |          |
|              |              |             |          |
|--INVITE Carol@C-------------------------------------&gt;|
|  Diversion: Bob@P2          |             |          |
|    ;reason=user-busy        |             |          |
|              |              |             |          |
|&lt;-200-------------------------------------------------|
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |




<span class="grey">Levy &amp; Mohali                   Historic                       [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.3.%20%20Network%20Call%20Forward%20on%20Busy%20%28P1%20Recursing%2C%20P2%20Non-Recursing%29"></a><a class="selflink" href="#section-6.2.3" name="section-6.2.3">6.2.3</a>.  Network Call Forward on Busy (P1 Recursing, P2 Non-Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on Busy (CFB) to Carol@C.  Proxy 1 (P1) is recursing.

                     +----------------------+
                     | Bob@P2: CFB-&gt;Carol@C |
                     +------+---------------+
                             \
                              \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-486--------|          |
|              |              |             |          |
|              |              |--ACK-------&gt;|          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=user-busy       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=user-busy       |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |










<span class="grey">Levy &amp; Mohali                   Historic                       [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.4.%20%20Endpoint%20Call%20Forward%20on%20Busy%20%28P1%20Recursing%2C%20P2%20Non-Recursing%29"></a><a class="selflink" href="#section-6.2.4" name="section-6.2.4">6.2.4</a>.  Endpoint Call Forward on Busy (P1 Recursing, P2 Non-Recursing)</span>

   In this message flow, user agent server B (B) non-recursively
   implements Call Forward on Busy (CFB) to Carol@C.  Proxy 2 (P2) is
   non-recursing.  Proxy 1 (P1) is recursing.

                               +---------------------+
                               | Bob@B: CFB-&gt;Carol@C |
                               +------+--------------+
                                          \
                                           \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-302--------|          |
|              |              |  Contact: Carol@C      |
|              |              |  Diversion: Bob@B      |
|              |              |    ;reason=user-busy   |
|              |              |             |          |
|              |              |--ACK-------&gt;|          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@B          |          |
|              |    ;reason=user-busy       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@B          |          |
|              |    ;reason-user-busy       |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |






<span class="grey">Levy &amp; Mohali                   Historic                       [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Call%20Forward%20on%20No-Answer"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Call Forward on No-Answer</span>

   Usage of the Diversion header is shown below for several variant
   implementations of Call Forward on No-Answer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.1.%20%20Network%20Call%20Forward%20on%20No-Answer%20%28P2%20Recursing%29"></a><a class="selflink" href="#section-6.3.1" name="section-6.3.1">6.3.1</a>.  Network Call Forward on No-Answer (P2 Recursing)</span>

   In this message flow, Proxy 2 (P2) recursively implements Call
   Forward on No Answer (CFNA) to Carol@C.

                     +-----------------------+
                     | Bob@P2: CFNA-&gt;Carol@C |
                     +------+----------------+
                             \
                              \
A              P1             P2            B          C
                           recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-180--------|          |
|              |              |             |          |
|              |              |             |          |
|              |              |             |          |
|              |           timeout          |          |
|              |              |--INVITE Carol@C-------&gt;|
|              |              |  Diversion: Bob@P2     |
|              |              |    ;reason=no-answer   |
|              |              |             |          |
|              |              |&lt;-200-------------------|
|              |              |             |          |
|              |&lt;-200---------|             |          |
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |









<span class="grey">Levy &amp; Mohali                   Historic                       [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.2.%20%20Network%20Call%20Forward%20on%20No-Answer%20%28P1%20Non-Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.3.2" name="section-6.3.2">6.3.2</a>.  Network Call Forward on No-Answer (P1 Non-Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on No Answer (CFNA) to Carol@C.  Proxy 1 (P1) is non-
   recursing.

                     +-----------------------+
                     | Bob@P2: CFNA-&gt;Carol@C |
                     +------+----------------+
                             \
                              \
A              P1             P2            B          C
            non-recursing  non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-180--------|          |
|              |              |             |          |
|              |              |             |          |
|              |              |             |          |
|              |           timeout          |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=no-answer       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|&lt;-302---------|              |             |          |
|  Contact: Carol@C           |             |          |
|  Diversion: Bob@P2          |             |          |
|    ;reason=no-answer        |             |          |
|              |              |             |          |
|--ACK--------&gt;|              |             |          |
|              |              |             |          |
|--INVITE Carol@C-------------------------------------&gt;|
|  Diversion: Bob@P2          |             |          |
|    ;reason=no-answer        |             |          |
|              |              |             |          |
|&lt;-200-------------------------------------------------|
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.3.%20%20Network%20Call%20Forward%20on%20No%20Answer%20%28P1%20Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.3.3" name="section-6.3.3">6.3.3</a>.  Network Call Forward on No Answer (P1 Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on No Answer (CFNA) to Carol@C.  Proxy 1 (P1) is recursing.

                     +-----------------------+
                     | Bob@P2: CFNA-&gt;Carol@C |
                     +------+----------------+
                             \
                              \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |&lt;-180--------|          |
|              |              |             |          |
|              |              |             |          |
|              |              |             |          |
|              |            timeout         |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=no-answer       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=no-answer       |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |








<span class="grey">Levy &amp; Mohali                   Historic                       [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.3.4.%20%20Endpoint%20Call%20Forward%20on%20No-Answer%20%28P1%20Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.3.4" name="section-6.3.4">6.3.4</a>.  Endpoint Call Forward on No-Answer (P1 Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%2C%20B%20Non-Recursing%29"></a>        Recursing, B Non-Recursing)</span>

   In this message flow, user agent server B (B) non-recursively
   implements Call Forward on No Answer (CFNA) to Carol@C.  Proxy 2 (P2)
   is non-recursing.  Proxy 1 (P1) is recursing.

                                  +----------------------+
                                  | Bob@B: CFNA-&gt;Carol@C |
                                  +------+---------------+
                                          \
                                           \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |             |          |
|              |              |             |          |
|              |              |             |          |
|              |              |          timeout       |
|              |              |&lt;-302--------|          |
|              |              |  Contact: Carol@C      |
|              |              |  Diversion: Bob@B      |
|              |              |    ;reason=no-answer   |
|              |              |             |          |
|              |              |--ACK-------&gt;|          |
|              |              |             |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@B          |          |
|              |    ;reason=no-answer       |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@B          |          |
|              |    ;reason-no-answer       |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20Call%20Forward%20on%20Unavailable"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  Call Forward on Unavailable</span>

   Usage of the Diversion header is shown below for several variant
   implementations of Call Forward on Unavailable.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.1.%20%20Network%20Call%20Forward%20on%20Unavailable%20%28P2%20Recursing%29"></a><a class="selflink" href="#section-6.4.1" name="section-6.4.1">6.4.1</a>.  Network Call Forward on Unavailable (P2 Recursing)</span>

   In this message flow, Proxy 2 (P2) recursively implements Call
   Forward on Unavailable (CFUNV) to Carol@C.

                     +------------------------+
                     | Bob@P2: CFUNV-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A              P1             P2            B          C
                           recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|&lt;-100---------|              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |&lt;-100---------|             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |  ...        |          |
|              |              |--INV Bob@B-&gt;|          |
|              |           timeout          |          |
|              |              |--INVITE Carol@C-------&gt;|
|              |              |  Diversion: Bob@P2     |
|              |              |    ;reason=unavailable
|              |              |             |          |
|              |              |&lt;-200-------------------|
|              |              |             |          |
|              |&lt;-200---------|             |          |
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.2.%20%20Network%20Call%20Forward%20on%20Unavailable%20%28P1%20Non-Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.4.2" name="section-6.4.2">6.4.2</a>.  Network Call Forward on Unavailable (P1 Non-Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on Unavailable (CFUNV) to Carol@C.  Proxy 1 (P1) is non-
   recursing.



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


                     +------------------------+
                     | Bob@P2: CFUNV-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A              P1             P2            B          C
            non-recursing  non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|              |              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |              |             |          |
|              |&lt;-100---------|             |          |
|              |              |             |          |
|&lt;-100---------|              |             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |  ...        |          |
|              |              |--INV Bob@B-&gt;|          |
|              |           timeout          |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unavailable     |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|&lt;-302---------|              |             |          |
|  Contact: Carol@C           |             |          |
|  Diversion: Bob@P2          |             |          |
|    ;reason=unavailable      |             |          |
|              |              |             |          |
|--ACK--------&gt;|              |             |          |
|              |              |             |          |
|--INVITE Carol@C-------------------------------------&gt;|
|  Diversion: Bob@P2          |             |          |
|    ;reason=unavailable      |             |          |
|              |              |             |          |
|&lt;-200-------------------------------------------------|
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |







<span class="grey">Levy &amp; Mohali                   Historic                       [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.3.%20%20Network%20Call%20Forward%20on%20Unavailable%20%28P1%20Recursing%2C%20P2%20Non-"></a><a class="selflink" href="#section-6.4.3" name="section-6.4.3">6.4.3</a>.  Network Call Forward on Unavailable (P1 Recursing, P2 Non-</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Recursing%29"></a>        Recursing)</span>

   In this message flow, Proxy 2 (P2) non-recursively implements Call
   Forward on Unavailable (CFUNV) to Carol@C.  Proxy 1 (P1) is
   recursing.

                     +------------------------+
                     | Bob@P2: CFUNV-&gt;Carol@C |
                     +------+-----------------+
                             \
                              \
A              P1             P2            B          C
            recursing      non-recursing
|              |              |             |          |
|--INV Bob@P1-&gt;|              |             |          |
|&lt;-100---------|              |             |          |
|              |--INV Bob@P2-&gt;|             |          |
|              |&lt;-100---------|             |          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |--INV Bob@B-&gt;|          |
|              |              |  ...        |          |
|              |              |--INV Bob@B-&gt;|          |
|              |           timeout          |          |
|              |&lt;-302---------|             |          |
|              |  Contact: Carol@C          |          |
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unavailable     |          |
|              |              |             |          |
|              |--ACK--------&gt;|             |          |
|              |              |             |          |
|              |--INVITE Carol@C----------------------&gt;|
|              |  Diversion: Bob@P2         |          |
|              |    ;reason=unavailable     |          |
|              |              |             |          |
|              |&lt;-200----------------------------------|
|              |              |             |          |
|&lt;-200---------|              |             |          |
|              |              |             |          |
|--ACK------------------------------------------------&gt;|
|              |              |             |          |
|              |              |             |          |








<span class="grey">Levy &amp; Mohali                   Historic                       [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20Multiple%20Diversions"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  Multiple Diversions</span>

   Usage of the Diversion header when multiple diversions occur are
   shown the following two examples.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.5.1.%20%20Call%20Forward%20Unconditional%20and%20Call%20Forward%20Busy"></a><a class="selflink" href="#section-6.5.1" name="section-6.5.1">6.5.1</a>.  Call Forward Unconditional and Call Forward Busy</span>

   In this message flow, Proxy 2 (P2) implements Call Forward
   Unconditional (CFUNC) to Carol@C.  C then implements Call Forward on
   Busy (CFB) to 5551234@D.  P2 is non-recursing.  P1 is recursing.  C
   is non-recursing.








































<span class="grey">Levy &amp; Mohali                   Historic                       [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


            +------------------------+     +-------------------------+
            | Bob@P2: CFUNC-&gt;Carol@C |     | Carol@C: CFB-&gt;5551234@D |
            +---------------+--------+     +--------+----------------+
                             \                       \
                              \                       \
A              P1             P2            B          C          D
            recursing      non-recursing          non-recursing
|              |              |             |          |          |
|--INV Bob@P1-&gt;|              |             |          |          |
|              |              |             |          |          |
|              |--INV Bob@P2-&gt;|             |          |          |
|              |              |             |          |          |
|              |&lt;-302---------|             |          |          |
|              |  Contact: Carol@C          |          |          |
|              |  Diversion: Bob@P2         |          |          |
|              |    ;reason=unconditional   |          |          |
|              |              |             |          |          |
|              |--ACK--------&gt;|             |          |          |
|              |              |             |          |          |
|              |--INVITE Carol@C----------------------&gt;|          |
|              |  Diversion: Bob@P2         |          |          |
|              |    ;reason=unconditional   |          |          |
|              |              |             |          |          |
|              |&lt;-302----------------------------------|          |
|              |  Contact: 5551234@D        |          |          |
|              |  Diversion: Carol@C        |          |          |
|              |    ;reason=user-busy       |          |          |
|              |    ;privacy="full"         |          |          |
|              |  Diversion: Bob@P2         |          |          |
|              |    ;reason=unconditional   |          |          |
|              |              |             |          |          |
|              |--ACK---------------------------------&gt;|          |
|              |              |             |          |          |
|              |--INVITE 5551234@D-------------------------------&gt;|
|              |  Diversion: Carol@C        |          |          |
|              |    ;reason=user-busy       |          |          |
|              |    ;privacy="full"         |          |          |
|              |  Diversion: Bob@P2         |          |          |
|              |    ;reason=unconditional   |          |          |
|              |              |             |          |          |
|              |&lt;-200---------------------------------------------|
|              |              |             |          |          |
|&lt;-200---------|              |             |          |          |
|              |              |             |          |          |
|--ACK-----------------------------------------------------------&gt;|
|              |              |             |          |          |
|              |              |             |          |          |




<span class="grey">Levy &amp; Mohali                   Historic                       [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.5.2.%20%20Call%20Forward%20Unconditional%20and%20Call%20Forward%20No%20Answer"></a><a class="selflink" href="#section-6.5.2" name="section-6.5.2">6.5.2</a>.  Call Forward Unconditional and Call Forward No Answer</span>

   In this message flow, Proxy 2 (P2) implements Call Forward
   Unconditional (CFUNC) to Carol@C.  (P2 would normally have routed the
   call to B).  C then implements Call Forward on No Answer (CFNA) to
   5551234@D.  P2 is recursing.  C is recursing.

         +------------------------+  +--------------------------+
         | Bob@P2: CFUNC-&gt;Carol@C |  | Carol@C: CFNA-&gt;5551234@D |
         +------------------+-----+  +-----+--------------------+
                             \              \
                              \              \
A              P1             P2       B      C                 D
                            recursing       recursing
|              |              |        |      |                 |
|--INV Bob@P1-&gt;|              |        |      |                 |
|              |              |        |      |                 |
|              |--INV Bob@P2-&gt;|        |      |                 |
|              |              |        |      |                 |
|              |              |--INV Carol@C-&gt;|                 |
|              |              |  Diversion: Bob@P2              |
|              |              |    ;reason=unconditional        |
|              |              |        |      |                 |
|              |              |&lt;--180---------|                 |
|              |              |        |      |                 |
|              |&lt;-180---------|        |      |                 |
|              |              |        |      |                 |
|&lt;-180---------|              |        |      |                 |
|              |              |        |      |                 |
|              |              |        |      |                 |
|              |              |        |    timeout             |
|              |              |        |      |--INV 5551234@D-&gt;|
|              |              |        |      |Diversion: Carol@C
|              |              |        |      |  ;reason=no-answer
|              |              |        |      |  ;privacy="full"
|              |              |        |      |Diversion: Bob@P2
|              |              |        |      |  ;reason= unconditional
|              |              |        |      |                 |
|              |              |        |      |&lt;-200------------|
|              |              |        |      |         |       |
|              |              |&lt;-200----------|         |       |
|              |              |        |      |         |       |
|              |&lt;-200---------|        |      |         |       |
|              |              |        |      |         |       |
|&lt;-200---------|              |        |      |         |       |
|              |              |        |      |         |       |
|--ACK---------------------------------------------------------&gt;|
|              |              |        |      |         |       |



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security Considerations</span>

   There are some privacy considerations when using the Diversion
   header.  Usage of the Diversion header implies that the diverting UAS
   trusts the diverted-to UAS.  Usage of the Diversion header by SIP
   proxies or SIP user agents can cause information leakage of route
   information and called information to untrusted SIP proxies and
   untrusted callers in upstream 3xxs.  Leakage of this information can
   be mitigated by having a recursing trusted upstream proxy server.
   For a SIP network architecture where all proxies are required to be
   non-recursive, Diversion header hiding may be considered necessary in
   order to prevent leakage of route information to the caller.  To
   accomplish Diversion header hiding, a trusted upstream proxy would
   add a Record-Route header and use a secret key to encrypt the
   contents of the Diversion header in 3xxs that are forwarded upstream.
   On receipt of re-INVITEs, the proxy would decrypt the contents of the
   Diversion header (using its secret key) and forward the INVITE.
   There is no currently defined interaction of the Diversion and Hide
   headers.  Question: Should there be?

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Further%20Examples"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Further Examples</span>

   Only the relevant headers have been included in the following
   examples.  The contents of the Session Description Protocols (SDPs)
   have also been omitted.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Night%20Service%2FAutomatic%20Call%20Distribution%20%28ACD%29%20Using%20Diversion"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Night Service/Automatic Call Distribution (ACD) Using Diversion</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/Header"></a>      Header</span>

   In the following two message flows, two separate companies,
   WeSellPizza.com and WeSellFlowers.com, have contracted with a third
   company, NightService.com to provide nighttime support for their
   incoming voice calls.

   In the first flow, Alice calls out for pizza.  In the second flow,
   Alice calls for roses.  In both instances, the same night service
   company (and receptionist, Carol) answers the call.  However, because
   the Diversion header is used, Carol is able to customize her greeting
   to the caller.












<span class="grey">Levy &amp; Mohali                   Historic                       [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


                +-------------------------------------+
                | WeSellPizza@P2: CFTOD-&gt;nightserv@P3 |
                +------------+------------------------+
                              \
                               \
UAC             P1             P2                 P3               UAS1
                        (WeSellPizza.com)  (NightService.com)
                                                (ACD)
| [<a href="#ref-1">1</a>]           |              |                   |                  |
|-INV pizza@P1-&gt;|              |                   |                  |
|               |              |                   |                  |
|               |              |                   |                  |
|               | [<a href="#ref-2">2</a>] INVITE WeSellPizza@P2        |                  |
|               |-------------&gt;|                   |                  |
|               |              |                   |                  |
|               |              | [<a href="#ref-3">3</a>]               |                  |
|               |              |-INV nightserv@P3-&gt;|                  |
|               |              | Diversion: WeSellPizza@P2            |
|               |              |   ;reason=time-of-day                |
|               |              |                   |                  |
|               |              |                   | [<a href="#ref-4">4</a>]              |
|               |              |                   |-INV Carol@uas1--&gt;|
|               |              |            Diversion: WeSellPizza@P2 |
|               |              |                ;reason=time-of-day   |
|               |              |                   |                  |
|               |              |                   |&lt;-[<a href="#ref-5">5</a>] 200---------|
|               |              |&lt;-[<a href="#ref-6">6</a>] 200----------|                  |
|               |&lt;-[<a href="#ref-7">7</a>] 200-----|                   |                  |
|&lt;-[<a href="#ref-8">8</a>] 200------|              |                   |                  |
|               |              |                   |                  |
|--[<a href="#ref-9">9</a>] ACK-----------------------------------------------------------&gt;|
|               |              |                   |                  |
|&lt;=========================================="Hello, WeSellPizza"======|
|               |              |                   |                  |
|               |              |                   |                  |

   Alice calls for pizza.

   [<a id="ref-1" name="ref-1">1</a>] SIP UAC to SIP proxy server 1:

        INVITE sip:pizza@p1.isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:pizza@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp




<span class="grey">Levy &amp; Mohali                   Historic                       [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   The ISP's originating proxy translated the keyword pizza to the
   company WeSellPizza.com

   [<a id="ref-2" name="ref-2">2</a>] SIP proxy server 1 to SIP proxy server 2 (WeSellPizza.com):

        INVITE sip:WeSellPizza@p2.isp.com SIP/2.0
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:pizza@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   It's after midnight and the pizza people are in bed.  Fortunately,
   WeSellPizza.com has contracted with NightService.com to answer their
   nighttime calls.  Thus, P2 implements CFTOD to NightService.com.

   [<a id="ref-3" name="ref-3">3</a>] SIP proxy server 2 (WeSellPizza.com) to
       SIP proxy server 3 (NightService.com):

        INVITE sip:NightService@p3.isp.com SIP/2.0
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:pizza@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:WeSellPizza@p2.isp.com&gt;
          ;reason=time-of-day
        Content-Type: application/sdp

   Carol is available to receive the incoming call.

















<span class="grey">Levy &amp; Mohali                   Historic                       [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-4" name="ref-4">4</a>] SIP proxy server 3 (NightService.com) to UAS1 (Carol):

        INVITE sip:carol@uas1.nightservice.com SIP/2.0
        Via: SIP/2.0/UDP p3.isp.com
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:pizza@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:WeSellPizza@p2.isp.com&gt;
          ;reason=time-of-day
        Content-Type: application/sdp

   The ACD keys off the Diversion header to pull up the WeSellPizza FAQ
   on Carol's web browser.

   [<a id="ref-5" name="ref-5">5</a>] UAS1 to SIP proxy server 3:

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP p3.isp.com
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:pizza@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-6" name="ref-6">6</a>] SIP proxy server 3 to SIP proxy server 2:

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:pizza@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp







<span class="grey">Levy &amp; Mohali                   Historic                       [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-7" name="ref-7">7</a>] SIP proxy server 2 to SIP proxy server 1:

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:pizza@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-8" name="ref-8">8</a>] SIP proxy server 1 to UAC

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:pizza@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-9" name="ref-9">9</a>] SIP UAC to UAS1:

        ACK sip:uas1.nightservice.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:pizza@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   The RTP flows begin and Carol answers "Hello, WeSellPizza.  How may I
   help you?"

















<span class="grey">Levy &amp; Mohali                   Historic                       [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


                 +---------------------------------------+
                 | WeSellFlowers@P4: CFTOD-&gt;nightserv@P3 |
                 +-------------+-------------------------+
                                \
                                 \
UAC             P1               P4                 P3              UAS1
                         (WeSellFlowers.com)  (NightService.com)
                                                   (ACD)
| [<a href="#ref-1">1</a>]           |                |                   |                |
|-INV roses@P1-&gt;|                |                   |                |
|               |                |                   |                |
|               | [<a href="#ref-2">2</a>] INVITE WeSellFlowers@P4        |                |
|               |---------------&gt;|                   |                |
|               |                |                   |                |
|               | [<a href="#ref-3">3</a>]            |                   |                |
|               |&lt;-302-----------|                   |                |
|               |  Contact: nightservice@P3          |                |
|               |  Diversion: WeSellFlowers@P4       |                |
|               |    ;reason=time-of-day             |                |
|               |                |                   |                |
|               |--[<a href="#ref-4">4</a>] ACK------&gt;|                   |                |
|               |                |                   |                |
|               | [<a href="#ref-5">5</a>]            |                   |                |
|               |-INVITE nightservice@P3------------&gt;|                |
|               | Diversion: WeSellFlowers@P4        |                |
|               |   ;reason=time-of-day              |                |
|               |                |                   |                |
|               |                |                   | [<a href="#ref-6">6</a>]            |
|               |                |               -INV Carol@uas1-----&gt;|
|               |                |          Diversion: WeSellFlowers@P4
|               |                |            ;reason=time-of-day
|               |                |                                    |
|               |                |              |&lt;-[<a href="#ref-7">7</a>] 200------------|
|               |&lt;-[<a href="#ref-8">8</a>] 200---------------------------|                |
|&lt;-[<a href="#ref-9">9</a>] 200------|                |                   |                |
|               |                |                   |                |
|--[<a href="#ref-10">10</a>] ACK----------------------------------------------------------&gt;|
|               |                |                   |                |
|&lt;======================================="Hello, WeSellFlowers"=======|
|               |                |                   |                |
|               |                |                   |                |










<span class="grey">Levy &amp; Mohali                   Historic                       [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   Alice calls for roses.

   [<a id="ref-1" name="ref-1">1</a>] SIP UAC to SIP proxy server 1:

        INVITE sip:roses@p1.isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:roses@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   The ISP's originating proxy translated the keyword roses to the
   company WeSellFlowers.com

   [<a id="ref-2" name="ref-2">2</a>] SIP proxy server 1 to SIP proxy server 4 (WeSellFlowers.com):

        INVITE sip:WeSellFlowers@p4.isp.com SIP/2.0
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:roses@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   It's now 1 a.m. and the florists are also in bed.  Fortunately,
   WeSellFlowers.com has contracted with NightService.com to answer
   their nighttime calls, too.  Thus, P4 implements CFTOD to
   NightService.com.

   [<a id="ref-3" name="ref-3">3</a>] SIP proxy server 4 (WeSellFlowers.com) to
       SIP proxy server 1 (NightService.com):

        SIP/2.0 302 Moved Temporarily
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: NightService@p3.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=p4
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:WeSellFlowers@p4.isp.com&gt;
          ;reason=time-of-day







<span class="grey">Levy &amp; Mohali                   Historic                       [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-4" name="ref-4">4</a>] SIP proxy server 1 to SIP proxy server 4 (WeSellFlowers.com):
        ACK sip:uas1.nightservice.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=p4
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   [<a id="ref-5" name="ref-5">5</a>] SIP proxy server 1 (WeSellFlowers.com) to
       SIP proxy server 3 (NightService.com):

        INVITE sip:NightService@p3.isp.com SIP/2.0
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:roses@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:WeSellFlowers@p4.isp.com&gt;
          ;reason=time-of-day
        Content-Type: application/sdp

   Carol is available to receive the incoming call.

   [<a id="ref-6" name="ref-6">6</a>] SIP proxy server 3 (NightService.com) to UAS1 (Carol):

        INVITE sip:carol@uas1.nightservice.com SIP/2.0
        Via: SIP/2.0/UDP p3.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:roses@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:WeSellFlowers@p4.isp.com&gt;
          ;reason=time-of-day
        Content-Type: application/sdp

   The ACD keys off the Diversion header to pull up the WeSellFlowers
   FAQ on Carol's web browser.











<span class="grey">Levy &amp; Mohali                   Historic                       [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-7" name="ref-7">7</a>] SIP UAS1 to SIP proxy server 3:

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP p3.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-8" name="ref-8">8</a>] SIP proxy server 3 to SIP proxy server 1:

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-9" name="ref-9">9</a>] SIP proxy server 1 to UAC

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: carol@uas1.nightservice.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-10" name="ref-10">10</a>] SIP UAC to SIP UAS1:

        ACK sip:uas1.nightservice.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:roses@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   The RTP flows begin and Carol answers "Hello, WeSellFlowers.  How may
   I help you?"




<span class="grey">Levy &amp; Mohali                   Historic                       [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Voicemail%20Service%20Using%20Diversion%20Header"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Voicemail Service Using Diversion Header</span>

   Bob has contracted his Voicemail to a third-party company,
   Voicemail.com.  In this message flow, Bob has hit the Do-Not-Disturb
   button on his phone.  The Do-Not-Disturb functionality of Bob's phone
   is configured to CFUNC (Call Forward Unconditional) to
   voicemail@isp.com.  Because the Diversion header is used,
   Voicemail.com is able to place the incoming call into Bob's voice
   mailbox.










































<span class="grey">Levy &amp; Mohali                   Historic                       [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


                 +---------------------------------------------+
                 | Bob@UAS1: CFDoNotDisturb-&gt;voicemail@isp.com |
                 +--------------------------------------+------+
                                                         \
                                                          \
UAC1               P1                P2            UAS1        UAS2
                                                          Voicemail.com
|                  |                  |              |          |
|--[<a href="#ref-1">1</a>] INV Bob@P1-&gt;|                  |              |          |
|                  |                  |              |          |
|                  |--[<a href="#ref-2">2</a>] INV Bob@P2-&gt;|              |          |
|                  |                  |              |          |
|                  |               [<a href="#ref-3">3</a>] INV Bob@uas1-&gt;|          |
|                  |                  |              |          |
|                  |                [<a href="#ref-4">4</a>] &lt;- 302-------|          |
|                  |               Contact: voicemail@isp.com   |
|                  |               Diversion: Bob@uas1          |
|                  |                 ;reason=do-not-disturb     |
|                  |                  |              |          |
|                  |                  |[<a href="#ref-5">5</a>] ACK------&gt;|          |
|                  |                  |              |          |
|                  |&lt;-[<a href="#ref-6">6</a>] 302---------|              |          |
|                  |  Contact: voicemail@isp.com     |          |
|                  |  Diversion: Bob@uas1            |          |
|                  |    ;reason=do-not-disturb       |          |
|                  |                  |              |          |
|                  |--[<a href="#ref-7">7</a>] ACK--------&gt;|              |          |
|&lt;-[<a href="#ref-8">8</a>] 302---------|                  |              |          |
|  Contact: voicemail@isp.com         |              |          |
|  Diversion: Bob@uas1                |              |          |
|    ;reason=do-not-disturb           |              |          |
|                  |                  |              |          |
|--[<a href="#ref-9">9</a>] ACK--------&gt;|                  |              |          |
|                  |                  |              |          |
|--[<a href="#ref-10">10</a>] INVITE voicemail@isp.com-------------------------------&gt;|
|  Diversion: Bob@uas1                |              |          |
|    ;reason=do-not-disturb           |              |          |
|                  |                  |              |          |
|&lt;--[<a href="#ref-11">11</a>] 200----------------------------------------------------|
|                  |                  |              |          |
|---[<a href="#ref-12">12</a>] ACK---------------------------------------------------&gt;|
|                  |                  |              |          |
|                  |                  |              |          |








<span class="grey">Levy &amp; Mohali                   Historic                       [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   Alice calls Bob.

   [<a id="ref-1" name="ref-1">1</a>] SIP UAC to SIP proxy server 1:

        INVITE sip:Bob@p1.isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:Bob@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   The ISP's originating proxy routes the request to proxy 2 (P2).

   [<a id="ref-2" name="ref-2">2</a>] SIP proxy server 1 to SIP proxy server 2:

        INVITE sip:Bob@p2.isp.com SIP/2.0
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:Bob@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   [<a id="ref-3" name="ref-3">3</a>] SIP proxy server 2 to UAS1 (Bob's SIP phone):

        INVITE sip:Bob@uas1.isp.com SIP/2.0
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:Bob@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp

   Since Bob had hit the Do-Not-Disturb button on his SIP phone, Bob's
   phone forwards the call to his voicemail service.












<span class="grey">Levy &amp; Mohali                   Historic                       [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-4" name="ref-4">4</a>] User agent server 1 (UAS1) to SIP proxy server 2 (P2)

        SIP/2.0 302 Moved Temporarily
        Via: SIP/2.0/UDP p2.isp.com
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: Voicemail@isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:Bob@uas1.isp.com&gt;
          ;reason=do-not-disturb

   [<a id="ref-5" name="ref-5">5</a>] SIP proxy server 2 to UAS1 (Bob's SIP phone):

        ACK sip:Bob@uas1.isp.com SIP/2.0
        Via: SIP/2.0/UDP p2.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   [<a id="ref-6" name="ref-6">6</a>] SIP proxy server 2 (P2) to SIP proxy server 1 (P1):

        SIP/2.0 302 Moved Temporarily
        Via: SIP/2.0/UDP p1.isp.com
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: Voicemail@isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:Bob@uas1.isp.com&gt;
          ;reason=do-not-disturb

   [<a id="ref-7" name="ref-7">7</a>] SIP proxy server 1 to SIP proxy server 2:

        ACK sip:Bob@p2.isp.com SIP/2.0
        Via: SIP/2.0/UDP p1.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE







<span class="grey">Levy &amp; Mohali                   Historic                       [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-8" name="ref-8">8</a>] SIP proxy server 1 (P1) to UAC (alice-pc):

        SIP/2.0 302 Moved Temporarily
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: Voicemail@isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:Bob@uas1.isp.com&gt;
          ;reason=do-not-disturb

   [<a id="ref-9" name="ref-9">9</a>] SIP UAC to SIP proxy server 1:

        ACK sip:Bob@p1.isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas1
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   [<a id="ref-10" name="ref-10">10</a>] SIP UAC (alice-pc) to Voicemail server.

        INVITE sip:Voicemail@isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: sip:Bob@p1.isp.com
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Diversion: &lt;sip:Bob@uas1.isp.com&gt;
          ;reason=do-not-disturb
        Content-Type: application/sdp

   [<a id="ref-11" name="ref-11">11</a>] Voicemail server to SIP UAC (alice-pc):

        SIP/2.0 200 OK
        Via: SIP/2.0/UDP alice-pc.isp.com
        Contact: Voicemail@isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas2
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE
        Content-Type: application/sdp








<span class="grey">Levy &amp; Mohali                   Historic                       [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   [<a id="ref-12" name="ref-12">12</a>] SIP UAC to Voicemail server:

        ACK sip:Voicemail@isp.com SIP/2.0
        Via: SIP/2.0/UDP alice-pc.isp.com
        From: sip:alice@isp.com
        To: &lt;sip:Bob@p1.isp.com&gt;;tag=uas2
        Call-ID: 12345600@alice-pc.isp.com
        CSeq: 1 INVITE

   Because the Diversion header is present, the Voicemail server is able
   to place Alice's message into Bob's voice mailbox.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Questions%20and%20Answers%20on%20Alternative%20Approaches"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Questions and Answers on Alternative Approaches</span>

   Question 1:

   Why do we need the Diversion header when we can see the To: header?

   Answer:

   a) The To: header is not guaranteed to have significance to the
      called party.

      For example, the To: header may contain a locally significant URL
      (to the caller) such as a private numbering plan, speed dial
      digits, telephony escape digits, or telephony prefix digits.

      Without a Diversion header, enumerating all possible locally
      significant To: headers that anyone might use to contact
      Bob@uas1.isp.com becomes a configuration problem at
      Voicemail@isp.com and is prone to namespace collision.

      Support for Diversion headers enables Bob to contract a third-
      party service (Voicemail@isp.com) with a single globally
      significant URL for his voice mailbox (Bob@uas1.isp.com).

   b) Given a set of multiple diversions, there is a policy decision of
      which Diversion header takes precedence for service logic.

      Different services (or even different users for the same service)
      may want to configure this policy differently (first, last, second
      to last, etc.).









<span class="grey">Levy &amp; Mohali                   Historic                       [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   Question 2:

   Why do we need the Diversion header when we can see the Via: header?

   Answer:

   The Via header does not contain information about servers whom have
   deflected the call (using a 3xx).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Mapping%20ISUP%2FISDN%20Redirection%20Information%20to%20SIP%20Diversion%20Header"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Mapping ISUP/ISDN Redirection Information to SIP Diversion Header</span>

   The discussions below regarding ISUP/ISDN reflect generic elements in
   ISUP/ISDN.  In some variations of ISUP/ISDN, the information elements
   are represented differently.  Regardless of the ISUP/ISDN variant,
   translation should be performed for the "first redirecting number"
   and the "last redirecting number".

   In order to prevent ambiguity, it is important to highlight a
   terminology mismatch between ISUP/ISDN and SIP.  In SIP, a "redirect"
   indicates the act of returning a 3xx response.  In ISUP/ISDN, a
   "redirection" is diversion of a call by a network entity.  In
   ISUP/ISDN, a call may also be deflected (by an endpoint).  Diversion
   is the more generic term that refers to either the act of an network
   redirection or endpoint deflection.

   In SIP, Diversion can be implemented as either an upstream 3xx (non-
   recursive) or an additionally forked downstream request (recursive).
   In the following text, a lowercase "redirect" indicates the SIP
   usage, while an uppercase "Redirect" indicates ISUP usage.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Mapping%20ISUP%2FISDN%20Diversion%20Reason%20Codes"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Mapping ISUP/ISDN Diversion Reason Codes</span>

   ISUP and ISDN define the following diversion reasons:

      0000 = Unknown
      0001 = Call forwarding busy or called DTE busy
      0010 = Call forwarding no reply
      1111 = Call forwarding unconditional or systematic
             call redirection
      1010 = Call deflection or call forwarding by the called DTE
      1001 = Call forwarding DTE out of order










<span class="grey">Levy &amp; Mohali                   Historic                       [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


      Mapping of ISUP/ISDN reason codes to Diversion reason codes is
      performed as follows:

      ISUP/ISDN reason code       Diversion reason code
      0001                        "user-busy"
      0010                        "no-answer"
      1111                        "unconditional"
      1010                        "deflection"
      1001                        "unavailable"
      0000                        all others

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Mapping%20ISUP%20Redirection%20Information%20to%20SIP%20Diversion%20Header"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Mapping ISUP Redirection Information to SIP Diversion Header</span>

   This section describes how generic ISUP diversion information
   elements may be translated across an ISUP/SIP gateway.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.1.%20%20ISUP%20Definitions"></a><a class="selflink" href="#section-9.2.1" name="section-9.2.1">9.2.1</a>.  ISUP Definitions</span>

   Called Party Number          The number of the party to which the
                                call is currently being routed.

   Redirecting Number           The number to which the call was being
                                routed when the last diversion occurred.

   Redirecting Reason           The reason that the last diversion
                                occurred.

   Original Called Number       The number to which the call was being
                                routed when the first diversion
                                occurred.

   Original Redirecting Reason  The reason that the first diversion
                                occurred.

   Redirection Counter          The count of the total number of
                                diversions that have occurred.

   Address Presentation         Indication of whether presentation is
                                allowed or restricted.












<span class="grey">Levy &amp; Mohali                   Historic                       [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.2.%20%20ISUP%20Parameters"></a><a class="selflink" href="#section-9.2.2" name="section-9.2.2">9.2.2</a>.  ISUP Parameters</span>

   When a SIP call transits a SIP/ISUP gateway, the following
   information in the ISUP message should be examined/set when
   translating SIP Diversion headers to ISUP diversion information:

      1) Redirecting Number

      2) Redirecting Reason

      3) Redirecting Address Presentation

      4) Original Called Number

      5) Original Redirecting Reason

      6) Original Address Presentation

      7) Redirection Counter

   An ISUP message contains information on the first and last diversions
   that occurred.  The Redirection number is the number to which the
   call was being routed when the last diversion occurred.  The
   Redirecting Reason is the reason that the last diversion occurred.

   The Original Called Number is the number to which the call was being
   routed when the first diversion occurred.  The Original Redirecting
   Reason is the reason that the first diversion occurred.

   When only one Diversion has occurred, the number to which the call
   was being routed when the diversion occurred is in the Redirecting
   Number and the reason for that diversion is carried in the Redirect
   Reason.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.3.%20%20ISUP%20to%20SIP%20Translation"></a><a class="selflink" href="#section-9.2.3" name="section-9.2.3">9.2.3</a>.  ISUP to SIP Translation</span>

   The ISUP Redirecting Number SHOULD be used to set the value of the
   name-addr of the top-most Diversion header.  The ISUP Redirecting
   Number address presentation SHOULD be used to set the value of the
   diversion-privacy of the top-most Diversion header.  The ISUP
   Redirecting Reason SHOULD be used to set the value of the diversion-
   reason of the top-most Diversion header.  When present, the Original
   Called Number SHOULD be used to set the name-addr of the bottom-most
   Diversion header.  When present, the Original Redirecting Reason
   SHOULD be used to set the diversion-reason of the bottom-most
   Diversion header.  When present, the Original Address Presentation
   SHOULD be used to set the diversion-privacy of the bottom-most
   Diversion header.



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   The Redirection Counter value minus 1 SHOULD be stored in the
   diversion- counter associated with the top-most Diversion header.
   Presence of the diversion-counter for the bottom-most Diversion
   header is optional.  If present, the diversion-counter of the bottom-
   most Diversion header SHOULD be 1.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.4.%20%20SIP%20to%20ISUP%20Translation"></a><a class="selflink" href="#section-9.2.4" name="section-9.2.4">9.2.4</a>.  SIP to ISUP Translation</span>

   The name-addr of the top-most Diversion header SHOULD be used to set
   the ISUP Redirecting Number.  The diversion-reason of the top-most
   Diversion header SHOULD be used to set the ISUP Redirecting Reason.
   The diversion-privacy of the top-most Diversion header SHOULD be used
   to set the ISUP Redirecting Address Presentation.

   When multiple Diversion headers are present, the name-addr of the
   bottom- most Diversion header SHOULD be used to set the ISUP Original
   Redirecting Number.  When multiple Diversion headers are present, the
   diversion-reason of the bottom-most Diversion header SHOULD be used
   to set the ISUP Original Redirecting Reason.  When multiple Diversion
   headers are present, the diversion-privacy of the bottom-most
   Diversion header SHOULD be used to set the ISUP Original Redirecting
   Address Presentation.

   The ISUP Redirection Counter SHOULD be set equal to the sum of the
   counters of all Diversion headers in the SIP message.  A Diversion
   header that does not explicitly specify a diversion-counter tag
   counts as 1.
























<span class="grey">Levy &amp; Mohali                   Historic                       [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.5.%20%20Example%20of%20ISUP%20to%20SIP%20Translation"></a><a class="selflink" href="#section-9.2.5" name="section-9.2.5">9.2.5</a>.  Example of ISUP to SIP Translation</span>

                                   ISUP/SIP GW
                                       |
--IAM---------------------------------&gt;|
  Called Party Number    =+19195551004 |
  Redirecting Number     =+19195551002 |
    Address Presentation =presentation restricted
  Original Called Number =+19195551001 |
  RedirectionInformation:              |
    Original Redirecting Reason = Unconditional (1111)
    Redirecting Reason = User busy (0001)
    Redirection Counter = 5            |
                                       |
                                       |--INVITE +19195551004------&gt;
                                       |  Diversion: &lt;tel:+19195551002&gt;
                                       |    ;reason=user-busy
                                       |    ;privacy="full"
                                       |    ;counter=4
                                       |  Diversion: &lt;tel:+19195551001&gt;
                                       |    ;reason=unconditional
                                       |    ;counter=1
                                       |
                                       |



























<span class="grey">Levy &amp; Mohali                   Historic                       [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.2.6.%20%20Example%20of%20SIP%20to%20ISUP%20Translation"></a><a class="selflink" href="#section-9.2.6" name="section-9.2.6">9.2.6</a>.  Example of SIP to ISUP Translation</span>

                                   ISUP/SIP GW
                                       |
                                       |&lt;--INVITE +19195551004------
                                       |  Diversion: &lt;tel:+19195551002&gt;
                                       |    ;reason=user-busy
                                       |    ;privacy="full"
                                       |    ;counter=4
                                       |  Diversion: &lt;tel:+19195551001&gt;
                                       |    ;reason=unconditional
                                       |    ;counter=1
                                       |
                                       |
                                       |
&lt;--IAM---------------------------------|
  Called Party Number    =+19195551004 |
  Redirecting Number     =+19195551002 |
    Address Presentation =presentation restricted
  Original Called Number =+19195551001 |
  RedirectionInformation:              |
    Original Redirecting Reason = Unconditional (1111)
    Redirecting Reason = User busy (0001)
    Redirection Counter = 5            |

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Mapping%20ISDN%20Redirection%20Information%20to%20SIP%20Diversion%20Header"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Mapping ISDN Redirection Information to SIP Diversion Header</span>

   An ISDN message can contain up to two instances of a Redirecting
   Number information element.  When a diversion occurs, an additional
   Redirection number information element is added.  When a third (or
   greater) diversion occurs, the new Redirecting Number information
   element replaces the bottom-most Redirection number information
   element.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.1.%20%20ISDN%20Definitions"></a><a class="selflink" href="#section-9.3.1" name="section-9.3.1">9.3.1</a>.  ISDN Definitions</span>

   Called Party Number          The number of the party to which the
                                call is currently being routed.

   Redirecting Number
   information element          Aggregate information element that
                                contains Redirecting number and Reason
                                for diversion.








<span class="grey">Levy &amp; Mohali                   Historic                       [Page 47]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   Redirecting Number           The number to which the call was being
                                routed when the last diversion occurred.

   Reason for Diversion         The reason that the last diversion
                                occurred.

   Origin of Number             Indicates whether the number is user
                                provided and screened or network
                                provided.

   Presentation Status          Indicates if presentation is allowed or
                                prohibited.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.2.%20%20ISDN%20Parameters"></a><a class="selflink" href="#section-9.3.2" name="section-9.3.2">9.3.2</a>.  ISDN Parameters</span>

   When a SIP call transits a SIP/ISDN gateway, the following
   information in the ISDN message should be examined/set when
   translating SIP Diversion headers to ISDN diversion information:

      1) Redirecting Number of the top-most Redirecting Number
         information element

      2) Reason for diversion of the top-most Redirection number
         information element

      3) Origin of Number and Presentation Status of the top-most
         Redirection number information element

      4) Redirection number of the bottom-most Redirection number
         information element

      5) Reason for diversion of the bottom-most Redirection number
         information element

      6) Origin of Number and Presentation Status of the bottom-most
         Redirection number information element

   An ISDN message contains information on the first and last diversions
   that occurred.  The top-most Redirection number information element
   contains information (including the Redirecting Number, Origin of
   Number, Presentation Status, and Reason for diversion) about the last
   diversion that occurred.  The bottom-most Redirection number
   information element contains information (including the Redirecting
   Number, Origin of Number, Presentation Status, and Reason for
   diversion) about the first diversion that occurred.

   If only one Diversion has occurred, only one Redirection number
   information element is present.



<span class="grey">Levy &amp; Mohali                   Historic                       [Page 48]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-49" id="page-49" name="page-49"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


   The Redirecting Number information element has the same Type of
   Number/Numbering Plan, and Digits as the Calling Party Number
   information element.

   There is no Redirection Counter associated with this ISDN information
   element.

   Notice that the order of the Redirection number information elements
   in an ISDN message (top=first, bottom=last) is reversed from the
   order of Diversion headers in a SIP message (top=last, bottom=first).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.3.%20%20ISDN%20to%20SIP%20Translation"></a><a class="selflink" href="#section-9.3.3" name="section-9.3.3">9.3.3</a>.  ISDN to SIP Translation</span>

   The Redirecting Number of the top-most ISDN Redirecting Number
   information element SHOULD be used to set the value of the name-addr
   of the bottom-most Diversion header.  The Reason for Diversion of the
   top-most ISDN Redirecting Number information element SHOULD be used
   to set the value of the diversion-reason of the bottom-most Diversion
   header.

   The Origin of Number of the top-most ISDN Redirecting Number
   information element SHOULD be used to set the value of the diversion-
   screen of the bottom-most Diversion header.  The Presentation Status
   of the top-most ISDN Redirecting Number information element SHOULD be
   used to set the value of the diversion-privacy of the bottom-most
   Diversion header.

   The Redirecting Number of the bottom-most ISDN Redirecting Number
   information element SHOULD be used to set the value of the name-addr
   of the top-most Diversion header.  The Reason for Diversion of the
   bottom-most ISDN Redirecting Number information element SHOULD be
   used to set the value of the diversion-reason of the top-most
   Diversion header.

   The Origin of Number of the bottom-most ISDN Redirecting Number
   information element SHOULD be used to set the value of the diversion-
   screen of the top-most Diversion header.  The Presentation Status of
   the bottom-most ISDN Redirecting Number information element SHOULD be
   used to set the value of the diversion-privacy of the top-most
   Diversion header.

   Presence of the diversion-counter in each of the Diversion headers is
   optional.  If present, the diversion-counter of each Diversion header
   SHOULD be 1.







<span class="grey">Levy &amp; Mohali                   Historic                       [Page 49]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-50" id="page-50" name="page-50"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.4.%20%20SIP%20to%20ISDN%20Translation"></a><a class="selflink" href="#section-9.3.4" name="section-9.3.4">9.3.4</a>.  SIP to ISDN Translation</span>

   The name-addr of the top-most Diversion header SHOULD be used to set
   the Redirecting Number of the bottom-most ISDN Redirecting Number
   information element.

   The diversion-reason of the top-most Diversion header SHOULD be used
   to set the Reason for Diversion of the bottom-most ISDN Redirecting
   Number information element.

   The diversion-screen of the top-most Diversion header SHOULD be used
   to set the Origin of Number of the bottom-most ISDN Redirecting
   Number information element.

   The diversion-privacy of the top-most Diversion header SHOULD be used
   to set the Presentation Status of the bottom-most ISDN Redirecting
   Number information element.

   The name-addr of the bottom-most Diversion header SHOULD be used to
   set the Redirecting Number of the top-most ISDN Redirecting Number
   information element.

   The diversion-reason of the bottom-most Diversion header SHOULD be
   used to set the Reason for Diversion of the top-most ISDN Redirecting
   Number information element.

   The diversion-screen of the bottom-most Diversion header SHOULD be
   used to set the Origin of Number of the top-most ISDN Redirecting
   Number information element.

   The diversion-privacy of the bottom-most Diversion header SHOULD be
   used to set the Presentation Status of the top-most ISDN Redirecting
   Number information element.


















<span class="grey">Levy &amp; Mohali                   Historic                       [Page 50]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-51" id="page-51" name="page-51"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.5.%20%20Example%20of%20ISDN%20to%20SIP%20Translation"></a><a class="selflink" href="#section-9.3.5" name="section-9.3.5">9.3.5</a>.  Example of ISDN to SIP Translation</span>

                        ISDN/SIP GW
                                       |
--Setup-------------------------------&gt;|
  Called party number      =+19195551004
  Redirecting Number information element:
    Redirecting Number     =+19195551001
    Reason for redirection = Unconditional (1111)
    Origin of Number       = passed network screening
    Presentation Status    = presentation allowed
  Redirecting Number information element:
    Redirecting Number     =+19195551002
    Reason for redirection = User busy (0001)
    Origin of Number       = passed network screening
    Presentation Status    = presentation prohibited
                                       |
                                       |--INVITE tel:+19195551004----&gt;
                                       |  Diversion: &lt;tel:+19195551002&gt;
                                       |    ;reason=user-busy
                                       |    ;screen="yes"
                                       |    ;privacy="off"
                                       |  Diversion: &lt;tel:+19195551001&gt;
                                       |    ;reason=unconditional
                                       |    ;screen="yes"
                                       |    ;privacy="full"
                                       |
                                       |























<span class="grey">Levy &amp; Mohali                   Historic                       [Page 51]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-52" id="page-52" name="page-52"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.3.6.%20%20Example%20of%20SIP%20to%20ISDN%20Translation"></a><a class="selflink" href="#section-9.3.6" name="section-9.3.6">9.3.6</a>.  Example of SIP to ISDN Translation</span>

                                   ISDN/SIP GW
                                       |
&lt;--Setup-------------------------------|
  Called party number      =+19195551004
  Redirecting Number information element:
    Redirecting Number     =+19195551001
    Reason for redirection = Unconditional (1111)
    Origin of Number       = passed network screening
    Presentation Status    = presentation allowed
  Redirecting Number information element:
    Redirecting Number     =+19195551002
    Reason for redirection = User busy (0001)
    Origin of Number       = passed network screening
    Presentation Status    = presentation prohibited
                                       |
                                       |&lt;--INVITE tel:+19195551004----
                                       |  Diversion: &lt;tel:+19195551002&gt;
                                       |    ;reason=user-busy
                                       |    ;screen="yes"
                                       |    ;privacy="off
                                       |  Diversion: &lt;tel:+19195551001&gt;
                                       |    ;reason=unconditional
                                       |    ;screen="yes"
                                       |    ;privacy="full"
                                       |

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Information%20Loss%20in%20SIP%20to%20ISUP%2FISDN%20Translation"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Information Loss in SIP to ISUP/ISDN Translation</span>

   Because ISUP and ISDN only support a subset of the information in a
   SIP Diversion header, information loss occurs during translation at a
   SIP/ISUP or SIP/ISDN boundary.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.4.1.%20%20Loss%20of%20Diversion%20URI%20Information"></a><a class="selflink" href="#section-9.4.1" name="section-9.4.1">9.4.1</a>.  Loss of Diversion URI Information</span>

   Because ISUP and ISDN only support a subset of URI types
   (specifically tel: URIs and sip:x@y;user=phone URIs), diversion
   information occurring for other URI types may be lost when crossing
   from SIP to ISDN or ISUP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.4.2.%20%20Loss%20of%20Diversion%20Reason%20Information"></a><a class="selflink" href="#section-9.4.2" name="section-9.4.2">9.4.2</a>.  Loss of Diversion Reason Information</span>

   Because ISUP and ISDN only support a subset of the reason codes
   supported by the Diversion header, specific reason code information
   may be lost when crossing from SIP to ISDN or ISUP.





<span class="grey">Levy &amp; Mohali                   Historic                       [Page 52]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-53" id="page-53" name="page-53"> </a>
<span class="grey"><a href="rfc5806.html">RFC 5806</a>               Diversion Indication in SIP            March 2010</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/9.4.3.%20%20Loss%20of%20Diversion%20Counter%20Information"></a><a class="selflink" href="#section-9.4.3" name="section-9.4.3">9.4.3</a>.  Loss of Diversion Counter Information</span>

   Because ISDN does not support a counter field (indicating the number
   of diversions that have occurred), counter information may be lost
   when crossing from SIP to ISDN.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Contributors"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Contributors</span>

   Special acknowledgement to both Bryan Byerly and JR Yang.  As
   original authors of this document, both were instrumental is getting
   this document written.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Acknowledgements"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Acknowledgements</span>

   We would like to thank David Williams, Ameet Kher, Satya Khatter,
   Manoj Bhatia, Shail Bhatnagar, Denise Caballero-Mccann, Kara Adams,
   Charles Eckel of Cisco Systems, and Bert Culpepper of InterVoice-
   Brite for their insights, inputs, and comments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Normative%20References"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

Authors' Addresses

   Steve Levy
   Cisco Systems
   7025 Kit Creek Road P.O. Box 14987 Research Triangle Park,
   NC  27709
   USA

   EMail: stlevy@cisco.com

   Marianne Mohali (editor)
   Orange Labs
   38-40 rue du General Leclerc
   Issy-Les-Moulineaux Cedex 9  92794
   France

   Phone: +33145294514
   EMail: marianne.mohali@orange-ftgroup.com




Levy &amp; Mohali                   Historic                       [Page 53]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5806 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:33 GMT --></html>