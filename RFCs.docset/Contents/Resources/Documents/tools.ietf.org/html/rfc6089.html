<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6089 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6089" name="DC.Identifier"/>
<meta content="This document introduces extensions to Mobile IPv6 that allow nodes to
bind one or more flows to a care-of address. These extensions allow
multihomed nodes to instruct home agents and other Mobile IPv6
entities to direct inbound flows to specific addresses. [STANDARDS-
TRACK]" name="DC.Description.Abstract"/>
<meta content="Soliman, Hesham" name="DC.Creator"/>
<meta content="Tsirtsis, George" name="DC.Creator"/>
<meta content="Giaretta, Gerardo" name="DC.Creator"/>
<meta content="Kuladinithi, Koojana" name="DC.Creator"/>
<meta content="Montavont, Nicolas" name="DC.Creator"/>
<meta content="January, 2011" name="DC.Date.Issued"/>
<meta content="Flow Bindings in Mobile IPv6 and Network Mobility (NEMO) Basic Support" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6089 - Flow Bindings in Mobile IPv6 and Network Mobility (NEMO) Basic Support</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6089.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6089" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mext-flow-binding" title="draft-ietf-mext-flow-binding">draft-ietf-mext...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6089" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6089" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6089" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                       G. Tsirtsis
Request for Comments: 6089                                      Qualcomm
Updates: <a href="rfc5648.html">5648</a>                                                 H. Soliman
Category: Standards Track                           Elevate Technologies
ISSN: 2070-1721                                             N. Montavont
                                                                   IT/TB
                                                             G. Giaretta
                                                                Qualcomm
                                                          K. Kuladinithi
                                                    University of Bremen
                                                            January 2011


 <span class="h1">Flow Bindings in Mobile IPv6 and Network Mobility (NEMO) Basic Support</span>

Abstract

   This document introduces extensions to Mobile IPv6 that allow nodes
   to bind one or more flows to a care-of address.  These extensions
   allow multihomed nodes to instruct home agents and other Mobile IPv6
   entities to direct inbound flows to specific addresses.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6089">http://www.rfc-editor.org/info/rfc6089</a>.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must




<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Requirements Notation  . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Mobile IPv6 Extensions . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     4.1.  Definition Update for Binding Identifier Mobility
           Option . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-4.2">4.2</a>.  Flow Identification Mobility Option  . . . . . . . . . . .  <a href="#page-5">5</a>
       <a href="#section-4.2.1">4.2.1</a>.  Flow Identification Sub-Options Definition . . . . . .  <a href="#page-7">7</a>
       <a href="#section-4.2.2">4.2.2</a>.  Flow Summary Mobility Option . . . . . . . . . . . . . <a href="#page-11">11</a>
     4.3.  Flow Bindings Entries List and Its Relationship to
           Binding Cache  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
   <a href="#section-5">5</a>.  Protocol Operations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
     <a href="#section-5.1">5.1</a>.  General  . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
       <a href="#section-5.1.1">5.1.1</a>.  Preferred Care-of Address  . . . . . . . . . . . . . . <a href="#page-15">15</a>
     <a href="#section-5.2">5.2</a>.  Mobile Node Considerations . . . . . . . . . . . . . . . . <a href="#page-15">15</a>
       <a href="#section-5.2.1">5.2.1</a>.  Sending BU with BID Options  . . . . . . . . . . . . . <a href="#page-15">15</a>
       5.2.2.  Sending BU with Flow Identification Mobility
               Options  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
       <a href="#section-5.2.3">5.2.3</a>.  Sending BU with a Flow Summary Option  . . . . . . . . <a href="#page-17">17</a>
       <a href="#section-5.2.4">5.2.4</a>.  Removing Flow Bindings . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
       <a href="#section-5.2.5">5.2.5</a>.  Returning Home . . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
       <a href="#section-5.2.6">5.2.6</a>.  Receiving Binding Acknowledgements . . . . . . . . . . <a href="#page-19">19</a>
       <a href="#section-5.2.7">5.2.7</a>.  Return Routability Procedure . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-5.3">5.3</a>.  HA, MAP, and CN Considerations . . . . . . . . . . . . . . <a href="#page-19">19</a>
       <a href="#section-5.3.1">5.3.1</a>.  Handling Binding Identifier Mobility Options . . . . . <a href="#page-20">20</a>
       <a href="#section-5.3.2">5.3.2</a>.  Handling Flow Identification Mobility Options  . . . . <a href="#page-20">20</a>
       <a href="#section-5.3.3">5.3.3</a>.  Handling Flow Summary Mobility Option  . . . . . . . . <a href="#page-23">23</a>
       <a href="#section-5.3.4">5.3.4</a>.  Flow Binding Removals  . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
       <a href="#section-5.3.5">5.3.5</a>.  Sending Binding Acknowledgements . . . . . . . . . . . <a href="#page-24">24</a>
       <a href="#section-5.3.6">5.3.6</a>.  Packet Processing  . . . . . . . . . . . . . . . . . . <a href="#page-24">24</a>
   <a href="#section-6">6</a>.  MTU Considerations . . . . . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-7">7</a>.  Security considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
   <a href="#section-8">8</a>.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
   <a href="#section-9">9</a>.  Contributors . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-28">28</a>
   <a href="#section-10">10</a>. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
   <a href="#section-11">11</a>. References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
     <a href="#section-11.1">11.1</a>. Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
     <a href="#section-11.2">11.2</a>. Informative References . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>







<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Mobile IPv6 [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>], Dual-Stack MIPv6 (DSMIPv6) [<a href="rfc5555.html" title='"Mobile IPv6 Support for Dual Stack Hosts and Routers"'>RFC5555</a>], and
   Network Mobility (NEMO) Basic Support [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>] allow a mobile node /
   mobile router to manage its mobility using the binding update
   message, which binds one care-of address to one home address and
   associated mobile networks.  The binding update message can be sent
   to the home agent.  In Mobile IPv6, the binding update can also be
   sent to a correspondent node or to a mobility anchor point (see
   [<a href="rfc5380.html" title='"Hierarchical Mobile IPv6 (HMIPv6) Mobility Management"'>RFC5380</a>]).  The semantics of the binding update are limited to
   care-of address changes.  That is, [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>], [<a href="rfc5555.html" title='"Mobile IPv6 Support for Dual Stack Hosts and Routers"'>RFC5555</a>], and
   [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>] do not allow a mobile node / mobile router to bind more
   than one address to the home address.  In [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], Mobile IPv6 and
   NEMO Basic Support are extended to allow the binding of more than one
   care-of address to a home address.  This specification further
   extends Mobile IPv6, DSMIPv6, and NEMO Basic Support to allow them to
   specify policies associated with each binding.  A policy can contain
   a request for special treatment of a particular IPv4 or IPv6 flow,
   which is viewed as a group of packets matching a traffic selector.
   Hence, this specification allows a mobile node / mobile router to
   bind a particular flow to a care-of address without affecting other
   flows using the same home address.  In addition, this specification
   allows to bind a particular flow to a particular care-of address
   directly with correspondent node and mobility agents (i.e., home
   agents [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] and mobility anchor points [<a href="rfc5380.html" title='"Hierarchical Mobile IPv6 (HMIPv6) Mobility Management"'>RFC5380</a>]).

   In this document, a flow is defined as a set of IP packets matching a
   traffic selector.  A traffic selector can identify the source and
   destination IP addresses, transport protocol number, the source and
   destination port numbers and other fields in IP and higher-layer
   headers.  This specification does not define traffic selectors, which
   are going to be defined in other specifications.  This specification,
   however, does define the traffic selector sub-option format to be
   used for any specific traffic selector.

   Using the flow identifier option introduced in this specification, a
   mobile node / mobile router can bind one or more flows to a care-of
   address while maintaining the reception of other flows on another
   care-of address.  The mobile node / mobile router assembles the flow
   binding requests based on local policies, link characteristics, and
   the types of applications running at the time.  Such policies are
   outside the scope of this document.

   It should be noted that the flow identification mobility option can
   be associated with any binding update, whether it is sent to a
   mobility agent or a correspondent node.





<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   Note that per-packet load balancing may have negative impacts on TCP
   congestion avoidance mechanisms as it is desirable to maintain order
   between packets belonging to the same TCP connection.  This behavior
   is specified in [<a href="rfc2702.html" title='"Requirements for Traffic Engineering Over MPLS"'>RFC2702</a>].  Other negative impacts are also foreseen
   for other types of real-time connections due to the potential
   variations in round-trip time between packets.  Moreover, per-packet
   load-balancing will negatively affect traffic with anti-replay
   protection mechanisms.  Hence, per-packet load balancing is not
   envisioned in this specification.

   In the rest of the document, the term "mobile node" is used to
   designate either a mobile node as defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] and [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>],
   or a mobile router as defined in [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>] unless stated otherwise.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Requirements%20Notation"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Requirements Notation</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Terminology"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Terminology</span>

   Terms used in this document are defined in [<a href="rfc3753.html" title='"Mobility Related Terminology"'>RFC3753</a>] and [<a href="rfc4885.html" title='"Network Mobility Support Terminology"'>RFC4885</a>].
   The following terms are also used in this document:

      Flow: A flow is a sequence of packets for which the mobile node
      (MN) desires special handling either by the home agent (HA), the
      corresponding node (CN) or the mobility anchor point (MAP).

      Traffic Selector: One or more parameters that can be matched
      against fields in the packet's headers for the purpose of
      classifying a packet.  Examples of such parameters include the
      source and destination IP addresses, transport protocol number,
      the source and destination port numbers, and other fields in IP
      and higher-layer headers.

      Flow binding: It consists of a traffic selector, and one or more
      binding identifiers (BIDs).  IP packets from one or more flows
      that match the traffic selector associated with the flow binding
      are forwarded to the BIDs associated with the same flow binding.

      Flow Identifier: A flow identifier uniquely identifies a flow
      binding associated with a mobile node.  It is generated by a
      mobile node and is cached in the table of flow binding entries
      maintained by the MN, HA, CN, or MAP.






<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Mobile%20IPv6%20Extensions"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Mobile IPv6 Extensions</span>

   This section introduces extensions to Mobile IPv6 that are necessary
   for supporting the flow binding mechanism described in this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Definition%20Update%20for%20Binding%20Identifier%20Mobility%20Option"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Definition Update for Binding Identifier Mobility Option</span>

   This specification updates the definition of the Binding Identifier
   Mobility option defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], as follows:

                            1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                       |   Type = 35   |     Length    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |       Binding ID (BID)        |     Status    |H|   BID-PRI   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-------------------------------+
       +                                                               +
       :                 IPv4 or IPv6 Care-of Address (CoA)            :
       +                                                               +
       +---------------------------------------------------------------+



             Figure 1: The Binding Identifier Mobility Option

      BID-PRI

         This is a 7-bit unsigned integer placing each BID to a relative
         priority (PRI) with other registered BIDs.  Value '0' is
         reserved and MUST NOT be used.  A lower number in this field
         indicates a higher priority, while BIDs with the same BID-PRI
         value have equal priority meaning that, the BID used is an
         implementation issue.  This is consistent with current practice
         in packet classifiers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Flow%20Identification%20Mobility%20Option"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Flow Identification Mobility Option</span>

   The flow identification mobility option is a new mobility option
   [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>], and it is included in the binding update and
   acknowledgement messages.  This option contains information that
   allows the receiver of a binding update to install policies on a
   traffic flow and route it to a given care-of address.  Multiple
   options may exist within the same binding update message.  The
   alignment requirement for this option is 2n.






<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Option Type   |  Option Len   |              FID              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |              FID-PRI          |   Reserved    |     Status    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   Sub-options (optional) ...
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

             Figure 2: The Flow Identification Mobility Option

      Option Type

         45

      Option Len

         Length of the option in octets as per [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>].

      FID

         The Flow Identifier field is a 16-bit unsigned integer that
         includes the unique identifier for the flow binding.  This
         field is used to refer to an existing flow binding or to create
         a new flow binding.  The value of this field is set by the
         mobile node.  FID = 0 is reserved and MUST NOT be used.

      FID-PRI

         This is a 16-bit unsigned integer priority field to indicate
         the priority of a particular option.  This field is needed in
         cases where two different flow descriptions in two different
         options overlap.  The priority field decides which policy
         should be executed in those cases.  A lower number in this
         field indicates a higher priority.  Value '0' is reserved and
         MUST NOT be used.  FID-PRI MUST be unique to each of the flows
         pertaining to a given MN.  In other words, two FIDs MUST NOT be
         associated with the same FID-PRI value.

      Status

         This 8-bit unsigned integer field indicates the success or
         failure of the flow binding operation for the particular flow
         in the option.  This field is not relevant to the binding
         update message as a whole or to other flow identification
         options.  This field is only relevant when included in the
         Binding Acknowledgement message and must be ignored in the



<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


         binding update message.  The following values are reserved for
         the Status field within the flow identification mobility
         option:

            0 Flow binding successful

            128 Administratively prohibited

            129 Flow binding rejected, reason unspecified

            130 Flow identification mobility option malformed

            131 BID not found

            132 FID not found

            133 Traffic selector format not supported

      Sub-options (optional)

         Zero or more sub-options, defined in <a href="#section-4.2.1">Section 4.2.1</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Flow%20Identification%20Sub-Options%20Definition"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Flow Identification Sub-Options Definition</span>

   Flow identification sub-options are encoded within the remaining
   space of the flow identification mobility option, using a sub-option
   type-length-value (TLV) format as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Sub-Opt Type  |Sub-Opt Length |   Sub-Option Data...
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

              Figure 3: Flow Identification Sub-Option Format

      Sub-Opt Type

         8-bit unsigned integer indicating the sub-option Type.  When
         processing a flow identification mobility option containing an
         option for which the sub-option Type value is not recognized by
         the receiver, the receiver MUST silently ignore and skip over
         the sub-option, correctly handling any remaining sub-options in
         the same option.







<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


      Sub-Opt Len

         8-bit unsigned integer, representing the length in octets of
         the flow identification sub-option.  This field indicates the
         length of the sub-option not including the Sub-Opt Type and
         Sub-Opt Length fields.  Note that Sub-Opt Type '0'
         (<a href="#section-4.2.1.1">Section 4.2.1.1</a>) is a special case that does not take a Sub-
         Opt Length field.

      Sub-Option Data

         A variable length field that contains data specific to the sub-
         option.

   The following subsections specify the sub-option Types that are
   currently defined for use in the flow identification option.
   Implementations MUST silently ignore any sub-options that they do not
   understand.

   These sub-options may have alignment requirements.  Following the
   convention in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>], regarding mobility options, these sub-
   options are aligned in a packet so that multi-octet values within the
   sub-option Data field of each sub-option fall on natural boundaries
   (i.e., fields of width n octets are placed at an integer multiple of
   n octets from the start of the header, for n = 1, 2, 4, or 8).

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.1.%20%20Pad1"></a><a class="selflink" href="#section-4.2.1.1" name="section-4.2.1.1">4.2.1.1</a>.  Pad1</span>

   The Pad1 sub-option does not have any alignment requirements.  Its
   format is as follows:

          0
          0 1 2 3 4 5 6 7
         +-+-+-+-+-+-+-+-+
         | Sub-Opt Type  |
         +-+-+-+-+-+-+-+-+

   Sub-Opt Type

      0

   NOTE: The format of the Pad1 sub-option is a special case -- it has
   neither sub-option Length nor sub-option Data fields.

   The Pad1 sub-option is used to insert one octet of padding in the
   flow identification option.  If more than one octet of padding is
   required, the PadN sub-option, described next, should be used rather
   than multiple Pad1 sub-options.



<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.2.%20%20PadN"></a><a class="selflink" href="#section-4.2.1.2" name="section-4.2.1.2">4.2.1.2</a>.  PadN</span>

   The PadN sub-option does not have any alignment requirements.  Its
   format is as follows:

          0                   1
          0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - - -
         | Sub-Opt Type  | Sub-Opt Len   | Option Data
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - - -

   Sub-Opt Type

      1

   Sub-Opt Len

      Set to the length of the sub-option.

   Sub-Opt Data

      0 or more bytes set to 0 by the sender and ignored by the
      receiver.

   The PadN sub-option is used to insert two or more octets of padding
   in the flow identification mobility option.  For N octets of padding,
   the sub-option Length field contains the value N, and the sub-option
   Data field consists of N-2 zero-valued octets.  PadN sub-option Data
   MUST be ignored by the receiver.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.3.%20%20Binding%20Reference%20Sub-Option"></a><a class="selflink" href="#section-4.2.1.3" name="section-4.2.1.3">4.2.1.3</a>.  Binding Reference Sub-Option</span>

   This section introduces the binding reference sub-option, included in
   the flow identification mobility option.  A node MUST NOT include
   more than one binding reference sub-options in a given flow binding
   identification option.  The binding reference sub-option includes one
   or more BIDs defined in Multiple Care-of Addresses (MCoA) [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].
   This sub-option associates the flow described in a flow
   identification mobility option with one or more registered BIDs.

   When binding a flow using this sub-option, the binding identifier
   mobility option, defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], MUST be included in either the
   same or an earlier binding update (BU).  The binding reference sub-
   option is shown below.  The alignment requirement for this sub-option
   is 2n.






<span class="grey">Tsirtsis, et al.             Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Sub-Opt Type   |  Sub-Opt Len  |              BID              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     BID  ........
       +-+-+-+-+-+-+-+-+-+-

                Figure 4: The Binding Reference Sub-Option

      Sub-Opt Type

         2

      Sub-Opt Len

         Variable

      BID

         A 16-bit unsigned integer indicating the BID that the mobile
         node wants to associate with the flow identification option.
         One or more BID fields can be included in this sub-option.
         Since each BID is 2 bytes long, the value of the Sub-opt Len
         field indicates the number of BIDs present.  Number of BIDs =
         Sub-Opt Len/2.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.4.%20%20Traffic%20Selector%20Sub-Option"></a><a class="selflink" href="#section-4.2.1.4" name="section-4.2.1.4">4.2.1.4</a>.  Traffic Selector Sub-Option</span>

   The traffic selector sub-option includes the parameters used to match
   packets for a specific flow binding.  A node MUST NOT include more
   than one traffic selector sub-option in a given flow binding
   identification option.

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Sub-Opt Type   |  Sub-Opt Len  |   TS Format   |   Reserved    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Traffic Selector ...
       +-+-+-+-+-+-+-+-+-+-+-+


                 Figure 5: The Traffic Selector Sub-Option

   Sub-Opt Type

      3



<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   Sub-Opt Len

      Variable

   TS Format

      An 8-bit unsigned integer indicating the Traffic Selector Format.
      Value "0" is reserved and MUST NOT be used.

   Reserved

      An 8-bit reserved field.  It MUST be set to zero by the sender and
      ignored by the receiver.

   Traffic Selector

      A variable-length field, the format and content of which is out of
      scope for this specification.  The traffic selector defined in
      [<a href="rfc6088.html" title='"Traffic Selectors for Flow Bindings"'>RFC6088</a>] is mandatory to implement.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20Flow%20Summary%20Mobility%20Option"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  Flow Summary Mobility Option</span>

   The flow summary mobility option is a new mobility option [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>],
   which includes one or more flow identifiers (FIDs) for the purpose of
   refreshing their state.  The alignment requirement for this option is
   2n.

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Option Type   |  Option Len   |              FID              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |     FID  ........
       +-+-+-+-+-+-+-+-+-+-

                Figure 6: The Flow Summary Mobility Option

      Option Type

         44

      Option Length

         Length of the option in octets as per [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>].







<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


      FID

         A 16-bit unsigned integer indicating a registered FID.  One or
         more FID fields can be included in this option.  Number of FIDs
         = Option Len/2.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Flow%20Bindings%20Entries%20List%20and%20Its%20Relationship%20to%20Binding%20Cache"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Flow Bindings Entries List and Its Relationship to Binding Cache</span>

   The conceptual Mobile IPv6 binding cache was defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] to
   identify the mobile IP state maintained by the mobile node, mobility
   agent, and correspondent node.  The binding cache includes, among
   others, the mobile node's home address, the registered care-of
   address, and the lifetime of the binding.  The binding cache has been
   extended by [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>] to include more than one care-of addresses and
   to associate each of them with a binding identifier (BID).

   This specification does not modify the Mobile IPv6 binding cache any
   further.

   Flow bindings can be thought of as a conceptual list of entries that
   is separate from the binding cache.  The flow bindings list contains
   an entry for each of the registered flow bindings.  Flow binding
   entries point to an entry in the binding cache by means of the BID.
   Each flow binding entry includes the following parameters:

   o  FID (Flow Identifier): For a given mobile node, identified by its
      primary home address, the FID MUST uniquely identify an entry,
      i.e., a unique flow binding.  Each mobile node can only have a
      single entry identified by a given FID at any one time.  A given
      FID number space is used for all the addresses associated to a
      given MN by the HA (e.g., via [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>]).  Different mobile nodes
      use the same FID number space.

   o  A Traffic Selector: Included in a traffic selector sub-option.

   o  BID(s): The list of BIDs associated with the entry as defined by
      the binding reference sub-option included in the FID option that
      created it.

   o  Active/Inactive flag: This flag indicates whether the entry is
      active or inactive.

   o  FID-PRI: This field indicates the priority of the flow binding and
      is used to break the tie between overlapping flow bindings.







<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   The flow bindings list is associated with a given mobile node, and
   the correspondent binding cache.  An entry in the flow bindings list,
   however, is identified by the FID and the list is ordered according
   to the FID-PRI field as defined in the FID option that created each
   entry.

   A valid BID is required to make the entry 'Active'.  If all of the
   BIDs pointed to by a given entry are deregistered [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], the flow
   binding entry becomes 'Inactive', in other words it does not affect
   data traffic.  Note that an entry becomes 'Inactive' only if all of
   the BIDs are deregistered.  If only some of the BIDs are still valid,
   the invalid BIDs are simply ignored.

   Also, note that the state described in this section is maintained by
   the mobile node as well as in mobility agents and correspondent
   nodes.  As such, the mobile node is fully aware of which BIDs are
   valid at any time and which flow binding entries are active/inactive.
   <a href="#section-5">Section 5</a> defines how these flow binding entries are manipulated by
   the mobile node in detail.

   As an example, the following represents an ordered flow binding entry
   table for a mobile node that has registered multiple care-of
   addresses and flow bindings.

          FID-PRI     FID    Traffic Selector    BIDs      A/I
          -------     ---    ----------------    ----    -------
             10        4           TCP            2       Active
             30        2       srcAddr=IPy        4      Inactive
             40        5           UDP           1,3      Active


                       Ordered Flow Binding Entries

   According to the above list of flow binding entries, all TCP traffic
   will match the first entry, and will be forwarded to BID2,
   corresponding to a given care-of address (IP3), as shown below.

   The second entry is marked as 'Inactive' since the BID 4 does not
   exist in the ordered list of BID entries below.  Inactive entries do
   not affect traffic, i.e., packets are not matched against them.

   Any UDP traffic that does not match any of the earlier entries will
   match the third rule, at which point it will be replicated and
   forwarded to BIDs 1 and 3, corresponding to care-of addresses IP1 and
   IP2 shown below.






<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   Finally, any remaining packets that do not match any of the entries
   above will be simply forwarded to the care-of address indicated by
   the highest order BID in the table below.  In the example, such
   packets will be forwarded to BID1 corresponding to care-of address
   IP1.

                       BID-PRI          BID        CoA
                      ---------         ---        ---
                          20             1         IP1
                          30             3         IP2
                          30             2         IP3

                            Ordered BID Entries

   Mobility agent and corresponding node implementations should take
   care to avoid flow binding rules affecting the fundamental operation
   of Mobile IPv6 and its extensions.  In particular, flow binding rules
   MUST NOT apply to Mobile IPv6 signaling generated by mobility agents
   and corresponding nodes communicating with a given mobile node, since
   that could adversely affect the operation of the protocol.  Other,
   non-MIPv6 traffic generated by these entities SHOULD be matched
   against the mobile node's flow binding rules as normal.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Protocol%20Operations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Protocol Operations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20General"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  General</span>

   This specification introduces a flow bindings list of entries and an
   ordered list of flow binding identifiers, allowing mobile nodes to
   associate flow binding policies with the registered care-of
   addresses.

   The flow identification mobility option defines how the mobile node
   can control a set of flow binding entries maintained in a mobility
   agent, or correspondent node.

   This specification allows mobile nodes to direct flows to a
   particular care-of address.  The granularity of what constitutes a
   flow depends on the traffic selector used.

   The remainder of this section discusses how mobile nodes can use the
   options and sub-options defined in this document when sending binding
   updates to the correspondent node, home agent, or mobility anchor
   point.  In addition, refresh, deletion, and modification of flow
   binding entries are all discussed below.






<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.1.1.%20%20Preferred%20Care-of%20Address"></a><a class="selflink" href="#section-5.1.1" name="section-5.1.1">5.1.1</a>.  Preferred Care-of Address</span>

   Any node that supports this specification MUST maintain an ordered
   list of care-of addresses for each mobile node for which it maintains
   a list of flow bindings.  The ordered list of care-of addresses is
   built based on the BID-PRI field of the binding identifier mobility
   option (see <a href="#section-4.1">Section 4.1</a>).

   The ordered list of BIDs is used to determine how to forward a packet
   to a given mobile node when the packet does not match any of the flow
   binding entries defined in <a href="#section-4.3">Section 4.3</a>.  A packet that does not match
   any of the flow binding entries SHOULD be forwarded to the care-of
   address identified by the BID with the highest priority, i.e., lowest
   BID-PRI value.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Mobile%20Node%20Considerations"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Mobile Node Considerations</span>

   This specification allows the mobile node to maintain several
   bindings with its mobility agent and correspondent nodes, and it
   allows it to direct packets to different care-of addresses according
   to flow bindings.

   The mobility agent and correspondent node list of flow bindings is
   manipulated by the mobile node, via flow identification and flow
   summary mobility options included in binding update messages.  Each
   flow binding update can add, modify, refresh, or delete a given
   binding.  More than one flow identification mobility option MAY be
   included in the same binding update, but each of them MUST include a
   different FID.  In other words, two flow identification options in
   the same message cannot be about the same flow binding.

   All flow binding state MUST be refreshed in every binding update the
   mobile node sends.  Any previously registered flow binding that is
   not included in a given binding update will be deleted.  So, any flow
   bindings that are not added or modified by a flow identification
   mobility option, but have previously registered and need to be
   maintained, MUST be included in a flow summary mobility option.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20Sending%20BU%20with%20BID%20Options"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  Sending BU with BID Options</span>

   This specification (see <a href="#section-4.1">Section 4.1</a>) updates the definition of the
   binding identifier mobility option, originally defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].
   According to this specification, the BID option includes a BID-PRI
   field assigning each registered care-of address a priority, and thus
   places them in an ordered list, as also described in <a href="#section-4.3">Section 4.3</a>.

   To ensure backwards compatibility with [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], for the purpose of
   this specification, the field BID-PRI MUST NOT be set to zero.



<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   Receiver implementation of this specification will take a BID-PRI
   field of value zero as an indication that this is a BID option of the
   format defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].

   Mobile nodes supporting this specification MUST use the BID option
   format defined in <a href="#section-4.1">Section 4.1</a>.  Mobile nodes MUST also register all
   care-of addresses using the updated BID option format, either in the
   same BU as any flow identification mobility options using them or in
   earlier BUs.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20Sending%20BU%20with%20Flow%20Identification%20Mobility%20Options"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  Sending BU with Flow Identification Mobility Options</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.1.%20%20New%20Flow%20Bindings"></a><a class="selflink" href="#section-5.2.2.1" name="section-5.2.2.1">5.2.2.1</a>.  New Flow Bindings</span>

   When adding a new flow binding, a mobile node sends the flow
   identification mobility option in the binding update, with the FID
   field set to a value that is not already present in the list of flow
   binding entries maintained by the receiver.  The care-of address(es)
   associated with each flow identification mobility option in the
   binding update must be logically registered by this binding update,
   or must have already been registered by the receiver of the binding
   update in an earlier binding update, as defined in <a href="#section-5.2.1">Section 5.2.1</a>.

   The flow identification mobility option MUST include a unique flow
   identifier in the FID field.  The FID need only be unique for the
   receiver of the binding update and for the same sender, i.e., the
   same FID can be used across different receivers of the binding
   update, for the same sender.  The FID-PRI field is set to the desired
   unique priority of the FID, defining the order of the flow binding to
   be added in the list of flow binding entries, as defined in
   <a href="#section-4.3">Section 4.3</a>.  The Status field is set to zero in all binding update
   messages.

   Since this flow identification mobility option is requesting the
   addition of a new flow binding in the list of flow bindings
   maintained by the receiver, the mobile node MUST include exactly one
   traffic selector sub-option (see <a href="#section-4.2.1.4">Section 4.2.1.4</a>) describing the flow
   associated with the new flow binding.  The TS Format field of the
   traffic selector sub-option MUST be set to the non-zero value of the
   format used by the mobile node.

   The mobile node MUST also include exactly one BID reference sub-
   option (see <a href="#section-4.2.1.3">Section 4.2.1.3</a>) to associate the flow binding with a
   given set of BIDs and corresponding CoAs.







<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.2.%20%20Updating%20Flow%20Bindings"></a><a class="selflink" href="#section-5.2.2.2" name="section-5.2.2.2">5.2.2.2</a>.  Updating Flow Bindings</span>

   Flow binding modification is essentially a process where parameters
   associated with an existing flow binding in the list of flow binding
   entries are replaced by parameters included in the flow
   identification mobility option, and the same FID is maintained.  With
   this procedure, the mobile node can change the priority, the BID(s),
   and/or the traffic selector associated with a flow binding.

   To modify an existing flow binding, the mobile node MUST send a
   binding update with a flow identification option, with the FID field
   set to one of the FID values already in the list of flow binding
   entries.  The FID-PRI field MUST be set to the priority value for the
   flow binding entry.  The Status field is set to zero since this
   option is in a binding update.

   The mobile node MAY include exactly one traffic selector sub-option
   (see <a href="#section-4.2.1.4">Section 4.2.1.4</a>) describing the updated flow to be associated
   with the flow binding.  The mobile node MAY, however, omit the
   traffic selector sub-option if it wants the traffic selector
   currently associated with the flow binding entry identified by the
   FID field to be maintained.

   The mobile node MAY include exactly one binding reference sub-option
   (see <a href="#section-4.2.1.3">Section 4.2.1.3</a>) to associate the existing flow binding with a
   new set of CoAs.  The mobile node MAY omit the binding reference sub-
   option if it wants the BIDs currently associated with the flow
   binding entry identified by the FID field to be maintained.

   Note that it is also possible for the mobile node to effectively
   modify the effect of a flow binding entry without actually changing
   the entry itself.  This can be done by changing the CoA associated
   with a given BID, which is a process defined in detail in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.3.%20%20Sending%20BU%20with%20a%20Flow%20Summary%20Option"></a><a class="selflink" href="#section-5.2.3" name="section-5.2.3">5.2.3</a>.  Sending BU with a Flow Summary Option</span>

   When the mobile node sends a binding update, it MUST refresh all flow
   bindings it wants to maintain even if it does not want to change any
   of their parameters.

   To refresh an existing flow binding, the mobile node MUST send a
   binding update with a flow summary option.  The flow summary option
   MUST include one or more FID fields, as indicated in <a href="#section-4.2.2">Section 4.2.2</a>.
   Each FID field included MUST be set to one of the FID values already
   in the list of flow binding entries.  Each flow summary mobility
   option can identify up to 127 FIDs, so more than one such option can





<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   be included in a binding update message as required.  A given FID
   SHOULD NOT be included more than once in all of the flow summary
   mobility options included in a given binding update message.

   Any flow bindings (active or inactive) that are not identified in a
   binding update will be removed from the list of flow binding entries.

   Note that any inactive flow bindings, i.e., flow bindings without
   associated BIDs that are marked as 'Inactive' in the list of flow
   binding entries (see <a href="#section-4.3">Section 4.3</a>), MUST also be refreshed, or
   modified, to be maintained.  If they are not included in a BU
   message, they will be removed.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.4.%20%20Removing%20Flow%20Bindings"></a><a class="selflink" href="#section-5.2.4" name="section-5.2.4">5.2.4</a>.  Removing Flow Bindings</span>

   Removal of flow binding entries is performed implicitly by omission
   of a given FID from a binding update.

   To remove a flow binding, the MN simply sends a binding update
   message that includes flow identification and flow summary mobility
   options for all the FIDs that need to be refreshed, modified, or
   added, and simply omits any FIDs that need to be removed.

   Note that a mobile node can also render a flow binding inactive by
   removing the BIDs associated with it, without removing the flow
   binding itself.  The procedure for removing a BID is defined in
   detail in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].

   When all the BIDs associated with a flow binding are removed, the
   flow binding MUST be marked as 'Inactive' in the list of flow binding
   entries, as shown in <a href="#section-4.3">Section 4.3</a>.  In other words, the state
   associated with the flow binding MUST be maintained, but it no longer
   affects the mobile node's traffic.  The MN can return an inactive
   flow binding to the active state by using the flow binding
   modification process, described in <a href="#section-5.2.2.2">Section 5.2.2.2</a>, to associate it
   again with one or more valid BIDs.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.5.%20%20Returning%20Home"></a><a class="selflink" href="#section-5.2.5" name="section-5.2.5">5.2.5</a>.  Returning Home</span>

   This specification is compatible with the home registration
   procedures defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] and [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].  More specifically, if
   the mobile node performs a deregistration in the [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] style, all
   of its bindings, including flow bindings are deleted.  If the mobile
   node, however, performs a home registration in the [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>] style,
   then the home link is associated with a specific BID and so, as far
   as this specification is concerned, it is treated as any other link
   associated with a given BID.




<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.6.%20%20Receiving%20Binding%20Acknowledgements"></a><a class="selflink" href="#section-5.2.6" name="section-5.2.6">5.2.6</a>.  Receiving Binding Acknowledgements</span>

   According to [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>], all nodes are required to silently ignore
   mobility options not understood while processing binding updates.  As
   such, a mobile node receiving a Binding Acknowledgement message in
   response to the transmission of a binding update message MUST
   determine if the Binding Acknowledgement message contains a copy of
   every flow identification mobility options included in the binding
   update.  A Binding Acknowledgement without flow identification
   option(s), in response to a binding update with flow identification
   mobility option, would indicate the inability (or unwillingness) on
   behalf of the source node to support the extensions presented in this
   document.

   If a received Binding Acknowledgement contains a copy of each flow
   identification mobility option that was sent within the binding
   update, the Status field of each flow identification option indicates
   the status of the flow binding on the distant node.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.7.%20%20Return%20Routability%20Procedure"></a><a class="selflink" href="#section-5.2.7" name="section-5.2.7">5.2.7</a>.  Return Routability Procedure</span>

   A mobile node may perform route optimization with correspondent
   nodes, as defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>].  Route optimization allows a mobile
   node to bind a care-of address to a home address in order to allow
   the correspondent node to direct the traffic to the current location
   of the mobile node.  Before sending a binding update to correspondent
   node, the Return Routability Procedure needs to be performed between
   the mobile node and the correspondent node.  This procedure is not
   affected by the extensions defined in this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20HA%2C%20MAP%2C%20and%20CN%20Considerations"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  HA, MAP, and CN Considerations</span>

   This specification allows the mobility agents (home agents and
   mobility anchor points), and correspondent nodes to maintain several
   flow bindings for a given home address and to direct packets to
   different care-of addresses according to flow bindings.  This section
   details the home agent operations necessary to implement this
   specification.  These operations are identical for MAPs and CNs,
   unless otherwise stated.

   Note that route optimization is only defined for mobile nodes (MIPv6
   [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>]) and not mobile routers (NEMOv6 [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>]).  Thus, these
   sections only apply to correspondent nodes with respect to mobile
   nodes and not mobile routers.







<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.1.%20%20Handling%20Binding%20Identifier%20Mobility%20Options"></a><a class="selflink" href="#section-5.3.1" name="section-5.3.1">5.3.1</a>.  Handling Binding Identifier Mobility Options</span>

   This specification (see <a href="#section-4.1">Section 4.1</a>) updates the definition of the
   binding identifier mobility option, originally defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].
   According to this specification, the BID option includes a BID-PRI
   field assigning each registered care-of address a priority, and thus
   places them in an ordered list (see <a href="#section-4.3">Section 4.3</a>).

   Home agents receiving BUs including BID options and flow
   identification options MUST logically process BID options first.
   This is because BID reference sub-options included in the flow
   identification mobility options might refer to BIDs defined in BID
   options included in the same message.

   The BID option is processed as defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>], but then the BID
   to care-of address mapping is placed in an ordered list according to
   the BID-PRI field of the BID option.

   Binding identifier registrations and deregistrations indirectly
   affect the MN's flow binding entries.  The home agent MUST update the
   flow binding entries table accordingly as BIDs are added or removed
   (as per [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>]).  For example, as discussed in <a href="#section-4.3">Section 4.3</a>, if all
   of the BIDs associated with a given flow binding entry are removed
   (i.e., become invalid) the entry MUST be marked as 'Inactive'.  While
   if any of the invalid BIDs associated with an inactive flow binding
   entry are registered (i.e., become valid), the entry MUST be marked
   as 'Active'.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.%20%20Handling%20Flow%20Identification%20Mobility%20Options"></a><a class="selflink" href="#section-5.3.2" name="section-5.3.2">5.3.2</a>.  Handling Flow Identification Mobility Options</span>

   When the home agent receives a binding update that includes at least
   one flow identification mobility option, it first performs the
   operation described in <a href="rfc3775.html#section-10.3.1">section 10.3.1 of RFC 3775</a>, followed by the
   operations defined in <a href="#section-5.3.1">Section 5.3.1</a> of this document.

   Home agents that do not support this specification will ignore the
   flow identification mobility options and all their sub-options,
   having no effect on the operation of the rest of the protocol.

   If the binding update is accepted, and the home agent is willing to
   support flow bindings for this MN, the home agent checks the flow
   identification mobility options.

   If more than one flow identification mobility option in the same BU
   has the same value in the FID field, all the flow identification
   mobility options MUST be rejected.





<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   If all FID fields have different values the flow identification
   mobility options can be processed further and in any order, as
   defined by the following subsections.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.1.%20%20Handling%20New%20FIDs"></a><a class="selflink" href="#section-5.3.2.1" name="section-5.3.2.1">5.3.2.1</a>.  Handling New FIDs</span>

   If the FID field of the flow identification mobility option is not
   already present in the list of flow binding entries for this mobile
   node, then this is a request for a new entry.

      If the flow identification mobility option does not include a
      traffic selector sub-option, the home agent MUST reject this
      request by copying the flow identification mobility option in the
      Binding Acknowledgement (BA) and setting the Status field to the
      value defined in Figure 2 for "Flow identification option
      malformed".

      If the flow identification option does include a traffic selector
      sub-option, but the format indicated in the TS Format field is not
      supported, the home agent MUST reject this request by copying the
      flow identification mobility option in the BA, and setting the
      Status field to the value defined in Figure 2 for "Traffic
      Selector format not supported".

   Then, the home agent MUST check the binding reference sub-option.

      If the binding reference sub-option is not included, the home
      agent MUST reject this request by copying the flow identification
      mobility option in the BA and setting the Status field to the
      value defined for "Flow identification mobility option malformed"
      in <a href="#section-4.2">Section 4.2</a>.

      If the binding reference sub-option is present and includes one or
      more BIDs that are not present in the binding cache of the mobile
      node, the home agent MUST reject this request by copying the flow
      identification option in the BA and setting the Status field to
      the value defined for "BID not found" in <a href="#section-4.2">Section 4.2</a>.

      If the binding reference sub-option is present and includes one or
      more BIDs, and the BIDs exist in the mobile node's binding cache,
      the home agent SHOULD add a new entry in the mobile node's list of
      flow binding entries, as defined below.

   When the home agent decides to add an entry in the mobile node's list
   of flow binding entries, as discussed above, it MUST do it according
   to the following rules: the entry MUST be placed according to the
   order indicated by the FID-PRI field of the flow identification
   mobility option and it MUST include:



<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


      the FID as a key to the entry,

      the traffic selector included in the corresponding sub-option,

      the BIDs indicated in the binding reference sub-option, and

      the entry MUST be marked as 'Active', as shown in <a href="#section-4.3">Section 4.3</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.2.%20%20Handling%20Known%20FIDs"></a><a class="selflink" href="#section-5.3.2.2" name="section-5.3.2.2">5.3.2.2</a>.  Handling Known FIDs</span>

   If the FID field of the flow identification mobility option is
   already present in the list of flow binding entries for this mobile
   node, then this is a request to update the existing entry.

   The flow binding modification is essentially a process where
   parameters associated with an existing flow binding entry are
   replaced by the parameters included in a flow identification mobility
   option with the same FID as the existing entry.

   The home agent MUST change the priority of the entry according to the
   FID-PRI field of the flow identification mobility option.

   Since this flow identification mobility option is designed to update
   an existing entry, it may or may not include a traffic selector sub-
   option.  Specifically:

      if a traffic selector sub-option is not included in the flow
      identification mobility option, then the traffic selector already
      associated with entry MUST be maintained;

      otherwise, the traffic selector in the entry MUST be replaced by
      the traffic selector in the sub-option.

   Since this flow identification mobility option is designed to update
   an existing entry, it may or may not include a binding reference sub-
   option.  Specifically:

      if a binding reference sub-option is not included in the flow
      identification mobility option, then the BIDs already associated
      with entry MUST be maintained;

      otherwise, the BIDs in the entry MUST be replaced by the BIDs in
      the sub-option.








<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.3.%20%20Handling%20Flow%20Summary%20Mobility%20Option"></a><a class="selflink" href="#section-5.3.3" name="section-5.3.3">5.3.3</a>.  Handling Flow Summary Mobility Option</span>

   When the home agent receives a binding update that includes flow
   summary mobility options, it first performs the operation described
   so far in <a href="#section-5.3">Section 5.3</a>.

   If the value of any of the FID fields included in a flow summary
   mobility option is not present in the list of flow binding entries
   for this mobile node, the home agent MUST reject this flow binding
   refresh by including a flow identification mobility option in the BA
   for each FID that is not found, and by setting the FID field to the
   value of the FID that is not found and the Status field to the value
   defined for "FID not found" in <a href="#section-4.2">Section 4.2</a>.

   If the value of the FID field is present in the mobile nodes list of
   flow binding entries the, home agent SHOULD refresh the flow binding
   entry identified by the FID without changing any of the other
   parameters associated with it.

   If a given FID is included more than once in the same or different
   flow summary mobility options in the same binding update message, the
   duplicates can be simply ignored.

   Note that, an [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] deregistration binding update (with a zero
   lifetime) would result in deleting all bindings, including all flow
   bindings regardless of the presence of flow summary mobility options.
   A binding update (with a zero lifetime) would result in deleting all
   bindings, including all flow bindings regardless of the presence of
   flow summary mobility options.  A specific binding deregistration,
   however, as defined in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>] (with lifetime of zero and one or
   more binding identifier mobility options identifying specific BIDs)
   does not remove all the bindings for the MN, and thus it SHOULD
   include flow summary mobility options to maintain the flow bindings
   that need to be preserved.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.4.%20%20Flow%20Binding%20Removals"></a><a class="selflink" href="#section-5.3.4" name="section-5.3.4">5.3.4</a>.  Flow Binding Removals</span>

   Removal of flow bindings is performed implicitly by omission of a
   given FID from a binding update.

   When a valid binding update is received, any registered FIDs that are
   not explicitly referred to in a flow identification mobility option
   or in a flow summary mobility option, in the same binding update,
   MUST be removed from the list of flow binding entries for the mobile
   node.






<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.5.%20%20Sending%20Binding%20Acknowledgements"></a><a class="selflink" href="#section-5.3.5" name="section-5.3.5">5.3.5</a>.  Sending Binding Acknowledgements</span>

   Upon the reception of a binding update, the home agent is required to
   send back a Binding Acknowledgement.  The status code in the Binding
   Acknowledgement must be set as recommended in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>].  This status
   code does not give information on the success or failure of flow
   bindings.

   In order to inform the mobile node about the status of the flow
   binding(s) requested by a mobile node, flow identification options
   SHOULD be included in the Binding Acknowledgement message.
   Specifically, the home agent SHOULD copy each flow identification
   mobility option received in the binding update and set its status
   code to an appropriate value.  Note that the home agent does not need
   to respond specifically regarding FIDs included in a flow summary
   mobility option but only to those in flow identification mobility
   options.  If an operation requested in a flow identification option
   by a mobile node is performed successfully by the home agent, the
   Status field on the copied flow identification mobility option in the
   BA, SHOULD be set to the value defined for "Flow binding successful"
   in <a href="#section-4.2">Section 4.2</a>; otherwise, it SHOULD be set to one of the rejection
   codes also defined in <a href="#section-4.2">Section 4.2</a>.  <a href="#section-5.3.2">Section 5.3.2</a> identifies a number
   of cases where specific error codes should be used.

   Home agents that support this specification MAY refuse to maintain
   flow bindings by setting the Status field of any flow identification
   mobility options to the value defined for "Administratively
   prohibited" in <a href="#section-4.2">Section 4.2</a>, or by just ignoring all the flow binding
   options.

   Note that BID options and their Status field are handled as defined
   in [<a href="rfc5648.html" title='"Multiple Care-of Addresses Registration"'>RFC5648</a>].  The BID-PRI field in a BID option included in the
   Binding Acknowledgement is copied from the BID-PRI field of the
   corresponding BID option in the binding request.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.6.%20%20Packet%20Processing"></a><a class="selflink" href="#section-5.3.6" name="section-5.3.6">5.3.6</a>.  Packet Processing</span>

   This section defines packet processing rules according to this
   specification.  This specification does not change any of the packet
   interception rules defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] and [<a href="rfc5555.html" title='"Mobile IPv6 Support for Dual Stack Hosts and Routers"'>RFC5555</a>].  These rules
   apply to HAs, MAPs, and CNs as part of the routing process for any
   packet with a destination address set to a valid home address of the
   mobile node.  For nodes other than CNs, this also applies to packets
   with a destination address set to an address under any of the
   registered prefixes.  These rules apply equally to IPv6 packets as
   well as to IPv4 packets as per [<a href="rfc5555.html" title='"Mobile IPv6 Support for Dual Stack Hosts and Routers"'>RFC5555</a>].





<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   Before a packet is forwarded to the mobile node, it MUST be matched
   against the ordered list of flow bindings stored in the list of flow
   binding entries for this mobile node (see <a href="#section-4.3">Section 4.3</a>).  A match is
   attempted with the traffic selector included in the first line
   (highest order) of the table.  The first entry that creates a match
   defines how the packet is routed.  When a packet matches the traffic
   selector of a given entry, a copy of the packet is forwarded to each
   of the care-of addresses associated with the BIDs indicated in the
   same line of the table.

   If any of the BIDs indicated does not correspond to a valid care-of
   address, e.g., the BID was deregistered then, that BID has no effect
   on the traffic.  In other words, packets matching the flow binding
   are forwarded to the remaining BIDs, pointing to registered care-of
   addresses.  If none of the BIDs pointed to in a flow binding entry is
   valid, then the entry is considered to be inactive (as defined in
   <a href="#section-4.3">Section 4.3</a>) and is skipped.  In other words, packets should not be
   matched against that entry.

   If a packet does not match any of the active flow binding entries for
   the given MN, the packet SHOULD be forwarded to the highest order
   care-of address, i.e., the one associated with the BID with the
   lowest BID-PRI.

   If a packet is fragmented, only the first fragment contains all IP
   and transport layer headers, while subsequent fragments only contain
   an IP header without transport layer headers.  For this reason, it is
   possible that subsequent fragments do not match the same traffic
   selector as the initial fragment of such a packet.  Unless specific
   measures are taken, the likely outcome is that the initial fragment
   is routed as the MN intended while subsequent fragments are routed
   differently, and probably based on the default flow binding.  HAs,
   MAPs, and CNs SHOULD take care to forward all fragments of a given
   packet the same way, and in accordance to the flow binding matching
   the first fragment of said packet.  This should be possible given the
   fact that fragment headers include enough information to identify a
   fragment as part of a specific packet, but the details of how this is
   ensured are implementation specific and are not defined in this
   specification.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20MTU%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  MTU Considerations</span>

   The options and sub-options defined in this specification add to
   those defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] and other related specifications, all of
   which potentially add to the size of binding update messages.
   Implementations SHOULD take care to minimize fragmentation by forming
   binding updates that are shorter than what the path MTU allows
   whenever possible.



<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   This specification offers a number of mechanisms for reducing the
   size of binding updates.  The operations defined in this
   specification that require the most verbose options are those
   registering new BIDs, <a href="#section-4.1">Section 4.1</a>, and identifying new flows,
   <a href="#section-4.2.1.4">Section 4.2.1.4</a>.  Implementations are encouraged to keep binding
   updates to sizes below that of the path's MTU by making full use of
   the BID reference sub-option, <a href="#section-4.2.1.3">Section 4.2.1.3</a>, and flow summary
   option, <a href="#section-4.2.2">Section 4.2.2</a>, which allows them to refer to already
   registered care-of addresses and flow bindings, while registering new
   ones in subsequent binding update messages.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security considerations</span>

   This document introduces a new option that adds more granularity to
   the binding update and acknowledgement messages defined in [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>],
   [<a href="rfc5555.html" title='"Mobile IPv6 Support for Dual Stack Hosts and Routers"'>RFC5555</a>], and [<a href="rfc3963.html" title='"Network Mobility (NEMO) Basic Support Protocol"'>RFC3963</a>], so it inherits the security considerations
   discussed in these documents.  The new option allows the mobile node
   to associate some flows to one interface and other flows to another
   interface.  Since the flow identification mobility option is part of
   the mobility header, it uses the same security as the binding update,
   whether it is sent to a mobility agent or to a correspondent node.

   This specification does not open up new fundamental lines of attack
   on communications between the MN and its correspondent nodes.
   However, it allows attacks of a finer granularity than those on the
   binding update.  For instance, the attacker can divert or replicate
   flows of special interest to the attacker to an address of the
   attacker's choosing, if the attacker is able to impersonate the MN or
   modify a binding update sent by the MN.  Hence, it becomes doubly
   critical that authentication and integrity services are applied to
   binding updates.

   Finally, when the optional anti-replay feature of Encapsulating
   Security Payload (ESP) [<a href="rfc4303.html" title='"IP Encapsulating Security Payload (ESP)"'>RFC4303</a>] is employed and packets to/from
   different CoAs are sent on the same security association (SA), some
   packets could be discarded at the receiver due to the windowing
   mechanism used by this feature.  Therefore, a sender SHOULD put
   traffic to/from different CoAs, but with the same HoA in the selector
   values, on different SAs to support Multiple Care-of Addresses
   appropriately.  To permit this, the IPsec implementation SHOULD
   establish and maintain multiple SAs between a given sender and
   receiver, with the same selectors.  Distribution of traffic among
   these parallel SAs to support Multiple Care-of Addresses is locally
   determined by the sender and is not negotiated by the Internet Key
   Exchange version 2 (IKEv2) protocol [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>].  The receiver will
   process the packets from the different SAs without prejudice.





<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  IANA Considerations</span>

   This specification requires the following IANA assignments on
   existing namespaces as well as the creation of some new namespaces.

      New Mobility Options [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>]: This registry is available from
      <a href="http://www.iana.org/">http://www.iana.org</a> under "Mobile IPv6 parameters".  The following
      type numbers have been assigned for:

         44 Flow Identification Mobility Option, defined in <a href="#section-4.2">Section 4.2</a>

         45 Flow Summary Mobility Option, defined in <a href="#section-4.2.2">Section 4.2.2</a>

      A new "Flow Identification Mobility Option Status Codes" namespace
      has been created.  The following 'Status' codes are defined in
      this specification, in <a href="#section-4.2">Section 4.2</a>:

         0 Flow binding successful

         1-127 Unassigned.  Available for success codes to be allocated
         via Standards Action or IESG Approval as per [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

         128 Administratively prohibited

         129 Flow binding rejected, reason unspecified

         130 Flow identification mobility option malformed

         131 BID not found

         132 FID not found

         133 Traffic selector format not supported

         134-250 Unassigned.  Available for reject codes to be allocated
         via Standards Action or IESG Approval as per [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

         251-255 Reserved for experimental use.  This small number of
         status codes should be sufficient for experiments with
         currently unforeseen error conditions.











<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


      A new "Flow Identification Sub-Options" namespace for the flow
      identification mobility option has been created.  The sub-option
      space is defined in Figure 3.  The following sub-option Type
      values are defined in this specification:

         0 Pad

         1 PadN

         2 BID Reference

         3 Traffic Selector

         4-250 Unassigned.  Available for allocation based on Standards
         Action or IESG Approval as per [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

         251-255 Reserved for experimental use.  This small number of
         sub-option Types should be sufficient for experiments with
         additional parameters associated with a flow.

      A new "Traffic Selector Format" namespace for the traffic selector
      sub-option has been created.  The traffic selector format space is
      defined by the TS Format field in Figure 5.  The following values
      are defined in this specification:

         0 Reserved

         1-250 Unassigned.  Available for allocation based on Standards
         Action or IESG Approval as per [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

         251-255 Reserved for experimental use.  This small number of
         traffic selector format types should be sufficient for
         experiments with different ways of representing a traffic
         selector.

   Similar to the procedures specified for Mobile IPv6 [<a href="rfc3775.html" title='"Mobility Support in IPv6"'>RFC3775</a>] number
   spaces, future allocations from the new number spaces requires
   Standards Action or IESG Approval as per [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Contributors"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Contributors</span>

   We would like to explicitly acknowledge the following person who
   coauthored one of the documents used as source material for this
   document.

      Nikolaus A. Fikouras, niko@comnets.uni-bremen.de





<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Acknowledgements"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Acknowledgements</span>

   We would also like to acknowledge the following people in
   alphabetical order for their contributions to this specification: C.
   Castelluccia, D. Craig, K. ElMalki, K. Georgios, C. Goerg, C. Kaas-
   Petersen, J. Laganier, T. Noel, V. Park, F.-N.  Pavlidou, P. Stupar.
   Also, Gabor Fekete for the analysis that led to the inclusion of the
   BID reference sub-option, and Henrik Levkowetz for suggesting support
   for other ways of describing flows.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3775" name="ref-RFC3775">RFC3775</a>]  Johnson, D., Perkins, C., and J. Arkko, "Mobility Support
              in IPv6", <a href="rfc3775.html">RFC 3775</a>, June 2004.

   [<a id="ref-RFC3963" name="ref-RFC3963">RFC3963</a>]  Devarapalli, V., Wakikawa, R., Petrescu, A., and P.
              Thubert, "Network Mobility (NEMO) Basic Support Protocol",
              <a href="rfc3963.html">RFC 3963</a>, January 2005.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              May 2008.

   [<a id="ref-RFC5555" name="ref-RFC5555">RFC5555</a>]  Soliman, H., "Mobile IPv6 Support for Dual Stack Hosts and
              Routers", <a href="rfc5555.html">RFC 5555</a>, June 2009.

   [<a id="ref-RFC5648" name="ref-RFC5648">RFC5648</a>]  Wakikawa, R., Devarapalli, V., Tsirtsis, G., Ernst, T.,
              and K. Nagami, "Multiple Care-of Addresses Registration",
              <a href="rfc5648.html">RFC 5648</a>, October 2009.

   [<a id="ref-RFC6088" name="ref-RFC6088">RFC6088</a>]  Tsirtsis, G., Giaretta, G., Soliman, H., and N. Montavont,
              "Traffic Selectors for Flow Bindings", <a href="rfc6088.html">RFC 6088</a>,
              January 2011.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-RFC2702" name="ref-RFC2702">RFC2702</a>]  Awduche, D., Malcolm, J., Agogbua, J., O'Dell, M., and J.
              McManus, "Requirements for Traffic Engineering Over MPLS",
              <a href="rfc2702.html">RFC 2702</a>, September 1999.

   [<a id="ref-RFC3753" name="ref-RFC3753">RFC3753</a>]  Manner, J. and M. Kojo, "Mobility Related Terminology",
              <a href="rfc3753.html">RFC 3753</a>, June 2004.




<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


   [<a id="ref-RFC4303" name="ref-RFC4303">RFC4303</a>]  Kent, S., "IP Encapsulating Security Payload (ESP)",
              <a href="rfc4303.html">RFC 4303</a>, December 2005.

   [<a id="ref-RFC4885" name="ref-RFC4885">RFC4885</a>]  Ernst, T. and H-Y. Lach, "Network Mobility Support
              Terminology", <a href="rfc4885.html">RFC 4885</a>, July 2007.

   [<a id="ref-RFC5380" name="ref-RFC5380">RFC5380</a>]  Soliman, H., Castelluccia, C., ElMalki, K., and L.
              Bellier, "Hierarchical Mobile IPv6 (HMIPv6) Mobility
              Management", <a href="rfc5380.html">RFC 5380</a>, October 2008.

   [<a id="ref-RFC5996" name="ref-RFC5996">RFC5996</a>]  Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen,
              "Internet Key Exchange Protocol Version 2 (IKEv2)",
              <a href="rfc5996.html">RFC 5996</a>, September 2010.






































<span class="grey">Tsirtsis, et al.             Standards Track                   [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc6089.html">RFC 6089</a>                      Flow Binding                  January 2011</span>


Authors' Addresses

   George Tsirtsis
   Qualcomm

   EMail: tsirtsis@qualcomm.com


   Hesham Soliman
   Elevate Technologies

   EMail: hesham@elevatemobile.com


   Nicolas Montavont
   Institut Telecom / Telecom Bretagne
   2, rue de la chataigneraie
   Cesson Sevigne  35576
   France

   Phone: (+33) 2 99 12 70 23
   EMail: nicolas.montavont@telecom-bretagne.eu
   URI:   <a href="http://www.rennes.enst-bretagne.fr/~nmontavo//">http://www.rennes.enst-bretagne.fr/~nmontavo//</a>


   Gerardo Giaretta
   Qualcomm

   EMail: gerardog@qualcomm.com


   Koojana Kuladinithi
   University of Bremen
   ComNets-ikom
   Otto-Hahn-Allee NW 1
   Bremen, Bremen  28359
   Germany

   Phone: +49-421-218-8264
   Fax:   +49-421-218-3601
   EMail: koo@comnets.uni-bremen.de
   URI:   <a href="http://www.comnets.uni-bremen.de/~koo/">http://www.comnets.uni-bremen.de/~koo/</a>









Tsirtsis, et al.             Standards Track                   [Page 31]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6089 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --></html>