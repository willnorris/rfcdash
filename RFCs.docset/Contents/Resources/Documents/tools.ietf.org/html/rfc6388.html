<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6388 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:30 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-minei-mpls-ldp-p2mp" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:6388" name="DC.Identifier"/>
<meta content="November, 2011" name="DC.Date.Issued"/>
<meta content="Kompella, Kireeti" name="DC.Creator"/>
<meta content="Thomas, Bob" name="DC.Creator"/>
<meta content="Wijnands, IJsbrand" name="DC.Creator"/>
<meta content="Minei, Ina" name="DC.Creator"/>
<meta content="This document describes extensions to the Label Distribution Protocol
(LDP) for the setup of point-to-multipoint (P2MP) and multipoint-to-
multipoint (MP2MP) Label Switched Paths (LSPs) in MPLS networks. These
extensions are also referred to as multipoint LDP. Multipoint LDP
constructs the P2MP or MP2MP LSPs without interacting with or relying
upon any other multicast tree construction protocol. Protocol elements
and procedures for this solution are described for building such LSPs
in a receiver-initiated manner. There can be various applications for
multipoint LSPs, for example IP multicast or support for multicast in
BGP/MPLS Layer 3 Virtual Private Networks (L3VPNs). Specification of
how such applications can use an LDP signaled multipoint LSP is
outside the scope of this document. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Label Distribution Protocol Extensions for Point-to-Multipoint and Multipoint-to-Multipoint Label Switched Paths" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6388 - Label Distribution Protocol Extensions for Point-to-Multipoint and Multipoint-to-Multipoint Label Switched Paths</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6388.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6388" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mpls-ldp-p2mp" title="draft-ietf-mpls-ldp-p2mp">draft-ietf-mpls...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6388" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6388" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6388" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6388&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Updated by: <a href="rfc7358.html">7358</a>                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                 IJ. Wijnands, Ed.
Request for Comments: 6388                           Cisco Systems, Inc.
Category: Standards Track                                  I. Minei, Ed.
ISSN: 2070-1721                                              K. Kompella
                                                        Juniper Networks
                                                               B. Thomas
                                                           November 2011


               <span class="h1">Label Distribution Protocol Extensions for</span>
 <span class="h1">Point-to-Multipoint and Multipoint-to-Multipoint Label Switched Paths</span>

Abstract

   This document describes extensions to the Label Distribution Protocol
   (LDP) for the setup of point-to-multipoint (P2MP) and multipoint-to-
   multipoint (MP2MP) Label Switched Paths (LSPs) in MPLS networks.
   These extensions are also referred to as multipoint LDP.  Multipoint
   LDP constructs the P2MP or MP2MP LSPs without interacting with or
   relying upon any other multicast tree construction protocol.
   Protocol elements and procedures for this solution are described for
   building such LSPs in a receiver-initiated manner.  There can be
   various applications for multipoint LSPs, for example IP multicast or
   support for multicast in BGP/MPLS Layer 3 Virtual Private Networks
   (L3VPNs).  Specification of how such applications can use an LDP
   signaled multipoint LSP is outside the scope of this document.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6388">http://www.rfc-editor.org/info/rfc6388</a>.











<span class="grey">Wijnands, et al.             Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Conventions Used in This Document ..........................<a href="#page-4">4</a>
      <a href="#section-1.2">1.2</a>. Terminology ................................................<a href="#page-4">4</a>
      <a href="#section-1.3">1.3</a>. Manageability ..............................................<a href="#page-5">5</a>
   <a href="#section-2">2</a>. Setting Up P2MP LSPs with LDP ...................................<a href="#page-6">6</a>
      <a href="#section-2.1">2.1</a>. Support for P2MP LSP Setup with LDP ........................<a href="#page-6">6</a>
      <a href="#section-2.2">2.2</a>. The P2MP FEC Element .......................................<a href="#page-6">6</a>
      <a href="#section-2.3">2.3</a>. The LDP MP Opaque Value Element ............................<a href="#page-8">8</a>
           <a href="#section-2.3.1">2.3.1</a>. The Generic LSP Identifier ..........................<a href="#page-9">9</a>
      <a href="#section-2.4">2.4</a>. Using the P2MP FEC Element .................................<a href="#page-9">9</a>
           <a href="#section-2.4.1">2.4.1</a>. Label Mapping ......................................<a href="#page-10">10</a>
           <a href="#section-2.4.2">2.4.2</a>. Label Withdraw .....................................<a href="#page-12">12</a>
           <a href="#section-2.4.3">2.4.3</a>. Upstream LSR Change ................................<a href="#page-13">13</a>
   <a href="#section-3">3</a>. Setting up MP2MP LSPs with LDP .................................<a href="#page-14">14</a>
      <a href="#section-3.1">3.1</a>. Support for MP2MP LSP Setup with LDP ......................<a href="#page-14">14</a>
      <a href="#section-3.2">3.2</a>. The MP2MP Downstream and Upstream FEC Elements ............<a href="#page-15">15</a>
      <a href="#section-3.3">3.3</a>. Using the MP2MP FEC Elements ..............................<a href="#page-15">15</a>
           <a href="#section-3.3.1">3.3.1</a>. MP2MP Label Mapping ................................<a href="#page-17">17</a>
           <a href="#section-3.3.2">3.3.2</a>. MP2MP Label Withdraw ...............................<a href="#page-20">20</a>



<span class="grey">Wijnands, et al.             Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


           <a href="#section-3.3.3">3.3.3</a>. MP2MP Upstream LSR Change ..........................<a href="#page-21">21</a>
   <a href="#section-4">4</a>. Micro-Loops in MP LSPs .........................................<a href="#page-21">21</a>
   <a href="#section-5">5</a>. The LDP MP Status TLV ..........................................<a href="#page-21">21</a>
      <a href="#section-5.1">5.1</a>. The LDP MP Status Value Element ...........................<a href="#page-22">22</a>
      <a href="#section-5.2">5.2</a>. LDP Messages Containing LDP MP Status Messages ............<a href="#page-22">22</a>
           <a href="#section-5.2.1">5.2.1</a>. LDP MP Status Sent in LDP Notification Messages ....<a href="#page-23">23</a>
           <a href="#section-5.2.2">5.2.2</a>. LDP MP Status TLV in Label Mapping Message .........<a href="#page-24">24</a>
   <a href="#section-6">6</a>. Upstream Label Allocation on a LAN .............................<a href="#page-24">24</a>
      <a href="#section-6.1">6.1</a>. LDP Multipoint-to-Multipoint on a LAN .....................<a href="#page-24">24</a>
           <a href="#section-6.1.1">6.1.1</a>. MP2MP Downstream Forwarding ........................<a href="#page-25">25</a>
           <a href="#section-6.1.2">6.1.2</a>. MP2MP Upstream Forwarding ..........................<a href="#page-25">25</a>
   <a href="#section-7">7</a>. Root Node Redundancy ...........................................<a href="#page-25">25</a>
      <a href="#section-7.1">7.1</a>. Root Node Redundancy - Procedures for P2MP LSPs ...........<a href="#page-26">26</a>
      <a href="#section-7.2">7.2</a>. Root Node Redundancy - Procedures for MP2MP LSPs ..........<a href="#page-26">26</a>
   <a href="#section-8">8</a>. Make Before Break (MBB) ........................................<a href="#page-27">27</a>
      <a href="#section-8.1">8.1</a>.  MBB Overview .............................................<a href="#page-27">27</a>
      <a href="#section-8.2">8.2</a>. The MBB Status Code .......................................<a href="#page-28">28</a>
      <a href="#section-8.3">8.3</a>. The MBB Capability ........................................<a href="#page-29">29</a>
      <a href="#section-8.4">8.4</a>. The MBB Procedures ........................................<a href="#page-29">29</a>
           <a href="#section-8.4.1">8.4.1</a>. Terminology ........................................<a href="#page-29">29</a>
           <a href="#section-8.4.2">8.4.2</a>. Accepting Elements .................................<a href="#page-30">30</a>
           <a href="#section-8.4.3">8.4.3</a>. Procedures for Upstream LSR Change .................<a href="#page-30">30</a>
           <a href="#section-8.4.4">8.4.4</a>. Receiving a Label Mapping with MBB Status Code .....<a href="#page-31">31</a>
           <a href="#section-8.4.5">8.4.5</a>. Receiving a Notification with MBB Status Code ......<a href="#page-31">31</a>
           <a href="#section-8.4.6">8.4.6</a>. Node Operation for MP2MP LSPs ......................<a href="#page-32">32</a>
   <a href="#section-9">9</a>. Typed Wildcard for mLDP FEC Element ............................<a href="#page-32">32</a>
   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-32">32</a>
   <a href="#section-11">11</a>. IANA Considerations ...........................................<a href="#page-33">33</a>
   <a href="#section-12">12</a>. Acknowledgments ...............................................<a href="#page-34">34</a>
   <a href="#section-13">13</a>. Contributing Authors ..........................................<a href="#page-35">35</a>
   <a href="#section-14">14</a>. References ....................................................<a href="#page-37">37</a>
      <a href="#section-14.1">14.1</a>. Normative References .....................................<a href="#page-37">37</a>
      <a href="#section-14.2">14.2</a>. Informative References ...................................<a href="#page-37">37</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The LDP protocol is described in [<a href="rfc5036.html" title='"LDP Specification"'>RFC5036</a>].  It defines mechanisms
   for setting up point-to-point (P2P) and multipoint-to-point (MP2P)
   LSPs in the network.  This document describes extensions to LDP for
   setting up point-to-multipoint (P2MP) and multipoint-to-multipoint
   (MP2MP) LSPs.  These are collectively referred to as multipoint LSPs
   (MP LSPs).  A P2MP LSP allows traffic from a single root (or ingress)
   node to be delivered to a number of leaf (or egress) nodes.  An MP2MP
   LSP allows traffic from multiple ingress nodes to be delivered to
   multiple egress nodes.  Only a single copy of the packet will be sent
   to an LDP neighbor traversed by the MP LSP.  This is accomplished
   without the use of a multicast protocol in the network.  There can be




<span class="grey">Wijnands, et al.             Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   several MP LSPs rooted at a given ingress node, each with its own
   identifier.

   The solution assumes that the leaf nodes of the MP LSP know the root
   node and identifier of the MP LSP to which they belong.  The
   mechanisms for the distribution of this information are outside the
   scope of this document.  The specification of how an application can
   use an MP LSP signaled by LDP is also outside the scope of this
   document.

   Related documents that may be of interest include [<a href="rfc6348.html" title='"Requirements for Point-to-Multipoint Extensions to the Label Distribution Protocol"'>RFC6348</a>],
   [<a href="#ref-L3VPN-MCAST">L3VPN-MCAST</a>], and [<a href="rfc4875.html" title='"Extensions to Resource Reservation Protocol - Traffic Engineering (RSVP-TE) for Point-to- Multipoint TE Label Switched Paths (LSPs)"'>RFC4875</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   All new fields shown as "reserved" in this document MUST be set to
   zero on transmission and MUST be ignored on receipt.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terminology"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terminology</span>

   Some of the following terminology is taken from [<a href="rfc6348.html" title='"Requirements for Point-to-Multipoint Extensions to the Label Distribution Protocol"'>RFC6348</a>].

   mLDP:  Multipoint extensions for LDP.

   P2P LSP:  An LSP that has one Ingress LSR and one Egress LSR.

   P2MP LSP:  An LSP that has one Ingress LSR and one or more Egress
      LSRs.

   MP2P LSP:  An LSP that has one or more Ingress LSRs and one unique
      Egress LSR.

   MP2MP LSP:  An LSP with a distinguished root node that connects a set
      of nodes, such that traffic sent by any node in the LSP is
      delivered to all others.

   MP LSP:  A multipoint LSP, either a P2MP or an MP2MP LSP.

   Ingress LSR:  An Ingress LSR for a particular LSP is an LSR that can
      send a data packet along the LSP.  MP2MP LSPs can have multiple
      Ingress LSRs, P2MP LSPs have just one, and that node is often
      referred to as the "root node".





<span class="grey">Wijnands, et al.             Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   Egress LSR:  An Egress LSR for a particular LSP is an LSR that can
      remove a data packet from that LSP for further processing.  P2P
      and MP2P LSPs have only a single egress node, but P2MP and MP2MP
      LSPs can have multiple egress nodes.

   Transit LSR:  An LSR that has reachability to the root of the MP LSP
      via a directly connected upstream LSR and one or more directly
      connected downstream LSRs.

   Bud LSR:  An LSR that is an egress but also has one or more directly
      connected downstream LSRs.

   Leaf node:  A leaf node can be either an Egress or Bud LSR when
      referred to in the context of a P2MP LSP.  In the context of an
      MP2MP LSP, a leaf is both Ingress and Egress for the same MP2MP
      LSP and can also be a Bud LSR.

   CRC32:  This contains a Cyclic Redundancy Check value of the
      uncompressed data in network byte order computed according to
      CRC-32 algorithm used in the ISO 3309 standard [<a href="#ref-ISO3309" title='"ISO Information Processing Systems - Data Communication - High-Level Data Link Control Procedure - Frame Structure"'>ISO3309</a>] and in
      <a href="#section-8.1.1.6.2">Section 8.1.1.6.2</a> of ITU-T recommendation V.42 [<a href="#ref-ITU.V42.1994">ITU.V42.1994</a>].

   FEC:    Forwarding Equivalence Class

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20Manageability"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  Manageability</span>

   MPLS LSRs can be modeled and managed using the MIB module defined in
   [<a href="rfc3813.html" title='"Multiprotocol Label Switching (MPLS) Label Switching Router (LSR) Management Information Base (MIB)"'>RFC3813</a>].  That MIB module is fully capable of handling the one-to-
   many in-segment to out-segment relationships needed to support P2MP
   LSPs, and no further changes are required.

   [<a id="ref-RFC3815" name="ref-RFC3815">RFC3815</a>] defines managed objects for LDP.  The MIB module allows the
   modeling and management of LDP and LDP speakers for the protocol as
   defined in [<a href="rfc5036.html" title='"LDP Specification"'>RFC5036</a>].  The protocol extensions defined in this
   document to support P2MP in LDP may require an additional MIB module
   or extensions to the modules defined in [<a href="rfc3815.html" title='"Definitions of Managed Objects for the Multiprotocol Label Switching (MPLS), Label Distribution Protocol (LDP)"'>RFC3815</a>].  This is for
   future study, and at the time of this writing, no interest has been
   expressed in this work.

   Future manageability work should pay attention to the protocol
   extensions defined in this document, and specifically the
   configurable and variable elements, along with reporting the new
   protocol fields that identify individual P2MP LSPs.








<span class="grey">Wijnands, et al.             Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Setting%20Up%20P2MP%20LSPs%20with%20LDP"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Setting Up P2MP LSPs with LDP</span>

   A P2MP LSP consists of a single root node, zero or more transit
   nodes, and one or more leaf nodes.  Leaf nodes initiate P2MP LSP
   setup and tear-down.  Leaf nodes also install forwarding state to
   deliver the traffic received on a P2MP LSP to wherever it needs to
   go; how this is done is outside the scope of this document.  Transit
   nodes install MPLS forwarding state and propagate the P2MP LSP setup
   (and tear-down) toward the root.  The root node installs forwarding
   state to map traffic into the P2MP LSP; how the root node determines
   which traffic should go over the P2MP LSP is outside the scope of
   this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Support%20for%20P2MP%20LSP%20Setup%20with%20LDP"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Support for P2MP LSP Setup with LDP</span>

   Support for the setup of P2MP LSPs is advertised using LDP
   capabilities as defined in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>].  An implementation supporting
   the P2MP procedures specified in this document MUST implement the
   procedures for Capability Parameters in Initialization messages.

   A new Capability Parameter TLV is defined, the P2MP Capability.
   Following is the format of the P2MP Capability Parameter.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1|0| P2MP Capability (0x0508)  |      Length (= 1)             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |S| Reserved    |
      +-+-+-+-+-+-+-+-+

   S: As specified in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>]

   The P2MP Capability TLV MUST be advertised in the LDP Initialization
   message.  Advertisement of the P2MP Capability indicates support of
   the procedures for P2MP LSP setup detailed in this document.  If the
   peer has not advertised the corresponding capability, then label
   messages using the P2MP FEC Element SHOULD NOT be sent to the peer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20The%20P2MP%20FEC%20Element"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  The P2MP FEC Element</span>

   For the setup of a P2MP LSP with LDP, we define one new protocol
   entity, the P2MP FEC Element, to be used as a FEC Element in the FEC
   TLV.  Note that the P2MP FEC Element does not necessarily identify
   the traffic that must be mapped to the LSP, so from that point of
   view, the use of the term FEC is a misnomer.  The description of the
   P2MP FEC Element follows.




<span class="grey">Wijnands, et al.             Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   The P2MP FEC Element consists of the address of the root of the P2MP
   LSP and an opaque value.  The opaque value consists of one or more
   LDP MP opaque value elements.  The opaque value is unique within the
   context of the root node.  The combination of (Root Node Address
   type, Root Node Address, Opaque Value) uniquely identifies a P2MP LSP
   within the MPLS network.

   The P2MP FEC Element is encoded as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |P2MP Type(0x06)|        Address Family         | Address Length|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ~                       Root Node Address                       ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Opaque Length              |    Opaque Value ...           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
      ~                                                               ~
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type:  The type of the P2MP FEC Element is 0x06.

   Address Family:  Two octet quantity containing a value from IANA's
      "Address Family Numbers" registry that encodes the address family
      for the Root LSR Address.

   Address Length:  Length of the Root LSR Address in octets.

   Root Node Address:  A host address encoded according to the Address
      Family field.

   Opaque Length:  The length of the opaque value, in octets.

   Opaque Value:  One or more MP opaque value elements, uniquely
      identifying the P2MP LSP in the context of the root node.  This is
      described in the next section.

   If the Address Family is IPv4, the Address Length MUST be 4; if the
   Address Family is IPv6, the Address Length MUST be 16.  No other
   Address Lengths are defined at present.







<span class="grey">Wijnands, et al.             Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   If the Address Length doesn't match the defined length for the
   Address Family, the receiver SHOULD abort processing the message
   containing the FEC Element, and send an "Unknown FEC" Notification
   message to its LDP peer signaling an error.

   If a FEC TLV contains a P2MP FEC Element, the P2MP FEC Element MUST
   be the only FEC Element in the FEC TLV.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20The%20LDP%20MP%20Opaque%20Value%20Element"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  The LDP MP Opaque Value Element</span>

   The LDP MP opaque value element is used in the P2MP and MP2MP FEC
   Elements defined in subsequent sections.  It carries information that
   is meaningful to Ingress LSRs and Leaf LSRs, but need not be
   interpreted by Transit LSRs.

   The LDP MP opaque value element basic type is encoded as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Type &lt; 255    | Length                        | Value ...     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
      ~                                                               ~
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type:  The Type of the LDP MP opaque value element.  IANA maintains a
      registry of basic types (see <a href="#section-11">Section 11</a>).

   Length:  The length of the Value field, in octets.

   Value:  String of Length octets, to be interpreted as specified by
      the Type field.
















<span class="grey">Wijnands, et al.             Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   The LDP MP opaque value element extended type is encoded as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Type = 255    |        Extended Type          | Length (high) |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
      | Length (low)  |                Value                          |
      +-+-+-+-+-+-+-+-+                                               |
      ~                                                               ~
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type:  Type = 255.

   Extended Type:  The Extended Type of the LDP MP opaque value element.
      IANA maintains a registry of extended types (see <a href="#section-11">Section 11</a>).

   Length:  The length of the Value field, in octets.

   Value:  String of Length octets, to be interpreted as specified by
      the Type field.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.1.%20%20The%20Generic%20LSP%20Identifier"></a><a class="selflink" href="#section-2.3.1" name="section-2.3.1">2.3.1</a>.  The Generic LSP Identifier</span>

   The generic LSP identifier is a type of opaque value element basic
   type encoded as follows:

   Type:  1

   Length:  4

   Value:  A 32-bit integer, unique in the context of the root, as
      identified by the root's address.

   This type of opaque value element is recommended when mapping of
   traffic to LSPs is non-algorithmic and is done by means outside LDP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Using%20the%20P2MP%20FEC%20Element"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Using the P2MP FEC Element</span>

   This section defines the rules for the processing and propagation of
   the P2MP FEC Element.  The following notation is used in the
   processing rules:

   1. P2MP FEC Element &lt;X, Y&gt;: a FEC Element with root node address X
      and opaque value Y.



<span class="grey">Wijnands, et al.             Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   2. P2MP Label Mapping &lt;X, Y, L&gt;: a Label Mapping message with a FEC
      TLV with a single P2MP FEC Element &lt;X, Y&gt; and Label TLV with label
      L.  Label L MUST be allocated from the per-platform label space
      (see <a href="rfc3031.html#section-3.14">[RFC3031], Section 3.14</a>) of the LSR sending the Label Mapping
      message.  The use of the interface label space is outside the
      scope of this document.

   3. P2MP Label Withdraw &lt;X, Y, L&gt;: a Label Withdraw message with a FEC
      TLV with a single P2MP FEC Element &lt;X, Y&gt; and Label TLV with label
      L.

   4. P2MP LSP &lt;X, Y&gt; (or simply &lt;X, Y&gt;): a P2MP LSP with root node
      address X and opaque value Y.

   5. The notation L' -&gt; {&lt;I1, L1&gt; &lt;I2, L2&gt; ..., &lt;In, Ln&gt;} on LSR X
      means that on receiving a packet with label L', X makes n copies
      of the packet.  For copy i of the packet, X swaps L' with Li and
      sends it out over interface Ii.

   The procedures below are organized by the role that the node plays in
   the P2MP LSP.  Node Z knows that it is a leaf node by a discovery
   process that is outside the scope of this document.  During the
   course of protocol operation, the root node recognizes its role
   because it owns the root node address.  A transit node is any node
   (other than the root node) that receives a P2MP Label Mapping message
   (i.e., one that has leaf nodes downstream of it).

   Note that a transit node (and indeed the root node) may also be a
   leaf node.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.%20%20Label%20Mapping"></a><a class="selflink" href="#section-2.4.1" name="section-2.4.1">2.4.1</a>.  Label Mapping</span>

   The remainder of this section specifies the procedures for
   originating P2MP Label Mapping messages and for processing received
   P2MP Label Mapping messages for a particular LSP.  The procedures for
   a particular LSR depend upon the role that LSR plays in the LSP
   (Ingress, Transit, or Egress).

   All labels discussed here are downstream-assigned [<a href="rfc5332.html" title='"MPLS Multicast Encapsulations"'>RFC5332</a>] except
   those that are assigned using the procedures of <a href="#section-6">Section 6</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.1.%20%20Determining%20One%27s%20%27upstream%20LSR%27"></a><a class="selflink" href="#section-2.4.1.1" name="section-2.4.1.1">2.4.1.1</a>.  Determining One's 'upstream LSR'</span>

   Each node that is either an Leaf or Transit LSR of MP LSP needs to
   use the procedures below to select an upstream LSR.  A node Z that
   wants to join an MP LSP &lt;X, Y&gt; determines the LDP peer U that is Z's
   next-hop on the best path from Z to the root node X.  If there is




<span class="grey">Wijnands, et al.             Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   more than one such LDP peer, only one of them is picked.  U is Z's
   "upstream LSR" for &lt;X, Y&gt;.

   When there are several candidate upstream LSRs, the LSR MUST select
   one upstream LSR.  The algorithm used for the LSR selection is a
   local matter.  If the LSR selection is done over a LAN interface and
   the <a href="#section-6">Section 6</a> procedures are applied, the following procedure SHOULD
   be applied to ensure that the same upstream LSR is elected among a
   set of candidate receivers on that LAN.

   1. The candidate upstream LSRs are numbered from lower to higher IP
      address.

   2. The following hash is performed: H = (CRC32(Opaque Value)) modulo
      N, where N is the number of upstream LSRs.  The 'Opaque Value' is
      the field identified in the FEC Element right after 'Opaque
      Length'.  The 'Opaque Length' indicates the size of the opaque
      value used in this calculation.

   3. The selected upstream LSR U is the LSR that has the number H.

   This procedure will ensure that there is a single forwarder over the
   LAN for a particular LSP.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.2.%20%20Determining%20the%20Forwarding%20Interface%20to%20an%20LSR"></a><a class="selflink" href="#section-2.4.1.2" name="section-2.4.1.2">2.4.1.2</a>.  Determining the Forwarding Interface to an LSR</span>

   Suppose LSR U receives an MP Label Mapping message from a downstream
   LSR D, specifying label L.  Suppose further that U is connected to D
   over several LDP enabled interfaces or RSVP-TE Tunnel interfaces.  If
   U needs to transmit to D a data packet whose top label is L, U is
   free to transmit the packet on any of those interfaces.  The
   algorithm it uses to choose a particular interface and next-hop for a
   particular such packet is a local matter.  For completeness, the
   following procedure MAY be used.  LSR U may do a lookup in the
   unicast routing table to find the best interface and next-hop to
   reach LSR D. If the next-hop and interface are also advertised by LSR
   D via the LDP session, it can be used to transmit the packet to LSR
   D.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.3.%20%20Leaf%20Operation"></a><a class="selflink" href="#section-2.4.1.3" name="section-2.4.1.3">2.4.1.3</a>.  Leaf Operation</span>

   A leaf node Z of P2MP LSP &lt;X, Y&gt; determines its upstream LSR U for
   &lt;X, Y&gt; as per <a href="#section-2.4.1.1">Section 2.4.1.1</a>, allocates a label L, and sends a P2MP
   Label Mapping &lt;X, Y, L&gt; to U.







<span class="grey">Wijnands, et al.             Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.4.%20%20Transit%20Node%20Operation"></a><a class="selflink" href="#section-2.4.1.4" name="section-2.4.1.4">2.4.1.4</a>.  Transit Node Operation</span>

   Suppose a transit node Z receives a P2MP Label Mapping &lt;X, Y, L&gt; from
   LSR T.  Z checks whether it already has state for &lt;X, Y&gt;.  If not, Z
   determines its upstream LSR U for &lt;X, Y&gt; as per <a href="#section-2.4.1.1">Section 2.4.1.1</a>.
   Using this Label Mapping to update the label forwarding table MUST
   NOT be done as long as LSR T is equal to LSR U.  If LSR U is
   different from LSR T, Z will allocate a label L', and install state
   to swap L' with L over interface I associated with LSR T and send a
   P2MP Label Mapping &lt;X, Y, L'&gt; to LSR U.  Interface I is determined
   via the procedures in <a href="#section-2.4.1.2">Section 2.4.1.2</a>.

   If Z already has state for &lt;X, Y&gt;, then Z does not send a Label
   Mapping message for P2MP LSP &lt;X, Y&gt;.  If LSR T is not equal to the
   upstream LSR of &lt;X, Y&gt; and &lt;I, L&gt; does not already exist as
   forwarding state, the forwarding state is updated.  Assuming its old
   forwarding state was L'-&gt; {&lt;I1, L1&gt; &lt;I2, L2&gt; ..., &lt;In, Ln&gt;}, its new
   forwarding state becomes L'-&gt; {&lt;I1, L1&gt; &lt;I2, L2&gt; ..., &lt;In, Ln&gt;, &lt;I,
   L&gt;}.  If LSR T is equal to the installed upstream LSR, the Label
   Mapping from LSR T MUST be retained and MUST NOT update the label
   forwarding table.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.1.5.%20%20Root%20Node%20Operation"></a><a class="selflink" href="#section-2.4.1.5" name="section-2.4.1.5">2.4.1.5</a>.  Root Node Operation</span>

   Suppose the root node Z receives a P2MP Label Mapping &lt;X, Y, L&gt; from
   LSR T.  Z checks whether it already has forwarding state for &lt;X, Y&gt;.
   If not, Z creates forwarding state to push label L onto the traffic
   that Z wants to forward over the P2MP LSP (how this traffic is
   determined is outside the scope of this document).

   If Z already has forwarding state for &lt;X, Y&gt;, then Z adds "push label
   L, send over interface I" to the next hop, where I is the interface
   associated with LSR T and determined via the procedures in <a href="#section-2.4.1.2">Section</a>
   <a href="#section-2.4.1.2">2.4.1.2</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.2.%20%20Label%20Withdraw"></a><a class="selflink" href="#section-2.4.2" name="section-2.4.2">2.4.2</a>.  Label Withdraw</span>

   The following section lists procedures for generating and processing
   P2MP Label Withdraw messages for nodes that participate in a P2MP
   LSP.  An LSR should apply those procedures that apply to it, based on
   its role in the P2MP LSP.










<span class="grey">Wijnands, et al.             Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.2.1.%20%20Leaf%20Operation"></a><a class="selflink" href="#section-2.4.2.1" name="section-2.4.2.1">2.4.2.1</a>.  Leaf Operation</span>

   If a leaf node Z discovers that it has no downstream neighbors in
   that LSP, and that it has no need to be an Egress LSR for that LSP
   (by means outside the scope of this document), then it SHOULD send a
   Label Withdraw &lt;X, Y, L&gt; to its upstream LSR U for &lt;X, Y&gt;, where L is
   the label it had previously advertised to U for &lt;X, Y&gt;.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.2.2.%20%20Transit%20Node%20Operation"></a><a class="selflink" href="#section-2.4.2.2" name="section-2.4.2.2">2.4.2.2</a>.  Transit Node Operation</span>

   If a transit node Z receives a Label Withdraw message &lt;X, Y, L&gt; from
   a node W, it deletes label L from its forwarding state and sends a
   Label Release message with label L to W.

   If deleting L from Z's forwarding state for P2MP LSP &lt;X, Y&gt; results
   in no state remaining for &lt;X, Y&gt;, then Z propagates the Label
   Withdraw for &lt;X, Y&gt; to its upstream T, by sending a Label Withdraw
   &lt;X, Y, L1&gt; where L1 is the label Z had previously advertised to T for
   &lt;X, Y&gt;.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.4.2.3.%20%20Root%20Node%20Operation"></a><a class="selflink" href="#section-2.4.2.3" name="section-2.4.2.3">2.4.2.3</a>.  Root Node Operation</span>

   When the root node of a P2MP LSP receives a Label Withdraw message,
   the procedures are the same as those for transit nodes, except that
   it would not propagate the Label Withdraw upstream (as it has no
   upstream).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.4.3.%20%20Upstream%20LSR%20Change"></a><a class="selflink" href="#section-2.4.3" name="section-2.4.3">2.4.3</a>.  Upstream LSR Change</span>

   Suppose that for a given node Z participating in a P2MP LSP &lt;X, Y&gt;,
   the upstream LSR changes from U to U' as per <a href="#section-2.4.1.1">Section 2.4.1.1</a>.  Z MUST
   update its forwarding state as follows.  It allocates a new label,
   L', for &lt;X, Y&gt;.  The forwarding state for L' is copied from the
   forwarding state for L, with one exception: if U' was present in the
   forwarding state of L, it MUST NOT be installed in the forwarding
   state of L'.  Then the forwarding state for L is deleted and the
   forwarding state for L' is installed.  In addition, Z MUST send a
   Label Mapping &lt;X, Y, L'&gt; to U' and send a Label Withdraw &lt;X, Y, L&gt; to
   U.  Note, if there was a downstream mapping from U that was not
   installed in the forwarding due to the procedures defined in <a href="#section-2.4.1.4">Section</a>
   <a href="#section-2.4.1.4">2.4.1.4</a>, it can now be installed.

   While changing the upstream LSR, the following must be taken into
   consideration.  If L' is added before L is removed, there is a
   potential risk of packet duplication and/or the creation of a
   transient data-plane forwarding loop.  If L is removed before L' is
   added, packet loss may result.  Ideally the change from L to L' is
   done atomically such that no packet loss or duplication occurs.  If



<span class="grey">Wijnands, et al.             Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   that is not possible, the RECOMMENDED default behavior is to remove L
   before adding L'.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Setting%20up%20MP2MP%20LSPs%20with%20LDP"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Setting up MP2MP LSPs with LDP</span>

   An MP2MP LSP is much like a P2MP LSP in that it consists of a single
   root node, zero or more transit nodes, and one or more Leaf LSRs
   acting equally an as Ingress or Egress LSR.  A leaf node participates
   in the setup of an MP2MP LSP by establishing both a downstream LSP,
   which is much like a P2MP LSP from the root, and an upstream LSP,
   which is used to send traffic toward the root and other leaf nodes.
   Transit nodes support the setup by propagating the upstream and
   downstream LSP setup toward the root and installing the necessary
   MPLS forwarding state.  The transmission of packets from the root
   node of an MP2MP LSP to the receivers is identical to that for a P2MP
   LSP.  Traffic from a downstream node follows the upstream LSP toward
   the root node and branches downward along the downstream LSP as
   required to reach other leaf nodes.  A packet that is received from a
   downstream node MUST never be forwarded back out to that same node.
   Mapping traffic to the MP2MP LSP may happen at any leaf node.  How
   that mapping is established is outside the scope of this document.

   Due to how an MP2MP LSP is built, a Leaf LSR that is sending packets
   on the MP2MP LSP does not receive its own packets.  There is also no
   additional mechanism needed on the root or Transit LSR to match
   upstream traffic to the downstream forwarding state.  Packets that
   are forwarded over an MP2MP LSP will not traverse a link more than
   once, with the possible exception of LAN links (see <a href="#section-3.3.1">Section 3.3.1</a>),
   if the procedures of [<a href="rfc5331.html" title='"MPLS Upstream Label Assignment and Context-Specific Label Space"'>RFC5331</a>] are not provided.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Support%20for%20MP2MP%20LSP%20Setup%20with%20LDP"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Support for MP2MP LSP Setup with LDP</span>

   Support for the setup of MP2MP LSPs is advertised using LDP
   capabilities as defined in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>].  An implementation supporting
   the MP2MP procedures specified in this document MUST implement the
   procedures for Capability Parameters in Initialization messages.

   A new Capability Parameter TLV is defined, the MP2MP Capability.
   Following is the format of the MP2MP Capability Parameter.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1|0| MP2MP Capability (0x0509) |      Length (= 1)             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |S| Reserved    |
      +-+-+-+-+-+-+-+-+




<span class="grey">Wijnands, et al.             Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   S: As specified in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>]

   The MP2MP Capability TLV MUST be advertised in the LDP Initialization
   message.  Advertisement of the MP2MP Capability indicates support of
   the procedures for MP2MP LSP setup detailed in this document.  If the
   peer has not advertised the corresponding capability, then label
   messages using the MP2MP upstream and downstream FEC Elements SHOULD
   NOT be sent to the peer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20The%20MP2MP%20Downstream%20and%20Upstream%20FEC%20Elements"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  The MP2MP Downstream and Upstream FEC Elements</span>

   For the setup of an MP2MP LSP with LDP, we define 2 new protocol
   entities, the MP2MP downstream FEC and upstream FEC Element.  Both
   elements will be used as FEC Elements in the FEC TLV.  Note that the
   MP2MP FEC Elements do not necessarily identify the traffic that must
   be mapped to the LSP, so from that point of view, the use of the term
   FEC is a misnomer.  The description of the MP2MP FEC Elements follow.

   The structure, encoding, and error handling for the MP2MP downstream
   and upstream FEC Elements are the same as for the P2MP FEC Element
   described in <a href="#section-2.2">Section 2.2</a>.  The difference is that two new FEC types
   are used: MP2MP downstream type (0x08) and MP2MP upstream type
   (0x07).

   If a FEC TLV contains an MP2MP FEC Element, the MP2MP FEC Element
   MUST be the only FEC Element in the FEC TLV.

   Note, except when using the procedures of [<a href="rfc5331.html" title='"MPLS Upstream Label Assignment and Context-Specific Label Space"'>RFC5331</a>], the MPLS labels
   used are "downstream-assigned" [<a href="rfc5332.html" title='"MPLS Multicast Encapsulations"'>RFC5332</a>], even if they are bound to
   the "upstream FEC Element".

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Using%20the%20MP2MP%20FEC%20Elements"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Using the MP2MP FEC Elements</span>

   This section defines the rules for the processing and propagation of
   the MP2MP FEC Elements.  The following notation is used in the
   processing rules:

   1.  MP2MP downstream LSP &lt;X, Y&gt; (or simply downstream &lt;X, Y&gt;): an
       MP2MP LSP downstream path with root node address X and opaque
       value Y.

   2.  MP2MP upstream LSP &lt;X, Y, D&gt; (or simply upstream &lt;X, Y, D&gt;): an
       MP2MP LSP upstream path for downstream node D with root node
       address X and opaque value Y.

   3.  MP2MP downstream FEC Element &lt;X, Y&gt;: a FEC Element with root node
       address X and opaque value Y used for a downstream MP2MP LSP.




<span class="grey">Wijnands, et al.             Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   4.  MP2MP upstream FEC Element &lt;X, Y&gt;: a FEC Element with root node
       address X and opaque value Y used for an upstream MP2MP LSP.

   5.  MP2MP-D Label Mapping &lt;X, Y, L&gt;: a Label Mapping message with a
       FEC TLV with a single MP2MP downstream FEC Element &lt;X, Y&gt; and
       label TLV with label L.  Label L MUST be allocated from the per-
       platform label space (see <a href="rfc3031.html#section-3.14">[RFC3031], Section 3.14</a>) of the LSR
       sending the Label Mapping message.  The use of the interface
       label space is outside the scope of this document.

   6.  MP2MP-U Label Mapping &lt;X, Y, Lu&gt;: a Label Mapping message with a
       FEC TLV with a single MP2MP upstream FEC Element &lt;X, Y&gt; and label
       TLV with label Lu.  Label Lu MUST be allocated from the per-
       platform label space (see <a href="rfc3031.html#section-3.14">[RFC3031], Section 3.14</a>) of the LSR
       sending the Label Mapping message.  The use of the interface
       label space is outside the scope of this document.

   7.  MP2MP-D Label Withdraw &lt;X, Y, L&gt;: a Label Withdraw message with a
       FEC TLV with a single MP2MP downstream FEC Element &lt;X, Y&gt; and
       label TLV with label L.

   8.  MP2MP-U Label Withdraw &lt;X, Y, Lu&gt;: a Label Withdraw message with
       a FEC TLV with a single MP2MP upstream FEC Element &lt;X, Y&gt; and
       label TLV with label Lu.

   9.  MP2MP-D Label Release &lt;X, Y, L&gt;: a Label Release message with a
       FEC TLV with a single MP2MP downstream FEC Element &lt;X, Y&gt; and
       Label TLV with label L.

   10. MP2MP-U Label Release &lt;X, Y, Lu&gt;: a Label Release message with a
       FEC TLV with a single MP2MP upstream FEC Element &lt;X, Y&gt; and label
       TLV with label Lu.

   The procedures below are organized by the role which the node plays
   in the MP2MP LSP.  Node Z knows that it is a leaf node by a discovery
   process that is outside the scope of this document.  During the
   course of the protocol operation, the root node recognizes its role
   because it owns the root node address.  A transit node is any node
   (other then the root node) that receives an MP2MP Label Mapping
   message (i.e., one that has leaf nodes downstream of it).

   Note that a transit node (and indeed the root node) may also be a
   leaf node and the root node does not have to be an Ingress LSR or a
   leaf of the MP2MP LSP.







<span class="grey">Wijnands, et al.             Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20%20MP2MP%20Label%20Mapping"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>.  MP2MP Label Mapping</span>

   The remainder of this section specifies the procedures for
   originating MP2MP Label Mapping messages and for processing received
   MP2MP Label Mapping messages for a particular LSP.  The procedures
   for a particular LSR depend upon the role that the LSR plays in the
   LSP (Ingress, Transit, or Egress).

   All labels discussed here are downstream-assigned [<a href="rfc5332.html" title='"MPLS Multicast Encapsulations"'>RFC5332</a>] except
   those that are assigned using the procedures of <a href="#section-6">Section 6</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.1.%20%20Determining%20one%27s%20upstream%20MP2MP%20LSR"></a><a class="selflink" href="#section-3.3.1.1" name="section-3.3.1.1">3.3.1.1</a>.  Determining one's upstream MP2MP LSR</span>

   Determining the upstream LDP peer U for an MP2MP LSP &lt;X, Y&gt; follows
   the procedure for a P2MP LSP described in <a href="#section-2.4.1.1">Section 2.4.1.1</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.2.%20%20Determining%20One%27s%20Downstream%20MP2MP%20LSR"></a><a class="selflink" href="#section-3.3.1.2" name="section-3.3.1.2">3.3.1.2</a>.  Determining One's Downstream MP2MP LSR</span>

   An LDP peer U that receives an MP2MP-D Label Mapping from an LDP peer
   D will treat D as downstream MP2MP LSR.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.3.%20%20Installing%20the%20Upstream%20Path%20of%20an%20MP2MP%20LSP"></a><a class="selflink" href="#section-3.3.1.3" name="section-3.3.1.3">3.3.1.3</a>.  Installing the Upstream Path of an MP2MP LSP</span>

   There are two methods for installing the upstream path of an MP2MP
   LSP to a downstream neighbor.

   1. We can install the upstream MP2MP path (to a downstream neighbor)
      based on receiving an MP2MP-D Label Mapping from the downstream
      neighbor.  This will install the upstream path on a hop-by-hop
      basis.

   2. We install the upstream MP2MP path (to a downstream neighbor)
      based on receiving an MP2MP-U Label Mapping from the upstream
      neighbor.  An LSR does not need to wait for the MP2MP-U Label
      Mapping if it is the root of the MP2MP LSP or if it already
      received an MP2MP-U Label Mapping from the upstream neighbor.  We
      call this method ordered mode.  The typical result of this mode is
      that the downstream path of the MP2MP is built hop by hop towards
      the root.  Once the root is reached, the root node will trigger an
      MP2MP-U Label Mapping to the downstream neighbor(s).

   For setting up the upstream path of an MP2MP LSP, ordered mode SHOULD
   be used.  Due to ordered mode, the upstream path of the MP2MP LSP is
   installed at the leaf node once the path to the root has completed.
   The advantage is that when a leaf starts sending immediately after
   the upstream path is installed, packets are able to reach the root





<span class="grey">Wijnands, et al.             Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   node without being dropped due to an incomplete LSP.  Method 1 is not
   able to guarantee that the upstream path has completed before the
   leaf starts sending.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.4.%20%20MP2MP%20Leaf%20Node%20Operation"></a><a class="selflink" href="#section-3.3.1.4" name="section-3.3.1.4">3.3.1.4</a>.  MP2MP Leaf Node Operation</span>

   A leaf node Z of an MP2MP LSP &lt;X, Y&gt; determines its upstream LSR U
   for &lt;X, Y&gt; as per <a href="#section-3.3.1.1">Section 3.3.1.1</a>, allocates a label L, and sends an
   MP2MP-D Label Mapping &lt;X, Y, L&gt; to U.

   Leaf node Z expects an MP2MP-U Label Mapping &lt;X, Y, Lu&gt; from node U
   in response to the MP2MP-D Label Mapping it sent to node U.  Z checks
   whether it already has forwarding state for upstream &lt;X, Y&gt;.  If not,
   Z creates forwarding state to push label Lu onto the traffic that Z
   wants to forward over the MP2MP LSP.  How it determines what traffic
   to forward on this MP2MP LSP is outside the scope of this document.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.5.%20%20MP2MP%20Transit%20Node%20Operation"></a><a class="selflink" href="#section-3.3.1.5" name="section-3.3.1.5">3.3.1.5</a>.  MP2MP Transit Node Operation</span>

   Suppose node Z receives an MP2MP-D Label Mapping &lt;X, Y, L&gt; from LSR
   D.  Z checks whether it has forwarding state for downstream &lt;X, Y&gt;.
   If not, Z determines its upstream LSR U for &lt;X, Y&gt; as per <a href="#section-3.3.1.1">Section</a>
   <a href="#section-3.3.1.1">3.3.1.1</a>.  Using this Label Mapping to update the label forwarding
   table MUST NOT be done as long as LSR D is equal to LSR U.  If LSR U
   is different from LSR D, Z will allocate a label L' and install
   downstream forwarding state to swap label L' with label L over
   interface I associated with LSR D and send an MP2MP-D Label Mapping
   &lt;X, Y, L'&gt; to U.  Interface I is determined via the procedures in
   <a href="#section-2.4.1.2">Section 2.4.1.2</a>.

   If Z already has forwarding state for downstream &lt;X, Y&gt;, all that Z
   needs to do in this case is check that LSR D is not equal to the
   upstream LSR of &lt;X, Y&gt; and update its forwarding state.  Assuming its
   old forwarding state was L'-&gt; {&lt;I1, L1&gt; &lt;I2, L2&gt; ..., &lt;In, Ln&gt;}, its
   new forwarding state becomes L'-&gt; {&lt;I1, L1&gt; &lt;I2, L2&gt; ..., &lt;In, Ln&gt;,
   &lt;I, L&gt;}.  If the LSR D is equal to the installed upstream LSR, the
   Label Mapping from LSR D MUST be retained and MUST NOT update the
   label forwarding table.

   Node Z checks if upstream LSR U already assigned a label Lu to
   &lt;X, Y&gt;.  If not, transit node Z waits until it receives an MP2MP-U
   Label Mapping &lt;X, Y, Lu&gt; from LSR U (see <a href="#section-3.3.1.3">Section 3.3.1.3</a>).  Once the
   MP2MP-U Label Mapping is received from LSR U, node Z checks whether
   it already has forwarding state upstream &lt;X, Y, D&gt;.  If it does, then
   no further action needs to happen.  If it does not, it allocates a
   label Lu' and creates a new label swap for Lu' with label Lu over
   interface Iu.  Interface Iu is determined via the procedures in
   <a href="#section-2.4.1.2">Section 2.4.1.2</a>.  In addition, it also adds the label swap(s) from



<span class="grey">Wijnands, et al.             Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   the forwarding state downstream &lt;X, Y&gt;, omitting the swap on
   interface I for node D.  The swap on interface I for node D is
   omitted to prevent a packet originated by D to be forwarded back to
   D.

   Node Z determines the downstream MP2MP LSR as per <a href="#section-3.3.1.2">Section 3.3.1.2</a>,
   and sends an MP2MP-U Label Mapping &lt;X, Y, Lu'&gt; to node D.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.6.%20%20MP2MP%20Root%20Node%20Operation"></a><a class="selflink" href="#section-3.3.1.6" name="section-3.3.1.6">3.3.1.6</a>.  MP2MP Root Node Operation</span>

<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.6.1.%20%20Root%20Node%20Is%20Also%20a%20Leaf"></a><a class="selflink" href="#section-3.3.1.6.1" name="section-3.3.1.6.1">3.3.1.6.1</a>.  Root Node Is Also a Leaf</span>

   Suppose root/leaf node Z receives an MP2MP-D Label Mapping &lt;X, Y, L&gt;
   from node D.  Z checks whether it already has forwarding state
   downstream &lt;X, Y&gt;.  If not, Z creates downstream forwarding state to
   push label L on traffic that Z wants to forward down the MP2MP LSP.
   How it determines what traffic to forward on this MP2MP LSP is
   outside the scope of this document.  If Z already has forwarding
   state for downstream &lt;X, Y&gt;, then Z will add the label push for L
   over interface I to it.  Interface I is determined via the procedures
   in <a href="#section-2.4.1.2">Section 2.4.1.2</a>.

   Node Z checks if it has forwarding state for upstream &lt;X, Y, D&gt;.  If
   not, Z allocates a label Lu' and creates upstream forwarding state to
   swap Lu' with the label swap(s) from the forwarding state downstream
   &lt;X, Y&gt;, except the swap on interface I for node D.  This allows
   upstream traffic to go down the MP2MP to other node(s), except the
   node from which the traffic was received.  Node Z determines the
   downstream MP2MP LSR as per section <a href="#section-3.3.1.2">Section 3.3.1.2</a>, and sends an
   MP2MP-U Label Mapping &lt;X, Y, Lu'&gt; to node D.  Since Z is the root of
   the tree, Z will not send an MP2MP-D Label Mapping and will not
   receive an MP2MP-U Label Mapping.

<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.6.2.%20%20Root%20Node%20is%20Not%20a%20Leaf"></a><a class="selflink" href="#section-3.3.1.6.2" name="section-3.3.1.6.2">3.3.1.6.2</a>.  Root Node is Not a Leaf</span>

   Suppose the root node Z receives an MP2MP-D Label Mapping &lt;X, Y, L&gt;
   from node D.  Z checks whether it already has forwarding state for
   downstream &lt;X, Y&gt;.  If not, Z creates downstream forwarding state and
   installs a outgoing label L over interface I.  Interface I is
   determined via the procedures in <a href="#section-2.4.1.2">Section 2.4.1.2</a>.  If Z already has
   forwarding state for downstream &lt;X, Y&gt;, then Z will add label L over
   interface I to the existing state.

   Node Z checks if it has forwarding state for upstream &lt;X, Y, D&gt;.  If
   not, Z allocates a label Lu' and creates forwarding state to swap Lu'
   with the label swap(s) from the forwarding state downstream &lt;X, Y&gt;,
   except the swap for node D.  This allows upstream traffic to go down
   the MP2MP to other node(s), except the node from which it was



<span class="grey">Wijnands, et al.             Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   received.  Root node Z determines the downstream MP2MP LSR D as per
   <a href="#section-3.3.1.2">Section 3.3.1.2</a>, and sends an MP2MP-U Label Mapping &lt;X, Y, Lu'&gt; to
   it.  Since Z is the root of the tree, Z will not send an MP2MP-D
   Label Mapping and will not receive an MP2MP-U Label Mapping.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20%20MP2MP%20Label%20Withdraw"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>.  MP2MP Label Withdraw</span>

   The following section lists procedures for generating and processing
   MP2MP Label Withdraw messages for nodes that participate in an MP2MP
   LSP.  An LSR should apply those procedures that apply to it, based on
   its role in the MP2MP LSP.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.1.%20%20MP2MP%20Leaf%20Operation"></a><a class="selflink" href="#section-3.3.2.1" name="section-3.3.2.1">3.3.2.1</a>.  MP2MP Leaf Operation</span>

   If a leaf node Z discovers (by means outside the scope of this
   document) that it has no downstream neighbors in that LSP and that it
   has no need to be an Egress LSR for that LSP (by means outside the
   scope of this document), then it SHOULD send an MP2MP-D Label
   Withdraw &lt;X, Y, L&gt; to its upstream LSR U for &lt;X, Y&gt;, where L is the
   label it had previously advertised to U for &lt;X,Y&gt;.  Leaf node Z will
   also send an unsolicited label release &lt;X, Y, Lu&gt; to U to indicate
   that the upstream path is no longer used and that label Lu can be
   removed.

   Leaf node Z expects the upstream router U to respond by sending a
   downstream label release for L.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.2.%20%20MP2MP%20Transit%20Node%20Operation"></a><a class="selflink" href="#section-3.3.2.2" name="section-3.3.2.2">3.3.2.2</a>.  MP2MP Transit Node Operation</span>

   If a transit node Z receives an MP2MP-D Label Withdraw message
   &lt;X, Y, L&gt; from node D, it deletes label L from its forwarding state
   downstream &lt;X, Y&gt; and from all its upstream states for &lt;X, Y&gt;.  Node
   Z sends an MP2MP-D Label Release message with label L to D.  Since
   node D is no longer part of the downstream forwarding state, Z cleans
   up the forwarding state upstream &lt;X, Y, D&gt;.  There is no need to send
   an MP2MP-U Label Withdraw &lt;X, Y, Lu&gt; to D because node D already
   removed Lu and sent a label release for Lu to Z.

   If deleting L from Z's forwarding state for downstream &lt;X, Y&gt; results
   in no state remaining for &lt;X, Y&gt;, then Z propagates the MP2MP-D Label
   Withdraw &lt;X, Y, L&gt; to its upstream node U for &lt;X, Y&gt; and will also
   send an unsolicited MP2MP-U Label Release &lt;X, Y, Lu&gt; to U to indicate
   that the upstream path is no longer used and that label Lu can be
   removed.







<span class="grey">Wijnands, et al.             Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.3.%20%20MP2MP%20Root%20Node%20Operation"></a><a class="selflink" href="#section-3.3.2.3" name="section-3.3.2.3">3.3.2.3</a>.  MP2MP Root Node Operation</span>

   When the root node of an MP2MP LSP receives an MP2MP-D Label Withdraw
   message, the procedure is the same as that for transit nodes, except
   that the root node will not propagate the Label Withdraw upstream (as
   it has no upstream).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.3.%20%20MP2MP%20Upstream%20LSR%20Change"></a><a class="selflink" href="#section-3.3.3" name="section-3.3.3">3.3.3</a>.  MP2MP Upstream LSR Change</span>

   The procedure for changing the upstream LSR is the same as documented
   in <a href="#section-2.4.3">Section 2.4.3</a>, except it is applied to MP2MP FECs, using the
   procedures described in <a href="#section-3.3.1">Section 3.3.1</a> through <a href="#section-3.3.2.3">Section 3.3.2.3</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Micro-Loops%20in%20MP%20LSPs"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Micro-Loops in MP LSPs</span>

   Micro-loops created by the unicast routing protocol during
   convergence may also effect mLDP MP LSPs.  Since the tree building
   logic in mLDP is based on unicast routing, a unicast routing loop may
   also result in a micro-loop in the MP LSPs.  Micro-loops that involve
   2 directly connected routers don't create a loop in mLDP.  mLDP is
   able to prevent this inconsistency by never allowing an upstream LDP
   neighbor to be added as a downstream LDP neighbor into the Label
   Forwarding Table (LFT) for the same FEC.  Micro-loops that involve
   more than 2 LSRs are not prevented.

   Micro-loops that involve more than 2 LSRs may create a micro-loop in
   the downstream path of either an MP2MP LSP or P2MP LSP and the
   upstream path of the MP2MP LSP.  The loops are transient and will
   disappear as soon as the unicast routing protocol converges and mLDP
   has updated the forwarding state accordingly.  Micro-loops that occur
   in the upstream path of an MP2MP LSP may be detected by including LDP
   path vector in the MP2MP-U Label Mapping messages.  These procedures
   are currently under investigation and are subjected to further study.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20The%20LDP%20MP%20Status%20TLV"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  The LDP MP Status TLV</span>

   An LDP MP capable router MAY use an LDP MP Status TLV to indicate
   additional status for an MP LSP to its remote peers.  This includes
   signaling to peers that are either upstream or downstream of the LDP
   MP capable router.  The value of the LDP MP Status TLV will remain
   opaque to LDP and MAY encode one or more status elements.










<span class="grey">Wijnands, et al.             Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   The LDP MP Status TLV is encoded as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1|0| LDP MP Status Type(0x096F)|            Length             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                           Value                               |
      ~                                                               ~
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   LDP MP Status Type:  The LDP MP Status (0x096F).

   Length:  Length of the LDP MP Status Value in octets.

   Value:  One or more LDP MP Status Value elements.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20The%20LDP%20MP%20Status%20Value%20Element"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  The LDP MP Status Value Element</span>

   The LDP MP Status Value Element that is included in the LDP MP Status
   TLV Value has the following encoding.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Type          | Length                        | Value ...     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
      ~                                                               ~
      |                                                               |
      |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type:  The type of the LDP MP Status Value Element.  IANA maintains a
      registry of status value types (see <a href="#section-11">Section 11</a>).

   Length:  The length of the Value field, in octets.

   Value:  String of Length octets, to be interpreted as specified by
      the Type field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20LDP%20Messages%20Containing%20LDP%20MP%20Status%20Messages"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  LDP Messages Containing LDP MP Status Messages</span>

   The LDP MP Status TLV may appear either in a Label Mapping message or
   an LDP Notification message.




<span class="grey">Wijnands, et al.             Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20LDP%20MP%20Status%20Sent%20in%20LDP%20Notification%20Messages"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  LDP MP Status Sent in LDP Notification Messages</span>

   An LDP MP Status TLV sent in a notification message must be
   accompanied with a Status TLV, as described in [<a href="rfc5036.html" title='"LDP Specification"'>RFC5036</a>].  The
   general format of the Notification message with an LDP MP Status TLV
   is:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |0|   Notification (0x0001)     |      Message Length           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Message ID                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Status TLV                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                   LDP MP Status TLV                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                 Optional LDP MP FEC TLV                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                 Optional Label TLV                            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   The Status TLV status code is used to indicate that LDP MP Status TLV
   and any additional information follows in the Notification message's
   "optional parameter" section.  Depending on the actual contents of
   the LDP MP Status TLV, an LDP P2MP or MP2MP FEC TLV and a Label TLV
   may also be present to provide context to the LDP MP Status TLV.

   Since the notification does not refer to any particular message, the
   Message ID and Message Type fields are set to 0.




















<span class="grey">Wijnands, et al.             Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20LDP%20MP%20Status%20TLV%20in%20Label%20Mapping%20Message"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  LDP MP Status TLV in Label Mapping Message</span>

   An example of the Label Mapping message defined in [<a href="rfc5036.html" title='"LDP Specification"'>RFC5036</a>] is shown
   below to illustrate the message with an Optional LDP MP Status TLV
   present.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |0|   Label Mapping (0x0400)    |      Message Length           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Message ID                                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     FEC TLV                                   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Label TLV                                 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Optional LDP MP Status TLV                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Additional Optional Parameters            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Upstream%20Label%20Allocation%20on%20a%20LAN"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Upstream Label Allocation on a LAN</span>

   On a LAN, the procedures so far discussed would require the upstream
   LSR to send a copy of the packet to each receiver individually.  If
   there is more than one receiver on the LAN, we don't take full
   benefit of the multi-access capability of the network.  We may
   optimize the bandwidth consumption on the LAN and replication
   overhead on the upstream LSR by using upstream label allocation
   [<a href="rfc5331.html" title='"MPLS Upstream Label Assignment and Context-Specific Label Space"'>RFC5331</a>].  Procedures on how to distribute upstream labels using LDP
   is documented in [<a href="rfc6389.html" title='"MPLS Upstream Label Assignment for LDP"'>RFC6389</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20LDP%20Multipoint-to-Multipoint%20on%20a%20LAN"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  LDP Multipoint-to-Multipoint on a LAN</span>

   The procedure to allocate a context label on a LAN is defined in
   [<a href="rfc5331.html" title='"MPLS Upstream Label Assignment and Context-Specific Label Space"'>RFC5331</a>].  That procedure results in each LSR on a given LAN having
   a context label which, on that LAN, can be used to identify itself
   uniquely.  Each LSR advertises its context label as an upstream-
   assigned label, following the procedures of [<a href="rfc6389.html" title='"MPLS Upstream Label Assignment for LDP"'>RFC6389</a>].  Any LSR for
   which the LAN is a downstream link on some P2MP or MP2MP LSP will
   allocate an upstream-assigned label identifying that LSP.  When the
   LSR forwards a packet downstream on one of those LSPs, the packet's
   top label must be the LSR's context label, and the packet's second
   label is the label identifying the LSP.  We will call the top label
   the "upstream LSR label" and the second label the "LSP label".





<span class="grey">Wijnands, et al.             Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.1.%20%20MP2MP%20Downstream%20Forwarding"></a><a class="selflink" href="#section-6.1.1" name="section-6.1.1">6.1.1</a>.  MP2MP Downstream Forwarding</span>

   The downstream path of an MP2MP LSP is much like a normal P2MP LSP,
   so we will use the same procedures as those defined in [<a href="rfc6389.html" title='"MPLS Upstream Label Assignment for LDP"'>RFC6389</a>].  A
   label request for an LSP label is sent to the upstream LSR.  The
   Label Mapping that is received from the upstream LSR contains the LSP
   label for the MP2MP FEC and the upstream LSR context label.  The
   MP2MP downstream path (corresponding to the LSP label) will be
   installed in the context-specific forwarding table corresponding to
   the upstream LSR label.  Packets sent by the upstream router can be
   forwarded downstream using this forwarding state based on a two-label
   lookup.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.1.2.%20%20MP2MP%20Upstream%20Forwarding"></a><a class="selflink" href="#section-6.1.2" name="section-6.1.2">6.1.2</a>.  MP2MP Upstream Forwarding</span>

   An MP2MP LSP also has an upstream forwarding path.  Upstream packets
   need to be forwarded in the direction of the root and downstream on
   any node on the LAN that has a downstream interface for the LSP.  For
   a given MP2MP LSP on a given LAN, exactly one LSR is considered to be
   the upstream LSR.  If an LSR on the LAN receives a packet from one of
   its downstream interfaces for the LSP, and if it needs to forward the
   packet onto the LAN, it ensures that the packet's top label is the
   context label of the upstream LSR, and that its second label is the
   LSP label that was assigned by the upstream LSR.

   Other LSRs receiving the packet will not be able to tell whether the
   packet really came from the upstream router, but that makes no
   difference in the processing of the packet.  The upstream LSR will
   see its own upstream LSR in the label, and this will enable it to
   determine that the packet is traveling upstream.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Root%20Node%20Redundancy"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Root Node Redundancy</span>

   The root node is a single point of failure for an MP LSP, whether the
   MP LSP is P2MP or MP2MP.  The problem is particularly severe for
   MP2MP LSPs.  In the case of MP2MP LSPs, all leaf nodes must use the
   same root node to set up the MP2MP LSP, because otherwise the traffic
   sourced by some leafs is not received by others.  Because the root
   node is the single point of failure for an MP LSP, we need a fast and
   efficient mechanism to recover from a root node failure.

   An MP LSP is uniquely identified in the network by the opaque value
   and the root node address.  It is likely that the root node for an MP
   LSP will be defined statically.  The root node address may be
   configured on each leaf statically or learned using a dynamic
   protocol.  How leafs learn about the root node is out of the scope of
   this document.




<span class="grey">Wijnands, et al.             Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   Suppose that for the same opaque value we define two (or more) root
   node addresses, and we build a tree to each root using the same
   opaque value.  Effectively these will be treated as different MP LSPs
   in the network.  Once the trees are built, the procedures differ for
   P2MP and MP2MP LSPs.  The different procedures are explained in the
   sections below.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Root%20Node%20Redundancy%20-%20Procedures%20for%20P2MP%20LSPs"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Root Node Redundancy - Procedures for P2MP LSPs</span>

   Since all leafs have set up P2MP LSPs to all the roots, they are
   prepared to receive packets on either one of these LSPs.  However,
   only one of the roots should be forwarding traffic at any given time,
   for the following reasons: 1) to achieve bandwidth savings in the
   network and 2) to ensure that the receiving leafs don't receive
   duplicate packets (since one cannot assume that the receiving leafs
   are able to discard duplicates).  How the roots determine which one
   is the active sender is outside the scope of this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Root%20Node%20Redundancy%20-%20Procedures%20for%20MP2MP%20LSPs"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Root Node Redundancy - Procedures for MP2MP LSPs</span>

   Since all leafs have set up an MP2MP LSP to each one of the root
   nodes for this opaque value, a sending leaf may pick either of the
   two (or more) MP2MP LSPs to forward a packet on.  The leaf nodes
   receive the packet on one of the MP2MP LSPs.  The client of the MP2MP
   LSP does not care on which MP2MP LSP the packet is received, as long
   as they are for the same opaque value.  The sending leaf MUST only
   forward a packet on one MP2MP LSP at a given point in time.  The
   receiving leafs are unable to discard duplicate packets because they
   accept on all LSPs.  Using all the available MP2MP LSPs, we can
   implement redundancy using the following procedures.

   A sending leaf selects a single root node out of the available roots
   for a given opaque value.  A good strategy MAY be to look at the
   unicast routing table and select a root that is closest in terms of
   the unicast metric.  As soon as the root address of the active root
   disappears from the unicast routing table (or becomes less
   attractive) due to root node or link failure, the leaf can select a
   new best root address and start forwarding to it directly.  If
   multiple root nodes have the same unicast metric, the highest root
   node addresses MAY be selected, or per session load balancing MAY be
   done over the root nodes.

   All leafs participating in an MP2MP LSP MUST join all the available
   root nodes for a given opaque value.  Since the sending leaf may pick
   any MP2MP LSP, it must be prepared to receive on it.

   The advantage of pre-building multiple MP2MP LSPs for a single opaque
   value is that convergence from a root node failure happens as fast as



<span class="grey">Wijnands, et al.             Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   the unicast routing protocol is able to notify.  There is no need for
   an additional protocol to advertise to the leaf nodes which root node
   is the active root.  The root selection is a local leaf policy that
   does not need to be coordinated with other leafs.  The disadvantage
   of pre-building multiple MP2MP LSPs is that more label resources are
   used, depending on how many root nodes are defined.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Make%20Before%20Break%20%28MBB%29"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Make Before Break (MBB)</span>

   An LSR selects the LSR that is its next hop to the root of the LSP as
   its upstream LSR for an MP LSP.  When the best path to reach the root
   changes, the LSR must choose a new upstream LSR.  Sections <a href="#section-2.4.3">2.4.3</a> and
   3.3.3 describe these procedures.

   When the best path to the root changes, the LSP may be broken
   temporarily resulting in packet loss until the LSP "reconverges" to a
   new upstream LSR.  The goal of MBB when this happens is to keep the
   duration of packet loss as short as possible.  In addition, there are
   scenarios where the best path from the LSR to the root changes but
   the LSP continues to forward packets to the previous next hop to the
   root.  That may occur when a link comes up or routing metrics change.
   In such a case, a new LSP should be established before the old LSP is
   removed to limit the duration of packet loss.  The procedures
   described below deal with both scenarios in a way that an LSR does
   not need to know which of the events described above caused its
   upstream router for an MBB LSP to change.

   The MBB procedures are an optional extension to the MP LSP building
   procedures described in this document.  The procedures in this
   section offer a make-before-break behavior, except in cases where the
   new path is part of a transient routing loop involving more than 2
   LSRs (also see <a href="#section-4">Section 4</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20MBB%20Overview"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  MBB Overview</span>

   The MBB procedures use additional LDP signaling.

   Suppose some event causes a downstream LSR-D to select a new upstream
   LSR-U for FEC-A.  The new LSR-U may already be forwarding packets for
   FEC-A; that is, to downstream LSRs other than LSR-D.  After LSR-U
   receives a label for FEC-A from LSR-D, it will notify LSR-D when it
   knows that the LSP for FEC-A has been established from the root to
   itself.  When LSR-D receives this MBB notification, it will change
   its next hop for the LSP root to LSR-U.

   The assumption is that if LSR-U has received an MBB notification from
   its upstream router for the FEC-A LSP and has installed forwarding
   state, the LSR is capable of forwarding packets on the LSP.  At that



<span class="grey">Wijnands, et al.             Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   point LSR-U should signal LSR-D by means of an MBB notification that
   it has become part of the tree identified by FEC-A and that LSR-D
   should initiate its switchover to the LSP.

   At LSR-U, the LSP for FEC-A may be in 1 of 3 states.

   1. There is no state for FEC-A.

   2. State for FEC-A exists and LSR-U is waiting for MBB notification
      that the LSP from the root to it exists.

   3. State for FEC-A exists and the MBB notification has been received
      or it is the root node for FEC-A.

   After LSR-U receives LSR-D's Label Mapping message for FEC-A, LSR-U
   MUST NOT reply with an MBB notification to LSR-D until its state for
   the LSP is state #3 above.  If the state of the LSP at LSR-U is state
   #1 or #2, LSR-U should remember receipt of the Label Mapping message
   from LSR-D while waiting for an MBB notification from its upstream
   LSR for the LSP.  When LSR-U receives the MBB notification from LSR-
   U, it transitions to LSP state #3 and sends an MBB notification to
   LSR-D.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20The%20MBB%20Status%20Code"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  The MBB Status Code</span>

   As noted in <a href="#section-8.1">Section 8.1</a>, the procedures for establishing an MBB MP
   LSP are different from those for establishing normal MP LSPs.

   When a downstream LSR sends a Label Mapping message for MP LSP to its
   upstream LSR, it MAY include an LDP MP Status TLV that carries an MBB
   Status Code to indicate that MBB procedures apply to the LSP.  This
   new MBB Status Code MAY also appear in an LDP Notification message
   used by an upstream LSR to signal LSP state #3 to the downstream LSR;
   that is, that the upstream LSRs state for the LSP exists and that it
   has received notification from its upstream LSR that the LSP is in
   state #3.

   The MBB Status is a type of the LDP MP Status Value Element as
   described in <a href="#section-5.1">Section 5.1</a>.  It is encoded as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | MBB Type = 1  |      Length = 1               | Status Code   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      MBB Type:  Type 1




<span class="grey">Wijnands, et al.             Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


      Length:  1

      Status Code:  1 = MBB request

                    2 = MBB ack

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20The%20MBB%20Capability"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  The MBB Capability</span>

   An LSR MAY advertise that it is capable of handling MBB LSPs using
   the capability advertisement as defined in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>].  The LDP MP MBB
   capability has the following format:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1|0| LDP MP MBB Capability     |           Length = 1          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |S| Reserved    |
      +-+-+-+-+-+-+-+-+

   LDP MP MBB Capability: The MBB Capability Parameter (0x050A)

   S: As specified in [<a href="rfc5561.html" title='"LDP Capabilities"'>RFC5561</a>]

   If an LSR has not advertised that it is MBB capable, its LDP peers
   MUST NOT send it messages that include MBB parameters.  If an LSR
   receives a Label Mapping message with an MBB parameter from
   downstream LSR-D and its upstream LSR-U has not advertised that it is
   MBB capable, the LSR MUST send an MBB notification immediately to
   LSR-U (see <a href="#section-8.4">Section 8.4</a>).  If this happens, an MBB MP LSP will not be
   established, but a normal MP LSP will be the result.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.4.%20%20The%20MBB%20Procedures"></a><a class="selflink" href="#section-8.4" name="section-8.4">8.4</a>.  The MBB Procedures</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.1.%20%20Terminology"></a><a class="selflink" href="#section-8.4.1" name="section-8.4.1">8.4.1</a>.  Terminology</span>

   1. MBB LSP &lt;X, Y&gt;: A P2MP or MP2MP Make Before Break (MBB) LSP entry
      with root node address X and opaque value Y.

   2. A(N, L): An accepting element that consists of an upstream
      neighbor N and Local label L.  This LSR assigned label L to
      neighbor N for a specific MBB LSP.  For an active element, the
      corresponding label is stored in the label forwarding database.

   3. iA(N, L): An inactive accepting element that consists of an
      upstream neighbor N and local label L.  This LSR assigned label L
      to neighbor N for a specific MBB LSP.  For an inactive element,




<span class="grey">Wijnands, et al.             Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


      the corresponding label is not stored in the label forwarding
      database.

   4. F(N, L): A Forwarding state that consists of downstream neighbor N
      and label L.  This LSR is sending label packets with label L to
      neighbor N for a specific FEC.

   5. F'(N, L): A Forwarding state that has been marked for sending an
      MBB Notification message to neighbor N with label L.

   6. MBB Notification &lt;X, Y, L&gt;: An LDP notification message with an MP
      LSP &lt;X, Y&gt;, label L, and MBB Status code 2.

   7. MBB Label Mapping &lt;X, Y, L&gt;: A P2MP Label Mapping or MP2MP Label
      Mapping downstream with a FEC element &lt;X, Y&gt;, label L, and MBB
      Status code 1.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.2.%20%20Accepting%20Elements"></a><a class="selflink" href="#section-8.4.2" name="section-8.4.2">8.4.2</a>.  Accepting Elements</span>

   An accepting element represents a specific label value L that has
   been advertised to a neighbor N for an MBB LSP &lt;X, Y&gt; and is a
   candidate for accepting labels switched packets on.  An LSR can have
   two accepting elements for a specific MBB LSP &lt;X, Y&gt; LSP, only one of
   them MUST be active.  An active element is the element for which the
   label value has been installed in the label forwarding database.  An
   inactive accepting element is created after a new upstream LSR is
   chosen and replacement the active element in the label forwarding
   database is pending.  Inactive elements only exist temporarily while
   switching to a new upstream LSR.  Once the switch has been completed,
   only one active element remains.  During network convergence, it is
   possible that an inactive accepting element is created while another
   inactive accepting element is pending.  If that happens, the older
   inactive accepting element MUST be replaced with a newer inactive
   element.  If an accepting element is removed, a Label Withdraw has to
   be sent for label L to neighbor N for &lt;X, Y&gt;.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.3.%20%20Procedures%20for%20Upstream%20LSR%20Change"></a><a class="selflink" href="#section-8.4.3" name="section-8.4.3">8.4.3</a>.  Procedures for Upstream LSR Change</span>

   Suppose a node Z has an MBB LSP &lt;X, Y&gt; with an active accepting
   element A(N1, L1).  Due to a routing change, it detects a new best
   path for root X and selects a new upstream LSR N2.  Node Z allocates
   a new local label L2 and creates an inactive accepting element iA(N2,
   L2).  Node Z sends MBB Label Mapping &lt;X, Y, L2&gt; to N2 and waits for
   the new upstream LSR N2 to respond with an MBB Notification for &lt;X,
   Y, L2&gt;.  During this transition phase, there are two accepting
   elements, the element A(N1, L1) still accepting packets from N1 over
   label L1 and the new inactive element iA(N2, L2).




<span class="grey">Wijnands, et al.             Standards Track                   [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   While waiting for the MBB Notification from upstream LSR N2, it is
   possible that another transition occurs due to a routing change.
   Suppose the new upstream LSR is N3.  An inactive element iA(N3, L3)
   is created and the old inactive element iA(N2, L2) MUST be removed.
   A Label Withdraw MUST be sent to N2 for &lt;X, Y, L2&gt;.  The MBB
   Notification for &lt;X, Y, L2&gt; from N2 will be ignored because the
   inactive element is removed.

   It is possible that the MBB Notification from upstream LSR is never
   received due to link or node failure.  To prevent waiting
   indefinitely for the MBB Notification, a timeout SHOULD be applied.
   As soon as the timer expires, the procedures in <a href="#section-8.4.5">Section 8.4.5</a> are
   applied as if an MBB Notification was received for the inactive
   element.  If a downstream LSR detects that the old upstream LSR went
   down while waiting for the MBB Notification from the new upstream
   LSR, the downstream LSR can immediately proceed without waiting for
   the timer to expire.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.4.%20%20Receiving%20a%20Label%20Mapping%20with%20MBB%20Status%20Code"></a><a class="selflink" href="#section-8.4.4" name="section-8.4.4">8.4.4</a>.  Receiving a Label Mapping with MBB Status Code</span>

   Suppose node Z has state for an MBB LSP &lt;X, Y&gt; and receives an MBB
   Label Mapping &lt;X, Y, L2&gt; from N2.  A new forwarding state F(N2, L2)
   will be added to the MP LSP if it did not already exist.  If this MBB
   LSP has an active accepting element or if node Z is the root of the
   MBB LSP, an MBB notification &lt;X, Y, L2)&gt; is sent to node N2.  If node
   Z has an inactive accepting element, it marks the Forwarding state as
   &lt;X, Y, F'(N2, L2)&gt;.  If the router Z upstream LSR for &lt;X, Y&gt; happens
   to be N2, then Z MUST NOT send an MBB notification to N2 at once.
   Sending the MBB notification to N2 must be done only after Z upstream
   for &lt;X, Y&gt; stops being N2.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.5.%20%20Receiving%20a%20Notification%20with%20MBB%20Status%20Code"></a><a class="selflink" href="#section-8.4.5" name="section-8.4.5">8.4.5</a>.  Receiving a Notification with MBB Status Code</span>

   Suppose node Z receives an MBB Notification &lt;X, Y, L&gt; from N.  If
   node Z has state for MBB LSP &lt;X, Y&gt; and an inactive accepting element
   iA(N, L) that matches with N and L, we activate this accepting
   element and install label L in the label-forwarding database.  If
   another active accepting element was present, it will be removed from
   the label-forwarding database.

   If this MBB LSP &lt;X, Y&gt; also has Forwarding states marked for sending
   MBB Notifications, like &lt;X, Y, F'(N2, L2)&gt;, MBB Notifications are
   sent to these downstream LSRs.  If node Z receives an MBB
   Notification for an accepting element that is not inactive or does
   not match the label value and neighbor address, the MBB notification
   is ignored.





<span class="grey">Wijnands, et al.             Standards Track                   [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/8.4.6.%20%20Node%20Operation%20for%20MP2MP%20LSPs"></a><a class="selflink" href="#section-8.4.6" name="section-8.4.6">8.4.6</a>.  Node Operation for MP2MP LSPs</span>

   The procedures described above apply to the downstream path of an
   MP2MP LSP.  The upstream path of the MP2MP is set up as normal
   without including an MBB Status code.  If the MBB procedures apply to
   an MP2MP downstream FEC element, the upstream path to a node N is
   only installed in the label-forwarding database if node N is part of
   the active accepting element.  If node N is part of an inactive
   accepting element, the upstream path is installed when this inactive
   accepting element is activated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Typed%20Wildcard%20for%20mLDP%20FEC%20Element"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Typed Wildcard for mLDP FEC Element</span>

   The format of the mLDP FEC Typed Wildcard FEC is as follows:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Typed Wcard   |     Type      |   Len = 2     |      AFI      ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ~               |
      +-+-+-+-+-+-+-+-+

   Typed Wcard:  As specified in [<a href="rfc5918.html" title="&quot;Label Distribution Protocol (LDP) 'Typed Wildcard' Forward Equivalence Class (FEC)&quot;">RFC5918</a>]

   Type:  The type of FEC Element Type.  Either the P2MP FEC Element or
      the MP2MP FEC Element using the values defined for those FEC
      Elements when carried in the FEC TLV as defined in this document.

   Len:  Len FEC Type Info, two octets (=0x02).

   AFI:  Address Family, two-octet quantity containing a value from
      IANA's "Address Family Numbers" registry.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   The same security considerations apply as those for the base LDP
   specification, as described in [<a href="rfc5036.html" title='"LDP Specification"'>RFC5036</a>].

   The protocol specified in this document does not provide any
   authorization mechanism for controlling the set of LSRs that may join
   a given MP LSP.  If such authorization is desirable, additional
   mechanisms, outside the scope of this document, are needed.  Note
   that authorization policies cannot be implemented and/or configured
   solely at the root node of the LSP, because the root node does not
   learn the identities of all the leaf nodes.





<span class="grey">Wijnands, et al.             Standards Track                   [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  IANA Considerations</span>

   Per this document, IANA has created 3 new registries.

   1. "LDP MP Opaque Value Element basic type"

      The range is 0-255, with the following values allocated in this
      document:

         0: Reserved

         1: Generic LSP identifier

         255: Extended Type field is present in the following two bytes

      The allocation policy for this space is 'Standards Action with
      Early Allocation'.

   2. "LDP MP Opaque Value Element extended type"

      The range is 0-65535, with the following allocation policies:

         0-32767: Standards Action with Early Allocation

         32768-65535: First Come, First Served

   3. "LDP MP Status Value Element type"

      The range is 0-255, with the following values allocated in this
      document:

         0: Reserved

         1: MBB Status

      The allocation policy for this space is 'Standards Action with
      Early Allocation'.














<span class="grey">Wijnands, et al.             Standards Track                   [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   The code point values listed below have been allocated by IANA
   through early allocation.

   IANA allocated three new code points from the LDP registry
   "Forwarding Equivalence Class (FEC) Type Name Space".  The values
   are:

      P2MP FEC type - requested value 0x06

      MP2MP-up FEC type - requested value 0x07

      MP2MP-down FEC type - requested value 0x08

   IANA assigned three new code points for new Capability Parameter TLVs
   from the LDP registry "TLV Type Name Space", corresponding to the
   advertisement of the P2MP, MP2MP, and MBB capabilities.  The values
   are:

      P2MP Capability Parameter - 0x0508

      MP2MP Capability Parameter - 0x0509

      MBB Capability Parameter - 0x050A

   IANA assigned an LDP Status Code to indicate that an LDP MP Status
   TLV is following in the Notification message.  The value assigned in
   the LDP registry "LDP Status Code Name Space" is:

      LDP MP status - requested value 0x00000040

   IANA assigned a new code point for an LDP MP Status TLV.  The value
   assigned in the LDP registry "LDP TLV Type Name Space" is:

      LDP MP Status TLV Type - requested value 0x096F

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Acknowledgments"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Acknowledgments</span>

   The authors would like to thank the following individuals for their
   review and contribution: Nischal Sheth, Yakov Rekhter, Rahul
   Aggarwal, Arjen Boers, Eric Rosen, Nidhi Bhaskar, Toerless Eckert,
   George Swallow, Jin Lizhong, Vanson Lim, Adrian Farrel, Thomas Morin
   and Ben Niven-Jenkins.









<span class="grey">Wijnands, et al.             Standards Track                   [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Contributing%20Authors"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Contributing Authors</span>

   Below is a list of the contributing authors in alphabetical order:

   Shane Amante
   Level 3 Communications, LLC
   1025 Eldorado Blvd
   Broomfield, CO 80021
   US
   EMail: Shane.Amante@Level3.com


   Luyuan Fang
   Cisco Systems
   300 Beaver Brook Road
   Boxborough, MA 01719
   US
   EMail: lufang@cisco.com


   Hitoshi Fukuda
   NTT Communications Corporation
   1-1-6, Uchisaiwai-cho, Chiyoda-ku
   Tokyo 100-8019,
   Japan
   EMail: hitoshi.fukuda@ntt.com


   Yuji Kamite
   NTT Communications Corporation
   Tokyo Opera City Tower
   3-20-2 Nishi Shinjuku, Shinjuku-ku,
   Tokyo 163-1421,
   Japan
   EMail: y.kamite@ntt.com


   Kireeti Kompella
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA 94089
   US
   EMail: kireeti@juniper.net








<span class="grey">Wijnands, et al.             Standards Track                   [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   Jean-Louis Le Roux
   France Telecom
   2, avenue Pierre-Marzin
   Lannion, Cedex 22307
   France
   EMail: jeanlouis.leroux@francetelecom.com


   Ina Minei
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   US
   EMail: ina@juniper.net


   Bob Thomas
   Cisco Systems, Inc.
   300 Beaver Brook Road
   Boxborough, MA, 01719
   EMail: bobthomas@alum.mit.edu


   Lei Wang
   Telenor
   Snaroyveien 30
   Fornebu 1331
   Norway
   EMail: lei.wang@telenor.com


   IJsbrand Wijnands
   Cisco Systems, Inc.
   De kleetlaan 6a
   1831 Diegem
   Belgium
   EMail: ice@cisco.com














<span class="grey">Wijnands, et al.             Standards Track                   [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20References"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.1.%20%20Normative%20References"></a><a class="selflink" href="#section-14.1" name="section-14.1">14.1</a>.  Normative References</span>

   [<a id="ref-ITU.V42.1994" name="ref-ITU.V42.1994">ITU.V42.1994</a>]
              International Telecommunications Union, "Error-correcting
              Procedures for DCEs Using Asynchronous-to-Synchronous
              Conversion", ITU-T Recommendation V.42, 1994.
              <a href="http://www.itu.int/rec/T-REC-V.42-200203-I">http://www.itu.int/rec/T-REC-V.42-200203-I</a>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3031" name="ref-RFC3031">RFC3031</a>]  Rosen, E., Viswanathan, A., and R. Callon, "Multiprotocol
              Label Switching Architecture", <a href="rfc3031.html">RFC 3031</a>, January 2001.

   [<a id="ref-RFC5036" name="ref-RFC5036">RFC5036</a>]  Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,
              "LDP Specification", <a href="rfc5036.html">RFC 5036</a>, October 2007.

   [<a id="ref-RFC5331" name="ref-RFC5331">RFC5331</a>]  Aggarwal, R., Rekhter, Y., and E. Rosen, "MPLS Upstream
              Label Assignment and Context-Specific Label Space", <a href="rfc5331.html">RFC</a>
              <a href="rfc5331.html">5331</a>, August 2008.

   [<a id="ref-RFC5561" name="ref-RFC5561">RFC5561</a>]  Thomas, B., Raza, K., Aggarwal, S., Aggarwal, R., and JL.
              Le Roux, "LDP Capabilities", <a href="rfc5561.html">RFC 5561</a>, July 2009.

   [<a id="ref-RFC5918" name="ref-RFC5918">RFC5918</a>]  Asati, R., Minei, I., and B. Thomas, "Label Distribution
              Protocol (LDP) 'Typed Wildcard' Forward Equivalence Class
              (FEC)", <a href="rfc5918.html">RFC 5918</a>, August 2010.

   [<a id="ref-RFC6389" name="ref-RFC6389">RFC6389</a>]  Aggarwal, R. and JL. Le Roux, "MPLS Upstream Label
              Assignment for LDP", <a href="rfc6389.html">RFC 6389</a>, September 2011.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/14.2.%20%20Informative%20References"></a><a class="selflink" href="#section-14.2" name="section-14.2">14.2</a>.  Informative References</span>

   [<a id="ref-ISO3309" name="ref-ISO3309">ISO3309</a>]  International Organization for Standardization, "ISO
              Information Processing Systems - Data Communication -
              High-Level Data Link Control Procedure - Frame Structure",
              ISO 3309, 3rd Edition, October 1984.

   [<a id="ref-L3VPN-MCAST" name="ref-L3VPN-MCAST">L3VPN-MCAST</a>]
              Rosen, E., Ed., and R. Aggarwal, Ed., "Multicast in
              MPLS/BGP IP VPNs", Work in Progress, January 2010.

   [<a id="ref-RFC3813" name="ref-RFC3813">RFC3813</a>]  Srinivasan, C., Viswanathan, A., and T. Nadeau,
              "Multiprotocol Label Switching (MPLS) Label Switching
              Router (LSR) Management Information Base (MIB)", <a href="rfc3813.html">RFC 3813</a>,
              June 2004.



<span class="grey">Wijnands, et al.             Standards Track                   [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


   [<a id="ref-RFC3815" name="ref-RFC3815">RFC3815</a>]  Cucchiara, J., Sjostrand, H., and J. Luciani, "Definitions
              of Managed Objects for the Multiprotocol Label Switching
              (MPLS), Label Distribution Protocol (LDP)", <a href="rfc3815.html">RFC 3815</a>, June
              2004.

   [<a id="ref-RFC4875" name="ref-RFC4875">RFC4875</a>]  Aggarwal, R., Ed., Papadimitriou, D., Ed., and S.
              Yasukawa, Ed., "Extensions to Resource Reservation
              Protocol - Traffic Engineering (RSVP-TE) for Point-to-
              Multipoint TE Label Switched Paths (LSPs)", <a href="rfc4875.html">RFC 4875</a>, May
              2007.

   [<a id="ref-RFC5332" name="ref-RFC5332">RFC5332</a>]  Eckert, T., Rosen, E., Ed., Aggarwal, R., and Y. Rekhter,
              "MPLS Multicast Encapsulations", <a href="rfc5332.html">RFC 5332</a>, August 2008.

   [<a id="ref-RFC6348" name="ref-RFC6348">RFC6348</a>]  Le Roux, J., Ed., and T. Morin, Ed., "Requirements for
              Point-to-Multipoint Extensions to the Label Distribution
              Protocol", <a href="rfc6348.html">RFC 6348</a>, September 2011.


































<span class="grey">Wijnands, et al.             Standards Track                   [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc6388.html">RFC 6388</a>            P2MP and MP2MP LSP Setup with LDP      November 2011</span>


Authors' Addresses

   IJsbrand Wijnands (editor)
   Cisco Systems, Inc.
   De kleetlaan 6a
   Diegem  1831
   Belgium
   EMail: ice@cisco.com


   Ina Minei (editor)
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   US
   EMail: ina@juniper.net


   Kireeti Kompella
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   US
   EMail: kireeti@juniper.net


   Bob Thomas
   300 Beaver Brook Road
   Boxborough  01719
   US
   EMail: bobthomas@alum.mit.edu




















Wijnands, et al.             Standards Track                   [Page 39]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6388 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:30 GMT --></html>