<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7029 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:25 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-hartman-emu-mutual-crypto-bind" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7029" name="DC.Identifier"/>
<meta content="October, 2013" name="DC.Date.Issued"/>
<meta content="Wasserman, Margaret" name="DC.Creator"/>
<meta content="Hartman, Sam" name="DC.Creator"/>
<meta content="Zhang, Dacheng" name="DC.Creator"/>
<meta content="As the Extensible Authentication Protocol (EAP) evolves, EAP peers
rely increasingly on information received from the EAP server. EAP
extensions such as channel binding or network posture information are
often carried in tunnel methods; peers are likely to rely on this
information. Cryptographic binding is a facility described in RFC 3748
that protects tunnel methods against man-in-the-middle attacks.
However, cryptographic binding focuses on protecting the server rather
than the peer. This memo explores attacks possible when the peer is
not protected from man-in-the-middle attacks and recommends
cryptographic binding based on an Extended Master Session Key, a new
form of cryptographic binding that protects both peer and server along
with other mitigations." name="DC.Description.Abstract"/>
<meta content="Extensible Authentication Protocol (EAP) Mutual Cryptographic Binding" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7029 - Extensible Authentication Protocol (EAP) Mutual Cryptographic Binding</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7029.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7029" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-emu-crypto-bind" title="draft-ietf-emu-crypto-bind">draft-ietf-emu-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7029" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7029" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7029" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                        S. Hartman
Request for Comments: 7029                                  M. Wasserman
Category: Informational                                Painless Security
ISSN: 2070-1721                                                 D. Zhang
                                                                  Huawei
                                                            October 2013


 <span class="h1">Extensible Authentication Protocol (EAP) Mutual Cryptographic Binding</span>

Abstract

   As the Extensible Authentication Protocol (EAP) evolves, EAP peers
   rely increasingly on information received from the EAP server.  EAP
   extensions such as channel binding or network posture information are
   often carried in tunnel methods; peers are likely to rely on this
   information.  Cryptographic binding is a facility described in <a href="rfc3748.html">RFC</a>
   <a href="rfc3748.html">3748</a> that protects tunnel methods against man-in-the-middle attacks.
   However, cryptographic binding focuses on protecting the server
   rather than the peer.  This memo explores attacks possible when the
   peer is not protected from man-in-the-middle attacks and recommends
   cryptographic binding based on an Extended Master Session Key, a new
   form of cryptographic binding that protects both peer and server
   along with other mitigations.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7029">http://www.rfc-editor.org/info/rfc7029</a>.











<span class="grey">Hartman, et al.               Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


Copyright Notice

   Copyright (c) 2013 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Keywords for Requirement Levels ............................<a href="#page-5">5</a>
   <a href="#section-2">2</a>. An Example Problem ..............................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. The Server Insertion Attack .....................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Conditions for the Attack ..................................<a href="#page-7">7</a>
      <a href="#section-3.2">3.2</a>. Mitigation Strategies ......................................<a href="#page-8">8</a>
           <a href="#section-3.2.1">3.2.1</a>. Server Authentication ...............................<a href="#page-8">8</a>
           <a href="#section-3.2.2">3.2.2</a>. Server Policy .......................................<a href="#page-9">9</a>
           <a href="#section-3.2.3">3.2.3</a>. Existing Cryptographic Binding .....................<a href="#page-12">12</a>
           <a href="#section-3.2.4">3.2.4</a>. Introducing EMSK-Based Cryptographic Binding .......<a href="#page-12">12</a>
           <a href="#section-3.2.5">3.2.5</a>. Mix Key into Long-Term Credentials .................<a href="#page-14">14</a>
      <a href="#section-3.3">3.3</a>. Intended Intermediates ....................................<a href="#page-14">14</a>
   <a href="#section-4">4</a>. Recommendations ................................................<a href="#page-15">15</a>
      <a href="#section-4.1">4.1</a>. Mutual Cryptographic Binding ..............................<a href="#page-15">15</a>
      <a href="#section-4.2">4.2</a>. State Tracking ............................................<a href="#page-15">15</a>
      <a href="#section-4.3">4.3</a>. Certificate Naming ........................................<a href="#page-16">16</a>
      <a href="#section-4.4">4.4</a>. Inner Mixing ..............................................<a href="#page-16">16</a>
   <a href="#section-5">5</a>. Survey of Tunnel Methods .......................................<a href="#page-16">16</a>
      <a href="#section-5.1">5.1</a>. Tunnel EAP (TEAP) Method ..................................<a href="#page-16">16</a>
      <a href="#section-5.2">5.2</a>. Flexible Authentication via Secure Tunneling (FAST) .......<a href="#page-17">17</a>
      <a href="#section-5.3">5.3</a>. EAP Tunneled Transport Layer Security (EAP-TTLS) ..........<a href="#page-17">17</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-17">17</a>
   <a href="#section-7">7</a>. Acknowledgements ...............................................<a href="#page-18">18</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-18">18</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-18">18</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-18">18</a>








<span class="grey">Hartman, et al.               Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Extensible Authentication Protocol (EAP) [<a href="rfc3748.html" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>] provides
   authentication between a peer (a party accessing some service) and a
   authentication server.  Traditionally, peers have not relied
   significantly on information received from EAP servers.  However,
   facilities such as EAP channel binding [<a href="rfc6677.html" title='"Channel-Binding Support for Extensible Authentication Protocol (EAP) Methods"'>RFC6677</a>] provide the peer
   with confirmation of information about the resource it is accessing.
   Other facilities such as EAP Posture Transport [<a href="#ref-PT-EAP" title='"PT-EAP: Posture Transport (PT) Protocol For EAP Tunnel Methods"'>PT-EAP</a>] permit a peer
   and EAP server to discuss the security properties of accessed
   networks.  Both of these facilities provide peers with information
   they need to rely on and provide attackers who are able to
   impersonate an EAP server to a peer with new opportunities for
   attack.

   Instead of adding these new facilities to all EAP methods, work has
   focused on adding support to tunnel methods [<a href="rfc6678.html" title='"Requirements for a Tunnel-Based Extensible Authentication Protocol (EAP) Method"'>RFC6678</a>].  There are
   numerous tunnel methods, including [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP-FAST)"'>RFC4851</a>] and [<a href="rfc5281.html" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)"'>RFC5281</a>], and work
   on building a Standards Track tunnel method [<a href="#ref-TEAP" title='"Tunnel EAP Method (TEAP) Version 1"'>TEAP</a>].  These tunnel
   methods are extensible.  By adding an extension to support a facility
   such as channel binding to a tunnel method, an extension can be used
   with any inner method carried in the tunnel.

   Tunnel methods need to be careful about man-in-the-middle attacks.
   See [<a href="rfc6678.html" title='"Requirements for a Tunnel-Based Extensible Authentication Protocol (EAP) Method"'>RFC6678</a>] (Sections <a href="#section-3.2">3.2</a> and <a href="#section-4.6.3">4.6.3</a>) and [<a href="#ref-TUNNEL-MITM">TUNNEL-MITM</a>] for a
   detailed description of these attacks.  For example, an attack can
   happen when a peer is willing to perform authentication inside and
   outside a tunnel.  An attacker can impersonate the EAP server and
   offer the inner method to the peer.  However, on the other side, the
   attacker acts as a man-in-the-middle and opens a tunnel to the real
   EAP server.  Figure 1 illustrates this attack.  At the end of the
   attack, the EAP server believes it is talking to the peer.  At the
   inner method level, this is true.  At the outer method level,
   however, the server is talking to the attacker.

















<span class="grey">Hartman, et al.               Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


    Peer                Attacker         Service         AAA Server
     |                     |                 |                |
     |                     |                 |                |
     |Peer Initiates Connection to a Service |                |
     |---------------------+-------X--------&gt;|                |
     |   (Intercepted by an Attacker)        |                |
     |                     |                 |                |
     |                     |        Tunnel Establishment      |
     |                     |&lt;--------------------------------&gt;|
     |                     |                 |                |
     |                     |..................................|
     |                     |              Tunnel              |
     |    Non-Tunneled     |                 |                |
     |       Method        |  Tunneled Authentication Method  |
     |&lt;===================&gt;|&lt;================================&gt;|
     |                     |                 |                |
     |                     |..................................|
     |                     |                 |                |
     |                     |    Attacker     |&lt;--- MSK keys --|
     |                     | Connected as    |                |
     |                     |      Peer       |                |
     |                     |&lt;---------------&gt;|                |

   A classic tunnel attack where the attacker inserts an extra tunnel
   between the attacker and EAP server.

                      Figure 1: Classic Tunnel Attack

   There are two mitigation strategies for this classic attack.  First,
   security policy can be set up so that the same method is not offered
   by a server both inside and outside a tunnel.  Second, a technical
   solution is available if the inner method is sufficiently strong:
   cryptographic binding is a security property of a tunnel method under
   which the EAP server confirms that the inner and outer parties are
   the same.  Cryptographic binding is typically implemented by
   requiring the outer party (the other end of the tunnel) to prove
   knowledge of the Master Session Key (MSK) of the inner method.  This
   proves to the server that the inner and outer exchanges are with the
   same party.  <a href="rfc3748.html">RFC 3748</a>'s definition of cryptographic binding allows
   for an optional proof to the peer that the inner and outer exchanges
   are with the same party.  As discussed below, proving knowledge of
   the MSK is insufficient to prove to the peer that the inner and outer
   exchanges are with the same party.








<span class="grey">Hartman, et al.               Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Keywords%20for%20Requirement%20Levels"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Keywords for Requirement Levels</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20An%20Example%20Problem"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  An Example Problem</span>

   The GSS-EAP (Generic Security Service Extensible Authentication
   Protocol) mechanism [<a href="#ref-GSS-EAP" title='"A GSS-API Mechanism for the Extensible Authentication Protocol"'>GSS-EAP</a>] provides application authentication
   using EAP.  A peer could reasonably trust some applications
   significantly more than others.  If the peer sends confidential
   information to some applications, an attacker may gain significant
   value from convincing the peer that the attacker is the trusted
   application.  Channel bindings are used to provide information to the
   peer about the application service to which the peer connects.  Prior
   to channel bindings, peers could not distinguish one Network Access
   Service (NAS) from another, so attacks where one NAS impersonated
   another were out of scope.  However, channel bindings add this
   capability and thus expands the threat model of EAP.  The GSS-EAP
   mechanism requires distinguishing one service from another.

   Consider the following example.  A relatively untrusted service, say
   a print server, has been compromised.  A user is attempting to
   connect to a trusted service such as a financial application.  Both
   the print server and the financial application use an Authentication,
   Authorization, and Accounting protocol (AAA) to transport EAP
   authentication back to the user's EAP server.  The print server
   mounts a man-in-the-middle attack on the user's connection to the
   financial application and claims to be the application.

   The print server offers a tunnel method towards the peer.  The print
   server extracts the inner method from the tunnel and sends it on
   towards the AAA server.  Channel binding happens at the tunnel method
   though.  So, the print server is happy to confirm that it is the
   financial application.  After the inner method completes, the EAP
   server sends the MSK to the print server over the AAA protocol.  If
   only the MSK is needed for cryptographic binding, then the print
   server can successfully perform cryptographic binding and may be able
   to impersonate the financial application to the peer.











<span class="grey">Hartman, et al.               Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


    Peer                Attacker         Service         AAA Server
     |                     |                 |                |
     |                     |                 |                |
     |Peer Initiates Connection to a Service |                |
     |---------------------+----X-----------&gt;|                |
     |   (Intercepted by an Attacker)        |                |
     |                     |                 |                |
     |                     |                 |                |
     | Tunnel Establishment|                 |                |
     |&lt;-------------------&gt;|                 |                |
     |.....................|                 |                |
     |       Tunnel        |                 |                |
     |                     |                                  |
     |      Tunneled       |             Non-Tunneled         |
     |       Method        |        Authentication Method     |
     |&lt;===================&gt;|&lt;================================&gt;|
     |                     |(Same as Inner Method from Tunnel)|
     |.....................|                 |                |
     |                     |                 |                |
     |        Peer         |                 |                |
     |    Connected to     |&lt;----------------------MSK keys --|
     |      Attacker       |                 |                |
     |&lt;-------------------&gt;|                 |                |
     |                     |                 |                |

   A modified tunnel attack when an extra server rather than extra
   client is inserted.

    Figure 2: Channel Binding Requires More than Cryptographic Binding

   This attack is not specific to GSS-EAP.  The channel bindings
   specification [<a href="rfc6677.html" title='"Channel-Binding Support for Extensible Authentication Protocol (EAP) Methods"'>RFC6677</a>] describes a number of situations where
   channel bindings are important for network access.  In these
   situations, one NAS could impersonate another by using a similar
   attack.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20The%20Server%20Insertion%20Attack"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  The Server Insertion Attack</span>

   The previous section described an example of the server insertion
   attack.  In this attack, one party adds a layer of tunneling such
   that from the perspective of the EAP peer, there are more methods
   than from the perspective of the EAP server.  This attack is most
   beneficial when the party inserting the extra tunnel is a legitimate
   NAS, so mitigations need to be able to prevent a legitimate NAS from
   inappropriately adding a layer of tunneling.  Some deployments
   utilize an intentional intermediary that adds an extra level of EAP
   tunneling between the peer and the EAP server; see <a href="#section-3.3">Section 3.3</a> for a
   discussion.



<span class="grey">Hartman, et al.               Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Conditions%20for%20the%20Attack"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Conditions for the Attack</span>

   For an inserted server attack to have value, the attacker needs to
   gain an advantage from its attack.  An attacker could gain an
   advantage in the following ways:

   o  The attacker can send information to a peer that the peer would
      trust from the EAP server but not the attacker.  Examples of this
      include channel-binding responses.

   o  The peer sends information to the attacker that was intended for
      the EAP server.  For example, the inner user identity may disclose
      privacy-sensitive information.  The channel-binding request may
      disclose what service the peer wishes to connect to.

   o  The attacker may influence session parameters.  For example, if
      the attacker can influence the MSK, then the attacker may be able
      to read or influence session traffic and mount an attack on the
      confidentiality or integrity of the resulting session.

   o  An attacker may impact availability of the session.  In practice
      though, an attacker that can mount a server insertion attack is
      likely to be able to impact availability in other ways.

   For this attack to be possible, the following conditions need to
   hold:

   1.  The attacker needs to be able to establish a tunnel method with
       the peer over which the peer will authenticate.

   2.  The attacker needs to be able to respond to any inner
       authentication.  For example, an attacker who is a legitimate NAS
       can forward the inner authentication over AAA towards the EAP
       server.  Note that the inner authentication may not be EAP.

   3.  Typically, the attacker needs to be able to complete the tunnel
       method after inner authentication.  This may not be necessary if
       the attacker is gaining advantage from information sent by the
       peer over the tunnel.

   4.  In some cases, the attacker may need to complete a Secure
       Association Protocol (SAP) or otherwise demonstrate knowledge of
       the MSK after the tunnel method successfully completes.

   Attackers who are legitimate NASes are the primary focus of this
   memo.  Previous work has provided mitigation against attackers who
   are not NASes; these mitigations are briefly discussed.




<span class="grey">Hartman, et al.               Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Mitigation%20Strategies"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Mitigation Strategies</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Server%20Authentication"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Server Authentication</span>

   If the peer confirms the identity of the party that the tunnel method
   is established with, the peer prevents the first condition (attacker
   establishing a tunnel method).  Many tunnel methods rely on Transport
   Layer Security (TLS) [<a href="rfc5281.html" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)"'>RFC5281</a>] [<a href="#ref-TEAP" title='"Tunnel EAP Method (TEAP) Version 1"'>TEAP</a>].  The specifications for these
   methods tend to encourage or mandate certificate checking.  If the
   TLS certificate is validated back to a trust anchor and the identity
   of the tunnel method server confirmed, then the first attack
   condition cannot be met.

   Many challenges make server authentication difficult.  There is not
   an obvious name by which to identify a tunnel method server.  It is
   not obvious where in the tunnel server certificate the name should be
   found.  One particularly problematic practice is to use a certificate
   that names the host on which the tunnel server runs.  Given such a
   name, it is very difficult for a peer to understand whether that
   server is intended to be a tunnel method server for the realm.

   It's not clear what trust anchors to use for tunnel servers.  Using
   commercial Certificate Authorities (CAs) is probably undesirable
   because tunnel servers often operate in a closed community and are
   often provisioned with certificates issued by that community.  Using
   commercial CAs can be particularly problematic with peers that
   support hostnames in certificates.  Then anyone who can obtain a
   certificate for any host in the domain being contacted can
   impersonate a tunnel server.

   These difficulties lead to poor deployment of good certificate
   validation.  Many peers make it easy to disable certificate
   validation.  Other peers validate back to trust anchors but do not
   check names of certificates.  What name types are supported and what
   configuration is easy to perform depend significantly on the peer in
   question.

   Specifications also make the problem worse.  For example, [<a href="rfc5281.html" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)"'>RFC5281</a>]
   indicates that the only impact of failing to perform certificate
   validation is that the inner method can be attacked.  Administrators
   and implementors believing this claim may believe that protection
   from passive attacks is sufficient.

   In addition, some deployments such as provisioning or strong inner
   methods are designed to work without certificate validation.
   <a href="#section-3.9">Section 3.9</a> of the tunnel requirements document [<a href="rfc6678.html" title='"Requirements for a Tunnel-Based Extensible Authentication Protocol (EAP) Method"'>RFC6678</a>] discusses
   this requirement.




<span class="grey">Hartman, et al.               Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20Server%20Policy"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  Server Policy</span>

   Server policy can potentially prevent the second condition (attacker
   being able to respond to inner authentication) from being possible.
   If the server only performs a particular inner authentication within
   a tunnel, then the attacker cannot gain a response to the inner
   authentication without there being such a tunnel.  The attacker may
   be able to add a second layer of tunnels; see Figure 3.  The inner
   tunnel may limit the attacker's capabilities; for example, if channel
   binding is performed over tunnel t2 in the figure, then an attacker
   cannot observe or influence it.

    Peer                Attacker         Service         AAA Server
     |                     |                 |                |
     |                     |                 |                |
     |Peer Initiates Connection to a Service |                |
     |---------------------+----X-----------&gt;|                |
     |   (Intercepted by an Attacker)        |                |
     |                     |                 |                |
     |                     |                 |                |
     | Tunnel Establishment|                 |                |
     |&lt;-------------------&gt;|                 |                |
     |.....................|                 |                |
     |       Tunnel t1     |                 |                |
     |                     |                 |                |
     |.......................................... .............|
     |                        Tunnel t2                       |
     |                                                        |
     |                                                        |
     |                       Inner Method                     |
     |&lt;======================================================&gt;|
     |                                                        |
     |.......................................... .............|
     |                     |                 |                |
     |.....................|                 |                |
     |                     |                 |                |
     |        Peer         |                 |                |
     |    Connected to     |&lt;----------------------MSK keys --|
     |      Attacker       |                 |                |
     |&lt;-------------------&gt;|                 |                |
     |                     |                 |                |

   A tunnel t1 from the peer to the attacker contains a tunnel t2 from
   the peer to the home EAP server.  Inside tunnel t2 is an inner
   authentication.

                    Figure 3: Multiple Layered Tunnels




<span class="grey">Hartman, et al.               Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   Peer policy can be combined with this server policy to help prevent
   conditions 1 (attacker can establish a tunnel the peer will use) and
   2 (attacker can respond to inner authentication).  If the peer
   requires exactly one tunnel of a particular type and the EAP server
   only performs inner authentication over a tunnel of this type, then
   the attacker cannot establish tunnel t1 in the figure above.
   Configuring this peer policy may be more challenging than configuring
   policy on the EAP server.

   An attacker may be able to mount a more traditional man-in-the-middle
   attack in this instance; see Figure 4.  This policy on the peer and
   EAP server combined with a tunnel method that supports cryptographic
   binding will allow the EAP server to detect the attacker.  This means
   the attacker cannot act as a legitimate NAS and, in particular, does
   not obtain the MSK.  So, if the tunnel between the attacker and peer
   also requires cryptographic binding and if the cryptographic binding
   requires both the EAP server and peer to prove knowledge of the inner
   MSK, then the authentication will fail.  If cryptographic binding is
   not performed, then this attack may succeed.
































<span class="grey">Hartman, et al.               Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


     Peer                Attacker         Service         AAA Server
      |                     |                 |                |
      |                     |                 |                |
      |Peer Initiates Connection to a Service |                |
      |---------------------+----X-----------&gt;|                |
      |   (Intercepted by an Attacker)        |                |
      |                     |                 |                |
      |                     |                 |                |
      | Tunnel Establishment|       Tunnel Establishment       |
      |&lt;-------------------&gt;|&lt;--------------------------------&gt;|
      |.....................|.................... .............|
      |       Tunnel t1     |             Tunnel t2            |
      |                     |                                  |
      |      Tunneled       |                                  |
      |       Method        |        Tunneled Method           |
      |&lt;===================&gt;|&lt;================================&gt;|
      |                     |                                  |
      |.....................|..................................|
      |                     |                 |                |
      |        Peer         |                 |                |
      |    Connected to     |                 |                |
      |      Attacker       |                 |                |
      |&lt;-------------------&gt;|                 |                |
      |                     |                 |                |

   A tunnel t1 extends from the peer to the attacker.  A tunnel t2
   extends from the attacker to the home EAP server.  An inner EAP
   authentication is forwarded unmodified by the attacker from tunnel t1
   to tunnel t2.  The attacker can observe this inner authentication.

             Figure 4: A Traditional Man-in-the-Middle Attack

   Cryptographic binding is only a valuable component of a defense if
   the inner authentication is a key-deriving EAP method.  Most tunnel
   methods also support non-EAP inner authentication such as Microsoft
   CHAP version 2 [<a href="rfc2759.html" title='"Microsoft PPP CHAP Extensions, Version 2"'>RFC2759</a>].  This may undermine cryptographic binding
   in a number of ways.  An attacker may be able to convert an EAP
   method into a compatible non-EAP form of the same credential to
   suppress cryptographic binding.  In addition, an inner authentication
   may be available through an entirely different means.  For example, a
   Lightweight Directory Access Protocol [<a href="rfc4510.html" title='"Lightweight Directory Access Protocol (LDAP): Technical Specification Road Map"'>RFC4510</a>] or other directory
   server may provide an attacker a way to get challenges and provide
   responses for an authentication mechanism entirely outside of the
   AAA/EAP context.  An attacker with this capability may be able to get
   around server policy requiring an inner authentication be used only
   in a given type of tunnel.





<span class="grey">Hartman, et al.               Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   To recap, the following policy conditions appear sufficient to
   prevent a server insertion attack:

   1.  Peer and EAP server require a particular inner EAP method used
       within a particular tunnel method.

   2.  The inner EAP method's authentication is only available within
       the tunnel and through no other means including non-EAP means.

   3.  The inner EAP method produces a key.

   4.  The tunnel method uses cryptographic binding and the peer
       requires the other end of the tunnel to prove knowledge of the
       inner MSK.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.3.%20%20Existing%20Cryptographic%20Binding"></a><a class="selflink" href="#section-3.2.3" name="section-3.2.3">3.2.3</a>.  Existing Cryptographic Binding</span>

   The most advanced examples of cryptographic binding today work at two
   levels.  First, the server and peer prove to each other knowledge of
   the inner MSK.  Then, the inner MSK is combined with some outer key
   material to form the tunnel's EAP keys.  This is sufficient to detect
   an inserted server or peer provided that the attacker does not learn
   the inner MSK.  This seems sufficient to defend against attackers who
   cannot act as a legitimate NAS.

   The definition of cryptographic binding in [<a href="rfc3748.html" title='"Extensible Authentication Protocol (EAP)"'>RFC3748</a>] does not require
   these steps.  To meet that definition, it would be sufficient for a
   peer to prove knowledge of the inner key to the EAP server.  This
   would open some additional attacks.  For example, by indicating
   success, an attacker might be able to mask a cryptographic binding
   failure.  The peer is unlikely to be able to detect the failure,
   especially if only the tunnel key material is used for the final
   keys.

   As discussed in the previous section, cryptographic binding is only
   effective when the inner method is EAP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.4.%20%20Introducing%20EMSK-Based%20Cryptographic%20Binding"></a><a class="selflink" href="#section-3.2.4" name="section-3.2.4">3.2.4</a>.  Introducing EMSK-Based Cryptographic Binding</span>

   Cryptographic binding can be strengthened when the inner EAP method
   supports an Extended Master Session Key (EMSK).  The EMSK is never
   disclosed to any party other than the EAP server or peer, so even a
   legitimate NAS cannot learn the EMSK.  So, if the same techniques
   currently applied to the inner MSK are applied to the inner EMSK,
   then condition 3 (completing tunnel authentication) will not hold
   because the attacker cannot complete this new form of cryptographic
   binding.  This does not prevent the attacker from learning




<span class="grey">Hartman, et al.               Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   confidential information such as a channel-binding request sent over
   the tunnel prior to cryptographic binding.

   Obviously, as with all forms of cryptographic binding, cryptographic
   binding only works for key-deriving inner EAP methods.  Also, some
   deployments (see <a href="#section-3.3">Section 3.3</a>) insert intermediates between the peer
   and the EAP server.  EMSK-based cryptographic binding is incompatible
   with these deployments because the intermediate cannot learn the
   EMSK.

   Formally, EMSK-based cryptographic binding is a security claim for
   EAP tunnel methods that holds when:

   1.  The peer proves to the server that the peer participating in any
       inner method is the same as the peer for the tunnel method.

   2.  The server proves to the peer that the server for any inner
       method is the same as the server for the tunnel method.

   3.  The MSK and EMSK for the tunnel depend on the MSK and EMSK of
       inner methods.

   4.  The peer MUST be able to force the authentication to fail if the
       peer is unable to confirm the identity of the server.

   5.  Proofs offered need to be secure even against attackers who know
       the inner method MSK.

   If EMSK-based cryptographic binding is not an optional facility, it
   provides a strong defense against server insertion attacks and other
   tunnel man-in-the-middle (MITM) attacks for inner methods that
   provide an EMSK.  The strength of the defense is dependent on the
   strength of the inner method.  EMSK-based cryptographic binding MAY
   be provided as an optional facility.  The value of EMSK-based
   cryptographic binding is reduced somewhat if it is an optional
   feature.  It permits configurations where a peer uses other means to
   authenticate the server if the peer has sufficient information
   configured to validate the certificate and identity of an EAP server
   while using EMSK-based cryptographic binding for deployments where
   that is possible.

   If EMSK-based cryptographic binding is an optional facility, the
   negotiation of whether to use it MUST be protected by the inner MSK
   or EMSK.  Typically, the MSK will be used because the primary
   advantage of making EMSK-based cryptographic binding an optional
   facility is to permit intermediates who know only the MSK to decline
   to use EMSK-based cryptographic binding.  The peer MUST have an




<span class="grey">Hartman, et al.               Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   opportunity to fail the authentication after the server declines to
   use EMSK-based cryptographic binding.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.5.%20%20Mix%20Key%20into%20Long-Term%20Credentials"></a><a class="selflink" href="#section-3.2.5" name="section-3.2.5">3.2.5</a>.  Mix Key into Long-Term Credentials</span>

   Another defense against tunnel MITM attacks, potentially including
   server insertion attacks, is to use a different credential for
   tunneled methods from other authentications.  This may prevent the
   second condition (attacker being able to respond to inner
   authentication) from taking place.  For example, if key material from
   the tunnel is mixed into a shared secret or password that is the
   basis of the inner authentication, then the second condition will not
   hold unless the attacker already knows this shared secret.  The
   advantage of this approach is that it seems to be the only way to
   strengthen non-EAP inner authentications within a tunnel.

   There are several disadvantages.  Choosing a function to mix the
   tunnel key material into the inner authentication will be very
   dependent on the inner authentication.  In addition, this appears to
   involve a layering violation.  However, exploring the possibility of
   providing a solution like this seems important because it can
   function for inner authentications where no other approach will work.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Intended%20Intermediates"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Intended Intermediates</span>

   Some deployments introduce a tunnel server separate from the EAP
   server; see [<a href="rfc5281.html" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)"'>RFC5281</a>] for an example of this style of deployment.
   The tunnel server is between the NAS and the EAP server.  The only
   difference between such an intermediate and an attacker is that the
   intermediate provides some function valuable to the peer or EAP
   server and that the intermediate is trusted by the peer.  If peers
   are configured with the necessary information to validate
   certificates of these intermediates and to confirm their identity,
   then tunnel MITM and inserted server attacks can be defended against.
   The intermediates need to be trusted with regard to channel binding
   and other services that the peer depends on.

   Support for trusted intermediates is not a requirement according to
   the tunnel method requirements.

   It seems reasonable to treat trusted intermediates as a special case
   if they are supported and to focus on the security of the case where
   there are not intermediates in the tunnel as the common case.








<span class="grey">Hartman, et al.               Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Recommendations"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Recommendations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Mutual%20Cryptographic%20Binding"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Mutual Cryptographic Binding</span>

   The Tunnel EAP method [<a href="#ref-TEAP" title='"Tunnel EAP Method (TEAP) Version 1"'>TEAP</a>] should gain support for EMSK-based
   cryptographic binding.

   As channel-binding support is added to existing EAP methods, EMSK-
   based cryptographic binding or some other form of cryptographic
   binding that protects against server insertion should also be added
   to these methods.  Mutual cryptographic binding may also be valuable
   when other services are added to EAP methods that may require a peer
   trust an EAP server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20State%20Tracking"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  State Tracking</span>

   Today, mutual authentication in EAP is thought of as a security claim
   about a method.  However, in practice, it's an attribute of a
   particular exchange.  Mutual authentication can be obtained via
   checking certificates, through mutual cryptographic binding, or in
   very controlled cases through carefully crafted peer and server
   policy combined with existing cryptographic binding.  Using services
   like channel binding that involve the peer trusting the EAP server
   should require mutual authentication be present in the session.

   To accomplish this, implementations including channel binding or
   other peer services MUST track whether mutual authentication has
   happened.  They SHOULD default to not permitting these peer services
   unless mutual authentication has happened.  They SHOULD support a
   configuration where the peer fails to authenticate unless mutual
   authentication takes place.  Discussion of whether this configuration
   should be recommended as a default is required.

   The Tunnel EAP method [<a href="#ref-TEAP" title='"Tunnel EAP Method (TEAP) Version 1"'>TEAP</a>] should permit peers to force
   authentication failure if they are unable to perform mutual
   authentication.  The protocol should permit this to be deferred until
   after mutual cryptographic binding is considered.

   Services such as channel binding should be deferred until after
   cryptographic binding or mutual cryptographic binding.

   An additional complication arises when a tunnel method authenticates
   multiple parties such as authenticating both the peer machine and the
   peer user to the EAP server.  Depending on how mutual authentication
   is achieved, only some of these parties may have confidence in it.
   For example, if a strong shared secret is used to mutually
   authenticate the user and the EAP server, the machine may not have
   confidence that the EAP server is the authenticated party if the



<span class="grey">Hartman, et al.               Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   machine cannot trust the user not to disclose the shared secret to an
   attacker.  In these cases, the parties that have achieved mutual
   authentication need to be considered when evaluating whether to use
   peer services.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Certificate%20Naming"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Certificate Naming</span>

   Work is required to promote interoperable deployment of server
   certificate validation by peers.  A standard way to name EAP servers
   is required.  Recommendations for what name forms peers should
   implement is required.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Inner%20Mixing"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Inner Mixing</span>

   More consideration of the proposal to mix some key material into
   inner authentications is desired.  Currently, the proposal is under-
   defined and fairly invasive.  Are there versions of this proposal
   that would be valuable?  Is there a way to view it as something more
   abstract so that it does not involve a combinatorial explosion as a
   result of considering specific tunnels and inner methods?

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Survey%20of%20Tunnel%20Methods"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Survey of Tunnel Methods</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Tunnel%20EAP%20%28TEAP%29%20Method"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Tunnel EAP (TEAP) Method</span>

   The Tunnel EAP method [<a href="#ref-TEAP" title='"Tunnel EAP Method (TEAP) Version 1"'>TEAP</a>] provides several features designed to
   limit man-in-the-middle vulnerabilities and provide a safe platform
   for peer services.

   TEAP implementations support checking the Network Access Identifier
   (NAI) realm portion against a DNS subjectAlternativeName in the
   certificate of the TEAP server.  TEAP supports EMSK-based
   cryptographic binding as a way to achieve mutual cryptographic
   binding.  TEAP also supports MSK-based cryptographic binding for
   cases where the EMSK is not available; this cryptographic binding
   does not provide sufficient assurance for peer services.  TEAP
   provides recommendations on conditions that need to be met prior to
   using peer services.  These recommendations explicitly address when
   the MSK-based cryptographic binding is sufficient and when EMSK-based
   cryptographic binding is required.  TEAP meets the recommendations
   for implementations outlined in this memo.










<span class="grey">Hartman, et al.               Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Flexible%20Authentication%20via%20Secure%20Tunneling%20%28FAST%29"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Flexible Authentication via Secure Tunneling (FAST)</span>

   EAP-FAST [<a href="rfc4851.html" title='"The Flexible Authentication via Secure Tunneling Extensible Authentication Protocol Method (EAP-FAST)"'>RFC4851</a>] provides MSK-based cryptographic binding.
   EAP-FAST requires that server certificates be validated.  However, no
   guidance is given on how servers are named, so the specification does
   not provide enough guidance to interoperably enforce this
   requirement.

   EAP-FAST does not support channel binding or other peer services,
   although the protocol is extensible and TLVs could be defined for
   peer services.  If the certificates are actually validated and names
   checked, then EAP-FAST would provide security guarantees sufficient
   to use these peer services.  However, the cryptographic binding in
   EAP-FAST is not strong enough to secure peer services if the server
   certificate is not validated and name checked.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20EAP%20Tunneled%20Transport%20Layer%20Security%20%28EAP-TTLS%29"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  EAP Tunneled Transport Layer Security (EAP-TTLS)</span>

   The EAP Tunneled Transport Layer Security Version 0 (EAP-TTLS)
   [<a href="rfc5281.html" title='"Extensible Authentication Protocol Tunneled Transport Layer Security Authenticated Protocol Version 0 (EAP-TTLSv0)"'>RFC5281</a>] does not support cryptographic binding.  It also does not
   support peer services such as channel binding although they could be
   added using extensible AVPs.

   EAP-TTLS recommends that implementations SHOULD validate certificates
   but gives no guidance on how to handle naming.  Even if certificates
   are validated, EAP-TTLS is not generally suited to peer services.  As
   an example, EAP-TTLS does not include protected result indication.
   So, an unprotected EAP success packet can end the authentication.  In
   addition, it is difficult for a peer to request services such as
   channel binding because the server ends the authentication as soon as
   authentication is successful.

   A variety of extensions, including EAP-TTLS version 1, improve some
   of these concerns.  Specification and implementation issues
   complicate analysis of these extensions.  As an example, most
   implementations can be tricked into using EAP-TTLS version 0.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   This memo examines the security considerations of providing new
   classes of service within EAP methods.  Traditionally, the primary
   focus of EAP is authenticating the peer to the network.  However, as
   the peer places trust in the EAP server, mutual authentication
   becomes more important.  This memo examines the security of mutual
   authentication for EAP tunnel methods.






<span class="grey">Hartman, et al.               Informational                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Acknowledgements"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Acknowledgements</span>

   The authors would like to thank Alan DeKok for helping to explore
   these attacks.  Alan focused the discussion on the importance of
   inner authentications that are not EAP and proposed mixing in key
   material as a way to resolve these authentications.

   Jari Arkko provided a review of the attack and valuable context on
   past efforts in developing cryptographic binding.

   Sam Hartman's and Margaret Wasserman's work on this memo is funded by
   Huawei.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3748" name="ref-RFC3748">RFC3748</a>]  Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H.
              Levkowetz, "Extensible Authentication Protocol (EAP)", <a href="rfc3748.html">RFC</a>
              <a href="rfc3748.html">3748</a>, June 2004.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-GSS-EAP" name="ref-GSS-EAP">GSS-EAP</a>]  Hartman, S. and J. Howlett, "A GSS-API Mechanism for the
              Extensible Authentication Protocol", Work in Progress,
              August 2012.

   [<a id="ref-PT-EAP" name="ref-PT-EAP">PT-EAP</a>]   Cam-Winget, N. and P. Sangster, "PT-EAP: Posture Transport
              (PT) Protocol For EAP Tunnel Methods", Work in Progress,
              March 2013.

   [<a id="ref-RFC2759" name="ref-RFC2759">RFC2759</a>]  Zorn, G., "Microsoft PPP CHAP Extensions, Version 2", <a href="rfc2759.html">RFC</a>
              <a href="rfc2759.html">2759</a>, January 2000.

   [<a id="ref-RFC4510" name="ref-RFC4510">RFC4510</a>]  Zeilenga, K., "Lightweight Directory Access Protocol
              (LDAP): Technical Specification Road Map", <a href="rfc4510.html">RFC 4510</a>, June
              2006.

   [<a id="ref-RFC4851" name="ref-RFC4851">RFC4851</a>]  Cam-Winget, N., McGrew, D., Salowey, J., and H. Zhou, "The
              Flexible Authentication via Secure Tunneling Extensible
              Authentication Protocol Method (EAP-FAST)", <a href="rfc4851.html">RFC 4851</a>, May
              2007.






<span class="grey">Hartman, et al.               Informational                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7029.html">RFC 7029</a>                  Mutual Crypto Binding             October 2013</span>


   [<a id="ref-RFC5281" name="ref-RFC5281">RFC5281</a>]  Funk, P. and S. Blake-Wilson, "Extensible Authentication
              Protocol Tunneled Transport Layer Security Authenticated
              Protocol Version 0 (EAP-TTLSv0)", <a href="rfc5281.html">RFC 5281</a>, August 2008.

   [<a id="ref-RFC6677" name="ref-RFC6677">RFC6677</a>]  Hartman, S., Clancy, T., and K. Hoeper, "Channel-Binding
              Support for Extensible Authentication Protocol (EAP)
              Methods", <a href="rfc6677.html">RFC 6677</a>, July 2012.

   [<a id="ref-RFC6678" name="ref-RFC6678">RFC6678</a>]  Hoeper, K., Hanna, S., Zhou, H., and J. Salowey,
              "Requirements for a Tunnel-Based Extensible Authentication
              Protocol (EAP) Method", <a href="rfc6678.html">RFC 6678</a>, July 2012.

   [<a id="ref-TEAP" name="ref-TEAP">TEAP</a>]     Zhou, H., Cam-Winget, N., Salowey, J., and S. Hanna,
              "Tunnel EAP Method (TEAP) Version 1", Work in Progress,
              September 2013.

   [<a id="ref-TUNNEL-MITM" name="ref-TUNNEL-MITM">TUNNEL-MITM</a>]
              Asokan, N., Niemi, V., and K. Nyberg, "Man-in-the-Middle
              in Tunnelled Authentication Protocols", Cryptology ePrint
              Archive: Report 2002/163, November 2002.

Authors' Addresses

   Sam Hartman
   Painless Security

   EMail: hartmans-ietf@mit.edu


   Margaret Wasserman
   Painless Security

   EMail: mrw@painless-security.com
   URI:   <a href="http://www.painless-security.com/">http://www.painless-security.com/</a>


   Dacheng Zhang
   Huawei

   EMail: zhangdacheng@huawei.com











Hartman, et al.               Informational                    [Page 19]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7029 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:25 GMT --></html>