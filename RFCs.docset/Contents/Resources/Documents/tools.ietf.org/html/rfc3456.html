<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3456 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:47 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:3456" name="DC.Identifier"/>
<meta content="This memo explores the requirements for host configuration in IPsec
tunnel mode, and describes how the Dynamic Host Configuration Protocol
(DHCPv4) may be leveraged for configuration. In many remote access
scenarios, a mechanism for making the remote host appear to be present
on the local corporate network is quite useful. This may be
accomplished by assigning the host a &quot;virtual&quot; address from the
corporate network, and then tunneling traffic via IPsec from the
host's ISP-assigned address to the corporate security gateway. In
IPv4, DHCP provides for such remote host configuration. [STANDARDS-
TRACK]" name="DC.Description.Abstract"/>
<meta content="Aboba, Bernard" name="DC.Creator"/>
<meta content="Kelly, Scott" name="DC.Creator"/>
<meta content="Gupta, Vipul" name="DC.Creator"/>
<meta content="Patel, Baiju V." name="DC.Creator"/>
<meta content="January, 2003" name="DC.Date.Issued"/>
<meta content="Dynamic Host Configuration Protocol (DHCPv4) Configuration of IPsec Tunnel Mode" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3456 - Dynamic Host Configuration Protocol (DHCPv4) Configuration of IPsec Tunnel Mode</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3456.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3456" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ipsec-dhcp" title="draft-ietf-ipsec-dhcp">draft-ietf-ipse...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3456" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3456" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3456" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                           B. Patel
Request for Comments: 3456                                    Intel Corp
Category: Standards Track                                       B. Aboba
                                                               Microsoft
                                                                S. Kelly
                                                               Airespace
                                                                V. Gupta
                                                  Sun Microsystems, Inc.
                                                            January 2003


              <span class="h1">Dynamic Host Configuration Protocol (DHCPv4)</span>
                   <span class="h1">Configuration of IPsec Tunnel Mode</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

Abstract

   This memo explores the requirements for host configuration in IPsec
   tunnel mode, and describes how the Dynamic Host Configuration
   Protocol (DHCPv4) may be leveraged for configuration.  In many remote
   access scenarios, a mechanism for making the remote host appear to be
   present on the local corporate network is quite useful.  This may be
   accomplished by assigning the host a "virtual" address from the
   corporate network, and then tunneling traffic via IPsec from the
   host's ISP-assigned address to the corporate security gateway.  In
   IPv4, DHCP provides for such remote host configuration.














<span class="grey">Patel, et. al.              Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction...................................................  <a href="#page-2">2</a>
     <a href="#section-1.1">1.1</a> Terminology.................................................  <a href="#page-2">2</a>
     <a href="#section-1.2">1.2</a> Requirements Language.......................................  <a href="#page-3">3</a>
   <a href="#section-2">2</a>. IPsec tunnel mode configuration requirements...................  <a href="#page-3">3</a>
     <a href="#section-2.1">2.1</a> DHCP configuration evaluation...............................  <a href="#page-3">3</a>
     <a href="#section-2.2">2.2</a> Summary.....................................................  <a href="#page-4">4</a>
   <a href="#section-3">3</a>. Scenario overview..............................................  <a href="#page-4">4</a>
     <a href="#section-3.1">3.1</a> Configuration walk-through..................................  <a href="#page-5">5</a>
   <a href="#section-4">4</a>. Detailed description...........................................  <a href="#page-6">6</a>
     <a href="#section-4.1">4.1</a> DHCPDISCOVER message processing.............................  <a href="#page-6">6</a>
     <a href="#section-4.2">4.2</a> DHCP Relay behavior.........................................  <a href="#page-9">9</a>
     <a href="#section-4.3">4.3</a> DHCPREQUEST message processing.............................. <a href="#page-10">10</a>
     <a href="#section-4.4">4.4</a> DHCPACK message processing.................................. <a href="#page-10">10</a>
     <a href="#section-4.5">4.5</a> Configuration policy........................................ <a href="#page-11">11</a>
   <a href="#section-5">5</a>. Security Considerations........................................ <a href="#page-11">11</a>
   <a href="#section-6">6</a>. IANA Considerations............................................ <a href="#page-12">12</a>
   <a href="#section-7">7</a>. Intellectual Property Statement................................ <a href="#page-12">12</a>
   <a href="#section-8">8</a>. References..................................................... <a href="#page-13">13</a>
     <a href="#section-8.1">8.1</a> Normative References........................................ <a href="#page-13">13</a>
     <a href="#section-8.2">8.2</a> Informative References...................................... <a href="#page-13">13</a>
   <a href="#section-9">9</a>. Acknowledgments................................................ <a href="#page-14">14</a>
   Appendix - IKECFG evaluation...................................... <a href="#page-15">15</a>
   Authors' Addresses................................................ <a href="#page-17">17</a>
   Full Copyright Statement ......................................... <a href="#page-18">18</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   In many remote access scenarios, a mechanism for making the remote
   host appear to be present on the local corporate network is quite
   useful.  This may be accomplished by assigning the host a "virtual"
   address from the corporate network, and then tunneling traffic via
   IPsec from the host's ISP-assigned address to the corporate security
   gateway.  In IPv4, Dynamic Host Configuration Protocol (DHCP) [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>]
   provides for such remote host configuration. This document explores
   the requirements for host configuration in IPsec tunnel mode, and
   describes how DHCPv4 may be leveraged for configuration.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   This document uses the following terms:

   DHCP client
         A DHCP client or "client" is an Internet host using DHCP to
         obtain configuration parameters such as a network address.





<span class="grey">Patel, et. al.              Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   DHCP server
         A DHCP server or "server" is an Internet host that returns
         configuration parameters to DHCP clients.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Requirements%20language"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Requirements language</span>

   In this document, the key words "MAY", "MUST, "MUST NOT", "optional",
   "recommended", "SHOULD", and "SHOULD NOT", are to be interpreted as
   described in [<a href="#ref-1" title='"Key words for use in RFCs to Indicate Requirement Levels"'>1</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20IPsec%20tunnel%20mode%20configuration%20requirements"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  IPsec tunnel mode configuration requirements</span>

   As described in [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>], the configuration requirements of a host with
   an IPsec tunnel mode interface include the need to obtain an IPv4
   address and other configuration parameters appropriate to the class
   of host.  In addition to meeting the basic requirements [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>], the
   following additional capabilities may be desirable:

      a. integration with existing IPv4 address management facilities
      b. support for address pool management
      c. reconfiguration when required
      d. support for fail-over
      e. maintaining security and simplicity in the IKE implementation.
      f. authentication where required

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20DHCP%20configuration%20evaluation"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  DHCP configuration evaluation</span>

   Leveraging DHCP for configuration of IPsec tunnel mode meets the
   basic requirements described in [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>].  It also provides the
   additional capabilities described above.

   Basic configuration
         In IPv4, leveraging DHCPv4 [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] for the configuration of IPsec
         tunnel mode satisfies the basic requirements described in [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>].
         Since the required configuration parameters described in [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>]
         are a subset of those already supported in DHCPv4 options [<a href="#ref-4" title='"DHCP Options and BOOTP Vendor Extensions"'>4</a>],
         no new DHCPv4 options are required, and no modifications to
         DHCPv4 [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] are required.

   Address management integration
         Since DHCPv4 is widely deployed for address management today,
         reuse of DHCPv4 for IPsec tunnel mode address management
         enables compatibility and integration with existing addressing
         implementations and IPv4 address management software.







<span class="grey">Patel, et. al.              Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   Address pool management
         As described in [<a href="#ref-18" title="Indiana">18</a>], DHCPv4 implementations support
         conditional behavior so that the address and configuration
         parameters assigned can be dependent on parameters included in
         the DHCPDISCOVER.  This makes it possible for the security
         gateway to ensure that the remote host receives an IP address
         assignment from the appropriate address pool, such as via the
         User Class option, described in [<a href="#ref-16" title='"The User Class Option for DHCP"'>16</a>].

   Reconfiguration
         DHCP supports the concept of configuration leases, and there is
         a proposal for handling forced reconfiguration [<a href="#ref-14" title='"DHCP reconfigure extension"'>14</a>].

   Fail-over support
         When leveraging DHCPv4, configuration and addressing state is
         kept on the DHCP server, not within the IKE implementation.  As
         a result, the loss of a tunnel server does not result in the
         loss of configuration and addressing state, thus making it
         easier to support fail-over [<a href="#ref-12" title='"DHCP Failover Protocol"'>12</a>].

   Security and simplicity
         Leveraging DHCPv4 also makes it easier to maintain security in
         the IKE implementation since no IKE modifications are required
         to support configuration.

   Authentication
         Where DHCPv4 authentication [<a href="#ref-5" title='"Authentication for DHCP Messages"'>5</a>] is required, this can be
         supported on an IPsec tunnel mode interface as it would be on
         any other interface.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Summary"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Summary</span>

   As described, DHCPv4 [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] meets the IPsec tunnel mode configuration
   requirements [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>], as well as providing additional capabilities.  As
   described in the Appendix, IKECFG [<a href="#ref-13" title='"The ISAKMP Configuration Method"'>13</a>] does not meet the basic
   requirements, nor does it provide the additional capabilities.  As a
   result, DHCPv4 is the superior alternative for IPsec tunnel mode
   configuration.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Scenario%20overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Scenario overview</span>

   IPsec [<a href="#ref-2" title='"Security Architecture for the Internet Protocol"'>2</a>], [<a href="#ref-6" title='"IP Authentication Header"'>6</a>]-[<a href="#ref-9" title='"The Internet Key Exchange (IKE)"'>9</a>] is a protocol suite defined to secure
   communication at the network layer between communicating peers.
   Among many applications enabled by IPsec, a useful application is to
   connect a remote host to a corporate intranet via a security gateway,
   using IPsec tunnel mode.  This host is then configured in such a
   manner so as to provide it with a virtual presence on the internal
   network.  This is accomplished in the following manner:



<span class="grey">Patel, et. al.              Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   A remote host on the Internet will connect to the security gateway
   and then establish an IPsec tunnel to it.  The remote host then
   interacts via the IPsec tunnel with a DHCPv4 server which provides
   the remote host with an address from the corporate network address
   space.  The remote host subsequently uses this as the source address
   for all interactions with corporate resources.  Note that this
   implies that the corporate security gateway continues to recognize
   the host's original, routable IP address as the tunnel endpoint.  The
   virtual identity assumed by the remote host when using the assigned
   address appears to the corporate network as though it were situated
   behind a security gateway bearing the original routable IP address.
   All the traffic between the remote host and the intranet will be
   carried over the IPsec tunnel via the security gateway as shown
   below:

                                          corporate net
    +------------------+                      |
    |    externally    |        +--------+    |   !~~~~~~~~~~!
    |+-------+ visible |        |        |    |   ! rmt host !
    ||virtual| host    |        |security|    |---! virtual  !
    || host  |         |--------|gateway/|    |   ! presence !
    ||       |&lt;================&gt;|  DHCP  |----|   !~~~~~~~~~~!
    |+-------+         |--------| Relay  |    |
    +------------------+   ^    +--------+    |   +--------+
                           |                  |---| DHCPv4 |
                         IPsec tunnel         |   | server |
                         with encapsulated    |   +--------+
                         traffic inside

   This scenario assumes that the remote host already has Internet
   connectivity and the host Internet interface is appropriately
   configured.  The mechanisms for configuration of the remote host's
   address for the Internet interface are well defined; i.e., PPP IP
   control protocol (IPCP), described in [<a href="#ref-10" title='"The PPP Internet Protocol Control Protocol (IPCP)"'>10</a>], DHCPv4, described in [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>],
   and static addressing.  The mechanisms for auto-configuration of the
   intranet are also standardized.  It is also assumed that the remote
   host has knowledge of the location of the security gateway.  This can
   be accomplished via DNS, using either A, KX [<a href="#ref-23" title='"Key Exchange Delegation Record for the DNS"'>23</a>], or SRV [<a href="#ref-24" title='"A DNS RR for specifying the location of services (DNS SRV)"'>24</a>]
   records.

   A typical configuration of the remote host in this application would
   use two addresses: 1) an interface to connect to the Internet
   (Internet interface), and 2) a virtual interface to connect to the
   intranet (intranet interface).  The IP address of the Internet and
   intranet interfaces are used in the outer and inner headers of the
   IPsec tunnel mode packet, respectively.





<span class="grey">Patel, et. al.              Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Configuration%20walk-through"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Configuration walk-through</span>

   The configuration of the intranet interface of the IPsec tunnel mode
   host is accomplished in the following steps:

   a. The remote host establishes an IKE security association with the
      security gateway in a main mode or aggressive mode exchange.  This
      IKE SA then serves to secure additional quick mode IPsec SAs.

   b. The remote host establishes a DHCP SA with the IPsec tunnel mode
      server in a quick mode exchange.  The DHCP SA is an IPsec tunnel
      mode SA established to protect initial DHCPv4 traffic between the
      security gateway and the remote host.  The DHCP SA MUST only be
      used for DHCP traffic.  The details of how this SA is set up are
      described in <a href="#section-4.1">Section 4.1</a>.

   c. DHCP messages are sent back and forth between the remote host and
      the DHCPv4 server.  The traffic is protected between the remote
      host and the security gateway using the DHCP SA established in
      step b.  After the DHCP conversation completes, the remote host's
      intranet interface obtains an IP address as well as other
      configuration parameters.

   d. The remote host MAY request deletion of the DHCP SA since future
      DHCP messages will be carried over a new IPsec tunnel.
      Alternatively, the remote host and the security gateway MAY
      continue to use the same SA for all subsequent traffic by adding
      temporary SPD selectors in the same manner as is provided for name
      ID types in [<a href="#ref-2" title='"Security Architecture for the Internet Protocol"'>2</a>].

   e. If a new IPsec tunnel is required, the remote host establishes a
      tunnel mode SA to the security gateway in a quick mode exchange.
      In this case, the new address assigned via DHCPv4 SHOULD be used
      in the quick mode ID.

   At the end of the last step, the remote host is ready to communicate
   with the intranet using an IPsec tunnel.  All the IP traffic
   (including future DHCPv4 messages) between the remote host and the
   intranet are now tunneled over this IPsec tunnel mode SA.

   Since the security parameters used for different SAs are based on the
   unique requirements of the remote host and the security gateway, they
   are not described in this document.  The mechanisms described here
   work best when the VPN is implemented using a virtual interface.







<span class="grey">Patel, et. al.              Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Detailed%20description"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Detailed description</span>

   This section provides details relating to the messages exchanged
   during the setup and teardown of the DHCP SAs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20DHCPDISCOVER%20message%20processing"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  DHCPDISCOVER message processing</span>

   The events begin with the remote host intranet interface generating a
   DHCPDISCOVER message.  Details are described below:

   FIELD      OCTETS       DESCRIPTION

   op            1  Message op code / message type.
                    1 = BOOTREQUEST, 2 = BOOTREPLY
   htype         1  Hardware address type.  Set to value 31.
                    signifying an IPsec tunnel mode virtual interface.
   hlen          1  Hardware address length
   hops          1  Client sets to zero, optionally used by relay agents
                    when booting via a relay agent.
   xid           4  Transaction ID, a random number chosen by the
                    client, used by the client and server to associate
                    messages and responses between a client and a
                    server.
   secs          2  Filled in by client, seconds elapsed since client
                    began address acquisition or renewal process.
   flags         2  Flags.  Broadcast bit MUST be set to zero.
   ciaddr        4  Client IP address; only filled in if client is in
                    BOUND, RENEW or REBINDING state.
   yiaddr        4  'your' (client) IP address.
   siaddr        4  IP address of next server to use in bootstrap;
                    returned in DHCPOFFER, DHCPACK by server.
   giaddr        4  Security gateway interface IPv4 address, used in
                    booting via a relay agent.
   chaddr       16  Client hardware address.  Should be unique.
   sname        64  Optional server host name, null terminated string.
   file        128  Boot file name, null terminated string; "generic"
                    name or null in DHCPDISCOVER, fully qualified
                    directory-path name in DHCPOFFER.
   options     var  Optional parameters field.

         Table 1:  Description of fields in the DHCP message

   The htype value is set to the value 31, signifying a virtual IPsec
   tunnel mode interface, in order to enable the DHCP server to
   differentiate VPN from non-VPN requests.  The chaddr field of the
   DHCPDISCOVER MUST include an identifier unique to the virtual subnet.
   The client MUST use the same chaddr field in all subsequent messages
   within the same DHCPv4 exchange.  In addition, the chaddr SHOULD be



<span class="grey">Patel, et. al.              Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   persistent between reboots so that the DHCP server will be able to
   re-assign the same address if desired.

   The hlen and chaddr fields SHOULD be determined as follows:

   a. If one or more LAN interfaces are available, the hlen and chaddr
      fields SHOULD be determined from the active LAN interface with the
      lowest interface number.  If no active LAN interface is available,
      then the parameters SHOULD be determined from the LAN interface
      with the lowest interface number.  This enables the chaddr to be
      persistent between reboots, as long as the LAN interface hardware
      is not removed.

   b. If there is no LAN interface, the chaddr field SHOULD be
      determined by concatenating x'4000', the IPv4 address of the
      interface supplying network connectivity, and an additional octet.
      The x'4000' value indicates a locally administered unicast MAC
      address, thus guaranteeing that the constructed chaddr value will
      not conflict with a globally assigned value.

      The additional octet (which MAY represent an interface number)
      SHOULD be persistent between reboots, so that the chaddr value
      will be persistent across reboots if the assigned IPv4 address
      remains consistent.

   If the above prescription is followed, then the chaddr will always be
   unique on the virtual subnet provided that the remote host only
   brings up a single tunnel to the security gateway.  Where a LAN
   interface is available, the chaddr will be globally unique.  When a
   non-LAN interface is available and a unique Internet address is
   assigned to the remote host, the chaddr will also be globally unique.
   Where a private IP address [<a href="#ref-22" title='"Address Allocation for Private Internets"'>22</a>] is assigned to a non-LAN interface,
   it will not be globally unique.  However, in this case packets will
   not be routed back and forth between the remote host and the security
   gateway unless the external network and corporate network have a
   consistent addressing plan.  In this case the private IP address
   assigned to the remote host will be unique on the virtual subnet.

   For use in DHCPv4 configuration of IPsec tunnel mode, the client-
   identifier option MUST be included, MUST be unique within the virtual
   subnet and SHOULD be persistent across reboots.  Possibilities
   include:

   a. The htype/chaddr combination.  If assigned as described above,
      this will be unique on the virtual subnet.  It will be persistent
      across reboots for a LAN interface.  If a non-LAN interface is
      used, it may not be persistent across reboots if the assigned IP
      address changes.



<span class="grey">Patel, et. al.              Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   b. The machine FQDN concatenated with an interface number.  Assuming
      that the machine FQDN does not conflict with that of another
      machine, this will be unique on the virtual subnet as well as
      persistent across reboots.

   c. The user NAI concatenated with an interface number.  Assuming that
      the user is only connected to the VPN at one location, this will
      be unique on the subnet as well as persistent across reboots.

   In order to deliver the DHCPDISCOVER packet from the intranet
   interface to the security gateway, an IKE Phase 1 SA is established
   between the Internet interface and the security gateway.  A phase 2
   (quick mode) DHCP SA tunnel mode SA is then established.  The key
   lifetime for the DHCP SA SHOULD be on the order of minutes since it
   will only be temporary.  The remote host SHOULD  use an IDci payload
   of 0.0.0.0/UDP/port 68 in the quick mode exchange.  The security
   gateway will use an IDcr payload of its own Internet address/UDP/port
   67.  The DHCP SA is established as a tunnel mode SA with filters set
   as follows:

      From remote host to security gateway: Any to Any, destination: UDP
      port 67

      From security gateway to remote host: Any to Any, destination: UDP
      port 68

   Note that these filters will work not only for a client without
   configuration, but also with a client that has previously obtained a
   configuration lease, and is attempting to renew it.  In the latter
   case, the DHCP SA will initially be used to send a DHCPREQUEST rather
   than a DHCPDISCOVER message.  The initial DHCPv4 message
   (DHCPDISCOVER or DHCPREQUEST) is then tunneled to the security
   gateway using the tunnel mode SA.  Note that since the DHCPDISCOVER
   packet has a broadcast address destination, the IPsec implementations
   on both the remote host and the security gateway must be capable of
   handling this.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20DHCP%20Relay%20behavior"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  DHCP Relay behavior</span>

   While other configurations are possible, typically the DHCPv4 server
   will not reside on the same machine as the security gateway, which
   will act as a DHCPv4 relay, inserting its address in the "giaddr"
   field.  In this case, the security gateway relays packets between the
   client and the DHCPv4 server, but does not request or renew addresses
   on the client's behalf.  While acting as a DHCP Relay, the security
   gateway MAY implement DHCP Relay load balancing as described in [<a href="#ref-19" title='"DHC Load Balancing Algorithm"'>19</a>].





<span class="grey">Patel, et. al.              Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   Since DHCP Relays are stateless, the security gateway SHOULD insert
   appropriate information in the DHCP message prior to forwarding to
   one or more DHCP servers.  This enables the security gateway to route
   the corresponding DHCPOFFER message(s) back to the remote host on the
   correct IPsec tunnel, without having to keep state gleaned from the
   DISCOVER, such as a table of the xid, chaddr and tunnel.

   If the security gateway maintains a separate subnet for each IPsec
   tunnel, then this can be accomplished by inserting the appropriate
   interface address in the giaddr field.  Alternatively, the security
   gateway can utilize the DHCP Relay Agent Information Option [<a href="#ref-17" title='"DHCP Relay Agent Information Option"'>17</a>].  In
   this case, the virtual port number of the tunnel is inserted in the
   Agent Circuit ID Sub-option (sub-option code 1).

   To learn the internal IP address of the client in order to route
   packets to it, the security gateway will typically snoop the yiaddr
   field within the DHCPACK and plumb a corresponding route as part of
   DHCP Relay processing.

   Where allocating a separate subnet for each tunnel is not feasible,
   and the DHCP server does not support the Relay Agent Information
   Option, stateless Relay Agent behavior will not be possible.  In such
   cases, implementations MAY devise a mapping between the xid, chaddr,
   and tunnel in order to route the DHCP server response to the
   appropriate tunnel endpoint.  Note that this is particularly
   undesirable in large VPN servers where the resulting state will be
   substantial.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20DHCPREQUEST%20message%20processing"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  DHCPREQUEST message processing</span>

   After the Internet interface has received the DHCPOFFER message, it
   forwards this to the intranet interface after IPsec processing.  The
   intranet interface then responds by creating a DHCPREQUEST message,
   which is tunneled to security gateway using the DHCP SA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20DHCPACK%20message%20processing"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  DHCPACK message processing</span>

   The DHCPv4 server then replies with a DHCPACK or DHCPNAK message,
   which is forwarded down the DHCP SA by the security gateway.  The
   remote host Internet interface then forwards the DHCPACK or DHCPNAK
   message to the intranet interface after IPsec processing.

   After processing of the DHCPACK, the intranet interface is configured
   and the Internet interface can establish a new IPsec tunnel mode SA
   to the security gateway.  The remote host may now delete the DHCP
   tunnel mode SA.  All future DHCP messages sent by the client,
   including DHCPREQUEST, DHCPINFORM, DHCPDECLINE, and DHCPRELEASE
   messages will use the newly established VPN SA.  Similarly, all DHCP



<span class="grey">Patel, et. al.              Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   messages subsequently sent by the DHCPv4 server will be forwarded by
   the security gateway (acting as a DHCP Relay) using the IPsec tunnel
   mode SA, including DHCPOFFER, DHCPACK, and DHCPNAK messages.

   It SHOULD be possible to configure the remote host to forward all
   Internet-bound traffic through the tunnel.  While this adds overhead
   to round-trips between the remote host and the Internet, it provides
   some added security in return for this, in that the corporate
   security gateway may now filter traffic as it would if the remote
   host were physically located on the corporate network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20Configuration%20policy"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  Configuration policy</span>

   Several mechanisms can be used to enable remote hosts to be assigned
   different configurations.  For example, clients may use the User
   Class Option [<a href="#ref-16" title='"The User Class Option for DHCP"'>16</a>] to request various configuration profiles.  The
   DHCPv4 server may also take a number of other variables into account,
   including the htype/chaddr; the host name option; the client-
   identifier option; the DHCP Relay Agent Information option [<a href="#ref-17" title='"DHCP Relay Agent Information Option"'>17</a>]; the
   vendor-class-identifier option; the vendor-specific information
   option; or the subnet selection option [<a href="#ref-15" title='"The IPv4 Subnet Selection Option for DHCP"'>15</a>].

   Conditional configuration of clients, described in [<a href="#ref-18" title="Indiana">18</a>], can be used
   to solve a number of problems, including assignment of options based
   on the client operating system; assignment of groups of clients to
   address ranges subsequently used to determine quality of service;
   allocation of special address ranges for remote hosts; assignment of
   static routes to clients [<a href="#ref-20" title='"The Classless Static Route Option for Dynamic Host Configuration Protocol (DHCP)"'>20</a>], etc.  As noted in the security
   considerations, these mechanisms, while useful, do not enhance
   security since they can be evaded by a remote host choosing its own
   IP address.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   This protocol is secured using IPsec, and as a result the DHCP
   packets flowing between the remote host and the security gateway are
   authenticated and integrity protected.

   However, since the security gateway acts as a DHCP Relay, no
   protection is afforded the DHCP packets in the portion of the path
   between the security gateway and the DHCP server, unless DHCP
   authentication is used.

   Note that authenticated DHCP cannot be used as an access control
   mechanism.  This is because a remote host can always set its own IP
   address and thus evade any  security measures based on DHCP
   authentication.




<span class="grey">Patel, et. al.              Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   As a result, the assigned address MUST NOT be depended upon for
   security.  Instead, the security gateway can use other techniques
   such as instantiating packet filters or quick mode selectors on a
   per-tunnel basis.

   As described in [<a href="#ref-17" title='"DHCP Relay Agent Information Option"'>17</a>], a number of issues arise when forwarding DHCP
   client requests from untrusted sources.  These include DHCP
   exhaustion attacks, and spoofing of the client identifier option or
   client MAC address.  These issues can be partially addressed through
   use of the DHCP Relay Information Option [<a href="#ref-17" title='"DHCP Relay Agent Information Option"'>17</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  IANA Considerations</span>

   This document requires that an htype value be allocated for use with
   IPsec tunnel mode, as described in <a href="#section-4.1">section 4.1</a>.  Note that DHCP
   relies on the arp-parameters registry for definition of both the hrd
   parameter in ARP and the htype parameter in BOOTP/DHCP.  As a result,
   an assignment in the arp-parameters registry is required, even though
   IPsec-DHCP will never use that parameter for ARP purposes, since
   conceptually BOOTP/DHCP and ARP share the arp-parameters registry.

   This document does not create any new number spaces for IANA
   administration.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Intellectual%20Property%20Statement"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Intellectual Property Statement</span>

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights.  Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in <a href="https://tools.ietf.org/html/bcp11">BCP-11</a>.  Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard.  Please address the information to the IETF Executive
   Director.






<span class="grey">Patel, et. al.              Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>  Normative References</span>

   [<a id="ref-1" name="ref-1">1</a>]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-2" name="ref-2">2</a>]  Atkinson, R. and S. Kent, "Security Architecture for the
        Internet Protocol", <a href="rfc2401.html">RFC 2401</a>, November 1998.

   [<a id="ref-3" name="ref-3">3</a>]  Droms, R., "Dynamic Host Configuration Protocol", <a href="rfc2131.html">RFC 2131</a>,
        March 1997.

   [<a id="ref-4" name="ref-4">4</a>]  Alexander, S. and R. Droms, "DHCP Options and BOOTP Vendor
        Extensions", <a href="rfc2132.html">RFC 2132</a>, March 1997.

   [<a id="ref-5" name="ref-5">5</a>]  Droms, R. and W. Arbaugh, "Authentication for DHCP Messages",
        <a href="rfc3118.html">RFC 3118</a>, June 2001.

   [<a id="ref-6" name="ref-6">6</a>]  Kent, S. and R. Atkinson, "IP Authentication Header", <a href="rfc2402.html">RFC 2402</a>,
        November 1998.

   [<a id="ref-7" name="ref-7">7</a>]  Kent, S. and R. Atkinson, "IP Encapsulating Security Payload
        (ESP)", <a href="rfc2406.html">RFC 2406</a>, November 1998.

   [<a id="ref-8" name="ref-8">8</a>]  Piper, D., "The Internet IP Security Domain of Interpretation of
        ISAKMP", <a href="rfc2407.html">RFC 2407</a>, November 1998.

   [<a id="ref-9" name="ref-9">9</a>]  Harkins, D. and D. Carrel, "The Internet Key Exchange (IKE)",
        <a href="rfc2409.html">RFC 2409</a>, November 1998.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>  Informative References</span>

   [<a id="ref-10" name="ref-10">10</a>] McGregor, G., "The PPP Internet Protocol Control Protocol
        (IPCP)", <a href="rfc1332.html">RFC 1332</a>, May 1992.

   [<a id="ref-11" name="ref-11">11</a>] Cobb, S., "PPP Internet Protocol Control Protocol Extensions for
        Name Server Addresses", <a href="rfc1877.html">RFC 1877</a>, December 1995.

   [<a id="ref-12" name="ref-12">12</a>] Droms, R., Kinnear, K., Stapp, M., Volz, B., Gonczi, S., Rabil,
        G., Dooley, M. and A. Kapur, "DHCP Failover Protocol", Work in
        Progress.

   [<a id="ref-13" name="ref-13">13</a>] Dukes, D. and R. Pereira, <a href="https://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22The+ISAKMP+Configuration+Method%22" style="text-decoration: none">"The ISAKMP Configuration Method"</a>,
        Work in Progress.

   [<a id="ref-14" name="ref-14">14</a>] T'Joens, Y., Hublet, C. and P. De Schrijver, "DHCP reconfigure
        extension", <a href="rfc3203.html">RFC 3203</a>, December 2001.



<span class="grey">Patel, et. al.              Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   [<a id="ref-15" name="ref-15">15</a>] Waters, G., "The IPv4 Subnet Selection Option for DHCP", <a href="rfc3011.html">RFC</a>
        <a href="rfc3011.html">3011</a>, November 2000.

   [<a id="ref-16" name="ref-16">16</a>] Stump, G., Droms, R., Gu, Y., Vyaghrapuri, R., Demirtjis, A.,
        Beser, B. and J. Privat, "The User Class Option for DHCP", <a href="rfc3004.html">RFC</a>
        <a href="rfc3004.html">3004</a>, November 2000.

   [<a id="ref-17" name="ref-17">17</a>] Patrick, M., "DHCP Relay Agent Information Option", <a href="rfc3046.html">RFC 3046</a>,
        January 2001.

   [<a id="ref-18" name="ref-18">18</a>] Droms, R., and Lemon, T., The DHCP Handbook, Macmillan,
        Indianapolis, Indiana, 1999.

   [<a id="ref-19" name="ref-19">19</a>] Volz, B., Gonczi, S., Lemon, T. and R. Stevens, "DHC Load
        Balancing Algorithm", <a href="rfc3074.html">RFC 3074</a>, February 2001.

   [<a id="ref-20" name="ref-20">20</a>] Lemon, T., Cheshire, S. and B. Volz, "The Classless Static Route
        Option for Dynamic Host Configuration Protocol (DHCP)", <a href="rfc3442.html">RFC</a>
        <a href="rfc3442.html">3442</a>, December 2002.

   [<a id="ref-21" name="ref-21">21</a>] Kelly, S. and S. Ramamoorthi, "Requirements for IPsec Remote
        Access Scenarios", <a href="rfc3457.html">RFC 3457</a>, January 2003.

   [<a id="ref-22" name="ref-22">22</a>] Rekhter, Y., Moskowitz, B., Karrenberg, D., G. de Groot, and E.
        Lear, "Address Allocation for Private Internets", <a href="https://tools.ietf.org/html/bcp5">BCP 5</a>, <a href="rfc1918.html">RFC</a>
        <a href="rfc1918.html">1918</a>, February 1996.

   [<a id="ref-23" name="ref-23">23</a>] Atkinson, R., "Key Exchange Delegation Record for the DNS", <a href="rfc2230.html">RFC</a>
        <a href="rfc2230.html">2230</a>, November 1997.

   [<a id="ref-24" name="ref-24">24</a>] Gulbrandsen, A., Vixie, P. and L. Esibov, "A DNS RR for
        specifying the location of services (DNS SRV)", <a href="rfc2782.html">RFC 2782</a>,
        February 2000.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Acknowledgments"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Acknowledgments</span>

   This document has been enriched by comments from John Richardson and
   Prakash Iyer of Intel, Gurdeep Pall and Peter Ford of Microsoft.













<span class="grey">Patel, et. al.              Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


Appendix - IKECFG evaluation

   Alternatives to DHCPv4, such as ISAKMP CFG, described in [<a href="#ref-13" title='"The ISAKMP Configuration Method"'>13</a>], do not
   meet the basic requirements described in [<a href="#ref-21" title='"Requirements for IPsec Remote Access Scenarios"'>21</a>], nor do they provide
   the additional capabilities of DHCPv4.

   Basic configuration
         While ISAKMP CFG can provide for IP address assignment as well
         as configuration of a few additional parameters such as the DNS
         server and WINS server addresses, the rich configuration
         facilities of DHCPv4 are not supported.  Past experience with
         similar configuration mechanisms within PPP IPCP [<a href="#ref-11" title='"PPP Internet Protocol Control Protocol Extensions for Name Server Addresses"'>11</a>] has
         taught us that it is not viable merely to support minimal
         configuration.  Eventually, either much of the functionality
         embodied in the DHCPv4 options [<a href="#ref-4" title='"DHCP Options and BOOTP Vendor Extensions"'>4</a>] is duplicated or support for
         DHCPINFORM [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] will be required.

   Address management integration
         Since IKECFG is not integrated with existing IP address
         management facilities, it is difficult to integrate it with
         policy management services that may be dependent on the user to
         IP address binding.

   Address pool management
         IKECFG does not provide a mechanism for the remote host to
         indicate a preference for a particular address pool.  This
         makes it difficult to support address pool management.

   Reconfiguration
         IKECFG does not support the concept of configuration leases or
         reconfiguration.

   Fail-over support
         Since IKECFG creates a separate pool of address state, it
         complicates the provisioning of network utility-class
         reliability, both in the IP address management system and in
         the security gateways themselves.

   Security and simplicity
         As past history with PPP IPCP demonstrates, once it is decided
         to provide non-integrated address management and configuration
         facilities within IKE, it will be difficult to limit the
         duplication of effort to address assignment.  Instead, it will
         be tempting to also duplicate the configuration, authentication
         and fail-over facilities of DHCPv4.  This duplication will
         greatly increase the scope of work, eventually compromising the
         security of IKE.




<span class="grey">Patel, et. al.              Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


   Authentication
         While IKECFG can support mutual authentication of the IPsec
         tunnel endpoints, it is difficult to integrate IKECFG with
         DHCPv4 authentication [<a href="#ref-5" title='"Authentication for DHCP Messages"'>5</a>].  This is because the security
         gateway will not typically have access to the client
         credentials necessary to issue an DHCPv4 authentication option
         on the client's behalf.

   As a result, security gateways implementing IKECFG typically request
   allocation of an IP address on their own behalf, and then assign this
   to the client via IKECFG.  Since IKECFG does not support the concept
   of an address lease, the security gateway will need to do the renewal
   itself.  This complicates the renewal process.

   Since <a href="rfc2131.html">RFC 2131</a> [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] assumes that a DHCPREQUEST will not contain a
   filled in giaddr field when generated during RENEWING state, the
   DHCPACK will be sent directly to the client, which will not be
   expecting it.  As a result, it is either necessary for the security
   gateway to add special code to avoid forwarding such packets, or to
   wait until REBINDING state.  Since [<a href="#ref-3" title='"Dynamic Host Configuration Protocol"'>3</a>] does not specify that the
   giaddr field cannot be filled in when in the REBINDING state, the
   security gateway may put its own address in the giaddr field when in
   REBINDING state, thereby ensuring that it can receive the renewal
   response without treating it as a special case.



























<span class="grey">Patel, et. al.              Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


Authors' Addresses

   Baiju V. Patel
   Intel Corp
   2511 NE 25th Ave
   Hillsboro, OR 97124

   Phone: +1 503 712 2303
   EMail: baiju.v.patel@intel.com


   Bernard Aboba
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA 98052

   Phone: +1 425 706 6605
   EMail: bernarda@microsoft.com


   Scott Kelly
   Airespace
   110 Nortech Pkwy
   San Jose CA 95134 USA

   Phone: +1 (408) 941-0500
   EMail: scott@hyperthought.com


   Vipul Gupta
   Sun Microsystems, Inc.
   MS UMTV29-235
   2600 Casey Avenue
   Mountain View, CA 94303

   Phone: +1 650 336 1681
   EMail: vipul.gupta@sun.com














<span class="grey">Patel, et. al.              Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3456.html">RFC 3456</a>          DHCPv4 Config. of IPsec Tunnel Mode       January 2003</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Patel, et. al.              Standards Track                    [Page 18]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3456 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:47 GMT --></html>