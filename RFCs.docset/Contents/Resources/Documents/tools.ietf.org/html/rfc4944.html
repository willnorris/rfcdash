<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc4944 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:43:12 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.119" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:4944" name="DC.Identifier"/>
<meta content="This document describes the frame format for transmission of IPv6
packets and the method of forming IPv6 link-local addresses and
statelessly autoconfigured addresses on IEEE 802.15.4 networks.
Additional specifications include a simple header compression scheme
using shared context and provisions for packet delivery in IEEE
802.15.4 meshes. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Kushalnagar, Nandakishore" name="DC.Creator"/>
<meta content="Montenegro, Gabriel" name="DC.Creator"/>
<meta content="Culler, David E." name="DC.Creator"/>
<meta content="Hui, Jonathan W." name="DC.Creator"/>
<meta content="September, 2007" name="DC.Date.Issued"/>
<meta content="Transmission of IPv6 Packets over IEEE 802.15.4 Networks" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 4944 - Transmission of IPv6 Packets over IEEE 802.15.4 Networks</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4944.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4944" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-6lowpan-format" title="draft-ietf-6lowpan-format">draft-ietf-6lowpa...</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4944" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4944" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=4944">Errata</a>]        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Updated by: <a href="rfc6282.html">6282</a>, <a href="rfc6775.html">6775</a>                                 PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                      G. Montenegro
Request for Comments: 4944                         Microsoft Corporation
Category: Standards Track                                 N. Kushalnagar
                                                              Intel Corp
                                                                  J. Hui
                                                               D. Culler
                                                          Arch Rock Corp
                                                          September 2007


        <span class="h1">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Abstract

   This document describes the frame format for transmission of IPv6
   packets and the method of forming IPv6 link-local addresses and
   statelessly autoconfigured addresses on IEEE 802.15.4 networks.
   Additional specifications include a simple header compression scheme
   using shared context and provisions for packet delivery in IEEE
   802.15.4 meshes.























<span class="grey">Montenegro, et al.          Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
     <a href="#section-1.1">1.1</a>.  Requirements Notation  . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
     <a href="#section-1.2">1.2</a>.  Terms Used . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  IEEE 802.15.4 Mode for IP  . . . . . . . . . . . . . . . . . .  <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Addressing Modes . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Maximum Transmission Unit  . . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
   <a href="#section-5">5</a>.  LoWPAN Adaptation Layer and Frame Format . . . . . . . . . . .  <a href="#page-6">6</a>
     <a href="#section-5.1">5.1</a>.  Dispatch Type and Header . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-5.2">5.2</a>.  Mesh Addressing Type and Header  . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-5.3">5.3</a>.  Fragmentation Type and Header  . . . . . . . . . . . . . . <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  Stateless Address Autoconfiguration  . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#section-7">7</a>.  IPv6 Link Local Address  . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
   <a href="#section-8">8</a>.  Unicast Address Mapping  . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
   <a href="#section-9">9</a>.  Multicast Address Mapping  . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-10">10</a>. Header Compression . . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-10.1">10.1</a>. Encoding of IPv6 Header Fields . . . . . . . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-10.2">10.2</a>. Encoding of UDP Header Fields  . . . . . . . . . . . . . . <a href="#page-19">19</a>
     <a href="#section-10.3">10.3</a>. Non-Compressed Fields  . . . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
       <a href="#section-10.3.1">10.3.1</a>.  Non-Compressed IPv6 Fields  . . . . . . . . . . . . . <a href="#page-21">21</a>
       10.3.2.  Non-Compressed and Partially Compressed UDP Fields  . 21
   <a href="#section-11">11</a>. Frame Delivery in a Link-Layer Mesh  . . . . . . . . . . . . . <a href="#page-21">21</a>
     <a href="#section-11.1">11.1</a>. LoWPAN Broadcast . . . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#section-12">12</a>. IANA Considerations  . . . . . . . . . . . . . . . . . . . . . <a href="#page-23">23</a>
   <a href="#section-13">13</a>. Security Considerations  . . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-14">14</a>. Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-15">15</a>. References . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
     <a href="#section-15.1">15.1</a>. Normative References . . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
     <a href="#section-15.2">15.2</a>. Informative References . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
   <a href="#appendix-A">Appendix A</a>.  Alternatives for Delivery of Frames in a Mesh . . . . <a href="#page-28">28</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The IEEE 802.15.4 standard [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>] targets low-power personal
   area networks.  This document defines the frame format for
   transmission of IPv6 [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>] packets as well as the formation of
   IPv6 link-local addresses and statelessly autoconfigured addresses on
   top of IEEE 802.15.4 networks.  Since IPv6 requires support of packet
   sizes much larger than the largest IEEE 802.15.4 frame size, an
   adaptation layer is defined.  This document also defines mechanisms
   for header compression required to make IPv6 practical on IEEE
   802.15.4 networks, and the provisions required for packet delivery in
   IEEE 802.15.4 meshes.  However, a full specification of mesh routing
   (the specific protocol used, the interactions with neighbor
   discovery, etc) is out of the scope of this document.





<span class="grey">Montenegro, et al.          Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Notation"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Notation</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terms%20Used"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terms Used</span>

   AES:  Advanced Encryption Scheme

   CSMA/CA:  Carrier Sense Multiple Access / Collision Avoidance

   FFD:  Full Function Device

   GTS:  Guaranteed Time Service

   MTU:  Maximum Transmission Unit

   MAC:  Media Access Control

   PAN:  Personal Area Network

   RFD:  Reduced Function Device

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20IEEE%20802.15.4%20Mode%20for%20IP"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  IEEE 802.15.4 Mode for IP</span>

   IEEE 802.15.4 defines four types of frames: beacon frames, MAC
   command frames, acknowledgement frames, and data frames.  IPv6
   packets MUST be carried on data frames.  Data frames may optionally
   request that they be acknowledged.  In keeping with [<a href="rfc3819.html" title='"Advice for Internet Subnetwork Designers"'>RFC3819</a>], it is
   recommended that IPv6 packets be carried in frames for which
   acknowledgements are requested so as to aid link-layer recovery.

   IEEE 802.15.4 networks can either be nonbeacon-enabled or beacon-
   enabled [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>].  The latter is an optional mode in which
   devices are synchronized by a so-called coordinator's beacons.  This
   allows the use of superframes within which a contention-free
   Guaranteed Time Service (GTS) is possible.  This document does not
   require that IEEE networks run in beacon-enabled mode.  In nonbeacon-
   enabled networks, data frames (including those carrying IPv6 packets)
   are sent via the contention-based channel access method of unslotted
   CSMA/CA.

   In nonbeacon-enabled networks, beacons are not used for
   synchronization.  However, they are still useful for link-layer
   device discovery to aid in association and disassociation events.
   This document recommends that beacons be configured so as to aid
   these functions.  A further recommendation is for these events to be



<span class="grey">Montenegro, et al.          Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   available at the IPv6 layer to aid in detecting network attachment, a
   problem being worked on at the IETF at the time of this writing.

   The specification allows for frames in which either the source or
   destination addresses (or both) are elided.  The mechanisms defined
   in this document require that both source and destination addresses
   be included in the IEEE 802.15.4 frame header.  The source or
   destination PAN ID fields may also be included.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Addressing%20Modes"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Addressing Modes</span>

   IEEE 802.15.4 defines several addressing modes: it allows the use of
   either IEEE 64-bit extended addresses or (after an association event)
   16-bit addresses unique within the PAN [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>].  This document
   supports both 64-bit extended addresses, and 16-bit short addresses.
   For use within 6LoWPANs, this document imposes additional constraints
   (beyond those imposed by IEEE 802.15.4) on the format of the 16-bit
   short addresses, as specified in <a href="#section-12">Section 12</a>.  Short addresses being
   transient in nature, a word of caution is in order: since they are
   doled out by the PAN coordinator function during an association
   event, their validity and uniqueness is limited by the lifetime of
   that association.  This can be cut short by the expiration of the
   association or simply by any mishap occurring to the PAN coordinator.
   Because of the scalability issues posed by such a centralized
   allocation and single point of failure at the PAN coordinator,
   deployers should carefully weigh the tradeoffs (and implement the
   necessary mechanisms) of growing such networks based on short
   addresses.  Of course, IEEE 64-bit extended addresses may not suffer
   from these drawbacks, but still share the remaining scalability
   issues concerning routing, discovery, configuration, etc.

   This document assumes that a PAN maps to a specific IPv6 link.  This
   complies with the recommendation that shared networks support link-
   layer subnet [<a href="rfc3819.html" title='"Advice for Internet Subnetwork Designers"'>RFC3819</a>] broadcast.  Strictly speaking, it is multicast
   not broadcast that exists in IPv6.  However, multicast is not
   supported natively in IEEE 802.15.4.  Hence, IPv6 level multicast
   packets MUST be carried as link-layer broadcast frames in IEEE
   802.15.4 networks.  This MUST be done such that the broadcast frames
   are only heeded by devices within the specific PAN of the link in
   question.  As per Section 7.5.6.2 in [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>], this is
   accomplished as follows:

   1.  A destination PAN identifier is included in the frame, and it
       MUST match the PAN ID of the link in question.

   2.  A short destination address is included in the frame, and it MUST
       match the broadcast address (0xffff).




<span class="grey">Montenegro, et al.          Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   Additionally, support for mapping of IPv6 multicast addresses per
   <a href="#section-9">Section 9</a> MUST only be used in a mesh configuration.  A full
   specification of such functionality is out of the scope of this
   document.

   As usual, hosts learn IPv6 prefixes via router advertisements as per
   [<a href="rfc4861.html" title='"Neighbor Discovery for IP version 6 (IPv6)"'>RFC4861</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Maximum%20Transmission%20Unit"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Maximum Transmission Unit</span>

   The MTU size for IPv6 packets over IEEE 802.15.4 is 1280 octets.
   However, a full IPv6 packet does not fit in an IEEE 802.15.4 frame.
   802.15.4 protocol data units have different sizes depending on how
   much overhead is present [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>].  Starting from a maximum
   physical layer packet size of 127 octets (aMaxPHYPacketSize) and a
   maximum frame overhead of 25 (aMaxFrameOverhead), the resultant
   maximum frame size at the media access control layer is 102 octets.
   Link-layer security imposes further overhead, which in the maximum
   case (21 octets of overhead in the AES-CCM-128 case, versus 9 and 13
   for AES-CCM-32 and AES-CCM-64, respectively) leaves only 81 octets
   available.  This is obviously far below the minimum IPv6 packet size
   of 1280 octets, and in keeping with <a href="#section-5">Section 5</a> of the IPv6
   specification [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>], a fragmention and reassembly adaptation
   layer must be provided at the layer below IP.  Such a layer is
   defined below in <a href="#section-5">Section 5</a>.

   Furthermore, since the IPv6 header is 40 octets long, this leaves
   only 41 octets for upper-layer protocols, like UDP.  The latter uses
   8 octets in the header which leaves only 33 octets for application
   data.  Additionally, as pointed out above, there is a need for a
   fragmentation and reassembly layer, which will use even more octets.

   The above considerations lead to the following two observations:

   1.  The adaptation layer must be provided to comply with the IPv6
       requirements of a minimum MTU.  However, it is expected that (a)
       most applications of IEEE 802.15.4 will not use such large
       packets, and (b) small application payloads in conjunction with
       the proper header compression will produce packets that fit
       within a single IEEE 802.15.4 frame.  The justification for this
       adaptation layer is not just for IPv6 compliance, as it is quite
       likely that the packet sizes produced by certain application
       exchanges (e.g., configuration or provisioning) may require a
       small number of fragments.

   2.  Even though the above space calculation shows the worst-case
       scenario, it does point out the fact that header compression is
       compelling to the point of almost being unavoidable.  Since we



<span class="grey">Montenegro, et al.          Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


       expect that most (if not all) applications of IP over IEEE
       802.15.4 will make use of header compression, it is defined below
       in <a href="#section-10">Section 10</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20LoWPAN%20Adaptation%20Layer%20and%20Frame%20Format"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  LoWPAN Adaptation Layer and Frame Format</span>

   The encapsulation formats defined in this section (subsequently
   referred to as the "LoWPAN encapsulation") are the payload in the
   IEEE 802.15.4 MAC protocol data unit (PDU).  The LoWPAN payload
   (e.g., an IPv6 packet) follows this encapsulation header.

   All LoWPAN encapsulated datagrams transported over IEEE 802.15.4 are
   prefixed by an encapsulation header stack.  Each header in the header
   stack contains a header type followed by zero or more header fields.
   Whereas in an IPv6 header the stack would contain, in the following
   order, addressing, hop-by-hop options, routing, fragmentation,
   destination options, and finally payload [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>]; in a LoWPAN
   header, the analogous header sequence is mesh (L2) addressing, hop-
   by-hop options (including L2 broadcast/multicast), fragmentation, and
   finally payload.  These examples show typical header stacks that may
   be used in a LoWPAN network.

   A LoWPAN encapsulated IPv6 datagram:

      +---------------+-------------+---------+
      | IPv6 Dispatch | IPv6 Header | Payload |
      +---------------+-------------+---------+

   A LoWPAN encapsulated LOWPAN_HC1 compressed IPv6 datagram:

      +--------------+------------+---------+
      | HC1 Dispatch | HC1 Header | Payload |
      +--------------+------------+---------+

   A LoWPAN encapsulated LOWPAN_HC1 compressed IPv6 datagram that
   requires mesh addressing:

      +-----------+-------------+--------------+------------+---------+
      | Mesh Type | Mesh Header | HC1 Dispatch | HC1 Header | Payload |
      +-----------+-------------+--------------+------------+---------+

   A LoWPAN encapsulated LOWPAN_HC1 compressed IPv6 datagram that
   requires fragmentation:

      +-----------+-------------+--------------+------------+---------+
      | Frag Type | Frag Header | HC1 Dispatch | HC1 Header | Payload |
      +-----------+-------------+--------------+------------+---------+




<span class="grey">Montenegro, et al.          Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   A LoWPAN encapsulated LOWPAN_HC1 compressed IPv6 datagram that
   requires both mesh addressing and fragmentation:

      +-------+-------+-------+-------+---------+---------+---------+
      | M Typ | M Hdr | F Typ | F Hdr | HC1 Dsp | HC1 Hdr | Payload |
      +-------+-------+-------+-------+---------+---------+---------+

   A LoWPAN encapsulated LOWPAN_HC1 compressed IPv6 datagram that
   requires both mesh addressing and a broadcast header to support mesh
   broadcast/multicast:

      +-------+-------+-------+-------+---------+---------+---------+
      | M Typ | M Hdr | B Dsp | B Hdr | HC1 Dsp | HC1 Hdr | Payload |
      +-------+-------+-------+-------+---------+---------+---------+

   When more than one LoWPAN header is used in the same packet, they
   MUST appear in the following order:

      Mesh Addressing Header

      Broadcast Header

      Fragmentation Header

   All protocol datagrams (e.g., IPv6, compressed IPv6 headers, etc.)
   SHALL be preceded by one of the valid LoWPAN encapsulation headers,
   examples of which are given above.  This permits uniform software
   treatment of datagrams without regard to the mode of their
   transmission.

   The definition of LoWPAN headers, other than mesh addressing and
   fragmentation, consists of the dispatch value, the definition of the
   header fields that follow, and their ordering constraints relative to
   all other headers.  Although the header stack structure provides a
   mechanism to address future demands on the LoWPAN adaptation layer,
   it is not intended to provided general purpose extensibility.  This
   format document specifies a small set of header types using the
   header stack for clarity, compactness, and orthogonality.













<span class="grey">Montenegro, et al.          Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Dispatch%20Type%20and%20Header"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Dispatch Type and Header</span>

   The dispatch type is defined by a zero bit as the first bit and a one
   bit as the second bit.  The dispatch type and header are shown here:

                        1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 1| Dispatch  |  type-specific header
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Dispatch               6-bit selector.  Identifies the type of header
                          immediately following the Dispatch Header.

   type-specific header   A header determined by the Dispatch Header.

                    Figure 1: Dispatch Type and Header

   The dispatch value may be treated as an unstructured namespace.  Only
   a few symbols are required to represent current LoWPAN functionality.
   Although some additional savings could be achieved by encoding
   additional functionality into the dispatch byte, these measures would
   tend to constrain the ability to address future alternatives.




























<span class="grey">Montenegro, et al.          Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


           Pattern    Header Type
         +------------+-----------------------------------------------+
         | 00  xxxxxx | NALP       - Not a LoWPAN frame               |
         | 01  000001 | IPv6       - Uncompressed IPv6 Addresses      |
         | 01  000010 | LOWPAN_HC1 - LOWPAN_HC1 compressed IPv6       |
         | 01  000011 | reserved   - Reserved for future use          |
         |   ...      | reserved   - Reserved for future use          |
         | 01  001111 | reserved   - Reserved for future use          |
         | 01  010000 | LOWPAN_BC0 - LOWPAN_BC0 broadcast             |
         | 01  010001 | reserved   - Reserved for future use          |
         |   ...      | reserved   - Reserved for future use          |
         | 01  111110 | reserved   - Reserved for future use          |
         | 01  111111 | ESC        - Additional Dispatch byte follows |
         | 10  xxxxxx | MESH       - Mesh Header                      |
         | 11  000xxx | FRAG1      - Fragmentation Header (first)     |
         | 11  001000 | reserved   - Reserved for future use          |
         |   ...      | reserved   - Reserved for future use          |
         | 11  011111 | reserved   - Reserved for future use          |
         | 11  100xxx | FRAGN      - Fragmentation Header (subsequent)|
         | 11  101000 | reserved   - Reserved for future use          |
         |   ...      | reserved   - Reserved for future use          |
         | 11  111111 | reserved   - Reserved for future use          |
         +------------+-----------------------------------------------+

                   Figure 2: Dispatch Value Bit Pattern

   NALP:  Specifies that the following bits are not a part of the LoWPAN
      encapsulation, and any LoWPAN node that encounters a dispatch
      value of 00xxxxxx shall discard the packet.  Other non-LoWPAN
      protocols that wish to coexist with LoWPAN nodes should include a
      byte matching this pattern immediately following the 802.15.4.
      header.

   IPv6:  Specifies that the following header is an uncompressed IPv6
      header [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>].

   LOWPAN_HC1:  Specifies that the following header is a LOWPAN_HC1
      compressed IPv6 header.  This header format is defined in
      Figure 9.

   LOWPAN_BC0:  Specifies that the following header is a LOWPAN_BC0
      header for mesh broadcast/multicast support and is described in
      <a href="#section-11.1">Section 11.1</a>.

   ESC:  Specifies that the following header is a single 8-bit field for
      the Dispatch value.  It allows support for Dispatch values larger
      than 127.




<span class="grey">Montenegro, et al.          Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Mesh%20Addressing%20Type%20and%20Header"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Mesh Addressing Type and Header</span>

   The mesh type is defined by a one bit and zero bit as the first two
   bits.  The mesh type and header are shown here:

                           1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1 0|V|F|HopsLft| originator address, final address
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 3: Mesh Addressing Type and Header

   Field definitions are as follows:

   V: This 1-bit field SHALL be zero if the Originator (or "Very first")
      Address is an IEEE extended 64-bit address (EUI-64), or 1 if it is
      a short 16-bit addresses.

   F: This 1-bit field SHALL be zero if the Final Destination Address is
      an IEEE extended 64-bit address (EUI-64), or 1 if it is a short
      16-bit addresses.

   Hops Left:  This 4-bit field SHALL be decremented by each forwarding
      node before sending this packet towards its next hop.  The packet
      is not forwarded any further if Hops Left is decremented to zero.
      The value 0xF is reserved and signifies an 8-bit Deep Hops Left
      field immediately following, and allows a source node to specify a
      hop limit greater than 14 hops.

   Originator Address:  This is the link-layer address of the
      Originator.

   Final Destination Address:  This is the link-layer address of the
      Final Destination.

   Note that the 'V' and 'F' bits allow for a mix of 16 and 64-bit
   addresses.  This is useful at least to allow for mesh layer
   "broadcast", as 802.15.4 broadcast addresses are defined as 16-bit
   short addresses.

   A further discussion of frame delivery within a mesh is in
   <a href="#section-11">Section 11</a>.








<span class="grey">Montenegro, et al.          Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Fragmentation%20Type%20and%20Header"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Fragmentation Type and Header</span>

   If an entire payload (e.g., IPv6) datagram fits within a single
   802.15.4 frame, it is unfragmented and the LoWPAN encapsulation
   should not contain a fragmentation header.  If the datagram does not
   fit within a single IEEE 802.15.4 frame, it SHALL be broken into link
   fragments.  As the fragment offset can only express multiples of
   eight bytes, all link fragments for a datagram except the last one
   MUST be multiples of eight bytes in length.  The first link fragment
   SHALL contain the first fragment header as defined below.

                           1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1 1 0 0 0|    datagram_size    |         datagram_tag          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 4: First Fragment

   The second and subsequent link fragments (up to and including the
   last) SHALL contain a fragmentation header that conforms to the
   format shown below.

                           1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1 1 1 0 0|    datagram_size    |         datagram_tag          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |datagram_offset|
      +-+-+-+-+-+-+-+-+

                      Figure 5: Subsequent Fragments

   datagram_size:  This 11-bit field encodes the size of the entire IP
      packet before link-layer fragmentation (but after IP layer
      fragmentation).  The value of datagram_size SHALL be the same for
      all link-layer fragments of an IP packet.  For IPv6, this SHALL be
      40 octets (the size of the uncompressed IPv6 header) more than the
      value of Payload Length in the IPv6 header [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>] of the
      packet.  Note that this packet may already be fragmented by hosts
      involved in the communication, i.e., this field needs to encode a
      maximum length of 1280 octets (the IEEE 802.15.4 link MTU, as
      defined in this document).

      NOTE: This field does not need to be in every packet, as one could
      send it with the first fragment and elide it subsequently.
      However, including it in every link fragment eases the task of
      reassembly in the event that a second (or subsequent) link



<span class="grey">Montenegro, et al.          Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


      fragment arrives before the first.  In this case, the guarantee of
      learning the datagram_size as soon as any of the fragments arrives
      tells the receiver how much buffer space to set aside as it waits
      for the rest of the fragments.  The format above trades off
      simplicity for efficiency.

   datagram_tag:  The value of datagram_tag (datagram tag) SHALL be the
      same for all link fragments of a payload (e.g., IPv6) datagram.
      The sender SHALL increment datagram_tag for successive, fragmented
      datagrams.  The incremented value of datagram_tag SHALL wrap from
      65535 back to zero.  This field is 16 bits long, and its initial
      value is not defined.

   datagram_offset:  This field is present only in the second and
      subsequent link fragments and SHALL specify the offset, in
      increments of 8 octets, of the fragment from the beginning of the
      payload datagram.  The first octet of the datagram (e.g., the
      start of the IPv6 header) has an offset of zero; the implicit
      value of datagram_offset in the first link fragment is zero.  This
      field is 8 bits long.

   The recipient of link fragments SHALL use (1) the sender's 802.15.4
   source address (or the Originator Address if a Mesh Addressing field
   is present), (2) the destination's 802.15.4 address (or the Final
   Destination address if a Mesh Addressing field is present), (3)
   datagram_size, and (4) datagram_tag to identify all the link
   fragments that belong to a given datagram.

   Upon receipt of a link fragment, the recipient starts constructing
   the original unfragmented packet whose size is datagram_size.  It
   uses the datagram_offset field to determine the location of the
   individual fragments within the original unfragmented packet.  For
   example, it may place the data payload (except the encapsulation
   header) within a payload datagram reassembly buffer at the location
   specified by datagram_offset.  The size of the reassembly buffer
   SHALL be determined from datagram_size.

   If a link fragment that overlaps another fragment is received, as
   identified above, and differs in either the size or datagram_offset
   of the overlapped fragment, the fragment(s) already accumulated in
   the reassembly buffer SHALL be discarded.  A fresh reassembly may be
   commenced with the most recently received link fragment.  Fragment
   overlap is determined by the combination of datagram_offset from the
   encapsulation header and "Frame Length" from the 802.15.4 Physical
   Layer Protocol Data Unit (PPDU) packet header.

   Upon detection of a IEEE 802.15.4 Disassociation event, fragment
   recipients MUST discard all link fragments of all partially



<span class="grey">Montenegro, et al.          Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   reassembled payload datagrams, and fragment senders MUST discard all
   not yet transmitted link fragments of all partially transmitted
   payload (e.g., IPv6) datagrams.  Similarly, when a node first
   receives a fragment with a given datagram_tag, it starts a reassembly
   timer.  When this time expires, if the entire packet has not been
   reassembled, the existing fragments MUST be discarded and the
   reassembly state MUST be flushed.  The reassembly timeout MUST be set
   to a maximum of 60 seconds (this is also the timeout in the IPv6
   reassembly procedure [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>]).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Stateless%20Address%20Autoconfiguration"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Stateless Address Autoconfiguration</span>

   This section defines how to obtain an IPv6 interface identifier.

   The Interface Identifier [<a href="rfc4291.html" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>] for an IEEE 802.15.4 interface may
   be based on the EUI-64 identifier [<a href="#ref-EUI64" title='"GUIDELINES FOR 64-BIT GLOBAL IDENTIFIER (EUI-64) REGISTRATION AUTHORITY"'>EUI64</a>] assigned to the IEEE
   802.15.4 device.  In this case, the Interface Identifier is formed
   from the EUI-64 according to the "IPv6 over Ethernet" specification
   [<a href="rfc2464.html" title='"Transmission of IPv6 Packets over Ethernet Networks"'>RFC2464</a>].

   All 802.15.4 devices have an IEEE EUI-64 address, but 16-bit short
   addresses (<a href="#section-3">Section 3</a> and <a href="#section-12">Section 12</a>) are also possible.  In these
   cases, a "pseudo 48-bit address" is formed as follows.  First, the
   left-most 32 bits are formed by concatenating 16 zero bits to the 16-
   bit PAN ID (alternatively, if no PAN ID is known, 16 zero bits may be
   used).  This produces a 32-bit field as follows:

      16_bit_PAN:16_zero_bits

   Then, these 32 bits are concatenated with the 16-bit short address.
   This produces a 48-bit address as follows:

      32_bits_as_specified_previously:16_bit_short_address

   The interface identifier is formed from this 48-bit address as per
   the "IPv6 over Ethernet" specification [<a href="rfc2464.html" title='"Transmission of IPv6 Packets over Ethernet Networks"'>RFC2464</a>].  However, in the
   resultant interface identifier, the "Universal/Local" (U/L) bit SHALL
   be set to zero in keeping with the fact that this is not a globally
   unique value.  For either address format, all zero addresses MUST NOT
   be used.

   A different MAC address set manually or by software MAY be used to
   derive the Interface Identifier.  If such a MAC address is used, its
   global uniqueness property should be reflected in the value of the
   U/L bit.

   An IPv6 address prefix used for stateless autoconfiguration [<a href="rfc4862.html" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>]
   of an IEEE 802.15.4 interface MUST have a length of 64 bits.



<span class="grey">Montenegro, et al.          Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IPv6%20Link%20Local%20Address"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IPv6 Link Local Address</span>

   The IPv6 link-local address [<a href="rfc4291.html" title='"IP Version 6 Addressing Architecture"'>RFC4291</a>] for an IEEE 802.15.4 interface
   is formed by appending the Interface Identifier, as defined above, to
   the prefix FE80::/64.

          10 bits            54 bits                  64 bits
       +----------+-----------------------+----------------------------+
       |1111111010|         (zeros)       |    Interface Identifier    |
       +----------+-----------------------+----------------------------+

                                 Figure 6

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Unicast%20Address%20Mapping"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Unicast Address Mapping</span>

   The address resolution procedure for mapping IPv6 non-multicast
   addresses into IEEE 802.15.4 link-layer addresses follows the general
   description in <a href="rfc4861.html#section-7.2">SectionÂ 7.2 of [RFC4861]</a>, unless otherwise specified.

   The Source/Target Link-layer Address option has the following forms
   when the link layer is IEEE 802.15.4 and the addresses are EUI-64 or
   16-bit short addresses, respectively.





























<span class="grey">Montenegro, et al.          Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


                       0                   1
                       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |     Type      |    Length=2   |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |                               |
                      +-        IEEE 802.15.4        -+
                      |          EUI-64               |
                      +-                             -+
                      |                               |
                      +-         Address             -+
                      |                               |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |                               |
                      +-         Padding             -+
                      |                               |
                      +-        (all zeros)          -+
                      |                               |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                       0                   1
                       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |     Type      |    Length=1   |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |     16-bit short Address      |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |                               |
                      +-         Padding             -+
                      |         (all zeros)           |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 7

   Option fields:

   Type:

      1: for Source Link-layer address.

      2: for Target Link-layer address.

   Length:  This is the length of this option (including the type and
      length fields) in units of 8 octets.  The value of this field is 2
      if using EUI-64 addresses, or 1 if using 16-bit short addresses.

   IEEE 802.15.4 Address:  The 64-bit IEEE 802.15.4 address, or the 16-
      bit short address (as per the format in <a href="#section-9">Section 9</a>), in canonical



<span class="grey">Montenegro, et al.          Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


      bit order.  This is the address the interface currently responds
      to.  This address may be different from the built-in address used
      to derive the Interface Identifier, because of privacy or security
      (e.g., of neighbor discovery) considerations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Multicast%20Address%20Mapping"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Multicast Address Mapping</span>

   The functionality in this section MUST only be used in a mesh-enabled
   LoWPAN.  An IPv6 packet with a multicast destination address (DST),
   consisting of the sixteen octets DST[1] through DST[16], is
   transmitted to the following 802.15.4 16-bit multicast address:

                       0                   1
                       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |1 0 0|DST[15]* |   DST[16]     |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 8

   Here, DST[15]* refers to the last 5 bits in octet DST[15], that is,
   bits 3-7 within DST[15].  The initial 3-bit pattern of "100" follows
   the 16-bit address format for multicast addresses (<a href="#section-12">Section 12</a>).

   This allows for multicast support within 6LoWPAN networks, but the
   full specification of such support is out of the scope of this
   document.  Example mechanisms are: flooding, controlled flooding,
   unicasting to the PAN coordinator, etc.  It is expected that this
   would be specified by the different mesh routing mechanisms.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Header%20Compression"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Header Compression</span>

   There is much published and in-progress standardization work on
   header compression.  Nevertheless, header compression for IPv6 over
   IEEE 802.15.4 has differing constraints summarized as follows:

      Existing work assumes that there are many flows between any two
      devices.  Here, we assume a very simple and low-context flavor of
      header compression.  Whereas this works independently of flows
      (potentially several), it does not use any context specific to any
      flow.  Thus, it cannot achieve as much compression as schemes that
      build a separate context for each flow to be compressed.

      Given the very limited packet sizes, it is highly desirable to
      integrate layer 2 with layer 3 compression, something
      traditionally not done (although now changing due to the ROHC
      (RObust Header Compression) working group).




<span class="grey">Montenegro, et al.          Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


      It is expected that IEEE 802.15.4 devices will be deployed in
      multi-hop networks.  However, header compression in a mesh departs
      from the usual point-to-point link scenario in which the
      compressor and decompressor are in direct and exclusive
      communication with each other.  In an IEEE 802.15.4 network, it is
      highly desirable for a device to be able to send header compressed
      packets via any of its neighbors, with as little preliminary
      context-building as possible.

   Any new packet formats required by header compression reuse the basic
   packet formats defined in <a href="#section-5">Section 5</a> by using different dispatch
   values.

   Header compression may result in alignment not falling on an octet
   boundary.  Since hardware typically cannot transmit data in units
   less than an octet, padding must be used.  Padding is done as
   follows: First, the entire series of contiguous compressed headers is
   laid out (this document only defines IPv6 and UDP header compression
   schemes, but others may be defined elsewhere).  Then, zero bits
   SHOULD be added as appropriate to align to an octet boundary.  This
   counteracts any potential misalignment caused by header compression,
   so subsequent fields (e.g., non-compressed headers or data payloads)
   start on an octet boundary and follow as usual.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Encoding%20of%20IPv6%20Header%20Fields"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Encoding of IPv6 Header Fields</span>

   By virtue of having joined the same 6LoWPAN network, devices share
   some state.  This makes it possible to compress headers without
   explicitly building any compression context state.  Therefore,
   6LoWPAN header compression does not keep any flow state; instead, it
   relies on information pertaining to the entire link.  The following
   IPv6 header values are expected to be common on 6LoWPAN networks, so
   the HC1 header has been constructed to efficiently compress them from
   the onset: Version is IPv6; both IPv6 source and destination
   addresses are link local; the IPv6 interface identifiers (bottom 64
   bits) for the source or destination addresses can be inferred from
   the layer two source and destination addresses (of course, this is
   only possible for interface identifiers derived from an underlying
   802.15.4 MAC address); the packet length can be inferred either from
   layer two ("Frame Length" in the IEEE 802.15.4 PPDU) or from the
   "datagram_size" field in the fragment header (if present); both the
   Traffic Class and the Flow Label are zero; and the Next Header is
   UDP, ICMP or TCP.  The only field in the IPv6 header that always
   needs to be carried in full is the Hop Limit (8 bits).  Depending on
   how closely the packet matches this common case, different fields may
   not be compressible thus needing to be carried "in-line" as well
   (<a href="#section-10.3.1">Section 10.3.1</a>).  This common IPv6 header (as mentioned above) can
   be compressed to 2 octets (1 octet for the HC1 encoding and 1 octet



<span class="grey">Montenegro, et al.          Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   for the Hop Limit), instead of 40 octets.  Such a packet is
   compressible via the LOWPAN_HC1 format by using a Dispatch value of
   LOWPAN_HC1 followed by a LOWPAN_HC1 header "HC1 encoding" field (8
   bits) to encode the different combinations as shown below.  This
   header may be preceded by a fragmentation header, which may be
   preceded by a mesh header.

                           1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | HC1 encoding  |     Non-Compressed fields follow...
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

         Figure 9: LOWPAN_HC1 (common compressed header encoding)

   As can be seen below (bit 7), an HC2 encoding may follow an HC1
   octet.  In this case, the non-compressed fields follow the HC2
   encoding field (<a href="#section-10.3">Section 10.3</a>).

   The address fields encoded by "HC1 encoding" are interpreted as
   follows:

      PI:  Prefix carried in-line (<a href="#section-10.3.1">Section 10.3.1</a>).

      PC:  Prefix compressed (link-local prefix assumed).

      II:  Interface identifier carried in-line (<a href="#section-10.3.1">Section 10.3.1</a>).

      IC:  Interface identifier elided (derivable from the corresponding
         link-layer address).  If applied to the interface identifier of
         either the source or destination address when routing in a mesh
         (<a href="#section-11">Section 11</a>), the corresponding link-layer address is that
         found in the "Mesh Addressing" field (<a href="#section-5.2">Section 5.2</a>).

   The "HC1 encoding" is shown below (starting with bit 0 and ending at
   bit 7):

      IPv6 source address (bits 0 and 1):

         00:  PI, II

         01:  PI, IC

         10:  PC, II

         11:  PC, IC





<span class="grey">Montenegro, et al.          Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


      IPv6 destination address (bits 2 and 3):

         00:  PI, II

         01:  PI, IC

         10:  PC, II

         11:  PC, IC

      Traffic Class and Flow Label (bit 4):

         0: not compressed; full 8 bits for Traffic Class and 20 bits
            for Flow Label are sent

         1: Traffic Class and Flow Label are zero

      Next Header (bits 5 and 6):

         00:  not compressed; full 8 bits are sent

         01:  UDP

         10:  ICMP

         11:  TCP

      HC2 encoding(bit 7):

         0: No more header compression bits

         1: HC1 encoding immediately followed by more header compression
            bits per HC2 encoding format.  Bits 5 and 6 determine which
            of the possible HC2 encodings apply (e.g., UDP, ICMP, or TCP
            encodings).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Encoding%20of%20UDP%20Header%20Fields"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Encoding of UDP Header Fields</span>

   Bits 5 and 6 of the LOWPAN_HC1 allows compressing the Next Header
   field in the IPv6 header (for UDP, TCP, and ICMP).  Further
   compression of each of these protocol headers is also possible.  This
   section explains how the UDP header itself may be compressed.  The
   HC2 encoding in this section is the HC_UDP encoding, and it only
   applies if bits 5 and 6 in HC1 indicate that the protocol that
   follows the IPv6 header is UDP.  The HC_UDP encoding (Figure 10)
   allows compressing the following fields in the UDP header: source
   port, destination port, and length.  The UDP header's checksum field
   is not compressed and is therefore carried in full.  The scheme



<span class="grey">Montenegro, et al.          Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   defined below allows compressing the UDP header to 4 octets instead
   of the original 8 octets.

   The only UDP header field whose value may be deduced from information
   available elsewhere is the Length.  The other fields must be carried
   in-line either in full or in a partially compressed manner
   (<a href="#section-10.3.2">Section 10.3.2</a>).

                           1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |HC_UDP encoding|     Fields carried in-line follow...
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

         Figure 10: HC_UDP (UDP common compressed header encoding)

   The "HC_UDP encoding" for UDP is shown below (starting with bit 0 and
   ending at bit 7):

      UDP source port (bit 0):

         0: Not compressed, carried "in-line" (<a href="#section-10.3.2">Section 10.3.2</a>)

         1: Compressed to 4 bits.  The actual 16-bit source port is
            obtained by calculating: P + short_port value.  The value of
            P is the number 61616 (0xF0B0).  The short_port is expressed
            as a 4-bit value which is carried "in-line" (<a href="#section-10.3.2">Section 10.3.2</a>)

      UDP destination port (bit 1):

         0: Not compressed, carried "in-line" (<a href="#section-10.3.2">Section 10.3.2</a>)

         1: Compressed to 4 bits.  The actual 16-bit destination port is
            obtained by calculating: P + short_port value.  The value of
            P is the number 61616 (0xF0B0).  The short_port is expressed
            as a 4-bit value which is carried "in-line" (<a href="#section-10.3.2">Section 10.3.2</a>)

      Length (bit 2):

         0: not compressed, carried "in-line" (<a href="#section-10.3.2">Section 10.3.2</a>)

         1: compressed, length computed from IPv6 header length
            information.  The value of the UDP length field is equal to
            the Payload Length from the IPv6 header, minus the length of
            any extension headers present between the IPv6 header and
            the UDP header.

      Reserved (bit 3 through 7)



<span class="grey">Montenegro, et al.          Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.3.%20%20Non-Compressed%20Fields"></a><a class="selflink" href="#section-10.3" name="section-10.3">10.3</a>.  Non-Compressed Fields</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.1.%20%20Non-Compressed%20IPv6%20Fields"></a><a class="selflink" href="#section-10.3.1" name="section-10.3.1">10.3.1</a>.  Non-Compressed IPv6 Fields</span>

   This scheme allows the IPv6 header to be compressed to different
   degrees.  Hence, instead of the entire (standard) IPv6 header, only
   non-compressed fields need to be sent.  The subsequent header (as
   specified by the Next Header field in the original IPv6 header)
   immediately follows the IPv6 non-compressed fields.

   Uncompressed IPv6 addressing is described by a dispatch type
   containing an IPv6 dispatch value followed by the uncompressed IPv6
   header.  This dispatch type may be preceded by additional LoWPAN
   headers.

   The non-compressed IPv6 field that MUST be always present is the Hop
   Limit (8 bits).  This field MUST always follow the encoding fields
   (e.g., "HC1 encoding" as shown in Figure 9), perhaps including other
   future encoding fields).  Other non-compressed fields MUST follow the
   Hop Limit as implied by the "HC1 encoding" in the exact same order as
   shown above (<a href="#section-10.1">Section 10.1</a>): source address prefix (64 bits) and/or
   interface identifier (64 bits), destination address prefix (64 bits)
   and/or interface identifier (64 bits), Traffic Class (8 bits), Flow
   Label (20 bits) and Next Header (8 bits).  The actual next header
   (e.g., UDP, TCP, ICMP, etc) follows the non-compressed fields.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.2.%20%20Non-Compressed%20and%20Partially%20Compressed%20UDP%20Fields"></a><a class="selflink" href="#section-10.3.2" name="section-10.3.2">10.3.2</a>.  Non-Compressed and Partially Compressed UDP Fields</span>

   This scheme allows the UDP header to be compressed to different
   degrees.  Hence, instead of the entire (standard) UDP header, only
   non-compressed or partially compressed fields need to be sent.

   The non-compressed or partially compressed fields in the UDP header
   MUST always follow the IPv6 header and any of its associated in-line
   fields.  Any UDP header in-line fields present MUST appear in the
   same order as the corresponding fields appear in a normal UDP header
   [<a href="https://tools.ietf.org/html/rfc0768" title='"User Datagram Protocol"'>RFC0768</a>], e.g., source port, destination port, length, and checksum.
   If either the source or destination ports are in "short_port"
   notation (as indicated in the compressed UDP header), then instead of
   taking 16 bits, the inline port numbers take 4 bits.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Frame%20Delivery%20in%20a%20Link-Layer%20Mesh"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Frame Delivery in a Link-Layer Mesh</span>

   Even though 802.15.4 networks are expected to commonly use mesh
   routing, the IEEE 802.15.4-2003 specification [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>] does not
   define such capability.  In such cases, Full Function Devices (FFDs)
   run an ad hoc or mesh routing protocol to populate their routing
   tables (outside the scope of this document).  In such mesh scenarios,



<span class="grey">Montenegro, et al.          Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   two devices do not require direct reachability in order to
   communicate.  Of these devices, the sender is known as the
   "Originator", and the receiver is known as the "Final Destination".
   An originator device may use other intermediate devices as forwarders
   towards the final destination.  In order to achieve such frame
   delivery using unicast, it is necessary to include the link-layer
   addresses of the originator and final destinations, in addition to
   the hop-by-hop source and destination.

   This section defines how to effect delivery of layer 2 frames in a
   mesh, given a target "Final Destination" link-layer address.

   Mesh delivery is enabled by including a Mesh Addressing header prior
   to any other headers of the LoWPAN encapsulation (<a href="#section-5">Section 5</a>), an
   unfragmented and fragmented header; a full-blown IPv6 header; or a
   compressed IPv6 header as per <a href="#section-10">Section 10</a> or any others defined
   elsewhere.

   If a node wishes to use a default mesh forwarder to deliver a packet
   (i.e., because it does not have direct reachability to the
   destination), it MUST include a Mesh Addressing header with the
   originator's link-layer address set to its own, and the final
   destination's link-layer address set to the packet's ultimate
   destination.  It sets the source address in the 802.15.4 header to
   its own link-layer address, and puts the forwarder's link-layer
   address in the 802.15.4 header's destination address field.  Finally,
   it transmits the packet.

   Similarly, if a node receives a frame with a Mesh Addressing header,
   it must look at the Mesh Addressing header's "Final Destination"
   field to determine the real destination.  If the node is itself the
   final destination, it consumes the packet as per normal delivery.  If
   it is not the final destination, the device then reduces the "Hops
   Left" field, and if the result is zero, discards the packet.
   Otherwise, the node consults its link-layer routing table, determines
   what the next hop towards the final destination should be, and puts
   that address in the destination address field of the 802.15.4 header.
   Finally, the node changes the source address in the 802.15.4 header
   to its own link-layer address and transmits the packet.

   Whereas a node must participate in a mesh routing protocol to be a
   forwarder, no such requirement exists for simply using mesh
   forwarding.  Only "Full Function Devices" (FFDs) are expected to
   participate as routers in a mesh.  "Reduced Function Devices" (RFDs)
   limit themselves to discovering FFDs and using them for all their
   forwarding, in a manner similar to how IP hosts typically use default
   routers to forward all their off-link traffic.  For an RFD using mesh
   delivery, the "forwarder" is always the appropriate FFD.



<span class="grey">Montenegro, et al.          Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20LoWPAN%20Broadcast"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  LoWPAN Broadcast</span>

   Additional mesh routing functionality is encoded using a routing
   header immediately following the Mesh header.  In particular, a
   broadcast header consists of a LOWPAN_BC0 dispatch followed by a
   sequence number field.  The sequence number is used to detect
   duplicate packets (and hopefully suppress them).

                           1
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |0|1|LOWPAN_BC0 |Sequence Number|
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                        Figure 11: Broadcast Header

   Field definitions are as follows:

   Sequence Number:  This 8-bit field SHALL be incremented by the
      originator whenever it sends a new mesh broadcast or multicast
      packet.  Full specification of how to handle this field is out of
      the scope of this document.

   Further implications of such mesh-layer broadcast, e.g., whether it
   maps to a controlled flooding mechanism or its role in, say, topology
   discovery, is out of the scope of this document.

   Additional mesh routing capabilities, such as specifying the mesh
   routing protocol, source routing, and so on may be expressed by
   defining additional routing headers that precede the fragmentation or
   addressing header in the header stack.  The full specification of
   such mesh routing capabilities are out of the scope of this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  IANA Considerations</span>

   This document creates two new IANA registries, as discussed below.
   Future assignments in these registries are to be coordinated via IANA
   under the policy of "Specification Required" [<a href="rfc2434.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC2434</a>].  It is
   expected that this policy will allow for other (non-IETF)
   organizations to more easily obtain assignments.

   This document creates a new IANA registry for the Dispatch type field
   shown in the header definitions in <a href="#section-5">Section 5</a>.  This document defines
   the values IPv6, LOWPAN_HC1 header compression, BC0 broadcast and two
   escape patterns (NALP to indicate not a LOWPAN frame and ESC to allow
   additional dispatch bytes).  This document defines this field to be 8
   bits long.  The values 00xxxxxx being reserved and not used, allows
   for a total of 192 different values, which should be more than



<span class="grey">Montenegro, et al.          Standards Track                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   enough.  If header compression formats in addition to HC1 are defined
   or if additional TCP, ICMP HC2 formats are defined, it is expected
   that these will use reserved dispatch values following LOWPAN_HC1.
   If additional mesh delivery formats are defined these will use
   reserved values following LOWPAN_BC0.

   This document creates a new IANA registry for the 16-bit short
   address fields as used in 6LoWPAN packets.

                       0                   1
                       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                      |     16-bit short Address      |
                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                                 Figure 12

   This registry MUST include the addresses 0xffff (16-bit broadcast
   address accepted by all devices currently listening to the channel)
   and 0xfffe as defined in [<a href="#ref-ieee802.15.4" title='"IEEE Std. 802.15.4-2003"'>ieee802.15.4</a>].  Additionally, within
   6LoWPAN networks, 16-bit short addresses MUST follow this format
   (referring to bit fields in the order from 0 to 7), where "x" is a
   place holder for an unspecified bit value:

   Range 1, 0xxxxxxxxxxxxxxx:  The first bit (bit 0) SHALL be zero if
      the 16-bit address is a unicast address.  This leaves 15 bits for
      the actual address.

   Range 2, 100xxxxxxxxxxxxx:  Bits 0, 1, and 2 SHALL follow this
      pattern if the 16-bit address is a multicast address (see
      <a href="#section-9">Section 9</a>).  This leaves 13 bits for the actual multicast address.

   Range 3, 101xxxxxxxxxxxxx:  This pattern for bits 0, 1, and 2 is
      reserved.  Any future assignment shall follow the policy mentioned
      above.

   Range 4, 110xxxxxxxxxxxxx:  This pattern for bits 0, 1, and 2 is
      reserved.  Any future assignment shall follow the policy mentioned
      above.

   Range 5, 111xxxxxxxxxxxxx:  This pattern for bits 0, 1, and 2 is
      reserved.  Any future assignment shall follow the policy mentioned
      above.








<span class="grey">Montenegro, et al.          Standards Track                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Security%20Considerations"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Security Considerations</span>

   The method of derivation of Interface Identifiers from EUI-64 MAC
   addresses is intended to preserve global uniqueness when possible.
   However, there is no protection from duplication through accident or
   forgery.

   Neighbor Discovery in IEEE 802.15.4 links may be susceptible to
   threats as detailed in [<a href="rfc3756.html" title='"IPv6 Neighbor Discovery (ND) Trust Models and Threats"'>RFC3756</a>].  Mesh routing is expected to be
   common in IEEE 802.15.4 networks.  This implies additional threats
   due to ad hoc routing as per [<a href="#ref-KW03" title='"Secure Routing in Sensor Networks: Attacks and Countermeasures"'>KW03</a>].  IEEE 802.15.4 provides some
   capability for link-layer security.  Users are urged to make use of
   such provisions if at all possible and practical.  Doing so will
   alleviate the threats stated above.

   A sizeable portion of IEEE 802.15.4 devices is expected to always
   communicate within their PAN (i.e., within their link, in IPv6
   terms).  In response to cost and power consumption considerations,
   and in keeping with the IEEE 802.15.4 model of "Reduced Function
   Devices" (RFDs), these devices will typically implement the minimum
   set of features necessary.  Accordingly, security for such devices
   may rely quite strongly on the mechanisms defined at the link layer
   by IEEE 802.15.4.  The latter, however, only defines the Advanced
   Encryption Standard (AES) modes for authentication or encryption of
   IEEE 802.15.4 frames, and does not, in particular, specify key
   management (presumably group oriented).  Other issues to address in
   real deployments relate to secure configuration and management.
   Whereas such a complete picture is out of the scope of this document,
   it is imperative that IEEE 802.15.4 networks be deployed with such
   considerations in mind.  Of course, it is also expected that some
   IEEE 802.15.4 devices (the so-called "Full Function Devices", or
   "FFDs") will implement coordination or integration functions.  These
   may communicate regularly with off-link IPv6 peers (in addition to
   the more common on-link exchanges).  Such IPv6 devices are expected
   to secure their end-to-end communications with the usual mechanisms
   (e.g., IPsec, TLS, etc).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Acknowledgements"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Acknowledgements</span>

   Thanks to the authors of <a href="rfc2464.html">RFC 2464</a> and <a href="rfc2734.html">RFC 2734</a>, as parts of this
   document are patterned after theirs.  Thanks to Geoff Mulligan for
   useful discussions which helped shape this document.  Erik Nordmark's
   suggestions were instrumental for the header compression section.
   Also thanks to Shoichi Sakane, Samita Chakrabarti, Vipul Gupta,
   Carsten Bormann, Ki-Hyung Kim, Mario Mao, Phil Levis, Magnus
   Westerlund, and Jari Arkko.





<span class="grey">Montenegro, et al.          Standards Track                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20References"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.1.%20%20Normative%20References"></a><a class="selflink" href="#section-15.1" name="section-15.1">15.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]       Bradner, S., "Key words for use in RFCs to Indicate
                   Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2434" name="ref-RFC2434">RFC2434</a>]       Narten, T. and H. Alvestrand, "Guidelines for Writing
                   an IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>,
                   <a href="rfc2434.html">RFC 2434</a>, October 1998.

   [<a id="ref-RFC2460" name="ref-RFC2460">RFC2460</a>]       Deering, S. and R. Hinden, "Internet Protocol,
                   Version 6 (IPv6) Specification", <a href="rfc2460.html">RFC 2460</a>,
                   December 1998.

   [<a id="ref-RFC2464" name="ref-RFC2464">RFC2464</a>]       Crawford, M., "Transmission of IPv6 Packets over
                   Ethernet Networks", <a href="rfc2464.html">RFC 2464</a>, December 1998.

   [<a id="ref-RFC4291" name="ref-RFC4291">RFC4291</a>]       Hinden, R. and S. Deering, "IP Version 6 Addressing
                   Architecture", <a href="rfc4291.html">RFC 4291</a>, February 2006.

   [<a id="ref-RFC4861" name="ref-RFC4861">RFC4861</a>]       Narten, T., Nordmark, E., Simpson, W., and H.
                   Soliman, "Neighbor Discovery for IP version 6
                   (IPv6)", <a href="rfc4861.html">RFC 4861</a>, September 2007.

   [<a id="ref-RFC4862" name="ref-RFC4862">RFC4862</a>]       Thomson, S., Narten, T., and T. Jinmei, "IPv6
                   Stateless Address Autoconfiguration", <a href="rfc4862.html">RFC 4862</a>,
                   September 2007.

   [<a id="ref-ieee802.15.4" name="ref-ieee802.15.4">ieee802.15.4</a>]  IEEE Computer Society, "IEEE Std. 802.15.4-2003",
                   October 2003.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/15.2.%20%20Informative%20References"></a><a class="selflink" href="#section-15.2" name="section-15.2">15.2</a>.  Informative References</span>

   [<a id="ref-EUI64" name="ref-EUI64">EUI64</a>]         "GUIDELINES FOR 64-BIT GLOBAL IDENTIFIER (EUI-64)
                   REGISTRATION AUTHORITY", IEEE <a href="http://standards.ieee.org/regauth/oui/tutorials/EUI64.html">http://</a>
                   <a href="http://standards.ieee.org/regauth/oui/tutorials/EUI64.html">standards.ieee.org/regauth/oui/tutorials/EUI64.html</a>.

   [<a id="ref-KW03" name="ref-KW03">KW03</a>]          Karlof, Chris and Wagner, David, "Secure Routing in
                   Sensor Networks: Attacks and Countermeasures",
                   Elsevier's AdHoc Networks Journal, Special Issue on
                   Sensor Network Applications and Protocols vol 1,
                   issues 2-3, September 2003.

   [<a id="ref-RFC0768" name="ref-RFC0768">RFC0768</a>]       Postel, J., "User Datagram Protocol", STD 6, <a href="rfc768.html">RFC 768</a>,
                   August 1980.





<span class="grey">Montenegro, et al.          Standards Track                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   [<a id="ref-RFC3756" name="ref-RFC3756">RFC3756</a>]       Nikander, P., Kempf, J., and E. Nordmark, "IPv6
                   Neighbor Discovery (ND) Trust Models and Threats",
                   <a href="rfc3756.html">RFC 3756</a>, May 2004.

   [<a id="ref-RFC3819" name="ref-RFC3819">RFC3819</a>]       Karn, P., Bormann, C., Fairhurst, G., Grossman, D.,
                   Ludwig, R., Mahdavi, J., Montenegro, G., Touch, J.,
                   and L. Wood, "Advice for Internet Subnetwork
                   Designers", <a href="https://tools.ietf.org/html/bcp89">BCP 89</a>, <a href="rfc3819.html">RFC 3819</a>, July 2004.











































<span class="grey">Montenegro, et al.          Standards Track                    [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Alternatives%20for%20Delivery%20of%20Frames%20in%20a%20Mesh"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Alternatives for Delivery of Frames in a Mesh</span>

   Before settling on the mechanism finally adopted for delivery in a
   mesh (<a href="#section-11">Section 11</a>), several alternatives were considered.  In addition
   to the hop-by-hop source and destination link-layer addresses,
   delivering a packet in a LoWPAN mesh requires the end-to-end
   originator and destination addresses.  These could be expressed
   either as layer 2 or as layer 3 (i.e., IP ) addresses.  In the latter
   case, there would be no need to provide any additional header support
   in this document (i.e., within the LoWPAN header itself).  The link-
   layer destination address would point to the next hop destination
   address while the IP header destination address would point to the
   final destination (IP) address (possibly multiple hops away from the
   source), and similarly for the source addresses.  Thus, while
   forwarding data, the single-hop source and destination addresses
   would change at each hop (always pointing to the node doing the
   forwarding and the "best" next link-layer hop, respectively), while
   the source and destination IP addresses would remain unchanged.
   Notice that if an IP packet is fragmented, the individual fragments
   may arrive at any node out of order.  If the initial fragment (which
   contains the IP header) is delayed for some reason, a node that
   receives a subsequent fragment would lack the required information.
   It would be forced to wait until it receives the IP header (within
   the first fragment) before being able to forward the fragment any
   further.  This imposes some additional buffering requirements on
   intermediate nodes.  Additionally, such a specification would only
   work for one type of LoWPAN payload: IPv6.  In general, it would have
   to be adapted for any other payload, and would require that payload
   to provide its own end-to-end addressing information.

   On the other hand, the approach finally followed (<a href="#section-11">Section 11</a>) creates
   a mesh at the LoWPAN layer (below layer 3).  Accordingly, the link-
   layer originator and final destination address are included within
   the LoWPAN header.  This enables mesh delivery for any protocol or
   application layered on the LoWPAN adaptation layer (<a href="#section-5">Section 5</a>).  For
   IPv6 as supported in this document, another advantage of expressing
   the originator and final destinations as layer 2 addresses is that
   the IPv6 addresses can be compressed as per the header compression
   specified in <a href="#section-10">Section 10</a>.  Furthermore, the number of octets needed to
   maintain routing tables is reduced due to the smaller size of
   802.15.4 addresses (either 64 bits or 16 bits) as compared to IPv6
   addresses (128 bits).  A disadvantage is that applications on top of
   IP do not address packets to link-layer destination addresses, but to
   IP (layer 3) destination addresses.  Thus, given an IP address, there
   is a need to resolve the corresponding link-layer address.
   Accordingly, a mesh routing specification needs to clarify the
   Neighbor Discovery implications, although in some special cases, it
   may be possible to derive a device's address at layer 2 from its



<span class="grey">Montenegro, et al.          Standards Track                    [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


   address at layer 3 (and vice versa).  Such complete specification is
   outside the scope of this document.

Authors' Addresses

   Gabriel Montenegro
   Microsoft Corporation

   EMail: gabriel.montenegro@microsoft.com


   Nandakishore Kushalnagar
   Intel Corp

   EMail: nandakishore.kushalnagar@intel.com


   Jonathan W. Hui
   Arch Rock Corp

   EMail: jhui@archrock.com


   David E. Culler
   Arch Rock Corp

   EMail: dculler@archrock.com
























<span class="grey">Montenegro, et al.          Standards Track                    [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc4944.html">RFC 4944</a>                IPv6 over IEEE 802.15.4           September 2007</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Montenegro, et al.          Standards Track                    [Page 30]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.119, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc4944 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:43:12 GMT --></html>