<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7248 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:05:01 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.127" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-saintandre-sip-xmpp-presence" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7248" name="DC.Identifier"/>
<meta content="May, 2014" name="DC.Date.Issued"/>
<meta content="Hildebrand, Joe" name="DC.Creator"/>
<meta content="Houri, Avshalom" name="DC.Creator"/>
<meta content="Saint-Andre, Peter" name="DC.Creator"/>
<meta content="This document defines a bidirectional protocol mapping for the
exchange of presence information between the Session Initiation
Protocol (SIP) and the Extensible Messaging and Presence Protocol
(XMPP)." name="DC.Description.Abstract"/>
<meta content="Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Presence" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7248 - Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Presence</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7248.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7248" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-stox-presence" title="draft-ietf-stox-presence">draft-ietf-stox...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7248" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7248" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7248" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc8048.html">8048</a>                                     PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                    P. Saint-Andre
Request for Comments: 7248                                          &amp;yet
Category: Standards Track                                       A. Houri
ISSN: 2070-1721                                                      IBM
                                                           J. Hildebrand
                                                     Cisco Systems, Inc.
                                                                May 2014


   <span class="h1">Interworking between the Session Initiation Protocol (SIP) and the</span>
      <span class="h1">Extensible Messaging and Presence Protocol (XMPP): Presence</span>

Abstract

   This document defines a bidirectional protocol mapping for the
   exchange of presence information between the Session Initiation
   Protocol (SIP) and the Extensible Messaging and Presence Protocol
   (XMPP).

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7248">http://www.rfc-editor.org/info/rfc7248</a>.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
   <a href="#section-2">2</a>. Intended Audience ...............................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Terminology .....................................................<a href="#page-3">3</a>
   <a href="#section-4">4</a>. Subscriptions to Presence Information ...........................<a href="#page-4">4</a>
      <a href="#section-4.1">4.1</a>. Overview ...................................................<a href="#page-4">4</a>
      <a href="#section-4.2">4.2</a>. XMPP to SIP ................................................<a href="#page-5">5</a>
           <a href="#section-4.2.1">4.2.1</a>. Establishing a Presence Subscription ................<a href="#page-5">5</a>
           <a href="#section-4.2.2">4.2.2</a>. Refreshing a Presence Subscription ..................<a href="#page-9">9</a>
           <a href="#section-4.2.3">4.2.3</a>. Cancelling a Presence Subscription .................<a href="#page-10">10</a>
      <a href="#section-4.3">4.3</a>. SIP to XMPP ...............................................<a href="#page-12">12</a>
           <a href="#section-4.3.1">4.3.1</a>. Establishing a Presence Subscription ...............<a href="#page-12">12</a>
           <a href="#section-4.3.2">4.3.2</a>. Refreshing a Presence Subscription .................<a href="#page-14">14</a>
           <a href="#section-4.3.3">4.3.3</a>. Cancelling a Presence Subscription .................<a href="#page-17">17</a>
   <a href="#section-5">5</a>. Notifications of Presence Information ..........................<a href="#page-17">17</a>
      <a href="#section-5.1">5.1</a>. Overview ..................................................<a href="#page-17">17</a>
      <a href="#section-5.2">5.2</a>. XMPP to SIP ...............................................<a href="#page-19">19</a>
      <a href="#section-5.3">5.3</a>. SIP to XMPP ...............................................<a href="#page-22">22</a>
   <a href="#section-6">6</a>. Requests for Presence Information ..............................<a href="#page-24">24</a>
      <a href="#section-6.1">6.1</a>. XMPP to SIP ...............................................<a href="#page-24">24</a>
      <a href="#section-6.2">6.2</a>. SIP to XMPP ...............................................<a href="#page-25">25</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-26">26</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-27">27</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-27">27</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-27">27</a>
   <a href="#appendix-A">Appendix A</a>. Acknowledgements ......................................<a href="#page-29">29</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   In order to help ensure interworking between presence systems that
   conform to the instant message / presence requirements [<a href="rfc2779.html" title='"Instant Messaging / Presence Protocol Requirements"'>RFC2779</a>], it
   is important to clearly define protocol mappings between such
   systems.  Within the IETF, work has proceeded on two presence
   technologies:

   o  Various extensions to the Session Initiation Protocol ([<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>])
      for presence, in particular [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>]

   o  The Extensible Messaging and Presence Protocol (XMPP), which
      consists of a formalization of the core XML streaming protocols
      developed originally by the Jabber open-source community; the
      relevant specifications are [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>] for the XML streaming layer
      and [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>] for basic presence and instant-messaging extensions

   One approach to helping ensure interworking between these protocols
   is to map each protocol to the abstract semantics described in
   [<a href="rfc3860.html" title='"Common Profile for Instant Messaging (CPIM)"'>RFC3860</a>]; although that is the approach taken by both [<a href="rfc3922.html" title='"Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM)"'>RFC3922</a>] and



<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   [<a href="#ref-SIMPLE-CPIM-MAPPING" title='"CPIM Mapping of SIMPLE Presence and Instant Messaging"'>SIMPLE-CPIM-MAPPING</a>], to the best of our knowledge that approach has
   never been implemented.  The approach taken in this document is to
   directly map semantics from one protocol to another (i.e., from SIP/
   SIMPLE (SIP for Instant Messaging and Presence Leveraging Extensions)
   to XMPP and vice versa), since that is how existing systems solve the
   interworking problem.

   The architectural assumptions underlying such direct mappings are
   provided in [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>], including mapping of addresses and error
   conditions.  The mappings specified in this document cover basic
   presence functionality.  Mapping of more advanced functionality
   (e.g., so-called "rich presence") is out of scope for this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Intended%20Audience"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Intended Audience</span>

   The documents in this series are intended for use by software
   developers who have an existing system based on one of these
   technologies (e.g., SIP) and would like to enable communication from
   that existing system to systems based on the other technology (e.g.,
   XMPP).  We assume that readers are familiar with the core
   specifications for both SIP [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] and XMPP [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>], with the
   base document for this series [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>], and with the following
   presence-related specifications:

   o  "A Presence Event Package for the Session Initiation Protocol
      (SIP)" [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>]

   o  "Presence Information Data Format (PIDF)" [<a href="rfc3863.html" title='"Presence Information Data Format (PIDF)"'>RFC3863</a>]

   o  "Extensible Messaging and Presence Protocol (XMPP): Instant
      Messaging and Presence" [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>]

   o  "SIP-Specific Event Notification" [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Terminology"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Terminology</span>

   A number of terms used here (user, contact, subscription,
   notification, etc.) are explained in [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>], [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>], [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>],
   and [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>].  This document uses some, but not all, of the terms
   defined in the Model for Presence and Instant Messaging [<a href="rfc2778.html" title='"A Model for Presence and Instant Messaging"'>RFC2778</a>].

   In flow diagrams, SIP traffic is shown using arrows such as "***&gt;",
   whereas XMPP traffic is shown using arrows such as "...&gt;".

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].



<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Subscriptions%20to%20Presence%20Information"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Subscriptions to Presence Information</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Overview"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Overview</span>

   Both XMPP and presence-aware SIP systems enable entities (often, but
   not necessarily, human users) to subscribe to the presence of other
   entities.  XMPP presence subscriptions are specified in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>].
   Presence subscriptions using a SIP event package for presence are
   specified in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>].

   As described in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>], XMPP presence subscriptions are managed
   using XMPP &lt;presence/&gt; stanzas of type "subscribe", "subscribed",
   "unsubscribe", and "unsubscribed".  The main subscription states are:

   o  "none" (neither the user nor the contact is subscribed to the
      other's presence information)

   o  "from" (the user has a subscription from the contact)

   o  "to" (the user has a subscription to the contact's presence
      information)

   o  "both" (both user and contact are subscribed to each other's
      presence information)

   As described in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>], SIP presence subscriptions are managed
   through the use of SIP SUBSCRIBE events sent from a SIP user agent to
   an intended recipient who is most generally referenced by a Presence
   URI of the form &lt;pres:user@domain&gt; but who might be referenced by a
   SIP or SIPS (Session Initiation Protocol Secure) URI of the form
   &lt;sip:user@domain&gt; or &lt;sips:user@domain&gt;.  In practice, 'pres' URIs
   are rarely used, which is why the examples in this document use 'sip'
   URIs.

   The subscription models underlying XMPP and SIP differ mainly in the
   fact that XMPP presence subscriptions are long-lived (indeed
   permanent if not explicitly cancelled, so that a subscription need
   never be refreshed during any given presence "session"), whereas SIP
   presence subscriptions are short-lived (the default time-to-live of a
   SIP presence subscription is 3600 seconds, as specified in
   <a href="rfc3856.html#section-6.4">Section 6.4 of [RFC3856]</a>, so that a subscription needs to be
   explicitly refreshed if it will have the appearance of being
   permanent or even of lasting as long as the duration of a presence
   "session").  This disparity has implications for the handling of
   subscription cancellations in either direction and, from the SIP
   side, subscription refreshes.





<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20XMPP%20to%20SIP"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  XMPP to SIP</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Establishing%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Establishing a Presence Subscription</span>

   The following diagram illustrates the protocol flow for establishing
   a presence subscription from an XMPP user to a SIP user, as further
   explained in the text and examples after the diagram.

   XMPP       XMPP      XMPP-to-SIP    SIP-to-XMPP     SIP          SIP
   User      Server      Gateway        Gateway       Server        User
    |           |            |              |            |           |
    | (F1) XMPP |            |              |            |           |
    | subscribe |            |              |            |           |
    |..........&gt;|            |              |            |           |
    |           | (F2) XMPP  |              |            |           |
    |           | subscribe  |              |            |           |
    |           |...........&gt;|              |            |           |
    |           |            | (F3) SIP SUBSCRIBE        |           |
    |           |            |**************************&gt;|           |
    |           |            |              |            | (F4) SIP  |
    |           |            |              |            | SUBSCRIBE |
    |           |            |              |            |**********&gt;|
    |           |            |              |            | (F5) SIP  |
    |           |            |              |            | 200 OK    |
    |           |            |              | (F6) SIP   |&lt;**********|
    |           |            |              | 200 OK     | (F7) SIP  |
    |           |            |              |&lt;***********| NOTIFY    |
    |           |            |              |            |&lt;**********|
    |           |            |              | (F8) SIP   |           |
    |           |            |              | NOTIFY     |           |
    |           |            |              |&lt;***********|           |
    |           |            |              | (F9) SIP   |           |
    |           |            |              | 200 OK     |           |
    |           |            |              |***********&gt;|           |
    |           |            |              |            | (F10) SIP |
    |           |    (F11) XMPP subscribed  |            | 200 OK    |
    |           |&lt;..........................|            |**********&gt;|
    |           |    (F12) XMPP presence    |            |           |
    |           |&lt;..........................|            |           |
    | (F13) XMPP|            |              |            |           |
    | subscribed|            |              |            |           |
    |&lt;..........|            |              |            |           |
    | (F14) XMPP|            |              |            |           |
    | presence  |            |              |            |           |
    |&lt;..........|            |              |            |           |






<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   An XMPP user (e.g., juliet@example.com) initiates a subscription by
   sending a subscription request to a contact (e.g.,
   romeo@example.net), and the contact either accepts or declines the
   request.  If the contact accepts the request, the user will have a
   subscription to the contact's presence information until (1) the user
   unsubscribes or (2) the contact cancels the subscription.  The
   subscription request is encapsulated in a &lt;presence/&gt; stanza of type
   "subscribe":

   Example 1: XMPP User Subscribes to SIP Contact (F1)

   |  &lt;presence from='juliet@example.com'
   |            to='romeo@example.net'
   |            type='subscribe'/&gt;

   Upon receiving such a &lt;presence/&gt; stanza, the XMPP server to which
   Juliet has connected needs to determine the identity of the
   domainpart in the 'to' address, which it does by following the
   procedures explained in <a href="rfc7247.html#section-5">Section 5 of [RFC7247]</a>.  If the domain is a
   SIP domain, the XMPP server will hand off the &lt;presence/&gt; stanza to
   an associated XMPP-to-SIP gateway or connection manager that natively
   communicates with presence-aware SIP servers.

   The XMPP-to-SIP gateway is then responsible for translating the XMPP
   subscription request into a SIP SUBSCRIBE request addressed from the
   XMPP user to the SIP user:

   Example 2: SIP Transformation of XMPP Subscription Request (F3)

   |  SUBSCRIBE sip:romeo@example.net SIP/2.0
   |  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=ffd2
   |  Call-ID: 5BCF940D-793D-43F8-8972-218F7F4EAA8C
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 123 SUBSCRIBE
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Accept: application/pidf+xml
   |  Expires: 3600
   |  Content-Length: 0











<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   Once the XMPP-to-SIP gateway has passed the SIP SUBSCRIBE off to the
   SIP server (via the SIP-to-XMPP gateway) and the SIP server has
   delivered the SIP SUBSCRIBE to the SIP user (F3 and F4; no example
   shown for F4), the SIP user would then send a response indicating
   acceptance of the subscription request:

   Example 3: SIP Accepts Subscription Request (F6)

   |  SIP/2.0 200 OK
   |  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=ffd2
   |  To: &lt;sip:juliet@example.com&gt;;tag=j89d
   |  Call-ID: 5BCF940D-793D-43F8-8972-218F7F4EAA8C
   |  CSeq: 234 SUBSCRIBE
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Expires: 3600
   |  Content-Length: 0

   In accordance with [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>], the XMPP-to-SIP gateway SHOULD consider
   the subscription state to be "neutral" until it receives a NOTIFY
   message.  Therefore, the SIP user or SIP-to-XMPP gateway at the SIP
   user's domain SHOULD immediately send a NOTIFY message containing a
   Subscription-State header whose value contains the string "active"
   (see <a href="#section-5">Section 5</a>).



























<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   Example 4: SIP User Sends Presence Notification (F7)

   |  NOTIFY sip:192.0.2.1 SIP/2.0
   |  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=yt66
   |  To: &lt;sip:juliet@example.com&gt;;tag=bi54
   |  Call-ID: 5BCF940D-793D-43F8-8972-218F7F4EAA8C
   |  Event: presence
   |  Subscription-State: active;expires=499
   |  Max-Forwards: 70
   |  CSeq: 8775 NOTIFY
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Content-Type: application/pidf+xml
   |  Content-Length: 193
   |
   |  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
   |  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
   |            entity='pres:romeo@example.net'&gt;
   |    &lt;tuple id='ID-orchard'&gt;
   |      &lt;status&gt;
   |        &lt;basic&gt;open&lt;/basic&gt;
   |        &lt;show xmlns='jabber:client'&gt;away&lt;/show&gt;
   |      &lt;/status&gt;
   |    &lt;/tuple&gt;
   |  &lt;/presence&gt;

   In response, the presence-aware SIP-to-XMPP gateway would send a 200
   OK to the SIP user (not shown here, since it is not translated into
   an XMPP stanza).

   Upon receiving the first NOTIFY with a subscription state of active,
   the XMPP-to-SIP gateway MUST generate a &lt;presence/&gt; stanza of type
   "subscribed":

   Example 5: XMPP User Receives Acknowledgement from SIP Contact (F13)

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='subscribed'/&gt;












<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   As described in <a href="#section-5">Section 5</a>, the gateway MUST also generate a presence
   notification addressed to the XMPP user:

   Example 6: XMPP User Receives Presence Notification from SIP Contact
   (F14)

   |  &lt;presence from='romeo@example.net/orchard'
   |            to='juliet@example.com'/&gt;

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20Refreshing%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  Refreshing a Presence Subscription</span>

   It is the responsibility of the XMPP-to-SIP gateway to set the value
   of the Expires header and to periodically renew the subscription on
   the SIP side of the gateway so that the subscription appears to be
   permanent to the XMPP user.  For example, the XMPP-to-SIP gateway
   SHOULD send a new SUBSCRIBE request to the SIP user whenever the XMPP
   user initiates a presence session with the XMPP server by sending
   initial presence to its XMPP server.  The XMPP-to-SIP gateway also
   SHOULD send a new SUBSCRIBE request to the SIP user whenever the SIP
   presence subscription is scheduled to expire during the XMPP user's
   active presence session.

   The rules regarding SIP SUBSCRIBE requests for the purpose of
   establishing and refreshing a presence subscription are provided in
   [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>].  Those rules also apply to XMPP-to-SIP gateways.
   Furthermore, an XMPP-to-SIP gateway MUST consider the XMPP
   subscription to be permanently cancelled (and so inform the XMPP
   user) if it receives a SIP response of 403, 489, or 603.  By
   contrast, it is appropriate to consider a SIP response of 423 or 481
   to be a transient error and to maintain the long-lived XMPP presence
   subscription.  [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>] explains more detailed considerations about
   the handling of SIP responses in relation to subscription requests
   and refreshes.

   Finally, see the security considerations section (<a href="#section-7">Section 7</a>) of this
   document for important information and requirements regarding the
   security implications of subscription refreshes.














<span class="grey">Saint-Andre, et al.          Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.3.%20%20Cancelling%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.2.3" name="section-4.2.3">4.2.3</a>.  Cancelling a Presence Subscription</span>

   The following diagram illustrates the protocol flow for cancelling an
   XMPP user's presence subscription to a SIP user, as further explained
   in the text and examples after the diagram.

   XMPP       XMPP      XMPP-to-SIP    SIP-to-XMPP     SIP          SIP
   User      Server      Gateway        Gateway       Server        User
    |           |            |              |            |           |
    | (F15) XMPP|            |              |            |           |
    |unsubscribe|            |              |            |           |
    |..........&gt;|            |              |            |           |
    |           | (F16) XMPP |              |            |           |
    |           | unsubscribe|              |            |           |
    |           |...........&gt;|              |            |           |
    |           |            | (F17) SIP SUBSCRIBE       |           |
    |           |            | Expires: 0   |            |           |
    |           |            |**************************&gt;|           |
    |           |            |              |            | (F18) SIP |
    |           |            |              |            | SUBSCRIBE |
    |           |            |              |            | Expires: 0|
    |           |            |              |            |**********&gt;|
    |           |            |              |            | (F19) SIP |
    |           |            |              |            | 200 OK    |
    |           |            |              |            |&lt;**********|
    |           |            |              | (F20) SIP  |           |
    |           |            |              | 200 OK     |           |
    |           |            |              |&lt;***********|           |
    |           |  (F21) XMPP unsubscribed  |            |           |
    |           |&lt;..........................|            |           |
    | (F22) XMPP|            |              |            |           |
    | unsubscribed           |              |            |           |
    |&lt;..........|            |              |            |           |
    |           |            |              |            |           |

   At any time after subscribing, the XMPP user can unsubscribe from the
   contact's presence.  This is done by sending a &lt;presence/&gt; stanza of
   type "unsubscribe":

   Example 7: XMPP User Unsubscribes from SIP Contact (F15)

   |  &lt;presence from='juliet@example.com'
   |            to='romeo@example.net'
   |            type='unsubscribe'/&gt;







<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   The XMPP-to-SIP gateway is responsible for translating the
   unsubscribe command into a SIP SUBSCRIBE request with the Expires
   header set to a value of zero:

   Example 8: SIP Transformation of XMPP Unsubscribe (F17)

   |  SUBSCRIBE sip:romeo@example.net SIP/2.0
   |  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=j89d
   |  Call-ID: 9D9F00DF-FCA9-4E7E-B970-80B638D5218A
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 789 SUBSCRIBE
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Accept: application/pidf+xml
   |  Expires: 0
   |  Content-Length: 0

   Upon sending the transformed unsubscribe, the XMPP-to-SIP gateway
   SHOULD send a &lt;presence/&gt; stanza of type "unsubscribed" addressed to
   the XMPP user:

   Example 9: XMPP User Receives Unsubscribed Notification (F22)

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='unsubscribed'/&gt;
























<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20SIP%20to%20XMPP"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  SIP to XMPP</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20Establishing%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  Establishing a Presence Subscription</span>

   The following diagram illustrates the protocol flow for establishing
   a presence subscription from a SIP user to an XMPP user, as further
   explained in the text and examples after the diagram.

   SIP        SIP      SIP-to-XMPP    XMPP-to-SIP      XMPP         XMPP
   User      Server      Gateway        Gateway       Server        User
    |           |            |              |            |           |
    | (F23) SIP |            |              |            |           |
    | SUBSCRIBE |            |              |            |           |
    |**********&gt;|            |              |            |           |
    |           | (F24) SIP  |              |            |           |
    |           | SUBSCRIBE  |              |            |           |
    |           |***********&gt;|              |            |           |
    |           |            | (F25) XMPP subscribe      |           |
    |           |            |..........................&gt;|           |
    |           |            |              |            | (F26) XMPP|
    |           |            |              |            | subscribe |
    |           |            |              |            |..........&gt;|
    |           |            |              |            | (F27) XMPP|
    |           |            |              |            | subscribed|
    |           |            |              |            |&lt;..........|
    |           |            |              | (F28) XMPP |           |
    |           |            |              | subscribed |           |
    |           |            |              |&lt;...........|           |
    |           | (F29) SIP 200 OK          |            |           |
    |           |&lt;**************************|            |           |
    | (F30) SIP |            |              |            |           |
    | 200 OK    |            |              |            |           |
    |&lt;**********|            |              |            |           |
    |           |            |              |            |           |

















<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   A SIP user initiates a subscription to a contact's presence
   information by sending a SIP SUBSCRIBE request to the contact.  The
   following is an example of such a request:

   Example 10: SIP User Subscribes to XMPP Contact (F23)

   |  SUBSCRIBE sip:juliet@example.com SIP/2.0
   |  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=xfg9
   |  Call-ID: AA5A8BE5-CBB7-42B9-8181-6230012B1E11
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 263 SUBSCRIBE
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Accept: application/pidf+xml
   |  Content-Length: 0

   Notice that the Expires header was not included in the SUBSCRIBE
   request; this means that the default value of 3600 (i.e., 3600
   seconds = 1 hour) applies.

   Upon receiving the SUBSCRIBE, the SIP server needs to determine the
   identity of the domain portion of the Request-URI or To header, which
   it does by following the procedures explained in <a href="rfc7247.html#section-5">Section 5 of
   [RFC7247]</a>.  If the domain is an XMPP domain, the SIP server will hand
   off the SUBSCRIBE to an associated SIP-to-XMPP gateway or connection
   manager that natively communicates with XMPP servers.

   The SIP-to-XMPP gateway is then responsible for translating the
   SUBSCRIBE into an XMPP subscription request addressed from the SIP
   user to the XMPP user:

   Example 11: XMPP Transformation of SIP SUBSCRIBE (F25)

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='subscribe'/&gt;

   In accordance with [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>], once it receives the stanza from the
   XMPP-to-SIP gateway, the XMPP user's server MUST deliver the presence
   subscription request to the XMPP user (or, if a subscription already
   exists in the XMPP user's roster, the XMPP server SHOULD auto-reply
   with a &lt;presence/&gt; stanza of type "subscribed").








<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   If the XMPP user approves the subscription request, the XMPP server
   then MUST return a &lt;presence/&gt; stanza of type "subscribed" addressed
   from the XMPP user to the SIP user.  The XMPP-to-SIP gateway is
   responsible for translating the &lt;presence/&gt; stanza of type
   "subscribed" into a SIP 200 OK response.

   If the XMPP user declines the subscription request, the XMPP server
   then MUST return a &lt;presence/&gt; stanza of type "unsubscribed"
   addressed from the XMPP user to the SIP user and the XMPP-to-SIP
   gateway MUST transform that stanza into an empty SIP NOTIFY message
   with a Subscription-State of "terminated" and a reason of "rejected":

   Example 12: Subscription Request Rejected

   |  NOTIFY sip:192.0.2.2 SIP/2.0
   |  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=ur93
   |  To: &lt;sip:romeo@example.net&gt;;tag=pq72
   |  Call-ID: AA5A8BE5-CBB7-42B9-8181-6230012B1E11
   |  Event: presence
   |  Subscription-State: terminated;reason=rejected
   |  Max-Forwards: 70
   |  CSeq: 232 NOTIFY
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Content-Type: application/pidf+xml
   |  Content-Length: 0

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20Refreshing%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  Refreshing a Presence Subscription</span>

   For as long as a SIP user is online and interested in receiving
   presence notifications from the XMPP contact, the user's SIP user
   agent is responsible for periodically refreshing the subscription by
   sending an updated SUBSCRIBE request with an appropriate value for
   the Expires header.  In response, the presence-aware SIP-to-XMPP
   gateway MUST send a SIP NOTIFY to the user agent (per [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>]); if
   the gateway has meaningful information about the availability state
   of the XMPP user (e.g., obtained from the core presence session in
   the XMPP server) then the NOTIFY MUST communicate that information
   (e.g., by including a PIDF body [<a href="rfc3863.html" title='"Presence Information Data Format (PIDF)"'>RFC3863</a>] with the relevant data),
   whereas if the gateway does not have meaningful information about the
   availability state of the XMPP user then the NOTIFY MUST be empty as
   allowed by [<a href="rfc6665.html" title='"SIP-Specific Event Notification"'>RFC6665</a>].









<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   Once the SIP user ends its presence session, it is the responsibility
   of the presence-aware SIP-to-XMPP gateway to properly handle the
   difference between short-lived SIP presence subscriptions and long-
   lived XMPP presence subscriptions.  The gateway has two options when
   the SIP user's subscription expires:

   o  Cancel the subscription (i.e., treat it as temporary) and send an
      XMPP &lt;presence/&gt; stanza of type "unsubscribe" to the XMPP contact;
      this honors the SIP semantic but will seem strange to the XMPP
      contact (since it will appear that the SIP user has cancelled a
      long-lived subscription).

   o  Maintain the subscription (i.e., treat it as long-lived), and

      1.  send a SIP NOTIFY request to the SIP user containing a PIDF
          document specifying that the XMPP contact now has a basic
          status of "closed", including a Subscription-State of
          "terminated" with a reason of "timeout"

      2.  send an XMPP &lt;presence/&gt; stanza of type "unavailable" to the
          XMPP contact; this violates the letter of the SIP semantic but
          will seem more natural to the XMPP contact

   Which of these options a presence-aware SIP-to-XMPP gateway chooses
   is up to the implementation.

   If the implementation chooses the first option, the protocol
   generated would be as follows:

   Example 13: XMPP Handling of Temporary Subscription Expiry

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='unsubscribe'/&gt;

















<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   If the implementation chooses the second option, the protocol
   generated would be as follows:

   Example 14: SIP Handling of Long-Lived Subscription Expiry

   |  NOTIFY sip:192.0.2.2 SIP/2.0
   |  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=ur93
   |  To: &lt;sip:romeo@example.net&gt;;tag=pq72
   |  Call-ID: 2B44E147-3B53-45E4-9D48-C051F3216D14
   |  Event: presence
   |  Subscription-State: terminated;reason=timeout
   |  Max-Forwards: 70
   |  CSeq: 232 NOTIFY
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Content-Type: application/pidf+xml
   |  Content-Length: 194
   |
   |  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
   |  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
   |            entity='pres:juliet@example.com'&gt;
   |    &lt;tuple id='ID-balcony'&gt;
   |      &lt;status&gt;
   |        &lt;basic&gt;closed&lt;/basic&gt;
   |      &lt;/status&gt;
   |    &lt;/tuple&gt;
   |  &lt;/presence&gt;

   Example 15: XMPP Handling of Long-Lived Subscription Expiry

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='unavailable'/&gt;


















<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.3.%20%20Cancelling%20a%20Presence%20Subscription"></a><a class="selflink" href="#section-4.3.3" name="section-4.3.3">4.3.3</a>.  Cancelling a Presence Subscription</span>

   At any time, the SIP user can cancel the subscription by sending a
   SUBSCRIBE message whose Expires header is set to a value of zero
   ("0"):

   Example 16: SIP User Cancels Subscription

   |  SUBSCRIBE sip:juliet@example.com SIP/2.0
   |  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=yt66
   |  Call-ID: 717B1B84-F080-4F12-9F44-0EC1ADE767B9
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 8775 SUBSCRIBE
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Expires: 0
   |  Content-Length: 0

   As above, upon receiving such a request, a presence-aware SIP-to-XMPP
   gateway is responsible for doing one of the following:

   o  Cancel the subscription (i.e., treat it as temporary) and send an
      XMPP &lt;presence/&gt; stanza of type "unsubscribe" to the XMPP contact.

   o  Maintain the subscription (i.e., treat it as long-lived), and

      1.  send a SIP NOTIFY request to the SIP user containing a PIDF
          document specifying that the XMPP contact now has a basic
          status of "closed"

      2.  send a SIP SUBSCRIBE request to the SIP user with an Expires
          header set to a value of "0" (zero) when it receives XMPP
          presence of type "unavailable" from the XMPP contact

      3.  send an XMPP &lt;presence/&gt; stanza of type "unavailable" to the
          XMPP contact

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Notifications%20of%20Presence%20Information"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Notifications of Presence Information</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Overview"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Overview</span>

   Both XMPP and presence-aware SIP systems enable entities (often, but
   not necessarily, human users) to send presence notifications to other
   entities.  At its most basic, the term "presence" refers to
   information about an entity's "on/off" availability for communication
   on a network.  Often, this basic concept is supplemented by
   information that further specifies the entity's context or status



<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   while available for communication; these availability states commonly
   include "away" and "do not disturb".  Some systems and protocols
   extend the concepts of presence and availability even further and
   refer to any relatively ephemeral information about an entity as a
   kind of presence; categories of such "extended presence" include
   geographical location (e.g., GPS coordinates), user mood (e.g.,
   grumpy), user activity (e.g., walking), and ambient environment
   (e.g., noisy).  In this document, we focus on the "least common
   denominator" of network availability only, although future documents
   might address broader notions of presence, including availability
   states and extended presence.

   [<a id="ref-RFC6121" name="ref-RFC6121">RFC6121</a>] defines how XMPP &lt;presence/&gt; stanzas can indicate
   availability (via absence of a 'type' attribute) or lack of
   availability (via a 'type' attribute with a value of "unavailable").
   SIP presence using a SIP event package for presence is specified in
   [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>].

   As described in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>], XMPP presence information about an entity
   is communicated by means of an XML &lt;presence/&gt; stanza sent over an
   XML stream.  In this document we will assume that such a &lt;presence/&gt;
   stanza is sent from an XMPP client to an XMPP server over an XML
   stream negotiated between the client and the server, and that the
   client is controlled by a human user.  In general, XMPP presence is
   sent by the user to the user's server and then broadcast to all
   entities who are subscribed to the user's presence information.

   As described in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>], presence information about an entity is
   communicated by means of a SIP NOTIFY event sent from a SIP user
   agent to an intended recipient who is most generally referenced by a
   Presence URI of the form &lt;pres:user@domain&gt; but who might be
   referenced by a SIP or SIPS URI of the form &lt;sip:user@domain&gt; or
   &lt;sips:user@domain&gt;.

   This document addresses basic presence or network availability only,
   not the various extensions to SIP and XMPP for "rich presence" such
   as [<a href="rfc4480.html" title='"RPID: Rich Presence Extensions to the Presence Information Data Format (PIDF)"'>RFC4480</a>], [<a href="#ref-XEP-0107" title='"User Mood"'>XEP-0107</a>], and [<a href="#ref-XEP-0108" title='"User Activity"'>XEP-0108</a>].














<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20XMPP%20to%20SIP"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  XMPP to SIP</span>

   When Juliet interacts with her XMPP client to modify her presence
   information (or when her client automatically updates her presence
   information, e.g., via an "auto-away" feature), her client generates
   an XMPP &lt;presence/&gt; stanza.  The syntax of the &lt;presence/&gt; stanza,
   including required and optional elements and attributes, is defined
   in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>].  The following is an example of such a stanza:

   Example 17: XMPP User Sends Presence Notification

   |  &lt;presence from='juliet@example.com/balcony'/&gt;

   Upon receiving such a stanza, the XMPP server to which Juliet has
   connected broadcasts it to all subscribers who are authorized to
   receive presence notifications from Juliet (this is similar to the
   SIP NOTIFY method).  For each subscriber, broadcasting the presence
   notification involves either delivering it to a local recipient (if
   the hostname in the subscriber's address matches one of the hostnames
   serviced by the XMPP server) or attempting to route it to the foreign
   domain that services the hostname in the subscriber's address.  Thus,
   the XMPP server needs to determine the identity of the domainpart in
   the 'to' address, which it does by following the procedures discussed
   in [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>].  If the domain is a SIP domain, the XMPP server will
   hand off the &lt;presence/&gt; stanza to an associated XMPP-to-SIP gateway
   or connection manager that natively communicates with presence-aware
   SIP servers (no example shown).

   The XMPP-to-SIP gateway is then responsible for translating the XMPP
   &lt;presence/&gt; stanza into a SIP NOTIFY request and included PIDF
   document from the XMPP user to the SIP user.

   Example 18: SIP Transformation of XMPP Presence Notification

   |  NOTIFY sip:192.0.2.2 SIP/2.0
   |  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=gh19
   |  To: &lt;sip:romeo@example.net&gt;;tag=yt66
   |  Contact: &lt;sip:juliet@example.com&gt;;gr=balcony
   |  Call-ID: 2B44E147-3B53-45E4-9D48-C051F3216D14
   |  Event: presence
   |  Subscription-State: active;expires=599
   |  Max-Forwards: 70
   |  CSeq: 157 NOTIFY
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Content-Type: application/pidf+xml
   |  Content-Length: 192
   |



<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   |  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
   |  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
   |            entity='pres:juliet@example.com'&gt;
   |    &lt;tuple id='ID-balcony'&gt;
   |      &lt;status&gt;
   |        &lt;basic&gt;open&lt;/basic&gt;
   |        &lt;show xmlns='jabber:client'&gt;away&lt;/show&gt;
   |      &lt;/status&gt;
   |    &lt;/tuple&gt;
   |  &lt;/presence&gt;

   The mapping of XMPP syntax elements to SIP syntax elements SHOULD be
   as shown in the following table.  (Mappings for elements not
   mentioned are undefined.)

        +-----------------------------+---------------------------+
        |  XMPP Element or Attribute  |  SIP Header or PIDF Data  |
        +-----------------------------+---------------------------+
        |  &lt;presence/&gt; stanza         |  "Event: presence" (1)    |
        +-----------------------------+---------------------------+
        |  XMPP resource identifier   |  tuple 'id' attribute (2) |
        +-----------------------------+---------------------------+
        |  from                       |  From                     |
        +-----------------------------+---------------------------+
        |  id                         |  CSeq (3)                 |
        +-----------------------------+---------------------------+
        |  to                         |  To                       |
        +-----------------------------+---------------------------+
        |  type                       |  basic status (4) (5)     |
        +-----------------------------+---------------------------+
        |  xml:lang                   |  Content-Language         |
        +-----------------------------+---------------------------+
        |  &lt;priority/&gt;                |  priority for tuple (6)   |
        +-----------------------------+---------------------------+
        |  &lt;show/&gt;                    |  no mapping (7)           |
        +-----------------------------+---------------------------+
        |  &lt;status/&gt;                  |  &lt;note/&gt;                  |
        +-----------------------------+---------------------------+

             Table 1: Presence Syntax Mapping from XMPP to SIP

   Note the following regarding these mappings:

   (1)  Only an XMPP &lt;presence/&gt; stanza that lacks a 'type' attribute or
        whose 'type' attribute has a value of "unavailable" SHOULD be
        mapped by an XMPP-to-SIP gateway to a SIP NOTIFY request, since
        those are the only &lt;presence/&gt; stanzas that represent
        notifications.



<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   (2)  The PIDF schema defines the tuple 'id' attribute as having a
        datatype of "xs:ID"; because this datatype is more restrictive
        than the "xs:string" datatype for XMPP resourceparts (in
        particular, a number is not allowed as the first character of an
        ID), prepending the resourcepart with "ID-" or some other
        alphabetic string when mapping from XMPP to SIP is RECOMMENDED.

   (3)  In practice, XMPP &lt;presence/&gt; stanzas often do not include the
        'id' attribute.

   (4)  Because the lack of a 'type' attribute indicates that an XMPP
        entity is available for communications, the gateway SHOULD map
        that information to a PIDF basic status of "open".  Because a
        'type' attribute with a value of "unavailable" indicates that an
        XMPP entity is not available for communications, the gateway
        SHOULD map that information to a PIDF basic status of "closed".

   (5)  When the XMPP-to-SIP gateway receives XMPP presence of type
        "unavailable" from the XMPP contact, it SHOULD (a) send a SIP
        NOTIFY request to the SIP user containing a PIDF document
        specifying that the XMPP contact now has a basic status of
        "closed" and (b) send a SIP SUBSCRIBE request to the SIP user
        with an Expires header set to a value of "0" (zero).

   (6)  The value of the XMPP &lt;priority/&gt; element is an integer between
        -128 and +127, whereas the value of the PIDF &lt;contact/&gt;
        element's 'priority' attribute is a decimal number from zero to
        one inclusive, with a maximum of three decimal places.  If the
        value of the XMPP &lt;priority/&gt; element is negative, an XMPP-to-
        SIP gateway MUST NOT map the value.  If an XMPP-to-SIP gateway
        maps positive values, it SHOULD treat XMPP priority 0 as PIDF
        priority 0 and XMPP priority 127 as PIDF priority 1, mapping
        intermediate values appropriately so that they are unique (e.g.,
        XMPP priority 1 to PIDF priority 0.007, XMPP priority 2 to PIDF
        priority 0.015, and so on up through mapping XMPP priority 126
        to PIDF priority 0.992; note that this is an example only and
        that the exact mapping is up to the implementation).

   (7)  Some implementations support custom extensions to encapsulate
        detailed information about availability; however, there is no
        need to standardize a PIDF extension for this purpose, since
        PIDF is already extensible and thus the &lt;show/&gt; element
        (qualified by the 'jabber:client' namespace) can be included
        directly in the PIDF XML.  The examples in this document
        illustrate this usage, which is RECOMMENDED.  The most useful
        values are likely "away" and "dnd", although note that the
        latter value merely means "busy" and does not imply that a
        server or client ought to block incoming traffic while the user



<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


        is in that state.  Naturally, a gateway can choose to translate
        a custom extension into an established value of the &lt;show/&gt;
        element [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>] or translate a &lt;show/&gt; element into a custom
        extension that the gateway knows is supported by the user agent
        of the intended recipient.  Unfortunately, this behavior does
        not guarantee that information will not be lost; to help prevent
        information loss, a gateway ought to include both the &lt;show/&gt;
        element and the custom extension if the gateway cannot suitably
        translate the custom value into a &lt;show/&gt; value.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20SIP%20to%20XMPP"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  SIP to XMPP</span>

   When Romeo changes his presence, his SIP user agent generates a SIP
   NOTIFY request for any active subscriptions.  The syntax of the
   NOTIFY request is defined in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>].  The following is an example
   of such a request:

   Example 19: SIP User Sends Presence Notification

   |  NOTIFY sip:192.0.2.1 SIP/2.0
   |  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=yt66
   |  To: &lt;sip:juliet@example.com&gt;;tag=bi54
   |  Contact: &lt;sip:romeo@example.net&gt;;gr=orchard
   |  Call-ID: C33C6C9D-0F4A-42F9-B95C-7CE86B526B5B
   |  Event: presence
   |  Subscription-State: active;expires=499
   |  Max-Forwards: 70
   |  CSeq: 8775 NOTIFY
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Content-Type: application/pidf+xml
   |  Content-Length: 193
   |
   |  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
   |  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
   |            entity='pres:romeo@example.net'&gt;
   |    &lt;tuple id='ID-orchard'&gt;
   |      &lt;status&gt;
   |        &lt;basic&gt;closed&lt;/basic&gt;
   |      &lt;/status&gt;
   |    &lt;/tuple&gt;
   |  &lt;/presence&gt;









<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   Upon receiving the NOTIFY, the SIP server needs to determine the
   identity of the domain portion of the Request-URI or To header, which
   it does by following the procedures discussed in [<a href="rfc7247.html" title='"Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Architecture, Addresses, and Error Handling"'>RFC7247</a>].  If the
   domain is an XMPP domain, the SIP server will hand off the NOTIFY to
   an associated SIP-to-XMPP gateway or connection manager that natively
   communicates with XMPP servers.

   The SIP-to-XMPP gateway is then responsible for translating the
   NOTIFY into an XMPP &lt;presence/&gt; stanza addressed from the SIP user to
   the XMPP user:

   Example 20: XMPP Transformation of SIP Presence Notification

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com/balcony'
   |            type='unavailable'/&gt;

   The mapping of SIP syntax elements to XMPP syntax elements SHOULD be
   as shown in the following table.  (Mappings for elements not
   mentioned are undefined.)

        +---------------------------+-----------------------------+
        |  SIP Header or PIDF Data  |  XMPP Element or Attribute  |
        +---------------------------+-----------------------------+
        |  basic status             |  type (1)                   |
        +---------------------------+-----------------------------+
        |  Content-Language         |  xml:lang                   |
        +---------------------------+-----------------------------+
        |  CSeq                     |  id (2)                     |
        +---------------------------+-----------------------------+
        |  From                     |  from                       |
        +---------------------------+-----------------------------+
        |  priority for tuple       |  &lt;priority/&gt; (3)            |
        +---------------------------+-----------------------------+
        |  To                       |  to                         |
        +---------------------------+-----------------------------+
        |  &lt;note/&gt;                  |  &lt;status/&gt;                  |
        +---------------------------+-----------------------------+
        |  &lt;show/&gt;                  |  &lt;show/&gt; (4)                |
        +---------------------------+-----------------------------+

             Table 2: Presence Syntax Mapping from SIP to XMPP









<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   Note the following regarding these mappings:

   (1)  A PIDF basic status of "open" SHOULD be mapped to no 'type'
        attribute, and a PIDF basic status of "closed" SHOULD be mapped
        to a 'type' attribute whose value is "unavailable".

   (2)  This mapping is OPTIONAL.

   (3)  See the notes following Table 1 of this document regarding
        mapping of presence priority.

   (4)  If a SIP implementation supports the &lt;show/&gt; element (qualified
        by the 'jabber:client' namespace) as a PIDF extension for
        availability status as described in the notes following Table 1
        of this document, the SIP-to-XMPP gateway is responsible for
        including that element in the XMPP presence notification.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Requests%20for%20Presence%20Information"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Requests for Presence Information</span>

   Both SIP and XMPP provide methods for requesting presence information
   about another entity.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20XMPP%20to%20SIP"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  XMPP to SIP</span>

   In XMPP, a request for presence information is completed by sending a
   &lt;presence/&gt; stanza of type "probe":

   Example 21: XMPP Server Sends Presence Probe on Behalf of XMPP User

   |  &lt;presence from='juliet@example.com/chamber'
   |            to='romeo@example.net'
   |            type='probe'/&gt;

      Note: As described in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>], presence probes are used by XMPP
      servers to request presence on behalf of XMPP users; XMPP clients
      are discouraged from sending presence probes, since retrieving
      presence is a service that servers provide.














<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   An XMPP-to-SIP gateway would transform the presence probe into its
   SIP equivalent, which is a SUBSCRIBE request with an Expires header
   value of zero:

   Example 22: SIP Transformation of XMPP Presence Probe

   |  SUBSCRIBE sip:romeo@example.net SIP/2.0
   |  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bKna998sk
   |  From: &lt;sip:juliet@example.com&gt;;tag=ffd2
   |  Call-ID: 5BCF940D-793D-43F8-8972-218F7F4EAA8C
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 123 SUBSCRIBE
   |  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
   |  Accept: application/pidf+xml
   |  Expires: 0
   |  Content-Length: 0

   As described in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>], this cancels any subscription but causes a
   NOTIFY to be sent to the subscriber, just as a presence probe does
   (the transformation rules for presence notifications have been
   previously described in <a href="#section-5.2">Section 5.2</a> of this document).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20SIP%20to%20XMPP"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  SIP to XMPP</span>

   In SIP, a request for presence information is effectively completed
   by sending a SUBSCRIBE with an Expires header value of zero:

   Example 23: SIP User Sends Presence Request

   |  SUBSCRIBE sip:juliet@example.com SIP/2.0
   |  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
   |  From: &lt;sip:romeo@example.net&gt;;tag=yt66
   |  Call-ID: 717B1B84-F080-4F12-9F44-0EC1ADE767B9
   |  Event: presence
   |  Max-Forwards: 70
   |  CSeq: 8775 SUBSCRIBE
   |  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
   |  Expires: 0
   |  Content-Length: 0











<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   When honoring the long-lived semantics of an XMPP presence
   subscription, a presence-aware SIP-to-XMPP gateway SHOULD translate
   such a SIP request into a &lt;presence/&gt; stanza of type "probe" if it
   does not already have presence information about the contact:

   Example 24: XMPP Transformation of SIP Presence Request

   |  &lt;presence from='romeo@example.net'
   |            to='juliet@example.com'
   |            type='probe'/&gt;

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security Considerations</span>

   Detailed security considerations for presence protocols are given in
   [<a href="rfc2779.html" title='"Instant Messaging / Presence Protocol Requirements"'>RFC2779</a>], for SIP-based presence in [<a href="rfc3856.html" title='"A Presence Event Package for the Session Initiation Protocol (SIP)"'>RFC3856</a>] (see also [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>]),
   and for XMPP-based presence in [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>] (see also [<a href="rfc6120.html" title='"Extensible Messaging and Presence Protocol (XMPP): Core"'>RFC6120</a>]).

   The mismatch between long-lived XMPP presence subscriptions and
   short-lived SIP presence subscriptions introduces the possibility of
   an amplification attack launched from the XMPP network against a SIP
   presence server (since each long-lived XMPP presence subscription
   would typically result in multiple subscription refresh requests on
   the SIP side of a gateway).  Therefore, access to an XMPP-to-SIP
   gateway SHOULD be restricted in various ways; among other things,
   only an XMPP service that carefully controls account provisioning and
   provides effective methods for the administrators to control the
   behavior of registered users ought to host such a gateway (e.g., not
   a service that offers open account registration), and a gateway ought
   to be associated only with a single domain or trust realm (e.g., a
   gateway hosted at simple.example.com ought to allow only users within
   the example.com domain to access the gateway, not users within
   example.org, example.net, or any other domain).  If a SIP presence
   server receives communications through an XMPP-to-SIP gateway from
   users who are not associated with a domain that is so related to the
   hostname of the gateway, it SHOULD (based on local service
   provisioning) refuse to service such users or refuse to receive
   traffic from the gateway.  As a further check, whenever an XMPP-to-
   SIP gateway seeks to refresh an XMPP user's long-lived subscription
   to a SIP user's presence, it MUST first send an XMPP &lt;presence/&gt;
   stanza of type "probe" from the address of the gateway to the "bare
   Jabber ID (JID)" (user@domain.tld) of the XMPP user, to which the
   user's XMPP server MUST respond in accordance with [<a href="rfc6121.html" title='"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"'>RFC6121</a>]; this
   puts an equal burden on the XMPP server and the SIP server.








<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
              June 2002.

   [<a id="ref-RFC3856" name="ref-RFC3856">RFC3856</a>]  Rosenberg, J., "A Presence Event Package for the Session
              Initiation Protocol (SIP)", <a href="rfc3856.html">RFC 3856</a>, August 2004.

   [<a id="ref-RFC3863" name="ref-RFC3863">RFC3863</a>]  Sugano, H., Fujimoto, S., Klyne, G., Bateman, A., Carr,
              W., and J. Peterson, "Presence Information Data Format
              (PIDF)", <a href="rfc3863.html">RFC 3863</a>, August 2004.

   [<a id="ref-RFC6120" name="ref-RFC6120">RFC6120</a>]  Saint-Andre, P., "Extensible Messaging and Presence
              Protocol (XMPP): Core", <a href="rfc6120.html">RFC 6120</a>, March 2011.

   [<a id="ref-RFC6121" name="ref-RFC6121">RFC6121</a>]  Saint-Andre, P., "Extensible Messaging and Presence
              Protocol (XMPP): Instant Messaging and Presence",
              <a href="rfc6121.html">RFC 6121</a>, March 2011.

   [<a id="ref-RFC6665" name="ref-RFC6665">RFC6665</a>]  Roach, A., "SIP-Specific Event Notification", <a href="rfc6665.html">RFC 6665</a>,
              July 2012.

   [<a id="ref-RFC7247" name="ref-RFC7247">RFC7247</a>]  Saint-Andre, P., Houri, A., and J. Hildebrand,
              "Interworking between the Session Initiation Protocol
              (SIP) and the Extensible Messaging and Presence Protocol
              (XMPP): Architecture, Addresses, and Error Handling",
              <a href="rfc7247.html">RFC 7247</a>, May 2014.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-RFC2778" name="ref-RFC2778">RFC2778</a>]  Day, M., Rosenberg, J., and H. Sugano, "A Model for
              Presence and Instant Messaging", <a href="rfc2778.html">RFC 2778</a>, February 2000.

   [<a id="ref-RFC2779" name="ref-RFC2779">RFC2779</a>]  Day, M., Aggarwal, S., Mohr, G., and J. Vincent, "Instant
              Messaging / Presence Protocol Requirements", <a href="rfc2779.html">RFC 2779</a>,
              February 2000.

   [<a id="ref-RFC3860" name="ref-RFC3860">RFC3860</a>]  Peterson, J., "Common Profile for Instant Messaging
              (CPIM)", <a href="rfc3860.html">RFC 3860</a>, August 2004.





<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


   [<a id="ref-RFC3922" name="ref-RFC3922">RFC3922</a>]  Saint-Andre, P., "Mapping the Extensible Messaging and
              Presence Protocol (XMPP) to Common Presence and Instant
              Messaging (CPIM)", <a href="rfc3922.html">RFC 3922</a>, October 2004.

   [<a id="ref-RFC4480" name="ref-RFC4480">RFC4480</a>]  Schulzrinne, H., Gurbani, V., Kyzivat, P., and J.
              Rosenberg, "RPID: Rich Presence Extensions to the Presence
              Information Data Format (PIDF)", <a href="rfc4480.html">RFC 4480</a>, July 2006.

   [<a id="ref-SIMPLE-CPIM-MAPPING" name="ref-SIMPLE-CPIM-MAPPING">SIMPLE-CPIM-MAPPING</a>]
              Campbell, B. and J. Rosenberg, "CPIM Mapping of SIMPLE
              Presence and Instant Messaging", Work in Progress,
              June 2002.

   [<a id="ref-XEP-0107" name="ref-XEP-0107">XEP-0107</a>] Saint-Andre, P. and R. Meijer, "User Mood", XSF XEP 0107,
              October 2008, &lt;<a href="http://xmpp.org/extensions/xep-0107.html">http://xmpp.org/extensions/xep-0107.html</a>&gt;.

   [<a id="ref-XEP-0108" name="ref-XEP-0108">XEP-0108</a>] Meijer, R. and P. Saint-Andre, "User Activity",
              XSF XEP 0108, October 2008,
              &lt;<a href="http://xmpp.org/extensions/xep-0108.html">http://xmpp.org/extensions/xep-0108.html</a>&gt;.
































<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Acknowledgements"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Acknowledgements</span>

   The authors wish to thank the following individuals for their
   feedback: Chris Christou, Fabio Forno, Adrian Georgescu, Philipp
   Hancke, Saul Ibarra Corretge, Markus Isomaki, Olle Johansson, Paul
   Kyzivat, Salvatore Loreto, Michael Lundberg, Daniel-Constantin
   Mierla, and Tory Patnoe.

   Dave Crocker provided helpful and detailed feedback on behalf of the
   Applications Area Directorate.

   Ben Laurie performed a review on behalf of the Security Directorate,
   resulting in improvements to the security considerations.

   During IESG review, Pete Resnick caught several oversights in the
   document with regard to interoperability.

   The authors gratefully acknowledge the assistance of Markus Isomaki
   and Yana Stamcheva as the working group chairs and Gonzalo Camarillo
   as the sponsoring Area Director.

   Some text in this document was borrowed from [<a href="rfc3922.html" title='"Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM)"'>RFC3922</a>].

   Peter Saint-Andre wishes to acknowledge Cisco Systems, Inc., for
   employing him during his work on earlier versions of this document.


























<span class="grey">Saint-Andre, et al.          Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc7248.html">RFC 7248</a>             SIP-XMPP Interworking: Presence            May 2014</span>


Authors' Addresses

   Peter Saint-Andre
   &amp;yet

   EMail: ietf@stpeter.im


   Avshalom Houri
   IBM
   Rorberg Building, Pekris 3
   Rehovot  76123
   Israel

   EMail: avshalom@il.ibm.com


   Joe Hildebrand
   Cisco Systems, Inc.
   1899 Wynkoop Street, Suite 600
   Denver, CO  80202
   USA

   EMail: jhildebr@cisco.com



























Saint-Andre, et al.          Standards Track                   [Page 30]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.127, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7248 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Aug 2018 14:05:01 GMT --></html>