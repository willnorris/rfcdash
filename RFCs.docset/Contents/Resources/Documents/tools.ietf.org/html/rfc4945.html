<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc4945 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:38 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:4945" name="DC.Identifier"/>
<meta content="The Internet Key Exchange (IKE) and Public Key Infrastructure for
X.509 (PKIX) certificate profile both provide frameworks that must be
profiled for use in a given application. This document provides a
profile of IKE and PKIX that defines the requirements for using PKI
technology in the context of IKE/IPsec. The document complements
protocol specifications such as IKEv1 and IKEv2, which assume the
existence of public key certificates and related keying materials, but
which do not address PKI issues explicitly. This document addresses
those issues. The intended audience is implementers of PKI for IPsec.
[STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Brian Korver &lt;briank@networkresonance.com&gt;" name="DC.Creator"/>
<meta content="August, 2007" name="DC.Date.Issued"/>
<meta content="The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 4945 - The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4945.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4945" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-pki4ipsec-ikecert-profile" title="draft-ietf-pki4ipsec-ikecert-profile">draft-ietf-pki4...</a>] [<a href="https://datatracker.ietf.org/doc/rfc4945" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4945" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4945" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                          B. Korver
Request for Comments: 4945                       Network Resonance, Inc.
Category: Standards Track                                    August 2007


 <span class="h1">The Internet IP Security PKI Profile of IKEv1/ISAKMP, IKEv2, and PKIX</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   The Internet Key Exchange (IKE) and Public Key Infrastructure for
   X.509 (PKIX) certificate profile both provide frameworks that must be
   profiled for use in a given application.  This document provides a
   profile of IKE and PKIX that defines the requirements for using PKI
   technology in the context of IKE/IPsec.  The document complements
   protocol specifications such as IKEv1 and IKEv2, which assume the
   existence of public key certificates and related keying materials,
   but which do not address PKI issues explicitly.  This document
   addresses those issues.  The intended audience is implementers of PKI
   for IPsec.




















<span class="grey">Korver                      Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terms and Definitions ...........................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Use of Certificates in <a href="rfc2401.html">RFC 2401</a> and IKEv1/ISAKMP ................<a href="#page-5">5</a>
      <a href="#section-3.1">3.1</a>. Identification Payload .....................................<a href="#page-5">5</a>
           <a href="#section-3.1.1">3.1.1</a>. ID_IPV4_ADDR and ID_IPV6_ADDR .......................<a href="#page-7">7</a>
           <a href="#section-3.1.2">3.1.2</a>. ID_FQDN .............................................<a href="#page-9">9</a>
           <a href="#section-3.1.3">3.1.3</a>. ID_USER_FQDN .......................................<a href="#page-10">10</a>
           3.1.4. ID_IPV4_ADDR_SUBNET, ID_IPV6_ADDR_SUBNET,
                  ID_IPV4_ADDR_RANGE, ID_IPV6_ADDR_RANGE .............<a href="#page-11">11</a>
           <a href="#section-3.1.5">3.1.5</a>. ID_DER_ASN1_DN .....................................<a href="#page-11">11</a>
           <a href="#section-3.1.6">3.1.6</a>. ID_DER_ASN1_GN .....................................<a href="#page-12">12</a>
           <a href="#section-3.1.7">3.1.7</a>. ID_KEY_ID ..........................................<a href="#page-12">12</a>
           <a href="#section-3.1.8">3.1.8</a>. Selecting an Identity from a Certificate ...........<a href="#page-12">12</a>
           <a href="#section-3.1.9">3.1.9</a>. Subject for DN Only ................................<a href="#page-12">12</a>
           <a href="#section-3.1.10">3.1.10</a>. Binding Identity to Policy ........................<a href="#page-13">13</a>
      <a href="#section-3.2">3.2</a>. Certificate Request Payload ...............................<a href="#page-13">13</a>
           <a href="#section-3.2.1">3.2.1</a>. Certificate Type ...................................<a href="#page-14">14</a>
           <a href="#section-3.2.2">3.2.2</a>. X.509 Certificate - Signature ......................<a href="#page-14">14</a>
           <a href="#section-3.2.3">3.2.3</a>. Revocation Lists (CRL and ARL) .....................<a href="#page-14">14</a>
           <a href="#section-3.2.4">3.2.4</a>. PKCS #7 wrapped X.509 certificate ..................<a href="#page-15">15</a>
           <a href="#section-3.2.5">3.2.5</a>. Location of Certificate Request Payloads ...........<a href="#page-15">15</a>
           3.2.6. Presence or Absence of Certificate Request
                  Payloads ...........................................<a href="#page-15">15</a>
           <a href="#section-3.2.7">3.2.7</a>. Certificate Requests ...............................<a href="#page-15">15</a>
           <a href="#section-3.2.8">3.2.8</a>. Robustness .........................................<a href="#page-18">18</a>
           <a href="#section-3.2.9">3.2.9</a>. Optimizations ......................................<a href="#page-18">18</a>
      <a href="#section-3.3">3.3</a>. Certificate Payload .......................................<a href="#page-19">19</a>
           <a href="#section-3.3.1">3.3.1</a>. Certificate Type ...................................<a href="#page-20">20</a>
           <a href="#section-3.3.2">3.3.2</a>. X.509 Certificate - Signature ......................<a href="#page-20">20</a>
           <a href="#section-3.3.3">3.3.3</a>. Revocation Lists (CRL and ARL) .....................<a href="#page-20">20</a>
           <a href="#section-3.3.4">3.3.4</a>. PKCS #7 Wrapped X.509 Certificate ..................<a href="#page-20">20</a>
           <a href="#section-3.3.5">3.3.5</a>. Location of Certificate Payloads ...................<a href="#page-21">21</a>
           <a href="#section-3.3.6">3.3.6</a>. Certificate Payloads Not Mandatory .................<a href="#page-21">21</a>
           3.3.7. Response to Multiple Certification
                  Authority Proposals ................................<a href="#page-21">21</a>
           <a href="#section-3.3.8">3.3.8</a>. Using Local Keying Materials .......................<a href="#page-21">21</a>
           <a href="#section-3.3.9">3.3.9</a>. Multiple End-Entity Certificates ...................<a href="#page-22">22</a>
           <a href="#section-3.3.10">3.3.10</a>. Robustness ........................................<a href="#page-22">22</a>
           <a href="#section-3.3.11">3.3.11</a>. Optimizations .....................................<a href="#page-23">23</a>
   <a href="#section-4">4</a>. Use of Certificates in <a href="rfc4301.html">RFC 4301</a> and IKEv2 ......................<a href="#page-24">24</a>
      <a href="#section-4.1">4.1</a>. Identification Payload ....................................<a href="#page-24">24</a>
      <a href="#section-4.2">4.2</a>. Certificate Request Payload ...............................<a href="#page-24">24</a>
           <a href="#section-4.2.1">4.2.1</a>. Revocation Lists (CRL and ARL) .....................<a href="#page-24">24</a>
      <a href="#section-4.3">4.3</a>. Certificate Payload .......................................<a href="#page-25">25</a>
           <a href="#section-4.3.1">4.3.1</a>. IKEv2's Hash and URL of X.509 Certificate ..........<a href="#page-25">25</a>
           <a href="#section-4.3.2">4.3.2</a>. Location of Certificate Payloads ...................<a href="#page-25">25</a>



<span class="grey">Korver                      Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


           <a href="#section-4.3.3">4.3.3</a>. Ordering of Certificate Payloads ...................<a href="#page-25">25</a>
   <a href="#section-5">5</a>. Certificate Profile for IKEv1/ISAKMP and IKEv2 .................<a href="#page-26">26</a>
      <a href="#section-5.1">5.1</a>. X.509 Certificates ........................................<a href="#page-26">26</a>
           <a href="#section-5.1.1">5.1.1</a>. Versions ...........................................<a href="#page-26">26</a>
           <a href="#section-5.1.2">5.1.2</a>. Subject ............................................<a href="#page-26">26</a>
           <a href="#section-5.1.3">5.1.3</a>. X.509 Certificate Extensions .......................<a href="#page-27">27</a>
      <a href="#section-5.2">5.2</a>. X.509 Certificate Revocation Lists ........................<a href="#page-33">33</a>
           5.2.1. Multiple Sources of Certificate Revocation
                  Information ........................................<a href="#page-34">34</a>
           <a href="#section-5.2.2">5.2.2</a>. X.509 Certificate Revocation List Extensions .......<a href="#page-34">34</a>
      <a href="#section-5.3">5.3</a>. Strength of Signature Hashing Algorithms ..................<a href="#page-35">35</a>
   <a href="#section-6">6</a>. Configuration Data Exchange Conventions ........................<a href="#page-36">36</a>
      <a href="#section-6.1">6.1</a>. Certificates ..............................................<a href="#page-36">36</a>
      <a href="#section-6.2">6.2</a>. CRLs and ARLs .............................................<a href="#page-37">37</a>
      <a href="#section-6.3">6.3</a>. Public Keys ...............................................<a href="#page-37">37</a>
      <a href="#section-6.4">6.4</a>. PKCS#10 Certificate Signing Requests ......................<a href="#page-37">37</a>
   <a href="#section-7">7</a>. Security Considerations ........................................<a href="#page-37">37</a>
      <a href="#section-7.1">7.1</a>. Certificate Request Payload ...............................<a href="#page-37">37</a>
      <a href="#section-7.2">7.2</a>. IKEv1 Main Mode ...........................................<a href="#page-37">37</a>
      <a href="#section-7.3">7.3</a>. Disabling Certificate Checks ..............................<a href="#page-38">38</a>
   <a href="#section-8">8</a>. Acknowledgements ...............................................<a href="#page-38">38</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-38">38</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-38">38</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-39">39</a>
   <a href="#appendix-A">Appendix A</a>. The Possible Dangers of Delta CRLs ....................<a href="#page-40">40</a>
   <a href="#appendix-B">Appendix B</a>. More on Empty CERTREQs ................................<a href="#page-40">40</a>

























<span class="grey">Korver                      Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   IKE [<a href="#ref-1" title='"The Internet Key Exchange (IKE)"'>1</a>], ISAKMP [<a href="#ref-2" title='"Internet Security Association and Key Management Protocol (ISAKMP)"'>2</a>], and IKEv2 [<a href="#ref-3" title='"Internet Key Exchange (IKEv2) Protocol"'>3</a>] provide a secure key exchange
   mechanism for use with IPsec [<a href="#ref-4" title='"Security Architecture for the Internet Protocol"'>4</a>] [<a href="#ref-14" title='"Security Architecture for the Internet Protocol"'>14</a>].  In many cases, the peers
   authenticate using digital certificates as specified in PKIX [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>].
   Unfortunately, the combination of these standards leads to an
   underspecified set of requirements for the use of certificates in the
   context of IPsec.

   ISAKMP references the PKIX certificate profile but, in many cases,
   merely specifies the contents of various messages without specifying
   their syntax or semantics.  Meanwhile, the PKIX certificate profile
   provides a large set of certificate mechanisms that are generally
   applicable for Internet protocols, but little specific guidance for
   IPsec.  Given the numerous underspecified choices, interoperability
   is hampered if all implementers do not make similar choices, or at
   least fail to account for implementations that have chosen
   differently.

   This profile of the IKE and PKIX frameworks is intended to provide an
   agreed-upon standard for using PKI technology in the context of IPsec
   by profiling the PKIX framework for use with IKE and IPsec, and by
   documenting the contents of the relevant IKE payloads and further
   specifying their semantics.

   In addition to providing a profile of IKE and PKIX, this document
   attempts to incorporate lessons learned from recent experience with
   both implementation and deployment, as well as the current state of
   related protocols and technologies.

   Material from ISAKMP, IKEv1, IKEv2, or PKIX is not repeated here, and
   readers of this document are assumed to have read and understood
   those documents.  The requirements and security aspects of those
   documents are fully relevant to this document as well.

   This document is organized as follows.  <a href="#section-2">Section 2</a> defines special
   terminology used in the rest of this document, <a href="#section-3">Section 3</a> provides the
   profile of IKEv1/ISAKMP, <a href="#section-4">Section 4</a> provides a profile of IKEv2, and
   <a href="#section-5">Section 5</a> provides the profile of PKIX.  <a href="#section-6">Section 6</a> covers conventions
   for the out-of-band exchange of keying materials for configuration
   purposes.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terms%20and%20Definitions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terms and Definitions</span>

   Except for those terms that are defined immediately below, all terms
   used in this document are defined in either the PKIX [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>], ISAKMP [<a href="#ref-2" title='"Internet Security Association and Key Management Protocol (ISAKMP)"'>2</a>],
   IKEv1 [<a href="#ref-1" title='"The Internet Key Exchange (IKE)"'>1</a>], IKEv2 [<a href="#ref-3" title='"Internet Key Exchange (IKEv2) Protocol"'>3</a>], or Domain of Interpretation (DOI) [<a href="#ref-6" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>6</a>]
   documents.



<span class="grey">Korver                      Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   o  Peer source address: The source address in packets from a peer.
      This address may be different from any addresses asserted as the
      "identity" of the peer.

   o  FQDN: Fully qualified domain name.

   o  ID_USER_FQDN: IKEv2 renamed ID_USER_FQDN to ID_RFC822_ADDR.  Both
      are referred to as ID_USER_FQDN in this document.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="#ref-7" title='"Key words for use in RFCs to Indicate Requirement Levels"'>7</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Use%20of%20Certificates%20in%20RFC%202401%20and%20IKEv1%2FISAKMP"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Use of Certificates in <a href="rfc2401.html">RFC 2401</a> and IKEv1/ISAKMP</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Identification%20Payload"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Identification Payload</span>

   The Identification (ID) Payload indicates the identity claimed by the
   sender.  The recipient can then use the ID as a lookup key for policy
   and for certificate lookup in whatever certificate store or directory
   that it has available.  Our primary concern in this section is to
   profile the ID payload so that it can be safely used to generate or
   lookup policy.  IKE mandates the use of the ID payload in Phase 1.

   The DOI [<a href="#ref-6" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>6</a>] defines the 11 types of Identification Data that can be
   used and specifies the syntax for these types.  These are discussed
   below in detail.

   The ID payload requirements in this document cover only the portion
   of the explicit policy checks that deal with the Identification
   Payload specifically.  For instance, in the case where ID does not
   contain an IP address, checks such as verifying that the peer source
   address is permitted by the relevant policy are not addressed here,
   as they are out of the scope of this document.

   Implementations SHOULD populate ID with identity information that is
   contained within the end-entity certificate.  Populating ID with
   identity information from the end-entity certificate enables
   recipients to use ID as a lookup key to find the peer end-entity
   certificate.  The only case where implementations may populate ID
   with information that is not contained in the end-entity certificate
   is when ID contains the peer source address (a single address, not a
   subnet or range).

   Because implementations may use ID as a lookup key to determine which
   policy to use, all implementations MUST be especially careful to
   verify the truthfulness of the contents by verifying that they
   correspond to some keying material demonstrably held by the peer.



<span class="grey">Korver                      Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   Failure to do so may result in the use of an inappropriate or
   insecure policy.  The following sections describe the methods for
   performing this binding.

   The following table summarizes the binding of the Identification
   Payload to the contents of end-entity certificates and of identity
   information to policy.  Each ID type is covered more thoroughly in
   the following sections.

   ID type  | Support  | Correspond  | Cert     | SPD lookup
            | for send | PKIX Attrib | matching | rules
   -------------------------------------------------------------------
            |          |             |          |
   IP*_ADDR | MUST [<a href="#ref-a">a</a>] | SubjAltName | MUST [<a href="#ref-b" title="with no other lookup. The matched ID MAY be used for Security Policy Database (SPD) lookup">b</a>] | [<a href="#ref-c">c</a>], [<a href="#ref-d">d</a>]
            |          | iPAddress   |          |
            |          |             |          |
   FQDN     | MUST [<a href="#ref-a">a</a>] | SubjAltName | MUST [<a href="#ref-b" title="with no other lookup. The matched ID MAY be used for Security Policy Database (SPD) lookup">b</a>] | [<a href="#ref-c">c</a>], [<a href="#ref-d">d</a>]
            |          | dNSName     |          |
            |          |             |          |
   USER_FQDN| MUST [<a href="#ref-a">a</a>] | SubjAltName | MUST [<a href="#ref-b" title="with no other lookup. The matched ID MAY be used for Security Policy Database (SPD) lookup">b</a>] | [<a href="#ref-c">c</a>], [<a href="#ref-d">d</a>]
            |          | rfc822Name  |          |
            |          |             |          |
   IP range | MUST NOT | n/a         | n/a      | n/a
            |          |             |          |
   DN       | MUST [<a href="#ref-a">a</a>] | Entire      | MUST [<a href="#ref-b" title="with no other lookup. The matched ID MAY be used for Security Policy Database (SPD) lookup">b</a>] | MUST support lookup
            |          | Subject,    |          | on any combination
            |          | bitwise     |          | of C, CN, O, or OU
            |          | compare     |          |
            |          |             |          |
   GN       | MUST NOT | n/a         | n/a      | n/a
            |          |             |          |
   KEY_ID   | MUST NOT | n/a         | n/a      | n/a
            |          |             |          |

   [<a id="ref-a" name="ref-a">a</a>] = Implementation MUST have the configuration option to send this
         ID type in the ID payload.  Whether or not the ID type is used
         is a matter of local configuration.

   [<a id="ref-b" name="ref-b">b</a>] = The ID in the ID payload MUST match the contents of the
         corresponding field (listed) in the certificate exactly, with
         no other lookup.  The matched ID MAY be used for Security
         Policy Database (SPD) lookup, but is not required to be used
         for this.

   [<a id="ref-c" name="ref-c">c</a>] = At a minimum, Implementation MUST be capable of being
         configured to perform exact matching of the ID payload contents
         to an entry in the local SPD.




<span class="grey">Korver                      Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   [<a id="ref-d" name="ref-d">d</a>] = In addition, the implementation MAY also be configurable to
         perform substring or wildcard matches of ID payload contents to
         entries in the local SPD.  (More on this in <a href="#section-3.1.5">Section 3.1.5</a>.)

   When sending an IPV4_ADDR, IPV6_ADDR, FQDN, or USER_FQDN,
   implementations MUST be able to be configured to send the same string
   as it appears in the corresponding SubjectAltName extension.  This
   document RECOMMENDS that deployers use this configuration option.
   All these ID types are treated the same: as strings that can be
   compared easily and quickly to a corresponding string in an explicit
   value in the certificate.  Of these types, FQDN and USER_FQDN are
   RECOMMENDED over IP addresses (see discussion in <a href="#section-3.1.1">Section 3.1.1</a>).

   When sending a Distinguished Name (DN) as ID, implementations MUST
   send the entire DN in ID.  Also, implementations MUST support at
   least the C, CN, O, and OU attributes for SPD matching.  See <a href="#section-3.1.5">Section</a>
   <a href="#section-3.1.5">3.1.5</a> for more details about DN, including SPD matching.

   Recipients MUST be able to perform SPD matching on the exact contents
   of the ID, and this SHOULD be the default setting.  In addition,
   implementations MAY use substrings or wildcards in local policy
   configuration to do the SPD matching against the ID contents.  In
   other words, implementations MUST be able to do exact matches of ID
   to SPD, but MAY also be configurable to do substring or wildcard
   matches of ID to SPD.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20%20ID_IPV4_ADDR%20and%20ID_IPV6_ADDR"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>.  ID_IPV4_ADDR and ID_IPV6_ADDR</span>

   Implementations MUST support at least the ID_IPV4_ADDR or
   ID_IPV6_ADDR ID type, depending on whether the implementation
   supports IPv4, IPv6, or both.  These addresses MUST be encoded in
   "network byte order", as specified in IP [<a href="#ref-8" title='"Internet Protocol"'>8</a>]: The least significant
   bit (LSB) of each octet is the LSB of the corresponding byte in the
   network address.  For the ID_IPV4_ADDR type, the payload MUST contain
   exactly four octets [<a href="#ref-8" title='"Internet Protocol"'>8</a>].  For the ID_IPV6_ADDR type, the payload MUST
   contain exactly sixteen octets [<a href="#ref-10" title='"Internet Protocol, Version 6 (IPv6) Specification"'>10</a>].

   Implementations SHOULD NOT populate ID payload with IP addresses due
   to interoperability issues such as problems with Network Address
   Translator (NAT) traversal, and problems with IP verification
   behavior.

   Deployments may only want to consider using the IP address as ID if
   all of the following are true:

   o  the peer's IP address is static, not dynamically changing

   o  the peer is NOT behind a NAT'ing device



<span class="grey">Korver                      Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   o  the administrator intends the implementation to verify that the
      peer source address matches the IP address in the ID received, and
      that in the iPAddress field in the peer certificate's
      SubjectAltName extension.

   Implementations MUST be capable of verifying that the IP address
   presented in ID matches via bitwise comparison the IP address present
   in the certificate's iPAddress field of the SubjectAltName extension.
   Implementations MUST perform this verification by default.  When
   comparing the contents of ID with the iPAddress field in the
   SubjectAltName extension for equality, binary comparison MUST be
   performed.  Note that certificates may contain multiple address
   identity types -- in which case, at least one must match the source
   IP.  If the default is enabled, then a mismatch between the two
   addresses MUST be treated as an error, and security association setup
   MUST be aborted.  This event SHOULD be auditable.  Implementations
   MAY provide a configuration option to (i.e., local policy
   configuration can enable) skip that verification step, but that
   option MUST be off by default.  We include the "option-to-skip-
   validation" in order to permit better interoperability as current
   implementations vary greatly in how they behave on this topic.

   In addition, implementations MUST be capable of verifying that the
   address contained in the ID is the same as the address contained in
   the IP header.  Implementations SHOULD be able to check the address
   in either the outermost or innermost IP header and MAY provide a
   configuration option for specifying which is to be checked.  If there
   is no configuration option provided, an implementation SHOULD check
   the peer source address contained in the outermost header (as is the
   practice of most of today's implementations).  If ID is one of the IP
   address types, then implementations MUST perform this verification by
   default.  If this default is enabled, then a mismatch MUST be treated
   as an error, and security association setup MUST be aborted.  This
   event SHOULD be auditable.  Implementations MAY provide a
   configuration option to (i.e. local policy configuration can enable)
   skip that verification step, but that option MUST be off by default.
   We include the "option-to-skip-validation" in order to permit better
   interoperability, as current implementations vary greatly in how they
   behave on the topic of verification of source IP.

   If the default for both the verifications above are enabled, then, by
   transitive property, the implementation will also be verifying that
   the peer source IP address matches via a bitwise comparison the
   contents of the iPAddress field in the SubjectAltName extension in
   the certificate.  In addition, implementations MAY allow
   administrators to configure a local policy that explicitly requires
   that the peer source IP address match via a bitwise comparison the
   contents of the iPAddress field in the SubjectAltName extension in



<span class="grey">Korver                      Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   the certificate.  Implementations SHOULD allow administrators to
   configure a local policy that skips this validation check.

   Implementations MAY support substring, wildcard, or regular
   expression matching of the contents of ID to look up the policy in
   the SPD, and such would be a matter of local security policy
   configuration.

   Implementations MAY use the IP address found in the header of packets
   received from the peer to look up the policy, but such
   implementations MUST still perform verification of the ID payload.
   Although packet IP addresses are inherently untrustworthy and must
   therefore be independently verified, it is often useful to use the
   apparent IP address of the peer to locate a general class of policies
   that will be used until the mandatory identity-based policy lookup
   can be performed.

   For instance, if the IP address of the peer is unrecognized, a VPN
   gateway device might load a general "road warrior" policy that
   specifies a particular Certification Authority (CA) that is trusted
   to issue certificates that contain a valid rfc822Name, which can be
   used by that implementation to perform authorization based on access
   control lists (ACLs) after the peer's certificate has been validated.
   The rfc822Name can then be used to determine the policy that provides
   specific authorization to access resources (such as IP addresses,
   ports, and so forth).

   As another example, if the IP address of the peer is recognized to be
   a known peer VPN endpoint, policy may be determined using that
   address, but until the identity (address) is validated by validating
   the peer certificate, the policy MUST NOT be used to authorize any
   IPsec traffic.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.%20%20ID_FQDN"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a>.  ID_FQDN</span>

   Implementations MUST support the ID_FQDN ID type, generally to
   support host-based access control lists for hosts without fixed IP
   addresses.  However, implementations SHOULD NOT use the DNS to map
   the FQDN to IP addresses for input into any policy decisions, unless
   that mapping is known to be secure, for example, if DNSSEC [<a href="#ref-11" title='"DNS Security Introduction and Requirements"'>11</a>] were
   employed for that FQDN.

   If ID contains an ID_FQDN, implementations MUST be capable of
   verifying that the identity contained in the ID payload matches
   identity information contained in the peer end-entity certificate, in
   the dNSName field in the SubjectAltName extension.  Implementations
   MUST perform this verification by default.  When comparing the
   contents of ID with the dNSName field in the SubjectAltName extension



<span class="grey">Korver                      Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   for equality, case-insensitive string comparison MUST be performed.
   Note that case-insensitive string comparison works on
   internationalized domain names (IDNs) as well (See IDN [<a href="#ref-12" title='"Internationalizing Domain Names in Applications (IDNA)"'>12</a>]).
   Substring, wildcard, or regular expression matching MUST NOT be
   performed for this comparison.  If this default is enabled, then a
   mismatch MUST be treated as an error, and security association setup
   MUST be aborted.  This event SHOULD be auditable.  Implementations
   MAY provide a configuration option to (i.e., local policy
   configuration can enable) skip that verification step, but that
   option MUST be off by default.  We include the "option-to-skip-
   validation" in order to permit better interoperability, as current
   implementations vary greatly in how they behave on this topic.

   Implementations MAY support substring, wildcard, or regular
   expression matching of the contents of ID to look up the policy in
   the SPD, and such would be a matter of local security policy
   configuration.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.3.%20%20ID_USER_FQDN"></a><a class="selflink" href="#section-3.1.3" name="section-3.1.3">3.1.3</a>.  ID_USER_FQDN</span>

   Implementations MUST support the ID_USER_FQDN ID type, generally to
   support user-based access control lists for users without fixed IP
   addresses.  However, implementations SHOULD NOT use the DNS to map
   the FQDN portion to IP addresses for input into any policy decisions,
   unless that mapping is known to be secure, for example, if DNSSEC
   [<a href="#ref-11" title='"DNS Security Introduction and Requirements"'>11</a>] were employed for that FQDN.

   Implementations MUST be capable of verifying that the identity
   contained in the ID payload matches identity information contained in
   the peer end-entity certificate, in the rfc822Name field in the
   SubjectAltName extension.  Implementations MUST perform this
   verification by default.  When comparing the contents of ID with the
   rfc822Name field in the SubjectAltName extension for equality, case-
   insensitive string comparison MUST be performed.  Note that case-
   insensitive string comparison works on internationalized domain names
   (IDNs) as well (See IDN [<a href="#ref-12" title='"Internationalizing Domain Names in Applications (IDNA)"'>12</a>]).  Substring, wildcard, or regular
   expression matching MUST NOT be performed for this comparison.  If
   this default is enabled, then a mismatch MUST be treated as an error,
   and security association setup MUST be aborted.  This event SHOULD be
   auditable.  Implementations MAY provide a configuration option to
   (i.e., local policy configuration can enable) skip that verification
   step, but that option MUST be off by default.  We include the
   "option-to-skip-validation" in order to permit better
   interoperability, as current implementations vary greatly in how they
   behave on this topic.






<span class="grey">Korver                      Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   Implementations MAY support substring, wildcard, or regular
   expression matching of the contents of ID to look up policy in the
   SPD, and such would be a matter of local security policy
   configuration.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.4.%20%20ID_IPV4_ADDR_SUBNET%2C%20ID_IPV6_ADDR_SUBNET%2C%20ID_IPV4_ADDR_RANGE%2C"></a><a class="selflink" href="#section-3.1.4" name="section-3.1.4">3.1.4</a>.  ID_IPV4_ADDR_SUBNET, ID_IPV6_ADDR_SUBNET, ID_IPV4_ADDR_RANGE,</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/ID_IPV6_ADDR_RANGE"></a>        ID_IPV6_ADDR_RANGE</span>

   Note that <a href="rfc3779.html">RFC 3779</a> [<a href="#ref-13" title='"X.509 Extensions for IP Addresses and AS Identifiers"'>13</a>] defines blocks of addresses using the
   certificate extension identified by:

            id-pe-ipAddrBlock OBJECT IDENTIFIER ::= { id-pe 7 }

   although use of this extension in IKE is considered experimental at
   this time.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.5.%20%20ID_DER_ASN1_DN"></a><a class="selflink" href="#section-3.1.5" name="section-3.1.5">3.1.5</a>.  ID_DER_ASN1_DN</span>

   Implementations MUST support receiving the ID_DER_ASN1_DN ID type.
   Implementations MUST be capable of generating this type, and the
   decision to do so will be a matter of local security policy
   configuration.  When generating this type, implementations MUST
   populate the contents of ID with the Subject field from the end-
   entity certificate, and MUST do so such that a binary comparison of
   the two will succeed.  If there is not a match, this MUST be treated
   as an error, and security association setup MUST be aborted.  This
   event SHOULD be auditable.

   Implementations MUST NOT populate ID with the Subject from the end-
   entity certificate if it is empty, even though an empty certificate
   Subject is explicitly allowed in the "Subject" section of the PKIX
   certificate profile.

   Regarding SPD matching, implementations MUST be able to perform
   matching based on a bitwise comparison of the entire DN in ID to its
   entry in the SPD.  However, operational experience has shown that
   using the entire DN in local configuration is difficult, especially
   in large-scale deployments.  Therefore, implementations also MUST be
   able to perform SPD matches of any combination of one or more of the
   C, CN, O, OU attributes within Subject DN in the ID to the same in
   the SPD.  Implementations MAY support matching using additional DN
   attributes in any combination, although interoperability is far from
   certain and is dubious.  Implementations MAY also support performing
   substring, wildcard, or regular expression matches for any of its
   supported DN attributes from ID, in any combination, to the SPD.
   Such flexibility allows deployers to create one SPD entry on the
   gateway for an entire department of a company (e.g., O=Foobar Inc.,
   OU=Engineering) while still allowing them to draw out other details



<span class="grey">Korver                      Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   from the DN (e.g., CN=John Doe) for auditing purposes.  All the above
   is a matter of local implementation and local policy definition and
   enforcement capability, not bits on the wire, but will have a great
   impact on interoperability.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.6.%20%20ID_DER_ASN1_GN"></a><a class="selflink" href="#section-3.1.6" name="section-3.1.6">3.1.6</a>.  ID_DER_ASN1_GN</span>

   Implementations MUST NOT generate this type, because the recipient
   will be unlikely to know how to use it.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.7.%20%20ID_KEY_ID"></a><a class="selflink" href="#section-3.1.7" name="section-3.1.7">3.1.7</a>.  ID_KEY_ID</span>

   The ID_KEY_ID type used to specify pre-shared keys and thus is out of
   scope.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.8.%20%20Selecting%20an%20Identity%20from%20a%20Certificate"></a><a class="selflink" href="#section-3.1.8" name="section-3.1.8">3.1.8</a>.  Selecting an Identity from a Certificate</span>

   Implementations MUST support certificates that contain more than a
   single identity, such as when the Subject field and the
   SubjectAltName extension are both populated, or the SubjectAltName
   extension contains multiple identities irrespective of whether or not
   the Subject is empty.  In many cases, a certificate will contain an
   identity, such as an IP address, in the SubjectAltName extension in
   addition to a non-empty Subject.

   Implementations should populate ID with whichever identity is likely
   to be named in the peer's policy.  In practice, this generally means
   FQDN, or USER_FQDN, but this information may also be available to the
   administrator through some out-of-band means.  In the absence of such
   out-of-band configuration information, the identity with which an
   implementation chooses to populate the ID payload is a local matter.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.9.%20%20Subject%20for%20DN%20Only"></a><a class="selflink" href="#section-3.1.9" name="section-3.1.9">3.1.9</a>.  Subject for DN Only</span>

   If an FQDN is intended to be processed as an identity for the
   purposes of ID matching, it MUST be placed in the dNSName field of
   the SubjectAltName extension.  Implementations MUST NOT populate the
   Subject with an FQDN in place of populating the dNSName field of the
   SubjectAltName extension.

   While nothing prevents an FQDN, USER_FQDN, or IP address information
   from appearing somewhere in the Subject contents, such entries MUST
   NOT be interpreted as identity information for the purposes of
   matching with ID or for policy lookup.







<span class="grey">Korver                      Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.10.%20%20Binding%20Identity%20to%20Policy"></a><a class="selflink" href="#section-3.1.10" name="section-3.1.10">3.1.10</a>.  Binding Identity to Policy</span>

   In the presence of certificates that contain multiple identities,
   implementations should select the most appropriate identity from the
   certificate and populate the ID with that.  The recipient MUST use
   the identity sent as a first key when selecting the policy.  The
   recipient MUST also use the most specific policy from that database
   if there are overlapping policies caused by wildcards (or the
   implementation can de-correlate the policy database so there will not
   be overlapping entries, or it can also forbid creation of overlapping
   policies and leave the de-correlation process to the administrator,
   but, as this moves the problem to the administrator, it is NOT
   RECOMMENDED).

   For example, imagine that an implementation is configured with a
   certificate that contains both a non-empty Subject and a dNSName.
   The sender's policy may specify which of those to use, and it
   indicates the policy to the other end by sending that ID.  If the
   recipient has both a specific policy for the dNSName for this host
   and generic wildcard rule for some attributes present in the Subject
   field, it will match a different policy depending on which ID is
   sent.  As the sender knows why it wanted to connect the peer, it also
   knows what identity it should use to match the policy it needs to the
   operation it tries to perform; it is the only party who can select
   the ID adequately.

   In the event that the policy cannot be found in the recipient's SPD
   using the ID sent, then the recipient MAY use the other identities in
   the certificate when attempting to match a suitable policy.  For
   example, say the certificate contains a non-empty Subject field, a
   dNSName and an iPAddress.  If an iPAddress is sent in ID but no
   specific entry exists for the address in the policy database, the
   recipient MAY search in the policy database based on the Subject or
   the dNSName contained in the certificate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Certificate%20Request%20Payload"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Certificate Request Payload</span>

   The Certificate Request (CERTREQ) Payload allows an implementation to
   request that a peer provide some set of certificates or certificate
   revocation lists (CRLs).  It is not clear from ISAKMP exactly how
   that set should be specified or how the peer should respond.  We
   describe the semantics on both sides.









<span class="grey">Korver                      Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Certificate%20Type"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Certificate Type</span>

   The Certificate Type field identifies to the peer the type of
   certificate keying materials that are desired.  ISAKMP defines 10
   types of Certificate Data that can be requested and specifies the
   syntax for these types.  For the purposes of this document, only the
   following types are relevant:

      o  X.509 Certificate - Signature
      o  Revocation Lists (CRL and ARL)
      o  PKCS #7 wrapped X.509 certificate

   The use of the other types are out of the scope of this document:

      o  X.509 Certificate - Key Exchange
      o  PGP (Pretty Good Privacy) Certificate
      o  DNS Signed Key
      o  Kerberos Tokens
      o  SPKI (Simple Public Key Infrastructure) Certificate
      o  X.509 Certificate Attribute

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20X.509%20Certificate%20-%20Signature"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  X.509 Certificate - Signature</span>

   This type requests that the end-entity certificate be a certificate
   used for signing.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.3.%20%20Revocation%20Lists%20%28CRL%20and%20ARL%29"></a><a class="selflink" href="#section-3.2.3" name="section-3.2.3">3.2.3</a>.  Revocation Lists (CRL and ARL)</span>

   ISAKMP does not support Certificate Payload sizes over approximately
   64K, which is too small for many CRLs, and UDP fragmentation is
   likely to occur at sizes much smaller than that.  Therefore, the
   acquisition of revocation material is to be dealt with out-of-band of
   IKE.  For this and other reasons, implementations SHOULD NOT generate
   CERTREQs where the Certificate Type is "Certificate Revocation List
   (CRL)" or "Authority Revocation List (ARL)".  Implementations that do
   generate such CERTREQs MUST NOT require the recipient to respond with
   a CRL or ARL, and MUST NOT fail when not receiving any.  Upon receipt
   of such a CERTREQ, implementations MAY ignore the request.

   In lieu of exchanging revocation lists in-band, a pointer to
   revocation checking SHOULD be listed in either the
   CRLDistributionPoints (CDP) or the AuthorityInfoAccess (AIA)
   certificate extensions (see <a href="#section-5">Section 5</a> for details).  Unless other
   methods for obtaining revocation information are available,
   implementations SHOULD be able to process these attributes, and from
   them be able to identify cached revocation material, or retrieve the
   relevant revocation material from a URL, for validation processing.
   In addition, implementations MUST have the ability to configure



<span class="grey">Korver                      Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   validation checking information for each certification authority.
   Regardless of the method (CDP, AIA, or static configuration), the
   acquisition of revocation material SHOULD occur out-of-band of IKE.
   Note, however, that an inability to access revocation status data
   through out-of-band means provides a potential security vulnerability
   that could potentially be exploited by an attacker.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.4.%20%20PKCS%20%237%20wrapped%20X.509%20certificate"></a><a class="selflink" href="#section-3.2.4" name="section-3.2.4">3.2.4</a>.  PKCS #7 wrapped X.509 certificate</span>

   This ID type defines a particular encoding (not a particular
   certificate type); some current implementations may ignore CERTREQs
   they receive that contain this ID type, and the editors are unaware
   of any implementations that generate such CERTREQ messages.
   Therefore, the use of this type is deprecated.  Implementations
   SHOULD NOT require CERTREQs that contain this Certificate Type.
   Implementations that receive CERTREQs that contain this ID type MAY
   treat such payloads as synonymous with "X.509 Certificate -
   Signature".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.5.%20%20Location%20of%20Certificate%20Request%20Payloads"></a><a class="selflink" href="#section-3.2.5" name="section-3.2.5">3.2.5</a>.  Location of Certificate Request Payloads</span>

   In IKEv1 Main Mode, the CERTREQ payload MUST be in messages 4 and 5.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.6.%20%20Presence%20or%20Absence%20of%20Certificate%20Request%20Payloads"></a><a class="selflink" href="#section-3.2.6" name="section-3.2.6">3.2.6</a>.  Presence or Absence of Certificate Request Payloads</span>

   When in-band exchange of certificate keying materials is desired,
   implementations MUST inform the peer of this by sending at least one
   CERTREQ.  In other words, an implementation that does not send any
   CERTREQs during an exchange SHOULD NOT expect to receive any CERT
   payloads.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.7.%20%20Certificate%20Requests"></a><a class="selflink" href="#section-3.2.7" name="section-3.2.7">3.2.7</a>.  Certificate Requests</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.7.1.%20%20Specifying%20Certification%20Authorities"></a><a class="selflink" href="#section-3.2.7.1" name="section-3.2.7.1">3.2.7.1</a>.  Specifying Certification Authorities</span>

   When requesting in-band exchange of keying materials, implementations
   SHOULD generate CERTREQs for every peer trust anchor that local
   policy explicitly deems trusted during a given exchange.
   Implementations SHOULD populate the Certification Authority field
   with the Subject field of the trust anchor, populated such that
   binary comparison of the Subject and the Certification Authority will
   succeed.









<span class="grey">Korver                      Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   Upon receipt of a CERTREQ, implementations MUST respond by sending at
   least the end-entity certificate corresponding to the Certification
   Authority listed in the CERTREQ unless local security policy
   configuration specifies that keying materials must be exchanged out-
   of-band.  Implementations MAY send certificates other than the end-
   entity certificate (see <a href="#section-3.3">Section 3.3</a> for discussion).

   Note that, in the case where multiple end-entity certificates may be
   available that chain to different trust anchors, implementations
   SHOULD resort to local heuristics to determine which trust anchor is
   most appropriate to use for generating the CERTREQ.  Such heuristics
   are out of the scope of this document.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.7.2.%20%20Empty%20Certification%20Authority%20Field"></a><a class="selflink" href="#section-3.2.7.2" name="section-3.2.7.2">3.2.7.2</a>.  Empty Certification Authority Field</span>

   Implementations SHOULD generate CERTREQs where the Certificate Type
   is "X.509 Certificate - Signature" and where the Certification
   Authority field is not empty.  However, implementations MAY generate
   CERTREQs with an empty Certification Authority field under special
   conditions.  Although PKIX prohibits certificates with an empty
   Issuer field, there does exist a use case where doing so is
   appropriate, and carries special meaning in the IKE context.  This
   has become a convention within the IKE interoperability tests and
   usage space, and so its use is specified, explained here for the sake
   of interoperability.

   USE CASE: Consider the rare case where you have a gateway with
   multiple policies for a large number of IKE peers: some of these
   peers are business partners, some are remote-access employees, some
   are teleworkers, some are branch offices, and/or the gateway may be
   simultaneously serving many customers (e.g., Virtual Routers).  The
   total number of certificates, and corresponding trust anchors, is
   very high -- say, hundreds.  Each of these policies is configured
   with one or more acceptable trust anchors, so that in total, the
   gateway has one hundred (100) trust anchors that could possibly used
   to authenticate an incoming connection.  Assume that many of those
   connections originate from hosts/gateways with dynamically assigned
   IP addresses, so that the source IP of the IKE initiator is not known
   to the gateway, nor is the identity of the initiator (until it is
   revealed in Main Mode message 5).  In IKE main mode message 4, the
   responder gateway will need to send a CERTREQ to the initiator.
   Given this example, the gateway will have no idea which of the
   hundred possible Certification Authorities to send in the CERTREQ.
   Sending all possible Certification Authorities will cause significant
   processing delays, bandwidth consumption, and UDP fragmentation, so
   this tactic is ruled out.





<span class="grey">Korver                      Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   In such a deployment, the responder gateway implementation should be
   able to do all it can to indicate a Certification Authority in the
   CERTREQ.  This means the responder SHOULD first check SPD to see if
   it can match the source IP, and find some indication of which CA is
   associated with that IP.  If this fails (because the source IP is not
   familiar, as in the case above), then the responder SHOULD have a
   configuration option specifying which CAs are the default CAs to
   indicate in CERTREQ during such ambiguous connections (e.g., send
   CERTREQ with these N CAs if there is an unknown source IP).  If such
   a fall-back is not configured or impractical in a certain deployment
   scenario, then the responder implementation SHOULD have both of the
   following configuration options:

   o  send a CERTREQ payload with an empty Certification Authority
      field, or

   o  terminate the negotiation with an appropriate error message and
      audit log entry.

   Receiving a CERTREQ payload with an empty Certification Authority
   field indicates that the recipient should send all/any end-entity
   certificates it has, regardless of the trust anchor.  The initiator
   should be aware of what policy and which identity it will use, as it
   initiated the connection on a matched policy to begin with, and can
   thus respond with the appropriate certificate.

   If, after sending an empty CERTREQ in Main Mode message 4, a
   responder receives a certificate in message 5 that chains to a trust
   anchor that the responder either (a) does NOT support, or (b) was not
   configured for the policy (that policy was now able to be matched due
   to having the initiator's certificate present), this MUST be treated
   as an error, and security association setup MUST be aborted.  This
   event SHOULD be auditable.

   Instead of sending an empty CERTREQ, the responder implementation MAY
   be configured to terminate the negotiation on the grounds of a
   conflict with locally configured security policy.

   The decision of which to configure is a matter of local security
   policy; this document RECOMMENDS that both options be presented to
   administrators.

   More examples and explanation of this issue are included in "More on
   Empty CERTREQs" (Appendix B).







<span class="grey">Korver                      Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.8.%20%20Robustness"></a><a class="selflink" href="#section-3.2.8" name="section-3.2.8">3.2.8</a>.  Robustness</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.8.1.%20%20Unrecognized%20or%20Unsupported%20Certificate%20Types"></a><a class="selflink" href="#section-3.2.8.1" name="section-3.2.8.1">3.2.8.1</a>.  Unrecognized or Unsupported Certificate Types</span>

   Implementations MUST be able to deal with receiving CERTREQs with
   unsupported Certificate Types.  Absent any recognized and supported
   CERTREQ types, implementations MAY treat them as if they are of a
   supported type with the Certification Authority field left empty,
   depending on local policy.  ISAKMP [<a href="#ref-2" title='"Internet Security Association and Key Management Protocol (ISAKMP)"'>2</a>] <a href="#section-5.10">Section 5.10</a>, "Certificate
   Request Payload Processing", specifies additional processing.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.8.2.%20%20Undecodable%20Certification%20Authority%20Fields"></a><a class="selflink" href="#section-3.2.8.2" name="section-3.2.8.2">3.2.8.2</a>.  Undecodable Certification Authority Fields</span>

   Implementations MUST be able to deal with receiving CERTREQs with
   undecodable Certification Authority fields.  Implementations MAY
   ignore such payloads, depending on local policy.  ISAKMP specifies
   other actions which may be taken.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.8.3.%20%20Ordering%20of%20Certificate%20Request%20Payloads"></a><a class="selflink" href="#section-3.2.8.3" name="section-3.2.8.3">3.2.8.3</a>.  Ordering of Certificate Request Payloads</span>

   Implementations MUST NOT assume that CERTREQs are ordered in any way.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.9.%20%20Optimizations"></a><a class="selflink" href="#section-3.2.9" name="section-3.2.9">3.2.9</a>.  Optimizations</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.9.1.%20%20Duplicate%20Certificate%20Request%20Payloads"></a><a class="selflink" href="#section-3.2.9.1" name="section-3.2.9.1">3.2.9.1</a>.  Duplicate Certificate Request Payloads</span>

   Implementations SHOULD NOT send duplicate CERTREQs during an
   exchange.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.9.2.%20%20Name%20Lowest%20%27Common%27%20Certification%20Authorities"></a><a class="selflink" href="#section-3.2.9.2" name="section-3.2.9.2">3.2.9.2</a>.  Name Lowest 'Common' Certification Authorities</span>

   When a peer's certificate keying material has been cached, an
   implementation can send a hint to the peer to elide some of the
   certificates the peer would normally include in the response.  In
   addition to the normal set of CERTREQs that are sent specifying the
   trust anchors, an implementation MAY send CERTREQs specifying the
   relevant cached end-entity certificates.  When sending these hints,
   it is still necessary to send the normal set of trust anchor CERTREQs
   because the hints do not sufficiently convey all of the information
   required by the peer.  Specifically, either the peer may not support
   this optimization or there may be additional chains that could be
   used in this context but will not be if only the end-entity
   certificate is specified.

   No special processing is required on the part of the recipient of
   such a CERTREQ, and the end-entity certificates will still be sent.
   On the other hand, the recipient MAY elect to elide certificates
   based on receipt of such hints.



<span class="grey">Korver                      Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   CERTREQs must contain information that identifies a Certification
   Authority certificate, which results in the peer always sending at
   least the end-entity certificate.  Always sending the end-entity
   certificate allows implementations to determine unambiguously when a
   new certificate is being used by a peer (perhaps because the previous
   certificate has just expired), which may result in a failure because
   a new intermediate CA certificate might not be available to validate
   the new end-entity certificate).  Implementations that implement this
   optimization MUST recognize when the end-entity certificate has
   changed and respond to it by not performing this optimization if the
   exchange must be retried so that any missing keying materials will be
   sent during retry.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.9.3.%20%20Example"></a><a class="selflink" href="#section-3.2.9.3" name="section-3.2.9.3">3.2.9.3</a>.  Example</span>

   Imagine that an IKEv1 implementation has previously received and
   cached the peer certificate chain TA-&gt;CA1-&gt;CA2-&gt;EE.  If, during a
   subsequent exchange, this implementation sends a CERTREQ containing
   the Subject field in certificate TA, this implementation is
   requesting that the peer send at least three certificates: CA1, CA2,
   and EE.  On the other hand, if this implementation also sends a
   CERTREQ containing the Subject field of CA2, the implementation is
   providing a hint that only one certificate needs to be sent: EE.
   Note that in this example, the fact that TA is a trust anchor should
   not be construed to imply that TA is a self-signed certificate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Certificate%20Payload"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Certificate Payload</span>

   The Certificate (CERT) Payload allows the peer to transmit a single
   certificate or CRL.  Multiple certificates should be transmitted in
   multiple payloads.  For backwards-compatibility reasons,
   implementations MAY send intermediate CA certificates in addition to
   the appropriate end-entity certificate(s), but SHOULD NOT send any
   CRLs, ARLs, or trust anchors.  Exchanging trust anchors and
   especially CRLs and ARLs in IKE would increase the likelihood of UDP
   fragmentation, make the IKE exchange more complex, and consume
   additional network bandwidth.

   Note, however, that while the sender of the CERT payloads SHOULD NOT
   send any certificates it considers trust anchors, it's possible that
   the recipient may consider any given intermediate CA certificate to
   be a trust anchor.  For instance, imagine the sender has the
   certificate chain TA1-&gt;CA1-&gt;EE1 while the recipient has the
   certificate chain TA2-&gt;EE2 where TA2=CA1.  The sender is merely
   including an intermediate CA certificate, while the recipient
   receives a trust anchor.





<span class="grey">Korver                      Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   However, not all certificate forms that are legal in the PKIX
   certificate profile make sense in the context of IPsec.  The issue of
   how to represent IKE-meaningful name-forms in a certificate is
   especially problematic.  This document provides a profile for a
   subset of the PKIX certificate profile that makes sense for IKEv1/
   ISAKMP.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20%20Certificate%20Type"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>.  Certificate Type</span>

   The Certificate Type field identifies to the peer the type of
   certificate keying materials that are included.  ISAKMP defines 10
   types of Certificate Data that can be sent and specifies the syntax
   for these types.  For the purposes of this document, only the
   following types are relevant:

      o  X.509 Certificate - Signature
      o  Revocation Lists (CRL and ARL)
      o  PKCS #7 wrapped X.509 certificate

   The use of the other types are out of the scope of this document:

      o  X.509 Certificate - Key Exchange
      o  PGP Certificate
      o  DNS Signed Key
      o  Kerberos Tokens
      o  SPKI Certificate
      o  X.509 Certificate Attribute

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20%20X.509%20Certificate%20-%20Signature"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>.  X.509 Certificate - Signature</span>

   This type specifies that Certificate Data contains a certificate used
   for signing.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.3.%20%20Revocation%20Lists%20%28CRL%20and%20ARL%29"></a><a class="selflink" href="#section-3.3.3" name="section-3.3.3">3.3.3</a>.  Revocation Lists (CRL and ARL)</span>

   These types specify that Certificate Data contains an X.509 CRL or
   ARL.  These types SHOULD NOT be sent in IKE.  See <a href="#section-3.2.3">Section 3.2.3</a> for
   discussion.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.4.%20%20PKCS%20%237%20Wrapped%20X.509%20Certificate"></a><a class="selflink" href="#section-3.3.4" name="section-3.3.4">3.3.4</a>.  PKCS #7 Wrapped X.509 Certificate</span>

   This type defines a particular encoding, not a particular certificate
   type.  Implementations SHOULD NOT generate CERTs that contain this
   Certificate Type.  Implementations SHOULD accept CERTs that contain
   this Certificate Type because several implementations are known to
   generate them.  Note that those implementations sometimes include





<span class="grey">Korver                      Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   entire certificate hierarchies inside a single CERT PKCS #7 payload,
   which violates the requirement specified in ISAKMP that this payload
   contain a single certificate.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.5.%20%20Location%20of%20Certificate%20Payloads"></a><a class="selflink" href="#section-3.3.5" name="section-3.3.5">3.3.5</a>.  Location of Certificate Payloads</span>

   In IKEv1 Main Mode, the CERT payload MUST be in messages 5 and 6.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.6.%20%20Certificate%20Payloads%20Not%20Mandatory"></a><a class="selflink" href="#section-3.3.6" name="section-3.3.6">3.3.6</a>.  Certificate Payloads Not Mandatory</span>

   An implementation that does not receive any CERTREQs during an
   exchange SHOULD NOT send any CERT payloads, except when explicitly
   configured to proactively send CERT payloads in order to interoperate
   with non-compliant implementations that fail to send CERTREQs even
   when certificates are desired.  In this case, an implementation MAY
   send the certificate chain (not including the trust anchor)
   associated with the end-entity certificate.  This MUST NOT be the
   default behavior of implementations.

   Implementations whose local security policy configuration expects
   that a peer must receive certificates through out-of-band means
   SHOULD ignore any CERTREQ messages that are received.  Such a
   condition has been known to occur due to non-compliant or buggy
   implementations.

   Implementations that receive CERTREQs from a peer that contain only
   unrecognized Certification Authorities MAY elect to terminate the
   exchange, in order to avoid unnecessary and potentially expensive
   cryptographic processing, denial-of-service (resource starvation)
   attacks.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.7.%20%20Response%20to%20Multiple%20Certification%20Authority%20Proposals"></a><a class="selflink" href="#section-3.3.7" name="section-3.3.7">3.3.7</a>.  Response to Multiple Certification Authority Proposals</span>

   In response to multiple CERTREQs that contain different Certification
   Authority identities, implementations MAY respond using an end-entity
   certificate which chains to a CA that matches any of the identities
   provided by the peer.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.8.%20%20Using%20Local%20Keying%20Materials"></a><a class="selflink" href="#section-3.3.8" name="section-3.3.8">3.3.8</a>.  Using Local Keying Materials</span>

   Implementations MAY elect to skip parsing or otherwise decoding a
   given set of CERTs if those same keying materials are available via
   some preferable means, such as the case where certificates from a
   previous exchange have been cached.







<span class="grey">Korver                      Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.9.%20%20Multiple%20End-Entity%20Certificates"></a><a class="selflink" href="#section-3.3.9" name="section-3.3.9">3.3.9</a>.  Multiple End-Entity Certificates</span>

   Implementations SHOULD NOT send multiple end-entity certificates and
   recipients SHOULD NOT be expected to iterate over multiple end-entity
   certificates.

   If multiple end-entity certificates are sent, they MUST have the same
   public key; otherwise, the responder does not know which key was used
   in the Main Mode message 5.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.%20%20Robustness"></a><a class="selflink" href="#section-3.3.10" name="section-3.3.10">3.3.10</a>.  Robustness</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.1.%20%20Unrecognized%20or%20Unsupported%20Certificate%20Types"></a><a class="selflink" href="#section-3.3.10.1" name="section-3.3.10.1">3.3.10.1</a>.  Unrecognized or Unsupported Certificate Types</span>

   Implementations MUST be able to deal with receiving CERTs with
   unrecognized or unsupported Certificate Types.  Implementations MAY
   discard such payloads, depending on local policy.  ISAKMP [<a href="#ref-2" title='"Internet Security Association and Key Management Protocol (ISAKMP)"'>2</a>] <a href="#section-5.10">Section</a>
   <a href="#section-5.10">5.10</a>, "Certificate Request Payload Processing", specifies additional
   processing.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.2.%20%20Undecodable%20Certificate%20Data%20Fields"></a><a class="selflink" href="#section-3.3.10.2" name="section-3.3.10.2">3.3.10.2</a>.  Undecodable Certificate Data Fields</span>

   Implementations MUST be able to deal with receiving CERTs with
   undecodable Certificate Data fields.  Implementations MAY discard
   such payloads, depending on local policy.  ISAKMP specifies other
   actions that may be taken.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.3.%20%20Ordering%20of%20Certificate%20Payloads"></a><a class="selflink" href="#section-3.3.10.3" name="section-3.3.10.3">3.3.10.3</a>.  Ordering of Certificate Payloads</span>

   Implementations MUST NOT assume that CERTs are ordered in any way.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.4.%20%20Duplicate%20Certificate%20Payloads"></a><a class="selflink" href="#section-3.3.10.4" name="section-3.3.10.4">3.3.10.4</a>.  Duplicate Certificate Payloads</span>

   Implementations MUST support receiving multiple identical CERTs
   during an exchange.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.10.5.%20%20Irrelevant%20Certificates"></a><a class="selflink" href="#section-3.3.10.5" name="section-3.3.10.5">3.3.10.5</a>.  Irrelevant Certificates</span>

   Implementations MUST be prepared to receive certificates and CRLs
   that are not relevant to the current exchange.  Implementations MAY
   discard such extraneous certificates and CRLs.

   Implementations MAY send certificates that are irrelevant to an
   exchange.  One reason for including certificates that are irrelevant
   to an exchange is to minimize the threat of leaking identifying
   information in exchanges where CERT is not encrypted in IKEv1.  It
   should be noted, however, that this probably provides rather poor
   protection against leaking the identity.



<span class="grey">Korver                      Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   Another reason for including certificates that seem irrelevant to an
   exchange is that there may be two chains from the Certification
   Authority to the end entity, each of which is only valid with certain
   validation parameters (such as acceptable policies).  Since the end-
   entity doesn't know which parameters the relying party is using, it
   should send the certificates needed for both chains (even if there's
   only one CERTREQ).

   Implementations SHOULD NOT send multiple end-entity certificates and
   recipients SHOULD NOT be expected to iterate over multiple end-entity
   certificates.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.%20%20Optimizations"></a><a class="selflink" href="#section-3.3.11" name="section-3.3.11">3.3.11</a>.  Optimizations</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.1.%20%20Duplicate%20Certificate%20Payloads"></a><a class="selflink" href="#section-3.3.11.1" name="section-3.3.11.1">3.3.11.1</a>.  Duplicate Certificate Payloads</span>

   Implementations SHOULD NOT send duplicate CERTs during an exchange.
   Such payloads should be suppressed.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.2.%20%20Send%20Lowest%20%27Common%27%20Certificates"></a><a class="selflink" href="#section-3.3.11.2" name="section-3.3.11.2">3.3.11.2</a>.  Send Lowest 'Common' Certificates</span>

   When multiple CERTREQs are received that specify certification
   authorities within the end-entity certificate chain, implementations
   MAY send the shortest chain possible.  However, implementations
   SHOULD always send the end-entity certificate.  See <a href="#section-3.2.9.2">Section 3.2.9.2</a>
   for more discussion of this optimization.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.3.%20%20Ignore%20Duplicate%20Certificate%20Payloads"></a><a class="selflink" href="#section-3.3.11.3" name="section-3.3.11.3">3.3.11.3</a>.  Ignore Duplicate Certificate Payloads</span>

   Implementations MAY employ local means to recognize CERTs that have
   already been received and SHOULD discard these duplicate CERTs.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.11.4.%20%20Hash%20Payload"></a><a class="selflink" href="#section-3.3.11.4" name="section-3.3.11.4">3.3.11.4</a>.  Hash Payload</span>

   IKEv1 specifies the optional use of the Hash Payload to carry a
   pointer to a certificate in either of the Phase 1 public key
   encryption modes.  This pointer is used by an implementation to
   locate the end-entity certificate that contains the public key that a
   peer should use for encrypting payloads during the exchange.

   Implementations SHOULD include this payload whenever the public
   portion of the keypair has been placed in a certificate.









<span class="grey">Korver                      Standards Track                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Use%20of%20Certificates%20in%20RFC%204301%20and%20IKEv2"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Use of Certificates in <a href="rfc4301.html">RFC 4301</a> and IKEv2</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Identification%20Payload"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Identification Payload</span>

   The Peer Authorization Database (PAD) as described in <a href="rfc4301.html">RFC 4301</a> [<a href="#ref-14" title='"Security Architecture for the Internet Protocol"'>14</a>]
   describes the use of the ID payload in IKEv2 and provides a formal
   model for the binding of identity to policy in addition to providing
   services that deal more specifically with the details of policy
   enforcement, which are generally out of scope of this document.  The
   PAD is intended to provide a link between the SPD and the security
   association management in protocols such as IKE.  See <a href="rfc4301.html">RFC 4301</a> [<a href="#ref-14" title='"Security Architecture for the Internet Protocol"'>14</a>],
   Section 4.4.3 for more details.

   Note that IKEv2 adds an optional IDr payload in the second exchange
   that the initiator may send to the responder in order to specify
   which of the responder's multiple identities should be used.  The
   responder MAY choose to send an IDr in the third exchange that
   differs in type or content from the initiator-generated IDr.  The
   initiator MUST be able to receive a responder-generated IDr that is a
   different type from the one the initiator generated.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Certificate%20Request%20Payload"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Certificate Request Payload</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Revocation%20Lists%20%28CRL%20and%20ARL%29"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Revocation Lists (CRL and ARL)</span>

   IKEv2 does not support Certificate Payload sizes over approximately
   64K.  See <a href="#section-3.2.3">Section 3.2.3</a> for the problems this can cause.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.1.%20%20IKEv2%27s%20Hash%20and%20URL%20of%20X.509%20certificate"></a><a class="selflink" href="#section-4.2.1.1" name="section-4.2.1.1">4.2.1.1</a>.  IKEv2's Hash and URL of X.509 certificate</span>

   This ID type defines a request for the peer to send a hash and URL of
   its X.509 certificate, instead of the actual certificate itself.
   This is a particularly useful mechanism when the peer is a device
   with little memory and lower bandwidth, e.g., a mobile handset or
   consumer electronics device.

   If the IKEv2 implementation supports URL lookups, and prefers such a
   URL to receiving actual certificates, then the implementation will
   want to send a notify of type HTTP_CERT_LOOKUP_SUPPORTED.  From IKEv2
   [<a href="#ref-3" title='"Internet Key Exchange (IKEv2) Protocol"'>3</a>], Section 3.10.1, "This notification MAY be included in any
   message that can include a CERTREQ payload and indicates that the
   sender is capable of looking up certificates based on an HTTP-based
   URL (and hence presumably would prefer to receive certificate
   specifications in that format)".  If an HTTP_CERT_LOOKUP_SUPPORTED
   notification is sent, the sender MUST support the http scheme.  See
   <a href="#section-4.3.1">Section 4.3.1</a> for more discussion of HTTP_CERT_LOOKUP_SUPPORTED.





<span class="grey">Korver                      Standards Track                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.2.%20%20Location%20of%20Certificate%20Request%20Payloads"></a><a class="selflink" href="#section-4.2.1.2" name="section-4.2.1.2">4.2.1.2</a>.  Location of Certificate Request Payloads</span>

   In IKEv2, the CERTREQ payload must be in messages 2 and 3.  Note that
   in IKEv2, it is possible to have one side authenticating with
   certificates while the other side authenticates with pre-shared keys.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Certificate%20Payload"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Certificate Payload</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20IKEv2%27s%20Hash%20and%20URL%20of%20X.509%20Certificate"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  IKEv2's Hash and URL of X.509 Certificate</span>

   This type specifies that Certificate Data contains a hash and the URL
   to a repository where an X.509 certificate can be retrieved.

   An implementation that sends an HTTP_CERT_LOOKUP_SUPPORTED
   notification MUST support the http scheme and MAY support the ftp
   scheme, and MUST NOT require any specific form of the url-path, and
   it SHOULD support having user-name, password, and port parts in the
   URL.  The following are examples of mandatory forms:

   o  http://certs.example.com/certificate.cer
   o  http://certs.example.com/certs/cert.pl?u=foo;a=pw;valid-to=+86400
   o  http://certs.example.com/%0a/../foo/bar/zappa

   while the following is an example of a form that SHOULD be supported:

   o  <a href="http://user:password@certs.example.com:8888/certificate.cer">http://user:password@certs.example.com:8888/certificate.cer</a>

   FTP MAY be supported, and if it is, the following is an example of
   the ftp scheme that MUST be supported:

   o  ftp://ftp.example.com/pub/certificate.cer

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20Location%20of%20Certificate%20Payloads"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  Location of Certificate Payloads</span>

   In IKEv2, the CERT payload MUST be in messages 3 and 4.  Note that in
   IKEv2, it is possible to have one side authenticating with
   certificates while the other side authenticates with pre-shared keys.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.3.%20%20Ordering%20of%20Certificate%20Payloads"></a><a class="selflink" href="#section-4.3.3" name="section-4.3.3">4.3.3</a>.  Ordering of Certificate Payloads</span>

   For IKEv2, implementations MUST NOT assume that any but the first
   CERT is ordered in any way.  IKEv2 specifies that the first CERT
   contain an end-entity certificate that can be used to authenticate
   the peer.







<span class="grey">Korver                      Standards Track                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Certificate%20Profile%20for%20IKEv1%2FISAKMP%20and%20IKEv2"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Certificate Profile for IKEv1/ISAKMP and IKEv2</span>

   Except where specifically stated in this document, implementations
   MUST conform to the requirements of the PKIX [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>] certificate profile.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20X.509%20Certificates"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  X.509 Certificates</span>

   Users deploying IKE and IPsec with certificates have often had little
   control over the capabilities of CAs available to them.
   Implementations of this specification may include configuration knobs
   to disable checks required by this specification in order to permit
   use with inflexible and/or noncompliant CAs.  However, all checks on
   certificates exist for a specific reason involving the security of
   the entire system.  Therefore, all checks MUST be enabled by default.
   Administrators and users ought to understand the security purpose for
   the various checks, and be clear on what security will be lost by
   disabling the check.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.1.1.%20%20Versions"></a><a class="selflink" href="#section-5.1.1" name="section-5.1.1">5.1.1</a>.  Versions</span>

   Although PKIX states that "implementations SHOULD be prepared to
   accept any version certificate", in practice, this profile requires
   certain extensions that necessitate the use of Version 3 certificates
   for all but self-signed certificates used as trust anchors.
   Implementations that conform to this document MAY therefore reject
   Version 1 and Version 2 certificates in all other cases.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.1.2.%20%20Subject"></a><a class="selflink" href="#section-5.1.2" name="section-5.1.2">5.1.2</a>.  Subject</span>

   Certification Authority implementations MUST be able to create
   certificates with Subject fields with at least the following four
   attributes: CN, C, O, and OU.  Implementations MAY support other
   Subject attributes as well.  The contents of these attributes SHOULD
   be configurable on a certificate-by-certificate basis, as these
   fields will likely be used by IKE implementations to match SPD
   policy.

   See <a href="#section-3.1.5">Section 3.1.5</a> for details on how IKE implementations need to be
   able to process Subject field attributes for SPD policy lookup.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.2.1.%20%20Empty%20Subject%20Name"></a><a class="selflink" href="#section-5.1.2.1" name="section-5.1.2.1">5.1.2.1</a>.  Empty Subject Name</span>

   IKE Implementations MUST accept certificates that contain an empty
   Subject field, as specified in the PKIX certificate profile.
   Identity information in such certificates will be contained entirely
   in the SubjectAltName extension.





<span class="grey">Korver                      Standards Track                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.2.2.%20%20Specifying%20Hosts%20and%20not%20FQDN%20in%20the%20Subject%20Name"></a><a class="selflink" href="#section-5.1.2.2" name="section-5.1.2.2">5.1.2.2</a>.  Specifying Hosts and not FQDN in the Subject Name</span>

   Implementations that desire to place host names that are not intended
   to be processed by recipients as FQDNs (for instance "Gateway
   Router") in the Subject MUST use the commonName attribute.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.2.3.%20%20EmailAddress"></a><a class="selflink" href="#section-5.1.2.3" name="section-5.1.2.3">5.1.2.3</a>.  EmailAddress</span>

   As specified in the PKIX certificate profile, implementations MUST
   NOT populate X.500 distinguished names with the emailAddress
   attribute.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.%20%20X.509%20Certificate%20Extensions"></a><a class="selflink" href="#section-5.1.3" name="section-5.1.3">5.1.3</a>.  X.509 Certificate Extensions</span>

   Conforming IKE implementations MUST recognize extensions that must or
   may be marked critical according to this specification.  These
   extensions are: KeyUsage, SubjectAltName, and BasicConstraints.

   Certification Authority implementations SHOULD generate certificates
   such that the extension criticality bits are set in accordance with
   the PKIX certificate profile and this document.  With respect to
   compliance with the PKIX certificate profile, IKE implementations
   processing certificates MAY ignore the value of the criticality bit
   for extensions that are supported by that implementation, but MUST
   support the criticality bit for extensions that are not supported by
   that implementation.  That is, a relying party SHOULD processes all
   the extensions it is aware of whether the bit is true or false -- the
   bit says what happens when a relying party cannot process an
   extension.

          implements    bit in cert     PKIX mandate    behavior
          ------------------------------------------------------
          yes           true            true            ok
          yes           true            false           ok or reject
          yes           false           true            ok or reject
          yes           false           false           ok
          no            true            true            reject
          no            true            false           reject
          no            false           true            reject
          no            false           false           ok

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.1.%20%20AuthorityKeyIdentifier%20and%20SubjectKeyIdentifier"></a><a class="selflink" href="#section-5.1.3.1" name="section-5.1.3.1">5.1.3.1</a>.  AuthorityKeyIdentifier and SubjectKeyIdentifier</span>

   Implementations SHOULD NOT assume support for the
   AuthorityKeyIdentifier or SubjectKeyIdentifier extensions.  Thus,
   Certification Authority implementations should not generate
   certificate hierarchies that are overly complex to process in the
   absence of these extensions, such as those that require possibly



<span class="grey">Korver                      Standards Track                    [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   verifying a signature against a large number of similarly named CA
   certificates in order to find the CA certificate that contains the
   key that was used to generate the signature.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.2.%20%20KeyUsage"></a><a class="selflink" href="#section-5.1.3.2" name="section-5.1.3.2">5.1.3.2</a>.  KeyUsage</span>

   IKE uses an end-entity certificate in the authentication process.
   The end-entity certificate may be used for multiple applications.  As
   such, the CA can impose some constraints on the manner that a public
   key ought to be used.  The KeyUsage (KU) and ExtendedKeyUsage (EKU)
   extensions apply in this situation.

   Since we are talking about using the public key to validate a
   signature, if the KeyUsage extension is present, then at least one of
   the digitalSignature or the nonRepudiation bits in the KeyUsage
   extension MUST be set (both can be set as well).  It is also fine if
   other KeyUsage bits are set.

   A summary of the logic flow for peer cert validation follows:

   o  If no KU extension, continue.

   o  If KU present and doesn't mention digitalSignature or
      nonRepudiation (both, in addition to other KUs, is also fine),
      reject cert.

   o  If none of the above, continue.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.3.%20%20PrivateKeyUsagePeriod"></a><a class="selflink" href="#section-5.1.3.3" name="section-5.1.3.3">5.1.3.3</a>.  PrivateKeyUsagePeriod</span>

   The PKIX certificate profile recommends against the use of this
   extension.  The PrivateKeyUsageExtension is intended to be used when
   signatures will need to be verified long past the time when
   signatures using the private keypair may be generated.  Since IKE
   security associations (SAs) are short-lived relative to the intended
   use of this extension in addition to the fact that each signature is
   validated only a single time, the usefulness of this extension in the
   context of IKE is unclear.  Therefore, Certification Authority
   implementations MUST NOT generate certificates that contain the
   PrivateKeyUsagePeriod extension.  If an IKE implementation receives a
   certificate with this set, it SHOULD ignore it.










<span class="grey">Korver                      Standards Track                    [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.4.%20%20CertificatePolicies"></a><a class="selflink" href="#section-5.1.3.4" name="section-5.1.3.4">5.1.3.4</a>.  CertificatePolicies</span>

   Many IKE implementations do not currently provide support for the
   CertificatePolicies extension.  Therefore, Certification Authority
   implementations that generate certificates that contain this
   extension SHOULD NOT mark the extension as critical.  As is the case
   with all certificate extensions, a relying party receiving this
   extension but who can process the extension SHOULD NOT reject the
   certificate because it contains the extension.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.5.%20%20PolicyMappings"></a><a class="selflink" href="#section-5.1.3.5" name="section-5.1.3.5">5.1.3.5</a>.  PolicyMappings</span>

   Many IKE implementations do not support the PolicyMappings extension.
   Therefore, implementations that generate certificates that contain
   this extension SHOULD NOT mark the extension as critical.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.6.%20%20SubjectAltName"></a><a class="selflink" href="#section-5.1.3.6" name="section-5.1.3.6">5.1.3.6</a>.  SubjectAltName</span>

   Deployments that intend to use an ID of FQDN, USER_FQDN, IPV4_ADDR,
   or IPV6_ADDR MUST issue certificates with the corresponding
   SubjectAltName fields populated with the same data.  Implementations
   SHOULD generate only the following GeneralName choices in the
   SubjectAltName extension, as these choices map to legal IKEv1/ISAKMP/
   IKEv2 Identification Payload types: rfc822Name, dNSName, or
   iPAddress.  Although it is possible to specify any GeneralName choice
   in the Identification Payload by using the ID_DER_ASN1_GN ID type,
   implementations SHOULD NOT assume support for such functionality, and
   SHOULD NOT generate certificates that do so.

<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.6.1.%20%20dNSName"></a><a class="selflink" href="#section-5.1.3.6.1" name="section-5.1.3.6.1">5.1.3.6.1</a>.  dNSName</span>

   If the IKE ID type is FQDN, then this field MUST contain a fully
   qualified domain name.  If the IKE ID type is FQDN, then the dNSName
   field MUST match its contents.  Implementations MUST NOT generate
   names that contain wildcards.  Implementations MAY treat certificates
   that contain wildcards in this field as syntactically invalid.

   Although this field is in the form of an FQDN, IKE implementations
   SHOULD NOT assume that this field contains an FQDN that will resolve
   via the DNS, unless this is known by way of some out-of-band
   mechanism.  Such a mechanism is out of the scope of this document.
   Implementations SHOULD NOT treat the failure to resolve as an error.









<span class="grey">Korver                      Standards Track                    [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.6.2.%20%20iPAddress"></a><a class="selflink" href="#section-5.1.3.6.2" name="section-5.1.3.6.2">5.1.3.6.2</a>.  iPAddress</span>

   If the IKE ID type is IPV4_ADDR or IPV6_ADDR, then the iPAddress
   field MUST match its contents.  Note that although PKIX permits CIDR
   [<a href="#ref-15" title='"Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan"'>15</a>] notation in the "Name Constraints" extension, the PKIX
   certificate profile explicitly prohibits using CIDR notation for
   conveying identity information.  In other words, the CIDR notation
   MUST NOT be used in the SubjectAltName extension.

<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.6.3.%20%20rfc822Name"></a><a class="selflink" href="#section-5.1.3.6.3" name="section-5.1.3.6.3">5.1.3.6.3</a>.  rfc822Name</span>

   If the IKE ID type is USER_FQDN, then the rfc822Name field MUST match
   its contents.  Although this field is in the form of an Internet mail
   address, IKE implementations SHOULD NOT assume that this field
   contains a valid email address, unless this is known by way of some
   out-of-band mechanism.  Such a mechanism is out of the scope of this
   document.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.7.%20%20IssuerAltName"></a><a class="selflink" href="#section-5.1.3.7" name="section-5.1.3.7">5.1.3.7</a>.  IssuerAltName</span>

   Certification Authority implementations SHOULD NOT assume that other
   implementations support the IssuerAltName extension, and especially
   should not assume that information contained in this extension will
   be displayed to end users.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.8.%20%20SubjectDirectoryAttributes"></a><a class="selflink" href="#section-5.1.3.8" name="section-5.1.3.8">5.1.3.8</a>.  SubjectDirectoryAttributes</span>

   The SubjectDirectoryAttributes extension is intended to convey
   identification attributes of the subject.  IKE implementations MAY
   ignore this extension when it is marked non-critical, as the PKIX
   certificate profile mandates.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.9.%20%20BasicConstraints"></a><a class="selflink" href="#section-5.1.3.9" name="section-5.1.3.9">5.1.3.9</a>.  BasicConstraints</span>

   The PKIX certificate profile mandates that CA certificates contain
   this extension and that it be marked critical.  IKE implementations
   SHOULD reject CA certificates that do not contain this extension.
   For backwards compatibility, implementations may accept such
   certificates if explicitly configured to do so, but the default for
   this setting MUST be to reject such certificates.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.10.%20%20NameConstraints"></a><a class="selflink" href="#section-5.1.3.10" name="section-5.1.3.10">5.1.3.10</a>.  NameConstraints</span>

   Many IKE implementations do not support the NameConstraints
   extension.  Since the PKIX certificate profile mandates that this
   extension be marked critical when present, Certification Authority
   implementations that are interested in maximal interoperability for
   IKE SHOULD NOT generate certificates that contain this extension.



<span class="grey">Korver                      Standards Track                    [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.11.%20%20PolicyConstraints"></a><a class="selflink" href="#section-5.1.3.11" name="section-5.1.3.11">5.1.3.11</a>.  PolicyConstraints</span>

   Many IKE implementations do not support the PolicyConstraints
   extension.  Since the PKIX certificate profile mandates that this
   extension be marked critical when present, Certification Authority
   implementations that are interested in maximal interoperability for
   IKE SHOULD NOT generate certificates that contain this extension.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.12.%20%20ExtendedKeyUsage"></a><a class="selflink" href="#section-5.1.3.12" name="section-5.1.3.12">5.1.3.12</a>.  ExtendedKeyUsage</span>

   The CA SHOULD NOT include the ExtendedKeyUsage (EKU) extension in
   certificates for use with IKE.  Note that there were three IPsec-
   related object identifiers in EKU that were assigned in 1999.  The
   semantics of these values were never clearly defined.  The use of
   these three EKU values in IKE/IPsec is obsolete and explicitly
   deprecated by this specification.  CAs SHOULD NOT issue certificates
   for use in IKE with them.  (For historical reference only, those
   values were id-kp-ipsecEndSystem, id-kp-ipsecTunnel, and id-kp-
   ipsecUser.)

   The CA SHOULD NOT mark the EKU extension in certificates for use with
   IKE and one or more other applications.  Nevertheless, this document
   defines an ExtendedKeyUsage keyPurposeID that MAY be used to limit a
   certificate's use:

   id-kp-ipsecIKE OBJECT IDENTIFIER ::= { id-kp 17 }

   where id-kp is defined in <a href="rfc3280.html">RFC 3280</a> [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>].  If a certificate is intended
   to be used with both IKE and other applications, and one of the other
   applications requires use of an EKU value, then such certificates
   MUST contain either the keyPurposeID id-kp-ipsecIKE or
   anyExtendedKeyUsage [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>], as well as the keyPurposeID values
   associated with the other applications.  Similarly, if a CA issues
   multiple otherwise-similar certificates for multiple applications
   including IKE, and it is intended that the IKE certificate NOT be
   used with another application, the IKE certificate MAY contain an EKU
   extension listing a keyPurposeID of id-kp-ipsecIKE to discourage its
   use with the other application.  Recall, however, that EKU extensions
   in certificates meant for use in IKE are NOT RECOMMENDED.

   Conforming IKE implementations are not required to support EKU.  If a
   critical EKU extension appears in a certificate and EKU is not
   supported by the implementation, then <a href="rfc3280.html">RFC 3280</a> requires that the
   certificate be rejected.  Implementations that do support EKU MUST
   support the following logic for certificate validation:






<span class="grey">Korver                      Standards Track                    [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   o  If no EKU extension, continue.

   o  If EKU present AND contains either id-kp-ipsecIKE or
      anyExtendedKeyUsage, continue.

   o  Otherwise, reject cert.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.13.%20%20CRLDistributionPoints"></a><a class="selflink" href="#section-5.1.3.13" name="section-5.1.3.13">5.1.3.13</a>.  CRLDistributionPoints</span>

   Because this document deprecates the sending of CRLs in-band, the use
   of CRLDistributionPoints (CDP) becomes very important if CRLs are
   used for revocation checking (as opposed to, say, Online Certificate
   Status Protocol - OCSP [<a href="#ref-16" title='"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP"'>16</a>]).  The IPsec peer either needs to have a
   URL for a CRL written into its local configuration, or it needs to
   learn it from CDP.  Therefore, Certification Authority
   implementations SHOULD issue certificates with a populated CDP.

   Failure to validate the CRLDistributionPoints/
   IssuingDistributionPoint pair can result in CRL substitution where an
   entity knowingly substitutes a known good CRL from a different
   distribution point for the CRL that is supposed to be used, which
   would show the entity as revoked.  IKE implementations MUST support
   validating that the contents of CRLDistributionPoints match those of
   the IssuingDistributionPoint to prevent CRL substitution when the
   issuing CA is using them.  At least one CA is known to default to
   this type of CRL use.  See <a href="#section-5.2.2.5">Section 5.2.2.5</a> for more information.

   CDPs SHOULD be "resolvable".  Several non-compliant Certification
   Authority implementations are well known for including unresolvable
   CDPs like <a href="http://localhost/path_to_CRL">http://localhost/path_to_CRL</a> and <a href="http:///path_to_CRL">http:///path_to_CRL</a> that
   are equivalent to failing to include the CDP extension in the
   certificate.

   See the IETF IPR Web page for CRLDistributionPoints intellectual
   property rights (IPR) information.  Note that both the
   CRLDistributionPoints and IssuingDistributionPoint extensions are
   RECOMMENDED but not REQUIRED by the PKIX certificate profile, so
   there is no requirement to license any IPR.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.14.%20%20InhibitAnyPolicy"></a><a class="selflink" href="#section-5.1.3.14" name="section-5.1.3.14">5.1.3.14</a>.  InhibitAnyPolicy</span>

   Many IKE implementations do not support the InhibitAnyPolicy
   extension.  Since the PKIX certificate profile mandates that this
   extension be marked critical when present, Certification Authority
   implementations that are interested in maximal interoperability for
   IKE SHOULD NOT generate certificates that contain this extension.





<span class="grey">Korver                      Standards Track                    [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.15.%20%20FreshestCRL"></a><a class="selflink" href="#section-5.1.3.15" name="section-5.1.3.15">5.1.3.15</a>.  FreshestCRL</span>

   IKE implementations MUST NOT assume that the FreshestCRL extension
   will exist in peer certificates.  Note that most IKE implementations
   do not support delta CRLs.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.16.%20%20AuthorityInfoAccess"></a><a class="selflink" href="#section-5.1.3.16" name="section-5.1.3.16">5.1.3.16</a>.  AuthorityInfoAccess</span>

   The PKIX certificate profile defines the AuthorityInfoAccess
   extension, which is used to indicate "how to access CA information
   and services for the issuer of the certificate in which the extension
   appears".  Because this document deprecates the sending of CRLs in-
   band, the use of AuthorityInfoAccess (AIA) becomes very important if
   OCSP [<a href="#ref-16" title='"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP"'>16</a>] is to be used for revocation checking (as opposed to CRLs).
   The IPsec peer either needs to have a URI for the OCSP query written
   into its local configuration, or it needs to learn it from AIA.
   Therefore, implementations SHOULD support this extension, especially
   if OCSP will be used.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.1.3.17.%20%20SubjectInfoAccess"></a><a class="selflink" href="#section-5.1.3.17" name="section-5.1.3.17">5.1.3.17</a>.  SubjectInfoAccess</span>

   The PKIX certificate profile defines the SubjectInfoAccess
   certificate extension, which is used to indicate "how to access
   information and services for the subject of the certificate in which
   the extension appears".  This extension has no known use in the
   context of IPsec.  Conformant IKE implementations SHOULD ignore this
   extension when present.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20X.509%20Certificate%20Revocation%20Lists"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  X.509 Certificate Revocation Lists</span>

   When validating certificates, IKE implementations MUST make use of
   certificate revocation information, and SHOULD support such
   revocation information in the form of CRLs, unless non-CRL revocation
   information is known to be the only method for transmitting this
   information.  Deployments that intend to use CRLs for revocation
   SHOULD populate the CRLDistributionPoints extension.  Therefore,
   Certification Authority implementations MUST support issuing
   certificates with this field populated.  IKE implementations MAY
   provide a configuration option to disable use of certain types of
   revocation information, but that option MUST be off by default.  Such
   an option is often valuable in lab testing environments.










<span class="grey">Korver                      Standards Track                    [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.1.%20%20Multiple%20Sources%20of%20Certificate%20Revocation%20Information"></a><a class="selflink" href="#section-5.2.1" name="section-5.2.1">5.2.1</a>.  Multiple Sources of Certificate Revocation Information</span>

   IKE implementations that support multiple sources of obtaining
   certificate revocation information MUST act conservatively when the
   information provided by these sources is inconsistent: when a
   certificate is reported as revoked by one trusted source, the
   certificate MUST be considered revoked.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.%20%20X.509%20Certificate%20Revocation%20List%20Extensions"></a><a class="selflink" href="#section-5.2.2" name="section-5.2.2">5.2.2</a>.  X.509 Certificate Revocation List Extensions</span>

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.1.%20%20AuthorityKeyIdentifier"></a><a class="selflink" href="#section-5.2.2.1" name="section-5.2.2.1">5.2.2.1</a>.  AuthorityKeyIdentifier</span>

   Certification Authority implementations SHOULD NOT assume that IKE
   implementations support the AuthorityKeyIdentifier extension, and
   thus should not generate certificate hierarchies which are overly
   complex to process in the absence of this extension, such as those
   that require possibly verifying a signature against a large number of
   similarly named CA certificates in order to find the CA certificate
   which contains the key that was used to generate the signature.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.2.%20%20IssuerAltName"></a><a class="selflink" href="#section-5.2.2.2" name="section-5.2.2.2">5.2.2.2</a>.  IssuerAltName</span>

   Certification Authority implementations SHOULD NOT assume that IKE
   implementations support the IssuerAltName extension, and especially
   should not assume that information contained in this extension will
   be displayed to end users.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.3.%20%20CRLNumber"></a><a class="selflink" href="#section-5.2.2.3" name="section-5.2.2.3">5.2.2.3</a>.  CRLNumber</span>

   As stated in the PKIX certificate profile, all issuers MUST include
   this extension in all CRLs.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.4.%20%20DeltaCRLIndicator"></a><a class="selflink" href="#section-5.2.2.4" name="section-5.2.2.4">5.2.2.4</a>.  DeltaCRLIndicator</span>

<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.4.1.%20%20If%20Delta%20CRLs%20Are%20Unsupported"></a><a class="selflink" href="#section-5.2.2.4.1" name="section-5.2.2.4.1">5.2.2.4.1</a>.  If Delta CRLs Are Unsupported</span>

   IKE implementations that do not support delta CRLs MUST reject CRLs
   that contain the DeltaCRLIndicator (which MUST be marked critical
   according to the PKIX certificate profile) and MUST make use of a
   base CRL if it is available.  Such implementations MUST ensure that a
   delta CRL does not "overwrite" a base CRL, for instance, in the
   keying material database.









<span class="grey">Korver                      Standards Track                    [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h6"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.4.2.%20%20Delta%20CRL%20Recommendations"></a><a class="selflink" href="#section-5.2.2.4.2" name="section-5.2.2.4.2">5.2.2.4.2</a>.  Delta CRL Recommendations</span>

   Since some IKE implementations that do not support delta CRLs may
   behave incorrectly or insecurely when presented with delta CRLs,
   administrators and deployers should consider whether issuing delta
   CRLs increases security before issuing such CRLs.  And, if all the
   elements in the VPN and PKI systems do not adequately support Delta
   CRLs, then their use should be questioned.

   The editors are aware of several implementations that behave in an
   incorrect or insecure manner when presented with delta CRLs.  See
   <a href="#appendix-A">Appendix A</a> for a description of the issue.  Therefore, this
   specification RECOMMENDS NOT issuing delta CRLs at this time.  On the
   other hand, failure to issue delta CRLs may expose a larger window of
   vulnerability if a full CRL is not issued as often as delta CRLs
   would be.  See the Security Considerations section of the PKIX [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>]
   certificate profile for additional discussion.  Implementers as well
   as administrators are encouraged to consider these issues.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.5.%20%20IssuingDistributionPoint"></a><a class="selflink" href="#section-5.2.2.5" name="section-5.2.2.5">5.2.2.5</a>.  IssuingDistributionPoint</span>

   A CA that is using CRLDistributionPoints may do so to provide many
   "small" CRLs, each only valid for a particular set of certificates
   issued by that CA.  To associate a CRL with a certificate, the CA
   places the CRLDistributionPoints extension in the certificate, and
   places the IssuingDistributionPoint in the CRL.  The
   distributionPointName field in the CRLDistributionPoints extension
   MUST be identical to the distributionPoint field in the
   IssuingDistributionPoint extension.  At least one CA is known to
   default to this type of CRL use.  See <a href="#section-5.1.3.13">Section 5.1.3.13</a> for more
   information.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.2.2.6.%20%20FreshestCRL"></a><a class="selflink" href="#section-5.2.2.6" name="section-5.2.2.6">5.2.2.6</a>.  FreshestCRL</span>

   Given the recommendations against Certification Authority
   implementations generating delta CRLs, this specification RECOMMENDS
   that implementations do not populate CRLs with the FreshestCRL
   extension, which is used to obtain delta CRLs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Strength%20of%20Signature%20Hashing%20Algorithms"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Strength of Signature Hashing Algorithms</span>

   At the time that this document is being written, popular
   certification authorities and CA software issue certificates using
   the RSA-with-SHA1 and RSA-with-MD5 signature algorithms.
   Implementations MUST be able to validate certificates with either of
   those algorithms.





<span class="grey">Korver                      Standards Track                    [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   As described in [<a href="#ref-17" title='"Attacks on Cryptographic Hashes in Internet Protocols"'>17</a>], both the MD5 and SHA-1 hash algorithms are
   weaker than originally expected with respect to hash collisions.
   Certificates that use these hash algorithms as part of their
   signature algorithms could conceivably be subject to an attack where
   a CA issues a certificate with a particular identity, and the
   recipient of that certificate can create a different valid
   certificate with a different identity.  So far, such an attack is
   only theoretical, even with the weaknesses found in the hash
   algorithms.

   Because of the recent attacks, there has been a heightened interest
   in having widespread deployment of additional signature algorithms.
   The algorithm that has been mentioned most often is RSA-with-SHA256,
   two types of which are described in detail in [<a href="#ref-18" title='"Additional Algorithms and Identifiers for RSA Cryptography for use in the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>18</a>].  It is widely
   expected that this signature algorithm will be much more resilient to
   collision-based attacks than the current RSA-with-SHA1 and RSA-with-
   MD5, although no proof of that has been shown.  There is active
   discussion in the cryptographic community of better hash functions
   that could be used in signature algorithms.

   In order to interoperate, all implementations need to be able to
   validate signatures for all algorithms that the implementations will
   encounter.  Therefore, implementations SHOULD be able to use
   signatures that use the sha256WithRSAEncryption signature algorithm
   (PKCS#1 version 1.5) as soon as possible.  At the time that this
   document is being written, there is at least one CA that supports
   generating certificates with sha256WithRSAEncryption signature
   algorithm, and it is expected that there will be significant
   deployment of this algorithm by the end of 2007.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Configuration%20Data%20Exchange%20Conventions"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Configuration Data Exchange Conventions</span>

   Below, we present a common format for exchanging configuration data.
   Implementations MUST support these formats, MUST support receiving
   arbitrary whitespace at the beginning and end of any line, MUST
   support receiving arbitrary line lengths although they SHOULD
   generate lines less than 76 characters, and MUST support receiving
   the following three line-termination disciplines: LF (US-ASCII 10),
   CR (US-ASCII 13), and CRLF.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Certificates"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Certificates</span>

   Certificates MUST be Base64 [<a href="#ref-19" title='"The Base16, Base32, and Base64 Data Encodings"'>19</a>] encoded and appear between the
   following delimiters:

            -----BEGIN CERTIFICATE-----
            -----END CERTIFICATE-----




<span class="grey">Korver                      Standards Track                    [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20CRLs%20and%20ARLs"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  CRLs and ARLs</span>

   CRLs and ARLs MUST be Base64 encoded and appear between the following
   delimiters:

            -----BEGIN CRL-----
            -----END CRL-----

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Public%20Keys"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Public Keys</span>

   IKE implementations MUST support two forms of public keys:
   certificates and so-called "raw" keys.  Certificates should be
   transferred in the same form as <a href="#section-6.1">Section 6.1</a>.  A raw key is only the
   SubjectPublicKeyInfo portion of the certificate, and MUST be Base64
   encoded and appear between the following delimiters:

            -----BEGIN PUBLIC KEY-----
            -----END PUBLIC KEY-----

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20PKCS%2310%20Certificate%20Signing%20Requests"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  PKCS#10 Certificate Signing Requests</span>

   A PKCS#10 [<a href="#ref-9" title='"PKCS #10: Certification Request Syntax Specification Version 1.7"'>9</a>] Certificate Signing Request MUST be Base64 encoded and
   appear between the following delimiters:

            -----BEGIN CERTIFICATE REQUEST-----
            -----END CERTIFICATE REQUEST-----

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Security%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Security Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Certificate%20Request%20Payload"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Certificate Request Payload</span>

   The Contents of CERTREQ are not encrypted in IKE.  In some
   environments, this may leak private information.  Administrators in
   some environments may wish to use the empty Certification Authority
   option to prevent such information from leaking, at the cost of
   performance.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20IKEv1%20Main%20Mode"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  IKEv1 Main Mode</span>

   Certificates may be included in any message, and therefore
   implementations may wish to respond with CERTs in a message that
   offers privacy protection in Main Mode messages 5 and 6.

   Implementations may not wish to respond with CERTs in the second
   message, thereby violating the identity protection feature of Main
   Mode in IKEv1.





<span class="grey">Korver                      Standards Track                    [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Disabling%20Certificate%20Checks"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Disabling Certificate Checks</span>

   It is important to note that anywhere this document suggests
   implementers provide users with the configuration option to simplify,
   modify, or disable a feature or verification step, there may be
   security consequences for doing so.  Deployment experience has shown
   that such flexibility may be required in some environments, but
   making use of such flexibility can be inappropriate in others.  Such
   configuration options MUST default to "enabled" and it is appropriate
   to provide warnings to users when disabling such features.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgements"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgements</span>

   The authors would like to acknowledge the expired document "A PKIX
   Profile for IKE" (July 2000) for providing valuable materials for
   this document.

   The authors would like to especially thank Eric Rescorla, one of its
   original authors, in addition to Greg Carter, Steve Hanna, Russ
   Housley, Charlie Kaufman, Tero Kivinen, Pekka Savola, Paul Hoffman,
   and Gregory Lebovitz for their valuable comments, some of which have
   been incorporated verbatim into this document.  Paul Knight performed
   the arduous task of converting the text to XML format.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-1" name="ref-1">1</a>]   Harkins, D. and D. Carrel, "The Internet Key Exchange (IKE)",
         <a href="rfc2409.html">RFC 2409</a>, November 1998.

   [<a id="ref-2" name="ref-2">2</a>]   Maughan, D., Schneider, M., and M. Schertler, "Internet
         Security Association and Key Management Protocol (ISAKMP)", <a href="rfc2408.html">RFC</a>
         <a href="rfc2408.html">2408</a>, November 1998.

   [<a id="ref-3" name="ref-3">3</a>]   Kaufman, C., "Internet Key Exchange (IKEv2) Protocol", <a href="rfc4306.html">RFC</a>
         <a href="rfc4306.html">4306</a>, December 2005.

   [<a id="ref-4" name="ref-4">4</a>]   Kent, S. and R. Atkinson, "Security Architecture for the
         Internet Protocol", <a href="rfc2401.html">RFC 2401</a>, November 1998.

   [<a id="ref-5" name="ref-5">5</a>]   Housley, R., Polk, W., Ford, W., and D. Solo, "Internet X.509
         Public Key Infrastructure Certificate and Certificate
         Revocation List (CRL) Profile", <a href="rfc3280.html">RFC 3280</a>, April 2002.

   [<a id="ref-6" name="ref-6">6</a>]   Piper, D., "The Internet IP Security Domain of Interpretation
         for ISAKMP", <a href="rfc2407.html">RFC 2407</a>, November 1998.




<span class="grey">Korver                      Standards Track                    [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   [<a id="ref-7" name="ref-7">7</a>]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-8" name="ref-8">8</a>]   Postel, J., "Internet Protocol", STD 5, <a href="rfc791.html">RFC 791</a>, September
         1981.

   [<a id="ref-9" name="ref-9">9</a>]   Nystrom, M. and B. Kaliski, "PKCS #10: Certification Request
         Syntax Specification Version 1.7", <a href="rfc2986.html">RFC 2986</a>, November 2000.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-10" name="ref-10">10</a>]  Deering, S. and R. Hinden, "Internet Protocol, Version 6 (IPv6)
         Specification", <a href="rfc2460.html">RFC 2460</a>, December 1998.

   [<a id="ref-11" name="ref-11">11</a>]  Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose,
         "DNS Security Introduction and Requirements", <a href="rfc4033.html">RFC 4033</a>, March
         2005.

   [<a id="ref-12" name="ref-12">12</a>]  Faltstrom, P., Hoffman, P., and A. Costello,
         "Internationalizing Domain Names in Applications (IDNA)", <a href="rfc3490.html">RFC</a>
         <a href="rfc3490.html">3490</a>, March 2003.

   [<a id="ref-13" name="ref-13">13</a>]  Lynn, C., Kent, S., and K. Seo, "X.509 Extensions for IP
         Addresses and AS Identifiers", <a href="rfc3779.html">RFC 3779</a>, June 2004.

   [<a id="ref-14" name="ref-14">14</a>]  Kent, S. and K. Seo, "Security Architecture for the Internet
         Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.

   [<a id="ref-15" name="ref-15">15</a>]  Fuller, V. and T. Li, "Classless Inter-domain Routing (CIDR):
         The Internet Address Assignment and Aggregation Plan", <a href="https://tools.ietf.org/html/bcp122">BCP 122</a>,
         <a href="rfc4632.html">RFC 4632</a>, August 2006.

   [<a id="ref-16" name="ref-16">16</a>]  Myers, M., Ankney, R., Malpani, A., Galperin, S., and C. Adams,
         "X.509 Internet Public Key Infrastructure Online Certificate
         Status Protocol - OCSP", <a href="rfc2560.html">RFC 2560</a>, June 1999.

   [<a id="ref-17" name="ref-17">17</a>]  Hoffman, P. and B. Schneier, "Attacks on Cryptographic Hashes
         in Internet Protocols", <a href="rfc4270.html">RFC 4270</a>, November 2005.

   [<a id="ref-18" name="ref-18">18</a>]  Schaad, J., Kaliski, B., and R. Housley, "Additional Algorithms
         and Identifiers for RSA Cryptography for use in the Internet
         X.509 Public Key Infrastructure Certificate and Certificate
         Revocation List (CRL) Profile", <a href="rfc4055.html">RFC 4055</a>, June 2005.

   [<a id="ref-19" name="ref-19">19</a>]  Josefsson, S., "The Base16, Base32, and Base64 Data Encodings",
         <a href="rfc4648.html">RFC 4648</a>, October 2006.





<span class="grey">Korver                      Standards Track                    [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20The%20Possible%20Dangers%20of%20Delta%20CRLs"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  The Possible Dangers of Delta CRLs</span>

   The problem is that the CRL processing algorithm is sometimes written
   incorrectly with the assumption that all CRLs are base CRLs and it is
   assumed that CRLs will pass content validity tests.  Specifically,
   such implementations fail to check the certificate against all
   possible CRLs: if the first CRL that is obtained from the keying
   material database fails to decode, no further revocation checks are
   performed for the relevant certificate.  This problem is compounded
   by the fact that implementations that do not understand delta CRLs
   may fail to decode such CRLs due to the critical DeltaCRLIndicator
   extension.  The algorithm that is implemented in this case is
   approximately:

   o  fetch newest CRL

   o  check validity of CRL signature

   o  if CRL signature is valid, then

   o  if CRL does not contain unrecognized critical extensions and
      certificate is on CRL, then set certificate status to revoked

   The authors note that a number of PKI toolkits do not even provide a
   method for obtaining anything but the newest CRL, which in the
   presence of delta CRLs may in fact be a delta CRL, not a base CRL.

   Note that the above algorithm is dangerous in many ways.  See the
   PKIX [<a href="#ref-5" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>5</a>] certificate profile for the correct algorithm.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20More%20on%20Empty%20CERTREQs"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  More on Empty CERTREQs</span>

   Sending empty certificate requests is commonly used in
   implementations, and in the IPsec interop meetings, vendors have
   generally agreed that it means that send all/any end-entity
   certificates you have (if multiple end-entity certificates are sent,
   they must have same public key, as otherwise, the other end does not
   know which key was used).  For 99% of cases, the client has exactly
   one certificate and public key, so it really doesn't matter, but the
   server might have multiple; thus, it simply needs to say to the
   client, use any certificate you have.  If we are talking about
   corporate VPNs, etc., even if the client has multiple certificates or
   keys, all of them would be usable when authenticating to the server,
   so the client can simply pick one.

   If there is some real difference on which certificate to use (like
   ones giving different permissions), then the client must be
   configured anyway, or it might even ask the user which one to use



<span class="grey">Korver                      Standards Track                    [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   (the user is the only one who knows whether he needs admin
   privileges, thus needs to use admin cert, or if the normal email
   privileges are ok, thus uses email only cert).

   In 99% of the cases, the client has exactly one certificate, so it
   will send it.  In 90% of the rest of the cases, any of the
   certificates is ok, as they are simply different certificates from
   the same CA, or from different CAs for the same corporate VPN, thus
   any of them is ok.

   Sending empty certificate requests has been agreed there to mean
   "give me your cert, any cert".

   Justification:

   o  Responder first does all it can to send a CERTREQ with a CA, check
      for IP match in SPD, have a default set of CAs to use in ambiguous
      cases, etc.

   o  Sending empty CERTREQs is fairly common in implementations today,
      and is generally accepted to mean "send me a certificate, any
      certificate that works for you".

   o  Saves responder sending potentially hundreds of certs, the
      fragmentation problems that follow, etc.

   o  In +90% of use cases, Initiators have exactly one certificate.

   o  In +90% of the remaining use cases, the multiple certificates it
      has are issued by the same CA.

   o  In the remaining use case(s) -- if not all the others above -- the
      Initiator will be configured explicitly with which certificate to
      send, so responding to an empty CERTREQ is easy.

   The following example shows why initiators need to have sufficient
   policy definition to know which certificate to use for a given
   connection it initiates.

   EXAMPLE: Your client (initiator) is configured with VPN policies for
   gateways A and B (representing perhaps corporate partners).










<span class="grey">Korver                      Standards Track                    [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


   The policies for the two gateways look something like:

         Acme Company policy (gateway A)
            Engineering can access 10.1.1.0
                   Trusted CA: CA-A, Trusted Users: OU=Engineering
            Partners can access 20.1.1.0
                   Trusted CA: CA-B, Trusted Users: OU=AcmePartners

         Bizco Company policy (gateway B)
           Sales can access 30.1.1.0
                   Trusted CA: CA-C, Trusted Users: OU=Sales
           Partners can access 40.1.1.0
                   Trusted CA: CA-B, Trusted Users: OU=BizcoPartners

   You are an employee of Acme and you are issued the following
   certificates:

   o  From CA-A: CN=JoeUser,OU=Engineering
   o  From CA-B: CN=JoePartner,OU=BizcoPartners

   The client MUST be configured locally to know which CA to use when
   connecting to either gateway.  If your client is not configured to
   know the local credential to use for the remote gateway, this
   scenario will not work either.  If you attempt to connect to Bizco,
   everything will work... as you are presented with responding with a
   certificate signed by CA-B or CA-C... as you only have a certificate
   from CA-B you are OK.  If you attempt to connect to Acme, you have an
   issue because you are presented with an ambiguous policy selection.
   As the initiator, you will be presented with certificate requests
   from both CA-A and CA-B.  You have certificates issued by both CAs,
   but only one of the certificates will be usable.  How does the client
   know which certificate it should present?  It must have sufficiently
   clear local policy specifying which one credential to present for the
   connection it initiates.

Author's Address

   Brian Korver
   Network Resonance, Inc.
   2483 E. Bayshore Rd.
   Palo Alto, CA  94303
   US

   Phone: +1 650 812 7705
   EMail: briank@networkresonance.com






<span class="grey">Korver                      Standards Track                    [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc4945.html">RFC 4945</a>            PKI Profile for IKE/ISAKMP/PKIX          August 2007</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







Korver                      Standards Track                    [Page 43]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc4945 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:38 GMT --></html>