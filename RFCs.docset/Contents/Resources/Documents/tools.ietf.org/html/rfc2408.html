<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc2408 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:53 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:2408" name="DC.Identifier"/>
<meta content="This memo describes a protocol utilizing security concepts necessary
for establishing Security Associations (SA) and cryptographic keys in
an Internet environment. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Maughan, Douglas" name="DC.Creator"/>
<meta content="Schneider, Mark" name="DC.Creator"/>
<meta content="November, 1998" name="DC.Date.Issued"/>
<meta content="Internet Security Association and Key Management Protocol (ISAKMP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 2408 - Internet Security Association and Key Management Protocol (ISAKMP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc2408.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc2408" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ipsec-isakmp" title="draft-ietf-ipsec-isakmp">draft-ietf-ipse...</a>] [<a href="https://datatracker.ietf.org/doc/rfc2408" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc2408" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc2408" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=2408&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc4306.html">4306</a>                                     PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                      D. Maughan
Request for Comments: 2408                   National Security Agency
Category: Standards Track                                M. Schertler
                                                       Securify, Inc.
                                                         M. Schneider
                                             National Security Agency
                                                            J. Turner
                                              RABA Technologies, Inc.
                                                        November 1998


   <span class="h1">Internet Security Association and Key Management Protocol (ISAKMP)</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (1998).  All Rights Reserved.

Abstract

   This memo describes a protocol utilizing security concepts necessary
   for establishing Security Associations (SA) and cryptographic keys in
   an Internet environment.  A Security Association protocol that
   negotiates, establishes, modifies and deletes Security Associations
   and their attributes is required for an evolving Internet, where
   there will be numerous security mechanisms and several options for
   each security mechanism.  The key management protocol must be robust
   in order to handle public key generation for the Internet community
   at large and private key requirements for those private networks with
   that requirement.  The Internet Security Association and Key
   Management Protocol (ISAKMP) defines the procedures for
   authenticating a communicating peer, creation and management of
   Security Associations, key generation techniques, and threat
   mitigation (e.g.  denial of service and replay attacks).  All of
   these are necessary to establish and maintain secure communications
   (via IP Security Service or any other security protocol) in an
   Internet environment.







<span class="grey">Maughan, et. al.            Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


Table of Contents

   1 Introduction                                                     4
     <a href="#section-1.1">1.1</a> Requirements Terminology  . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-1.2">1.2</a> The Need for Negotiation  . . . . . . . . . . . . . . . . .  <a href="#page-5">5</a>
     <a href="#section-1.3">1.3</a> What can be Negotiated?   . . . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
     <a href="#section-1.4">1.4</a> Security Associations and Management  . . . . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-1.4.1">1.4.1</a> Security Associations and Registration  . . . . . . . .  <a href="#page-7">7</a>
       <a href="#section-1.4.2">1.4.2</a> ISAKMP Requirements   . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
     <a href="#section-1.5">1.5</a> Authentication  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
       <a href="#section-1.5.1">1.5.1</a> Certificate Authorities   . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
       <a href="#section-1.5.2">1.5.2</a> Entity Naming   . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
       <a href="#section-1.5.3">1.5.3</a> ISAKMP Requirements   . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
     <a href="#section-1.6">1.6</a> Public Key Cryptography . . . . . . . . . . . . . . . . . . <a href="#page-10">10</a>
       <a href="#section-1.6.1">1.6.1</a> Key Exchange Properties   . . . . . . . . . . . . . . . <a href="#page-11">11</a>
       <a href="#section-1.6.2">1.6.2</a> ISAKMP Requirements   . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
     <a href="#section-1.7">1.7</a> ISAKMP Protection . . . . . . . . . . . . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-1.7.1">1.7.1</a> Anti-Clogging (Denial of Service)   . . . . . . . . . . <a href="#page-12">12</a>
       <a href="#section-1.7.2">1.7.2</a> Connection Hijacking  . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
       <a href="#section-1.7.3">1.7.3</a> Man-in-the-Middle Attacks   . . . . . . . . . . . . . . <a href="#page-13">13</a>
     <a href="#section-1.8">1.8</a> Multicast Communications  . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   2 Terminology and Concepts                                        14
     <a href="#section-2.1">2.1</a> ISAKMP Terminology  . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
     <a href="#section-2.2">2.2</a> ISAKMP Placement  . . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-2.3">2.3</a> Negotiation Phases  . . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
     <a href="#section-2.4">2.4</a> Identifying Security Associations . . . . . . . . . . . . . <a href="#page-17">17</a>
     <a href="#section-2.5">2.5</a> Miscellaneous . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
       <a href="#section-2.5.1">2.5.1</a> Transport Protocol  . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
       <a href="#section-2.5.2">2.5.2</a> RESERVED Fields   . . . . . . . . . . . . . . . . . . . <a href="#page-20">20</a>
       <a href="#section-2.5.3">2.5.3</a> Anti-Clogging Token ("Cookie") Creation   . . . . . . . <a href="#page-20">20</a>
   3 ISAKMP Payloads                                                 21
     <a href="#section-3.1">3.1</a> ISAKMP Header Format  . . . . . . . . . . . . . . . . . . . <a href="#page-21">21</a>
     <a href="#section-3.2">3.2</a> Generic Payload Header  . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
     <a href="#section-3.3">3.3</a> Data Attributes . . . . . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
     <a href="#section-3.4">3.4</a> Security Association Payload  . . . . . . . . . . . . . . . <a href="#page-27">27</a>
     <a href="#section-3.5">3.5</a> Proposal Payload  . . . . . . . . . . . . . . . . . . . . . <a href="#page-28">28</a>
     <a href="#section-3.6">3.6</a> Transform Payload . . . . . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
     <a href="#section-3.7">3.7</a> Key Exchange Payload  . . . . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
     <a href="#section-3.8">3.8</a> Identification Payload  . . . . . . . . . . . . . . . . . . <a href="#page-32">32</a>
     <a href="#section-3.9">3.9</a> Certificate Payload . . . . . . . . . . . . . . . . . . . . <a href="#page-33">33</a>
     <a href="#section-3.10">3.10</a> Certificate Request Payload  . . . . . . . . . . . . . . . <a href="#page-34">34</a>
     <a href="#section-3.11">3.11</a> Hash Payload   . . . . . . . . . . . . . . . . . . . . . . <a href="#page-36">36</a>
     <a href="#section-3.12">3.12</a> Signature Payload  . . . . . . . . . . . . . . . . . . . . <a href="#page-37">37</a>
     <a href="#section-3.13">3.13</a> Nonce Payload  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-37">37</a>
     <a href="#section-3.14">3.14</a> Notification Payload   . . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
       <a href="#section-3.14.1">3.14.1</a> Notify Message Types   . . . . . . . . . . . . . . . . <a href="#page-40">40</a>
     <a href="#section-3.15">3.15</a> Delete Payload   . . . . . . . . . . . . . . . . . . . . . <a href="#page-41">41</a>
     <a href="#section-3.16">3.16</a> Vendor ID Payload  . . . . . . . . . . . . . . . . . . . . <a href="#page-43">43</a>



<span class="grey">Maughan, et. al.            Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   4 ISAKMP Exchanges                                                44
     <a href="#section-4.1">4.1</a> ISAKMP Exchange Types . . . . . . . . . . . . . . . . . . . <a href="#page-45">45</a>
       <a href="#section-4.1.1">4.1.1</a> Notation  . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-46">46</a>
     <a href="#section-4.2">4.2</a> Security Association Establishment  . . . . . . . . . . . . <a href="#page-46">46</a>
       <a href="#section-4.2.1">4.2.1</a> Security Association Establishment Examples   . . . . . <a href="#page-48">48</a>
     <a href="#section-4.3">4.3</a> Security Association Modification . . . . . . . . . . . . . <a href="#page-50">50</a>
     <a href="#section-4.4">4.4</a> Base Exchange . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-51">51</a>
     <a href="#section-4.5">4.5</a> Identity Protection Exchange  . . . . . . . . . . . . . . . <a href="#page-52">52</a>
     <a href="#section-4.6">4.6</a> Authentication Only Exchange  . . . . . . . . . . . . . . . <a href="#page-54">54</a>
     <a href="#section-4.7">4.7</a> Aggressive Exchange . . . . . . . . . . . . . . . . . . . . <a href="#page-55">55</a>
     <a href="#section-4.8">4.8</a> Informational Exchange  . . . . . . . . . . . . . . . . . . <a href="#page-57">57</a>
   5 ISAKMP Payload Processing                                       58
     <a href="#section-5.1">5.1</a> General Message Processing  . . . . . . . . . . . . . . . . <a href="#page-58">58</a>
     <a href="#section-5.2">5.2</a> ISAKMP Header Processing  . . . . . . . . . . . . . . . . . <a href="#page-59">59</a>
     <a href="#section-5.3">5.3</a> Generic Payload Header Processing . . . . . . . . . . . . . <a href="#page-61">61</a>
     <a href="#section-5.4">5.4</a> Security Association Payload Processing . . . . . . . . . . <a href="#page-62">62</a>
     <a href="#section-5.5">5.5</a> Proposal Payload Processing . . . . . . . . . . . . . . . . <a href="#page-63">63</a>
     <a href="#section-5.6">5.6</a> Transform Payload Processing  . . . . . . . . . . . . . . . <a href="#page-64">64</a>
     <a href="#section-5.7">5.7</a> Key Exchange Payload Processing . . . . . . . . . . . . . . <a href="#page-65">65</a>
     <a href="#section-5.8">5.8</a> Identification Payload Processing . . . . . . . . . . . . . <a href="#page-66">66</a>
     <a href="#section-5.9">5.9</a> Certificate Payload Processing  . . . . . . . . . . . . . . <a href="#page-66">66</a>
     <a href="#section-5.10">5.10</a> Certificate Request Payload Processing   . . . . . . . . . <a href="#page-67">67</a>
     <a href="#section-5.11">5.11</a> Hash Payload Processing  . . . . . . . . . . . . . . . . . <a href="#page-69">69</a>
     <a href="#section-5.12">5.12</a> Signature Payload Processing   . . . . . . . . . . . . . . <a href="#page-69">69</a>
     <a href="#section-5.13">5.13</a> Nonce Payload Processing   . . . . . . . . . . . . . . . . <a href="#page-70">70</a>
     <a href="#section-5.14">5.14</a> Notification Payload Processing  . . . . . . . . . . . . . <a href="#page-71">71</a>
     <a href="#section-5.15">5.15</a> Delete Payload Processing  . . . . . . . . . . . . . . . . <a href="#page-73">73</a>
   6 Conclusions                                                     75
   A ISAKMP Security Association Attributes                          77
     <a href="#appendix-A.1">A.1</a> Background/Rationale  . . . . . . . . . . . . . . . . . . . <a href="#page-77">77</a>
     <a href="#appendix-A.2">A.2</a> Internet IP Security DOI Assigned Value . . . . . . . . . . <a href="#page-77">77</a>
     <a href="#appendix-A.3">A.3</a> Supported Security Protocols  . . . . . . . . . . . . . . . <a href="#page-77">77</a>
     <a href="#appendix-A.4">A.4</a> ISAKMP Identification Type Values . . . . . . . . . . . . . <a href="#page-78">78</a>
       <a href="#appendix-A.4.1">A.4.1</a> ID_IPV4_ADDR  . . . . . . . . . . . . . . . . . . . . . <a href="#page-78">78</a>
       <a href="#appendix-A.4.2">A.4.2</a> ID_IPV4_ADDR_SUBNET . . . . . . . . . . . . . . . . . . <a href="#page-78">78</a>
       <a href="#appendix-A.4.3">A.4.3</a> ID_IPV6_ADDR  . . . . . . . . . . . . . . . . . . . . . <a href="#page-78">78</a>
       <a href="#appendix-A.4.4">A.4.4</a> ID_IPV6_ADDR_SUBNET   . . . . . . . . . . . . . . . . . <a href="#page-78">78</a>
   B Defining a new Domain of Interpretation                         79
     <a href="#appendix-B.1">B.1</a> Situation . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-79">79</a>
     <a href="#appendix-B.2">B.2</a> Security Policies . . . . . . . . . . . . . . . . . . . . . <a href="#page-80">80</a>
     <a href="#appendix-B.3">B.3</a> Naming Schemes  . . . . . . . . . . . . . . . . . . . . . . <a href="#page-80">80</a>
     <a href="#appendix-B.4">B.4</a> Syntax for Specifying Security Services . . . . . . . . . . <a href="#page-80">80</a>
     <a href="#appendix-B.5">B.5</a> Payload Specification . . . . . . . . . . . . . . . . . . . <a href="#page-80">80</a>
     <a href="#appendix-B.6">B.6</a> Defining new Exchange Types . . . . . . . . . . . . . . . . <a href="#page-80">80</a>
   Security Considerations                                           81
   IANA Considerations                                               81
   Domain of Interpretation                                          81
   Supported Security Protocols                                      82



<span class="grey">Maughan, et. al.            Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   Acknowledgements                                                  82
   References                                                        82
   Authors' Addresses                                                85
   Full Copyright Statement                                          86

List of Figures

   <a href="#section-1">1</a>   ISAKMP Relationships  . . . . . . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-2">2</a>   ISAKMP Header Format  . . . . . . . . . . . . . . . . . . . <a href="#page-22">22</a>
   <a href="#section-3">3</a>   Generic Payload Header  . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-4">4</a>   Data Attributes . . . . . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
   <a href="#section-5">5</a>   Security Association Payload  . . . . . . . . . . . . . . . <a href="#page-27">27</a>
   <a href="#section-6">6</a>   Proposal Payload Format . . . . . . . . . . . . . . . . . . <a href="#page-28">28</a>
   <a href="#section-7">7</a>   Transform Payload Format  . . . . . . . . . . . . . . . . . <a href="#page-30">30</a>
   <a href="#section-8">8</a>   Key Exchange Payload Format . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
   <a href="#section-9">9</a>   Identification Payload Format . . . . . . . . . . . . . . . <a href="#page-32">32</a>
   <a href="#section-10">10</a>  Certificate Payload Format  . . . . . . . . . . . . . . . . <a href="#page-33">33</a>
   <a href="#section-11">11</a>  Certificate Request Payload Format  . . . . . . . . . . . . <a href="#page-34">34</a>
   <a href="#section-12">12</a>  Hash Payload Format . . . . . . . . . . . . . . . . . . . . <a href="#page-36">36</a>
   <a href="#section-13">13</a>  Signature Payload Format  . . . . . . . . . . . . . . . . . <a href="#page-37">37</a>
   <a href="#section-14">14</a>  Nonce Payload Format  . . . . . . . . . . . . . . . . . . . <a href="#page-38">38</a>
   <a href="#section-15">15</a>  Notification Payload Format . . . . . . . . . . . . . . . . <a href="#page-39">39</a>
   <a href="#section-16">16</a>  Delete Payload Format . . . . . . . . . . . . . . . . . . . <a href="#page-42">42</a>
   <a href="#section-17">17</a>  Vendor ID Payload Format  . . . . . . . . . . . . . . . . . <a href="#page-44">44</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a> Introduction</span>

   This document describes an Internet Security Association and Key
   Management Protocol (ISAKMP). ISAKMP combines the security concepts
   of authentication, key management, and security associations to
   establish the required security for government, commercial, and
   private communications on the Internet.

   The Internet Security Association and Key Management Protocol
   (ISAKMP) defines procedures and packet formats to establish,
   negotiate, modify and delete Security Associations (SA). SAs contain
   all the information required for execution of various network
   security services, such as the IP layer services (such as header
   authentication and payload encapsulation), transport or application
   layer services, or self-protection of negotiation traffic.  ISAKMP
   defines payloads for exchanging key generation and authentication
   data.  These formats provide a consistent framework for transferring
   key and authentication data which is independent of the key
   generation technique, encryption algorithm and authentication
   mechanism.






<span class="grey">Maughan, et. al.            Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   ISAKMP is distinct from key exchange protocols in order to cleanly
   separate the details of security association management (and key
   management) from the details of key exchange.  There may be many
   different key exchange protocols, each with different security
   properties.  However, a common framework is required for agreeing to
   the format of SA attributes, and for negotiating, modifying, and
   deleting SAs.  ISAKMP serves as this common framework.

   Separating the functionality into three parts adds complexity to the
   security analysis of a complete ISAKMP implementation.  However, the
   separation is critical for interoperability between systems with
   differing security requirements, and should also simplify the
   analysis of further evolution of a ISAKMP server.

   ISAKMP is intended to support the negotiation of SAs for security
   protocols at all layers of the network stack (e.g., IPSEC, TLS, TLSP,
   OSPF, etc.).  By centralizing the management of the security
   associations, ISAKMP reduces the amount of duplicated functionality
   within each security protocol.  ISAKMP can also reduce connection
   setup time, by negotiating a whole stack of services at once.

   The remainder of <a href="#section-1">section 1</a> establishes the motivation for security
   negotiation and outlines the major components of ISAKMP, i.e.
   Security Associations and Management, Authentication, Public Key
   Cryptography, and Miscellaneous items.  <a href="#section-2">Section 2</a> presents the
   terminology and concepts associated with ISAKMP. <a href="#section-3">Section 3</a> describes
   the different ISAKMP payload formats.  <a href="#section-4">Section 4</a> describes how the
   payloads of ISAKMP are composed together as exchange types to
   establish security associations and perform key exchanges in an
   authenticated manner.  Additionally, security association
   modification, deletion, and error notification are discussed.
   <a href="#section-5">Section 5</a> describes the processing of each payload within the context
   of ISAKMP exchanges, including error handling and associated actions.
   The appendices provide the attribute values necessary for ISAKMP and
   requirement for defining a new Domain of Interpretation (DOI) within
   ISAKMP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1%20Requirements%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a> Requirements Terminology</span>

   The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD,
   SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL, when they appear in this
   document, are to be interpreted as described in [<a href="rfc2119.html" title='"Key Words for use in RFCs to Indicate Requirement Levels"'>RFC-2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2%20The%20Need%20for%20Negotiation"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a> The Need for Negotiation</span>

   ISAKMP extends the assertion in [<a href="#ref-DOW92" title="P. Van Oorschot">DOW92</a>] that authentication and key
   exchanges must be combined for better security to include security
   association exchanges.  The security services required for



<span class="grey">Maughan, et. al.            Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   communications depends on the individual network configurations and
   environments.  Organizations are setting up Virtual Private Networks
   (VPN), also known as Intranets, that will require one set of security
   functions for communications within the VPN and possibly many
   different security functions for communications outside the VPN to
   support geographically separate organizational components, customers,
   suppliers, sub-contractors (with their own VPNs), government, and
   others.  Departments within large organizations may require a number
   of security associations to separate and protect data (e.g.
   personnel data, company proprietary data, medical) on internal
   networks and other security associations to communicate within the
   same department.  Nomadic users wanting to "phone home" represent
   another set of security requirements.  These requirements must be
   tempered with bandwidth challenges.  Smaller groups of people may
   meet their security requirements by setting up "Webs of Trust".
   ISAKMP exchanges provide these assorted networking communities the
   ability to present peers with the security functionality that the
   user supports in an authenticated and protected manner for agreement
   upon a common set of security attributes, i.e.  an interoperable
   security association.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3%20What%20can%20be%20Negotiated%3F"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a> What can be Negotiated?</span>

   Security associations must support different encryption algorithms,
   authentication mechanisms, and key establishment algorithms for other
   security protocols, as well as IP Security.  Security associations
   must also support host-oriented certificates for lower layer
   protocols and user- oriented certificates for higher level protocols.
   Algorithm and mechanism independence is required in applications such
   as e-mail, remote login, and file transfer, as well as in session
   oriented protocols, routing protocols, and link layer protocols.
   ISAKMP provides a common security association and key establishment
   protocol for this wide range of security protocols, applications,
   security requirements, and network environments.

   ISAKMP is not bound to any specific cryptographic algorithm, key
   generation technique, or security mechanism.  This flexibility is
   beneficial for a number of reasons.  First, it supports the dynamic
   communications environment described above.  Second, the independence
   from specific security mechanisms and algorithms provides a forward
   migration path to better mechanisms and algorithms.  When improved
   security mechanisms are developed or new attacks against current
   encryption algorithms, authentication mechanisms and key exchanges
   are discovered, ISAKMP will allow the updating of the algorithms and
   mechanisms without having to develop a completely new KMP or patch
   the current one.





<span class="grey">Maughan, et. al.            Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   ISAKMP has basic requirements for its authentication and key exchange
   components.  These requirements guard against denial of service,
   replay / reflection, man-in-the-middle, and connection hijacking
   attacks.  This is important because these are the types of attacks
   that are targeted against protocols.  Complete Security Association
   (SA) support, which provides mechanism and algorithm independence,
   and protection from protocol threats are the strengths of ISAKMP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4%20Security%20Associations%20and%20Management"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a> Security Associations and Management</span>

   A Security Association (SA) is a relationship between two or more
   entities that describes how the entities will utilize security
   services to communicate securely.  This relationship is represented
   by a set of information that can be considered a contract between the
   entities.  The information must be agreed upon and shared between all
   the entities.  Sometimes the information alone is referred to as an
   SA, but this is just a physical instantiation of the existing
   relationship.  The existence of this relationship, represented by the
   information, is what provides the agreed upon security information
   needed by entities to securely interoperate.  All entities must
   adhere to the SA for secure communications to be possible.  When
   accessing SA attributes, entities use a pointer or identifier refered
   to as the Security Parameter Index (SPI). [<a href="#ref-SEC-ARCH" title='"Security Architecture for the Internet Protocol"'>SEC-ARCH</a>] provides details
   on IP Security Associations (SA) and Security Parameter Index (SPI)
   definitions.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.4.1%20Security%20Associations%20and%20Registration"></a><a class="selflink" href="#section-1.4.1" name="section-1.4.1">1.4.1</a> Security Associations and Registration</span>

   The SA attributes required and recommended for the IP Security (AH,
   ESP) are defined in [<a href="#ref-SEC-ARCH" title='"Security Architecture for the Internet Protocol"'>SEC-ARCH</a>].  The attributes specified for an IP
   Security SA include, but are not limited to, authentication
   mechanism, cryptographic algorithm, algorithm mode, key length, and
   Initialization Vector (IV).  Other protocols that provide algorithm
   and mechanism independent security MUST define their requirements for
   SA attributes.  The separation of ISAKMP from a specific SA
   definition is important to ensure ISAKMP can es tablish SAs for all
   possible security protocols and applications.

   NOTE: See [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>] for a discussion of SA attributes that should be
   considered when defining a security protocol or application.

   In order to facilitate easy identification of specific attributes
   (e.g.  a specific encryption algorithm) among different network
   entites the attributes must be assigned identifiers and these
   identifiers must be registered by a central authority.  The Internet
   Assigned Numbers Authority (IANA) provides this function for the
   Internet.




<span class="grey">Maughan, et. al.            Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.4.2%20ISAKMP%20Requirements"></a><a class="selflink" href="#section-1.4.2" name="section-1.4.2">1.4.2</a> ISAKMP Requirements</span>

   Security Association (SA) establishment MUST be part of the key
   management protocol defined for IP based networks.  The SA concept is
   required to support security protocols in a diverse and dynamic
   networking environment.  Just as authentication and key exchange must
   be linked to provide assurance that the key is established with the
   authenticated party [<a href="#ref-DOW92" title="P. Van Oorschot">DOW92</a>], SA establishment must be linked with the
   authentication and the key exchange protocol.

   ISAKMP provides the protocol exchanges to establish a security
   association between negotiating entities followed by the
   establishment of a security association by these negotiating entities
   in behalf of some protocol (e.g.  ESP/AH). First, an initial protocol
   exchange allows a basic set of security attributes to be agreed upon.
   This basic set provides protection for subsequent ISAKMP exchanges.
   It also indicates the authentication method and key exchange that
   will be performed as part of the ISAKMP protocol.  If a basic set of
   security attributes is already in place between the negotiating
   server entities, the initial ISAKMP exchange may be skipped and the
   establishment of a security association can be done directly.  After
   the basic set of security attributes has been agreed upon, initial
   identity authenticated, and required keys generated, the established
   SA can be used for subsequent communications by the entity that
   invoked ISAKMP.  The basic set of SA attributes that MUST be
   implemented to provide ISAKMP interoperability are defined in
   <a href="#appendix-A">Appendix A</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.5%20Authentication"></a><a class="selflink" href="#section-1.5" name="section-1.5">1.5</a> Authentication</span>

   A very important step in establishing secure network communications
   is authentication of the entity at the other end of the
   communication.  Many authentication mechanisms are available.
   Authentication mechanisms fall into two catagories of strength - weak
   and strong.  Sending cleartext keys or other unprotected
   authenticating information over a network is weak, due to the threat
   of reading them with a network sniffer.  Additionally, sending one-
   way hashed poorly-chosen keys with low entropy is also weak, due to
   the threat of brute-force guessing attacks on the sniffed messages.
   While passwords can be used for establishing identity, they are not
   considered in this context because of recent statements from the
   Internet Architecture Board [<a href="#ref-IAB" title='"Report of the IAB Security Architecture Workshop"'>IAB</a>].  Digital signatures, such as the
   Digital Signature Standard (DSS) and the Rivest-Shamir-Adleman (RSA)
   signature, are public key based strong authentication mechanisms.
   When using public key digital signatures each entity requires a
   public key and a private key.  Certificates are an essential part of
   a digital signature authentication mechanism.  Certificates bind a
   specific entity's identity (be it host, network, user, or



<span class="grey">Maughan, et. al.            Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   application) to its public keys and possibly other security-related
   information such as privileges, clearances, and compartments.
   Authentication based on digital signatures requires a trusted third
   party or certificate authority to create, sign and properly
   distribute certificates.  For more detailed information on digital
   signatures, such as DSS and RSA, and certificates see [<a href="#ref-Schneier" title="and Source Code in C (Second Edition)">Schneier</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.5.1%20Certificate%20Authorities"></a><a class="selflink" href="#section-1.5.1" name="section-1.5.1">1.5.1</a> Certificate Authorities</span>

   Certificates require an infrastructure for generation, verification,
   revocation, management and distribution.  The Internet Policy
   Registration Authority (IPRA) [<a href="rfc1422.html" title='"Privacy Enhancement for Internet Electronic Mail: Part II: Certificate-Based Key Management"'>RFC-1422</a>] has been established to
   direct this infrastructure for the IETF. The IPRA certifies Policy
   Certification Authorities (PCA). PCAs control Certificate Authorities
   (CA) which certify users and subordinate entities.  Current
   certificate related work includes the Domain Name System (DNS)
   Security Extensions [<a href="#ref-DNSSEC" title="Domain Name System Protocol Security Extensions">DNSSEC</a>] which will provide signed entity keys in
   the DNS. The Public Key Infrastucture (PKIX) working group is
   specifying an Internet profile for X.509 certificates.  There is also
   work going on in industry to develop X.500 Directory Services which
   would provide X.509 certificates to users.  The U.S. Post Office is
   developing a (CA) hierarchy.  The NIST Public Key Infrastructure
   Working Group has also been doing work in this area.  The DOD Multi
   Level Information System Security Initiative (MISSI) program has
   begun deploying a certificate infrastructure for the U.S. Government.
   Alternatively, if no infrastructure exists, the PGP Web of Trust
   certificates can be used to provide user authentication and privacy
   in a community of users who know and trust each other.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.5.2%20Entity%20Naming"></a><a class="selflink" href="#section-1.5.2" name="section-1.5.2">1.5.2</a> Entity Naming</span>

   An entity's name is its identity and is bound to its public keys in
   certificates.  The CA MUST define the naming semantics for the
   certificates it issues.  See the UNINETT PCA Policy Statements
   [<a href="#ref-Berge" title='"UNINETT PCA Policy Statements"'>Berge</a>] for an example of how a CA defines its naming policy.  When
   the certificate is verified, the name is verified and that name will
   have meaning within the realm of that CA. An example is the DNS
   security extensions which make DNS servers CAs for the zones and
   nodes they serve.  Resource records are provided for public keys and
   signatures on those keys.  The names associated with the keys are IP
   addresses and domain names which have meaning to entities accessing
   the DNS for this information.  A Web of Trust is another example.
   When webs of trust are set up, names are bound with the public keys.
   In PGP the name is usually the entity's e-mail address which has
   meaning to those, and only those, who understand e-mail.  Another web
   of trust could use an entirely different naming scheme.





<span class="grey">Maughan, et. al.            Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.5.3%20ISAKMP%20Requirements"></a><a class="selflink" href="#section-1.5.3" name="section-1.5.3">1.5.3</a> ISAKMP Requirements</span>

   Strong authentication MUST be provided on ISAKMP exchanges.  Without
   being able to authenticate the entity at the other end, the Security
   Association (SA) and session key established are suspect.  Without
   authentication you are unable to trust an entity's identification,
   which makes access control questionable.  While encryption (e.g.
   ESP) and integrity (e.g.  AH) will protect subsequent communications
   from passive eavesdroppers, without authentication it is possible
   that the SA and key may have been established with an adversary who
   performed an active man-in-the-middle attack and is now stealing all
   your personal data.

   A digital signature algorithm MUST be used within ISAKMP's
   authentication component.  However, ISAKMP does not mandate a
   specific signature algorithm or certificate authority (CA). ISAKMP
   allows an entity initiating communications to indicate which CAs it
   supports.  After selection of a CA, the protocol provides the
   messages required to support the actual authentication exchange.  The
   protocol provides a facility for identification of different
   certificate authorities, certificate types (e.g.  X.509, PKCS #7,
   PGP, DNS SIG and KEY records), and the exchange of the certificates
   identified.

   ISAKMP utilizes digital signatures, based on public key cryptography,
   for authentication.  There are other strong authentication systems
   available, which could be specified as additional optional
   authentication mechanisms for ISAKMP. Some of these authentication
   systems rely on a trusted third party called a key distribution
   center (KDC) to distribute secret session keys.  An example is
   Kerberos, where the trusted third party is the Kerberos server, which
   holds secret keys for all clients and servers within its network
   domain.  A client's proof that it holds its secret key provides
   authenticaton to a server.

   The ISAKMP specification does not specify the protocol for
   communicating with the trusted third parties (TTP) or certificate
   directory services.  These protocols are defined by the TTP and
   directory service themselves and are outside the scope of this
   specification.  The use of these additional services and protocols
   will be described in a Key Exchange specific document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.6%20Public%20Key%20Cryptography"></a><a class="selflink" href="#section-1.6" name="section-1.6">1.6</a> Public Key Cryptography</span>

   Public key cryptography is the most flexible, scalable, and efficient
   way for users to obtain the shared secrets and session keys needed to
   support the large number of ways Internet users will interoperate.
   Many key generation algorithms, that have different properties, are



<span class="grey">Maughan, et. al.            Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   available to users (see [<a href="#ref-DOW92" title="P. Van Oorschot">DOW92</a>], [<a href="#ref-ANSI" title="April 19">ANSI</a>], and [<a href="#ref-Oakley" title='"The Oakley Key Determination Protocol"'>Oakley</a>]).  Properties
   of key exchange protocols include the key establishment method,
   authentication, symmetry, perfect forward secrecy, and back traffic
   protection.

   NOTE: Cryptographic keys can protect information for a considerable
   length of time.  However, this is based on the assumption that keys
   used for protection of communications are destroyed after use and not
   kept for any reason.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.6.1%20Key%20Exchange%20Properties"></a><a class="selflink" href="#section-1.6.1" name="section-1.6.1">1.6.1</a> Key Exchange Properties</span>

   Key Establishment (Key Generation / Key Transport): The two common
   methods of using public key cryptography for key establishment are
   key transport and key generation.  An example of key transport is the
   use of the RSA algorithm to encrypt a randomly generated session key
   (for encrypting subsequent communications) with the recipient's
   public key.  The encrypted random key is then sent to the recipient,
   who decrypts it using his private key.  At this point both sides have
   the same session key, however it was created based on input from only
   one side of the communications.  The benefit of the key transport
   method is that it has less computational overhead than the following
   method.  The Diffie-Hellman (D-H) algorithm illustrates key
   generation using public key cryptography.  The D-H algorithm is begun
   by two users exchanging public information.  Each user then
   mathematically combines the other's public information along with
   their own secret information to compute a shared secret value.  This
   secret value can be used as a session key or as a key encryption key
   for encrypting a randomly generated session key.  This method
   generates a session key based on public and secret information held
   by both users.  The benefit of the D-H algorithm is that the key used
   for encrypting messages is based on information held by both users
   and the independence of keys from one key exchange to another
   provides perfect forward secrecy.  Detailed descriptions of these
   algorithms can be found in [<a href="#ref-Schneier" title="and Source Code in C (Second Edition)">Schneier</a>].  There are a number of
   variations on these two key generation schemes and these variations
   do not necessarily interoperate.

   Key Exchange Authentication: Key exchanges may be authenticated
   during the protocol or after protocol completion.  Authentication of
   the key exchange during the protocol is provided when each party
   provides proof it has the secret session key before the end of the
   protocol.  Proof can be provided by encrypting known data in the
   secret session key during the protocol echange.  Authentication after
   the protocol must occur in subsequent commu nications.
   Authentication during the protocol is preferred so subsequent
   communications are not initiated if the secret session key is not
   established with the desired party.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   Key Exchange Symmetry: A key exchange provides symmetry if either
   party can initiate the exchange and exchanged messages can cross in
   transit without affecting the key that is generated.  This is
   desirable so that computation of the keys does not require either
   party to know who initated the exchange.  While key exchange symmetry
   is desirable, symmetry in the entire key management protocol may
   provide a vulnerablity to reflection attacks.

   Perfect Forward Secrecy: As described in [<a href="#ref-DOW92" title="P. Van Oorschot">DOW92</a>], an authenticated
   key exchange protocol provides perfect forward secrecy if disclosure
   of longterm secret keying material does not compromise the secrecy of
   the exchanged keys from previous communications.  The property of
   perfect forward secrecy does not apply to key exchange without
   authentication.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.6.2%20ISAKMP%20Requirements"></a><a class="selflink" href="#section-1.6.2" name="section-1.6.2">1.6.2</a> ISAKMP Requirements</span>

   An authenticated key exchange MUST be supported by ISAKMP. Users
   SHOULD choose additional key establishment algorithms based on their
   requirements.  ISAKMP does not specify a specific key exchange.
   However, [<a href="#ref-IKE" title='"The Internet Key Exchange (IKE)"'>IKE</a>] describes a proposal for using the Oakley key exchange
   [<a href="#ref-Oakley" title='"The Oakley Key Determination Protocol"'>Oakley</a>] in conjunction with ISAKMP. Requirements that should be
   evaluated when choosing a key establishment algorithm include
   establishment method (generation vs.  transport), perfect forward
   secrecy, computational overhead, key escrow, and key strength.  Based
   on user requirements, ISAKMP allows an entity initiating
   communications to indicate which key exchanges it supports.  After
   selection of a key exchange, the protocol provides the messages
   required to support the actual key establishment.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.7%20ISAKMP%20Protection"></a><a class="selflink" href="#section-1.7" name="section-1.7">1.7</a> ISAKMP Protection</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.7.1%20Anti-Clogging%20%28Denial%20of%20Service%29"></a><a class="selflink" href="#section-1.7.1" name="section-1.7.1">1.7.1</a> Anti-Clogging (Denial of Service)</span>

   Of the numerous security services available, protection against
   denial of service always seems to be one of the most difficult to
   address.  A "cookie" or anti-clogging token (ACT) is aimed at
   protecting the computing resources from attack without spending
   excessive CPU resources to determine its authenticity.  An exchange
   prior to CPU-intensive public key operations can thwart some denial
   of service attempts (e.g.  simple flooding with bogus IP source
   addresses).  Absolute protection against denial of service is
   impossible, but this anti-clogging token provides a technique for
   making it easier to handle.  The use of an anti-clogging token was
   introduced by Karn and Simpson in [<a href="#ref-Karn" title="and B. Simpson">Karn</a>].






<span class="grey">Maughan, et. al.            Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   It should be noted that in the exchanges shown in <a href="#section-4">section 4</a>, the
   anticlogging mechanism should be used in conjuction with a garbage-
   state collection mechanism; an attacker can still flood a server
   using packets with bogus IP addresses and cause state to be created.
   Such aggressive memory management techniques SHOULD be employed by
   protocols using ISAKMP that do not go through an initial, anti-
   clogging only phase, as was done in [<a href="#ref-Karn" title="and B. Simpson">Karn</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.7.2%20Connection%20Hijacking"></a><a class="selflink" href="#section-1.7.2" name="section-1.7.2">1.7.2</a> Connection Hijacking</span>

   ISAKMP prevents connection hijacking by linking the authentication,
   key exchange and security association exchanges.  This linking
   prevents an attacker from allowing the authentication to complete and
   then jumping in and impersonating one entity to the other during the
   key and security association exchanges.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.7.3%20Man-in-the-Middle%20Attacks"></a><a class="selflink" href="#section-1.7.3" name="section-1.7.3">1.7.3</a> Man-in-the-Middle Attacks</span>

   Man-in-the-Middle attacks include interception, insertion, deletion,
   and modification of messages, reflecting messages back at the sender,
   replaying old messages and redirecting messages.  ISAKMP features
   prevent these types of attacks from being successful.  The linking of
   the ISAKMP exchanges prevents the insertion of messages in the
   protocol exchange.  The ISAKMP protocol state machine is defined so
   deleted messages will not cause a partial SA to be created, the state
   machine will clear all state and return to idle.  The state machine
   also prevents reflection of a message from causing harm.  The
   requirement for a new cookie with time variant material for each new
   SA establishment prevents attacks that involve replaying old
   messages.  The ISAKMP strong authentication requirement prevents an
   SA from being established with anyone other than the intended party.
   Messages may be redirected to a different destination or modified but
   this will be detected and an SA will not be established.  The ISAKMP
   specification defines where abnormal processing has occurred and
   recommends notifying the appropriate party of this abnormality.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.8%20Multicast%20Communications"></a><a class="selflink" href="#section-1.8" name="section-1.8">1.8</a> Multicast Communications</span>

   It is expected that multicast communications will require the same
   security services as unicast communications and may introduce the
   need for additional security services.  The issues of distributing
   SPIs for multicast traffic are presented in [<a href="#ref-SEC-ARCH" title='"Security Architecture for the Internet Protocol"'>SEC-ARCH</a>].  Multicast
   security issues are also discussed in [<a href="rfc1949.html" title='"Scalable Multicast Key Distribution"'>RFC-1949</a>] and [<a href="#ref-BC" title="and J. Crowcroft">BC</a>].  A future
   extension to ISAKMP will support multicast key distribution.  For an
   introduction to the issues related to multicast security, consult the
   Internet Drafts, [<a href="rfc2094.html" title='"Group Key Management Protocol (GKMP) Architecture"'>RFC-2094</a>] and [<a href="rfc2093.html" title='"Group Key Management Protocol (GKMP) Specification"'>RFC-2093</a>], describing Sparta's
   research in this area.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2%20Terminology%20and%20Concepts"></a><a class="selflink" href="#section-2" name="section-2">2</a> Terminology and Concepts</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1%20ISAKMP%20Terminology"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a> ISAKMP Terminology</span>

   Security Protocol: A Security Protocol consists of an entity at a
   single point in the network stack, performing a security service for
   network communication.  For example, IPSEC ESP and IPSEC AH are two
   different security protocols.  TLS is another example.  Security
   Protocols may perform more than one service, for example providing
   integrity and confidentiality in one module.

   Protection Suite: A protection suite is a list of the security
   services that must be applied by various security protocols.  For
   example, a protection suite may consist of DES encryption in IP ESP,
   and keyed MD5 in IP AH. All of the protections in a suite must be
   treated as a single unit.  This is necessary because security
   services in different security protocols can have subtle
   interactions, and the effects of a suite must be analyzed and
   verified as a whole.

   Security Association (SA): A Security Association is a security-
   protocol- specific set of parameters that completely defines the
   services and mechanisms necessary to protect traffic at that security
   protocol location.  These parameters can include algorithm
   identifiers, modes, cryptographic keys, etc.  The SA is referred to
   by its associated security protocol (for example, "ISAKMP SA", "ESP
   SA", "TLS SA").

   ISAKMP SA: An SA used by the ISAKMP servers to protect their own
   traffic.  Sections <a href="#section-2.3">2.3</a> and <a href="#section-2.4">2.4</a> provide more details about ISAKMP SAs.

   Security Parameter Index (SPI): An identifier for a Security
   Assocation, relative to some security protocol.  Each security
   protocol has its own "SPI-space".  A (security protocol, SPI) pair
   may uniquely identify an SA. The uniqueness of the SPI is
   implementation dependent, but could be based per system, per
   protocol, or other options.  Depending on the DOI, additional
   information (e.g.  host address) may be necessary to identify an SA.
   The DOI will also determine which SPIs (i.e.  initiator's or
   responder's) are sent during communication.

   Domain of Interpretation: A Domain of Interpretation (DOI) defines
   payload formats, exchange types, and conventions for naming
   security-relevant information such as security policies or
   cryptographic algorithms and modes.  A Domain of Interpretation (DOI)
   identifier is used to interpret the payloads of ISAKMP payloads.  A
   system SHOULD support multiple Domains of Interpretation
   simultaneously.  The concept of a DOI is based on previous work by



<span class="grey">Maughan, et. al.            Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   the TSIG CIPSO Working Group, but extends beyond security label
   interpretation to include naming and interpretation of security
   services.  A DOI defines:

    o  A "situation":  the set of information that will be used to
       determine the required security services.

    o  The set of security policies that must, and may, be supported.

    o  A syntax for the specification of proposed security services.

    o  A scheme for naming security-relevant information, including
       encryption algorithms, key exchange algorithms, security policy
       attributes, and certificate authorities.

    o  The specific formats of the various payload contents.

    o  Additional exchange types, if required.

   The rules for the IETF IP Security DOI are presented in [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].
   Specifications of the rules for customized DOIs will be presented in
   separate documents.

   Situation: A situation contains all of the security-relevant
   information that a system considers necessary to decide the security
   services required to protect the session being negotiated.  The
   situation may include addresses, security classifications, modes of
   operation (normal vs.  emergency), etc.

   Proposal: A proposal is a list, in decreasing order of preference, of
   the protection suites that a system considers acceptable to protect
   traffic under a given situation.

   Payload: ISAKMP defines several types of payloads, which are used to
   transfer information such as security association data, or key
   exchange data, in DOI-defined formats.  A payload consists of a
   generic payload header and a string of octects that is opaque to
   ISAKMP. ISAKMP uses DOI- specific functionality to synthesize and
   interpret these payloads.  Multiple payloads can be sent in a single
   ISAKMP message.  See <a href="#section-3">section 3</a> for more details on the payload types,
   and [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>] for the formats of the IETF IP Security DOI payloads.

   Exchange Type: An exchange type is a specification of the number of
   messages in an ISAKMP exchange, and the payload types that are
   contained in each of those messages.  Each exchange type is designed
   to provide a particular set of security services, such as anonymity
   of the participants, perfect forward secrecy of the keying material,
   authentication of the participants, etc.  <a href="#section-4.1">Section 4.1</a> defines the



<span class="grey">Maughan, et. al.            Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   default set of ISAKMP exchange types.  Other exchange types can be
   added to support additional key exchanges, if required.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2%20ISAKMP%20Placement"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a> ISAKMP Placement</span>

   Figure 1 is a high level view of the placement of ISAKMP within a
   system context in a network architecture.  An important part of
   negotiating security services is to consider the entire "stack" of
   individual SAs as a unit.  This is referred to as a "protection
   suite".

     +------------+        +--------+                +--------------+
     !     DOI    !        !        !                !  Application !
     ! Definition ! &lt;----&gt; ! ISAKMP !                !    Process   !
     +------------+    --&gt; !        !                !--------------!
    +--------------+   !   +--------+                ! Appl Protocol!
    ! Key Exchange !   !     ^  ^                    +--------------+
    !  Definition  !&lt;--      !  !                           ^
    +--------------+         !  !                           !
                             !  !                           !
            !----------------!  !                           !
            v                   !                           !
        +-------+               v                           v
        !  API  !        +---------------------------------------------+
        +-------+        !                Socket Layer                 !
            !            !---------------------------------------------!
            v            !        Transport Protocol (TCP / UDP)       !
     +----------+        !---------------------------------------------!
     ! Security ! &lt;----&gt; !                     IP                      !
     ! Protocol !        !---------------------------------------------!
     +----------+        !             Link Layer Protocol             !
                         +---------------------------------------------+


                     Figure 1:  ISAKMP Relationships

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3%20Negotiation%20Phases"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a> Negotiation Phases</span>

   ISAKMP offers two "phases" of negotiation.  In the first phase, two
   entities (e.g.  ISAKMP servers) agree on how to protect further
   negotiation traffic between themselves, establishing an ISAKMP SA.
   This ISAKMP SA is then used to protect the negotiations for the
   Protocol SA being requested.  Two entities (e.g.  ISAKMP servers) can
   negotiate (and have active) multiple ISAKMP SAs.







<span class="grey">Maughan, et. al.            Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   The second phase of negotiation is used to establish security
   associations for other security protocols.  This second phase can be
   used to establish many security associations.  The security
   associations established by ISAKMP during this phase can be used by a
   security protocol to protect many message/data exchanges.

   While the two-phased approach has a higher start-up cost for most
   simple scenarios, there are several reasons that it is beneficial for
   most cases.

   First, entities (e.g.  ISAKMP servers) can amortize the cost of the
   first phase across several second phase negotiations.  This allows
   multiple SAs to be established between peers over time without having
   to start over for each communication.

   Second, security services negotiated during the first phase provide
   security properties for the second phase.  For example, after the
   first phase of negotiation, the encryption provided by the ISAKMP SA
   can provide identity protection, potentially allowing the use of
   simpler second-phase exchanges.  On the other hand, if the channel
   established during the first phase is not adequate to protect
   identities, then the second phase must negotiate adequate security
   mechanisms.

   Third, having an ISAKMP SA in place considerably reduces the cost of
   ISAKMP management activity - without the "trusted path" that an
   ISAKMP SA gives you, the entities (e.g.  ISAKMP servers) would have
   to go through a complete re-authentication for each error
   notification or deletion of an SA.

   Negotiation during each phase is accomplished using ISAKMP-defined
   exchanges (see <a href="#section-4">section 4</a>) or exchanges defined for a key exchange
   within a DOI.

   Note that security services may be applied differently in each
   negotiation phase.  For example, different parties are being
   authenticated during each of the phases of negotiation.  During the
   first phase, the parties being authenticated may be the ISAKMP
   servers/hosts, while during the second phase, users or application
   level programs are being authenticated.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4%20Identifying%20Security%20Associations"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a> Identifying Security Associations</span>

   While bootstrapping secure channels between systems, ISAKMP cannot
   assume the existence of security services, and must provide some
   protections for itself.  Therefore, ISAKMP considers an ISAKMP
   Security Association to be different than other types, and manages
   ISAKMP SAs itself, in their own name space.  ISAKMP uses the two



<span class="grey">Maughan, et. al.            Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   cookie fields in the ISAKMP header to identify ISAKMP SAs.  The
   Message ID in the ISAKMP Header and the SPI field in the Proposal
   payload are used during SA establishment to identify the SA for other
   security protocols.  The interpretation of these four fields is
   dependent on the operation taking place.

   The following table shows the presence or absence of several fields
   during SA establishment.  The following fields are necessary for
   various operations associated with SA establishment: cookies in the
   ISAKMP header, the ISAKMP Header Message ID field, and the SPI field
   in the Proposal payload.  An 'X' in the column means the value MUST
   be present.  An 'NA' in the column means a value in the column is Not
   Applicable to the operation.

  #             Operation            I-Cookie  R-Cookie  Message ID  SPI
 (1)  Start ISAKMP SA negotiation    X         0         0           0
 (2)  Respond ISAKMP SA negotiation  X         X         0           0
 (3)  Init other SA negotiation      X         X         X           X
 (4)  Respond other SA negotiation   X         X         X           X
 (5)  Other (KE, ID, etc.)           X         X         X/0         NA
 (6)  Security Protocol (ESP, AH)    NA        NA        NA          X

   In the first line (1) of the table, the initiator includes the
   Initiator Cookie field in the ISAKMP Header, using the procedures
   outlined in sections <a href="#section-2.5.3">2.5.3</a> and <a href="#section-3.1">3.1</a>.

   In the second line (2) of the table, the responder includes the
   Initiator and Responder Cookie fields in the ISAKMP Header, using the
   procedures outlined in sections <a href="#section-2.5.3">2.5.3</a> and <a href="#section-3.1">3.1</a>.  Additional messages
   may be exchanged between ISAKMP peers, depending on the ISAKMP
   exchange type used during the phase 1 negotiation.  Once the phase 1
   exchange is completed, the Initiator and Responder cookies are
   included in the ISAKMP Header of all subsequent communications
   between the ISAKMP peers.

   During phase 1 negotiations, the initiator and responder cookies
   determine the ISAKMP SA. Therefore, the SPI field in the Proposal
   payload is redundant and MAY be set to 0 or it MAY contain the
   transmitting entity's cookie.

   In the third line (3) of the table, the initiator associates a
   Message ID with the Protocols contained in the SA Proposal.  This
   Message ID and the initiator's SPI(s) to be associated with each
   protocol in the Proposal are sent to the responder.  The SPI(s) will
   be used by the security protocols once the phase 2 negotiation is
   completed.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   In the fourth line (4) of the table, the responder includes the same
   Message ID and the responder's SPI(s) to be associated with each
   protocol in the accepted Proposal.  This information is returned to
   the initiator.

   In the fifth line (5) of the table, the initiator and responder use
   the Message ID field in the ISAKMP Header to keep track of the in-
   progress protocol negotiation.  This is only applicable for a phase 2
   exchange and the value MUST be 0 for a phase 1 exchange because the
   combined cookies identify the ISAKMP SA. The SPI field in the
   Proposal payload is not applicable because the Proposal payload is
   only used during the SA negotiation message exchange (steps 3 and 4).

   In the sixth line (6) of the table, the phase 2 negotiation is
   complete.  The security protocols use the SPI(s) to determine which
   security services and mechanisms to apply to the communication
   between them.  The SPI value shown in the sixth line (6) is not the
   SPI field in the Proposal payload, but the SPI field contained within
   the security protocol header.

   During the SA establishment, a SPI MUST be generated.  ISAKMP is
   designed to handle variable sized SPIs.  This is accomplished by
   using the SPI Size field within the Proposal payload during SA
   establishment.  Handling of SPIs will be outlined by the DOI
   specification (e.g.  [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>]).

   When a security association (SA) is initially established, one side
   assumes the role of initiator and the other the role of responder.
   Once the SA is established, both the original initiator and responder
   can initiate a phase 2 negotiation with the peer entity.  Thus,
   ISAKMP SAs are bidirectional in nature.

   Additionally, ISAKMP allows both initiator and responder to have some
   control during the negotiation process.  While ISAKMP is designed to
   allow an SA negotiation that includes multiple proposals, the
   initiator can maintain some control by only making one proposal in
   accordance with the initiator's local security policy.  Once the
   initiator sends a proposal containing more than one proposal (which
   are sent in decreasing preference order), the initiator relinquishes
   control to the responder.  Once the responder is controlling the SA
   establishment, the responder can make its policy take precedence over
   the initiator within the context of the multiple options offered by
   the initiator.  This is accomplished by selecting the proposal best
   suited for the responder's local security policy and returning this
   selection to the initiator.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5%20Miscellaneous"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a> Miscellaneous</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.1%20Transport%20Protocol"></a><a class="selflink" href="#section-2.5.1" name="section-2.5.1">2.5.1</a> Transport Protocol</span>

   ISAKMP can be implemented over any transport protocol or over IP
   itself.  Implementations MUST include send and receive capability for
   ISAKMP using the User Datagram Protocol (UDP) on port 500.  UDP Port
   500 has been assigned to ISAKMP by the Internet Assigned Numbers
   Authority (IANA). Implementations MAY additionally support ISAKMP
   over other transport protocols or over IP itself.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.2%20RESERVED%20Fields"></a><a class="selflink" href="#section-2.5.2" name="section-2.5.2">2.5.2</a> RESERVED Fields</span>

   The existence of RESERVED fields within ISAKMP payloads are used
   strictly to preserve byte alignment.  All RESERVED fields in the
   ISAKMP protocol MUST be set to zero (0) when a packet is issued.  The
   receiver SHOULD check the RESERVED fields for a zero (0) value and
   discard the packet if other values are found.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.5.3%20Anti-Clogging%20Token%20%28%22Cookie%22%29%20Creation"></a><a class="selflink" href="#section-2.5.3" name="section-2.5.3">2.5.3</a> Anti-Clogging Token ("Cookie") Creation</span>

   The details of cookie generation are implementation dependent, but
   MUST satisfy these basic requirements (originally stated by Phil Karn
   in [<a href="#ref-Karn" title="and B. Simpson">Karn</a>]):

      1.    The cookie must depend on the specific parties.  This
            prevents an attacker from obtaining a cookie using a real IP
            address and UDP port, and then using it to swamp the victim
            with Diffie-Hellman requests from randomly chosen IP
            addresses or ports.

      2.    It must not be possible for anyone other than the issuing
            entity to generate cookies that will be accepted by that
            entity.  This implies that the issuing entity must use local
            secret information in the generation and subsequent
            verification of a cookie.  It must not be possible to deduce
            this secret information from any particular cookie.

      3.    The cookie generation function must be fast to thwart
            attacks intended to sabotage CPU resources.

   Karn's suggested method for creating the cookie is to perform a fast
   hash (e.g.  MD5) over the IP Source and Destination Address, the UDP
   Source and Destination Ports and a locally generated secret random
   value.  ISAKMP requires that the cookie be unique for each SA
   establishment to help prevent replay attacks, therefore, the date and
   time MUST be added to the information hashed.  The generated cookies
   are placed in the ISAKMP Header (described in <a href="#section-3.1">section 3.1</a>) Initiator



<span class="grey">Maughan, et. al.            Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   and Responder cookie fields.  These fields are 8 octets in length,
   thus, requiring a generated cookie to be 8 octets.  Notify and Delete
   messages (see sections <a href="#section-3.14">3.14</a>, <a href="#section-3.15">3.15</a>, and <a href="#section-4.8">4.8</a>) are uni-directional
   transmissions and are done under the protection of an existing ISAKMP
   SA, thus, not requiring the generation of a new cookie.  One
   exception to this is the transmission of a Notify message during a
   Phase 1 exchange, prior to completing the establishment of an SA.
   Sections <a href="#section-3.14">3.14</a> and <a href="#section-4.8">4.8</a> provide additional details.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3%20ISAKMP%20Payloads"></a><a class="selflink" href="#section-3" name="section-3">3</a> ISAKMP Payloads</span>

   ISAKMP payloads provide modular building blocks for constructing
   ISAKMP messages.  The presence and ordering of payloads in ISAKMP is
   defined by and dependent upon the Exchange Type Field located in the
   ISAKMP Header (see Figure 2).  The ISAKMP payload types are discussed
   in sections <a href="#section-3.4">3.4</a> through <a href="#section-3.15">3.15</a>.  The descriptions of the ISAKMP
   payloads, messages, and exchanges (see <a href="#section-4">Section 4</a>) are shown using
   network octet ordering.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1%20ISAKMP%20Header%20Format"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a> ISAKMP Header Format</span>

   An ISAKMP message has a fixed header format, shown in Figure 2,
   followed by a variable number of payloads.  A fixed header simplifies
   parsing, providing the benefit of protocol parsing software that is
   less complex and easier to implement.  The fixed header contains the
   information required by the protocol to maintain state, process
   payloads and possibly prevent denial of service or replay attacks.

   The ISAKMP Header fields are defined as follows:

    o  Initiator Cookie (8 octets) - Cookie of entity that initiated SA
       establishment, SA notification, or SA deletion.

    o  Responder Cookie (8 octets) - Cookie of entity that is responding
       to an SA establishment request, SA notification, or SA deletion.
















<span class="grey">Maughan, et. al.            Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                         1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    !                          Initiator                            !
    !                            Cookie                             !
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    !                          Responder                            !
    !                            Cookie                             !
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    !  Next Payload ! MjVer ! MnVer ! Exchange Type !     Flags     !
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    !                          Message ID                           !
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    !                            Length                             !
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                 Figure 2:  ISAKMP Header Format

    o  Next Payload (1 octet) - Indicates the type of the first payload
       in the message.  The format for each payload is defined in
       sections <a href="#section-3.4">3.4</a> through <a href="#section-3.16">3.16</a>.  The processing for the payloads is
       defined in <a href="#section-5">section 5</a>.


                        Next Payload Type       Value
                    NONE                           0
                    Security Association (SA)      1
                    Proposal (P)                   2
                    Transform (T)                  3
                    Key Exchange (KE)              4
                    Identification (ID)            5
                    Certificate (CERT)             6
                    Certificate Request (CR)       7
                    Hash (HASH)                    8
                    Signature (SIG)                9
                    Nonce (NONCE)                 10
                    Notification (N)              11
                    Delete (D)                    12
                    Vendor ID (VID)               13
                    RESERVED                   14 - 127
                    Private USE               128 - 255

    o  Major Version (4 bits) - indicates the major version of the ISAKMP
       protocol in use.  Implementations based on this version of the
       ISAKMP Internet-Draft MUST set the Major Version to 1.
       Implementations based on previous versions of ISAKMP Internet-
       Drafts MUST set the Major Version to 0.  Implementations SHOULD



<span class="grey">Maughan, et. al.            Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       never accept packets with a major version number larger than its
       own.

    o  Minor Version (4 bits) - indicates the minor version of the
       ISAKMP protocol in use.  Implementations based on this version of
       the ISAKMP Internet-Draft MUST set the Minor Version to 0.
       Implementations based on previous versions of ISAKMP Internet-
       Drafts MUST set the Minor Version to 1.  Implementations SHOULD
       never accept packets with a minor version number larger than its
       own, given the major version numbers are identical.

    o  Exchange Type (1 octet) - indicates the type of exchange being
       used.  This dictates the message and payload orderings in the
       ISAKMP exchanges.


                            Exchange Type      Value
                         NONE                    0
                         Base                    1
                         Identity Protection     2
                         Authentication Only     3
                         Aggressive              4
                         Informational           5
                         ISAKMP Future Use     6 - 31
                         DOI Specific Use     32 - 239
                         Private Use         240 - 255

    o  Flags (1 octet) - indicates specific options that are set for the
       ISAKMP exchange.  The flags listed below are specified in the
       Flags field beginning with the least significant bit, i.e the
       Encryption bit is bit 0 of the Flags field, the Commit bit is bit
       1 of the Flags field, and the Authentication Only bit is bit 2 of
       the Flags field.  The remaining bits of the Flags field MUST be
       set to 0 prior to transmission.

      --  E(ncryption Bit) (1 bit) - If set (1), all payloads following
          the header are encrypted using the encryption algorithm
          identified in the ISAKMP SA. The ISAKMP SA Identifier is the
          combination of the initiator and responder cookie.  It is
          RECOMMENDED that encryption of communications be done as soon
          as possible between the peers.  For all ISAKMP exchanges
          described in <a href="#section-4.1">section 4.1</a>, the encryption SHOULD begin after
          both parties have exchanged Key Exchange payloads.  If the
          E(ncryption Bit) is not set (0), the payloads are not
          encrypted.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


      -- C(ommit Bit) (1 bit) - This bit is used to signal key exchange
          synchronization.  It is used to ensure that encrypted material
          is not received prior to completion of the SA establishment.
          The Commit Bit can be set (at anytime) by either party
          participating in the SA establishment, and can be used during
          both phases of an ISAKMP SA establishment.  However, the value
          MUST be reset after the Phase 1 negotiation.  If set(1), the
          entity which did not set the Commit Bit MUST wait for an
          Informational Exchange containing a Notify payload (with the
          CONNECTED Notify Message) from the entity which set the Commit
          Bit.  In this instance, the Message ID field of the
          Informational Exchange MUST contain the Message ID of the
          original ISAKMP Phase 2 SA negotiation.  This is done to
          ensure that the Informational Exchange with the CONNECTED
          Notify Message can be associated with the correct Phase 2 SA.
          The receipt and processing of the Informational Exchange
          indicates that the SA establishment was successful and either
          entity can now proceed with encrypted traffic communication.
          In addition to synchronizing key exchange, the Commit Bit can
          be used to protect against loss of transmissions over
          unreliable networks and guard against the need for multiple
          re-transmissions.

          NOTE: It is always possible that the final message of an
          exchange can be lost.  In this case, the entity expecting to
          receive the final message of an exchange would receive the
          Phase 2 SA negotiation message following a Phase 1 exchange or
          encrypted traffic following a Phase 2 exchange.  Handling of
          this situation is not standardized, but we propose the
          following possibilities.  If the entity awaiting the
          Informational Exchange can verify the received message (i.e.
          Phase 2 SA negotiation message or encrypted traffic), then
          they MAY consider the SA was established and continue
          processing.  The other option is to retransmit the last ISAKMP
          message to force the other entity to retransmit the final
          message.  This suggests that implementations may consider
          retaining the last message (locally) until they are sure the
          SA is established.

      --  A(uthentication Only Bit) (1 bit) - This bit is intended for
          use with the Informational Exchange with a Notify payload and
          will allow the transmission of information with integrity
          checking, but no encryption (e.g.  "emergency mode").  <a href="#section-4.8">Section</a>
          <a href="#section-4.8">4.8</a> states that a Phase 2 Informational Exchange MUST be sent
          under the protection of an ISAKMP SA. This is the only
          exception to that policy.  If the Authentication Only bit is
          set (1), only authentication security services will be applied
          to the entire Notify payload of the Informational Exchange and



<span class="grey">Maughan, et. al.            Standards Track                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


          the payload will not be encrypted.

    o  Message ID (4 octets) - Unique Message Identifier used to
       identify protocol state during Phase 2 negotiations.  This value
       is randomly generated by the initiator of the Phase 2
       negotiation.  In the event of simultaneous SA establishments
       (i.e.  collisions), the value of this field will likely be
       different because they are independently generated and, thus, two
       security associations will progress toward establishment.
       However, it is unlikely there will be absolute simultaneous
       establishments.  During Phase 1 negotiations, the value MUST be
       set to 0.

    o  Length (4 octets) - Length of total message (header + payloads)
       in octets.  Encryption can expand the size of an ISAKMP message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2%20Generic%20Payload%20Header"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a> Generic Payload Header</span>

   Each ISAKMP payload defined in sections <a href="#section-3.4">3.4</a> through <a href="#section-3.16">3.16</a> begins with
   a generic header, shown in Figure 3, which provides a payload
   "chaining" capability and clearly defines the boundaries of a
   payload.

                            1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       ! Next Payload  !   RESERVED    !         Payload Length        !
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 3:  Generic Payload Header

   The Generic Payload Header fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.  This field provides
       the "chaining" capability.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3%20Data%20Attributes"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a> Data Attributes</span>

   There are several instances within ISAKMP where it is necessary to
   represent Data Attributes.  An example of this is the Security
   Association (SA) Attributes contained in the Transform payload



<span class="grey">Maughan, et. al.            Standards Track                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   (described in <a href="#section-3.6">section 3.6</a>).  These Data Attributes are not an ISAKMP
   payload, but are contained within ISAKMP payloads.  The format of the
   Data Attributes provides the flexibility for representation of many
   different types of information.  There can be multiple Data
   Attributes within a payload.  The length of the Data Attributes will
   either be 4 octets or defined by the Attribute Length field.  This is
   done using the Attribute Format bit described below.  Specific
   information about the attributes for each domain will be described in
   a DOI document, e.g.  IPSEC DOI [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !A!       Attribute Type        !    AF=0  Attribute Length     !
     !F!                             !    AF=1  Attribute Value      !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     .                   AF=0  Attribute Value                       .
     .                   AF=1  Not Transmitted                       .
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                     Figure 4:  Data Attributes

   The Data Attributes fields are defined as follows:

    o  Attribute Type (2 octets) - Unique identifier for each type of
       attribute.  These attributes are defined as part of the DOI-
       specific information.

       The most significant bit, or Attribute Format (AF), indicates
       whether the data attributes follow the Type/Length/Value (TLV)
       format or a shortened Type/Value (TV) format.  If the AF bit is a
       zero (0), then the Data Attributes are of the Type/Length/Value
       (TLV) form.  If the AF bit is a one (1), then the Data Attributes
       are of the Type/Value form.

    o  Attribute Length (2 octets) - Length in octets of the Attribute
       Value.  When the AF bit is a one (1), the Attribute Value is only
       2 octets and the Attribute Length field is not present.

    o  Attribute Value (variable length) - Value of the attribute
       associated with the DOI-specific Attribute Type.  If the AF bit
       is a zero (0), this field has a variable length defined by the
       Attribute Length field.  If the AF bit is a one (1), the
       Attribute Value has a length of 2 octets.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4%20Security%20Association%20Payload"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a> Security Association Payload</span>

   The Security Association Payload is used to negotiate security
   attributes and to indicate the Domain of Interpretation (DOI) and
   Situation under which the negotiation is taking place.  Figure 5
   shows the format of the Security Association payload.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !              Domain of Interpretation  (DOI)                  !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                           Situation                           ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


              Figure 5:  Security Association Payload

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.  This field MUST NOT
       contain the values for the Proposal or Transform payloads as they
       are considered part of the security association negotiation.  For
       example, this field would contain the value "10" (Nonce payload)
       in the first message of a Base Exchange (see <a href="#section-4.4">Section 4.4</a>) and the
       value "0" in the first message of an Identity Protect Exchange
       (see <a href="#section-4.5">Section 4.5</a>).

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the entire
       Security Association payload, including the SA payload, all
       Proposal payloads, and all Transform payloads associated with the
       proposed Security Association.

    o  Domain of Interpretation (4 octets) - Identifies the DOI (as
       described in <a href="#section-2.1">Section 2.1</a>) under which this negotiation is taking
       place.  The DOI is a 32-bit unsigned integer.  A DOI value of 0
       during a Phase 1 exchange specifies a Generic ISAKMP SA which can
       be used for any protocol during the Phase 2 exchange.  The
       necessary SA Attributes are defined in A.4.  A DOI value of 1 is
       assigned to the IPsec DOI [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].  All other DOI values are
       reserved to IANA for future use.  IANA will not normally assign a
       DOI value without referencing some public specification, such as



<span class="grey">Maughan, et. al.            Standards Track                    [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       an Internet RFC. Other DOI's can be defined using the description
       in <a href="#appendix-B">appendix B</a>.  This field MUST be present within the Security
       Association payload.

    o  Situation (variable length) - A DOI-specific field that
       identifies the situation under which this negotiation is taking
       place.  The Situation is used to make policy decisions regarding
       the security attributes being negotiated.  Specifics for the IETF
       IP Security DOI Situation are detailed in [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].  This field
       MUST be present within the Security Association payload.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5%20Proposal%20Payload"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a> Proposal Payload</span>

   The Proposal Payload contains information used during Security
   Association negotiation.  The proposal consists of security
   mechanisms, or transforms, to be used to secure the communications
   channel.  Figure 6 shows the format of the Proposal Payload.  A
   description of its use can be found in <a href="#section-4.2">section 4.2</a>.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !  Proposal #   !  Protocol-Id  !    SPI Size   !# of Transforms!
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                        SPI (variable)                         !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                 Figure 6:  Proposal Payload Format

   The Proposal Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  This field MUST only contain the
       value "2" or "0".  If there are additional Proposal payloads in
       the message, then this field will be 2.  If the current Proposal
       payload is the last within the security association proposal,
       then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the entire
       Proposal payload, including generic payload header, the Proposal
       payload, and all Transform payloads associated with this
       proposal.  In the event there are multiple proposals with the
       same proposal number (see <a href="#section-4.2">section 4.2</a>), the Payload Length field



<span class="grey">Maughan, et. al.            Standards Track                    [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       only applies to the current Proposal payload and not to all
       Proposal payloads.

    o  Proposal # (1 octet) - Identifies the Proposal number for the
       current payload.  A description of the use of this field is found
       in <a href="#section-4.2">section 4.2</a>.

    o  Protocol-Id (1 octet) - Specifies the protocol identifier for the
       current negotiation.  Examples might include IPSEC ESP, IPSEC AH,
       OSPF, TLS, etc.

    o  SPI Size (1 octet) - Length in octets of the SPI as defined by
       the Protocol-Id.  In the case of ISAKMP, the Initiator and
       Responder cookie pair from the ISAKMP Header is the ISAKMP SPI,
       therefore, the SPI Size is irrelevant and MAY be from zero (0) to
       sixteen (16).  If the SPI Size is non-zero, the content of the
       SPI field MUST be ignored.  If the SPI Size is not a multiple of
       4 octets it will have some impact on the SPI field and the
       alignment of all payloads in the message.  The Domain of
       Interpretation (DOI) will dictate the SPI Size for other
       protocols.

    o  # of Transforms (1 octet) - Specifies the number of transforms
       for the Proposal.  Each of these is contained in a Transform
       payload.

    o  SPI (variable) - The sending entity's SPI. In the event the SPI
       Size is not a multiple of 4 octets, there is no padding applied
       to the payload, however, it can be applied at the end of the
       message.

   The payload type for the Proposal Payload is two (2).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6%20Transform%20Payload"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a> Transform Payload</span>

   The Transform Payload contains information used during Security
   Association negotiation.  The Transform payload consists of a
   specific security mechanism, or transforms, to be used to secure the
   communications channel.  The Transform payload also contains the
   security association attributes associated with the specific
   transform.  These SA attributes are DOI-specific.  Figure 7 shows the
   format of the Transform Payload.  A description of its use can be
   found in <a href="#section-4.2">section 4.2</a>.








<span class="grey">Maughan, et. al.            Standards Track                    [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !  Transform #  !  Transform-Id !           RESERVED2           !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                        SA Attributes                          ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                Figure 7:  Transform Payload Format

   The Transform Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  This field MUST only contain the
       value "3" or "0".  If there are additional Transform payloads in
       the proposal, then this field will be 3.  If the current
       Transform payload is the last within the proposal, then this
       field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header, Transform values,
       and all SA Attributes.

    o  Transform # (1 octet) - Identifies the Transform number for the
       current payload.  If there is more than one transform proposed
       for a specific protocol within the Proposal payload, then each
       Transform payload has a unique Transform number.  A description
       of the use of this field is found in <a href="#section-4.2">section 4.2</a>.

    o  Transform-Id (1 octet) - Specifies the Transform identifier for
       the protocol within the current proposal.  These transforms are
       defined by the DOI and are dependent on the protocol being
       negotiated.

    o  RESERVED2 (2 octets) - Unused, set to 0.

    o  SA Attributes (variable length) - This field contains the
       security association attributes as defined for the transform
       given in the Transform-Id field.  The SA Attributes SHOULD be
       represented using the Data Attributes format described in <a href="#section-3.3">section</a>
       <a href="#section-3.3">3.3</a>.  If the SA Attributes are not aligned on 4-byte boundaries,



<span class="grey">Maughan, et. al.            Standards Track                    [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       then subsequent payloads will not be aligned and any padding will
       be added at the end of the message to make the message 4-octet
       aligned.

   The payload type for the Transform Payload is three (3).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.7%20Key%20Exchange%20Payload"></a><a class="selflink" href="#section-3.7" name="section-3.7">3.7</a> Key Exchange Payload</span>

   The Key Exchange Payload supports a variety of key exchange
   techniques.  Example key exchanges are Oakley [<a href="#ref-Oakley" title='"The Oakley Key Determination Protocol"'>Oakley</a>], Diffie-
   Hellman, the enhanced Diffie-Hellman key exchange described in X9.42
   [<a href="#ref-ANSI" title="April 19">ANSI</a>], and the RSA-based key exchange used by PGP. Figure 8 shows
   the format of the Key Exchange payload.

   The Key Exchange Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       nextpayload in the message.  If the current payload is the last
       in the message, then this field will be 0.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                       Key Exchange Data                       ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


               Figure 8:  Key Exchange Payload Format

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Key Exchange Data (variable length) - Data required to generate a
       session key.  The interpretation of this data is specified by the
       DOI and the associated Key Exchange algorithm.  This field may
       also contain pre-placed key indicators.

   The payload type for the Key Exchange Payload is four (4).







<span class="grey">Maughan, et. al.            Standards Track                    [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.8%20Identification%20Payload"></a><a class="selflink" href="#section-3.8" name="section-3.8">3.8</a> Identification Payload</span>

   The Identification Payload contains DOI-specific data used to
   exchange identification information.  This information is used for
   determining the identities of communicating peers and may be used for
   determining authenticity of information.  Figure 9 shows the format
   of the Identification Payload.

   The Identification Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  ID Type (1 octet) - Specifies the type of Identification being
       used.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !   ID Type     !             DOI Specific ID Data              !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                   Identification Data                         ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


              Figure 9:  Identification Payload Format

       This field is DOI-dependent.

    o  DOI Specific ID Data (3 octets) - Contains DOI specific
       Identification data.  If unused, then this field MUST be set to
       0.

    o  Identification Data (variable length) - Contains identity
       information.  The values for this field are DOI-specific and the
       format is specified by the ID Type field.  Specific details for
       the IETF IP Security DOI Identification Data are detailed in
       [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].



<span class="grey">Maughan, et. al.            Standards Track                    [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   The payload type for the Identification Payload is five (5).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.9%20Certificate%20Payload"></a><a class="selflink" href="#section-3.9" name="section-3.9">3.9</a> Certificate Payload</span>

   The Certificate Payload provides a means to transport certificates or
   other certificate-related information via ISAKMP and can appear in
   any ISAKMP message.  Certificate payloads SHOULD be included in an
   exchange whenever an appropriate directory service (e.g.  Secure DNS
   [<a href="#ref-DNSSEC" title="Domain Name System Protocol Security Extensions">DNSSEC</a>]) is not available to distribute certificates.  The
   Certificate payload MUST be accepted at any point during an exchange.
   Figure 10 shows the format of the Certificate Payload.

   NOTE: Certificate types and formats are not generally bound to a DOI
   - it is expected that there will only be a few certificate types, and
   that most DOIs will accept all of these types.

   The Certificate Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Cert Encoding !                                               !
     +-+-+-+-+-+-+-+-+                                               !
     ~                       Certificate Data                        ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


               Figure 10:  Certificate Payload Format

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Certificate Encoding (1 octet) - This field indicates the type of
       certificate or certificate-related information contained in the
       Certificate Data field.







<span class="grey">Maughan, et. al.            Standards Track                    [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                          Certificate Type            Value
                  NONE                                   0
                  PKCS #7 wrapped X.509 certificate      1
                  PGP Certificate                        2
                  DNS Signed Key                         3
                  X.509 Certificate - Signature          4
                  X.509 Certificate - Key Exchange       5
                  Kerberos Tokens                        6
                  Certificate Revocation List (CRL)      7
                  Authority Revocation List (ARL)        8
                  SPKI Certificate                       9
                  X.509 Certificate - Attribute         10
                  RESERVED                           11 - 255

    o  Certificate Data (variable length) - Actual encoding of
       certificate data.  The type of certificate is indicated by the
       Certificate Encoding field.

   The payload type for the Certificate Payload is six (6).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.10%20Certificate%20Request%20Payload"></a><a class="selflink" href="#section-3.10" name="section-3.10">3.10</a> Certificate Request Payload</span>

   The Certificate Request Payload provides a means to request
   certificates via ISAKMP and can appear in any message.  Certificate
   Request payloads SHOULD be included in an exchange whenever an
   appropriate directory service (e.g.  Secure DNS [<a href="#ref-DNSSEC" title="Domain Name System Protocol Security Extensions">DNSSEC</a>]) is not
   available to distribute certificates.  The Certificate Request
   payload MUST be accepted at any point during the exchange.  The
   responder to the Certificate Request payload MUST send its
   certificate, if certificates are supported, based on the values
   contained in the payload.  If multiple certificates are required,
   then multiple Certificate Request payloads SHOULD be transmitted.
   Figure 11 shows the format of the Certificate Request Payload.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !  Cert. Type   !                                               !
     +-+-+-+-+-+-+-+-+                                               !
     ~                    Certificate Authority                      ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


           Figure 11:  Certificate Request Payload Format




<span class="grey">Maughan, et. al.            Standards Track                    [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   The Certificate Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Certificate Type (1 octet) - Contains an encoding of the type of
       certificate requested.  Acceptable values are listed in <a href="#section-3.9">section</a>
       <a href="#section-3.9">3.9</a>.

    o  Certificate Authority (variable length) - Contains an encoding of
       an acceptable certificate authority for the type of certificate
       requested.  As an example, for an X.509 certificate this field
       would contain the Distinguished Name encoding of the Issuer Name
       of an X.509 certificate authority acceptable to the sender of
       this payload.  This would be included to assist the responder in
       determining how much of the certificate chain would need to be
       sent in response to this request.  If there is no specific
       certificate authority requested, this field SHOULD not be
       included.

   The payload type for the Certificate Request Payload is seven (7).
























<span class="grey">Maughan, et. al.            Standards Track                    [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.11%20Hash%20Payload"></a><a class="selflink" href="#section-3.11" name="section-3.11">3.11</a> Hash Payload</span>

   The Hash Payload contains data generated by the hash function
   (selected during the SA establishment exchange), over some part of
   the message and/or ISAKMP state.  This payload may be used to verify
   the integrity of the data in an ISAKMP message or for authentication
   of the negotiating entities.  Figure 12 shows the format of the Hash
   Payload.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                           Hash Data                           ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                  Figure 12:  Hash Payload Format

   The Hash Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Hash Data (variable length) - Data that results from applying the
       hash routine to the ISAKMP message and/or state.
















<span class="grey">Maughan, et. al.            Standards Track                    [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.12%20Signature%20Payload"></a><a class="selflink" href="#section-3.12" name="section-3.12">3.12</a> Signature Payload</span>

   The Signature Payload contains data generated by the digital
   signature function (selected during the SA establishment exchange),
   over some part of the message and/or ISAKMP state.  This payload is
   used to verify the integrity of the data in the ISAKMP message, and
   may be of use for non-repudiation services.  Figure 13 shows the
   format of the Signature Payload.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                         Signature Data                        ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                Figure 13:  Signature Payload Format

   The Signature Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Signature Data (variable length) - Data that results from
       applying the digital signature function to the ISAKMP message
       and/or state.

   The payload type for the Signature Payload is nine (9).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.13%20Nonce%20Payload"></a><a class="selflink" href="#section-3.13" name="section-3.13">3.13</a> Nonce Payload</span>

   The Nonce Payload contains random data used to guarantee liveness
   during an exchange and protect against replay attacks.  Figure 14
   shows the format of the Nonce Payload.  If nonces are used by a
   particular key exchange, the use of the Nonce payload will be
   dictated by the key exchange.  The nonces may be transmitted as part
   of the key exchange data, or as a separate payload.  However, this is
   defined by the key exchange, not by ISAKMP.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                            Nonce Data                         ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                  Figure 14:  Nonce Payload Format

   The Nonce Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Nonce Data (variable length) - Contains the random data generated
       by the transmitting entity.

   The payload type for the Nonce Payload is ten (10).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.14%20Notification%20Payload"></a><a class="selflink" href="#section-3.14" name="section-3.14">3.14</a> Notification Payload</span>

   The Notification Payload can contain both ISAKMP and DOI-specific
   data and is used to transmit informational data, such as error
   conditions, to an ISAKMP peer.  It is possible to send multiple
   Notification payloads in a single ISAKMP message.  Figure 15 shows
   the format of the Notification Payload.

   Notification which occurs during, or is concerned with, a Phase 1
   negotiation is identified by the Initiator and Responder cookie pair
   in the ISAKMP Header.  The Protocol Identifier, in this case, is
   ISAKMP and the SPI value is 0 because the cookie pair in the ISAKMP
   Header identifies the ISAKMP SA. If the notification takes place
   prior to the completed exchange of keying information, then the
   notification will be unprotected.







<span class="grey">Maughan, et. al.            Standards Track                    [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   Notification which occurs during, or is concerned with, a Phase 2
   negotiation is identified by the Initiator and Responder cookie pair
   in the ISAKMP Header and the Message ID and SPI associated with the
   current negotiation.  One example for this type of notification is to
   indicate why a proposal was rejected.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !              Domain of Interpretation  (DOI)                  !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !  Protocol-ID  !   SPI Size    !      Notify Message Type      !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                Security Parameter Index (SPI)                 ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                       Notification Data                       ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


              Figure 15:  Notification Payload Format

   The Notification Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Domain of Interpretation (4 octets) - Identifies the DOI (as
       described in <a href="#section-2.1">Section 2.1</a>) under which this notification is taking
       place.  For ISAKMP this value is zero (0) and for the IPSEC DOI
       it is one (1).  Other DOI's can be defined using the description
       in <a href="#appendix-B">appendix B</a>.

    o  Protocol-Id (1 octet) - Specifies the protocol identifier for the
       current notification.  Examples might include ISAKMP, IPSEC ESP,
       IPSEC AH, OSPF, TLS, etc.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 39]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-40" id="page-40" name="page-40"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


    o  SPI Size (1 octet) - Length in octets of the SPI as defined by
       the Protocol-Id.  In the case of ISAKMP, the Initiator and
       Responder cookie pair from the ISAKMP Header is the ISAKMP SPI,
       therefore, the SPI Size is irrelevant and MAY be from zero (0) to
       sixteen (16).  If the SPI Size is non-zero, the content of the
       SPI field MUST be ignored.  The Domain of Interpretation (DOI)
       will dictate the SPI Size for other protocols.

    o  Notify Message Type (2 octets) - Specifies the type of
       notification message (see <a href="#section-3.14.1">section 3.14.1</a>).  Additional text, if
       specified by the DOI, is placed in the Notification Data field.

    o  SPI (variable length) - Security Parameter Index.  The receiving
       entity's SPI. The use of the SPI field is described in <a href="#section-2.4">section</a>
       <a href="#section-2.4">2.4</a>.  The length of this field is determined by the SPI Size
       field and is not necessarily aligned to a 4 octet boundary.

    o  Notification Data (variable length) - Informational or error data
       transmitted in addition to the Notify Message Type.  Values for
       this field are DOI-specific.

   The payload type for the Notification Payload is eleven (11).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.14.1%20Notify%20Message%20Types"></a><a class="selflink" href="#section-3.14.1" name="section-3.14.1">3.14.1</a> Notify Message Types</span>

   Notification information can be error messages specifying why an SA
   could not be established.  It can also be status data that a process
   managing an SA database wishes to communicate with a peer process.
   For example, a secure front end or security gateway may use the
   Notify message to synchronize SA communication.  The table below
   lists the Nofitication messages and their corresponding values.
   Values in the Private Use range are expected to be DOI-specific
   values.

                      NOTIFY MESSAGES - ERROR TYPES

                           Errors               Value
                 INVALID-PAYLOAD-TYPE             1
                 DOI-NOT-SUPPORTED                2
                 SITUATION-NOT-SUPPORTED          3
                 INVALID-COOKIE                   4
                 INVALID-MAJOR-VERSION            5
                 INVALID-MINOR-VERSION            6
                 INVALID-EXCHANGE-TYPE            7
                 INVALID-FLAGS                    8
                 INVALID-MESSAGE-ID               9
                 INVALID-PROTOCOL-ID             10
                 INVALID-SPI                     11



<span class="grey">Maughan, et. al.            Standards Track                    [Page 40]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-41" id="page-41" name="page-41"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                 INVALID-TRANSFORM-ID            12
                 ATTRIBUTES-NOT-SUPPORTED        13
                 NO-PROPOSAL-CHOSEN              14
                 BAD-PROPOSAL-SYNTAX             15
                 PAYLOAD-MALFORMED               16
                 INVALID-KEY-INFORMATION         17
                 INVALID-ID-INFORMATION          18
                 INVALID-CERT-ENCODING           19
                 INVALID-CERTIFICATE             20
                 CERT-TYPE-UNSUPPORTED           21
                 INVALID-CERT-AUTHORITY          22
                 INVALID-HASH-INFORMATION        23
                 AUTHENTICATION-FAILED           24
                 INVALID-SIGNATURE               25
                 ADDRESS-NOTIFICATION            26
                 NOTIFY-SA-LIFETIME              27
                 CERTIFICATE-UNAVAILABLE         28
                 UNSUPPORTED-EXCHANGE-TYPE       29
                 UNEQUAL-PAYLOAD-LENGTHS         30
                 RESERVED (Future Use)        31 - 8191
                 Private Use                8192 - 16383



                      NOTIFY MESSAGES - STATUS TYPES
                          Status              Value
                  CONNECTED                   16384
                  RESERVED (Future Use)   16385 - 24575
                  DOI-specific codes     24576 - 32767
                  Private Use            32768 - 40959
                  RESERVED (Future Use)  40960 - 65535

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.15%20Delete%20Payload"></a><a class="selflink" href="#section-3.15" name="section-3.15">3.15</a> Delete Payload</span>

   The Delete Payload contains a protocol-specific security association
   identifier that the sender has removed from its security association
   database and is, therefore, no longer valid.  Figure 16 shows the
   format of the Delete Payload.  It is possible to send multiple SPIs
   in a Delete payload, however, each SPI MUST be for the same protocol.
   Mixing of Protocol Identifiers MUST NOT be performed with the Delete
   payload.

   Deletion which is concerned with an ISAKMP SA will contain a
   Protocol-Id of ISAKMP and the SPIs are the initiator and responder
   cookies from the ISAKMP Header.  Deletion which is concerned with a
   Protocol SA, such as ESP or AH, will contain the Protocol-Id of that
   protocol (e.g.  ESP, AH) and the SPI is the sending entity's SPI(s).




<span class="grey">Maughan, et. al.            Standards Track                    [Page 41]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-42" id="page-42" name="page-42"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   NOTE: The Delete Payload is not a request for the responder to delete
   an SA, but an advisory from the initiator to the responder.  If the
   responder chooses to ignore the message, the next communication from
   the responder to the initiator, using that security association, will
   fail.  A responder is not expected to acknowledge receipt of a Delete
   payload.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !              Domain of Interpretation  (DOI)                  !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !  Protocol-Id  !   SPI Size    !           # of SPIs           !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~               Security Parameter Index(es) (SPI)              ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                 Figure 16:  Delete Payload Format

   The Delete Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Domain of Interpretation (4 octets) - Identifies the DOI (as
       described in <a href="#section-2.1">Section 2.1</a>) under which this deletion is taking
       place.  For ISAKMP this value is zero (0) and for the IPSEC DOI
       it is one (1).  Other DOI's can be defined using the description
       in <a href="#appendix-B">appendix B</a>.

    o  Protocol-Id (1 octet) - ISAKMP can establish security
       associations for various protocols, including ISAKMP and IPSEC.
       This field identifies which security association database to
       apply the delete request.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 42]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-43" id="page-43" name="page-43"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


    o  SPI Size (1 octet) - Length in octets of the SPI as defined by
       the Protocol-Id.  In the case of ISAKMP, the Initiator and
       Responder cookie pair is the ISAKMP SPI. In this case, the SPI
       Size would be 16 octets for each SPI being deleted.

    o  # of SPIs (2 octets) - The number of SPIs contained in the Delete
       payload.  The size of each SPI is defined by the SPI Size field.

    o  Security Parameter Index(es) (variable length) - Identifies the
       specific security association(s) to delete.  Values for this
       field are DOI and protocol specific.  The length of this field is
       determined by the SPI Size and # of SPIs fields.

   The payload type for the Delete Payload is twelve (12).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.16%20Vendor%20ID%20Payload"></a><a class="selflink" href="#section-3.16" name="section-3.16">3.16</a> Vendor ID Payload</span>

   The Vendor ID Payload contains a vendor defined constant.  The
   constant is used by vendors to identify and recognize remote
   instances of their implementations.  This mechanism allows a vendor
   to experiment with new features while maintaining backwards
   compatibility.  This is not a general extension facility of ISAKMP.
   Figure 17 shows the format of the Vendor ID Payload.

   The Vendor ID payload is not an announcement from the sender that it
   will send private payload types.  A vendor sending the Vendor ID MUST
   not make any assumptions about private payloads that it may send
   unless a Vendor ID is received as well.  Multiple Vendor ID payloads
   MAY be sent.  An implementation is NOT REQUIRED to understand any
   Vendor ID payloads.  An implementation is NOT REQUIRED to send any
   Vendor ID payload at all.  If a private payload was sent without
   prior agreement to send it, a compliant implementation may reject a
   proposal with a notify message of type INVALID-PAYLOAD-TYPE.

   If a Vendor ID payload is sent, it MUST be sent during the Phase 1
   negotiation.  Reception of a familiar Vendor ID payload in the Phase
   1 negotiation allows an implementation to make use of Private USE
   payload numbers (128-255), described in <a href="#section-3.1">section 3.1</a> for vendor
   specific extensions during Phase 2 negotiations.  The definition of
   "familiar" is left to implementations to determine.  Some vendors may
   wish to implement another vendor's extension prior to
   standardization.  However, this practice SHOULD not be widespread and
   vendors should work towards standardization instead.

   The vendor defined constant MUST be unique.  The choice of hash and
   text to hash is left to the vendor to decide.  As an example, vendors
   could generate their vendor id by taking a plain (non-keyed) hash of
   a string containing the product name, and the version of the product.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 43]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-44" id="page-44" name="page-44"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   A hash is used instead of a vendor registry to avoid local
   cryptographic policy problems with having a list of "approved"
   products, to keep away from maintaining a list of vendors, and to
   allow classified products to avoid having to appear on any list.  For
   instance:

   "Example Company IPsec.  Version 97.1"

   (not including the quotes) has MD5 hash:
   48544f9b1fe662af98b9b39e50c01a5a, when using MD5file.  Vendors may
   include all of the hash, or just a portion of it, as the payload
   length will bound the data.  There are no security implications of
   this hash, so its choice is arbitrary.

                          1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ! Next Payload  !   RESERVED    !         Payload Length        !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     !                                                               !
     ~                        Vendor ID (VID)                        ~
     !                                                               !
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                Figure 17:  Vendor ID Payload Format

   The Vendor ID Payload fields are defined as follows:

    o  Next Payload (1 octet) - Identifier for the payload type of the
       next payload in the message.  If the current payload is the last
       in the message, then this field will be 0.

    o  RESERVED (1 octet) - Unused, set to 0.

    o  Payload Length (2 octets) - Length in octets of the current
       payload, including the generic payload header.

    o  Vendor ID (variable length) - Hash of the vendor string plus
       version (as described above).

   The payload type for the Vendor ID Payload is thirteen (13).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4%20ISAKMP%20Exchanges"></a><a class="selflink" href="#section-4" name="section-4">4</a> ISAKMP Exchanges</span>

   ISAKMP supplies the basic syntax of a message exchange.  The basic
   building blocks for ISAKMP messages are the payload types described
   in <a href="#section-3">section 3</a>.  This section describes the procedures for SA



<span class="grey">Maughan, et. al.            Standards Track                    [Page 44]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-45" id="page-45" name="page-45"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   establishment and SA modification, followed by a default set of
   exchanges that MAY be used for initial interoperability.  Other
   exchanges will be defined depending on the DOI and key exchange.
   [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>] and [<a href="#ref-IKE" title='"The Internet Key Exchange (IKE)"'>IKE</a>] are examples of how this is achieved.  <a href="#appendix-B">Appendix B</a>
   explains the procedures for accomplishing these additions.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1%20ISAKMP%20Exchange%20Types"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a> ISAKMP Exchange Types</span>

   ISAKMP allows the creation of exchanges for the establishment of
   Security Associations and keying material.  There are currently five
   default Exchange Types defined for ISAKMP. Sections <a href="#section-4.4">4.4</a> through <a href="#section-4.8">4.8</a>
   describe these exchanges.  Exchanges define the content and ordering
   of ISAKMP messages during communications between peers.  Most
   exchanges will include all the basic payload types - SA, KE, ID, SIG
   - and may include others.  The primary difference between exchange
   types is the ordering of the messages and the payload ordering within
   each message.  While the ordering of payloads within messages is not
   mandated, for processing efficiency it is RECOMMENDED that the
   Security Association payload be the first payload within an exchange.
   Processing of each payload within an exchange is described in <a href="#section-5">section</a>
   <a href="#section-5">5</a>.

   Sections <a href="#section-4.4">4.4</a> through <a href="#section-4.8">4.8</a> provide a default set of ISAKMP exchanges.
   These exchanges provide different security protection for the
   exchange itself and information exchanged.  The diagrams in each of
   the following sections show the message ordering for each exchange
   type as well as the payloads included in each message, and provide
   basic notes describing what has happened after each message exchange.
   None of the examples include any "optional payloads", like
   certificate and certificate request.  Additionally, none of the
   examples include an initial exchange of ISAKMP Headers (containing
   initiator and responder cookies) which would provide protection
   against clogging (see <a href="#section-2.5.3">section 2.5.3</a>).

   The defined exchanges are not meant to satisfy all DOI and key
   exchange protocol requirements.  If the defined exchanges meet the
   DOI requirements, then they can be used as outlined.  If the defined
   exchanges do not meet the security requirements defined by the DOI,
   then the DOI MUST specify new exchange type(s) and the valid
   sequences of payloads that make up a successful exchange, and how to
   build and interpret those payloads.  All ISAKMP implementations MUST
   implement the Informational Exchange and SHOULD implement the other
   four exchanges.  However, this is dependent on the definition of the
   DOI and associated key exchange protocols.







<span class="grey">Maughan, et. al.            Standards Track                    [Page 45]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-46" id="page-46" name="page-46"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   As discussed above, these exchange types can be used in either phase
   of negotiation.  However, they may provide different security
   properties in each of the phases.  With each of these exchanges, the
   combination of cookies and SPI fields identifies whether this
   exchange is being used in the first or second phase of a negotiation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.1%20Notation"></a><a class="selflink" href="#section-4.1.1" name="section-4.1.1">4.1.1</a> Notation</span>

   The following notation is used to describe the ISAKMP exchange types,
   shown in the next section, with the message formats and associated
   payloads:

     HDR is an ISAKMP header whose exchange type defines the payload
          orderings
     SA is an SA negotiation payload with one or more Proposal and
          Transform payloads. An initiator MAY provide multiple proposals
          for negotiation; a responder MUST reply with only one.
     KE is the key exchange payload.
     IDx is the identity payload for "x". x can be: "ii" or "ir"
          for the ISAKMP initiator and responder, respectively, or x can
          be: "ui", "ur" (when the ISAKMP daemon is a proxy negotiator),
          for the user initiator and responder, respectively.
     HASH is the hash payload.
     SIG is the signature payload. The data to sign is exchange-specific.
     AUTH is a generic authentication mechanism, such as HASH or SIG.
     NONCE is the nonce payload.
     '*' signifies payload encryption after the ISAKMP header. This
          encryption MUST begin immediately after the ISAKMP header and
          all payloads following the ISAKMP header MUST be encrypted.

     =&gt; signifies "initiator to responder" communication
     &lt;= signifies "responder to initiator" communication

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2%20Security%20Association%20Establishment"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a> Security Association Establishment</span>

   The Security Association, Proposal, and Transform payloads are used
   to build ISAKMP messages for the negotiation and establishment of
   SAs.  An SA establishment message consists of a single SA payload
   followed by at least one, and possibly many, Proposal payloads and at
   least one, and possibly many, Transform payloads associated with each
   Proposal payload.  Because these payloads are considered together,
   the SA payload will point to any following payloads and not to the
   Proposal payload included with the SA payload.  The SA Payload
   contains the DOI and Situation for the proposed SA. Each Proposal
   payload contains a Security Parameter Index (SPI) and ensures that
   the SPI is associated with the Protocol-Id in accordance with the
   Internet Security Architecture [<a href="#ref-SEC-ARCH" title='"Security Architecture for the Internet Protocol"'>SEC-ARCH</a>].  Proposal payloads may or
   may not have the same SPI, as this is implementation dependent.  Each



<span class="grey">Maughan, et. al.            Standards Track                    [Page 46]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-47" id="page-47" name="page-47"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   Transform Payload contains the specific security mechanisms to be
   used for the designated protocol.  It is expected that the Proposal
   and Transform payloads will be used only during SA establishment
   negotiation.  The creation of payloads for security association
   negotiation and establishment described here in this section are
   applicable for all ISAKMP exchanges described later in sections <a href="#section-4.4">4.4</a>
   through 4.8.  The examples shown in 4.2.1 contain only the SA,
   Proposal, and Transform payloads and do not contain other payloads
   that might exist for a given ISAKMP exchange.

   The Proposal payload provides the initiating entity with the
   capability to present to the responding entity the security protocols
   and associated security mechanisms for use with the security
   association being negotiated.  If the SA establishment negotiation is
   for a combined protection suite consisting of multiple protocols,
   then there MUST be multiple Proposal payloads each with the same
   Proposal number.  These proposals MUST be considered as a unit and
   MUST NOT be separated by a proposal with a different proposal number.
   The use of the same Proposal number in multiple Proposal payloads
   provides a logical AND operation, i.e.  Protocol 1 AND Protocol 2.
   The first example below shows an ESP AND AH protection suite.  If the
   SA establishment negotiation is for different protection suites, then
   there MUST be multiple Proposal payloads each with a monotonically
   increasing Proposal number.  The different proposals MUST be
   presented in the initiator's preference order.  The use of different
   Proposal numbers in multiple Proposal payloads provides a logical OR
   operation, i.e.  Proposal 1 OR Proposal 2, where each proposal may
   have more than one protocol.  The second example below shows either
   an AH AND ESP protection suite OR just an ESP protection suite.  Note
   that the Next Payload field of the Proposal payload points to another
   Proposal payload (if it exists).  The existence of a Proposal payload
   implies the existence of one or more Transform payloads.

   The Transform payload provides the initiating entity with the
   capability to present to the responding entity multiple mechanisms,
   or transforms, for a given protocol.  The Proposal payload identifies
   a Protocol for which services and mechanisms are being negotiated.
   The Transform payload allows the initiating entity to present several
   possible supported transforms for that proposed protocol.  There may
   be several transforms associated with a specific Proposal payload
   each identified in a separate Transform payload.  The multiple
   transforms MUST be presented with monotonically increasing numbers in
   the initiator's preference order.  The receiving entity MUST select a
   single transform for each protocol in a proposal or reject the entire
   proposal.  The use of the Transform number in multiple Transform
   payloads provides a second level OR operation, i.e.  Transform 1 OR
   Transform 2 OR Transform 3.  Example 1 below shows two possible
   transforms for ESP and a single transform for AH. Example 2 below



<span class="grey">Maughan, et. al.            Standards Track                    [Page 47]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-48" id="page-48" name="page-48"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   shows one transform for AH AND one transform for ESP OR two
   transforms for ESP alone.  Note that the Next Payload field of the
   Transform payload points to another Transform payload or 0.  The
   Proposal payload delineates the different proposals.

   When responding to a Security Association payload, the responder MUST
   send a Security Association payload with the selected proposal, which
   may consist of multiple Proposal payloads and their associated
   Transform payloads.  Each of the Proposal payloads MUST contain a
   single Transform payload associated with the Protocol.  The responder
   SHOULD retain the Proposal # field in the Proposal payload and the
   Transform # field in each Transform payload of the selected Proposal.
   Retention of Proposal and Transform numbers should speed the
   initiator's protocol processing by negating the need to compare the
   respondor's selection with every offered option.  These values enable
   the initiator to perform the comparison directly and quickly.  The
   initiator MUST verify that the Security Association payload received
   from the responder matches one of the proposals sent initially.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1%20Security%20Association%20Establishment%20Examples"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a> Security Association Establishment Examples</span>

   This example shows a Proposal for a combined protection suite with
   two different protocols.  The first protocol is presented with two
   transforms supported by the proposer.  The second protocol is
   presented with a single transform.  An example for this proposal
   might be: Protocol 1 is ESP with Transform 1 as 3DES and Transform 2
   as DES AND Protocol 2 is AH with Transform 1 as SHA. The responder
   MUST select from the two transforms proposed for ESP. The resulting
   protection suite will be either (1) 3DES AND SHA OR (2) DES AND SHA,
   depending on which ESP transform was selected by the responder.  Note
   this example is shown using the Base Exchange.

                            1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      /+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Nonce    !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
SA Pay !                 Domain of Interpretation (DOI)                !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                           Situation                           !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Proposal !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Prop 1 ! Proposal # = 1!  Protocol-Id  !    SPI Size   !# of Trans. = 2!
Prot 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SPI (variable)                        !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Transform!   RESERVED    !         Payload Length        !



<span class="grey">Maughan, et. al.            Standards Track                    [Page 48]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-49" id="page-49" name="page-49"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 1 ! Transform # 1 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 2 ! Transform # 2 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Prop 1 ! Proposal # = 1!  Protocol ID  !    SPI Size   !# of Trans. = 1!
Prot 2 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SPI (variable)                        !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 1 ! Transform # 1 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      \+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   This second example shows a Proposal for two different protection
   suites.  The SA Payload was omitted for space reasons.  The first
   protection suite is presented with one transform for the first
   protocol and one transform for the second protocol.  The second
   protection suite is presented with two transforms for a single
   protocol.  An example for this proposal might be:  Proposal 1 with
   Protocol 1 as AH with Transform 1 as MD5 AND Protocol 2 as ESP with
   Transform 1 as 3DES. This is followed by Proposal 2 with Protocol 1
   as ESP with Transform 1 as DES and Transform 2 as 3DES. The responder
   MUST select from the two different proposals.  If the second Proposal
   is selected, the responder MUST select from the two transforms for
   ESP. The resulting protection suite will be either (1) MD5 AND 3DES
   OR the selection between (2) DES OR (3) 3DES.

                            1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      /+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Proposal !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Prop 1 ! Proposal # = 1!  Protocol ID  !    SPI Size   !# of Trans. = 1!
Prot 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SPI (variable)                        !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !



<span class="grey">Maughan, et. al.            Standards Track                    [Page 49]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-50" id="page-50" name="page-50"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 1 ! Transform # 1 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Proposal !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Prop 1 ! Proposal # = 1! Protocol ID   !    SPI Size   !# of Trans. = 1!
Prot 2 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SPI (variable)                        !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 1 ! Transform # 1 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Prop 2 ! Proposal # = 2! Protocol ID   !    SPI Size   !# of Trans. = 2!
Prot 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SPI (variable)                        !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = Transform!   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 1 ! Transform # 1 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      &gt;+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / ! NP = 0        !   RESERVED    !         Payload Length        !
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Tran 2 ! Transform # 2 ! Transform ID  !           RESERVED2           !
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ !                         SA Attributes                         !
      \+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3%20Security%20Association%20Modification"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a> Security Association Modification</span>

   Security Association modification within ISAKMP is accomplished by
   creating a new SA and initiating communications using that new SA.
   Deletion of the old SA can be done anytime after the new SA is
   established.  Deletion of the old SA is dependent on local security
   policy.  Modification of SAs by using a "Create New SA followed by
   Delete Old SA" method is done to avoid potential vulnerabilities in
   synchronizing modification of existing SA attributes.  The procedure
   for creating new SAs is outlined in <a href="#section-4.2">section 4.2</a>.  The procedure for
   deleting SAs is outlined in <a href="#section-5.15">section 5.15</a>.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 50]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-51" id="page-51" name="page-51"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   Modification of an ISAKMP SA (phase 1 negotiation) follows the same
   procedure as creation of an ISAKMP SA. There is no relationship
   between the two SAs and the initiator and responder cookie pairs
   SHOULD be different, as outlined in <a href="#section-2.5.3">section 2.5.3</a>.

   Modification of a Protocol SA (phase 2 negotiation) follows the same
   procedure as creation of a Protocol SA. The creation of a new SA is
   protected by the existing ISAKMP SA. There is no relationship between
   the two Protocol SAs.  A protocol implementation SHOULD begin using
   the newly created SA for outbound traffic and SHOULD continue to
   support incoming traffic on the old SA until it is deleted or until
   traffic is received under the protection of the newly created SA. As
   stated previously in this section, deletion of an old SA is then
   dependent on local security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4%20Base%20Exchange"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a> Base Exchange</span>

   The Base Exchange is designed to allow the Key Exchange and
   Authentication related information to be transmitted together.
   Combining the Key Exchange and Authentication-related information
   into one message reduces the number of round-trips at the expense of
   not providing identity protection.  Identity protection is not
   provided because identities are exchanged before a common shared
   secret has been established and, therefore, encryption of the
   identities is not possible.  The following diagram shows the messages
   with the possible payloads sent in each message and notes for an
   example of the Base Exchange.

                         BASE EXCHANGE

 #  Initiator Direction  Responder            NOTE
(1)  HDR; SA; NONCE  =&gt;           Begin ISAKMP-SA or Proxy negotiation

(2)                  &lt;=  HDR; SA; NONCE
                                  Basic SA agreed upon
(3)  HDR; KE;        =&gt;
     IDii; AUTH                   Key Generated (by responder)
                                  Initiator Identity Verified by
                                  Responder
(4)                  &lt;=  HDR; KE;
                         IDir; AUTH
                                  Responder Identity Verified by
                                  Initiator Key Generated (by
                                  initiator) SA established







<span class="grey">Maughan, et. al.            Standards Track                    [Page 51]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-52" id="page-52" name="page-52"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   In the first message (1), the initiator generates a proposal it
   considers adequate to protect traffic for the given situation.  The
   Security Association, Proposal, and Transform payloads are included
   in the Security Association payload (for notation purposes).  Random
   information which is used to guarantee liveness and protect against
   replay attacks is also transmitted.  Random information provided by
   both parties SHOULD be used by the authentication mechanism to
   provide shared proof of participation in the exchange.

   In the second message (2), the responder indicates the protection
   suite it has accepted with the Security Association, Proposal, and
   Transform payloads.  Again, random information which is used to
   guarantee liveness and protect against replay attacks is also
   transmitted.  Random information provided by both parties SHOULD be
   used by the authentication mechanism to provide shared proof of
   participation in the exchange.  Local security policy dictates the
   action of the responder if no proposed protection suite is accepted.
   One possible action is the transmission of a Notify payload as part
   of an Informational Exchange.

   In the third (3) and fourth (4) messages, the initiator and
   responder, respectively, exchange keying material used to arrive at a
   common shared secret and identification information.  This
   information is transmitted under the protection of the agreed upon
   authentication function.  Local security policy dictates the action
   if an error occurs during these messages.  One possible action is the
   transmission of a Notify payload as part of an Informational
   Exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5%20Identity%20Protection%20Exchange"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a> Identity Protection Exchange</span>

   The Identity Protection Exchange is designed to separate the Key
   Exchange information from the Identity and Authentication related
   information.  Separating the Key Exchange from the Identity and
   Authentication related information provides protection of the
   communicating identities at the expense of two additional messages.
   Identities are exchanged under the protection of a previously
   established common shared secret.  The following diagram shows the
   messages with the possible payloads sent in each message and notes
   for an example of the Identity Protection Exchange.











<span class="grey">Maughan, et. al.            Standards Track                    [Page 52]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-53" id="page-53" name="page-53"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                    IDENTITY PROTECTION EXCHANGE

 #      Initiator       Direction    Responder      NOTE
(1)  HDR; SA               =&gt;                       Begin ISAKMP-SA or
                                                    Proxy negotiation
(2)                        &lt;=     HDR; SA
                                                    Basic SA agreed upon
(3)  HDR; KE; NONCE        =&gt;
(4)                        &lt;=     HDR; KE; NONCE
                                                    Key Generated (by
                                                    Initiator and
                                                    Responder)
(5)  HDR*; IDii; AUTH      =&gt;
                                                    Initiator Identity
                                                    Verified by
                                                    Responder
(6)                        &lt;=     HDR*; IDir; AUTH
                                                    Responder Identity
                                                    Verified by
                                                    Initiator
                                                    SA established

   In the first message (1), the initiator generates a proposal it
   considers adequate to protect traffic for the given situation.  The
   Security Association, Proposal, and Transform payloads are included
   in the Security Association payload (for notation purposes).

   In the second message (2), the responder indicates the protection
   suite it has accepted with the Security Association, Proposal, and
   Transform payloads.  Local security policy dictates the action of the
   responder if no proposed protection suite is accepted.  One possible
   action is the transmission of a Notify payload as part of an
   Informational Exchange.

   In the third (3) and fourth (4) messages, the initiator and
   responder, respectively, exchange keying material used to arrive at a
   common shared secret and random information which is used to
   guarantee liveness and protect against replay attacks.  Random
   information provided by both parties SHOULD be used by the
   authentication mechanism to provide shared proof of participation in
   the exchange.  Local security policy dictates the action if an error
   occurs during these messages.  One possible action is the
   transmission of a Notify payload as part of an Informational
   Exchange.

   In the fifth (5) and sixth (6) messages, the initiator and responder,
   respectively, exchange identification information and the results of
   the agreed upon authentication function.  This information is



<span class="grey">Maughan, et. al.            Standards Track                    [Page 53]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-54" id="page-54" name="page-54"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   transmitted under the protection of the common shared secret.  Local
   security policy dictates the action if an error occurs during these
   messages.  One possible action is the transmission of a Notify
   payload as part of an Informational Exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.6%20Authentication%20Only%20Exchange"></a><a class="selflink" href="#section-4.6" name="section-4.6">4.6</a> Authentication Only Exchange</span>

   The Authentication Only Exchange is designed to allow only
   Authentication related information to be transmitted.  The benefit of
   this exchange is the ability to perform only authentication without
   the computational expense of computing keys.  Using this exchange
   during negotiation, none of the transmitted information will be
   encrypted.  However, the information may be encrypted in other
   places.  For example, if encryption is negotiated during the first
   phase of a negotiation and the authentication only exchange is used
   in the second phase of a negotiation, then the authentication only
   exchange will be encrypted by the ISAKMP SAs negotiated in the first
   phase.  The following diagram shows the messages with possible
   payloads sent in each message and notes for an example of the
   Authentication Only Exchange.

                     AUTHENTICATION ONLY EXCHANGE

 #      Initiator     Direction     Responder     NOTE
(1)  HDR; SA; NONCE      =&gt;                       Begin ISAKMP-SA or
                                                  Proxy negotiation
(2)                       &lt;=     HDR; SA; NONCE;
                                 IDir; AUTH
                                                  Basic SA agreed upon
                                                  Responder Identity
                                                  Verified by Initiator
(3)  HDR; IDii; AUTH      =&gt;
                                                  Initiator Identity
                                                  Verified by Responder
                                                  SA established

   In the first message (1), the initiator generates a proposal it
   considers adequate to protect traffic for the given situation.  The
   Security Association, Proposal, and Transform payloads are included
   in the Security Association payload (for notation purposes).  Random
   information which is used to guarantee liveness and protect against
   replay attacks is also transmitted.  Random information provided by
   both parties SHOULD be used by the authentication mechanism to
   provide shared proof of participation in the exchange.

   In the second message (2), the responder indicates the protection
   suite it has accepted with the Security Association, Proposal, and
   Transform payloads.  Again, random information which is used to



<span class="grey">Maughan, et. al.            Standards Track                    [Page 54]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-55" id="page-55" name="page-55"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   guarantee liveness and protect against replay attacks is also
   transmitted.  Random information provided by both parties SHOULD be
   used by the authentication mechanism to provide shared proof of
   participation in the exchange.  Additionally, the responder transmits
   identification information.  All of this information is transmitted
   under the protection of the agreed upon authentication function.
   Local security policy dictates the action of the responder if no
   proposed protection suite is accepted.  One possible action is the
   transmission of a Notify payload as part of an Informational
   Exchange.

   In the third message (3), the initiator transmits identification
   information.  This information is transmitted under the protection of
   the agreed upon authentication function.  Local security policy
   dictates the action if an error occurs during these messages.  One
   possible action is the transmission of a Notify payload as part of an
   Informational Exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.7%20Aggressive%20Exchange"></a><a class="selflink" href="#section-4.7" name="section-4.7">4.7</a> Aggressive Exchange</span>

   The Aggressive Exchange is designed to allow the Security
   Association, Key Exchange and Authentication related payloads to be
   transmitted together.  Combining the Security Association, Key
   Exchange, and Authentication-related information into one message
   reduces the number of round-trips at the expense of not providing
   identity protection.  Identity protection is not provided because
   identities are exchanged before a common shared secret has been
   established and, therefore, encryption of the identities is not
   possible.  Additionally, the Aggressive Exchange is attempting to
   establish all security relevant information in a single exchange.
   The following diagram shows the messages with possible payloads sent
   in each message and notes for an example of the Aggressive Exchange.



















<span class="grey">Maughan, et. al.            Standards Track                    [Page 55]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-56" id="page-56" name="page-56"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


                        AGGRESSIVE EXCHANGE

 #     Initiator   Direction      Responder      NOTE
(1)  HDR; SA; KE;      =&gt;                        Begin ISAKMP-SA or
                                                 Proxy negotiation
     NONCE; IDii                                 and Key Exchange

(2)                    &lt;=     HDR; SA; KE;
                              NONCE; IDir; AUTH
                                                 Initiator Identity
                                                 Verified by Responder
                                                 Key Generated
                                                 Basic SA agreed upon
(3)  HDR*; AUTH        =&gt;
                                                 Responder Identity
                                                 Verified by Initiator
                                                 SA established

   In the first message (1), the initiator generates a proposal it
   considers adequate to protect traffic for the given situation.  The
   Security Association, Proposal, and Transform payloads are included
   in the Security Association payload (for notation purposes).  There
   can be only one Proposal and one Transform offered (i.e.  no choices)
   in order for the aggressive exchange to work.  Keying material used
   to arrive at a common shared secret and random information which is
   used to guarantee liveness and protect against replay attacks are
   also transmitted.  Random information provided by both parties SHOULD
   be used by the authentication mechanism to provide shared proof of
   participation in the exchange.  Additionally, the initiator transmits
   identification information.

   In the second message (2), the responder indicates the protection
   suite it has accepted with the Security Association, Proposal, and
   Transform payloads.  Keying material used to arrive at a common
   shared secret and random information which is used to guarantee
   liveness and protect against replay attacks is also transmitted.
   Random information provided by both parties SHOULD be used by the
   authentication mechanism to provide shared proof of participation in
   the exchange.  Additionally, the responder transmits identification
   information.  All of this information is transmitted under the
   protection of the agreed upon authentication function.  Local
   security policy dictates the action of the responder if no proposed
   protection suite is accepted.  One possible action is the
   transmission of a Notify payload as part of an Informational
   Exchange.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 56]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-57" id="page-57" name="page-57"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   In the third (3) message, the initiator transmits the results of the
   agreed upon authentication function.  This information is transmitted
   under the protection of the common shared secret.  Local security
   policy dictates the action if an error occurs during these messages.
   One possible action is the transmission of a Notify payload as part
   of an Informational Exchange.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.8%20Informational%20Exchange"></a><a class="selflink" href="#section-4.8" name="section-4.8">4.8</a> Informational Exchange</span>

   The Informational Exchange is designed as a one-way transmittal of
   information that can be used for security association management.
   The following diagram shows the messages with possible payloads sent
   in each message and notes for an example of the Informational
   Exchange.

                      INFORMATIONAL EXCHANGE

    #   Initiator  Direction Responder  NOTE
   (1)  HDR*; N/D     =&gt;                Error Notification or Deletion

   In the first message (1), the initiator or responder transmits an
   ISAKMP Notify or Delete payload.

   If the Informational Exchange occurs prior to the exchange of keying
   meterial during an ISAKMP Phase 1 negotiation, there will be no
   protection provided for the Informational Exchange.  Once keying
   material has been exchanged or an ISAKMP SA has been established, the
   Informational Exchange MUST be transmitted under the protection
   provided by the keying material or the ISAKMP SA.

   All exchanges are similar in that with the beginning of any exchange,
   cryptographic synchronization MUST occur.  The Informational Exchange
   is an exchange and not an ISAKMP message.  Thus, the generation of an
   Message ID (MID) for an Informational Exchange SHOULD be independent
   of IVs of other on-going communication.  This will ensure
   cryptographic synchronization is maintained for existing
   communications and the Informational Exchange will be processed
   correctly.  The only exception to this is when the Commit Bit of the
   ISAKMP Header is set.  When the Commit Bit is set, the Message ID
   field of the Informational Exchange MUST contain the Message ID of
   the original ISAKMP Phase 2 SA negotiation, rather than a new Message
   ID (MID). This is done to ensure that the Informational Exchange with
   the CONNECTED Notify Message can be associated with the correct Phase
   2 SA. For a description of the Commit Bit, see <a href="#section-3.1">section 3.1</a>.







<span class="grey">Maughan, et. al.            Standards Track                    [Page 57]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-58" id="page-58" name="page-58"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5%20ISAKMP%20Payload%20Processing"></a><a class="selflink" href="#section-5" name="section-5">5</a> ISAKMP Payload Processing</span>

   <a href="#section-3">Section 3</a> describes the ISAKMP payloads.  These payloads are used in
   the exchanges described in <a href="#section-4">section 4</a> and can be used in exchanges
   defined for a specific DOI. This section describes the processing for
   each of the payloads.  This section suggests the logging of events to
   a system audit file.  This action is controlled by a system security
   policy and is, therefore, only a suggested action.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1%20General%20Message%20Processing"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a> General Message Processing</span>

   Every ISAKMP message has basic processing applied to insure protocol
   reliability, and to minimize threats, such as denial of service and
   replay attacks.  All processing SHOULD include packet length checks
   to insure the packet received is at least as long as the length given
   in the ISAKMP Header.  If the ISAKMP message length and the value in
   the Payload Length field of the ISAKMP Header are not the same, then
   the ISAKMP message MUST be rejected.  The receiving entity (initiator
   or responder) MUST do the following:

   1.  The event, UNEQUAL PAYLOAD LENGTHS, MAY be logged in the
       appropriate system audit file.

   2.  An Informational Exchange with a Notification payload containing
       the UNEQUAL-PAYLOAD-LENGTHS message type MAY be sent to the
       transmitting entity.  This action is dictated by a system
       security policy.

   When transmitting an ISAKMP message, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Set a timer and initialize a retry counter.

       NOTE: Implementations MUST NOT use a fixed timer.  Instead,
       transmission timer values should be adjusted dynamically based on
       measured round trip times.  In addition, successive
       retransmissions of the same packet should be separated by
       increasingly longer time intervals (e.g., exponential backoff).

   2.  If the timer expires, the ISAKMP message is resent and the retry
       counter is decremented.

   3.  If the retry counter reaches zero (0), the event, RETRY LIMIT
       REACHED, MAY be logged in the appropriate system audit file.

   4.  The ISAKMP protocol machine clears all states and returns to
       IDLE.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 58]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-59" id="page-59" name="page-59"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2%20ISAKMP%20Header%20Processing"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a> ISAKMP Header Processing</span>

   When creating an ISAKMP message, the transmitting entity (initiator
   or responder) MUST do the following:

   1.  Create the respective cookie.  See <a href="#section-2.5.3">section 2.5.3</a> for details.

   2.  Determine the relevant security characteristics of the session
       (i.e. DOI and situation).

   3.  Construct an ISAKMP Header with fields as described in <a href="#section-3.1">section</a>
       <a href="#section-3.1">3.1</a>.

   4.  Construct other ISAKMP payloads, depending on the exchange type.

   5.  Transmit the message to the destination host as described in
       section5.1.

   When an ISAKMP message is received, the receiving entity (initiator
   or responder) MUST do the following:

   1.  Verify the Initiator and Responder "cookies".  If the cookie
       validation fails, the message is discarded and the following
       actions are taken:

       (a)  The event, INVALID COOKIE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-COOKIE message type MAY be sent to
            the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Check the Next Payload field to confirm it is valid.  If the Next
       Payload field validation fails, the message is discarded and the
       following actions are taken:

       (a)  The event, INVALID NEXT PAYLOAD, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-PAYLOAD-TYPE message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

   3.  Check the Major and Minor Version fields to confirm they are
       correct (see <a href="#section-3.1">section 3.1</a>).  If the Version field validation
       fails, the message is discarded and the following actions are



<span class="grey">Maughan, et. al.            Standards Track                    [Page 59]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-60" id="page-60" name="page-60"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       taken:

       (a)  The event, INVALID ISAKMP VERSION, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-MAJOR-VERSION or INVALID-MINOR-
            VERSION message type MAY be sent to the transmitting entity.
            This action is dictated by a system security policy.

   4.  Check the Exchange Type field to confirm it is valid.  If the
       Exchange Type field validation fails, the message is discarded
       and the following actions are taken:

       (a)  The event, INVALID EXCHANGE TYPE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-EXCHANGE-TYPE message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   5.  Check the Flags field to ensure it contains correct values.  If
       the Flags field validation fails, the message is discarded and
       the following actions are taken:

       (a)  The event, INVALID FLAGS, MAY be logged in the appropriate
            systemaudit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-FLAGS message type MAY be sent to the
            transmitting entity.  This action is dictated by a system
            security policy.

   6.  Check the Message ID field to ensure it contains correct values.
       If the Message ID validation fails, the message is discarded and
       the following actions are taken:

       (a)  The event, INVALID MESSAGE ID, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-MESSAGE-ID message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

   7.  Processing of the ISAKMP message continues using the value in the
       Next Payload field.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 60]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-61" id="page-61" name="page-61"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3%20Generic%20Payload%20Header%20Processing"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a> Generic Payload Header Processing</span>

   When creating any of the ISAKMP Payloads described in sections <a href="#section-3.4">3.4</a>
   through 3.15 a Generic Payload Header is placed at the beginning of
   these payloads.  When creating the Generic Payload Header, the
   transmitting entity (initiator or responder) MUST do the following:

   1.  Place the value of the Next Payload in the Next Payload field.
       These values are described in <a href="#section-3.1">section 3.1</a>.

   2.  Place the value zero (0) in the RESERVED field.

   3.  Place the length (in octets) of the payload in the Payload Length
       field.

   4.  Construct the payloads as defined in the remainder of this
       section.

   When any of the ISAKMP Payloads are received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Check the Next Payload field to confirm it is valid.  If the Next
       Payload field validation fails, the message is discarded and the
       following actions are taken:

       (a)  The event, INVALID NEXT PAYLOAD, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-PAYLOAD-TYPE message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Verify the RESERVED field contains the value zero.  If the value
       in the RESERVED field is not zero, the message is discarded and
       the following actions are taken:

       (a)  The event, INVALID RESERVED FIELD, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the BAD-PROPOSAL-SYNTAX or PAYLOAD-MALFORMED
            message type MAY be sent to the transmitting entity.  This
            action is dictated by a system security policy.

   3.  Process the remaining payloads as defined by the Next Payload
       field.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 61]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-62" id="page-62" name="page-62"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4%20Security%20Association%20Payload%20Processing"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a> Security Association Payload Processing</span>

   When creating a Security Association Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the Domain of Interpretation for which this negotiation
       is being performed.

   2.  Determine the situation within the determined DOI for which this
       negotiation is being performed.

   3.  Determine the proposal(s) and transform(s) within the situation.
       These are described, respectively, in sections <a href="#section-3.5">3.5</a> and <a href="#section-3.6">3.6</a>.

   4.  Construct a Security Association payload.

   5.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Security Association payload is received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Determine if the Domain of Interpretation (DOI) is supported.  If
       the DOI determination fails, the message is discarded and the
       following actions are taken:

       (a)  The event, INVALID DOI, MAY be logged in the appropriate
            system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the DOI-NOT-SUPPORTED message type MAY be sent to
            the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Determine if the given situation can be protected.  If the
       Situation determination fails, the message is discarded and the
       following actions are taken:

       (a)  The event, INVALID SITUATION, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the SITUATION-NOT-SUPPORTED message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   3.  Process the remaining payloads (i.e.  Proposal, Transform) of the
       Security Association Payload.  If the Security Association



<span class="grey">Maughan, et. al.            Standards Track                    [Page 62]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-63" id="page-63" name="page-63"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       Proposal (as described in sections <a href="#section-5.5">5.5</a> and <a href="#section-5.6">5.6</a>) is not accepted,
       then the following actions are taken:

       (a)  The event, INVALID PROPOSAL, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the NO-PROPOSAL-CHOSEN message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.5%20Proposal%20Payload%20Processing"></a><a class="selflink" href="#section-5.5" name="section-5.5">5.5</a> Proposal Payload Processing</span>

   When creating a Proposal Payload, the transmitting entity (initiator
   or responder) MUST do the following:

   1.  Determine the Protocol for this proposal.

   2.  Determine the number of proposals to be offered for this protocol
       and the number of transforms for each proposal.  Transforms are
       described in <a href="#section-3.6">section 3.6</a>.

   3.  Generate a unique pseudo-random SPI.

   4.  Construct a Proposal payload.

   When a Proposal payload is received, the receiving entity (initiator
   or responder) MUST do the following:

   1.  Determine if the Protocol is supported.  If the Protocol-ID field
       is invalid, the payload is discarded and the following actions
       are taken:

       (a)  The event, INVALID PROTOCOL, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-PROTOCOL-ID message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Determine if the SPI is valid.  If the SPI is invalid, the
       payload is discarded and the following actions are taken:

       (a)  The event, INVALID SPI, MAY be logged in the appropriate
            system audit file.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 63]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-64" id="page-64" name="page-64"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-SPI message type MAY be sent to the
            transmitting entity.  This action is dictated by a system
            security policy.

   3.  Ensure the Proposals are presented according to the details given
       in <a href="#section-3.5">section 3.5</a> and 4.2.  If the proposals are not formed
       correctly, the following actions are taken:

       (a)  Possible events, BAD PROPOSAL SYNTAX, INVALID PROPOSAL, are
            logged in the appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the BAD-PROPOSAL-SYNTAX or PAYLOAD-MALFORMED
            message type MAY be sent to the transmitting entity.  This
            action is dictated by a system security policy.

   4.  Process the Proposal and Transform payloads as defined by the
       Next Payload field.  Examples of processing these payloads are
       given in <a href="#section-4.2.1">section 4.2.1</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.6%20Transform%20Payload%20Processing"></a><a class="selflink" href="#section-5.6" name="section-5.6">5.6</a> Transform Payload Processing</span>

   When creating a Transform Payload, the transmitting entity (initiator
   or responder) MUST do the following:

   1.  Determine the Transform # for this transform.

   2.  Determine the number of transforms to be offered for this
       proposal.  Transforms are described in sections <a href="#section-3.6">3.6</a>.

   3.  Construct a Transform payload.

   When a Transform payload is received, the receiving entity (initiator
   or responder) MUST do the following:

   1.  Determine if the Transform is supported.  If the Transform-ID
       field contains an unknown or unsupported value, then that
       Transform payload MUST be ignored and MUST NOT cause the
       generation of an INVALID TRANSFORM event.  If the Transform-ID
       field is invalid, the payload is discarded and the following
       actions are taken:

       (a)  The event, INVALID TRANSFORM, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-TRANSFORM-ID message type MAY be sent



<span class="grey">Maughan, et. al.            Standards Track                    [Page 64]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-65" id="page-65" name="page-65"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


            to the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Ensure the Transforms are presented according to the details
       given in <a href="#section-3.6">section 3.6</a> and 4.2.  If the transforms are not formed
       correctly, the following actions are taken:

       (a)  Possible events, BAD PROPOSAL SYNTAX, INVALID TRANSFORM,
            INVALID ATTRIBUTES, are logged in the appropriate system
            audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the BAD-PROPOSAL-SYNTAX, PAYLOAD-MALFORMED or
            ATTRIBUTES-NOT-SUPPORTED message type MAY be sent to the
            transmitting entity.  This action is dictated by a system
            security policy.

   3.  Process the subsequent Transform and Proposal payloads as defined
       by the Next Payload field.  Examples of processing these payloads
       are given in <a href="#section-4.2.1">section 4.2.1</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.7%20Key%20Exchange%20Payload%20Processing"></a><a class="selflink" href="#section-5.7" name="section-5.7">5.7</a> Key Exchange Payload Processing</span>

   When creating a Key Exchange Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the Key Exchange to be used as defined by the DOI.

   2.  Determine the usage of the Key Exchange Data field as defined by
       the DOI.

   3.  Construct a Key Exchange payload.

   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Key Exchange payload is received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Determine if the Key Exchange is supported.  If the Key Exchange
       determination fails, the message is discarded and the following
       actions are taken:

       (a)  The event, INVALID KEY INFORMATION, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-KEY-INFORMATION message type MAY be



<span class="grey">Maughan, et. al.            Standards Track                    [Page 65]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-66" id="page-66" name="page-66"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


            sent to the transmitting entity.  This action is dictated by
            a system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.8%20Identification%20Payload%20Processing"></a><a class="selflink" href="#section-5.8" name="section-5.8">5.8</a> Identification Payload Processing</span>

   When creating an Identification Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the Identification information to be used as defined by
       the DOI (and possibly the situation).

   2.  Determine the usage of the Identification Data field as defined
       by the DOI.

   3.  Construct an Identification payload.

   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When an Identification payload is received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Determine if the Identification Type is supported.  This may be
       based on the DOI and Situation.  If the Identification
       determination fails, the message is discarded and the following
       actions are taken:

       (a)  The event, INVALID ID INFORMATION, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-ID-INFORMATION message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.9%20Certificate%20Payload%20Processing"></a><a class="selflink" href="#section-5.9" name="section-5.9">5.9</a> Certificate Payload Processing</span>

   When creating a Certificate Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the Certificate Encoding to be used.  This may be
       specified by the DOI.

   2.  Ensure the existence of a certificate formatted as defined by the
       Certificate Encoding.

   3.  Construct a Certificate payload.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 66]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-67" id="page-67" name="page-67"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Certificate payload is received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Determine if the Certificate Encoding is supported.  If the
       Certificate Encoding is not supported, the payload is discarded
       and the following actions are taken:

       (a)  The event, INVALID CERTIFICATE TYPE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-CERT-ENCODING message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   2.  Process the Certificate Data field.  If the Certificate Data is
       invalid or improperly formatted, the payload is discarded and the
       following actions are taken:

       (a)  The event, INVALID CERTIFICATE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-CERTIFICATE message type MAY be sent
            to the transmitting entity.  This action is dictated by a
            system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.10%20Certificate%20Request%20Payload%20Processing"></a><a class="selflink" href="#section-5.10" name="section-5.10">5.10</a> Certificate Request Payload Processing</span>

   When creating a Certificate Request Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the type of Certificate Encoding to be requested.  This
       may be specified by the DOI.

   2.  Determine the name of an acceptable Certificate Authority which
       is to be requested (if applicable).

   3.  Construct a Certificate Request payload.

   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Certificate Request payload is received, the receiving entity
   (initiator or responder) MUST do the following:



<span class="grey">Maughan, et. al.            Standards Track                    [Page 67]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-68" id="page-68" name="page-68"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   1.  Determine if the Certificate Encoding is supported.  If the
       Certificate Encoding is invalid, the payload is discarded and the
       following actions are taken:

       (a)  The event, INVALID CERTIFICATE TYPE, MAY be logged in
            the appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-CERT-ENCODING message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

       If the Certificate Encoding is not supported, the payload is
       discarded and the following actions are taken:

       (a)  The event, CERTIFICATE TYPE UNSUPPORTED, MAY be logged in
            the appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the CERT-TYPE-UNSUPPORTED message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   2.  Determine if the Certificate Authority is supported for the
       specified Certificate Encoding.  If the Certificate Authority is
       invalid or improperly formatted, the payload is discarded and the
       following actions are taken:

       (a)  The event, INVALID CERTIFICATE AUTHORITY, MAY be logged in
            the appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-CERT-AUTHORITY message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   3.  Process the Certificate Request.  If a requested Certificate Type
       with the specified Certificate Authority is not available, then
       the payload is discarded and the following actions are taken:

       (a)  The event, CERTIFICATE-UNAVAILABLE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the CERTIFICATE-UNAVAILABLE message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 68]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-69" id="page-69" name="page-69"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.11%20Hash%20Payload%20Processing"></a><a class="selflink" href="#section-5.11" name="section-5.11">5.11</a> Hash Payload Processing</span>

   When creating a Hash Payload, the transmitting entity (initiator or
   responder) MUST do the following:

   1.  Determine the Hash function to be used as defined by the SA
       negotiation.

   2.  Determine the usage of the Hash Data field as defined by the DOI.

   3.  Construct a Hash payload.

   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Hash payload is received, the receiving entity (initiator or
   responder) MUST do the following:

   1.  Determine if the Hash is supported.  If the Hash determination
       fails, the message is discarded and the following actions are
       taken:

       (a)  The event, INVALID HASH INFORMATION, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-HASH-INFORMATION message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

   2.  Perform the Hash function as outlined in the DOI and/or Key
       Exchange protocol documents.  If the Hash function fails, the
       message is discarded and the following actions are taken:

       (a)  The event, INVALID HASH VALUE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the AUTHENTICATION-FAILED message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.12%20Signature%20Payload%20Processing"></a><a class="selflink" href="#section-5.12" name="section-5.12">5.12</a> Signature Payload Processing</span>

   When creating a Signature Payload, the transmitting entity (initiator
   or responder) MUST do the following:





<span class="grey">Maughan, et. al.            Standards Track                    [Page 69]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-70" id="page-70" name="page-70"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   1.  Determine the Signature function to be used as defined by the SA
       negotiation.

   2.  Determine the usage of the Signature Data field as defined by the
       DOI.

   3.  Construct a Signature payload.

   4.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Signature payload is received, the receiving entity (initiator
   or responder) MUST do the following:

   1.  Determine if the Signature is supported.  If the Signature
       determination fails, the message is discarded and the following
       actions are taken:

       (a)  The event, INVALID SIGNATURE INFORMATION, MAY be logged in
            the appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the INVALID-SIGNATURE message type MAY be sent to
            the transmitting entity.  This action is dictated by a
            system security policy.

   2.  Perform the Signature function as outlined in the DOI and/or Key
       Exchange protocol documents.  If the Signature function fails,
       the message is discarded and the following actions are taken:

       (a)  The event, INVALID SIGNATURE VALUE, MAY be logged in the
            appropriate system audit file.

       (b)  An Informational Exchange with a Notification payload
            containing the AUTHENTICATION-FAILED message type MAY be
            sent to the transmitting entity.  This action is dictated by
            a system security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.13%20Nonce%20Payload%20Processing"></a><a class="selflink" href="#section-5.13" name="section-5.13">5.13</a> Nonce Payload Processing</span>

   When creating a Nonce Payload, the transmitting entity (initiator or
   responder) MUST do the following:

   1.  Create a unique random value to be used as a nonce.

   2.  Construct a Nonce payload.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 70]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-71" id="page-71" name="page-71"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   3.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   When a Nonce payload is received, the receiving entity (initiator or
   responder) MUST do the following:

   1.  There are no specific procedures for handling Nonce payloads.
       The procedures are defined by the exchange types (and possibly
       the DOI and Key Exchange descriptions).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.14%20Notification%20Payload%20Processing"></a><a class="selflink" href="#section-5.14" name="section-5.14">5.14</a> Notification Payload Processing</span>

   During communications it is possible that errors may occur.  The
   Informational Exchange with a Notify Payload provides a controlled
   method of informing a peer entity that errors have occurred during
   protocol processing.  It is RECOMMENDED that Notify Payloads be sent
   in a separate Informational Exchange rather than appending a Notify
   Payload to an existing exchange.

   When creating a Notification Payload, the transmitting entity
   (initiator or responder) MUST do the following:

   1.  Determine the DOI for this Notification.

   2.  Determine the Protocol-ID for this Notification.

   3.  Determine the SPI size based on the Protocol-ID field.  This
       field is necessary because different security protocols have
       different SPI sizes.  For example, ISAKMP combines the Initiator
       and Responder cookie pair (16 octets) as a SPI, while ESP and AH
       have 4 octet SPIs.

   4.  Determine the Notify Message Type based on the error or status
       message desired.

   5.  Determine the SPI which is associated with this notification.

   6.  Determine if additional Notification Data is to be included.
       This is additional information specified by the DOI.

   7.  Construct a Notification payload.

   8.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   Because the Informational Exchange with a Notification payload is a
   unidirectional message a retransmission will not be performed.  The
   local security policy will dictate the procedures for continuing.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 71]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-72" id="page-72" name="page-72"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   However, we RECOMMEND that a NOTIFICATION PAYLOAD ERROR event be
   logged in the appropriate system audit file by the receiving entity.

   If the Informational Exchange occurs prior to the exchange of keying
   material during an ISAKMP Phase 1 negotiation there will be no
   protection provided for the Informational Exchange.  Once the keying
   material has been exchanged or the ISAKMP SA has been established,
   the Informational Exchange MUST be transmitted under the protection
   provided by the keying material or the ISAKMP SA.

   When a Notification payload is received, the receiving entity
   (initiator or responder) MUST do the following:

   1.  Determine if the Informational Exchange has any protection
       applied to it by checking the Encryption Bit and the
       Authentication Only Bit in the ISAKMP Header.  If the Encryption
       Bit is set, i.e.  the Informational Exchange is encrypted, then
       the message MUST be decrypted using the (in-progress or
       completed) ISAKMP SA. Once the decryption is complete the
       processing can continue as described below.  If the
       Authentication Only Bit is set, then the message MUST be
       authenticated using the (in-progress or completed) ISAKMP SA.
       Once the authentication is completed, the processing can continue
       as described below.  If the Informational Exchange is not
       encrypted or authentication, the payload processing can continue
       as described below.

   2.  Determine if the Domain of Interpretation (DOI) is supported.  If
       the DOI determination fails, the payload is discarded and the
       following action is taken:

       (a)  The event, INVALID DOI, MAY be logged in the appropriate
            system audit file.

   3.  Determine if the Protocol-Id is supported.  If the Protocol-Id
       determination fails, the payload is discarded and the following
       action is taken:

       (a)  The event, INVALID PROTOCOL-ID, MAY be logged in the
            appropriate system audit file.

   4.  Determine if the SPI is valid.  If the SPI is invalid, the
       payload is discarded and the following action is taken:

       (a)  The event, INVALID SPI, MAY be logged in the appropriate
            system audit file.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 72]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-73" id="page-73" name="page-73"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   5.  Determine if the Notify Message Type is valid.  If the Notify
       Message Type is invalid, the payload is discarded and the
       following action is taken:

       (a)  The event, INVALID MESSAGE TYPE, MAY be logged in the
            appropriate system audit file.

   6.  Process the Notification payload, including additional
       Notification Data, and take appropriate action, according to
       local security policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.15%20Delete%20Payload%20Processing"></a><a class="selflink" href="#section-5.15" name="section-5.15">5.15</a> Delete Payload Processing</span>

   During communications it is possible that hosts may be compromised or
   that information may be intercepted during transmission.  Determining
   whether this has occurred is not an easy task and is outside the
   scope of this memo.  However, if it is discovered that transmissions
   are being compromised, then it is necessary to establish a new SA and
   delete the current SA.

   The Informational Exchange with a Delete Payload provides a
   controlled method of informing a peer entity that the transmitting
   entity has deleted the SA(s).  Deletion of Security Associations MUST
   always be performed under the protection of an ISAKMP SA. The
   receiving entity SHOULD clean up its local SA database.  However,
   upon receipt of a Delete message the SAs listed in the Security
   Parameter Index (SPI) field of the Delete payload cannot be used with
   the transmitting entity.  The SA Establishment procedure must be
   invoked to re-establish secure communications.

   When creating a Delete Payload, the transmitting entity (initiator or
   responder) MUST do the following:

   1.  Determine the DOI for this Deletion.

   2.  Determine the Protocol-ID for this Deletion.

   3.  Determine the SPI size based on the Protocol-ID field.  This
       field is necessary because different security protocols have
       different SPI sizes.  For example, ISAKMP combines the Initiator
       and Responder cookie pair (16 octets) as a SPI, while ESP and AH
       have 4 octet SPIs.

   4.  Determine the # of SPIs to be deleted for this protocol.

   5.  Determine the SPI(s) which is (are) associated with this
       deletion.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 73]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-74" id="page-74" name="page-74"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   6.  Construct a Delete payload.

   7.  Transmit the message to the receiving entity as described in
       <a href="#section-5.1">section 5.1</a>.

   Because the Informational Exchange with a Delete payload is a
   unidirectional message a retransmission will not be performed.  The
   local security policy will dictate the procedures for continuing.
   However, we RECOMMEND that a DELETE PAYLOAD ERROR event be logged in
   the appropriate system audit file by the receiving entity.

   As described above, the Informational Exchange with a Delete payload
   MUST be transmitted under the protection provided by an ISAKMP SA.

   When a Delete payload is received, the receiving entity (initiator or
   responder) MUST do the following:

   1.  Because the Informational Exchange is protected by some security
       service (e.g.  authentication for an Auth-Only SA, encryption for
       other exchanges), the message MUST have these security services
       applied using the ISAKMP SA. Once the security service processing
       is complete the processing can continue as described below.  Any
       errors that occur during the security service processing will be
       evident when checking information in the Delete payload.  The
       local security policy SHOULD dictate any action to be taken as a
       result of security service processing errors.

   2.  Determine if the Domain of Interpretation (DOI) is supported.  If
       the DOI determination fails, the payload is discarded and the
       following action is taken:

       (a)  The event, INVALID DOI, MAY be logged in the appropriate
            system audit file.

   3.  Determine if the Protocol-Id is supported.  If the Protocol-Id
       determination fails, the payload is discarded and the following
       action is taken:

       (a)  The event, INVALID PROTOCOL-ID, MAY be logged in the
            appropriate system audit file.

   4.  Determine if the SPI is valid for each SPI included in the Delete
       payload.  For each SPI that is invalid, the following action is
       taken:

       (a)  The event, INVALID SPI, MAY be logged in the appropriate
            system audit file.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 74]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-75" id="page-75" name="page-75"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   5.  Process the Delete payload and take appropriate action, according
       to local security policy.  As described above, one appropriate
       action SHOULD include cleaning up the local SA database.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6%20Conclusions"></a><a class="selflink" href="#section-6" name="section-6">6</a> Conclusions</span>

   The Internet Security Association and Key Management Protocol
   (ISAKMP) is a well designed protocol aimed at the Internet of the
   future.  The massive growth of the Internet will lead to great
   diversity in network utilization, communications, security
   requirements, and security mechanisms.  ISAKMP contains all the
   features that will be needed for this dynamic and expanding
   communications environment.

   ISAKMP's Security Association (SA) feature coupled with
   authentication and key establishment provides the security and
   flexibility that will be needed for future growth and diversity.
   This security diversity of multiple key exchange techniques,
   encryption algorithms, authentication mechanisms, security services,
   and security attributes will allow users to select the appropriate
   security for their network, communications, and security needs.  The
   SA feature allows users to specify and negotiate security
   requirements with other users.  An additional benefit of supporting
   multiple techniques in a single protocol is that as new techniques
   are developed they can easily be added to the protocol.  This
   provides a path for the growth of Internet security services.  ISAKMP
   supports both publicly or privately defined SAs, making it ideal for
   government, commercial, and private communications.

   ISAKMP provides the ability to establish SAs for multiple security
   protocols and applications.  These protocols and applications may be
   session-oriented or sessionless.  Having one SA establishment
   protocol that supports multiple security protocols eliminates the
   need for multiple, nearly identical authentication, key exchange and
   SA establishment protocols when more than one security protocol is in
   use or desired.  Just as IP has provided the common networking layer
   for the Internet, a common security establishment protocol is needed
   if security is to become a reality on the Internet.  ISAKMP provides
   the common base that allows all other security protocols to
   interoperate.

   ISAKMP follows good security design principles.  It is not coupled to
   other insecure transport protocols, therefore it is not vulnerable or
   weakened by attacks on other protocols.  Also, when more secure
   transport protocols are developed, ISAKMP can be easily migrated to
   them.  ISAKMP also provides protection against protocol related
   attacks.  This protection provides the assurance that the SAs and
   keys established are with the desired party and not with an attacker.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 75]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-76" id="page-76" name="page-76"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   ISAKMP also follows good protocol design principles.  Protocol
   specific information only is in the protocol header, following the
   design principles of IPv6.  The data transported by the protocol is
   separated into functional payloads.  As the Internet grows and
   evolves, new payloads to support new security functionality can be
   added without modifying the entire protocol.













































<span class="grey">Maughan, et. al.            Standards Track                    [Page 76]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-77" id="page-77" name="page-77"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


A ISAKMP Security Association Attributes

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1%20Background%2FRationale"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a> Background/Rationale</span>

   As detailed in previous sections, ISAKMP is designed to provide a
   flexible and extensible framework for establishing and managing
   Security Associations and cryptographic keys.  The framework provided
   by ISAKMP consists of header and payload definitions, exchange types
   for guiding message and payload exchanges, and general processing
   guidelines.  ISAKMP does not define the mechanisms that will be used
   to establish and manage Security Associations and cryptographic keys
   in an authenticated and confidential manner.  The definition of
   mechanisms and their application is the purview of individual Domains
   of Interpretation (DOIs).

   This section describes the ISAKMP values for the Internet IP Security
   DOI, supported security protocols, and identification values for
   ISAKMP Phase 1 negotiations.  The Internet IP Security DOI is
   MANDATORY to implement for IP Security.  [<a href="#ref-Oakley" title='"The Oakley Key Determination Protocol"'>Oakley</a>] and [<a href="#ref-IKE" title='"The Internet Key Exchange (IKE)"'>IKE</a>] describe,
   in detail, the mechanisms and their application for establishing and
   managing Security Associations and cryptographic keys for IP
   Security.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2%20Internet%20IP%20Security%20DOI%20Assigned%20Value"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a> Internet IP Security DOI Assigned Value</span>

   As described in [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>], the Internet IP Security DOI Assigned Number
   is one (1).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3%20Supported%20Security%20Protocols"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a> Supported Security Protocols</span>

   Values for supported security protocols are specified in the most
   recent "Assigned Numbers" RFC [<a href="#ref-STD-2" title='"Assigned Numbers"'>STD-2</a>].  Presented in the following
   table are the values for the security protocols supported by ISAKMP
   for the Internet IP Security DOI.


                       Protocol Assigned Value
                       RESERVED        0
                       ISAKMP          1

   All DOIs MUST reserve ISAKMP with a Protocol-ID of 1.  All other
   security protocols within that DOI will be numbered accordingly.

   Security protocol values 2-15359 are reserved to IANA for future use.
   Values 15360-16383 are permanently reserved for private use amongst
   mutually consenting implementations.  Such private use values are
   unlikely to be interoperable across different implementations.




<span class="grey">Maughan, et. al.            Standards Track                    [Page 77]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-78" id="page-78" name="page-78"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.4%20ISAKMP%20Identification%20Type%20Values"></a><a class="selflink" href="#appendix-A.4" name="appendix-A.4">A.4</a> ISAKMP Identification Type Values</span>

   The following table lists the assigned values for the Identification
   Type field found in the Identification payload during a generic Phase
   1 exchange, which is not for a specific protocol.


                              ID Type       Value
                        ID_IPV4_ADDR          0
                        ID_IPV4_ADDR_SUBNET   1
                        ID_IPV6_ADDR          2
                        ID_IPV6_ADDR_SUBNET   3

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.4.1%20ID_IPV4_ADDR"></a><a class="selflink" href="#appendix-A.4.1" name="appendix-A.4.1">A.4.1</a> ID_IPV4_ADDR</span>

   The ID_IPV4_ADDR type specifies a single four (4) octet IPv4 address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.4.2%20ID_IPV4_ADDR_SUBNET"></a><a class="selflink" href="#appendix-A.4.2" name="appendix-A.4.2">A.4.2</a> ID_IPV4_ADDR_SUBNET</span>

   The ID_IPV4_ADDR_SUBNET type specifies a range of IPv4 addresses,
   represented by two four (4) octet values.  The first value is an IPv4
   address.  The second is an IPv4 network mask.  Note that ones (1s) in
   the network mask indicate that the corresponding bit in the address
   is fixed, while zeros (0s) indicate a "wildcard" bit.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.4.3%20ID_IPV6_ADDR"></a><a class="selflink" href="#appendix-A.4.3" name="appendix-A.4.3">A.4.3</a> ID_IPV6_ADDR</span>

   The ID_IPV6_ADDR type specifies a single sixteen (16) octet IPv6
   address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/A.4.4%20ID_IPV6_ADDR_SUBNET"></a><a class="selflink" href="#appendix-A.4.4" name="appendix-A.4.4">A.4.4</a> ID_IPV6_ADDR_SUBNET</span>

   The ID_IPV6_ADDR_SUBNET type specifies a range of IPv6 addresses,
   represented by two sixteen (16) octet values.  The first value is an
   IPv6 address.  The second is an IPv6 network mask.  Note that ones
   (1s) in the network mask indicate that the corresponding bit in the
   address is fixed, while zeros (0s) indicate a "wildcard" bit.














<span class="grey">Maughan, et. al.            Standards Track                    [Page 78]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-79" id="page-79" name="page-79"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


B Defining a new Domain of Interpretation

   The Internet DOI may be sufficient to meet the security requirements
   of a large portion of the internet community.  However, some groups
   may have a need to customize some aspect of a DOI, perhaps to add a
   different set of cryptographic algorithms, or perhaps because they
   want to make their security-relevant decisions based on something
   other than a host id or user id.  Also, a particular group may have a
   need for a new exchange type, for example to support key management
   for multicast groups.

   This section discusses guidelines for defining a new DOI. The full
   specification for the Internet DOI can be found in [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>].

   Defining a new DOI is likely to be a time-consuming process.  If at
   all possible, it is recommended that the designer begin with an
   existing DOI and customize only the parts that are unacceptable.

   If a designer chooses to start from scratch, the following MUST be
   defined:

    o  A "situation":  the set of information that will be used to
       determine the required security services.

    o  The set of security policies that must be supported.

    o  A scheme for naming security-relevant information, including
       encryption algorithms, key exchange algorithms, etc.

    o  A syntax for the specification of proposed security services,
       attributes, and certificate authorities.

    o  The specific formats of the various payload contents.

    o  Additional exchange types, if required.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.1%20Situation"></a><a class="selflink" href="#appendix-B.1" name="appendix-B.1">B.1</a> Situation</span>

   The situation is the basis for deciding how to protect a
   communications channel.  It must contain all of the data that will be
   used to determine the types and strengths of protections applied in
   an SA. For example, a US Department of Defense DOI would probably use
   unpublished algorithms and have additional special attributes to
   negotiate.  These additional security attributes would be included in
   the situation.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 79]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-80" id="page-80" name="page-80"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.2%20Security%20Policies"></a><a class="selflink" href="#appendix-B.2" name="appendix-B.2">B.2</a> Security Policies</span>

   Security policies define how various types of information must be
   categorized and protected.  The DOI must define the set of security
   policies supported, because both parties in a negotiation must trust
   that the other party understands a situation, and will protect
   information appropriately, both in transit and in storage.  In a
   corporate setting, for example, both parties in a negotiation must
   agree to the meaning of the term "proprietary information" before
   they can negotiate how to protect it.

   Note that including the required security policies in the DOI only
   specifies that the participating hosts understand and implement those
   policies in a full system context.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.3%20Naming%20Schemes"></a><a class="selflink" href="#appendix-B.3" name="appendix-B.3">B.3</a> Naming Schemes</span>

   Any DOI must define a consistent way to name cryptographic
   algorithms, certificate authorities, etc.  This can usually be done
   by using IANA naming conventions, perhaps with some private
   extensions.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.4%20Syntax%20for%20Specifying%20Security%20Services"></a><a class="selflink" href="#appendix-B.4" name="appendix-B.4">B.4</a> Syntax for Specifying Security Services</span>

   In addition to simply specifying how to name entities, the DOI must
   also specify the format for complete proposals of how to protect
   traffic under a given situation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.5%20Payload%20Specification"></a><a class="selflink" href="#appendix-B.5" name="appendix-B.5">B.5</a> Payload Specification</span>

   The DOI must specify the format of each of the payload types.  For
   several of the payload types, ISAKMP has included fields that would
   have to be present across all DOI (such as a certificate authority in
   the certificate payload, or a key exchange identifier in the key
   exchange payload).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.6%20Defining%20new%20Exchange%20Types"></a><a class="selflink" href="#appendix-B.6" name="appendix-B.6">B.6</a> Defining new Exchange Types</span>

   If the basic exchange types are inadequate to meet the requirements
   within a DOI, a designer can define up to thirteen extra exchange
   types per DOI.  The designer creates a new exchange type by choosing
   an unused exchange type value, and defining a sequence of messages
   composed of strings of the ISAKMP payload types.

   Note that any new exchange types must be rigorously analyzed for
   vulnerabilities.  Since this is an expensive and imprecise
   undertaking, a new exchange type should only be created when
   absolutely necessary.



<span class="grey">Maughan, et. al.            Standards Track                    [Page 80]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-81" id="page-81" name="page-81"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


Security Considerations

   Cryptographic analysis techniques are improving at a steady pace.
   The continuing improvement in processing power makes once
   computationally prohibitive cryptographic attacks more realistic.
   New cryptographic algorithms and public key generation techniques are
   also being developed at a steady pace.  New security services and
   mechanisms are being developed at an accelerated pace.  A consistent
   method of choosing from a variety of security services and mechanisms
   and to exchange attributes required by the mechanisms is important to
   security in the complex structure of the Internet.  However, a system
   that locks itself into a single cryptographic algorithm, key exchange
   technique, or security mechanism will become increasingly vulnerable
   as time passes.

   UDP is an unreliable datagram protocol and therefore its use in
   ISAKMP introduces a number of security considerations.  Since UDP is
   unreliable, but a key management protocol must be reliable, the
   reliability is built into ISAKMP. While ISAKMP utilizes UDP as its
   transport mechanism, it doesn't rely on any UDP information (e.g.
   checksum, length) for its processing.

   Another issue that must be considered in the development of ISAKMP is
   the effect of firewalls on the protocol.  Many firewalls filter out
   all UDP packets, making reliance on UDP questionable in certain
   environments.

   A number of very important security considerations are presented in
   [<a href="#ref-SEC-ARCH" title='"Security Architecture for the Internet Protocol"'>SEC-ARCH</a>].  One bears repeating.  Once a private session key is
   created, it must be safely stored.  Failure to properly protect the
   private key from access both internal and external to the system
   completely nullifies any protection provided by the IP Security
   services.

IANA Considerations

   This document contains many "magic" numbers to be maintained by the
   IANA.  This section explains the criteria to be used by the IANA to
   assign additional numbers in each of these lists.

Domain of Interpretation

   The Domain of Interpretation (DOI) is a 32-bit field which identifies
   the domain under which the security association negotiation is taking
   place.  Requests for assignments of new DOIs must be accompanied by a
   standards-track RFC which describes the specific domain.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 81]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-82" id="page-82" name="page-82"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


Supported Security Protocols

   ISAKMP is designed to provide security association negotiation and
   key management for many security protocols.  Requests for identifiers
   for additional security protocols must be accompanied by a
   standards-track RFC which describes the security protocol and its
   relationship to ISAKMP.

Acknowledgements

   Dan Harkins, Dave Carrel, and Derrell Piper of Cisco Systems provided
   design assistance with the protocol and coordination for the [<a href="#ref-IKE" title='"The Internet Key Exchange (IKE)"'>IKE</a>]
   and [<a href="#ref-IPDOI" title='"The Internet IP Security Domain of Interpretation for ISAKMP"'>IPDOI</a>] documents.

   Hilarie Orman, via the Oakley key exchange protocol, has
   significantly influenced the design of ISAKMP.

   Marsha Gross, Bill Kutz, Mike Oehler, Pete Sell, and Ruth Taylor
   provided significant input and review to this document.

   Scott Carlson ported the TIS DNSSEC prototype to FreeBSD for use with
   the ISAKMP prototype.

   Jeff Turner and Steve Smalley contributed to the prototype
   development and integration with ESP and AH.

   Mike Oehler and Pete Sell performed interoperability testing with
   other ISAKMP implementors.

   Thanks to Carl Muckenhirn of SPARTA, Inc.  for his assistance with
   LaTeX.

References

   [<a id="ref-ANSI" name="ref-ANSI">ANSI</a>]     ANSI, X9.42:  Public Key Cryptography for the Financial
              Services Industry -- Establishment of Symmetric Algorithm
              Keys Using Diffie-Hellman, Working Draft, April 19, 1996.

   [<a id="ref-BC" name="ref-BC">BC</a>]       Ballardie, A., and J. Crowcroft, Multicast-specific
              Security Threats and Countermeasures, Proceedings of 1995
              ISOC Symposium on Networks &amp; Distributed Systems Security,
              pp. 17-30, Internet Society, San Diego, CA, February 1995.

   [<a id="ref-Berge" name="ref-Berge">Berge</a>]    Berge, N., "UNINETT PCA Policy Statements", <a href="rfc1875.html">RFC 1875</a>,
              December 1995.






<span class="grey">Maughan, et. al.            Standards Track                    [Page 82]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-83" id="page-83" name="page-83"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   [<a id="ref-CW87" name="ref-CW87">CW87</a>]     Clark, D.D. and D.R. Wilson, A Comparison of Commercial
              and Military Computer Security Policies, Proceedings of
              the IEEE Symposium on Security &amp; Privacy, Oakland, CA,
              1987, pp. 184-193.

   [<a id="ref-DNSSEC" name="ref-DNSSEC">DNSSEC</a>]   D. Eastlake III, Domain Name System Protocol Security
              Extensions, Work in Progress.

   [<a id="ref-DOW92" name="ref-DOW92">DOW92</a>]    Diffie, W., M.Wiener, P. Van Oorschot, Authentication and
              Authenticated Key Exchanges, Designs, Codes, and
              Cryptography, 2, 107-125, Kluwer Academic Publishers,
              1992.

   [<a id="ref-IAB" name="ref-IAB">IAB</a>]      Bellovin, S., "Report of the IAB Security Architecture
              Workshop", <a href="rfc2316.html">RFC 2316</a>, April 1998.

   [<a id="ref-IKE" name="ref-IKE">IKE</a>]      Harkins, D., and D. Carrel, "The Internet Key Exchange
              (IKE)", <a href="rfc2409.html">RFC 2409</a>, November 1998.

   [<a id="ref-IPDOI" name="ref-IPDOI">IPDOI</a>]    Piper, D., "The Internet IP Security Domain of
              Interpretation for ISAKMP", <a href="rfc2407.html">RFC 2407</a>, November 1998.

   [<a id="ref-Karn" name="ref-Karn">Karn</a>]     Karn, P., and B. Simpson, Photuris:  Session Key
              Management Protocol, Work in Progress.

   [<a id="ref-Kent94" name="ref-Kent94">Kent94</a>]   Steve Kent, IPSEC SMIB, e-mail to ipsec@ans.net, August
              10, 1994.

   [<a id="ref-Oakley" name="ref-Oakley">Oakley</a>]   Orman, H., "The Oakley Key Determination Protocol",  <a href="rfc2412.html">RFC</a>
              <a href="rfc2412.html">2412</a>, November 1998.

   [<a id="ref-RFC-1422" name="ref-RFC-1422">RFC-1422</a>] Kent, S., "Privacy Enhancement for Internet Electronic
              Mail:  Part II: Certificate-Based Key Management", <a href="rfc1422.html">RFC</a>
              <a href="rfc1422.html">1422</a>, February 1993.

   [<a id="ref-RFC-1949" name="ref-RFC-1949">RFC-1949</a>] Ballardie, A., "Scalable Multicast Key Distribution", <a href="rfc1949.html">RFC</a>
              <a href="rfc1949.html">1949</a>, May 1996.

   [<a id="ref-RFC-2093" name="ref-RFC-2093">RFC-2093</a>] Harney, H., and C. Muckenhirn, "Group Key Management
              Protocol (GKMP) Specification", <a href="rfc2093.html">RFC 2093</a>, July 1997.

   [<a id="ref-RFC-2094" name="ref-RFC-2094">RFC-2094</a>] Harney, H., and C. Muckenhirn, "Group Key Management
              Protocol (GKMP) Architecture", <a href="rfc2094.html">RFC 2094</a>, July 1997.

   [<a id="ref-RFC-2119" name="ref-RFC-2119">RFC-2119</a>] Bradner, S., "Key Words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.





<span class="grey">Maughan, et. al.            Standards Track                    [Page 83]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-84" id="page-84" name="page-84"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


   [<a id="ref-Schneier" name="ref-Schneier">Schneier</a>] Bruce Schneier, Applied Cryptography - Protocols,
              Algorithms, and Source Code in C (Second Edition), John
              Wiley &amp; Sons, Inc., 1996.

   [<a id="ref-SEC-ARCH" name="ref-SEC-ARCH">SEC-ARCH</a>] Atkinson, R., and S. Kent, "Security Architecture for the
              Internet Protocol", <a href="rfc2401.html">RFC 2401</a>, November 1998.

   [<a id="ref-STD-2" name="ref-STD-2">STD-2</a>]   Reynolds, J., and J. Postel, "Assigned Numbers", STD 2, <a href="rfc1700.html">RFC</a>
              <a href="rfc1700.html">1700</a>, October 1994.  See also:
              <a href="http://www.iana.org/numbers.html">http://www.iana.org/numbers.html</a>









































<span class="grey">Maughan, et. al.            Standards Track                    [Page 84]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-85" id="page-85" name="page-85"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


Authors' Addresses

   Douglas Maughan
   National Security Agency
   ATTN: R23
   9800 Savage Road
   Ft.  Meade, MD. 20755-6000

   Phone:  301-688-0847
   EMail:wdm@tycho.ncsc.mil


   Mark Schneider
   National Security Agency
   ATTN: R23
   9800 Savage Road
   Ft.  Meade, MD. 20755-6000

   Phone:  301-688-0851
   EMail:mss@tycho.ncsc.mil


   Mark Schertler
   Securify, Inc.
   2415-B Charleston Road
   Mountain View, CA 94043

   Phone:  650-934-9303
   EMail:mjs@securify.com


   Jeff Turner
   RABA Technologies, Inc.
   10500 Little Patuxent Parkway
   Columbia, MD. 21044

   Phone:  410-715-9399
   EMail:jeff.turner@raba.com













<span class="grey">Maughan, et. al.            Standards Track                    [Page 85]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-86" id="page-86" name="page-86"> </a>
<span class="grey"><a href="rfc2408.html">RFC 2408</a>                         ISAKMP                    November 1998</span>


Full Copyright Statement

   Copyright (C) The Internet Society (1998).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
























Maughan, et. al.            Standards Track                    [Page 86]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc2408 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:53 GMT --></html>