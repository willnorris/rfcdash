<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7743 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-zjns-mpls-lsp-ping-relay-reply" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7743" name="DC.Identifier"/>
<meta content="January, 2016" name="DC.Date.Issued"/>
<meta content="Swallow, George" name="DC.Creator"/>
<meta content="Nadeau, Tom" name="DC.Creator"/>
<meta content="Jin, Lizhong" name="DC.Creator"/>
<meta content='In some inter-AS (Autonomous System) and inter-area deployment
scenarios for RFC 4379 ("Label Switched Path (LSP) Ping and
Traceroute"), a replying Label Switching Router (LSR) may not have the
available route to an initiator, and the Echo Reply message sent to
the initiator would be discarded, resulting in false negatives or a
complete failure of operation of the LSP Ping and Traceroute. This
document describes extensions to the LSP Ping mechanism to enable the
replying LSR to have the capability to relay the Echo Response by a
set of routable intermediate nodes to the initiator. This document
updates RFC 4379.' name="DC.Description.Abstract"/>
<meta content="Relayed Echo Reply Mechanism for Label Switched Path (LSP) Ping" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7743 - Relayed Echo Reply Mechanism for Label Switched Path (LSP) Ping</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7743.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7743" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mpls-lsp-ping-relay-reply" title="draft-ietf-mpls-lsp-ping-relay-reply">draft-ietf-mpls...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7743" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7743" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7743" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                       J. Luo, Ed.
Request for Comments: 7743                                           ZTE
Updates: <a href="rfc4379.html">4379</a>                                                L. Jin, Ed.
Category: Standards Track
ISSN: 2070-1721                                           T. Nadeau, Ed.
                                                                 Brocade
                                                         G. Swallow, Ed.
                                                                   Cisco
                                                            January 2016


    <span class="h1">Relayed Echo Reply Mechanism for Label Switched Path (LSP) Ping</span>

Abstract

   In some inter-AS (Autonomous System) and inter-area deployment
   scenarios for <a href="rfc4379.html">RFC 4379</a> ("Label Switched Path (LSP) Ping and
   Traceroute"), a replying Label Switching Router (LSR) may not have
   the available route to an initiator, and the Echo Reply message sent
   to the initiator would be discarded, resulting in false negatives or
   a complete failure of operation of the LSP Ping and Traceroute.  This
   document describes extensions to the LSP Ping mechanism to enable the
   replying LSR to have the capability to relay the Echo Response by a
   set of routable intermediate nodes to the initiator.  This document
   updates <a href="rfc4379.html">RFC 4379</a>.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7743">http://www.rfc-editor.org/info/rfc7743</a>.












<span class="grey">Luo, et al.                  Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of

   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Conventions Used in This Document ..........................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Motivation ......................................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. Extensions ......................................................<a href="#page-5">5</a>
      <a href="#section-3.1">3.1</a>. Relayed Echo Reply Message .................................<a href="#page-5">5</a>
      <a href="#section-3.2">3.2</a>. Relay Node Address Stack ...................................<a href="#page-6">6</a>
      <a href="#section-3.3">3.3</a>. MTU Exceeded Return Code ...................................<a href="#page-8">8</a>
   <a href="#section-4">4</a>. Procedures ......................................................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. Sending an Echo Request ....................................<a href="#page-9">9</a>
      <a href="#section-4.2">4.2</a>. Receiving an Echo Request ..................................<a href="#page-9">9</a>
      <a href="#section-4.3">4.3</a>. Originating a Relayed Echo Reply ..........................<a href="#page-10">10</a>
      <a href="#section-4.4">4.4</a>. Relaying a Relayed Echo Reply .............................<a href="#page-11">11</a>
      <a href="#section-4.5">4.5</a>. Sending an Echo Reply .....................................<a href="#page-11">11</a>
      <a href="#section-4.6">4.6</a>. Sending Subsequent Echo Requests ..........................<a href="#page-12">12</a>
      <a href="#section-4.7">4.7</a>. Impact on Traceroute ......................................<a href="#page-12">12</a>
   <a href="#section-5">5</a>. LSP Ping Relayed Echo Reply Example ............................<a href="#page-13">13</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-14">14</a>
   <a href="#section-7">7</a>. Backward Compatibility .........................................<a href="#page-15">15</a>
   <a href="#section-8">8</a>. IANA Considerations ............................................<a href="#page-15">15</a>
      <a href="#section-8.1">8.1</a>. MPLS Relayed Echo Reply ...................................<a href="#page-15">15</a>
      <a href="#section-8.2">8.2</a>. Relay Node Address Stack TLV ..............................<a href="#page-16">16</a>
      <a href="#section-8.3">8.3</a>. MTU Exceeded Return Code ..................................<a href="#page-16">16</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-16">16</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-16">16</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-17">17</a>
   Acknowledgements ..................................................<a href="#page-17">17</a>
   Contributors ......................................................<a href="#page-17">17</a>
   Authors' Addresses ................................................<a href="#page-18">18</a>





<span class="grey">Luo, et al.                  Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This document describes extensions to the Label Switched Path (LSP)
   Ping specified in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] by adding a Relayed Echo Reply mechanism
   that could be used to report data-plane failures for inter-AS
   (Autonomous System) and inter-area LSPs.  Without these extensions,
   the ping functionality provided by [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] would fail in many
   deployed inter-AS scenarios, since the replying Label Switching
   Router (LSR) in one AS may not have an available route to the
   initiator in the other AS.  The mechanism in this document defines a
   new Message Type referred to as the "Relayed Echo Reply message" and
   a new TLV referred to as the "Relay Node Address Stack TLV".

   This document updates [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>]; it includes updates to the Echo
   Request sending procedure in <a href="rfc4379.html#section-4.3">Section 4.3 of [RFC4379]</a>, the Echo
   Request receiving procedure in <a href="rfc4379.html#section-4.4">Section 4.4 of [RFC4379]</a>, the Echo
   Reply sending procedure in <a href="rfc4379.html#section-4.5">Section 4.5 of [RFC4379]</a>, and the Echo
   Reply receiving procedure in <a href="rfc4379.html#section-4.6">Section 4.6 of [RFC4379]</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Motivation"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Motivation</span>

   LSP Ping [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] defines a mechanism to detect data-plane failures
   and localize faults.  The mechanism specifies that the Echo Reply
   should be sent back to the initiator using a UDP packet with the
   IPv4/IPv6 destination address set to an address of the LSR that
   originated the Echo Request.  This works in administrative domains
   where IP-address reachability is allowed among LSRs and every LSR is
   able to route back to the originating LSR.  However, in practice,
   this is often not the case due to intra-provider routing policy,
   route hiding, and network address translation at Autonomous System
   Border Routers (ASBRs).  In fact, it is almost always the case that
   in inter-AS scenarios, the only node in one AS to which direct
   routing is allowed from the other AS is the ASBR, and routing
   information from within one AS is not distributed into another AS.

   Figure 1 demonstrates a case where an LSP is set up between PE1 and
   PE2.  If PE1's IP address is not distributed to AS2, a traceroute
   from PE1 directed towards PE2 can result in a failure because an LSR
   in AS2 may not be able to send the Echo Reply message.  For example,
   P2 cannot forward packets back to PE1 given that it is a routable IP
   address in AS1 but not routable in AS2.  In this case, PE1 would




<span class="grey">Luo, et al.                  Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   detect a path break, as the Echo Reply messages would not be
   received.  Then, localization of the actual fault would not be
   possible.

   Note that throughout the document, "routable address" means that it
   is possible to route an IP packet to this address using the normal
   information exchanged by the IGP and BGP (or EGP) operating in the
   AS.

   +-------+   +-------+   +------+   +------+   +------+   +------+
   |       |   |       |   |      |   |      |   |      |   |      |
   |  PE1  +---+   P1  +---+ ASBR1+---+ ASBR2+---+  P2  +---+  PE2 |
   |       |   |       |   |      |   |      |   |      |   |      |
   +-------+   +-------+   +------+   +------+   +------+   +------+
   &lt;---------------AS1-------------&gt;&lt;---------------AS2------------&gt;
   &lt;---------------------------- LSP ------------------------------&gt;

                Figure 1: Simple Inter-AS LSP Configuration

   A second example that illustrates how [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] would be insufficient
   would be the inter-area situation in a seamless MPLS architecture
   [<a href="#ref-MPLSARCH" title='"Seamless MPLS Architecture"'>MPLSARCH</a>] as shown below in Figure 2.  In this example, LSRs in the
   core network would not have an IP-reachable route to any of the
   access nodes (ANs).  When tracing an LSP from one AN to the remote
   AN, the LSR1/LSR2 node cannot send the Echo Reply either, like the P2
   node in the inter-AS scenario in Figure 1.

              +-------+   +-------+   +------+   +------+
              |       |   |       |   |      |   |      |
           +--+ AGN11 +---+ AGN21 +---+ ABR1 +---+ LSR1 +--&gt; to AGN
          /   |       |  /|       |   |      |   |      |
   +----+/    +-------+\/ +-------+   +------+  /+------+
   | AN |              /\                     \/
   +----+\    +-------+  \+-------+   +------+/\ +------+
          \   |       |   |       |   |      |  \|      |
           +--+ AGN12 +---+ AGN22 +---+ ABR2 +---+ LSR2 +--&gt; to AGN
              |       |   |       |   |      |   |      |
              +-------+   +-------+   +------+   +------+
   static route    IS-IS L1 LDP            IS-IS L2 LDP
   &lt;-Access-&gt;&lt;--Aggregation Domain--&gt;&lt;---------Core---------&gt;

   AGN: aggregation node

                   Figure 2: Seamless MPLS Architecture







<span class="grey">Luo, et al.                  Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   This document describes extensions to the LSP Ping mechanism to
   facilitate a response from the replying LSR by defining a mechanism
   that uses a relay node (e.g., ASBR) to relay the message back to the
   initiator.  Every designated or learned relay node must be reachable
   to the next relay node or to the initiator.  Using a recursive
   approach, a relay node could relay the message to the next relay node
   until the initiator is reached.

   The LSP Ping relay mechanism in this document is defined for unicast.
   How to apply the LSP Ping relay mechanism in multicast is out of
   scope.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Extensions"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Extensions</span>

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>] defines two Message Types: Echo Request and Echo Reply.
   This document defines a new Message Type: Relayed Echo Reply.  The
   Relayed Echo Reply message is used in place of the Echo Reply message
   when an LSR is replying LSR to a relay node.

   A new TLV named the "Relay Node Address Stack TLV" is defined in this
   document to carry the IP addresses of the relay nodes for the
   replying LSR.

   In addition, the Maximum Transmission Unit (MTU) Exceeded Return Code
   is defined to indicate to the initiator that one or more TLVs will
   not be returned due to the MTU size.

   It should be noted that this document focuses only on detecting the
   LSP that is set up using a uniform IP address family type.  That is,
   all hops between the source and destination node use the same address
   family type for their LSP Ping control planes.  This does not
   preclude nodes that support both IPv6 and IPv4 addresses
   simultaneously, but the entire path must be addressable using only
   one address family type.  Support for mixed IPv4-only and IPv6-only
   is beyond the scope of this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Relayed%20Echo%20Reply%20Message"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Relayed Echo Reply Message</span>

   The Relayed Echo Reply message is a UDP packet, and the UDP payload
   has the same format with Echo Request/Reply message.  A new Message
   Type is requested from IANA.

   New Message Type:
       Value    Meaning
       -----    -------
       5        MPLS Relayed Echo Reply





<span class="grey">Luo, et al.                  Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   The use of TCP and UDP port number 3503 is described in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] and
   has been allocated by IANA for LSP Ping messages.  The Relayed Echo
   Reply message will use the same port number.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Relay%20Node%20Address%20Stack"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Relay Node Address Stack</span>

   The Relay Node Address Stack TLV is an optional TLV.  It MUST be
   carried in the Echo Request, Echo Reply, and Relayed Echo Reply
   messages if the Echo Reply relayed mechanism described in this
   document is required.  Figure 3 illustrates the TLV format.

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                Type           |               Length          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |   Initiator Source Port       | Reply Add Type|   Reserved    |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |    Source Address of Replying Router (0, 4, or 16 octets)     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |  Destination Address Offset   |   Number of Relayed Addresses |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                                                               |
     ~                Stack of Relayed Addresses                     ~
     |                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 3: Relay Node Address Stack TLV

   -  Type: Value is 32768.  The value has been assigned by IANA from
      the 32768-49161 range as suggested by <a href="rfc4379.html#section-3">[RFC4379], Section 3</a>.

   -  Length: The length of the value field in octets.

   -  Initiator Source Port: The source UDP port that the initiator uses
      in the Echo Request message, and the port that is expected to
      receive the Echo Reply message.

   -  Reply Address Type: Address type of replying router.  This value
      also implies the length of the address field as shown below.

   Type#   Address Type   Address Length
   ----    ------------   ------------
   0       Null           0
   1       IPv4           4
   2       IPv6           16





<span class="grey">Luo, et al.                  Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   -  Reserved: This field is reserved and MUST be set to zero.

   -  Source Address of Replying Router: Source IP address of the
      originator of Echo Reply or Relay Echo Reply message.

   -  Destination Address Offset: The offset in octets from the top-of-
      stack to the destination address entry.  Each entry size has been
      listed in this section.  Please also refer to <a href="#section-4.2">Section 4.2</a> for more
      detail of the operation.

   -  Number of Relayed Addresses: An integer indicating the number of
      relayed addresses in the stack.

   -  Stack of Relayed Addresses: A list of relay node address entries.
      This stack grows downward, with relay node addresses that are
      further along the LSP appearing lower down in the stack.  Please
      refer to <a href="#section-4.2">Section 4.2</a> for the relay node discovery mechanism.

   The format of each relay node address entry is as below:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Address  Type |K|  Reserved   |          Reserved             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~           Relayed Address (0, 4, or 16 octets)                ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Figure 4: Relay Node Address Entry

   Type#   Address Type   Address Length   Size of the Entry
   ----    ------------   ------------     -----------------
   0       Null           0                4
   1       IPv4           4                8
   2       IPv6           16               20

   Reserved: The two fields are reserved and MUST be set to zero.

   K bit: If the K bit is set to 1, then this address stack entry MUST
   NOT be stripped from the Relay Node Address Stack during the
   processing described in <a href="#section-4.2">Section 4.2</a>.  If the K bit is clear, the
   entry might be stripped according to the processing described in
   <a href="#section-4.2">Section 4.2</a>.

   Having the K bit set in the relay node address entry causes that
   entry to be preserved in the Relay Node Address Stack TLV for the
   entire traceroute operation.  A responder node MAY set the K bit to
   ensure its relay node address entry remains as one of the relay nodes



<span class="grey">Luo, et al.                  Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   in the Relay Node Address Stack TLV.  The address with the K bit set
   will always be a relay node address for the Relayed Echo Reply, see
   <a href="#section-4.3">Section 4.3</a>.

   Relayed Address: This field specifies the node address: either IPv4
   or IPv6.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20MTU%20Exceeded%20Return%20Code"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  MTU Exceeded Return Code</span>

   This Return Code is defined to indicate that one or more TLVs were
   omitted from the Echo Reply or Relayed Echo Reply message to avoid
   exceeding the message's effective MTU size.  These TLVs MAY be
   included in an Errored TLV's Object with their lengths set to 0 and
   no value.  The return sub-code MUST be set to the value that
   otherwise would have been sent.  For more detail, please refer to
   <a href="#section-4.2">Section 4.2</a>.

   MTU Exceeded Return Code:
       Value    Meaning
       -----    -------
       20       One or more TLVs not returned due to MTU size

   This document updates step 7 in <a href="rfc4379.html#section-4.4">Section 4.4 of [RFC4379]</a> to integrate
   the processing of the MTU Exceeded Return Code by adding the
   following text:

      Before sending Echo Reply, the new packet size should be checked.
      If Best-return-code is 3 ("Replying router is an egress for the
      FEC at stack depth"), or 8 ("Label switched at stack-depth"), and
      if the packet size exceeds MTU size, then Best-return-code is 20
      ("One or more TLVs not returned due to MTU size").

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Procedures"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Procedures</span>

   To perform a ping operation, the initiator first discovers the relay
   nodes.  Once those nodes have been discovered, the initiator includes
   the Relay Node Address Stack TLV into any Echo Request message.  The
   node can then ping as normal.  Note that, in some cases, the repeated
   lack of replies to Echo Request messages may be due to a route change
   that has impacted the necessary stack of relay nodes.  In this case,
   the initiator may need to rediscover the relay nodes.  The following
   sections describe the procedures for sending and receiving Echo
   Request messages with the Relay Node Address Stack TLV.  These
   procedures can be used in traceroute mode to discover the relay
   nodes.






<span class="grey">Luo, et al.                  Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Sending%20an%20Echo%20Request"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Sending an Echo Request</span>

   In addition to the procedures described in <a href="rfc4379.html#section-4.3">Section 4.3 of [RFC4379]</a>,
   a Relay Node Address Stack TLV MUST be carried in the Echo Request
   message if the relay functionality is required.  The relay function
   initiation is out of the scope of this document.  One possible way to
   do this is that the operator can explicitly add an option to the ping
   command.

   When the initiator sends the first Echo Request with a Relay Node
   Address Stack TLV, the TLV MUST contain the initiator address as the
   first entry of the stack of relayed addresses, the Destination
   Address Offset set to this entry, and the source address of the
   replying router set to null.  The Initiator Source Port field MUST be
   set to the source UDP port.  Note that the first relay node address
   in the stack will always be the initiator's address.

   When sending a subsequent Echo Request message, refer to <a href="#section-4.6">Section 4.6</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Receiving%20an%20Echo%20Request"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Receiving an Echo Request</span>

   The Type of the Relay Node Address Stack TLV (32768) falls within the
   range defined in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] as "optional TLVs" that can be silently
   dropped if not recognized.  An LSR that does not recognize the TLV
   SHOULD ignore it.

   In addition to the processes in <a href="rfc4379.html#section-4.4">Section 4.4 of [RFC4379]</a>, the
   procedures of the Relay Node Address Stack TLV are defined here.

   Upon receiving a Relay Node Address Stack TLV in an Echo Request
   message, the receiver updates the "Source Address of Replying
   Router".  The address MUST be the same as the source IP address of
   Relay Echo Reply (<a href="#section-4.3">Section 4.3</a>) or Echo Reply message (<a href="#section-4.5">Section 4.5</a>)
   being sent.

   Those address entries with the K bit set to 1 MUST be kept in the
   stack.  The receiver MUST check the addresses of the stack in
   sequence from bottom to top to find the last address in the stack
   with the K bit set (or the top of the stack if no K bit was found).
   The receiver then checks the stack beginning with this entry,
   proceeding towards the bottom to find the first routable address IP
   address.  The Destination Address Offset MUST be set to this entry,
   which is also the resolved destination address.  Address entries
   below the first routable IP address MUST be deleted.  At least one
   address entry of the replying LSR MUST be added at the bottom of the
   stack.  A second address entry (or more) MAY also be added if
   necessary, depending on implementation.  The final address added MUST
   be an address that is reachable through the interface that the Echo



<span class="grey">Luo, et al.                  Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   Request message would have been forwarded to if its TTL had not
   expired at this node.  The updated Relay Node Address Stack TLV MUST
   be carried in the response message.

   If the replying LSR is configured to hide its routable address
   information, the address entry added in the stack MUST be a NIL entry
   with Address Type set to NULL.

   If a node spans two addressing domains (with respect to this message)
   where nodes on either side may not be able to reach nodes in the
   other domain, then the final address added SHOULD set the K bit.  One
   example of spanning two address domains is the ASBR node.

   K bit applies in the case of a NULL address, to serve as a warning to
   the initiator that further Echo Request messages may not result in
   receiving Echo Reply messages.

   If the full reply message would exceed the MTU size, the Relay Node
   Address Stack TLV SHOULD be included in the Echo Reply message (i.e.,
   other optional TLVs are excluded).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Originating%20a%20Relayed%20Echo%20Reply"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Originating a Relayed Echo Reply</span>

   The destination address determined as described in <a href="#section-4.2">Section 4.2</a> is
   used as the next relay node address.  If the resolved next relay node
   address is not routable, then the sending of the Relayed Echo Reply
   or Echo Reply will fail.

   If the first IP address in the Relay Node Address Stack TLV is not
   the next relay node address, the replying LSR SHOULD send a Relayed
   Echo Reply message to the next relay node.  The processing of Relayed
   Echo Reply is the same with the procedure of the Echo Reply described
   in <a href="rfc4379.html#section-4.5">Section 4.5 of [RFC4379]</a>, except the destination IP address and
   the destination UDP port.  The destination IP address of the Relayed
   Echo Reply is set to the next relay node address from the Relay Node
   Address Stack TLV, and both the source and destination UDP port are
   set to 3503.  The updated Relay Node Address Stack TLV described in
   <a href="#section-4.2">Section 4.2</a> MUST be carried in the Relayed Echo Reply message.  The
   Source Address of the Replying Router field is kept unmodified, and
   the Source IP address field of the IP header is set to an address of
   the sending node.

   When the next relay node address is the first one in the address
   list, please refer to <a href="#section-4.5">Section 4.5</a>.







<span class="grey">Luo, et al.                  Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Relaying%20a%20Relayed%20Echo%20Reply"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Relaying a Relayed Echo Reply</span>

   Upon receiving a Relayed Echo Reply message with its own address as
   the destination address in the IP header, the relay node MUST
   determine the next relay node address as described in <a href="#section-4.2">Section 4.2</a>,
   with the modification that the location of the received destination
   address is used instead of the bottom of stack in the algorithm.  The
   Destination Address Offset in Relay Node Address Stack TLV will be
   set to the next relay node address.  Note that unlike in <a href="#section-4.2">Section 4.2</a>,
   no changes are made to the Stack of Relayed Addresses.

   If the next relay node address is not the first one in the address
   list, i.e., another intermediate relay node, the relay node MUST send
   a Relayed Echo Reply message to the determined upstream node with the
   payload unchanged other than the Relay Node Address Stack TLV.  The
   TTL SHOULD be copied from the received Relay Echo Reply and
   decremented by 1.  The Source Address of the Replying Router field is
   kept unmodified and the Source IP address field of the IP header is
   set to an address of the sending node.

   When the next relay node address is the first one in the address
   list, please refer to <a href="#section-4.5">Section 4.5</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20Sending%20an%20Echo%20Reply"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  Sending an Echo Reply</span>

   The Echo Reply is sent in two cases:


   1.  When the replying LSR receives an Echo Request, and the first IP
       address in the Relay Node Address Stack TLV is the next relay
       node address (<a href="#section-4.3">Section 4.3</a>), the replying LSR would send an Echo
       Reply to the initiator.  In addition to the procedure of the Echo
       Reply described in <a href="rfc4379.html#section-4.5">Section 4.5 of [RFC4379]</a>, the updated Relay
       Node Address Stack TLV described in <a href="#section-4.2">Section 4.2</a> MUST be carried
       in the Echo Reply.

       If the receiver does not recognize the Relay Node Address Stack
       TLV, as per Sections <a href="#section-3">3</a> and <a href="#section-4.5">4.5</a> of [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], it will send an Echo
       Reply without including the TLV.

   2.  When the intermediate relay node receives a Relayed Echo Reply,
       and the first IP address in the Relay Node Address Stack TLV is
       the next relay node address (<a href="#section-4.4">Section 4.4</a>), the intermediate relay
       node will send the Echo Reply to the initiator, and update the
       Message Type field from type of "Relayed Echo Reply" to "Echo
       Reply".  The updated Relay Node Address Stack TLV described in
       <a href="#section-4.4">Section 4.4</a> MUST be carried in the Echo Reply.  The destination
       IP address of the Echo Reply is set to the first IP address in



<span class="grey">Luo, et al.                  Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


       the stack, and the destination UDP port will be copied from the
       Initiator Source Port field of the Relay Node Address Stack TLV.
       The source UDP port should be 3503.  The TTL of the Echo Reply
       SHOULD be copied from the received Relay Echo Reply and
       decremented by 1.  The Source Address of the Replying Router
       field is kept unmodified, and the Source IP address field of the
       IP header is set to an address of the sending node.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.6.%20%20Sending%20Subsequent%20Echo%20Requests"></a><a class="selflink" href="#section-4.6" name="section-4.6">4.6</a>.  Sending Subsequent Echo Requests</span>

   During a traceroute operation, multiple Echo Request messages are
   sent.  Each time the TTL is increased, the initiator SHOULD copy the
   Relay Node Address Stack TLV received in the previous Echo Reply to
   the next Echo Request.  The Relay Node Address Stack TLV MUST NOT be
   modified except as follows.  A NIL entry that does not have the K bit
   set MAY be removed.  A NIL entry with the K bit serves as a warning
   that further Echo Request messages are likely not to result in a
   reply.  If, however, the initiator decides to continue a traceroute
   operation, the NIL entry with the K bit set MUST be removed.  The
   Source Address of the Replying Router and Destination Address Offset
   fields may be preserved or reset since these fields are ignored in
   the received MPLS Echo Request.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.7.%20%20Impact%20on%20Traceroute"></a><a class="selflink" href="#section-4.7" name="section-4.7">4.7</a>.  Impact on Traceroute</span>

   The Source IP address in Echo Reply and Relay Echo Reply should be
   the address of the node sending those packets, not the original
   responding node.  Then the traceroute address output module will
   print the source IP address as below:

     if (Relay Node Address Stack TLV exists) {
   Print the Source Address of Replying Router in
   Relay Node Address Stack TLV;
     } else {
   Print the source IP address of Echo Reply message;
     }















<span class="grey">Luo, et al.                  Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20LSP%20Ping%20Relayed%20Echo%20Reply%20Example"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  LSP Ping Relayed Echo Reply Example</span>

   Considering the inter-AS scenario in Figure 5 below, AS1 and AS2 are
   two independent address domains.  In the example, an LSP has been
   created between PE1 to PE2, but PE1 in AS1 is not reachable by P2 in
   AS2.

   +-------+   +-------+   +------+   +------+   +------+   +------+
   |       |   |       |   |      |   |      |   |      |   |      |
   |  PE1  +---+   P1  +---+ ASBR1+---+ ASBR2+---+  P2  +---+  PE2 |
   |       |   |       |   |      |   |      |   |      |   |      |
   +-------+   +-------+   +------+   +------+   +------+   +------+
   &lt;---------------AS1-------------&gt;&lt;---------------AS2------------&gt;
   &lt;--------------------------- LSP -------------------------------&gt;

                      Figure 5: Example Inter-AS LSP

   When performing LSP traceroute on the LSP, the first Echo Request
   sent by PE1 with outermost label TTL=1 contains the Relay Node
   Address Stack TLV with PE1's address as the first relayed address.

   After being processed by P1, P1's interface address facing ASBR1
   without the K bit set will be added in the Relay Node Address Stack
   TLV address list following PE1's address in the Echo Reply.

   PE1 copies the Relay Node Address Stack TLV into the next Echo
   Request when receiving the Echo Reply.

   Upon receiving the Echo Request, ASBR1 checks the address list in the
   Relay Node Address Stack TLV and determines that PE1's address is the
   next relay address.  Then it deletes P1's address, and adds its
   interface address facing ASBR2 with the K bit set.  As a result,
   there will be PE1's address followed by ASBR1's interface address
   facing ASBR2 in the Relay Node Address Stack TLV of the Echo Reply
   sent by ASBR1.

   PE1 then sends an Echo Request with outermost label TTL=3, containing
   the Relay Node Address Stack TLV copied from the received Echo Reply
   message.  Upon receiving the Echo Request message, ASBR2 checks the
   address list in the Relay Node Address Stack TLV and determines that
   ASBR1's interface address is the next relay address in the stack TLV.
   ASBR2 adds its interface address facing P2 with the K bit set.  Then
   ASBR2 sets the next relay address as the destination address of the
   Relayed Echo Reply and sends the Relayed Echo Reply to ASBR1.







<span class="grey">Luo, et al.                  Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   Upon receiving the Relayed Echo Reply from ASBR2, ASBR1 checks the
   address list in the Relay Node Address Stack TLV and determines that
   PE1's address is the next relay node.  Then ASBR1 sends an Echo Reply
   to PE1.

   For the Echo Request with outermost label TTL=4, P2 checks the
   address list in the Relay Node Address Stack TLV and determines that
   ASBR2's interface address is the next relay address.  Then P2 sends a
   Relayed Echo Reply to ASBR2 with the Relay Node Address Stack TLV
   containing four addresses: PE1's, ASBR1's interface address, ASBR2's
   interface address, and P2's interface address facing PE2 in sequence.

   Then, according to the process described in <a href="#section-4.4">Section 4.4</a>, ASBR2 sends
   the Relayed Echo Reply to ASBR1.  Upon receiving the Relayed Echo
   Reply, ASBR1 sends an Echo Reply to PE1.  And, as relayed by ASBR2
   and ASBR1, the Echo Reply would finally be sent to the initiator PE1.

   For the Echo Request with outermost label TTL=5, the Echo Reply would
   relayed to PE1 by ASBR2 and ASBR1, similar to the case of TTL=4.

   The Echo Reply from the replying node that has no IP reachable route
   to the initiator is thus transmitted to the initiator by multiple
   relay nodes.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   The Relayed Echo Reply mechanism for LSP Ping creates an increased
   risk of DoS by putting the IP address of a target router in the Relay
   Node Address Stack.  These messages could then be used to attack the
   control plane of an LSR by overwhelming it with these packets.  A
   rate limiter SHOULD be applied to the well-known UDP port on the
   relay node as suggested in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>].  The node that acts as a relay
   node SHOULD validate the relay reply against a set of valid source
   addresses and discard packets from untrusted border router addresses.
   An implementation SHOULD provide such filtering capabilities.

   If an operator wants to obscure their nodes, it is RECOMMENDED that
   they replace the replying node address that originated the Echo Reply
   with the NIL address entry in the Relay Node Address Stack TLV.

   A receiver of an MPLS Echo Request could verify that the first
   address in the Relay Node Address Stack TLV is the same address as
   the source IP address field of the received IP header.








<span class="grey">Luo, et al.                  Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


   The Relay Node Address Stack TLV has the path information of the LSP,
   and such information may be maliciously used by any uncontrolled LSR/
   LER.  We have two ways to reduce the path information in the TLV:

   o  It is recommended to clear the K bit in the relay address entry
      unless it must be set (e.g., as listed in <a href="#section-4.2">Section 4.2</a>).

   o  It is recommended to use the NIL address entry to hide node
      information, if possible.

   Other security considerations discussed in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] are also
   applicable to this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Backward%20Compatibility"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Backward Compatibility</span>

   When one of the nodes along the LSP does not support the mechanism
   specified in this document, the node will ignore the Relay Node
   Address Stack TLV as described in <a href="#section-4.2">Section 4.2</a>.  Then the initiator
   may not receive the Relay Node Address Stack TLV in Echo Reply
   message from that node.  In this case, an indication should be
   reported to the operator, and the Relay Node Address Stack TLV in the
   next Echo Request message should be copied from the previous Echo
   Request, and continue the ping process.  If the node described above
   is located between the initiator and the first relay node, the ping
   process could continue without interruption.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  IANA Considerations</span>

   IANA has assigned one new Message Type, one new TLV, and one Return
   Code.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20MPLS%20Relayed%20Echo%20Reply"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  MPLS Relayed Echo Reply</span>

   One new Message Type from the "Multi-Protocol Label Switching (MPLS)
   Label Switched Paths (LSPs) Ping Parameters" registry in the "Message
   Type" subregistry has been allocated:

        Value    Meaning
        -----    -------
        5        MPLS Relayed Echo Reply

   The value has been assigned from the "Standards Action" [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>]
   range (0-191) using the lowest free value within this range.








<span class="grey">Luo, et al.                  Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Relay%20Node%20Address%20Stack%20TLV"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Relay Node Address Stack TLV</span>

   One new TLV from the "Multi-Protocol Label Switching (MPLS) Label
   Switched Paths (LSPs) Ping Parameters" registry in the "TLVs"
   subregistry has been allocated:

        Type    TLV Name
        ----    --------
        32768   Relay Node Address Stack TLV

   The value has been assigned from the "Standards Action" range
   (32768-49161) as suggested by [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] Sections <a href="#section-3">3</a> and <a href="#section-7.2">7.2</a> using the
   first free value within this range.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20MTU%20Exceeded%20Return%20Code"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  MTU Exceeded Return Code</span>

   The MTU Exceeded return code from the "Multi-Protocol Label Switching
   (MPLS) Label Switched Paths (LSPs) Ping Parameters" registry in the
   "Return Codes"subregistry has been allocated:

       Value    Meaning
       -----    -------
       20       One or more TLVs not returned due to MTU size

   The value has been assigned from the "Standards Action" range (0-191)
   using the lowest free value within this range.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Normative%20References"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]  Kompella, K. and G. Swallow, "Detecting Multi-Protocol
              Label Switched (MPLS) Data Plane Failures", <a href="rfc4379.html">RFC 4379</a>,
              DOI 10.17487/RFC4379, February 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4379">http://www.rfc-editor.org/info/rfc4379</a>&gt;.











<span class="grey">Luo, et al.                  Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Informative%20References"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Informative References</span>

   [<a id="ref-MPLSARCH" name="ref-MPLSARCH">MPLSARCH</a>] Leymann, N., Decraene, B., Filsfils, C., Konstantynowicz,
              M., and D. Steinberg, "Seamless MPLS Architecture", Work
              in Progress, <a href="https://tools.ietf.org/html/draft-ietf-mpls-seamless-mpls-07">draft-ietf-mpls-seamless-mpls-07</a>, June 2014.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              DOI 10.17487/RFC5226, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5226">http://www.rfc-editor.org/info/rfc5226</a>&gt;.

Acknowledgements

   The authors would like to thank Carlos Pignataro, Xinwen Jiao, Manuel
   Paul, Loa Andersson, Wim Henderickx, Mach Chen, Thomas Morin, Gregory
   Mirsky, Nobo Akiya, and Joel M. Halpern for their valuable comments
   and suggestions.

Contributors

   Ryan Zheng
   JSPTPD
   371, Zhongshan South Road
   Nanjing 210006
   China

   Email: ryan.zhi.zheng@gmail.com
























<span class="grey">Luo, et al.                  Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7743.html">RFC 7743</a>            MPLS LSP Ping Relayed Echo Reply        January 2016</span>


Authors' Addresses

   Jian Luo (editor)
   ZTE
   50, Ruanjian Avenue
   Nanjing  210012
   China

   Email: luo.jian@zte.com.cn


   Lizhong Jin (editor)
   Shanghai
   China

   Email: lizho.jin@gmail.com


   Thomas Nadeau (editor)
   Brocade

   Email: tnadeau@lucidvision.com


   George Swallow (editor)
   Cisco Systems

   Email: swallow@cisco.com























Luo, et al.                  Standards Track                   [Page 18]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7743 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:19 GMT --></html>