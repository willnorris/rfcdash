<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc4623 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-malis-pwe3-fragmentation" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:4623" name="DC.Identifier"/>
<meta content="August, 2006" name="DC.Date.Issued"/>
<meta content="Townsley, W. Mark" name="DC.Creator"/>
<meta content="Malis, Andrew G." name="DC.Creator"/>
<meta content="This document defines a generalized method of performing fragmentation
for use by Pseudowire Emulation Edge-to-Edge (PWE3) protocols and
services. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Pseudowire Emulation Edge-to-Edge (PWE3) Fragmentation and Reassembly" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 4623 - Pseudowire Emulation Edge-to-Edge (PWE3) Fragmentation and Reassembly</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc4623.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc4623" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-pwe3-fragmentation" title="draft-ietf-pwe3-fragmentation">draft-ietf-pwe3...</a>] [<a href="https://datatracker.ietf.org/doc/rfc4623" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc4623" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc4623" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=4623">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                           A. Malis
Request for Comments: 4623                                       Tellabs
Category: Standards Track                                    M. Townsley
                                                           Cisco Systems
                                                             August 2006


               <span class="h1">Pseudowire Emulation Edge-to-Edge (PWE3)</span>
                     <span class="h1">Fragmentation and Reassembly</span>

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2006).

Abstract

   This document defines a generalized method of performing
   fragmentation for use by Pseudowire Emulation Edge-to-Edge (PWE3)
   protocols and services.
























<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Conventions Used in This Document ...............................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Alternatives to PWE3 Fragmentation/Reassembly ...................<a href="#page-5">5</a>
   <a href="#section-4">4</a>. PWE3 Fragmentation with MPLS ....................................<a href="#page-5">5</a>
      <a href="#section-4.1">4.1</a>. Fragment Bit Locations for MPLS ............................<a href="#page-6">6</a>
      <a href="#section-4.2">4.2</a>. Other Considerations .......................................<a href="#page-6">6</a>
   <a href="#section-5">5</a>. PWE3 Fragmentation with L2TP ....................................<a href="#page-6">6</a>
      <a href="#section-5.1">5.1</a>. PW-Specific Fragmentation vs. IP fragmentation .............<a href="#page-7">7</a>
      <a href="#section-5.2">5.2</a>. Advertising Reassembly Support in L2TP .....................<a href="#page-7">7</a>
      <a href="#section-5.3">5.3</a>. L2TP Maximum Receive Unit (MRU) AVP ........................<a href="#page-8">8</a>
      <a href="#section-5.4">5.4</a>. L2TP Maximum Reassembled Receive Unit (MRRU) AVP ...........<a href="#page-8">8</a>
      <a href="#section-5.5">5.5</a>. Fragment Bit Locations for L2TPv3 Encapsulation ............<a href="#page-9">9</a>
      <a href="#section-5.6">5.6</a>. Fragment Bit Locations for L2TPv2 Encapsulation ............<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-10">10</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-10">10</a>
      <a href="#section-7.1">7.1</a>. Control Message Attribute Value Pairs (AVPs) ..............<a href="#page-11">11</a>
      <a href="#section-7.2">7.2</a>. Default L2-Specific Sublayer Bits .........................<a href="#page-11">11</a>
      <a href="#section-7.3">7.3</a>. Leading Bits of the L2TPv2 Message Header .................<a href="#page-11">11</a>
   <a href="#section-8">8</a>. Acknowledgements ...............................................<a href="#page-11">11</a>
   <a href="#section-9">9</a>. Normative References ...........................................<a href="#page-12">12</a>
   <a href="#section-10">10</a>. Informative References ........................................<a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>. Relationship Between This Document and <a href="rfc1990.html">RFC 1990</a> .......<a href="#page-14">14</a>



























<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Pseudowire Emulation Edge-to-Edge Architecture Document
   [<a href="#ref-Architecture" title='"Pseudo Wire Emulation Edge- to-Edge (PWE3) Architecture"'>Architecture</a>] defines a network reference model for PWE3:

         |&lt;-------------- Emulated Service ----------------&gt;|
         |                                                  |
         |          |&lt;------- Pseudowire -------&gt;|          |
         |          |                            |          |
         |          |    |&lt;-- PSN Tunnel --&gt;|    |          |
         | PW End   V    V                  V    V  PW End  |
         V Service  +----+                  +----+  Service V
   +-----+    |     | PE1|==================| PE2|     |    +-----+
   |     |----------|............PW1.............|----------|     |
   | CE1 |    |     |    |                  |    |     |    | CE2 |
   |     |----------|............PW2.............|----------|     |
   +-----+  ^ |     |    |==================|    |     | ^  +-----+
         ^  |       +----+                  +----+     | |  ^
         |  |   Provider Edge 1         Provider Edge 2  |  |
         |  |                                            |  |
   Customer |                                            | Customer
   Edge 1   |                                            | Edge 2
            |                                            |
            |                                            |
      native service                               native service

                  Figure 1: PWE3 Network Reference Model

   A Pseudowire (PW) payload is normally relayed across the PW as a
   single IP or MPLS Packet Switched Network (PSN) Protocol Data Unit
   (PDU).  However, there are cases where the combined size of the
   payload and its associated PWE3 and PSN headers may exceed the PSN
   path Maximum Transmission Unit (MTU).  When a packet exceeds the MTU
   of a given network, fragmentation and reassembly will allow the
   packet to traverse the network and reach its intended destination.

   The purpose of this document is to define a generalized method of
   performing fragmentation for use with all PWE3 protocols and
   services.  This method should be utilized only in cases where MTU-
   management methods fail.  Due to the increased processing overhead,
   fragmentation and reassembly in core network devices should always be
   considered something to avoid whenever possible.

   The PWE3 fragmentation and reassembly domain is shown in Figure 2:







<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


         |&lt;-------------- Emulated Service ----------------&gt;|
         |          |&lt;---Fragmentation Domain---&gt;|          |
         |          ||&lt;------- Pseudowire -----&gt;||          |
         |          ||                          ||          |
         |          ||   |&lt;-- PSN Tunnel --&gt;|   ||          |
         | PW End   VV   V                  V   VV  PW End  |
         V Service  +----+                  +----+  Service V
   +-----+    |     | PE1|==================| PE2|     |    +-----+
   |     |----------|............PW1.............|----------|     |
   | CE1 |    |     |    |                  |    |     |    | CE2 |
   |     |----------|............PW2.............|----------|     |
   +-----+  ^ |     |    |==================|    |     | ^  +-----+
         ^  |       +----+                  +----+     | |  ^
         |  |   Provider Edge 1         Provider Edge 2  |  |
         |  |                                            |  |
   Customer |                                            | Customer
   Edge 1   |                                            | Edge 2
            |                                            |
            |                                            |
      native service                               native service

              Figure 2: PWE3 Fragmentation/Reassembly Domain

   Fragmentation takes place in the transmitting PE immediately prior to
   PW encapsulation, and reassembly takes place in the receiving PE
   immediately after PW decapsulation.

   Since a sequence number is necessary for the fragmentation and
   reassembly procedures, using the Sequence Number field on fragmented
   packets is REQUIRED (see Sections <a href="#section-4.1">4.1</a> and <a href="#section-5.5">5.5</a> for the location of the
   Sequence Number fields for MPLS and L2TPv3 encapsulations,
   respectively).  The order of operation is that first fragmentation is
   performed, and then the resulting fragments are assigned sequential
   sequence numbers.

   Depending on the specific PWE3 encapsulation in use, the value 0 may
   not be a part of the sequence number space, in which case its use for
   fragmentation must follow this same rule: as the sequence number is
   incremented, it skips zero and wraps from 65535 to 1.  Conversely, if
   the value 0 is part of the sequence space, then the same sequence
   space is also used for fragmentation and reassembly.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Conventions Used in This Document</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="#ref-KEYWORDS" title='"Key words for use in RFCs to Indicate Requirement Levels"'>KEYWORDS</a>].




<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Alternatives%20to%20PWE3%20Fragmentation%2FReassembly"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Alternatives to PWE3 Fragmentation/Reassembly</span>

   Fragmentation and reassembly in network equipment generally requires
   significantly greater resources than sending a packet as a single
   unit.  As such, fragmentation and reassembly should be avoided
   whenever possible.  Ideal solutions for avoiding fragmentation
   include proper configuration and management of MTU sizes between the
   Customer Edge (CE) router and Provider Edge (PE) router and across
   the PSN, as well as adaptive measures that operate with the
   originating host (e.g., [<a href="#ref-PATHMTU" title='"Path MTU discovery"'>PATHMTU</a>], [<a href="#ref-PATHMTUv6" title='"Path MTU Discovery for IP version 6"'>PATHMTUv6</a>]) to reduce the packet
   sizes at the source.

   In some cases, a PE may be able to fragment an IP version 4 (IPv4)
   [<a href="rfc791.html" title='"Internet Protocol"'>RFC791</a>] packet before it enters a PW.  For example, if the PE can
   fragment and forward IPv4 packets with the DF bit clear in a manner
   that is identical to an IPv4 router, it may fragment packets arriving
   from a CE, forwarding the IPv4 fragments with associated framing for
   that attachment circuit (AC) over the PW.  Architecturally, the IPv4
   fragmentation happens before reaching the PW, presenting multiple
   frames to the PW to forward in the normal manner for that PWType.
   Thus, this method is entirely transparent to the PW encapsulation and
   to the remote end of the PW itself.  Packet fragments are ultimately
   reassembled on the destination IPv4 host in the normal way.  IPv6
   packets are not to be fragmented in this manner.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20PWE3%20Fragmentation%20with%20MPLS"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  PWE3 Fragmentation with MPLS</span>

   When using the signaling procedures in [<a href="#ref-MPLS-Control" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>MPLS-Control</a>], there is a
   Pseudowire Interface Parameter Sub-TLV type used to signal the use of
   fragmentation when advertising a VC label [<a href="#ref-IANA" title='"IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)"'>IANA</a>]:

      Parameter      Length    Description
           0x09           4    Fragmentation indicator

   The presence of this parameter in the VC FEC element indicates that
   the receiver is able to reassemble fragments when the control word is
   in use for the VC label being advertised.  It does not obligate the
   sender to use fragmentation; it is simply an indication that the
   sender MAY use fragmentation.  The sender MUST NOT use fragmentation
   if this parameter is not present in the VC FEC element.

   If [<a href="#ref-MPLS-Control" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>MPLS-Control</a>] signaling is not in use, then whether or not to use
   fragmentation MUST be configured in the sender.








<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Fragment%20Bit%20Locations%20for%20MPLS"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Fragment Bit Locations for MPLS</span>

   MPLS-based PWE3 uses the following control word format
   [<a href="#ref-Control-Word" title='"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"'>Control-Word</a>], with the B and E fragmentation bits identified in
   position 8 and 9:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0 0 0 0| Flags |B|E|   Length  |     Sequence Number           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                 Figure 3: Preferred PW MPLS Control Word

   The B and E bits are defined as follows:

   BE
   --
   00 indicates that the entire (un-fragmented) payload is carried
      in a single packet
   01 indicates the packet carrying the first fragment
   10 indicates the packet carrying the last fragment
   11 indicates a packet carrying an intermediate fragment

   See <a href="#appendix-A">Appendix A</a> for a discussion of the derivation of these values for
   the B and E bits.

   See <a href="#section-1">Section 1</a> for the description of the use of the Sequence Number
   field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Other%20Considerations"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Other Considerations</span>

   Path MTU [<a href="#ref-PATHMTU" title='"Path MTU discovery"'>PATHMTU</a>] [<a href="#ref-PATHMTUv6" title='"Path MTU Discovery for IP version 6"'>PATHMTUv6</a>] may be used to dynamically determine
   the maximum size for fragments.  The application of path MTU to MPLS
   is discussed in [<a href="#ref-LABELSTACK" title='"MPLS Label Stack Encoding"'>LABELSTACK</a>].  The maximum size of the fragments may
   also be configured.  The signaled Interface MTU parameter in
   [<a href="#ref-MPLS-Control" title='"Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)"'>MPLS-Control</a>] SHOULD be used to set the maximum size of the
   reassembly buffer for received packets to make optimal use of
   reassembly buffer resources.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20PWE3%20Fragmentation%20with%20L2TP"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  PWE3 Fragmentation with L2TP</span>

   This section defines the location of the B and E bits for L2TPv3
   [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>] and L2TPv2 [<a href="#ref-L2TPv2" title='"Layer Two Tunneling Protocol "'>L2TPv2</a>] headers, as well as the signaling
   mechanism for advertising MRU (Maximum Receive Unit) values and
   support for fragmentation on a given PW.  As IP is the most common
   PSN used with L2TP, IP PSN fragmentation and reassembly is discussed
   as well.



<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20PW-Specific%20Fragmentation%20vs.%20IP%20fragmentation"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  PW-Specific Fragmentation vs. IP fragmentation</span>

   When proper MTU management across a network fails, IP PSN
   fragmentation and reassembly may be used to accommodate MTU
   mismatches between tunnel endpoints.  If the overall traffic
   requiring fragmentation and reassembly is very light, or there are
   sufficient optimized mechanisms for IP PSN fragmentation and
   reassembly available, IP PSN fragmentation and reassembly may be
   sufficient.

   When facing a large number of PW packets requiring fragmentation and
   reassembly, a PW-specific method has properties that potentially
   allow for more resource-friendly implementations.  Specifically, the
   ability to assign buffer usage on a per-PW basis and PW sequencing
   may be utilized to gain advantage over a general mechanism applying
   to all IP packets across all PWs.  Further, PW fragmentation may be
   more easily enabled in a selective manner for some or all PWs, rather
   than enabling reassembly for all IP traffic arriving at a given node.

   Deployments SHOULD avoid a situation that uses a combination of IP
   PSN and PW fragmentation and reassembly on the same node.  Such
   operation clearly defeats the purpose behind the mechanism defined in
   this document.  This is especially important for L2TPv3 pseudowires,
   since potentially fragmentation can take place in three different
   places (the IP PSN, the PW, and the encapsulated payload).  Care must
   be taken to ensure that the MTU/MRU values are set and advertised
   properly at each tunnel endpoint to avoid this.  When fragmentation
   is enabled within a given PW, the DF bit MUST be set on all L2TP over
   IP packets for that PW.

   L2TPv3 nodes SHOULD participate in Path MTU ([<a href="#ref-PATHMTU" title='"Path MTU discovery"'>PATHMTU</a>], [<a href="#ref-PATHMTUv6" title='"Path MTU Discovery for IP version 6"'>PATHMTUv6</a>])
   for automatic adjustment of the PSN MTU.  When the payload is IP,
   Path MTU should be used at they payload level as well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Advertising%20Reassembly%20Support%20in%20L2TP"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Advertising Reassembly Support in L2TP</span>

   The constructs defined in this section for advertising fragmentation
   support in L2TP are applicable to [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>] and [<a href="#ref-L2TPv2" title='"Layer Two Tunneling Protocol "'>L2TPv2</a>].

   This document defines two new AVPs to advertise maximum receive unit
   values and reassembly support.  These AVPs MAY be present in the
   Incoming-Call-Request (ICRQ), Incoming-Call-Reply (ICRP), Incoming-
   Call-Connected (ICCN), Outgoing-Call-Request (OCRQ), Outgoing-Call-
   Reply (OCRP), Outgoing-Call-Connected (OCCN), or Set-Link-Info (SLI)
   messages.  The most recent value received always takes precedence
   over a previous value and MUST be dynamic over the life of the





<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


   session if received via the SLI message.  One of the two new AVPs
   (MRRU) is used to advertise that PWE3 reassembly is supported by the
   sender of the AVP.  Reassembly support MAY be unidirectional.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20L2TP%20Maximum%20Receive%20Unit%20%28MRU%29%20AVP"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  L2TP Maximum Receive Unit (MRU) AVP</span>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|H|0|0|0|0|    Length         |              0                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              MRU              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

              Figure 4: L2TP Maximum Receive Unit (MRU) AVP

   MRU (Maximum Receive Unit), attribute number 94, is the maximum size,
   in octets, of a fragmented or complete PW frame, including L2TP
   encapsulation, receivable by the side of the PW advertising this
   value.  The advertised MRU does NOT include the PSN header (i.e., the
   IP and/or UDP header).  This AVP does not imply that PWE3
   fragmentation or reassembly is supported.  If reassembly is not
   enabled or unavailable, this AVP may be used alone to advertise the
   MRU for a complete frame.

   This AVP MAY be hidden (the H bit MAY be 0 or 1).  The mandatory (M)
   bit for this AVP SHOULD be set to 0.  The Length (before hiding) is
   8.  The Vendor ID is the IETF Vendor ID of 0.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20L2TP%20Maximum%20Reassembled%20Receive%20Unit%20%28MRRU%29%20AVP"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  L2TP Maximum Reassembled Receive Unit (MRRU) AVP</span>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|H|0|0|0|0|    Length         |              0                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              MRRU             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       Figure 5: L2TP Maximum Reassembled Receive Unit (MRRU) AVP

   MRRU (Maximum Reassembled Receive Unit AVP), attribute number 95, is
   the maximum size, in octets, of a reassembled frame, including any PW
   framing, but not including the L2TP encapsulation or L2-specific
   sublayer.  Presence of this AVP signifies the ability to receive PW
   fragments and reassemble them.  Packet fragments MUST NOT be sent by
   a peer that has not received this AVP in a control message.  If the
   MRRU is present in a message, the MRU AVP MUST be present as well.



<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


   The MRRU SHOULD be used to set the maximum size of the reassembly
   buffer for received packets to make optimal use of reassembly buffer
   resources.

   This AVP MAY be hidden (the H bit MAY be 0 or 1).  The mandatory (M)
   bit for this AVP SHOULD be set to 0.  The Length (before hiding) is
   8.  The Vendor ID is the IETF Vendor ID of 0.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.5.%20%20Fragment%20Bit%20Locations%20for%20L2TPv3%20Encapsulation"></a><a class="selflink" href="#section-5.5" name="section-5.5">5.5</a>.  Fragment Bit Locations for L2TPv3 Encapsulation</span>

   The usage of the B and E bits is described in <a href="#section-4.1">Section 4.1</a>.  For
   L2TPv3 encapsulation, the B and E bits are defined as bits 2 and 3 in
   the leading bits of the Default L2-Specific Sublayer (see <a href="#section-7">Section 7</a>).

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|H|0|0|0|0|    Length         |              0                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |x|S|B|E|x|x|x|x|              Sequence Number                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Figure 6: B and E Bits Location in the Default L2-Specific Sublayer

   The S (Sequence) bit is as defined in [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>].  Location of the B
   and E bits for PW-Types that use a variant L2 specific sublayer are
   outside the scope of this document.

   When fragmentation is used, an L2-Specific Sublayer with B and E bits
   defined MUST be present in all data packets for a given session.  The
   presence and format of the L2-Specific Sublayer is advertised via the
   L2-Specific Sublayer AVP, Attribute Type 69, defined in Section 5.4.4
   of [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>].

   See <a href="#section-1">Section 1</a> for the description of the use of the Sequence Number
   field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.6.%20%20Fragment%20Bit%20Locations%20for%20L2TPv2%20Encapsulation"></a><a class="selflink" href="#section-5.6" name="section-5.6">5.6</a>.  Fragment Bit Locations for L2TPv2 Encapsulation</span>

   The usage of the B and E bits is described in <a href="#section-4.1">Section 4.1</a>.  For
   L2TPv2 encapsulation, the B and E bits are defined as bits 8 and 9 in
   the leading bits of the L2TPv2 header as depicted below (see <a href="#section-7">Section</a>
   <a href="#section-7">7</a>).








<span class="grey">Malis &amp; Townsley            Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|H|0|0|0|0|    Length         |              0                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |T|L|x|x|S|x|O|P|B|E|x|x|  Ver  |          Length (opt)         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       Figure 7: B and E bits location in the L2TPv2 Message Header

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   As with any additional protocol construct, each level of complexity
   adds the potential to exploit protocol and implementation errors.
   Implementers should be especially careful of not tying up an
   abundance of resources, even for the most pathological combination of
   packet fragments that could be received.  Beyond these issues of
   general implementation quality, there are no known notable security
   issues with using the mechanism defined in this document.  It should
   be pointed out that <a href="rfc1990.html">RFC 1990</a>, on which this document is based, and
   its derivatives have been widely implemented and extensively used in
   the Internet and elsewhere.

   [<a id="ref-IPFRAG-SEC" name="ref-IPFRAG-SEC">IPFRAG-SEC</a>] and [<a href="#ref-TINYFRAG" title='"Protection Against a Variant of the Tiny Fragment Attack (RFC 1858)"'>TINYFRAG</a>] describe potential network attacks
   associated with IP fragmentation and reassembly.  The issues
   described in these documents attempt to bypass IP access controls by
   sending various carefully formed "tiny fragments", or by exploiting
   the IP offset field to cause fragments to overlap and rewrite
   interesting portions of an IP packet after access checks have been
   performed.  The latter is not an issue with the PW-specific
   fragmentation method described in this document, as there is no
   offset field.  However, implementations MUST be sure not to allow
   more than one whole fragment to overwrite another in a reconstructed
   frame.  The former may be a concern if packet filtering and access
   controls are being placed on tunneled frames within the PW
   encapsulation.  To circumvent any possible attacks in either case,
   all filtering and access controls should be applied to the resulting
   reconstructed frame rather than any PW fragments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   This document does not define any new registries for IANA to
   maintain.

   Note that [<a href="#ref-IANA" title='"IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)"'>IANA</a>] has already allocated the Fragmentation Indicator
   interface parameter, so no further IANA action is required.





<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


   This document requires IANA to assign new values for registries
   already managed by IANA (see Sections <a href="#section-7.1">7.1</a> and <a href="#section-7.2">7.2</a>) and two reserved
   bits in an existing header (see <a href="#section-7.3">Section 7.3</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Control%20Message%20Attribute%20Value%20Pairs%20%28AVPs%29"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Control Message Attribute Value Pairs (AVPs)</span>

   Two additional AVP Attributes are specified in Sections <a href="#section-5.3">5.3</a> and <a href="#section-5.4">5.4</a>.
   They are required to be defined by IANA as described in <a href="https://tools.ietf.org/html/bcp0068#section-2.2">Section 2.2
   of [BCP0068]</a>.

   Control Message Attribute Value Pairs
   -------------------------------------

   94 - Maximum Receive Unit (MRU) AVP
   95 - Maximum Reassembled Receive Unit (MRRU) AVP

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Default%20L2-Specific%20Sublayer%20Bits"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Default L2-Specific Sublayer Bits</span>

   This registry was created as part of the publication of [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>].
   This document defines two reserved bits in the Default L2-Specific
   Sublayer in <a href="#section-5.5">Section 5.5</a>, which may be assigned by IETF Consensus
   [<a href="rfc2434.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC2434</a>].  They are required to be assigned by IANA.

   Default L2-Specific Sublayer bits - per [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>]
   ---------------------------------

   Bit 2 - B (Fragmentation) bit
   Bit 3 - E (Fragmentation) bit

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Leading%20Bits%20of%20the%20L2TPv2%20Message%20Header"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Leading Bits of the L2TPv2 Message Header</span>

   This document requires definition of two reserved bits in the L2TPv2
   [<a href="#ref-L2TPv2" title='"Layer Two Tunneling Protocol "'>L2TPv2</a>] header.  Locations are noted by the "B" and "E" bits in
   <a href="#section-5.6">Section 5.6</a>.

   Leading Bits of the L2TPv2 Message Header - per [<a href="#ref-L2TPv2" title='"Layer Two Tunneling Protocol "'>L2TPv2</a>, <a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>]
   -----------------------------------------

   Bit 8 - B (Fragmentation) bit
   Bit 9 - E (Fragmentation) bit

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Acknowledgements"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Acknowledgements</span>

   The authors wish to thank Eric Rosen and Carlos Pignataro, both of
   Cisco Systems, for their review of this document.






<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Normative%20References"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Normative References</span>

   [<a id="ref-Control-Word" name="ref-Control-Word">Control-Word</a>] Bryant, S., Swallow, G., Martini, L., and D.
                  McPherson, "Pseudowire Emulation Edge-to-Edge (PWE3)
                  Control Word for Use over an MPLS PSN", <a href="rfc4385.html">RFC 4385</a>,
                  February 2006.

   [<a id="ref-IANA" name="ref-IANA">IANA</a>]         Martini, L., "IANA Allocations for Pseudowire Edge to
                  Edge Emulation (PWE3)", <a href="https://tools.ietf.org/html/bcp116">BCP 116</a>, <a href="rfc4446.html">RFC 4446</a>, April 2006.

   [<a id="ref-KEYWORDS" name="ref-KEYWORDS">KEYWORDS</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                  Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-LABELSTACK" name="ref-LABELSTACK">LABELSTACK</a>]   Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,
                  Farinacci, D., Li, T., and A. Conta, "MPLS Label Stack
                  Encoding", <a href="rfc3032.html">RFC 3032</a>, January 2001.

   [<a id="ref-L2TPv2" name="ref-L2TPv2">L2TPv2</a>]       Townsley, W., Valencia, A., Rubens, A., Pall, G.,
                  Zorn, G., and B. Palter, "Layer Two Tunneling Protocol
                  "L2TP"", <a href="rfc2661.html">RFC 2661</a>, August 1999.

   [<a id="ref-L2TPv3" name="ref-L2TPv3">L2TPv3</a>]       Lau, J., Townsley, M., and I. Goyret, "Layer Two
                  Tunneling Protocol - Version 3 (L2TPv3)", <a href="rfc3931.html">RFC 3931</a>,
                  March 2005.

   [<a id="ref-MLPPP" name="ref-MLPPP">MLPPP</a>]        Sklower, K., Lloyd, B., McGregor, G., Carr, D., and T.
                  Coradetti, "The PPP Multilink Protocol (MP)", <a href="rfc1990.html">RFC</a>
                  <a href="rfc1990.html">1990</a>, August 1996.

   [<a id="ref-MPLS-Control" name="ref-MPLS-Control">MPLS-Control</a>] Martini, L., Rosen, E., El-Aawar, N., Smith, T., and
                  G. Heron, "Pseudowire Setup and Maintenance Using the
                  Label Distribution Protocol (LDP)", <a href="rfc4447.html">RFC 4447</a>, April
                  2006.

   [<a id="ref-PATHMTU" name="ref-PATHMTU">PATHMTU</a>]      Mogul, J. and S. Deering, "Path MTU discovery", <a href="rfc1191.html">RFC</a>
                  <a href="rfc1191.html">1191</a>, November 1990.

   [<a id="ref-PATHMTUv6" name="ref-PATHMTUv6">PATHMTUv6</a>]    McCann, J., Deering, S., and J. Mogul, "Path MTU
                  Discovery for IP version 6", <a href="rfc1981.html">RFC 1981</a>, August 1996.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Informative%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Informative References</span>

   [<a id="ref-Architecture" name="ref-Architecture">Architecture</a>] Bryant, S. and P. Pate, "Pseudo Wire Emulation Edge-
                  to-Edge (PWE3) Architecture", <a href="rfc3985.html">RFC 3985</a>, March 2005.







<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


   [<a id="ref-BCP0068" name="ref-BCP0068">BCP0068</a>]      Townsley, W., "Layer Two Tunneling Protocol (L2TP)
                  Internet Assigned Numbers Authority (IANA)
                  Considerations Update", <a href="https://tools.ietf.org/html/bcp68">BCP 68</a>, <a href="rfc3438.html">RFC 3438</a>, December
                  2002.

   [<a id="ref-FAST" name="ref-FAST">FAST</a>]         ATM Forum, "Frame Based ATM over SONET/SDH Transport
                  (FAST)", af-fbatm-0151.000, July 2000.

   [<a id="ref-FRF.12" name="ref-FRF.12">FRF.12</a>]       Frame Relay Forum, "Frame Relay Fragmentation
                  Implementation Agreement", FRF.12, December 1997.

   [<a id="ref-IPFRAG-SEC" name="ref-IPFRAG-SEC">IPFRAG-SEC</a>]   Ziemba, G., Reed, D., and P. Traina, "Security
                  Considerations for IP Fragment Filtering", <a href="rfc1858.html">RFC 1858</a>,
                  October 1995.

   [<a id="ref-RFC2434" name="ref-RFC2434">RFC2434</a>]      Narten, T. and H. Alvestrand, "Guidelines for Writing
                  an IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc2434.html">RFC</a>
                  <a href="rfc2434.html">2434</a>, October 1998.

   [<a id="ref-RFC791" name="ref-RFC791">RFC791</a>]       Postel, J., "Internet Protocol", STD 5, <a href="rfc791.html">RFC 791</a>,
                  September 1981.

   [<a id="ref-TINYFRAG" name="ref-TINYFRAG">TINYFRAG</a>]     Miller, I., "Protection Against a Variant of the Tiny
                  Fragment Attack (<a href="rfc1858.html">RFC 1858</a>)", <a href="rfc3128.html">RFC 3128</a>, June 2001.



























<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Relationship%20between%20This%20Document%20and%20RFC%201990"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Relationship between This Document and <a href="rfc1990.html">RFC 1990</a></span>

   The fragmentation of large packets into smaller units for
   transmission is not new.  One fragmentation and reassembly method was
   defined in <a href="rfc1990.html">RFC 1990</a>, Multi-Link PPP [<a href="#ref-MLPPP" title='"The PPP Multilink Protocol (MP)"'>MLPPP</a>].  This method was also
   adopted for both Frame Relay [<a href="#ref-FRF.12" title='"Frame Relay Fragmentation Implementation Agreement"'>FRF.12</a>] and ATM [<a href="#ref-FAST" title='"Frame Based ATM over SONET/SDH Transport (FAST)"'>FAST</a>] network
   technology.  This document adopts the <a href="rfc1990.html">RFC 1990</a> fragmentation and
   reassembly procedures as well, with some distinct modifications
   described in this appendix.  Familiarity with <a href="rfc1990.html">RFC 1990</a> is assumed.

   <a href="rfc1990.html">RFC 1990</a> was designed for use in environments where packet fragments
   may arrive out of order due to their transmission on multiple
   parallel links, specifying that buffering be used to place the
   fragments in correct order.  For PWE3, the ability to reorder
   fragments prior to reassembly is OPTIONAL; receivers MAY choose to
   drop frames when a lost fragment is detected. Thus, when the sequence
   number on received fragments shows that a fragment has been skipped,
   the partially reassembled packet MAY be dropped, or the receiver MAY
   wish to wait for the fragment to arrive out of order.  In the latter
   case, a reassembly timer MUST be used to avoid locking up buffer
   resources for too long a period.

   Dropping out-of-order fragments on a given PW can provide a
   considerable scalability advantage for network equipment performing
   reassembly.  If out-of-order fragments are a relatively rare event on
   a given PW, throughput should not be adversely affected by this.
   Note, however, if there are cases where fragments of a given frame
   are received out-or-order in a consistent manner (e.g., a short
   fragment is always switched ahead of a larger fragment), then
   dropping out-of-order fragments will cause the fragmented frame never
   to be received.  This condition may result in an effective denial of
   service to a higher-lever application.  As such, implementations
   fragmenting a PW frame MUST at the very least ensure that all
   fragments are sent in order from their own egress point.

   An implementation may also choose to allow reassembly of a limited
   number of fragmented frames on a given PW, or across a set of PWs
   with reassembly enabled.  This allows for a more even distribution of
   reassembly resources, reducing the chance that a single or small set
   of PWs will exhaust all reassembly resources for a node.  As with
   dropping out-of-order fragments, there are perceivable cases where
   this may also provide an effective denial of service.  For example,
   if fragments of multiple frames are consistently received before each
   frame can be reconstructed in a set of limited PW reassembly buffers,
   then a set of these fragmented frames will never be delivered.






<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


   <a href="rfc1990.html">RFC 1990</a> headers use two bits that indicate the first and last
   fragments in a frame, and a sequence number.  The sequence number may
   be either 12 or 24 bits in length (from [<a href="#ref-MLPPP" title='"The PPP Multilink Protocol (MP)"'>MLPPP</a>]):

                0             7 8            15
               +-+-+-+-+-------+---------------+
               |B|E|0|0|    sequence number    |
               +-+-+-+-+-------+---------------+

               +-+-+-+-+-+-+-+-+---------------+
               |B|E|0|0|0|0|0|0|sequence number|
               +-+-+-+-+-+-+-+-+---------------+
               |      sequence number (L)      |
               +---------------+---------------+

               Figure 6: <a href="rfc1990.html">RFC 1990</a> Header Formats

   PWE3 fragmentation takes advantage of existing PW sequence numbers
   and control bit fields wherever possible, rather than defining a
   separate header exclusively for the use of fragmentation.  Thus, it
   uses neither of the <a href="rfc1990.html">RFC 1990</a> sequence number formats described above,
   relying instead on the sequence number that already exists in the
   PWE3 header.

   <a href="rfc1990.html">RFC 1990</a> defines two one-bit fields: a (B)eginning fragment bit and
   an (E)nding fragment bit.  The B bit is set to 1 on the first
   fragment derived from a PPP packet and set to 0 for all other
   fragments from the same PPP packet.  The E bit is set to 1 on the
   last fragment and set to 0 for all other fragments.  A complete
   unfragmented frame has both the B and E bits set to 1.

   PWE3 fragmentation inverts the value of the B and E bits, while
   retaining the operational concept of marking the beginning and ending
   of a fragmented frame.  Thus, for PW the B bit is set to 0 on the
   first fragment derived from a PW frame and set to 1 for all other
   fragments derived from the same frame.  The E bit is set to 0 on the
   last fragment and set to 1 for all other fragments.   A complete
   unfragmented frame has both the B and E bits set to 0.  The
   motivation behind this value inversion for the B and E bits is to
   allow complete frames (and particularly, implementations that only
   support complete frames) simply to leave the B and E bits in the
   header set to 0.

   In order to support fragmentation, the B and E bits MUST be defined
   or identified for all PWE3 tunneling protocols.  Sections <a href="#section-4">4</a> and <a href="#section-5">5</a>
   define these locations for PWE3 MPLS [<a href="#ref-Control-Word" title='"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN"'>Control-Word</a>], L2TPv2 [<a href="#ref-L2TPv2" title='"Layer Two Tunneling Protocol "'>L2TPv2</a>],
   and L2TPv3 [<a href="#ref-L2TPv3" title='"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"'>L2TPv3</a>] tunneling protocols.




<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


Authors' Addresses

   Andrew G. Malis
   Tellabs
   1415 West Diehl Road
   Naperville, IL 60563

   EMail: Andy.Malis@tellabs.com


   W. Mark Townsley
   Cisco Systems
   7025 Kit Creek Road
   PO Box 14987
   Research Triangle Park, NC 27709

   EMail: mark@townsley.net


































<span class="grey">Malis &amp; Townsley            Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc4623.html">RFC 4623</a>          PWE3 Fragmentation and Reassembly          August 2006</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2006).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).







Malis &amp; Townsley            Standards Track                    [Page 17]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc4623 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:40 GMT --></html>