<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5406 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:5406" name="DC.Identifier"/>
<meta content='The Security Considerations sections of many Internet Drafts say, in
effect, "just use IPsec". While this is sometimes correct, more often
it will leave users without real, interoperable security mechanisms.
This memo offers some guidance on when IPsec Version 2 should and
should not be specified. This document specifies an Internet Best
Current Practices for the Internet Community, and requests discussion
and suggestions for improvements.' name="DC.Description.Abstract"/>
<meta content="Steven Bellovin &lt;bellovin@acm.org&gt;" name="DC.Creator"/>
<meta content="February, 2009" name="DC.Date.Issued"/>
<meta content="Guidelines for Specifying the Use of IPsec Version 2" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5406 - Guidelines for Specifying the Use of IPsec Version 2</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgmagenta" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5406.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5406" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-bellovin-useipsec" title="draft-bellovin-useipsec">draft-bellovin-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5406" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5406" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5406" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                   BEST CURRENT PRACTICE</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                        S. Bellovin
Request for Comments: 5406                           Columbia University
BCP: 146                                                   February 2009
Category: Best Current Practice


          <span class="h1">Guidelines for Specifying the Use of IPsec Version 2</span>

Status of This Memo

   This document specifies an Internet Best Current Practices for the
   Internet Community, and requests discussion and suggestions for
   improvements.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents in effect on the date of
   publication of this document (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>).
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Abstract

   The Security Considerations sections of many Internet Drafts say, in
   effect, "just use IPsec".  While this is sometimes correct, more
   often it will leave users without real, interoperable security
   mechanisms.  This memo offers some guidance on when IPsec Version 2
   should and should not be specified.







<span class="grey">Bellovin                 Best Current Practice                  [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Security Considerations sections of many Internet Drafts say, in
   effect, "just use IPsec".  While the use of IPsec is sometimes the
   correct security solution, more information is needed to provide
   interoperable security solutions.  In some cases, IPsec is
   unavailable in the likely endpoints.  If IPsec is unavailable to --
   and hence unusable by -- a majority of the users in a particular
   protocol environment, then the specification of IPsec is tantamount
   to saying "turn off security" within this community.  Further, when
   IPsec is available, the implementation may not provide the proper
   granularity of protection.  Finally, if IPsec is available and
   appropriate, the document mandating the use of IPsec needs to specify
   just how it is to be used.

   The goal of this document is to provide guidance to protocol
   designers on the specification of IPsec when it is the appropriate
   security mechanism.  The protocol specification is expected to
   provide realistic, interoperable security.  Therefore, guidance on
   the configuration of the various IPsec databases, such as the
   Security Policy Database (SPD), is often required.

   This document describes how to specify the use of IPsec Version 2
   [<a href="rfc2401.html" title='"Security Architecture for the Internet Protocol"'>RFC2401</a>] including the ESPv2 (Encapsulating Security Payload version
   2) [<a href="rfc2406.html" title='"IP Encapsulating Security Payload (ESP)"'>RFC2406</a>], AHv2 (Authentication Header version 2) [<a href="rfc2402.html" title='"IP Authentication Header"'>RFC2402</a>], and
   IKEv1 (Internet Key Exchange version 1) [<a href="rfc2409.html" title='"The Internet Key Exchange (IKE)"'>RFC2409</a>].  A separate
   document will describe the IPsec Version 3 suite [<a href="rfc4301.html" title='"Security Architecture for the Internet Protocol"'>RFC4301</a>] [<a href="rfc4302.html" title='"IP Authentication Header"'>RFC4302</a>]
   [<a href="rfc4303.html" title='"IP Encapsulating Security Payload (ESP)"'>RFC4303</a>] [<a href="rfc4306.html" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>].

   For further guidance on security considerations (including discussion
   of IPsec), see [<a href="rfc3552.html" title='"Guidelines for Writing RFC Text on Security Considerations"'>RFC3552</a>].

   NOTE: Many of the arguments below relate to the capabilities of
   current implementations of IPsec.  These may change over time; this
   advice is based on the knowledge available to the IETF at publication
   time.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20WARNING"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  WARNING</span>

   The design of security protocols is a subtle and difficult art.  The
   cautions here about specifying the use of IPsec should NOT be taken
   to mean that you should invent your own new security protocol for
   each new application.  If IPsec is a bad choice, using another
   standardized, well-understood security protocol will almost always
   give the best results for both implementation and deployment.
   Security protocols are very hard to design; rolling out a new one
   will require extensive theoretical and practical work to confirm its
   security properties and will incur both delay and uncertainty.



<span class="grey">Bellovin                 Best Current Practice                  [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20The%20Pieces%20of%20IPsec"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  The Pieces of IPsec</span>

   IPsec is composed of a number of different pieces.  These can be used
   to provide confidentiality, integrity, and replay protection; though
   some of these can be configured manually, generally a key management
   component is used.  Additionally, the decision about whether and how
   to use IPsec is controlled by a policy database of some sort.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20AH%20and%20ESP"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  AH and ESP</span>

   The Authentication Header (AH) [<a href="rfc2402.html" title='"IP Authentication Header"'>RFC2402</a>] and the Encapsulating
   Security Payload (ESP) [<a href="rfc2406.html" title='"IP Encapsulating Security Payload (ESP)"'>RFC2406</a>] are the over-the-wire security
   protocols.  Both provide (optional) replay protection.  ESP typically
   is used to provide confidentiality (encryption), integrity, and
   authentication for traffic.  ESP also can provide integrity and
   authentication without confidentiality, which makes it a good
   alternative to AH in most cases where confidentiality is not a
   required or desired service.  Finally, ESP can be used to provide
   confidentiality alone, although this is not recommended [<a href="#ref-Bell96" title='"Problem Areas for the IP Security Protocols"'>Bell96</a>].

   The difference in integrity protection offered by AH is that AH
   protects portions of the preceding IP header, including the source
   and destination address.  However, if ESP is used in tunnel mode (see
   <a href="#section-3.2">Section 3.2</a>) and integrity/authentication is enabled, the IP header
   seen by the source and destination hosts is completely protected
   anyway.

   AH can also protect those IP options that need to be seen by
   intermediate routers, but must be intact and authentic when delivered
   to the receiving system.  At this time, use (and existence) of such
   IP options is extremely rare.

   If an application requires such protection, and if the information to
   be protected cannot be inferred from the key management process, AH
   must be used.  (ESP is generally regarded as easier to implement;
   however, virtually all IPsec packages support both.)  If
   confidentiality is required, ESP must be used.  It is possible to use
   AH in conjunction with ESP, but this combination is rarely required.

   All variants of IPsec have problems with NAT boxes -- see [<a href="rfc3715.html" title='"IPsec-Network Address Translation (NAT) Compatibility Requirements"'>RFC3715</a>]
   for details -- but AH is considerably more troublesome.  In
   environments where there is substantial likelihood that the two
   endpoints will be separated by a NAT box -- this includes almost all
   services involving user-to-server traffic, as opposed to server-to-
   server traffic -- NAT traversal [<a href="rfc3948.html" title='"UDP Encapsulation of IPsec ESP Packets"'>RFC3948</a>] should be mandated and AH
   should be avoided.  (Note that [<a href="rfc3948.html" title='"UDP Encapsulation of IPsec ESP Packets"'>RFC3948</a>] is for ESP only, and cannot
   be used for AH.)




<span class="grey">Bellovin                 Best Current Practice                  [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Transport%20and%20Tunnel%20Mode"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Transport and Tunnel Mode</span>

   AH and ESP can both be used in either transport mode or tunnel mode.
   In tunnel mode, the IPsec header is followed by an inner IP header.
   This is the normal usage for Virtual Private Networks (VPN) and is
   generally required whenever either end of the IPsec-protected path is
   not the ultimate IP destination, e.g., when IPsec is implemented in a
   firewall, router, etc.

   Transport mode is preferred for point-to-point communication, though
   tunnel mode can also be used for this purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Key%20Management"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Key Management</span>

   Any cryptographic system requires key management.  IPsec provides for
   both manual and automatic key management schemes.  Manual key
   management is easy; however, it doesn't scale very well.  Also,
   IPsec's replay protection mechanisms are not available if manual key
   management is used.  The need for automatic key exchange is discussed
   in more detail in [<a href="rfc4107.html" title='"Guidelines for Cryptographic Key Management"'>RFC4107</a>].

   The primary automated key exchange mechanism for IPsec is the
   Internet Key Exchange (IKE) [<a href="rfc2409.html" title='"The Internet Key Exchange (IKE)"'>RFC2409</a>].  A new, simpler version of IKE
   has been approved [<a href="rfc4306.html" title='"Internet Key Exchange (IKEv2) Protocol"'>RFC4306</a>], but many existing systems still use
   IKEv1.  This document does not discuss IKEv2 and IPsecv3.  A second
   mechanism, Kerberized Internet Negotiation of Keys (KINK) [<a href="rfc4430.html" title='"Kerberized Internet Negotiation of Keys (KINK)"'>RFC4430</a>],
   has been defined.  It, of course, uses Kerberos and is suitable if
   and only if a Kerberos infrastructure is available.

   If a decision to use IKE is made, the precise mode of operation must
   be specified as well.  IKE can be used in main mode or aggressive
   mode; both support digital signatures, two different ways of using
   public key encryption, and shared secrets for authentication.

   Shared secret authentication is simpler; however, it doesn't scale as
   well in many-to-many communication scenarios since each endpoint must
   share a unique secret with every peer with which it can communicate.
   Note, though, that using shared secrets in IKE is far preferable to
   manual keying.

   In most real-world situations where public key modes of IKE are used,
   locally issued certificates are employed.  That is, the administrator
   of the system or network concerned will issue certificates to all
   authorized users.  These certificates are useful only for IPsec.

   It is sometimes possible to use certificates [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] from an
   existing Public Key Infrastructure (PKI) with IKE.  In practice, this
   is rare.  Furthermore, not only is there no global PKI covering most



<span class="grey">Bellovin                 Best Current Practice                  [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   Internet endpoints, there probably never will be.  Designing a
   structure that assumes such a PKI is a mistake.  In particular,
   assuming that an arbitrary node will have an "authentic" certificate,
   issued by a mutually trusted third party and vouching for that node's
   identity, is wrong.  Again, such a PKI does not and probably will not
   exist.  Public key IKE is generally a good idea, but should almost
   always be used with locally issued certificates as opposed to
   certificates from an existing PKI.

   Note that public key schemes require a substantial amount of
   computation.  Protocol designers should consider whether or not such
   computations are feasible on devices of interest to their clientele.
   Using certificates roughly doubles the number of large
   exponentiations that must be performed, compared with shared secret
   versions of IKE.

   Today, even low-powered devices can generally perform enough
   computation to set up a limited number of security associations.
   Concentration points, such as firewalls or VoIP servers, may require
   hardware assists, especially if many peers are expected to create
   security associations at about the same time.

   Using any automated key management mechanism can be difficult when
   trying to protect low-level protocols.  For example, even though
   [<a href="rfc2461.html" title='"Neighbor Discovery for IP Version 6 (IPv6)"'>RFC2461</a>] specified the use of IPsec to protect IPv6 Neighbor
   Discovery, it was impossible to do key management: nodes couldn't use
   IKE because it required IP-level communication, and that isn't
   possible before Neighbor Discovery associations are set up.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Application%20Programming%20Interface%20%28API%29"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Application Programming Interface (API)</span>

   It is, in some sense, a misnomer to speak of the API as a part of
   IPsec since this piece is missing on many systems.  To the extent
   that APIs exist, they aren't standardized.  The problem is simple:
   there is no portable way (and often no way at all) for an application
   to request IPsec protection, or to tell if it was used for given
   inbound packets or connections.

   There are additional problems:

   o  Applications rarely have access to such APIs.  Rather, IPsec is
      usually configured by a system or network administrator.

   o  Applications are unable to verify that IPsec services are being
      used underneath.






<span class="grey">Bellovin                 Best Current Practice                  [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   o  Applications are unaware of the specific identities and properties
      of the protected channel provided by IPsec.  For instance, the
      IPsec key management mechanisms may be aware of the identity and
      authorization of the peer, but this information cannot be used by
      the application nor linked to application-level decisions, such as
      access to resources reserved to the entity identified by this
      identity.

   Router- or firewall-based IPsec implementations pose even greater
   problems since there is no standardized over-the-wire protocol for
   communicating this information from outboard encryptors to hosts.

   By contrast, higher-layer security services, such as TLS, are able to
   provide the necessary control and assurance.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Availability%20of%20IPsec%20in%20Target%20Devices"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Availability of IPsec in Target Devices</span>

   Although IPsec is now widely implemented and is available for current
   releases of most host operating systems, it is less available for
   embedded systems.  Few hubs, network address translators, etc.,
   implement it, especially at the low end.  It is generally
   inappropriate to rely on IPsec when many of the endpoints are in this
   category.

   Even for host-to-host use, IPsec availability (and experience and
   ease of use) has generally been for VPNs.  Hosts that support IPsec
   for VPN use frequently do not support it on a point-to-point basis,
   especially via a stable, well-defined API or user interface.

   Finally, few implementations support multiple layers of IPsec.  If a
   telecommuter is using IPsec in VPN mode to access an organizational
   network, he or she may not be able to employ a second level of IPsec
   to protect an application connection to a host within the
   organization.  (We note that such support is, in fact, mandated by
   Case 4 of <a href="rfc2401.html#section-4.5">Section 4.5 of [RFC2401]</a>.  Nevertheless, it is not widely
   available.)  The likelihood of such deployment scenarios should be
   taken into account when deciding whether or not to mandate IPsec.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Endpoints"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Endpoints</span>

   [<a id="ref-RFC2401" name="ref-RFC2401">RFC2401</a>] describes many different forms of endpoint identifier.
   These include source addresses (both IPv4 and IPv6), host names
   (possibly as embedded in X.500 certificates), and user IDs (again,
   possibly as embedded in a certificate).  Not all forms of identifier
   are available on all implementations; in particular, user-granularity
   identification is not common.  This is especially a concern for
   multi-user systems, where it may not be possible to use different
   certificates to distinguish between traffic from two different users.



<span class="grey">Bellovin                 Best Current Practice                  [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   Again, we note that the ability to provide fine-grained protection,
   such as keying each connection separately and with per-user
   credentials, was one of the original design goals of IPsec.
   Nevertheless, only a few platforms support it.  Indeed, some
   implementations do not even support using port numbers when deciding
   whether or not to apply IPsec protection.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Selectors%20and%20the%20SPD"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Selectors and the SPD</span>

   <a href="rfc2401.html#section-4.4">Section 4.4 of [RFC2401]</a> describes the Security Policy Database (SPD)
   and "selectors" used to decide what traffic should be protected by
   IPsec.  Choices include source and destination addresses (or address
   ranges), protocol numbers (i.e., 6 for TCP and 17 for UDP), and port
   numbers for TCP and UDP.  Protocols whose protection requirements
   cannot be described in such terms are poorer candidates for IPsec; in
   particular, it becomes impossible to apply protection at any finer
   grain than "destination host".  Thus, traffic embedded in a Layer 2
   Tunneling Protocol (L2TP) [<a href="rfc2661.html" title='"Layer Two Tunneling Protocol "'>RFC2661</a>] session cannot be protected
   selectively by IPsec above the L2TP layer, because IPsec has no
   selectors defined that let it peer into the L2TP packet to find the
   TCP port numbers.  Similarly, the Stream Control Transmission
   Protocol (SCTP) [<a href="rfc4960.html" title='"Stream Control Transmission Protocol"'>RFC4960</a>] did not exist when [<a href="rfc2401.html" title='"Security Architecture for the Internet Protocol"'>RFC2401</a>] was written;
   thus, protecting individual SCTP applications on the basis of port
   number could not be done until a new document was written [<a href="rfc3554.html" title='"On the Use of Stream Control Transmission Protocol (SCTP) with IPsec"'>RFC3554</a>]
   that defined new selectors for IPsec, and implementations appeared.

   Furthermore, in a world that runs to a large extent on dynamically
   assigned addresses and often uses dynamically assigned port numbers
   as well, an all-or-nothing policy for VPNs can work well; other
   policies, however, can be difficult to create in any usable form.

   The granularity of protection available may have side effects.  If
   certain traffic between a pair of machines is protected by IPsec,
   does the implementation permit other traffic to be unprotected or
   protected by different policies?  Alternatively, if the
   implementation is such that it is only capable of protecting all
   traffic or none, does the device have sufficient CPU capacity to
   encrypt everything?  Note that some low-end devices may have limited
   secure storage capacity for keys, etc.

   Implementation issues are also a concern here.  As before, too many
   vendors have not implemented the full specification; too many IPsec
   implementations are not capable of using port numbers in their
   selectors.  Protection of traffic between two hosts is thus on an
   all-or-nothing basis when these non-compliant implementations are
   employed.





<span class="grey">Bellovin                 Best Current Practice                  [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Broadcast%20and%20Multicast"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Broadcast and Multicast</span>

   Although the designers of IPsec tried to leave room for protection of
   multicast traffic, a complete design wasn't finished until much
   later.  As such, many IPsec implementations do not support multicast.
   [<a href="rfc5374.html" title='"Multicast Extensions to the Security Architecture for the Internet Protocol"'>RFC5374</a>] describes extensions to IPsec to support it.  Other
   relevant documents include [<a href="rfc3830.html" title='"MIKEY: Multimedia Internet KEYing"'>RFC3830</a>], [<a href="rfc3547.html" title='"The Group Domain of Interpretation"'>RFC3547</a>], and [<a href="rfc4535.html" title='"GSAKMP: Group Secure Association Key Management Protocol"'>RFC4535</a>].

   Because of the delay, protocol designers who use multicast should
   consider the availability of these extensions in target platforms of
   interest.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Specifying%20IPsec"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Specifying IPsec</span>

   Despite all of the caveats given above, it may still be appropriate
   to use IPsec in particular situations.  The range of choices makes it
   mandatory to define precisely how IPsec is to be used.  Authors of
   standards documents that rely on IPsec must specify the following:

   a.  What selectors should the initiator of the conversation (the
       client, in client-server architectures) use?  What addresses,
       port numbers, etc., are to be used?

   b.  What IPsec protocol is to be used: AH or ESP?  What mode is to be
       employed: transport mode or tunnel mode?

   c.  What form of key management is appropriate?

   d.  What form of identification should be used?  Choices include IP
       address, DNS name with or without a user name, and X.500
       distinguished name.

   e.  If the application server will switch user IDs (i.e., it is a
       login service of some sort) and user name identification is used,
       is a new security association negotiated that utilizes a user-
       granularity certificate?  If so, when?

   f.  What form of authentication should be used?  Choices include pre-
       shared secrets and certificates.

   g.  How are the participants authorized to perform the operations
       that they request?  For instance, are all devices with a
       certificate from a particular source allowed to use any
       application with IPsec or access any resource?  (This problem can
       appear with any security service, of course.)






<span class="grey">Bellovin                 Best Current Practice                  [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   h.  Which of the many variants of IKE must be supported?  Main mode?
       Aggressive mode?

       Note that there are two different versions of IKE: IKE and IKEv2.
       IKEv2 is simpler and cleaner, but is not yet widely available.
       You must specify which version of IKE you require.

   i.  Is suitable IPsec support available in likely configurations of
       the products that would have to employ IPsec?

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Example"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Example</span>

   Let us now work through an example based on these guidelines.  We
   will use the Border Gateway Protocol (BGP) [<a href="rfc4271.html" title='"A Border Gateway Protocol 4 (BGP-4)"'>RFC4271</a>] to show how to
   evaluate and specify the use of IPsec for transmission security,
   rather than the mechanism described in [<a href="rfc2385.html" title='"Protection of BGP Sessions via the TCP MD5 Signature Option"'>RFC2385</a>].  Note carefully
   that we are not saying that IPsec is an appropriate choice here.
   Rather, we are demonstrating the necessary examination and
   specification process.  Also note that the deeper security issues
   raised by BGP are not addressed by IPsec or any other transmission
   security mechanism; see [<a href="#ref-Kent00a" title='"Secure Border Gateway Protocol (Secure-BGP)"'>Kent00a</a>] and [<a href="#ref-Kent00b" title='"Secure Border Gateway Protocol (Secure-BGP) -- Real World Performance and Deployment Issues"'>Kent00b</a>] for more details.

   Selectors        BGP runs between manually configured pairs of hosts
                    on TCP port 179.  The appropriate selector would be
                    the pair of BGP speakers, for that port only.  Note
                    that the router's "loopback address" is almost
                    certainly the address to use.

   Mode             Transport mode would be the proper choice if IPsec
                    were used.  The information being communicated is
                    generally not confidential, so encryption need not
                    be used.  Either AH or ESP can be used; if ESP is
                    used, the sender's IP address would need to be
                    checked against the IP address asserted in the key
                    management exchange.  (This check is mandated by
                    [<a href="rfc2401.html" title='"Security Architecture for the Internet Protocol"'>RFC2401</a>].)  For the sake of interoperability,
                    either AH or ESP would need to be specified as
                    mandatory to implement.

   Key Management   To permit replay detection, an automated key
                    management system should be used, most likely IKE.
                    Again, the RFC author should pick one.









<span class="grey">Bellovin                 Best Current Practice                  [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   Security Policy  Connections should be accepted only from the
                    designated peer.  (Note that this restriction
                    applies only to BGP.  If the router -- or any IPsec
                    host -- runs multiple services with different
                    security needs, each such service requires its own
                    security policy.)

   Authentication   Given the number of BGP-speaking routers used
                    internally by large ISPs, it is likely that shared
                    key mechanisms are inadequate.  Consequently,
                    certificate-based IKE must be supported.  However,
                    shared secret mode is reasonable on peering links or
                    (perhaps) on links between ISPs and customers.
                    Whatever scheme is used, it must tie back to a
                    source IP address or Autonomous System (AS) number
                    in some fashion, since other BGP policies are
                    expressed in these terms.  If certificates are used,
                    would they use IP addresses or AS numbers?  Which?

   Availability     For this scenario, availability is the crucial
                    question.  Do likely BGP speakers -- both backbone
                    routers and access routers -- support the profile of
                    IPsec described above?  Will use of IPsec, with its
                    attendant expensive cryptographic operations, raise
                    the issue of new denial-of-service attacks?  The
                    working group and the IESG must make these
                    determinations before deciding to use IPsec to
                    protect BGP.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   IPsec provides transmission security and simple access control only.
   There are many other dimensions to protocol security that are beyond
   the scope of this memo, including most notably availability.  For
   example, using IPsec does little to defend against denial-of-service
   attacks; in some situations, i.e., on CPU-limited systems, it may
   contribute to the attacks.  Within its scope, the security of any
   resulting protocol depends heavily on the accuracy of the analysis
   that resulted in a decision to use IPsec.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Acknowledgments"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Acknowledgments</span>

   Ran Atkinson, Lakshminath Dondeti, Barbara Fraser, Paul Hoffman, Russ
   Housley, Stephen Kent, Eric Fleischman, assorted members of the IESG,
   and a plethora of others have made many useful suggestions.






<span class="grey">Bellovin                 Best Current Practice                 [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20References"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20Normative%20References"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-RFC2401" name="ref-RFC2401">RFC2401</a>]  Kent, S. and R. Atkinson, "Security Architecture for the
              Internet Protocol", <a href="rfc2401.html">RFC 2401</a>, November 1998.

   [<a id="ref-RFC2402" name="ref-RFC2402">RFC2402</a>]  Kent, S. and R. Atkinson, "IP Authentication Header",
              <a href="rfc2402.html">RFC 2402</a>, November 1998.

   [<a id="ref-RFC2406" name="ref-RFC2406">RFC2406</a>]  Kent, S. and R. Atkinson, "IP Encapsulating Security
              Payload (ESP)", <a href="rfc2406.html">RFC 2406</a>, November 1998.

   [<a id="ref-RFC2409" name="ref-RFC2409">RFC2409</a>]  Harkins, D. and D. Carrel, "The Internet Key Exchange
              (IKE)", <a href="rfc2409.html">RFC 2409</a>, November 1998.

   [<a id="ref-RFC3554" name="ref-RFC3554">RFC3554</a>]  Bellovin, S., Ioannidis, J., Keromytis, A., and R.
              Stewart, "On the Use of Stream Control Transmission
              Protocol (SCTP) with IPsec", <a href="rfc3554.html">RFC 3554</a>, July 2003.

   [<a id="ref-RFC3948" name="ref-RFC3948">RFC3948</a>]  Huttunen, A., Swander, B., Volpe, V., DiBurro, L., and M.
              Stenberg, "UDP Encapsulation of IPsec ESP Packets",
              <a href="rfc3948.html">RFC 3948</a>, January 2005.

   [<a id="ref-RFC4107" name="ref-RFC4107">RFC4107</a>]  Bellovin, S. and R. Housley, "Guidelines for Cryptographic
              Key Management", <a href="https://tools.ietf.org/html/bcp107">BCP 107</a>, <a href="rfc4107.html">RFC 4107</a>, June 2005.

   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, May 2008.

   [<a id="ref-RFC5374" name="ref-RFC5374">RFC5374</a>]  Weis, B., Gross, G., and D. Ignjatic, "Multicast
              Extensions to the Security Architecture for the Internet
              Protocol", <a href="rfc5374.html">RFC 5374</a>, November 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20Informative%20References"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-Bell96" name="ref-Bell96">Bell96</a>]   Bellovin, S., "Problem Areas for the IP Security
              Protocols", Proc. Sixth Usenix Security Symposium, pp.
              205-214, 1996.

   [<a id="ref-Kent00a" name="ref-Kent00a">Kent00a</a>]  Kent, S., Lynn, C., and K. Seo, "Secure Border Gateway
              Protocol (Secure-BGP)", IEEE Journal on Selected Areas in
              Communications, 18:4, pp. 582-592, 2000.






<span class="grey">Bellovin                 Best Current Practice                 [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   [<a id="ref-Kent00b" name="ref-Kent00b">Kent00b</a>]  Kent, S., Lynn, C., Mikkelson, J., and K. Seo, "Secure
              Border Gateway Protocol (Secure-BGP) -- Real World
              Performance and Deployment Issues", Proc. Network and
              Distributed System Security Symposium (NDSS), 2000.

   [<a id="ref-RFC2385" name="ref-RFC2385">RFC2385</a>]  Heffernan, A., "Protection of BGP Sessions via the TCP MD5
              Signature Option", <a href="rfc2385.html">RFC 2385</a>, August 1998.

   [<a id="ref-RFC2461" name="ref-RFC2461">RFC2461</a>]  Narten, T., Nordmark, E., and W. Simpson, "Neighbor
              Discovery for IP Version 6 (IPv6)", <a href="rfc2461.html">RFC 2461</a>,
              December 1998.

   [<a id="ref-RFC2661" name="ref-RFC2661">RFC2661</a>]  Townsley, W., Valencia, A., Rubens, A., Pall, G., Zorn,
              G., and B. Palter, "Layer Two Tunneling Protocol "L2TP"",
              <a href="rfc2661.html">RFC 2661</a>, August 1999.

   [<a id="ref-RFC3547" name="ref-RFC3547">RFC3547</a>]  Baugher, M., Weis, B., Hardjono, T., and H. Harney, "The
              Group Domain of Interpretation", <a href="rfc3547.html">RFC 3547</a>, July 2003.

   [<a id="ref-RFC3552" name="ref-RFC3552">RFC3552</a>]  Rescorla, E. and B. Korver, "Guidelines for Writing RFC
              Text on Security Considerations", <a href="https://tools.ietf.org/html/bcp72">BCP 72</a>, <a href="rfc3552.html">RFC 3552</a>,
              July 2003.

   [<a id="ref-RFC3715" name="ref-RFC3715">RFC3715</a>]  Aboba, B. and W. Dixon, "IPsec-Network Address Translation
              (NAT) Compatibility Requirements", <a href="rfc3715.html">RFC 3715</a>, March 2004.

   [<a id="ref-RFC3830" name="ref-RFC3830">RFC3830</a>]  Arkko, J., Carrara, E., Lindholm, F., Naslund, M., and K.
              Norrman, "MIKEY: Multimedia Internet KEYing", <a href="rfc3830.html">RFC 3830</a>,
              August 2004.

   [<a id="ref-RFC4271" name="ref-RFC4271">RFC4271</a>]  Rekhter, Y., Li, T., and S. Hares, "A Border Gateway
              Protocol 4 (BGP-4)", <a href="rfc4271.html">RFC 4271</a>, January 2006.

   [<a id="ref-RFC4301" name="ref-RFC4301">RFC4301</a>]  Kent, S. and K. Seo, "Security Architecture for the
              Internet Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.

   [<a id="ref-RFC4302" name="ref-RFC4302">RFC4302</a>]  Kent, S., "IP Authentication Header", <a href="rfc4302.html">RFC 4302</a>,
              December 2005.

   [<a id="ref-RFC4303" name="ref-RFC4303">RFC4303</a>]  Kent, S., "IP Encapsulating Security Payload (ESP)",
              <a href="rfc4303.html">RFC 4303</a>, December 2005.

   [<a id="ref-RFC4306" name="ref-RFC4306">RFC4306</a>]  Kaufman, C., "Internet Key Exchange (IKEv2) Protocol",
              <a href="rfc4306.html">RFC 4306</a>, December 2005.

   [<a id="ref-RFC4430" name="ref-RFC4430">RFC4430</a>]  Sakane, S., Kamada, K., Thomas, M., and J. Vilhuber,
              "Kerberized Internet Negotiation of Keys (KINK)",
              <a href="rfc4430.html">RFC 4430</a>, March 2006.



<span class="grey">Bellovin                 Best Current Practice                 [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5406.html">RFC 5406</a>                      IPsec Usage                  February 2009</span>


   [<a id="ref-RFC4535" name="ref-RFC4535">RFC4535</a>]  Harney, H., Meth, U., Colegrove, A., and G. Gross,
              "GSAKMP: Group Secure Association Key Management
              Protocol", <a href="rfc4535.html">RFC 4535</a>, June 2006.

   [<a id="ref-RFC4960" name="ref-RFC4960">RFC4960</a>]  Stewart, R., "Stream Control Transmission Protocol",
              <a href="rfc4960.html">RFC 4960</a>, September 2007.

Author's Address

   Steven M. Bellovin
   Columbia University
   1214 Amsterdam Avenue
   MC 0401
   New York, NY  10027
   US

   Phone: +1 212 939 7149
   EMail: bellovin@acm.org

































Bellovin                 Best Current Practice                 [Page 13]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5406 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --></html>