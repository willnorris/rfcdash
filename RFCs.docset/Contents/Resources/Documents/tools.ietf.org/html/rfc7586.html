<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7586 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:7586" name="DC.Identifier"/>
<meta content="This document introduces the Scalable Address Resolution Protocol
(SARP), an architecture that uses proxy gateways to scale large data
center networks. SARP is based on fast proxies that significantly
reduce switches' Filtering Database (FDB) table sizes and reduce
impact of ARP and Neighbor Discovery (ND) on network elements in an
environment where hosts within one subnet (or VLAN) can spread over
various locations. SARP is targeted for massive data centers with a
significant number of Virtual Machines (VMs) that can move across
various physical locations." name="DC.Description.Abstract"/>
<meta content="Dunbar, Linda" name="DC.Creator"/>
<meta content="Mizrahi, Tal" name="DC.Creator"/>
<meta content="Yerushalmi, Ilan" name="DC.Creator"/>
<meta content="Nachum, Youval" name="DC.Creator"/>
<meta content="June, 2015" name="DC.Date.Issued"/>
<meta content="The Scalable Address Resolution Protocol (SARP) for Large Data Centers" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7586 - The Scalable Address Resolution Protocol (SARP) for Large Data Centers</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgyellow" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7586.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7586" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-nachum-sarp" title="draft-nachum-sarp">draft-nachum-sarp</a>] [<a href="https://datatracker.ietf.org/doc/rfc7586" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7586" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7586" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=7586&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]    </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                            EXPERIMENTAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Independent Submission                                         Y. Nachum
Request for Comments: 7586
Category: Experimental                                         L. Dunbar
ISSN: 2070-1721                                                   Huawei
                                                           I. Yerushalmi
                                                              T. Mizrahi
                                                                 Marvell
                                                               June 2015


            <span class="h1">The Scalable Address Resolution Protocol (SARP)</span>
                         <span class="h1">for Large Data Centers</span>

Abstract

   This document introduces the Scalable Address Resolution Protocol
   (SARP), an architecture that uses proxy gateways to scale large data
   center networks.  SARP is based on fast proxies that significantly
   reduce switches' Filtering Database (FDB) table sizes and reduce
   impact of ARP and Neighbor Discovery (ND) on network elements in an
   environment where hosts within one subnet (or VLAN) can spread over
   various locations.  SARP is targeted for massive data centers with a
   significant number of Virtual Machines (VMs) that can move across
   various physical locations.

Independent Submissions Editor Note

   This is an Experimental document; that experiment will end two years
   after the RFC is published.  At that point, the RFC authors will
   attempt to determine how widely SARP has been implemented and used.

IESG Note

   The IESG notes that the problems described in <a href="rfc6820.html">RFC 6820</a> can already be
   addressed through the simple combination of existing standardized or
   other published techniques including Layer 2 VPN (<a href="rfc4664.html">RFC 4664</a>), proxy
   ARP (<a href="rfc925.html">RFC 925</a>), proxy Neighbor Discovery (<a href="rfc4389.html">RFC 4389</a>), IGMP and MLD
   snooping (<a href="rfc4541.html">RFC 4541</a>), and ARP mediation for IP interworking of Layer 2
   VPNs (<a href="rfc6575.html">RFC 6575</a>).












<span class="grey">Nachum, et al.                Experimental                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for examination, experimental implementation, and
   evaluation.

   This document defines an Experimental Protocol for the Internet
   community.  This is a contribution to the RFC Series, independently
   of any other RFC stream.  The RFC Editor has chosen to publish this
   document at its discretion and makes no statement about its value for
   implementation or deployment.  Documents approved for publication by
   the RFC Editor are not a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7586">http://www.rfc-editor.org/info/rfc7586</a>.

Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.






















<span class="grey">Nachum, et al.                Experimental                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. SARP Motivation ............................................<a href="#page-4">4</a>
      <a href="#section-1.2">1.2</a>. SARP Overview ..............................................<a href="#page-7">7</a>
      <a href="#section-1.3">1.3</a>. SARP Deployment Options ....................................<a href="#page-8">8</a>
      <a href="#section-1.4">1.4</a>. Comparison with Existing Solutions .........................<a href="#page-9">9</a>
   <a href="#section-2">2</a>. Terms and Abbreviations Used in This Document ..................<a href="#page-10">10</a>
   <a href="#section-3">3</a>. SARP: Theory of Operation ......................................<a href="#page-11">11</a>
      <a href="#section-3.1">3.1</a>. Control Plane: ARP/ND .....................................<a href="#page-11">11</a>
           <a href="#section-3.1.1">3.1.1</a>. ARP/NS Request for a Local VM ......................<a href="#page-11">11</a>
           <a href="#section-3.1.2">3.1.2</a>. ARP/NS Request for a Remote VM .....................<a href="#page-12">12</a>
           3.1.3. Gratuitous ARP and Unsolicited Neighbor
                  Advertisement (UNA) ................................<a href="#page-13">13</a>
      <a href="#section-3.2">3.2</a>. Data Plane: Packet Transmission ...........................<a href="#page-13">13</a>
           <a href="#section-3.2.1">3.2.1</a>. Local Packet Transmission ..........................<a href="#page-13">13</a>
           <a href="#section-3.2.2">3.2.2</a>. Packet Transmission between Sites ..................<a href="#page-13">13</a>
      <a href="#section-3.3">3.3</a>. VM Migration ..............................................<a href="#page-14">14</a>
           <a href="#section-3.3.1">3.3.1</a>. VM Local Migration .................................<a href="#page-14">14</a>
           <a href="#section-3.3.2">3.3.2</a>. VM Migration from One Site to Another ..............<a href="#page-14">14</a>
                  3.3.2.1. Impact on IP-to-MAC Mapping Cache
                           Table of Migrated VMs .....................<a href="#page-16">16</a>
      <a href="#section-3.4">3.4</a>. Multicast and Broadcast ...................................<a href="#page-17">17</a>
      <a href="#section-3.5">3.5</a>. Non-IP Packet .............................................<a href="#page-17">17</a>
      <a href="#section-3.6">3.6</a>. High Availability and Load Balancing ......................<a href="#page-17">17</a>
      <a href="#section-3.7">3.7</a>. SARP Interaction with Overlay Networks ....................<a href="#page-18">18</a>
   <a href="#section-4">4</a>. Security Considerations ........................................<a href="#page-18">18</a>
   <a href="#section-5">5</a>. References .....................................................<a href="#page-19">19</a>
      <a href="#section-5.1">5.1</a>. Normative References ......................................<a href="#page-19">19</a>
      <a href="#section-5.2">5.2</a>. Informative References ....................................<a href="#page-20">20</a>
   Acknowledgments ...................................................<a href="#page-21">21</a>
   Authors' Addresses ................................................<a href="#page-21">21</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   This document describes a proxy gateway technique, called the
   Scalable Address Resolution Protocol (SARP), which reduces switches'
   Filtering Database (FDB) size and ARP/Neighbor Discovery impact on
   network elements in an environment where hosts within one subnet (or
   VLAN) can spread over various access domains in data centers.

   The main idea of SARP is to represent all VMs (or hosts) under each
   access domain by the MAC address of their corresponding access node
   (or aggregation node).  For example (Figure 1), when host A in the
   west site needs to communicate with host B, which is on the same VLAN
   but connected to a different access domain (east site), SARP requires
   host A to use the MAC address of SARP proxy 2, rather than the
   address of host B.  By doing so, switches in each domain do not need



<span class="grey">Nachum, et al.                Experimental                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   to maintain a list of MAC addresses for all the VMs (hosts) in
   different access domains; every switch only needs to be familiar with
   MAC addresses that reside in the current domain, and addresses of
   remote SARP proxy gateways.  Therefore, the switches' FDB size is
   limited regardless of the number of access domains.

     +-------+     +-------+    _   __       +-------+     +-------+
     |       |     | SARP  |   / \_/  \_     | SARP  |     |       |
     |host A |&lt;===&gt;| proxy |&lt;=&gt;\_       \&lt;==&gt;| proxy |&lt;===&gt;|host B |
     |       |     |   1   |   /       _/    |   2   |     |       |
     +-------+     +-------+   \__   _/      +-------+     +-------+
                                  \_/
     &lt;------West Site------&gt;                 &lt;------East Site------&gt;

                     Figure 1: A Brief Overview of SARP

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20SARP%20Motivation"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  SARP Motivation</span>

   [<a id="ref-RFC6820" name="ref-RFC6820">RFC6820</a>] discusses the impacts and scaling issues that arise in data
   center networks when subnets span across multiple Layer 2 / Layer 3
   (L2/L3) boundary routers.

   Unfortunately, when the combined number of VMs (or hosts) in all
   those subnets is large, it can lead to an explosion of the size of
   the switches' MAC address table and a heavy impact on network
   elements.

   There are four major issues associated with subnets spanning across
   multiple L2/L3 boundary router ports:

   1) Explosion of the size of the intermediate switches' MAC address
      table (FDB).

      When hosts in a VLAN (or subnet) span across multiple access
      domains and each access domain has hosts belonging to different
      VLANs, each access switch has to enable multiple VLANs.  Thus,
      those access switches are exposed to all MAC addresses across all
      VLANs.

      For example, for an access switch with 40 attached physical
      servers, where each server has 100 VMs, the access switch has
      4,000 attached MAC addresses.  If hosts/VMs can indeed be moved
      anywhere, the worst case for the Access Switch is when all those
      4,000 VMs belong to different VLANs, i.e., the access switch has
      4000 VLANs enabled.  If each VLAN has 200 hosts, this access
      switch's MAC address table potentially has 200 * 4,000 = 800,000
      entries.




<span class="grey">Nachum, et al.                Experimental                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


      It is important to note that the example above is relevant
      regardless of whether IPv4 or IPv6 is used.

      The example illustrates a scenario that is worse than what today's
      L2/L3 gateway has to face.  In today's environment, where each
      subnet is limited to a few access switches, the number of MAC
      addresses the gateway has to learn is of a significantly smaller
      scale.

   2) ARP/ND processing load impact on the L2/L3 boundary routers.

      All VMs periodically send NDs to their corresponding gateway nodes
      to get gateway nodes' MAC addresses.  When the combined number of
      VMs across all the VLANs is large, processing the responses to the
      ND requests from those VMs can easily exhaust the gateway's CPU
      utilization.

      An L2/L3 boundary router could be hit with ARP/ND twice when the
      originating and destination stations are in different subnets
      attached to the same router and when those hosts do not
      communicate with external peers very frequently.  The first hit is
      when the originating station in subnet 1 initiates an ARP/ND
      request to the L2/L3 boundary router.  The second hit is when the
      L2/L3 boundary router initiates an ARP/ND request to the target in
      subnet 2 if the target is not in the router's ARP/ND cache.

   3) In IPv4, every end station in a subnet receives ARP broadcast
      messages from all other end stations in the subnet.  IPv6 ND has
      eliminated this issue by using multicast.

      However, most devices support a limited number of multicast
      addresses, due to the scaling of multicast filtering.  Once the
      number of multicast addresses exceeds the multicast filter limit,
      the multicast addresses have to be processed by the devices' CPUs
      (i.e., the slow path).

      It is less of an issue in data centers without VM mobility, since
      each port is only dedicated to one (or a small number of) VLANs.
      Thus, the number of multicast addresses hitting each port is
      significantly lower.

   4) The ARP/ND messages are flooded to many physical link segments
      that can reduce the bandwidth utilization for user traffic.

      ARP/ND flooding is, in most cases, an insignificant issue in
      today's data center networks, as the majority of data center
      servers are shifting towards 1G or 10G Ethernet ports.  The
      bandwidth used by ARP/ND, even when flooded to all physical links,



<span class="grey">Nachum, et al.                Experimental                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


      becomes negligible compared to the link bandwidth.  Furthermore,
      IGMP and Multicast Listener Discovery (MLD) snooping [<a href="rfc4541.html" title='"Considerations for Internet Group Management Protocol (IGMP) and Multicast Listener Discovery (MLD) Snooping Switches"'>RFC4541</a>] can
      further reduce the ND multicast traffic to some physical link
      segments.

   Statistics gathered by Merit Network [<a href="#ref-ARMDStats" title='"Address Resolution Statistics"'>ARMDStats</a>] have shown that the
   major impact of a large number of VMs in data centers is on the L2/L3
   boundary routers, i.e., issue 2 above.  An L2/L3 boundary router
   could be hit with ARP/ND twice when 1) the originating and
   destination stations are in different subnets attached to the same
   router, and 2) those hosts do not communicate with external peers
   often enough.

   Overlay approaches, e.g., [<a href="rfc7364.html" title='"Problem Statement: Overlays for Network Virtualization"'>RFC7364</a>], can hide addresses of hosts
   (VMs) in the core, but they do not prevent the MAC address table
   explosion problem (issue 1) unless the Network Virtualization Edge
   (NVE) is on a server.

   The scaling practices documented in [<a href="rfc7342.html" title='"Practices for Scaling ARP and Neighbor Discovery (ND) in Large Data Centers"'>RFC7342</a>] can only reduce some
   ARP impact on L2/L3 boundary routers in some scenarios, but not all.

   In order to protect router CPUs from being overburdened by target
   resolution requests, some routers rate-limit the target MAC
   resolution requests to the router's CPU.  When the rate limit is
   exceeded, the incoming data frames are dropped.  In traditional data
   centers, this issue is less significant, since the number of hosts
   attached to one L2/L3 boundary router is limited by the number of
   physical ports of the switches/routers.  When servers are virtualized
   to support 30+ VMs, the number of hosts under one router can grow by
   a factor of 30+.  Furthermore, in traditional data center networks,
   each subnet is neatly bound to a limited number of server racks,
   i.e., switches only need to be familiar with MAC addresses of hosts
   that reside in this small number of subnets.  In contemporary data
   center networks, as subnets are spread across many server racks,
   switches are exposed to VLAN/MAC addresses of many subnets, greatly
   increasing the size of switches' FDB tables.

   The solution proposed in this document can eliminate or reduce the
   likelihood of inter-subnet data frames being dropped and reduce the
   number of host MAC addresses that intermediate switches are exposed
   to, thus reducing switches' FDB table sizes.










<span class="grey">Nachum, et al.                Experimental                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20SARP%20Overview"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  SARP Overview</span>

   The SARP approach uses proxy gateways to address the problems
   discussed above.

   Note: The guidelines to proxy developers [<a href="rfc4389.html" title='"Neighbor Discovery Proxies (ND Proxy)"'>RFC4389</a>] have been
   carefully considered for SARP.  <a href="#section-3.3">Section 3.3</a> discusses how SARP works
   when VMs are moved from one segment to another.

   In order to enable VMs to be moved across servers while ensuring
   their MAC/IP addresses remain unchanged, the Layer 2 network (e.g.,
   VLAN) that interconnects those VMs may spread across different server
   racks, different rows of server racks, or even different data center
   sites.

   A multisite data center network is comprised of two main building
   blocks: an interconnecting segment and an access segment.  While the
   access network is, in most cases, a Layer 2 network, the
   interconnecting segment is not necessarily a Layer 2 network.

   The SARP proxies are located at the boundaries where the access
   segment connects to its interconnecting segment.  The boundary node
   can be a hypervisor virtual switch, a top-of-rack switch, an
   aggregation switch (or end-of-row switch), or a data center core
   switch.  Figure 2 depicts an example of two remote data centers that
   are managed as a single, flat Layer 2 domain.  SARP proxies are
   implemented at the edge devices connecting the data center to the
   transport network.  SARP significantly reduces the ARP/ND
   transmissions over the interconnecting network.






















<span class="grey">Nachum, et al.                Experimental                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


                            *-------------------*
                            |                   |
                    +-------| Interconnecting   |-------+
                    |       |     network       |       |
                    |       *-------------------*       |
                    |                                   |
           *-----------------*                  *----------------*
           |  SARP Proxies   |                  |  SARP Proxies  |
           *-----------------*                  *----------------*
              |           |                        |           |
          *-------*   *-------*                *-------*   *-------*
          |Access |   |Access |                |Access |   |Access |
          *-------*   *-------*                *-------*   *-------*
              |
         *----------*
         |Hypervisor|
         *----------*
              |
          *--------*
          |Virtual |
          |Machine |
          *--------*

             (West Site)                          (East Site)

               Figure 2: SARP: Network Architecture Example

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.3.%20%20SARP%20Deployment%20Options"></a><a class="selflink" href="#section-1.3" name="section-1.3">1.3</a>.  SARP Deployment Options</span>

   SARP deployment is tightly coupled with the data center architecture.
   SARP proxies are located at the point where the Layer 2
   infrastructure connects to its Layer 2 cloud using overlay networks.
   SARP proxies can be located at the data center edge (as Figure 2
   depicts), data center core, or data center aggregation (denoted by
   "Agg" in the figure).  SARP can also be implemented by the hypervisor
   (as Figure 3 depicts).

   To simplify the description, we will focus on data centers that are
   managed as a single, flat Layer 2 network, where SARP proxies are
   located at the boundary where the data center connects to the
   transport network (as Figure 2 depicts).










<span class="grey">Nachum, et al.                Experimental                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


                            *-------------------*
                            |                   |
                    +-------|     TRANSPORT     |-------+
                    |       |                   |       |
                    |       *-------------------*       |
                    |                                   |
           *-----------------*                  *----------------*
           |   Edge Device   |                  |  Edge Device   |
           *-----------------*                  *----------------*
                    |                                   |
           *-----------------*                  *----------------*
           |       Core      |                  |      Core      |
           *-----------------*                  *----------------*
              |           |                        |           |
          *-------*   *-------*                *-------*   *-------*
          |  Agg  |   |  Agg  |                |  Agg  |   |  Agg  |
          *-------*   *-------*                *-------*   *-------*
              |
         *----------*
         |Hypervisor|
         *----------*

             (West Site)                          (East Site)

                     Figure 3: SARP Deployment Options

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.4.%20%20Comparison%20with%20Existing%20Solutions"></a><a class="selflink" href="#section-1.4" name="section-1.4">1.4</a>.  Comparison with Existing Solutions</span>

   The IETF has developed several mechanisms to address issues
   associated with Layer 2 networks over multiple geographic locations,
   for example, Layer 2 VPN [<a href="rfc4664.html" title='"Framework for Layer 2 Virtual Private Networks (L2VPNs)"'>RFC4664</a>], proxy ARP [<a href="rfc925.html" title='"Multi-LAN address resolution"'>RFC925</a>] [<a href="#ref-ProxyARP" title='"Using ARP to implement transparent subnet gateways"'>ProxyARP</a>],
   proxy Neighbor Discovery [<a href="rfc4389.html" title='"Neighbor Discovery Proxies (ND Proxy)"'>RFC4389</a>], IGMP and MLD snooping [<a href="rfc4541.html" title='"Considerations for Internet Group Management Protocol (IGMP) and Multicast Listener Discovery (MLD) Snooping Switches"'>RFC4541</a>],
   and ARP mediation for IP interworking of Layer 2 VPNs [<a href="rfc6575.html" title='"Address Resolution Protocol (ARP) Mediation for IP Interworking of Layer 2 VPNs"'>RFC6575</a>].

   However, all those solutions work well when hosts within one subnet
   are placed together under one access domain, so that the intermediate
   switches in each access domain are only exposed to host addresses
   from a limited number of subnets.  SARP is to provide a solution when
   hosts within one subnet are spread across multiple access domains,
   and each access domain has hosts from many subnets.  Under this
   environment, the intermediate switches in each access domain are
   exposed to combined hosts of all the subnets that are enabled by the
   access domain.








<span class="grey">Nachum, et al.                Experimental                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terms%20and%20Abbreviations%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terms and Abbreviations Used in This Document</span>

   ARP:   Address Resolution Protocol [<a href="#ref-ARP" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>ARP</a>]

   FDB:   Filtering Database, which is used for Layer 2 switches
          [<a href="#ref-802.1Q" title='"IEEE Standard for Local and metropolitan area networks -- Bridges and Bridged Networks"'>802.1Q</a>].  Layer 2 switches flood data frames when the
          Destination Address (DA) is not in the FDB, whereas routers
          drop data frames when the DA is not in the Forwarding
          Information Base (FIB).  That is why the FDB is used for Layer
          2 switches.

   FIB:   Forwarding Information Base

   Hypervisor: a software layer that creates and runs virtual machines
          on a server

   IP-D:  IP address of the destination virtual machine

   IP-S:  IP address of the source virtual machine

   MAC-D: MAC address of the destination virtual machine

   MAC-E: MAC address of the East Proxy SARP Device

   MAC-S: MAC address of the source virtual machine

   NA:    IPv6 ND's Neighbor Advertisement

   ND:    IPv6 Neighbor Discovery Protocol [<a href="#ref-ND" title='"Neighbor Discovery for IP version 6 (IPv6)"'>ND</a>].  In this document, ND
          also refers to Neighbor Solicitation, Neighbor Advertisement,
          and Unsolicited Neighbor Advertisement messages defined by <a href="rfc4861.html">RFC</a>
          <a href="rfc4861.html">4861</a>.

   NS:    IPv6 ND's Neighbor Solicitation

   SARP Proxy: The components that participate in SARP

   UNA:   IPv6 ND's Unsolicited Neighbor Advertisement [<a href="#ref-ND" title='"Neighbor Discovery for IP version 6 (IPv6)"'>ND</a>]

   VM:    Virtual Machine











<span class="grey">Nachum, et al.                Experimental                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20SARP%3A%20Theory%20of%20Operation"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  SARP: Theory of Operation</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Control%20Plane%3A%20ARP%2FND"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Control Plane: ARP/ND</span>

   This section describes the ARP/ND procedure scenarios.  The first
   scenario addresses a case where both the source and destination VMs
   reside in the same access segment.  In the second scenario, the
   source VM is in the local access segment and the destination VM is
   located at the remote access segment.

   In all scenarios, the VMs (source and destination) share the same L2
   broadcast domain.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.1.%20%20ARP%2FNS%20Request%20for%20a%20Local%20VM"></a><a class="selflink" href="#section-3.1.1" name="section-3.1.1">3.1.1</a>.  ARP/NS Request for a Local VM</span>

   When source and destination VMs are located at the same access
   segment (Figure 4), the address resolution process is as described in
   [<a href="#ref-ARP" title='"Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"'>ARP</a>] and [<a href="#ref-ND" title='"Neighbor Discovery for IP version 6 (IPv6)"'>ND</a>]; host A sends an ARP request or an IPv6 Neighbor
   Solicitation (NS) to learn the IP-to-MAC mapping of host B, and it
   receives a reply from host B with the IP-D to MAC-D mapping.

     +-------+      _   __       +-------+      _   __
     |host A |     / \_/  \_     | SARP  |     / \_/  \_
     | IP-S  |&lt;---&gt;\_access \&lt;==&gt;| proxy |&lt;===&gt;\_interc.\
     | MAC-S |     /network_/    |   1   |     /network_/
     +-------+  +-&gt;\__   _/      +-------+     \__   _/
                |     \_/                         \_/
     +-------+  |
     |host B |&lt;-+
     | IP-D  |
     | MAC-D |
     +-------+

     &lt;--------------West Site------------&gt;

           Figure 4: SARP: Two Hosts in the Same Access Segment















<span class="grey">Nachum, et al.                Experimental                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.2.%20%20ARP%2FNS%20Request%20for%20a%20Remote%20VM"></a><a class="selflink" href="#section-3.1.2" name="section-3.1.2">3.1.2</a>.  ARP/NS Request for a Remote VM</span>

   When the source and destination VMs are located at different access
   segments, the address resolution process is as follows.

     +-------+     +-------+    _   __       +-------+     +-------+
     |host A |     | SARP  |   / \_/  \_     | SARP  |     |host B |
     | IP-S  |&lt;===&gt;|proxy 1|&lt;=&gt;\_       \&lt;==&gt;|proxy 2|&lt;===&gt;| IP-D  |
     | MAC-S |     | MAC-W |   /       _/    | MAC-E |     | MAC-D |
     +-------+     +-------+   \__   _/      +-------+     +-------+
                                  \_/
     &lt;------West Site------&gt;                 &lt;------East Site------&gt;

        Figure 5: SARP: Two Hosts That Reside in Different Segments

   In the example illustrated in Figure 5, the source VM is located at
   the west access segment and the destination VM is located at the east
   access segment.

   When host A sends an ARP/NS request to find out the IP-to-MAC mapping
   of host B:

   1. If SARP proxy 1 does not have IP-D in its ARP cache, the ARP/NS
      request is propagated to all access segments that might have VMs
      in the same virtual network as the originating VM, including the
      east access segment.

   2. As SARP proxy 1 forwards the ARP/NS message, it replaces the
      source MAC address, MAC-S, with its own MAC address, MAC-W.  Thus,
      all switches that reside in the interconnecting segment are not
      exposed to MAC-S.

   3. The ARP/NS request reaches SARP proxy 2.

   4. If SARP proxy 2 does not have IP-D in its ARP cache, the ARP/NS
      request is forwarded to the east access network.  Host B responds
      with an ARP reply (IPv4) or a Neighbor Advertisement (IPv6) to the
      request with MAC-D.

   5. When the response message reaches SARP proxy 2, it replaces MAC-D
      with MAC-E; thus, the response reaches SARP proxy 1 with MAC-E.

   6. As SARP proxy 1 forwards the response to host A, it replaces the
      destination address from MAC-W to MAC-S.







<span class="grey">Nachum, et al.                Experimental                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   SARP Proxy ARP/ND Cache

   SARP proxies maintain a cache of the IP-to-MAC mapping.  This cache
   is based on ARP/ND messages that are sent by hosts and traverse the
   SARP proxies.

   In steps 1 and 4 above, if the SARP proxy has IP-D in its ARP cache,
   it responds with MAC-E, without forwarding the ARP/NS request.

   This caching approach significantly reduces the volume of the ARP/ND
   transmission over the network and reduces the round-trip time of
   ARP/ND requests.

   When the west SARP proxy caches the IP-to-MAC mapping entries for
   remote VMs, the expiration timers should be set to relatively low
   values to prevent stale entries due to remote VMs being moved or
   deleted.  In environments where VMs move more frequently, it is not
   recommended for SARP proxies to cache the IP-to-MAC mapping entries
   of remote VMs.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.1.3.%20%20Gratuitous%20ARP%20and%20Unsolicited%20Neighbor%20Advertisement%20%28UNA%29"></a><a class="selflink" href="#section-3.1.3" name="section-3.1.3">3.1.3</a>.  Gratuitous ARP and Unsolicited Neighbor Advertisement (UNA)</span>

   Hosts (or VMs) send out Gratuitous ARP (IPv4) [<a href="#ref-TcpIp" title='"TCP/IP Illustrated, Volume 1: The Protocols"'>TcpIp</a>] and Unsolicited
   Neighbor Advertisement (UNA) (IPv6) messages to allow other nodes to
   refresh IP-to-MAC entries in their caches.

   The local SARP proxy processes the Gratuitous ARP or UNA message in
   the same way as the ARP reply or IPv6 NA, i.e., replaces the MAC
   addresses in the same manner.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Data%20Plane%3A%20Packet%20Transmission"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Data Plane: Packet Transmission</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Local%20Packet%20Transmission"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Local Packet Transmission</span>

   When a VM transmits packets to a destination VM that is located at
   the same site (Figure 4), the data plane is unaffected by SARP;
   packets are sent from (IP-S, MAC-S) to (IP-D, MAC-D).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20Packet%20Transmission%20between%20Sites"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  Packet Transmission between Sites</span>

   Packets that are sent between sites (Figure 5) traverse the SARP
   proxy of both sites.

   A packet sent from host A to host B undergoes the following
   procedure:

   1. Host A sends a packet to IP-D, and based on its ARP table, it uses
      the MAC addresses {MAC-E, MAC-S}.



<span class="grey">Nachum, et al.                Experimental                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   2. SARP proxy 1 receives the packet and replaces the source MAC
      address, such that the packet includes {MAC-E, MAC-W}.

   3. SARP proxy 2 receives the packet and replaces the destination MAC
      address, and the packet is sent to host B with {MAC-D, MAC-W}.

   SARP proxy 1 replaces the source MAC address with its own, since
   switches in the interconnecting segment are only familiar with SARP
   proxy MAC addresses and are not familiar with host addresses.

   Note: it is a common security practice in data center networks to use
   access lists, allowing each VM to communicate only with a list of
   authorized peer VMs.  In most cases, such access control lists are
   based on IP addresses and, hence, are not affected by the MAC address
   replacement in SARP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20VM%20Migration"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  VM Migration</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20%20VM%20Local%20Migration"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>.  VM Local Migration</span>

   When a VM migrates locally within its access segment, SARP does not
   require any special behavior.  VM migration is resolved entirely by
   the Layer 2 mechanisms.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20%20VM%20Migration%20from%20One%20Site%20to%20Another"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>.  VM Migration from One Site to Another</span>

   This section focuses on a scenario where a VM migrates from the west
   site to the east site while maintaining its MAC and IP addresses.

   VM migration might affect networking elements based on their
   respective locations:

   -  origin site (west site)

   -  destination site (east site)

   -  other sites

     +-------+     +-------+    _   __       +-------+     +-------+
     |host A |     | SARP  |   / \_/  \_     | SARP  |     |host A |
     | IP-D  |&lt;===&gt;|proxy 1|&lt;=&gt;\_       \&lt;==&gt;|proxy 2|&lt;===&gt;| IP-D  |
     | MAC-D |     | MAC-W |   /       _/    | MAC-E |     | MAC-D |
     +-------+     +-------+   \__   _/      +-------+     +-------+
                                  \_/
     &lt;------West Site------&gt;                 &lt;------East Site------&gt;
           Origin Site                          Destination Site

        Figure 6: SARP: Host A Migrates from West Site to East Site



<span class="grey">Nachum, et al.                Experimental                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   Origin Site

      The origin site is the site where the VM resides before the
      migration (west site).

      Before the VM (IP=IP-D, MAC=MAC-D) is moved, all VMs at the west
      site that have an ARP entry of IP-D in their ARP table have the
      IP-D -&gt; MAC-D mapping.  VMs on other access segments have an ARP
      entry of IP-D -&gt; MAC-W mapping where MAC-W is the MAC address of
      the SARP proxy on the west access segment.

      After the VM (IP-D) in the west site moves to the east site, if a
      Gratuitous ARP (IPv4) or an Unsolicited Neighbor Advertisement
      (IPv6) message is sent out by the destination hypervisor on behalf
      of the VM (IP-D), then the IP-to-MAC mapping cache of the VMs in
      all access segments is updated by IP-D -&gt; MAC-E, where MAC-E is
      the MAC address of the SARP proxy on the east site.  If no
      Gratuitous ARP or UNA message is sent out by the destination
      hypervisor, the IP-to-MAC cache on the VMs in the west site (and
      other sites) is eventually aged out.

      Until the IP-to-MAC mapping cache tables are updated, the source
      VMs from the west site continue sending packets locally to MAC-D,
      and switches at the west site are still configured with the old
      location of MAC-D.  This transient condition can be resolved by
      having the VM manager send out a fake Gratuitous ARP or UNA
      message on behalf of the destination Hypervisor.  Another
      alternative is to have a shorter aging timer configured for the
      IP-to-MAC cache table.

   Destination Site

      The destination site is the site to which the VM migrated, i.e.,
      the east site in Figure 6.

      Before any Gratuitous ARP or UNA messages are sent out by the
      destination hypervisor, all VMs at the east site (and all other
      sites) might have an IP-D -&gt; MAC-W mapping in their IP-to-MAC
      mapping cache.  The IP-to-MAC mapping cache is updated by aging or
      by a Gratuitous ARP or UNA message sent by the destination
      hypervisor.  Until the IP-to-MAC mapping caches are updated, VMs
      from the east site continue to send packets to MAC-W.  This can be
      resolved by having the VM manager send out a fake Gratuitous ARP
      or UNA message immediately after the VM migration or by
      redirecting the packets from the SARP proxy of the east site back
      to the migrated VM by updating the destination MAC of the packets
      to MAC-D.




<span class="grey">Nachum, et al.                Experimental                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   Other Sites

      All VMs at the other sites that have an ARP entry of IP-D in their
      ARP table have the IP-D -&gt; MAC-W mapping.  The ARP mapping is
      updated by aging or by a Gratuitous ARP message sent by the
      destination hypervisor of the migrated VM and modified by the SARP
      proxy of the east site to an IP-D -&gt; MAC-E mapping.  Until ARP
      tables are updated, VMs from other sites continue sending packets
      to MAC-W.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.1.%20%20Impact%20on%20IP-to-MAC%20Mapping%20Cache%20Table%20of%20Migrated%20VMs"></a><a class="selflink" href="#section-3.3.2.1" name="section-3.3.2.1">3.3.2.1</a>.  Impact on IP-to-MAC Mapping Cache Table of Migrated VMs</span>

   When a VM (IP-D) is moved from one site to another, its IP-to-MAC
   mapping entries for VMs located at other sites (i.e., neither the
   east site nor the west site) are still valid, even though most guest
   OSs (or VMs) will refresh their IP-to-MAC cache after migration.

   The migrated VM's IP-to-MAC mapping entries for VMs located at the
   east site, if not refreshed after migration, can be kept with no
   change until the ARP aging time, as these entries are mapped to MAC-
   E.  All traffic originated from the migrated VM in its new location
   to VMs located at the east site traverses the SARP proxy of the east
   site.  That SARP proxy can redirect the traffic back to the
   corresponding destinations on the east site.  Furthermore, an ARP/UNA
   message sent by the SARP proxy of the east site or by the VMs on the
   east site can refresh the corresponding entries in the migrated VM's
   IP-to-MAC cache.

   The migrated VM's ARP entries for VMs located at the west site remain
   unchanged until either the ARP entries age out or new data frames are
   received from the remote sites.  Since all MAC addresses of the VMs
   located at the west site are unknown at the east site, all unknown
   traffic from the VM is intercepted by the SARP proxy of the east site
   and forwarded to the SARP proxy of the west site (during the
   transient period before the ARP entries age out).  This transient
   behavior is avoided if the SARP proxy has the destination IP address
   in its ARP cache, and, upon receiving a packet with an unknown
   destination MAC address, it could send a Gratuitous ARP or UNA
   message to the migrated VM.

   Note that overlay networks providing Layer 2 network virtualization
   services configure their edge-device MAC aging timers to be greater
   than the ARP request interval.








<span class="grey">Nachum, et al.                Experimental                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Multicast%20and%20Broadcast"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Multicast and Broadcast</span>

   Multicast and broadcast traffic is forwarded by SARP proxies as
   follows:

   o  SARP proxies modify the source MAC address of multicast and
      broadcast packets as described in <a href="#section-3.2">Section 3.2</a>.

   o  SARP proxies do not modify the destination MAC address of
      multicast and broadcast packets.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20%20Non-IP%20Packet"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>.  Non-IP Packet</span>

   The L2/L3 boundary routers in the current document are capable of
   forwarding non-IP IEEE 802.1 Ethernet frames (Layer 2) without
   changing the MAC headers.  When subnets span across multiple ports of
   those routers, they are still under the category of a single link, or
   a multi-access link model recommended by [<a href="rfc4903.html" title='"Multi-Link Subnet Issues"'>RFC4903</a>].  They differ from
   the "multi-link" subnets described in [<a href="#ref-MultLinkSub">MultLinkSub</a>] and [<a href="rfc4903.html" title='"Multi-Link Subnet Issues"'>RFC4903</a>],
   which refer to a different physical media with the same prefix
   connected to a router, where the Layer 2 frames cannot be natively
   forwarded without changing the headers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6.%20%20High%20Availability%20and%20Load%20Balancing"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a>.  High Availability and Load Balancing</span>

   The SARP proxy is located at the boundary where the local Layer 2
   infrastructure connects to the interconnecting network.  All traffic
   from the local site to the remote sites traverses the SARP proxy.
   The SARP proxy is subject to high-availability and bandwidth
   requirements.

   The SARP architecture supports multiple SARP proxies connecting a
   single site to the transport network.  In the SARP architecture, all
   proxies can be active and can back up one another.  The SARP
   architecture is robust and allows network administrators to allocate
   proxies according to bandwidth and high-availability requirements.

   Traffic is segregated between SARP proxies by using VLANs.  An SARP
   proxy is the Master SARP proxy of a set of VLANs and the Backup SARP
   proxy of another set of VLANs.

   For example, assume the SARP proxies of the west site are SARP proxy
   1 and SARP proxy 2.  The west site supports VLAN 1 and VLAN 2, while
   SARP proxy 1 is the Master SARP proxy of VLAN 1 and the Backup SARP
   proxy of VLAN 2, and SARP proxy 2 is the Master SARP proxy of VLAN 2
   and the Backup SARP proxy of VLAN 1.  Both proxies are members of
   VLAN 1 and VLAN 2.




<span class="grey">Nachum, et al.                Experimental                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   The Master SARP proxy updates its Backup SARP proxy with all the ARP
   reply messages.  The Backup SARP proxy maintains a backup database to
   all the VLANs that it is the Backup SARP proxy of.

   The Master and the Backup SARP proxies maintain a keepalive
   mechanism.  In case of a failure, the Backup SARP proxy becomes the
   Master SARP proxy.  The failure decision is per VLAN.  When the
   Master and the Backup SARP proxies switch over, the Backup SARP proxy
   can use the MAC address of the Master SARP proxy.  The Backup SARP
   proxy sends locally a Gratuitous ARP message with the MAC address of
   the Master SARP proxy to update the forwarding tables on the local
   switches.  The Backup SARP proxy also updates the remote SARP proxies
   on the change.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.7.%20%20SARP%20Interaction%20with%20Overlay%20Networks"></a><a class="selflink" href="#section-3.7" name="section-3.7">3.7</a>.  SARP Interaction with Overlay Networks</span>

   SARP can be used over overlay networks, providing L2 network
   virtualization (such as IP, Virtual Private LAN Service (VPLS),
   Transparent Interconnection of Lots of Links (TRILL), Overlay
   Transport Virtualization (OTV), Network Virtualization using GRE
   (NVGRE), and Virtual eXtensible Local Area Network (VXLAN)).  The
   mapping of SARP to overlay networks is straightforward; the VM does
   the mapping of the destination IP to the SARP proxy MAC address.  The
   mapping of the proxy MAC to its correct tunnel is done by the overlay
   networks.

   SARP significantly scales down the complexity of the overlay networks
   and transport networks by reducing the mapping tables to the number
   of SARP proxies.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Security%20Considerations"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Security Considerations</span>

   SARP proxies are located at the boundaries of access networks, where
   the local Layer 2 infrastructure connects to its Layer 2 cloud.  SARP
   proxies interoperate with overlay network protocols that extend the
   Layer 2 subnet across data centers or between different systems
   within a data center.

   SARP does not expose the network to security threats beyond those
   that exist whether or not SARP is present.

   SARP proxies may be exposed to denial-of-service (DoS) attacks by
   means of ARP/ND message flooding.  Thus, SARP proxies must have
   sufficient resources to support the SARP control plane without making
   the network more vulnerable to DoS than it was without SARP proxies.






<span class="grey">Nachum, et al.                Experimental                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   SARP adds security to the data plane in terms of network
   reconnaissance, by hiding all the local Layer 2 MAC addresses from
   potential attackers located at the interconnecting network and
   significantly limiting the number of addresses exposed to an attacker
   at a remote site.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20References"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Normative%20References"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Normative References</span>

   [<a id="ref-ARP" name="ref-ARP">ARP</a>]       Plummer, D., "Ethernet Address Resolution Protocol: Or
               Converting Network Protocol Addresses to 48.bit Ethernet
               Address for Transmission on Ethernet Hardware", STD 37,
               <a href="rfc826.html">RFC 826</a>, DOI 10.17487/RFC0826, November 1982,
               &lt;<a href="http://www.rfc-editor.org/info/rfc826">http://www.rfc-editor.org/info/rfc826</a>&gt;.

   [<a id="ref-ND" name="ref-ND">ND</a>]        Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
               "Neighbor Discovery for IP version 6 (IPv6)", <a href="rfc4861.html">RFC 4861</a>,
               DOI 10.17487/RFC4861, September 2007,
               &lt;<a href="http://www.rfc-editor.org/info/rfc4861">http://www.rfc-editor.org/info/rfc4861</a>&gt;.

   [<a id="ref-ProxyARP" name="ref-ProxyARP">ProxyARP</a>]  Carl-Mitchell, S. and J. Quarterman, "Using ARP to
               implement transparent subnet gateways", <a href="rfc1027.html">RFC 1027</a>,
               DOI 10.17487/RFC1027, October 1987,
               &lt;<a href="http://www.rfc-editor.org/info/rfc1027">http://www.rfc-editor.org/info/rfc1027</a>&gt;.

   [<a id="ref-RFC925" name="ref-RFC925">RFC925</a>]    Postel, J., "Multi-LAN address resolution", <a href="rfc925.html">RFC 925</a>,
               DOI 10.17487/RFC0925, October 1984,
               &lt;<a href="http://www.rfc-editor.org/info/rfc925">http://www.rfc-editor.org/info/rfc925</a>&gt;.

   [<a id="ref-RFC4389" name="ref-RFC4389">RFC4389</a>]   Thaler, D., Talwar, M., and C. Patel, "Neighbor Discovery
               Proxies (ND Proxy)", <a href="rfc4389.html">RFC 4389</a>, DOI 10.17487/RFC4389,
               April 2006, &lt;<a href="http://www.rfc-editor.org/info/rfc4389">http://www.rfc-editor.org/info/rfc4389</a>&gt;.

   [<a id="ref-RFC4541" name="ref-RFC4541">RFC4541</a>]   Christensen, M., Kimball, K., and F. Solensky,
               "Considerations for Internet Group Management Protocol
               (IGMP) and Multicast Listener Discovery (MLD) Snooping
               Switches", <a href="rfc4541.html">RFC 4541</a>, DOI 10.17487/RFC4541, May 2006,
               &lt;<a href="http://www.rfc-editor.org/info/rfc4541">http://www.rfc-editor.org/info/rfc4541</a>&gt;.

   [<a id="ref-RFC4664" name="ref-RFC4664">RFC4664</a>]   Andersson, L., Ed., and E. Rosen, Ed., "Framework for
               Layer 2 Virtual Private Networks (L2VPNs)", <a href="rfc4664.html">RFC 4664</a>,
               DOI 10.17487/RFC4664, September 2006,
               &lt;<a href="http://www.rfc-editor.org/info/rfc4664">http://www.rfc-editor.org/info/rfc4664</a>&gt;.







<span class="grey">Nachum, et al.                Experimental                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


   [<a id="ref-RFC6575" name="ref-RFC6575">RFC6575</a>]   Shah, H., Ed., Rosen, E., Ed., Heron, G., Ed., and V.
               Kompella, Ed., "Address Resolution Protocol (ARP)
               Mediation for IP Interworking of Layer 2 VPNs", <a href="rfc6575.html">RFC 6575</a>,
               DOI 10.17487/RFC6575, June 2012,
               &lt;<a href="http://www.rfc-editor.org/info/rfc6575">http://www.rfc-editor.org/info/rfc6575</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Informative%20References"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Informative References</span>

   [<a id="ref-802.1Q" name="ref-802.1Q">802.1Q</a>]    IEEE, "IEEE Standard for Local and metropolitan area
               networks -- Bridges and Bridged Networks", IEEE Std
               802.1Q.

   [<a id="ref-ARMDStats" name="ref-ARMDStats">ARMDStats</a>] Karir, M., and J. Rees, <a href="https://www.google.com/search?sitesearch=tools.ietf.org%2Fhtml%2F&amp;q=inurl:draft-+%22Address+Resolution+Statistics%22" style="text-decoration: none">"Address Resolution Statistics"</a>,
               Work in Progress, <a href="https://tools.ietf.org/html/draft-karir-armd-statistics-01">draft-karir-armd-statistics-01</a>, July
               2011.

   [<a id="ref-MultLinkSub" name="ref-MultLinkSub">MultLinkSub</a>]
               Thaler, D., and C. Huitema, "Multi-link Subnet Support in
               IPv6", Work in Progress,
               <a href="https://tools.ietf.org/html/draft-ietf-ipv6-multi-link-subnets-00">draft-ietf-ipv6-multi-link-subnets-00</a>, June 2002.

   [<a id="ref-RFC4903" name="ref-RFC4903">RFC4903</a>]   Thaler, D., "Multi-Link Subnet Issues", <a href="rfc4903.html">RFC 4903</a>,
               DOI 10.17487/RFC4903, June 2007,
               &lt;<a href="http://www.rfc-editor.org/info/rfc4903">http://www.rfc-editor.org/info/rfc4903</a>&gt;.

   [<a id="ref-RFC6820" name="ref-RFC6820">RFC6820</a>]   Narten, T., Karir, M., and I. Foo, "Address Resolution
               Problems in Large Data Center Networks", <a href="rfc6820.html">RFC 6820</a>,
               DOI 10.17487/RFC6820, January 2013,
               &lt;<a href="http://www.rfc-editor.org/info/rfc6820">http://www.rfc-editor.org/info/rfc6820</a>&gt;.

   [<a id="ref-RFC7342" name="ref-RFC7342">RFC7342</a>]   Dunbar, L., Kumari, W., and I. Gashinsky, "Practices for
               Scaling ARP and Neighbor Discovery (ND) in Large Data
               Centers", <a href="rfc7342.html">RFC 7342</a>, DOI 10.17487/RFC7342, August 2014,
               &lt;<a href="http://www.rfc-editor.org/info/rfc7342">http://www.rfc-editor.org/info/rfc7342</a>&gt;.

   [<a id="ref-RFC7364" name="ref-RFC7364">RFC7364</a>]   Narten, T., Ed., Gray, E., Ed., Black, D., Fang, L.,
               Kreeger, L., and M. Napierala, "Problem Statement:
               Overlays for Network Virtualization", <a href="rfc7364.html">RFC 7364</a>,
               DOI 10.17487/RFC7364, October 2014,
               &lt;<a href="http://www.rfc-editor.org/info/rfc7364">http://www.rfc-editor.org/info/rfc7364</a>&gt;.

   [<a id="ref-TcpIp" name="ref-TcpIp">TcpIp</a>]     Stevens, W., "TCP/IP Illustrated, Volume 1: The
               Protocols", Addison-Wesley, 1994.








<span class="grey">Nachum, et al.                Experimental                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7586.html">RFC 7586</a>                          SARP                         June 2015</span>


Acknowledgments

   The authors thank Ted Lemon, Eric Gray, and Adrian Farrel for
   providing valuable comments and suggestions for the document.

Authors' Addresses

   Youval Nachum
   EMail: youval.nachum@gmail.com


   Linda Dunbar
   Huawei Technologies
   5430 Legacy Drive, Suite #175
   Plano, TX  75024
   United States
   Phone: (469) 277 5840
   EMail: ldunbar@huawei.com


   Ilan Yerushalmi
   Marvell
   6 Hamada St.
   Yokneam, 20692
   Israel
   EMail: yilan@marvell.com


   Tal Mizrahi
   Marvell
   6 Hamada St.
   Yokneam, 20692
   Israel
   EMail: talmi@marvell.com

















Nachum, et al.                Experimental                     [Page 21]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7586 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:21 GMT --></html>