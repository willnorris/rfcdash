<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc8267 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="rfc5667" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:8267" name="DC.Identifier"/>
<meta content="October, 2017" name="DC.Date.Issued"/>
<meta content="Chuck Lever &lt;chuck.lever@oracle.com&gt;" name="DC.Creator"/>
<meta content="This document specifies Upper-Layer Bindings of Network File System
(NFS) protocol versions to RPC-over-RDMA version 1, thus enabling the
use of Direct Data Placement. This document obsoletes RFC 5667." name="DC.Description.Abstract"/>
<meta content="Network File System (NFS) Upper-Layer Binding to RPC-over-RDMA Version 1" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 8267 - Network File System (NFS) Upper-Layer Binding to RPC-over-RDMA Version 1</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc8267.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc8267" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-nfsv4-rfc5667bis" title="draft-ietf-nfsv4-rfc5667bis">draft-ietf-nfsv...</a>] [<a href="https://datatracker.ietf.org/doc/rfc8267" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc8267" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc8267" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                          C. Lever
Request for Comments: 8267                                        Oracle
Obsoletes: <a href="rfc5667.html">5667</a>                                             October 2017
Category: Standards Track
ISSN: 2070-1721


Network File System (NFS) Upper-Layer Binding to RPC-over-RDMA Version 1

Abstract

   This document specifies Upper-Layer Bindings of Network File System
   (NFS) protocol versions to RPC-over-RDMA version 1, thus enabling the
   use of Direct Data Placement.  This document obsoletes <a href="rfc5667.html">RFC 5667</a>.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="https://www.rfc-editor.org/info/rfc8267">https://www.rfc-editor.org/info/rfc8267</a>.























<span class="grey">Lever                        Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

























<span class="grey">Lever                        Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Requirements Language . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Reply Size Estimation . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.1">3.1</a>.  Short Reply Chunk Retry . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  Upper-Layer Binding for NFS Versions 2 and 3  . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-4.1">4.1</a>.  Reply Size Estimation . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-4.2">4.2</a>.  RPC Binding Considerations  . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   5.  Upper-Layer Bindings for NFS Versions 2 and 3 Auxiliary
       Protocols . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-5.1">5.1</a>.  MOUNT, NLM, and NSM Protocols . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-5.2">5.2</a>.  NFSACL Protocol . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Upper-Layer Binding for NFS Version 4 . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-6.1">6.1</a>.  DDP-Eligibility . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-6.2">6.2</a>.  Reply Size Estimation . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-6.3">6.3</a>.  RPC Binding Considerations  . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.4">6.4</a>.  NFS COMPOUND Requests . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-6.5">6.5</a>.  NFS Callback Requests . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
     <a href="#section-6.6">6.6</a>.  Session-Related Considerations  . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-6.7">6.7</a>.  Transport Considerations  . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
   <a href="#section-7">7</a>.  Extending NFS Upper-Layer Bindings  . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-8">8</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-9">9</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
   <a href="#section-10">10</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-10.1">10.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-10.2">10.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
   <a href="#appendix-A">Appendix A</a>.  Changes Since <a href="rfc5667.html">RFC 5667</a> . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>





















<span class="grey">Lever                        Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The RPC-over-RDMA version 1 transport may employ Direct Data
   Placement (DDP) to convey data payloads associated with RPC
   transactions [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>].  To enable successful interoperation, RPC
   client and server implementations using RPC-over-RDMA version 1 must
   agree which External Data Representation (XDR) data items and RPC
   procedures are eligible to use DDP.

   An Upper-Layer Binding specifies this agreement for one or more
   versions of one RPC program.  Other operational details, such as RPC
   binding assignments, pairing Write chunks with result data items, and
   reply size estimation, are also specified by this Binding.

   This document contains material required of Upper-Layer Bindings, as
   specified in [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>], for the following NFS protocol versions:

   o  NFS version 2 [<a href="rfc1094.html" title='"NFS: Network File System Protocol specification"'>RFC1094</a>]

   o  NFS version 3 [<a href="rfc1813.html" title='"NFS Version 3 Protocol Specification"'>RFC1813</a>]

   o  NFS version 4.0 [<a href="rfc7530.html" title='"Network File System (NFS) Version 4 Protocol"'>RFC7530</a>]

   o  NFS version 4.1 [<a href="rfc5661.html" title='"Network File System (NFS) Version 4 Minor Version 1 Protocol"'>RFC5661</a>]

   o  NFS version 4.2 [<a href="rfc7862.html" title='"Network File System (NFS) Version 4 Minor Version 2 Protocol"'>RFC7862</a>]

   Upper-Layer Bindings are also provided for auxiliary protocols used
   with NFS versions 2 and 3 (see <a href="#section-5">Section 5</a>).

   This document assumes the reader is already familiar with concepts
   and terminology defined in [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>] and the documents it references.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Requirements%20Language"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   <a href="https://tools.ietf.org/html/bcp14">BCP 14</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="rfc8174.html" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.











<span class="grey">Lever                        Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Reply%20Size%20Estimation"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Reply Size Estimation</span>

   During the construction of each RPC Call message, a requester is
   responsible for allocating appropriate resources for receiving the
   corresponding Reply message.  If the requester expects the RPC Reply
   message will be larger than its inline threshold, it provides Write
   and/or Reply chunks wherein the responder can place results and the
   Reply's Payload stream.

   A reply resource overrun occurs if the RPC Reply Payload stream does
   not fit into the provided Reply chunk or if no Reply chunk was
   provided and the Payload stream does not fit inline.  This prevents
   the responder from returning the Upper-Layer reply to the requester.
   Therefore, reliable reply size estimation is necessary to ensure
   successful interoperation.

   In most cases, the NFS protocol's XDR definition provides enough
   information to enable an NFS client to predict the maximum size of
   the expected Reply message.  If there are variable-size data items in
   the result, the maximum size of the RPC Reply message can be
   estimated as follows:

   o  The client requests only a specific portion of an object (e.g.,
      using the "count" and "offset" fields in an NFS READ).

   o  The client limits the number of results (e.g., using the "count"
      field of an NFS READDIR request).

   o  The client has already cached the size of the whole object it is
      about to request (e.g., via a previous NFS GETATTR request).

   o  The client and server have negotiated a maximum size for all calls
      and responses (e.g., using a CREATE_SESSION operation).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Short%20Reply%20Chunk%20Retry"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Short Reply Chunk Retry</span>

   In a few cases, either the size of one or more returned data items or
   the number of returned data items cannot be known in advance of
   forming an RPC Call.

   If an NFS server finds that the NFS client provided inadequate
   receive resources to return the whole Reply, it returns an RPC-level
   error or a transport error, such as ERR_CHUNK.








<span class="grey">Lever                        Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   In response to these errors, an NFS client can choose to:

   o  terminate the RPC transaction immediately with an error, or

   o  allocate a larger Reply chunk and send the same request as a new
      RPC transaction (a new Transaction ID (XID) should be assigned to
      the retransmitted request to avoid matching a cached RPC Reply
      that caches the original error).  The NFS client should avoid
      retrying the request indefinitely because a responder may return
      ERR_CHUNK for a variety of reasons.

   Subsequent sections of this document discuss exactly which operations
   might have ultimate difficulty with reply size estimation.  These
   operations are eligible for "short Reply chunk retry".  Unless
   explicitly mentioned as applicable, short Reply chunk retry should
   not be used since accurate reply size estimation is problematic in
   only a few cases.  In all other cases, reply size underestimation is
   considered a correctable implementation bug.

   NFS server implementations can avoid connection loss by first
   confirming that target RDMA segments are large enough to receive
   results before initiating explicit RDMA operations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Upper-Layer%20Binding%20for%20NFS%20Versions%202%20and%203"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Upper-Layer Binding for NFS Versions 2 and 3</span>

   The Upper-Layer Binding specification in this section applies to NFS
   versions 2 [<a href="rfc1094.html" title='"NFS: Network File System Protocol specification"'>RFC1094</a>] and 3 [<a href="rfc1813.html" title='"NFS Version 3 Protocol Specification"'>RFC1813</a>].  For brevity, in this document
   a "Legacy NFS client" refers to an NFS client using versions 2 or 3
   of the NFS RPC program (100003) to communicate with an NFS server.
   Likewise, a "Legacy NFS server" is an NFS server communicating with
   clients using NFS versions 2 or 3.

   The following XDR data items in NFS versions 2 and 3 are
   DDP-eligible:

   o  the opaque file data argument in the NFS WRITE procedure

   o  the pathname argument in the NFS SYMLINK procedure

   o  the opaque file data result in the NFS READ procedure

   o  the pathname result in the NFS READLINK procedure

   All other argument or result data items in NFS versions 2 and 3 are
   not DDP-eligible.






<span class="grey">Lever                        Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   A transport error does not give an indication of whether the server
   has processed the arguments of the RPC Call or whether the server has
   accessed or modified client memory associated with that RPC.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Reply%20Size%20Estimation"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Reply Size Estimation</span>

   A Legacy NFS client determines the maximum reply size for each
   operation using the criteria outlined in <a href="#section-3">Section 3</a>.  There are no
   operations in NFS versions 2 or 3 that benefit from short Reply chunk
   retry.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20RPC%20Binding%20Considerations"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  RPC Binding Considerations</span>

   Legacy NFS servers traditionally listen for clients on UDP and TCP
   port 2049.  Additionally, they register these ports with a local
   portmapper [<a href="rfc1833.html" title='"Binding Protocols for ONC RPC Version 2"'>RFC1833</a>] service.

   A Legacy NFS server supporting RPC-over-RDMA version 1 on such a
   network and registering itself with the RPC portmapper MAY choose an
   arbitrary port or MAY use the alternative well-known port number for
   its RPC-over-RDMA service (see <a href="#section-9">Section 9</a>).  The chosen port MAY be
   registered with the RPC portmapper under the netids assigned in
   [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Upper-Layer%20Bindings%20for%20NFS%20Versions%202%20and%203%20Auxiliary%20Protocols"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Upper-Layer Bindings for NFS Versions 2 and 3 Auxiliary Protocols</span>

   NFS versions 2 and 3 are typically deployed with several other
   protocols, sometimes referred to as "NFS auxiliary protocols".  These
   are distinct RPC programs that define procedures that are not part of
   the NFS RPC program (100003).  The Upper-Layer Bindings in this
   section apply to:

   o  versions 2 and 3 of the MOUNT RPC program (100005) [<a href="rfc1813.html" title='"NFS Version 3 Protocol Specification"'>RFC1813</a>];

   o  versions 1, 3, and 4 of the NLM (Network Lock Manager) RPC program
      (100021) [<a href="rfc1813.html" title='"NFS Version 3 Protocol Specification"'>RFC1813</a>];

   o  version 1 of the NSM (Network Status Monitor) RPC program
      (100024), which is described in Chapter 11 of [<a href="#ref-XNFS" title='"Protocols for Interworking: XNFS, Version 3W"'>XNFS</a>]; and

   o  version 1 of the NFSACL RPC program (100227), which does not have
      a public definition.  NFSACL is treated in this document as a de
      facto standard, as there are several interoperating
      implementations.







<span class="grey">Lever                        Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20MOUNT%2C%20NLM%2C%20and%20NSM%20Protocols"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  MOUNT, NLM, and NSM Protocols</span>

   Historically, NFS/RDMA implementations have chosen to convey the
   MOUNT, NLM, and NSM protocols via TCP.  To enable interoperation of
   these protocols when NFS/RDMA is in use, a Legacy NFS server MUST
   provide support for these protocols via TCP.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20NFSACL%20Protocol"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  NFSACL Protocol</span>

   Legacy clients and servers that support the NFSACL RPC program
   typically convey NFSACL procedures on the same connection as the NFS
   RPC program (100003).  This obviates the need for separate rpcbind
   queries to discover server support for this RPC program.

   Access Control Lists (ACLs) are typically small, but even large ACLs
   must be encoded and decoded to some degree.  Thus, no data item in
   this upper-layer protocol is DDP-eligible.

   For NFSACL procedures whose Replies do not include an ACL object, the
   size of a Reply is determined directly from the NFSACL RPC program's
   XDR definition.

   There is no protocol-specified size limit for NFS version 3 ACLs, and
   there is no mechanism in either the NFSACL or NFS RPC programs for a
   Legacy client to ascertain the largest ACL a Legacy server can
   return.  Legacy client implementations should choose a maximum size
   for ACLs based on their own internal limits.

   Because an NFSACL client cannot know in advance how large a returned
   ACL will be, it can use short Reply chunk retry when an NFSACL GETACL
   operation encounters a transport error.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Upper-Layer%20Binding%20for%20NFS%20Version%204"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Upper-Layer Binding for NFS Version 4</span>

   The Upper-Layer Binding specification in this section applies to
   versions of the NFS RPC program defined in NFS versions 4.0
   [<a href="rfc7530.html" title='"Network File System (NFS) Version 4 Protocol"'>RFC7530</a>], 4.1 [<a href="rfc5661.html" title='"Network File System (NFS) Version 4 Minor Version 1 Protocol"'>RFC5661</a>], and 4.2 [<a href="rfc7862.html" title='"Network File System (NFS) Version 4 Minor Version 2 Protocol"'>RFC7862</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20DDP-Eligibility"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  DDP-Eligibility</span>

   Only the following XDR data items in the COMPOUND procedure of all
   NFS version 4 minor versions are DDP-eligible:

   o  The opaque data field in the WRITE4args structure

   o  The linkdata field of the NF4LNK arm in the createtype4 union





<span class="grey">Lever                        Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   o  The opaque data field in the READ4resok structure

   o  The linkdata field in the READLINK4resok structure

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Reply%20Size%20Estimation"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Reply Size Estimation</span>

   Within NFS version 4, there are certain variable-length result data
   items whose maximum size cannot be estimated by clients reliably
   because there is no protocol-specified size limit on these arrays.
   These include:

   o  the attrlist4 field;

   o  fields containing ACLs such as fattr4_acl, fattr4_dacl, and
      fattr4_sacl;

   o  fields in the fs_locations4 and fs_locations_info4 data
      structures; and

   o  fields opaque to the NFS version 4 protocol that pertain to pNFS
      (parallel NFS) layout metadata, such as loc_body, loh_body,
      da_addr_body, lou_body, lrf_body, fattr_layout_types, and
      fs_layout_types.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.1.%20%20Reply%20Size%20Estimation%20for%20Minor%20Version%200"></a><a class="selflink" href="#section-6.2.1" name="section-6.2.1">6.2.1</a>.  Reply Size Estimation for Minor Version 0</span>

   The NFS version 4.0 protocol itself does not impose any bound on the
   size of NFS calls or responses.

   Some of the data items enumerated in <a href="#section-6.2">Section 6.2</a> (in particular, the
   items related to ACLs and fs_locations) make it difficult to predict
   the maximum size of NFS version 4.0 Replies that interrogate
   variable-length fattr4 attributes.  Client implementations might rely
   on their own internal architectural limits to constrain the reply
   size, but such limits are not always guaranteed to be reliable.

   When an especially large fattr4 result is expected, a Reply chunk
   might be required.  An NFS version 4.0 client can use short Reply
   chunk retry when an NFS COMPOUND containing a GETATTR operation
   encounters a transport error.

   The use of NFS COMPOUND operations raises the possibility of requests
   that combine a non-idempotent operation (e.g., RENAME) with a GETATTR
   operation that requests one or more variable-length results.  This
   combination should be avoided by ensuring that any GETATTR operation
   that requests a result of unpredictable length is sent in an NFS
   COMPOUND by itself.




<span class="grey">Lever                        Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.2.2.%20%20Reply%20Size%20Estimation%20for%20Minor%20Version%201%20and%20Newer%20Minor"></a><a class="selflink" href="#section-6.2.2" name="section-6.2.2">6.2.2</a>.  Reply Size Estimation for Minor Version 1 and Newer Minor</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Versions"></a>        Versions</span>

   In NFS version 4.1 and newer minor versions, the csa_fore_chan_attrs
   argument of the CREATE_SESSION operation contains a
   ca_maxresponsesize field.  The value in this field can be taken as
   the absolute maximum size of replies generated by an NFS version 4.1
   server.

   This value can be used in cases where it is not possible to precisely
   estimate a reply size upper bound.  In practice, objects such as
   ACLs, named attributes, layout bodies, and security labels are much
   smaller than this maximum.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20RPC%20Binding%20Considerations"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  RPC Binding Considerations</span>

   NFS version 4 servers are required to listen on TCP port 2049, and
   they are not required to register with an rpcbind service [<a href="rfc7530.html" title='"Network File System (NFS) Version 4 Protocol"'>RFC7530</a>].

   Therefore, an NFS version 4 server supporting RPC-over-RDMA version 1
   MUST use the alternative well-known port number for its RPC-over-RDMA
   service (see <a href="#section-9">Section 9</a>).  Clients SHOULD connect to this well-known
   port without consulting the RPC portmapper (as for NFS version 4 on
   TCP transports).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20NFS%20COMPOUND%20Requests"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  NFS COMPOUND Requests</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.1.%20%20Multiple%20DDP-Eligible%20Data%20Items"></a><a class="selflink" href="#section-6.4.1" name="section-6.4.1">6.4.1</a>.  Multiple DDP-Eligible Data Items</span>

   An NFS version 4 COMPOUND procedure can contain more than one
   operation that carries a DDP-eligible data item.  An NFS version 4
   client provides XDR Position values in each Read chunk to
   disambiguate which chunk is associated with which argument data item.
   However, NFS version 4 server and client implementations must agree
   in advance on how to pair Write chunks with returned result data
   items.

   In the following list, a "READ operation" refers to any NFS version 4
   operation that has a DDP-eligible result data item.  The mechanism
   specified in <a href="rfc8166.html#section-4.3.2">Section 4.3.2 of [RFC8166]</a> is applied to this class of
   operations:

   o  If an NFS version 4 client wishes all DDP-eligible items in an NFS
      Reply to be conveyed inline, it leaves the Write list empty.

   o  The first chunk in the Write list MUST be used by the first READ
      operation in an NFS version 4 COMPOUND procedure.  The next Write
      chunk is used by the next READ operation, and so on.



<span class="grey">Lever                        Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   o  If an NFS version 4 client has provided a matching non-empty Write
      chunk, then the corresponding READ operation MUST return its
      DDP-eligible data item using that chunk.

   o  If an NFS version 4 client has provided an empty matching Write
      chunk, then the corresponding READ operation MUST return all of
      its result data items inline.

   o  If a READ operation returns a union arm that does not contain a
      DDP-eligible result, and the NFS version 4 client has provided a
      matching non-empty Write chunk, an NFS version 4 server MUST
      return an empty Write chunk in that Write list position.

   o  If there are more READ operations than Write chunks, then
      remaining NFS READ operations in an NFS version 4 COMPOUND that
      have no matching Write chunk MUST return their results inline.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.2.%20%20Chunk%20List%20Complexity"></a><a class="selflink" href="#section-6.4.2" name="section-6.4.2">6.4.2</a>.  Chunk List Complexity</span>

   The RPC-over-RDMA version 1 protocol does not place any limit on the
   number of chunks or segments that may appear in Read or Write lists.
   However, for various reasons, NFS version 4 server implementations
   often have practical limits on the number of chunks or segments they
   are prepared to process in a single RPC transaction conveyed via
   RPC-over-RDMA version 1.

   These implementation limits are especially important when Kerberos
   integrity or privacy is in use [<a href="rfc7861.html" title='"Remote Procedure Call (RPC) Security Version 3"'>RFC7861</a>].  Generic Security Service
   (GSS) services increase the size of credential material in RPC
   headers, potentially requiring more frequent use of Long messages.
   This can increase the complexity of chunk lists independent of the
   NFS version 4 COMPOUND being conveyed.

   In the absence of explicit knowledge of the server's limits, NFS
   version 4 clients SHOULD follow the prescriptions listed below when
   constructing RPC-over-RDMA version 1 messages.  NFS version 4 servers
   MUST accept and process such requests.

   o  The Read list can contain either a Position Zero Read chunk, one
      Read chunk with a non-zero Position, or both.

   o  The Write list can contain no more than one Write chunk.

   o  Any chunk can contain up to sixteen RDMA segments.







<span class="grey">Lever                        Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   NFS version 4 clients wishing to send more complex chunk lists can
   provide configuration interfaces to bound the complexity of NFS
   version 4 COMPOUNDs, limit the number of elements in scatter-gather
   operations, and avoid other sources of chunk overruns at the
   receiving peer.

   An NFS version 4 server SHOULD return one of the following responses
   to a client that has sent an RPC transaction via RPC-over-RDMA
   version 1, which cannot be processed due to chunk list complexity
   limits on the server:

   o  A problem is detected by the transport layer while parsing the
      transport header in an RPC Call message.  The server responds with
      an RDMA_ERROR message with the err field set to ERR_CHUNK.

   o  A problem is detected during XDR decoding of the RPC Call message
      while the RPC layer reassembles the call's XDR stream.  The server
      responds with an RPC Reply with its "reply_stat" field set to
      MSG_ACCEPTED and its "accept_stat" field set to GARBAGE_ARGS.

   After receiving one of these errors, an NFS version 4 client SHOULD
   NOT retransmit the failing request, as the result would be the same
   error.  It SHOULD immediately terminate the RPC transaction
   associated with the XID in the RPC Reply.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.4.3.%20%20NFS%20Version%204%20COMPOUND%20Example"></a><a class="selflink" href="#section-6.4.3" name="section-6.4.3">6.4.3</a>.  NFS Version 4 COMPOUND Example</span>

   The following example shows a Write list with three Write chunks: A,
   B, and C.  The NFS version 4 server consumes the provided Write
   chunks by writing the results of the designated operations in the
   COMPOUND request (READ and READLINK) back to each chunk.

      Write list:

         A --&gt; B --&gt; C

      NFS version 4 COMPOUND request:

         PUTFH LOOKUP READ PUTFH LOOKUP READLINK PUTFH LOOKUP READ
                       |                   |                   |
                       v                   v                   v
                       A                   B                   C

   If the NFS version 4 client does not want to have the READLINK result
   returned via RDMA, it provides an empty Write chunk for buffer B to
   indicate that the READLINK result must be returned inline.





<span class="grey">Lever                        Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20NFS%20Callback%20Requests"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  NFS Callback Requests</span>

   The NFS version 4 family of protocols support server-initiated
   callbacks to notify NFS version 4 clients of events such as recalled
   delegations.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.5.1.%20%20NFS%20Version%204.0%20Callback"></a><a class="selflink" href="#section-6.5.1" name="section-6.5.1">6.5.1</a>.  NFS Version 4.0 Callback</span>

   NFS version 4.0 implementations typically employ a separate TCP
   connection to handle callback operations, even when the forward
   channel uses an RPC-over-RDMA version 1 transport.

   No operation in the NFS version 4.0 callback RPC program conveys a
   significant data payload.  Therefore, no XDR data items in this RPC
   program are DDP-eligible.

   A CB_RECALL Reply is small and fixed in size.  The CB_GETATTR Reply
   contains a variable-length fattr4 data item.  See <a href="#section-6.2.1">Section 6.2.1</a> for a
   discussion of reply size prediction for this data item.

   An NFS version 4.0 client advertises netids and ad hoc port addresses
   for contacting its NFS version 4.0 callback service using the
   SETCLIENTID operation.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.5.2.%20%20NFS%20Version%204.1%20Callback"></a><a class="selflink" href="#section-6.5.2" name="section-6.5.2">6.5.2</a>.  NFS Version 4.1 Callback</span>

   In NFS version 4.1 and newer minor versions, callback operations may
   appear on the same connection as is used for NFS version 4 forward
   channel client requests.  NFS version 4 clients and servers MUST use
   the approach described in [<a href="rfc8167.html" title='"Bidirectional Remote Procedure Call on RPC- over-RDMA Transports"'>RFC8167</a>] when backchannel operations are
   conveyed on RPC-over-RDMA version 1 transports.

   The csa_back_chan_attrs argument of the CREATE_SESSION operation
   contains a ca_maxresponsesize field.  The value in this field can be
   taken as the absolute maximum size of backchannel replies generated
   by a replying NFS version 4 client.

   There are no DDP-eligible data items in callback procedures defined
   in NFS versions 4.1 or 4.2.  However, some callback operations (such
   as messages that convey device ID information) can be large, in which
   case, a Long Call or Reply might be required.

   When an NFS version 4.1 client can support Long Calls in its
   backchannel, it reports a backchannel ca_maxrequestsize that is
   larger than the connection's inline thresholds.  Otherwise, an NFS
   version 4 server MUST use only Short messages to convey backchannel
   operations.




<span class="grey">Lever                        Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.6.%20%20Session-Related%20Considerations"></a><a class="selflink" href="#section-6.6" name="section-6.6">6.6</a>.  Session-Related Considerations</span>

   The presence of an NFS session (defined in [<a href="rfc5661.html" title='"Network File System (NFS) Version 4 Minor Version 1 Protocol"'>RFC5661</a>]) has no effect
   on the operation of RPC-over-RDMA version 1.  None of the operations
   introduced to support NFS sessions (e.g., the SEQUENCE operation)
   contain DDP-eligible data items.  There is no need to match the
   number of session slots with the number of available RPC-over-RDMA
   credits.

   However, there are a few new cases where an RPC transaction can fail.
   For example, in response to an RPC request, a requester might receive
   an RDMA_ERROR message with an rdma_err value of ERR_CHUNK.  These
   situations are not different from existing RPC errors, which an NFS
   session implementation is already prepared to handle for other
   transports.  And as with other transports during such a failure,
   there might be no SEQUENCE result available to the requester to
   distinguish whether failure occurred before or after the requested
   operations were executed on the responder.

   When a transport error occurs (e.g., RDMA_ERROR), the requester
   proceeds as usual to match the incoming XID value to a waiting RPC
   Call.  The RPC transaction is terminated, and the result status is
   reported to the upper-layer protocol.  The requester's session
   implementation then determines the session ID and slot for the failed
   request and performs slot recovery to make that slot usable again.
   If this were not done, that slot could be rendered permanently
   unavailable.

   When an NFS session is not present (for example, when NFS version 4.0
   is in use), a transport error does not provide an indication of
   whether the server has processed the arguments of the RPC Call or
   whether the server has accessed or modified client memory associated
   with that RPC.


















<span class="grey">Lever                        Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.7.%20%20Transport%20Considerations"></a><a class="selflink" href="#section-6.7" name="section-6.7">6.7</a>.  Transport Considerations</span>

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.7.1.%20%20Congestion%20Avoidance"></a><a class="selflink" href="#section-6.7.1" name="section-6.7.1">6.7.1</a>.  Congestion Avoidance</span>

   <a href="rfc7530.html#section-3.1">Section 3.1 of [RFC7530]</a> states:

      Where an NFSv4 implementation supports operation over the IP
      network protocol, the supported transport layer between NFS and IP
      MUST be an IETF standardized transport protocol that is specified
      to avoid network congestion; such transports include TCP and the
      Stream Control Transmission Protocol (SCTP).

   <a href="rfc5661.html#section-2.9.1">Section 2.9.1 of [RFC5661]</a> also states:

      Even if NFSv4.1 is used over a non-IP network protocol, it is
      RECOMMENDED that the transport support congestion control.

      It is permissible for a connectionless transport to be used under
      NFSv4.1; however, reliable and in-order delivery of data combined
      with congestion control by the connectionless transport is
      REQUIRED.  As a consequence, UDP by itself MUST NOT be used as an
      NFSv4.1 transport.

   RPC-over-RDMA version 1 is constructed on a platform of RDMA Reliable
   Connections [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>] [<a href="rfc5041.html" title='"Direct Data Placement over Reliable Transports"'>RFC5041</a>].  RDMA Reliable Connections are
   reliable, connection-oriented transports that guarantee in-order
   delivery, thus meeting all above requirements for NFS version 4
   transports.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.7.2.%20%20Retransmission%20and%20Keep-Alive"></a><a class="selflink" href="#section-6.7.2" name="section-6.7.2">6.7.2</a>.  Retransmission and Keep-Alive</span>

   NFS version 4 client implementations often rely on a transport-layer
   keep-alive mechanism to detect when an NFS version 4 server has
   become unresponsive.  When an NFS server is no longer responsive,
   client-side keep-alive terminates the connection, which in turn
   triggers reconnection and RPC retransmission.

   Some RDMA transports (such as Reliable Connections on InfiniBand)
   have no keep-alive mechanism.  Without a disconnect or new RPC
   traffic, such connections can remain alive long after an NFS server
   has become unresponsive.  Once an NFS client has consumed all
   available RPC-over-RDMA credits on that transport connection, it will
   forever await a Reply before sending another RPC request.








<span class="grey">Lever                        Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   NFS version 4 clients SHOULD reserve one RPC-over-RDMA credit to use
   for a periodic server or connection health assessment.  This credit
   can be used to drive an RPC request on an otherwise idle connection,
   triggering either a quick affirmative server response or immediate
   connection termination.

   In addition to network partition and request loss scenarios,
   RPC-over-RDMA transport connections can be terminated when a
   Transport header is malformed, Reply messages are larger than receive
   resources, or when too many RPC-over-RDMA messages are sent at once.
   In such cases:

   o  If there is a transport error indicated (i.e., RDMA_ERROR) before
      the disconnect or instead of a disconnect, the requester MUST
      respond to that error as prescribed by the specification of the
      RPC transport.  Then, the NFS version 4 rules for handling
      retransmission apply.

   o  If there is a transport disconnect and the responder has provided
      no other response for a request, then only the NFS version 4 rules
      for handling retransmission apply.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Extending%20NFS%20Upper-Layer%20Bindings"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Extending NFS Upper-Layer Bindings</span>

   RPC programs such as NFS are required to have an Upper-Layer Binding
   specification to interoperate on RPC-over-RDMA version 1 transports
   [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>].  Via IETF standards action, the Upper-Layer Binding
   specified in this document can be extended to cover (a) versions of
   the NFS version 4 protocol specified after NFS version 4 minor
   version 2 or (b) separately published extensions to an existing NFS
   version 4 minor version, as described in [<a href="rfc8178.html" title='"Rules for NFSv4 Extensions and Minor Versions"'>RFC8178</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Security Considerations</span>

   RPC-over-RDMA version 1 supports all RPC security models, including
   RPCSEC_GSS security and transport-level security [<a href="rfc7861.html" title='"Remote Procedure Call (RPC) Security Version 3"'>RFC7861</a>].  The
   choice of what Direct Data Placement mechanism to convey RPC argument
   and results does not affect this, since it changes only the method of
   data transfer.  Because this document defines only the binding of the
   NFS protocols atop [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>], all relevant security considerations
   are, therefore, to be described at that layer.










<span class="grey">Lever                        Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  IANA Considerations</span>

   The use of Direct Data Placement in NFS introduces a need for an
   additional port number assignment for networks that share traditional
   UDP and TCP port spaces with RDMA services.  The iWARP protocol is
   such an example [<a href="rfc5041.html" title='"Direct Data Placement over Reliable Transports"'>RFC5041</a>] [<a href="rfc5040.html" title='"A Remote Direct Memory Access Protocol Specification"'>RFC5040</a>].

   For this purpose, a set of transport protocol port number assignments
   is specified by this document.  IANA has assigned the following ports
   for NFS/RDMA in the IANA port registry, according to the guidelines
   described in [<a href="rfc6335.html" title='"Internet Assigned Numbers Authority (IANA) Procedures for the Management of the Service Name and Transport Protocol Port Number Registry"'>RFC6335</a>].

     nfsrdma 20049 tcp  Network File System (NFS) over RDMA
     nfsrdma 20049 udp  Network File System (NFS) over RDMA
     nfsrdma 20049 sctp Network File System (NFS) over RDMA

   This document is listed as the reference for the nfsrdma port
   assignments.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC1833" name="ref-RFC1833">RFC1833</a>]  Srinivasan, R., "Binding Protocols for ONC RPC Version 2",
              <a href="rfc1833.html">RFC 1833</a>, DOI 10.17487/RFC1833, August 1995,
              &lt;<a href="https://www.rfc-editor.org/info/rfc1833">https://www.rfc-editor.org/info/rfc1833</a>&gt;.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5661" name="ref-RFC5661">RFC5661</a>]  Shepler, S., Ed., Eisler, M., Ed., and D. Noveck, Ed.,
              "Network File System (NFS) Version 4 Minor Version 1
              Protocol", <a href="rfc5661.html">RFC 5661</a>, DOI 10.17487/RFC5661, January 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5661">https://www.rfc-editor.org/info/rfc5661</a>&gt;.

   [<a id="ref-RFC6335" name="ref-RFC6335">RFC6335</a>]  Cotton, M., Eggert, L., Touch, J., Westerlund, M., and S.
              Cheshire, "Internet Assigned Numbers Authority (IANA)
              Procedures for the Management of the Service Name and
              Transport Protocol Port Number Registry", <a href="https://tools.ietf.org/html/bcp165">BCP 165</a>,
              <a href="rfc6335.html">RFC 6335</a>, DOI 10.17487/RFC6335, August 2011,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6335">https://www.rfc-editor.org/info/rfc6335</a>&gt;.








<span class="grey">Lever                        Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   [<a id="ref-RFC7530" name="ref-RFC7530">RFC7530</a>]  Haynes, T., Ed. and D. Noveck, Ed., "Network File System
              (NFS) Version 4 Protocol", <a href="rfc7530.html">RFC 7530</a>, DOI 10.17487/RFC7530,
              March 2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7530">https://www.rfc-editor.org/info/rfc7530</a>&gt;.

   [<a id="ref-RFC7861" name="ref-RFC7861">RFC7861</a>]  Adamson, A. and N. Williams, "Remote Procedure Call (RPC)
              Security Version 3", <a href="rfc7861.html">RFC 7861</a>, DOI 10.17487/RFC7861,
              November 2016, &lt;<a href="https://www.rfc-editor.org/info/rfc7861">https://www.rfc-editor.org/info/rfc7861</a>&gt;.

   [<a id="ref-RFC7862" name="ref-RFC7862">RFC7862</a>]  Haynes, T., "Network File System (NFS) Version 4 Minor
              Version 2 Protocol", <a href="rfc7862.html">RFC 7862</a>, DOI 10.17487/RFC7862,
              November 2016, &lt;<a href="https://www.rfc-editor.org/info/rfc7862">https://www.rfc-editor.org/info/rfc7862</a>&gt;.

   [<a id="ref-RFC8166" name="ref-RFC8166">RFC8166</a>]  Lever, C., Ed., Simpson, W., and T. Talpey, "Remote Direct
              Memory Access Transport for Remote Procedure Call Version
              1", <a href="rfc8166.html">RFC 8166</a>, DOI 10.17487/RFC8166, June 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8166">https://www.rfc-editor.org/info/rfc8166</a>&gt;.

   [<a id="ref-RFC8167" name="ref-RFC8167">RFC8167</a>]  Lever, C., "Bidirectional Remote Procedure Call on RPC-
              over-RDMA Transports", <a href="rfc8167.html">RFC 8167</a>, DOI 10.17487/RFC8167,
              June 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8167">https://www.rfc-editor.org/info/rfc8167</a>&gt;.

   [<a id="ref-RFC8174" name="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="rfc2119.html">RFC</a>
              <a href="rfc2119.html">2119</a> Key Words", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc8174.html">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-RFC1094" name="ref-RFC1094">RFC1094</a>]  Nowicki, B., "NFS: Network File System Protocol
              specification", <a href="rfc1094.html">RFC 1094</a>, DOI 10.17487/RFC1094, March
              1989, &lt;<a href="https://www.rfc-editor.org/info/rfc1094">https://www.rfc-editor.org/info/rfc1094</a>&gt;.

   [<a id="ref-RFC1813" name="ref-RFC1813">RFC1813</a>]  Callaghan, B., Pawlowski, B., and P. Staubach, "NFS
              Version 3 Protocol Specification", <a href="rfc1813.html">RFC 1813</a>,
              DOI 10.17487/RFC1813, June 1995,
              &lt;<a href="https://www.rfc-editor.org/info/rfc1813">https://www.rfc-editor.org/info/rfc1813</a>&gt;.

   [<a id="ref-RFC5040" name="ref-RFC5040">RFC5040</a>]  Recio, R., Metzler, B., Culley, P., Hilland, J., and D.
              Garcia, "A Remote Direct Memory Access Protocol
              Specification", <a href="rfc5040.html">RFC 5040</a>, DOI 10.17487/RFC5040, October
              2007, &lt;<a href="https://www.rfc-editor.org/info/rfc5040">https://www.rfc-editor.org/info/rfc5040</a>&gt;.

   [<a id="ref-RFC5041" name="ref-RFC5041">RFC5041</a>]  Shah, H., Pinkerton, J., Recio, R., and P. Culley, "Direct
              Data Placement over Reliable Transports", <a href="rfc5041.html">RFC 5041</a>,
              DOI 10.17487/RFC5041, October 2007,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5041">https://www.rfc-editor.org/info/rfc5041</a>&gt;.






<span class="grey">Lever                        Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   [<a id="ref-RFC5666" name="ref-RFC5666">RFC5666</a>]  Talpey, T. and B. Callaghan, "Remote Direct Memory Access
              Transport for Remote Procedure Call", <a href="rfc5666.html">RFC 5666</a>,
              DOI 10.17487/RFC5666, January 2010,
              &lt;<a href="https://www.rfc-editor.org/info/rfc5666">https://www.rfc-editor.org/info/rfc5666</a>&gt;.

   [<a id="ref-RFC5667" name="ref-RFC5667">RFC5667</a>]  Talpey, T. and B. Callaghan, "Network File System (NFS)
              Direct Data Placement", <a href="rfc5667.html">RFC 5667</a>, DOI 10.17487/RFC5667,
              January 2010, &lt;<a href="https://www.rfc-editor.org/info/rfc5667">https://www.rfc-editor.org/info/rfc5667</a>&gt;.

   [<a id="ref-RFC8178" name="ref-RFC8178">RFC8178</a>]  Noveck, D., "Rules for NFSv4 Extensions and Minor
              Versions", <a href="rfc8178.html">RFC 8178</a>, DOI 10.17487/RFC8178, July 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8178">https://www.rfc-editor.org/info/rfc8178</a>&gt;.

   [<a id="ref-XNFS" name="ref-XNFS">XNFS</a>]     The Open Group, "Protocols for Interworking: XNFS, Version
              3W", Document Number C702, ISBN 1-85912-184-5, February
              1998.



































<span class="grey">Lever                        Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Changes%20Since%20RFC%205667"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Changes Since <a href="rfc5667.html">RFC 5667</a></span>

   Corrections and updates made necessary by new language in [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>]
   have been introduced.  For example, references to deprecated features
   of RPC-over-RDMA version 1 (such as RDMA_MSGP) and the use of the
   Read list for handling RPC Replies have been removed.  The term
   "mapping" has been replaced with the term "binding" or "Upper-Layer
   Binding" throughout the document.  Material that duplicates what is
   in [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>] has been deleted.

   Material required by [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>] for Upper-Layer Bindings that was not
   present in [<a href="rfc5667.html" title='"Network File System (NFS) Direct Data Placement"'>RFC5667</a>] has been added.  A complete discussion of reply
   size estimation has been introduced for all protocols covered by the
   Upper-Layer Bindings in this document.

   Technical corrections have been made.  For example, the mention of
   12KB and 36KB inline thresholds has been removed.  The reference to a
   nonexistent NFS version 4 SYMLINK operation has been replaced.

   The discussion of NFS version 4 COMPOUND handling has been completed.
   Some changes were made to the algorithm for matching DDP-eligible
   results to Write chunks.

   Requirements to ignore extra Read or Write chunks have been removed
   from the NFS versions 2 and 3 Upper-Layer Binding, as they conflict
   with [<a href="rfc8166.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call Version 1"'>RFC8166</a>].

   A section discussing NFS version 4 retransmission and connection loss
   has been added.

   The following additional improvements have been made, relative to
   [<a href="rfc5667.html" title='"Network File System (NFS) Direct Data Placement"'>RFC5667</a>]:

   o  An explicit discussion of NFS versions 4.0 and 4.1 backchannel
      operation have replaced the previous treatment of callback
      operations.

   o  A section describing considerations when an NFS session is in use
      has been added.

   o  An Upper-Layer Binding for NFS version 4.2 has been added.

   o  A section suggesting a mechanism for periodically assessing
      connection health has been introduced.

   o  Ambiguous or erroneous uses of key words from <a href="rfc2119.html">RFC 2119</a> have been
      corrected.




<span class="grey">Lever                        Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc8267.html">RFC 8267</a>             NFS on RPC-over-RDMA Version 1         October 2017</span>


   o  References to obsolete RFCs have been updated.

   o  An IANA Considerations section has been added, which specifies the
      port assignments for NFS/RDMA.  This replaces the example
      assignment that appeared in [<a href="rfc5666.html" title='"Remote Direct Memory Access Transport for Remote Procedure Call"'>RFC5666</a>].

   o  Code excerpts have been removed, and figures have been modernized.

Acknowledgments

   The author gratefully acknowledges the work of Brent Callaghan and
   Tom Talpey on the original NFS Direct Data Placement specification
   [<a href="rfc5667.html" title='"Network File System (NFS) Direct Data Placement"'>RFC5667</a>].  Tom contributed the text of <a href="#section-6.4.2">Section 6.4.2</a>.

   Dave Noveck provided an excellent review, constructive suggestions,
   and consistent navigational guidance throughout the process of
   drafting this document.  Dave contributed the text of Sections <a href="#section-6.6">6.6</a>
   and 7 and insisted on precise discussion of reply size estimation.

   Thanks to Karen Deitke for her sharp observations about idempotency,
   NFS COMPOUNDs, and NFS sessions.

   Special thanks go to Transport Area Director Spencer Dawkins, NFSV4
   Working Group Chair and Document Shepherd Spencer Shepler, and NFSV4
   Working Group Secretary Thomas Haynes for their support.  The author
   also wishes to thank Bill Baker and Greg Marsden for their support of
   this work.

Author's Address

   Charles Lever
   Oracle Corporation
   1015 Granger Avenue
   Ann Arbor, MI  48104
   United States of America

   Phone: +1 248 816 6463
   Email: chuck.lever@oracle.com













Lever                        Standards Track                   [Page 21]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc8267 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --></html>