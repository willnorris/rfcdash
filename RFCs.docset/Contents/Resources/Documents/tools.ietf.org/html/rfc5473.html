<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5473 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:41:47 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.119" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-boschi-ipfix-reducing-redundancy" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:5473" name="DC.Identifier"/>
<meta content="March, 2009" name="DC.Date.Issued"/>
<meta content="Elisa Boschi &lt;elisa.boschi@hitachi-eu.com&gt;" name="DC.Creator"/>
<meta content="This document describes a bandwidth saving method for exporting Flow
or packet information using the IP Flow Information eXport (IPFIX)
protocol. As the Packet Sampling (PSAMP) protocol is based on IPFIX,
these considerations are valid for PSAMP exports as well.  This method
works by separating information common to several Flow Records from
information specific to an individual Flow Record. Common Flow
information is exported only once in a Data Record defined by an
Options Template, while the rest of the specific Flow information is
associated with the common information via a unique identifier. This
memo provides information for the Internet community." name="DC.Description.Abstract"/>
<meta content="Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5473 - Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5473.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5473" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ipfix-reducing-redundancy" title="draft-ietf-ipfix-reducing-redundancy">draft-ietf-ipfix-...</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5473" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5473" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=5473">Errata</a>]        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                          E. Boschi
Request for Comments: 5473                                Hitachi Europe
Category: Informational                                          L. Mark
                                                         Fraunhofer IFAM
                                                               B. Claise
                                                     Cisco Systems, Inc.
                                                              March 2009


       <span class="h1">Reducing Redundancy in IP Flow Information Export (IPFIX)</span>
                  <span class="h1">and Packet Sampling (PSAMP) Reports</span>

Status of This Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents in effect on the date of
   publication of this document (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>).
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Abstract

   This document describes a bandwidth saving method for exporting Flow
   or packet information using the IP Flow Information eXport (IPFIX)
   protocol.  As the Packet Sampling (PSAMP) protocol is based on IPFIX,
   these considerations are valid for PSAMP exports as well.




<span class="grey">Boschi, et al.               Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   This method works by separating information common to several Flow
   Records from information specific to an individual Flow Record.
   Common Flow information is exported only once in a Data Record
   defined by an Options Template, while the rest of the specific Flow
   information is associated with the common information via a unique
   identifier.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. IPFIX Documents Overview ...................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. PSAMP Documents Overview ...................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Terminology .....................................................<a href="#page-4">4</a>
      <a href="#section-2.1">2.1</a>. Terminology Summary Table ..................................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. IPFIX Flows versus PSAMP Packets ...........................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Specifications for Bandwidth-Saving Information Export ..........<a href="#page-5">5</a>
      <a href="#section-3.1">3.1</a>. Problem Statement and High-Level Solution ..................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. Data Reduction Technique ...................................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Transport Protocol Choice .......................................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. PR-SCTP ....................................................<a href="#page-9">9</a>
      <a href="#section-4.2">4.2</a>. UDP ........................................................<a href="#page-9">9</a>
      <a href="#section-4.3">4.3</a>. TCP ........................................................<a href="#page-9">9</a>
   <a href="#section-5">5</a>. commonPropertiesID Management ...................................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. The Collecting Process Side ....................................<a href="#page-10">10</a>
      <a href="#section-6.1">6.1</a>. UDP .......................................................<a href="#page-11">11</a>
      <a href="#section-6.2">6.2</a>. TCP .......................................................<a href="#page-12">12</a>
   <a href="#section-7">7</a>. Advanced Techniques ............................................<a href="#page-12">12</a>
      <a href="#section-7.1">7.1</a>. Multiple Data Reduction ...................................<a href="#page-12">12</a>
      <a href="#section-7.2">7.2</a>. Cascading Common Properties ...............................<a href="#page-15">15</a>
   <a href="#section-8">8</a>. Export and Evaluation Considerations ...........................<a href="#page-15">15</a>
      <a href="#section-8.1">8.1</a>. Transport Protocol Choice .................................<a href="#page-16">16</a>
      <a href="#section-8.2">8.2</a>. Reduced Size Encoding .....................................<a href="#page-16">16</a>
      <a href="#section-8.3">8.3</a>. Efficiency Gain ...........................................<a href="#page-16">16</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-17">17</a>
   <a href="#section-10">10</a>. Acknowledgments ...............................................<a href="#page-17">17</a>
   <a href="#section-11">11</a>. References ....................................................<a href="#page-17">17</a>
      <a href="#section-11.1">11.1</a>. Normative References .....................................<a href="#page-17">17</a>
      <a href="#section-11.2">11.2</a>. Informative References ...................................<a href="#page-18">18</a>
   <a href="#appendix-A">Appendix A</a>. Examples ..............................................<a href="#page-19">19</a>
      <a href="#appendix-A.1">A.1</a>. Per-Flow Data Reduction ...................................<a href="#page-19">19</a>
      <a href="#appendix-A.2">A.2</a>. Per-Packet Data Reduction .................................<a href="#page-23">23</a>
      <a href="#appendix-A.3">A.3</a>. Common Properties Withdrawal Message ......................<a href="#page-26">26</a>









<span class="grey">Boschi, et al.               Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The IPFIX working group has specified a protocol to export IP Flow
   information [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].  This protocol is designed to export
   information about IP traffic Flows and related measurement data,
   where a Flow is defined by a set of key attributes (e.g., source and
   destination IP address, source and destination port, etc.).  However,
   thanks to its template mechanism, the IPFIX protocol can export any
   type of information, as long as the Information Element is specified
   in the IPFIX information model [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] or registered with IANA.

   Regardless of the fields' contents, Flow Records with common
   properties export the same fields in every single Data Record.  These
   common properties may represent values common to a collection of
   Flows or packets, or values that are invariant over time.  Note that
   the common properties don't represent the list of Flow Keys, which
   are used to define a Flow definition; however, the common properties
   may contain some of the Flow Keys.  The reduction of redundant data
   from the export stream can result in a significant reduction of the
   transferred data.

   This document specifies a way to export these invariant or common
   properties only once, while the rest of the Flow-specific properties
   are exported in regular Data Records.  Unique common properties
   identifiers are used to link Data Records and the common attributes.

   The proposed method is applicable to IPFIX Flow and to PSAMP per-
   packet information, without any changes to both the IPFIX and PSAMP
   protocol specifications.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20IPFIX%20Documents%20Overview"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  IPFIX Documents Overview</span>

   The IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] provides network administrators with
   access to IP Flow information.  The architecture for the export of
   measured IP Flow information out of an IPFIX exporting process to a
   collecting process is defined in the IPFIX Architecture [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>],
   per the requirements defined in <a href="rfc3917.html">RFC 3917</a> [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].  The IPFIX
   Architecture [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>] specifies how IPFIX Data Records and templates
   are carried via a congestion-aware transport protocol from IPFIX
   exporting processes to IPFIX collecting processes.  IPFIX has a
   formal description of IPFIX Information Elements, their names, types,
   and additional semantic information, as specified in the IPFIX
   information model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  Finally, the IPFIX applicability
   statement [<a href="rfc5472.html" title='"IP Flow Information Export (IPFIX) Applicability"'>RFC5472</a>] describes what type of applications can use the
   IPFIX protocol and how they can use the information provided.  It
   furthermore shows how the IPFIX framework relates to other
   architectures and frameworks.




<span class="grey">Boschi, et al.               Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20PSAMP%20Documents%20Overview"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  PSAMP Documents Overview</span>

   The document "A Framework for Packet Selection and Reporting"
   [<a href="rfc5474.html" title='"A Framework for Packet Selection and Reporting"'>RFC5474</a>] describes the PSAMP framework for network elements to
   select subsets of packets by statistical and other methods, and to
   export a stream of reports on the selected packets to a collector.
   The set of packet selection techniques (sampling, filtering, and
   hashing) supported by PSAMP is described in "Sampling and Filtering
   Techniques for IP Packet Selection" [<a href="rfc5475.html" title='"Sampling and Filtering Techniques for IP Packet Selection"'>RFC5475</a>].  The PSAMP protocol
   [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>] specifies the export of packet information from a PSAMP
   exporting process to a PSAMP collecting process.  Like IPFIX, PSAMP
   has a formal description of its Information Elements, their names,
   types, and additional semantic information.  The PSAMP information
   model is defined in [<a href="rfc5477.html" title='"Information Model for Packet Sampling Exports"'>RFC5477</a>].  Finally, [<a href="#ref-PSAMP-MIB" title='"Definitions of Managed Objects for Packet Sampling"'>PSAMP-MIB</a>] describes the
   PSAMP Management Information Base.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   IPFIX-specific terminology used in this document is defined in
   <a href="#section-2">Section 2</a> of the IPFIX protocol specification [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] and <a href="#section-3">Section 3</a>
   of the PSAMP protocol specification [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>].  As in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] and
   [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>], these IPFIX-specific terms have the first letter of a word
   capitalized when used in this document.

   In addition, the following new terms are defined in this document:

   commonPropertiesID:  The commonPropertiesID is an identifier of a set
      of common properties that is locally unique per Observation Domain
      and Transport Session.  Typically, this Information Element is
      used to link to information reported in separate Data Records.
      See the IPFIX information model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>] for the Information
      Element definition.

   Common Properties:  Common Properties are a collection of one or more
      attributes shared by a set of different Flow Records.  Each set of
      Common Properties is uniquely identifiable by means of a
      commonPropertiesID.

   Specific Properties:  Specific Properties are a collection of one or
      more attributes reported in a Flow Record that are not included in
      the Common Properties defined for that Flow Record.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].






<span class="grey">Boschi, et al.               Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Terminology%20Summary%20Table"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Terminology Summary Table</span>

   +------------------+---------------------------------------------+
   |                  |                 Contents                    |
   |                  +--------------------+------------------------+
   |       Set        |      Template      |         Record         |
   +------------------+--------------------+------------------------+
   |     Data Set     |          /         |     Data Record(s)     |
   +------------------+--------------------+------------------------+
   |   Template Set   | Template Record(s) |           /            |
   +------------------+--------------------+------------------------+
   | Options Template | Options Template   |           /            |
   |       Set        | Record(s)          |                        |
   +------------------+--------------------+------------------------+

                         Terminology Summary Table

   A Data Set is composed of Data Record(s).  No Template Record is
   included.  A Template Record or an Options Template Record defines
   the Data Record.

   A Template Set contains only Template Record(s).

   An Options Template Set contains only Options Template Record(s).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20IPFIX%20Flows%20versus%20PSAMP%20Packets"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  IPFIX Flows versus PSAMP Packets</span>

   As described in the PSAMP protocol specification [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>], the major
   difference between IPFIX and PSAMP is that the IPFIX protocol exports
   Flow Records while the PSAMP protocol exports Packet Records.  From a
   pure export point of view, IPFIX will not distinguish a Flow Record
   composed of several packets aggregated together from a Flow Record
   composed of a single packet.  So, the PSAMP export can be seen as a
   special IPFIX Flow Record containing information about a single
   packet.

   For this document's clarity, the term Flow Record represents a
   generic term expressing an IPFIX Flow Record or a PSAMP Packet
   Record, as foreseen by its definition.  However, when appropriate, a
   clear distinction between Flow Record or Packet Record will be made.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Specifications%20for%20Bandwidth-Saving%20Information%20Export"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Specifications for Bandwidth-Saving Information Export</span>

   Several Flow Records often share a set of Common Properties.
   Repeating the information about these Common Properties for every
   Flow Record introduces a huge amount of redundancy.  This document
   proposes a method to reduce this redundancy.




<span class="grey">Boschi, et al.               Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   The PSAMP specifications are used for the export of per-packet
   information, exporting the specific observed packet in an IPFIX Flow
   Record.  This can be considered as a special Flow Record case,
   composed of a single packet.  Therefore, the method described in this
   document is also applicable to per-packet data reduction, e.g., for
   export of One-Way Delay (OWD) measurements (see Appendix), trajectory
   sampling, etc.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Problem%20Statement%20and%20High-Level%20Solution"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Problem Statement and High-Level Solution</span>

   Consider a set of properties "A", e.g., common sourceAddressA and
   sourcePortA, equivalent for each Flow Record exported.  Figure 1
   shows how this information is repeated with classical IPFIX Flow
   Records, expressing the waste of bandwidth to export redundant
   information.

   +----------------+-------------+---------------------------+
   | sourceAddressA | sourcePortA |     &lt;Flow1 information&gt;   |
   +----------------+-------------+---------------------------+
   | sourceAddressA | sourcePortA |     &lt;Flow2 information&gt;   |
   +----------------+-------------+---------------------------+
   | sourceAddressA | sourcePortA |     &lt;Flow3 information&gt;   |
   +----------------+-------------+---------------------------+
   | sourceAddressA | sourcePortA |     &lt;Flow4 information&gt;   |
   +----------------+-------------+---------------------------+
   |      ...       |     ...     |            ...            |
   +----------------+-------------+---------------------------+

        Figure 1: Common and Specific Properties Exported Together

   Figure 2 shows how this information is exported when applying the
   specifications of this document.  The Common Properties are separated
   from the Specific Properties for each Flow Record.  The Common
   Properties would be exported only once in a specific Data Record
   (defined by an Options Template), while each Flow Record contains a
   pointer to the Common Properties A, along with its Flow-specific
   information.  In order to maintain the relationship between these
   sets of properties, we introduce indices (in this case, the index for
   properties A) for the Common Properties that are unique for all
   Common Properties entries within an Observation Domain.  The purpose
   of the indices is to serve as a "key" identifying "rows" of the
   Common Properties table.  The rows are then referenced by the
   Specific Properties by using the appropriate value for the Common
   Properties identifier.







<span class="grey">Boschi, et al.               Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   +------------------------+-----------------+-------------+
   | index for properties A | sourceAddressA  | sourcePortA |
   +------------------------+-----------------+-------------+
   |          ...           |      ...        |     ...     |
   +------------------------+-----------------+-------------+


   +------------------------+---------------------------+
   | index for properties A |     &lt;Flow1 information&gt;   |
   +------------------------+---------------------------+
   | index for properties A |     &lt;Flow2 information&gt;   |
   +------------------------+---------------------------+
   | index for properties A |     &lt;Flow3 information&gt;   |
   +------------------------+---------------------------+
   | index for properties A |     &lt;Flow4 information&gt;   |
   +------------------------+---------------------------+

       Figure 2: Common and Specific Properties Exported Separately

   This unique export of the Common Properties results in a decrease of
   the bandwidth requirements for the path between the Exporter and the
   Collector.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Data%20Reduction%20Technique"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Data Reduction Technique</span>

   The IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] is Template based.  Templates define how
   data should be exported, describing data fields together with their
   type and meaning.  IPFIX specifies two types of Templates: the
   Template Record and the Options Template Record.  The difference
   between the two is that the Options Template Record includes the
   notion of scope, defining how to scope the applicability of the Data
   Record.  The scope, which is only available in the Options Template
   Record, gives the context of the reported Information Elements in the
   Data Records.  The Template Records and Options Template Records are
   necessary to decode the Data Records.  Indeed, by only looking at the
   Data Records themselves, it is impossible to distinguish a Data
   Record defined by Template Record from a Data Record defined by an
   Options Template Record.  To export information more efficiently,
   this specification proposes to group Flow Records by their common
   properties.  We define Common Properties as a collection of
   attributes shared by a set of different Flow Records.

   An implementation using the proposed specification MUST follow the
   IPFIX transport protocol specifications defined in the IPFIX protocol
   [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].






<span class="grey">Boschi, et al.               Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   As explained in Figure 3, the information is split into two parts,
   using two different Data Records.  Common Properties MUST be exported
   via Data Records defined by an Options Template Record.  Like
   Template Records, they MUST be sent only once per SCTP association or
   TCP connection, and MUST be sent reliably via SCTP if SCTP is the
   transport protocol.  These properties represent values common to
   several Flow Records (e.g., IP source and destination address).  The
   Common Properties Data Records MUST be sent prior to the
   corresponding Specific Properties Data Records.  The Data Records
   reporting Specific Properties MUST be associated with the Data
   Records reporting the Common Properties using a unique identifier for
   the Common Properties, the commonPropertiesID Information Element
   [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  The commonPropertiesID Information Element MUST be
   included in the scope of the Options Template Record, and also
   included in the associated Template Record.

   +---------------------------+     +---------------------+
   | Common Properties         |     | Specific Properties |  Template
   | Options Template Record   |     | Template Record     |  Definition
   |                           |     |                     |
   | scope: commonPropertiesID |     | commonPropertiesID  |
   | Common Properties         |     | Specific Properties |
   +------------+--------------+     +----------+----------+
   .............|...............................|.......................
                |                               |
   +------------v-------------+      +----------v----------+
   | Common Properties        |      | Specific Properties |+  Exported
   | Data Record              |------&gt; Data Records        ||  Data
   +--------------------------+      +---------------------+|  Records
                                      +---------------------+

          Figure 3: Template Record and Data Record Dependencies

   From the IPFIX protocol, there are no differences between the per-
   Flow or per-packet data reduction, except maybe the terminology where
   the Specific Properties could be called packet Specific Properties in
   the previous figure.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Transport%20Protocol%20Choice"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Transport Protocol Choice</span>

   This document follows the IPFIX transport protocol specifications
   defined in the IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].  However, depending on the
   transport protocol choice, this document imposes some additional
   constraints.  If Partial Reliable Stream Control Transmission
   Protocol (PR-SCTP) [<a href="rfc3758.html" title='"Stream Control Transmission Protocol (SCTP) Partial Reliability Extension"'>RFC3758</a>] is selected as the IPFIX protocol, the
   following PR-SCTP subsection specifications MUST be respected.  If
   UDP is selected as the IPFIX protocol, the following UDP subsection




<span class="grey">Boschi, et al.               Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   specifications MUST be respected.  If TCP is selected as the IPFIX
   protocol, the following TCP subsection specifications MUST be
   respected.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20PR-SCTP"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  PR-SCTP</span>

   The active Common Properties MUST be sent after the SCTP association
   establishment and before the corresponding Specific Properties Data
   Records.  In the case of SCTP association re-establishment, all
   active Common Properties MUST be resent before the corresponding
   Specific Properties Data Records.

   The Common Properties Data Records MUST be sent reliably.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20UDP"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  UDP</span>

   Common Properties Data Records MUST be resent on a regular basis.
   The periodicity MUST be configurable.  The default value for the
   frequency of Common Properties transmission (refresh timeout) is 10
   minutes.

   The Exporting Process SHOULD transmit the Common Properties
   definition in advance of any Data Record that uses these Common
   Properties to help ensure that the Collector has the Common
   Properties definition before receiving the first associated Data
   Record.

   If a commonPropertiesID is not used anymore, the Exporting Process
   stops resending the related Common Properties Data Record.  The old
   commonPropertiesID MUST NOT be used until its lifetime (see
   <a href="#section-6.1">Section 6.1</a>) has expired.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20TCP"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  TCP</span>

   Common Properties MUST be sent after the TCP connection
   establishment, and before the corresponding Specific Properties Data
   Records.  In the case of TCP connection re-establishment, all active
   Common Properties MUST be resent before the corresponding Specific
   Properties Data Records.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20commonPropertiesID%20Management"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  commonPropertiesID Management</span>

   The commonPropertiesID is an identifier of a set of common properties
   that is locally unique per Observation Domain and Transport Session.
   The Exporting Process MUST manage the commonPropertiesIDs allocations
   for its Observation Domains and Transport Session.  Different





<span class="grey">Boschi, et al.               Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   Observation Domains from the same Exporter MAY use the same
   commonPropertiesID value to refer to different sets of Common
   Properties.

   The commonPropertiesID values MAY be assigned sequentially, but it is
   NOT REQUIRED.  Particular commonPropertiesID ranges or values MAY
   have explicit meanings for the IPFIX Device.  For example,
   commonPropertiesID values may be assigned based on the result of a
   hash function, etc.

   Using a 64-bit commonPropertiesID Information Element allows the
   export of 2**64 active sets of Common Properties, per Observation
   Domain and per Transport Session.

   commonPropertiesIDs that are not used anymore SHOULD be withdrawn.
   The Common Properties Withdrawal message is a Data Record defined by
   an Options Template consisting of only one scope field -- namely, the
   commonPropertiesID (with a type of 137 [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]) and no non-scope
   fields.

   0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 3            |      Length = 14 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID N           |       Field Count = 1         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Scope Field count = 1    |0|  commonPropertiesID = 137   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Scope 1 Field Length = 8     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

              Figure 4: Common Properties Withdrawal Message

   If UDP is selected as the transport protocol, the Common Properties
   Withdrawal messages MUST NOT be used, as this method is inefficient
   due to the unreliable nature of UDP.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20The%20Collecting%20Process%20Side"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  The Collecting Process Side</span>

   This section describes the Collecting Process when using SCTP and PR-
   SCTP as the transport protocol.  Any necessary changes to the
   Collecting Process, specifically related to TCP or UDP transport
   protocols, are specified in the subsections.

   The Collecting Process MUST store the commonPropertiesID information
   for the duration of the association so that it can interpret the
   corresponding Data Records that are received in subsequent Data Sets.



<span class="grey">Boschi, et al.               Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   The Collecting Process can either store the Data Records as they
   arrive, without reconstructing the initial Flow Record, or
   reconstruct the initial Flow Record.  In the former case, there might
   be less storage capacity required at the Collector side.  In the
   latter case, the Collector job is more complex and time-consuming due
   to the higher resource demand for record processing in real time.

   If the Collecting Process has received the Specific Properties Data
   Record before the associated Common Properties Data Record, the
   Collecting Process SHOULD store the Specific Properties Data Record
   and await the retransmission or out-of-order arrival of the Common
   Properties Data Record.

   commonPropertiesIDs are unique per SCTP association and per
   Observation Domain.  If the Collecting Process receives an Options
   Template Record with a scope containing a commonPropertiesID that has
   already been received but that has not previously been withdrawn
   (i.e., a commonPropertiesID from the same Exporter Observation Domain
   received on the SCTP association), then the Collecting Process MUST
   shut down the association.

   When an SCTP association is closed, the Collecting Process MUST
   discard all commonPropertiesIDs received over that association and
   stop decoding IPFIX Messages that use those commonPropertiesIDs.

   If a Collecting Process receives a Common Properties Withdrawal
   message, the Collecting Process MUST delete the corresponding Common
   Properties associated with the specific SCTP association and specific
   Observation Domain, and stop interpreting Data Records referring to
   those Common Properties.  The receipt of Data Records referring to
   Common Properties that have been withdrawn MUST be ignored and SHOULD
   be logged by the Collecting Process.

   If the Collecting Process receives a Common Properties Withdrawal
   message for Common Properties that it has not received before on this
   SCTP association, it MUST reset the SCTP association and discard the
   IPFIX Message, and it SHOULD log the error as it does for malformed
   IPFIX Messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20UDP"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  UDP</span>

   The Collecting Process MUST associate a lifetime with each Common
   Property received via UDP.  Common Properties not refreshed by the
   Exporting Process within the lifetime are expired at the Collecting
   Process.






<span class="grey">Boschi, et al.               Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   If the Common Properties are not refreshed before that lifetime has
   expired, the Collecting Process MUST discard the corresponding
   definition of the commonPropertiesID and any current and future
   associated Data Records.  In this case, an alarm MUST be logged.

   The Collecting Process MUST NOT decode any further Data Records that
   are associated with the expired Common Properties.  If a Common
   Property is refreshed with a definition that differs from the
   previous definition, the Collecting Process SHOULD log a warning and
   replace the previously received Common Property with the new one.
   The Common Property lifetime at the Collecting Process MUST be at
   least 3 times higher than the refresh timeout of the Template used to
   export the Common Property definition, configured on the Exporting
   Process.

   The Collecting Process SHOULD accept Data Records without the
   associated Common Properties required to decode the Data Record.  If
   the Common Properties have not been received at the time Data Records
   are received, the Collecting Process SHOULD store the Data Records
   for a short period of time and decode them after the Common
   Properties definitions are received.  The short period of time MUST
   be lower than the lifetime of definitions associated with identifiers
   considered unique within the UDP session.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20TCP"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  TCP</span>

   When the TCP connection is reset, either gracefully or abnormally,
   the Collecting Processes MUST delete all commonPropertiesID values
   and associated Common Properties data corresponding to that
   connection.

   If a Collection Process receives a Common Properties Withdrawal
   message, the Collection Process MUST expire the related Common
   Properties data.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Advanced%20Techniques"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Advanced Techniques</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Multiple%20Data%20Reduction"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Multiple Data Reduction</span>

   A Flow Record can refer to one or more Common Properties sets; the
   use of multiple Common Properties can lead to more efficient exports.
   When sets of Common Properties are identified in the data, it may be
   found that there is more than one set of non-overlapping properties.

   Note that in the case of multiple Common Properties in one Data
   Record, the different sets of Common Properties MUST be disjoint
   (i.e., MUST NOT have Information Elements in common) to avoid
   potential collisions.



<span class="grey">Boschi, et al.               Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   Consider a set of properties "A", e.g., common sourceAddressA and
   sourcePortA, and another set of properties "B", e.g.,
   destinationAddressB and destinationPortB.  Figure 5 shows how this
   information is repeated with classical IPFIX export in several Flow
   Records.

   +--------+--------+---------+---------+---------------------+
   |srcAddrA|srcPortA|destAddrB|destPortB| &lt;Flow1 information&gt; |
   +--------+--------+---------+---------+---------------------+
   |srcAddrA|srcPortA|destAddrC|destPortC| &lt;Flow2 information&gt; |
   +--------+--------+---------+---------+---------------------+
   |srcAddrD|srcPortD|destAddrB|destPortB| &lt;Flow3 information&gt; |
   +--------+--------+---------+---------+---------------------+
   |srcAddrD|srcPortD|destAddrC|destPortC| &lt;Flow4 information&gt; |
   +--------+--------+---------+---------+---------------------+
   |   ...  |   ...  |   ...   |   ...   |        ...          |
   +--------+--------+---------+---------+---------------------+

        Figure 5: Common and Specific Properties Exported Together

   Besides A and B, other sets of Properties might be repeated as well
   (e.g., Properties C and D in the figure above).

   We can separate the Common Properties into properties A composed of
   sourceAddressA and sourcePortA, properties D composed of
   sourceAddressD and sourcePortD, properties B composed of
   destinationAddressB and destinationPortB, and properties C composed
   of destinationAddressC and destinationPortC.  These four records can
   be expanded to four combinations of Data Records to reduce redundancy
   without the need to define four complete sets of Common Properties
   (see the figure below).  The more Common Properties sets that are
   defined, the more combinations that are available.



















<span class="grey">Boschi, et al.               Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   +-------------------+-----------------+-------------+
   | index for prop. A | sourceAddressA  | sourcePortA |
   +-------------------+-----------------+-------------+
   | index for prop. D | sourceAddressD  | sourcePortD |
   +-------------------+-----------------+-------------+

   +-------------------+---------------------+------------------+
   | index for prop. B | destinationAddressB | destinationPortB |
   +-------------------+---------------------+------------------+
   | index for prop. C | destinationAddressC | destinationPortC |
   +-------------------+---------------------+------------------+

   +------------------+------------------+-----------------------+
   |index for prop. A |index for prop. B |  &lt;Flow1 information&gt;  |
   +------------------+------------------+-----------------------+
   |index for prop. A |index for prop. C |  &lt;Flow2 information&gt;  |
   +------------------+------------------+-----------------------+
   |index for prop. D |index for prop. B |  &lt;Flow3 information&gt;  |
   +------------------+------------------+-----------------------+
   |index for prop. D |index for prop. C |  &lt;Flow4 information&gt;  |
   +------------------+------------------+-----------------------+

     Figure 6: Multiple Common (above) and Specific Properties (below)
                            Exported Separately

   The advantage of the multiple Common Properties is that the objective
   of reducing the bandwidth is met while the number of indices is kept
   to a minimum.  Defining an extra index for all records would not save
   bandwidth in the case of Figure 5 and is generally a less efficient
   solution.

   If a set of Flow Records share multiple sets of Common Properties,
   multiple commonPropertiesID instances MAY be used to increase export
   efficiency even further, as displayed in Figure 7.

















<span class="grey">Boschi, et al.               Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   +--------------------------- +     +---------------------+
   | Common Properties          |     | Specific Properties | Template
   | Options Template Record    |     | Template Record     | Definition
   |                            |     |                     |
   | Scope: commonPropertiesID1 |     | commonPropertiesID1 |
   | Scope: commonPropertiesID2 |     | commonPropertiesID2 |
   | Common Properties          |     | Specific Properties |
   +------------+---------------+     +---------+-----------+
   .............|...............................|.......................
                |                               |
   +------------v-------------+      +----------v----------+
   | Common Properties        |      | Specific Properties |+  Exported
   | Data Record              |------&gt; Data Records        ||  Data
   +------------------------- +      +---------------------+|  Records
                                      +---------------------+

                     Figure 7: Multiple Data Reduction

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Cascading%20Common%20Properties"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Cascading Common Properties</span>

   An Exporting Process MUST NOT export any set of Common Properties
   that contains, either directly or via other cascaded Common
   Properties, references to itself in its own definition (i.e., a
   circular definition).  When the Collecting Process receives Common
   Properties that reference other Common Properties, it MUST resolve
   the references to Common Properties.  If the Common Properties aren't
   available at the time Data Records are received, the Collecting
   Process SHOULD store the Data Records for a short period of time and
   decode them after the Common Properties are received.

   If the Collecting Process could not decode a cascading Common
   Properties definition because the referenced Common Properties are
   not available before the short period of time, then the Collecting
   Process SHOULD log the error.

   If the Collecting Process could not decode a cascading Common
   Properties definition because it detects a circular definition, then
   the Collecting Process SHOULD log the error.

   Information Element ordering MUST be preserved when creating and
   expanding Common Properties.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Export%20and%20Evaluation%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Export and Evaluation Considerations</span>

   The objective of the method specified in this document is the
   reduction in the amount of measurement data that has to be
   transferred from the Exporter to the Collector.  Note that the
   efficiency of this method may vary, as discussed in this section.  In



<span class="grey">Boschi, et al.               Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   addition, there might be less storage capacity required at the
   Collector side if the Collector decides to store the Data Records as
   they arrive, without reconstructing the initial Flow Record.

   On the other hand, this method requires additional resources on both
   the Exporter and the Collector.  The Exporter has to manage Common
   Properties information and to assign commonPropertiesID values.  The
   Collector has to process records described by two templates instead
   of just one.  Additional effort is also required when post processing
   the measurement data, in order to correlate Flow Records with Common
   Properties information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Transport%20Protocol%20Choice"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Transport Protocol Choice</span>

   The proposed method is most effective using a reliable transport
   protocol for the transfer of the Common Properties.  Therefore, the
   use of PR-SCTP with full reliability or TCP is recommended for the
   transmission of IPFIX Messages containing Common Properties.  Note
   that use of UDP is less efficient for the transmission of Common
   Properties, as they have to be resent regularly.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Reduced%20Size%20Encoding"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Reduced Size Encoding</span>

   The transfer of the commonPropertiesIDs originates some overhead and
   might even increase the amount of exported data if the length of the
   commonPropertiesID field is not shorter than the length of the
   replaced fields.

   In cases where the range of the commonPropertiesID can be restricted,
   it is RECOMMENDED to apply reduced size encoding to the
   commonPropertiesID to achieve a further gain in bandwidth efficiency.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Efficiency%20Gain"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Efficiency Gain</span>

   While the goal of this specification is to reduce the bandwidth, the
   efficiency might be limited.  Indeed, the efficiency gain is based on
   the abundance of redundant information in Flows and would be directly
   proportional to the reuse of the defined commonPropertiesID values,
   with a theoretical limit where all the Data Records would use a
   single commonPropertiesID.  In other words, the more we reuse a
   commonPropertiesID value, the better the efficiency gain.  While the
   Exporting Process can evaluate the direct gain for the Flow Records
   to be exported, it cannot predict whether future Flow Records would
   contain the information specified by active commonPropertiesID
   values.  This implies that the efficiency factor of this
   specification is higher for specific applications where filtering is
   involved, such as one-way delay or trajectory sampling.




<span class="grey">Boschi, et al.               Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   Note that this technique might even lead to an increase in bandwidth
   usage under certain conditions.  Taking into account the overhead of
   exporting the commonPropertiesID values, if the commonPropertiesID
   values are not used in future Data Records, this technique would
   actually increase the export bandwidth.  A typical case would be the
   assignments of Common Properties based on past observed traffic,
   hoping that future Flows would contain the same characteristics.

   The efficiency gain depends also on the difference between the length
   of the replaced fields and the length of the commonPropertiesID.  The
   shorter the length of the commonPropertiesID is (with respect to the
   total length of the Common Properties fields), the bigger the gain
   is.

   The example in <a href="#appendix-A.2">Appendix A.2</a> below uses IPFIX to export measurement
   data for each received packet.  In that case, for a Flow of 1000
   packets, the amount of data can be decreased more than 26 percent.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   The same security considerations as for the IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>]
   apply.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Acknowledgments"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Acknowledgments</span>

   The authors would like to thank Guido Pohl for initiating this work
   and for his contribution to early versions of this document.  Thanks
   also to Andrew Johnson, Gehrard Muenz, Brian Trammell, and Paul
   Aitken for their comments and feedback.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20References"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Normative%20References"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]    Bradner, S., "Key words for use in RFCs to Indicate
                Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC5101" name="ref-RFC5101">RFC5101</a>]    Claise, B., "Specification of the IP Flow Information
                Export (IPFIX) Protocol for the Exchange of IP Traffic
                Flow Information", <a href="rfc5101.html">RFC 5101</a>, January 2008.

   [<a id="ref-RFC5102" name="ref-RFC5102">RFC5102</a>]    Quittek, J., Bryant, S., Claise, B., Aitken, P., and J.
                Meyer, "Information Model for IP Flow Information
                Export", <a href="rfc5102.html">RFC 5102</a>, January 2008.

   [<a id="ref-RFC5476" name="ref-RFC5476">RFC5476</a>]    Claise, B., Ed., "Packet Sampling (PSAMP) Protocol
                Specifications", <a href="rfc5476.html">RFC 5476</a>, March 2009.




<span class="grey">Boschi, et al.               Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Informative%20References"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Informative References</span>

   [<a id="ref-PSAMP-MIB" name="ref-PSAMP-MIB">PSAMP-MIB</a>]  Dietz, T., Ed. and B. Claise, "Definitions of Managed
                Objects for Packet Sampling", Work in Progress,
                June 2006.

   [<a id="ref-RFC3550" name="ref-RFC3550">RFC3550</a>]    Schulzrinne, H., Casner, S., Frederick, R., and V.
                Jacobson, "RTP: A Transport Protocol for Real-Time
                Applications", STD 64, <a href="rfc3550.html">RFC 3550</a>, July 2003.

   [<a id="ref-RFC3758" name="ref-RFC3758">RFC3758</a>]    Stewart, R., Ramalho, M., Xie, Q., Tuexen, M., and P.
                Conrad, "Stream Control Transmission Protocol (SCTP)
                Partial Reliability Extension", <a href="rfc3758.html">RFC 3758</a>, May 2004.

   [<a id="ref-RFC3917" name="ref-RFC3917">RFC3917</a>]    Quittek, J., Zseby, T., Claise, B., and S. Zander,
                "Requirements for IP Flow Information Export (IPFIX)",
                <a href="rfc3917.html">RFC 3917</a>, October 2004.

   [<a id="ref-RFC4960" name="ref-RFC4960">RFC4960</a>]    Stewart, R., "Stream Control Transmission Protocol",
                <a href="rfc4960.html">RFC 4960</a>, September 2007.

   [<a id="ref-RFC5470" name="ref-RFC5470">RFC5470</a>]    Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek,
                "Architecture for IP Flow Information Export", <a href="rfc5470.html">RFC 5470</a>,
                March 2009.

   [<a id="ref-RFC5472" name="ref-RFC5472">RFC5472</a>]    Zseby, T., Boschi, E., Brownlee, N., and B. Claise, "IP
                Flow Information Export (IPFIX) Applicability",
                <a href="rfc5472.html">RFC 5472</a>, March 2009.

   [<a id="ref-RFC5474" name="ref-RFC5474">RFC5474</a>]    Duffield, N., Ed., "A Framework for Packet Selection and
                Reporting", <a href="rfc5474.html">RFC 5474</a>, March 2009.

   [<a id="ref-RFC5475" name="ref-RFC5475">RFC5475</a>]    Zseby, T., Molina, M., Duffield, N., Niccolini, S., and
                F. Raspall, "Sampling and Filtering Techniques for IP
                Packet Selection", <a href="rfc5475.html">RFC 5475</a>, March 2009.

   [<a id="ref-RFC5477" name="ref-RFC5477">RFC5477</a>]    Dietz, T., Claise, B., Aitken, P., Dressler, F., and G.
                Carle, "Information Model for Packet Sampling Exports",
                <a href="rfc5477.html">RFC 5477</a>, March 2009.












<span class="grey">Boschi, et al.               Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Examples"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Examples</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Per-Flow%20Data%20Reduction"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Per-Flow Data Reduction</span>

   In this section, we show how Flow information can be exported
   efficiently using the method described in this document.  Let's
   suppose we have to periodically export data about two IPv6 Flows.

   In this example, we report the following information:

   Flow|        dstIPv6Address                 | dst- |nPkts|nBytes
       |                                       | Port |     |
   ----------------------------------------------------------------
    A  |2001:DB8:80AD:5800:0058:0800:2023:1D71 |  80  | 30  |  6000
       |                                       |      |     |
    A  |2001:DB8:80AD:5800:0058:0800:2023:1D71 |  80  | 50  |  9500
       |                                       |      |     |
    B  |2001:DB8:80AD:5800:0058:00AA:00B7:AF2B | 1932 | 60  |  8000
       |                                       |      |     |
    A  |2001:DB8:80AD:5800:0058:0800:2023:1D71 |  80  | 40  |  6500
       |                                       |      |     |
    A  |2001:DB8:80AD:5800:0058:0800:2023:1D71 |  80  | 60  |  9500
       |                                       |      |     |
    B  |2001:DB8:80AD:5800:0058:00AA:00B7:AF2B | 1932 | 54  |  7600

                    Figure 8: Flow Information Example

   The Common Properties in this case are the destination IPv6 address
   and the destination port.  We first define an Options Template that
   contains the following Information Elements:

   o  Scope: commonPropertiesID in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a type of 137 and a
      length of 8 octets.

   o  The destination IPv6 address: destinationIPv6Address in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
      with a type of 28 and a length of 16 octets.

   o  The destination port: destinationTransportPort in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with
      a type of 11, and a length of 2 octets.

   Figure 9 shows the Options Template defining the Common Properties
   with commonPropertiesID as scope:









<span class="grey">Boschi, et al.               Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


     0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 3            |      Length = 24 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID = 257       |       Field Count = 3         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Scope Field count = 1    |0|  commonPropertiesID = 137   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Scope 1 Field Length = 8     |0|  destinationIPv6Address = 28|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 16        |0|destinationTransportPort = 11|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 2         |        (Padding)              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

               Figure 9: Common Properties Options Template

   The Specific Properties Template consists of the information not
   contained in the Options Templates, i.e., Flow-specific information;
   in this case, the number of packets and the number of bytes to be
   reported.  Additionally, this Template contains the
   commonPropertiesID.  In Data Records, the value of this field will
   contain one of the unique indices of the Option Records exported
   before.  It contains the following Information Elements (see also
   Figure 10):

   o  commonPropertiesID with a length of 8 octets.

   o  The number of packets of the Flow: inPacketDeltaCount in
      [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a length of 4 octets.

   o  The number of octets of the Flow: inOctetDeltaCount in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
      with a length of 4 octets.

















<span class="grey">Boschi, et al.               Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


     0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 2            |      Length = 20 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID = 258       |       Field Count = 3         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|  commonPropertiesID = 137   |       Field Length = 8        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|    inPacketDeltaCount = 2   |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|    inOctetDeltaCount = 1    |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 10: Specific Properties Template

   Considering the data shown at the beginning of this example, the
   following two Data Records will be exported:

   Common-      |           dstAddress                    | dst-
   PropertiesID |                                         | Port
   -------------+-----------------------------------------+-------
       101      | 2001:DB8:80AD:5800:0058:0800:2023:1D71  |  80
                |                                         |
       102      | 2001:DB8:80AD:5800:0058:00AA:00B7:AF2B  | 1932

                                 Figure 11
























<span class="grey">Boschi, et al.               Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   The Data Records reporting the Common Properties will look like:

   0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 257          |      Length = 60 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                             101                             -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-           2001:DB8:80AD:5800:0058:0800:2023:1D71            -+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            80                 |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-                             -+
   |                              102                              |
   +-                             -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                              -+
   |                                                               |
   +-                                                             -+
   |            2001:DB8:80AD:5800:0058:00AA:00B7:AF2B             |
   +-                                                             -+
   |                                                               |
   +-                             -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |          1932                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 12: Data Records reporting Common Properties

   The Data Records will in turn be:

   commonPropertiesID  |  inPacketDeltaCount  | inOctetDeltaCount
   ---------------------------------------------------------------
           101         |          30          |       6000
           101         |          50          |       9500
           102         |          60          |       8000
           101         |          40          |       6500
           101         |          60          |       9500
           102         |          54          |       7600

                                 Figure 13



<span class="grey">Boschi, et al.               Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   Figure 14 shows the first Data Record listed in the table:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Set ID = 258         |          Length = 16          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                             101                             -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               30              |             6000              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 14: Data Record reporting Common Properties

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Per-Packet%20Data%20Reduction"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Per-Packet Data Reduction</span>

   An example of the per-packet data reduction is the measurement of
   One-Way Delay (OWD), where the exact same specific packet must be
   observed at the source and destination of the path to be measured.
   The OWD is computed by subtracting the time of observation of the
   same packet at the two end-points with synchronized clocks.  As the
   OWD is measured for a specific application on which a Service Level
   Agreement (SLA) is bound, this translates into the observation of
   multiple packets with Specific Properties.  In order to match the
   identical packet at both Observation Points, a series of packets with
   a set of properties (for example, all the packets of a specific
   source and destination IP addresses, of a specific Diffserv codepoint
   (DSCP) value, and of a specific destination transport port) must be
   observed at both ends of the measurements.  This implies that the
   source and destination must export a series of Flow Records composed
   of two types of information: some common information for all packets,
   and some unique information about each packet in order to generate a
   unique identifier for each packet passing this Observation Point (for
   example, a hash value on the invariant fields of the packet).  So,
   the source and destination composing the measurement's end-points can
   individually and independently apply the redundancy technique
   described in this document in order to save some bandwidth for their
   respective Flow Records exports.

   The Templates required for exporting measurement data of this kind
   are illustrated in the figures below.  Figure 15 shows the Options
   Template containing the information concerning Flows using the
   commonPropertiesID as scope.  In the Common Properties Template, we
   export the following Information Elements:





<span class="grey">Boschi, et al.               Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   o  The source IPv4 Address: sourceIPv4Address in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a
      type of 8 and a length of 4 octets.

   o  The destination IPv4 Address: destinationIPv4Address in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>],
      with a type of 12 and a length of 4 octets.

   o  The Class of Service field: ClassOfServiceIPv4 in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with
      a type of 5 and a length of 1 octet.

   o  The Protocol Identifier: protocolIdentifier in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a
      type of 4 and a length of 1 octet.

   o  The source port: sourceTransportPort in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a type of
      7 and a length of 2 octets.

   o  The destination port: destinationTransportPort in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with
      a type of 11 and a length of 2 octets.

   The commonPropertiesID Information Element is used as the Scope
   Field.

     0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 3            |      Length = 40 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID = 256       |       Field Count = 7         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Scope Field count = 1    |0|  commonPropertiesID = 137   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Scope 1 Field Length = 4     |0|    sourceIPv4Address = 8    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 4         |0| destinationIPv4Address = 12 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 4         |0|  classOfServiceIPv4 = 5     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 1         |0|  protocolIdentifier = 4     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 1         |0|  transportSourcePort = 7    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 2         |0|transportDestinationPort = 11|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Field Length = 2         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 15: Example Flow Properties Template





<span class="grey">Boschi, et al.               Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   For passive OWD measurement, the Packet Properties Template or
   Specific Properties Template consists of at least the timestamp and
   packet ID.  Additionally, this template contains a commonPropertiesID
   field to associate the packet with a Flow.

   Figure 16 displays the template with the packet properties.  In this
   example, we export the following Information Elements:

   o  commonPropertiesID.  In this case, reduced size encoding is used,
      and the Information Element is declared with a length of 4 octets
      instead of 8.

   o  The packet timestamp: observationTimeMilliseconds in the PSAMP
      information model [<a href="rfc5477.html" title='"Information Model for Packet Sampling Exports"'>RFC5477</a>], with a type of 323 and a length of 8
      octets.

   o  digestHashValue in the PSAMP information model [<a href="rfc5477.html" title='"Information Model for Packet Sampling Exports"'>RFC5477</a>], with a
      type of 326 and a length of 8 octets.

   o  The packet length: ipTotalLength in the IPFIX information model
      [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], with a type of 224 and a length of 8 octets.

      0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         Set ID = 2            |      Length = 36 octets       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       Template ID = 257       |       Field Count = 4         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0|  commonPropertiesID = 137   |       Field Length = 4        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0| observationTimeMillis.= 323 |       Field Length = 8        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0|    digestHashValue = 326    |       Field Length = 8        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0|    ipTotalLength = 224      |       Field Length = 8        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

               Figure 16: Example Packet Properties Template

   At the collection point, packet records from the two measurement
   points are gathered and correlated by means of the packet ID.  The
   resulting delay Data Records are exported in a similar manner as the
   packet data.  One-Way Delay data is associated with Flow information
   by the commonPropertiesID field.  The OWD properties contain the
   Packet Pair ID (which is the packet ID of the two contributing packet





<span class="grey">Boschi, et al.               Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   records), the timestamp of the packet passing the reference monitor
   point in order to reconstruct a time series, the calculated delay
   value, and the commonPropertiesID.

   In this example, using IPFIX to export the measurement data for each
   received packet, 38 bytes have to be transferred (sourceAddressV4=4,
   destinationAddressV4=4, classOfServiceV4=1, protocolIdentifier=1,
   sourceTransportPort=2, destinationTransportPort=2,
   observationTimeMilliseconds=8, digestHashValue=8, ipTotalLength=8).
   Without considering the IPFIX protocol overhead, a Flow of 1000
   packets produces 38000 bytes of measurement data.  Using the proposed
   optimization, each packet produces an export of only 28 bytes
   (observationTimeMilliseconds=8, digestHashValue=8, ipTotalLength=8,
   commonPropertiesID=4).  The export of the Flow information produces
   18 bytes (sourceAddressV4=4, destinationAddressV4=4,
   classOfServiceV4=1, protocolIdentifier=1, sourceTransportPort=2,
   destinationTransportPort=2, commonPropertiesID=4).  For a Flow of
   1000 packets, this sums to 28018 bytes.  This is a decrease of more
   than 26 percent.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.3.%20%20Common%20Properties%20Withdrawal%20Message"></a><a class="selflink" href="#appendix-A.3" name="appendix-A.3">A.3</a>.  Common Properties Withdrawal Message</span>

   This section shows an example commonPropertiesID Withdrawal message.
   Figure 17 depicts the Options Template Record with the
   commonPropertiesID as unique scope field, and no non-scope fields.

     0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 3            |      Length = 14 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 259         |       Field Count = 1         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Scope Field count = 1    |0|  commonPropertiesID 137     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Scope 1 Field Length = 8     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

         Figure 17: Example Common Properties Withdrawal Template












<span class="grey">Boschi, et al.               Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc5473.html">RFC 5473</a>                  Reducing Redundancy                 March 2009</span>


   Figure 18 shows the Option Data Record withdrawing commonPropertiesID
   N:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Set ID = 259          |      Length = 12 octets       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                              N                              -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

            Figure 18: Record Withdrawing commonPropertiesID N

Authors' Addresses

   Elisa Boschi
   Hitachi Europe
   c/o ETH Zurich
   Gloriastrasse 35
   8092 Zurich
   Switzerland

   Phone: +41 44 6327057
   EMail: elisa.boschi@hitachi-eu.com


   Lutz Mark
   Fraunhofer IFAM
   Wiener Str. 12
   28359 Bremen
   Germany

   Phone: +49 421 2246206
   EMail: lutz.mark@ifam.fraunhofer.de


   Benoit Claise
   Cisco Systems, Inc.
   De Kleetlaan 6a b1
   Diegem  1813
   Belgium

   Phone: +32 2 704 5622
   EMail: bclaise@cisco.com





Boschi, et al.               Informational                     [Page 27]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.119, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5473 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:41:47 GMT --></html>