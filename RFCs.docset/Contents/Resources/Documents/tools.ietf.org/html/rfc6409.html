<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6409 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:38:27 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.119" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="rfc4409" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:6409" name="DC.Identifier"/>
<meta content="November, 2011" name="DC.Date.Issued"/>
<meta content="Klensin, John C" name="DC.Creator"/>
<meta content="Gellens, Randall" name="DC.Creator"/>
<meta content="This memo splits message submission from message relay, allowing each
service to operate according to its own rules (for security, policy,
etc.), and specifies what actions are to be taken by a submission
server.  Message relay is unaffected, and continues to use SMTP over
port 25.  When conforming to this document, message submission uses
the protocol specified here, normally over port 587.  This separation
of function offers a number of benefits, including the ability to
apply specific security or policy requirements. [STANDARDS-TRACK]" name="DC.Description.Abstract"/>
<meta content="Message Submission for Mail" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6409 - Message Submission for Mail</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bggreen" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6409.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6409" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-yam-rfc4409bis" title="draft-ietf-yam-rfc4409bis">draft-ietf-yam-rf...</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6409" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6409" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=6409">Errata</a>]        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       INTERNET STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Internet Engineering Task Force (IETF)                        R. Gellens
Request for Comments: 6409                         QUALCOMM Incorporated
STD: 72                                                       J. Klensin
Obsoletes: <a href="rfc4409.html">4409</a>                                            November 2011
Category: Standards Track
ISSN: 2070-1721


                      <span class="h1">Message Submission for Mail</span>

Abstract

   This memo splits message submission from message relay, allowing each
   service to operate according to its own rules (for security, policy,
   etc.), and specifies what actions are to be taken by a submission
   server.

   Message relay is unaffected, and continues to use SMTP over port 25.

   When conforming to this document, message submission uses the
   protocol specified here, normally over port 587.

   This separation of function offers a number of benefits, including
   the ability to apply specific security or policy requirements.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6409">http://www.rfc-editor.org/info/rfc6409</a>.













<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Document Information ............................................<a href="#page-5">5</a>
      <a href="#section-2.1">2.1</a>. Definitions of Terms Used in This Memo .....................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. Conventions Used in This Document ..........................<a href="#page-6">6</a>
   <a href="#section-3">3</a>. Message Submission ..............................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Submission Identification ..................................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. Message Rejection and Bouncing .............................<a href="#page-6">6</a>
      <a href="#section-3.3">3.3</a>. Authorized Submission ......................................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Mandatory Actions ...............................................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. General Submission Rejection Code ..........................<a href="#page-8">8</a>
      <a href="#section-4.2">4.2</a>. Ensure All Domains Are Fully Qualified .....................<a href="#page-8">8</a>
      <a href="#section-4.3">4.3</a>. Require Authentication .....................................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. Recommended Actions .............................................<a href="#page-9">9</a>
      <a href="#section-5.1">5.1</a>. Enforce Address Syntax .....................................<a href="#page-9">9</a>
      <a href="#section-5.2">5.2</a>. Log Errors .................................................<a href="#page-9">9</a>
      <a href="#section-5.3">5.3</a>. Apply Shorter Timeouts .....................................<a href="#page-9">9</a>
   <a href="#section-6">6</a>. Optional Actions ...............................................<a href="#page-10">10</a>
      <a href="#section-6.1">6.1</a>. Enforce Submission Rights .................................<a href="#page-10">10</a>
      <a href="#section-6.2">6.2</a>. Enforce Permissions .......................................<a href="#page-10">10</a>
      <a href="#section-6.3">6.3</a>. Check Message Data ........................................<a href="#page-10">10</a>
      <a href="#section-6.4">6.4</a>. Support for the Postmaster Address ........................<a href="#page-10">10</a>
      <a href="#section-6.5">6.5</a>. Adjust Character Encodings ................................<a href="#page-11">11</a>
   <a href="#section-7">7</a>. Interaction with SMTP Extensions ...............................<a href="#page-12">12</a>
   <a href="#section-8">8</a>. Message Modifications ..........................................<a href="#page-13">13</a>
      <a href="#section-8.1">8.1</a>. Add 'Sender' ..............................................<a href="#page-14">14</a>
      <a href="#section-8.2">8.2</a>. Add 'Date' ................................................<a href="#page-14">14</a>
      <a href="#section-8.3">8.3</a>. Add 'Message-ID' ..........................................<a href="#page-14">14</a>
      <a href="#section-8.4">8.4</a>. Transfer Encode ...........................................<a href="#page-14">14</a>
      <a href="#section-8.5">8.5</a>. Sign the Message ..........................................<a href="#page-14">14</a>
      <a href="#section-8.6">8.6</a>. Encrypt the Message .......................................<a href="#page-14">14</a>
      <a href="#section-8.7">8.7</a>. Resolve Aliases ...........................................<a href="#page-15">15</a>
      <a href="#section-8.8">8.8</a>. Header Rewriting ..........................................<a href="#page-15">15</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-15">15</a>
   <a href="#section-10">10</a>. IANA Considerations ...........................................<a href="#page-16">16</a>
   <a href="#section-11">11</a>. Acknowledgments ...............................................<a href="#page-16">16</a>
   <a href="#section-12">12</a>. References ....................................................<a href="#page-17">17</a>
      <a href="#section-12.1">12.1</a>. Normative References .....................................<a href="#page-17">17</a>
      <a href="#section-12.2">12.2</a>. Informative References ...................................<a href="#page-17">17</a>
   <a href="#appendix-A">Appendix A</a>. Major Changes from <a href="rfc4409.html">RFC 4409</a> ...........................<a href="#page-20">20</a>










<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   SMTP [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>] was defined as a message *transfer* protocol, that
   is, a means to route (if needed) and deliver finished (complete)
   messages.

   Message Transfer Agents (MTAs) are not supposed to alter the message
   text, except to add 'Received', 'Return-Path', and other header
   fields as required by [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>].  However, SMTP is now also widely
   used as a message *submission* protocol, that is, a means for Message
   User Agents (MUAs) to introduce new messages into the MTA routing
   network.  The process that accepts message submissions from MUAs is
   termed a "Message Submission Agent" (MSA).

   In order to permit unconstrained communications, SMTP is not often
   authenticated during message relay.

   Authentication and authorization of initial submissions have become
   increasingly important, driven by changes in security requirements
   and rising expectations that submission servers take responsibility
   for the message traffic they originate.

   For example, due to the prevalence of machines that have worms,
   viruses, or other malicious software that generate large amounts of
   spam, many sites now prohibit outbound traffic on the standard SMTP
   port (port 25), funneling all mail submissions through submission
   servers.

   In addition to authentication and authorization issues, messages
   being submitted are, in some cases, finished (complete) messages and,
   in other cases, are unfinished (incomplete) in one or more aspects.
   Unfinished messages may need to be completed to ensure they conform
   to the Message Format specification [<a href="#ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>] and related
   requirements.  For example, the message may lack a proper 'Date'
   header field, and domains might not be fully qualified.  In some
   cases, the MUA may be unable to generate finished messages (e.g., it
   might not know its time zone).  Even when submitted messages are
   complete, local site policy may dictate that the message text be
   examined or modified in some way, e.g., to conceal local name or
   address spaces.  Such completions or modifications have been shown to
   cause harm when performed by downstream MTAs -- that is, MTAs after
   the first-hop submission MTA -- and are, in general, considered to be
   outside the province of standardized MTA functionality.








<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   Separating messages into submissions and transfers allows developers
   and network administrators to do the following more easily:

   o  Implement security policies and guard against unauthorized mail
      relaying or injection of unsolicited bulk mail.

   o  Implement authenticated submission, including off-site submission
      by authorized users such as travelers.

   o  Separate the relevant software code differences, thereby making
      each code base more straightforward and allowing for different
      programs for relay and submission.

   o  Detect configuration problems with a site's mail clients.

   o  Provide a basis for adding enhanced submission services.

   This memo describes a low-cost, deterministic means for messages to
   be identified as submissions, and it specifies what actions are to be
   taken by a submission server.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Document%20Information"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Document Information</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Definitions%20of%20Terms%20Used%20in%20This%20Memo"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Definitions of Terms Used in This Memo</span>

   Many of the concepts and terms used in this document are defined in
   [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>]; familiarity with those documents is assumed here.

   Fully Qualified

   Containing or consisting of a domain that can be globally resolved
   using the Domain Name Service, that is, not a local alias or partial
   specification.

   Message Submission Agent (MSA)

   A process that conforms to this specification.  An MSA acts as a
   submission server to accept messages from MUAs, and it either
   delivers them or acts as an SMTP client to relay them to an MTA.

   Message Transfer Agent (MTA)

   A process that conforms to [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>].  An MTA acts as an SMTP server
   to accept messages from an MSA or another MTA, and it either delivers
   them or acts as an SMTP client to relay them to another MTA.






<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   Message User Agent (MUA)

   A process that acts (often on behalf of a user and with a user
   interface) to compose and submit new messages, and to process
   delivered messages.

   For delivered messages, the receiving MUA may obtain and process the
   message according to local conventions or, in what is commonly
   referred to as a split-MUA model, Post Office Protocol [<a href="#ref-POP3" title='"Post Office Protocol - Version 3"'>POP3</a>] or IMAP
   [<a href="#ref-IMAP4" title='"INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1"'>IMAP4</a>] is used to access delivered messages, whereas the protocol
   defined here (or SMTP) is used to submit messages.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Conventions%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Conventions Used in This Document</span>

   Examples use the 'example.net' domain.

   The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY"
   in this document are to be interpreted as defined in [<a href="#ref-KEYWORDS" title='"Key words for use in RFCs to Indicate Requirement Levels"'>KEYWORDS</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Message%20Submission"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Message Submission</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Submission%20Identification"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Submission Identification</span>

   Port 587 is reserved for email message submission as specified in
   this document.  Messages received on this port are defined to be
   submissions.  The protocol used is ESMTP [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>], with additional
   restrictions or allowances as specified here.

   Although most email clients and servers can be configured to use port
   587 instead of 25, there are cases where this is not possible or
   convenient.  A site MAY choose to use port 25 for message submission
   by designating some hosts to be MSAs and others to be MTAs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Message%20Rejection%20and%20Bouncing"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Message Rejection and Bouncing</span>

   MTAs and MSAs MAY implement message rejection rules that rely, in
   part, on whether the message is a submission or a relay.

   For example, some sites might configure their MTAs to reject all RCPT
   commands for messages that do not reference local users, and they
   might configure their MSA to reject all message submissions that do
   not come from authorized users, with authorization based on either
   the authenticated identity or the submitting endpoint being within a
   protected IP environment.

   NOTE: It is better to reject a message than to risk sending one that
   is damaged.  This is especially true for problems that are
   correctable by the MUA, for example, an invalid 'From' field.



<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   If an MSA is not able to determine a return path to the submitting
   user, from a valid MAIL FROM, a valid source IP address, or based on
   authenticated identity, then the MSA SHOULD immediately reject the
   message.  A message can be immediately rejected by returning a 550
   code to the MAIL command.

   Note that a null return path, that is, MAIL FROM:&lt;&gt;, is permitted and
   MUST NOT, in itself, be cause for rejecting a message.  (MUAs need to
   generate null return-path messages for a variety of reasons,
   including disposition notifications.)

   Except in the case where the MSA is unable to determine a valid
   return path for the message being submitted, text in this
   specification that instructs an MSA to issue a rejection code MAY be
   complied with by accepting the message and subsequently generating a
   bounce message.  (That is, if the MSA is going to reject a message
   for any reason except being unable to determine a return path, it can
   optionally do an immediate rejection or accept the message and then
   mail a bounce.)

   NOTE: In the normal case of message submission, immediately rejecting
   the message is preferred, as it gives the user and MUA direct
   feedback.  To properly handle delayed bounces, the client MUA needs
   to maintain a queue of messages it has submitted and match bounces to
   them.  Note that many contemporary MUAs do not have this capability.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Authorized%20Submission"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Authorized Submission</span>

   Numerous methods have been used to ensure that only authorized users
   are able to submit messages.  These methods include authenticated
   SMTP, IP address restrictions, secure IP and other tunnels, and prior
   POP authentication.

   Authenticated SMTP [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] has seen widespread deployment.  It
   allows the MSA to determine an authorization identity for the message
   submission, one that is not tied to other protocols.

   IP address restrictions are very widely implemented, but they do not
   allow for travelers and similar situations, and they can be easily
   spoofed unless all transport paths between the MUA and MSA are
   trustworthy.

   Secure IP [<a href="#ref-IPSEC" title='"Security Architecture for the Internet Protocol"'>IPSEC</a>], and other encrypted and authenticated tunneling
   techniques, can also be used and provide additional benefits of
   protection against eavesdropping and traffic analysis.

   Requiring a POP [<a href="#ref-POP3" title='"Post Office Protocol - Version 3"'>POP3</a>] authentication (from the same IP address)
   within some amount of time (e.g., 20 minutes) prior to the start of a



<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   message submission session has also been used, but this does impose
   restrictions on clients as well as servers, which may cause
   difficulties.  Specifically, the client must do a POP authentication
   before an SMTP submission session, and not all clients are capable
   and configured for this.  Also, the MSA must coordinate with the POP
   server, which may be difficult.  There is also a window during which
   an unauthorized user can submit messages and appear to be a
   previously authorized user.  Since it is dependent on the MUA's IP
   addresses, this technique is substantially as subject to IP address
   spoofing as validation based on known IP addresses alone (see above).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Mandatory%20Actions"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Mandatory Actions</span>

   An MSA MUST do all of the following:

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20General%20Submission%20Rejection%20Code"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  General Submission Rejection Code</span>

   Unless covered by a more precise response code, response code 554 is
   to be used to reject a MAIL, RCPT, or DATA command that contains
   something improper.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Ensure%20All%20Domains%20Are%20Fully%20Qualified"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Ensure All Domains Are Fully Qualified</span>

   The MSA MUST ensure that all domains in the SMTP envelope are fully
   qualified.

   If the MSA examines or alters the message text in any way, except to
   add trace header fields [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>], it MUST ensure that all domains
   in address header fields are fully qualified.

   Reply code 554 is to be used to reject a MAIL, RCPT, or DATA command
   that contains improper domain references.

   A frequent local convention is to accept single-level domains (e.g.,
   'sales') and then to expand the reference by adding the remaining
   portion of the domain name (e.g., to 'sales.example.net').  Local
   conventions that permit single-level domains SHOULD reject, rather
   than expand, incomplete multi-level domains (e.g., 'squeaky.sales'),
   since such expansion is particularly risky.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Require%20Authentication"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Require Authentication</span>

   The MSA MUST, by default, issue an error response to the MAIL command
   if the session has not been authenticated using [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>], unless
   it has already independently established authentication or
   authorization (such as being within a protected subnetwork).

   <a href="#section-3.3">Section 3.3</a> discusses authentication mechanisms.



<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   Reply code 530 [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] is used for this purpose.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Recommended%20Actions"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Recommended Actions</span>

   The MSA SHOULD do all of the following.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Enforce%20Address%20Syntax"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Enforce Address Syntax</span>

   An MSA SHOULD reject messages with illegal syntax in a sender or
   recipient SMTP envelope address.

   If the MSA examines or alters the message text in any way, except to
   add trace header fields, it SHOULD reject messages with illegal
   address syntax in address header fields.

   Reply code 501 is to be used to reject a MAIL or RCPT command that
   contains a detectably improper address.

   When addresses are resolved after submission of the message body,
   reply code 554 (with a suitable enhanced status code from
   [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>]) is used after end-of-data, if the message contains
   invalid addresses in the header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Log%20Errors"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Log Errors</span>

   The MSA SHOULD log message errors, especially apparent
   misconfigurations of client software.

   It can be very helpful to notify the administrator when problems are
   detected with local mail clients.  This is another advantage of
   distinguishing submission from relay: system administrators might be
   interested in local configuration problems, but not in client
   problems at other sites.

   Note that it is important to impose limits on such logging to prevent
   certain forms of denial-of-service (DoS) attacks.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Apply%20Shorter%20Timeouts"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Apply Shorter Timeouts</span>

   The timeouts specified in <a href="rfc5321.html#section-4.5.3.2">Section 4.5.3.2 of RFC 5321</a> [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>] are
   designed to deal with the many types of situations that can be
   encountered on the public Internet.  The relationship among clients
   and servers corresponding to this specification is typically much
   closer and more predictable.  Submission clients behave differently
   from relay client in some areas, especially tolerance for timeouts.
   In practice, message submission clients tend to have short timeouts
   (perhaps 2-5 minutes for a reply to any command).  Submission servers
   SHOULD respond to any command (even DATA) in fewer than 2 minutes.



<span class="grey">Gellens &amp; Klensin            Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   When the submission server has a close administrative and/or network
   relationship with the submission client(s) -- e.g., with a webmail
   interface calling on a tightly bound submission server -- mutual
   agreement on much shorter timeouts MAY be appropriate.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Optional%20Actions"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Optional Actions</span>

   The MSA MAY do any of the following.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Enforce%20Submission%20Rights"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Enforce Submission Rights</span>

   The MSA MAY issue an error response to a MAIL command if the address
   in MAIL FROM appears to have insufficient submission rights or is not
   authorized with the authentication used (if the session has been
   authenticated).

   Reply code 550 with an appropriate enhanced status code per
   [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>], such as 5.7.1, is used for this purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Enforce%20Permissions"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Enforce Permissions</span>

   The MSA MAY issue an error response to a RCPT command if inconsistent
   with the permissions given to the user (if the session has been
   authenticated).

   Reply code 550 with an appropriate enhanced status code per
   [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>], such as 5.7.1, is used for this purpose.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Check%20Message%20Data"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Check Message Data</span>

   The MSA MAY issue an error response to the DATA command or send a
   failure result after end-of-data if the submitted message is
   syntactically invalid, seems inconsistent with permissions given to
   the user (if known), or violates site policy in some way.

   Reply code 554 is used for syntactic problems in the data.  Reply
   code 501 is used if the command itself is not syntactically valid.
   Reply code 550 with an appropriate enhanced status code per
   [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>] (such as 5.7.1) is used to reject based on the
   submitting user.  Reply code 550 with an appropriate enhanced status
   code (such as 5.7.0) is used if the message violates site policy.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20Support%20for%20the%20Postmaster%20Address"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  Support for the Postmaster Address</span>

   If appropriate under local conditions and to facilitate conformance
   with the "postmaster" requirements of [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>], the MSA MAY permit
   a reduced degree of authentication for mail addressed to the
   "postmaster" (or one of its alternate spelling forms, see



<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>]), in one or more domains, as compared to requirements
   enforced for other addresses.  Among other benefits, this provides an
   address of last resort that can be used by authorized users to report
   problems that otherwise prevent them from submitting mail.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20Adjust%20Character%20Encodings"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  Adjust Character Encodings</span>

   Subject to limits imposed by other protocols and specifications, the
   MSA MAY convert among character sets or string encodings to improve
   message usefulness, likelihood of delivery, or conformance with other
   specifications or recommendations.  Such conversions MAY include,
   when necessary, replacement of addresses whose encoding does not
   conform to <a href="rfc5321.html">RFC 5321</a> with ones that do, using information available
   out of band.





































<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Interaction%20with%20SMTP%20Extensions"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Interaction with SMTP Extensions</span>

   The following table lists Standards Track and Experimental SMTP
   extensions whose documents do not explicitly specify their
   applicability to this protocol.  Listed are the EHLO keyword, name,
   an indication as to the use of the extension on the submit port, and
   a reference.

+--------------------+----------------------+--------+-----------------+
| Keyword            | Name                 |Sub-    | Reference       |
|                    |                      |mission |                 |
+--------------------+----------------------+--------+-----------------+
|PIPELINING          |Pipelining            |SHOULD  |[<a href="#ref-PIPELINING" title='"SMTP Service Extension for Command Pipelining"'>PIPELINING</a>]     |
|ENHANCEDSTATUSCODES |Enhanced Status Codes |SHOULD  |[<a href="#ref-CODES-EXTENSION">CODES-EXTENSION</a>]|
|ETRN                |Extended Turn         |MUST NOT|[<a href="#ref-ETRN" title='"SMTP Service Extension for Remote Message Queue Starting"'>ETRN</a>]           |
|   ...              |Extended Codes        |SHOULD  |[<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>]     |
|DSN                 |Delivery Status       |SHOULD  |[<a href="#ref-DSN" title='"Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)"'>DSN</a>]            |
|                    |  Notification        |        |                 |
|SIZE                |Message size          |MAY     |[<a href="#ref-SIZE" title='"SMTP Service Extension for Message Size Declaration"'>SIZE</a>]           |
|   ...              |521 reply code        |MUST NOT|[<a href="#ref-REPLY-521" title='"SMTP 521 Reply Code"'>REPLY-521</a>]      |
|CHECKPOINT          |Checkpoint/Restart    |MAY     |[<a href="#ref-CHECKPOINT" title='"SMTP Service Extension for Checkpoint/Restart"'>CHECKPOINT</a>]     |
|BINARYMIME          |Binary MIME           |MAY     |[<a href="#ref-CHUNKING" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>CHUNKING</a>]       |
|CHUNKING            |Chunking              |MAY     |[<a href="#ref-CHUNKING" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>CHUNKING</a>]       |
|8BITMIME            |Use 8-bit data        |SHOULD  |[<a href="rfc6152.html" title='"SMTP Service Extension for 8-bit MIME Transport"'>RFC6152</a>]        |
|AUTH                |Authentication        |MUST    |[<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>]      |
|STARTTLS            |Start TLS             |MAY     |[<a href="#ref-START-TLS" title='"SMTP Service Extension for Secure SMTP over Transport Layer Security"'>START-TLS</a>]      |
|NO-SOLICITING       |Notification of       |MAY     |[<a href="rfc3865.html" title='"A No Soliciting Simple Mail Transfer Protocol (SMTP) Service Extension"'>RFC3865</a>]        |
|                    |  no soliciting       |        |                 |
|MTRK                |Message Tracking      |MAY     |[<a href="#ref-MSG-TRACK" title='"SMTP Service Extension for Message Tracking"'>MSG-TRACK</a>]      |
|ATRN                |On-Demand Relay       |MUST NOT|[<a href="rfc2645.html" title='"ON-DEMAND MAIL RELAY (ODMR) SMTP with Dynamic IP Addresses"'>RFC2645</a>]        |
|DELIVERBY           |Deliver By            |MAY     |[<a href="rfc2852.html" title='"Deliver By SMTP Service Extension"'>RFC2852</a>]        |
|CONPERM             |Content Conversion    |MAY     |[<a href="rfc4141.html" title='"SMTP and MIME Extensions for Content Conversion"'>RFC4141</a>]        |
|                    |  Permission          |        |                 |
|CONNEG              |Content Conversion    |MAY     |[<a href="rfc4141.html" title='"SMTP and MIME Extensions for Content Conversion"'>RFC4141</a>]        |
|                    |  Negotiation         |        |                 |
+--------------------+----------------------+--------+-----------------+
                             Table 1

   Future SMTP extensions SHOULD explicitly specify if they are valid on
   the Submission port.

   Some SMTP extensions are especially useful for message submission:

   Extended Status Codes [<a href="#ref-SMTP-CODES" title='"Enhanced Mail System Status Codes"'>SMTP-CODES</a>] SHOULD be supported and used
   according to [<a href="#ref-CODES-EXTENSION">CODES-EXTENSION</a>].  This permits the MSA to notify the
   client of specific configuration or other problems in more detail
   than the response codes listed in this memo.  Because some rejections




<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   are related to a site's security policy, care should be used not to
   expose more detail to unauthenticated senders than is needed.

   [<a id="ref-PIPELINING" name="ref-PIPELINING">PIPELINING</a>] SHOULD be supported by the MSA.

   [<a id="ref-SMTP-AUTH" name="ref-SMTP-AUTH">SMTP-AUTH</a>] allows the MSA to validate the authority and determine
   the identity of the submitting user and MUST be supported by the MSA.

   [<a id="ref-START-TLS" name="ref-START-TLS">START-TLS</a>] is the most widely used mechanism, at the time this
   document was written, that allows the MUA and MSA to protect message
   submission integrity and privacy.

   Any references to the DATA command in this memo also refer to any
   substitutes for DATA, such as the BDAT command used with [<a href="#ref-CHUNKING" title='"SMTP Service Extensions for Transmission of Large and Binary MIME Messages"'>CHUNKING</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Message%20Modifications"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Message Modifications</span>

   Sites MAY modify submissions to ensure compliance with standards and
   site policy.  This section describes a number of such modifications
   that are often considered useful.

   NOTE: As a matter of guidance for local decisions to implement
   message modification, a paramount rule is to limit such actions to
   remedies for specific problems that have clear solutions.  This is
   especially true with address elements.  For example, indiscriminately
   appending a domain to an address or element that lacks one typically
   results in more broken addresses.  An unqualified address must be
   verified to be a valid local part in the domain before the domain can
   be safely added.

   Any message forwarded or delivered by the MSA MUST conform to the
   requirements of [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>] and [<a href="#ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>] or the requirements
   permitted by extensions that are supported by the MSA and accepted by
   the next-hop server.

   Message modification can affect the validity of an existing message
   signature, such as by DomainKeys Identified Mail (DKIM) [<a href="#ref-DKIM" title='"DomainKeys Identified Mail (DKIM) Signatures"'>DKIM</a>],
   Pretty Good Privacy (PGP) [<a href="rfc4880.html" title='"OpenPGP Message Format"'>RFC4880</a>], or Secure MIME (S/MIME)
   [<a href="rfc5751.html" title='"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification"'>RFC5751</a>], and can render the signature invalid.  This, in turn, can
   affect message handling by later receivers, such as filtering engines
   that consider the presence or absence of a valid signature.










<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Add%20%27Sender%27"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Add 'Sender'</span>

   The MSA MAY add or replace the 'Sender' field, if the identity of the
   sender is known and this is not given in the 'From' field.

   The MSA MUST ensure that any address it places in a 'Sender' field
   is, in fact, a valid mail address.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Add%20%27Date%27"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Add 'Date'</span>

   The MSA MAY add a 'Date' field to the submitted message, if it lacks
   it, or correct the 'Date' field if it does not conform to
   [<a href="#ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>] syntax.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.3.%20%20Add%20%27Message-ID%27"></a><a class="selflink" href="#section-8.3" name="section-8.3">8.3</a>.  Add 'Message-ID'</span>

   The MSA SHOULD add or replace the 'Message-ID' field, if it lacks it,
   or it is not valid syntax (as defined by [<a href="#ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>]).  Note
   that a number of clients still do not generate 'Message-ID' fields.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.4.%20%20Transfer%20Encode"></a><a class="selflink" href="#section-8.4" name="section-8.4">8.4</a>.  Transfer Encode</span>

   The MSA MAY apply transfer encoding to the message according to MIME
   conventions, if needed and not harmful to the MIME type.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.5.%20%20Sign%20the%20Message"></a><a class="selflink" href="#section-8.5" name="section-8.5">8.5</a>.  Sign the Message</span>

   The MSA MAY (digitally) sign or otherwise add authentication
   information to the message.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.6.%20%20Encrypt%20the%20Message"></a><a class="selflink" href="#section-8.6" name="section-8.6">8.6</a>.  Encrypt the Message</span>

   The MSA MAY encrypt the message for transport to reflect
   organizational policies.

   NOTE: To be useful, the addition of a signature and/or encryption by
   the MSA generally implies that the connection between the MUA and MSA
   must, itself, be secured in some other way, for example, by operating
   inside of a secure environment, by securing the submission connection
   at the transport layer, or by using an [<a href="#ref-SMTP-AUTH" title='"SMTP Service Extension for Authentication"'>SMTP-AUTH</a>] mechanism that
   provides for session integrity.










<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.7.%20%20Resolve%20Aliases"></a><a class="selflink" href="#section-8.7" name="section-8.7">8.7</a>.  Resolve Aliases</span>

   The MSA MAY resolve and rewrite aliases (e.g., Canonical Name (CNAME)
   records) for domain names, in the SMTP envelope and/or in address
   fields of the header, subject to local policy.

   NOTE: SMTP [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>] prohibits the use of domain name aliases in
   addresses and the session-opening announcement.  As with other SMTP
   requirements, <a href="rfc5321.html">RFC 5321</a> effectively prohibits an MSA from forwarding
   such messages into the public Internet.  Nonetheless, unconditionally
   resolving aliases could be harmful.  For example, if www.example.net
   and ftp.example.net are both aliases for mail.example.net, rewriting
   them could lose useful information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.8.%20%20Header%20Rewriting"></a><a class="selflink" href="#section-8.8" name="section-8.8">8.8</a>.  Header Rewriting</span>

   The MSA MAY rewrite local parts and/or domains in the SMTP envelope
   and, optionally, in address fields of the header, according to local
   policy.  For example, a site may prefer to rewrite 'JRU' as
   'J.Random.User' in order to hide login names and/or to rewrite
   'squeaky.sales.example.net' as 'zyx.example.net' to hide machine
   names and make it easier to move users.

   However, only addresses, local-parts, or domains that match specific
   local MSA configuration settings should be altered.  It would be very
   dangerous for the MSA to apply data-independent rewriting rules, such
   as always deleting the first element of a domain name.  So, for
   example, a rule that strips the leftmost element of the domain, if
   the complete domain matches '*.foo.example.net', would be acceptable.

   The MSA MUST NOT rewrite a forward-pointing (destination) address in
   a way that violates the constraints of [<a href="#ref-SMTP-MTA" title='"Simple Mail Transfer Protocol"'>SMTP-MTA</a>] on modifications of
   local-parts.  Changes to addressing and encoding, carried out in
   conjunction with the action of <a href="#section-6.5">Section 6.5</a>, do not violate this
   principle if the MSA has sufficient information available to
   successfully and accurately apply the substitution.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   Separation of submission and relay of messages allows a site to
   implement different policies for the two types of services, including
   requiring the use of additional security mechanisms for one or both.
   It can do this in a way that is simpler, both technically and
   administratively.  This increases the likelihood that policies will
   be applied correctly.






<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   Separation also can aid in tracking and preventing unsolicited bulk
   email.

   For example, a site could configure its mail servers such that the
   MSA requires authentication before accepting a message, and the MTA
   rejects all RCPT commands for non-local users.  This can be an
   important element in a site's total email security policy.

   If a site fails to require any form of authorization for message
   submissions (see <a href="#section-3.3">Section 3.3</a> for discussion), it is allowing open use
   of its resources and name; unsolicited bulk email can be injected
   using its facilities.

   <a href="#section-3">Section 3</a> includes further discussion of issues with some
   authentication methods.

   <a href="#section-5.2">Section 5.2</a> includes a cautionary note that unlimited logging can
   enable certain forms of denial-of-service attacks.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  IANA Considerations</span>

   The entries in Table 1 have been corrected (reference for NO-
   SOLICITING) and extended (ATRN, DELIVERBY, CONPERM, and CONNEG).  The
   "SMTP Service Extensions" registry has been updated to reflect the
   changed and new entries.  Entries in the registry that do not appear
   in the table above are correct and should not be altered.

   The entry in the "SMTP Service Extensions" registry for <a href="rfc4409.html">RFC 4409</a> has
   been updated to reference this document.  The original reference for
   Submit (<a href="rfc2476.html">RFC 2476</a>), which should have been corrected earlier, has also
   been updated to point to this document.

   The entry in the "Service Name and Transport Protocol Port Number
   Registry" for port 587 has been updated to point to this document.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Acknowledgments"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Acknowledgments</span>

   The preparation and development of the current version of this
   specification was stimulated by discussions in the IETF YAM and EAI
   Working Groups.  Dave Crocker, Subramanian Moonesamy, Barry Leiba,
   John Levine, and others provided text that appeared in this document
   or versions leading up to it.

   Nathaniel Borenstein and Barry Leiba were instrumental in the
   development of <a href="rfc4409.html">RFC 4409</a>, the update to <a href="rfc2476.html">RFC 2476</a>.

   The original memo (<a href="rfc2476.html">RFC 2476</a>) was developed, in part, based on
   comments and discussions that took place on and off the IETF-Submit



<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   mailing list.  The help of those who took the time to review that
   document and make suggestions is appreciated, especially that of Dave
   Crocker, Ned Freed, Keith Moore, John Myers, and Chris Newman.

   Special thanks to Harald Alvestrand, who got this effort started.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20References"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20Normative%20References"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-KEYWORDS" name="ref-KEYWORDS">KEYWORDS</a>]   Bradner, S., "Key words for use in RFCs to Indicate
                Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-SMTP-AUTH" name="ref-SMTP-AUTH">SMTP-AUTH</a>]  Siemborski, R. and A. Melnikov, "SMTP Service Extension
                for Authentication", <a href="rfc4954.html">RFC 4954</a>, July 2007.

   [<a id="ref-SMTP-MTA" name="ref-SMTP-MTA">SMTP-MTA</a>]   Klensin, J., "Simple Mail Transfer Protocol", <a href="rfc5321.html">RFC 5321</a>,
                October 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20Informative%20References"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-CHECKPOINT" name="ref-CHECKPOINT">CHECKPOINT</a>] Crocker, D. and N. Freed, "SMTP Service Extension for
                Checkpoint/Restart", <a href="rfc1845.html">RFC 1845</a>, September 1995.

   [<a id="ref-CHUNKING" name="ref-CHUNKING">CHUNKING</a>]   Vaudreuil, G., "SMTP Service Extensions for Transmission
                of Large and Binary MIME Messages", <a href="rfc3030.html">RFC 3030</a>,
                December 2000.

   [<a id="ref-CODES-EXTENSION" name="ref-CODES-EXTENSION">CODES-EXTENSION</a>]
                Freed, N., "SMTP Service Extension for Returning
                Enhanced Error Codes", <a href="rfc2034.html">RFC 2034</a>, October 1996.

   [<a id="ref-DKIM" name="ref-DKIM">DKIM</a>]       Crocker, D., Hansen, T., and M. Kucherawy, "DomainKeys
                Identified Mail (DKIM) Signatures", <a href="rfc6376.html">RFC 6376</a>,
                September 2011.

   [<a id="ref-DSN" name="ref-DSN">DSN</a>]        Moore, K., "Simple Mail Transfer Protocol (SMTP) Service
                Extension for Delivery Status Notifications (DSNs)",
                <a href="rfc3461.html">RFC 3461</a>, January 2003.

   [<a id="ref-ETRN" name="ref-ETRN">ETRN</a>]       De Winter, J., "SMTP Service Extension for Remote
                Message Queue Starting", <a href="rfc1985.html">RFC 1985</a>, August 1996.

   [<a id="ref-IMAP4" name="ref-IMAP4">IMAP4</a>]      Crispin, M., "INTERNET MESSAGE ACCESS PROTOCOL - VERSION
                4rev1", <a href="rfc3501.html">RFC 3501</a>, March 2003.

   [<a id="ref-IPSEC" name="ref-IPSEC">IPSEC</a>]      Kent, S. and K. Seo, "Security Architecture for the
                Internet Protocol", <a href="rfc4301.html">RFC 4301</a>, December 2005.



<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   [<a id="ref-MESSAGE-FORMAT" name="ref-MESSAGE-FORMAT">MESSAGE-FORMAT</a>]
                Resnick, P., Ed., "Internet Message Format", <a href="rfc5322.html">RFC 5322</a>,
                October 2008.

   [<a id="ref-MSG-TRACK" name="ref-MSG-TRACK">MSG-TRACK</a>]  Allman, E. and T. Hansen, "SMTP Service Extension for
                Message Tracking", <a href="rfc3885.html">RFC 3885</a>, September 2004.

   [<a id="ref-PIPELINING" name="ref-PIPELINING">PIPELINING</a>] Freed, N., "SMTP Service Extension for Command
                Pipelining", STD 60, <a href="rfc2920.html">RFC 2920</a>, September 2000.

   [<a id="ref-POP3" name="ref-POP3">POP3</a>]       Myers, J. and M. Rose, "Post Office Protocol - Version
                3", STD 53, <a href="rfc1939.html">RFC 1939</a>, May 1996.

   [<a id="ref-REPLY-521" name="ref-REPLY-521">REPLY-521</a>]  Durand, A. and F. Dupont, "SMTP 521 Reply Code",
                <a href="rfc1846.html">RFC 1846</a>, September 1995.

   [<a id="ref-RFC2645" name="ref-RFC2645">RFC2645</a>]    Gellens, R., "ON-DEMAND MAIL RELAY (ODMR) SMTP with
                Dynamic IP Addresses", <a href="rfc2645.html">RFC 2645</a>, August 1999.

   [<a id="ref-RFC2852" name="ref-RFC2852">RFC2852</a>]    Newman, D., "Deliver By SMTP Service Extension",
                <a href="rfc2852.html">RFC 2852</a>, June 2000.

   [<a id="ref-RFC3865" name="ref-RFC3865">RFC3865</a>]    Malamud, C., "A No Soliciting Simple Mail Transfer
                Protocol (SMTP) Service Extension", <a href="rfc3865.html">RFC 3865</a>,
                September 2004.

   [<a id="ref-RFC4141" name="ref-RFC4141">RFC4141</a>]    Toyoda, K. and D. Crocker, "SMTP and MIME Extensions for
                Content Conversion", <a href="rfc4141.html">RFC 4141</a>, November 2005.

   [<a id="ref-RFC4880" name="ref-RFC4880">RFC4880</a>]    Callas, J., Donnerhacke, L., Finney, H., Shaw, D., and
                R.  Thayer, "OpenPGP Message Format", <a href="rfc4880.html">RFC 4880</a>,
                November 2007.

   [<a id="ref-RFC5751" name="ref-RFC5751">RFC5751</a>]    Ramsdell, B. and S. Turner, "Secure/Multipurpose
                Internet Mail Extensions (S/MIME) Version 3.2 Message
                Specification", <a href="rfc5751.html">RFC 5751</a>, January 2010.

   [<a id="ref-RFC6152" name="ref-RFC6152">RFC6152</a>]    Klensin, J., Freed, N., Rose, M., and D. Crocker, "SMTP
                Service Extension for 8-bit MIME Transport", STD 71,
                <a href="rfc6152.html">RFC 6152</a>, March 2011.

   [<a id="ref-SIZE" name="ref-SIZE">SIZE</a>]       Klensin, J., Freed, N., and K. Moore, "SMTP Service
                Extension for Message Size Declaration", STD 10,
                <a href="rfc1870.html">RFC 1870</a>, November 1995.







<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


   [<a id="ref-SMTP-CODES" name="ref-SMTP-CODES">SMTP-CODES</a>] Vaudreuil, G., "Enhanced Mail System Status Codes",
                <a href="rfc3463.html">RFC 3463</a>, January 2003.

   [<a id="ref-START-TLS" name="ref-START-TLS">START-TLS</a>]  Hoffman, P., "SMTP Service Extension for Secure SMTP
                over Transport Layer Security", <a href="rfc3207.html">RFC 3207</a>, February 2002.














































<span class="grey">Gellens &amp; Klensin            Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6409.html">RFC 6409</a>               Message Submission for Mail         November 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Major%20Changes%20from%20RFC%204409"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Major Changes from <a href="rfc4409.html">RFC 4409</a></span>

   The protocol specified by this document is not substantively
   different from that of <a href="rfc4409.html">RFC 4409</a>.  However, the present specification
   contains several clarifications and updates to reflect changes and
   revisions to other documents subsequent to the publication of <a href="rfc4409.html">RFC</a>
   <a href="rfc4409.html">4409</a>.  The following specific changes may be of interest to some
   readers.

   o  Updated several references to reflect more recent versions of the
      various specifications.  As part of this, reclassified <a href="rfc4954.html">RFC 4954</a> to
      a normative reference (SMTP AUTH is a MUST for <a href="rfc4409.html">RFC 4409</a> and this
      specification).

   o  Updated the text in <a href="#section-7">Section 7</a> to reflect the existence and partial
      population of the registry and the included table (Table 1) to
      correct one entry and add others.  See <a href="#section-10">Section 10</a> for more
      information.

   o  Added new text (<a href="#section-5.3">Section 5.3</a>) to clarify that Submission Servers
      should respond quickly.

   o  Added text to make it explicit that character encoding changes are
      permitted.

   o  Added text to make it clear that modifications to signed messages
      may cause problems and that they should be carefully considered.

Authors' Addresses

   Randall Gellens
   QUALCOMM Incorporated
   5775 Morehouse Drive
   San Diego, CA  92121-2779
   USA

   EMail: rg+ietf@qualcomm.com


   John C Klensin
   1770 Massachusetts Ave, #322
   Cambridge, MA  02140
   USA

   Phone: +1 617 491 5735
   EMail: john-ietf@jck.com





Gellens &amp; Klensin            Standards Track                   [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.119, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6409 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:38:27 GMT --></html>