<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc8102 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-psarkar-rtgwg-rlfa-node-protection" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:8102" name="DC.Identifier"/>
<meta content="March, 2017" name="DC.Date.Issued"/>
<meta content="Sarkar, Pushpasis" name="DC.Creator"/>
<meta content="Gredler, Hannes" name="DC.Creator"/>
<meta content="Hegde, Shraddha" name="DC.Creator"/>
<meta content="Litkowski, Stephane" name="DC.Creator"/>
<meta content="Bowers, Chris" name="DC.Creator"/>
<meta content='The loop-free alternates (LFAs) computed following the current remote-
LFA specification guarantees only link protection. The resulting
remote-LFA next hops (also called "PQ-nodes") may not guarantee node
protection for all destinations being protected by it.  This document
describes an extension to the remote-loop-free-based IP fast reroute
mechanisms that specifies procedures for determining whether or not a
given PQ-node provides node protection for a specific destination. The
document also shows how the same procedure can be utilized for the
collection of complete characteristics for alternate paths. Knowledge
about the characteristics of all alternate paths is a precursor to
applying the operator-defined policy for eliminating paths not fitting
the constraints.' name="DC.Description.Abstract"/>
<meta content="Remote-LFA Node Protection and Manageability" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 8102 - Remote-LFA Node Protection and Manageability</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc8102.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc8102" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-rtgwg-rlfa-node-protection" title="draft-ietf-rtgwg-rlfa-node-protection">draft-ietf-rtgw...</a>] [<a href="https://datatracker.ietf.org/doc/rfc8102" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc8102" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc8102" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                    P. Sarkar, Ed.
Request for Comments: 8102                                  Arrcus, Inc.
Category: Standards Track                                       S. Hegde
ISSN: 2070-1721                                                C. Bowers
                                                  Juniper Networks, Inc.
                                                              H. Gredler
                                                           RtBrick, Inc.
                                                            S. Litkowski
                                                                  Orange
                                                              March 2017


              <span class="h1">Remote-LFA Node Protection and Manageability</span>

Abstract

   The loop-free alternates (LFAs) computed following the current
   remote-LFA specification guarantees only link protection.  The
   resulting remote-LFA next hops (also called "PQ-nodes") may not
   guarantee node protection for all destinations being protected by it.

   This document describes an extension to the remote-loop-free-based IP
   fast reroute mechanisms that specifies procedures for determining
   whether or not a given PQ-node provides node protection for a
   specific destination.  The document also shows how the same procedure
   can be utilized for the collection of complete characteristics for
   alternate paths.  Knowledge about the characteristics of all
   alternate paths is a precursor to applying the operator-defined
   policy for eliminating paths not fitting the constraints.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc8102">http://www.rfc-editor.org/info/rfc8102</a>.








<span class="grey">Sarkar, et al.               Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





































<span class="grey">Sarkar, et al.               Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.1">1.1</a>.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.2">1.2</a>.  Requirements Language . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-2">2</a>.  Node Protection with Remote-LFA . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-2.1">2.1</a>.  The Problem . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-2.2">2.2</a>.  Additional Definitions  . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-2.2.1">2.2.1</a>.  Link-Protecting Extended P-Space  . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-2.2.2">2.2.2</a>.  Node-Protecting Extended P-Space  . . . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-2.2.3">2.2.3</a>.  Q-Space . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-2.2.4">2.2.4</a>.  Link-Protecting PQ-Space  . . . . . . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-2.2.5">2.2.5</a>.  Candidate Node-Protecting PQ-Space  . . . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-2.2.6">2.2.6</a>.  Cost-Based Definitions  . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
         <a href="#section-2.2.6.1">2.2.6.1</a>.  Link-Protecting Extended P-Space  . . . . . . . .   <a href="#page-9">9</a>
         <a href="#section-2.2.6.2">2.2.6.2</a>.  Node-Protecting Extended P-Space  . . . . . . . .   <a href="#page-9">9</a>
         <a href="#section-2.2.6.3">2.2.6.3</a>.  Q-Space . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-2.3">2.3</a>.  Computing Node-Protecting R-LFA Path  . . . . . . . . . .  <a href="#page-10">10</a>
       2.3.1.  Computing Candidate Node-Protecting PQ-Nodes for
               Primary Next Hops . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
       2.3.2.  Computing Node-Protecting Paths from PQ-Nodes to
               Destinations  . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
       2.3.3.  Computing Node-Protecting R-LFA Paths for
               Destinations with Multiple Primary Next-Hop Nodes . .  <a href="#page-14">14</a>
       <a href="#section-2.3.4">2.3.4</a>.  Limiting Extra Computational Overhead . . . . . . . .  <a href="#page-18">18</a>
   <a href="#section-3">3</a>.  Manageability of Remote-LFA Alternate Paths . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-3.1">3.1</a>.  The Problem . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
     <a href="#section-3.2">3.2</a>.  The Solution  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#section-4">4</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#section-5">5</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
   <a href="#section-6">6</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
     <a href="#section-6.1">6.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
     <a href="#section-6.2">6.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
















<span class="grey">Sarkar, et al.               Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The Remote-LFA specification [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] provides loop-free alternates
   that guarantee only link protection.  The resulting remote-LFA
   alternate next hops (also referred to as the "PQ-nodes") may not
   provide node protection for all destinations covered by the same
   remote-LFA alternate, in case of failure of the primary next-hop
   node, and it does not provide a means to determine the same.

   Also, the LFA Manageability document [<a href="rfc7916.html" title='"Operational Management of Loop-Free Alternates"'>RFC7916</a>] requires a computing
   router to find all possible alternate next hops (including all
   possible remote-LFA), collect the complete set of path
   characteristics for each alternate path, run an alternate-selection
   policy (configured by the operator), and find the best alternate
   path.  This will require that the remote-LFA implementation gathers
   all the required path characteristics along each link on the entire
   remote-LFA alternate path.

   With current LFA [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>] and remote-LFA implementations, the
   forward SPF (and reverse SPF) is run with the computing router and
   its immediate one-hop routers as the roots.  While that enables
   computation of path attributes (e.g., Shared Risk Link Group (SRLG)
   and Admin-groups) for the first alternate path segment from the
   computing router to the PQ-node, there is no means for the computing
   router to gather any path attributes for the path segment from the
   PQ-node to the destination.  Consequently, any policy-based selection
   of alternate paths will consider only the path attributes from the
   computing router up until the PQ-node.

   This document describes a procedure for determining node protection
   with remote-LFA.  The same procedure is also extended for the
   collection of a complete set of path attributes, enabling more
   accurate policy-based selection for alternate paths obtained with
   remote-LFA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Abbreviations"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Abbreviations</span>

   This document uses the following list of abbreviations:

      LFA: Loop-Free Alternates

      RLFA or R-LFA: Remote Loop-Free Alternates

      ECMP: Equal-Cost Multiple Path

      SPF: Shortest Path First graph computations

      NH: Next-Hop node



<span class="grey">Sarkar, et al.               Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Node%20Protection%20with%20Remote-LFA"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Node Protection with Remote-LFA</span>

   Node protection is required to provide protection of traffic on a
   given forwarding node against the failure of the first-hop node on
   the primary forwarding path.  Such protection becomes more critical
   in the absence of mechanisms like non-stop routing in the network.
   Certain operators refrain from deploying non-stop-routing in their
   network, due to the required complex state synchronization between
   redundant control plane hardwares it requires, and the significant
   additional computation and performance overheads it comes along with.
   In such cases, node protection is essential to guarantee
   uninterrupted flow of traffic, even in the case of an entire
   forwarding node going down.

   The following sections discuss the node-protection problem in the
   context of remote-LFA and propose a solution.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20The%20Problem"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  The Problem</span>

   To better illustrate the problem and the solution proposed in this
   document, the following topology diagram from the remote-LFA document
   [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] is being re-used with slight modification.

                                             D1
                                            /
                                       S-x-E
                                      /     \
                                     N       R3--D2
                                      \     /
                                      R1---R2

                           Figure 1: Topology 1

   In the above topology, for all (non-ECMP) destinations reachable via
   the S-E link, there is no standard LFA alternate.  As per the remote-
   LFA [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] alternate specifications, node R2 being the only PQ-
   node for the S-E link provides the next hop for all of the above
   destinations.  Table 1 shows all possible primary and remote-LFA
   alternate paths for each destination.






<span class="grey">Sarkar, et al.               Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


    +-------------+--------------+---------+-------------------------+
    | Destination | Primary Path | PQ-node | Remote-LFA Backup Path  |
    +-------------+--------------+---------+-------------------------+
    | R3          | S-&gt;E-&gt;R3     | R2      | S=&gt;N=&gt;R1=&gt;R2-&gt;R3        |
    | E           | S-&gt;E         | R2      | S=&gt;N=&gt;R1=&gt;R2-&gt;R3-&gt;E     |
    | D1          | S-&gt;E-&gt;D1     | R2      | S=&gt;N=&gt;R1=&gt;R2-&gt;R3-&gt;E-&gt;D1 |
    | D2          | S-&gt;E-&gt;R3-&gt;D2 | R2      | S=&gt;N=&gt;R1=&gt;R2-&gt;R3-&gt;D2    |
    +-------------+--------------+---------+-------------------------+

              Table 1: Remote-LFA Backup Paths via PQ-Node R2

   A closer look at Table 1 shows that, while the PQ-node R2 provides
   link protection for all the destinations, it does not provide node
   protection for destinations E and D1.  In the event of the node-
   failure on primary next hop E, the alternate path from the remote-LFA
   next hop R2 to E and D1 also becomes unavailable.  So, for a remote-
   LFA next hop to provide node protection for a given destination, the
   shortest path from the given PQ-node to the given destination MUST
   NOT traverse the primary next hop.

   In another extension of the topology in Figure 1, let us consider an
   additional link between N and E with the same cost as the other
   links.

                                             D1
                                            /
                                       S-x-E
                                      /   / \
                                     N---+   R3--D2
                                      \     /
                                      R1---R2

                           Figure 2: Topology 2

   In the above topology, the S-E link is no longer on any of the
   shortest paths from N to R3, E, and D1.  Hence, R3, E, and D1 are
   also included in both the extended P-space and the Q-space of E (with
   respect to the S-E link).  Table 2 shows all possible primary and
   R-LFA alternate paths via PQ-node R3 for each destination reachable
   through the S-E link in the above topology.  The R-LFA alternate
   paths via PQ-node R2 remain the same as in Table 1.










<span class="grey">Sarkar, et al.               Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


     +-------------+--------------+---------+------------------------+
     | Destination | Primary Path | PQ-node | Remote-LFA Backup Path |
     +-------------+--------------+---------+------------------------+
     | R3          | S-&gt;E-&gt;R3     | R3      | S=&gt;N=&gt;E=&gt;R3            |
     | E           | S-&gt;E         | R3      | S=&gt;N=&gt;E=&gt;R3-&gt;E         |
     | D1          | S-&gt;E-&gt;D1     | R3      | S=&gt;N=&gt;E=&gt;R3-&gt;E-&gt;D1     |
     | D2          | S-&gt;E-&gt;R3-&gt;D2 | R3      | S=&gt;N=&gt;E=&gt;R3-&gt;D2        |
     +-------------+--------------+---------+------------------------+

              Table 2: Remote-LFA Backup Paths via PQ-Node R3

   Again, a closer look at Table 2 shows that, unlike Table 1 where the
   single PQ-node R2 provided node protection for destinations R3 and
   D2, if we choose R3 as the R-LFA next hop, it no longer provides node
   protection for R3 and D2.  If S chooses R3 as the R-LFA next hop and
   if there is a node-failure on primary next hop E, then one of the
   parallel ECMP paths between N and R3 also becomes unavailable on the
   alternate path from S to R-LFA next hop R3.  So, for a remote-LFA
   next hop to provide node protection for a given destination, the
   shortest paths from S to the chosen PQ-node MUST NOT traverse the
   primary next-hop node.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Additional%20Definitions"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Additional Definitions</span>

   This document adds and enhances the following definitions, extending
   the ones mentioned in the Remote-LFA specification [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.1.%20%20Link-Protecting%20Extended%20P-Space"></a><a class="selflink" href="#section-2.2.1" name="section-2.2.1">2.2.1</a>.  Link-Protecting Extended P-Space</span>

   The Remote-LFA specification [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] already defines this.  The
   link-protecting extended P-space for a link S-E being protected is
   the set of routers that are reachable from one or more direct
   neighbors of S, except primary node E, without traversing the S-E
   link on any of the shortest paths from the direct neighbor to the
   router.  This MUST exclude any direct neighbor for which there is at
   least one ECMP path from the direct neighbor traversing the link
   (S-E) being protected.

   For a cost-based definition for link-protecting extended P-space,
   refer to <a href="#section-2.2.6.1">Section 2.2.6.1</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.2.%20%20Node-Protecting%20Extended%20P-Space"></a><a class="selflink" href="#section-2.2.2" name="section-2.2.2">2.2.2</a>.  Node-Protecting Extended P-Space</span>

   The node-protecting extended P-space for a primary next-hop node E
   being protected is the set of routers that are reachable from one or
   more direct neighbors of S, except primary node E, without traversing
   node E.  This MUST exclude any direct neighbors for which there is at




<span class="grey">Sarkar, et al.               Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   least one ECMP path from the direct neighbor traversing the node E
   being protected.

   For a cost-based definition for node-protecting extended P-space,
   refer to <a href="#section-2.2.6.2">Section 2.2.6.2</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.3.%20%20Q-Space"></a><a class="selflink" href="#section-2.2.3" name="section-2.2.3">2.2.3</a>.  Q-Space</span>

   The Remote-LFA document [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] already defines this.  The Q-space
   for a link S-E being protected is the set of nodes that can reach
   primary node E, without traversing the S-E link on any of the
   shortest paths from the node itself to primary next hop E.  This MUST
   exclude any node for which there is at least one ECMP path from the
   node to the primary next hop E traversing the link (S-E) being
   protected.

   For a cost-based definition for Q-Space, refer to <a href="#section-2.2.6.3">Section 2.2.6.3</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.4.%20%20Link-Protecting%20PQ-Space"></a><a class="selflink" href="#section-2.2.4" name="section-2.2.4">2.2.4</a>.  Link-Protecting PQ-Space</span>

   A node Y is in a link-protecting PQ-space with respect to the link
   (S-E) being protected if and only if Y is present in both link-
   protecting extended P-space and the Q-space for the link being
   protected.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.5.%20%20Candidate%20Node-Protecting%20PQ-Space"></a><a class="selflink" href="#section-2.2.5" name="section-2.2.5">2.2.5</a>.  Candidate Node-Protecting PQ-Space</span>

   A node Y is in a candidate node-protecting PQ-space with respect to
   the node (E) being protected if and only if Y is present in both the
   node-protecting extended P-space and the Q-space for the link being
   protected.

   Please note that a node Y being in a candidate node-protecting PQ-
   space does not guarantee that the R-LFA alternate path via the same,
   in entirety, is unaffected in the event of a node failure of primary
   next-hop node E.  It only guarantees that the path segment from S to
   PQ-node Y is unaffected by the same failure event.  The PQ-nodes in
   the candidate node-protecting PQ-space may provide node protection
   for only a subset of destinations that are reachable through the
   corresponding primary link.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.6.%20%20Cost-Based%20Definitions"></a><a class="selflink" href="#section-2.2.6" name="section-2.2.6">2.2.6</a>.  Cost-Based Definitions</span>

   This section provides cost-based definitions for some of the terms
   introduced in <a href="#section-2.2">Section 2.2</a> of this document.






<span class="grey">Sarkar, et al.               Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.2.6.1.%20%20Link-Protecting%20Extended%20P-Space"></a><a class="selflink" href="#section-2.2.6.1" name="section-2.2.6.1">2.2.6.1</a>.  Link-Protecting Extended P-Space</span>

   Please refer to <a href="#section-2.2.1">Section 2.2.1</a> for a formal definition of link-
   protecting extended P-space.

   A node Y is in a link-protecting extended P-space with respect to the
   link (S-E) being protected if and only if there exists at least one
   direct neighbor of S (Ni) other than primary next hop E that
   satisfies the following condition.

   D_opt(Ni,Y) &lt; D_opt(Ni,S) + D_opt(S,Y)

   Where,
     D_opt(A,B) : Distance on the most optimum path from A to B.
            Ni  : A direct neighbor of S other than primary
                  next hop E.
             Y  : The node being evaluated for link-protecting
                  extended P-Space.

              Figure 3: Link-Protecting Ext-P-Space Condition

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.2.6.2.%20%20Node-Protecting%20Extended%20P-Space"></a><a class="selflink" href="#section-2.2.6.2" name="section-2.2.6.2">2.2.6.2</a>.  Node-Protecting Extended P-Space</span>

   Please refer to <a href="#section-2.2.2">Section 2.2.2</a> for a formal definition of node-
   protecting extended P-space.

   A node Y is in a node-protecting extended P-space with respect to the
   node E being protected if and only if there exists at least one
   direct neighbor of S (Ni) other than primary next hop E, that
   satisfies the following condition.

   D_opt(Ni,Y) &lt; D_opt(Ni,E) + D_opt(E,Y)

   Where,
     D_opt(A,B) : Distance on the most optimum path from A to B.
             E  : The primary next hop on the shortest path from S
                  to destination.
             Ni : A direct neighbor of S other than primary
                  next hop E.
              Y : The node being evaluated for node-protecting
                  extended P-Space.

              Figure 4: Node-Protecting Ext-P-Space Condition

   Please note that a node Y satisfying the condition in Figure 4 above
   only guarantees that the R-LFA alternate path segment from S via
   direct neighbor Ni to the node Y is not affected in the event of a
   node failure of E.  It does not yet guarantee that the path segment



<span class="grey">Sarkar, et al.               Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   from node Y to the destination is also unaffected by the same failure
   event.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/2.2.6.3.%20%20Q-Space"></a><a class="selflink" href="#section-2.2.6.3" name="section-2.2.6.3">2.2.6.3</a>.  Q-Space</span>

   Please refer to <a href="#section-2.2.3">Section 2.2.3</a> for a formal definition of Q-Space.

   A node Y is in Q-space with respect to the link (S-E) being protected
   if and only if the following condition is satisfied:

   D_opt(Y,E) &lt; D_opt(S,E) + D_opt(Y,S)

   Where,
     D_opt(A,B) : Distance on the most optimum path from A to B.
             E  : The primary next hop on the shortest path from S
                  to destination.
             Y  : The node being evaluated for Q-Space.

                        Figure 5: Q-Space Condition

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Computing%20Node-Protecting%20R-LFA%20Path"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Computing Node-Protecting R-LFA Path</span>

   The R-LFA alternate path through a given PQ-node to a given
   destination is comprised of two path segments as follows:

   1.  Path segment from the computing router to the PQ-node (Remote-LFA
       alternate next hop), and

   2.  Path segment from the PQ-node to the destination being protected.

   So, to ensure that an R-LFA alternate path for a given destination
   provides node protection, we need to ensure that none of the above
   path segments are affected in the event of failure of the primary
   next-hop node.  Sections <a href="#section-2.3.1">2.3.1</a> and <a href="#section-2.3.2">2.3.2</a> show how this can be
   ensured.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.1.%20%20Computing%20Candidate%20Node-Protecting%20PQ-Nodes%20for%20Primary%20Next"></a><a class="selflink" href="#section-2.3.1" name="section-2.3.1">2.3.1</a>.  Computing Candidate Node-Protecting PQ-Nodes for Primary Next</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Hops"></a>        Hops</span>

   To choose a node-protecting R-LFA next hop for a destination R3,
   router S needs to consider a PQ-node from the candidate node-
   protecting PQ-space for the primary next hop E on the shortest path
   from S to R3.  As mentioned in <a href="#section-2.2.2">Section 2.2.2</a>, to consider a PQ-node
   as a candidate node-protecting PQ-node, there must be at least one
   direct neighbor Ni of S, such that all shortest paths from Ni to the
   PQ-node do not traverse primary next-hop node E.





<span class="grey">Sarkar, et al.               Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   Implementations SHOULD run the inequality in <a href="#section-2.2.6.2">Section 2.2.6.2</a>,
   Figure 4 for all direct neighbors, other than primary next-hop node
   E, to determine whether a node Y is a candidate node-protecting PQ-
   node.  All of the metrics needed by this inequality would have been
   already collected from the forward SPFs rooted at each of direct
   neighbor S, computed as part of standard LFA [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>]
   implementation.  With reference to the topology in Figure 2, Table 3
   shows how the above condition can be used to determine the candidate
   node-protecting PQ-space for S-E link (primary next hop E).

   +------------+----------+----------+----------+---------+-----------+
   | Candidate  |  Direct  |  D_opt   |  D_opt   |  D_opt  | Condition |
   |  PQ-node   | Nbr (Ni) |  (Ni,Y)  |  (Ni,E)  |  (E,Y)  |    Met    |
   |    (Y)     |          |          |          |         |           |
   +------------+----------+----------+----------+---------+-----------+
   |     R2     |    N     | 2 (N,R2) | 1 (N,E)  |    2    |    Yes    |
   |            |          |          |          |  (E,R2) |           |
   |     R3     |    N     | 2 (N,R3) | 1 (N,E)  |    1    |     No    |
   |            |          |          |          |  (E,R3) |           |
   +------------+----------+----------+----------+---------+-----------+

    Table 3: Node-Protection Evaluation for R-LFA Repair Tunnel to PQ-
                                   Node

   As seen in the above Table 3, R3 does not meet the node-protecting
   extended p-space inequality; so, while R2 is in candidate node-
   protecting PQ-space, R3 is not.

   Some SPF implementations may also produce a list of links and nodes
   traversed on the shortest path(s) from a given root to others.  In
   such implementations, router S may have executed a forward SPF with
   each of its direct neighbors as the SPF root, executed as part of the
   standard LFA computations [<a href="rfc5286.html" title='"Basic Specification for IP Fast Reroute: Loop-Free Alternates"'>RFC5286</a>].  So, S may re-use the list of
   links and nodes collected from the same SPF computations to decide
   whether or not a node Y is a candidate node-protecting PQ-node.  A
   node Y shall be considered as a node-protecting PQ-node if and only
   if there is at least one direct neighbor of S, other than the primary
   next hop E for which the primary next-hop node E does not exist on
   the list of nodes traversed on any of the shortest paths from the
   direct neighbor to the PQ-node.  Table 4 is an illustration of the
   mechanism with the topology in Figure 2.










<span class="grey">Sarkar, et al.               Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   +-------------+---------------------------+------------+------------+
   | Candidate   | Repair Tunnel Path        | Link       | Node       |
   | PQ-node     | (Repairing router to PQ-  | Protection | Protection |
   |             | node)                     |            |            |
   +-------------+---------------------------+------------+------------+
   | R2          | S-&gt;N-&gt;R1-&gt;R2              | Yes        | Yes        |
   | R2          | S-&gt;E-&gt;R3-&gt;R2              | No         | No         |
   | R3          | S-&gt;N-&gt;E-&gt;R3               | Yes        | No         |
   +-------------+---------------------------+------------+------------+

          Table 4: Protection of Remote-LFA Tunnel to the PQ-Node

   As seen in the above Table 4, while R2 is a candidate node-protecting
   remote-LFA next hop for R3 and D2, it is not so for E and D1, since
   the primary next hop E is on the shortest path from R2 to E and D1.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.2.%20%20Computing%20Node-Protecting%20Paths%20from%20PQ-Nodes%20to%20Destinations"></a><a class="selflink" href="#section-2.3.2" name="section-2.3.2">2.3.2</a>.  Computing Node-Protecting Paths from PQ-Nodes to Destinations</span>

   Once a computing router finds all the candidate node-protecting PQ-
   nodes for a given directly attached primary link, it shall follow the
   procedure as proposed in this section to choose one or more node-
   protecting R-LFA paths for destinations reachable through the same
   primary link in the primary SPF graph.

   To find a node-protecting R-LFA path for a given destination, the
   computing router needs to pick a subset of PQ-nodes from the
   candidate node-protecting PQ-space for the corresponding primary next
   hop, such that all the path(s) from the PQ-node(s) to the given
   destination remain unaffected in the event of a node failure of the
   primary next-hop node.  To determine whether a given PQ-node belongs
   to such a subset of PQ-nodes, the computing router MUST ensure that
   none of the primary next-hop nodes are found on any of the shortest
   paths from the PQ-node to the given destination.

   This document proposes an additional forward SPF computation for each
   of the PQ-nodes to discover all shortest paths from the PQ-nodes to
   the destination.  This will help determine whether or not a given
   primary next-hop node is on the shortest paths from the PQ-node to
   the given destination.  To determine whether or not a given candidate
   node-protecting PQ-node provides node-protecting alternate for a
   given destination, all the shortest paths from the PQ-node to the
   given destination have to be inspected to check if the primary next-
   hop node is found on any of these shortest paths.  To compute all the
   shortest paths from a candidate node-protecting PQ-node to one or
   more destinations, the computing router MUST run the forward SPF on
   the candidate node-protecting PQ-node.  Soon after running the
   forward SPF, the computer router SHOULD run the inequality in
   Figure 6 below, once for each destination.  A PQ-node that does not



<span class="grey">Sarkar, et al.               Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   qualify the condition for a given destination does not guarantee node
   protection for the path segment from the PQ-node to the specific
   destination.

   D_opt(Y,D) &lt; D_opt(Y,E) + Distance_opt(E,D)

   Where,
     D_opt(A,B) : Distance on the most optimum path from A to B.
             D  : The destination node.
             E  : The primary next hop on the shortest path from S
                  to destination.
             Y  : The node-protecting PQ-node being evaluated

      Figure 6: Node-Protecting Condition for PQ-Node to Destination

   All of the above metric costs, except D_opt(Y, D), can be obtained
   with forward and reverse SPFs with E (the primary next hop) as the
   root, run as part of the regular LFA and remote-LFA implementation.
   The Distance_opt(Y, D) metric can only be determined by the
   additional forward SPF run with PQ-node Y as the root.  With
   reference to the topology in Figure 2, Table 5 shows that the above
   condition can be used to determine node protection with a node-
   protecting PQ-node R2.

   +-------------+------------+---------+--------+---------+-----------+
   | Destination | Primary-NH |  D_opt  | D_opt  |  D_opt  | Condition |
   |     (D)     |    (E)     |  (Y, D) | (Y, E) |  (E, D) |    Met    |
   +-------------+------------+---------+--------+---------+-----------+
   |      R3     |     E      |    1    |   2    |    1    |    Yes    |
   |             |            | (R2,R3) | (R2,E) |  (E,R3) |           |
   |      E      |     E      |    2    |   2    | 0 (E,E) |     No    |
   |             |            |  (R2,E) | (R2,E) |         |           |
   |      D1     |     E      |    3    |   2    |    1    |     No    |
   |             |            | (R2,D1) | (R2,E) |  (E,D1) |           |
   |      D2     |     E      |    2    |   2    |    1    |    Yes    |
   |             |            | (R2,D2) | (R2,E) |  (E,D2) |           |
   +-------------+------------+---------+--------+---------+-----------+

    Table 5: Node-Protection Evaluation for R-LFA Path Segment between
                          PQ-Node and Destination

   As seen in the example above, R2 does not meet the node-protecting
   inequality for destination E and D1.  And so, once again, while R2 is
   a node-protecting remote-LFA next hop for R3 and D2, it is not so for
   E and D1.






<span class="grey">Sarkar, et al.               Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   In SPF implementations that also produce a list of links and nodes
   traversed on the shortest path(s) from a given root to others, the
   inequality in Figure 6 above need not be evaluated.  Instead, to
   determine whether or not a PQ-node provides node protection for a
   given destination, the list of nodes computed from forward SPF that
   run on the PQ-node for the given destination SHOULD be inspected.  In
   case the list contains the primary next-hop node, the PQ-node does
   not provide node protection.  Else, the PQ-node guarantees the node-
   protecting alternate for the given destination.  Below is an
   illustration of the mechanism with candidate node-protecting PQ-node
   R2 in the topology in Figure 2.

   +-------------+---------------------------+------------+------------+
   | Destination | Shortest Path (Repairing  | Link       | Node       |
   |             | router to PQ-node)        | Protection | Protection |
   +-------------+---------------------------+------------+------------+
   | R3          | R2-&gt;R3                    | Yes        | Yes        |
   | E           | R2-&gt;R3-&gt;E                 | Yes        | No         |
   | D1          | R2-&gt;R3-&gt;E-&gt;D1             | Yes        | No         |
   | D2          | R2-&gt;R3-&gt;D2                | Yes        | Yes        |
   +-------------+---------------------------+------------+------------+

        Table 6: Protection of Remote-LFA Path between PQ-node and
                                Destination

   As seen in the above example, while R2 is a candidate node-protecting
   R-LFA next hop for R3 and D2, it is not so for E and D1, since the
   primary next hop E is on the shortest path from R2 to E and D1.

   The procedure described in this document helps no more than to
   determine whether or not a given remote-LFA alternate provides node
   protection for a given destination.  It does not find out any new
   remote-LFA alternate next hops, outside the ones already computed by
   the standard remote-LFA procedure.  However, in the case of
   availability of more than one PQ-node (remote-LFA alternates) for a
   destination where node protection is required for the given primary
   next hop, this procedure will eliminate the PQ-nodes that do not
   provide node protection and choose only the ones that do.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.3.%20%20Computing%20Node-Protecting%20R-LFA%20Paths%20for%20Destinations%20with"></a><a class="selflink" href="#section-2.3.3" name="section-2.3.3">2.3.3</a>.  Computing Node-Protecting R-LFA Paths for Destinations with</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Multiple%20Primary%20Next-Hop%20Nodes"></a>        Multiple Primary Next-Hop Nodes</span>

   In certain scenarios, when one or more destinations may be reachable
   via multiple ECMP (equal-cost-multi-path) next-hop nodes and only
   link protection is required, there is no need to compute any
   alternate paths for such destinations.  In the event of failure of
   one of the next-hop links, the remaining primary next hops shall
   always provide link protection.  However, if node protection is



<span class="grey">Sarkar, et al.               Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   required, the rest of the primary next hops may not guarantee node
   protection.  Figure 7 below shows one such example topology.

                                    D1
                              2    /
                          S---x---E1
                         / \     / \
                        /   x   /   \
                       /     \ /     \
                      N-------E2      R3--D2
                       \  2          /
                        \           /
                         \         /
                         R1-------R2
                              2

   Primary Next hops:
     Destination D1 = [{ S-E1, E1}, {S-E2, E2}]
     Destination D2 = [{ S-E1, E1}, {S-E2, E2}]

          Figure 7: Topology with Multiple ECMP Primary Next Hops

   In the above example topology, costs of all links are 1, except the
   following links:

      Link: S-E1, Cost: 2

      Link: N-E2: Cost: 2

      Link: R1-R2: Cost: 2

   In the above topology, on computing router S, destinations D1 and D2
   are reachable via two ECMP next-hop nodes E1 and E2.  However, the
   primary paths via next-hop node E2 also traverse via the next-hop
   node E1.  So, in the event of node failure of next-hop node E1, both
   primary paths (via E1 and E2) become unavailable.  Hence, if node
   protection is desired for destinations D1 and D2, alternate paths
   that do not traverse any of the primary next-hop nodes E1 and E2 need
   to be computed.  In the above topology, the only alternate neighbor N
   does not provide such an LFA alternate path.  Hence, one or more
   R-LFA node-protecting alternate paths for destinations D1 and D2,
   needs to be computed.

   In the above topology, the link-protecting PQ-nodes are as follows:

      Primary Next Hop: E1, Link-Protecting PQ-Node: { R2 }

      Primary Next Hop: E2, Link-Protecting PQ-Node: { R2 }



<span class="grey">Sarkar, et al.               Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   To find one (or more) node-protecting R-LFA paths for destinations D1
   and D2, one (or more) node-protecting PQ-node(s) need to be
   determined first.  Inequalities specified in Sections <a href="#section-2.2.6.2">2.2.6.2</a> and
   2.2.6.3 can be evaluated to compute the node-protecting PQ-space for
   each of the next-hop nodes E1 and E2, as shown in Table 7 below.  To
   select a PQ-node as a node-protecting PQ-node for a destination with
   multiple primary next-hop nodes, the PQ-node MUST satisfy the
   inequality for all primary next-hop nodes.  Any PQ-node that is NOT a
   node-protecting PQ-node for all the primary next-hop nodes MUST NOT
   be chosen as the node-protecting PQ-node for the destination.

   +--------+----------+-------+--------+--------+---------+-----------+
   | Primary| Candidate| Direct| D_opt  | D_opt  |  D_opt  | Condition |
   |  Next  |   PQ-    |  Nbr  | (Ni,Y) | (Ni,E) |  (E,Y)  |    Met    |
   |  Hop   | node (Y) |  (Ni) |        |        |         |           |
   |  (E)   |          |       |        |        |         |           |
   +--------+----------+-------+--------+--------+---------+-----------+
   |   E1   |    R2    |   N   |   3    |   3    |    2    |    Yes    |
   |        |          |       | (N,R2) | (N,E1) | (E1,R2) |           |
   |   E2   |    R2    |   N   |   3    |   2    |    3    |    Yes    |
   |        |          |       | (N,R2) | (N,E2) | (E2,R2) |           |
   +--------+----------+-------+--------+--------+---------+-----------+

     Table 7: Computing Node-Protected PQ-Nodes for Next Hop E1 and E2

   In SPF implementations that also produce a list of links and nodes
   traversed on the shortest path(s) from a given root to others, the
   tunnel-repair paths from the computing router to candidate PQ-node
   can be examined to ensure that none of the primary next-hop nodes are
   traversed.  PQ-nodes that provide one or more Tunnel-repair paths
   that do not traverse any of the primary next-hop nodes are to be
   considered as node-protecting PQ-nodes.  Table 8 below shows the
   possible tunnel-repair paths to PQ-node R2.

   +--------------+------------+-------------------+-------------------+
   |  Primary-NH  |  PQ-Node   |   Tunnel-Repair   |    Exclude All    |
   |     (E)      |    (Y)     |       Paths       |     Primary-NH    |
   +--------------+------------+-------------------+-------------------+
   |    E1, E2    |     R2     |  S==&gt;N==&gt;R1==&gt;R2  |        Yes        |
   +--------------+------------+-------------------+-------------------+

                Table 8: Tunnel-Repair Paths to PQ-Node R2

   From Tables 7 and 8 in the example above, R2 is a node-protecting PQ-
   node for both primary next hops E1 and E2 and should be chosen as the
   node-protecting PQ-node for destinations D1 and D2 that are both
   reachable via the primary next-hop nodes E1 and E2.




<span class="grey">Sarkar, et al.               Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   Next, to find a node-protecting R-LFA path from a node-protecting PQ-
   node to destinations D1 and D2, inequalities specified in Figure 6
   should be evaluated to ensure that R2 provides a node-protecting
   R-LFA path for each of these destinations, as shown below in Table 9.
   For an R-LFA path to qualify as a node-protecting R-LFA path for a
   destination with multiple ECMP primary next-hop nodes, the R-LFA path
   from the PQ-node to the destination MUST satisfy the inequality for
   all primary next-hop nodes.

   +----------+----------+-------+--------+--------+--------+----------+
   | Destinat | Primary- |  PQ-  | D_opt  | D_opt  | D_opt  | Condition|
   | ion (D)  |  NH (E)  |  Node | (Y, D) | (Y, E) | (E, D) |   Met    |
   |          |          |  (Y)  |        |        |        |          |
   +----------+----------+-------+--------+--------+--------+----------+
   |    D1    |    E1    |   R2  | 3 (R2, | 2 (R2, | 1 (E1, |    No    |
   |          |          |       |  D1)   |  E1)   |  D1)   |          |
   |    D1    |    E2    |   R2  | 3 (R2, | 3 (R2, | 2 (E2, |   Yes    |
   |          |          |       |  D1)   |  E2)   |  D1)   |          |
   |    D2    |    E1    |   R2  | 2 (R2, | 2 (R2, | 2 (E1, |   Yes    |
   |          |          |       |  D2)   |  E1)   |  D2)   |          |
   |    D2    |    E2    |   R2  | 2 (R2, | 2 (R2, | 3 (E2, |   Yes    |
   |          |          |       |  D2)   |  E2)   |  D2)   |          |
   +----------+----------+-------+--------+--------+--------+----------+

              Table 9: Finding Node-Protecting R-LFA Path for
                          Destinations D1 and D2

   In SPF implementations that also produce a list of links and nodes
   traversed on the shortest path(s) from a given root to others, the
   R-LFA paths via a node-protecting PQ-node to the final destination
   can be examined to ensure that none of the primary next-hop nodes are
   traversed.  One or more R-LFA paths that do not traverse any of the
   primary next-hop nodes guarantees node protection in the event of
   failure of any of the primary next-hop nodes.  Table 10 shows the
   possible R-LFA-paths for destinations D1 and D2 via the node-
   protecting PQ-node R2.















<span class="grey">Sarkar, et al.               Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   +-------------+------------+---------+-----------------+------------+
   | Destination | Primary-NH | PQ-Node |   R-LFA Paths   |  Exclude   |
   |     (D)     |    (E)     |   (Y)   |                 |    All     |
   |             |            |         |                 | Primary-NH |
   +-------------+------------+---------+-----------------+------------+
   |      D1     |   E1, E2   |    R2   | S==&gt;N==&gt;R1==&gt;R2 |     No     |
   |             |            |         | --&gt;R3--&gt;E1--&gt;D1 |            |
   |             |            |         |                 |            |
   |      D2     |   E1, E2   |    R2   | S==&gt;N==&gt;R1==&gt;R2 |    Yes     |
   |             |            |         |    --&gt;R3--&gt;D2   |            |
   +-------------+------------+---------+-----------------+------------+

             Table 10: R-LFA Paths for Destinations D1 and D2

   From Tables 9 and 10 in the example above, the R-LFA path from R2
   does not meet the node-protecting inequality for destination D1,
   while it does meet the same inequality for destination D2.  So, while
   R2 provides a node-protecting R-LFA alternate for D2, it fails to
   provide node protection for destination D1.  Finally, while it is
   possible to get a node-protecting R-LFA path for D2, no such node-
   protecting R-LFA path can be found for D1.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.3.4.%20%20Limiting%20Extra%20Computational%20Overhead"></a><a class="selflink" href="#section-2.3.4" name="section-2.3.4">2.3.4</a>.  Limiting Extra Computational Overhead</span>

   In addition to the extra reverse SPF computations suggested by the
   Remote-LFA document [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] (one reverse SPF for each of the
   directly connected neighbors), this document proposes a forward SPF
   computation for each PQ-node discovered in the network.  Since the
   average number of PQ-nodes found in any network is considerably more
   than the number of direct neighbors of the computing router, the
   proposal of running one forward SPF per PQ-node may add considerably
   to the overall SPF computation time.

   To limit the computational overhead of the approach proposed, this
   document specifies that implementations MUST choose a subset from the
   entire set of PQ-nodes computed in the network, with a finite limit
   on the number of PQ-nodes in the subset.  Implementations MUST choose
   a default value for this limit and may provide the user with a
   configuration knob to override the default limit.  This document
   suggests 16 as a default value for this limit.  Implementations MUST
   also evaluate some default preference criteria while considering a
   PQ-node in this subset.  The exact default preference criteria to be
   used is outside the scope of this document and is a matter of
   implementation.  Finally, implementations MAY also allow the user to
   override the default preference criteria, by providing a policy
   configuration for the same.





<span class="grey">Sarkar, et al.               Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


   This document proposes that implementations SHOULD use a default
   preference criteria for PQ-node selection that will put a score on
   each PQ-node, proportional to the number of primary interfaces for
   which it provides coverage, its distance from the computing router,
   and its router-id (or system-id in case of IS-IS).  PQ-nodes that
   cover more primary interfaces SHOULD be preferred over PQ-nodes that
   cover fewer primary interfaces.  When two or more PQ-nodes cover the
   same number of primary interfaces, PQ-nodes that are closer (based on
   metric) to the computing router SHOULD be preferred over PQ-nodes
   farther away from it.  For PQ-nodes that cover the same number of
   primary interfaces and are the same distance from the computing
   router, the PQ-node with smaller router-id (or system-id in case of
   IS-IS) SHOULD be preferred.

   Once a subset of PQ-nodes is found, a computing router shall run a
   forward SPF on each of the PQ-nodes in the subset to continue with
   procedures proposed in <a href="#section-2.3.2">Section 2.3.2</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Manageability%20of%20Remote-LFA%20Alternate%20Paths"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Manageability of Remote-LFA Alternate Paths</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20The%20Problem"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  The Problem</span>

   With the regular remote-LFA [<a href="rfc7490.html" title='"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)"'>RFC7490</a>] functionality, the computing
   router may compute more than one PQ-node as usable remote-LFA
   alternate next hops.  Additionally, [<a href="rfc7916.html" title='"Operational Management of Loop-Free Alternates"'>RFC7916</a>] specifies an LFA (and a
   remote-LFA) manageability framework, in which an alternate selection
   policy may be configured to let the network operator choose one of
   them as the most appropriate remote-LFA alternates.  For such a
   policy-based alternate selection to run, the computing router needs
   to collect all the relevant path characteristics (as specified in
   <a href="rfc7916.html#section-6.2.4">Section 6.2.4 of [RFC7916]</a>) for each of the alternate paths (one
   through each of the PQ-nodes).  As mentioned before in <a href="#section-2.3">Section 2.3</a>,
   the R-LFA alternate path through a given PQ-node to a given
   destination is comprised of two path segments.  <a href="rfc7916.html#section-6.2.4">Section 6.2.4 of
   [RFC7916]</a> specifies that any kind of alternate selection policy must
   consider path characteristics for both path segments while evaluating
   one or more RLFA alternate paths.

   The first path segment (i.e., from the computing router to the PQ-
   node) can be calculated from the regular forward SPF done as part of
   standard and remote LFA computations.  However, without the mechanism
   proposed in <a href="#section-2.3.2">Section 2.3.2</a> of this document, there is no way to
   determine the path characteristics for the second path segment (i.e.,
   from the PQ-node to the destination).  In the absence of the path
   characteristics for the second path segment, two remote-LFA alternate
   paths may be equally preferred based on the first path segment
   characteristics only, although the second path segment attributes may
   be different.



<span class="grey">Sarkar, et al.               Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20The%20Solution"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  The Solution</span>

   The additional forward SPF computation proposed in <a href="#section-2.3.2">Section 2.3.2</a>
   shall also collect links, nodes, and path characteristics along the
   second path segment.  This shall enable the collection of complete
   path characteristics for a given remote-LFA alternate path to a given
   destination.  The complete alternate path characteristics shall then
   facilitate more accurate alternate path selection while running the
   alternate selection policy.

   As already specified in <a href="#section-2.3.4">Section 2.3.4</a>, to limit the computational
   overhead of the proposed approach, forward SPF computations must be
   run on a selected subset from the entire set of PQ-nodes computed in
   the network, with a finite limit on the number of PQ-nodes in the
   subset.  The detailed suggestion on how to select this subset is
   specified in the same section.  While this limits the number of
   possible alternate paths provided to the alternate-selection policy,
   this is needed to keep the computational complexity within affordable
   limits.  However, if the alternate-selection policy is very
   restrictive, this may leave few destinations in the entire topology
   without protection.  Yet this limitation provides a necessary
   tradeoff between extensive coverage and immense computational
   overhead.

   The mechanism proposed in this section does not modify or invalidate
   any part of [<a href="rfc7916.html" title='"Operational Management of Loop-Free Alternates"'>RFC7916</a>].  This document specifies a mechanism to meet
   the requirements specified in <a href="rfc7916.html#section-6.2.5.4">Section 6.2.5.4 of [RFC7916]</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  IANA Considerations</span>

   This document does not require any IANA actions.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   This document does not introduce any change in any of the protocol
   specifications.  It simply proposes to run an extra SPF rooted on
   each PQ-node discovered in the whole network.














<span class="grey">Sarkar, et al.               Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20References"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Normative%20References"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC5286" name="ref-RFC5286">RFC5286</a>]  Atlas, A., Ed. and A. Zinin, Ed., "Basic Specification for
              IP Fast Reroute: Loop-Free Alternates", <a href="rfc5286.html">RFC 5286</a>,
              DOI 10.17487/RFC5286, September 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5286">http://www.rfc-editor.org/info/rfc5286</a>&gt;.

   [<a id="ref-RFC7490" name="ref-RFC7490">RFC7490</a>]  Bryant, S., Filsfils, C., Previdi, S., Shand, M., and N.
              So, "Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)",
              <a href="rfc7490.html">RFC 7490</a>, DOI 10.17487/RFC7490, April 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7490">http://www.rfc-editor.org/info/rfc7490</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Informative%20References"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Informative References</span>

   [<a id="ref-RFC7916" name="ref-RFC7916">RFC7916</a>]  Litkowski, S., Ed., Decraene, B., Filsfils, C., Raza, K.,
              Horneffer, M., and P. Sarkar, "Operational Management of
              Loop-Free Alternates", <a href="rfc7916.html">RFC 7916</a>, DOI 10.17487/RFC7916,
              July 2016, &lt;<a href="http://www.rfc-editor.org/info/rfc7916">http://www.rfc-editor.org/info/rfc7916</a>&gt;.

Acknowledgements

   Many thanks to Bruno Decraene for providing his useful comments.  We
   would also like to thank Uma Chunduri for reviewing this document and
   providing valuable feedback.  Also, many thanks to Harish Raghuveer
   for his review and comments on the initial draft versions of this
   document.


















<span class="grey">Sarkar, et al.               Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc8102.html">RFC 8102</a>         R-LFA Node Protection and Manageability      March 2017</span>


Authors' Addresses

   Pushpasis Sarkar (editor)
   Arrcus, Inc.

   Email: pushpasis.ietf@gmail.com


   Shraddha Hegde
   Juniper Networks, Inc.
   Electra, Exora Business Park
   Bangalore, KA  560103
   India

   Email: shraddha@juniper.net


   Chris Bowers
   Juniper Networks, Inc.
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   United States of America

   Email: cbowers@juniper.net


   Hannes Gredler
   RtBrick, Inc.

   Email: hannes@rtbrick.com


   Stephane Litkowski
   Orange

   Email: stephane.litkowski@orange.com















Sarkar, et al.               Standards Track                   [Page 22]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc8102 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:15 GMT --></html>