<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6072 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-ietf-sipping-certs" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:6072" name="DC.Identifier"/>
<meta content="February, 2011" name="DC.Date.Issued"/>
<meta content="Jennings, Cullen" name="DC.Creator"/>
<meta content="Peterson, Jon" name="DC.Creator"/>
<meta content="Fischl, Jason" name="DC.Creator"/>
<meta content="This draft defines a Credential Service that allows Session Initiation
Protocol (SIP) User Agents (UAs) to use a SIP event package to
discover the certificates of other users. This mechanism allows user
agents that want to contact a given Address-of-Record (AOR) to
retrieve that AOR's certificate by subscribing to the Credential
Service, which returns an authenticated response containing that
certificate. The Credential Service also allows users to store and
retrieve their own certificates and private keys." name="DC.Description.Abstract"/>
<meta content="Certificate Management Service for The Session Initiation Protocol (SIP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6072 - Certificate Management Service for The Session Initiation Protocol (SIP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6072.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6072" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-sip-certs" title="draft-ietf-sip-certs">draft-ietf-sip-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6072" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6072" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6072" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=6072">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Internet Engineering Task Force (IETF)                       C. Jennings
Request for Comments: 6072                                 Cisco Systems
Category: Standards Track                                 J. Fischl, Ed.
ISSN: 2070-1721                                                    Skype
                                                           February 2011


Certificate Management Service for the Session Initiation Protocol (SIP)

Abstract

   This document defines a credential service that allows Session
   Initiation Protocol (SIP) User Agents (UAs) to use a SIP event
   package to discover the certificates of other users.  This mechanism
   allows User Agents that want to contact a given Address-of-Record
   (AOR) to retrieve that AOR's certificate by subscribing to the
   credential service, which returns an authenticated response
   containing that certificate.  The credential service also allows
   users to store and retrieve their own certificates and private keys.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6072">http://www.rfc-editor.org/info/rfc6072</a>.


















<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Definitions .....................................................<a href="#page-4">4</a>
   <a href="#section-3">3</a>. Overview ........................................................<a href="#page-4">4</a>
   <a href="#section-4">4</a>. UA Behavior with Certificates ...................................<a href="#page-7">7</a>
   <a href="#section-5">5</a>. UA Behavior with Credentials ....................................<a href="#page-8">8</a>
   <a href="#section-6">6</a>. Event Package Formal Definition for "certificate" ...............<a href="#page-9">9</a>
      <a href="#section-6.1">6.1</a>. Event Package Name .........................................<a href="#page-9">9</a>
      <a href="#section-6.2">6.2</a>. SUBSCRIBE Bodies ...........................................<a href="#page-9">9</a>
      <a href="#section-6.3">6.3</a>. Subscription Duration .....................................<a href="#page-10">10</a>
      <a href="#section-6.4">6.4</a>. NOTIFY Bodies .............................................<a href="#page-10">10</a>
      <a href="#section-6.5">6.5</a>. Subscriber Generation of SUBSCRIBE Requests ...............<a href="#page-10">10</a>
      <a href="#section-6.6">6.6</a>. Notifier Processing of SUBSCRIBE Requests .................<a href="#page-11">11</a>
      <a href="#section-6.7">6.7</a>. Notifier Generation of NOTIFY Requests ....................<a href="#page-11">11</a>
      <a href="#section-6.8">6.8</a>. Subscriber Processing of NOTIFY Requests ..................<a href="#page-11">11</a>
      <a href="#section-6.9">6.9</a>. Handling of Forked Requests ...............................<a href="#page-11">11</a>
      <a href="#section-6.10">6.10</a>. Rate of Notifications ....................................<a href="#page-12">12</a>
      <a href="#section-6.11">6.11</a>. State Agents and Lists ...................................<a href="#page-12">12</a>
      <a href="#section-6.12">6.12</a>. Behavior of a Proxy Server ...............................<a href="#page-12">12</a>




<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   <a href="#section-7">7</a>. Event Package Formal Definition for "credential" ...............<a href="#page-12">12</a>
      <a href="#section-7.1">7.1</a>. Event Package Name ........................................<a href="#page-12">12</a>
      <a href="#section-7.2">7.2</a>. SUBSCRIBE Bodies ..........................................<a href="#page-12">12</a>
      <a href="#section-7.3">7.3</a>. Subscription Duration .....................................<a href="#page-12">12</a>
      <a href="#section-7.4">7.4</a>. NOTIFY Bodies .............................................<a href="#page-13">13</a>
      <a href="#section-7.5">7.5</a>. Subscriber Generation of SUBSCRIBE Requests ...............<a href="#page-13">13</a>
      <a href="#section-7.6">7.6</a>. Notifier Processing of SUBSCRIBE Requests .................<a href="#page-14">14</a>
      <a href="#section-7.7">7.7</a>. Notifier Generation of NOTIFY Requests ....................<a href="#page-14">14</a>
      <a href="#section-7.8">7.8</a>. Generation of PUBLISH Requests ............................<a href="#page-15">15</a>
      <a href="#section-7.9">7.9</a>. Notifier Processing of PUBLISH Requests ...................<a href="#page-15">15</a>
      <a href="#section-7.10">7.10</a>. Subscriber Processing of NOTIFY Requests .................<a href="#page-16">16</a>
      <a href="#section-7.11">7.11</a>. Handling of Forked Requests ..............................<a href="#page-16">16</a>
      <a href="#section-7.12">7.12</a>. Rate of Notifications ....................................<a href="#page-16">16</a>
      <a href="#section-7.13">7.13</a>. State Agents and Lists ...................................<a href="#page-16">16</a>
      <a href="#section-7.14">7.14</a>. Behavior of a Proxy Server ...............................<a href="#page-16">16</a>
   <a href="#section-8">8</a>. Identity Signatures ............................................<a href="#page-16">16</a>
   <a href="#section-9">9</a>. Examples .......................................................<a href="#page-17">17</a>
      <a href="#section-9.1">9.1</a>. Encrypted Page Mode Instant Message .......................<a href="#page-17">17</a>
      <a href="#section-9.2">9.2</a>. Setting and Retrieving UA Credentials .....................<a href="#page-18">18</a>
   <a href="#section-10">10</a>. Security Considerations .......................................<a href="#page-19">19</a>
      <a href="#section-10.1">10.1</a>. Certificate Revocation ...................................<a href="#page-21">21</a>
      <a href="#section-10.2">10.2</a>. Certificate Replacement ..................................<a href="#page-22">22</a>
      <a href="#section-10.3">10.3</a>. Trusting the Identity of a Certificate ...................<a href="#page-22">22</a>
           <a href="#section-10.3.1">10.3.1</a>. Extra Assurance ...................................<a href="#page-23">23</a>
      <a href="#section-10.4">10.4</a>. SACRED Framework .........................................<a href="#page-24">24</a>
      <a href="#section-10.5">10.5</a>. Crypto Profiles ..........................................<a href="#page-24">24</a>
      <a href="#section-10.6">10.6</a>. User Certificate Generation ..............................<a href="#page-25">25</a>
      <a href="#section-10.7">10.7</a>. Private Key Storage ......................................<a href="#page-25">25</a>
      <a href="#section-10.8">10.8</a>. Compromised Authentication Service .......................<a href="#page-26">26</a>
   <a href="#section-11">11</a>. IANA Considerations ...........................................<a href="#page-26">26</a>
      <a href="#section-11.1">11.1</a>. Certificate Event Package ................................<a href="#page-27">27</a>
      <a href="#section-11.2">11.2</a>. Credential Event Package .................................<a href="#page-27">27</a>
      <a href="#section-11.3">11.3</a>. Identity Algorithm .......................................<a href="#page-27">27</a>
   <a href="#section-12">12</a>. Acknowledgments ...............................................<a href="#page-27">27</a>
   <a href="#section-13">13</a>. References ....................................................<a href="#page-28">28</a>
      <a href="#section-13.1">13.1</a>. Normative References .....................................<a href="#page-28">28</a>
      <a href="#section-13.2">13.2</a>. Informative References ...................................<a href="#page-29">29</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>], as amended by [<a href="rfc3853.html" title='"S/MIME Advanced Encryption Standard (AES) Requirement for the Session Initiation Protocol (SIP)"'>RFC3853</a>], provides a mechanism for end-to-
   end encryption and integrity using Secure/Multipurpose Internet Mail
   Extensions (S/MIME) [<a href="rfc5751.html" title='"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification"'>RFC5751</a>].  Several security properties of
   [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] depend on S/MIME, and yet it has not been widely deployed.
   One reason is the complexity of providing a reasonable certificate
   distribution infrastructure.  This specification proposes a way to
   address discovery, retrieval, and management of certificates for SIP
   deployments.  Combined with the SIP Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] specification,



<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   this specification allows users to have certificates that are not
   signed by any well known certification authority while still strongly
   binding the user's identity to the certificate.

   In addition, this specification provides a mechanism that allows SIP
   User Agents such as IP phones to enroll and get their credentials
   without any more configuration information than they commonly have
   today.  The end user expends no extra effort.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Definitions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Definitions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   Certificate:  A Public Key Infrastructure using X.509 (PKIX)-
      [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] style certificate containing a public key and a list of
      identities in the SubjectAltName that are bound to this key.  The
      certificates discussed in this document are generally self-signed
      and use the mechanisms in the SIP Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] specification
      to vouch for their validity.  Certificates that are signed by a
      certification authority can also be used with all the mechanisms
      in this document; however, they need not be validated by the
      receiver (although the receiver can validate them for extra
      assurance; see <a href="#section-10.3.1">Section 10.3.1</a>).

   Credential:  For this document, "credential" means the combination of
      a certificate and the associated private key.

   Password Phrase:  A password used to encrypt and decrypt a PKCS #8
      (Public Key Cryptographic System #8) private key.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Overview</span>

   The general approach is to provide a new SIP service referred to as a
   "credential service" that allows SIP User Agents (UAs) to subscribe
   to other users' certificates using a new SIP event package [<a href="rfc3265.html" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>RFC3265</a>].
   The certificate is delivered to the subscribing UA in a corresponding
   SIP NOTIFY request.  An authentication service as described in the
   SIP Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] specification can be used to vouch for the
   identity of the sender of the certificate by using the sender's proxy
   domain certificate to sign the NOTIFY request.  The authentication
   service is vouching that the sender is allowed to populate the SIP
   From header field value.  The sender of the message is vouching that
   this is an appropriate certificate for the user identified in the SIP
   From header field value.  The credential service can manage public
   certificates as well as the user's private keys.  Users can update
   their credentials, as stored on the credential service, using a SIP



<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   PUBLISH [<a href="rfc3903.html" title='"Session Initiation Protocol (SIP) Extension for Event State Publication"'>RFC3903</a>] request.  The UA authenticates to the credential
   service using a shared secret when a UA is updating a credential.
   Typically the shared secret will be the same one that is used by the
   UA to authenticate a REGISTER request with the Registrar for the
   domain (usually with SIP Digest Authentication).

   The following figure shows Bob publishing his credentials from one of
   his User Agents (e.g., his laptop software client), retrieving his
   credentials from another of his User Agents (e.g., his mobile phone),
   and then Alice retrieving Bob's certificate and sending a message to
   Bob.  SIP 200-class responses are omitted from the diagram to make
   the figure easier to understand.

                example.com domain
                ------------------
    Alice       Proxy  Auth   Cred               Bob1  Bob2
      |           |      |      | TLS Handshake    |    |
      |  [ Bob generates   ]    |&lt;---------------------&gt;|
      |  [ credentials and ]    | PUBLISH (credential)  |
      |  [ publishes them  ]    |&lt;----------------------|
      |           |      |      | Digest Challenge      |
      |           |      |      |----------------------&gt;|
      |           |      |      | PUBLISH + Digest      |
      |           |      |      |&lt;----------------------|
      |           |      |      |                  |
      |           |      |      | time passes...   |
      |           |      |      |                  |
      |           |      |      | TLS Handshake    |
      |   [ Bob later gets ]    |&lt;----------------&gt;|
      |   [ back his own   ]    | SUBSCRIBE        |
      |   [ credentials    ]    | (credential)     |
      |   [ at another     ]    |&lt;-----------------|
      |   [ User Agent     ]    | SUBSCRIBE+Digest |
      |           |      |      |&lt;-----------------|
      |           |      |      | NOTIFY           |
      |           |      |      |-----------------&gt;|
      |           |      |      | Bob decrypts key |
      |           |      |      |                  |
      |           |      |      |                  |
      | SUBSCRIBE (certificate) |    Alice fetches |
      |----------&gt;|-----&gt;|-----&gt;|    Bob's cert    |
      |           |      |NOTIFY|                  |
      | NOTIFY+Identity  |&lt;-----|                  |
      |&lt;----------+------|      |  Alice uses cert |
      |           |      |      |  to encrypt      |
      | MESSAGE   |      |      |  message to Bob  |
      |----------&gt;|------+------+-----------------&gt;|




<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   Bob's UA (Bob2) does a Transport Layer Security (TLS) [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>]
   handshake with the credential server to authenticate that the UA is
   connected to the correct credential server.  Then Bob's UA publishes
   his newly created or updated credentials.  The credential server
   challenges the UA using a Digest Authentication scheme to
   authenticate that the UA knows Bob's shared secret.  Once the UA is
   authenticated, the credential server stores Bob's credentials.

   Another of Bob's User Agents (Bob1) wants to fetch its current
   credentials.  It does a TLS [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] handshake with the credential
   server to authenticate that the UA is connected to the correct
   credential server.  Then Bob's UA subscribes for the credentials.
   The credential server challenges the UA to authenticate that the UA
   knows Bob's shared secret.  Once the UA is authenticated, the
   credential server sends a NOTIFY that contains Bob's credentials.
   The private key portion of the credential may have been encrypted
   with a secret that only Bob's UA (and not the credential server)
   knows.  In this case, once Bob's UA decrypts the private key, it will
   be ready to go.  Typically Bob's UA would do this when it first
   registers on the network.

   Some time later Alice decides that she wishes to discover Bob's
   certificate so that she can send him an encrypted message or so that
   she can verify the signature on a message from Bob.  Alice's UA sends
   a SUBSCRIBE message to Bob's AOR.  The proxy in Bob's domain routes
   this to the credential server via an "authentication service" as
   defined in [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>].  The credential server returns a NOTIFY that
   contains Bob's public certificate in the body.  This is routed
   through an authentication service that signs that this message really
   can validly claim to be from the AOR "sip:bob@example.com".  Alice's
   UA receives the certificate and can use it to encrypt a message to
   Bob.

   It is critical to understand that the only way that Alice can trust
   that the certificate really is the one for Bob and that the NOTIFY
   has not been spoofed is for Alice to check that the Identity
   [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] header field value is correct.

   The mechanism described in this document works for both self-signed
   certificates and certificates signed by well known certification
   authorities.  In order to deploy certificates signed by well known
   certification authorities, certification authorities would have to
   support adding SIP URIs to the SubjectAltName of the certificates
   they generate.  This is something that has been rarely implemented by
   commercial certification authorities.  However, most UAs would only
   use self-signed certificates and would use an authentication service
   as described in [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] to provide a strong binding of an AOR to
   the certificates.



<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   The mechanisms described in this document allow for three different
   styles of deployment:

   1.  Deployments where the credential server only stores certificates
       and does not store any private key information.  If the
       deployment had users with multiple devices, some other scheme
       (perhaps even manual provisioning) would be used to get the right
       private keys onto all the devices that a user employs.

   2.  Deployments where the credential server stores certificates and
       also stores an encrypted version of the private keys.  The
       credential server would not know or need the password phrase for
       decrypting the private key.  The credential server would help
       move the private keys between devices, but the user would need to
       enter a password phrase on each device to allow that device to
       decrypt (and encrypt) the private key information.

   3.  Deployments where the credential server generates and stores the
       certificates and private keys.  Deployments such as these may not
       use password phrases.  Consequently, the private keys are not
       encrypted inside the PKCS #8 objects.  This style of deployment
       would often have the credential server, instead of the devices,
       create the credentials.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20UA%20Behavior%20with%20Certificates"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  UA Behavior with Certificates</span>

   When a User Agent wishes to discover some other user's certificate,
   it subscribes to the "certificate" SIP event package as described in
   <a href="#section-6">Section 6</a> to get the certificate.  While the subscription is active,
   if the certificate is updated, the Subscriber will receive the
   updated certificate in a notification.

   The Subscriber needs to decide how long it is willing to trust that
   the certificate it receives is still valid.  If the certificate is
   revoked before it expires, the Notifier will send a notification with
   an empty body to indicate that the certificate is no longer valid.
   If the certificate is renewed before it expires, the Notifier will
   send a notification with a body containing the new certificate.  Note
   that the Subscriber might not receive the notification if an attacker
   blocks this traffic.  The amount of time that the Subscriber caches a
   certificate SHOULD be configurable.  A default of one day is
   RECOMMENDED.

   Note that the actual duration of the subscription is unrelated to the
   caching time or validity time of the corresponding certificate.
   Allowing subscriptions to persist after a certificate is no longer
   valid ensures that Subscribers receive the replacement certificate in
   a timely fashion.  The Notifier could return an immediate



<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   notification with the certificate in response to a subscribe request
   and then immediately terminate subscription, setting the reason
   parameter to "probation".  The Subscriber will have to periodically
   poll the Notifier to verify the validity of the certificate.

   If the UA uses a cached certificate in a request and receives a 437
   (Unsupported Certificate) response, it SHOULD remove the certificate
   it used from the cache and attempt to fetch the certificate again.
   If the certificate is changed, then the UA SHOULD retry the original
   request with the new certificate.  This situation usually indicates
   that the certificate was recently updated, and that the Subscriber
   has not received a corresponding notification.  If the certificate
   fetched is the same as the one that was previously in the cache, then
   the UA SHOULD NOT try the request again.  This situation can happen
   when the request is retargeted to a different user than the original
   request.  The 437 response is defined in [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>].

      Note: A UA that has a presence list MAY want to subscribe to the
      certificates of all the presentities in the list when the UA
      subscribes to their presence, so that when the user wishes to
      contact a presentity, the UA will already have the appropriate
      certificate.  Future specifications might consider the possibility
      of retrieving the certificates along with the presence documents.

   The details of how a UA deals with receiving encrypted messages is
   outside the scope of this specification.  It is worth noting that if
   Charlie's User Agent Server (UAS) receives a request that is
   encrypted to Bob, it would be valid and legal for that UA to send a
   302 redirecting the call to Bob.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20UA%20Behavior%20with%20Credentials"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  UA Behavior with Credentials</span>

   UAs discover their own credentials by subscribing to their AOR with
   an event type of "credential" as described in <a href="#section-7">Section 7</a>.  After a UA
   registers, it SHOULD retrieve its credentials by subscribing to them
   as described in <a href="#section-6.5">Section 6.5</a>.

   When a UA discovers its credential, the private key information might
   be encrypted with a password phrase.  The UA SHOULD request that the
   user enter the password phrase on the device, and the UA MAY cache
   this password phrase for future use.










<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   There are several different cases in which a UA should generate a new
   credential:

   o  If the UA receives a NOTIFY with no body for the credential
      package.

   o  If the certificate has expired.

   o  If the certificate's notAfter date is within the next 600 seconds,
      the UA SHOULD attempt to create replacement credentials.  The UA
      does this by waiting a random amount of time between 0 and
      300 seconds.  If no new credentials have been received in that
      time, the UA creates new credentials to replace the expiring ones
      and sends them in a PUBLISH request following the rules for
      modifying event state as described in <a href="rfc3903.html#section-4.4">Section 4.4 of [RFC3903]</a>.

   o  If the user of the device has indicated via the user interface
      that they wish to revoke the current certificate and issue a new
      one.

   Credentials are created by constructing a new key pair that will
   require appropriate randomness as described in [<a href="rfc4086.html" title='"Randomness Requirements for Security"'>RFC4086</a>] and then
   creating a certificate as described in <a href="#section-10.6">Section 10.6</a>.  The UA MAY
   encrypt the private key with a password phrase supplied by the user
   as specified in <a href="#section-10.5">Section 10.5</a>.  Next, the UA updates the user's
   credential by sending a PUBLISH [<a href="rfc3903.html" title='"Session Initiation Protocol (SIP) Extension for Event State Publication"'>RFC3903</a>] request with the
   credentials or just the certificate as described in <a href="#section-7.8">Section 7.8</a>.

   If a UA wishes to revoke the existing certificate without publishing
   a new one, it MUST send a PUBLISH with an empty body to the
   credential server.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Event%20Package%20Formal%20Definition%20for%20%22certificate%22"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Event Package Formal Definition for "certificate"</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Event%20Package%20Name"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Event Package Name</span>

   This document defines a SIP event package as defined in [<a href="rfc3265.html" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>RFC3265</a>].
   The event-package token name for this package is:

          certificate

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20SUBSCRIBE%20Bodies"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  SUBSCRIBE Bodies</span>

   This package does not define any SUBSCRIBE bodies.







<span class="grey">Jennings &amp; Fischl            Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Subscription%20Duration"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Subscription Duration</span>

   Subscriptions to this event package can range from no time to weeks.
   Subscriptions in days are more typical and are RECOMMENDED.  The
   default subscription duration for this event package is one day.

   The credential service is encouraged to keep the subscriptions active
   for AORs that are communicating frequently, but the credential
   service MAY terminate the subscription at any point in time.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20NOTIFY%20Bodies"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  NOTIFY Bodies</span>

   The body of a NOTIFY request for this package MUST either be empty or
   contain an application/pkix-cert body (as defined in [<a href="rfc2585.html" title='"Internet X.509 Public Key Infrastructure Operational Protocols: FTP and HTTP"'>RFC2585</a>]) that
   contains the certificate, unless an Accept header field has
   negotiated some other type.  The Content-Disposition MUST be set to
   "signal" as defined in [<a href="rfc3204.html" title='"MIME media types for ISUP and QSIG Objects"'>RFC3204</a>].

   A future extension MAY define other NOTIFY bodies.  If no "Accept"
   header field is present in the SUBSCRIBE, the body type defined in
   this document MUST be assumed.

   Implementations that generate large notifications are reminded to
   follow the message size restrictions for unreliable transports
   articulated in <a href="rfc3261.html#section-18.1.1">Section 18.1.1 of [RFC3261]</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20Subscriber%20Generation%20of%20SUBSCRIBE%20Requests"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  Subscriber Generation of SUBSCRIBE Requests</span>

   A UA discovers a certificate by sending a SUBSCRIBE request with an
   event type of "certificate" to the AOR for which a certificate is
   desired.  In general, the UA stays subscribed to the certificate for
   as long as it plans to use and cache the certificate, so that the UA
   can be notified about changes or revocations to the certificate.

   Subscriber User Agents will typically subscribe to certificate
   information for a period of hours or days, and automatically attempt
   to re-subscribe just before the subscription is completely expired.

   When a user de-registers from a device (logoff, power down of a
   mobile device, etc.), Subscribers SHOULD unsubscribe by sending a
   SUBSCRIBE request with an Expires header field of zero.










<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.6.%20%20Notifier%20Processing%20of%20SUBSCRIBE%20Requests"></a><a class="selflink" href="#section-6.6" name="section-6.6">6.6</a>.  Notifier Processing of SUBSCRIBE Requests</span>

   When a SIP credential server receives a SUBSCRIBE request with the
   certificate event-type, it is not necessary to authenticate the
   subscription request.  The Notifier MAY limit the duration of the
   subscription to an administrator-defined period of time.  The
   duration of the subscription does not correspond in any way to the
   period for which the certificate will be valid.

   When the credential server receives a SUBSCRIBE request for a
   certificate, it first checks to see if it has credentials for the
   requested URI.  If it does not have a certificate, it returns a
   NOTIFY request with an empty message body.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.7.%20%20Notifier%20Generation%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-6.7" name="section-6.7">6.7</a>.  Notifier Generation of NOTIFY Requests</span>

   Immediately after a subscription is accepted, the Notifier MUST send
   a NOTIFY with the current certificate, or an empty body if no
   certificate is available for the target user.  In either case it
   forms a NOTIFY with the From header field value set to the value of
   the To header field in the SUBSCRIBE request.  This server sending
   the NOTIFY needs either to implement an authentication service (as
   described in SIP Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>]) or else the server needs to be
   set up such that the NOTIFY request will be sent through an
   authentication service.  Sending the NOTIFY request through the
   authentication service requires the SUBSCRIBE request to have been
   routed through the authentication service, since the NOTIFY is sent
   within the dialog formed by the subscription.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.8.%20%20Subscriber%20Processing%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-6.8" name="section-6.8">6.8</a>.  Subscriber Processing of NOTIFY Requests</span>

   The resulting NOTIFY will contain an application/pkix-cert body that
   contains the requested certificate.  The UA MUST follow the
   procedures in <a href="#section-10.3">Section 10.3</a> to decide if the received certificate can
   be used.  The UA needs to cache this certificate for future use.  The
   maximum length of time for which it should be cached is discussed in
   <a href="#section-10.1">Section 10.1</a>.  The certificate MUST be removed from the cache if the
   certificate has been revoked (if a NOTIFY with an empty body is
   received), or if it is updated by a subsequent NOTIFY.  The UA MUST
   check that the NOTIFY is correctly signed by an authentication
   service as described in [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>].  If the identity asserted by the
   authentication service does not match the AOR that the UA subscribed
   to, the certificate in the NOTIFY is discarded and MUST NOT be used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.9.%20%20Handling%20of%20Forked%20Requests"></a><a class="selflink" href="#section-6.9" name="section-6.9">6.9</a>.  Handling of Forked Requests</span>

   This event package does not permit forked requests.  At most one
   subscription to this event type is permitted per resource.



<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.10.%20%20Rate%20of%20Notifications"></a><a class="selflink" href="#section-6.10" name="section-6.10">6.10</a>.  Rate of Notifications</span>

   Notifiers SHOULD NOT generate NOTIFY requests more frequently than
   once per minute.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.11.%20%20State%20Agents%20and%20Lists"></a><a class="selflink" href="#section-6.11" name="section-6.11">6.11</a>.  State Agents and Lists</span>

   The credential server described in this section that serves
   certificates is a state agent as defined in [<a href="rfc3265.html" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>RFC3265</a>], and
   implementations of the credential server MUST be implemented as a
   state agent.

   Implementers MUST NOT use the event list extension [<a href="rfc4662.html" title='"A Session Initiation Protocol (SIP) Event Notification Extension for Resource Lists"'>RFC4662</a>] with
   this event type.  It is not possible to make such an approach work,
   because the authentication service would have to simultaneously
   assert several different identities.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.12.%20%20Behavior%20of%20a%20Proxy%20Server"></a><a class="selflink" href="#section-6.12" name="section-6.12">6.12</a>.  Behavior of a Proxy Server</span>

   There are no additional requirements on a SIP proxy, other than to
   transparently forward the SUBSCRIBE and NOTIFY requests as required
   in SIP.  This specification describes the proxy, authentication
   service, and credential service as three separate services, but it is
   certainly possible to build a single SIP network element that
   performs all of these services at the same time.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Event%20Package%20Formal%20Definition%20for%20%22credential%22"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Event Package Formal Definition for "credential"</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Event%20Package%20Name"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Event Package Name</span>

   This document defines a SIP event package as defined in [<a href="rfc3265.html" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>RFC3265</a>].
   The event-package token name for this package is:

         credential

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20SUBSCRIBE%20Bodies"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  SUBSCRIBE Bodies</span>

   This package does not define any SUBSCRIBE bodies.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Subscription%20Duration"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Subscription Duration</span>

   Subscriptions to this event package can range from hours to one week.
   Subscriptions in days are more typical and are RECOMMENDED.  The
   default subscription duration for this event package is one day.

   The credential service SHOULD keep subscriptions active for UAs that
   are currently registered.




<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.4.%20%20NOTIFY%20Bodies"></a><a class="selflink" href="#section-7.4" name="section-7.4">7.4</a>.  NOTIFY Bodies</span>

   An implementation compliant to this specification MUST support the
   multipart/mixed type (see [<a href="rfc2046.html" title='"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types"'>RFC2046</a>]).  This allows a notification to
   contain multiple resource documents including at a minimum the
   application/pkix-cert body with the certificate and an application/
   pkcs8 body that has the associated private key information for the
   certificate.  The application/pkcs8 media type is defined in
   [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>].

   The absence of an Accept header in the SUBSCRIBE indicates support
   for multipart/mixed and the content types application/pkix-cert and
   application/pkcs8.  If an Accept header is present, these types MUST
   be included, in addition to any other types supported by the client.

   The application/pkix-cert body is a Distinguished Encoding Rules
   (DER)-encoded X.509v3 certificate [<a href="rfc2585.html" title='"Internet X.509 Public Key Infrastructure Operational Protocols: FTP and HTTP"'>RFC2585</a>].  The application/pkcs8
   body contains a DER-encoded [<a href="rfc5958.html" title='"Asymmetric Key Packages"'>RFC5958</a>] object that contains the
   private key.  The PKCS #8 objects MUST be of type PrivateKeyInfo.
   The integrity and confidentiality of the PKCS #8 objects are provided
   by the TLS transport.  The transport encoding of all the MIME bodies
   is binary.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.5.%20%20Subscriber%20Generation%20of%20SUBSCRIBE%20Requests"></a><a class="selflink" href="#section-7.5" name="section-7.5">7.5</a>.  Subscriber Generation of SUBSCRIBE Requests</span>

   A Subscriber User Agent will subscribe to its credential information
   for a period of hours or days and will automatically attempt to
   re-subscribe before the subscription has completely expired.

   The Subscriber SHOULD subscribe to its credentials whenever a new
   user becomes associated with the device (a new login).  The
   Subscriber SHOULD also renew its subscription immediately after a
   reboot, or when the Subscriber's network connectivity has just been
   re-established.

   The UA needs to authenticate with the credential service for these
   operations.  The UA MUST use TLS to directly connect to the server
   acting as the credential service or to a server that is authoritative
   for the domain of the credential service.  The UA MUST NOT connect
   through an intermediate proxy to the credential service.  The UA may
   be configured with a specific name for the credential service;
   otherwise, normal SIP routing is used.  As described in <a href="rfc3261.html">RFC 3261</a>, the
   TLS connection needs to present a certificate that matches the








<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   expected name of the server to which the connection was formed, so
   that the UA knows it is talking to the correct server.  Failing to do
   this may result in the UA publishing its private key information to
   an attacker.  The credential service will authenticate the UA using
   the usual SIP Digest mechanism, so the UA can expect to receive a SIP
   challenge to the SUBSCRIBE or PUBLISH requests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.6.%20%20Notifier%20Processing%20of%20SUBSCRIBE%20Requests"></a><a class="selflink" href="#section-7.6" name="section-7.6">7.6</a>.  Notifier Processing of SUBSCRIBE Requests</span>

   When a credential service receives a SUBSCRIBE for a credential, the
   credential service has to authenticate and authorize the UA, and
   validate that adequate transport security is being used.  Only a UA
   that can authenticate as being able to register as the AOR is
   authorized to receive the credentials for that AOR.  The credential
   service MUST challenge the UA to authenticate the UA and then decide
   if it is authorized to receive the credentials.  If authentication is
   successful, the Notifier MAY limit the duration of the subscription
   to an administrator-defined period of time.  The duration of the
   subscription MUST NOT be larger than the length of time for which the
   certificate is still valid.  The Expires header field SHOULD be set
   so that it is not longer than the notAfter date in the certificate.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.7.%20%20Notifier%20Generation%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-7.7" name="section-7.7">7.7</a>.  Notifier Generation of NOTIFY Requests</span>

   Once the UA has authenticated with the credential service and the
   subscription is accepted, the credential service MUST immediately
   send a Notify request.  The authentication service is applied to this
   NOTIFY request in the same way as the certificate subscriptions.  If
   the credential is revoked, the credential service MUST terminate any
   current subscriptions and force the UA to re-authenticate by sending
   a NOTIFY with its Subscription-State header field set to "terminated"
   and a reason parameter set to "deactivated".  (This causes a
   Subscriber to retry the subscription immediately.)  This is so that
   if a secret for retrieving the credentials gets compromised, the
   rogue UA will not continue to receive credentials after the
   compromised secret has been changed.

   Any time the credentials for this URI change, the credential service
   MUST send a new NOTIFY to any active subscriptions with the new
   credentials.

   The notification MUST be sent over TLS so that it is integrity
   protected, and the TLS needs to be directly connected between the UA
   and the credential service with no intermediaries.







<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.8.%20%20Generation%20of%20PUBLISH%20Requests"></a><a class="selflink" href="#section-7.8" name="section-7.8">7.8</a>.  Generation of PUBLISH Requests</span>

   A User Agent SHOULD be configurable to control whether it publishes
   the credential for a user or just the user's certificate.

   When publishing just a certificate, the body contains an application/
   pkix-cert.  When publishing a credential, the body contains a
   multipart/mixed containing both an application/pkix-cert and an
   application/pkcs8 body.

   When the UA sends the PUBLISH [<a href="rfc3903.html" title='"Session Initiation Protocol (SIP) Extension for Event State Publication"'>RFC3903</a>] request, it needs to do the
   following:

   o  The UA MUST use TLS to directly connect to the server acting as
      the credential service or to a server that is authoritative for
      the domain of the credential service.  The UA MUST NOT connect
      through an intermediate proxy to the credential service.

   o  The Expires header field value in the PUBLISH request SHOULD be
      set to match the time for which the certificate is valid.

   o  If the certificate includes Basic Constraints, it SHOULD set the
      cA boolean to false.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.9.%20%20Notifier%20Processing%20of%20PUBLISH%20Requests"></a><a class="selflink" href="#section-7.9" name="section-7.9">7.9</a>.  Notifier Processing of PUBLISH Requests</span>

   When the credential service receives a PUBLISH request to update
   credentials, it MUST authenticate and authorize this request in the
   same way as for subscriptions for credentials.  If the authorization
   succeeds, then the credential service MUST perform the following
   checks on the certificate:

   o  The notBefore validity time MUST NOT be in the future.

   o  The notAfter validity time MUST be in the future.

   o  If a cA BasicConstraints boolean is set in the certificate, it is
      set to FALSE.

   If all of these succeed, the credential service updates the
   credential for this URI, processes all the active certificates and
   credential subscriptions to this URI, and generates a NOTIFY request
   with the new credential or certificate.  Note the SubjectAltName
   SHOULD NOT be checked, as that would restrict which certificates
   could be used and offers no additional security guarantees.






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   If the Subscriber submits a PUBLISH request with no body and
   Expires=0, this revokes the current credentials.  Watchers of these
   credentials will receive an update with no body, indicating that they
   MUST stop any previously stored credentials.  Note that subscriptions
   to the certificate package are NOT terminated; each Subscriber to the
   certificate package receives a notification with an empty body.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.10.%20%20Subscriber%20Processing%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-7.10" name="section-7.10">7.10</a>.  Subscriber Processing of NOTIFY Requests</span>

   When the UA receives a valid NOTIFY request, it should replace its
   existing credentials with the new received ones.  If the UA cannot
   decrypt the PKCS #8 object, it MUST send a 437 (Unsupported
   Certificate) response.  Later, if the user provides a new password
   phrase for the private key, the UA can subscribe to the credentials
   again and attempt to decrypt with the new password phrase.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.11.%20%20Handling%20of%20Forked%20Requests"></a><a class="selflink" href="#section-7.11" name="section-7.11">7.11</a>.  Handling of Forked Requests</span>

   This event package does not permit forked requests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.12.%20%20Rate%20of%20Notifications"></a><a class="selflink" href="#section-7.12" name="section-7.12">7.12</a>.  Rate of Notifications</span>

   Notifiers SHOULD NOT generate NOTIFY requests more frequently than
   once per minute.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.13.%20%20State%20Agents%20and%20Lists"></a><a class="selflink" href="#section-7.13" name="section-7.13">7.13</a>.  State Agents and Lists</span>

   The credential server described in this section which serves
   credentials is a state agent, and implementations of the credential
   server MUST be implemented as a state agent.

   Implementers MUST NOT use the event list extension [<a href="rfc4662.html" title='"A Session Initiation Protocol (SIP) Event Notification Extension for Resource Lists"'>RFC4662</a>] with
   this event type.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.14.%20%20Behavior%20of%20a%20Proxy%20Server"></a><a class="selflink" href="#section-7.14" name="section-7.14">7.14</a>.  Behavior of a Proxy Server</span>

   The behavior is identical to behavior described for certificate
   subscriptions in <a href="#section-6.12">Section 6.12</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Identity%20Signatures"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Identity Signatures</span>

   The [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] authentication service defined a signature algorithm
   based on SHA-1 called rsa-sha1.  This specification adds a signature
   algorithm that is roughly the same but based on SHA-256 and called
   rsa-sha256.






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   When using the rsa-sha256 algorithm, the signature MUST be computed
   in exactly the same way as described in <a href="rfc4474.html#section-9">Section 9 of [RFC4474]</a> with
   the exception that instead of using sha1WithRSAEncryption, the
   computation is done using sha256WithRSAEncryption as described in
   [<a href="rfc5754.html" title='"Using SHA2 Algorithms with Cryptographic Message Syntax"'>RFC5754</a>].

   Implementations of this specification MUST implement both rsa-sha1
   and rsa-sha256.  The IANA registration for rsa-sha256 is defined in
   <a href="#section-11.3">Section 11.3</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Examples"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Examples</span>

   In all of these examples, large parts of the messages are omitted to
   highlight what is relevant to this document.  The lines in the
   examples that are prefixed by $ represent encrypted blocks of data.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Encrypted%20Page%20Mode%20Instant%20Message"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Encrypted Page Mode Instant Message</span>

   In this example, Alice sends Bob an encrypted page mode instant
   message.  Alice does not already have Bob's public key from previous
   communications, so she fetches Bob's public key from Bob's credential
   service:

   SUBSCRIBE sip:bob@biloxi.example.com SIP/2.0
   ...
   Event: certificate

   The credential service responds with the certificate in a NOTIFY.

   NOTIFY alice@atlanta.example.com  SIP/2.0
   Subscription-State: active; expires=7200
   ....
   From: &lt;sip:bob@biloxi.example.com&gt;;tag=1234
   Identity: ".... stuff removed ...."
   Identity-Info: &lt;https://atlanta.example.com/cert&gt;;alg=rsa-sha256
   ....
   Event: certificate
   Content-Type: application/pkix-cert
   Content-Disposition: signal

   &lt; certificate data &gt;










<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   Next, Alice sends a SIP MESSAGE to Bob and can encrypt the body using
   Bob's public key as shown below.

    MESSAGE sip:bob@biloxi.example.com SIP/2.0
    ...
    Content-Type: application/pkcs7-mime
    Content-Disposition: render

    $ Content-Type: text/plain
    $
    $ &lt; encrypted version of "Hello" &gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Setting%20and%20Retrieving%20UA%20Credentials"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Setting and Retrieving UA Credentials</span>

   When Alice's UA wishes to publish Alice's certificate and private key
   to the credential service, it sends a PUBLISH request like the one
   below.  This must be sent over a TLS connection directly to the
   domain of the credential service.  The credential service presents a
   certificate where the SubjectAltName contains an entry that matches
   the domain name in the request line of the PUBLISH request and
   challenges the request to authenticate her.

    PUBLISH sips:alice@atlanta.example.com SIP/2.0
    ...
    Event: credential
    Content-Type: multipart/mixed;boundary=boundary
    Content-Disposition: signal

    --boundary
    Content-ID: 123
    Content-Type: application/pkix-cert

    &lt; Public certificate for Alice &gt;
    --boundary
    Content-ID: 456
    Content-Type: application/pkcs8

    &lt; Private Key for Alice &gt;
    --boundary

   If one of Alice's UAs subscribes to the credential event, the
   credential service will challenge the request to authenticate her,
   and the NOTIFY will include a body similar to the one in the PUBLISH
   example above.







<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   The high-level message flow from a security point of view is
   summarized in the following figure.  The 200 responses are removed
   from the figure, as they do not have much to do with the overall
   security.

   In this figure, authC refers to authentication and authZ refers to
   authorization.

   Alice     Server              Bob UA
    |           | TLS Handshake    | 1) Client authC/Z server
    |           |&lt;----------------&gt;|
    |           | PUBLISH          | 2) Client sends request
    |           |&lt;-----------------|    (write credential)
    |           | Digest Challenge | 3) Server challenges client
    |           |-----------------&gt;|
    |           | PUBLISH + Digest | 4) Server authC/Z client
    |           |&lt;-----------------|
    |           |      time...     |
    |           |                  |
    |           | TLS Handshake    | 5) Client authC/Z server
    |           |&lt;----------------&gt;|
    |           | SUBSCRIBE        | 6) Client sends request
    |           |&lt;-----------------|    (read credential)
    |           | Digest Challenge | 7) Server challenges client
    |           |-----------------&gt;|
    |           | SUBSCRIBE+Digest | 8) Server authC/Z client
    |           |&lt;-----------------|
    |           | NOTIFY           | 9) Server returns credential
    |           |-----------------&gt;|
    |           |
    | SUBSCRIBE |   10) Client requests certificate
    |----------&gt;|
    |           |
    |NOTIFY+AUTH|   11) Server returns user's certificate and signs that
    |&lt;----------|       it is valid using certificate for the domain
    |           |

   When the UA, labeled Bob, first created a credential for Bob, it
   would store this on the credential server.  The UA authenticated the
   server using the certificates from the TLS handshake.  The server
   authenticated the UA using a digest-style challenge with a shared
   secret.

   The UA, labeled Bob, wishes to request its credentials from the
   server.  First, it forms a TLS connection to the server, which
   provides integrity and privacy protection and also authenticates the



<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   server to Bob's UA.  Next, the UA requests its credentials using a
   SUBSCRIBE request.  The server challenges the SUBSCRIBE Request to
   authenticate Bob's UA.  The server and Bob's UA have a shared secret
   that is used for this.  If the authentication is successful, the
   server sends the credentials to Bob's UA.  The private key in the
   credentials may have been encrypted using a shared secret that the
   server does not know.

   A similar process would be used for Bob's UA to publish new
   credentials to the server.  Bob's UA would send a PUBLISH request
   containing the new credentials.  When this happened, all the other
   UAs that were subscribed to Bob's credentials would receive a NOTIFY
   with the new credentials.

   Alice wishes to find Bob's certificate and sends a SUBSCRIBE to the
   server.  The server sends the response in a NOTIFY.  This does not
   need to be sent over a privacy or integrity protected channel, as the
   authentication service described in [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] provides integrity
   protection of this information and signs it with the certificate for
   the domain.

   This whole scheme is highly dependent on trusting the operators of
   the credential service and trusting that the credential service will
   not be compromised.  The security of all the users will be
   compromised if the credential service is compromised.

      Note: There has been significant discussion of the topic of
      avoiding deployments in which the credential servers store the
      private keys, even in some encrypted form that the credential
      server does not know how to decrypt.  Various schemes were
      considered to avoid this, but they all result in either moving the
      problem to some other server, which does not seem to make the
      problem any better, or having a different credential for each
      device.  For some deployments where each user has only one device,
      this is fine, but for deployments with multiple devices, it would
      require that when Alice went to contact Bob, Alice would have to
      provide messages encrypted for all of Bob's devices.  The SIPPING
      Working Group did consider this architecture and decided it was
      not appropriate due both to the information it revealed about the
      devices and users, and to the amount of signaling required to make
      it work.










<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   This specification requires that TLS be used for the SIP
   communications to place and retrieve a UA's private key.  This
   provides security in two ways:

   1.  Confidentiality is provided for the Digest Authentication
       exchange, thus protecting it from dictionary attacks.

   2.  Confidentiality is provided for the private key, thus protecting
       it from being exposed to passive attackers.

   In order to prevent man-in-the-middle attacks, TLS clients MUST check
   that the SubjectAltName of the certificate for the server they
   connected to exactly matches the server they were trying to connect
   to.  The TLS client must be directly connected to the correct server;
   otherwise, any intermediaries in the TLS path can compromise the
   certificate and instead provide a certificate for which the attacker
   knows the private key.  This may lead the UA that relies on this
   compromised certificate to lose confidential information.  Failing to
   use TLS or selecting a poor cipher suite (such as NULL encryption)
   may result in credentials, including private keys, being sent
   unencrypted over the network and will render the whole system
   useless.

   The correct checking of chained certificates as specified in TLS
   [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] is critical for the client to authenticate the server.  If
   the client does not authenticate that it is talking to the correct
   credential service, a man-in-the-middle attack is possible.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Certificate%20Revocation"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Certificate Revocation</span>

   If a particular credential needs to be revoked, the new credential is
   simply published to the credential service.  Every device with a copy
   of the old credential or certificate in its cache will have a
   subscription and will rapidly (order of seconds) be notified and
   replace its cache.  Clients that are not subscribed will subscribe
   when they next need to use the certificate and will get the new
   certificate.

   It is possible that an attacker could mount a denial-of-service (DoS)
   attack such that the UA that had cached a certificate did not receive
   the NOTIFY with its revocation.  To protect against this attack, the
   UA needs to limit how long it caches certificates.  After this time,
   the UA would invalidate the cached information, even though no NOTIFY
   had ever been received due to the attacker blocking it.

   The duration of this cached information is in some ways similar to a
   device deciding how often to check a Certificate Revocation List
   (CRL).  For many applications, a default time of one day is



<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   suggested, but for some applications it may be desirable to set the
   time to zero so that no certificates are cached at all and the
   credential is checked for validity every time the certificate is
   used.

   The UA MUST NOT cache the certificates for a period longer than that
   of the subscription duration.  This is to avoid the UA using invalid
   cached credentials when the Notifier of the new credentials has been
   prevented from updating the UA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Certificate%20Replacement"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Certificate Replacement</span>

   The UAs in the system replace the certificates close to the time that
   the certificates would expire.  If a UA has used the same key pair to
   encrypt a very large volume of traffic, the UA MAY choose to replace
   the credential with a new one before the normal expiration.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.3.%20%20Trusting%20the%20Identity%20of%20a%20Certificate"></a><a class="selflink" href="#section-10.3" name="section-10.3">10.3</a>.  Trusting the Identity of a Certificate</span>

   When a UA wishes to discover the certificate for
   sip:alice@example.com, the UA subscribes to the certificate for
   alice@example.com and receives a certificate in the body of a SIP
   NOTIFY request.  The term "original URI" is used to describe the URI
   that was in the To header field value of the SUBSCRIBE request.  So,
   in this case, the original URI would be sip:alice@example.com.

   If the certificate is signed by a trusted certification authority,
   and one of the names in the SubjectAltName matches the original URI,
   then this certificate MAY be used, but only for exactly the original
   URI and not for other identities found in the SubjectAltName.
   Otherwise, there are several steps the UA MUST perform before using
   this certificate.

   o  The From header field in the NOTIFY request MUST match the
      original URI that was subscribed to.

   o  The UA MUST check the Identity header field as described in the
      Identity [<a href="rfc4474.html" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>RFC4474</a>] specification to validate that bodies have not
      been tampered with and that an authentication service has
      validated this From header field.

   o  The UA MUST check the validity time of the certificate and stop
      using the certificate if it is invalid.  (Implementations are
      reminded to verify both the notBefore and notAfter validity
      times.)






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   o  The certificate MAY have several names in the SubjectAltName, but
      the UA MUST only use this certificate when it needs the
      certificate for the identity asserted by the authentication
      service in the NOTIFY.  This means that the certificate should
      only be indexed in the certificate cache by the AOR that the
      authentication service asserted and not by the value of all the
      identities found in the SubjectAltName list.

   These steps result in a chain of bindings that result in a trusted
   binding between the original AOR that was subscribed to and a public
   key.  The original AOR is forced to match the From header field.  The
   authentication service validates that this request did come from the
   identity claimed in the From header field value and that the bodies
   in the request that carry the certificate have not been tampered
   with.  The certificate in the body contains the public key for the
   identity.  Only the UA that can authenticate as this AOR, or devices
   with access to the private key of the domain, can tamper with this
   body.  This stops other users from being able to provide a false
   public key.  This chain of assertion from original URI, to From, to
   body, to public key is critical to the security of the mechanism
   described in this specification.  If any of the steps above are not
   followed, this chain of security will be broken and the system will
   not work.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/10.3.1.%20%20Extra%20Assurance"></a><a class="selflink" href="#section-10.3.1" name="section-10.3.1">10.3.1</a>.  Extra Assurance</span>

   Although the certificates used with this document need not be
   validatable to a trust anchor via PKIX [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] procedures,
   certificates that can be validated may also be distributed via this
   mechanism.  Such certificates potentially offer an additional level
   of security because they can be used with the secure (and partially
   isolated) certification authority user verification and key issuance
   toolset, rather than depending on the security of generic SIP
   implementations.

   When a relying party receives a certificate that is not self-signed,
   it MAY attempt to validate the certificate using the rules in
   <a href="rfc5280.html#section-6">Section 6 of [RFC5280]</a>.  If the certificate validates successfully
   and the names correctly match the user's AOR (see <a href="#section-10.6">Section 10.6</a>), then
   the implementation SHOULD provide some indication that the
   certificate has been validated with an external authority.  In
   general, failure to validate a certificate via this mechanism SHOULD
   NOT be used as a reason to reject the certificate.  However, if the
   certificate is revoked, then the implementation SHOULD reject it.







<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.4.%20%20SACRED%20Framework"></a><a class="selflink" href="#section-10.4" name="section-10.4">10.4</a>.  SACRED Framework</span>

   This specification includes a mechanism that allows end users to
   share the same credentials across different end-user devices.  This
   mechanism is based on the one presented in the Securely Available
   Credentials (SACRED) Framework [<a href="rfc3760.html" title='"Securely Available Credentials (SACRED) - Credential Server Framework"'>RFC3760</a>].  While this mechanism is
   fully described in this document, the requirements and background are
   more thoroughly discussed in [<a href="rfc3760.html" title='"Securely Available Credentials (SACRED) - Credential Server Framework"'>RFC3760</a>].

   Specifically, Sections <a href="#section-7.5">7.5</a>, <a href="#section-7.6">7.6</a>, and <a href="#section-7.9">7.9</a> follow the TLS with Client
   Authentication (cTLS) architecture described in <a href="rfc3760.html#section-4.2.2">Section 4.2.2 of
   [RFC3760]</a>.  The client authenticates the server using the server's
   TLS certificate.  The server authenticates the client using a SIP
   Digest transaction inside the TLS session.  The TLS sessions form a
   strong session key that is used to protect the credentials being
   exchanged.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.5.%20%20Crypto%20Profiles"></a><a class="selflink" href="#section-10.5" name="section-10.5">10.5</a>.  Crypto Profiles</span>

   Credential services SHOULD implement the server name indication
   extensions in [<a href="rfc4366.html" title='"Transport Layer Security (TLS) Extensions"'>RFC4366</a>].  As specified in [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>], credential
   services MUST support the TLS cipher suite
   TLS_RSA_WITH_AES_128_CBC_SHA.  In addition, they MUST support the TLS
   cipher suite TLS_RSA_WITH_AES_128_CBC_SHA256 as specified in
   [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>].  If additional cipher suites are supported, then
   implementations MUST NOT negotiate a cipher suite that employs NULL
   encryption, integrity, or authentication algorithms.

   Implementations of TLS typically support multiple versions of the
   Transport Layer Security protocol as well as the older Secure Socket
   Layer (SSL) protocol.  Because of known security vulnerabilities,
   clients and servers MUST NOT request, offer, or use SSL 2.0.  See
   <a href="rfc5246.html#appendix-E.2">Appendix E.2 of [RFC5246]</a> for further details.

   The PKCS #8 encryption in the clients MUST implement PBES2 with a key
   derivation algorithm of PBKDF2 using HMAC.  Clients MUST implement
   this HMAC with both SHA-1 [<a href="rfc3370.html" title='"Cryptographic Message Syntax (CMS) Algorithms"'>RFC3370</a>] and SHA-256 [<a href="rfc5754.html" title='"Using SHA2 Algorithms with Cryptographic Message Syntax"'>RFC5754</a>].  Clients
   MUST implement an encryption algorithm of id-aes128-wrap-pad as
   defined in [<a href="rfc5649.html" title='"Advanced Encryption Standard (AES) Key Wrap with Padding Algorithm"'>RFC5649</a>].  Some pre-standard deployments of this
   specification used DES-EDE2-CBC-Pad as defined in [<a href="rfc2898.html" title='"PKCS #5: Password-Based Cryptography Specification Version 2.0"'>RFC2898</a>] so, for
   some implementations, it may be desirable to also support that
   algorithm.  A different password SHOULD be used for the PKCS #8
   encryption than is used for authentication of the client.  It is
   important to choose sufficiently strong passwords.  Specific advice
   on the password can be found in <a href="rfc5959.html#section-6">Section 6 of [RFC5959]</a>.






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.6.%20%20User%20Certificate%20Generation"></a><a class="selflink" href="#section-10.6" name="section-10.6">10.6</a>.  User Certificate Generation</span>

   The certificates need to be consistent with [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>].  The
   sha1WithRSAEncryption and sha256WithRSAEncryption algorithms for the
   signatureAlgorithm MUST be implemented.  The Issuers SHOULD be the
   same as the subject.  Given the ease of issuing new certificates with
   this system, the Validity field can be relatively short.  A Validity
   value of one year or less is RECOMMENDED.  The SubjectAltName must
   have a URI type that is set to the SIP URL corresponding to the user
   AOR.  It MAY be desirable to put some randomness into the length of
   time for which the certificates are valid so that it does not become
   necessary to renew all the certificates in the system at the same
   time.

   When creating a new key pair for a certificate, it is critical to
   have appropriate randomness as described in [<a href="rfc4086.html" title='"Randomness Requirements for Security"'>RFC4086</a>].  This can be
   challenging on some embedded devices, such as some IP phones, and
   implementers should pay particular attention to this point.

   It is worth noting that a UA can discover the current time by looking
   at the Date header field value in the 200 response to a REGISTER
   request.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.7.%20%20Private%20Key%20Storage"></a><a class="selflink" href="#section-10.7" name="section-10.7">10.7</a>.  Private Key Storage</span>

   The protection afforded private keys is a critical security factor.
   On a small scale, failure of devices to protect the private keys will
   permit an attacker to masquerade as the user or decrypt their
   personal information.  As noted in the SACRED Framework, when stored
   on an end-user device, such as a diskette or hard drive, credentials
   SHOULD NOT be in the clear.  It is RECOMMENDED that private keys be
   stored securely in the device, more specifically, encrypting them
   using tamper-resistant hardware encryption and exposing them only
   when required: for example, the private key is decrypted when
   necessary to generate a digital signature, and re-encrypted
   immediately to limit exposure in the RAM to a short period of time.
   Some implementations may limit access to private keys by prompting
   users for a PIN prior to allowing access to the private key.













<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   On the server side, the protection of unencrypted PKCS #8 objects is
   equally important.  Failure of a server to protect the private keys
   would be catastrophic, as attackers with access to unencrypted
   PKCS #8 objects could masquerade as any user whose private key was
   not encrypted.  Therefore, it is also recommended that the private
   keys be stored securely in the server, more specifically, encrypting
   them using tamper-resistant hardware encryption and exposing them
   only when required.

   FIPS 140-2 [<a href="#ref-FIPS-140-2" title='"Security Requirements for Cryptographic Modules"'>FIPS-140-2</a>] provides useful guidance on secure storage.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.8.%20%20Compromised%20Authentication%20Service"></a><a class="selflink" href="#section-10.8" name="section-10.8">10.8</a>.  Compromised Authentication Service</span>

   One of the worst attacks against the Certificate Management Service
   described in this document would be if the authentication service
   were compromised.  This attack is somewhat analogous to a
   certification authority being compromised in traditional PKI systems.
   The attacker could make a fake certificate for which it knows the
   private key, use it to receive any traffic for a given use, and then
   re-encrypt that traffic with the correct key and forward the
   communication to the intended receiver.  The attacker would thus
   become a "man in the middle" in the communications.

   There is not too much that can be done to protect against this type
   of attack.  A UA MAY subscribe to its own certificate under some
   other identity to try to detect whether the credential server is
   handing out the correct certificates.  It will be difficult to do
   this in a way that does not allow the credential server to recognize
   the user's UA.

   The UA MAY also save the fingerprints of the cached certificates and
   warn users when the certificates change significantly before their
   expiry date.

   The UA MAY also allow the user to see the fingerprints of the cached
   certificates so that they can be verified by some other out-of-band
   means.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  IANA Considerations</span>

   This specification defines two new event packages that IANA has added
   to the "Session Initiation Protocol (SIP) Event Types Namespace"
   registry.








<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Certificate%20Event%20Package"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Certificate Event Package</span>

   To: ietf-sip-events@iana.org
   Subject: Registration of new SIP event package

   Package Name: certificate

   Is this registration for a template-package:  No

   Published Specification(s): This document

   New Event header parameters: This package defines no
                                new parameters

   Person &amp; email address to contact for further information:
     Cullen Jennings &lt;fluffy@cisco.com&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Credential%20Event%20Package"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Credential Event Package</span>

   To: ietf-sip-events@iana.org
   Subject: Registration of new SIP event package

   Package Name: credential

   Is this registration for a template-package:  No

   Published Specification(s): This document

   Person &amp; email address to contact for further information:
     Cullen Jennings &lt;fluffy@cisco.com&gt;

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.3.%20%20Identity%20Algorithm"></a><a class="selflink" href="#section-11.3" name="section-11.3">11.3</a>.  Identity Algorithm</span>

   IANA added the following entry to the "Identity-Info Algorithm
   Parameter Values" registry.

   "alg" Parameter Name    Reference
   ----------------------  ---------
   rsa-sha256              [<a href="rfc6072.html">RFC6072</a>]

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Acknowledgments"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Acknowledgments</span>

   Many thanks to Eric Rescorla, Russ Housley, Jim Schaad, Rohan Mahy,
   and Sean Turner for significant help, discussion, and text.  Many
   others provided useful comments and text, including Kumiko Ono, Peter
   Gutmann, Yaron Pdut, Aki Niemi, Magnus Nystrom, Paul Hoffman, Adina
   Simu, Dan Wing, Mike Hammer, Pasi Eronen, Alexey Melnikov, Tim Polk,
   John Elwell, Jonathan Rosenberg, and Lyndsay Campbell.



<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20References"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.1.%20%20Normative%20References"></a><a class="selflink" href="#section-13.1" name="section-13.1">13.1</a>.  Normative References</span>

   [<a id="ref-RFC2046" name="ref-RFC2046">RFC2046</a>]     Freed, N. and N. Borenstein, "Multipurpose Internet
                 Mail Extensions (MIME) Part Two: Media Types",
                 <a href="rfc2046.html">RFC 2046</a>, November 1996.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                 Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2585" name="ref-RFC2585">RFC2585</a>]     Housley, R. and P. Hoffman, "Internet X.509 Public Key
                 Infrastructure Operational Protocols: FTP and HTTP",
                 <a href="rfc2585.html">RFC 2585</a>, May 1999.

   [<a id="ref-RFC3204" name="ref-RFC3204">RFC3204</a>]     Zimmerer, E., Peterson, J., Vemuri, A., Ong, L., Audet,
                 F., Watson, M., and M. Zonoun, "MIME media types for
                 ISUP and QSIG Objects", <a href="rfc3204.html">RFC 3204</a>, December 2001.

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]     Rosenberg, J., Schulzrinne, H., Camarillo, G.,
                 Johnston, A., Peterson, J., Sparks, R., Handley, M.,
                 and E. Schooler, "SIP: Session Initiation Protocol",
                 <a href="rfc3261.html">RFC 3261</a>, June 2002.

   [<a id="ref-RFC3265" name="ref-RFC3265">RFC3265</a>]     Roach, A., "Session Initiation Protocol (SIP)-Specific
                 Event Notification", <a href="rfc3265.html">RFC 3265</a>, June 2002.

   [<a id="ref-RFC3370" name="ref-RFC3370">RFC3370</a>]     Housley, R., "Cryptographic Message Syntax (CMS)
                 Algorithms", <a href="rfc3370.html">RFC 3370</a>, August 2002.

   [<a id="ref-RFC3903" name="ref-RFC3903">RFC3903</a>]     Niemi, A., "Session Initiation Protocol (SIP) Extension
                 for Event State Publication", <a href="rfc3903.html">RFC 3903</a>, October 2004.

   [<a id="ref-RFC4474" name="ref-RFC4474">RFC4474</a>]     Peterson, J. and C. Jennings, "Enhancements for
                 Authenticated Identity Management in the Session
                 Initiation Protocol (SIP)", <a href="rfc4474.html">RFC 4474</a>, August 2006.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]     Dierks, T. and E. Rescorla, "The Transport Layer
                 Security (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>,
                 August 2008.

   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]     Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
                 Housley, R., and W. Polk, "Internet X.509 Public Key
                 Infrastructure Certificate and Certificate Revocation
                 List (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, May 2008.






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


   [<a id="ref-RFC4086" name="ref-RFC4086">RFC4086</a>]     Eastlake, D., Schiller, J., and S. Crocker, "Randomness
                 Requirements for Security", <a href="https://tools.ietf.org/html/bcp106">BCP 106</a>, <a href="rfc4086.html">RFC 4086</a>,
                 June 2005.

   [<a id="ref-RFC4366" name="ref-RFC4366">RFC4366</a>]     Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen,
                 J., and T. Wright, "Transport Layer Security (TLS)
                 Extensions", <a href="rfc4366.html">RFC 4366</a>, April 2006.

   [<a id="ref-RFC5754" name="ref-RFC5754">RFC5754</a>]     Turner, S., "Using SHA2 Algorithms with Cryptographic
                 Message Syntax", <a href="rfc5754.html">RFC 5754</a>, January 2010.

   [<a id="ref-RFC5649" name="ref-RFC5649">RFC5649</a>]     Housley, R. and M. Dworkin, "Advanced Encryption
                 Standard (AES) Key Wrap with Padding Algorithm",
                 <a href="rfc5649.html">RFC 5649</a>, September 2009.

   [<a id="ref-RFC5958" name="ref-RFC5958">RFC5958</a>]     Turner, S., "Asymmetric Key Packages", <a href="rfc5958.html">RFC 5958</a>,
                 August 2010.

   [<a id="ref-RFC5959" name="ref-RFC5959">RFC5959</a>]     Turner, S., "Algorithms for Asymmetric Key Package
                 Content Type", <a href="rfc5959.html">RFC 5959</a>, August 2010.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/13.2.%20%20Informative%20References"></a><a class="selflink" href="#section-13.2" name="section-13.2">13.2</a>.  Informative References</span>

   [<a id="ref-RFC2898" name="ref-RFC2898">RFC2898</a>]     Kaliski, B., "PKCS #5: Password-Based Cryptography
                 Specification Version 2.0", <a href="rfc2898.html">RFC 2898</a>, September 2000.

   [<a id="ref-RFC3760" name="ref-RFC3760">RFC3760</a>]     Gustafson, D., Just, M., and M. Nystrom, "Securely
                 Available Credentials (SACRED) - Credential Server
                 Framework", <a href="rfc3760.html">RFC 3760</a>, April 2004.

   [<a id="ref-RFC3853" name="ref-RFC3853">RFC3853</a>]     Peterson, J., "S/MIME Advanced Encryption Standard
                 (AES) Requirement for the Session Initiation Protocol
                 (SIP)", <a href="rfc3853.html">RFC 3853</a>, July 2004.

   [<a id="ref-RFC4662" name="ref-RFC4662">RFC4662</a>]     Roach, A., Campbell, B., and J. Rosenberg, "A Session
                 Initiation Protocol (SIP) Event Notification Extension
                 for Resource Lists", <a href="rfc4662.html">RFC 4662</a>, August 2006.

   [<a id="ref-RFC5751" name="ref-RFC5751">RFC5751</a>]     Ramsdell, B. and S. Turner, "Secure/Multipurpose
                 Internet Mail Extensions (S/MIME) Version 3.2 Message
                 Specification", <a href="rfc5751.html">RFC 5751</a>, January 2010.

   [<a id="ref-FIPS-140-2" name="ref-FIPS-140-2">FIPS-140-2</a>]  NIST, "Security Requirements for Cryptographic
                 Modules", May 2001, &lt;<a href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">http://csrc.nist.gov/publications/</a>
                 <a href="http://csrc.nist.gov/publications/fips/fips140-2/fips1402.pdf">fips/fips140-2/fips1402.pdf</a>&gt;.






<span class="grey">Jennings &amp; Fischl            Standards Track                   [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc6072.html">RFC 6072</a>                    SIP Certificates               February 2011</span>


Authors' Addresses

   Cullen Jennings
   Cisco Systems
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   Phone: +1 408 421-9990
   EMail: fluffy@cisco.com


   Jason Fischl (editor)
   Skype
   3210 Porter Drive
   Palo Alto, CA  94304
   USA

   Phone: +1-415-202-5192
   EMail: jason.fischl@skype.net































Jennings &amp; Fischl            Standards Track                   [Page 30]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6072 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --></html>