<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from tools.ietf.org/html/rfc6239 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:48:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129c" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
<meta name="DC.Identifier" content="urn:ietf:rfc:6239" />
<meta name="DC.Description.Abstract" content="This document describes the architecture of a Suite B compliant
implementation of the Secure Shell Transport Layer Protocol and the
Secure Shell Authentication Protocol. Suite B secure shell makes use
of elliptic curve Diffie-Hellmann (ECDH) key agreement, the elliptic
curve digital signature algorithm (ECDSA), the Advanced Encryption
Standard running in Galois Counter Mode (AES-GCM), two members of the
SHA-2 family of hashes (SHA-256 and SHA-384), and X.509 certificates." />
<meta name="DC.Creator" content="K. Igoe" />
<meta name="DC.Date.Issued" content="May, 2011" />
<meta name="DC.Title" content="Suite B Cryptographic Suites for Secure Shell (SSH)" />

    <link rel="icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <link rel="shortcut icon" href="https://tools.ietf.org/images/rfc.png" type="image/png" />
    <title>RFC 6239 - Suite B Cryptographic Suites for Secure Shell (SSH)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo bggrey"
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6239.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6239" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-igoe-secsh-suiteb" title="draft-igoe-secsh-suiteb">draft-igoe-secs...</a>] [<a href='https://datatracker.ietf.org/doc/rfc6239' title='IESG Datatracker information for this document'>Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6239" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6239" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=6239&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                                HISTORIC</span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Internet Engineering Task Force (IETF)                           K. Igoe
Request for Comments: 6239                      National Security Agency
Category: Informational                                         May 2011
ISSN: 2070-1721


          <span class="h1">Suite B Cryptographic Suites for Secure Shell (SSH)</span>

Abstract

   This document describes the architecture of a Suite B compliant
   implementation of the Secure Shell Transport Layer Protocol and the
   Secure Shell Authentication Protocol.  Suite B Secure Shell makes use
   of the elliptic curve Diffie-Hellman (ECDH) key agreement, the
   elliptic curve digital signature algorithm (ECDSA), the Advanced
   Encryption Standard running in Galois/Counter Mode (AES-GCM), two
   members of the SHA-2 family of hashes (SHA-256 and SHA-384), and
   X.509 certificates.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section&nbsp;2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6239">http://www.rfc-editor.org/info/rfc6239</a>.

















<span class="grey">Igoe                          Informational                     [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Suite B and Secure Shell ........................................<a href="#page-3">3</a>
      <a href="#section-2.1">2.1</a>. Minimum Levels of Security (minLOS) ........................<a href="#page-4">4</a>
      <a href="#section-2.2">2.2</a>. Digital Signatures and Certificates ........................<a href="#page-4">4</a>
      <a href="#section-2.3">2.3</a>. Non-Signature Primitives ...................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Security Mechanism Negotiation and Initialization ...............<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. Algorithm Negotiation: SSH_MSG_KEXINIT .....................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Key Exchange and Server Authentication ..........................<a href="#page-8">8</a>
      <a href="#section-4.1">4.1</a>. SSH_MSG_KEXECDH_INIT .......................................<a href="#page-9">9</a>
      <a href="#section-4.2">4.2</a>. SSH_MSG_KEXECDH_REPLY ......................................<a href="#page-9">9</a>
      <a href="#section-4.3">4.3</a>. Key and Initialization Vector Derivation ..................<a href="#page-10">10</a>
   <a href="#section-5">5</a>. User Authentication ............................................<a href="#page-10">10</a>
      <a href="#section-5.1">5.1</a>. First SSH_MSG_USERAUTH_REQUEST Message ....................<a href="#page-10">10</a>
      <a href="#section-5.2">5.2</a>. Second SSH_MSG_USERAUTH_REQUEST Message ...................<a href="#page-11">11</a>
   <a href="#section-6">6</a>. Confidentiality and Data Integrity of SSH Binary Packets .......<a href="#page-12">12</a>
      <a href="#section-6.1">6.1</a>. Galois/Counter Mode .......................................<a href="#page-12">12</a>
      <a href="#section-6.2">6.2</a>. Data Integrity ............................................<a href="#page-12">12</a>
   <a href="#section-7">7</a>. Rekeying .......................................................<a href="#page-12">12</a>
   <a href="#section-8">8</a>. Security Considerations ........................................<a href="#page-13">13</a>
   <a href="#section-9">9</a>. References .....................................................<a href="#page-13">13</a>
      <a href="#section-9.1">9.1</a>. Normative References ......................................<a href="#page-13">13</a>
      <a href="#section-9.2">9.2</a>. Informative References ....................................<a href="#page-13">13</a>












<span class="grey">Igoe                          Informational                     [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   This document describes the architecture of a Suite B compliant
   implementation of the Secure Shell Transport Layer Protocol and the
   Secure Shell Authentication Protocol.  Suite B Secure Shell makes use
   of the elliptic curve Diffie-Hellman (ECDH) key agreement, the
   elliptic curve digital signature algorithm (ECDSA), the Advanced
   Encryption Standard running in Galois/Counter Mode (AES-GCM), two
   members of the SHA-2 family of hashes (SHA-256 and SHA-384), and
   X.509 certificates.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>].

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Suite B and Secure Shell</span>

   Several RFCs have documented how each of the Suite B components are
   to be integrated into Secure Shell (SSH):

     kex algorithms
           ecdh-sha2-nistp256           [<a href="#ref-SSH-ECC" title="&quot;Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer&quot;">SSH-ECC</a>]
           ecdh-sha2-nistp384           [<a href="#ref-SSH-ECC" title="&quot;Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer&quot;">SSH-ECC</a>]

     server host key algorithms
           x509v3-ecdsa-sha2-nistp256   [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>]
           x509v3-ecdsa-sha2-nistp384   [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>]

     encryption algorithms (both client_to_server and server_to_client)
           AEAD_AES_128_GCM             [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>]
           AEAD_AES_256_GCM             [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>]

     MAC algorithms (both client_to_server and server_to_client)
           AEAD_AES_128_GCM             [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>]
           AEAD_AES_256_GCM             [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>]

   In Suite B, public key certificates used to verify signatures MUST be
   compliant with the Suite B Certificate Profile specified in <a href="rfc5759.html">RFC 5759</a>
   [<a href="#ref-SUITEBCERT" title="&quot;Suite B Certificate and Certificate Revocation List (CRL) Profile&quot;">SUITEBCERT</a>].

   The purpose of this document is to draw upon all of these documents
   to provide guidance for Suite B compliant implementations of Secure
   Shell (hereafter referred to as "SecSh-B").  Note that while SecSh-B
   MUST follow the guidance in this document, that requirement does not
   in and of itself imply that a given implementation of Secure Shell is
   suitable for use in protecting classified data.  An implementation of
   SecSh-B must be validated by the appropriate authority before such
   usage is permitted.



<span class="grey">Igoe                          Informational                     [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


   The two elliptic curves used in Suite B appear in the literature
   under two different names.  For the sake of clarity, we list both
   names below.

      Curve        NIST name        SECG name     OID [<a href="#ref-SEC2" title="&quot;Recommended Elliptic Curve Domain Parameters&quot;">SEC2</a>]
      ---------------------------------------------------------------
      P-256        nistp256         secp256r1     1.2.840.10045.3.1.7
      P-384        nistp384         secp384r1     1.3.132.0.34

   A description of these curves can be found in [<a href="#ref-NIST" title="&quot;Digital Signature Standard (DSS)&quot;">NIST</a>] or [<a href="#ref-SEC2" title="&quot;Recommended Elliptic Curve Domain Parameters&quot;">SEC2</a>].

   For the sake of brevity, ECDSA-256 will be used to denote ECDSA on
   P-256 using SHA-256, and ECDSA-384 will be used to denote ECDSA on
   P-384 using SHA-384.

<span class="h3"><a class="selflink" name="section-2.1" href="#section-2.1">2.1</a>.  Minimum Levels of Security (minLOS)</span>

   Suite B provides for two levels of cryptographic security, namely a
   128-bit minimum level of security (minLOS_128) and a 192-bit minimum
   level of security (minLOS_192).  As we shall see below, the
   ECDSA-256/384 signature algorithms and corresponding X.509v3
   certificates are treated somewhat differently than the non-signature
   primitives (kex algorithms, encryption algorithms, and Message
   Authentication Code (MAC) algorithms in Secure Shell parlance).

<span class="h3"><a class="selflink" name="section-2.2" href="#section-2.2">2.2</a>.  Digital Signatures and Certificates</span>

   SecSh-B uses ECDSA-256/384 for server authentication, user
   authentication, and in X.509 certificates.  [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>] defines two
   methods, x509v3-ecdsa-sha2-nistp256 and x509v3-ecdsa-sha2-nistp384,
   that are to be used for server and user authentication.  The
   following conditions must be met:

   1) The server MUST share its public key with the host using an
      X.509v3 certificate as described in [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>].  This public key
      MUST be used to authenticate the server to the host using
      ECDSA-256 or ECDSA-384 as appropriate (see <a href="#section-3">Section 3</a>).

   2) User authentication MUST begin with public key authentication
      using ECDSA-256/384 with X.509v3 certificates (see <a href="#section-4">Section 4</a>).
      Additional user authentication methods MAY be used, but only after
      the certificate-based ECDSA authentication has been successfully
      completed.

   3) The X.509v3 certificates MUST use only the two Suite B digital
      signatures, ECDSA-256 and ECDSA-384.

   4) ECDSA-256 MUST NOT be used to sign an ECDSA-384 public key.



<span class="grey">Igoe                          Informational                     [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


   5) ECDSA-384 MAY be used to sign an ECDSA-256 public key.

   6) At minLOS_192, all SecSh-B implementations MUST be able to verify
      ECDSA-384 signatures.

   7) At minLOS_128, all SecSh-B implementations MUST be able to verify
      ECDSA-256 signatures and SHOULD be able to verify ECDSA-384
      signatures, unless it is absolutely certain that the
      implementation will never need to verify certificates originating
      from an authority that uses an ECDSA-384 signing key.

   8) At minLOS_128, each SecSh-B server and each SecSh-B user MUST have
      either an ECDSA-256 signing key with a corresponding X.509v3
      certificate, an ECDSA-384 signing key with a corresponding X.509v3
      certificate, or both.

   9) At minLOS_192, each SecSh-B server and each SecSh-B user MUST have
      an ECDSA-384 signing key with a corresponding X.509v3 certificate.

   The selection of the signature algorithm to be used for server
   authentication is governed by the server_host_key_algorithms name-
   list in the SSH_MSG_KEXINIT packet (see <a href="#section-3.1">Section 3.1</a>).  The key
   exchange and server authentication are performed by the
   SSH_MSG_KEXECDH_REPLY packets (see <a href="#section-4">Section 4</a>).  User authentication
   is done via the SSH_MSG_USERAUTH_REQUEST messages (see <a href="#section-5">Section 5</a>).

<span class="h3"><a class="selflink" name="section-2.3" href="#section-2.3">2.3</a>.  Non-Signature Primitives</span>

   This section covers the constraints that the choice of minimum
   security level imposes upon the selection of a key agreement protocol
   (kex algorithm), encryption algorithm, and data integrity algorithm
   (MAC algorithm).  We divide the non-signature algorithms into two
   families, as shown in Table 1.

      +--------------+----------------------+----------------------+
      |  Algorithm   |  Family 1            |  Family 2            |
      +==============+======================+======================+
      |  kex         |  ecdh-sha2-nistp256  |  ecdh-sha2-nistp384  |
      +--------------+----------------------+----------------------+
      |  encryption  |  AEAD_AES_128_GCM    |  AEAD_AES_256_GCM    |
      +--------------+----------------------+----------------------+
      |  MAC         |  AEAD_AES_128_GCM    |  AEAD_AES_256_GCM    |
      +--------------+-----------------------+---------------------+

        Table 1.  Families of Non-Signature Algorithms in SecSh-B






<span class="grey">Igoe                          Informational                     [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


   At the 128-bit minimum level of security:

   o  The non-signature algorithms MUST either come exclusively from
      Family 1 or exclusively from Family 2.

   o  The selection of Family 1 versus Family 2 is independent of the
      choice of server host key algorithm.

   At the 192-bit minimum level of security:

   o  The non-signature algorithms MUST all come from Family 2.

   Most of the constraints described in this section can be achieved by
   severely restricting the kex_algorithm, encryption_algorithm, and
   mac_algorithm name lists offered in the SSH_MSG_KEXINIT packet.  See
   <a href="#section-3.1">Section 3.1</a> for details.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  Security Mechanism Negotiation and Initialization</span>

   As described in [<a href="#ref-SSH-Tran" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">SSH-Tran</a>], the exchange of SSH_MSG_KEXINIT between
   the server and the client establishes which key agreement algorithm,
   MAC algorithm, host key algorithm (server authentication algorithm),
   and encryption algorithm are to be used.  This section describes how
   the Suite B components are to be used in the Secure Shell algorithm
   negotiation, key agreement, server authentication, and user
   authentication.

   Negotiation and initialization of a Suite B Secure Shell connection
   involves the following Secure Shell messages (where C-&gt;S denotes a
   message from the client to the server, and S-&gt;C denotes a server-to-
   client message):

      SSH_MSG_KEXINIT           C-&gt;S  Contains lists of algorithms
                                      acceptable to the client.

      SSH_MSG_KEXINIT           S-&gt;C  Contains lists of algorithms
                                      acceptable to the server.

      SSH_MSG_KEXECDH_INIT      C-&gt;S  Contains the client's ephemeral
                                      elliptic curve Diffie-Hellman key.

      SSH_MSG_KEXECDH_REPLY     S-&gt;C  Contains a certificate with the
                                      server's ECDSA public signature
                                      key, the server's ephemeral ECDH
                                      contribution, and an ECDSA digital
                                      signature of the newly formed
                                      exchange hash value.




<span class="grey">Igoe                          Informational                     [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


      SSH_MSG_USERAUTH_REQUEST  C-&gt;S  Contains the user's name, the
                                      name of the service the user is
                                      requesting, the name of the
                                      authentication method the client
                                      wishes to use, and method-specific
                                      fields.

   When not in the midst of processing a key exchange, either party may
   initiate a key re-exchange by sending an SSH_MSG_KEXINIT packet.  All
   packets exchanged during the re-exchange are encrypted and
   authenticated using the current keys until the conclusion of the
   re-exchange, at which point an SSH_MSG_NEWKEYS initiates a change to
   the newly established keys.  Otherwise, the re-exchange protocol is
   identical to the initial key exchange protocol.  See Section 9 of
   [<a href="#ref-SSH-Tran" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">SSH-Tran</a>].

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Algorithm Negotiation: SSH_MSG_KEXINIT</span>

   The choice of all but the user authentication methods are determined
   by the exchange of SSH_MSG_KEXINIT between the client and the server.
   As described in [<a href="#ref-SSH-Tran" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">SSH-Tran</a>], the SSH_MSG_KEXINIT packet has the
   following structure:

      byte         SSH_MSG_KEXINIT
      byte[16]     cookie (random bytes)
      name-list    kex_algorithms
      name-list    server_host_key_algorithms
      name-list    encryption_algorithms_client_to_server
      name-list    encryption_algorithms_server_to_client
      name-list    mac_algorithms_client_to_server
      name-list    mac_algorithms_server_to_client
      name-list    compression_algorithms_client_to_server
      name-list    compression_algorithms_server_to_client
      name-list    languages_client_to_server
      name-list    languages_server_to_client
      boolean      first_kex_packet_follows
      uint32       0 (reserved for future extension)

   The SSH_MSG_KEXINIT name lists can be used to constrain the choice of
   non-signature and host key algorithms in accordance with the guidance
   given in <a href="#section-2">Section 2</a>.  Table 2 lists three allowable name lists for the
   non-signature algorithms.  One of these options MUST be used.









<span class="grey">Igoe                          Informational                     [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


       Family 1 only (min_LOS 128):
          kex_algorithm name_list         := { ecdh_sha2_nistp256 }
          encryption_algorithm name_list  := { AEAD_AES_128_GCM   }
          mac_algorithm name_list         := { AEAD_AES_128_GCM   }

       Family 2 only (min_LOS 128 or 192):
          kex_algorithm name_list         := { ecdh_sha2_nistp384 }
          encryption_algorithm name_list  := { AEAD_AES_256_GCM   }
          mac_algorithm name_list         := { AEAD_AES_256_GCM   }

       Family 1 or Family 2 (min_LOS 128):
          kex_algorithm name_list         := { ecdh_sha2_nistp256,
                                               ecdh_sha2_nistp384 }
          encryption_algorithm name_list  := { AEAD_AES_128_GCM,
                                               AEAD_AES_256_GCM   }
          mac_algorithm name_list         := { AEAD_AES_128_GCM,
                                               AEAD_AES_256_GCM   }

           Table 2.  Allowed Non-Signature Algorithm Name Lists

   Table 3 lists three allowable name lists for the server host key
   algorithms.  One of these options MUST be used.

            ECDSA-256 only (min_LOS 128):
               server_host_key_algorithms name_list :=
                                { x509v3-ecdsa-sha2-nistp256 }

            ECDSA-384 only (min_LOS 128 or 192):
               server_host_key_algorithms name_list :=
                                { x509v3-ecdsa-sha2-nistp384 }

            ECDSA-256 or ECDSA-384 (min_LOS 128):
               server_host_key_algorithms name_list :=
                                { x509v3-ecdsa-sha2-nistp256,
                                  x509v3-ecdsa-sha2-nistp384 }

          Table 3.  Allowed Server Host Key Algorithm Name Lists

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  Key Exchange and Server Authentication</span>

   SecSh-B uses ECDH to establish a shared secret value between the
   client and the server.  An X.509v3 certificate containing the
   server's public signing ECDSA key and an ECDSA signature on the
   exchange hash value derived from the newly established shared secret
   value are used to authenticate the server to the client.






<span class="grey">Igoe                          Informational                     [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  SSH_MSG_KEXECDH_INIT</span>

   The key exchange to be used in Secure Shell is determined by the name
   lists exchanged in the SSH_MSG_KEXINIT packets.  In Suite B, one of
   the following key agreement methods MUST be used to generate a shared
   secret value (SSV):

      ecdh-sha2-nistp256      ephemeral-ephemeral elliptic curve
                              Diffie-Hellman on nistp256 with SHA-256

      ecdh-sha2-nistp384      ephemeral-ephemeral elliptic curve
                              Diffie-Hellman on nistp384 with SHA-384

   and the format of the SSH_MSG_KEXECDH_INIT message is:

      byte      SSH_MSG_KEXDH_INIT

      string    Q_C    // the client's ephemeral contribution to the
                       // ECDH exchange, encoded as an octet string

   where the encoding of the elliptic curve point Q_C as an octet string
   is as specified in Section 2.3.3 of [<a href="#ref-SEC1" title="&quot;Elliptic Curve Cryptography&quot;">SEC1</a>].

<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  SSH_MSG_KEXECDH_REPLY</span>

   The SSH_MSG_KEXECDH_REPLY contains the server's contribution to the
   ECDH exchange, the server's public signature key, and a signature of
   the exchange hash value formed from the newly established shared
   secret value.  As stated in <a href="#section-3.1">Section 3.1</a>, in SecSh-B, the server host
   key algorithm MUST be either x509v3-ecdsa-sha2-nistp256 or
   x509v3-ecdsa-sha2-nistp384.

   The format of the SSH_MSG_KEXECDH_REPLY is:

      byte      SSH_MSG_KEXECDH_REPLY

      string    K_S    // a string encoding an X.509v3 certificate
                       // containing the server's ECDSA public host key

      string    Q_S    // the server's ephemeral contribution to the
                       // ECDH exchange, encoded as an octet string

      string    Sig_S  // an octet string containing the server's
                       // signature of the newly established exchange
                       // hash value






<span class="grey">Igoe                          Informational                     [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


   Details on the structure and encoding of the X.509v3 certificate can
   be found in Section 2 of [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>].  The encoding of the elliptic
   curve point Q_C as an octet string is as specified in Section 2.3.3
   of [<a href="#ref-SEC1" title="&quot;Elliptic Curve Cryptography&quot;">SEC1</a>], and the encoding of the ECDSA signature Sig_S as an octet
   string is as described in Section 3.1.2 of [<a href="#ref-SSH-ECC" title="&quot;Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer&quot;">SSH-ECC</a>].

<span class="h3"><a class="selflink" name="section-4.3" href="#section-4.3">4.3</a>.  Key and Initialization Vector Derivation</span>

   As specified in [<a href="#ref-SSH-Tran" title="&quot;The Secure Shell (SSH) Transport Layer Protocol&quot;">SSH-Tran</a>], the encryption keys and initialization
   vectors needed by Secure Shell are derived directly from the SSV
   using the hash function specified by the key agreement algorithm
   (SHA-256 for ecdh-sha2-nistp256 and SHA-384 for ecdh-sha2-nistp384).
   The client-to-server channel and the server-to-client channel will
   have independent keys and initialization vectors.  These keys will
   remain constant until a re-exchange results in the formation of a
   new SSV.

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  User Authentication</span>

   The Secure Shell Transport Layer Protocol authenticates the server to
   the host but does not authenticate the user (or the user's host) to
   the server.  For this reason, condition (2) of <a href="#section-2.2">Section 2.2</a> requires
   that all users of SecSh-B MUST be authenticated using ECDSA-256/384
   signatures and X.509v3 certificates.  [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>] provides two
   methods, x509v3-ecdsa-sha2-nistp256 and x509v3-ecdsa-sha2-nistp384,
   that MUST be used to achieve this goal.  At minLOS 128, either one of
   these methods may be used, but at minLOS 192,
   x509v3-ecdsa-sha2-nistp384 MUST be used.

<span class="h3"><a class="selflink" name="section-5.1" href="#section-5.1">5.1</a>.  First SSH_MSG_USERAUTH_REQUEST Message</span>

   The user's public key is sent to the server using an
   SSH_MSG_USERAUTH_REQUEST message.  When an x509v3-ecdsa-sha2-* user
   authentication method is being used, the structure of the
   SSH_MSG_USERAUTH_REQUEST message should be:

      byte      SSH_MSG_USERAUTH_REQUEST

      string    user_name      // in ISO-10646 UTF-8 encoding

      string    service_name   // service name in US-ASCII

      string    "publickey"

      boolean   FALSE






<span class="grey">Igoe                          Informational                    [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


      string    public_key_algorithm_name  // x509v3-ecdsa-sha2-nistp256
                                        // or x509v3-ecdsa-sha2-nistp384

      string    public_key_blob // X.509v3 certificate

   Details on the structure and encoding of the X.509v3 certificate can
   be found in Section 2 of [<a href="#ref-SSH-X509" title="&quot;X.509v3 Certificates for Secure Shell Authentication&quot;">SSH-X509</a>].

<span class="h3"><a class="selflink" name="section-5.2" href="#section-5.2">5.2</a>.  Second SSH_MSG_USERAUTH_REQUEST Message</span>

   Once the server has responded to the request message with an
   SSH_MSG_USERAUTH_PK_OK message, the client uses a second
   SSH_MSG_USERAUTH_REQUEST message to perform the actual
   authentication:

      byte      SSH_MSG_USERAUTH_REQUEST

      string    user_name      // in ISO-10646 UTF-8 encoding

      string    service_name   // service name in US-ASCII

      string    "publickey"

      boolean   TRUE

      string    public_key_algorithm_name  // x509v3-ecdsa-sha2-nistp256
                                        // or x509v3-ecdsa-sha2-nistp384

      string    Sig_U

   The signature field Sig_U is an ECDSA signature of the concatenation
   of several values, including the session identifier, user name,
   service name, public key algorithm name, and the user's public
   signing key.  The user's public signing key MUST be the signing key
   conveyed in the X.509v3 certificate sent in the first
   SSH_MSG_USERAUTH_REQUEST message.  The encoding of the ECDSA
   signature Sig_U as an octet string is as described in Section 3.1.2
   of [<a href="#ref-SSH-ECC" title="&quot;Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer&quot;">SSH-ECC</a>].

   The server MUST respond with either SSH_MSG_USERAUTH_SUCCESS (if no
   more authentications are needed) or SSH_MSG_USERAUTH_FAILURE (if the
   request failed, or more authentications are needed).









<span class="grey">Igoe                          Informational                    [Page 11]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Confidentiality and Data Integrity of SSH Binary Packets</span>

   Secure Shell transfers data between the client and the server using
   its own binary packet structure.  The SSH binary packet structure is
   independent of any packet structure on the underlying data channel.
   The contents of each binary packet and portions of the header are
   encrypted, and each packet is authenticated with its own message
   authentication code.  AES GCM will both encrypt the packet and form a
   16-octet authentication tag to ensure data integrity.

<span class="h3"><a class="selflink" name="section-6.1" href="#section-6.1">6.1</a>.  Galois/Counter Mode</span>

   [<a name="ref-SSH-GCM" id="ref-SSH-GCM">SSH-GCM</a>] describes how AES Galois/Counter Mode is to be used in
   Secure Shell.  Suite B SSH implementations MUST support
   AEAD_AES_GCM_128 and SHOULD support AEAD_AES_GCM_256 to both provide
   confidentiality and ensure data integrity.  No other confidentiality
   or data integrity algorithms are permitted.

   These algorithms rely on two counters:

      Invocation Counter: A 64-bit integer, incremented after each call
      to AES-GCM to process an SSH binary packet.  The initial value of
      the invocation counter is determined by the SSH initialization
      vector.

      Block Counter: A 32-bit integer, set to one at the start of each
      new SSH binary packet and incremented as each 16-octet block of
      data is processed.

   Ensuring that these counters are properly implemented is crucial to
   the security of the system.  The reader is referred to [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>] for
   details on the format, initialization, and usage of these counters
   and their relationship to the initialization vector and the SSV.

<span class="h3"><a class="selflink" name="section-6.2" href="#section-6.2">6.2</a>.  Data Integrity</span>

   The reader is reminded that, as specified in [<a href="#ref-SSH-GCM" title="&quot;AES Galois Counter Mode for the Secure Shell Transport Layer Protocol&quot;">SSH-GCM</a>], Suite B
   requires that all 16 octets of the authentication tag MUST be used as
   the SSH data integrity value of the SSH binary packet.

<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Rekeying</span>

   Secure Shell allows either the server or client to request that the
   Secure Shell connection be rekeyed.  Suite B places no constraints on
   how frequently this is to be done, but it does require that the
   cipher suite being employed MUST NOT be changed when a rekey occurs.





<span class="grey">Igoe                          Informational                    [Page 12]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  Security Considerations</span>

   When using ecdh_sha2_nistp256, each exponent used in the key exchange
   must have 256 bits of entropy.  Similarly, when using
   ecdh_sha2_nistp384, each exponent used in the key exchange must have
   384 bits of entropy.  The security considerations of [<a href="#ref-SSH-Arch" title="&quot;The Secure Shell (SSH) Protocol Architecture&quot;">SSH-Arch</a>]
   apply.

<span class="h2"><a class="selflink" name="section-9" href="#section-9">9</a>.  References</span>

<span class="h3"><a class="selflink" name="section-9.1" href="#section-9.1">9.1</a>.  Normative References</span>

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]    Bradner, S., "Key words for use in RFCs to Indicate
                Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a name="ref-SUITEBCERT" id="ref-SUITEBCERT">SUITEBCERT</a>] Solinas, J. and L. Zieglar, "Suite B Certificate and
                Certificate Revocation List (CRL) Profile", <a href="rfc5759.html">RFC 5759</a>,
                January 2010.

   [<a name="ref-SSH-Arch" id="ref-SSH-Arch">SSH-Arch</a>]   Ylonen, T. and C. Lonvick, Ed., "The Secure Shell (SSH)
                Protocol Architecture", <a href="rfc4251.html">RFC 4251</a>, January 2006.

   [<a name="ref-SSH-Tran" id="ref-SSH-Tran">SSH-Tran</a>]   Ylonen, T. and C. Lonvick, Ed., "The Secure Shell (SSH)
                Transport Layer Protocol", <a href="rfc4253.html">RFC 4253</a>, January 2006.

   [<a name="ref-SSH-ECC" id="ref-SSH-ECC">SSH-ECC</a>]    Stebila, D. and J. Green, "Elliptic Curve Algorithm
                Integration in the Secure Shell Transport Layer", <a href="rfc5656.html">RFC</a>
                <a href="rfc5656.html">5656</a>, December 2009.

   [<a name="ref-SSH-GCM" id="ref-SSH-GCM">SSH-GCM</a>]    Igoe, K. and J. Solinas, "AES Galois Counter Mode for
                the Secure Shell Transport Layer Protocol", <a href="rfc5647.html">RFC 5647</a>,
                August 2009.

   [<a name="ref-SSH-X509" id="ref-SSH-X509">SSH-X509</a>]   Igoe, K. and D. Stebila, "X.509v3 Certificates for
                Secure Shell Authentication", <a href="rfc6187.html">RFC 6187</a>, March 2011.

<span class="h3"><a class="selflink" name="section-9.2" href="#section-9.2">9.2</a>.  Informative References</span>

   [<a name="ref-NIST" id="ref-NIST">NIST</a>]       National Institute of Standards and Technology, "Digital
                Signature Standard (DSS)", Federal Information
                Processing Standards Publication 186-3.

   [<a name="ref-SEC1" id="ref-SEC1">SEC1</a>]       Standards for Efficient Cryptography Group, "Elliptic
                Curve Cryptography", SEC 1 v2.0, May 2009,
                &lt;<a href="http://www.secg.org/download/aid-780/sec1-v2.pdf">http://www.secg.org/download/aid-780/sec1-v2.pdf</a>&gt;.






<span class="grey">Igoe                          Informational                    [Page 13]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey"><a href="rfc6239.html">RFC 6239</a>              Suite B Crypto Suites for SSH             May 2011</span>


   [<a name="ref-SEC2" id="ref-SEC2">SEC2</a>]       Standards for Efficient Cryptography Group, "Recommended
                Elliptic Curve Domain Parameters", SEC 2 v1.0, September
                2000.  &lt;<a href="http://www.secg.org/download/aid-386/sec2_final.pdf">http://www.secg.org/download/aid-386/</a>
                <a href="http://www.secg.org/download/aid-386/sec2_final.pdf">sec2_final.pdf</a>&gt;.

Author's Address

   Kevin M. Igoe
   NSA/CSS Commercial Solutions Center
   National Security Agency

   EMail: kmigoe@nsa.gov







































Igoe                          Informational                    [Page 14]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129c, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>

<!-- Mirrored from tools.ietf.org/html/rfc6239 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Jul 2019 12:48:01 GMT -->
</html>
