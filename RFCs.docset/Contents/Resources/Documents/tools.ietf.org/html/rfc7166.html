<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7166 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:23 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="rfc6506" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7166" name="DC.Identifier"/>
<meta content="March, 2014" name="DC.Date.Issued"/>
<meta content="Bhatia, Manav" name="DC.Creator"/>
<meta content="Lindem, Acee" name="DC.Creator"/>
<meta content="Manral, Vishwas" name="DC.Creator"/>
<meta content="Currently, OSPF for IPv6 (OSPFv3) uses IPsec as the only mechanism for
authenticating protocol packets. This behavior is different from
authentication mechanisms present in other routing protocols (OSPFv2,
Intermediate System to Intermediate System (IS-IS), RIP, and Routing
Information Protocol Next Generation (RIPng)). In some environments,
it has been found that IPsec is difficult to configure and maintain
and thus cannot be used. This document defines an alternative
mechanism to authenticate OSPFv3 protocol packets so that OSPFv3 does
not depend only upon IPsec for authentication.  The OSPFv3
Authentication Trailer was originally defined in RFC 6506. This
document obsoletes RFC 6506 by providing a revised definition,
including clarifications and refinements of the procedures." name="DC.Description.Abstract"/>
<meta content="Supporting Authentication Trailer for OSPFv3" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7166 - Supporting Authentication Trailer for OSPFv3</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7166.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7166" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ospf-rfc6506bis" title="draft-ietf-ospf-rfc6506bis">draft-ietf-ospf...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7166" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7166" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7166" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                         M. Bhatia
Request for Comments: 7166                                Alcatel-Lucent
Obsoletes: <a href="rfc6506.html">6506</a>                                                V. Manral
Category: Standards Track                                    Ionos Corp.
ISSN: 2070-1721                                                A. Lindem
                                                                Ericsson
                                                              March 2014


              <span class="h1">Supporting Authentication Trailer for OSPFv3</span>

Abstract

   Currently, OSPF for IPv6 (OSPFv3) uses IPsec as the only mechanism
   for authenticating protocol packets.  This behavior is different from
   authentication mechanisms present in other routing protocols (OSPFv2,
   Intermediate System to Intermediate System (IS-IS), RIP, and Routing
   Information Protocol Next Generation (RIPng)).  In some environments,
   it has been found that IPsec is difficult to configure and maintain
   and thus cannot be used.  This document defines an alternative
   mechanism to authenticate OSPFv3 protocol packets so that OSPFv3 does
   not depend only upon IPsec for authentication.

   The OSPFv3 Authentication Trailer was originally defined in <a href="rfc6506.html">RFC 6506</a>.
   This document obsoletes <a href="rfc6506.html">RFC 6506</a> by providing a revised definition,
   including clarifications and refinements of the procedures.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7166">http://www.rfc-editor.org/info/rfc7166</a>.











<span class="grey">Bhatia, et al.               Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Requirements ...............................................<a href="#page-4">4</a>
      <a href="#section-1.2">1.2</a>. Summary of Changes from <a href="rfc6506.html">RFC 6506</a> ...........................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Proposed Solution ...............................................<a href="#page-5">5</a>
      <a href="#section-2.1">2.1</a>. AT-Bit in Options Field ....................................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. Basic Operation ............................................<a href="#page-6">6</a>
      <a href="#section-2.3">2.3</a>. IPv6 Source Address Protection .............................<a href="#page-6">6</a>
   <a href="#section-3">3</a>. OSPFv3 Security Association .....................................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Authentication Procedure ........................................<a href="#page-9">9</a>
      <a href="#section-4.1">4.1</a>. Authentication Trailer .....................................<a href="#page-9">9</a>
           <a href="#section-4.1.1">4.1.1</a>. Sequence Number Wrap ...............................<a href="#page-11">11</a>
      <a href="#section-4.2">4.2</a>. OSPFv3 Header Checksum and LLS Data Block Checksum ........<a href="#page-11">11</a>
      <a href="#section-4.3">4.3</a>. Cryptographic Authentication Procedure ....................<a href="#page-12">12</a>
      <a href="#section-4.4">4.4</a>. Cross-Protocol Attack Mitigation ..........................<a href="#page-12">12</a>
      <a href="#section-4.5">4.5</a>. Cryptographic Aspects .....................................<a href="#page-12">12</a>
      <a href="#section-4.6">4.6</a>. Message Verification ......................................<a href="#page-15">15</a>
   <a href="#section-5">5</a>. Migration and Backward Compatibility ...........................<a href="#page-16">16</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-17">17</a>
   <a href="#section-7">7</a>. IANA Considerations ............................................<a href="#page-18">18</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-19">19</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-19">19</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-19">19</a>
   <a href="#appendix-A">Appendix A</a>. Acknowledgments .......................................<a href="#page-22">22</a>











<span class="grey">Bhatia, et al.               Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Unlike Open Shortest Path First version 2 (OSPFv2) [<a href="rfc2328.html" title='"OSPF Version 2"'>RFC2328</a>], OSPF
   for IPv6 (OSPFv3) [<a href="rfc5340.html" title='"OSPF for IPv6"'>RFC5340</a>] does not include the AuType and
   Authentication fields in its headers for authenticating protocol
   packets.  Instead, OSPFv3 relies on the IPsec protocols
   Authentication Header (AH) [<a href="rfc4302.html" title='"IP Authentication Header"'>RFC4302</a>] and Encapsulating Security
   Payload (ESP) [<a href="rfc4303.html" title='"IP Encapsulating Security Payload (ESP)"'>RFC4303</a>] to provide integrity, authentication, and/or
   confidentiality.

   [<a id="ref-RFC4552" name="ref-RFC4552">RFC4552</a>] describes how IPv6 AH and ESP extension headers can be used
   to provide authentication and/or confidentiality to OSPFv3.

   However, there are some environments, e.g., Mobile Ad Hoc Networks
   (MANETs), where IPsec is difficult to configure and maintain; this
   mechanism cannot be used in such environments.

   [<a id="ref-RFC4552" name="ref-RFC4552">RFC4552</a>] discusses, at length, the reasoning behind using manually
   configured keys, rather than some automated key management protocol
   such as Internet Key Exchange version 2 (IKEv2) [<a href="rfc5996.html" title='"Internet Key Exchange Protocol Version 2 (IKEv2)"'>RFC5996</a>].  The
   primary problem is the lack of a suitable key management mechanism,
   as OSPFv3 adjacencies are formed on a one-to-many basis and most key
   management mechanisms are designed for a one-to-one communication
   model.  This forces the system administrator to use manually
   configured Security Associations (SAs) and cryptographic keys to
   provide the authentication and, if desired, confidentiality services.

   Regarding replay protection, [<a href="rfc4552.html" title='"Authentication/Confidentiality for OSPFv3"'>RFC4552</a>] states that:

      Since it is not possible using the current standards to provide
      complete replay protection while using manual keying, the proposed
      solution will not provide protection against replay attacks.

   Since there is no replay protection provided, there are a number of
   vulnerabilities in OSPFv3 that have been discussed in [<a href="rfc6039.html" title='"Issues with Existing Cryptographic Protection Methods for Routing Protocols"'>RFC6039</a>].

   While techniques exist to identify ESP-NULL packets [<a href="rfc5879.html" title='"Heuristics for Detecting ESP-NULL Packets"'>RFC5879</a>], these
   techniques are generally not implemented in the data planes of OSPFv3
   routers.  This makes it very difficult for implementations to examine
   OSPFv3 packets and prioritize certain OSPFv3 packet types, e.g.,
   Hello packets, over the other types.

   This document defines a mechanism that works similarly to OSPFv2
   [<a href="rfc5709.html" title='"OSPFv2 HMAC-SHA Cryptographic Authentication"'>RFC5709</a>] to provide authentication to OSPFv3 packets and solves the
   problems related to replay protection and deterministically
   disambiguating different OSPFv3 packets as described above.





<span class="grey">Bhatia, et al.               Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   This document adds support for the Secure Hash Algorithms (SHAs)
   defined in the US NIST Secure Hash Standard (SHS), which is specified
   by NIST FIPS 180-4.  [<a href="#ref-FIPS-180-4">FIPS-180-4</a>] includes SHA-1, SHA-224, SHA-256,
   SHA-384, and SHA-512.  The Hashed Message Authentication Code (HMAC)
   authentication mode defined in NIST FIPS 198-1 [<a href="#ref-FIPS-198-1">FIPS-198-1</a>] is used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Summary%20of%20Changes%20from%20RFC%206506"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Summary of Changes from <a href="rfc6506.html">RFC 6506</a></span>

   This document includes the following changes from <a href="rfc6506.html">RFC 6506</a> [<a href="rfc6506.html" title='"Supporting Authentication Trailer for OSPFv3"'>RFC6506</a>]:

   1. Sections <a href="#section-2.2">2.2</a> and <a href="#section-4.2">4.2</a> explicitly state that the Link-Local
      Signaling (LLS) block checksum calculation is omitted when an
      OSPFv3 Authentication Trailer is used for OSPFv3 authentication.
      The LLS data block is included in the authentication digest
      calculation, and computation of a checksum is unnecessary.
      Clarification of this issue was documented in an erratum.

   2. <a href="#section-3">Section 3</a> previously recommended usage of an expired key for
      transmitted OSPFv3 packets when no valid keys existed.  This
      statement has been removed.

   3. <a href="#section-4.5">Section 4.5</a> includes a correction to the key preparation to use
      the Protocol-Specific Authentication Key (Ks) rather than the
      Authentication Key (K) as the initial key (Ko).  This problem was
      also documented in an erratum.

   4. <a href="#section-4.5">Section 4.5</a> also includes a discussion of the choice of key length
      to be the hash length (L) rather than the block size (B).  The
      discussion of this choice was included to clarify an issue raised
      in a rejected erratum.

   5. Sections <a href="#section-4.1">4.1</a> and <a href="#section-4.6">4.6</a> indicate that sequence number checking is
      dependent on OSPFv3 packet type in order to account for packet
      prioritization as specified in [<a href="rfc4222.html" title='"Prioritized Treatment of Specific OSPF Version 2 Packets and Congestion Avoidance"'>RFC4222</a>].  This was an omission
      from <a href="rfc6506.html">RFC 6506</a> [<a href="rfc6506.html" title='"Supporting Authentication Trailer for OSPFv3"'>RFC6506</a>].

   6. <a href="#section-4.6">Section 4.6</a> explicitly states that OSPFv3 packets with a
      nonexistent or expired Security Association (SA) will be dropped.

   7. <a href="#section-5">Section 5</a> includes guidance on the precise actions required for an
      OSPFv3 router providing a backward-compatible transition mode.




<span class="grey">Bhatia, et al.               Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Proposed%20Solution"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Proposed Solution</span>

   To perform non-IPsec Cryptographic Authentication, OSPFv3 routers
   append a special data block, henceforth referred to as the
   Authentication Trailer, to the end of the OSPFv3 packets.  The length
   of the Authentication Trailer is not included in the length of the
   OSPFv3 packet but is included in the IPv6 payload length, as shown in
   Figure 1.

    +---------------------+ --              --  +----------------------+
    | IPv6 Payload Length | ^               ^   | IPv6 Payload Length  |
    | PL = OL + LL        | |               |   | PL = OL + LL + AL    |
    |                     | v               v   |                      |
    +---------------------+ --              --  +----------------------+
    | OSPFv3 Header       | ^               ^   | OSPFv3 Header        |
    | Length = OL         | |               |   | Length = OL          |
    |                     | |    OSPFv3     |   |                      |
    |.....................| |    Packet     |   |......................|
    |                     | |    Length     |   |                      |
    | OSPFv3 Packet       | |               |   | OSPFv3 Packet        |
    |                     | v               v   |                      |
    +---------------------+ --              --  +----------------------+
    |                     | ^               ^   |                      |
    | Optional LLS        | |    LLS Data   |   | Optional LLS         |
    | LL = LLS Data       | |    Block      |   | LL = LLS Data        |
    |      Block Length   | v    Length     v   |      Block Length    |
    +---------------------+ --              --  +----------------------+
                                            ^   |                      |
                       AL = PL - (OL + LL)  |   | Authentication       |
                                            |   | AL = Fixed Trailer + |
                                            v   |      Digest Length   |
                                            --  +----------------------+

                Figure 1: Authentication Trailer in OSPFv3

   The presence of the Link-Local Signaling (LLS) [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>] block is
   determined by the L-bit setting in the OSPFv3 Options field in OSPFv3
   Hello and Database Description packets.  If present, the LLS data
   block is included along with the OSPFv3 packet in the Cryptographic
   Authentication computation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20AT-Bit%20in%20Options%20Field"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  AT-Bit in Options Field</span>

   <a href="rfc6506.html">RFC 6506</a> introduced the AT-bit ("AT" stands for "Authentication
   Trailer") into the OSPFv3 Options field.  OSPFv3 routers MUST set the
   AT-bit in OSPFv3 Hello and Database Description packets to indicate
   that all the packets on this link will include an Authentication
   Trailer.  For OSPFv3 Hello and Database Description packets, the



<span class="grey">Bhatia, et al.               Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   AT-bit indicates that the AT is present.  For other OSPFv3 packet
   types, the OSPFv3 AT-bit setting from the OSPFv3 Hello/Database
   Description setting is preserved in the OSPFv3 neighbor data
   structure.  OSPFv3 packet types that don't include an OSPFv3 Options
   field will use the setting from the neighbor data structure to
   determine whether or not the AT is expected.

            0                   1                      2
            0 1 2 3 4 5 6 7 8 9 0 1 2 3  4 5  6 7 8  9 0 1  2 3
           +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+--+-+-+--+-+-+--+-+--+
           | | | | | | | | | | | | | |AT|L|AF|*|*|DC|R|N|MC|E|V6|
           +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+--+-+-+--+-+-+--+-+--+

                      Figure 2: OSPFv3 Options Field

   The AT-bit, as shown in the figure above, MUST be set in all OSPFv3
   Hello and Database Description packets that contain an Authentication
   Trailer.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Basic%20Operation"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Basic Operation</span>

   The procedure followed for computing the Authentication Trailer is
   much the same as those described in [<a href="rfc5709.html" title='"OSPFv2 HMAC-SHA Cryptographic Authentication"'>RFC5709</a>] and [<a href="rfc2328.html" title='"OSPF Version 2"'>RFC2328</a>].  One
   difference is that the LLS data block, if present, is included in the
   Cryptographic Authentication computation.

   The way the authentication data is carried in the Authentication
   Trailer is very similar to how it is done in the case of [<a href="rfc2328.html" title='"OSPF Version 2"'>RFC2328</a>].
   The only difference between the OSPFv2 Authentication Trailer and the
   OSPFv3 Authentication Trailer is that information in addition to the
   message digest is included.  The additional information in the OSPFv3
   Authentication Trailer is included in the message digest computation
   and is therefore protected by OSPFv3 Cryptographic Authentication as
   described herein.

   Consistent with OSPFv2 Cryptographic Authentication [<a href="rfc2328.html" title='"OSPF Version 2"'>RFC2328</a>] and
   Link-Local Signaling Cryptographic Authentication [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>], checksum
   calculation and verification are omitted for both the OSPFv3 header
   checksum and the LLS data block when the OSPFv3 authentication
   mechanism described in this specification is used.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20IPv6%20Source%20Address%20Protection"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  IPv6 Source Address Protection</span>

   While OSPFv3 always uses the Router ID to identify OSPFv3 neighbors,
   the IPv6 source address is learned from OSPFv3 Hello packets and
   copied into the neighbor data structure [<a href="rfc5340.html" title='"OSPF for IPv6"'>RFC5340</a>].  Hence, OSPFv3 is
   susceptible to Man-in-the-Middle attacks where the IPv6 source
   address is modified.  To thwart such attacks, the IPv6 source address



<span class="grey">Bhatia, et al.               Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   will be included in the message digest calculation and protected by
   OSPFv3 authentication.  Refer to <a href="#section-4.5">Section 4.5</a> for details.  This is
   different than the procedure specified in [<a href="rfc5709.html" title='"OSPFv2 HMAC-SHA Cryptographic Authentication"'>RFC5709</a>] but consistent
   with [<a href="#ref-MANUAL-KEY">MANUAL-KEY</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20OSPFv3%20Security%20Association"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  OSPFv3 Security Association</span>

   An OSPFv3 Security Association (SA) contains a set of parameters
   shared between any two legitimate OSPFv3 speakers.

   Parameters associated with an OSPFv3 SA are as follows:

   o  Security Association Identifier (SA ID)

      This is a 16-bit unsigned integer used to uniquely identify an
      OSPFv3 SA, as manually configured by the network operator.

      The receiver determines the active SA by looking at the SA ID
      field in the incoming protocol packet.

      The sender, based on the active configuration, selects an SA to
      use and puts the correct Key ID value associated with the SA in
      the OSPFv3 protocol packet.  If multiple valid and active OSPFv3
      SAs exist for a given interface, the sender may use any of those
      SAs to protect the packet.

      Using SA IDs makes changing keys while maintaining protocol
      operation convenient.  Each SA ID specifies two independent parts:
      the authentication algorithm and the Authentication Key, as
      explained below.

      Normally, an implementation would allow the network operator to
      configure a set of keys in a key chain, with each key in the chain
      having a fixed lifetime.  The actual operation of these mechanisms
      is outside the scope of this document.

      Note that each SA ID can indicate a key with a different
      authentication algorithm.  This allows the introduction of new
      authentication mechanisms without disrupting existing OSPFv3
      adjacencies.

   o  Authentication Algorithm

      This signifies the authentication algorithm to be used with this
      OSPFv3 SA.  This information is never sent in clear text over the
      wire.  Because this information is not sent on the wire, the
      implementer chooses an implementation-specific representation for
      this information.



<span class="grey">Bhatia, et al.               Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


      Currently, the following algorithms are supported:

      *  HMAC-SHA-1,

      *  HMAC-SHA-256,

      *  HMAC-SHA-384, and

      *  HMAC-SHA-512.

   o  Authentication Key

      This value denotes the Cryptographic Authentication Key associated
      with this OSPFv3 SA.  The length of this key is variable and
      depends upon the authentication algorithm specified by the
      OSPFv3 SA.

   o  KeyStartAccept

      This value indicates the time that this OSPFv3 router will accept
      packets that have been created with this OSPFv3 SA.

   o  KeyStartGenerate

      This value indicates the time that this OSPFv3 router will begin
      using this OSPFv3 SA for OSPFv3 packet generation.

   o  KeyStopGenerate

      This value indicates the time that this OSPFv3 router will stop
      using this OSPFv3 SA for OSPFv3 packet generation.

   o  KeyStopAccept

      This value indicates the time that this OSPFv3 router will stop
      accepting packets generated with this OSPFv3 SA.

      In order to achieve smooth key transition, KeyStartAccept SHOULD
      be less than KeyStartGenerate, and KeyStopGenerate SHOULD be less
      than KeyStopAccept.  If KeyStartGenerate or KeyStartAccept is left
      unspecified, the time will default to 0, and the key will be used
      immediately.  If KeyStopGenerate or KeyStopAccept is left
      unspecified, the time will default to infinity, and the key's
      lifetime will be infinite.  When a new key replaces an old key,
      the KeyStartGenerate time for the new key MUST be less than or
      equal to the KeyStopGenerate time of the old key.





<span class="grey">Bhatia, et al.               Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


      Key storage SHOULD persist across a system restart, warm or cold,
      to avoid operational issues.  In the event that the last key
      associated with an interface expires, the network operator SHOULD
      be notified, and the OSPFv3 packet MUST NOT be transmitted
      unauthenticated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Authentication%20Procedure"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Authentication Procedure</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Authentication%20Trailer"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Authentication Trailer</span>

   The Authentication Trailer that is appended to the OSPFv3 protocol
   packet is described below:

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |      Authentication Type      |        Auth Data Len          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Reserved            |   Security Association ID     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Cryptographic Sequence Number (High-Order 32 Bits)  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Cryptographic Sequence Number (Low-Order 32 Bits)   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                Authentication Data (Variable)                 |
    ~                                                               ~
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                  Figure 3: Authentication Trailer Format

   The various fields in the Authentication Trailer are as follows:

   o  Authentication Type

      This 16-bit field identifies the type of authentication.  The
      following values are defined in this specification:

         0 - Reserved.
         1 - HMAC Cryptographic Authentication as described herein.

   o  Auth Data Len

      This is the length in octets of the Authentication Trailer (AT),
      including both the 16-octet fixed header and the variable-length
      message digest.



<span class="grey">Bhatia, et al.               Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   o  Reserved

      This field is reserved.  It SHOULD be set to 0 when sending
      protocol packets and MUST be ignored when receiving protocol
      packets.

   o  Security Association Identifier (SA ID)

      This 16-bit field maps to the authentication algorithm and the
      secret key used to create the message digest appended to the
      OSPFv3 protocol packet.

      Though the SA ID implies the algorithm, the HMAC output size
      should not be used by implementers as an implicit hint, because
      additional algorithms may be defined in the future that have the
      same output size.

   o  Cryptographic Sequence Number

      This is a 64-bit strictly increasing sequence number that is used
      to guard against replay attacks.  The 64-bit sequence number MUST
      be incremented for every OSPFv3 packet sent by the OSPFv3 router.
      Upon reception, the sequence number MUST be greater than the
      sequence number in the last accepted OSPFv3 packet of the same
      OSPFv3 packet type from the sending OSPFv3 neighbor.  Otherwise,
      the OSPFv3 packet is considered a replayed packet and dropped.
      OSPFv3 packets of different types may arrive out of order if they
      are prioritized as recommended in [<a href="rfc4222.html" title='"Prioritized Treatment of Specific OSPF Version 2 Packets and Congestion Avoidance"'>RFC4222</a>].

      OSPFv3 routers implementing this specification MUST use available
      mechanisms to preserve the sequence number's strictly increasing
      property for the deployed life of the OSPFv3 router (including
      cold restarts).  One mechanism for accomplishing this would be to
      use the high-order 32 bits of the sequence number as a wrap/boot
      count that is incremented anytime the OSPFv3 router loses its
      sequence number state.  Sequence number wrap is described in
      <a href="#section-4.1.1">Section 4.1.1</a>.

   o  Authentication Data

      This field contains variable data that is carrying the digest for
      the protocol packet and optional LLS data block.









<span class="grey">Bhatia, et al.               Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.1.1.%20%20Sequence%20Number%20Wrap"></a><a class="selflink" href="#section-4.1.1" name="section-4.1.1">4.1.1</a>.  Sequence Number Wrap</span>

   When incrementing the sequence number for each transmitted OSPFv3
   packet, the sequence number should be treated as an unsigned 64-bit
   value.  If the lower-order 32-bit value wraps, the higher-order
   32-bit value should be incremented and saved in non-volatile storage.
   If by some chance the OSPFv3 router is deployed long enough that
   there is a possibility that the 64-bit sequence number may wrap, all
   keys, independent of their key distribution mechanism, MUST be reset
   to avoid the possibility of replay attacks.  Once the keys have been
   changed, the higher-order sequence number can be reset to 0 and saved
   to non-volatile storage.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20OSPFv3%20Header%20Checksum%20and%20LLS%20Data%20Block%20Checksum"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  OSPFv3 Header Checksum and LLS Data Block Checksum</span>

   Both the checksum calculation and verification are omitted for the
   OSPFv3 header checksum and the LLS data block checksum [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>] when
   the OSPFv3 authentication mechanism described in this specification
   is used.  This implies the following:

   o  For OSPFv3 packets to be transmitted, the OSPFv3 header checksum
      computation is omitted, and the OSPFv3 header checksum SHOULD be
      set to 0 prior to computation of the OSPFv3 Authentication Trailer
      message digest.

   o  For OSPFv3 packets including an LLS data block to be transmitted,
      the OSPFv3 LLS data block checksum computation is omitted, and the
      OSPFv3 LLS data block checksum SHOULD be set to 0 prior to
      computation of the OSPFv3 Authentication Trailer message digest.

   o  For received OSPFv3 packets including an OSPFv3 Authentication
      Trailer, OSPFv3 header checksum verification MUST be omitted.
      However, if the OSPFv3 packet does include a non-zero OSPFv3
      header checksum, it will not be modified by the receiver and will
      simply be included in the OSPFv3 Authentication Trailer message
      digest verification.

   o  For received OSPFv3 packets including an LLS data block and OSPFv3
      Authentication Trailer, LLS data block checksum verification MUST
      be omitted.  However, if the OSPFv3 packet does include an LLS
      data block with a non-zero checksum, it will not be modified by
      the receiver and will simply be included in the OSPFv3
      Authentication Trailer message digest verification.








<span class="grey">Bhatia, et al.               Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Cryptographic%20Authentication%20Procedure"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Cryptographic Authentication Procedure</span>

   As noted earlier, the SA ID maps to the authentication algorithm and
   the secret key used to generate and verify the message digest.  This
   specification discusses the computation of OSPFv3 Cryptographic
   Authentication data when any of the NIST SHS family of algorithms is
   used in the Hashed Message Authentication Code (HMAC) mode.

   The currently valid algorithms (including mode) for OSPFv3
   Cryptographic Authentication include:

   o  HMAC-SHA-1,

   o  HMAC-SHA-256,

   o  HMAC-SHA-384, and

   o  HMAC-SHA-512.

   Of the above, implementations of this specification MUST include
   support for at least HMAC-SHA-256 and SHOULD include support for
   HMAC-SHA-1 and MAY also include support for HMAC-SHA-384 and
   HMAC-SHA-512.

   Implementations of this specification MUST use HMAC-SHA-256 as the
   default authentication algorithm.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.4.%20%20Cross-Protocol%20Attack%20Mitigation"></a><a class="selflink" href="#section-4.4" name="section-4.4">4.4</a>.  Cross-Protocol Attack Mitigation</span>

   In order to prevent cross-protocol replay attacks for protocols
   sharing common keys, the two-octet OSPFv3 Cryptographic Protocol ID
   is appended to the Authentication Key prior to use.  Other protocols
   using Cryptographic Authentication as specified herein MUST similarly
   append their respective Cryptographic Protocol IDs to their keys in
   this step.  Refer to the IANA Considerations (<a href="#section-7">Section 7</a>).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.5.%20%20Cryptographic%20Aspects"></a><a class="selflink" href="#section-4.5" name="section-4.5">4.5</a>.  Cryptographic Aspects</span>

   In the algorithm description below, the following nomenclature, which
   is consistent with [<a href="#ref-FIPS-198-1">FIPS-198-1</a>], is used:

   H is the specific hashing algorithm (e.g., SHA-256).

   K is the Authentication Key from the OSPFv3 Security Association.

   Ks is a Protocol-Specific Authentication Key obtained by appending
   Authentication Key (K) with the two-octet OSPFv3 Cryptographic
   Protocol ID.



<span class="grey">Bhatia, et al.               Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   Ko is the cryptographic key used with the hash algorithm.

   B is the block size of H, measured in octets rather than bits.  Note
   that B is the internal block size, not the hash size.

      For SHA-1 and SHA-256: B == 64

      For SHA-384 and SHA-512: B == 128

   L is the length of the hash, measured in octets rather than bits.

   XOR is the exclusive-or operation.

   Opad is the hexadecimal value 0x5c repeated B times.

   Ipad is the hexadecimal value 0x36 repeated B times.

   Apad is a value that is the same length as the hash output or message
   digest.  The first 16 octets contain the IPv6 source address followed
   by the hexadecimal value 0x878FE1F3 repeated (L-16)/4 times.  This
   implies that hash output is always a length of at least 16 octets.

   1. Preparation of the Key

      The OSPFv3 Cryptographic Protocol ID is appended to the
      Authentication Key (K), yielding a Protocol-Specific
      Authentication Key (Ks).  In this application, Ko is always
      L octets long.  While [<a href="rfc2104.html" title='"HMAC: Keyed- Hashing for Message Authentication"'>RFC2104</a>] supports a key that is up to
      B octets long, this application uses L as the Ks length consistent
      with [<a href="rfc4822.html" title='"RIPv2 Cryptographic Authentication"'>RFC4822</a>], [<a href="rfc5310.html" title='"IS-IS Generic Cryptographic Authentication"'>RFC5310</a>], and [<a href="rfc5709.html" title='"OSPFv2 HMAC-SHA Cryptographic Authentication"'>RFC5709</a>].  According to
      [<a href="#ref-FIPS-198-1">FIPS-198-1</a>], Section 3, keys greater than L octets do not
      significantly increase the function strength.  Ks is computed as
      follows:

         If Ks is L octets long, then Ko is equal to Ks.  If Ks is more
         than L octets long, then Ko is set to H(Ks).  If Ks is less
         than L octets long, then Ko is set to the value of Ks, with
         zeros appended to the end of Ks such that Ko is L octets long.

   2. First-Hash

      First, the OSPFv3 packet's Authentication Data field in the
      Authentication Trailer is filled with the value Apad.  This is
      very similar to the appendage described in <a href="rfc2328.html#appendix-D.4.3">[RFC2328],
      Appendix D.4.3</a>, Items (6)(a) and (6)(d)).






<span class="grey">Bhatia, et al.               Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


      Then, a First-Hash, also known as the inner hash, is computed as
      follows:

         First-Hash = H(Ko XOR Ipad || (OSPFv3 Packet))

         When XORing Ko and Ipad, Ko will be padded with zeros to the
         length of Ipad.

         Implementation Note: The First-Hash above includes the
         Authentication Trailer as well as the OSPFv3 packet as per
         <a href="rfc2328.html#appendix-D.4.3">[RFC2328], Appendix D.4.3</a>, and the LLS data block, if present
         [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>].

      The definition of Apad (above) ensures that it is always the same
      length as the hash output.  This is consistent with <a href="rfc2328.html">RFC 2328</a>.
      Note that the "(OSPFv3 Packet)" referenced in the First-Hash
      function above includes both the optional LLS data block and the
      OSPFv3 Authentication Trailer.

      The digest length for SHA-1 is 20 octets; for SHA-256, 32 octets;
      for SHA-384, 48 octets; and for SHA-512, 64 octets.

   3. Second-Hash

      Then a Second-Hash, also known as the outer hash, is computed as
      follows:

         Second-Hash = H(Ko XOR Opad || First-Hash)

         When XORing Ko and Opad, Ko will be padded with zeros to the
         length of Opad.

   4. Result

      The resulting Second-Hash becomes the authentication data that is
      sent in the Authentication Trailer of the OSPFv3 packet.  The
      length of the authentication data is always identical to the
      message digest size of the specific hash function H that is
      being used.

      This also means that the use of hash functions with larger output
      sizes will also increase the size of the OSPFv3 packet as
      transmitted on the wire.








<span class="grey">Bhatia, et al.               Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


         Implementation Note: <a href="rfc2328.html#appendix-D">[RFC2328], Appendix D</a> specifies that the
         Authentication Trailer is not counted in the OSPF packet's own
         Length field but is included in the packet's IP Length field.
         Similar to this, the Authentication Trailer is not included in
         the OSPFv3 header length but is included in the IPv6 header
         payload length.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.6.%20%20Message%20Verification"></a><a class="selflink" href="#section-4.6" name="section-4.6">4.6</a>.  Message Verification</span>

   A router would determine that OSPFv3 is using an Authentication
   Trailer (AT) by examining the AT-bit in the Options field in the
   OSPFv3 header for Hello and Database Description packets.  The
   specification in the Hello and Database Description options indicates
   that other OSPFv3 packets will include the Authentication Trailer.

   The AT is accessed using the OSPFv3 packet header length to access
   the data after the OSPFv3 packet and, if an LLS data block [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>]
   is present, using the LLS data block length to access the data after
   the LLS data block.  The L-bit in the OSPFv3 options in Hello and
   Database Description packets is examined to determine if an LLS data
   block is present.  If an LLS data block is present (as specified by
   the L-bit), it is included along with the OSPFv3 Hello or Database
   Description packet in the Cryptographic Authentication computation.

   Due to the placement of the AT following the LLS data block and the
   fact that the LLS data block is included in the Cryptographic
   Authentication computation, OSPFv3 routers supporting this
   specification MUST minimally support examining the L-bit in the
   OSPFv3 options and using the length in the LLS data block to access
   the AT.  It is RECOMMENDED that OSPFv3 routers supporting this
   specification fully support OSPFv3 Link-Local Signaling [<a href="rfc5613.html" title='"OSPF Link-Local Signaling"'>RFC5613</a>].

   If usage of the AT, as specified herein, is configured for an OSPFv3
   link, OSPFv3 Hello and Database Description packets with the AT-bit
   clear in the options will be dropped.  All OSPFv3 packet types will
   be dropped if the AT is configured for the link and the IPv6 header
   length is less than the amount necessary to include an Authentication
   Trailer.

   The receiving interface's OSPFv3 SA is located using the SA ID in the
   received AT.  If the SA is not found, or if the SA is not valid for
   reception (i.e., current time &lt; KeyStartAccept or
   current time &gt;= KeyStopAccept), the OSPFv3 packet is dropped.

   If the cryptographic sequence number in the AT is less than or equal
   to the last sequence number in the last OSPFv3 packet of the same
   OSPFv3 type successfully received from the neighbor, the OSPFv3




<span class="grey">Bhatia, et al.               Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   packet MUST be dropped, and an error event SHOULD be logged.  OSPFv3
   packets of different types may arrive out of order if they are
   prioritized as recommended in [<a href="rfc4222.html" title='"Prioritized Treatment of Specific OSPF Version 2 Packets and Congestion Avoidance"'>RFC4222</a>].

   Authentication-algorithm-dependent processing needs to be performed,
   using the algorithm specified by the appropriate OSPFv3 SA for the
   received packet.

   Before an implementation performs any processing, it needs to save
   the values of the Authentication Data field from the Authentication
   Trailer appended to the OSPFv3 packet.

   It should then set the Authentication Data field with Apad before the
   authentication data is computed (as described in <a href="#section-4.5">Section 4.5</a>).  The
   calculated data is compared with the received authentication data in
   the Authentication Trailer.  If the two do not match, the packet MUST
   be discarded, and an error event SHOULD be logged.

   After the OSPFv3 packet has been successfully authenticated,
   implementations MUST store the 64-bit cryptographic sequence number
   for each OSPFv3 packet type received from the neighbor.  The saved
   cryptographic sequence numbers will be used for replay checking for
   subsequent packets received from the neighbor.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Migration%20and%20Backward%20Compatibility"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Migration and Backward Compatibility</span>

   All OSPFv3 routers participating on a link SHOULD be migrated to
   OSPFv3 authentication at the same time.  As with OSPFv2
   authentication, a mismatch in the SA ID, Authentication Type, or
   message digest will result in failure to form an adjacency.  For
   multi-access links, communities of OSPFv3 routers could be migrated
   using different Interface Instance IDs.  However, at least one router
   would need to form adjacencies between both the OSPFv3 routers
   including and not including the Authentication Trailer.  This would
   result in sub-optimal routing as well as added complexity and is only
   recommended in cases where authentication is desired on the link and
   migrating all the routers on the link at the same time isn't
   feasible.

   In support of uninterrupted deployment, an OSPFv3 router implementing
   this specification MAY implement a transition mode where it includes
   the Authentication Trailer in transmitted packets but does not verify
   this information in received packets.  This is provided as a








<span class="grey">Bhatia, et al.               Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   transition aid for networks in the process of migrating to the
   authentication mechanism described in this specification.  More
   specifically:

   1. OSPFv3 routers in transition mode will include the OSPFv3
      Authentication Trailer in transmitted packets and set the AT-bit
      in the Options field of transmitted Hello and Database Description
      packets.  OSPFv3 routers receiving these packets and not having
      authentication configured will ignore the Authentication Trailer
      and AT-bit.

   2. OSPFv3 routers in transition mode will also calculate and set the
      OSPFv3 header checksum and the LLS data block checksum in
      transmitted packets so that they will not be dropped by OSPFv3
      routers without authentication configured.

   3. OSPFv3 routers in transition mode will authenticate received
      packets that either have the AT-bit set in the Options field for
      Hello or Database Description packets or are from a neighbor that
      previously set the AT-bit in the Options field of successfully
      authenticated Hello and Database Description packets.

   4. OSPFv3 routers in transition mode will also accept packets without
      the Options field AT-bit set in Hello and Database Description
      packets.  These packets will be assumed to be from OSPFv3 routers
      without authentication configured, and they will not be
      authenticated.  Additionally, the OSPFv3 header checksum and LLS
      data block checksum will be validated.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   This document proposes extensions to OSPFv3 that would make it more
   secure than OSPFv3 as defined in [<a href="rfc5340.html" title='"OSPF for IPv6"'>RFC5340</a>].  It does not provide
   confidentiality, as a routing protocol contains information that does
   not need to be kept secret.  It does, however, provide means to
   authenticate the sender of packets that are of interest.  It
   addresses all the security issues that have been identified in
   [<a href="rfc6039.html" title='"Issues with Existing Cryptographic Protection Methods for Routing Protocols"'>RFC6039</a>] and [<a href="rfc6506.html" title='"Supporting Authentication Trailer for OSPFv3"'>RFC6506</a>].

   It should be noted that the authentication method described in this
   document is not being used to authenticate the specific originator of
   a packet but rather is being used to confirm that the packet has
   indeed been issued by a router that has access to the
   Authentication Key.

   Deployments SHOULD use sufficiently long and random values for the
   Authentication Key so that guessing and other cryptographic attacks
   on the key are not feasible in their environments.  Furthermore, it



<span class="grey">Bhatia, et al.               Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   is RECOMMENDED that Authentication Keys incorporate at least 128
   pseudorandom bits to minimize the risk of such attacks.  In support
   of these recommendations, management systems SHOULD support
   hexadecimal input of Authentication Keys.

   Deployments that support a transitionary state but interoperate with
   routers that do not support this authentication method may be exposed
   to unauthenticated data during the transition period.

   The mechanism described herein is not perfect and does not need to be
   perfect.  Instead, this mechanism represents a significant increase
   in the effort required for an adversary to successfully attack the
   OSPFv3 protocol, while not causing undue implementation, deployment,
   or operational complexity.

   Refer to [<a href="rfc4552.html" title='"Authentication/Confidentiality for OSPFv3"'>RFC4552</a>] for additional considerations on manual keying.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

   This document obsoletes <a href="rfc6506.html">RFC 6506</a>; thus, IANA has updated the
   references in existing registries that pointed to <a href="rfc6506.html">RFC 6506</a> to point
   to this document.  This is the only IANA action requested by this
   document.

   IANA previously allocated the AT-bit (0x000400) in the "OSPFv3
   Options (24 bits)" registry as described in <a href="#section-2.1">Section 2.1</a>.

   IANA previously created the "Open Shortest Path First v3 (OSPFv3)
   Authentication Trailer Options" registry.  This registry includes the
   "OSPFv3 Authentication Types" registry, which defines valid values
   for the Authentication Type field in the OSPFv3 Authentication
   Trailer.  The registration procedure is Standards Action [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>].

           +-------------+-----------------------------------+
           |Value        | Designation                       |
           +-------------+-----------------------------------+
           | 0           | Reserved                          |
           |             |                                   |
           | 1           | HMAC Cryptographic Authentication |
           |             |                                   |
           | 2-65535     | Unassigned                        |
           +-------------+-----------------------------------+

                        OSPFv3 Authentication Types

   Finally, IANA previously created the "Keying and Authentication for
   Routing Protocols (KARP) Parameters" registry.  This registry
   includes the "Cryptographic Protocol ID" registry, which provides



<span class="grey">Bhatia, et al.               Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   unique protocol-specific values for cryptographic applications,
   including but not limited to prevention of cross-protocol replay
   attacks.  Values can be assigned for both native IPv4/IPv6 protocols
   and UDP/TCP protocols.  The registration procedure is Standards
   Action.

                  +-------------+----------------------+
                  | Value/Range | Designation          |
                  +-------------+----------------------+
                  | 0           | Reserved             |
                  |             |                      |
                  | 1           | OSPFv3               |
                  |             |                      |
                  | 2-65535     | Unassigned           |
                  +-------------+----------------------+

                         Cryptographic Protocol ID

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2328" name="ref-RFC2328">RFC2328</a>]  Moy, J., "OSPF Version 2", STD 54, <a href="rfc2328.html">RFC 2328</a>, April 1998.

   [<a id="ref-RFC5340" name="ref-RFC5340">RFC5340</a>]  Coltun, R., Ferguson, D., Moy, J., and A. Lindem, "OSPF
              for IPv6", <a href="rfc5340.html">RFC 5340</a>, July 2008.

   [<a id="ref-RFC5709" name="ref-RFC5709">RFC5709</a>]  Bhatia, M., Manral, V., Fanto, M., White, R., Barnes, M.,
              Li, T., and R. Atkinson, "OSPFv2 HMAC-SHA Cryptographic
              Authentication", <a href="rfc5709.html">RFC 5709</a>, October 2009.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-FIPS-180-4" name="ref-FIPS-180-4">FIPS-180-4</a>]
              US National Institute of Standards and Technology, "Secure
              Hash Standard (SHS)", FIPS PUB 180-4, March 2012.

   [<a id="ref-FIPS-198-1" name="ref-FIPS-198-1">FIPS-198-1</a>]
              US National Institute of Standards and Technology, "The
              Keyed-Hash Message Authentication Code (HMAC)", FIPS
              PUB 198-1, July 2008.







<span class="grey">Bhatia, et al.               Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   [<a id="ref-MANUAL-KEY" name="ref-MANUAL-KEY">MANUAL-KEY</a>]
              Bhatia, M., Hartman, S., and D. Zhang, "Security Extension
              for OSPFv2 when using Manual Key Management", Work in
              Progress, February 2011.

   [<a id="ref-RFC2104" name="ref-RFC2104">RFC2104</a>]  Krawczyk, H., Bellare, M., and R. Canetti, "HMAC: Keyed-
              Hashing for Message Authentication", <a href="rfc2104.html">RFC 2104</a>,
              February 1997.

   [<a id="ref-RFC4222" name="ref-RFC4222">RFC4222</a>]  Choudhury, G., Ed., "Prioritized Treatment of Specific
              OSPF Version 2 Packets and Congestion Avoidance", <a href="https://tools.ietf.org/html/bcp112">BCP 112</a>,
              <a href="rfc4222.html">RFC 4222</a>, October 2005.

   [<a id="ref-RFC4302" name="ref-RFC4302">RFC4302</a>]  Kent, S., "IP Authentication Header", <a href="rfc4302.html">RFC 4302</a>,
              December 2005.

   [<a id="ref-RFC4303" name="ref-RFC4303">RFC4303</a>]  Kent, S., "IP Encapsulating Security Payload (ESP)",
              <a href="rfc4303.html">RFC 4303</a>, December 2005.

   [<a id="ref-RFC4552" name="ref-RFC4552">RFC4552</a>]  Gupta, M. and N. Melam, "Authentication/Confidentiality
              for OSPFv3", <a href="rfc4552.html">RFC 4552</a>, June 2006.

   [<a id="ref-RFC4822" name="ref-RFC4822">RFC4822</a>]  Atkinson, R. and M. Fanto, "RIPv2 Cryptographic
              Authentication", <a href="rfc4822.html">RFC 4822</a>, February 2007.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>, <a href="rfc5226.html">RFC 5226</a>,
              May 2008.

   [<a id="ref-RFC5310" name="ref-RFC5310">RFC5310</a>]  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,
              and M. Fanto, "IS-IS Generic Cryptographic
              Authentication", <a href="rfc5310.html">RFC 5310</a>, February 2009.

   [<a id="ref-RFC5613" name="ref-RFC5613">RFC5613</a>]  Zinin, A., Roy, A., Nguyen, L., Friedman, B., and D.
              Yeung, "OSPF Link-Local Signaling", <a href="rfc5613.html">RFC 5613</a>, August 2009.

   [<a id="ref-RFC5879" name="ref-RFC5879">RFC5879</a>]  Kivinen, T. and D. McDonald, "Heuristics for Detecting
              ESP-NULL Packets", <a href="rfc5879.html">RFC 5879</a>, May 2010.

   [<a id="ref-RFC5996" name="ref-RFC5996">RFC5996</a>]  Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen,
              "Internet Key Exchange Protocol Version 2 (IKEv2)",
              <a href="rfc5996.html">RFC 5996</a>, September 2010.









<span class="grey">Bhatia, et al.               Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   [<a id="ref-RFC6039" name="ref-RFC6039">RFC6039</a>]  Manral, V., Bhatia, M., Jaeggli, J., and R. White, "Issues
              with Existing Cryptographic Protection Methods for Routing
              Protocols", <a href="rfc6039.html">RFC 6039</a>, October 2010.

   [<a id="ref-RFC6506" name="ref-RFC6506">RFC6506</a>]  Bhatia, M., Manral, V., and A. Lindem, "Supporting
              Authentication Trailer for OSPFv3", <a href="rfc6506.html">RFC 6506</a>,
              February 2012.












































<span class="grey">Bhatia, et al.               Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Acknowledgments"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Acknowledgments</span>

   First and foremost, thanks to the US National Institute of Standards
   and Technology for their work on the SHA [<a href="#ref-FIPS-180-4">FIPS-180-4</a>] and HMAC
   [<a href="#ref-FIPS-198-1">FIPS-198-1</a>].

   Thanks also need to go to the authors of the HMAC-SHA authentication
   RFCs, including [<a href="rfc4822.html" title='"RIPv2 Cryptographic Authentication"'>RFC4822</a>], [<a href="rfc5310.html" title='"IS-IS Generic Cryptographic Authentication"'>RFC5310</a>], and [<a href="rfc5709.html" title='"OSPFv2 HMAC-SHA Cryptographic Authentication"'>RFC5709</a>].  The basic
   HMAC-SHA procedures were originally described by Ran Atkinson in
   [<a href="rfc4822.html" title='"RIPv2 Cryptographic Authentication"'>RFC4822</a>].

   Also, thanks to Ran Atkinson for help in the analysis of <a href="rfc6506.html">RFC 6506</a>
   errata.

   Thanks to Srinivasan K L and Marek Karasek for their identification
   and submission of <a href="rfc6506.html">RFC 6506</a> errata.

   Thanks to Sam Hartman for discussions on replay mitigation and the
   use of a 64-bit strictly increasing sequence number.  Also, thanks to
   Sam for comments during IETF last call with respect to the OSPFv3 SA
   and the sharing of keys between protocols.

   Thanks to Michael Barnes for numerous comments and strong input on
   the coverage of LLS by the Authentication Trailer (AT).

   Thanks to Marek Karasek for providing the specifics with respect to
   backward-compatible transition mode.

   Thanks to Michael Dubrovskiy and Anton Smirnov for comments on
   document revisions.

   Thanks to Rajesh Shetty for numerous comments, including the
   suggestion to include an Authentication Type field in the
   Authentication Trailer for extendibility.

   Thanks to Uma Chunduri for suggesting that we may want to protect the
   IPv6 source address even though OSPFv3 uses the Router ID for
   neighbor identification.

   Thanks to Srinivasan K L, Shraddha H, Alan Davey, Russ White, Stan
   Ratliff, and Glen Kent for their support and review comments.

   Thanks to Alia Atlas for comments made under the purview of the
   Routing Directorate review.

   Thanks to Stephen Farrell for comments during the IESG review.
   Stephen was also involved in the discussion of cross-protocol
   attacks.



<span class="grey">Bhatia, et al.               Standards Track                   [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc7166.html">RFC 7166</a>            Authentication Trailer for OSPFv3         March 2014</span>


   Thanks to Brian Carpenter for comments made during the Gen-ART
   review.

   Thanks to Victor Kuarsingh for the OPS-DIR review.

   Thanks to Brian Weis for the SEC-DIR review.

Authors' Addresses

   Manav Bhatia
   Alcatel-Lucent
   Bangalore
   India

   EMail: manav.bhatia@alcatel-lucent.com


   Vishwas Manral
   Ionos Corp.
   4100 Moorpark Ave.
   San Jose, CA  95117
   USA

   EMail: vishwas@ionosnetworks.com


   Acee Lindem
   Ericsson
   301 Midenhall Way
   Cary, NC  27513
   USA

   EMail: acee.lindem@ericsson.com


















Bhatia, et al.               Standards Track                   [Page 23]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7166 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:23 GMT --></html>