<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7968 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:18 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-yizhou-trill-tree-selection" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:7968" name="DC.Identifier"/>
<meta content="August, 2016" name="DC.Date.Issued"/>
<meta content="Chen, Hao" name="DC.Creator"/>
<meta content="Chatterjee, Somnath" name="DC.Creator"/>
<meta content="TRILL (Transparent Interconnection of Lots of Links) uses distribution
trees to deliver multi-destination frames. Multiple trees can be used
by an ingress Routing Bridge (RBridge) for flows, regardless of the
VLAN, Fine-Grained Label (FGL), and/or multicast group of the flow.
Different ingress RBridges may choose different distribution trees for
TRILL Data packets in the same VLAN, FGL, and/or multicast group. To
avoid unnecessary link utilization, distribution trees should be
pruned based on one or more of the following: VLAN, FGL, or multicast
destination address. If any VLAN, FGL, or multicast group can be sent
on any tree, for typical fast-path hardware, the amount of pruning
information is multiplied by the number of trees, but there is limited
hardware capacity for such pruning information.  This document
specifies an optional facility to restrict the TRILL Data packets sent
on particular distribution trees by VLAN, FGL, and/or multicast
groups, thus reducing the total amount of pruning information so that
it can more easily be accommodated by fast-path hardware." name="DC.Description.Abstract"/>
<meta content="Transparent Interconnection of Lots of Links (TRILL): Using Data Labels for Tree Selection for Multi-Destination Data" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7968 - Transparent Interconnection of Lots of Links (TRILL): Using Data Labels for Tree Selection for Multi-Destination Data</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7968.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7968" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-trill-tree-selection" title="draft-ietf-trill-tree-selection">draft-ietf-tril...</a>] [<a href="https://datatracker.ietf.org/doc/rfc7968" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc7968" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc7968" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=7968&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>]   </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                             Y. Li
Request for Comments: 7968                               D. Eastlake 3rd
Category: Standards Track                                         W. Hao
ISSN: 2070-1721                                                  H. Chen
                                                     Huawei Technologies
                                                           S. Chatterjee
                                                                   Cisco
                                                             August 2016


         <span class="h1">Transparent Interconnection of Lots of Links (TRILL):</span>
    <span class="h1">Using Data Labels for Tree Selection for Multi-Destination Data</span>

Abstract

   TRILL (Transparent Interconnection of Lots of Links) uses
   distribution trees to deliver multi-destination frames.  Multiple
   trees can be used by an ingress Routing Bridge (RBridge) for flows,
   regardless of the VLAN, Fine-Grained Label (FGL), and/or multicast
   group of the flow.  Different ingress RBridges may choose different
   distribution trees for TRILL Data packets in the same VLAN, FGL,
   and/or multicast group.  To avoid unnecessary link utilization,
   distribution trees should be pruned based on one or more of the
   following: VLAN, FGL, or multicast destination address.  If any VLAN,
   FGL, or multicast group can be sent on any tree, for typical fast-
   path hardware, the amount of pruning information is multiplied by the
   number of trees, but there is limited hardware capacity for such
   pruning information.

   This document specifies an optional facility to restrict the TRILL
   Data packets sent on particular distribution trees by VLAN, FGL,
   and/or multicast groups, thus reducing the total amount of pruning
   information so that it can more easily be accommodated by fast-path
   hardware.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc7841.html#section-2">Section 2 of RFC 7841</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7968">http://www.rfc-editor.org/info/rfc7968</a>.



<span class="grey">Li, et al.                   Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Background Description .....................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Terminology Used in This Document ..........................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. Motivations .....................................................<a href="#page-5">5</a>
   <a href="#section-3">3</a>. Tree Selection Based on Data Labels .............................<a href="#page-9">9</a>
      <a href="#section-3.1">3.1</a>. Overview of the Mechanism ..................................<a href="#page-9">9</a>
      <a href="#section-3.2">3.2</a>. APPsub-TLVs Supporting Tree Selection .....................<a href="#page-10">10</a>
           <a href="#section-3.2.1">3.2.1</a>. The Tree and VLANs APPsub-TLV ......................<a href="#page-11">11</a>
           <a href="#section-3.2.2">3.2.2</a>. The Tree and VLANs Used APPsub-TLV .................<a href="#page-12">12</a>
           <a href="#section-3.2.3">3.2.3</a>. The Tree and FGLs APPsub-TLV .......................<a href="#page-12">12</a>
           <a href="#section-3.2.4">3.2.4</a>. The Tree and FGLs Used APPsub-TLV ..................<a href="#page-13">13</a>
           <a href="#section-3.2.5">3.2.5</a>. The Tree and Groups APPsub-TLV .....................<a href="#page-13">13</a>
           <a href="#section-3.2.6">3.2.6</a>. The Tree and Groups Used APPsub-TLV ................<a href="#page-14">14</a>
      <a href="#section-3.3">3.3</a>. Detailed Processing .......................................<a href="#page-14">14</a>
      <a href="#section-3.4">3.4</a>. Failure Handling ..........................................<a href="#page-15">15</a>
   <a href="#section-4">4</a>. Backward Compatibility .........................................<a href="#page-17">17</a>
   <a href="#section-5">5</a>. Security Considerations ........................................<a href="#page-18">18</a>
   <a href="#section-6">6</a>. IANA Considerations ............................................<a href="#page-19">19</a>
   <a href="#section-7">7</a>. References .....................................................<a href="#page-19">19</a>
      <a href="#section-7.1">7.1</a>. Normative References ......................................<a href="#page-19">19</a>
      <a href="#section-7.2">7.2</a>. Informative References ....................................<a href="#page-20">20</a>
   Acknowledgments ...................................................<a href="#page-21">21</a>
   Authors' Addresses ................................................<a href="#page-21">21</a>











<span class="grey">Li, et al.                   Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Background%20Description"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Background Description</span>

   One or more distribution trees, identified by their root nicknames,
   are used to distribute multi-destination data in a (Transparent
   Interconnection of Lots of Links) (TRILL) campus [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  The
   Routing Bridge (RBridge) having the highest tree root priority
   announces the total number of trees that should be computed for the
   campus.  It may also specify the list of trees that RBridges need to
   compute using the Tree Identifiers (TREE-RT-IDs) sub-TLV [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].
   Every RBridge can specify the trees it will use for multi-destination
   TRILL Data packets it originates in the Trees Used Identifiers
   (TREE-USE-IDs) sub-TLV [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>], and the VLANs or Fine-Grained
   Labels (FGLs) [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>] it is interested in are specified in
   Interested VLANs and/or Interested Labels sub-TLVs [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].  It is
   suggested that by default the ingress RBridge uses the distribution
   tree whose root is the closest [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  The TREE-USE-IDs sub-TLV
   is used to build the RPF (Reverse Path Forwarding) check table that
   is used for RPF checking.  Interested VLANs and Interested Labels
   sub-TLVs are used for distribution tree pruning, and the
   multi-destination forwarding table with pruning information is built
   based on that RPF check table.  To reduce unnecessary link loads,
   each distribution tree should be pruned per VLAN/FGL, eliminating
   branches that have no potential receivers downstream as specified in
   [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  Further pruning based on Layer 2 or Layer 3 multicast
   addresses is also possible.
























<span class="grey">Li, et al.                   Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   Defaults are provided, but how many trees are calculated, where the
   tree roots are located, and which tree or trees are to be used by an
   ingress RBridge are implementation dependent.  With the increasing
   demand to use TRILL in data center networks, there are some features
   we can explore for multi-destination frames in the data center use
   case.  In order to achieve non-blocking data forwarding, a fat tree
   structure is often used.  Figure 1 shows a typical data center
   network based on the fat tree structure.  RB1 and RB2 are aggregation
   switches, and RB11 through RB14 are access switches.  It is a common
   practice to configure the tree roots to be at the aggregation
   switches for efficient traffic transportation.  All the ingress
   RBridges that are access switches will then be equally distant from
   all the tree roots.

                             +-----+    +-----+
                             | RB1 |    | RB2 |
                             +-----+    +-----+
                              / | \\     / /|\
                             /  |  \ \  / / | \
                            /   |   \  \ /  |  \-----+
                           /    |    \/  \  |        |
                          /     |    /\/   \|        |
                         /  /---+---/ /\    |\       |
                        /  /    |    /  \   |  \     |
                       /  /     |   /    \  |    \   |
                      /  /      |  /      \ |      \ |
                   +-----+   +-----+   +-----+   +-----+
                   | RB11|   | RB12|   | RB13|   | RB14|
                   +-----+   +-----+   +-----+   +-----+

            Figure 1: TRILL Network Based on Fat Tree Structure

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Terminology%20Used%20in%20This%20Document"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Terminology Used in This Document</span>

   This document uses the terminology from [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] and [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>], some
   of which is repeated below for convenience, along with some
   additional terms listed below:

   Campus: The name for a network using the TRILL protocol in the same
      sense that a "bridged LAN" is the name for a network using
      bridging.  In TRILL, the word "campus" has no academic
      implication.

   Data Label: VLAN or FGL.

   ECMP: Equal-Cost Multipath [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

   FGL: Fine-Grained Label [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>].



<span class="grey">Li, et al.                   Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   Interested Labels sub-TLV: Short for "Interested Labels and Spanning
      Tree Roots sub-TLV" [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].

   Interested VLANs sub-TLV: Short for "Interested VLANs and Spanning
      Tree Roots sub-TLV" [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].

   IPTV: "Television" (video) over IP.

   RBridge: An alternative name for a TRILL switch.

   RPF: Reverse Path Forwarding.

   TRILL: Transparent Interconnection of Lots of Links (or Tunneled
      Routing in the Link Layer).

   TRILL switch: A device implementing the TRILL protocol.  Sometimes
      called an RBridge.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Motivations"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Motivations</span>

   In the structure of Figure 1, if we choose to put the tree roots at
   RB1 and RB2, the ingress RBridge (e.g., RB11) would find more than
   one equal-cost closest tree root (i.e., RB1 and RB2).  An ingress
   RBridge has two options to select the tree root for multi-destination
   frames: choose one and only one as the distribution tree root, or use
   an ECMP-like algorithm to balance the traffic among the multiple
   trees whose roots are at the same distance from the RBridge.

   -  For the former (one distribution tree root), a single tree used by
      each ingress RBridge can have the problem of uneven or inefficient
      link usage.  For example, if RB11 chooses the tree that is rooted
      at RB1 as the distribution tree, the link between RB11 and RB2
      will not be used for multi-destination frames ingressed by RB11.

   -  For the latter (an ECMP-like algorithm), ECMP-based tree selection
      results in a linear increase in multicast forwarding table size
      with the number of trees, as explained in the next paragraph.

   A multicast forwarding table at an RBridge is normally used to map
   the key of (distribution tree nickname + VLAN) to an index to a list
   of ports for multicast packet replication.  The key used for mapping
   is simply the tree nickname when the RBridge does not prune the tree.





<span class="grey">Li, et al.                   Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   The key could be the distribution tree nickname augmented by the FGL
   and/or Layer 2 or 3 multicast address when the RBridge supports FGL
   and/or Layer 2 or 3 pruning information.

   For any RBridge RBn, for each VLAN x, if RBn is in a distribution
   tree t used by traffic in VLAN x, there will be an entry of (t, x,
   port list) in the multicast forwarding table on RBn.  Typically, each
   entry contains a distinct combination of (tree nickname, VLAN) as the
   lookup key.  If there are n such trees and m such VLANs, the
   multicast forwarding table size on RBn is n*m entries.  If an FGL is
   used [<a href="rfc7172.html" title='"Transparent Interconnection of Lots of Links (TRILL): Fine-Grained Labeling"'>RFC7172</a>] and/or finer pruning is used (for example, VLAN +
   multicast group address is used for pruning), the value of m
   increases.  In the larger-scale data center, more trees would be
   necessary for purposes of better load-balancing; this results in an
   increased value for n.  In either case, the number of table entries
   (i.e., n*m) will increase dramatically.



































<span class="grey">Li, et al.                   Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   The left-hand table in Figure 2 shows an example of the multicast
   forwarding table on RB11 in the Figure 1 topology, with two
   distribution trees in a campus using typical fast-path hardware.

             Before VLAN-Based                 After VLAN-Based
              Tree Selection                    Tree Selection
     +--------------+-----+---------+  +--------------+-----+---------+
     |tree nickname |VLAN |port list|  |tree nickname |VLAN |port list|
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     |  1  |         |  |   tree 1     |  1  |         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     |  2  |         |  |   tree 1     |  2  |         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     | ... |         |  |   tree 1     | ... |         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     | ... |         |  |   tree 1     | 1999|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     | ... |         |  |   tree 1     | 2000|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     | 4093|         |  |   tree 2     | 2001|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 1     | 4094|         |  |   tree 2     | 2002|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 2     |  1  |         |  |   tree 2     | ... |         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 2     |  2  |         |  |   tree 2     | 4093|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 2     | ... |         |  |   tree 2     | 4094|         |
     +--------------+-----+---------+  +--------------+-----+---------+
     |   tree 2     | ... |         |
     +--------------+-----+---------+
     |   tree 2     | ... |         |
     +--------------+-----+---------+
     |   tree 2     | ... |         |
     +--------------+-----+---------+
     |   tree 2     | 4093|         |
     +--------------+-----+---------+
     |   tree 2     | 4094|         |
     +--------------+-----+---------+

                   Figure 2: Multicast Forwarding Table
             before and after Using VLAN-Based Tree Selection

   The number of entries is approximately 2*4K in this case.  If four
   distribution trees are used in a TRILL campus and RBn has 4K VLANs
   with downstream receivers, it consumes 16K table entries.  The size
   of fast-path TRILL multicast forwarding tables is typically limited
   by hardware; therefore, the table entries are a precious resource.



<span class="grey">Li, et al.                   Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   In some implementations, the table is shared with Layer 3 IP
   multicast for a total of 16K or 8K table entries.  Therefore, we want
   to reduce the table size consumed for TRILL distribution trees as
   much as possible and at the same time maintain load-balancing among
   the trees.

   In cases where blocks of consecutive VLANs or FGLs can be assigned to
   a tree, the multicast forwarding table could be greatly compressed if
   entries could have a Data Label value and mask, with the fast-path
   hardware doing the longest prefix matching.  But few, if any,
   fast-path implementations provide such logic.

   A straightforward way to alleviate the problem of limited table
   entries is not to prune the distribution tree.  However, this can
   only be used in restricted scenarios, for the following reasons:

   -  Not pruning wastes bandwidth for multi-destination packets.  There
      is normally broadcast traffic, like ARP and unknown unicast, that
      can be pruned on a VLAN (or FGL) so that it is not sent down
      branches of a distribution tree where it is not needed.  In
      addition, if there is a lot of Layer 3 multicast traffic, no
      pruning may result in a worst-case scenario where that user data
      is unnecessarily flooded all over the campus.  The volume of
      flooded data could be very large if certain applications such as
      IPTV are supported.  More precise pruning, such as pruning based
      on multicast groups, may be desirable in this case.

   -  Not pruning is only useful at pure transit nodes.  Edge nodes
      always need to maintain the multicast forwarding table with the
      key of (tree nickname + VLAN (or FGL)), since the edge node needs
      to decide whether and how to replicate the frame to local access
      ports.  It is likely that edge nodes are relatively low-end
      switches with a smaller shared table size, say 4K, available.

   -  Due to security concerns, VLAN-based (or FGL-based) traffic
      isolation is a basic requirement in some scenarios.  No pruning
      may increase the risk of leakage of the traffic.  Misbehaving
      RBridges may take advantage of this leakage of traffic.

   In addition to the concern regarding multicast table size, some
   silicon does not currently support hashing-based tree nickname
   selection at the ingress RBridge but commonly uses VLAN-based tree
   selection.  If the control plane of the ingress RBridge maps the
   incoming VLAN x to a tree nickname t, the data plane will always use
   tree t for VLAN x multi-destination frames.  Such an ingress RBridge
   may choose multiple trees to be used for load-sharing; it can use one
   and only one tree for each VLAN.  If we make sure that all ingress




<span class="grey">Li, et al.                   Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   RBridges campus-wide send VLAN x multi-destination packets only use
   tree t, then there would be no need to store the multicast table
   entry with the key of (tree-other-than-t, x) on any RBridge.

   This document describes the TRILL control-plane support for
   distribution tree selection based on a VLAN, FGL, and/or multicast
   address to reduce the multicast forwarding table size.  It is
   compatible with the silicon implementations mentioned in the previous
   paragraph.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Tree%20Selection%20Based%20on%20Data%20Labels"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Tree Selection Based on Data Labels</span>

   Data Label (VLAN-based or FGL-based) tree selection can be used as a
   distribution tree selection mechanism, especially when the multicast
   forwarding table size is a concern.  This section specifies that
   mechanism and how to extend it so that tree selection can be based on
   multicast groups.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Overview%20of%20the%20Mechanism"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Overview of the Mechanism</span>

   The RBridge that has the highest priority to be a tree root announces
   the tree nicknames and the Data Labels allowed on each tree.  Such
   announcements of correspondence of tree to Data Label can be based on
   static configuration or some predefined algorithm beyond the scope of
   this document.  An ingress RBridge selects the tree-VLAN
   correspondence that it wishes to use from the list announced by the
   highest-priority tree root.  It SHOULD NOT transmit VLAN x frames on
   tree y if the highest-priority tree root does not say that VLAN x is
   allowed on tree y.

   If we make sure that a particular VLAN is allowed on one and only one
   tree, we can keep the number of multicast forwarding table entries on
   any RBridge fixed at 4K maximum (or up to 16M in the case of an FGL).
   Take Figure 1 as an example, where two trees are rooted at RB1 and
   RB2, respectively.  The highest-priority tree root appoints tree 1 to
   carry VLAN 1-2000 and tree 2 to carry VLAN 2001-4094.  With such an
   announcement by the highest-priority tree root, every RBridge that
   understands the announcement will not send VLAN 2001-4094 traffic on
   tree 1 and will not send VLAN 1-2000 traffic on tree 2.  That way, no
   RBridge would need to store the entries for tree 1 / VLAN 2001-4094
   or tree 2 / VLAN 1-2000.  Figure 2 shows the multicast forwarding
   table on an RBridge before and after we use VLAN-based tree
   selection.  The number of entries is reduced by a factor f, where f
   is the number of trees used in the campus.  In this example, it is
   reduced from 2*4094 to 4094.  This affects both transit nodes and
   edge nodes.  The data-plane encoding does not change.





<span class="grey">Li, et al.                   Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20APPsub-TLVs%20Supporting%20Tree%20Selection"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  APPsub-TLVs Supporting Tree Selection</span>

   Six new APPsub-TLVs that can be carried in the TRILL GENINFO TLV
   [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>] in Extended Level 1 Flooding Scope (E-L1FS) FS-Link State
   Protocol Data Units (FS-LSPs) [<a href="rfc7780.html" title='"Transparent Interconnection of Lots of Links (TRILL): Clarifications, Corrections, and Updates"'>RFC7780</a>] are defined below.  The first
   four can be considered analogous to finer-granularity versions of the
   TREE-RT-IDs sub-TLV and the TREE-USE-IDs sub-TLV [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].  Two
   APPsub-TLVs supporting VLAN-based tree selection are specified in
   Sections <a href="#section-3.2.1">3.2.1</a> and <a href="#section-3.2.2">3.2.2</a>.  They are used by the highest-priority tree
   root to announce the allowed VLANs on each tree in the campus and by
   an ingress RBridge to announce the tree-VLAN correspondence that it
   selects from the list announced by the highest-priority tree root.
   Two APPsub-TLVs supporting FGL-based tree selection are specified in
   Sections <a href="#section-3.2.3">3.2.3</a> and <a href="#section-3.2.4">3.2.4</a> for the same purpose.  Sections <a href="#section-3.2.5">3.2.5</a> and
   3.2.6 define two APPsub-TLVs to support finer granularity in
   selecting trees based on multicast groups rather than Data Labels.

    New APPsub-TLVs              Description
    =======================      =============
    Tree and VLANs               announcement by the highest-priority
                                 tree root of the VLANs allowed per tree

    Tree and VLANs Used          tree-VLAN correspondence that an
                                 ingress RBridge selects

    Tree and FGLs                announcement by the highest-priority
                                 tree root of the FGLs allowed per tree

    Tree and FGLs Used           tree-FGL correspondence that an
                                 ingress RBridge selects

    Tree and Groups              announcement by the highest-priority
                                 tree root of the multicast groups
                                 allowed on each tree

    Tree and Groups Used         tree and multicast group correspondence
                                 that an ingress RBridge selects














<span class="grey">Li, et al.                   Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20The%20Tree%20and%20VLANs%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  The Tree and VLANs APPsub-TLV</span>

   The RBridge that is the highest-priority tree root announces the
   VLANs allowed on each tree with the Tree and VLANs (TREE-VLANs)
   APPsub-TLV.  Multiple instances of this APPsub-TLV may be carried.
   The same tree nicknames may occur in multiple Tree-VLAN RECORDs
   within the same APPsub-TLV or across multiple APPsub-TLVs.  The
   APPsub-TLV format is as follows:

                               1 1 1 1 1 1
           0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          |   Type = 11                   |         (2 bytes)
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          |   Length                      |         (2 bytes)
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
          |   Tree-VLAN RECORD (1)                    |  (6 bytes)
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
          |   .................                       |
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
          |   Tree-VLAN RECORD (N)                    |  (6 bytes)
          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+

   where each Tree-VLAN RECORD is of the form:

            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |            Nickname                   |  (2 bytes)
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            | RESV  |        Start.VLAN             |  (2 bytes)
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            | RESV  |        End.VLAN               |  (2 bytes)
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   o  Type: TRILL GENINFO APPsub-TLV type; set to 11 (TREE-VLANs).

   o  Length: 6*n bytes, where there are n Tree-VLAN RECORDs.  Thus, the
      value of Length can be used to determine n.  If Length is not a
      multiple of 6, the APPsub-TLV is corrupt and MUST be ignored.

   o  Nickname: The nickname identifying the distribution tree by its
      root.

   o  RESV: 4 bits that MUST be sent as zero and ignored on receipt.

   o  Start.VLAN, End.VLAN: These fields are the VLAN IDs of the allowed
      VLAN range on the tree, inclusive.  To specify a single VLAN, the
      VLAN's ID appears as both the start and end VLAN.  If End.VLAN is
      less than Start.VLAN, the Tree-VLAN RECORD MUST be ignored.



<span class="grey">Li, et al.                   Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20The%20Tree%20and%20VLANs%20Used%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  The Tree and VLANs Used APPsub-TLV</span>

   This APPsub-TLV has the same structure as the TREE-VLANs APPsub-TLV
   specified in <a href="#section-3.2.1">Section 3.2.1</a>.  The differences are that its APPsub-TLV
   type is set to 12 (TREE-VLAN-USE) and the tree-VLAN correspondences
   in the Tree-VLAN RECORDs listed are those correspondences that the
   originating RBridge wants to use for multi-destination packets.  This
   APPsub-TLV is used by an ingress RBridge to distribute the tree-VLAN
   correspondence that it selects from the list announced by the
   highest-priority tree root.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.3.%20%20The%20Tree%20and%20FGLs%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.3" name="section-3.2.3">3.2.3</a>.  The Tree and FGLs APPsub-TLV</span>

   The RBridge that is the highest-priority tree root can use the Tree
   and FGLs (TREE-FGLs) APPsub-TLV to announce the FGLs allowed on each
   tree.  Multiple instances of this APPsub-TLV may be carried.  The
   same tree nicknames may occur in the multiple Tree-FGL RECORDs within
   the same APPsub-TLV or across multiple APPsub-TLVs.  Its format is as
   follows:

                             1 1 1 1 1 1
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |   Type = 13                   |         (2 bytes)
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |   Length                      |         (2 bytes)
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
        |   Tree-FGL RECORD (1)                     |  (8 bytes)
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
        |   .................                       |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+
        |   Tree-FGL RECORD (N)                     |  (8 bytes)
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+

   where each Tree-FGL RECORD is of the form:

       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |            Nickname                   |         (2 bytes)
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
       |            Start.FGL                          | (3 bytes)
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+
       |            End.FGL                            | (3 bytes)
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+








<span class="grey">Li, et al.                   Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   o  Type: TRILL GENINFO APPsub-TLV type; set to 13 (TREE-FGLs).

   o  Length: 8*n bytes, where there are n Tree-FGL RECORDs.  Thus, the
      value of Length can be used to determine n.  If Length is not a
      multiple of 8, the APPsub-TLV is corrupt and MUST be ignored.

   o  Nickname: The nickname identifying the distribution tree by
      its root.

   o  RESV: 4 bits that MUST be sent as zero and ignored on receipt.

   o  Start.FGL, End.FGL: These fields are the FGL IDs of the allowed
      FGL range on the tree, inclusive.  To specify a single FGL, the
      FGL's ID appears as both the start and end FGL.  If End.FGL is
      less than Start.FGL, the Tree-FGL RECORD MUST be ignored.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.4.%20%20The%20Tree%20and%20FGLs%20Used%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.4" name="section-3.2.4">3.2.4</a>.  The Tree and FGLs Used APPsub-TLV</span>

   This APPsub-TLV has the same structure as the TREE-FGLs APPsub-TLV
   specified in <a href="#section-3.2.3">Section 3.2.3</a>.  The differences are that its APPsub-TLV
   type is set to 14 (TREE-FGL-USE) and the Tree-FGL correspondences in
   the Tree-FGL RECORDs listed are those that the originating RBridge
   wants to use for multi-destination packets.  This APPsub-TLV is used
   by an ingress RBridge to distribute the tree-FGL correspondence that
   it selects from the list announced by the highest-priority tree root.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.5.%20%20The%20Tree%20and%20Groups%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.5" name="section-3.2.5">3.2.5</a>.  The Tree and Groups APPsub-TLV</span>

   Tree selection based on Data Labels is easily extended to tree
   selection based on Data Label + Layer 2 or 3 multicast groups.  We
   can appoint multicast group 1 in VLAN 10 to tree 1 and appoint
   group 2 in VLAN 10 to tree 2 for better load-sharing.

   The RBridge that is the highest-priority tree root can announce the
   multicast groups allowed on each tree for each Data Label with the
   Tree and Groups (TREE-GROUPs) APPsub-TLV.  Multiple instances of this
   APPsub-TLV may be carried.  The APPsub-TLV format is as follows:

         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |   Type = 15                   |  (2 bytes)
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |   Length                      |  (2 bytes)
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |   Tree Nickname               |  (2 bytes)
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
         |   Group Sub-Sub-TLVs             (variable)
         +-+-+-+-+-+-+-+-+-+....




<span class="grey">Li, et al.                   Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   o  Type: TRILL GENINFO APPsub-TLV type; set to 15 (TREE-GROUPs).

   o  Length: 2 + the length of the Group Sub-Sub TLVs that are
      included.

   o  Nickname: The nickname identifying the distribution tree by its
      root.

   o  Group Sub-Sub-TLVs: Zero or more of the TLV structures that are
      allowed as sub-TLVs of the Group Address (GADDR) TLV [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>].
      Each such TLV structure specifies a multicast group and either a
      VLAN or FGL.  Although these TLV structures are considered
      sub-TLVs when they appear inside a GADDR TLV, they are technically
      sub-sub-TLVs when they appear inside a TREE-GROUPs APPsub-TLV that
      is in turn inside a TRILL GENINFO TLV [<a href="rfc7357.html" title='"Transparent Interconnection of Lots of Links (TRILL): End Station Address Distribution Information (ESADI) Protocol"'>RFC7357</a>].

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.6.%20%20The%20Tree%20and%20Groups%20Used%20APPsub-TLV"></a><a class="selflink" href="#section-3.2.6" name="section-3.2.6">3.2.6</a>.  The Tree and Groups Used APPsub-TLV</span>

   The Tree and Groups Used (TREE-GROUPs-USE) APPsub-TLV has the same
   structure as the TREE-GROUPs APPsub-TLV specified in <a href="#section-3.2.5">Section 3.2.5</a>.
   The differences are that its APPsub-TLV type is set to 16
   (TREE-GROUPs-USE) and the Tree Nickname and Group sub-sub-TLVs listed
   in this APPsub-TLV are those that the originating RBridge wants to
   use for multi-destination packets.  This APPsub-TLV is used by an
   ingress RBridge to distribute the tree-group correspondence that it
   selects from the list announced by the highest-priority tree root.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Detailed%20Processing"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Detailed Processing</span>

   The highest-priority tree root RBridge MUST include all the necessary
   tree-related sub-TLVs defined in [<a href="rfc7176.html" title='"Transparent Interconnection of Lots of Links (TRILL) Use of IS-IS"'>RFC7176</a>] as usual in its E-L1FS
   FS-LSP and MAY include the TREE-VLANs APPsub-TLV and/or the TREE-FGLs
   APPsub-TLV in its E-L1FS FS-LSP [<a href="rfc7780.html" title='"Transparent Interconnection of Lots of Links (TRILL): Clarifications, Corrections, and Updates"'>RFC7780</a>].  In this way, it MAY
   indicate that each VLAN and/or FGL is only allowed on one or some
   other number of trees less than the number of trees being calculated
   in the campus in order to save table space in the fast-path
   forwarding hardware.

   An ingress RBridge that understands the TREE-VLANs APPsub-TLV SHOULD
   select the tree-VLAN correspondences that it wishes to use and put
   them in TREE-VLAN-USE APPsub-TLVs.  If there are multiple tree
   nicknames announced in a TREE-VLANs APPsub-TLV for VLAN x, the
   ingress RBridge chooses one of them if it supports this feature.  For
   example, the ingress RBridge may choose the closest (minimum-cost)
   root among them.  How to make such a choice is out of scope for this
   document.  It may be desirable to have some fixed algorithm to
   make sure that all ingress RBridges choose the same tree for VLAN x
   in this case.  Any single Data Label that the ingress RBridge is



<span class="grey">Li, et al.                   Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   interested in should be related to only one tree ID in a
   TREE-VLAN-USE APPsub-TLV to minimize the multicast forwarding table
   size on other RBridges, but as long as the Data Label is related to
   less than all the trees being calculated, it will reduce the burden
   on the forwarding table size.

   When an ingress RBridge encapsulates a multi-destination frame for
   Data Label x, it SHOULD use a tree nickname that it selected
   previously in a TREE-VLAN-USE or TREE-FGL-USE APPsub-TLV for
   Data Label x.  However, that may not be possible because either
   (1) the RBridge may not have advertised such TREE-VLAN-USE or
   TREE-FGL-USE APPsub-TLVs, in which case it can use any tree that has
   been advertised as permitted for the Data Label by the
   highest-priority tree root RBridge, or (2) the tree or trees it
   advertised might be unavailable due to failures.

   If RBridge RBn does not perform pruning, it builds the multicast
   forwarding table as specified in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].

   If RBn prunes the distribution tree based on VLANs, RBn uses the
   information received in TREE-VLAN-USE APPsub-TLVs to mark the set of
   VLANs reachable downstream for each adjacency and for each related
   tree.  If RBn prunes the distribution tree based on FGLs, RBn uses
   the information received in TRILL-FGL-USE APPsub-TLVs to mark the
   set of FGLs reachable downstream for each adjacency and for each
   related tree.

   Logically, an ingress RBridge that does not support VLAN-based or
   FGL-based tree selection is equivalent to the one that supports it
   but uses it in such a way as to gain no advantage; for example, it
   announces the use of all trees for all VLANs and FGLs.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Failure%20Handling"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Failure Handling</span>

   This section discusses failure scenarios for a distribution tree root
   for the case where that tree root is not the highest-priority root
   and the case where it is the highest-priority root.  This section
   also discusses some other transient error conditions.

   Failure of a tree root that is not the highest-priority tree root:
      It is the responsibility of the highest-priority tree root to
      inform other RBridges of any change in the allowed tree-VLAN
      correspondence.  When the highest-priority tree root learns that
      the root of tree t has failed, it should reassign the VLANs
      allowed on tree t to other trees or to a tree replacing the
      failed one.





<span class="grey">Li, et al.                   Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   Failure of the highest-priority tree root: It is suggested that the
      tree root of second-highest priority be pre-configured with the
      proper knowledge of the tree-VLAN correspondence allowed when the
      highest-priority tree root fails.  The information announced by
      the RBridge that has the second-highest priority to be a tree root
      would be in the link state of all RBridges but would not take
      effect unless the RBridge noticed the failure of the
      highest-priority tree root.  When the highest-priority tree root
      fails, the tree root that formerly had second-highest priority
      will become the highest-priority tree root of the campus.  When an
      RBridge notices the failure of the original highest-priority tree
      root, it can immediately use the stored information announced by
      the tree root that originally had second-highest priority.  It is
      suggested that the tree-VLAN correspondence information be
      pre-configured on the tree root of second-highest priority to be
      the same as that on the highest-priority tree root for the trees
      other than the highest-priority tree itself.  This can minimize
      the change to multicast forwarding tables in the case of
      highest-priority tree root failure.  For a large campus, it may
      make sense to pre-configure this information in a similar way on
      the third-priority, fourth-priority, or even lower-priority tree
      root RBridges.

   In some transient conditions, or in the case of a misbehaving
   highest-priority tree root, an ingress RBridge may encounter the
   following scenarios:

   -  No tree has been announced for which VLAN x frames are allowed.

   -  An ingress RBridge is supposed to transmit VLAN x frames on
      tree t, but the root of tree t is no longer reachable.

   For the second case, an ingress RBridge may choose another reachable
   tree root that allows VLAN x frames according to the highest-priority
   tree root announcement.  If there is no such tree available, then it
   is the same as the first case above.  The ingress RBridge should then
   be "downgraded" to a conventional RBridge with behavior as specified
   in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  A timer should be set to allow the temporary transient
   stage to complete before the change of the responsive tree or the
   downgrade takes effect.  The value of the timer should be set to at
   least the LSP flooding time of the campus.










<span class="grey">Li, et al.                   Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Backward%20Compatibility"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Backward Compatibility</span>

   RBridges MUST include the TREE-USE-IDs and INT-VLAN sub-TLVs in their
   LSPs when required by [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] whether or not they support the new
   TREE-VLAN-USE or TREE-FGL-USE APPsub-TLVs specified by this document.

   RBridges that understand the new TREE-VLAN-USE APPsub-TLV sent from
   another RBridge RBn should use it to build the multicast forwarding
   table and ignore the TREE-USE-IDs and INT-VLAN sub-TLVs sent from the
   same RBridge.  TREE-USE-IDs and INT-VLAN sub-TLVs are still useful
   for some purposes other than building the multicast forwarding table
   (e.g., building an RPF table, spanning tree root notification).  If
   the RBridge does not receive TREE-VLAN-USE APPsub-TLVs from RBn, it
   uses the conventional way described in [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>] to build the
   multicast forwarding table.

   For example, there are two distribution trees, tree 1 and tree 2, in
   the campus.  RB1 and RB2 are RBridges that use the new APPsub-TLVs
   described in this document.  RB3 is an old RBridge that is compatible
   with [<a href="rfc6325.html" title='"Routing Bridges (RBridges): Base Protocol Specification"'>RFC6325</a>].  Assume that RB2 is interested in VLANs 10 and 11 and
   RB3 is interested in VLANs 100 and 101.  Hence, RB1 receives
   ((tree 1, VLAN 10), (tree 2, VLAN 11)) as a TREE-VLAN-USE APPsub-TLV
   and (tree 1, tree 2) as a TREE-USE-IDs sub-TLV from RB2 on port x.
   Also, RB1 receives (tree 1) as a TREE-USE-IDs sub-TLV and no
   TREE-VLAN-USE APPsub-TLV from RB3 on port y.  RB2 and RB3 announce
   their interested VLANs in an INT-VLAN sub-TLV as usual.  RB1 will
   then build the entry of (tree 1, VLAN 10, port x) and
   (tree 2, VLAN 11, port x) based on RB2's LSP and the mechanism
   specified in this document.  RB1 also builds entries of
   (tree 1, VLAN 100, port y), (tree 1, VLAN 101, port y),
   (tree 2, VLAN 100, port y), and (tree 2, VLAN 101, port y) based on
   RB3's LSP in the conventional way.



















<span class="grey">Li, et al.                   Standards Track                   [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   The multicast forwarding table on RB1 with a merged entry would be
   like the following:

                 +--------------+-----+---------+
                 |tree nickname |VLAN |port list|
                 +--------------+-----+---------+
                 |   tree 1     |  10 |    x    |
                 +--------------+-----+---------+
                 |   tree 1     | 100 |    y    |
                 +--------------+-----+---------+
                 |   tree 1     | 101 |    y    |
                 +--------------+-----+---------+
                 |   tree 2     |  11 |    x    |
                 +--------------+-----+---------+
                 |   tree 2     | 100 |    y    |
                 +--------------+-----+---------+
                 |   tree 2     | 101 |    y    |
                 +--------------+-----+---------+

   As expected, that table is not as small as the one where every
   RBridge supports the new TREE-VLAN-USE APPsub-TLVs.  In a hybrid
   campus, the worst case would be where the number of entries is equal
   to the number of entries required by the current practice that does
   not support VLAN-based tree selection.  Such an extreme case happens
   when the set of interested VLANs from the new RBridges is a subset of
   the set of interested VLANs from the old RBridges.

   Tree selection based on the Data Label and multicast group is
   compatible with the current practice.  Its effectiveness increases
   with more RBridges supporting this feature in the TRILL campus.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   This document does not change the general RBridge security
   considerations of the TRILL base protocol.  The APPsub-TLVs specified
   can be secured using the IS-IS authentication feature [<a href="rfc5310.html" title='"IS-IS Generic Cryptographic Authentication"'>RFC5310</a>].  See
   <a href="rfc6325.html#section-6">Section 6 of [RFC6325]</a> for general TRILL security considerations.














<span class="grey">Li, et al.                   Standards Track                   [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  IANA Considerations</span>

   IANA has assigned six new TRILL APPsub-TLV types from the range less
   than 255, as specified in <a href="#section-3">Section 3</a>, and updated the "TRILL
   APPsub-TLV Types under IS-IS TLV 251 Application Identifier 1"
   registry on
   &lt;<a href="http://www.iana.org/assignments/trill-parameters/">http://www.iana.org/assignments/trill-parameters/</a>&gt;, as shown below.

     Type   Name of APPsub-TLV         Reference
     ----   -----------------------    -------------------------
      11    Tree and VLANs             <a href="rfc7968.html#section-3.2.1">Section 3.2.1 of RFC 7968</a>
      12    Tree and VLANs Used        <a href="rfc7968.html#section-3.2.2">Section 3.2.2 of RFC 7968</a>
      13    Tree and FGLs              <a href="rfc7968.html#section-3.2.3">Section 3.2.3 of RFC 7968</a>
      14    Tree and FGLs Used         <a href="rfc7968.html#section-3.2.4">Section 3.2.4 of RFC 7968</a>
      15    Tree and Groups            <a href="rfc7968.html#section-3.2.5">Section 3.2.5 of RFC 7968</a>
      16    Tree and Groups Used       <a href="rfc7968.html#section-3.2.6">Section 3.2.6 of RFC 7968</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20References"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Normative%20References"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC6325" name="ref-RFC6325">RFC6325</a>]  Perlman, R., Eastlake 3rd, D., Dutt, D., Gai, S., and A.
              Ghanwani, "Routing Bridges (RBridges): Base Protocol
              Specification", <a href="rfc6325.html">RFC 6325</a>, DOI 10.17487/RFC6325, July 2011,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6325">http://www.rfc-editor.org/info/rfc6325</a>&gt;.

   [<a id="ref-RFC7172" name="ref-RFC7172">RFC7172</a>]  Eastlake 3rd, D., Zhang, M., Agarwal, P., Perlman, R., and
              D. Dutt, "Transparent Interconnection of Lots of Links
              (TRILL): Fine-Grained Labeling", <a href="rfc7172.html">RFC 7172</a>,
              DOI 10.17487/RFC7172, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7172">http://www.rfc-editor.org/info/rfc7172</a>&gt;.

   [<a id="ref-RFC7176" name="ref-RFC7176">RFC7176</a>]  Eastlake 3rd, D., Senevirathne, T., Ghanwani, A., Dutt,
              D., and A. Banerjee, "Transparent Interconnection of Lots
              of Links (TRILL) Use of IS-IS", <a href="rfc7176.html">RFC 7176</a>,
              DOI 10.17487/RFC7176, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7176">http://www.rfc-editor.org/info/rfc7176</a>&gt;.









<span class="grey">Li, et al.                   Standards Track                   [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   [<a id="ref-RFC7357" name="ref-RFC7357">RFC7357</a>]  Zhai, H., Hu, F., Perlman, R., Eastlake 3rd, D., and O.
              Stokes, "Transparent Interconnection of Lots of Links
              (TRILL): End Station Address Distribution Information
              (ESADI) Protocol", <a href="rfc7357.html">RFC 7357</a>, DOI 10.17487/RFC7357,
              September 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7357">http://www.rfc-editor.org/info/rfc7357</a>&gt;.

   [<a id="ref-RFC7780" name="ref-RFC7780">RFC7780</a>]  Eastlake 3rd, D., Zhang, M., Perlman, R., Banerjee, A.,
              Ghanwani, A., and S. Gupta, "Transparent Interconnection
              of Lots of Links (TRILL): Clarifications, Corrections, and
              Updates", <a href="rfc7780.html">RFC 7780</a>, DOI 10.17487/RFC7780, February 2016,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7780">http://www.rfc-editor.org/info/rfc7780</a>&gt;.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Informative%20References"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-RFC5310" name="ref-RFC5310">RFC5310</a>]  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,
              and M. Fanto, "IS-IS Generic Cryptographic
              Authentication", <a href="rfc5310.html">RFC 5310</a>, DOI 10.17487/RFC5310,
              February 2009, &lt;<a href="http://www.rfc-editor.org/info/rfc5310">http://www.rfc-editor.org/info/rfc5310</a>&gt;.

































<span class="grey">Li, et al.                   Standards Track                   [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


Acknowledgments

   The authors wish to thank David M. Bond, Liangliang Ma, Naveen Nimmu,
   Radia Perlman, Rakesh Kumar, Robert Sparks, Daniele Ceccarelli, and
   Sunny Rajagopalan for their valuable comments and contributions.

Authors' Addresses

   Yizhou Li
   Huawei Technologies
   101 Software Avenue
   Nanjing  210012
   China

   Phone: +86-25-56624629
   Email: liyizhou@huawei.com


   Donald Eastlake 3rd
   Huawei Technologies
   155 Beaver Street
   Milford, MA  01757
   United States of America

   Phone: +1-508-333-2270
   Email: d3e3e3@gmail.com


   Weiguo Hao
   Huawei Technologies
   101 Software Avenue
   Nanjing  210012
   China

   Phone: +86-25-56623144
   Email: haoweiguo@huawei.com















<span class="grey">Li, et al.                   Standards Track                   [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc7968.html">RFC 7968</a>       TRILL: Tree Selection Based on Data Labels    August 2016</span>


   Hao Chen
   Huawei Technologies
   101 Software Avenue
   Nanjing  210012
   China

   Email: philips.chenhao@huawei.com


   Somnath Chatterjee
   Cisco Systems
   SEZ Unit, Cessna Business Park
   Outer Ring Road
   Bangalore  560087
   India

   Email: somnath.chatterjee01@gmail.com


































Li, et al.                   Standards Track                   [Page 22]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7968 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:18 GMT --></html>