<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc7737 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:34:31 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.119" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content='   The Multiprotocol Label Switching (MPLS) Label Switched Path (LSP)
   Ping and Traceroute use the Reply Mode field to signal the method to
   be used in the MPLS echo reply.  This document updates the procedures
   for the "Reply via Specified Path" Reply Mode.  The value of this
   Reply Mode is 5.  The update creates a simple way to indicate that
   the reverse LSP should be used as the return path.  This document
   also adds an optional TLV that can carry an ordered list of Reply
   Mode values.

   This document updates RFC 7110.
' name="DC.Description.Abstract"/>
<meta content="Swallow, George" name="DC.Creator"/>
<meta content="Chen, Mach(Guoyi)" name="DC.Creator"/>
<meta content="Pignataro, Carlos" name="DC.Creator"/>
<meta content="Akiya, Nobo" name="DC.Creator"/>
<meta content="Andersson, Loa" name="DC.Creator"/>
<meta content="Label Switched Path (LSP) Ping and Traceroute Reply Mode Simplification" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 7737 - Label Switched Path (LSP) Ping and Traceroute Reply Mode Simplification</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgwhite" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc7737.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc7737" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-mpls-lsp-ping-reply-mode-simple" title="draft-ietf-mpls-lsp-ping-reply-mode-simple">draft-ietf-mpls-l...</a>]                                 </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Internet Engineering Task Force (IETF)                          N. Akiya
Request for Comments: 7737                           Big Switch Networks
Updates: <a href="rfc7110.html">7110</a>                                                 G. Swallow
Category: Standards Track                                   C. Pignataro
ISSN: 2070-1721                                            Cisco Systems
                                                            L. Andersson
                                                                 M. Chen
                                                                  Huawei
                                                            January 2016


Label Switched Path (LSP) Ping and Traceroute Reply Mode Simplification

Abstract

   The Multiprotocol Label Switching (MPLS) Label Switched Path (LSP)
   Ping and Traceroute use the Reply Mode field to signal the method to
   be used in the MPLS echo reply.  This document updates the procedures
   for the "Reply via Specified Path" Reply Mode.  The value of this
   Reply Mode is 5.  The update creates a simple way to indicate that
   the reverse LSP should be used as the return path.  This document
   also adds an optional TLV that can carry an ordered list of Reply
   Mode values.

   This document updates <a href="rfc7110.html">RFC 7110</a>.

Status of This Memo

   This is an Internet Standards Track document.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Further information on
   Internet Standards is available in <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc7737">http://www.rfc-editor.org/info/rfc7737</a>.












<span class="grey">Akiya, et al.                Standards Track                    [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Requirements Language . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Problem Statements  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Solution  . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.1">3.1</a>.  "Reply via Specified Path" Reply Mode Update  . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.2">3.2</a>.  Reply Mode Order TLV  . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Relationships to Other LSP Ping and Traceroute Features . . .   <a href="#page-8">8</a>
     4.1.  Backwards Compatibility with "Reply via Specified Path"
           Reply Mode  . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-4.2">4.2</a>.  Reply Path TLV  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
       4.2.1.  Example 1: Reply Mode Order TLV Usage with Reply Path
               TLV . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
       4.2.2.  Example 2: Reply Mode Order TLV Usage with Reply Path
               TLV . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-4.3">4.3</a>.  Proxy LSP Ping  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-4.3.1">4.3.1</a>.  Proxy LSR Sending an MPLS Echo Request  . . . . . . .  <a href="#page-10">10</a>
       <a href="#section-4.3.2">4.3.2</a>.  Proxy LSR Sending an MPLS Proxy Ping Reply  . . . . .  <a href="#page-11">11</a>
   <a href="#section-5">5</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  Manageability Considerations  . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-7">7</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.1">7.1</a>.  New Reply Mode Order TLV  . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-8">8</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-8.1">8.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-8.2">8.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#appendix-A">Appendix A</a>.  Reply Mode Order TLV Beneficial Scenarios  . . . . .  <a href="#page-14">14</a>
     <a href="#appendix-A.1">A.1</a>.  Incorrect Forwarding Scenario . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#appendix-A.2">A.2</a>.  Non-Co-Routed Bidirectional LSP Scenario  . . . . . . . .  <a href="#page-15">15</a>
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   Contributors  . . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>




<span class="grey">Akiya, et al.                Standards Track                    [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Multiprotocol Label Switching (MPLS) Label Switched Path (LSP) Ping,
   as described in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], allows an initiator Label Switching Router
   (LSR) to encode instructions (Reply Mode) on how a responder LSR
   should send the response back to the initiator LSR.  [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] also
   allows the initiator LSR to encode a TLV (Reply Path TLV) that can
   instruct the responder LSR to use a specific LSP to send the response
   back to the initiator LSR.  Both approaches are powerful, as they
   provide the ability for the initiator LSR to control the return path.

   However, it is becoming increasingly difficult for an initiator LSR
   to select a valid return path to encode in the MPLS LSP echo request
   packets.  If the initiator LSR does not select a valid return path,
   the MPLS LSP echo reply will not get back to the initiator LSR.  This
   results in a false failure of MPLS LSP Ping and Traceroute
   operations.  In an effort to minimize such false failures, different
   implementations have chosen different default return path encoding
   for different LSP types and LSP operations.  The problem with
   implementations having different default return path encoding is that
   the MPLS echo reply will not work in many cases, and the default
   value may not be the preferred choice of the operators.

   This document describes the following:

   o  In <a href="#section-2">Section 2</a>, further description of the problems;

   o  In <a href="#section-3">Section 3</a>, a solution to minimize false failures while
      accommodating operator preferences;

   o  In <a href="#section-4">Section 4</a>, relationships to other LSP Ping and Traceroute
      features;

   o  In <a href="#appendix-A">Appendix A</a>, examples of scenarios where the mechanism described
      in this document provides benefits.

   This document updates [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] by allowing the usage of the "Reply
   via Specified Path" (value=5) Reply Mode without including the Reply
   Path TLV.  The update creates a simple way to indicate that the
   reverse LSP should be used as the return path.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].





<span class="grey">Akiya, et al.                Standards Track                    [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Problem%20Statements"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Problem Statements</span>

   It is becoming increasingly difficult for implementations to
   automatically supply a workable return path encoding for all MPLS LSP
   Ping and Traceroute operations across all LSP types.  There are
   several factors that contribute to this complication.

   o  Some LSPs have a control channel, and some do not.  Some LSPs have
      a reverse LSP, and some do not.  Some LSPs have IP reachability in
      the reverse direction, and some do not.

   o  LSRs on some LSPs can have different available return path(s).
      Available return path(s) can depend on whether the responder LSR
      is a transit LSR or an egress LSR.  In the case of a bidirectional
      LSP, available return path(s) on transit LSRs can also depend on
      whether the LSP is completely co-routed, partially co-routed, or
      associated (i.e., the LSPs in the two directions are not
      co-routed).

   o  MPLS echo request packets may incorrectly terminate on an
      unintended target that can have different available return path(s)
      than the intended target.

   o  The MPLS LSP Ping operation is expected to terminate on an egress
      LSR.  However, MPLS LSP Ping operations with specific TTL values
      and MPLS LSP Traceroute operations can terminate on both transit
      LSR(s) and the egress LSR.

   Except for the case where the responder LSR does not have an IP route
   back to the initiator LSR, it is possible to use the "Reply via an
   IPv4/IPv6 UDP packet" (value=2) Reply Mode value in all cases.
   However, some operators prefer the control channel and a reverse LSP
   as the default return path if they are both available, although this
   is not always the case.

   When specific return path encoding is supplied by users or
   applications, then there are no issues in choosing the return path
   encoding.  When specific return path encoding is not supplied by
   users or applications, then implementations use extra logic to
   compute, and sometimes guess, the default return path encodings.  If
   a responder LSR receives an MPLS echo request containing return path
   instructions that cannot be accommodated due to unavailability, then
   the responder LSR often drops such packets.  This failure mode
   results in the initiator LSR not receiving the intended MPLS LSP echo
   reply packets.  The scenario described here is a potentially
   acceptable result in some failure cases, like a broken LSP, where the
   MPLS echo request terminated on an unintended target.  However, if
   the initiator LSR does not receive an MPLS echo reply even after the



<span class="grey">Akiya, et al.                Standards Track                    [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   responder LSR receives the MPLS echo request and is able to verify
   the request, information is still sent back to the user(s); this is
   considered a false failure.

   Many operators prefer particular return path(s) over other return
   path(s) for specific LSP types.  To accommodate operator-preferred
   paths, implementations may default to operator-preferred return paths
   for particular operations or allow a default return path to be
   configured.  It would not be considered beneficial to use a preferred
   return path for an intended target LSR if there is previous knowledge
   at the initiator LSR that the return path is not available.  Using an
   unavailable preferred return path would undesirably result in the
   initiator LSR not receiving the MPLS echo return packets.  It would
   be considered beneficial, for given operations, if the sender of the
   MPLS echo request would be able to determine return path availability
   before the operation is initiated.

   This document (1) updates the procedures for the "Reply via Specified
   Path" Reply Mode to easily indicate the reverse LSP and (2) adds one
   optional TLV to describe an ordered list of Reply Modes.  Based on
   operational needs, the TLV can list multiple Reply Mode values in a
   preferred order to allow the responder LSR to use the first available
   Reply Mode from the list.  This eliminates the need for the initiator
   LSR to compute, or sometimes guess, the default return path encoding.
   This new mode of operation would result in simplified implementations
   across the various vendors and improve both usability and operational
   needs.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Solution"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Solution</span>

   This document updates the procedures for the "Reply via Specified
   Path" Reply Mode to easily indicate the reverse LSP.  This document
   also adds an optional TLV that can carry an ordered list of Reply
   Modes.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20%22Reply%20via%20Specified%20Path%22%20Reply%20Mode%20Update"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  "Reply via Specified Path" Reply Mode Update</span>

   Some LSP types are capable of having a related LSP in the reverse
   direction, through signaling or other association mechanisms.
   Examples of such LSP types are bidirectional Resource Reservation
   Protocol-Traffic Engineering (RSVP-TE) LSPs [<a href="rfc3473.html" title='"Generalized Multi-Protocol Label Switching (GMPLS) Signaling Resource ReserVation Protocol- Traffic Engineering (RSVP-TE) Extensions"'>RFC3473</a>] and MPLS
   Transport Profile (MPLS-TP) LSPs [<a href="rfc5960.html" title='"MPLS Transport Profile Data Plane Architecture"'>RFC5960</a>].  This document uses the
   term "reverse LSP" to refer to the LSP in the reverse direction of
   such LSP types.  Note that this document restricts the scope of
   "reverse LSP" applicability to those reverse LSPs that are capable
   and allowed to carry the IP encapsulated MPLS echo reply.





<span class="grey">Akiya, et al.                Standards Track                    [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   [<a id="ref-RFC7110" name="ref-RFC7110">RFC7110</a>] has defined the Reply Mode "Reply via Specified Path",
   which allows the initiator LSR to instruct the responder LSR to send
   the MPLS echo reply message on the reverse LSP.  However, the
   instruction also requires the initiator LSR to include the Reply Path
   TLV with the B bit (Bidirectional bit) set in the Flags field.
   Additionally, [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] specifies that if the "Reply via Specified
   Path" Reply Mode is used the Reply Path TLV MUST be present.

   This document updates the procedures for the "Reply via Specified
   Path" Reply Mode as follows:

   o  The "Reply via Specified Path" Reply Mode MAY be used without
      including a Reply Path TLV.

   o  The usage of the "Reply via Specified Path" Reply Mode without the
      inclusion of a Reply Path TLV implies the reverse LSP.  In other
      words, the usage of the "Reply via Specified Path" Reply Mode
      without the inclusion of a Reply Path TLV has the same semantics
      as the usage of the "Reply via Specified Path" Reply Mode with the
      inclusion of a Reply Path TLV with the B bit set in the Flags
      field.

   This document updates the first sentence of <a href="rfc7110.html#section-5.1">Section 5.1 of [RFC7110]</a>
   as follows:

   o  When sending an echo request, in addition to the rules and
      procedures defined in <a href="rfc4379.html#section-4.3">Section 4.3 of [RFC4379]</a>, the Reply Mode of
      the echo request MUST be set to "Reply via Specified Path", and a
      Reply Path TLV SHOULD be carried in the echo request message
      correspondingly; if the Reply Path TLV is not carried in the
      message, then it indicates the reverse LSP as the reply path.

   Note that the reverse LSP is in relation to the last Forwarding
   Equivalence Class (FEC) specified in the Target FEC Stack TLV.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Reply%20Mode%20Order%20TLV"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Reply Mode Order TLV</span>

   This document also introduces a new optional TLV to describe a list
   of Reply Mode values.  The new TLV will contain one or more Reply
   Mode values in preferred order.  The first Reply Mode value is the
   most preferred, and the last Reply Mode value is the least preferred.
   The following rules apply when using the Reply Mode Order TLV:

   1.  The Reply Mode Order TLV MUST NOT be included in any MPLS echo
       reply.  If the initiator LSR receives an MPLS echo reply with the
       Reply Mode Order TLV, the initiator LSR MUST ignore the whole
       Reply Mode Order TLV and MUST only use the value from the Reply




<span class="grey">Akiya, et al.                Standards Track                    [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


       Mode field of the received MPLS echo reply.  It may be beneficial
       for implementations to provide counters and/or logs, with
       appropriate log dampening, to record this error case.

   2.  The Reply Mode Order TLV MAY be included in MPLS echo requests.

   3.  The Reply Mode field of an MPLS echo request MUST be set to a
       valid value even when supplying the Reply Mode Order TLV.  The
       initiator LSR SHOULD set the Reply Mode field of an MPLS echo
       request to a value that corresponds to a return path that is most
       likely to be available, in case the responder LSR does not
       understand the Reply Mode Order TLV.

   4.  If a responder LSR understands the Reply Mode Order TLV but the
       TLV is not valid (due to the conditions described in items 6, 7,
       8, and 9 below), then the responder LSR MUST ignore the whole
       Reply Mode Order TLV and MUST only use the value from the Reply
       Mode field of the received MPLS echo request.  It may be
       beneficial for implementations to provide counters and/or logs,
       with appropriate log dampening, to record this error case.

   5.  If a responder LSR understands the Reply Mode Order TLV and the
       TLV is valid, then the responder LSR MUST consider the Reply Mode
       values specified in the TLV and MUST NOT use the value specified
       in the Reply Mode field of the received MPLS echo request.  In
       other words, a valid Reply Mode Order TLV overrides the value
       specified in the Reply Mode field of the received MPLS echo
       request.

   6.  The Reply Mode Order TLV MUST contain at least one Reply Mode
       value.

   7.  A Reply Mode value, except for Reply Mode value 5 (Reply via
       Specified Path), MUST NOT be repeated (i.e., MUST NOT appear
       multiple times) in the Reply Mode Order TLV.

   8.  Reply Mode value 5 (Reply via Specified Path) MAY be included
       more than once in the Reply Mode Order TLV.  However, in such a
       case, a Reply Path TLV MUST be included for all instances of
       Reply Mode value 5 that are included in the Reply Mode Order TLV.
       In other words, three instances of Reply Mode value 5 in the
       Reply Mode Order TLV will each require a Reply Path TLV.

   9.  The Reply Mode value 1 (Do not reply) MUST NOT be used in the
       Reply Mode Order TLV.






<span class="grey">Akiya, et al.                Standards Track                    [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   The responder LSR SHOULD select the first available return path in
   this TLV.  The Reply Mode value corresponding to the selected return
   path MUST be set in the Reply Mode field of the MPLS echo reply to
   communicate back to the initiator LSR which return path was chosen.

   The format of the TLV is as follows:

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Reply Mode Order TLV Type     |          Length               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ~ Reply Mode 1  | Reply Mode 2  | Reply Mode 3  | Reply Mode 4  ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                      Figure 1: Reply Mode Order TLV

   This is a variable-length optional TLV.  The Reply Mode Order TLV
   Type is 32770.

   The Length field is 2 octets in length.  It defines the length, in
   octets, of the list of Reply Mode values.

   Each Reply Mode field is 1 octet, and there is no padding.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Relationships%20to%20Other%20LSP%20Ping%20and%20Traceroute%20Features"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Relationships to Other LSP Ping and Traceroute Features</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Backwards%20Compatibility%20with%20%22Reply%20via%20Specified%20Path%22%20Reply%20Mode"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Backwards Compatibility with "Reply via Specified Path" Reply Mode</span>

   [<a id="ref-RFC7110" name="ref-RFC7110">RFC7110</a>] introduces the "Reply via Specified Path" (value=5) Reply
   Mode.  [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] also specifies that if this Reply Mode is used the
   Reply Path TLV MUST be included.  This document relaxes the semantics
   and specifies that this Reply Mode MAY be used without the Reply Path
   TLV.  This MAY be done to indicate that the reverse LSP SHALL be used
   as the return path.

   If an initiator LSR that sent an MPLS echo request message with the
   "Reply via Specified Path" Reply Mode but without including the Reply
   Path TLV receives back an MPLS echo reply message with a return code
   of "Malformed echo request received", then the initiator LSR SHOULD
   assume that the responder LSR does not support the mechanism defined
   in this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Reply%20Path%20TLV"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Reply Path TLV</span>

   A Reply Path TLV [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] is defined to identify a single return
   path.  When the initiator LSR wants to use the Reply Mode Order TLV
   to specify multiple return paths, then the initiator LSR SHOULD



<span class="grey">Akiya, et al.                Standards Track                    [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   include multiple "Reply via Specified Path" (value=5) Reply Mode
   values and multiple corresponding Reply Path TLV objects (one Reply
   Path TLV corresponding to a "Reply via Specified Path" Reply Mode and
   one Reply Path TLV identifying a return path).

   As described in <a href="#section-3.1">Section 3.1</a>, it is valid to use the "Reply via
   Specified Path" Reply Mode without inclusion in a Reply Path TLV.
   For the Reply Mode Order TLV, it is also valid to include a "Reply
   via Specified Path" Reply Mode value without a corresponding Reply
   Path TLV; this implies that the reverse LSP is the preferred return
   path.  When multiple consecutive "Reply via Specified Path" Reply
   Mode values are included but fewer corresponding Reply Path TLV
   objects exist, the responder LSR SHOULD think that the former "Reply
   via Specified Path" Reply Mode values have corresponding Reply Path
   TLVs.  The latter "Reply via Specified Path" Reply Mode values have
   no corresponding Reply Path TLVs.  For example, if the Reply Mode
   Order TLV carries Reply Modes {5, 5, 5} and only two Reply Path TLVs
   carry FEC X and FEC Y, respectively, then the reply path order is as
   follows:

   1.  Reply via Specified Path (FEC X)

   2.  Reply via Specified Path (FEC Y)

   3.  Reply via Specified Path (reverse LSP)

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.1.%20%20Example%201%3A%20Reply%20Mode%20Order%20TLV%20Usage%20with%20Reply%20Path%20TLV"></a><a class="selflink" href="#section-4.2.1" name="section-4.2.1">4.2.1</a>.  Example 1: Reply Mode Order TLV Usage with Reply Path TLV</span>

   If the initiator LSR was interested in encoding the following return
   paths:

   1.  Reply via application level control channel

   2.  FEC X

   3.  FEC Y

   4.  Reply via an IPv4/IPv6 UDP packet

   Then the MPLS echo request message is to carry:

   o  The Reply Mode Order TLV carrying Reply Modes {4, 5, 5, 2}

   o  One Reply Path TLV carrying FEC X

   o  One Reply Path TLV carrying FEC Y





<span class="grey">Akiya, et al.                Standards Track                    [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   The encoding specified by the Reply Mode Order TLV and the Reply Path
   TLV in the MPLS echo request message will cause the responder LSR to
   prefer "Reply via application level control channel (4)", followed by
   FEC X, FEC Y, and then "Reply via an IPv4/IPv6 UDP packet (2)".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.2.2.%20%20Example%202%3A%20Reply%20Mode%20Order%20TLV%20Usage%20with%20Reply%20Path%20TLV"></a><a class="selflink" href="#section-4.2.2" name="section-4.2.2">4.2.2</a>.  Example 2: Reply Mode Order TLV Usage with Reply Path TLV</span>

   If the initiator LSR was interested in encoding the following return
   paths:

   1.  Reverse LSP

   2.  Reply via an IPv4/IPv6 UDP packet

   3.  FEC X

   4.  FEC Y

   Then the MPLS echo request message is to carry:

   o  The Reply Mode Order TLV carrying Reply Modes {5, 2, 5, 5}

   o  One Reply Path TLV with the B bit set

   o  One Reply Path TLV carrying FEC X

   o  One Reply Path TLV carrying FEC Y

   The encoding specified by the Reply Mode Order TLV and the Reply Path
   TLV in the MPLS echo request message will cause the responder LSR to
   prefer the reverse LSP, followed by "Reply via an IPv4/IPv6 UDP
   packet (2)", FEC X, and then FEC Y.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.3.%20%20Proxy%20LSP%20Ping"></a><a class="selflink" href="#section-4.3" name="section-4.3">4.3</a>.  Proxy LSP Ping</span>

   The mechanism defined in this document will work with Proxy LSP Ping
   as defined by [<a href="rfc7555.html" title='"Proxy MPLS Echo Request"'>RFC7555</a>].  The MPLS proxy ping request message can
   carry a Reply Mode value in the header and one or more Reply Mode
   values in the Reply Mode Order TLV.  It is RECOMMENDED that Reply
   Mode 2 (Reply via an IPv4/IPv6 UDP packet) be used in the Reply Mode
   field of the MPLS proxy ping request message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.1.%20%20Proxy%20LSR%20Sending%20an%20MPLS%20Echo%20Request"></a><a class="selflink" href="#section-4.3.1" name="section-4.3.1">4.3.1</a>.  Proxy LSR Sending an MPLS Echo Request</span>

   If the proxy LSR is sending an MPLS echo request, then the proxy LSR
   MUST copy the following elements from the MPLS proxy ping request
   message to the MPLS echo request message:




<span class="grey">Akiya, et al.                Standards Track                   [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   o  The Reply Mode field.

   o  The Reply Mode Order TLV.

   o  The Reply Path TLV(s).  If there is more than one Reply Path TLV,
      then the ordering of the TLVs MUST be preserved when copying.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/4.3.2.%20%20Proxy%20LSR%20Sending%20an%20MPLS%20Proxy%20Ping%20Reply"></a><a class="selflink" href="#section-4.3.2" name="section-4.3.2">4.3.2</a>.  Proxy LSR Sending an MPLS Proxy Ping Reply</span>

   If the proxy LSR is sending an MPLS proxy ping reply, then it is
   RECOMMENDED that the Reply Mode Order TLV be ignored and the Reply
   Mode field in the MPLS proxy ping request message be used.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Security%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Security Considerations</span>

   The security considerations specified in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>] and [<a href="rfc7110.html" title='"Return Path Specified Label Switched Path (LSP) Ping"'>RFC7110</a>] also
   apply for this document.

   In addition, this document introduces the Reply Mode Order TLV.  It
   provides a new way for an unauthorized source to gather more network
   information, especially information regarding the potential return
   path(s) of an LSP.  To protect against unauthorized sources using
   MPLS echo request messages with the Reply Mode Order TLV to obtain
   network information, as also specified in [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>], it is
   RECOMMENDED that implementations provide a means of checking the
   source addresses of MPLS echo request messages against an access list
   before accepting the message.

   Another potential security issue is that the MPLS echo request and
   reply messages are not encrypted; the contents of the MPLS echo
   request and reply messages may therefore be potentially exposed.
   Although the exposure is within the MPLS domain, if such exposure is
   a concern, some encryption mechanisms [<a href="#ref-MPLS-OPP-ENCR">MPLS-OPP-ENCR</a>] may be
   employed.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Manageability%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Manageability Considerations</span>

   <a href="#section-2">Section 2</a> described problems that increase complexity with respect to
   operations and implementations.  In order to simplify operations and
   to allow LSP Ping and Traceroute to function efficiently whilst
   preserving code simplicity, it is RECOMMENDED that implementations
   allow devices to have configuration options to set operator-preferred
   Reply Modes.  For example:

   o  For those operators who are more interested in MPLS echo reply
      packets reaching the initiator LSR:

      1.  Reply via an IPv4/IPv6 UDP packet (2)



<span class="grey">Akiya, et al.                Standards Track                   [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


      2.  Reply via application level control channel (4)

      3.  Reply via Specified Path (5)

   o  For those operators who are more interested in MPLS echo reply
      packets testing the paths related to the forward LSP:

      1.  Reply via Specified Path (5)

      2.  Reply via application level control channel (4)

      3.  Reply via an IPv4/IPv6 UDP packet (2)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  IANA Considerations</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20New%20Reply%20Mode%20Order%20TLV"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  New Reply Mode Order TLV</span>

   IANA has assigned a new TLV type value from the "TLVs" sub-registry
   within the "Multiprotocol Label Switching Architecture (MPLS) Label
   Switched Paths (LSPs) Ping Parameters" registry, for the Reply Mode
   Order TLV.

   The new TLV Type value has been assigned from the range 32768-49161,
   as specified in Sections <a href="#section-3">3</a> and <a href="#section-7.2">7.2</a> of [<a href="rfc4379.html" title='"Detecting Multi-Protocol Label Switched (MPLS) Data Plane Failures"'>RFC4379</a>]; this range is for
   optional TLVs that can be silently dropped if not recognized.

     Type    Meaning                            Reference
     -----   -------                            ---------
     32770   Reply Mode Order TLV               <a href="rfc7737.html">RFC 7737</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC4379" name="ref-RFC4379">RFC4379</a>]  Kompella, K. and G. Swallow, "Detecting Multi-Protocol
              Label Switched (MPLS) Data Plane Failures", <a href="rfc4379.html">RFC 4379</a>,
              DOI 10.17487/RFC4379, February 2006,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4379">http://www.rfc-editor.org/info/rfc4379</a>&gt;.

   [<a id="ref-RFC7110" name="ref-RFC7110">RFC7110</a>]  Chen, M., Cao, W., Ning, S., Jounay, F., and S. Delord,
              "Return Path Specified Label Switched Path (LSP) Ping",
              <a href="rfc7110.html">RFC 7110</a>, DOI 10.17487/RFC7110, January 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7110">http://www.rfc-editor.org/info/rfc7110</a>&gt;.



<span class="grey">Akiya, et al.                Standards Track                   [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-MPLS-OPP-ENCR" name="ref-MPLS-OPP-ENCR">MPLS-OPP-ENCR</a>]
              Farrel, A. and S. Farrell, "Opportunistic Security in MPLS
              Networks", Work in Progress, <a href="https://tools.ietf.org/html/draft-ietf-mpls-opportunistic-encrypt-00">draft-ietf-mpls-</a>
              <a href="https://tools.ietf.org/html/draft-ietf-mpls-opportunistic-encrypt-00">opportunistic-encrypt-00</a>, July 2015.

   [<a id="ref-RFC3473" name="ref-RFC3473">RFC3473</a>]  Berger, L., Ed., "Generalized Multi-Protocol Label
              Switching (GMPLS) Signaling Resource ReserVation Protocol-
              Traffic Engineering (RSVP-TE) Extensions", <a href="rfc3473.html">RFC 3473</a>,
              DOI 10.17487/RFC3473, January 2003,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3473">http://www.rfc-editor.org/info/rfc3473</a>&gt;.

   [<a id="ref-RFC5960" name="ref-RFC5960">RFC5960</a>]  Frost, D., Ed., Bryant, S., Ed., and M. Bocci, Ed., "MPLS
              Transport Profile Data Plane Architecture", <a href="rfc5960.html">RFC 5960</a>,
              DOI 10.17487/RFC5960, August 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5960">http://www.rfc-editor.org/info/rfc5960</a>&gt;.

   [<a id="ref-RFC7555" name="ref-RFC7555">RFC7555</a>]  Swallow, G., Lim, V., and S. Aldrin, "Proxy MPLS Echo
              Request", <a href="rfc7555.html">RFC 7555</a>, DOI 10.17487/RFC7555, June 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7555">http://www.rfc-editor.org/info/rfc7555</a>&gt;.






























<span class="grey">Akiya, et al.                Standards Track                   [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Reply%20Mode%20Order%20TLV%20Beneficial%20Scenarios"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Reply Mode Order TLV Beneficial Scenarios</span>

   This section lists examples of how the Reply Mode Order TLV can be
   beneficial.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Incorrect%20Forwarding%20Scenario"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Incorrect Forwarding Scenario</span>

   As shown in Figure 2, a network has an LSP with the forwarding path
   A-B-C-D-E.  The LSP has a control channel.

                      A------B------C------D------E
                                           |
                                           |
                                           F

                      Forward Path: A-B-C-D-E

                      Figure 2: Incorrect Forwarding

   If D is incorrectly label switching to F (instead of E), then LSP
   Traceroute with "Reply via application level control channel (4)"
   will result in the following:

      Success (Reply from B)
      Success (Reply from C)
      Success (Reply from D)
      Timeout...
      Complete

   This is because F does not have a control channel on which to send
   the MPLS echo reply message.  With the extensions described in this
   document, the same procedures can be performed with the Reply Mode
   Order TLV carrying {4, 2}. When LSP Traceroute is issued, then the
   following output may be displayed without any unnecessary timeout:

      Success (Reply from B, Reply Mode: 4)
      Success (Reply from C, Reply Mode: 4)
      Success (Reply from D, Reply Mode: 4)
      FEC Mismatch (Reply from F, Reply Mode: 2)
      Complete

   The result provides more diagnostic information to the initiator LSR,
   and without any delay (i.e., timeout from one or more downstream
   LSRs).







<span class="grey">Akiya, et al.                Standards Track                   [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Non-Co-Routed%20Bidirectional%20LSP%20Scenario"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Non-Co-Routed Bidirectional LSP Scenario</span>

   As shown in Figure 3, a network has a bidirectional LSP where the
   forward LSP and the reverse LSP are not fully co-routed.

                           +----C------D----+
                          /                  \
                  A------B                    G------H
                          \                  /
                           +----E------F----+

                  Forward Path: A-B-C-D-G-H (upper path)
                  Reverse Path: H-G-F-E-B-A (lower path)

                 Figure 3: Non-Co-Routed Bidirectional LSP

   Some operators may prefer and configure "Reply via Specified Path" as
   the default Reply Mode but without including the Reply Path TLV, to
   indicate that the reverse LSP is used as the return path when MPLS
   echo request messages are sent on bidirectional LSPs.  Without the
   extensions described in this document, the following behaviors will
   be seen:

   o  When LSP Ping is issued from A, the reply will come back on the
      reverse LSP from H.

   o  When LSP Traceroute is issued from A, the replies will come back
      on the reverse LSP from B, G, and H but will encounter a timeout
      from C and D, as there are no reverse LSPs on those nodes.

   o  When LSP Ping with a specific TTL value is issued from A, whether
      a timeout will be encountered depends on the value of the TTL used
      (i.e., whether or not the MPLS echo request terminates on a node
      that has a reverse LSP).

   One can argue that the initiator LSR can automatically generate the
   same MPLS echo request with a different Reply Mode value to those
   nodes that time out.  However, such a mechanism will result in an
   extended time for the entire operation to complete (i.e., multiple
   seconds to multiple minutes).  This is undesirable, and perhaps
   unacceptable if the "user" is an application.










<span class="grey">Akiya, et al.                Standards Track                   [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


   With the extensions described in this document, the same procedures
   can be performed with the Reply Mode Order TLV carrying {5, 2}.  When
   LSP Traceroute is issued, then the following output may be displayed
   without any unnecessary timeout:

      Success (Reply Mode: 5)
      Success (Reply Mode: 2)
      Success (Reply Mode: 2)
      Success (Reply Mode: 5)
      Success (Reply Mode: 5)
      Complete

Acknowledgements

   The authors especially thank Tom Taylor, who passed away close to the
   time of publication of this RFC.  Tom did a careful review of the
   document and provided useful comments.

   The authors would also like to thank Santiago Alvarez and Faisal
   Iqbal for discussions that motivated the creation of this document;
   Sam Aldrin, Curtis Villamizar, Ross Callon, Jeffrey Zhang, Jeremy
   Whittaker, Mustapha Alissaoui, Qin Wu, Jie Dong, and Adrian Farrel
   for providing valuable comments that influenced the content of the
   document; and Dan Frost, Victor Kuarsingh, and Deborah Brungard for
   reviewing the document and providing useful comments.

Contributors

   Shaleen Saxena
   Brocade

   Email: ssaxena@brocade.com



















<span class="grey">Akiya, et al.                Standards Track                   [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc7737.html">RFC 7737</a>           LSP Ping Reply Mode Simplification       January 2016</span>


Authors' Addresses

   Nobo Akiya
   Big Switch Networks

   Email: nobo.akiya.dev@gmail.com


   George Swallow
   Cisco Systems

   Email: swallow@cisco.com


   Carlos Pignataro
   Cisco Systems

   Email: cpignata@cisco.com


   Loa Andersson
   Huawei

   Email: loa@mail01.huawei.com


   Mach(Guoyi) Chen
   Huawei

   Email: mach.chen@huawei.com





















Akiya, et al.                Standards Track                   [Page 17]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.119, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc7737 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 23 Aug 2016 18:34:31 GMT --></html>