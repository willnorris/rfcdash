<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3954 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:44 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:3954" name="DC.Identifier"/>
<meta content="This document specifies the data export format for version 9 of Cisco
Systems' NetFlow services, for use by implementations on the
network elements and/or matching collector programs. The version 9
export format uses templates to provide access to observations of IP
packet flows in a flexible and extensible manner. A template defines a
collection of fields, with corresponding descriptions of structure and
semantics. This memo provides information for the Internet community." name="DC.Description.Abstract"/>
<meta content="B. Claise" name="DC.Creator"/>
<meta content="October, 2004" name="DC.Date.Issued"/>
<meta content="Cisco Systems NetFlow Services Export Version 9" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3954 - Cisco Systems NetFlow Services Export Version 9</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3954.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3954" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-claise-netflow-9" title="draft-claise-netflow-9">draft-claise-ne...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3954" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3954" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3954" title="Side-by-side diff">Diff2</a>] [<a href="https://datatracker.ietf.org/ipr/search/?rfc=3954&amp;submit=rfc" title="IPR disclosures related to this document">IPR</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=3954">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                     B. Claise, Ed.
Request for Comments: 3954                                 Cisco Systems
Category: Informational                                     October 2004


            <span class="h1">Cisco Systems NetFlow Services Export Version 9</span>

Status of this Memo

   This memo provides information for the Internet community.  It does
   not specify an Internet standard of any kind.  Distribution of this
   memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2004).

IESG Note

   This RFC documents the NetFlow services export protocol Version 9 as
   it was when submitted to the IETF as a basis for further work in the
   IPFIX WG.

   This RFC itself is not a candidate for any level of Internet
   Standard.  The IETF disclaims any knowledge of the fitness of this
   RFC for any purpose, and in particular notes that it has not had
   complete IETF review for such things as security, congestion control,
   or inappropriate interaction with deployed protocols.  The RFC Editor
   has chosen to publish this document at its discretion.

Abstract

   This document specifies the data export format for version 9 of Cisco
   Systems' NetFlow services, for use by implementations on the network
   elements and/or matching collector programs.  The version 9 export
   format uses templates to provide access to observations of IP packet
   flows in a flexible and extensible manner.  A template defines a
   collection of fields, with corresponding descriptions of structure
   and semantics.

Table of Contents

   <a href="#section-1">1</a>.   Introduction. . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-2">2</a>
   <a href="#section-2">2</a>.   Terminology . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-4">4</a>
        <a href="#section-2.1">2.1</a>.  Terminology Summary Table . . . . . . . . . . . . . . .  <a href="#page-6">6</a>
   <a href="#section-3">3</a>.   NetFlow High-Level Picture on the Exporter. . . . . . . . . .  <a href="#page-6">6</a>
        <a href="#section-3.1">3.1</a>.  The NetFlow Process on the Exporter . . . . . . . . . .  <a href="#page-6">6</a>
        <a href="#section-3.2">3.2</a>.  Flow Expiration . . . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>



<span class="grey">Claise                       Informational                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


        <a href="#section-3.3">3.3</a>.  Transport Protocol. . . . . . . . . . . . . . . . . . .  <a href="#page-7">7</a>
   <a href="#section-4">4</a>.   Packet Layout . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-8">8</a>
   <a href="#section-5">5</a>.   Export Packet Format. . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
        <a href="#section-5.1">5.1</a>.  Header Format . . . . . . . . . . . . . . . . . . . . .  <a href="#page-9">9</a>
        <a href="#section-5.2">5.2</a>.  Template FlowSet Format . . . . . . . . . . . . . . . . <a href="#page-11">11</a>
        <a href="#section-5.3">5.3</a>.  Data FlowSet Format . . . . . . . . . . . . . . . . . . <a href="#page-13">13</a>
   <a href="#section-6">6</a>.   Options . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-14">14</a>
        <a href="#section-6.1">6.1</a>.  Options Template FlowSet Format . . . . . . . . . . . . <a href="#page-14">14</a>
        <a href="#section-6.2">6.2</a>.  Options Data Record Format. . . . . . . . . . . . . . . <a href="#page-16">16</a>
   <a href="#section-7">7</a>.   Template Management . . . . . . . . . . . . . . . . . . . . . <a href="#page-17">17</a>
   <a href="#section-8">8</a>.   Field Type Definitions. . . . . . . . . . . . . . . . . . . . <a href="#page-18">18</a>
   <a href="#section-9">9</a>.   The Collector Side. . . . . . . . . . . . . . . . . . . . . . <a href="#page-25">25</a>
   <a href="#section-10">10</a>.  Security Considerations . . . . . . . . . . . . . . . . . . . <a href="#page-26">26</a>
        <a href="#section-10.1">10.1</a>. Disclosure of Flow Information Data . . . . . . . . . . <a href="#page-26">26</a>
        <a href="#section-10.2">10.2</a>. Forgery of Flow Records or Template Records . . . . . . <a href="#page-26">26</a>
        <a href="#section-10.3">10.3</a>. Attacks on the NetFlow Collector. . . . . . . . . . . . <a href="#page-27">27</a>
   <a href="#section-11">11</a>.  Examples. . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-27">27</a>
        <a href="#section-11.1">11.1</a>. Packet Header Example . . . . . . . . . . . . . . . . . <a href="#page-28">28</a>
        <a href="#section-11.2">11.2</a>. Template FlowSet Example. . . . . . . . . . . . . . . . <a href="#page-28">28</a>
        <a href="#section-11.3">11.3</a>. Data FlowSet Example. . . . . . . . . . . . . . . . . . <a href="#page-29">29</a>
        <a href="#section-11.4">11.4</a>. Options Template FlowSet Example. . . . . . . . . . . . <a href="#page-30">30</a>
        <a href="#section-11.5">11.5</a>. Data FlowSet with Options Data Records Example. . . . . <a href="#page-30">30</a>
   <a href="#section-12">12</a>.  References. . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
        <a href="#section-12.1">12.1</a>. Normative References. . . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
        <a href="#section-12.2">12.2</a>. Informative References. . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
   <a href="#section-13">13</a>.  Authors . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
   <a href="#section-14">14</a>.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . <a href="#page-31">31</a>
   <a href="#section-15">15</a>.  Authors' Addresses. . . . . . . . . . . . . . . . . . . . . . <a href="#page-32">32</a>
   <a href="#section-16">16</a>.  Full Copyright Statement. . . . . . . . . . . . . . . . . . . <a href="#page-33">33</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Cisco Systems' NetFlow services provide network administrators with
   access to IP flow information from their data networks.  Network
   elements (routers and switches) gather flow data and export it to
   collectors.  The collected data provides fine-grained metering for
   highly flexible and detailed resource usage accounting.

   A flow is defined as a unidirectional sequence of packets with some
   common properties that pass through a network device.  These
   collected flows are exported to an external device, the NetFlow
   collector.  Network flows are highly granular; for example, flow
   records include details such as IP addresses, packet and byte counts,
   timestamps, Type of Service (ToS), application ports, input and
   output interfaces, etc.

   Exported NetFlow data is used for a variety of purposes, including
   enterprise accounting and departmental chargebacks, ISP billing, data



<span class="grey">Claise                       Informational                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   warehousing, network monitoring, capacity planning, application
   monitoring and profiling, user monitoring and profiling, security
   analysis, and data mining for marketing purposes.

   This document specifies NetFlow version 9.  It describes the
   implementation specifications both from network element and NetFlow
   collector points of view.  These specifications should help the
   deployment of NetFlow version 9 across different platforms and
   different vendors by limiting the interoperability risks.  The
   NetFlow export format version 9 uses templates to provide access to
   observations of IP packet flows in a flexible and extensible manner.

   A template defines a collection of fields, with corresponding
   descriptions of structure and semantics.

   The template-based approach provides the following advantages:

      -  New fields can be added to NetFlow flow records without
         changing the structure of the export record format.  With
         previous NetFlow versions, adding a new field in the flow
         record implied a new version of the export protocol format and
         a new version of the NetFlow collector that supported the
         parsing of the new export protocol format.

      -  Templates that are sent to the NetFlow collector contain the
         structural information about the exported flow record fields;
         therefore, if the NetFlow collector does not understand the
         semantics of new fields, it can still interpret the flow
         record.

      -  Because the template mechanism is flexible, it allows the
         export of only the required fields from the flows to the
         NetFlow collector.  This helps to reduce the exported flow data
         volume and provides possible memory savings for the exporter
         and NetFlow collector.  Sending only the required information
         can also reduce network load.

   The IETF IPFIX Working Group (IP Flow Information eXport) is
   developing a new protocol, based on the version 9 of Cisco Systems'
   NetFlow services.  Some enhancements in different domains (congestion
   aware transport protocol, built-in security, etc... ) have been
   incorporated in this new IPFIX protocol.  Refer to the IPFIX Working
   Group documents for more details.

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>
   [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].



<span class="grey">Claise                       Informational                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   Various terms used in this document are described in this section.
   Note that the terminology summary table in <a href="#section-2.1">Section 2.1</a> gives a quick
   overview of the relationships between some of the different terms
   defined.

   Observation Point
   An Observation Point is a location in the network where IP packets
   can be observed; for example, one or a set of interfaces on a network
   device like a router.  Every Observation Point is associated with an
   Observation Domain.

   Observation Domain
   The set of Observation Points that is the largest aggregatable set of
   flow information at the network device with NetFlow services enabled
   is termed an Observation Domain.  For example, a router line card
   composed of several interfaces with each interface being an
   Observation Point.

   IP Flow or Flow
   An IP Flow, also called a Flow, is defined as a set of IP packets
   passing an Observation Point in the network during a certain time
   interval.  All packets that belong to a particular Flow have a set of
   common properties derived from the data contained in the packet and
   from the packet treatment at the Observation Point.

   Flow Record
   A Flow Record provides information about an IP Flow observed at an
   Observation Point.  In this document, the Flow Data Records are also
   referred to as NetFlow services data and NetFlow data.

   Exporter
   A device (for example, a router) with the NetFlow services enabled,
   the Exporter monitors packets entering an Observation Point and
   creates Flows from these packets.  The information from these Flows
   is exported in the form of Flow Records to the NetFlow Collector.

   NetFlow Collector
   The NetFlow Collector receives Flow Records from one or more
   Exporters.  It processes the received Export Packet(s); that is, it
   parses and stores the Flow Record information.  Flow Records can be
   optionally aggregated before being stored on the hard disk.  The
   NetFlow Collector is also referred to as the Collector in this
   document.






<span class="grey">Claise                       Informational                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Export Packet
   An Export Packet is a packet originating at the Exporter that carries
   the Flow Records of this Exporter and whose destination is the
   NetFlow Collector.

   Packet Header
   The Packet Header is the first part of an Export Packet.  The Packet
   Header provides basic information about the packet such as the
   NetFlow version, number of records contained within the packet, and
   sequence numbering.

   Template Record
   A Template Record defines the structure and interpretation of fields
   in a Flow Data Record.

   Flow Data Record
   A Flow Data Record is a data record that contains values of the Flow
   parameters corresponding to a Template Record.

   Options Template Record
   An Options Template Record defines the structure and interpretation
   of fields in an Options Data Record, including defining the scope
   within which the Options Data Record is relevant.

   Options Data Record
   The data record that contains values and scope information of the
   Flow measurement parameters, corresponding to an Options Template
   Record.

   FlowSet
   FlowSet is a generic term for a collection of Flow Records that have
   a similar structure.  In an Export Packet, one or more FlowSets
   follow the Packet Header.  There are three different types of
   FlowSets: Template FlowSet, Options Template FlowSet, and Data
   FlowSet.

   Template FlowSet
   A Template FlowSet is one or more Template Records that have been
   grouped together in an Export Packet.

   Options Template FlowSet
   An Options Template FlowSet is one or more Options Template Records
   that have been grouped together in an Export Packet.








<span class="grey">Claise                       Informational                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Data FlowSet
   A Data FlowSet is one or more records, of the same type, that are
   grouped together in an Export Packet.  Each record is either a Flow
   Data Record or an Options Data Record previously defined by a
   Template Record or an Options Template Record.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Terminology%20Summary%20Table"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Terminology Summary Table</span>

   +------------------+---------------------------------------------+
   |                  |                    Contents                 |
   |                  +--------------------+------------------------+
   |     FlowSet      | Template  Record   |    Data Record         |
   +------------------+--------------------+------------------------+
   |                  |                    |  Flow Data Record(s)   |
   | Data FlowSet     |          /         |          or            |
   |                  |                    | Options Data Record(s) |
   +------------------+--------------------+------------------------+
   | Template FlowSet | Template Record(s) |           /            |
   +------------------+--------------------+------------------------+
   | Options Template | Options Template   |           /            |
   | FlowSet          | Record(s)          |                        |
   +------------------+--------------------+------------------------+

   A Data FlowSet is composed of an Options Data Record(s) or Flow Data
   Record(s).  No Template Record is included. A Template Record defines
   the Flow Data Record, and an Options Template Record defines the
   Options Data Record.

   A Template FlowSet is composed of Template Record(s).  No Flow or
   Options Data Record is included.

   An Options Template FlowSet is composed of Options Template
   Record(s).  No Flow or Options Data Record is included.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20NetFlow%20High-Level%20Picture%20on%20the%20Exporter"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  NetFlow High-Level Picture on the Exporter</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20The%20NetFlow%20Process%20on%20the%20Exporter"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  The NetFlow Process on the Exporter</span>

   The NetFlow process on the Exporter is responsible for the creation
   of Flows from the observed IP packets.  The details of this process
   are beyond the scope of this document.










<span class="grey">Claise                       Informational                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Flow%20Expiration"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Flow Expiration</span>

   A Flow is considered to be inactive if no packets belonging to the
   Flow have been observed at the Observation Point for a given timeout.
   If any packet is seen within the timeout, the flow is considered an
   active flow. A Flow can be exported under the following conditions:

      1. If the Exporter can detect the end of a Flow.  For example, if
         the FIN or RST bit is detected in a TCP [<a href="rfc793.html" title='"Transmission Control Protocol"'>RFC793</a>] connection,
         the Flow Record is exported.

      2. If the Flow has been inactive for a certain period of time.
         This inactivity timeout SHOULD be configurable at the Exporter,
         with a minimum value of 0 for an immediate expiration.

      3. For long-lasting Flows, the Exporter SHOULD export the Flow
         Records on a regular basis.  This timeout SHOULD be
         configurable at the Exporter.

      4. If the Exporter experiences internal constraints, a Flow MAY be
         forced to expire prematurely; for example, counters wrapping or
         low memory.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Transport%20Protocol"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Transport Protocol</span>

   To achieve efficiency in terms of processing at the Exporter while
   handling high volumes of Export Packets, the NetFlow Export Packets
   are encapsulated into UDP [<a href="rfc768.html" title='"User Datagram Protocol"'>RFC768</a>] datagrams for export to the
   NetFlow Collector.  However, NetFlow version 9 has been designed to
   be transport protocol independent.  Hence, it can also operate over
   congestion-aware protocols such as SCTP [<a href="rfc2960.html" title='"Stream Control Transmission Protocol"'>RFC2960</a>].

   Note that the Exporter can export to multiple Collectors, using
   independent transport protocols.

   UDP [<a href="rfc768.html" title='"User Datagram Protocol"'>RFC768</a>] is a non congestion-aware protocol, so when deploying
   NetFlow version 9 in a congestion-sensitive environment, make the
   connection between Exporter and NetFlow Collector through a dedicated
   link.  This ensures that any burstiness in the NetFlow traffic
   affects only this dedicated link.  When the NetFlow Collector can not
   be placed within a one-hop distance from the Exporter or when the
   export path from the Exporter to the NetFlow Collector can not be
   exclusively used for the NetFlow Export Packets, the export path
   should be designed so that it can always sustain the maximum
   burstiness of NetFlow traffic from the Exporter.  Note that the
   congestion can occur on the Exporter in case the export path speed is
   too low.




<span class="grey">Claise                       Informational                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Packet%20Layout"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Packet Layout</span>

   An Export Packet consists of a Packet Header followed by one or more
   FlowSets.  The FlowSets can be any of the possible three types:
   Template, Data, or Options Template.

     +--------+-------------------------------------------+
     |        | +----------+ +---------+ +----------+     |
     | Packet | | Template | | Data    | | Options  |     |
     | Header | | FlowSet  | | FlowSet | | Template | ... |
     |        | |          | |         | | FlowSet  |     |
     |        | +----------+ +---------+ +----------+     |
     +--------+-------------------------------------------+
                         Export Packet

   A FlowSet ID is used to distinguish the different types of FlowSets.
   FlowSet IDs lower than 256 are reserved for special FlowSets, such as
   the Template FlowSet (ID 0) and the Options Template FlowSet (ID 1).
   The Data FlowSets have a FlowSet ID greater than 255.

   The format of the Template, Data, and Options Template FlowSets will
   be discussed later in this document.  The Exporter MUST code all
   binary integers of the Packet Header and the different FlowSets in
   network byte order (also known as the big-endian byte ordering).

   Following are some examples of export packets:

   1. An Export Packet consisting of interleaved Template, Data, and
      Options Template FlowSets.  Example: a newly created Template is
      exported as soon as possible.  So if there is already an Export
      Packet with a Data FlowSet that is being prepared for export, the
      Template and Option FlowSets are also interleaved with this
      information, subject to availability of space.

   Export Packet:
   +--------+--------------------------------------------------------+
   |        | +----------+ +---------+     +-----------+ +---------+ |
   | Packet | | Template | | Data    |     | Options   | | Data    | |
   | Header | | FlowSet  | | FlowSet | ... | Template  | | FlowSet | |
   |        | |          | |         |     | FlowSet   | |         | |
   |        | +----------+ +---------+     +-----------+ +---------+ |
   +--------+--------------------------------------------------------+

   2. An Export Packet consisting entirely of Data FlowSets.  Example:
      after the appropriate Template Records have been defined and
      transmitted to the NetFlow Collector device, the majority of
      Export Packets consists solely of Data FlowSets.




<span class="grey">Claise                       Informational                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Export Packet:
   +--------+----------------------------------------------+
   |        | +---------+     +---------+      +---------+ |
   | Packet | | Data    | ... | Data    | ...  | Data    | |
   | Header | | FlowSet | ... | FlowSet | ...  | FlowSet | |
   |        | +---------+     +---------+      +---------+ |
   +--------+----------------------------------------------+

   3. An Export Packet consisting entirely of Template and Options
      Template FlowSets.  Example: the Exporter MAY transmit a packet
      containing Template and Options Template FlowSets periodically to
      help ensure that the NetFlow Collector has the correct Template
      Records and Options Template Records when the corresponding Flow
      Data records are received.

   Export Packet:
   +--------+-------------------------------------------------+
   |        | +----------+     +----------+      +----------+ |
   | Packet | | Template |     | Template |      | Options  | |
   | Header | | FlowSet  | ... | FlowSet  | ...  | Template | |
   |        | |          |     |          |      | FlowSet  | |
   |        | +----------+     +----------+      +----------+ |
   +--------+-------------------------------------------------+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Export%20Packet%20Format"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Export Packet Format</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Header%20Format"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Header Format</span>

   The Packet Header format is specified as:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Version Number          |            Count              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           sysUpTime                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           UNIX Secs                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Sequence Number                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Source ID                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+








<span class="grey">Claise                       Informational                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Packet Header Field Descriptions

   Version
         Version of Flow Record format exported in this packet.  The
         value of this field is 9 for the current version.

   Count
         The total number of records in the Export Packet, which is the
         sum of Options FlowSet records, Template FlowSet records, and
         Data FlowSet records.

   sysUpTime
         Time in milliseconds since this device was first booted.

   UNIX Secs
         Time in seconds since 0000 UTC 1970, at which the Export Packet
         leaves the Exporter.

   Sequence Number
         Incremental sequence counter of all Export Packets sent from
         the current Observation Domain by the Exporter.  This value
         MUST be cumulative, and SHOULD be used by the Collector to
         identify whether any Export Packets have been missed.

   Source ID
         A 32-bit value that identifies the Exporter Observation Domain.
         NetFlow Collectors SHOULD use the combination of the source IP
         address and the Source ID field to separate different export
         streams originating from the same Exporter.






















<span class="grey">Claise                       Informational                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Template%20FlowSet%20Format"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Template FlowSet Format</span>

   One of the essential elements in the NetFlow format is the Template
   FlowSet.  Templates greatly enhance the flexibility of the Flow
   Record format because they allow the NetFlow Collector to process
   Flow Records without necessarily knowing the interpretation of all
   the data in the Flow Record.  The format of the Template FlowSet is
   as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       FlowSet ID = 0          |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Template ID 256          |         Field Count           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type 1           |         Field Length 1        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type 2           |         Field Length 2        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type N           |         Field Length N        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Template ID 257          |         Field Count           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type 1           |         Field Length 1        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type 2           |         Field Length 2        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Field Type M           |         Field Length M        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Template ID K          |         Field Count           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             ...               |              ...              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Template FlowSet Field Descriptions

   FlowSet ID
         FlowSet ID value of 0 is reserved for the Template FlowSet.






<span class="grey">Claise                       Informational                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Length
         Total length of this FlowSet.  Because an individual Template
         FlowSet MAY contain multiple Template Records, the Length value
         MUST be used to determine the position of the next FlowSet
         record, which could be any type of FlowSet.  Length is the sum
         of the lengths of the FlowSet ID, the Length itself, and all
         Template Records within this FlowSet.

   Template ID
         Each of the newly generated Template Records is given a unique
         Template ID.  This uniqueness is local to the Observation
         Domain that generated the Template ID.  Template IDs 0-255 are
         reserved for Template FlowSets, Options FlowSets, and other
         reserved FlowSets yet to be created.  Template IDs of Data
         FlowSets are numbered from 256 to 65535.

   Field Count
         Number of fields in this Template Record.   Because a Template
         FlowSet usually contains multiple Template Records, this field
         allows the Collector to determine the end of the current
         Template Record and the start of the next.

   Field Type
         A numeric value that represents the type of the field.  Refer
         to the "Field Type Definitions" section.

   Field Length
         The length of the corresponding Field Type, in bytes.  Refer to
         the "Field Type Definitions" section.






















<span class="grey">Claise                       Informational                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Data%20FlowSet%20Format"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Data FlowSet Format</span>

   The format of the Data FlowSet is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   FlowSet ID = Template ID    |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 1 - Field Value 1    |   Record 1 - Field Value 2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 1 - Field Value 3    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 2 - Field Value 1    |   Record 2 - Field Value 2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 2 - Field Value 3    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 3 - Field Value 1    |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              ...              |            Padding            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Data FlowSet Field Descriptions

   FlowSet ID = Template ID
         Each Data FlowSet is associated with a FlowSet ID.  The FlowSet
         ID maps to a (previously generated) Template ID.  The Collector
         MUST use the FlowSet ID to find the corresponding Template
         Record and decode the Flow Records from the FlowSet.

   Length
         The length of this FlowSet.  Length is the sum of the lengths
         of the FlowSet ID, Length itself, all Flow Records within this
         FlowSet, and the padding bytes, if any.

   Record N - Field Value M
         The remainder of the Data FlowSet is a collection of Flow Data
         Record(s), each containing a set of field values.  The Type and
         Length of the fields have been previously defined in the
         Template Record referenced by the FlowSet ID or Template ID.

   Padding
         The Exporter SHOULD insert some padding bytes so that the
         subsequent FlowSet starts at a 4-byte aligned boundary.  It is
         important to note that the Length field includes the padding
         bytes.  Padding SHOULD be using zeros.





<span class="grey">Claise                       Informational                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Interpretation of the Data FlowSet format can be done only if the
   Template FlowSet corresponding to the Template ID is available at the
   Collector.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Options"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Options</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Options%20Template%20FlowSet%20Format"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Options Template FlowSet Format</span>

   The Options Template Record (and its corresponding Options Data
   Record) is used to supply information about the NetFlow process
   configuration or NetFlow process specific data, rather than supplying
   information about IP Flows.

   For example, the Options Template FlowSet can report the sample rate
   of a specific interface, if sampling is supported, along with the
   sampling method used.

   The format of the Options Template FlowSet follows.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       FlowSet ID = 1          |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Template ID           |      Option Scope Length      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Option Length          |       Scope 1 Field Type      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope 1 Field Length      |               ...             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Scope N Field Length      |      Option 1 Field Type      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Option 1 Field Length     |             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Option M Field Length     |           Padding             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Options Template FlowSet Field Definitions

   FlowSet ID = 1
         A FlowSet ID value of 1 is reserved for the Options Template.

   Length
         Total length of this FlowSet.  Each Options Template FlowSet
         MAY contain multiple Options Template Records.  Thus, the
         Length value MUST be used to determine the position of the next
         FlowSet record, which could be either a Template FlowSet or
         Data FlowSet.



<span class="grey">Claise                       Informational                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


         Length is the sum of the lengths of the FlowSet ID, the Length
         itself, and all Options Template Records within this FlowSet
         Template ID.

   Template ID
         Template ID of this Options Template.  This value is greater
         than 255.

   Option Scope Length
         The length in bytes of any Scope field definition contained in
         the Options Template Record (The use of "Scope" is described
         below).

   Option Length
         The length (in bytes) of any options field definitions
         contained in this Options Template Record.

   Scope 1 Field Type
         The relevant portion of the Exporter/NetFlow process to which
         the Options Template Record refers.
         Currently defined values are:
            1 System
            2 Interface
            3 Line Card
            4 Cache
            5 Template
         For example, the NetFlow process can be implemented on a per-
         interface basis, so if the Options Template Record were
         reporting on how the NetFlow process is configured, the Scope
         for the report would be 2 (interface).  The associated
         interface ID would then be carried in the associated Options
         Data FlowSet.  The Scope can be limited further by listing
         multiple scopes that all must match at the same time.  Note
         that the Scope fields always precede the Option fields.

   Scope 1 Field Length
         The length (in bytes) of the Scope field, as it would appear in
         an Options Data Record.

   Option 1 Field Type
         A numeric value that represents the type of field that would
         appear in the Options Template Record.  Refer to the Field Type
         Definitions section.

   Option 1 Field Length
         The length (in bytes) of the Option field.





<span class="grey">Claise                       Informational                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Padding
         The Exporter SHOULD insert some padding bytes so that the
         subsequent FlowSet starts at a 4-byte aligned boundary.  It is
         important to note that the Length field includes the padding
         bytes.  Padding SHOULD be using zeros.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Options%20Data%20Record%20Format"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Options Data Record Format</span>

   The Options Data Records are sent in Data FlowSets, on a regular
   basis, but not with every Flow Data Record.  How frequently these
   Options Data Records are exported is configurable.  See the
   "Templates Management" section for more details.

   The format of the Data FlowSet containing Options Data Records
   follows.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    FlowSet ID = Template ID   |          Length               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 1 - Scope 1 Value    |Record 1 - Option Field 1 Value|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Record 1 - Option Field 2 Value|             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 2 - Scope 1 Value    |Record 2 - Option Field 1 Value|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Record 2 - Option Field 2 Value|             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Record 3 - Scope 1 Value    |Record 3 - Option Field 1 Value|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Record 3 - Option Field 2 Value|             ...               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              ...              |            Padding            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Options Data Records of the Data FlowSet Field Descriptions

   FlowSet ID = Template ID
         A FlowSet ID precedes each group of Options Data Records within
         a Data FlowSet.  The FlowSet ID maps to a previously generated
         Template ID corresponding to this Options Template Record.  The
         Collector MUST use the FlowSet ID to map the appropriate type
         and length to any field values that follow.







<span class="grey">Claise                       Informational                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Length
         The length of this FlowSet. Length is the sum of the lengths of
         the FlowSet ID, Length itself, all the Options Data Records
         within this FlowSet, and the padding bytes, if any.

   Record N - Option Field M Value
         The remainder of the Data FlowSet is a collection of Flow
         Records, each containing a set of scope and field values.  The
         type and length of the fields were previously defined in the
         Options Template Record referenced by the FlowSet ID or
         Template ID.

   Padding
         The Exporter SHOULD insert some padding bytes so that the
         subsequent FlowSet starts at a 4-byte aligned boundary.  It is
         important to note that the Length field includes the padding
         bytes.  Padding SHOULD be using zeros.

   The Data FlowSet format can be interpreted only if the Options
   Template FlowSet corresponding to the Template ID is available at the
   Collector.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Template%20Management"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Template Management</span>

   Flow Data records that correspond to a Template Record MAY appear in
   the same and/or subsequent Export Packets.  The Template Record is
   not necessarily carried in every Export Packet.  As such, the NetFlow
   Collector MUST store the Template Record to interpret the
   corresponding Flow Data Records that are received in subsequent data
   packets.

   A NetFlow Collector that receives Export Packets from several
   Observation Domains from the same Exporter MUST be aware that the
   uniqueness of the Template ID is not guaranteed across Observation
   Domains.

   The Template IDs must remain constant for the life of the NetFlow
   process on the Exporter.  If the Exporter or the NetFlow process
   restarts for any reason, all information about Templates will be lost
   and new Template IDs will be created.  Template IDs are thus not
   guaranteed to be consistent across an Exporter or NetFlow process
   restart.

   A newly created Template record is assigned an unused Template ID
   from the Exporter.  If the template configuration is changed, the
   current Template ID is abandoned and SHOULD NOT be reused until the





<span class="grey">Claise                       Informational                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   NetFlow process or Exporter restarts.  If a Collector should receive
   a new definition for an already existing Template ID, it MUST discard
   the previous template definition and use the new one.

   If a configured Template Record on the Exporter is deleted, and re-
   configured with exactly the same parameters, the same Template ID
   COULD be reused.

   The Exporter sends the Template FlowSet and Options Template FlowSet
   under the following conditions:

   1. After a NetFlow process restarts, the Exporter MUST NOT send any
      Data FlowSet without sending the corresponding Template FlowSet
      and the required Options Template FlowSet in a previous packet or
      including it in the same Export Packet.  It MAY transmit the
      Template FlowSet and Options Template FlowSet, without any Data
      FlowSets, in advance to help ensure that the Collector will have
      the correct Template Record before receiving the first Flow or
      Options Data Record.

   2. In the event of configuration changes, the Exporter SHOULD send
      the new template definitions at an accelerated rate.  In such a
      case, it MAY transmit the changed Template Record(s) and Options
      Template Record(s), without any data, in advance to help ensure
      that the Collector will have the correct template information
      before receiving the first data.

   3. On a regular basis, the Exporter MUST send all the Template
      Records and Options Template Records to refresh the Collector.
      Template IDs have a limited lifetime at the Collector and MUST be
      periodically refreshed.  Two approaches are taken to make sure
      that Templates get refreshed at the Collector:
            * Every N number of Export Packets.
            * On a time basis, so every N number of minutes.
      Both options MUST be configurable by the user on the Exporter.
      When one of these expiry conditions is met, the Exporter MUST send
      the Template FlowSet and Options Template.

   4. In the event of a clock configuration change on the Exporter, the
      Exporter SHOULD send the template definitions at an accelerated
      rate.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Field%20Type%20Definitions"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Field Type Definitions</span>

   The following table describes all the field type definitions that an
   Exporter MAY support.  The fields are a selection of Packet Header
   fields, lookup results (for example, the autonomous system numbers or
   the subnet masks), and properties of the packet such as length.



<span class="grey">Claise                       Informational                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Field Type                Value Length  Description
                                   (bytes)

                                           Incoming counter with
                                           length N x 8 bits for the
   IN_BYTES                     1    N     number of bytes associated
                                           with an IP Flow. By default
                                           N is 4

                                           Incoming counter with
                                           length N x 8 bits for the
   IN_PKTS                      2    N     number of packets
                                           associated with an IP Flow.
                                           By default N is 4

   FLOWS                        3    N     Number of Flows
                                           that were aggregated;
                                           by default N is 4

   PROTOCOL                     4    1     IP protocol byte

                                           Type of service byte
   TOS                          5    1     setting when entering
                                           the incoming interface

                                           TCP flags; cumulative of
   TCP_FLAGS                    6    1     all the TCP flags seen in
                                           this Flow

                                           TCP/UDP source port number
   L4_SRC_PORT                  7    2     (for example, FTP, Telnet,
                                           or equivalent)

   IPV4_SRC_ADDR                8    4     IPv4 source address

                                           The number of contiguous
                                           bits in the source subnet
   SRC_MASK                     9    1     mask (i.e., the mask in
                                           slash notation)

                                           Input interface index.
   INPUT_SNMP                   10   N     By default N is 2, but
                                           higher values can be used

                                           TCP/UDP destination port
   L4_DST_PORT                  11   2     number (for example, FTP,
                                           Telnet, or equivalent)




<span class="grey">Claise                       Informational                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   IPV4_DST_ADDR                12   4     IPv4 destination address

                                           The number of contiguous
                                           bits in the destination
   DST_MASK                     13   1     subnet mask (i.e., the mask
                                           in slash notation)

                                           Output interface index.

   OUTPUT_SNMP                  14   N     By default N is 2, but
                                           higher values can be used

   IPV4_NEXT_HOP                15   4     IPv4 address of the next-
                                           hop router

                                           Source BGP autonomous
   SRC_AS                       16   N     system number where N could
                                           be 2 or 4. By default N is
                                           2

                                           Destination BGP autonomous
   DST_AS                       17   N     system number where N could
                                           be 2 or 4. By default N is
                                           2

   BGP_IPV4_NEXT_HOP            18   4     Next-hop router's IP
                                           address in the BGP domain

                                           IP multicast outgoing
                                           packet counter with length
   MUL_DST_PKTS                 19   N     N x 8 bits for packets
                                           associated with the IP
                                           Flow. By default N is 4

                                           IP multicast outgoing
                                           Octet (byte) counter with
                                           length N x 8 bits for the
   MUL_DST_BYTES                20   N     number of bytes associated
                                           with the IP Flow. By
                                           default N is 4

                                           sysUptime in msec at which
   LAST_SWITCHED                21   4     the last packet of this
                                           Flow was switched

                                           sysUptime in msec at which
   FIRST_SWITCHED               22   4     the first packet of this
                                           Flow was switched



<span class="grey">Claise                       Informational                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


                                           Outgoing counter with
                                           length N x 8 bits for the
   OUT_BYTES                    23   N     number of bytes associated
                                           with an IP Flow. By
                                           default N is 4

                                           Outgoing counter with
                                           length N x 8 bits for the
   OUT_PKTS                     24   N     number of packets
                                           associated with an IP Flow.
                                           By default N is 4

   IPV6_SRC_ADDR                27   16    IPv6 source address

   IPV6_DST_ADDR                28   16    IPv6 destination address

   IPV6_SRC_MASK                29   1     Length of the IPv6 source
                                           mask in contiguous bits

                                           Length of the IPv6
   IPV6_DST_MASK                30   1     destination mask in
                                           contiguous bits

   IPV6_FLOW_LABEL              31   3     IPv6 flow label as per
                                           <a href="rfc2460.html">RFC 2460</a> definition

                                           Internet Control Message
   ICMP_TYPE                    32   2     Protocol (ICMP) packet
                                           type; reported as
                                           ICMP Type * 256 + ICMP code

   MUL_IGMP_TYPE                33   1     Internet Group Management
                                           Protocol (IGMP) packet type

                                           When using sampled NetFlow,
                                           the rate at which packets
   SAMPLING_INTERVAL            34   4     are sampled; for example, a
                                           value of 100 indicates that
                                           one of every hundred
                                           packets is sampled

                                           For sampled NetFlow
                                           platform-wide:
   SAMPLING_ALGORITHM           35   1     0x01 deterministic sampling
                                           0x02 random sampling
                                           Use in connection with
                                           SAMPLING_INTERVAL




<span class="grey">Claise                       Informational                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


                                           Timeout value (in seconds)

   FLOW_ACTIVE_TIMEOUT          36   2     for active flow entries
                                           in the NetFlow cache

                                           Timeout value (in seconds)
   FLOW_INACTIVE_TIMEOUT        37   2     for inactive Flow entries
                                           in the NetFlow cache

                                           Type of Flow switching
   ENGINE_TYPE                  38   1     engine (route processor,
                                           linecard, etc...)

   ENGINE_ID                    39   1     ID number of the Flow
                                           switching engine

                                           Counter with length
                                           N x 8 bits for the number
   TOTAL_BYTES_EXP              40   N     of bytes exported by the
                                           Observation Domain. By
                                           default N is 4

                                           Counter with length
                                           N x 8 bits for the number
   TOTAL_PKTS_EXP               41   N     of packets exported by the
                                           Observation Domain. By
                                           default N is 4

                                           Counter with length
                                           N x 8 bits for the number
   TOTAL_FLOWS_EXP              42   N     of Flows exported by the
                                           Observation Domain. By
                                           default N is 4

   MPLS_TOP_LABEL_TYPE          46   1     MPLS Top Label Type:
                                           0x00 UNKNOWN
                                           0x01 TE-MIDPT
                                           0x02 ATOM
                                           0x03 VPN
                                           0x04 BGP
                                           0x05 LDP

                                           Forwarding Equivalent Class
   MPLS_TOP_LABEL_IP_ADDR       47   4     corresponding to the MPLS
                                           Top Label

   FLOW_SAMPLER_ID              48   1     Identifier shown
                                           in "show flow-sampler"



<span class="grey">Claise                       Informational                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


                                           The type of algorithm used
                                           for sampling data:
   FLOW_SAMPLER_MODE            49   1     0x02 random sampling
                                           Use in connection with
                                           FLOW_SAMPLER_MODE
                                           Packet interval at which to
   FLOW_SAMPLER_RANDOM_INTERVAL 50   4     sample. Use in connection
                                           with FLOW_SAMPLER_MODE

                                           Type of Service byte
   DST_TOS                      55   1     setting when exiting
                                           outgoing interface

   SRC_MAC                      56   6     Source MAC Address

   DST_MAC                      57   6     Destination MAC Address

                                           Virtual LAN identifier

   SRC_VLAN                     58   2     associated with ingress
                                           interface

                                           Virtual LAN identifier
   DST_VLAN                     59   2     associated with egress
                                           interface

                                           Internet Protocol Version
                                           Set to 4 for IPv4, set to 6
   IP_PROTOCOL_VERSION          60   1     for IPv6. If not present in
                                           the template, then version
                                           4 is assumed

                                           Flow direction:
   DIRECTION                    61   1     0 - ingress flow
                                           1 - egress flow

   IPV6_NEXT_HOP                62   16    IPv6 address of the
                                           next-hop router

   BGP_IPV6_NEXT_HOP            63   16    Next-hop router in the BGP
                                           domain

                                           Bit-encoded field
   IPV6_OPTION_HEADERS          64   4     identifying IPv6 option
                                           headers found in the flow

   MPLS_LABEL_1                 70   3     MPLS label at position 1 in
                                           the stack



<span class="grey">Claise                       Informational                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   MPLS_LABEL_2                 71   3     MPLS label at position 2 in
                                           the stack

   MPLS_LABEL_3                 72   3     MPLS label at position 3 in
                                           the stack

   MPLS_LABEL_4                 73   3     MPLS label at position 4 in
                                           the stack

   MPLS_LABEL_5                 74   3     MPLS label at position 5 in
                                           the stack

   MPLS_LABEL_6                 75   3     MPLS label at position 6 in
                                           the stack

   MPLS_LABEL_7                 76   3     MPLS label at position 7 in
                                           the stack

   MPLS_LABEL_8                 77   3     MPLS label at position 8 in
                                           the stack

   MPLS_LABEL_9                 78   3     MPLS label at position 9 in
                                           the stack

   MPLS_LABEL_10                79   3     MPLS label at position 10
                                           in the stack

   The value field is a numeric identifier for the field type. The
   following value fields are reserved for proprietary field types: 25,
   26, 43 to 45, 51 to 54, and 65 to 69.

   When extensibility is required, the new field types will be added to
   the list.  The new field types have to be updated on the Exporter and
   Collector but the NetFlow export format would remain unchanged.
   Refer to the latest documentation at <a href="http://www.cisco.com/">http://www.cisco.com</a> for the
   newly updated list.

   In some cases the size of a field type is fixed by definition, for
   example PROTOCOL, or IPV4_SRC_ADDR.  However in other cases they are
   defined as a variant type.  This improves the memory efficiency in
   the collector and reduces the network bandwidth requirement between
   the Exporter and the Collector.  As an example, in the case IN_BYTES,
   on an access router it might be sufficient to use a 32 bit counter (N
   = 4), whilst on a core router a 64 bit counter (N = 8) would be
   required.

   All counters and counter-like objects are unsigned integers of size N
   * 8 bits.



<span class="grey">Claise                       Informational                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20The%20Collector%20Side"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  The Collector Side</span>

   The Collector receives Template Records from the Exporter, normally
   before receiving Flow Data Records (or Options Data Records).  The
   Flow Data Records (or Options Data Records) can then be decoded and
   stored locally on the devices.  If the Template Records have not been
   received at the time Flow Data Records (or Options Data Records) are
   received, the Collector SHOULD store the Flow Data Records (or
   Options Data Records) and decode them after the Template Records are
   received.  A Collector device MUST NOT assume that the Data FlowSet
   and the associated Template FlowSet (or Options Template FlowSet) are
   exported in the same Export Packet.

   The Collector MUST NOT assume that one and only one Template FlowSet
   is present in an Export Packet.

   The life of a template at the Collector is limited to a fixed refresh
   timeout.  Templates not refreshed from the Exporter within the
   timeout are expired at the Collector.  The Collector MUST NOT attempt
   to decode the Flow or Options Data Records with an expired Template.
   At any given time the Collector SHOULD maintain the following for all
   the current Template Records and Options Template Records: Exporter,
   Observation Domain, Template ID, Template Definition, Last Received.

   Note that the Observation Domain is identified by the Source ID field
   from the Export Packet.

   In the event of a clock configuration change on the Exporter, the
   Collector SHOULD discard all Template Records and Options Template
   Records associated with that Exporter, in order for Collector to
   learn the new set of fields: Exporter, Observation Domain, Template
   ID, Template Definition, Last Received.

   Template IDs are unique per Exporter and per Observation Domain.

   If the Collector receives a new Template Record (for example, in the
   case of an Exporter restart) it MUST immediately override the
   existing Template Record.

   Finally, note that the Collector MUST accept padding in the Data
   FlowSet and Options Template FlowSet, which means for the Flow Data
   Records, the Options Data Records and the Template Records. Refer to
   the terminology summary table in <a href="#section-2.1">Section 2.1</a>.








<span class="grey">Claise                       Informational                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20Security%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  Security Considerations</span>

   The NetFlow version 9 protocol was designed with the expectation that
   the Exporter and Collector would remain within a single private
   network.  However the NetFlow version 9 protocol might be used to
   transport Flow Records over the public Internet which exposes the
   Flow Records to a number of security risks.  For example an attacker
   might capture, modify or insert Export Packets.  There is therefore a
   risk that IP Flow information might be captured or forged, or that
   attacks might be directed at the NetFlow Collector.

   The designers of NetFlow Version 9 did not impose any
   confidentiality, integrity or authentication requirements on the
   protocol because this reduced the efficiency of the implementation
   and it was believed at the time that the majority of deployments
   would confine the Flow Records to private networks, with the
   Collector(s) and Exporter(s) in close proximity.

   The IPFIX protocol (IP Flow Information eXport), which has chosen the
   NetFlow version 9 protocol as the base protocol, addresses the
   security considerations discussed in this section.  See the security
   section of IPFIX requirement draft [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>] for more information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Disclosure%20of%20Flow%20Information%20Data"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Disclosure of Flow Information Data</span>

   Because the NetFlow Version 9 Export Packets are not encrypted, the
   observation of Flow Records can give an attacker information about
   the active flows in the network, communication endpoints and traffic
   patterns.  This information can be used both to spy on user behavior
   and to plan and conceal future attacks.

   The information that an attacker could derive from the interception
   of Flow Records depends on the Flow definition.  For example, a Flow
   Record containing the source and destination IP addresses might
   reveal privacy sensitive information regarding the end user's
   activities, whilst a Flow Record only containing the source and
   destination IP network would be less revealing.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Forgery%20of%20Flow%20Records%20or%20Template%20Records"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Forgery of Flow Records or Template Records</span>

   If Flow Records are used in accounting and/or security applications,
   there may be a strong incentive to forge exported Flow Records (for
   example to defraud the service provider, or to prevent the detection
   of an attack).  This can be done either by altering the Flow Records
   on the path between the Observer and the Collector, or by injecting
   forged Flow Records that pretend to be originated by the Exporter.





<span class="grey">Claise                       Informational                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   An attacker could forge Templates and/or Options Templates and
   thereby try to confuse the NetFlow Collector, rendering it unable to
   decode the Export Packets.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.3.%20%20Attacks%20on%20the%20NetFlow%20Collector"></a><a class="selflink" href="#section-10.3" name="section-10.3">10.3</a>.  Attacks on the NetFlow Collector</span>

   Denial of service attacks on the NetFlow Collector can consume so
   many resources from the machine that, the Collector is unable to
   capture or decode some NetFlow Export Packets.  Such hazards are not
   explicitly addressed by the NetFlow Version 9 protocol, although the
   normal methods used to protect a server from a DoS attack will
   mitigate the problem.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Examples"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Examples</span>

   Let us consider the example of an Export Packet composed of a
   Template FlowSet, a Data FlowSet (which contains three Flow Data
   Records), an Options Template FlowSet, and a Data FlowSet (which
   contains two Options Data Records).

   Export Packet:

   +--------+---------------------------------------------. . .
   |        | +--------------+ +-----------------------+
   | Packet | | Template     | | Data                  |
   | Header | | FlowSet      | | FlowSet               |   . . .
   |        | | (1 Template) | | (3 Flow Data Records) |
   |        | +--------------+ +-----------------------+
   +--------+---------------------------------------------. . .

       . . .+-------------------------------------------------+
            +------------------+ +--------------------------+ |
            | Options          | | Data                     | |
       . . .| Template FlowSet | | FlowSet                  | |
            | (1 Template)     | | (2 Options Data Records) | |
            +------------------+ +--------------------------+ |
       . . .--------------------------------------------------+














<span class="grey">Claise                       Informational                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.1.%20%20Packet%20Header%20Example"></a><a class="selflink" href="#section-11.1" name="section-11.1">11.1</a>.  Packet Header Example</span>

   The Packet Header is composed of:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Version = 9               |          Count = 7            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           sysUpTime                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           UNIX Secs                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Sequence Number                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Source ID                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.2.%20%20Template%20FlowSet%20Example"></a><a class="selflink" href="#section-11.2" name="section-11.2">11.2</a>.  Template FlowSet Example</span>

   We want to report the following Field Types:
   -  The source IP address (IPv4), so the length is 4
   -  The destination IP address (IPv4), so the length is 4
   -  The next-hop IP address (IPv4), so the length is 4
   -  The number of bytes of the Flow
   -  The number of packets of the Flow

   Therefore, the Template FlowSet is composed of the following:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       FlowSet ID = 0          |      Length = 28 bytes        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 256         |       Field Count = 5         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     IP_SRC_ADDR = 8           |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     IP_DST_ADDR = 12          |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     IP_NEXT_HOP = 15          |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       IN_PKTS = 2             |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       IN_BYTES = 1            |       Field Length = 4        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+





<span class="grey">Claise                       Informational                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.3.%20%20Data%20FlowSet%20Example"></a><a class="selflink" href="#section-11.3" name="section-11.3">11.3</a>.  Data FlowSet Example</span>

   In this example, we report the following three Flow Records:

   Src IP addr. | Dst IP addr. | Next Hop addr. | Packet | Bytes
                |              |                | Number | Number
   ---------------------------------------------------------------
   198.168.1.12 | 10.5.12.254  | 192.168.1.1    | 5009   | 5344385
   192.168.1.27 | 10.5.12.23   | 192.168.1.1    | 748    | 388934
   192.168.1.56 | 10.5.12.65   | 192.168.1.1    | 5      | 6534


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       FlowSet ID = 256        |          Length = 64          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          198.168.1.12                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          10.5.12.254                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.168.1.1                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             5009                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            5344385                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.168.1.27                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           10.5.12.23                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.168.1.1                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              748                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             388934                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          192.168.1.56                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           10.5.12.65                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           192.168.1.1                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               5                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              6534                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




<span class="grey">Claise                       Informational                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


   Note that padding was not necessary in this example.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.4.%20%20Options%20Template%20FlowSet%20Example"></a><a class="selflink" href="#section-11.4" name="section-11.4">11.4</a>.  Options Template FlowSet Example</span>

   Per line card (the Exporter is composed of two line cards), we want
   to report the following Field Types:
   - Total number of Export Packets
   - Total number of exported Flows

   The format of the Options Template FlowSet is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       FlowSet ID = 1          |          Length = 24          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Template ID 257         |    Option Scope Length = 4    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Option Length = 8       |  Scope 1 Field Type = 3       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Scope 1 Field Length = 2    |   TOTAL_EXP_PKTS_SENT = 41    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Field Length = 2        |     TOTAL_FLOWS_EXP = 42      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Field Length = 2        |           Padding             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/11.5.%20%20Data%20FlowSet%20with%20Options%20Data%20Records%20Example"></a><a class="selflink" href="#section-11.5" name="section-11.5">11.5</a>.  Data FlowSet with Options Data Records Example</span>

   In this example, we report the following two records:

   Line Card ID | Export Packet| Export Flow
   ------------------------------------------
   Line Card 1  | 345          | 10201
   Line Card 2  | 690          | 20402
















<span class="grey">Claise                       Informational                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    FlowSet ID = 257           |         Length = 16           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             1                 |             345               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           10201               |              2                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            690                |            20402              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20References"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.1.%20%20Normative%20References"></a><a class="selflink" href="#section-12.1" name="section-12.1">12.1</a>.  Normative References</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]   Bradner, S., "Key words for use in RFCs to Indicate
               Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/12.2.%20%20Informative%20References"></a><a class="selflink" href="#section-12.2" name="section-12.2">12.2</a>.  Informative References</span>

   [<a id="ref-RFC768" name="ref-RFC768">RFC768</a>]    Postel, J., "User Datagram Protocol", STD 6, <a href="rfc768.html">RFC 768</a>,
               August 1980.

   [<a id="ref-RFC793" name="ref-RFC793">RFC793</a>]    Postel, J., "Transmission Control Protocol", STD 7, <a href="rfc793.html">RFC</a>
               <a href="rfc793.html">793</a>, September 1981.

   [<a id="ref-RFC2960" name="ref-RFC2960">RFC2960</a>]   Stewart, R., Xie, Q., Morneault, K., Sharp, C.,
               Schwarzbauer, H., Taylor, T., Rytina, I., Kalla, M.,
               Zhang, L., and V. Paxson, "Stream Control Transmission
               Protocol", <a href="rfc2960.html">RFC 2960</a>, October 2000.

   [<a id="ref-RFC3917" name="ref-RFC3917">RFC3917</a>]   Quittek, J., Zseby, T., Claise, B., and S. Zander,
               "Requirements for IP Flow Information Export (IPFIX)",
               <a href="rfc3917.html">RFC 3917</a>, October 2004.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Authors"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Authors</span>

   This document was jointly written by Vamsidhar Valluri, Martin
   Djernaes, Ganesh Sadasivan, and Benoit Claise.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Acknowledgments"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Acknowledgments</span>

   I would like to thank Pritam Shah, Paul Kohler, Dmitri Bouianovski,
   and Stewart Bryant for their valuable technical feedback.






<span class="grey">Claise                       Informational                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20Authors%27%20Addresses"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  Authors' Addresses</span>

   Benoit Claise (Editor)
   Cisco Systems
   De Kleetlaan 6a b1
   1831 Diegem
   Belgium

   Phone:  +32 2 704 5622
   EMail:  bclaise@cisco.com


   Ganesh Sadasivan
   Cisco Systems, Inc.
   3750 Cisco Way
   San Jose, CA 95134
   USA

   Phone:  +1 408 527-0251
   EMail:  gsadasiv@cisco.com


   Vamsi Valluri
   Cisco Systems, Inc.
   510 McCarthy Blvd.
   San Jose, CA 95035
   USA

   Phone:  +1 408 525-1835
   EMail:  vvalluri@cisco.com


   Martin Djernaes
   Cisco Systems, Inc.
   510 McCarthy Blvd.
   San Jose, CA 95035
   USA

   Phone:  +1 408 853-1676
   EMail:  djernaes@cisco.com











<span class="grey">Claise                       Informational                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc3954.html">RFC 3954</a>        Cisco Systems NetFlow Services Export V9    October 2004</span>


Full Copyright Statement

   Copyright (C) The Internet Society (2004).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and at www.rfc-editor.org, and except as set
   forth therein, the authors retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the ISOC's procedures with respect to rights in ISOC Documents can
   be found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







Claise                       Informational                     [Page 33]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3954 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:44 GMT --></html>