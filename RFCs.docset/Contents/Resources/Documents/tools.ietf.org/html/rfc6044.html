<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6044 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6044" name="DC.Identifier"/>
<meta content="Although the SIP History-Info header is the solution adopted in IETF,
the non-standard Diversion header is nevertheless widely implemented
and used for conveying call-diversion-related information in SIP
signaling.  This document describes a recommended interworking
guideline between the Diversion header and the History-Info header to
handle call diversion information. In addition, an interworking policy
is proposed to manage the headers' coexistence. The History-Info
header is described in RFC 4244 and the non-standard Diversion header
is described, as Historic, in RFC 5806.  Since the Diversion header is
used in many existing network implementations for the transport of
call diversion information, its interworking with the SIP History-Info
standardized solution is needed. This work is intended to enable the
migration from non- standard implementations and deployment toward
IETF specification- based implementations and deployment. This
document is not an Internet Standards Track specification; it is
published for informational purposes." name="DC.Description.Abstract"/>
<meta content="Marianne Mohali &lt;marianne.mohali@orange-ftgroup.com&gt;" name="DC.Creator"/>
<meta content="October, 2010" name="DC.Date.Issued"/>
<meta content="Mapping and Interworking of Diversion Information between Diversion and History-Info Headers in the Session Initiation Protocol (SIP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6044 - Mapping and Interworking of Diversion Information between Diversion and History-Info Headers in the Session Initiation Protocol (SIP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgbrown" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6044.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6044" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-mohali-diversion-history-info" title="draft-mohali-diversion-history-info">draft-mohali-di...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6044" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6044" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6044" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=6044">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">Obsoleted by: <a href="rfc7544.html">7544</a>                                         INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Independent Submission                                         M. Mohali
Request for Comments: 6044                         France Telecom Orange
Category: Informational                                     October 2010
ISSN: 2070-1721


Mapping and Interworking of Diversion Information between Diversion and
     History-Info Headers in the Session Initiation Protocol (SIP)

Abstract

   Although the SIP History-Info header is the solution adopted in IETF,
   the non-standard Diversion header is nevertheless widely implemented
   and used for conveying call-diversion-related information in SIP
   signaling.

   This document describes a recommended interworking guideline between
   the Diversion header and the History-Info header to handle call
   diversion information.  In addition, an interworking policy is
   proposed to manage the headers' coexistence.  The History-Info header
   is described in <a href="rfc4244.html">RFC 4244</a> and the non-standard Diversion header is
   described, as Historic, in <a href="rfc5806.html">RFC 5806</a>.

   Since the Diversion header is used in many existing network
   implementations for the transport of call diversion information, its
   interworking with the SIP History-Info standardized solution is
   needed.  This work is intended to enable the migration from non-
   standard implementations and deployment toward IETF specification-
   based implementations and deployment.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This is a contribution to the RFC Series, independently of any other
   RFC stream.  The RFC Editor has chosen to publish this document at
   its discretion and makes no statement about its value for
   implementation or deployment.  Documents approved for publication by
   the RFC Editor are not a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6044">http://www.rfc-editor.org/info/rfc6044</a>.






<span class="grey">Mohali                        Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


Copyright Notice

   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Overview ...................................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Background .................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Problem Statement ...............................................<a href="#page-4">4</a>
      <a href="#section-2.1">2.1</a>. Interworking Requirements and Scope ........................<a href="#page-4">4</a>
      <a href="#section-2.2">2.2</a>. Interworking Recommendations ...............................<a href="#page-6">6</a>
           2.2.1. SIP Network/Terminal Using Diversion to SIP
                  Network/Terminal Using History-Info Header ..........<a href="#page-6">6</a>
           2.2.2. SIP Network/Terminal Using History-Info
                  Header to SIP Network/terminal Using Diversion
                  Header ..............................................<a href="#page-8">8</a>
   <a href="#section-3">3</a>. Headers Syntaxes Reminder .......................................<a href="#page-9">9</a>
      <a href="#section-3.1">3.1</a>. History-Info Header Syntax .................................<a href="#page-9">9</a>
      <a href="#section-3.2">3.2</a>. Diversion Header Syntax ...................................<a href="#page-11">11</a>
   <a href="#section-4">4</a>. Headers in SIP Method ..........................................<a href="#page-11">11</a>
   <a href="#section-5">5</a>. Diversion Header to History-Info Header ........................<a href="#page-12">12</a>
   <a href="#section-6">6</a>. History-Info Header to Diversion Header ........................<a href="#page-15">15</a>
   <a href="#section-7">7</a>. Examples .......................................................<a href="#page-17">17</a>
      7.1. Example with Diversion Header Changed into
           History-Info Header .......................................<a href="#page-17">17</a>
      7.2. Example with History-Info Header Changed into
           Diversion Header ..........................................<a href="#page-17">17</a>
      <a href="#section-7.3">7.3</a>. Example with Two SIP Networks Using History-Info Header ...<a href="#page-17">17</a>
      <a href="#section-7.4">7.4</a>. Additional Interworking Cases .............................<a href="#page-19">19</a>
   <a href="#section-8">8</a>. Security Considerations ........................................<a href="#page-20">20</a>
   <a href="#section-9">9</a>. Acknowledgements ...............................................<a href="#page-21">21</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-21">21</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-21">21</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-21">21</a>
   <a href="#appendix-A">Appendix A</a>.  Interworking between Diversion Header and
                Voicemail URI ........................................<a href="#page-23">23</a>






<span class="grey">Mohali                        Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Overview"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Overview</span>

   For some VoIP-based (Voice over IP) services (e.g., voicemail,
   Interactive Voice Recognition (IVR) or automatic call distribution),
   it is helpful for the called SIP user agent to identify from whom and
   why the session was diverted.  For this information to be used by
   various service providers or by applications, it needs to pass
   through the network.  This is possible with two different SIP
   headers: the History-Info header defined in [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>] and the
   historic Diversion header defined in [<a href="rfc5806.html" title='"Diversion Indication in SIP"'>RFC5806</a>], which are both able
   to transport diversion information in SIP signaling.

   Although the Diversion header is not standardized, it is widely used.
   Therefore, it is useful to have guidelines to make this header
   interwork with the standard History-Info header.

   Note that the new implementation and deployment of the Diversion
   header is strongly discouraged.

   This document provides a mechanism for header-content translation
   between the Diversion header and the History-Info header.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Background"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Background</span>

   The History-Info header [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>] and its extension for forming SIP
   service URIs (including Voicemail URI) [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>] are recommended by
   the IETF to convey redirection information.  They are also
   recommended in the "Communication Diversion (CDIV) service" Third
   Generation Partnership Project (3GPP) specification [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>].

   Originally, the Diversion header was described in a document that was
   submitted to the SIP Working Group.  It has been published now as
   [<a href="rfc5806.html" title='"Diversion Indication in SIP"'>RFC5806</a>] for the historical record and to provide a reference for
   this RFC.

   This header contains a list of diverting URIs and associated
   information providing specific information as the reason for the call
   diversion.  Most existing SIP-based implementations have implemented
   the Diversion header when no standard solution was ready to deploy.
   The IETF has finally standardized the History-Info header, partly
   because it can transport general history information.  This allows
   the receiving part to determine how and why the session is received.
   As the History-Info header may contain further information than call
   diversion information, it is critical to avoid losing information and





<span class="grey">Mohali                        Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   be able to extract the relevant data using the retargeting cause URI
   parameter described in [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>] for the transport of the diversion
   reason.

   The Diversion header and the History-Info header have different
   syntaxes, described below.  Note that the main difference is that the
   History-Info header is a chronological writing header whereas the
   Diversion header applies a reverse chronology (i.e., the first
   diversion entry read corresponds to the last diverting user).

   <a href="#appendix-A">Appendix A</a> provides an interworking guideline between the Diversion
   header and the Voicemail URI, which is another way to convey
   diversion information.  The Voicemail URI is defined in [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Problem%20Statement"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Problem Statement</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Interworking%20Requirements%20and%20Scope"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Interworking Requirements and Scope</span>

   This section provides the baseline terminology used in the rest of
   the document and defines the scope of interworking between the
   Diversion header and the History-Info header.

   There are many ways in which SIP signaling can be used to modify a
   session destination before it is established, and there are many
   reasons for doing so.  The behavior of the SIP entities that will
   have to further process the session downstream will sometimes vary
   depending on the reasons that lead to changing the destination.  For
   example, whether it is for a simple proxy to route the session or for
   an application server to provide a supplementary service.  The
   Diversion header and the History-Info header differ in the approach
   and scope of addressing this problem.

   For clarity, the following vocabulary is used in this document:

   o  Retargeting/redirecting: retargeting/redirecting refers to the
      process of a Proxy Server/User Agent Client (UAC) changing a
      Uniform Resource Identifier (URI) in a request and thus changing
      the target of the request.  These terms are defined in [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>].
      The History-Info header is used to capture retargeting
      information.

   o  Call forwarding/call diversion/communication diversion: these
      terms are equivalent and refer to the Communications Diversion
      (CDIV) supplementary services, based on the Integrated Services
      Digital Network (ISDN) Communication diversion supplementary






<span class="grey">Mohali                        Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


      services and defined in 3GPP [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>].  They are applicable to
      entities that are intended to modify the original destination of
      an IP multimedia session during or prior to the session
      establishment.

   This document does not intend to describe when or how History-Info or
   Diversion headers should be used.  Hereafter is provided
   clarification on the context in which the interworking is required.

   The Diversion header has exactly the same scope as the call diversion
   service and each header entry reflects a call diversion invocation.
   The Diversion header is used for recording call forwarding
   information, which could be useful to network entities downstream.
   Today, this SIP header is implemented by several manufacturers and
   deployed in networks.

   The History-Info header is used to store all retargeting information
   including call diversion information.  In practice, the History-Info
   header [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>] is used to convey call-diversion-related information
   by using a cause URI parameter [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>] in the relevant entry.
   Note, however, that the use of cause URI parameter [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>] in a
   History-Info entry for a call diversion is specific to the 3GPP
   specification [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>].  [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>] focuses on retargeting toward a
   voicemail server and does not specify whether the cause URI parameter
   should be added in a URI for other cases.  As a consequence,
   implementations that do not use the cause URI parameter for call
   forwarding information are not considered for the mapping described
   in this document.  Nevertheless, some recommendations are given in
   the next sections on how to avoid the loss of non-mapped information
   at the boundary between a network region using History-Info header
   and one using the Diversion header.

   Since both headers address call forwarding needs, diverting
   information could be mixed up or be inconsistent if both are present
   in an uncoordinated fashion in the INVITE request.  So, Diversion and
   History-Info headers must not independently coexist in the same
   session signaling.  This document addresses how to convert
   information between the Diversion header and the History-Info header,
   and when and how to preserve both headers to cover additional cases.

   For the transportation of consistent diversion information
   downstream, it is necessary to make the two headers interwork.
   Interworking between the Diversion header and the History-Info header
   is introduced in sections <a href="#section-5">5</a> and <a href="#section-6">6</a>.  Since the coexistence scenario
   may vary from one use case to another one, guidelines regarding
   headers interaction are proposed.





<span class="grey">Mohali                        Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Interworking%20Recommendations"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Interworking Recommendations</span>

   Interworking function:

      In a normal case, the network topology assumption is that the
      interworking described in this document should be performed by a
      specific SIP border device that is aware, by configuration, that
      it is at the border between two regions, one using History-Info
      header and one using Diversion header.

   As History-Info header is a standard solution, a network using the
   Diversion header must be able to provide information to a network
   using the History-Info header.  In this case, to avoid header
   coexistence, it is required to replace, as often as possible, the
   Diversion header with the History-Info header in the INVITE request
   during the interworking.

   Since, the History-Info header has a wider scope than the Diversion
   header, it may be used for other needs and services than call
   diversion.  In addition to trace call diversion information, the
   History-Info header also acts as a session history and can store all
   successive R-URI values.  Consequently, even if it should be better
   to remove the History-Info header after the creation of the Diversion
   header to avoid confusion, the History-Info header must remain
   unmodified in the SIP signaling if it contains supplementary (non-
   diversion) information.  It is possible to have History-Info headers
   that do not have values that can be mapped into the Diversion header.
   In this case, no interworking with Diversion header should be
   performed, and it must be defined per implementation what to do in
   this case.  This point is left out of the scope of this document.

   As a conclusion, it is recommended to have local policies minimizing
   the loss of information and find the best way to keep it up to the
   terminating user agent.

   The following sections describe the basic common use case.
   Additional interworking cases are described in <a href="#section-7.5">section 7.5</a>.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.1.%20%20SIP%20Network%2FTerminal%20Using%20Diversion%20to%20SIP%20Network%2FTerminal"></a><a class="selflink" href="#section-2.2.1" name="section-2.2.1">2.2.1</a>.  SIP Network/Terminal Using Diversion to SIP Network/Terminal</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Using%20History-Info%20Header"></a>        Using History-Info Header</span>

   When the Diversion header is used to create a History-Info header,
   the Diversion header must be removed in the outgoing INVITE.  It is
   considered that all of the information present in the Diversion
   header is transferred in the History-Info header.






<span class="grey">Mohali                        Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   If a History-Info header is present in the incoming INVITE (in
   addition to Diversion header), the Diversion header and History-Info
   header present must be mixed and only the diversion information not
   yet present in the History-Info header must be inserted as a last
   entry (more recent) in the existing History-Info header, as
   recommended in [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>].

   As an example, this could be the case of an INVITE coming from
   network_2 using the Diversion header but previously passed through
   network_1 using the History-Info header (or the network_2 uses
   History-Info header to transport successive URI information) and
   going to network_3 using the History-Info header.

                       IWF*                                  IWF*
     network1           |                network_2            |network_3
    History-Info        |                 Diversion           |using
                        |                                     |Hist-Info
                        |                                     |
UA A    P1     AS B     |       P2     AS C    UA C   AS D    |     UA E
|       |       |       |       |       |       |     |       |        |
|INVITE |       |       |       |       |       |     |       |        |
|------&gt;|       |       |       |       |       |     |       |        |
|       |       |       |       |       |       |     |       |        |
|       |INVITE |       |       |       |       |     |       |        |
|       |------&gt;|       |       |       |       |     |       |        |
|       |Supported: histinfo    |       |       |     |       |        |
|       | History-Info:         |       |       |     |       |        |
|       | &lt;sip:proxyP1&gt;; index=1,       |       |     |       |        |
|       | &lt;sip:userB &gt;; index=1.1       |       |     |       |        |
|       |       |       |       |       |       |     |       |        |
|       |       |INVITE |       |       |       |     |       |        |
|       |       |------&gt;|       |       |       |     |       |        |
|       |       |History-Info:  |       |       |     |       |        |
|       |       |&lt;sip:proxyP1&gt;; index=1,|       |     |       |        |
|       |       |&lt;sip:userB&gt;; index=1.1 |       |     |       |        |
|       |       |&lt;sip:userC&gt;; cause=302; index=1.1.1  |       |        |

   In this case, the incoming INVITE contains a Diversion header and a
   History-Info header.  Therefore, as recommended in this document, it
   is necessary to create, for network_3, a single History-Info header
   gathering existing information from both the History-Info and the
   Diversion headers received.  Anyway, it is required from network_2
   (i.e., IWF) to remove the Diversion header when the message is going
   to a network not using the Diversion header.  Then, network_3 could
   use call forwarding information that is present in a single header
   and add its own diversion information if necessary.





<span class="grey">Mohali                        Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   Notes:

   1. If a network is not able either to use only one header each time
      or to maintain both headers up to date, the chronological order
      cannot be certified.

   2. It is not possible to have only a Diversion header when the
      History-Info header contains more than call diversion information.
      If previous policy recommendations are applied, the chronological
      order is respected as Diversion entries are inserted at the end of
      the History-Info header taking into account the Diversion internal
      chronology.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/2.2.2.%20%20SIP%20Network%2FTerminal%20Using%20History-Info%20Header%20to%20SIP"></a><a class="selflink" href="#section-2.2.2" name="section-2.2.2">2.2.2</a>.  SIP Network/Terminal Using History-Info Header to SIP</span>
<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/Network%2FTerminal%20Using%20Diversion%20Header"></a>        Network/Terminal Using Diversion Header</span>

   When the History-Info header is interpreted to create a Diversion
   header, some precautions must be taken.

   If the History-Info header contains only call forwarding information,
   then it must be deleted after the interworking.

   If the History-Info header contains other information, then only the
   information of concern to the diverting user must be used to create
   entries in the Diversion header and the History-Info header must be
   kept as received in the INVITE and forwarded downstream.

   Note: The History-Info header could be used for other reasons than
   call diversion services, for example, by a service that needs to know
   if a specific Application Server (AS) had yet been invoked in the
   signaling path.  If the call is later forwarded to a network using
   the History-Info header, it would be better not to lose history
   information due to passing though the network that only supports
   Diversion headers.  A recommended solution must not disrupt the
   standard behavior and networks that do not implement the History-Info
   header must be transparent to a received History-Info header.

   If a Diversion header is present in the incoming INVITE (in addition
   to History-Info header), only diversion information present in the
   History-Info header but not in the Diversion header must be inserted
   from the last entry (more recent) into the existing Diversion header,
   as recommended in [<a href="rfc5806.html" title='"Diversion Indication in SIP"'>RFC5806</a>].

   Note that the chronological order could not be certified.  If
   previous policy recommendations are respected, this case should not
   happen.





<span class="grey">Mohali                        Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   Forking case:

      The History-Info header enables the recording of sequential
      forking for the same served user.  During an interworking, from
      the History-Info header to Diversion header, the History-Info
      entries containing a forking situation (with an incremented
      "index" parameter) could possibly be mapped if it contains a call
      forwarding "cause" parameter.  The interworking entity could
      choose to create only a Diversion entry or not apply the
      interworking.  The choice could be done according a local policy.

   The same logic is applied for an interworking with Voicemail URI (see
   the Appendix).

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Headers%20Syntaxes%20Reminder"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Headers Syntaxes Reminder</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20History-Info%20Header%20Syntax"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  History-Info Header Syntax</span>

   History-Info = "History-Info" HCOLON hi-entry *(COMMA hi-entry)

     hi-entry           = hi-targeted-to-uri *( SEMI hi-param )
     hi-targeted-to-uri = name-addr
     hi-param           = hi-index / hi-extension
     hi-index           = "index" EQUAL 1*DIGIT *(DOT 1*DIGIT)
     hi-extension       = generic-param

   The History-Info header is specified in [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>].  The top-most
   History-Info entry (first in the list) corresponds to the oldest
   history information.

   A hi-entry may contain a cause URI parameter expressing the diversion
   reason.  This optional cause URI parameter is defined in [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>]
   with the following syntax:

   cause-param = "cause" EQUAL Status-Code

   This parameter is also named cause-param and should be inserted in
   the History-Info entry (URI) of the diverted-to user in case of call
   diversion as recommended in the 3GPP CDIV specification [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>].
   The cause values used in the cause-param for the diverting reason are
   listed in the <a href="rfc4458.html">RFC 4458</a>, and because it is a parameter dedicated to
   call forwarding service, its presence is used to determine that a hi-
   entry is a diverting user.  More precisely, each diverting user is
   located in the hi-entry before the one containing a cause-param with
   a cause value as listed in <a href="rfc4458.html">RFC 4458</a>.






<span class="grey">Mohali                        Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   Moreover, the Reason header defined in [<a href="rfc3326.html" title='"The Reason Header Field for the Session Initiation Protocol (SIP)"'>RFC3326</a>] should be escaped in
   the hi-entry of the diverting user when the call diversion is due to
   a received SIP response.  The Reason header contains a cause
   parameter set to the true SIP response code received (Status-Code).
   Therefore, in case of call diversion due to a SIP response, both
   cause parameters should be used.  The complexity is that these
   parameters could be used at the same time in the History-Info header
   but not in the same hi-entry and not with the same meaning.  Only the
   cause-param is dedicated to call diversion service.  The 'cause'
   Reason header parameter is not taken into account in the mapping with
   a Diversion header.

   [<a id="ref-RFC4458" name="ref-RFC4458">RFC4458</a>] also defines the 'target' URI parameter, which could be
   inserted in a R-URI and consequently in the hi-targeted-to-uri.  This
   parameter is used to keep the diverting user address in the
   downstream INVITE request in Voicemail URI implementation.  As this
   information is already present in the hi-entries, the 'target' URI
   parameter is not taken into account regarding the interworking with
   the Diversion header.  From the Diversion header, it could be
   possible to create the 'target' URI parameter in the hi-entries
   and/or in the R-URI, but this possibility is based on local policies
   not described in this document.

   A Privacy header, as defined in [<a href="rfc3323.html" title='"A Privacy Mechanism for the Session Initiation Protocol (SIP)"'>RFC3323</a>], could also be included in
   hi-entries with the 'history' value defined in the [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>].

   The index parameter is a string of digits, separated by dots, to
   indicate the number of forward hops and retargets.

   Note: A history entry could contain the "gr" parameter.  Regardless
   of the rules concerning the "gr" parameter defined in [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>],
   which must be applied, this parameter has no impact on the mapping
   and must only be copied with the served user address.

   Example:

   History-Info:
   &lt;sip: diverting_user1_addr?Privacy=none?Reason=SIP%3Bcause%
   3D302&gt;;index=1,
   &lt;sip: diverting_user2_addr;cause=480?Privacy=history&gt;;index=1.1,
   &lt;sip:last_diversion_target;cause=486&gt;; index=1.1.1

   Policy concerning "histinfo" option tag in Supported header:
   According to [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>], a proxy that receives a Request with the
   "histinfo" option tag in the Supported header should return captured
   History-Info in subsequent, provisional and final responses to the
   Request.  The behavior depends upon whether or not the local policy
   supports the capture of History-Info.



<span class="grey">Mohali                        Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20Diversion%20Header%20Syntax"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  Diversion Header Syntax</span>

   The following text is restating the exact syntax that the production
   rules in [<a href="rfc5806.html" title='"Diversion Indication in SIP"'>RFC5806</a>] define, but using [<a href="rfc5234.html" title='"Augmented BNF for Syntax Specifications: ABNF"'>RFC5234</a>] ABNF:

    Diversion = "Diversion" HCOLON diversion-params
                                 *(COMMA diversion-params)

    diversion-params    = name-addr *(SEMI (diversion-reason /
                          diversion-counter / diversion-limit /
                          diversion-privacy / diversion-screen /
                          diversion-extension))
    diversion-reason    = "reason" EQUAL ("unknown" / "user-busy" /
                          "no-answer" / "unavailable" / "unconditional"
                          / "time-of-day" / "do-not-disturb" /
                          "deflection" / "follow-me" / "out-of-service"
                          / "away" / token / quoted-string)
    diversion-counter   = "counter" EQUAL 1*2DIGIT
    diversion-limit     = "limit" EQUAL 1*2DIGIT
    diversion-privacy   = "privacy" EQUAL ("full" / "name" / "uri" /
                          "off" / token / quoted-string)
    diversion-screen    = "screen" EQUAL ("yes" / "no" / token /
                          quoted-string)
    diversion-extension = token [EQUAL (token / quoted-string)]

   Note: The Diversion header could be used in the comma-separated
   format, as described below, and in a header-separated format.  Both
   formats could be combined a received INVITE as recommended in
   [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>].

   Example:

   Diversion:

   diverting_user2_addr; reason="user-busy"; counter=1; privacy=full,
   diverting_user1_addr; reason="unconditional"; counter=1; privacy=off

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Headers%20in%20SIP%20Method"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Headers in SIP Method</span>

   The recommended interworking presented in this document should apply
   only for INVITE requests.

   In 3xx responses, both headers could be present.

   When a proxy wants to interwork with a network supporting the other
   header field, it should apply the interworking between Diversion
   header and History-Info header in the 3xx response.




<span class="grey">Mohali                        Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   When a recursing proxy redirects an initial INVITE after receiving a
   3xx response, it should add as a last entry either a Diversion header
   or a History-Info header (according to its capabilities) in the
   forwarded INVITE.  Local policies could apply to send the received
   header in the next INVITE.

   Other messages where History-Info could be present are not used for
   the call forwarding service and should not be changed into Diversion
   header.  The destination network must be transparent to the received
   History-Info header.

   Note: the following mapping is inspired from the ISDN User Part
   (ISUP) to the SIP interworking described in [<a href="#ref-TS_29.163" title='"Technical Specification Group Core Network and Terminals ; Interworking between the IP Multimedia (IM) Core Network (CN) Subsystem and Circuit Switched (CS) networks (Release 8)"'>TS_29.163</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Diversion%20Header%20to%20History-Info%20Header"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Diversion Header to History-Info Header</span>

   The following text is valid only if no History-Info is present in the
   INVITE request.  If at least one History-Info header is present, the
   interworking function must adapt its behavior to respect the
   chronological order.  See <a href="#section-2.2">section 2.2</a>.

   For N Diversion entries, N+1 History-Info entries must be created.
   To create the History-Info entries in the same order than during a
   session establishment, the Diversion entries must be mapped from the
   bottom-most until the top-most.  Each Diversion entry shall be mapped
   into a History-Info entry.  An additional History-Info entry (the
   last one) must be created with the diverted-to party address present
   in the R-URI of the received INVITE.  The mapping is described below.

   The first entry created in the History-Info header contains:

   - a hi-targeted-to-uri with the name-addr parameter of the bottom-
     most Diversion header.

   - if a privacy parameter is present in the bottom-most Diversion
     entry, then a Privacy header could be escaped in the History-Info
     header as described below.

   - an index set to 1.

   For each following Diversion entry (from bottom to top), the History-
   info entries are created as following (from top to bottom):









<span class="grey">Mohali                        Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


Source                                   Destination
Diversion header component:              History-Info header component:
=======================================================================
name-addr                                hi-targeted-to-uri

=======================================================================
Reason of the previous                   cause-param (not present in
Diversion entry                          the first created hi-entry)
"unknown"---------------------------------404 (default 'cause' value)
"unconditional"---------------------------302
"user-busy"-------------------------------486
"no-answer"-------------------------------408
"deflection "-----------------------------480 or 487
"unavailable"-----------------------------404
"time-of-day"-----------------------------404 (default)
"do-not-disturb"--------------------------404 (default)
"follow-me"-------------------------------404 (default)
"out-of-service"--------------------------404 (default)
"away"------------------------------------404 (default)

=======================================================================
Counter                                   hi-index
"1" or parameter -------------------------The previous created index
not present                               is incremented with ".1"
Superior to "1" --------------------------Create N-1 placeholder History
(i.e., N)                                 entry with the previous index
                                          incremented with ".1"
                                          Then the History-Info header
                                          created with the Diversion
                                          entry with the previous index
                                          incremented with ".1"
=======================================================================
Privacy                                   Privacy header escaped in the
                                          hi-targeted-to-uri
"full"------------------------------------"history"
"Off"-------------------------------------Privacy header field
                                          absent or "none"
"name"------------------------------------"history"
"uri"-------------------------------------"history"
=======================================================================

   A last History-Info entry is created and contains:

   - a hi-targeted-to-uri with the Request-URI of the INVITE request.

   - a cause-param from the top-most Diversion entry, mapped from the
     diversion-reason as described above.




<span class="grey">Mohali                        Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   - if a privacy parameter is present in the top-most Diversion entry,
     then a Privacy header could be escaped in the History-Info header
     as described above.

   - an index set to the previous created index and incremented with
     ".1"

   Notes:

   1. For other optional Diversion parameters, there is no
      recommendation as History-Info header does not provide equivalent
      parameters.

   2. For values of the diversion-reason values that are mapped with a
      recommended default value, it could also be possible to choose
      another value.  The cause-param URI parameter offers less possible
      values than the diversion-reason parameter.  However, it has been
      considered that cause-param values list was sufficient to
      implement CDIV service as defined in 3GPP [<a href="#ref-TS_24.604" title='"Technical Specification Group Core Network and Terminals ; Communication Diversion (CDIV) using IP Multimedia (IM)Core Network (CN) subsystem ; Protocol specification (Release 8), 3GPP TS 24.604"'>TS_24.604</a>] as it covers
      a large portion of cases.

   3. The Diversion header could contain a Tel:URI in the name-addr
      parameter, but it seems not possible to have a Tel:URI in the
      History-Info header.  [<a href="rfc3261.html" title='"SIP: Session Initiation Protocol"'>RFC3261</a>] gives an indication as to the
      mapping between sip: and Tel:URIs, but in this particular case, it
      is difficult to assign a valid hostport as the diversion has
      occurred in a previous network and a valid hostport is difficult
      to determine.  So, it is suggested that in case of Tel:URI in the
      Diversion header, the History-Info header should be created with a
      SIP URI with user=phone.

   4. The Diversion header allows the carrying of a counter that retains
      the information about the number of successive redirections.  The
      History-Info header does not have an equivalent because to trace
      and count the number of diversion it is necessary to count cause
      parameter containing a value associated to a call diversion.  Read
      the index value is not enough.  With the use of the "placeholder"
      entry, the History-Info header entries could reflect the real
      number of diversion occurred.

   Example of placeholder entry in the History-Info header:

      &lt;sip:unknown@unknown.invalid;cause=xxx&gt;;index=1.1

      &lt;sip:bob_addr;cause=404&gt;;index=1.1.1






<span class="grey">Mohali                        Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   "cause=xxx" reflects the diverting reason of a previous diverting
   user.  For a placeholder hi-entry, the value "404" must be taken for
   the cause-param and so, located in the next hi-entry.

   Concerning local policies recommendations about headers coexistence
   in the INVITE request, see sections <a href="#section-2.2">2.2</a> and <a href="#section-7.5">7.5</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20History-Info%20Header%20to%20Diversion%20Header"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  History-Info Header to Diversion Header</span>

   To create the Diversion entries in the same order than during a
   session establishment, the History-Info entries must be mapped from
   the top-most until the bottom-most.  The first History-Info header
   entry selected will be mapped into the last Diversion header entry
   and so on.  One Diversion header entry must be created for each
   History-Info entry, with a cause-param reflecting a diverting reason
   as listed in the [<a href="rfc4458.html" title='"Session Initiation Protocol (SIP) URIs for Applications such as Voicemail and Interactive Voice Response (IVR)"'>RFC4458</a>].

   In this case, the History-Info header must be mapped into the
   Diversion header as following:
































<span class="grey">Mohali                        Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   Source                                    Destination
   History-Info header component:            Diversion header component:
   =====================================================================
   hi-targeted-to-uri of the                   name-addr
   History-Info that precedes the one
   containing a diverting cause-param.

   =====================================================================
   cause-param                               Reason
   404---------------------------------------"unknown" (default value)
   302---------------------------------------"unconditional"
   486---------------------------------------"user-busy"
   408---------------------------------------"no-answer"
   480 or 487--------------------------------"deflection "
   503---------------------------------------"unavailable"

   =====================================================================
   hi-index                                   Counter
   Mandatory parameter for--------------------The counter is set to "1".
   History-Info reflecting
   the chronological order
   of the information.
   =====================================================================
   Privacy header [<a href="rfc3323.html" title='"A Privacy Mechanism for the Session Initiation Protocol (SIP)"'>RFC3323</a>] escaped in the    Privacy
   hi-targeted-to-uri of the
   History-Info, which precedes the one
   containing a diverting cause-param.
   Optional parameter for History-Info,
   this Privacy indicates that this
   specific History-Info header should
   not be forwarded.
   "history"----------------------------------"full"
   Privacy header field ----------------------"Off"
   Absent or "none"

   =====================================================================

   Note: For other optional History-Info parameters, there is no
   recommendation as Diversion header does not provide equivalent
   parameters.

   Concerning local policies recommendations about headers coexistence
   in the INVITE request, see <a href="#section-2.2">section 2.2</a>.








<span class="grey">Mohali                        Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Examples"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Examples</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Example%20with%20Diversion%20Header%20Changed%20into%20History-Info%20Header"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Example with Diversion Header Changed into History-Info Header</span>

   INVITE last_diverting_target
   Diversion:
   diverting_user3_address;reason=unconditional;counter=1;privacy=off,
   diverting_user2_address;reason=user-busy;counter=1;privacy=full,
   diverting_user1_address;reason=no-answer;counter=1;privacy=off

   Mapped into:

   History-Info:
   &lt;sip: diverting_user1_address; privacy=none &gt;; index=1,
   &lt;sip: diverting_user2_address; cause=408?privacy=history&gt;;index=1.1,
   &lt;sip: diverting_user3_address; cause=486?privacy=none&gt;;index=1.1.1,
   &lt;sip: last_diverting_target; cause=302&gt;;index=1.1.1.1

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20Example%20with%20History-Info%20Header%20Changed%20into%20Diversion%20Header"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  Example with History-Info Header Changed into Diversion Header</span>

   History-Info:
   &lt;sip: diverting_user1_address?privacy=history &gt;; index=1,
   &lt;sip: diverting_user2_address; cause=302? privacy=none&gt;;index=1.1,
   &lt;sip: last_diverting_target; cause=486&gt;;index=1.1.1

   Mapped into:

   Diversion:
   diverting_user2_address; reason=user-busy; counter=1; privacy=off,
   diverting_user1_address; reason=unconditional; counter=1;
   privacy=full

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Example%20with%20Two%20SIP%20Networks%20Using%20History-Info%20Header"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Example with Two SIP Networks Using History-Info Header</span>
<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/Interworking%20with%20a%20SIP%20Network%20Using%20Diversion%20Header"></a>      Interworking with a SIP Network Using Diversion Header</span>

   A -&gt; P1 -&gt; B -&gt; C -&gt; P2 -&gt; D-&gt; E
   A, B, C, D and E are users.
   B, C and D have Call Forwarding service invoked.
   P1 and P2 are proxies.
   Only relevant information is shown on the following call flow.











<span class="grey">Mohali                        Informational                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


                          IWF*                                IWF*
     SIP network using     |           SIP network using       |SIP net.
       History-Info        |                Diversion          |using
                           |                                   Hist-Info
                           |                                   |
   UA A    P1     AS B     |      P2     AS C    UA C   AS D   |    UA E
   |       |       |       |      |       |       |     |      |       |
   |INV B  |       |       |      |       |       |     |      |       |
   |------&gt;|       |       |      |       |       |     |      |       |
   |       |       |       |      |       |       |     |      |       |
   |       |INV B  |       |      |       |       |     |      |       |
   |       |------&gt;|       |      |       |       |     |      |       |
   |       |Supported: histinfo   |       |       |     |      |       |
   |       | History-Info:        |       |       |     |      |       |
   |       | &lt;sip:proxyP1&gt;; index=1,      |       |     |      |       |
   |       | &lt;sip:userB &gt;; index=1.1      |       |     |      |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |INV C  |      |       |       |     |      |       |
   |       |       |------&gt;|      |       |       |     |      |       |
   |       |       |History-Info: |       |       |     |      |       |
   |       |       &lt;sip:proxyP1&gt;; index=1,|       |     |      |       |
   |       |       &lt;sip:userB&gt;; index=1.1 |       |     |      |       |
   |       |       &lt;sip:userC; cause=302&gt;; index=1.1.1  |      |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |INV C |       |       |     |      |       |
   |       |       |       |-----&gt;|       |       |     |      |       |
   |       |       |       |Diversion:    |       |     |      |       |
   |       |       |       |B reason= unconditional counter=1  |       |
   |       |       |       |History-Info: |       |     |      |       |
   |       |       |       &lt;sip:proxyP1&gt;; index=1,|     |      |       |
   |       |       |       &lt;sip:userB&gt;; index=1.1 |     |      |       |
   |       |       |       &lt;sip:proxyP2; cause=302&gt;; index=1.1.1       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |INV C  |       |     |      |       |
   |       |       |       |      |------&gt;|       |     |      |       |
   |       |       |       |     No modification of Diversion due to P2|
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |       |INV C  |     |      |       |
   |       |       |       |      |       |------&gt;|     |      |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |       |&lt;--180-|     |      |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |  No response timer expire  |       |
   |       |       |       |      |       |---INV D ---&gt;|      |       |







<span class="grey">Mohali                        Informational                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   |       |       |Diversion:                          |      |       |
   |       |       |userC; reason=no-answer; counter=1; privacy=full,  |
   |       |       |userB; reason=unconditional; counter=1; privacy=off,
   |       |       |    History-Info:                   |      |       |
   |       |       |    &lt;sip:proxyP1&gt;; index=1,         |      |       |
   |       |       |    &lt;sip:userB&gt;; index=1.1          |      |       |
   |       |       |    &lt;sip:proxyP2; cause=302&gt;; index=1.1.1  |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |       |       |     |INV E |       |
   |       |       |       |      |       |       |     |-----&gt;|       |
   |       |       |Diversion:                                 |       |
   |       |       |userD; reason=time-of-day; counter=1; privacy=off  |
   |       |       |userC; reason=no-answer; counter=1; privacy=full,  |
   |       |       |userB; reason=unconditional; counter=1; privacy=off,
   |       |       |     History-Info:                         |       |
   |       |       |     &lt;sip:proxyP1&gt;; index=1,               |       |
   |       |       |     &lt;sip:userB&gt;; index=1.1                |       |
   |       |       |     &lt;sip:proxyP2; cause=302&gt;; index=1.1.1 |       |
   |       |       |       |      |       |       |     |      |       |
   |       |       |       |      |       |       |     |      | INV E |
   |       |       |       |      |       |       |     |      |------&gt;|
   |       |       | History-Info:                                     |
   |       |       |  &lt;sip:proxyP1&gt;; index=1,                          |
   |       |       |  &lt;sip:userB ?privacy=none&gt;; index=1.1,            |
   |       |       |  &lt;sip:proxyP2; cause=302&gt;; index=1.1.1,           |
   |       |       |  &lt;sip:userC ?privacy=history&gt;; index=1.1.1.1,     |
   |       |      &lt;sip:userD; cause=408 ?privacy=none&gt;; index=1.1.1.1.1,
   |       |       |  &lt;sip:userE; cause=404&gt;; index=1.1.1.1.1.1        |
   |       |       |       |      |       |       |     |       |      |
   |       |       |       |      |       |       |     |       |      |

   * Note: The IWF is an interworking function that could be a stand-
   alone equipment not defined in this document (it could be a proxy).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.4.%20%20Additional%20Interworking%20Cases"></a><a class="selflink" href="#section-7.4" name="section-7.4">7.4</a>.  Additional Interworking Cases</span>

   Even if for particular cases in which both headers could coexist, it
   should be the network local policy responsibility to make it work
   together.  Here are described some situations and some
   recommendations on the behavior to follow.

   In the case where there is one network that includes different nodes,
   some of them supporting the Diversion header and other ones
   supporting the History-Info header, there is a problem when any node
   handling a message does not know the next node that will handle the
   message.  This case can occur when the network has new and old nodes,
   the older ones using Diversion header and the more recent History-
   Info header.



<span class="grey">Mohali                        Informational                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   While a network replacement may be occurring, there will be a time
   when both nodes coexist in the network.  If the different nodes are
   being used to support different subscriber types due to different
   node capabilities then the problem is more important.  In this case,
   there is a need to pass both History-Info header and Diversion header
   within the core network.

   These headers need to be equivalent to ensure that, whatever the node
   receiving the message, the correct diversion information is received.
   This requires that whatever the received header, there is a
   requirement to be able to compare the headers and to convert the
   headers.  Depending upon the node capability, it may be possible to
   make assumptions as to how this is handled.

   o  If it is known that the older Diversion header supporting nodes do
      not pass on any received History-Info header, then the
      interworking becomes easier.  If a message is received with only
      Diversion headers, then it has originated from an 'old' node.  The
      equivalent History-Info entries can be created and these can then
      be passed as well as the Diversion header.

   o  If the node creates a new History-Info header for a call
      diversion, then an additional Diversion header must be created.

   o  If the next node is an 'old' node, then the Diversion header will
      be used by that node and the History-Info entries will be removed
      from the message when it is passed on.

   o  If the next node is a new node then the presence of both Diversion
      header and History-Info header means that interworking has already
      occurred and the Diversion and History-Info entries must be
      considered equivalent.

   o  If both nodes pass on both History-Info header and Diversion
      header, but only actively use one, then both types of nodes need
      to perform the interworking and must maintain equivalence between
      the headers.  This will eventually result in the use of Diversion
      header being deprecated when all nodes in the network support
      History-Info header.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Security%20Considerations"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Security Considerations</span>

   The security considerations in [<a href="rfc4244.html" title='"An Extension to the Session Initiation Protocol (SIP) for Request History Information"'>RFC4244</a>] and [<a href="rfc5806.html" title='"Diversion Indication in SIP"'>RFC5806</a>] apply.

   The use of the Diversion header or the History-Info header require
   the application of the requested privacy and integrity asked by each
   diverting user or entity.  Without integrity, the requested privacy
   functions could be downgraded or eliminated, potentially exposing



<span class="grey">Mohali                        Informational                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   identity information.  Without confidentiality, eavesdroppers on the
   network (or any intermediaries between the user and the privacy
   service) could see the very personal information that the user has
   asked the privacy service to obscure.  Unauthorized insertion,
   deletion of modification of those headers, can provide misleading
   information to users and applications.  A SIP entity that can provide
   a redirection reason in a History-Info header or a Diversion header
   should be able to suppress this in accordance with privacy
   requirements of the user concerned.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Acknowledgements"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Acknowledgements</span>

   The editor would like to acknowledge the constructive feedback and
   support provided by Steve Norreys, Jan Van Geel, Martin Dolly,
   Francisco Silva, Guiseppe Sciortino, Cinza Amenta, Christer Holmberg,
   Ian Elz, Jean-Francois Mule, Mary Barnes, Francois Audet, Erick
   Sasaki, Shida Schubert, Joel M. Halpern, Bob Braden, and Robert
   Sparks.  Merci a Lionel Morand, Xavier Marjou, and Philippe Fouquart.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC3261" name="ref-RFC3261">RFC3261</a>]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
               A., Peterson, J., Sparks, R., Handley, M., and E.
               Schooler, "SIP: Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>,
               June 2002.

   [<a id="ref-RFC3323" name="ref-RFC3323">RFC3323</a>]   Peterson, J., "A Privacy Mechanism for the Session
               Initiation Protocol (SIP)", <a href="rfc3323.html">RFC 3323</a>, November 2002.

   [<a id="ref-RFC3326" name="ref-RFC3326">RFC3326</a>]   Schulzrinne, H., Oran, D., and G. Camarillo, "The Reason
               Header Field for the Session Initiation Protocol (SIP)",
               <a href="rfc3326.html">RFC 3326</a>, December 2002.

   [<a id="ref-RFC4244" name="ref-RFC4244">RFC4244</a>]   Barnes, M., Ed., "An Extension to the Session Initiation
               Protocol (SIP) for Request History Information", <a href="rfc4244.html">RFC</a>
               <a href="rfc4244.html">4244</a>, November 2005.

   [<a id="ref-RFC5806" name="ref-RFC5806">RFC5806</a>]   Levy, S. and M. Mohali, Ed., "Diversion Indication in
               SIP", <a href="rfc5806.html">RFC 5806</a>, March 2010.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-RFC4458" name="ref-RFC4458">RFC4458</a>]   Jennings, C., Audet, F., and J. Elwell, "Session
               Initiation Protocol (SIP) URIs for Applications such as
               Voicemail and Interactive Voice Response (IVR)", <a href="rfc4458.html">RFC</a>
               <a href="rfc4458.html">4458</a>, April 2006.



<span class="grey">Mohali                        Informational                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


   [<a id="ref-RFC5234" name="ref-RFC5234">RFC5234</a>]   Crocker, D., Ed., and P. Overell, "Augmented BNF for
               Syntax Specifications: ABNF", STD 68, <a href="rfc5234.html">RFC 5234</a>, January
               2008.

   [<a id="ref-TS_24.604" name="ref-TS_24.604">TS_24.604</a>] 3rd Generation Partnership Project, "Technical
               Specification Group Core Network and Terminals ;
               Communication Diversion (CDIV) using IP Multimedia
               (IM)Core Network (CN) subsystem ; Protocol specification
               (Release 8), 3GPP TS 24.604", December 2008.

   [<a id="ref-TS_29.163" name="ref-TS_29.163">TS_29.163</a>] 3rd Generation Partnership Project, "Technical
               Specification Group Core Network and Terminals ;
               Interworking between the IP Multimedia (IM) Core Network
               (CN) Subsystem and Circuit Switched (CS) networks
               (Release 8)", December 2008.




































<span class="grey">Mohali                        Informational                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Interworking%20between%20Diversion%20Header%20and%20Voicemail%20URI"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Interworking between Diversion Header and Voicemail URI</span>

   Voicemail URI is a mechanism described in <a href="rfc4458.html">RFC 4458</a> to provide a
   simple way to transport only one redirecting user address and the
   reason why the diversion occurred in the R-URI of the INVITE request.
   This mechanism is mainly used for call diversion to a voicemail.

   Diversion header to Voicemail URI:

   Received:
   Diversion: userA-address;reason=user-busy;counter=1;privacy=full

   Sent (Voicemail URI created in the R-URI line of the INVITE):
   sip: voicemail@example.com;target=userA-address;cause=486 SIP/2.0

   Mapping of the Redirection Reason is the same as for History-Info
   header with a default value set to 404.

   If the Diversion header contains more than one Diversion entry, the
   choice of the redirecting user information inserted in the URI is in
   charge of the network local policy.  For example, the choice
   criterion of the redirecting information inserted in the URI could be
   the destination of forwarded INVITE request (whether or not the
   voicemail serves this user).

   Note: This interworking could be done in addition to the interworking
   of the Diversion header into the History-Info header.

   Voicemail URI to Diversion header:

   In case of real voicemail, this way of interworking should not
   happen.  However, if for any reason it occurs, it is recommended to
   do it as following:

   Received:
   INVITE sip: voicemail@example.com;\
   target=sip:+33145454500%40example.com;user=phone;\
   cause=302 SIP/2.0

   Sent in the forwarded INVITE:
   Diversion: sip:+
   33145454500%40example.com;user=phone;reason=unconditional;counter=1









<span class="grey">Mohali                        Informational                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6044.html">RFC 6044</a>           Mapping Diversion and History-Info       October 2010</span>


Author's Address

   Marianne Mohali
   France Telecom Orange
   38-40 rue du General Leclerc
   Issy-Les-Moulineaux Cedex 9  92794
   France

   Phone: +33 1 45 29 45 14
   EMail: marianne.mohali@orange-ftgroup.com









































Mohali                        Informational                    [Page 24]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6044 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:32 GMT --></html>