<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc3856 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:44 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:3856" name="DC.Identifier"/>
<meta content='This document describes the usage of the Session Initiation Protocol
(SIP) for subscriptions and notifications of presence. Presence is
defined as the willingness and ability of a user to communicate with
other users on the network. Historically, presence has been limited to
"on-line" and "off-line" indicators; the notion of presence here is
broader. Subscriptions and notifications of presence are supported by
defining an event package within the general SIP event notification
framework. This protocol is also compliant with the Common Presence
Profile (CPP) framework. [STANDARDS-TRACK]' name="DC.Description.Abstract"/>
<meta content="Jonathan Rosenberg &lt;jdrosen@dynamicsoft.com&gt;" name="DC.Creator"/>
<meta content="August, 2004" name="DC.Date.Issued"/>
<meta content="A Presence Event Package for the Session Initiation Protocol (SIP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 3856 - A Presence Event Package for the Session Initiation Protocol (SIP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc3856.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc3856" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-simple-presence" title="draft-ietf-simple-presence">draft-ietf-simp...</a>] [<a href="https://datatracker.ietf.org/doc/rfc3856" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc3856" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc3856" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=3856">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                       J. Rosenberg
Request for Comments: 3856                                   dynamicsoft
Category: Standards Track                                    August 2004


   <span class="h1">A Presence Event Package for the Session Initiation Protocol (SIP)</span>

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2004).

Abstract

   This document describes the usage of the Session Initiation Protocol
   (SIP) for subscriptions and notifications of presence.  Presence is
   defined as the willingness and ability of a user to communicate with
   other users on the network.  Historically, presence has been limited
   to "on-line" and "off-line" indicators; the notion of presence here
   is broader.  Subscriptions and notifications of presence are
   supported by defining an event package within the general SIP event
   notification framework.  This protocol is also compliant with the
   Common Presence Profile (CPP) framework.

Table of Contents

   <a href="#section-1">1</a>.  Introduction ................................................   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology .................................................   <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Definitions .................................................   <a href="#page-3">3</a>
   <a href="#section-4">4</a>.  Overview of Operation .......................................   <a href="#page-4">4</a>
   <a href="#section-5">5</a>.  Usage of Presence URIs ......................................   <a href="#page-6">6</a>
   <a href="#section-6">6</a>.  Presence Event Package ......................................   <a href="#page-7">7</a>
       <a href="#section-6.1">6.1</a>.  Package Name ..........................................   <a href="#page-8">8</a>
       <a href="#section-6.2">6.2</a>.  Event Package Parameters ..............................   <a href="#page-8">8</a>
       <a href="#section-6.3">6.3</a>.  SUBSCRIBE Bodies ......................................   <a href="#page-8">8</a>
       <a href="#section-6.4">6.4</a>.  Subscription Duration .................................   <a href="#page-9">9</a>
       <a href="#section-6.5">6.5</a>.  NOTIFY Bodies .........................................   <a href="#page-9">9</a>
       <a href="#section-6.6">6.6</a>.  Notifier Processing of SUBSCRIBE Requests .............   <a href="#page-9">9</a>
             <a href="#section-6.6.1">6.6.1</a>. Authentication .................................  <a href="#page-10">10</a>
             <a href="#section-6.6.2">6.6.2</a>. Authorization ..................................  <a href="#page-10">10</a>
       <a href="#section-6.7">6.7</a>.  Notifier Generation of NOTIFY Requests ................  <a href="#page-11">11</a>



<span class="grey">Rosenberg                   Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


       <a href="#section-6.8">6.8</a>.  Subscriber Processing of NOTIFY Requests ..............  <a href="#page-13">13</a>
       <a href="#section-6.9">6.9</a>.  Handling of Forked Requests ...........................  <a href="#page-13">13</a>
       <a href="#section-6.10">6.10</a>. Rate of Notifications .................................  <a href="#page-14">14</a>
       <a href="#section-6.11">6.11</a>. State Agents ..........................................  <a href="#page-14">14</a>
             6.11.1. Aggregation, Authentication, and Authorization.  14
             <a href="#section-6.11.2">6.11.2</a>. Migration .....................................  <a href="#page-15">15</a>
   <a href="#section-7">7</a>.  Learning Presence State .....................................  <a href="#page-16">16</a>
       <a href="#section-7.1">7.1</a>.  Co-location ...........................................  <a href="#page-16">16</a>
       <a href="#section-7.2">7.2</a>.  REGISTER ..............................................  <a href="#page-16">16</a>
       <a href="#section-7.3">7.3</a>.  Uploading Presence Documents ..........................  <a href="#page-17">17</a>
   <a href="#section-8">8</a>.  Example Message Flow ........................................  <a href="#page-17">17</a>
   <a href="#section-9">9</a>.  Security Considerations .....................................  <a href="#page-20">20</a>
       <a href="#section-9.1">9.1</a>.  Confidentiality .......................................  <a href="#page-20">20</a>
       <a href="#section-9.2">9.2</a>.  Message Integrity and Authenticity ....................  <a href="#page-21">21</a>
       <a href="#section-9.3">9.3</a>.  Outbound Authentication ...............................  <a href="#page-22">22</a>
       <a href="#section-9.4">9.4</a>.  Replay Prevention .....................................  <a href="#page-22">22</a>
       <a href="#section-9.5">9.5</a>.  Denial of Service Attacks Against Third Parties .......  <a href="#page-22">22</a>
       <a href="#section-9.6">9.6</a>.  Denial Of Service Attacks Against Servers .............  <a href="#page-23">23</a>
   <a href="#section-10">10</a>. IANA Considerations .........................................  <a href="#page-23">23</a>
   <a href="#section-11">11</a>. Contributors ................................................  <a href="#page-24">24</a>
   <a href="#section-12">12</a>. Acknowledgements ............................................  <a href="#page-25">25</a>
   <a href="#section-13">13</a>. Normative References ........................................  <a href="#page-25">25</a>
   <a href="#section-14">14</a>. Informative References ......................................  <a href="#page-26">26</a>
   <a href="#section-15">15</a>. Author's Address ............................................  <a href="#page-26">26</a>
   <a href="#section-16">16</a>. Full Copyright Statement ....................................  <a href="#page-27">27</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   Presence, also known as presence information, conveys the ability and
   willingness of a user to communicate across a set of devices.  <a href="rfc2778.html">RFC</a>
   <a href="rfc2778.html">2778</a> [<a href="#ref-10" title='"A Model for Presence and Instant Messaging"'>10</a>] defines a model and terminology for describing systems that
   provide presence information.  In that model, a presence service is a
   system that accepts, stores, and distributes presence information to
   interested parties, called watchers.  A presence protocol is a
   protocol for providing a presence service over the Internet or any IP
   network.

   This document proposes the usage of the Session Initiation Protocol
   (SIP) [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>] as a presence protocol.  This is accomplished through a
   concrete instantiation of the general event notification framework
   defined for SIP [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], and as such, makes use of the SUBSCRIBE and
   NOTIFY methods defined there.  Specifically, this document defines an
   event package, as described in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].  SIP is particularly
   well suited as a presence protocol.  SIP location services already
   contain presence information, in the form of registrations.
   Furthermore, SIP networks are capable of routing requests from any
   user on the network to the server that holds the registration state
   for a user.  As this state is a key component of user presence, those



<span class="grey">Rosenberg                   Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   SIP networks can allow SUBSCRIBE requests to be routed to the same
   server.  This means that SIP networks can be reused to establish
   global connectivity for presence subscriptions and notifications.

   This event package is based on the concept of a presence agent, which
   is a new logical entity that is capable of accepting subscriptions,
   storing subscription state, and generating notifications when there
   are changes in presence.  The entity is defined as a logical one,
   since it is generally co-resident with another entity.

   This event package is also compliant with the Common Presence Profile
   (CPP) framework that has been defined in [<a href="#ref-3" title='"Common Profile for Presence (CPP)"'>3</a>].  This allows SIP for
   presence to easily interwork with other presence systems compliant to
   CPP.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology</span>

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
   and "OPTIONAL" are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="#ref-4" title='"Key Words for Use in RFCs to Indicate Requirement Levels"'>4</a>] and
   indicate requirement levels for compliant implementations.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Definitions"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Definitions</span>

   This document uses the terms as defined in <a href="rfc2778.html">RFC 2778</a> [<a href="#ref-10" title='"A Model for Presence and Instant Messaging"'>10</a>].
   Additionally, the following terms are defined and/or additionally
   clarified:

      Presence User Agent (PUA): A Presence User Agent manipulates
         presence information for a presentity.  This manipulation can
         be the side effect of some other action (such as sending a SIP
         REGISTER request to add a new Contact) or can be done
         explicitly through the publication of presence documents.  We
         explicitly allow multiple PUAs per presentity.  This means that
         a user can have many devices (such as a cell phone and Personal
         Digital Assistant (PDA)), each of which is independently
         generating a component of the overall presence information for
         a presentity.  PUAs push data into the presence system, but are
         outside of it, in that they do not receive SUBSCRIBE messages
         or send NOTIFY messages.

      Presence Agent (PA): A presence agent is a SIP user agent which is
         capable of receiving SUBSCRIBE requests, responding to them,
         and generating notifications of changes in presence state.  A
         presence agent must have knowledge of the presence state of a
         presentity.  This means that it must have access to presence
         data manipulated by PUAs for the presentity.  One way to do
         this is by co-locating the PA with the proxy/registrar.



<span class="grey">Rosenberg                   Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


         Another way is to co-locate it with the presence user agent of
         the presentity.  However, these are not the only ways, and this
         specification makes no recommendations about where the PA
         function should be located.  A PA is always addressable with a
         SIP URI that uniquely identifies the presentity (i.e.,
         sip:joe@example.com).  There can be multiple PAs for a
         particular presentity, each of which handles some subset of the
         total subscriptions currently active for the presentity.  A PA
         is also a notifier (defined in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>]) that supports the
         presence event package.

      Presence Server: A presence server is a physical entity that can
         act as either a presence agent or as a proxy server for
         SUBSCRIBE requests.  When acting as a PA, it is aware of the
         presence information of the presentity through some protocol
         means.  When acting as a proxy, the SUBSCRIBE requests are
         proxied to another entity that may act as a PA.

      Edge Presence Server: An edge presence server is a presence agent
         that is co-located with a PUA.  It is aware of the presence
         information of the presentity because it is co-located with the
         entity that manipulates this presence information.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Overview%20of%20Operation"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Overview of Operation</span>

   In this section, we present an overview of the operation of this
   event package.  The overview describes behavior that is documented in
   part here, in part within the SIP event framework [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], and in part in
   the SIP specification [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>], in order to provide clarity on this
   package for readers only casually familiar with those specifications.
   However, the detailed semantics of this package require the reader to
   be familiar with SIP events and the SIP specification itself.

   When an entity, the subscriber, wishes to learn about presence
   information from some user, it creates a SUBSCRIBE request.  This
   request identifies the desired presentity in the Request-URI, using a
   SIP URI, SIPS URI [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>] or a presence (pres) URI [<a href="#ref-3" title='"Common Profile for Presence (CPP)"'>3</a>].  The SUBSCRIBE
   request is carried along SIP proxies as any other SIP request would
   be.  In most cases, it eventually arrives at a presence server, which
   can either generate a response to the request (in which case it acts
   as the presence agent for the presentity), or proxy it on to an edge
   presence server.  If the edge presence server handles the
   subscription, it is acting as the presence agent for the presentity.
   The decision at a presence server about whether to proxy or terminate
   the SUBSCRIBE is a local matter; however, we describe one way to
   effect such a configuration, using REGISTER.





<span class="grey">Rosenberg                   Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   The presence agent (whether in the presence server or edge presence
   server) first authenticates the subscription, then authorizes it.
   The means for authorization are outside the scope of this protocol,
   and we expect that many mechanisms will be used.  If authorized, a
   200 OK response is returned.  If authorization could not be obtained
   at this time, the subscription is considered "pending", and a 202
   response is returned.  In both cases, the PA sends an immediate
   NOTIFY message containing the state of the presentity and of the
   subscription.  The presentity state may be bogus in the case of a
   pending subscription, indicating offline no matter what the actual
   state of the presentity, for example.  This is to protect the privacy
   of the presentity, who may not want to reveal that they have not
   provided authorization for the subscriber.  As the state of the
   presentity changes, the PA generates NOTIFYs containing those state
   changes to all subscribers with authorized subscriptions.  Changes in
   the state of the subscription itself can also trigger NOTIFY
   requests; that state is carried in the Subscription-State header
   field of the NOTIFY, and would typically indicate whether the
   subscription is active or pending.

   The SUBSCRIBE message establishes a "dialog" with the presence agent.
   A dialog is defined in <a href="rfc3261.html">RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>], and it represents the SIP state
   between a pair of entities to facilitate peer-to-peer message
   exchanges.  This state includes the sequence numbers for messages in
   both directions (SUBSCRIBE from the subscriber, NOTIFY from the
   presence agent), in addition to a route set and remote target URI.
   The route set is a list of SIP (or SIPS) URIs which identify SIP
   proxy servers that are to be visited along the path of SUBSCRIBE
   refreshes or NOTIFY requests.  The remote target URI is the SIP or
   SIPS URI that identifies the target of the message - the subscriber,
   in the case of NOTIFY, or the presence agent, in the case of a
   SUBSCRIBE refresh.

   SIP provides a procedure called record-routing that allows for proxy
   servers to request to be on the path of NOTIFY messages and SUBSCRIBE
   refreshes.  This is accomplished by inserting a URI into the
   Record-Route header field in the initial SUBSCRIBE request.

   The subscription persists for a duration that is negotiated as part
   of the initial SUBSCRIBE.  The subscriber will need to refresh the
   subscription before its expiration, if they wish to retain the
   subscription.  This is accomplished by sending a SUBSCRIBE refresh
   within the same dialog established by the initial SUBSCRIBE.  This
   SUBSCRIBE is nearly identical to the initial one, but contains a tag
   in the To header field, a higher CSeq header field value, and
   possibly a set of Route header field values that identify the path of
   proxies the request is to take.




<span class="grey">Rosenberg                   Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   The subscriber can terminate the subscription by sending a SUBSCRIBE,
   within the dialog, with an Expires header field (which indicates
   duration of the subscription) value of zero.  This causes an
   immediate termination of the subscription.  A NOTIFY request is then
   generated by the presence agent with the most recent state.  In fact,
   behavior of the presence agent for handling a SUBSCRIBE request with
   Expires of zero is no different than for any other expiration value;
   pending or authorized SUBSCRIBE requests result in a triggered NOTIFY
   with the current presentity and subscription state.

   The presence agent can terminate the subscription at any time.  To do
   so, it sends a NOTIFY request with a Subscription-State header field
   indicating that the subscription has been terminated.  A reason
   parameter can be supplied which provides the reason.

   It is also possible to fetch the current presence state, resulting in
   a one-time notification containing the current state.  This is
   accomplished by sending a SUBSCRIBE request with an immediate
   expiration.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20Usage%20of%20Presence%20URIs"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  Usage of Presence URIs</span>

   A presentity is identified in the most general way through a presence
   URI [<a href="#ref-3" title='"Common Profile for Presence (CPP)"'>3</a>], which is of the form pres:user@domain.  These URIs are
   resolved to protocol specific URIs, such as the SIP or SIPS URI,
   through domain-specific mapping policies maintained on a server.

   It is very possible that a user will have both a SIP (and/or SIPS)
   URI and a pres URI to identify both themself and other users.  This
   leads to questions about how these URI relate and which are to be
   used.

   In some instances, a user starts with one URI format, such as the
   pres URI, and learns a URI in a different format through some
   protocol means.  As an example, a SUBSCRIBE request sent to a pres
   URI will result in learning a SIP or SIPS URI for the presentity from
   the Contact header field of the 200 OK to the SUBSCRIBE request.  As
   another example, a DNS mechanism might be defined that would allow
   lookup of a pres URI to obtain a SIP or SIPS URI.  In cases where one
   URI is learned from another through protocol means, those means will
   often provide some kind of scoping that limit the lifetime of the
   learned URI.  DNS, for example, provides a TTL which would limit the
   scope of the URI.  These scopes are very useful to avoid stale or
   conflicting URIs for identifying the same resource.  To ensure that a
   user can always determine whether a learned URI is still valid, it is
   RECOMMENDED that systems which provide lookup services for presence
   URIs have some kind of scoping mechanism.




<span class="grey">Rosenberg                   Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   If a subscriber is only aware of the protocol-independent pres URI
   for a presentity, it follows the procedures defined in [<a href="#ref-5" title='"Address Resolution for Instant Messaging and Presence"'>5</a>].  These
   procedures will result in the placement of the pres URI in the
   Request-URI of the SIP request, followed by the usage of the DNS
   procedures defined in [<a href="#ref-5" title='"Address Resolution for Instant Messaging and Presence"'>5</a>] to determine the host to send the SIP
   request to.  Of course, a local outbound proxy may alternatively be
   used, as specified in <a href="rfc3261.html">RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].  If the subscriber is aware of
   both the protocol-independent pres URI and the SIP or SIPS URI for
   the same presentity, and both are valid (as discussed above) it
   SHOULD use the pres URI format.  Of course, if the subscriber only
   knows the SIP URI for the presentity, that URI is used, and standard
   <a href="rfc3261.html">RFC 3261</a> processing will occur. When the pres URI is used, any
   proxies along the path of the SUBSCRIBE request which do not
   understand the URI scheme will reject the request.  As such, it is
   expected that many systems will be initially deployed that only
   provide users with a SIP URI.

   SUBSCRIBE messages also contain logical identifiers that define the
   originator and recipient of the subscription (the To and From header
   fields).  These headers can take either a pres or SIP URI.  When the
   subscriber is aware of both a pres and SIP URI for its own identity,
   it SHOULD use the pres URI in the From header field.  Similarly, when
   the subscriber is aware of both a pres and a SIP URI for the desired
   presentity, it SHOULD use the pres URI in the To header field.

   The usage of the pres URI instead of the SIP URI within the SIP
   message supports interoperability through gateways to other
   CPP-compliant systems.  It provides a protocol-independent form of
   identification which can be passed between systems.  Without such an
   identity, gateways would be forced to map SIP URIs into the
   addressing format of other protocols.  Generally, this is done by
   converting the SIP URI to the form &lt;foreign-protocol-scheme&gt;:&lt;encoded
   SIP URI&gt;@&lt;gateway&gt;.  This is commonly done in email systems, and has
   many known problems.  The usage of the pres URI is a SHOULD, and not
   a MUST, to allow for cases where it is known that there are no
   gateways present, or where the usage of the pres URI will cause
   interoperability problems with SIP components that do not support the
   pres URI.

   The Contact, Record-Route and Route fields do not identify logical
   entities, but rather concrete ones used for SIP messaging.  SIP [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>]
   specifies rules for their construction.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Presence%20Event%20Package"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Presence Event Package</span>

   The SIP event framework [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] defines a SIP extension for subscribing
   to, and receiving notifications of, events.  It leaves the definition
   of many aspects of these events to concrete extensions, known as



<span class="grey">Rosenberg                   Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   event packages.  This document qualifies as an event package.  This
   section fills in the information required for all event packages by
   <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Package%20Name"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Package Name</span>

   The name of this package is "presence".  As specified in <a href="rfc3265.html">RFC 3265</a>
   [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], this value appears in the Event header field present in
   SUBSCRIBE and NOTIFY requests.

   Example:

   Event: presence

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Event%20Package%20Parameters"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Event Package Parameters</span>

   The SIP event framework allows event packages to define additional
   parameters carried in the Event header field.  This package,
   presence, does not define any additional parameters.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20SUBSCRIBE%20Bodies"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  SUBSCRIBE Bodies</span>

   A SUBSCRIBE request MAY contain a body.  The purpose of the body
   depends on its type.  Subscriptions will normally not contain bodies.

   The Request-URI, which identifies the presentity, combined with the
   event package name, is sufficient for presence.

   One type of body that can be included in a SUBSCRIBE request is a
   filter document.  These filters request that only certain presence
   events generate notifications, or would ask for a restriction on the
   set of data returned in NOTIFY requests.  For example, a presence
   filter might specify that the notifications should only be generated
   when the status of the user's instant inbox [<a href="#ref-10" title='"A Model for Presence and Instant Messaging"'>10</a>] changes.  It might
   also say that the content of these notifications should only contain
   the status of the instant inbox.  Filter documents are not specified
   in this document, and at the time of writing, are expected to be the
   subject of future standardization activity.

   Honoring of these filters is at the policy discretion of the PA.

   If the SUBSCRIBE request does not contain a filter, this tells the PA
   that no filter is to be applied.  The PA SHOULD send NOTIFY requests
   at the discretion of its own policy.







<span class="grey">Rosenberg                   Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.4.%20%20Subscription%20Duration"></a><a class="selflink" href="#section-6.4" name="section-6.4">6.4</a>.  Subscription Duration</span>

   User presence changes as a result of many events.  Some examples are:

         o Turning on and off of a cell phone

         o Modifying the registration from a softphone

         o Changing the status on an instant messaging tool

   These events are usually triggered by human intervention, and occur
   with a frequency on the order of seconds to hours.  As such,
   subscriptions should have an expiration in the middle of this range,
   which is roughly one hour.  Therefore, the default expiration time
   for subscriptions within this package is 3600 seconds.  As per <a href="rfc3265.html">RFC</a>
   <a href="rfc3265.html">3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], the subscriber MAY specify an alternate expiration in the
   Expires header field.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.5.%20%20NOTIFY%20Bodies"></a><a class="selflink" href="#section-6.5" name="section-6.5">6.5</a>.  NOTIFY Bodies</span>

   As described in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], the NOTIFY message will contain bodies
   that describe the state of the subscribed resource.  This body is in
   a format listed in the Accept header field of the SUBSCRIBE, or a
   package-specific default if the Accept header field was omitted from
   the SUBSCRIBE.

   In this event package, the body of the notification contains a
   presence document.  This document describes the presence of the
   presentity that was subscribed to.  All subscribers and notifiers
   MUST support the "application/pidf+xml" presence data format
   described in [<a href="#ref-6" title='"Presence Information Data Format (PIDF)"'>6</a>].  The subscribe request MAY contain an Accept header
   field.  If no such header field is present, it has a default value of
   "application/pidf+xml".  If the header field is present, it MUST
   include "application/pidf+xml", and MAY include any other types
   capable of representing user presence.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.6.%20%20Notifier%20Processing%20of%20SUBSCRIBE%20Requests"></a><a class="selflink" href="#section-6.6" name="section-6.6">6.6</a>.  Notifier Processing of SUBSCRIBE Requests</span>

   Based on the proxy routing procedures defined in the SIP
   specification, the SUBSCRIBE request will arrive at a presence agent
   (PA).  This subsection defines package-specific processing at the PA
   of a SUBSCRIBE request.  General processing rules for requests are
   covered in <a href="rfc3261.html#section-8.2">Section 8.2 of RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>], in addition to general
   SUBSCRIBE processing in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].







<span class="grey">Rosenberg                   Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   User presence is highly sensitive information.  Because the
   implications of divulging presence information can be severe, strong
   requirements are imposed on the PA regarding subscription processing,
   especially related to authentication and authorization.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.6.1.%20%20Authentication"></a><a class="selflink" href="#section-6.6.1" name="section-6.6.1">6.6.1</a>.  Authentication</span>

   A presence agent MUST authenticate all subscription requests.  This
   authentication can be done using any of the mechanisms defined in <a href="rfc3261.html">RFC</a>
   <a href="rfc3261.html">3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].  Note that digest is mandatory to implement, as specified
   in <a href="rfc3261.html">RFC 3261</a>.

   In single-domain systems, where the subscribers all have shared
   secrets with the PA, the combination of digest authentication over
   Transport Layer Security (TLS) [<a href="#ref-7" title='"The TLS Protocol Version 1.0"'>7</a>] provides a secure and workable
   solution for authentication.  This use case is described in <a href="rfc3261.html#section-26.3.2.1">Section</a>
   <a href="rfc3261.html#section-26.3.2.1">26.3.2.1 of RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].

   In inter-domain scenarios, establishing an authenticated identity of
   the subscriber is harder.  It is anticipated that authentication will
   often be established through transitive trust.  SIP mechanisms for
   network asserted identity can be applied to establish the identity of
   the subscriber [<a href="#ref-11" title='"Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)"'>11</a>].

   A presentity MAY choose to represent itself with a SIPS URI.  By
   "represent itself", it means that the user represented by the
   presentity hands out, on business cards, web pages, and so on, a SIPS
   URI for their presentity.  The semantics associated with this URI, as
   described in <a href="rfc3261.html">RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>], require TLS usage on each hop between the
   subscriber and the server in the domain of the URI.  This provides
   additional assurances (but no absolute guarantees) that identity has
   been verified at each hop.

   Another mechanism for authentication is S/MIME.  Its usage with SIP
   is described fully in <a href="rfc3261.html">RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].  It provides an end-to-end
   authentication mechanism that can be used for a PA to establish the
   identity of the subscriber.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.6.2.%20%20Authorization"></a><a class="selflink" href="#section-6.6.2" name="section-6.6.2">6.6.2</a>.  Authorization</span>

   Once authenticated, the PA makes an authorization decision.  A PA
   MUST NOT accept a subscription unless authorization has been provided
   by the presentity.  The means by which authorization are provided are
   outside the scope of this document.  Authorization may have been
   provided ahead of time through access lists, perhaps specified in a
   web page.  Authorization may have been provided by means of uploading
   of some kind of standardized access control list document.  Back end
   authorization servers, such as a DIAMETER [<a href="#ref-12" title='"Diameter Base Protocol"'>12</a>] server, can also be



<span class="grey">Rosenberg                   Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   used.  It is also useful to be able to query the user for
   authorization following the receipt of a subscription request for
   which no authorization information has been provided.  The
   "watcherinfo" event template package for SIP [<a href="#ref-8" title='"A Watcher Information Event Template-Package for the Session Initiation Protocol (SIP)"'>8</a>] defines a means by
   which a presentity can become aware that a user has attempted to
   subscribe to it, so that it can then provide an authorization
   decision.

   Authorization decisions can be very complex.  Ultimately, all
   authorization decisions can be mapped into one of three states:
   rejected, successful, and pending.  Any subscription for which the
   client is authorized to receive information about some subset of
   presence state at some points in time is a successful subscription.
   Any subscription for which the client will never receive any
   information about any subset of the presence state is a rejected
   subscription.  Any subscription for which it is not yet known whether
   it is successful or rejected is pending.  Generally, a pending
   subscription occurs when the server cannot obtain authorization at
   the time of the subscription, but may be able to do so at a later
   time, perhaps when the presentity becomes available.

   The appropriate response codes for conveying a successful, rejected,
   or pending subscription (200, 403 or 603, and 202, respectively) are
   described in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].

   If the resource is not in a meaningful state, <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] allows the
   body of the initial NOTIFY to be empty.  In the case of presence,
   that NOTIFY MAY contain a presence document.  This document would
   indicate whatever presence state the subscriber has been authorized
   to see; it is interpreted by the subscriber as the current presence
   state of the presentity.  For pending subscriptions, the state of the
   presentity SHOULD include some kind of textual note that indicates a
   pending status.

   Polite blocking, as described in [<a href="#ref-13" title='"Instant Messaging / Presence Protocol Requirements"'>13</a>], is possible by generating a
   200 OK to the subscription even though it has been rejected (or
   marked pending).  Of course, an immediate NOTIFY will still be sent.
   The contents of the presence document in such a NOTIFY are at the
   discretion of the implementor, but SHOULD be constructed in such a
   way as to not reveal to the subscriber that their request has
   actually been blocked.  Typically, this is done by indicating
   "offline" or equivalent status for a single contact address.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.7.%20%20Notifier%20Generation%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-6.7" name="section-6.7">6.7</a>.  Notifier Generation of NOTIFY Requests</span>

   <a href="rfc3265.html">RFC 3265</a> details the formatting and structure of NOTIFY messages.
   However, packages are mandated to provide detailed information on
   when to send a NOTIFY, how to compute the state of the resource, how



<span class="grey">Rosenberg                   Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   to generate neutral or fake state information, and whether state
   information is complete or partial.  This section describes those
   details for the presence event package.

   A PA MAY send a NOTIFY at any time.  Typically, it will send one when
   the state of the presentity changes.  The NOTIFY request MAY contain
   a body indicating the state of the presentity.  The times at which
   the NOTIFY is sent for a particular subscriber, and the contents of
   the body within that notification, are subject to any rules specified
   by the authorization policy that governs the subscription.  This
   protocol in no way limits the scope of such policies.  As a baseline,
   a reasonable policy is to generate notifications when the state of
   any of the presence tuples changes.  These notifications would
   contain the complete and current presence state of the presentity as
   known to the presence agent.  Future extensions can be defined that
   allow a subscriber to request that the notifications contain changes
   in presence information only, rather than complete state.

   In the case of a pending subscription, when final authorization is
   determined, a NOTIFY can be sent.  If the result of the authorization
   decision was success, a NOTIFY SHOULD be sent and SHOULD contain a
   presence document with the current state of the presentity.  If the
   subscription is rejected, a NOTIFY MAY be sent.  As described in <a href="rfc3265.html">RFC</a>
   <a href="rfc3265.html">3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], the Subscription-State header field indicates the state of
   the subscription.

   The body of the NOTIFY MUST be sent using one of the types listed in
   the Accept header field in the most recent SUBSCRIBE request, or
   using the type "application/pidf+xml" if no Accept header field was
   present.

   The means by which the PA learns the state of the presentity are also
   outside the scope of this recommendation.  Registrations can provide
   a component of the presentity state.  However, the means by which a
   PA uses registrations to construct a presence document are an
   implementation choice.  If a PUA wishes to explicitly inform the
   presence agent of its presence state, it should explicitly publish
   the presence document (or its piece of it) rather than attempting to
   manipulate their registrations to achieve the desired result.

   For reasons of privacy, it will frequently be necessary to encrypt
   the contents of the notifications.  This can be accomplished using
   S/MIME.  The encryption can be performed using the key of the
   subscriber as identified in the From field of the SUBSCRIBE request.
   Similarly, integrity of the notifications is important to
   subscribers.  As such, the contents of the notifications MAY provide
   authentication and message integrity using S/MIME.  Since the NOTIFY
   is generated by the presence server, which may not have access to the



<span class="grey">Rosenberg                   Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   key of the user represented by the presentity, it will frequently be
   the case that the NOTIFY is signed by a third party.  It is
   RECOMMENDED that the signature be by an authority over the domain of
   the presentity.  In other words, for a user pres:user@example.com,
   the signator of the NOTIFY SHOULD be the authority for example.com.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.8.%20%20Subscriber%20Processing%20of%20NOTIFY%20Requests"></a><a class="selflink" href="#section-6.8" name="section-6.8">6.8</a>.  Subscriber Processing of NOTIFY Requests</span>

   <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] leaves it to event packages to describe the process
   followed by the subscriber upon receipt of a NOTIFY request,
   including any logic required to form a coherent resource state.

   In this specification, each NOTIFY contains either no presence
   document, or a document representing the complete and coherent state
   of the presentity.  Within a dialog, the presence document in the
   NOTIFY request with the highest CSeq header field value is the
   current one.  When no document is present in that NOTIFY, the
   presence document present in the NOTIFY with the next highest CSeq
   value is used.  Extensions which specify the use of partial state for
   presentities will need to dictate how coherent state is achieved.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.9.%20%20Handling%20of%20Forked%20Requests"></a><a class="selflink" href="#section-6.9" name="section-6.9">6.9</a>.  Handling of Forked Requests</span>

   <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] requires each package to describe handling of forked
   SUBSCRIBE requests.

   This specification only allows a single dialog to be constructed as a
   result of emitting an initial SUBSCRIBE request.  This guarantees
   that only a single PA is generating notifications for a particular
   subscription to a particular presentity.  The result of this is that
   a presentity can have multiple PAs active, but these should be
   homogeneous, so that each can generate the same set of notifications
   for the presentity.  Supporting heterogeneous PAs, each of which
   generates notifications for a subset of the presence data, is complex
   and difficult to manage.  Doing so would require the subscriber to
   act as the aggregator for presence data.  This aggregation function
   can only reasonably be performed by agents representing the
   presentity.  Therefore, if aggregation is needed, it MUST be done in
   a PA representing the presentity.

   <a href="rfc3265.html#section-4.4.9">Section 4.4.9 of RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] describes the processing that is
   required to guarantee the creation of a single dialog in response to
   a SUBSCRIBE request.








<span class="grey">Rosenberg                   Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.10.%20%20Rate%20of%20Notifications"></a><a class="selflink" href="#section-6.10" name="section-6.10">6.10</a>.  Rate of Notifications</span>

   <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] requires each package to specify the maximum rate at
   which notifications can be sent.

   A PA SHOULD NOT generate notifications for a single presentity at a
   rate of more than once every five seconds.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.11.%20%20State%20Agents"></a><a class="selflink" href="#section-6.11" name="section-6.11">6.11</a>.  State Agents</span>

   <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>] requires each package to consider the role of state
   agents in the package, and if they are used, to specify how
   authentication and authorization are done.

   State agents are core to this package.  Whenever the PA is not
   co-located with the PUA for the presentity, the PA is acting as a
   state agent.  It collects presence state from the PUA, and aggregates
   it into a presence document.  Because there can be multiple PUA, a
   centralized state agent is needed to perform this aggregation.  That
   is why state agents are fundamental to presence.  Indeed, they have a
   specific term that describes them - a presence server.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.11.1.%20%20Aggregation%2C%20Authentication%2C%20and%20Authorization"></a><a class="selflink" href="#section-6.11.1" name="section-6.11.1">6.11.1</a>.  Aggregation, Authentication, and Authorization</span>

   The means by which aggregation is done in the state agent is purely a
   matter of policy.  The policy will typically combine the desires of
   the presentity along with the desires of the provider.  This document
   in no way restricts the set of policies which may be applied.

   However, there is clearly a need for the state agent to have access
   to the state of the presentity.  This state is manipulated by the
   PUA.  One way in which the state agent can obtain this state is to
   subscribe to it.  As a result, if there were 5 PUA manipulating
   presence state for a single presentity, the state agent would
   generate 5 subscriptions, one to each PUA.  For this mechanism to be
   effective, all PUA SHOULD be capable of acting as a PA for the state
   that they manipulate, and that they authorize subscriptions that can
   be authenticated as coming from the domain of the presentity.

   The usage of state agents does not significantly alter the way in
   which authentication is done by the PA.  Any of the SIP
   authentication mechanisms can be used by a state agent.  However,
   digest authentication will require the state agent to be aware of the
   shared secret between the presentity and the subscriber.  This will
   require some means to securely transfer the shared secrets from the
   presentity to the state agent.





<span class="grey">Rosenberg                   Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   The usage of state agents does, however, have a significant impact on
   authorization.  As stated in <a href="#section-6.6">Section 6.6</a>, a PA is required to
   authorize all subscriptions.  If no explicit authorization policy has
   been defined, the PA will need to query the user for authorization.
   In a presence edge server (where the PUA is co-located with the PUA),
   this is trivially accomplished.  However, when state agents are used
   (i.e., a presence server), a means is needed to alert the user that
   an authorization decision is required.  This is the reason for the
   watcherinfo event template-package [<a href="#ref-8" title='"A Watcher Information Event Template-Package for the Session Initiation Protocol (SIP)"'>8</a>].  All state agents SHOULD
   support the watcherinfo template-package.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/6.11.2.%20%20Migration"></a><a class="selflink" href="#section-6.11.2" name="section-6.11.2">6.11.2</a>.  Migration</span>

   On occasion, it makes sense for the PA function to migrate from one
   server to another.  For example, for reasons of scale, the PA
   function may reside in the presence server when the PUA is not
   running, but when the PUA connects to the network, the PA migrates
   subscriptions to it in order to reduce state in the network.  The
   mechanism for accomplishing the migration is described in <a href="rfc3265.html#section-3.3.5">Section</a>
   <a href="rfc3265.html#section-3.3.5">3.3.5 of RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].  However, packages need to define under what
   conditions such a migration would take place.

   A PA MAY choose to migrate subscriptions at any time, through
   configuration, or through dynamic means.  The REGISTER request
   provides one dynamic means for a presence server to discover that the
   function can migrate to a PUA.  Specifically, if a PUA wishes to
   indicate support for the PA function, it SHOULD use the callee
   capabilities specification [<a href="#ref-9" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>9</a>] to indicate that it supports the
   SUBSCRIBE request method and the presence event package.  The
   combination of these two define a PA.  Of course, a presence server
   can always attempt a migration without these explicit hints.  If it
   fails with either a 405 or 489 response code, the server knows that
   the PUA does not support the PA function.  In this case, the server
   itself will need to act as a PA for that subscription request.  Once
   such a failure has occurred, the server SHOULD NOT attempt further
   migrations to that PUA for the duration of its registration.
   However, to avoid the extra traffic generated by these failed
   requests, a presence server SHOULD support the callee capabilities
   extension.

   Furthermore, indication of support for the SUBSCRIBE request and the
   presence event package is not sufficient for migration of
   subscriptions.  A PA SHOULD NOT migrate the subscription if it is
   composing aggregated presence documents received from multiple PUA.







<span class="grey">Rosenberg                   Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Learning%20Presence%20State"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Learning Presence State</span>

   Presence information can be obtained by the PA in many ways.  No
   specific mechanism is mandated by this specification.  This section
   overviews some of the options, for informational purposes only.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.1.%20%20Co-location"></a><a class="selflink" href="#section-7.1" name="section-7.1">7.1</a>.  Co-location</span>

   When the PA function is co-located with the PUA, presence is known
   directly by the PA.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.2.%20%20REGISTER"></a><a class="selflink" href="#section-7.2" name="section-7.2">7.2</a>.  REGISTER</span>

   A UA uses the SIP REGISTER method to inform the SIP network of its
   current communications addresses (i.e., Contact addresses).  Multiple
   UA can independently register Contact addresses for the same
   address-of-record.  This registration state represents an important
   piece of the overall presence information for a presentity.  It is an
   indication of basic reachability for communications.

   Usage of REGISTER information to construct presence is only possible
   if the PA has access to the registration database, and can be
   informed of changes to that database.  One way to accomplish that is
   to co-locate the PA with the registrar.

   The means by which registration state is converted into presence
   state is a matter of local policy, and beyond the scope of this
   specification.  However, some general guidelines can be provided.
   The address-of-record in the registration (the To header field)
   identifies the presentity.  Each registered Contact header field
   identifies a point of communications for that presentity, which can
   be modeled using a tuple.  Note that the contact address in the tuple
   need not be the same as the registered contact address.  Using an
   address-of-record instead allows subsequent communications from a
   watcher to pass through proxies.  This is useful for policy
   processing on behalf of the presentity and the provider.

   A PUA that uses registrations to manipulate presence state SHOULD
   make use of the SIP callee capabilities extension [<a href="#ref-9" title='"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)"'>9</a>].  This allows
   the PUA to provide the PA with richer information about itself.  For
   example, the presence of the methods parameter listing the method
   "MESSAGE" indicates support for instant messaging.

   The q values from the Contact header field [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>] can be used to
   establish relative priorities amongst the various communications
   addresses in the Contact header fields.





<span class="grey">Rosenberg                   Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   The usage of registrations to obtain presence information increases
   the requirements for authenticity and integrity of registrations.
   Therefore, REGISTER requests used by presence user agents MUST be
   authenticated.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/7.3.%20%20Uploading%20Presence%20Documents"></a><a class="selflink" href="#section-7.3" name="section-7.3">7.3</a>.  Uploading Presence Documents</span>

   If a means exists to upload presence documents from PUA to the PA,
   the PA can act as an aggregator and redistributor of those documents.
   The PA, in this case, would take the presence documents received from
   each PUA for the same presentity, and merge the tuples across all of
   those PUA into a single presence document.  Typically, this
   aggregation would be accomplished through administrator or user
   defined policies about how the aggregation should be done.

   The specific means by which a presence document is uploaded to a
   presence agent are outside the scope of this specification.  When a
   PUA wishes to have direct manipulation of the presence that is
   distributed to subscribers, direct uploading of presence documents is
   RECOMMENDED.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Example%20Message%20Flow"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Example Message Flow</span>

   This message flow illustrates how the presence server can be
   responsible for sending notifications for a presentity.  This flow
   assumes that the watcher has previously been authorized to subscribe
   to this resource at the server.

   In this flow, the PUA informs the server about the updated presence
   information through some non-SIP means.

   When the value of the Content-Length header field is "..." this means
   that the value should be whatever the computed length of the body is.


















<span class="grey">Rosenberg                   Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   Watcher             Server                 PUA
      | F1 SUBSCRIBE      |                    |
      |------------------&gt;|                    |
      | F2 200 OK         |                    |
      |&lt;------------------|                    |
      | F3 NOTIFY         |                    |
      |&lt;------------------|                    |
      | F4 200 OK         |                    |
      |------------------&gt;|                    |
      |                   |                    |
      |                   |   Update presence  |
      |                   |&lt;------------------ |
      |                   |                    |
      | F5 NOTIFY         |                    |
      |&lt;------------------|                    |
      | F6 200 OK         |                    |
      |------------------&gt;|                    |


   Message Details

   F1 SUBSCRIBE   watcher-&gt;example.com server

      SUBSCRIBE sip:resource@example.com SIP/2.0
      Via: SIP/2.0/TCP watcherhost.example.com;branch=z9hG4bKnashds7
      To: &lt;sip:resource@example.com&gt;
      From: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      CSeq: 17766 SUBSCRIBE
      Max-Forwards: 70
      Event: presence
      Accept: application/pidf+xml
      Contact: &lt;sip:user@watcherhost.example.com&gt;
      Expires: 600
      Content-Length: 0
















<span class="grey">Rosenberg                   Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   F2 200 OK   example.com server-&gt;watcher

      SIP/2.0 200 OK
      Via: SIP/2.0/TCP watcherhost.example.com;branch=z9hG4bKnashds7
        ;received=192.0.2.1
      To: &lt;sip:resource@example.com&gt;;tag=ffd2
      From: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      CSeq: 17766 SUBSCRIBE
      Expires: 600
      Contact: sip:server.example.com
      Content-Length: 0

   F3 NOTIFY  example.com server-&gt; watcher

      NOTIFY sip:user@watcherhost.example.com SIP/2.0
      Via: SIP/2.0/TCP server.example.com;branch=z9hG4bKna998sk
      From: &lt;sip:resource@example.com&gt;;tag=ffd2
      To: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      Event: presence
      Subscription-State: active;expires=599
      Max-Forwards: 70
      CSeq: 8775 NOTIFY
      Contact: sip:server.example.com
      Content-Type: application/pidf+xml
      Content-Length: ...

      [PIDF Document]

   F4 200 OK watcher-&gt; example.com server

      SIP/2.0 200 OK
      Via: SIP/2.0/TCP server.example.com;branch=z9hG4bKna998sk
        ;received=192.0.2.2
      From: &lt;sip:resource@example.com&gt;;tag=ffd2
      To: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      CSeq: 8775 NOTIFY
      Content-Length: 0











<span class="grey">Rosenberg                   Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   F5 NOTIFY example.com server -&gt; watcher

      NOTIFY sip:user@watcherhost.example.com SIP/2.0
      Via: SIP/2.0/TCP server.example.com;branch=z9hG4bKna998sl
      From: &lt;sip:resource@example.com&gt;;tag=ffd2
      To: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      CSeq: 8776 NOTIFY
      Event: presence
      Subscription-State: active;expires=543
      Max-Forwards: 70
      Contact: sip:server.example.com
      Content-Type: application/pidf+xml
      Content-Length: ...

      [New PIDF Document]

   F6 200 OK

      SIP/2.0 200 OK
      Via: SIP/2.0/TCP server.example.com;branch=z9hG4bKna998sl
       ;received=192.0.2.2
      From: &lt;sip:resource@example.com&gt;;tag=ffd2
      To: &lt;sip:user@example.com&gt;;tag=xfg9
      Call-ID: 2010@watcherhost.example.com
      CSeq: 8776 NOTIFY
      Content-Length: 0

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   There are numerous security considerations for presence.  <a href="rfc2779.html">RFC 2779</a>
   [<a href="#ref-13" title='"Instant Messaging / Presence Protocol Requirements"'>13</a>] outlines many of them, and they are discussed above.  This
   section considers them issue by issue.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Confidentiality"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Confidentiality</span>

   Confidentiality encompasses many aspects of a presence system:

      o  Subscribers may not want to reveal the fact that they have
         subscribed to certain users

      o  Users may not want to reveal that they have accepted
         subscriptions from certain users

      o  Notifications (and fetch results) may contain sensitive data
         which should not be revealed to anyone but the subscriber





<span class="grey">Rosenberg                   Standards Track                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   Confidentiality is provided through a combination of hop-by-hop
   encryption and end-to-end encryption.  The hop-by-hop mechanisms
   provide scalable confidentiality services, disable attacks involving
   traffic analysis, and hide all aspects of presence messages.
   However, they operate based on transitivity of trust, and they cause
   message content to be revealed to proxies.  The end-to-end mechanisms
   do not require transitivity of trust, and reveal information only to
   the desired recipient.  However, end-to-end encryption cannot hide
   all information, and is susceptible to traffic analysis.  Strong
   end-to-end authentication and encryption can be done using public
   keys, and end-to-end encryption can be done using private keys [<a href="#ref-14" title='"Password-Based Encryption for CMS"'>14</a>].
   Both hop-by-hop and end-to-end mechanisms will likely be needed for
   complete privacy services.

   SIP allows any hop by hop encryption scheme, but TLS is mandatory to
   implement for servers.  Therefore, it is RECOMMENDED that TLS [<a href="#ref-7" title='"The TLS Protocol Version 1.0"'>7</a>] be
   used between elements to provide this function.  The details for
   usage of TLS for server-to-server and client-to-server security are
   detailed in <a href="rfc3261.html#section-26.3.2">Section 26.3.2 of RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].

   SIP encryption, using S/MIME, MAY be used end-to-end for the
   transmission of both SUBSCRIBE and NOTIFY requests.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Message%20Integrity%20and%20Authenticity"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Message Integrity and Authenticity</span>

   It is important for the message recipient to ensure that the message
   contents are actually what was sent by the originator, and that the
   recipient of the message be able to determine who the originator
   really is.  This applies to both requests and responses of SUBSCRIBE
   and NOTIFY.  NOTIFY requests are particularly important.  Without
   authentication and integrity, presence documents could be forged or
   modified, fooling the watcher into believing incorrect presence
   information.

   <a href="rfc3261.html">RFC 3261</a> provides many mechanisms to provide these features.  In
   order for the PA to authenticate the watcher, it MAY use HTTP Digest
   (<a href="rfc3261.html#section-22">Section 22 of RFC 3261</a>).  As a result, all watchers MUST support
   HTTP Digest.  This is a redundant requirement, however, since all SIP
   user agents are mandated to support it by <a href="rfc3261.html">RFC 3261</a>.  To provide
   authenticity and integrity services, a watcher MAY use the SIPS
   scheme when subscribing to the presentity.  To support this, all PA
   MUST support TLS and SIPS as if they were a proxy (see <a href="rfc3261.html#section-26.3.1">Section 26.3.1
   of RFC 3261</a>).

   Furthermore, SMIME MAY be used for integrity and authenticity of
   SUBSCRIBE and NOTIFY requests.  This is described in <a href="rfc3261.html#section-23">Section 23 of
   RFC 3261</a>.




<span class="grey">Rosenberg                   Standards Track                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Outbound%20Authentication"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Outbound Authentication</span>

   When local proxies are used for transmission of outbound messages,
   proxy authentication is RECOMMENDED.  This is useful to verify the
   identity of the originator, and prevent spoofing and spamming at the
   originating network.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Replay%20Prevention"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Replay Prevention</span>

   Replay attacks can be used by an attacker to fool a watcher into
   believing an outdated presence state for a presentity.  For example,
   a document describing a presentity as being "offline" can be
   replayed, fooling watchers into thinking that the user is never
   online.  This may effectively block communications with the
   presentity.

   SIP S/MIME can provide message integrity and authentication over SIP
   request bodies.  Watchers and PAs MAY implement S/MIME signatures to
   prevent these replay attacks.  When it is used for that purpose, the
   presence document carried in the NOTIFY request MUST contain a
   timestamp.  In the case of PIDF, this is accomplished using the
   timestamp element, as described in Section 6 of [<a href="#ref-6" title='"Presence Information Data Format (PIDF)"'>6</a>].  Tuples whose
   timestamp is older than the timestamp of the most recently received
   presence document SHOULD be considered stale, and discarded.

   Finally, HTTP digest authentication (which MUST be implemented by
   watchers and PAs) MAY be used to prevent replay attacks, when there
   is a shared secret between the PA and the watcher.  In such a case,
   the watcher can challenge the NOTIFY requests with the auth-int
   quality of protection.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.5.%20%20Denial%20of%20Service%20Attacks%20Against%20Third%20Parties"></a><a class="selflink" href="#section-9.5" name="section-9.5">9.5</a>.  Denial of Service Attacks Against Third Parties</span>

   Denial of Service (DOS) attacks are a critical problem for an open,
   inter-domain, presence protocol.  Unfortunately, presence is a good
   candidate for Distributed DoS (DDOS) attacks because of its
   amplification properties.  A single SUBSCRIBE message could generate
   a nearly unending stream of notifications, so long as a suitably
   dynamic source of presence data can be found.  Thus, a simple way to
   launch an attack against a target is to send subscriptions to a large
   number of users, and in the Contact header field (which is where
   notifications are sent), place the address of the target.  <a href="rfc3265.html">RFC 3265</a>
   provides some mechanisms to mitigate these attacks [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].  If a NOTIFY
   is not acknowledged or was not wanted, the subscription that
   generated it is removed.  This eliminates the amplification
   properties of providing false Contact addresses.





<span class="grey">Rosenberg                   Standards Track                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   Authentication and authorization at the PA can also prevent these
   attacks.  Typically, authorization policy will not allow
   subscriptions from unknown watchers.  If the attacks are launched
   from watchers unknown to the presentity (a common case), the attacks
   are mitigated.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.6.%20%20Denial%20Of%20Service%20Attacks%20Against%20Servers"></a><a class="selflink" href="#section-9.6" name="section-9.6">9.6</a>.  Denial Of Service Attacks Against Servers</span>

   Denial of service attacks can also be launched against a presence
   agent itself, in order to disrupt service to a community of users.
   SIP itself, along with <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>], describes several mechanisms to
   mitigate these attacks.

   A server can prevent SYN-attack style attacks through a four-way
   handshake using digest authentication [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].  Even if the server does
   not have a shared secret with the client, it can verify the source IP
   address of the request using the "anonymous" user mechanism described
   in <a href="rfc3261.html#section-22.1">Section 22.1 of RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>].  SIP also allows a server to
   instruct a client to back-off from sending it requests, using the 503
   response code (<a href="rfc3261.html#section-21.5.4">Section 21.5.4 of RFC 3261</a> [<a href="#ref-1" title='"SIP: Session Initiation Protocol"'>1</a>]).  This can be used to
   fend off floods of SUBSCRIBE requests launched as a result of a
   distributed denial of service attack.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  IANA Considerations</span>

   This specification registers an event package, based on the
   registration procedures defined in <a href="rfc3265.html">RFC 3265</a> [<a href="#ref-2" title='"Session Initiation Protocol (SIP)-Specific Event Notification"'>2</a>].  The following is
   the information required for such a registration:

        Package Name: presence

        Package or Template-Package: This is a package.

        Published Document: <a href="rfc3856.html">RFC 3856</a>

        Person to Contact: Jonathan Rosenberg, jdrosen@jdrosen.net.















<span class="grey">Rosenberg                   Standards Track                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Contributors"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Contributors</span>

   The following individuals were part of the initial team that worked
   through the technical design of this specification:

   Jonathan Lennox
   Columbia University
   M/S 0401
   1214 Amsterdam Ave.
   New York, NY 10027-7003

   EMail: lennox@cs.columbia.edu

   Robert Sparks
   dynamicsoft
   5100 Tennyson Parkway
   Suite 1200
   Plano, Texas 75024

   EMail: rsparks@dynamicsoft.com

   Ben Campbell

   EMail: ben@nostrum.com

   Dean Willis
   dynamicsoft
   5100 Tennyson Parkway
   Suite 1200
   Plano, Texas 75024

   EMail: dwillis@dynamicsoft.com

   Henning Schulzrinne
   Columbia University
   M/S 0401
   1214 Amsterdam Ave.
   New York, NY 10027-7003

   EMail: schulzrinne@cs.columbia.edu











<span class="grey">Rosenberg                   Standards Track                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   Christian Huitema
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA 98052-6399

   EMail: huitema@microsoft.com

   Bernard Aboba
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA 98052-6399

   EMail: bernarda@microsoft.com

   David Gurle
   Reuters Corporation

   EMail: David.Gurle@reuters.com

   David Oran
   Cisco Systems
   170 West Tasman Dr.
   San Jose, CA 95134

   EMail: oran@cisco.com

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/12.%20%20Acknowledgements"></a><a class="selflink" href="#section-12" name="section-12">12</a>.  Acknowledgements</span>

   We would like to thank Rick Workman, Adam Roach, Sean Olson, Billy
   Biggs, Stuart Barkley, Mauricio Arango, Richard Shockey, Jorgen
   Bjorkner, Henry Sinnreich, Ronald Akers, Paul Kyzivat, Ya-Ching Tan,
   Patrik Faltstrom, Allison Mankin and Hisham Khartabil for their
   comments and support of this specification.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/13.%20%20Normative%20References"></a><a class="selflink" href="#section-13" name="section-13">13</a>.  Normative References</span>

   [<a id="ref-1" name="ref-1">1</a>]  Rosenberg, J., Schulzrinne, H., Camarillo, H., Johnston, A.,
        Peterson, J., Sparks, R., Handley, M., and E. Schooler, "SIP:
        Session Initiation Protocol", <a href="rfc3261.html">RFC 3261</a>, June 2002.

   [<a id="ref-2" name="ref-2">2</a>]  Roach, A., "Session Initiation Protocol (SIP)-Specific Event
        Notification", <a href="rfc3265.html">RFC 3265</a>, June 2002.

   [<a id="ref-3" name="ref-3">3</a>]  Peterson, J., "Common Profile for Presence (CPP)", <a href="rfc3859.html">RFC 3859</a>,
        August 2004.

   [<a id="ref-4" name="ref-4">4</a>]  Bradner, S., "Key Words for Use in RFCs to Indicate Requirement
        Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.



<span class="grey">Rosenberg                   Standards Track                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


   [<a id="ref-5" name="ref-5">5</a>]  Peterson, J., "Address Resolution for Instant Messaging and
        Presence", <a href="rfc3861.html">RFC 3861</a>, August 2004.

   [<a id="ref-6" name="ref-6">6</a>]  Sugano, H., Fujimoto, S., Klyne, G., Bateman, A., Carr, W., and
        J. Peterson, "Presence Information Data Format (PIDF)", <a href="rfc3863.html">RFC</a>
        <a href="rfc3863.html">3863</a>, August 2004.

   [<a id="ref-7" name="ref-7">7</a>]  Dierks, T. and C. Allen, "The TLS Protocol Version 1.0", <a href="rfc2246.html">RFC</a>
        <a href="rfc2246.html">2246</a>, January 1999.

   [<a id="ref-8" name="ref-8">8</a>]  Rosenberg, J., "A Watcher Information Event Template-Package for
        the Session Initiation Protocol (SIP)", <a href="rfc3857.html">RFC 3857</a>, August 2004.

   [<a id="ref-9" name="ref-9">9</a>]  Schulzrinne, H. Rosenberg, J., and P. Kyzivat, "Indicating User
        Agent Capabilities in the Session Initiation Protocol (SIP)",
        <a href="rfc3840.html">RFC 3840</a>, August 2004.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/14.%20%20Informative%20References"></a><a class="selflink" href="#section-14" name="section-14">14</a>.  Informative References</span>

   [<a id="ref-10" name="ref-10">10</a>] Day, M., Rosenberg, J., and H. Sugano, "A Model for Presence and
        Instant Messaging", <a href="rfc2778.html">RFC 2778</a>, February 2000.

   [<a id="ref-11" name="ref-11">11</a>] Peterson, J., "Enhancements for Authenticated Identity
        Management in the Session Initiation Protocol (SIP)", Work in
        Progress, May 2004.

   [<a id="ref-12" name="ref-12">12</a>] Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko,
        "Diameter Base Protocol", <a href="rfc3588.html">RFC 3588</a>, September 2003.

   [<a id="ref-13" name="ref-13">13</a>] Day, M., Aggarwal, S., Mohr, G., and J. Vincent, "Instant
        Messaging / Presence Protocol Requirements", <a href="rfc2779.html">RFC 2779</a>, February
        2000.

   [<a id="ref-14" name="ref-14">14</a>] Gutmann, P., "Password-Based Encryption for CMS", <a href="rfc3211.html">RFC 3211</a>,
        December 2001.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/15.%20%20Author%27s%20Address"></a><a class="selflink" href="#section-15" name="section-15">15</a>.  Author's Address</span>

   Jonathan Rosenberg
   dynamicsoft
   600 Lanidex Plaza
   Parsippany, NJ 07054

   EMail: jdrosen@dynamicsoft.com







<span class="grey">Rosenberg                   Standards Track                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc3856.html">RFC 3856</a>                      SIP Presence                   August 2004</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/16.%20%20Full%20Copyright%20Statement"></a><a class="selflink" href="#section-16" name="section-16">16</a>.  Full Copyright Statement</span>

   Copyright (C) The Internet Society (2004).  This document is subject
   to the rights, licenses and restrictions contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and
   except as set forth therein, the authors retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.









Rosenberg                   Standards Track                    [Page 27]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc3856 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:44 GMT --></html>