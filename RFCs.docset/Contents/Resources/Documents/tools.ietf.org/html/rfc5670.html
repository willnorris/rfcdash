<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5670 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:34 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-eardley-pcn-marking-behaviour" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:5670" name="DC.Identifier"/>
<meta content="November, 2009" name="DC.Date.Issued"/>
<meta content="Philip Eardley &lt;philip.eardley@bt.com&gt;" name="DC.Creator"/>
<meta content="This document standardises the two marking behaviours of PCN-nodes:
threshold marking and excess traffic marking. Threshold marking marks
all PCN-packets if the PCN traffic rate is greater than its configured
rate. Excess traffic marking marks a proportion of PCN- packets, such
that the amount marked equals the traffic rate in excess of its
configured rate. Setting the configured rates below the physical link
rates enables PCN-nodes to provide information to support admission
control and flow termination in order to protect the quality of
service of established inelastic flows." name="DC.Description.Abstract"/>
<meta content="Marking behaviour of PCN-nodes" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5670 - Marking behaviour of PCN-nodes</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgblue" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5670.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5670" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-pcn-marking-behaviour" title="draft-ietf-pcn-marking-behaviour">draft-ietf-pcn-...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5670" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5670" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5670" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=5670">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                       PROPOSED STANDARD</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Network Working Group                                    P. Eardley, Ed.
Request for Comments: 5670                                            BT
Category: Standards Track                                  November 2009


              <span class="h1">Metering and Marking Behaviour of PCN-Nodes</span>

Abstract

   The objective of Pre-Congestion Notification (PCN) is to protect the
   quality of service (QoS) of inelastic flows within a Diffserv domain
   in a simple, scalable, and robust fashion.  This document defines the
   two metering and marking behaviours of PCN-nodes.  Threshold-metering
   and -marking marks all PCN-packets if the rate of PCN-traffic is
   greater than a configured rate ("PCN-threshold-rate").  Excess-
   traffic-metering and -marking marks a proportion of PCN-packets, such
   that the amount marked equals the rate of PCN-traffic in excess of a
   configured rate ("PCN-excess-rate").  The level of marking allows
   PCN-boundary-nodes to make decisions about whether to admit or
   terminate PCN-flows.

Status of This Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow



<span class="grey">Eardley                     Standards Track                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-2">2</a>
      <a href="#section-1.1">1.1</a>. Terminology ................................................<a href="#page-4">4</a>
           <a href="#section-1.1.1">1.1.1</a>. Requirements Language ...............................<a href="#page-5">5</a>
   <a href="#section-2">2</a>. Specified PCN-Metering and -Marking Behaviours ..................<a href="#page-5">5</a>
      <a href="#section-2.1">2.1</a>. Behaviour Aggregate Classification Function ................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. Dropping Function ..........................................<a href="#page-5">5</a>
      <a href="#section-2.3">2.3</a>. Threshold-Meter Function ...................................<a href="#page-6">6</a>
      <a href="#section-2.4">2.4</a>. Excess-Traffic-Meter Function ..............................<a href="#page-6">6</a>
      <a href="#section-2.5">2.5</a>. Marking Function ...........................................<a href="#page-7">7</a>
   <a href="#section-3">3</a>. Security Considerations .........................................<a href="#page-7">7</a>
   <a href="#section-4">4</a>. Acknowledgements ................................................<a href="#page-8">8</a>
   <a href="#section-5">5</a>. References ......................................................<a href="#page-8">8</a>
      <a href="#section-5.1">5.1</a>. Normative Reference ........................................<a href="#page-8">8</a>
      <a href="#section-5.2">5.2</a>. Informative References .....................................<a href="#page-8">8</a>
   <a href="#appendix-A">Appendix A</a>.  Example Algorithms ...................................<a href="#page-11">11</a>
     <a href="#appendix-A.1">A.1</a>.  Threshold-Metering and -Marking ...........................<a href="#page-11">11</a>
     <a href="#appendix-A.2">A.2</a>.  Excess-Traffic-Metering and -Marking ......................<a href="#page-12">12</a>
   <a href="#appendix-B">Appendix B</a>.  Implementation Notes .................................<a href="#page-13">13</a>
     <a href="#appendix-B.1">B.1</a>.  Competing-Non-PCN-Traffic .................................<a href="#page-13">13</a>
     <a href="#appendix-B.2">B.2</a>.  Scope .....................................................<a href="#page-14">14</a>
     <a href="#appendix-B.3">B.3</a>.  Behaviour Aggregate Classification ........................<a href="#page-15">15</a>
     <a href="#appendix-B.4">B.4</a>.  Dropping ..................................................<a href="#page-15">15</a>
     <a href="#appendix-B.5">B.5</a>.  Threshold-Metering ........................................<a href="#page-17">17</a>
     <a href="#appendix-B.6">B.6</a>.  Excess-Traffic-Metering ...................................<a href="#page-18">18</a>
     <a href="#appendix-B.7">B.7</a>.  Marking ...................................................<a href="#page-19">19</a>

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The objective of Pre-Congestion Notification (PCN) is to protect the
   quality of service (QoS) of inelastic flows within a Diffserv domain
   in a simple, scalable, and robust fashion.  Two mechanisms are used:
   admission control to decide whether to admit or block a new flow
   request, and (in abnormal circumstances) flow termination to decide
   whether to terminate some of the existing flows.  To achieve this,
   the overall rate of PCN-traffic is metered on every link in the
   domain, and PCN-packets are appropriately marked when certain
   configured rates are exceeded.  These configured rates are below the
   rate of the link, thus providing notification to boundary nodes about



<span class="grey">Eardley                     Standards Track                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   overloads before any congestion occurs (hence "Pre-Congestion
   Notification").  The level of marking allows boundary nodes to make
   decisions about whether to admit or terminate.  Within the domain,
   PCN-traffic is forwarded in a prioritised Diffserv traffic class
   [<a href="rfc2475.html" title='"An Architecture for Differentiated Services"'>RFC2475</a>].

   This document defines the two metering and marking behaviours of PCN-
   nodes.  Their aim is to enable PCN-nodes to give an "early warning"
   of potential congestion before there is any significant build-up of
   PCN-packets in their queues.  In summary, their objectives are:

   o  Threshold-metering and -marking: to mark all PCN-packets (with a
      "threshold-mark") when the bit rate of PCN-traffic is greater than
      its configured reference rate ("PCN-threshold-rate").

   o  Excess-traffic-metering and -marking: when the bit rate of PCN-
      packets is greater than its configured reference rate ("PCN-
      excess-rate"), to mark PCN-packets (with an "excess-traffic-mark")
      at a rate equal to the difference between the rate of PCN-traffic
      and the PCN-excess-rate.

   Note that although [<a href="rfc3168.html" title='"The Addition of Explicit Congestion Notification (ECN) to IP"'>RFC3168</a>] defines a broadly RED-like (Random Early
   Detection) default congestion marking behaviour, it allows
   alternatives to be defined; this document defines such an
   alternative.

   <a href="#section-2">Section 2</a> below describes the functions involved, which in outline
   (see Figure 1) are:

   o  Behaviour aggregate (BA) classification: decide whether or not an
      incoming packet is a PCN-packet.

   o  Dropping (optional): drop packets if the link is overloaded.

   o  Threshold-meter: determine whether the bit rate of PCN-traffic
      exceeds its configured reference rate (PCN-threshold-rate).  The
      meter operates on all PCN-packets on the link, and not on
      individual flows.

   o  Excess-traffic-meter: measure by how much the bit rate of PCN-
      traffic exceeds its configured reference rate (PCN-excess-rate).
      The meter operates on all PCN-packets on the link, and not on
      individual flows.

   o  PCN-mark: actually mark the PCN-packets, if the meter functions
      indicate to do so.





<span class="grey">Eardley                     Standards Track                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


                                        +---------+    Result
                                     +-&gt;|Threshold|-------+
                                     |  |  Meter  |       |
                                     |  +---------+       V
         +----------+   +- - - - -+  |                +------+
         |   BA     |   |         |  |                |      |    Marked
Packet =&gt;|Classifier|==&gt;| Dropper |==?===============&gt;|Marker|==&gt; Packet
Stream   |          |   |         |  |                |      |    Stream
         +----------+   +- - - - -+  |                +------+
                                     |  +---------+       ^
                                     |  | Excess  |       |
                                     +-&gt;| Traffic |-------+
                                        |  Meter  |    Result
                                        +---------+

       Figure 1: Schematic of PCN-interior-node functionality

   <a href="#appendix-A">Appendix A</a> gives an example of algorithms that fulfil the
   specification of <a href="#section-2">Section 2</a>, and <a href="#appendix-B">Appendix B</a> provides some explanations
   of and comments on <a href="#section-2">Section 2</a>.  Both the Appendices are informative.

   The general architecture for PCN is described in [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>], whilst
   [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>] is an overview of PCN.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Terminology"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Terminology</span>

   In addition to the terminology defined in [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>] and [<a href="rfc2474.html" title='"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"'>RFC2474</a>],
   the following terms are defined:

   o  Competing-non-PCN-packet: a non-PCN-packet that shares a link with
      PCN-packets and competes with them for its forwarding bandwidth.
      Competing-non-PCN-packets MUST NOT be PCN-marked (only PCN-packets
      can be PCN-marked).

      Note: In general, it is not advised to have any competing-non-PCN-
      traffic.

      Note: There is likely to be traffic (such as best effort) that is
      forwarded at lower priority than PCN-traffic; although it shares
      the link with PCN-traffic, it doesn't compete for forwarding
      bandwidth, and hence it is not competing-non-PCN-traffic.  See
      <a href="#appendix-B.1">Appendix B.1</a> for further discussion about competing-non-PCN-
      traffic.








<span class="grey">Eardley                     Standards Track                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   o  Metered-packet: a packet that is metered by the metering functions
      specified in Sections <a href="#section-2.3">2.3</a> and <a href="#section-2.4">2.4</a>.  A PCN-packet MUST be treated
      as a metered-packet (with the minor exception noted below in
      <a href="#section-2.4">Section 2.4</a>).  A competing-non-PCN-packet MAY be treated as a
      metered-packet.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/1.1.1.%20%20Requirements%20Language"></a><a class="selflink" href="#section-1.1.1" name="section-1.1.1">1.1.1</a>.  Requirements Language</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a href="rfc2119.html">RFC 2119</a> [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Specified%20PCN-Metering%20and%20-Marking%20Behaviours"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Specified PCN-Metering and -Marking Behaviours</span>

   This section defines the two PCN-metering and -marking behaviours.
   The descriptions are functional and are not intended to restrict the
   implementation.  The informative Appendices supplement this section.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20Behaviour%20Aggregate%20Classification%20Function"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  Behaviour Aggregate Classification Function</span>

   A PCN-node MUST classify a packet as a PCN-packet if the value of its
   Differentiated Services Code Point (DSCP) and Explicit Congestion
   Notification (ECN) fields correspond to a PCN-enabled codepoint, as
   defined in the encoding scheme applicable to the PCN-domain (for
   example, [<a href="rfc5696.html" title='"Baseline Encoding and Transport of Pre-Congestion Information"'>RFC5696</a>] defines the baseline encoding).  Otherwise, the
   packet MUST NOT be classified as a PCN-packet.

   A PCN-node MUST classify a packet as a competing-non-PCN-packet if it
   is not a PCN-packet and it competes with PCN-packets for its
   forwarding bandwidth on a link.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20Dropping%20Function"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  Dropping Function</span>

   Note: If the PCN-node's queue overflows, then naturally packets are
   dropped.  This section describes additional action.

   On all links in the PCN-domain, dropping MAY be done by first
   metering all metered-packets to determine if the rate of metered-
   traffic on the link is greater than the rate allowed for such
   traffic; if the rate of metered-traffic is too high, then drop
   metered-packets.

   If the PCN-node drops PCN-packets, then:

   o  PCN-packets that arrive at the PCN-node already excess-traffic-
      marked SHOULD be preferentially dropped.





<span class="grey">Eardley                     Standards Track                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   o  the PCN-node's excess-traffic-meter SHOULD NOT meter the PCN-
      packets that it drops.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20Threshold-Meter%20Function"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  Threshold-Meter Function</span>

   A PCN-node MUST implement a threshold-meter that has behaviour
   functionally equivalent to the following.

   The meter acts like a token bucket, which is sized in bits and has a
   configured reference rate (bits per second).  The amount of tokens in
   the token bucket is termed F_tm.  Tokens are added at the reference
   rate (PCN-threshold-rate), to a maximum value BS_tm.  Tokens are
   removed equal to the size in bits of the metered-packet, to a minimum
   F_tm = 0.  (Explanation of abbreviations: F is short for Fill of the
   token bucket, BS for bucket size, and tm for threshold-meter.)

   The token bucket has a configured intermediate depth, termed
   threshold.  If F_tm &lt; threshold, then the meter indicates to the
   marking function that the packet is to be threshold-marked;
   otherwise, it does not.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20Excess-Traffic-Meter%20Function"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  Excess-Traffic-Meter Function</span>

   A packet SHOULD NOT be metered (by this excess-traffic-meter
   function) in the following two cases:

   o  if the PCN-packet is already excess-traffic-marked on arrival at
      the PCN-node.

   o  if this PCN-node drops the packet.

   Otherwise, the PCN-packet MUST be treated as a metered-packet -- that
   is, it is metered by the excess-traffic-meter.

   A PCN-node MUST implement an excess-traffic-meter.  The excess-
   traffic-meter SHOULD indicate packets to be excess-traffic-marked,
   independent of their size ("packet size independent marking"); if
   "packet size independent marking" is not implemented, then the
   excess-traffic-meter MUST use the "classic" metering behaviour.

   For the "classic" metering behaviour, the excess-traffic-meter has
   behaviour functionally equivalent to the following.

   The meter acts like a token bucket, which is sized in bits and has a
   configured reference rate (bits per second).  The amount of tokens in
   the token bucket is termed F_etm.  Tokens are added at the reference
   rate (PCN-excess-rate), to a maximum value BS_etm.  Tokens are
   removed equal to the size in bits of the metered-packet, to a minimum



<span class="grey">Eardley                     Standards Track                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   F_etm = 0.  If the token bucket is empty (F_etm = 0), then the meter
   indicates to the marking function that the packet is to be excess-
   traffic-marked.  (Explanation of abbreviations: F is short for Fill
   of the token bucket, BS for bucket size, and etm for excess-traffic-
   meter.)

   For "packet size independent marking", the excess-traffic-meter has
   behaviour functionally equivalent to the following.

   The meter acts like a token bucket, which is sized in bits and has a
   configured reference rate (bits per second).  The amount of tokens in
   the token bucket is termed F_etm.  Tokens are added at the reference
   rate (PCN-excess-rate), to a maximum value BS_etm.  If the token
   bucket is not negative, then tokens are removed equal to the size in
   bits of the metered-packet (and the meter does not indicate to the
   marking function that the packet is to be excess-traffic-marked).  If
   the token bucket is negative (F_etm &lt; 0), then the meter indicates to
   the marking function that the packet is to be excess-traffic-marked
   (and no tokens are removed).  (Explanation of abbreviations: F is
   short for Fill of the token bucket, BS for bucket size, and etm for
   excess-traffic-meter.)

   Otherwise, the meter MUST NOT indicate marking.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5.%20%20Marking%20Function"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a>.  Marking Function</span>

   A PCN-packet MUST be marked to reflect the metering results by
   setting its encoding state appropriately, as specified by the
   specific encoding scheme that applies in the PCN-domain.  A
   consistent choice of encoding scheme MUST be made throughout a PCN-
   domain.

   A PCN-node MUST NOT:

   o  PCN-mark a packet that is not a PCN-packet;

   o  change a non-PCN-packet into a PCN-packet;

   o  change a PCN-packet into a non-PCN-packet.

   Note: Although competing-non-PCN-packets MAY be metered, they MUST
   NOT be PCN-marked.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20Security%20Considerations"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  Security Considerations</span>

   It is assumed that all PCN-nodes are PCN-enabled and are trusted for
   truthful PCN-metering and PCN-marking.  If this isn't the case, then
   there are numerous potential attacks.  For instance, a rogue PCN-



<span class="grey">Eardley                     Standards Track                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   interior-node could PCN-mark all packets so that no flows were
   admitted.  Another possibility is that it doesn't PCN-mark any
   packets, even when it is pre-congested.

   Note that PCN-interior-nodes are not flow-aware.  This prevents some
   security attacks where an attacker targets specific flows in the data
   plane -- for instance, for Denial-of-Service (DoS) or eavesdropping.

   As regards Security Operations and Management, PCN adds few specifics
   to the general good practice required in this field [<a href="rfc4778.html" title='"Operational Security Current Practices in Internet Service Provider Environments"'>RFC4778</a>].  For
   example, it may be sensible for a PCN-node to raise an alarm if it is
   persistently PCN-marking.

   Security considerations are further discussed in [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Acknowledgements"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Acknowledgements</span>

   This document is the result of extensive collaboration within the PCN
   WG.  Amongst the most active other contributors to the development of
   the ideas specified in this document have been Jozef Babiarz, Bob
   Briscoe, Kwok-Ho Chan, Anna Charny, Georgios Karagiannis, Michael
   Menth, Toby Moncaster, Daisuke Satoh, and Joy Zhang.  <a href="#appendix-A">Appendix A</a> is
   based on text from Michael Menth.

   This document is a development of [<a href="#ref-Briscoe06-2" title='"Pre-Congestion Notification marking"'>Briscoe06-2</a>].  Its authors are
   therefore also contributors to this document: Jozef Babiarz, Attila
   Bader, Bob Briscoe, Kwok-Ho Chan, Anna Charny, Stephen Dudley, Philip
   Eardley, Georgios Karagiannis, Francois Le Faucheur, Vassilis
   Liatsos, Dave Songhurst, and Lars Westberg.

   Thanks to those who've made comments on the document: Joe Babiarz,
   Fred Baker, David Black, Bob Briscoe, Ken Carlberg, Anna Charny,
   Ralph Droms, Mehmet Ersue, Adrian Farrel, Ruediger Geib, Wei Gengyu,
   Fortune Huang, Christian Hublet, Ingemar Johansson, Georgios
   Karagiannis, Alexey Melnikov, Michael Menth, Toby Moncaster, Dimitri
   Papadimitriou, Tim Polk, Daisuke Satoh, and Magnus Westerlund.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20References"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Normative%20Reference"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Normative Reference</span>

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]      Bradner, S., "Key words for use in RFCs to Indicate
                  Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Informative%20References"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Informative References</span>

   [<a id="ref-Baker08" name="ref-Baker08">Baker08</a>]      Baker, F., Polk, J., and M. Dolly, "DSCP for Capacity-
                  Admitted Traffic", Work in Progress, November 2008.



<span class="grey">Eardley                     Standards Track                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   [<a id="ref-Briscoe06-1" name="ref-Briscoe06-1">Briscoe06-1</a>]  Briscoe, B., Eardley, P., Songhurst, D., Le Faucheur,
                  F., Charny, A., Babiarz, J., Chan, K., Dudley, S.,
                  Karagiannis, G., Bader, A., and L. Westberg, "An edge-
                  to-edge Deployment Model for Pre-Congestion
                  Notification: Admission Control over a DiffServ
                  Region", Work in Progress, October 2006.

   [<a id="ref-Briscoe06-2" name="ref-Briscoe06-2">Briscoe06-2</a>]  Briscoe, B., Eardley, P., Songhurst, D., Le Faucheur,
                  F., Charny, A., Liatsos, V., Babiarz, J., Chan, K.,
                  Dudley, S., Karagiannis, G., Bader, A., and L.
                  Westberg, "Pre-Congestion Notification marking", Work
                  in Progress, October 2006.

   [<a id="ref-Briscoe08" name="ref-Briscoe08">Briscoe08</a>]    Briscoe, B., "Byte and Packet Congestion
                  Notification", Work in Progress, August 2008.

   [<a id="ref-Charny07" name="ref-Charny07">Charny07</a>]     Charny, A., Babiarz, J., Menth, M., and X. Zhang,
                  "Comparison of Proposed PCN Approaches", Work
                  in Progress, November 2007.

   [<a id="ref-Menth10" name="ref-Menth10">Menth10</a>]      Menth, M., Lehrieder, F., Briscoe, B., Eardley, P.,
                  Moncaster, T., Babiarz, J., Chan, K., Charny, A.,
                  Karagiannis, G., Zhang, X., Taylor, T., Satoh, D., and
                  R. Geib, "A Survey of PCN-Based Admission Control and
                  Flow Termination", IEEE Communications Surveys and
                  Tutorials, 2010 (third issue), &lt;<a href="http://www3.informatik.uni-wuerzburg.de/staff/menth/Publications/papers/Menth08-PCN-Overview.pdf">http://</a>
                  <a href="http://www3.informatik.uni-wuerzburg.de/staff/menth/Publications/papers/Menth08-PCN-Overview.pdf">www3.informatik.uni-wuerzburg.de/staff/menth/</a>
                  <a href="http://www3.informatik.uni-wuerzburg.de/staff/menth/Publications/papers/Menth08-PCN-Overview.pdf">Publications/papers/Menth08-PCN-Overview.pdf</a>&gt;.

   [<a id="ref-RFC2474" name="ref-RFC2474">RFC2474</a>]      Nichols, K., Blake, S., Baker, F., and D. Black,
                  "Definition of the Differentiated Services Field (DS
                  Field) in the IPv4 and IPv6 Headers", <a href="rfc2474.html">RFC 2474</a>,
                  December 1998.

   [<a id="ref-RFC2475" name="ref-RFC2475">RFC2475</a>]      Blake, S., Black, D., Carlson, M., Davies, E., Wang,
                  Z., and W. Weiss, "An Architecture for Differentiated
                  Services", <a href="rfc2475.html">RFC 2475</a>, December 1998.

   [<a id="ref-RFC3168" name="ref-RFC3168">RFC3168</a>]      Ramakrishnan, K., Floyd, S., and D. Black, "The
                  Addition of Explicit Congestion Notification (ECN) to
                  IP", <a href="rfc3168.html">RFC 3168</a>, September 2001.

   [<a id="ref-RFC4778" name="ref-RFC4778">RFC4778</a>]      Kaeo, M., "Operational Security Current Practices in
                  Internet Service Provider Environments", <a href="rfc4778.html">RFC 4778</a>,
                  January 2007.

   [<a id="ref-RFC5127" name="ref-RFC5127">RFC5127</a>]      Chan, K., Babiarz, J., and F. Baker, "Aggregation of
                  DiffServ Service Classes", <a href="rfc5127.html">RFC 5127</a>, February 2008.



<span class="grey">Eardley                     Standards Track                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   [<a id="ref-RFC5559" name="ref-RFC5559">RFC5559</a>]      Eardley, P., "Pre-Congestion Notification (PCN)
                  Architecture", <a href="rfc5559.html">RFC 5559</a>, June 2009.

   [<a id="ref-RFC5696" name="ref-RFC5696">RFC5696</a>]      Moncaster, T., Briscoe, B., and M. Menth, "Baseline
                  Encoding and Transport of Pre-Congestion Information",
                  <a href="rfc5696.html">RFC 5696</a>, November 2009.

   [<a id="ref-Taylor09" name="ref-Taylor09">Taylor09</a>]     Charny, A., Huang, F., Menth, M., and T. Taylor, "PCN
                  Boundary Node Behaviour for the Controlled Load (CL)
                  Mode of Operation", Work in Progress, March 2009.









































<span class="grey">Eardley                     Standards Track                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20A.%20%20Example%20Algorithms"></a><a class="selflink" href="#appendix-A" name="appendix-A">Appendix A</a>.  Example Algorithms</span>

   Note: This Appendix is informative, not normative.  It is an example
   of algorithms that implement <a href="#section-2">Section 2</a> and is based on [<a href="#ref-Charny07" title='"Comparison of Proposed PCN Approaches"'>Charny07</a>] and
   [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>].

   There is no attempt to optimise the algorithms.  The metering and
   marking functions are implemented together.  It is assumed that three
   encoding states are available (one for threshold-marked, one for
   excess-traffic-marked, and one for not-marked).  It is assumed that
   all metered-packets are PCN-packets and that the link is never
   overloaded.  For excess-traffic-marking, "packet size independent
   marking" applies.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.1.%20%20Threshold-Metering%20and%20-Marking"></a><a class="selflink" href="#appendix-A.1" name="appendix-A.1">A.1</a>.  Threshold-Metering and -Marking</span>

   A token bucket with the following parameters:

      *  PCN-threshold-rate: token rate of token bucket (bits/second)

      *  BS_tm: depth of token bucket (bits)

      *  threshold: marking threshold of token bucket (bits)

      *  lastUpdate: time the token bucket was last updated (seconds)

      *  F_tm: amount of tokens in token bucket (bits)

   A PCN-packet has the following parameters:

      *  packet_size: the size of the PCN-packet (bits)

      *  packet_mark: the PCN encoding state of the packet

   In addition there is the parameter:

         now: the current time (seconds)

   The following steps are performed when a PCN-packet arrives on a
   link:

      *  F_tm = min(BS_tm, F_tm + (now - lastUpdate) * PCN-threshold-
         rate); // add tokens to token bucket

      *  F_tm = max(0, F_tm - packet_size); // remove tokens from token
         bucket





<span class="grey">Eardley                     Standards Track                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


      *  if ((F_tm &lt; threshold) AND (packet_mark != excess-traffic-
         marked)) then packet_mark = threshold-marked; // do threshold-
         marking, but don't re-mark packets that are already excess-
         traffic-marked

      *  lastUpdate = now // Note: 'now' has the same value as in step 1

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/A.2.%20%20Excess-Traffic-Metering%20and%20-Marking"></a><a class="selflink" href="#appendix-A.2" name="appendix-A.2">A.2</a>.  Excess-Traffic-Metering and -Marking</span>

   A token bucket with the following parameters:

      *  PCN-excess-rate: token rate of token bucket (bits/second)

      *  BS_etm: depth of TB in token bucket (bits)

      *  lastUpdate: time the token bucket was last updated (seconds)

      *  F_etm: amount of tokens in token bucket (bits)

   A PCN-packet has the following parameters:

      *  packet_size: the size of the PCN-packet (bits)

      *  packet_mark: the PCN encoding state of the packet

   In addition there is the parameter:

      *  now: the current time (seconds)

   The following steps are performed when a PCN-packet arrives on a
   link:

      *  F_etm = min(BS_etm, F_etm + (now - lastUpdate) * PCN-excess-
         rate); // add tokens to token bucket

      *  if (packet_mark != excess-traffic-marked) then // do not meter
         packets that are already excess-traffic-marked

         +  if (F_etm &lt; 0) then packet_mark = excess-traffic-marked; //
            do excess-traffic-marking.  The algorithm ensures this is
            independent of packet size

         +  else F_etm = F_etm - packet_size; // remove tokens from
            token bucket if don't mark packet

      *  lastUpdate = now // Note: 'now' has the same value as in step 1





<span class="grey">Eardley                     Standards Track                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/Appendix%20B.%20%20Implementation%20Notes"></a><a class="selflink" href="#appendix-B" name="appendix-B">Appendix B</a>.  Implementation Notes</span>

   Note: This Appendix is informative, not normative.  It comments on
   <a href="#section-2">Section 2</a>, including reasoning about whether MUSTs or SHOULDs are
   required.  For guidance on Operations and Management considerations,
   please see [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.1.%20%20Competing-Non-PCN-Traffic"></a><a class="selflink" href="#appendix-B.1" name="appendix-B.1">B.1</a>.  Competing-Non-PCN-Traffic</span>

   In general, it is not advised to have any competing-non-PCN-traffic,
   essentially because the unpredictable amount of competing-non-PCN-
   traffic makes the PCN mechanisms less accurate and so reduces PCN's
   ability to protect the QoS of admitted PCN-flows [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>].  But if
   there is competing-non-PCN-traffic, then:

   1.  There should be a mechanism to limit it, for example:

       *  limit the rate at which competing-non-PCN-traffic can be
          forwarded on each link in the PCN-domain.  One method for
          achieving this is to queue competing-non-PCN-packets
          separately from PCN-packets and to limit the scheduling rate
          of the former.  Another method is to drop competing-non-PCN-
          packets in excess of some rate.

       *  police competing-non-PCN-traffic at the PCN-ingress-nodes, as
          in the Diffserv architecture, for example.  However,
          Diffserv's static traffic conditioning agreements risk a
          focused overload of traffic from several PCN-ingress-nodes
          onto one link.

       *  by design, it is known that the level of competing-non-PCN-
          traffic is always very small -- perhaps it consists of
          operator control messages only.

   2.  In general, PCN's mechanisms should take account of competing-
       non-PCN-traffic, in order to improve the accuracy of the decision
       about whether to admit (or terminate) a PCN-flow.  For example:

       *  competing-non-PCN-traffic contributes to the PCN-meters;
          competing-non-PCN-packets are treated as metered-packets.

       *  each PCN-node, on its links: (1) reduces the reference rates
          (PCN-threshold-rate and PCN-excess-rate), in order to allow
          'headroom' for the competing-non-PCN-traffic; (2) limits the
          maximum forwarding rate of competing-non-PCN-traffic to be
          less than the 'headroom'.  In this case, competing-non-PCN-
          packets are not treated as metered-packets.




<span class="grey">Eardley                     Standards Track                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   3.  The operator should decide on appropriate action.  Dropping is
       discussed further in <a href="#appendix-B.4">Appendix B.4</a>.

   One specific example of competing-non-PCN-traffic occurs if the PCN-
   compatible Diffserv codepoint is one of those that [<a href="#ref-Baker08" title='"DSCP for Capacity- Admitted Traffic"'>Baker08</a>] defines
   as suitable for use with admission control and there is such non-PCN-
   traffic in the PCN-domain.  A similar example could occur for
   Diffserv codepoints of the Real-Time Treatment Aggregate [<a href="rfc5127.html" title='"Aggregation of DiffServ Service Classes"'>RFC5127</a>].
   In such cases, PCN-traffic and competing-non-PCN-traffic are
   distinguished by different values of the ECN field [<a href="rfc5696.html" title='"Baseline Encoding and Transport of Pre-Congestion Information"'>RFC5696</a>].

   Another example would occur if there is more than one PCN-compatible
   Diffserv codepoint in a PCN-domain.  For instance, suppose there are
   two PCN-BAs treated at different priorities.  Then as far as the
   lower priority PCN-BA is concerned, the higher priority PCN-traffic
   needs to be treated as competing-non-PCN-traffic.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.2.%20%20Scope"></a><a class="selflink" href="#appendix-B.2" name="appendix-B.2">B.2</a>.  Scope</span>

   It may be known, for instance by the design of the network topology,
   that some links can never be pre-congested (even in unusual
   circumstances, such as after the failure of some links).  There is
   then no need to deploy the PCN-metering and -marking behaviour on
   those links.

   The meters can be implemented on the ingoing or outgoing interface of
   a PCN-node.  It may be that existing hardware can support only one
   meter per ingoing interface and one per outgoing interface.  Then,
   for instance, threshold-metering could be run on all the ingoing
   interfaces and excess-traffic-metering on all the outgoing
   interfaces; note that the same choice must be made for all the links
   in a PCN-domain to ensure that the two metering behaviours are
   applied exactly once for all the links.

   The baseline encoding [<a href="rfc5696.html" title='"Baseline Encoding and Transport of Pre-Congestion Information"'>RFC5696</a>] specifies only two encoding states
   (PCN-marked and not-marked).  In this case, "excess-traffic-marked"
   means a packet that is PCN-marked as a result of the excess-traffic-
   meter function, and "threshold-marked" means a packet that is PCN-
   marked as a result of the threshold-meter function.  As far as
   terminology is concerned, this interpretation is consistent with that
   defined in [<a href="rfc5559.html" title='"Pre-Congestion Notification (PCN) Architecture"'>RFC5559</a>].  Note that a deployment needs to make a
   consistent choice throughout the PCN-domain whether PCN-marked is
   interpreted as excess-traffic-marked or threshold-marked.

   Note that even if there are only two encoding states, it is still
   required that both the meters are implemented, in order to ease
   compatibility between equipment and to remove a configuration option
   and associated complexity.  Hardware with limited availability of



<span class="grey">Eardley                     Standards Track                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   token buckets could be configured to run only one of the meters, but
   it must be possible to enable either meter.  Although, in the
   scenario with two encoding states, indications from one of the meters
   are ignored by the marking function, they may be logged or acted upon
   in some other way, for example, by the management system or an
   explicit signalling protocol; such considerations are out of the
   scope of this document.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.3.%20%20Behaviour%20Aggregate%20Classification"></a><a class="selflink" href="#appendix-B.3" name="appendix-B.3">B.3</a>.  Behaviour Aggregate Classification</span>

   Configuration of PCN-nodes will define what values of the DSCP and
   ECN fields indicate a PCN-packet in a particular PCN-domain.  For
   instance, [<a href="rfc5696.html" title='"Baseline Encoding and Transport of Pre-Congestion Information"'>RFC5696</a>] defines the baseline encoding.

   Configuration will also define what values of the DSCP and ECN fields
   indicate a competing-non-PCN-packet in a particular PCN-domain.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.4.%20%20Dropping"></a><a class="selflink" href="#appendix-B.4" name="appendix-B.4">B.4</a>.  Dropping</span>

   The objective of the dropping function is to minimise the queueing
   delay suffered by metered-traffic at a PCN-node, since PCN-traffic
   (and perhaps competing-non-PCN-traffic) is expected to be inelastic
   traffic generated by real-time applications.  In practice, it would
   be defined as exceeding a specific traffic profile, typically based
   on a token bucket.

   If there is no competing-non-PCN-traffic, then it is not expected
   that the dropping function is needed, since PCN's flow admission and
   termination mechanisms limit the amount of PCN-traffic.  Even so, it
   still might be implemented as a back stop against misconfiguration of
   the PCN-domain, for instance.

   If there is competing-non-PCN-traffic, then the details of the
   dropping function will depend on how the router's implementation
   handles the two sorts of traffic:

   1.  a common queue for PCN-traffic and competing-non-PCN-traffic,
       with a traffic conditioner for the competing-non-PCN-traffic; or

   2.  separate queues, in which case the amount of competing-non-PCN-
       traffic can be limited by limiting the rate at which the
       scheduler (for the competing-non-PCN-traffic) forwards packets.

   (The discussion here is based on that in [<a href="#ref-Baker08" title='"DSCP for Capacity- Admitted Traffic"'>Baker08</a>].)







<span class="grey">Eardley                     Standards Track                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   Note that only dropping of packets is allowed.  Downgrading of
   packets to a lower priority BA is not allowed (see <a href="#appendix-B.7">Appendix B.7</a>),
   since it would lead to packet mis-ordering.  Shaping ("the process of
   delaying packets" [<a href="rfc2475.html" title='"An Architecture for Differentiated Services"'>RFC2475</a>]) is not suitable if the traffic comes
   from real-time applications.

   Preferential dropping of competing-non-PCN-traffic:
      In general, it is reasonable for competing-non-PCN-traffic to get
      harsher treatment than PCN-traffic (that is, competing-non-PCN-
      packets are preferentially dropped) because PCN's flow admission
      and termination mechanisms are stronger than the mechanisms that
      are likely to be applied to the competing-non-PCN-traffic.  The
      PCN mechanisms also mean that a dropper should not be needed for
      the PCN-traffic.

   Preferential dropping of excess-traffic-marked packets:
      <a href="#section-2.2">Section 2.2</a> specifies, "If the PCN-node drops PCN-packets, then
      ...  PCN-packets that arrive at the PCN-node already excess-
      traffic-marked SHOULD be preferentially dropped".  In brief, the
      reason is that, with the "controlled load" edge behaviour
      [<a href="#ref-Taylor09" title='"PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation"'>Taylor09</a>], this avoids over-termination in the event of multiple
      bottlenecks in the PCN-domain [<a href="#ref-Charny07" title='"Comparison of Proposed PCN Approaches"'>Charny07</a>].  A fuller explanation is
      as follows.  The optimal dropping behaviour depends on the
      particular edge behaviour [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>].  A single dropping behaviour
      is defined, as it is simpler to standardise, implement, and
      operate.  The standardised dropping behaviour is at least adequate
      for all edge behaviours (and good for some), whereas others are
      not (for example, with tail dropping, far too much traffic may be
      terminated with the "controlled load" edge behaviour, in the event
      of multiple bottlenecks in the PCN-domain [<a href="#ref-Charny07" title='"Comparison of Proposed PCN Approaches"'>Charny07</a>]).  The
      dropping behaviour is defined as a 'SHOULD', rather than a 'MUST',
      in recognition that other dropping behaviour may be preferred in
      particular circumstances, for example: (1) with the "marked flow"
      termination edge behaviour, preferential dropping of unmarked
      packets may be better [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>]; (2) tail dropping may make PCN-
      marking behaviour easier to implement on current routers.

   Exactly what "preferentially dropped" means is left to the
   implementation.  It is also left to the implementation what to do if
   there are no excess-traffic-marked PCN-packets available at a
   particular instant.

   <a href="#section-2.2">Section 2.2</a> also specifies, "the PCN-node's excess-traffic-meter
   SHOULD NOT meter the PCN-packets that it drops."  This avoids over-
   termination [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>].  Effectively, it means that the dropping
   function (if present) should be done before the meter functions --
   which is natural.




<span class="grey">Eardley                     Standards Track                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.5.%20%20Threshold-Metering"></a><a class="selflink" href="#appendix-B.5" name="appendix-B.5">B.5</a>.  Threshold-Metering</span>

   The description is in terms of a 'token bucket with threshold' (which
   [<a href="#ref-Briscoe06-1" title='"An edge- to-edge Deployment Model for Pre-Congestion Notification: Admission Control over a DiffServ Region"'>Briscoe06-1</a>] views as a virtual queue).  However, the description is
   not intended to standardise implementation.

   The reference rate of the threshold-meter (PCN-threshold-rate) is
   configured at less than the rate allocated to the PCN-traffic class.
   Also, the PCN-threshold-rate is less than, or possibly equal to, the
   PCN-excess-rate.

   <a href="#section-2.3">Section 2.3</a> specifies, "If F_tm &lt; threshold, then the meter indicates
   to the marking function that the packet is to be threshold-marked;
   otherwise, it does not."  Note that a PCN-packet is marked without
   explicit additional bias for the packet's size.

   The behaviour must be functionally equivalent to the description in
   <a href="#section-2.3">Section 2.3</a>.  "Functionally equivalent" means the observable 'black
   box' behaviour is the same or very similar, for example, if either
   precisely the same set of packets is marked or if the set is shifted
   by one packet.  It is intended to allow implementation freedom over
   matters such as:

   o  whether tokens are added to the token bucket at regular time
      intervals or only when a packet is processed.

   o  whether the new token bucket depth is calculated before or after
      it is decided whether to PCN-mark the packet.  The effect of this
      is simply to shift the sequence of marks by one packet.

   o  when the token bucket is very nearly empty and a packet arrives
      larger than F_tm, then the precise change in F_tm is up to the
      implementation.  For instance:

      *  set F_tm = 0 and indicate threshold-mark to the marking
         function.

      *  check whether F_tm &lt; threshold and if it is, then indicate
         threshold-mark to the marking function; then set F_tm = 0.

      *  leave F_tm unaltered and indicate threshold-mark to the marking
         function.

   o  similarly, when the token bucket is very nearly full and a packet
      arrives larger than (BS_tm - F_tm), then the precise change in
      F_tm is up to the implementation.





<span class="grey">Eardley                     Standards Track                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   Note that all PCN-packets, even if already marked, are metered by the
   threshold-meter function (unlike the excess-traffic-meter function),
   because all packets should contribute to the decision whether there
   is room for a new flow.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.6.%20%20Excess-Traffic-Metering"></a><a class="selflink" href="#appendix-B.6" name="appendix-B.6">B.6</a>.  Excess-Traffic-Metering</span>

   The description is in terms of a token bucket, however the
   implementation is not standardised.

   The reference rate of the excess-traffic-meter (PCN-excess-rate) is
   configured at less than (or possibly equal to) the rate allocated to
   the PCN-traffic class.  Also, the PCN-excess-rate is greater than, or
   possibly equal to, the PCN-threshold-rate.

   As in Section B.5, "functionally equivalent" allows some
   implementation flexibility, for example, the exact algorithm when the
   token bucket is very nearly empty or very nearly full.

   <a href="#section-2.4">Section 2.4</a> specifies, "A packet SHOULD NOT be metered (by this
   excess-traffic-meter function) ... if the packet is already excess-
   traffic-marked on arrival at the PCN-node".  This avoids over-
   termination (with some edge behaviours) in the event that the PCN-
   traffic passes through multiple bottlenecks in the PCN-domain
   [<a href="#ref-Charny07" title='"Comparison of Proposed PCN Approaches"'>Charny07</a>].  Note that an implementation could determine whether the
   packet is already excess-traffic-marked as an integral part of its BA
   classification function.  The behaviour is defined as a 'SHOULD NOT',
   rather than a 'MUST NOT', because it may be slightly harder to
   implement than a metering function that is blind to previous packet
   markings.

   <a href="#section-2.4">Section 2.4</a> specifies, "A packet SHOULD NOT be metered (by this
   excess-traffic-meter function) ... if this PCN-node drops the
   packet."  This avoids over-termination [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>].  (A similar
   statement could also be made for the threshold-meter function but is
   irrelevant, as a link that is overloaded will already be
   substantially pre-congested and hence threshold-marking all packets.)
   It seems natural to perform the dropping function before the metering
   functions, although for some equipment it may be harder to implement;
   hence, the behaviour is defined as a 'SHOULD NOT', rather than a
   'MUST NOT'.

   "Packet size independent marking" -- excess-traffic-marking that is
   independent of packet size -- is specified as a 'SHOULD' rather than
   a 'MUST' in <a href="#section-2.4">Section 2.4</a> because it may be slightly harder for some
   equipment to implement, and the impact of not doing so is undesirable
   but moderate (sufficient traffic is terminated, but flows with large
   packets are more likely to be terminated).  With the "classic"



<span class="grey">Eardley                     Standards Track                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


   excess-traffic-meter behaviour, large packets are more likely to be
   excess-traffic-marked than small packets (because packets are marked
   if the number of tokens in the token bucket is smaller than the
   packet size).  This means that, with some edge behaviours, flows with
   large packets are more likely to be terminated than flows with small
   packets ([<a href="#ref-Briscoe08" title='"Byte and Packet Congestion Notification"'>Briscoe08</a>], [<a href="#ref-Menth10" title='"A Survey of PCN-Based Admission Control and Flow Termination"'>Menth10</a>]).  "Packet size independent marking"
   can be achieved by a small modification of the "classic" excess-
   traffic-meter.  The number of tokens in the bucket can become
   negative; if this number is negative at a packet's arrival, the
   packet is marked; otherwise, the amount of tokens equal to the packet
   size is removed from the bucket.  Note that with "packet size
   independent marking", either the packet is marked or tokens are
   removed -- never both.  Hence, the token bucket cannot become more
   negative than the maximum packet size on the link.  The algorithm
   described in <a href="#appendix-A">Appendix A</a> implements this behaviour.

   Note that BS_etm is independent of BS_tm, F_etm is independent of
   F_tm (except in that a packet can change both), and the two
   configured rates (PCN-excess-rate and PCN-threshold-rate) are
   independent (except that PCN-excess-rate &gt;= PCN-threshold-rate).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/B.7.%20%20Marking"></a><a class="selflink" href="#appendix-B.7" name="appendix-B.7">B.7</a>.  Marking</span>

   <a href="#section-2.5">Section 2.5</a> defines, "A PCN-node MUST NOT ...change a PCN-packet into
   a non-PCN-packet".  This means that a PCN-node is not allowed to
   downgrade a PCN-packet into a lower priority Diffserv BA (hence,
   downgrading is not allowed as an alternative to dropping).

   <a href="#section-2.5">Section 2.5</a> defines, "A PCN-node MUST NOT ...PCN-mark a packet that
   is not a PCN-packet".  This means that in the scenario where
   competing-non-PCN-packets are treated as metered-packets, a meter may
   indicate a packet is to be PCN-marked, but the marking function knows
   it cannot be marked.  It is left open to the implementation exactly
   what to do in this case; one simple possibility is to mark the next
   PCN-packet.  Note that unless the PCN-packets are a large fraction of
   all the metered-packets, the PCN mechanisms may not work well.

   Although the metering functions are described separately from the
   marking function, they can be implemented in an integrated fashion.












<span class="grey">Eardley                     Standards Track                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5670.html">RFC 5670</a>                PCN metering and marking           November 2009</span>


Author's Address

   Philip Eardley (editor)
   BT
   Adastral Park, Martlesham Heath
   Ipswich  IP5 3RE
   UK

   EMail: philip.eardley@bt.com










































Eardley                     Standards Track                    [Page 20]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5670 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:34 GMT --></html>