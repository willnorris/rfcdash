<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc6183 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:31 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="urn:ietf:rfc:6183" name="DC.Identifier"/>
<meta content="This document describes a framework for IPFIX Mediation. This
framework extends the IPFIX reference model by defining the IPFIX
Mediator components." name="DC.Description.Abstract"/>
<meta content="Ishibashi, Keisuke" name="DC.Creator"/>
<meta content="Muenz, Gerhard" name="DC.Creator"/>
<meta content="Kobayashi, Atsushi" name="DC.Creator"/>
<meta content="Claise, Benoit" name="DC.Creator"/>
<meta content="April, 2011" name="DC.Date.Issued"/>
<meta content="IPFIX Mediation: Framework" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 6183 - IPFIX Mediation: Framework</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgorange" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc6183.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc6183" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-ipfix-mediators-framework" title="draft-ietf-ipfix-mediators-framework">draft-ietf-ipfi...</a>] [<a href="https://datatracker.ietf.org/doc/rfc6183" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc6183" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc6183" title="Side-by-side diff">Diff2</a>] [<a href="https://www.rfc-editor.org/errata_search.php?rfc=6183">Errata</a>]</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                           INFORMATIONAL</span><br/>
<span class="pre noprint docinfo">                                                            <span style="color: #C00;">Errata Exist</span></span><br/>
<pre>Internet Engineering Task Force (IETF)                      A. Kobayashi
Request for Comments: 6183                                           NTT
Updates: <a href="rfc5470.html">5470</a>                                                  B. Claise
Category: Informational                              Cisco Systems, Inc.
ISSN: 2070-1721                                                 G. Muenz
                                                             TU Muenchen
                                                            K. Ishibashi
                                                                     NTT
                                                              April 2011


        <span class="h1">IP Flow Information Export (IPFIX) Mediation: Framework</span>

Abstract

   This document describes a framework for IP Flow Information Export
   (IPFIX) Mediation.  This framework extends the IPFIX reference model
   specified in <a href="rfc5470.html">RFC 5470</a> by defining the IPFIX Mediator components.

Status of This Memo

   This document is not an Internet Standards Track specification; it is
   published for informational purposes.

   This document is a product of the Internet Engineering Task Force
   (IETF).  It represents the consensus of the IETF community.  It has
   received public review and has been approved for publication by the
   Internet Engineering Steering Group (IESG).  Not all documents
   approved by the IESG are a candidate for any level of Internet
   Standard; see <a href="rfc5741.html#section-2">Section 2 of RFC 5741</a>.

   Information about the current status of this document, any errata,
   and how to provide feedback on it may be obtained at
   <a href="http://www.rfc-editor.org/info/rfc6183">http://www.rfc-editor.org/info/rfc6183</a>.

Copyright Notice

   Copyright (c) 2011 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must





<span class="grey">Kobayashi, et al.             Informational                     [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
   <a href="#section-2">2</a>. Terminology and Definitions .....................................<a href="#page-3">3</a>
   <a href="#section-3">3</a>. IPFIX/PSAMP Documents Overview ..................................<a href="#page-6">6</a>
      <a href="#section-3.1">3.1</a>. IPFIX Documents Overview ...................................<a href="#page-6">6</a>
      <a href="#section-3.2">3.2</a>. PSAMP Documents Overview ...................................<a href="#page-6">6</a>
   <a href="#section-4">4</a>. IPFIX Mediation Reference Model .................................<a href="#page-7">7</a>
   <a href="#section-5">5</a>. IPFIX Mediation Functional Blocks ..............................<a href="#page-12">12</a>
      <a href="#section-5.1">5.1</a>. Collecting Process ........................................<a href="#page-12">12</a>
      <a href="#section-5.2">5.2</a>. Exporting Process .........................................<a href="#page-13">13</a>
      <a href="#section-5.3">5.3</a>. Intermediate Process ......................................<a href="#page-13">13</a>
           <a href="#section-5.3.1">5.3.1</a>. Data Record Expiration .............................<a href="#page-14">14</a>
           <a href="#section-5.3.2">5.3.2</a>. Specific Intermediate Processes ....................<a href="#page-14">14</a>
   <a href="#section-6">6</a>. Component Combination ..........................................<a href="#page-20">20</a>
      <a href="#section-6.1">6.1</a>. Data-Based Collector Selection ............................<a href="#page-20">20</a>
      <a href="#section-6.2">6.2</a>. Flow Selection and Aggregation ............................<a href="#page-21">21</a>
      <a href="#section-6.3">6.3</a>. IPFIX File Writer/Reader ..................................<a href="#page-22">22</a>
   <a href="#section-7">7</a>. Encoding for IPFIX Message Header ..............................<a href="#page-22">22</a>
   <a href="#section-8">8</a>. Information Model ..............................................<a href="#page-24">24</a>
   <a href="#section-9">9</a>. Security Considerations ........................................<a href="#page-24">24</a>
      <a href="#section-9.1">9.1</a>. Avoiding Security Level Downgrade .........................<a href="#page-25">25</a>
      <a href="#section-9.2">9.2</a>. Avoiding Security Level Upgrade ...........................<a href="#page-25">25</a>
      <a href="#section-9.3">9.3</a>. Approximating End-to-End Assertions for IPFIX Mediators ...<a href="#page-26">26</a>
      <a href="#section-9.4">9.4</a>. Multiple Tenancy ..........................................<a href="#page-26">26</a>
   <a href="#section-10">10</a>. References ....................................................<a href="#page-27">27</a>
      <a href="#section-10.1">10.1</a>. Normative References .....................................<a href="#page-27">27</a>
      <a href="#section-10.2">10.2</a>. Informative References ...................................<a href="#page-27">27</a>
   <a href="#section-11">11</a>. Acknowledgements ..............................................<a href="#page-29">29</a>


















<span class="grey">Kobayashi, et al.             Informational                     [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   The IP Flow Information Export (IPFIX) architectural components in
   [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>] consist of IPFIX Devices and IPFIX Collectors communicating
   using the IPFIX protocol.  Due to the sustained growth of IP traffic
   in heterogeneous network environments, this Exporter-Collector
   architecture may lead to scalability problems.  In addition, it does
   not provide the flexibility required by a wide variety of measurement
   applications.  A detailed descriptions of these problems is given in
   [<a href="rfc5982.html" title='"IP Flow Information Export (IPFIX) Mediation: Problem Statement"'>RFC5982</a>].

   To fulfill application requirements with limited system resources,
   the IPFIX architecture needs to introduce an intermediate entity
   between Exporters and Collectors.  From a data manipulation point of
   view, this intermediate entity may provide the aggregation,
   correlation, filtering, and modification of Flow Records and/or
   Packet Sampling (PSAMP) Packet Reports to save measurement system
   resources and to perform preprocessing tasks for the Collector.  From
   a protocol conversion point of view, this intermediate entity may
   provide conversion into IPFIX, or conversion of IPFIX transport
   protocols (e.g., from UDP to the Stream Control Transmission Protocol
   (SCTP)) to improve the export reliability.

   This document introduces a generalized concept for such intermediate
   entities and describes the high-level architecture of IPFIX
   Mediation, key IPFIX Mediation architectural components, and
   characteristics of IPFIX Mediation.

   This document is structured as follows: <a href="#section-2">Section 2</a> describes the
   terminology used in this document, <a href="#section-3">Section 3</a> gives an IPFIX/PSAMP
   document overview, <a href="#section-4">Section 4</a> describes a high-level reference model,
   <a href="#section-5">Section 5</a> describes functional features related to IPFIX Mediation,
   <a href="#section-6">Section 6</a> describes combinations of components along with some
   application examples, <a href="#section-7">Section 7</a> describes consideration points of the
   encoding for IPFIX Message Headers, <a href="#section-8">Section 8</a> describes the
   Information Elements used in an IPFIX Mediator, and <a href="#section-9">Section 9</a>
   describes the security issues raised by IPFIX Mediation.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20Terminology%20and%20Definitions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  Terminology and Definitions</span>

   The IPFIX-specific and PSAMP-specific terminology used in this
   document is defined in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] and [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>], respectively.  The
   IPFIX-Mediation-specific terminology used in this document is defined
   in [<a href="rfc5982.html" title='"IP Flow Information Export (IPFIX) Mediation: Problem Statement"'>RFC5982</a>].  However, as reading the problem statements document is
   not a prerequisite to reading this framework document, the
   definitions have been reproduced here along with additional
   definitions.  In this document, as in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] and [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>], the
   first letter of each IPFIX-specific and PSAMP-specific term is



<span class="grey">Kobayashi, et al.             Informational                     [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   capitalized along with the IPFIX-Mediation-specific terms defined
   here.  The use of the terms "must", "should", and "may" in this
   document is informational only.

   In this document, we use the term "record stream" to mean a stream of
   records carrying flow-based or packet-based information.  The records
   may be encoded as IPFIX Data Records or in any other format.

   Transport Session Information

      The Transport Session Information contains information that allows
      the identification of an individual Transport Session as defined
      in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].  If SCTP is used as transport protocol, the
      Transport Session Information identifies the SCTP association.  If
      TCP or UDP is used as transport protocol, the Transport Session
      Information corresponds to the 5-tuple {Exporter IP address,
      Collector IP address, Exporter transport port, Collector transport
      port, transport protocol}.  The Transport Session Information may
      include further details about how Transport Layer Security (TLS)
      [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] or Datagram Transport Layer Security (DTLS) [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] is
      used for encryption and authentication.

   Original Exporter

      An Original Exporter is an IPFIX Device that hosts the Observation
      Points where the metered IP packets are observed.

   IPFIX Mediation

      IPFIX Mediation is the manipulation and conversion of a record
      stream for subsequent export using the IPFIX protocol.

   The following terms are used in this document to describe the
   architectural entities used by IPFIX Mediation.

   Intermediate Process

      An Intermediate Process takes a record stream as its input from
      Collecting Processes, Metering Processes, IPFIX File Readers,
      other Intermediate Processes, or other record sources; performs
      some transformations on this stream based upon the content of each
      record, states maintained across multiple records, or other data
      sources; and passes the transformed record stream as its output to
      Exporting Processes, IPFIX File Writers, or other Intermediate
      Processes in order to perform IPFIX Mediation.  Typically, an
      Intermediate Process is hosted by an IPFIX Mediator.
      Alternatively, an Intermediate Process may be hosted by an
      Original Exporter.



<span class="grey">Kobayashi, et al.             Informational                     [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   Specific Intermediate Processes are described below.  However, this
   is not an exhaustive list.

   Intermediate Conversion Process

      An Intermediate Conversion Process is an Intermediate Process that
      transforms non-IPFIX into IPFIX or manages the relation among
      Templates and states of incoming/outgoing transport sessions in
      the case of transport protocol conversion (e.g., from UDP to
      SCTP).

   Intermediate Aggregation Process

      An Intermediate Aggregation Process is an Intermediate Process
      that aggregates records based upon a set of Flow Keys or functions
      applied to fields from the record (e.g., data binning and subnet
      aggregation).

   Intermediate Correlation Process

      An Intermediate Correlation Process is an Intermediate Process
      that adds information to records, noting correlations among them,
      or generates new records with correlated data from multiple
      records (e.g., the production of bidirectional flow records from
      unidirectional flow records).

   Intermediate Selection Process

      An Intermediate Selection Process is an Intermediate Process that
      selects records from a sequence based upon criteria-evaluated
      record values and passes only those records that match the
      criteria (e.g., filtering only records from a given network to a
      given Collector).

   Intermediate Anonymization Process

      An Intermediate Anonymization Process is an Intermediate Process
      that transforms records in order to anonymize them, to protect the
      identity of the entities described by the records (e.g., by
      applying prefix-preserving pseudonymization of IP addresses).

   IPFIX Mediator

      An IPFIX Mediator is an IPFIX Device that provides IPFIX Mediation
      by receiving a record stream from some data sources, hosting one
      or more Intermediate Processes to transform that stream, and
      exporting the transformed record stream into IPFIX Messages via an
      Exporting Process.  In the common case, an IPFIX Mediator receives



<span class="grey">Kobayashi, et al.             Informational                     [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


      a record stream from a Collecting Process, but it could also
      receive a record stream from data sources not encoded using IPFIX,
      e.g., in the case of conversion from the NetFlow V9 protocol
      [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>] to the IPFIX protocol.

   Note that the IPFIX Mediator is a generalization of the concentrator
   and proxy elements envisioned in the IPFIX requirements [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].
   IPFIX Mediators running appropriate Intermediate Processes provide
   the functionality specified therein.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20IPFIX%2FPSAMP%20Documents%20Overview"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  IPFIX/PSAMP Documents Overview</span>

   IPFIX Mediation can be applied to flow-based or packet-based
   information.  The flow-based information is encoded as IPFIX Flow
   Records by the IPFIX protocol, and the packet-based information is
   extracted by some packet selection techniques and then encoded as
   PSAMP Packet Reports by the PSAMP protocol.  Thus, this section
   describes relevant documents for both protocols.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20IPFIX%20Documents%20Overview"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  IPFIX Documents Overview</span>

   The IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] provides network administrators with
   access to IP Flow information.  The architecture for the export of
   measured IP Flow information from an IPFIX Exporting Process to a
   Collecting Process is defined in [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>], per the requirements
   defined in [<a href="rfc3917.html" title='"Requirements for IP Flow Information Export (IPFIX)"'>RFC3917</a>].  The IPFIX protocol [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] specifies how
   IPFIX Data Records and Templates are carried via a number of
   transport protocols from IPFIX Exporting Processes to IPFIX
   Collecting Processes.  IPFIX has a formal description of IPFIX
   Information Elements, their names, types, and additional semantic
   information, as specified in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  The IPFIX Management
   Information Base is defined in [<a href="rfc5815.html" title='"Definitions of Managed Objects for IP Flow Information Export"'>RFC5815</a>].  Finally, [<a href="rfc5472.html" title='"IP Flow Information Export (IPFIX) Applicability"'>RFC5472</a>]
   describes what types of applications can use the IPFIX protocol and
   how they can use the information provided.  Furthermore, it shows how
   the IPFIX framework relates to other architectures and frameworks.
   The storage of IPFIX Messages in a file is specified in [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>].

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20PSAMP%20Documents%20Overview"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  PSAMP Documents Overview</span>

   The framework for packet selection and reporting [<a href="rfc5474.html" title='"A Framework for Packet Selection and Reporting"'>RFC5474</a>] enables
   network elements to select subsets of packets by statistical and
   other methods and to export a stream of reports on the selected
   packets to a Collector.  The set of packet selection techniques
   (Sampling and Filtering) standardized by PSAMP is described in
   [<a href="rfc5475.html" title='"Sampling and Filtering Techniques for IP Packet Selection"'>RFC5475</a>].  The PSAMP protocol [<a href="rfc5476.html" title='"Packet Sampling (PSAMP) Protocol Specifications"'>RFC5476</a>] specifies the export of
   packet information from a PSAMP Exporting Process to a Collector.
   Like IPFIX, PSAMP has a formal description of its Information




<span class="grey">Kobayashi, et al.             Informational                     [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   Elements, their names, types, and additional semantic information.
   The PSAMP information model is defined in [<a href="rfc5477.html" title='"Information Model for Packet Sampling Exports"'>RFC5477</a>].  The PSAMP
   Management Information Base is described in [<a href="#ref-PSAMP-MIB" title='"Definitions of Managed Objects for Packet Sampling"'>PSAMP-MIB</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20IPFIX%20Mediation%20Reference%20Model"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  IPFIX Mediation Reference Model</span>

   Figure A shows the high-level IPFIX Mediation reference model as an
   extension of the IPFIX reference model presented in [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>].  This
   figure covers the various possible scenarios that can exist in an
   IPFIX measurement system.

       +----------------+  +---------------+    +---------------+
       | Collector 1    |  | Collector 2   |    | Collector N   |
       |[Collecting     |  |[Collecting    |    |[Collecting    |
       |   Process(es)] |  |  Process(es)] |... |  Process(es)] |
       +----^-----------+  +---^--------^--+    +--------^------+
            |                 /          \               |
            |                /            \              |
     Flow Records     Flow Records   Flow Records   Flow Records
            |              /                \            |
     +------+-------------+------+    +------+-----------+--------+
     |IPFIX Mediator N+1         |    |IPFIX Mediator Z           |
     |[Exporting Process(es)]    |    |[Exporting Process(es)]    |
     |[Intermediate Process(es)] |    |[Intermediate Process(es)] |
     |[Collecting Process(es)]   |... |[Collecting Process(es)]   |
     +----^----------------^-----+    +------^----------------^---+
          |                |                 |                |
     Flow Records     Flow Records      Packet Reports  record stream
          |                |                 |                |
   +------+------+  +------+-------+  +------+-------+  +-----+-----+
   |IPFIX        |  |IPFIX Original|  |PSAMP Original|  |Other      |
   |  Mediator 1 |  |   Exporter 1 |  |   Exporter 1 |  |  Source 1 |
   |+-------------+ |+--------------+ |+--------------+ |+-----------+
   +|IPFIX        | +|IPFIX Original| +|PSAMP Original| +|Other      |
    |  Mediator N |  |   Exporter N |  |   Exporter N |  |  Source N |
    |[Exporting   |  |[Exporting    |  |[Exporting    |  |           |
    | Process(es)]|  |  Process(es)]|  |  Process(es)]|  |           |
    |[Intermediate|  |[Metering     |  |[Metering     |  |           |
    | Process(es)]|  |  Process(es)]|  |  Process(es)]|  |           |
    |[Collecting  |  |[Observation  |  |[Observation  |  |           |
    | Process(es)]|  |     Point(s)]|  |     Point(s)]|  |           |
    +------^------+  +-----^-^------+  +-----^-^------+  +-----------+
           |               | |               | |
      Flow Records   Packets coming    Packets coming
                    into Observation  into Observation
                          Points            Points

           Figure A: IPFIX Mediation Reference Model Overview



<span class="grey">Kobayashi, et al.             Informational                     [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   The functional components within each entity are indicated within
   brackets [].  An IPFIX Mediator receives IPFIX Flow Records or PSAMP
   Packet Reports from other IPFIX Mediators, IPFIX Flow Records from
   IPFIX Original Exporters, PSAMP Packet Reports from PSAMP Original
   Exporters, and/or a record stream from other sources.  The IPFIX
   Mediator then exports IPFIX Flow Records and/or PSAMP Packet Reports
   to one or multiple Collectors and/or other IPFIX Mediators.

   Figure B shows the basic IPFIX Mediator component model.  An IPFIX
   Mediator contains one or more Intermediate Processes and one or more
   Exporting Processes.  Typically, it also contains a Collecting
   Process but might contain several Collecting Processes, as described
   in Figure B.

                  IPFIX (Data Records)
                              ^
                            ^ |
   +------------------------|-|---------------------+
   | IPFIX Mediator         | |                     |
   |                        | |                     |
   |  .---------------------|-+-------------------. |
   | .----------------------+--------------------.| |
   | |          Exporting Process(es)            |' |
   | '----------------------^--------------------'  |
   |                        | |                     |
   |  .---------------------|-+-------------------. |
   | .----------------------+--------------------.| |
   | |          Intermediate Process(es)         |' |
   | '----------------------^--------------------'  |
   |                        | |                     |
   |  .---------------------|-+-------------------. |
   | .----------------------+--------------------.| |
   | |          Collecting Process(es)           |' |
   | '----------------------^--------------------'  |
   +------------------------|-|---------------------+
                            |
                  IPFIX (Data Records)

     Figure B: Basic IPFIX Mediator Component Model

   However, other data sources are also possible: an IPFIX Mediator can
   receive a record stream from non-IPFIX protocols such as NetFlow
   [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>] exporter(s).  This document does not make any particular
   assumption on how a record stream is transferred to an IPFIX
   Mediator.  Figure C shows the IPFIX Mediator component model in the
   case of IPFIX protocol conversion from non-IPFIX exporters.





<span class="grey">Kobayashi, et al.             Informational                     [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


                  IPFIX (Data Records)
                              ^
                            ^ |
   +------------------------|-|---------------------+
   | IPFIX Mediator         | |                     |
   |  .---------------------|-+-------------------. |
   | .----------------------+--------------------.| |
   | |          Exporting Process(es)            |' |
   | '----------------------^--------------------'  |
   |  .---------------------|-+-------------------. |
   | .----------------------+--------------------.| |
   | |          Intermediate Process(es)         |' |
   | '----------------------^--------------------'  |
   +------------------------|-----------------------+
                            | record stream
   +------------------------|-----------------------+
   | Non-IPFIX exporter     |                       |
   |          +-------------+----------+            |
   |          |                        |            |
   +----------|------------------------|------------+
              |                        |
            Packets coming into observation points

   Figure C: IPFIX Mediator Component Model in IPFIX
             Protocol Conversion

   Alternatively, an Original Exporter may provide IPFIX Mediation by
   hosting one or more Intermediate Processes.  The component model in
   Figure D adds Intermediate Process(es) to the IPFIX Device model
   illustrated in [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>].  In comparison with Figures 1 or 2 in
   [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>], the Intermediate Process is located between Exporting
   Process(es) and IPFIX or PSAMP Metering Process(es).



















<span class="grey">Kobayashi, et al.             Informational                     [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


                     IPFIX (Data Records)
                               ^ ^
   +---------------------------|-|------------------------+
   | Original Exporter         | |                        |
   |                           | |                        |
   |     .---------------------|-+-------------------.    |
   |    .----------------------+--------------------.|    |
   |    |           Exporting Process(es)           |'    |
   |    '----------------------^--------------------'     |
   |                           | |                        |
   |     .---------------------|-+-------------------.    |
   |    .----------------------+--------------------.|    |
   |    |          Intermediate Process(es)         |'    |
   |    '---------^-----------------------^---------'     |
   |              |      Data Records     |               |
   |   .----------+---------.   .---------+----------.    |
   |   | Metering Process 1 |...| Metering Process N |    |
   |   '----------^---------'   '---------^----------'    |
   |              |                       |               |
   |  .-----------+---------.   .---------+-----------.   |
   |  | Observation Point 1 |...| Observation Point N |   |
   |  '-----------^---------'   '---------^-----------'   |
   +--------------|-----------------------|---------------+
                  |                       |
            Packets coming into Observation Points

   Figure D: IPFIX Mediation Component Model at Original Exporter

   In addition, an Intermediate Process may be collocated with an IPFIX
   File Reader and/or Writer.  Figure E shows an IPFIX Mediation
   component model with an IPFIX File Writer and/or Reader.




















<span class="grey">Kobayashi, et al.             Informational                    [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


                   IPFIX (Data Records)
                               ^
                             ^ |
      .----------------------|-+--------------------.
     .-----------------------+---------------------.|
     |              IPFIX File Writer              |'
     '-----------------------^---------------------'
                             | |
      .----------------------|-+--------------------.
     .-----------------------+---------------------.|
     |          Intermediate Process(es)           |'
     '-----------------------^---------------------'
                             | |
      .----------------------|-+--------------------.
     .-----------------------+---------------------.|
     |              IPFIX File Reader              |'
     '-----------------------^---------------------'
                             |
                   IPFIX (Data Records)

   Figure E: IPFIX Mediation Component Model Collocated
             with IPFIX File Writer/Reader





























<span class="grey">Kobayashi, et al.             Informational                    [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20IPFIX%20Mediation%20Functional%20Blocks"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  IPFIX Mediation Functional Blocks</span>

   Figure F shows a functional block diagram example in an IPFIX
   Mediator that has different Intermediate Process types.

                         IPFIX           IPFIX               IPFIX
                           ^               ^                   ^
                           |               |                   |
     .------------.  .-----+-------. .-----+-------.    .------+------.
     | IPFIX File |  | Exporting   | | Exporting   |    | Exporting   |
     | Writer     |  | Process 1   | | Process 2   |....| Process N   |
     '-----^-^----'  '-----^-------' '-----^-------'    '------^------'
           | |             |               |                   |
           | +-------------+               |                   |
           :          Flow Records / Packet Reports            :
    .------+-------. .-----+--------. .----+---------. .--------------.
    | Intermediate | | Intermediate | | Intermediate | | Intermediate |
    | Anonymization| | Correlation  | | Aggregation  | | Selection    |
    | Process N    | | Process N    | | Process N    | | Process N    |
    '------|-------' '------|-------' '-----|-|------' '-------|------'
           |                +---------------+ |                |
           :                :                 :                :
    .------+-------. .------+-------. .-------+------. .-------+------.
    | Intermediate | | Intermediate | | Intermediate | | Intermediate |
    | Selection    | | Selection    | | Selection    | | Selection    |
    | Process 1    | | Process 2    | | Process 3    | | Process 4    |
    '------|-|-----' '------|-------' '-----|--------' '-------|------'
           | +--------------+               | +----------------+
           |                |               | |                |
           :          Flow Records / Packet Reports            :
    .------+------. .-------+-----.   .-----+-+-----.    .-----+------.
    | Collecting  | | Collecting  |   | Collecting  |    | IPFIX File |
    | Process 1   | | Process 2   |...| Process N   |    | Reader     |
    '------^------' '------^------'   '------^------'    '------------'
           |               |                 |
      Flow Records   Flow Records      Flow Records

         Figure F: IPFIX Mediation Functional Block Diagram

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20Collecting%20Process"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  Collecting Process</span>

   A Collecting Process in an IPFIX Mediator is not different from the
   Collecting Process described in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].  Additional functions in
   an IPFIX Mediator include transmitting the set of Data Records and
   Control Information to one or more components, i.e., Intermediate
   Processes and other applications.  In other words, a Collecting
   Process may duplicate the set and transmit it to one or more
   components in sequence or in parallel.  In the case of an IPFIX



<span class="grey">Kobayashi, et al.             Informational                    [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   Mediator, the Control Information described in [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>] includes
   IPFIX Message Header information and Transport Session Information
   along with information about the Metering Process and the Exporting
   Process in an Original Exporter, e.g., Sampling parameters.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20Exporting%20Process"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  Exporting Process</span>

   An Exporting Process in an IPFIX Mediator is not different from the
   Exporting Process described in [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>].  Additional functions in an
   IPFIX Mediator may include the following:

   o  Receiving the trigger to transmit the Template Withdrawal Messages
      from Intermediate Process(es) when relevant Templates become
      invalid due to, for example, incoming session failure.

   o  Transmitting the origin (e.g., Observation Point, Observation
      Domain ID, Original Exporter IP address, etc.) of the data in
      additional Data Record fields or additional Data Records.  The
      parameters that represent the origin should be configurable.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Intermediate%20Process"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Intermediate Process</span>

   An Intermediate Process is a key functional block for IPFIX
   Mediation.  Its typical functions include the following:

   o  Generating a new record stream from an input record stream
      including context information (e.g., Observation Domain ID and
      Transport Session Information) and transmitting it to other
      components.

   o  Reporting statistics and interpretations for IPFIX Metering
      Processes, PSAMP Metering Processes, and Exporting Processes from
      an Original Exporter.  See <a href="rfc5101.html#section-4">Section 4 of [RFC5101]</a> and <a href="rfc5476.html#section-6">Section 6 of
      [RFC5476]</a> for relevant statistics data structures and
      interpretations, respectively.  Activation of this function should
      be configurable.

   o  Maintaining the configurable relation between Collecting
      Process(es)/Metering Process(es) and Exporting Process(es)/other
      Intermediate Process(es).

   o  Maintaining database(s) of Data Records in the case of an
      Intermediate Aggregation Process and an Intermediate Correlation
      Process.  The function has the Data Record expiration rules
      described in the next subsection.

   o  Maintaining statistics on the Intermediate Process itself, such as
      the number of input/output Data Records, etc.



<span class="grey">Kobayashi, et al.             Informational                    [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   o  Maintaining additional information about output record streams,
      which includes information related to the Original Exporters,
      Observation Domain, and administrative domain as well as some
      configuration parameters related to each function.

   In the case of an Intermediate Aggregation Process, Intermediate
   Anonymization Process, and Intermediate Correlation Process, the
   value of the "flowKeyIndicator" needs to be modified when modifying
   the data structure defined by an original Template.

   For example, an Intermediate Aggregation Process aggregating incoming
   Flow Records composed of the sourceIPv4Address and
   destinationIPv4Address Flow Keys into outgoing Flow Records with the
   destinationIPv4Address Flow Key must modify the incoming
   flowKeyIndicator to contain only the destinationIPv4Address.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.1.%20%20Data%20Record%20Expiration"></a><a class="selflink" href="#section-5.3.1" name="section-5.3.1">5.3.1</a>.  Data Record Expiration</span>

   An Intermediate Aggregation Process and Intermediate Correlation
   Process need to have expiration conditions to export cached Data
   Records.  In the case of the Metering Process in an Original
   Exporter, these conditions are described in [<a href="rfc5470.html" title='"Architecture for IP Flow Information Export"'>RFC5470</a>].  In the case
   of the Intermediate Process, these conditions are as follows:

   o  If there are no input Data Records belonging to a cached Flow for
      a certain time period, aggregated Flow Records will expire.  This
      time period should be configurable at the Intermediate Process.

   o  If the Intermediate Process experiences resource constraints
      (e.g., lack of memory to store Flow Records), aggregated Flow
      Records may prematurely expire.

   o  For long-running Flows, the Intermediate Process should cause the
      Flow to expire on a regular basis or on the basis of an expiration
      policy.  This periodicity or expiration policy should be
      configurable at the Intermediate Process.

   In the case of an Intermediate Correlation Process, a cached Data
   Record may be prematurely expired (and discarded) when no correlation
   can be computed with newly received Data Records.  For example, an
   Intermediate Correlation Process computing one-way delay may discard
   the cached Packet Report when no other matching Packet Report are
   observed within a certain time period.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.%20%20Specific%20Intermediate%20Processes"></a><a class="selflink" href="#section-5.3.2" name="section-5.3.2">5.3.2</a>.  Specific Intermediate Processes</span>

   This section describes the functional blocks of specific Intermediate
   Processes.



<span class="grey">Kobayashi, et al.             Informational                    [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.1.%20%20Intermediate%20Conversion%20Process"></a><a class="selflink" href="#section-5.3.2.1" name="section-5.3.2.1">5.3.2.1</a>.  Intermediate Conversion Process</span>

   When receiving a non-IPFIX record stream, the Intermediate Conversion
   Process covers the following functions:

   o  Determining the IPFIX Information Element identifiers that
      correspond to the fields of the non-IPFIX records (e.g.,
      converting the NetFlow V9 protocol [<a href="rfc3954.html" title='"Cisco Systems NetFlow Services Export Version 9"'>RFC3954</a>] to the IPFIX
      Information Model [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]).

   o  Transforming the non-IPFIX records into Data Records, (Options)
      Template Records, and/or Data Records defined by Options
      Templates.

   o  Converting additional information (e.g., sampling rate, sampling
      algorithm, and observation information) into appropriate fields in
      the existing Data Records or into Data Records defined by new
      Options Templates.

   IPFIX transport protocol conversion can be used to enhance the export
   reliability, for example, for data retention and accounting.  In this
   case, the Intermediate Conversion Process covers the following
   functions:

   o  Relaying Data Records, (Options) Template Records, and Data
      Records defined by Options Templates.

   o  Setting the trigger for the Exporting Process in order to export
      IPFIX Template Withdrawal Messages relevant to the Templates when
      Templates becomes invalid due to, for example, incoming session
      failure.  This case applies to SCTP and TCP Transport Sessions on
      the outgoing side only.

   o  Maintaining the mapping information about Transport Sessions,
      Observation Domain IDs, and Template IDs on the incoming and
      outgoing sides in order to ensure the consistency of scope field
      values of incoming and outgoing Data Records defined by Options
      Templates and of Template IDs of incoming and outgoing IPFIX
      Template Withdrawal Messages.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.2.%20%20Intermediate%20Selection%20Process"></a><a class="selflink" href="#section-5.3.2.2" name="section-5.3.2.2">5.3.2.2</a>.  Intermediate Selection Process</span>

   An Intermediate Selection Process has analogous functions to the
   PSAMP Selection Process described in [<a href="rfc5475.html" title='"Sampling and Filtering Techniques for IP Packet Selection"'>RFC5475</a>].  The difference is
   that the Intermediate Selection Process takes a record stream, e.g.,
   Flow Records or Packet Reports, instead of observed packets as its
   input.




<span class="grey">Kobayashi, et al.             Informational                    [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   The typical function is property match filtering that retrieves a
   record stream of interest.  The function selects a Data Record if the
   value of a specific field in the Data Record equals a configured
   value or falls within a configured range.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.3.%20%20Intermediate%20Aggregation%20Process"></a><a class="selflink" href="#section-5.3.2.3" name="section-5.3.2.3">5.3.2.3</a>.  Intermediate Aggregation Process</span>

   An Intermediate Aggregation Process covers the following functions:

   o  Merging a set of Data Records within a certain time period into
      one Flow Record by summing up the counters where appropriate.

   o  Maintaining statistics and additional information about aggregated
      Flow Records.

      The statistics for an aggregated Flow Record may include the
      number of original Data Records and the maximum and minimum values
      of per-flow counters.  Additional information may include an
      aggregation time period, a new set of Flow Keys, and observation
      location information involved in the Flow aggregation.
      Observation location information can be tuples of (Observation
      Point, Observation Domain ID, Original Exporter IP address) or
      another identifier indicating the location where the measured
      traffic has been observed.

   o  Aggregation of Data Records, which can be done in the following
      ways:

      *  Spatial composition

         With spatial composition, Data Records sharing common
         properties are merged into one Flow Record within a certain
         time period.  One typical aggregation can be based on a new set
         of Flow Keys.  Generally, a set of common properties smaller
         than an original set of Flow Keys results in a higher level of
         aggregation.  Another aggregation can be based on a set of
         Observation Points within an Observation Domain, on a set of
         Observation Domains within an Exporter, or on a set of
         Exporters.

         If some fields do not serve as Flow Keys or per-Flow counters,
         their values may change from Data Records to Data Records
         within an aggregated Flow Record.  The Intermediate Aggregation
         Process determines their values by the first Data Record
         received, a specific Exporter IP address, or other appropriate
         decisions.





<span class="grey">Kobayashi, et al.             Informational                    [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


         Furthermore, a new identifier indicating a group of observation
         locations can be introduced, for example, to indicate PoPs
         (Points of Presence) in a large network, or a logical interface
         composed of physical interfaces with link aggregation.

      *  Temporal composition

         With temporal composition, multiple Flow Records with identical
         Flow Key values are merged into a single Flow Record of longer
         Flow duration if they arrive within a certain time interval.
         The main difference to spatial composition is that Flow Records
         are only merged if they originate from the same Observation
         Point and if the Flow Key values are identical.  For example,
         multiple Flow Records with a Flow duration of less than one
         minute can be merged into a single Flow Record with more than
         ten minutes Flow duration.

         In addition, the Intermediate Aggregation Process with temporal
         composition produces aggregated counters while reducing the
         number of Flow Records on a Collector.  Some specific non-key
         fields, such as the minimumIpTotalLength/maximumIpTotalLength
         or minimumTTL/maximumTTL, will contain the minimum and maximum
         values for the new aggregated Flow.

      Spatial and temporal composition can be combined in a single
      Intermediate Aggregation Process.  The Intermediate Aggregation
      Process can be combined with the Intermediate Selection Process in
      order to aggregate only a subset of the original Flow Records, for
      example, Flow Records with small numbers of packets as described
      in <a href="#section-6.2">Section 6.2</a>.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.4.%20%20Intermediate%20Anonymization%20Process"></a><a class="selflink" href="#section-5.3.2.4" name="section-5.3.2.4">5.3.2.4</a>.  Intermediate Anonymization Process</span>

   An Intermediate Anonymization Process covers the following typical
   functions:

   o  Deleting specified fields

      The function deletes existing fields in accordance with some
      instruction rules.  Examples include hiding network topology
      information and private information.  In the case of feeding Data
      Records to end customers, disclosing vulnerabilities is avoided by
      deleting fields, e.g., "ipNextHopIP{v4|v6}Address",
      "bgpNextHopIP{v4|v6}Address", "bgp{Next|Prev}AdjacentAsNumber",
      and "mplsLabelStackSection", as described in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].






<span class="grey">Kobayashi, et al.             Informational                    [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   o  Anonymizing values of specified fields

      The function modifies the values of specified fields.  Examples
      include anonymizing customers' private information, such as IP
      address and port number, in accordance with a privacy protection
      policy.  The Intermediate Anonymization Process may also report
      anonymized fields and the anonymization method as additional
      information.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/5.3.2.5.%20%20Intermediate%20Correlation%20Process"></a><a class="selflink" href="#section-5.3.2.5" name="section-5.3.2.5">5.3.2.5</a>.  Intermediate Correlation Process</span>

   An Intermediate Correlation Process can be viewed as a special case
   of the Intermediate Aggregation Process, covering the following
   typical functions:

   o  Producing new information including metrics, counters, attributes,
      or packet property parameters by evaluating the correlation among
      sets of Data Records or among Data Records and other meta data
      after gathering sets of Data Records within a certain time period.

   o  Adding new fields into a Data Record or creating a new Data
      Record.

   A correlation of Data Records can be done in the following ways,
   which can be implemented individually or in combinations.

   o  One-to-one correlation between Data Records, with the following
      examples:

      *  One-way delay, Packet delay variation in [<a href="rfc5481.html" title='"Packet Delay Variation Applicability Statement"'>RFC5481</a>]
         The metrics come from the correlation of the timestamp value on
         a pair of Packet Reports indicating an identical packet at
         different Observation Points in the network.

      *  Packet inter-arrival time
         The metrics come from the correlation of the timestamp value on
         consecutive Packet Reports from a single Exporter.

      *  Rate-limiting ratio, compression ratio, optimization ratio,
         etc.
         The data values come from the correlation of Data Records
         indicating an identical Flow observed on the incoming/outgoing
         points of a WAN interface.








<span class="grey">Kobayashi, et al.             Informational                    [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   o  Correlation amongst Data Records, with the following examples:

      *  Bidirectional Flow composition
         The method of exporting and representing a Bidirectional Flow
         (Biflow) is described in [<a href="rfc5103.html" title='"Bidirectional Flow Export Using IP Flow Information Export (IPFIX)"'>RFC5103</a>].  The Bidirectional Flow
         composition is a special case of Flow Key aggregation.  The
         Flow Records are merged into one Flow Record as Biflow if Non-
         directional Key Fields match and the Directional Key Fields
         match their reverse direction counterparts.  The direction
         assignment method to assign the Biflow Source and Destination
         as additional information may be reported.  In the case of an
         Intermediate Aggregation Process, the direction may be assigned
         arbitrarily (see <a href="rfc5103.html#section-5.3">[RFC5103], Section 5.3</a>).

      *  Average/maximum/minimum for packets, bytes, one-way delay,
         packet loss, etc.
         The data values come from the correlation of multiple Data
         Records gathered in a certain time interval.

   o  Correlation between Data Record and other meta data

      Typical examples are derived packet property parameters described
      in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>].  The parameters are retrieved based on the value of
      the specified field in an input Data Record, compensating for
      traditional exporting devices or probes that are unable to add
      packet property parameters.  Typical derived packet property
      parameters are as follows:

      *  "bgpNextHop{IPv4|IPv6}Address" described in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]
         This value indicates the egress router of a network domain.  It
         is useful for making a traffic matrix that covers the whole
         network domain.

      *  BGP community attributes
         This attribute indicates tagging for routes of geographical and
         topological information and source types (e.g., transit, peer,
         or customer) as described in [<a href="rfc4384.html" title='"BGP Communities for Data Collection"'>RFC4384</a>].  Therefore, network
         administrators can monitor the geographically-based or source-
         type-based traffic volume by correlating the attribute.

      *  "mplsVpnRouteDistinguisher" described in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]
         This value indicates the VPN customer's identification, which
         cannot be extracted from the core router in MPLS networks.
         Thanks to this correlation, network administrators can monitor
         the customer-based traffic volume even on core routers.






<span class="grey">Kobayashi, et al.             Informational                    [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Component%20Combination"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Component Combination</span>

   An IPFIX Mediator may be able to simultaneously support more than one
   Intermediate Process.  Multiple Intermediate Processes generally are
   configured in the following ways.

   o  Parallel Intermediate Processes

      A record stream is processed by multiple Intermediate Processes in
      parallel to fulfill the requirements of different applications.
      In this setup, every Intermediate Process receives a copy of the
      entire record stream as its input.

   o  Serial Intermediate Processes

      To execute flexible manipulation of a record stream, the
      Intermediate Processes are connected serially.  In that case, an
      output record stream from one Intermediate Process forms an input
      record stream for a succeeding Intermediate Process.

   In addition to the combination of Intermediate Processes, the
   combination of some components (Exporting Process, Collecting
   Process, IPFIX File Writer and Reader) can be applied to provide
   various data reduction techniques.  This section shows some
   combinations along with examples.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Data-Based%20Collector%20Selection"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Data-Based Collector Selection</span>

   The combination of one or more Intermediate Selection Processes and
   Exporting Processes can determine to which Collector input Data
   Records are exported.  Applicable examples include exporting Data
   Records to a dedicated Collector on the basis of a customer or an
   organization.  For example, an Intermediate Selection Process selects
   Data Records from a record stream on the basis of the peering
   autonomous system number, and an Exporting Process sends them to a
   dedicated Collector, as shown in the Figure G.















<span class="grey">Kobayashi, et al.             Informational                    [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


             .----------------------.   .------------.
             | Intermediate         |   | Exporting  |
             |  Selection Process 1 |   |  Process 1 |
          +--+--- Peering AS #10 ---+--&gt;|            +--&gt; Collector 1
          |  '----------------------'   '------------'
          |  .----------------------.   .------------.
   record |  | Intermediate         |   | Exporting  |
   stream |  |  Selection Process 2 |   |  Process 2 |
   -------+--+--- Peering AS #20 ---+--&gt;|            +--&gt; Collector 2
          |  '----------------------'   '------------'
          |  .----------------------.   .------------.
          |  | Intermediate         |   | Exporting  |
          |  |  Selection Process 3 |   |  Process 3 |
          +--+--- Peering AS #30 ---+--&gt;|            +--&gt; Collector 3
             '----------------------'   '------------'

             Figure G: Data-Based Collector Selection

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Flow%20Selection%20and%20Aggregation"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Flow Selection and Aggregation</span>

   The combination of one or more Intermediate Selection Processes and
   Intermediate Aggregation Processes can efficiently reduce the amount
   of Flow Records.  The combination structure is similar to the concept
   of the Composite Selector described in [<a href="rfc5474.html" title='"A Framework for Packet Selection and Reporting"'>RFC5474</a>].  For example, an
   Intermediate Selection Process selects Flows consisting of a small
   number of packets and then transmits them to an Intermediate
   Aggregation Process.  Another Intermediate Selection Process selects
   other Flow Records and then transmits them to an Exporting Process,
   as shown in Figure H.  This results in aggregation on the basis of
   the distribution of the number of packets per Flow.

            .------------------.  .--------------.  .------------.
            | Intermediate     |  | Intermediate |  | Exporting  |
            |   Selection      |  |  Aggregation |  |    Process |
            |        Process 1 |  |     Process  |  |            |
          +-+ packetDeltaCount +-&gt;|              +-&gt;|            |
          | |             &lt;= 5 |  |              |  |            |
   record | '------------------'  '--------------'  |            |
   stream | .------------------.                    |            |
   -------+ | Intermediate     |                    |            |
          | |   Selection      |                    |            |
          | |        Process 2 |                    |            |
          +-+ packetDeltaCount +-------------------&gt;|            |
            |              &gt; 5 |                    |            |
            '------------------'                    '------------'

          Figure H: Flow Selection and Aggregation Example




<span class="grey">Kobayashi, et al.             Informational                    [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20IPFIX%20File%20Writer%2FReader"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  IPFIX File Writer/Reader</span>

   An IPFIX File Writer [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>] stores Data Records in a file system.
   When Data Records include problematic Information Elements, an
   Intermediate Anonymization Process can delete these fields before the
   IPFIX File Writer handles them, as shown in Figure I.

          .---------------.  .---------------.  .-------------.
          | Collecting    |  | Intermediate  |  | IPFIX       |
    IPFIX |      Process  |  | Anonymization |  |   File      |
    -----&gt;|               +-&gt;|       Process +-&gt;|      Writer |
          '---------------'  '---------------'  '-------------'

      Figure I: IPFIX Mediation Example with IPFIX File Writer

   In contrast, an IPFIX File Reader [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>] retrieves stored Data
   Records when administrators want to retrieve past Data Records from a
   given time period.  If the data structure of the Data Records from
   the IPFIX File Reader is different from what administrators want, an
   Intermediate Anonymization Process and Intermediate Correlation
   Process can modify the data structure, as shown in Figure J.

    .-------------.  .---------------.  .---------------.  .-----------.
    | IPFIX       |  | Intermediate  |  | Intermediate  |  | Exporting |
    |   File      |  | Anonymization |  |   Correlation |  |   Process |
    |      Reader +-&gt;|       Process +-&gt;|       Process +-&gt;|           |
    '-------------'  '---------------'  '---------------'  '-----------'

      Figure J: IPFIX Mediation Example with IPFIX File Reader

   In the case where distributed IPFIX Mediators enable on-demand export
   of Data Records that have been previously stored by a File Writer, a
   collecting infrastructure with huge storage capacity for data
   retention can be set up.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Encoding%20for%20IPFIX%20Message%20Header"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Encoding for IPFIX Message Header</span>

   The IPFIX Message Header [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] includes Export Time, Sequence
   Number, and Observation Domain ID fields.  This section describes
   some consideration points for the IPFIX Message Header encoding in
   the context of IPFIX Mediation.

   Export Time

      An IPFIX Mediator can set the Export Time in two ways.

      *  Case 1: keeping the field value of incoming Transport Sessions




<span class="grey">Kobayashi, et al.             Informational                    [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


      *  Case 2: setting the time at which an IPFIX Message leaves the
         IPFIX Mediator

      Case 1 can be applied when an IPFIX Mediator operates as a proxy
      at the IPFIX Message level rather than the Data Record level.  In
      case 2, the IPFIX Mediator needs to handle any delta timestamp
      fields described in [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>], such as
      "flowStartDeltaMicroseconds" and "flowEndDeltaMicroseconds".

   Sequence Number

      In the case where an IPFIX Mediator relays IPFIX Messages from one
      Transport Session to another Transport Session, the IPFIX Mediator
      needs to handle the Sequence Number properly.  In particular, the
      Sequence Number in the outgoing session is not allowed to be re-
      initialized, even when the incoming session shuts down and
      restarts.

   Observation Domain ID

      According to [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>], the Observation Domain ID in the IPFIX
      Message Header is locally unique per Exporting Process.  In
      contrast to the Observation Domain ID used by an Original
      Exporter, the Observation Domain ID used by an IPFIX Mediator does
      not necessarily represent a set of Observation Points located at
      the IPFIX Mediator itself.

      An IPFIX Mediator may act as a proxy by relaying entire IPFIX
      Messages.  In this case, it may report information about the
      Original Exporters by using the Observation Domain ID of the
      outgoing Messages as the scope field in an Options Template
      Record.

      Otherwise, the IPFIX Mediator should have a function to export the
      observation location information regarding the Original Exporter.
      The information contains the IP addresses and Observation Domain
      IDs used by the Original Exporters and some information about the
      Transport Session, for example, the source port number, so that
      different Exporting Processes on the same Original Exporter can be
      identified.  As far as privacy policy permits, an IPFIX Mediator
      reports the information to an IPFIX Collector.

      If information about a set of Original Exporters needs to be
      reported, it can be useful to export it as Common Properties as
      specified in [<a href="rfc5473.html" title='"Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports"'>RFC5473</a>].  The commonPropertiesID may then serve as
      a scope for the set of Original Exporters.  The Common Properties





<span class="grey">Kobayashi, et al.             Informational                    [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


      Withdrawal Message [<a href="rfc5473.html" title='"Reducing Redundancy in IP Flow Information Export (IPFIX) and Packet Sampling (PSAMP) Reports"'>RFC5473</a>] can be used to indicate that an
      incoming Transport Session from one of the Original Exporters was
      closed.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20Information%20Model"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  Information Model</span>

   IPFIX Mediation reuses the general information models from [<a href="rfc5102.html" title='"Information Model for IP Flow Information Export"'>RFC5102</a>]
   and [<a href="rfc5477.html" title='"Information Model for Packet Sampling Exports"'>RFC5477</a>], and, depending on the Intermediate Processes type,
   potentially Information Elements such as:

   o  Original Exporter IP address, Observation Domain ID, and source
      port number about the Transport Session at the Original Exporter,
      in the case where an IPFIX Mediator reports original observation
      location information in <a href="#section-7">Section 7</a>.  The Information Elements
      contained in the Export Session Details Options Template in
      [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>] may be utilized for this purpose.

   o  Report on the applied IPFIX Mediation functions as described in
      <a href="rfc5982.html#section-6.7">Section 6.7. in [RFC5982]</a>.

   o  Certificate of an Original Exporter in <a href="#section-9">Section 9</a>.  The Information
      Element exporterCertificate in [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>] may be utilized for this
      purpose.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/9.%20%20Security%20Considerations"></a><a class="selflink" href="#section-9" name="section-9">9</a>.  Security Considerations</span>

   As Mediators act as both IPFIX Collecting Processes and Exporting
   Processes, the Security Considerations for IPFIX [<a href="rfc5101.html" title='"Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"'>RFC5101</a>] also apply
   to Mediators.  The Security Considerations for IPFIX Files [<a href="rfc5655.html" title='"Specification of the IP Flow Information Export (IPFIX) File Format"'>RFC5655</a>]
   also apply to IPFIX Mediators that write IPFIX Files or use them for
   internal storage.  In addition, there are a few specific
   considerations that IPFIX Mediator implementations must take into
   account.

   By design, IPFIX Mediators are "men-in-the-middle": they intercede in
   the communication between an Original Exporter (or another upstream
   Mediator) and a downstream Collecting Process.  TLS provides no way
   to connect the session between the Mediator and the Original Exporter
   to the session between the Mediator and the downstream Collecting
   Process; indeed, this is by design.  This has important implications
   for the level of confidentiality provided across an IPFIX Mediator
   and the ability to protect data integrity and Original Exporter
   authenticity across a Mediator.  In general, a Mediator should
   maintain the same level of integrity and confidentiality protection
   on both sides of the mediation operation, except in situations where
   the Mediator is explicitly deployed as a gateway between trusted and
   untrusted networks.




<span class="grey">Kobayashi, et al.             Informational                    [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   Subsequent subsections deal with specific security issues raised by
   IPFIX Mediation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.1.%20%20Avoiding%20Security%20Level%20Downgrade"></a><a class="selflink" href="#section-9.1" name="section-9.1">9.1</a>.  Avoiding Security Level Downgrade</span>

   An IPFIX Mediator that accepts IPFIX Messages over a Transport
   Session protected by TLS [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>] or DTLS [<a href="rfc4347.html" title='"Datagram Transport Layer Security"'>RFC4347</a>] and that then
   exports IPFIX Messages derived therefrom in cleartext is a
   potentially serious vulnerability in an IPFIX infrastructure.  The
   concern here is that confidentiality protection may be lost across a
   Mediator.

   Therefore, an IPFIX Mediator that receives IPFIX Messages from an
   upstream Exporting Process protected using TLS or DTLS must provide
   for sending of IPFIX Messages resulting from the operation of the
   Intermediate Process(es) to a downstream Collecting Process using TLS
   or DTLS by default.  It may be configurable to export records derived
   from protected records in cleartext but only when application
   requirements allow.

   There are two common use cases for this.  First, a Mediator
   performing a transformation that leads to a reduction in the required
   level of security (e.g., by removing all information requiring
   confidentiality from the output records) may export records
   downstream without confidentiality protection.  Second, a mediator
   that acts as a proxy between an external (untrusted) network and an
   internal (trusted) network may export records without TLS when the
   additional overhead of TLS is unnecessary (e.g., on a physically
   protected network in the same locked equipment rack).

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.2.%20%20Avoiding%20Security%20Level%20Upgrade"></a><a class="selflink" href="#section-9.2" name="section-9.2">9.2</a>.  Avoiding Security Level Upgrade</span>

   There is a similar problem in the opposite direction: as an IPFIX
   Mediator's signature on a TLS session to a downstream Collecting
   Process acts as an implicit assertion of the trustworthiness of the
   data within the session, a poorly deployed IPFIX Mediator could be
   used to "legitimize" records derived from untrusted sources.
   Unprotected sessions from the Original Exporter are generally
   untrusted, because they could have been tampered with or forged by an
   unauthorized third party.  The concern here is that a Mediator could
   be used to add inappropriate trust to external information whose
   integrity cannot be guaranteed.

   When specific deployment requirements allow, an IPFIX Mediator may
   export signed IPFIX Messages containing records derived from records
   received without integrity protection via TLS.  One such deployment
   consideration would be the reverse of the second case above: when the
   Mediator acts as a proxy between an internal (trusted) and an



<span class="grey">Kobayashi, et al.             Informational                    [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   external (untrusted) network and when the path from the Original
   Exporter is protected using some other method and the overhead of a
   TLS session is unnecessary.

   In such cases, the IPFIX Mediator should notify the downstream
   Collector about the missing protection of all or part of the original
   record stream as part of the Transport Session Information.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.3.%20%20Approximating%20End-to-End%20Assertions%20for%20IPFIX%20Mediators"></a><a class="selflink" href="#section-9.3" name="section-9.3">9.3</a>.  Approximating End-to-End Assertions for IPFIX Mediators</span>

   Because the Transport Session between an IPFIX Mediator and an
   Original Exporter is independent from the Transport Session between
   the Mediator and the downstream Collecting Process, there is no
   existing method via TLS to assert the identity of the original
   Exporting Process downstream.  However, an IPFIX Mediator, which
   modifies the stream of IPFIX Messages sent to it, is by definition a
   trusted entity in the infrastructure.  Therefore, the IPFIX
   Mediator's signature on an outgoing Transport Session can be treated
   as an implicit assertion that the Original Exporter was positively
   identified by the Mediator and that the source information it
   received was trustworthy.  However, as noted in the previous section,
   IPFIX Mediators must in this circumstance take care not to provide an
   inappropriate upgrade of trust.

   If the X.509 certificates [<a href="rfc5280.html" title='"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"'>RFC5280</a>] used to protect a Transport
   Session between an Original Exporter and an IPFIX Mediator are
   required downstream, an IPFIX Mediator may export Transport Session
   Information, including the exporterCertificate and the
   collectorCertificate Information Elements, with the Export Session
   Details Options Template defined in <a href="rfc5655.html#section-8.1.3">Section 8.1.3 of [RFC5655]</a> or the
   Message Details Options Template defined in <a href="rfc5655.html#section-8.1.4">Section 8.1.4 of
   [RFC5655]</a> in order to export this information downstream.  However,
   in this case, the IPFIX Mediator is making an implicit assertion that
   the upstream session was properly protected and therefore trustworthy
   or that the Mediator has otherwise been configured to trust the
   information from the Original Exporter and, as such, must protect the
   Transport Session to the downstream Collector using TLS or DTLS as
   well.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/9.4.%20%20Multiple%20Tenancy"></a><a class="selflink" href="#section-9.4" name="section-9.4">9.4</a>.  Multiple Tenancy</span>

   Information from multiple sources may only be combined within a
   Mediator when that Mediator is applied for that specific purpose
   (e.g., spatial aggregation or concentration of records).  In all
   other cases, an IPFIX Mediator must provide for keeping traffic data
   from multiple sources separate.  Though the details of this are
   application-specific, this generally entails separating Transport




<span class="grey">Kobayashi, et al.             Informational                    [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   Sessions within the Mediator and associating them with information
   related to the source or purpose, e.g., network or hardware address
   range, virtual LAN tag, interface identifiers, and so on.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/10.%20%20References"></a><a class="selflink" href="#section-10" name="section-10">10</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.1.%20%20Normative%20References"></a><a class="selflink" href="#section-10.1" name="section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC5101" name="ref-RFC5101">RFC5101</a>]   Claise, B., Ed., "Specification of the IP Flow
               Information Export (IPFIX) Protocol for the Exchange of
               IP Traffic Flow Information", <a href="rfc5101.html">RFC 5101</a>, January 2008.

   [<a id="ref-RFC5470" name="ref-RFC5470">RFC5470</a>]   Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek,
               "Architecture for IP Flow Information Export", <a href="rfc5470.html">RFC 5470</a>,
               March 2009.

   [<a id="ref-RFC5476" name="ref-RFC5476">RFC5476</a>]   Claise, B., Ed., Johnson, A., and J. Quittek, "Packet
               Sampling (PSAMP) Protocol Specifications", <a href="rfc5476.html">RFC 5476</a>,
               March 2009.

   [<a id="ref-RFC5655" name="ref-RFC5655">RFC5655</a>]   Trammell, B., Boschi, E., Mark, L., Zseby, T., and A.
               Wagner, "Specification of the IP Flow Information Export
               (IPFIX) File Format", <a href="rfc5655.html">RFC 5655</a>, October 2009.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/10.2.%20%20Informative%20References"></a><a class="selflink" href="#section-10.2" name="section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-PSAMP-MIB" name="ref-PSAMP-MIB">PSAMP-MIB</a>] Dietz, T., Claise, B., and J. Quittek, "Definitions of
               Managed Objects for Packet Sampling", Work in Progress,
               March 2011.

   [<a id="ref-RFC3917" name="ref-RFC3917">RFC3917</a>]   Quittek, J., Zseby, T., Claise, B., and S. Zander,
               "Requirements for IP Flow Information Export (IPFIX)",
               <a href="rfc3917.html">RFC 3917</a>, October 2004.

   [<a id="ref-RFC3954" name="ref-RFC3954">RFC3954</a>]   Claise, B., Ed., "Cisco Systems NetFlow Services Export
               Version 9", <a href="rfc3954.html">RFC 3954</a>, October 2004.

   [<a id="ref-RFC4347" name="ref-RFC4347">RFC4347</a>]   Rescorla, E. and N. Modadugu, "Datagram Transport Layer
               Security", <a href="rfc4347.html">RFC 4347</a>, April 2006.

   [<a id="ref-RFC4384" name="ref-RFC4384">RFC4384</a>]   Meyer, D., "BGP Communities for Data Collection", <a href="https://tools.ietf.org/html/bcp114">BCP</a>
               <a href="https://tools.ietf.org/html/bcp114">114</a>, <a href="rfc4384.html">RFC 4384</a>, February 2006.

   [<a id="ref-RFC5102" name="ref-RFC5102">RFC5102</a>]   Quittek, J., Bryant, S., Claise, B., Aitken, P., and J.
               Meyer, "Information Model for IP Flow Information
               Export", <a href="rfc5102.html">RFC 5102</a>, January 2008.





<span class="grey">Kobayashi, et al.             Informational                    [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


   [<a id="ref-RFC5103" name="ref-RFC5103">RFC5103</a>]   Trammell, B. and E. Boschi, "Bidirectional Flow Export
               Using IP Flow Information Export (IPFIX)", <a href="rfc5103.html">RFC 5103</a>,
               January 2008.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]   Dierks, T. and E. Rescorla, "The Transport Layer Security
               (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>, August 2008.

   [<a id="ref-RFC5280" name="ref-RFC5280">RFC5280</a>]   Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
               Housley, R., and W. Polk, "Internet X.509 Public Key
               Infrastructure Certificate and Certificate Revocation
               List (CRL) Profile", <a href="rfc5280.html">RFC 5280</a>, May 2008.

   [<a id="ref-RFC5472" name="ref-RFC5472">RFC5472</a>]   Zseby, T., Boschi, E., Brownlee, N., and B. Claise, "IP
               Flow Information Export (IPFIX) Applicability", <a href="rfc5472.html">RFC 5472</a>,
               March 2009.

   [<a id="ref-RFC5473" name="ref-RFC5473">RFC5473</a>]   Boschi, E., Mark, L., and B. Claise, "Reducing Redundancy
               in IP Flow Information Export (IPFIX) and Packet Sampling
               (PSAMP) Reports", <a href="rfc5473.html">RFC 5473</a>, March 2009.

   [<a id="ref-RFC5474" name="ref-RFC5474">RFC5474</a>]   Duffield, N., Ed., Chiou, D., Claise, B., Greenberg, A.,
               Grossglauser, M., and J. Rexford, "A Framework for Packet
               Selection and Reporting", <a href="rfc5474.html">RFC 5474</a>, March 2009.

   [<a id="ref-RFC5475" name="ref-RFC5475">RFC5475</a>]   Zseby, T., Molina, M., Duffield, N., Niccolini, S., and
               F. Raspall, "Sampling and Filtering Techniques for IP
               Packet Selection", <a href="rfc5475.html">RFC 5475</a>, March 2009.

   [<a id="ref-RFC5477" name="ref-RFC5477">RFC5477</a>]   Dietz, T., Claise, B., Aitken, P., Dressler, F., and G.
               Carle, "Information Model for Packet Sampling Exports",
               <a href="rfc5477.html">RFC 5477</a>, March 2009.

   [<a id="ref-RFC5481" name="ref-RFC5481">RFC5481</a>]   Morton, A. and B. Claise, "Packet Delay Variation
               Applicability Statement", <a href="rfc5481.html">RFC 5481</a>, March 2009.

   [<a id="ref-RFC5815" name="ref-RFC5815">RFC5815</a>]   Dietz, T., Ed., Kobayashi, A., Claise, B., and G. Muenz,
               "Definitions of Managed Objects for IP Flow Information
               Export", <a href="rfc5815.html">RFC 5815</a>, April 2010.

   [<a id="ref-RFC5982" name="ref-RFC5982">RFC5982</a>]   Kobayashi, A., Ed., and B. Claise, Ed., "IP Flow
               Information Export (IPFIX) Mediation: Problem Statement",
               <a href="rfc5982.html">RFC 5982</a>, August 2010.









<span class="grey">Kobayashi, et al.             Informational                    [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc6183.html">RFC 6183</a>               IPFIX Mediation: Framework             April 2011</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/11.%20%20Acknowledgements"></a><a class="selflink" href="#section-11" name="section-11">11</a>.  Acknowledgements</span>

   We would like to thank the following persons: Brian Trammell for his
   contribution regarding the improvement of the terminology section and
   the security considerations section; Daisuke Matsubara, Tsuyoshi
   Kondoh, Hiroshi Kurakami, and Haruhiko Nishida for their contribution
   during the initial phases of the document; Nevil Brownlee and Juergen
   Quittek for their technical reviews and feedback.

Authors' Addresses

   Atsushi Kobayashi
   Nippon Telegraph and Telephone East Corporation
   26F 3-20-2, Nishi-shinjuku 3-chome
   Shinjuku, Tokyo 163-8019
   Japan
   Phone: +81-3-5353-3636
   EMail: akoba@orange.plala.or.jp


   Benoit Claise
   Cisco Systems, Inc.
   De Kleetlaan 6a b1
   Diegem 1831
   Belgium
   Phone: +32 2 704 5622
   EMail: bclaise@cisco.com


   Gerhard Muenz
   Technische Universitaet Muenchen
   Boltzmannstr. 3
   Garching 85748
   Germany
   EMail: muenz@net.in.tum.de
   URI: <a href="http://www.net.in.tum.de/~muenz">http://www.net.in.tum.de/~muenz</a>


   Keisuke Ishibashi
   NTT Service Integration Platform Laboratories
   3-9-11 Midori-cho
   Musashino-shi 180-8585
   Japan
   Phone: +81-422-59-3407
   EMail: ishibashi.keisuke@lab.ntt.co.jp






Kobayashi, et al.             Informational                    [Page 29]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc6183 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:31 GMT --></html>