<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><!-- Mirrored from tools.ietf.org/html/rfc5353 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="index,follow" name="robots"/>
    <meta content="rfcmarkup version 1.126" name="creator"/>
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC"/>
<meta content="draft-xie-rserpool-enrp" name="DC.Relation.Replaces"/>
<meta content="urn:ietf:rfc:5353" name="DC.Identifier"/>
<meta content="September, 2008" name="DC.Date.Issued"/>
<meta content="Tuexen, Michael" name="DC.Creator"/>
<meta content="Silverton, Aron J." name="DC.Creator"/>
<meta content="Stillman, Maureen" name="DC.Creator"/>
<meta content="Xie, Qiaobing" name="DC.Creator"/>
<meta content="Stewart, Randall" name="DC.Creator"/>
<meta content="The Endpoint Handlespace Redundancy Protocol (ENRP) is designed to
work in conjunction with the Aggregate Server Access Protocol (ASAP)
to accomplish the functionality of the Reliable Server Pooling
(RSerPool) requirements and architecture. Within the operational scope
of RSerPool, ENRP defines the procedures and message formats of a
distributed, fault-tolerant registry service for storing, bookkeeping,
retrieving, and distributing pool operation and membership
information. This memo defines an Experimental Protocol for the
Internet community." name="DC.Description.Abstract"/>
<meta content="Endpoint Handlespace Redundancy Protocol (ENRP)" name="DC.Title"/>

    <link href="https://tools.ietf.org/images/rfc.png" rel="icon" type="image/png"/>
    <link href="https://tools.ietf.org/images/rfc.png" rel="shortcut icon" type="image/png"/>
    <title>RFC 5353 - Endpoint Handlespace Redundancy Protocol (ENRP)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0 1px; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div class="pre noprint docinfo bgyellow" onclick="showElem('legend');" onmouseout="hideElem('legend')" onmouseover="this.style.cursor='pointer';" style="height: 6px; position: absolute;" title="Click for colour legend.">                                                                        </div>
      <div class="docinfo noprint pre legend" id="legend" onmouseout="hideElem('legend');" onmouseover="showElem('legend');" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
      </div>
   </div>
<span class="pre noprint docinfo top">[<a href="index.html" title="Document search and retrieval page">Docs</a>] [<a href="https://tools.ietf.org/rfc/rfc5353.txt" title="Plaintext version of this document">txt</a>|<a href="https://tools.ietf.org/pdf/rfc5353" title="PDF version of this document">pdf</a>] [<a href="https://tools.ietf.org/html/draft-ietf-rserpool-enrp" title="draft-ietf-rserpool-enrp">draft-ietf-rser...</a>] [<a href="https://datatracker.ietf.org/doc/rfc5353" title="IESG Datatracker information for this document">Tracker</a>] [<a href="https://tools.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=rfc5353" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://tools.ietf.org/rfcdiff?url2=rfc5353" title="Side-by-side diff">Diff2</a>]         </span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<span class="pre noprint docinfo">                                                            EXPERIMENTAL</span><br/>
<span class="pre noprint docinfo">                                                                        </span><br/>
<pre>Network Working Group                                             Q. Xie
Request for Comments: 5353                                    R. Stewart
Category: Experimental                                The Resource Group
                                                             M. Stillman
                                                                   Nokia
                                                               M. Tuexen
                                      Muenster Univ. of Applied Sciences
                                                            A. Silverton
                                                  Sun Microsystems, Inc.
                                                          September 2008


            <span class="h1">Endpoint Handlespace Redundancy Protocol (ENRP)</span>

Status of This Memo

   This memo defines an Experimental Protocol for the Internet
   community.  It does not specify an Internet standard of any kind.
   Discussion and suggestions for improvement are requested.
   Distribution of this memo is unlimited.

Abstract

   The Endpoint Handlespace Redundancy Protocol (ENRP) is designed to
   work in conjunction with the Aggregate Server Access Protocol (ASAP)
   to accomplish the functionality of the Reliable Server Pooling
   (RSerPool) requirements and architecture.  Within the operational
   scope of RSerPool, ENRP defines the procedures and message formats of
   a distributed, fault-tolerant registry service for storing,
   bookkeeping, retrieving, and distributing pool operation and
   membership information.

Table of Contents

   <a href="#section-1">1</a>. Introduction ....................................................<a href="#page-3">3</a>
      <a href="#section-1.1">1.1</a>. Definitions ................................................<a href="#page-3">3</a>
      <a href="#section-1.2">1.2</a>. Conventions ................................................<a href="#page-4">4</a>
   <a href="#section-2">2</a>. ENRP Message Definitions ........................................<a href="#page-4">4</a>
      <a href="#section-2.1">2.1</a>. ENRP_PRESENCE Message ......................................<a href="#page-5">5</a>
      <a href="#section-2.2">2.2</a>. ENRP_HANDLE_TABLE_REQUEST Message ..........................<a href="#page-6">6</a>
      <a href="#section-2.3">2.3</a>. ENRP_HANDLE_TABLE_RESPONSE Message .........................<a href="#page-7">7</a>
      <a href="#section-2.4">2.4</a>. ENRP_HANDLE_UPDATE Message .................................<a href="#page-9">9</a>
      <a href="#section-2.5">2.5</a>. ENRP_LIST_REQUEST Message .................................<a href="#page-10">10</a>
      <a href="#section-2.6">2.6</a>. ENRP_LIST_RESPONSE Message ................................<a href="#page-11">11</a>
      <a href="#section-2.7">2.7</a>. ENRP_INIT_TAKEOVER Message ................................<a href="#page-12">12</a>
      <a href="#section-2.8">2.8</a>. ENRP_INIT_TAKEOVER_ACK Message ............................<a href="#page-13">13</a>
      <a href="#section-2.9">2.9</a>. ENRP_TAKEOVER_SERVER Message ..............................<a href="#page-14">14</a>
      <a href="#section-2.10">2.10</a>. ENRP_ERROR Message .......................................<a href="#page-15">15</a>



<span class="grey">Xie, et al.                   Experimental                      [Page 1]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-2" id="page-2" name="page-2"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   <a href="#section-3">3</a>. ENRP Operation Procedures ......................................<a href="#page-15">15</a>
      <a href="#section-3.1">3.1</a>. Methods for Communicating amongst ENRP Servers ............<a href="#page-16">16</a>
      <a href="#section-3.2">3.2</a>. ENRP Server Initialization ................................<a href="#page-16">16</a>
           <a href="#section-3.2.1">3.2.1</a>. Generate a Server Identifier .......................<a href="#page-16">16</a>
           <a href="#section-3.2.2">3.2.2</a>. Acquire Peer Server List ...........................<a href="#page-17">17</a>
                  <a href="#section-3.2.2.1">3.2.2.1</a>. Finding the Mentor Server .................<a href="#page-17">17</a>
                  3.2.2.2. Request Complete Server List from
                           Mentor Peer ...............................<a href="#page-17">17</a>
           <a href="#section-3.2.3">3.2.3</a>. Download ENRP Handlespace Data from Mentor Peer ....<a href="#page-18">18</a>
      <a href="#section-3.3">3.3</a>. Server Handlespace Update .................................<a href="#page-20">20</a>
           <a href="#section-3.3.1">3.3.1</a>. Announcing Additions or Updates of PE ..............<a href="#page-20">20</a>
           <a href="#section-3.3.2">3.3.2</a>. Announcing Removal of PE ...........................<a href="#page-21">21</a>
      <a href="#section-3.4">3.4</a>. Maintaining Peer List and Monitoring Peer Status ..........<a href="#page-22">22</a>
           <a href="#section-3.4.1">3.4.1</a>. Discovering New Peer ...............................<a href="#page-22">22</a>
           <a href="#section-3.4.2">3.4.2</a>. Server Sending Heartbeat ...........................<a href="#page-22">22</a>
           <a href="#section-3.4.3">3.4.3</a>. Detecting Peer Server Failure ......................<a href="#page-23">23</a>
      <a href="#section-3.5">3.5</a>. Taking Over a Failed Peer Server ..........................<a href="#page-23">23</a>
           <a href="#section-3.5.1">3.5.1</a>. Initiating Server Take-over Arbitration ............<a href="#page-23">23</a>
           <a href="#section-3.5.2">3.5.2</a>. Takeover Target Peer Server ........................<a href="#page-24">24</a>
      <a href="#section-3.6">3.6</a>. Handlespace Data Auditing and Re-synchronization ..........<a href="#page-25">25</a>
           <a href="#section-3.6.1">3.6.1</a>. Auditing Procedures ................................<a href="#page-25">25</a>
           <a href="#section-3.6.2">3.6.2</a>. PE Checksum Calculation Algorithm ..................<a href="#page-26">26</a>
           <a href="#section-3.6.3">3.6.3</a>. Re-Synchronization Procedures ......................<a href="#page-27">27</a>
      3.7. Handling Unrecognized Messages or Unrecognized
           Parameters ................................................<a href="#page-28">28</a>
   <a href="#section-4">4</a>. Variables and Thresholds .......................................<a href="#page-28">28</a>
      <a href="#section-4.1">4.1</a>. Variables .................................................<a href="#page-28">28</a>
      <a href="#section-4.2">4.2</a>. Thresholds ................................................<a href="#page-28">28</a>
   <a href="#section-5">5</a>. IANA Considerations ............................................<a href="#page-28">28</a>
      <a href="#section-5.1">5.1</a>. A New Table for ENRP Message Types ........................<a href="#page-29">29</a>
      <a href="#section-5.2">5.2</a>. A New Table for Update Action Types .......................<a href="#page-29">29</a>
      <a href="#section-5.3">5.3</a>. Port Numbers ..............................................<a href="#page-30">30</a>
      <a href="#section-5.4">5.4</a>. SCTP Payload Protocol Identifier ..........................<a href="#page-30">30</a>
   <a href="#section-6">6</a>. Security Considerations ........................................<a href="#page-30">30</a>
      <a href="#section-6.1">6.1</a>. Summary of RSerPool Security Threats ......................<a href="#page-30">30</a>
      <a href="#section-6.2">6.2</a>. Implementing Security Mechanisms ..........................<a href="#page-32">32</a>
      <a href="#section-6.3">6.3</a>. Chain of Trust ............................................<a href="#page-34">34</a>
   <a href="#section-7">7</a>. Acknowledgments ................................................<a href="#page-35">35</a>
   <a href="#section-8">8</a>. References .....................................................<a href="#page-36">36</a>
      <a href="#section-8.1">8.1</a>. Normative References ......................................<a href="#page-36">36</a>
      <a href="#section-8.2">8.2</a>. Informative References ....................................<a href="#page-37">37</a>










<span class="grey">Xie, et al.                   Experimental                      [Page 2]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-3" id="page-3" name="page-3"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/1.%20%20Introduction"></a><a class="selflink" href="#section-1" name="section-1">1</a>.  Introduction</span>

   ENRP is designed to work in conjunction with ASAP [<a href="rfc5352.html" title='"Aggregate Server Access Protocol (ASAP)"'>RFC5352</a>] to
   accomplish the functionality of RSerPool as defined by its
   requirements [<a href="rfc3237.html" title='"Requirements for Reliable Server Pooling"'>RFC3237</a>].

   Within the operational scope of RSerPool, ENRP defines the procedures
   and message formats of a distributed, fault-tolerant registry service
   for storing, bookkeeping, retrieving, and distributing pool operation
   and membership information.

   Whenever appropriate, in the rest of this document, we will refer to
   this RSerPool registry service as ENRP handlespace, or simply
   handlespace, because it manages all pool handles.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.1.%20%20Definitions"></a><a class="selflink" href="#section-1.1" name="section-1.1">1.1</a>.  Definitions</span>

   This document uses the following terms:

   Operational scope:  The part of the network visible to pool users by
      a specific instance of the reliable server pooling protocols.

   Pool (or server pool):  A collection of servers providing the same
      application functionality.

   Pool handle:  A logical pointer to a pool.  Each server pool will be
      identifiable in the operational scope of the system by a unique
      pool handle.

   Pool element:  A server entity having registered to a pool.

   Pool user:  A server pool user.

   Pool element handle (or endpoint handle):  A logical pointer to a
      particular pool element in a pool, consisting of the pool handle
      and a destination transport address of the pool element.

   Handle space:  A cohesive structure of pool handles and relations
      that may be queried by an internal or external agent.

   ENRP client channel:  The communication channel through which an ASAP
      User (either a Pool Element (PE) or Pool User (PU)) requests ENRP
      handlespace service.  The client channel is usually defined by the
      transport address of the Home ENRP server and a well-known port
      number.






<span class="grey">Xie, et al.                   Experimental                      [Page 3]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-4" id="page-4" name="page-4"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   ENRP server channel:  Defined by a list of IP addresses (one for each
      ENRP server in an operational scope) and a well-known port number.
      All ENRP servers in an operational scope can send "group-cast"
      messages to other servers through this channel.  In a "group-
      cast", the sending server sends multiple copies of the message,
      one to each of its peer servers, over a set of point-to-point
      Stream Control Transmission Protocol (SCTP) associations between
      the sending server and the peers.  The "group-cast" may be
      conveniently implemented with the use of the "SCTP_SENDALL" option
      on a one-to-many style SCTP socket.

   Home ENRP server:  The ENRP server to which a PE or PU currently
      belongs.  A PE MUST only have one Home ENRP server at any given
      time, and both the PE and its Home ENRP server MUST keep track of
      this master/slave relationship between them.  A PU SHOULD select
      one of the available ENRP servers as its Home ENRP server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/1.2.%20%20Conventions"></a><a class="selflink" href="#section-1.2" name="section-1.2">1.2</a>.  Conventions</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [<a href="rfc2119.html" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/2.%20%20ENRP%20Message%20Definitions"></a><a class="selflink" href="#section-2" name="section-2">2</a>.  ENRP Message Definitions</span>

   In this section, we define the format of all ENRP messages.  These
   are messages sent and received amongst ENRP servers in an operational
   scope.  Messages sent and received between a PE/PU and an ENRP server
   are part of ASAP and are defined in [<a href="rfc5352.html" title='"Aggregate Server Access Protocol (ASAP)"'>RFC5352</a>].  A common format, that
   is defined in [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>], is used for all ENRP and ASAP messages.

   Most ENRP messages contain a combination of fixed fields and TLV
   (Type-Length-Value) parameters.  The TLV parameters are also defined
   in [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>].  If a nested TLV parameter is not ended on a 32-bit
   word boundary, it will be padded with all '0' octets to the next 32-
   bit word boundary.

   All messages, as well as their fields/parameters described below,
   MUST be transmitted in network byte order (aka Big Endian, meaning
   the most significant byte is transmitted first).











<span class="grey">Xie, et al.                   Experimental                      [Page 4]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-5" id="page-5" name="page-5"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   For ENRP, the following message types are defined in this section:

         Type       Message Name
         -----      -------------------------
         0x00      - (Reserved by IETF)
         0x01      - ENRP_PRESENCE
         0x02      - ENRP_HANDLE_TABLE_REQUEST
         0x03      - ENRP_HANDLE_TABLE_RESPONSE
         0x04      - ENRP_HANDLE_UPDATE
         0x05      - ENRP_LIST_REQUEST
         0x06      - ENRP_LIST_RESPONSE
         0x07      - ENRP_INIT_TAKEOVER
         0x08      - ENRP_INIT_TAKEOVER_ACK
         0x09      - ENRP_TAKEOVER_SERVER
         0x0a      - ENRP_ERROR
         0x0b-0xff - (Reserved by IETF)

                                 Figure 1

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.1.%20%20ENRP_PRESENCE%20Message"></a><a class="selflink" href="#section-2.1" name="section-2.1">2.1</a>.  ENRP_PRESENCE Message</span>

   This ENRP message is used to announce (periodically) the presence of
   an ENRP server, or to probe the status of a peer ENRP server.  This
   message is either sent on the ENRP server channel or sent point-to-
   point to another ENRP server.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x01 |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Sending Server's ID                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                    Receiving Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                      PE Checksum Param                        :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :               Server Information Param (optional)             :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:  32 bits (unsigned integer)

         This is the ID of the ENRP server that sent this message.








<span class="grey">Xie, et al.                   Experimental                      [Page 5]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-6" id="page-6" name="page-6"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


      Receiving Server's ID:  32 bits (unsigned integer)

         This is the ID of the ENRP server to which this message is
         intended.  If the message is not intended for an individual
         server (e.g., the message is group-casted to a group of
         servers), this field MUST be sent with all 0s.  If the message
         is sent point-to-point, this field MAY be sent with all 0s.

      PE Checksum Parameter:

         This is a TLV that contains the latest PE checksum of the ENRP
         server that sends the ENRP_PRESENCE.  This parameter SHOULD be
         included for handlespace consistency auditing.  See
         <a href="#section-3.6.1">Section 3.6.1</a> for details.

      Server Information Parameter:

         If this parameter is present, it contains the server
         information of the sender of this message (the Server
         Information Parameter is defined in [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>]).  This parameter
         is optional.  However, if this message is sent in response to a
         received "reply required" ENRP_PRESENCE from a peer, the sender
         then MUST include its server information.

   Note, at startup, an ENRP server MUST pick a randomly generated, non-
   zero 32-bit unsigned integer as its ID and MUST use this same ID
   until the ENRP server is rebooted.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.2.%20%20ENRP_HANDLE_TABLE_REQUEST%20Message"></a><a class="selflink" href="#section-2.2" name="section-2.2">2.2</a>.  ENRP_HANDLE_TABLE_REQUEST Message</span>

   An ENRP server sends this message to one of its peers to request a
   copy of the handlespace data.  This message is normally used during
   server initialization or handlespace re-synchronization.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x02 |0|0|0|0|0|0|0|W|    Message Length = 0xC       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+








<span class="grey">Xie, et al.                   Experimental                      [Page 6]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-7" id="page-7" name="page-7"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


      W (oWn-children-only) Flag:  1 bit

         Set to '1' if the sender of this message is only requesting
         information about the PEs owned by the message receiver.
         Otherwise, set to '0'.

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.3.%20%20ENRP_HANDLE_TABLE_RESPONSE%20Message"></a><a class="selflink" href="#section-2.3" name="section-2.3">2.3</a>.  ENRP_HANDLE_TABLE_RESPONSE Message</span>

   The PEER_NAME_TABLE_RESPONSE message is sent by an ENRP server in
   response to a received PEER_NAME_TABLE_REQUEST message to assist
   peer-server initialization or handlespace synchronization.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x03 |0|0|0|0|0|0|M|R|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                                                               :
      :                     Pool Entry #1 (optional)                  :
      :                                                               :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                                                               :
      :                              ...                              :
      :                                                               :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                                                               :
      :                     Pool Entry #n (optional)                  :
      :                                                               :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      M (More_to_send) Flag:  1 bit

         Set to '1' if the sender of this message has more pool entries
         to send in subsequent ENRP_HANDLE_TABLE_RESPONSE messages.
         Otherwise, set to '0'.




<span class="grey">Xie, et al.                   Experimental                      [Page 7]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-8" id="page-8" name="page-8"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


      R (Reject) Flag:  1 bit

         MUST be set to '1' if the sender of this message is rejecting a
         handlespace request.  In this case, pool entries MUST NOT be
         included.  This might happen if the sender of this message is
         in the middle of initializing its database or is under high
         load.

      Message Length:  16 bits (unsigned integer)

         Indicates the entire length of the message, including the
         header, in number of octets.

         Note, the value in the Message Length field will NOT cover any
         padding at the end of this message.

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Pool Entry #1-#n:

         If the R flag is set to '0', at least one pool entry SHOULD be
         present in this message.  Each pool entry MUST start with a
         Pool Handle parameter, as defined in <a href="rfc5354.html#section-3.9">Section 3.9 of [RFC5354]</a>,
         and is followed by one or more Pool Element parameters in TLV
         format, as shown below:

                   +---------------------------+
                   :      Pool Handle          :
                   +---------------------------+
                   :         PE #1             :
                   +---------------------------+
                   :         PE #2             :
                   +---------------------------+
                   :          ...              :
                   +---------------------------+
                   :         PE #n             :
                   +---------------------------+








<span class="grey">Xie, et al.                   Experimental                      [Page 8]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-9" id="page-9" name="page-9"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.4.%20%20ENRP_HANDLE_UPDATE%20Message"></a><a class="selflink" href="#section-2.4" name="section-2.4">2.4</a>.  ENRP_HANDLE_UPDATE Message</span>

   The PEER_NAME_UPDATE message is sent by the Home ENRP server of a PE
   to all peer servers to announce registration, re-registration, or de-
   registration of the PE in the handlespace.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x04 |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |        Update Action          |        (reserved)             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                     Pool Handle Parameter                     :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                    Pool Element Parameter                     :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Message Length:  16 bits (unsigned integer)

         Indicates the entire length of the message, including the
         header, in number of octets.

         Note, the value in the Message Length field will NOT cover any
         padding at the end of this message.

      Update Action:  16 bits (unsigned integer)

         This field indicates the requested action of the specified PE.
         The field MUST be set to one of the following values:

         0x0000 - ADD_PE:  Add or update the specified PE in the ENRP
            handlespace.

         0x0001 - DEL_PE:  Delete the specified PE from the ENRP
            handlespace.

         0x0002 - 0xFFFF:  Reserved by IETF.

         Other values are reserved by IETF and MUST NOT be used.







<span class="grey">Xie, et al.                   Experimental                      [Page 9]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-10" id="page-10" name="page-10"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


      Reserved:  16 bits

         This field MUST be set to all 0s by the sender and ignored by
         the receiver.

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Pool Handle:

         Specifies to which the PE belongs.

      Pool Element:

         Specifies the PE.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.5.%20%20ENRP_LIST_REQUEST%20Message"></a><a class="selflink" href="#section-2.5" name="section-2.5">2.5</a>.  ENRP_LIST_REQUEST Message</span>

   The PEER_LIST_REQUEST message is sent to request a current copy of
   the ENRP server list.  This message is normally sent from a newly
   activated ENRP server to an established ENRP server as part of the
   initialization process.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x05 |0|0|0|0|0|0|0|0|    Message Length = 0xC       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.






<span class="grey">Xie, et al.                   Experimental                     [Page 10]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-11" id="page-11" name="page-11"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.6.%20%20ENRP_LIST_RESPONSE%20Message"></a><a class="selflink" href="#section-2.6" name="section-2.6">2.6</a>.  ENRP_LIST_RESPONSE Message</span>

   The PEER_LIST_RESPONSE message is sent in response from an ENRP
   server that receives a PEER_LIST_REQUEST message to return
   information about known ENRP servers.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x06 |0|0|0|0|0|0|0|R|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :            Server Information Parameter of Peer #1            :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                           ...                                 :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :            Server Information Parameter of Peer #n            :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      R (Reject) Flag:  1 bit

         This flag MUST be set to '1' if the sender of this message is
         rejecting a PEER_LIST_REQUEST message.  If this case occurs,
         the message MUST NOT include any Server Information Parameters.

      Message Length:  16 bits (unsigned integer)

         Indicates the entire length of the message in number of octets.

         Note, the value in the Message Length field will NOT cover any
         padding at the end of this message.

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Server Information Parameter of Peer #1-#n:

         Each contains a Server Information Parameter of a peer known to
         the sender.  The Server Information Parameter is defined in
         [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>].



<span class="grey">Xie, et al.                   Experimental                     [Page 11]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-12" id="page-12" name="page-12"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.7.%20%20ENRP_INIT_TAKEOVER%20Message"></a><a class="selflink" href="#section-2.7" name="section-2.7">2.7</a>.  ENRP_INIT_TAKEOVER Message</span>

   The ENRP_INIT_TAKEOVER message is sent by an ENRP server (the
   takeover initiator) to announce its intention of taking over a
   specific peer ENRP server.  It is sent to all its peers.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x07 |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Targeting Server's ID                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Targeting Server's ID:  32 bits (unsigned integer)

         This is the ID of the peer ENRP that is the target of this
         takeover attempt.





















<span class="grey">Xie, et al.                   Experimental                     [Page 12]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-13" id="page-13" name="page-13"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.8.%20%20ENRP_INIT_TAKEOVER_ACK%20Message"></a><a class="selflink" href="#section-2.8" name="section-2.8">2.8</a>.  ENRP_INIT_TAKEOVER_ACK Message</span>

   The PEER_INIT_TAKEOVER_ACK message is sent in response to a takeover
   initiator to acknowledge the reception of the PEER_INIT_TAKEOVER
   message and that it does not object to the takeover.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x08 |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Targeting Server's ID                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Targeting Server's ID:

         This is the ID of the peer ENRP that is the target of this
         takeover attempt.





















<span class="grey">Xie, et al.                   Experimental                     [Page 13]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-14" id="page-14" name="page-14"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.9.%20%20ENRP_TAKEOVER_SERVER%20Message"></a><a class="selflink" href="#section-2.9" name="section-2.9">2.9</a>.  ENRP_TAKEOVER_SERVER Message</span>

   The PEER_TAKEOVER_REGISTRAR message is sent by the takeover initiator
   to declare the enforcement of a takeover to all active peer ENRP
   servers.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x09 |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Targeting Server's ID                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Targeting Server's ID:

         This is the ID of the peer ENRP that is the target of this
         takeover operation.





















<span class="grey">Xie, et al.                   Experimental                     [Page 14]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-15" id="page-15" name="page-15"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/2.10.%20%20ENRP_ERROR%20Message"></a><a class="selflink" href="#section-2.10" name="section-2.10">2.10</a>.  ENRP_ERROR Message</span>

   The ENRP_ERROR message is sent by a registrar to report an
   operational error to a peer ENRP server.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 0x0a |0|0|0|0|0|0|0|0|        Message Length         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Sending Server's ID                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     Receiving Server's ID                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                 Operational Error Parameter                   :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Sending Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Receiving Server's ID:

         See <a href="#section-2.1">Section 2.1</a>.

      Operational Error Parameter:

         This parameter, defined in [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>], indicates the type of
         error(s) being reported.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/3.%20%20ENRP%20Operation%20Procedures"></a><a class="selflink" href="#section-3" name="section-3">3</a>.  ENRP Operation Procedures</span>

   In this section, we discuss the operation procedures defined by ENRP.
   An ENRP server MUST follow these procedures when sending, receiving,
   or processing ENRP messages.

   Many of the RSerPool events call for both server-to-server and PU/
   PE-to-server message exchanges.  Only the message exchanges and
   activities between an ENRP server and its peer(s) are considered
   within the ENRP scope and are defined in this document.

   Procedures for exchanging messages between a PE/PU and ENRP servers
   are defined in [<a href="rfc5352.html" title='"Aggregate Server Access Protocol (ASAP)"'>RFC5352</a>].








<span class="grey">Xie, et al.                   Experimental                     [Page 15]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-16" id="page-16" name="page-16"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.1.%20%20Methods%20for%20Communicating%20amongst%20ENRP%20Servers"></a><a class="selflink" href="#section-3.1" name="section-3.1">3.1</a>.  Methods for Communicating amongst ENRP Servers</span>

   Within an RSerPool operational scope, ENRP servers need to
   communicate with each other in order to exchange information, such as
   the pool membership changes, handlespace data synchronization, etc.

   Two types of communications are used amongst ENRP servers:

   o  point-to-point message exchanges from one ENPR server to a
      specific peer server, and

   o  announcements from one server to all its peer servers in the
      operational scope.

   Point-to-point communication is always carried out over an SCTP
   association between the sending server and the receiving server.
   Announcements are sent out via "group-casts" over the ENRP server
   channel.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.2.%20%20ENRP%20Server%20Initialization"></a><a class="selflink" href="#section-3.2" name="section-3.2">3.2</a>.  ENRP Server Initialization</span>

   This section describes the steps a new ENRP server needs to take in
   order to join the other existing ENRP servers, or to initiate the
   handlespace service if it is the first ENRP server started in the
   operational scope.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.1.%20%20Generate%20a%20Server%20Identifier"></a><a class="selflink" href="#section-3.2.1" name="section-3.2.1">3.2.1</a>.  Generate a Server Identifier</span>

   A new ENRP server MUST generate a non-zero, 32-bit server ID that is
   as unique as possible among all the ENRP servers in the operational
   scope, and this server ID MUST remain unchanged for the lifetime of
   the server.  Normally, a good 32-bit random number will be good
   enough, as the server ID [<a href="rfc4086.html" title='"Randomness Requirements for Security"'>RFC4086</a>] provides some information on
   randomness guidelines.

   Note, there is a very remote chance (about 1 in about 4 billion) that
   two ENRP servers in an operational scope will generate the same
   server ID and hence cause a server ID conflict in the pool.  However,
   no severe consequence of such a conflict has been identified.

   Note, the ENRP server ID space is separate from the PE Id space
   defined in [<a href="rfc5352.html" title='"Aggregate Server Access Protocol (ASAP)"'>RFC5352</a>].









<span class="grey">Xie, et al.                   Experimental                     [Page 16]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-17" id="page-17" name="page-17"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.%20%20Acquire%20Peer%20Server%20List"></a><a class="selflink" href="#section-3.2.2" name="section-3.2.2">3.2.2</a>.  Acquire Peer Server List</span>

   At startup, the ENRP server (the initiating server) will first
   attempt to learn of all existing peer ENRP servers in the same
   operational scope, or to determine that it is alone in the scope.

   The initiating server uses an existing peer server to bootstrap
   itself into service.  We call this peer server the mentor server.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.1.%20%20Finding%20the%20Mentor%20Server"></a><a class="selflink" href="#section-3.2.2.1" name="section-3.2.2.1">3.2.2.1</a>.  Finding the Mentor Server</span>

   If the initiating server is told about one existing peer server
   through some administrative means (such as DNS query, configuration
   database, startup scripts, etc.), the initiating server MUST then use
   this peer server as its mentor server.

   If multiple existing peer servers are specified, the initiating
   server MUST pick one of them as its mentor server and keep the others
   as its backup mentor servers.

   If no existing peer server is specified, the initiating server MUST
   assume that it is alone in the operational scope, and MUST skip the
   procedures in <a href="#section-3.2.2.2">Section 3.2.2.2</a> and <a href="#section-3.2.3">Section 3.2.3</a> and MUST consider its
   initialization completed and start offering ENRP services.

<span class="h5"><a class="dashAnchor" name="//apple_ref/Section/3.2.2.2.%20%20Request%20Complete%20Server%20List%20from%20Mentor%20Peer"></a><a class="selflink" href="#section-3.2.2.2" name="section-3.2.2.2">3.2.2.2</a>.  Request Complete Server List from Mentor Peer</span>

   Once the initiating server finds its mentor peer server (by either
   discovery or administrative means), the initiating server MUST send
   an ENRP_LIST_REQUEST message to the mentor peer server to request a
   copy of the complete server list maintained by the mentor peer (see
   <a href="#section-3.4">Section 3.4</a> for maintaining a server list).

   The initiating server SHOULD start a MAX-TIME-NO-RESPONSE timer every
   time it finishes sending an ENRP_LIST_REQUEST message.  If the timer
   expires before receiving a response from the mentor peer, the
   initiating server SHOULD abandon the interaction with the current
   mentor server and send a new server list request to a backup mentor
   peer, if one is available.

   Upon the reception of this request, the mentor peer server SHOULD
   reply with an ENRP_LIST_RESPONSE message and include in the message
   body all existing ENRP servers known by the mentor peer.

   Upon the reception of the ENRP_LIST_RESPONSE message from the mentor
   peer, the initiating server MUST use the server information carried
   in the message to initialize its own peer list.




<span class="grey">Xie, et al.                   Experimental                     [Page 17]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-18" id="page-18" name="page-18"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   However, if the mentor itself is in the process of startup and not
   ready to provide a peer server list (for example, the mentor peer is
   waiting for a response to its own ENRP_LIST_REQUEST to another
   server), it MUST reject the request by the initiating server and
   respond with an ENRP_LIST_RESPONSE message with the R flag set to
   '1', and with no server information included in the response.

   In the case where its ENRP_LIST_REQUEST is rejected by the mentor
   peer, the initiating server SHOULD either wait for a few seconds and
   re-send the ENRP_LIST_REQUEST to the mentor server, or if there is a
   backup mentor peer available, select another mentor peer server and
   send the ENRP_LIST_REQUEST to the new mentor server.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.2.3.%20%20Download%20ENRP%20Handlespace%20Data%20from%20Mentor%20Peer"></a><a class="selflink" href="#section-3.2.3" name="section-3.2.3">3.2.3</a>.  Download ENRP Handlespace Data from Mentor Peer</span>

   After a peer list download is completed, the initiating server MUST
   request a copy of the current handlespace data from its mentor peer
   server, by taking the following steps:

   1.  The initiating server MUST first send an
       ENRP_HANDLE_TABLE_REQUEST message to the mentor peer, with the W
       flag set to '0', indicating that the entire handlespace is
       requested.

   2.  Upon the reception of this message, the mentor peer MUST start a
       download session in which a copy of the current handlespace data
       maintained by the mentor peer is sent to the initiating server in
       one or more ENRP_HANDLE_TABLE_RESPONSE messages.  (Note, the
       mentor server may find it particularly desirable to use multiple
       ENRP_HANDLE_TABLE_RESPONSE messages to send the handlespace when
       the handlespace is large, especially when forming and sending out
       a single response containing a large handlespace may interrupt
       its other services.)

       If more than one ENRP_HANDLE_TABLE_RESPONSE message is used
       during the download, the mentor peer MUST use the M flag in each
       ENRP_HANDLE_TABLE_RESPONSE message to indicate whether this
       message is the last one for the download session.  In particular,
       the mentor peer MUST set the M flag to '1' in the outbound
       ENRP_HANDLE_TABLE_RESPONSE if there is more data to be
       transferred and MUST keep track of the progress of the current
       download session.  The mentor peer MUST set the M flag to '0' in
       the last ENRP_HANDLE_TABLE_RESPONSE for the download session and
       close the download session (i.e., removing any internal record of
       the session) after sending out the last message.






<span class="grey">Xie, et al.                   Experimental                     [Page 18]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-19" id="page-19" name="page-19"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   3.  During the downloading, every time the initiating server receives
       an ENRP_HANDLE_TABLE_RESPONSE message, it MUST transfer the data
       entries carried in the message into its local handlespace
       database, and then check whether or not this message is the last
       one for the download session.

       If the M flag is set to '1' in the just processed
       ENRP_HANDLE_TABLE_RESPONSE message, the initiating server MUST
       send another ENRP_HANDLE_TABLE_REQUEST message to the mentor peer
       to request for the next ENRP_HANDLE_TABLE_RESPONSE message.

   4.  When unpacking the data entries from a ENRP_HANDLE_TABLE_RESPONSE
       message into its local handlespace database, the initiating
       server MUST handle each pool entry carried in the message using
       the following rules:

       A.  If the pool does not exist in the local handlespace, the
           initiating server MUST create the pool in the local
           handlespace and add the PE(s) in the pool entry to the pool.

           When creating the pool, the initiation server MUST set the
           overall member selection policy type of the pool to the
           policy type indicated in the first PE.

       B.  If the pool already exists in the local handlespace, but the
           PE(s) in the pool entry is not currently a member of the
           pool, the initiating server MUST add the PE(s) to the pool.

       C.  If the pool already exists in the local handlespace AND the
           PE(s) in the pool entry is already a member of the pool, the
           initiating server SHOULD replace the attributes of the
           existing PE(s) with the new information.  ENRP will make sure
           that the information stays up to date.

   5.  When the last ENRP_HANDLE_TABLE_RESPONSE message is received from
       the mentor peer and unpacked into the local handlespace, the
       initialization process is completed and the initiating server
       SHOULD start to provide ENRP services.

   Under certain circumstances, the mentor peer itself may not be able
   to provide a handlespace download to the initiating server.  For
   example, the mentor peer is in the middle of initializing its own
   handlespace database, or it currently has too many download sessions
   open to other servers.







<span class="grey">Xie, et al.                   Experimental                     [Page 19]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-20" id="page-20" name="page-20"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   In such a case, the mentor peer MUST reject the request by the
   initiating server and respond with an ENRP_HANDLE_TABLE_RESPONSE
   message with the R flag set to '1', and with no pool entries included
   in the response.

   In the case where its ENRP_HANDLE_TABLE_REQUEST is rejected by the
   mentor peer, the initiating server SHOULD either wait for a few
   seconds and re-send the ENRP_HANDLE_TABLE_REQUEST to the mentor
   server, or if there is a backup mentor peer available, select another
   mentor peer server and send the ENRP_HANDLE_TABLE_REQUEST to the new
   mentor server.

   A handlespace download session that has been started may get
   interrupted for some reason.  To cope with this, the initiating
   server SHOULD start a timer every time it finishes sending an
   ENRP_HANDLE_TABLE_REQUEST to its mentor peer.  If this timer expires
   without receiving a response from the mentor peer, the initiating
   server SHOULD abort the current download session and re-start a new
   handlespace download with a backup mentor peer, if one is available.

   Similarly, after sending out an ENRP_HANDLE_TABLE_RESPONSE, and the
   mentor peer setting the M-bit to '1' to indicate that it has more
   data to send, it SHOULD start a session timer.  If this timer expires
   without receiving another request from the initiating server, the
   mentor peer SHOULD abort the session, cleaning out any resource and
   record of the session.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.3.%20%20Server%20Handlespace%20Update"></a><a class="selflink" href="#section-3.3" name="section-3.3">3.3</a>.  Server Handlespace Update</span>

   This includes a set of update operations used by an ENRP server to
   inform its peers when its local handlespace is modified, e.g.,
   addition of a new PE, removal of an existing PE, change of pool or PE
   properties.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.1.%20%20Announcing%20Additions%20or%20Updates%20of%20PE"></a><a class="selflink" href="#section-3.3.1" name="section-3.3.1">3.3.1</a>.  Announcing Additions or Updates of PE</span>

   When a new PE is granted registration to the handlespace or an
   existing PE is granted a re-registration, the Home ENRP server uses
   this procedure to inform all its peers.

   This is an ENRP announcement and is sent to all the peer of the Home
   ENRP server.  See <a href="#section-3.1">Section 3.1</a> on how announcements are sent.

   An ENRP server MUST announce this update to all its peers in a
   ENRP_HANDLE_UPDATE message with the Update Action field set to
   'ADD_PE', indicating the addition of a new PE or the modification of





<span class="grey">Xie, et al.                   Experimental                     [Page 20]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-21" id="page-21" name="page-21"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   an existing PE.  The complete new information of the PE and the pool
   it belongs to MUST be indicated in the message with a PE parameter
   and a Pool Handle parameter, respectively.

   The Home ENRP server SHOULD fill in its server ID in the Sending
   Server's ID field and leave the Receiving Server's ID blank (i.e.,
   all 0s).

   When a peer receives this ENRP_HANDLE_UPDATE message, it MUST take
   the following actions:

   1.  If the named pool indicated by the pool handle does not exist in
       its local copy of the handlespace, the peer MUST create the named
       pool in its local handlespace and add the PE to the pool as the
       first PE.  It MUST then copy in all other attributes of the PE
       carried in the message.

       When the new pool is created, the overall member selection policy
       of the pool MUST be set to the policy type indicated by the PE.

   2.  If the named pool already exists in the peer's local copy of the
       handlespace *and* the PE does not exist, the peer MUST add the PE
       to the pool as a new PE and copy in all attributes of the PE
       carried in the message.

   3.  If the named pool exists *and* the PE is already a member of the
       pool, the peer MUST replace the attributes of the PE with the new
       information carried in the message.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.3.2.%20%20Announcing%20Removal%20of%20PE"></a><a class="selflink" href="#section-3.3.2" name="section-3.3.2">3.3.2</a>.  Announcing Removal of PE</span>

   When an existing PE is granted de-registration or is removed from its
   handlespace for some other reasons (e.g., purging an unreachable PE,
   see <a href="rfc5352.html#section-3.5">Section 3.5 in [RFC5352]</a>), the ENRP server MUST use this
   procedure to inform all its peers about the change just made.

   This is an ENRP announcement and is sent to all the peers of the Home
   ENRP server.  See <a href="#section-3.1">Section 3.1</a> on how announcements are sent.

   An ENRP server MUST announce the PE removal to all its peers in an
   ENRP_HANDLE_UPDATE message with the Update Action field set to
   DEL_PE, indicating the removal of an existing PE.  The complete
   information of the PE and the pool it belongs to MUST be indicated in
   the message with a PE parameter and a Pool Handle parameter,
   respectively.






<span class="grey">Xie, et al.                   Experimental                     [Page 21]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-22" id="page-22" name="page-22"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   The sending server MUST fill in its server ID in the Sending Server's
   ID field and leave the Receiving Server's ID blank (i.e., set to all
   0s).

   When a peer receives this ENRP_HANDLE_UPDATE message, it MUST first
   find the pool and the PE in its own handlespace, and then remove the
   PE from its local handlespace.  If the removed PE is the last one in
   the pool, the peer MUST also delete the pool from its local
   handlespace.

   If the peer fails to find the PE or the pool in its handlespace, it
   SHOULD take no further actions.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.4.%20%20Maintaining%20Peer%20List%20and%20Monitoring%20Peer%20Status"></a><a class="selflink" href="#section-3.4" name="section-3.4">3.4</a>.  Maintaining Peer List and Monitoring Peer Status</span>

   An ENRP server MUST keep an internal record on the status of each of
   its known peers.  This record is referred to as the server's "peer
   list".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.1.%20%20Discovering%20New%20Peer"></a><a class="selflink" href="#section-3.4.1" name="section-3.4.1">3.4.1</a>.  Discovering New Peer</span>

   If a message of any type is received from a previously unknown peer,
   the ENRP server MUST consider this peer a new peer in the operational
   scope and add it to the peer list.

   The ENRP server MUST send an ENRP_PRESENCE message with the Reply-
   required flag set to '1' to the source address found in the arrived
   message.  This will force the new peer to reply with its own
   ENRP_PRESENCE containing its full server information (see
   <a href="#section-2.1">Section 2.1</a>).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.2.%20%20Server%20Sending%20Heartbeat"></a><a class="selflink" href="#section-3.4.2" name="section-3.4.2">3.4.2</a>.  Server Sending Heartbeat</span>

   Every PEER-HEARTBEAT-CYCLE seconds, an ENRP server MUST announce its
   continued presence to all its peer with a ENRP_PRESENCE message.  In
   the ENRP_PRESENCE message, the ENRP server MUST set the
   'Replay_required' flag to '0', indicating that no response is
   required.

   The arrival of this periodic ENRP_PRESENCE message will cause all its
   peers to update their internal variable "peer_last_heard" for the
   sending server (see <a href="#section-3.4.3">Section 3.4.3</a> for more details).









<span class="grey">Xie, et al.                   Experimental                     [Page 22]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-23" id="page-23" name="page-23"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.4.3.%20%20Detecting%20Peer%20Server%20Failure"></a><a class="selflink" href="#section-3.4.3" name="section-3.4.3">3.4.3</a>.  Detecting Peer Server Failure</span>

   An ENRP server MUST keep an internal variable "peer_last_heard" for
   each of its known peers and the value of this variable MUST be
   updated to the current local time every time a message of any type
   (point-to-point or announcement) is received from the corresponding
   peer.

   If a peer has not been heard for more than MAX-TIME-LAST-HEARD
   seconds, the ENRP server MUST immediately send a point-to-point
   ENRP_PRESENCE with the Reply_request flag set to '1' to that peer.

   If the send fails or the peer does not reply after MAX-TIME-NO-
   RESPONSE seconds, the ENRP server MUST consider the peer server dead
   and SHOULD initiate the takeover procedure defined in <a href="#section-3.5">Section 3.5</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.5.%20%20Taking%20Over%20a%20Failed%20Peer%20Server"></a><a class="selflink" href="#section-3.5" name="section-3.5">3.5</a>.  Taking Over a Failed Peer Server</span>

   In the following descriptions, we call the ENRP server that detects
   the failed peer server and initiates the takeover the "initiating
   server" and the failed peer server the "target server".  This allows
   the PE to continue to operate in case of a failure of their Home ENRP
   server.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.1.%20%20Initiating%20Server%20Take-over%20Arbitration"></a><a class="selflink" href="#section-3.5.1" name="section-3.5.1">3.5.1</a>.  Initiating Server Take-over Arbitration</span>

   The initiating server SHOULD first start the takeover arbitration
   process by sending an ENRP_INIT_TAKEOVER message to all its peer
   servers.  See <a href="#section-3.1">Section 3.1</a> on how announcements are sent.  In the
   message, the initiating server MUST fill in the Sending Server's ID
   and Targeting Server's ID.  The goal is that only one ENRP server
   takes over the PE from the target.

   After announcing the ENRP_INIT_TAKEOVER message ("group-casting" to
   all known peers, including the target server), the initiating server
   SHOULD wait for an ENRP_INIT_TAKEOVER_ACK message from each of its
   known peers, except that of the target server.

   Each peer receiving an ENRP_INIT_TAKEOVER message from the initiating
   server MUST take the following actions:

   1.  If the peer server determines that it (itself) is the target
       server indicated in the ENRP_INIT_TAKEOVER message, it MUST
       immediately announce an ENRP_PRESENCE message to all its peer
       ENRP servers in an attempt to stop this takeover process.  This






<span class="grey">Xie, et al.                   Experimental                     [Page 23]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-24" id="page-24" name="page-24"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


       indicates a false failure-detection case by the initiating
       server.  The initiating server MUST stop the takeover operation
       by marking the target server as "active" and taking no further
       takeover actions.

   2.  If the peer server finds that it has already started its own
       takeover arbitration process on the same target server, it MUST
       perform the following arbitration:

       A.  If the peer's server ID is smaller in value than the Sending
           Server's ID in the arrived ENRP_INIT_TAKEOVER message, the
           peer server MUST immediately abort its own take-over attempt
           by taking no further takeover actions of its own.  Moreover,
           the peer MUST mark the target server as "not active" on its
           internal peer list so that its status will no longer be
           monitored by the peer, and reply to the initiating server
           with an ENRP_INIT_TAKEOVER_ACK message.

       B.  Otherwise, the peer MUST ignore the ENRP_INIT_TAKEOVER
           message.

   3.  If the peer finds that it is neither the target server nor is in
       its own takeover process, the peer MUST: a) mark the target
       server as "not active" on its internal peer list so that its
       status will no longer be monitored by this peer, and b) MUST
       reply to the initiating server with an ENRP_INIT_TAKEOVER_ACK
       message.

   Once the initiating server has received the ENRP_INIT_TAKEOVER_ACK
   message from all of its currently known peers (except for the target
   server), it MUST consider that it has won the arbitration and MUST
   proceed to complete the takeover, following the steps described in
   <a href="#section-3.5.2">Section 3.5.2</a>.

   However, if it receives an ENRP_PRESENCE from the target server at
   any point in the arbitration process, the initiating server MUST
   immediately stop the takeover process and mark the status of the
   target server as "active".

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.5.2.%20%20Takeover%20Target%20Peer%20Server"></a><a class="selflink" href="#section-3.5.2" name="section-3.5.2">3.5.2</a>.  Takeover Target Peer Server</span>

   The initiating ENRP server MUST first send, via an announcement, an
   ENRP_TAKEOVER_SERVER message to inform all its active peers that the
   takeover has been enforced.  The target server's ID MUST be filled in
   the message.  The initiating server SHOULD then remove the target
   server from its internal peer list.





<span class="grey">Xie, et al.                   Experimental                     [Page 24]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-25" id="page-25" name="page-25"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   Then, it SHOULD examine its local copy of the handlespace and claim
   ownership of each of the PEs originally owned by the target server,
   by following these steps:

   1.  mark itself as the Home ENRP server of each of the PEs originally
       owned by the target server;

   2.  send a point-to-point ASAP_ENDPOINT_KEEP_ALIVE message, with the
       'H' flag set to '1', to each of the PEs.  This will trigger the
       PE to adopt the initiating sever as its new Home ENRP server.

   When a peer receives the ENRP_TAKEOVER_SERVER message from the
   initiating server, it SHOULD update its local peer list and PE cache
   by following these steps:

   1.  remove the target server from its internal peer list;

   2.  update the Home ENRP server of each PE in its local copy of the
       handlespace to be the sender of the message, i.e., the initiating
       server.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.6.%20%20Handlespace%20Data%20Auditing%20and%20Re-synchronization"></a><a class="selflink" href="#section-3.6" name="section-3.6">3.6</a>.  Handlespace Data Auditing and Re-synchronization</span>

   Message losses or certain temporary breaks in network connectivity
   may result in data inconsistency in the local handlespace copy of
   some of the ENRP servers in an operational scope.  Therefore, each
   ENRP server in the operational scope SHOULD periodically verify that
   its local copy of handlespace data is still in sync with that of its
   peers.

   This section defines the auditing and re-synchronization procedures
   for an ENRP server to maintain its handlespace data consistency.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.6.1.%20%20Auditing%20Procedures"></a><a class="selflink" href="#section-3.6.1" name="section-3.6.1">3.6.1</a>.  Auditing Procedures</span>

   A checksum covering the data that should be the same is exchanged to
   figure out whether or not the data is the same.

   The auditing of handlespace consistency is based on the following
   procedures:

   1.  An ENRP server SHOULD keep a separate PE checksum (a 16-bit
       integer internal variable) for each of its known peers and for
       itself.  For an ENRP server with 'k' known peers, we denote these
       internal variables as "pe_checksum_pr0", "pe_checksum_pr1", ...,
       "pe_checksum_prk", where "pe_checksum_pr0" is the server's own PE
       checksum.  The list of what these checksums cover and a detailed
       algorithm for calculating them is given in <a href="#section-3.6.2">Section 3.6.2</a>.



<span class="grey">Xie, et al.                   Experimental                     [Page 25]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-26" id="page-26" name="page-26"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   2.  Each time an ENRP server sends out an ENRP_PRESENCE, it MUST
       include in the message its current PE checksum (i.e.,
       "pe_checksum_pr0").

   3.  When an ENRP server (server A) receives a PE checksum (carried in
       an arrived ENRP_PRESENCE) from a peer ENRP server (server B),
       server A SHOULD compare the PE checksum found in the
       ENRP_PRESENCE with its own internal PE checksum of server B
       (i.e., "pe_checksum_prB").

   4.  If the two values match, server A will consider that there is no
       handlespace inconsistency between itself and server B, and it
       should take no further actions.

   5.  If the two values do NOT match, server A SHOULD consider that
       there is a handlespace inconsistency between itself and server B,
       and a re-synchronization process SHOULD be carried out
       immediately with server B (see <a href="#section-3.6.3">Section 3.6.3</a>).

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.6.2.%20%20PE%20Checksum%20Calculation%20Algorithm"></a><a class="selflink" href="#section-3.6.2" name="section-3.6.2">3.6.2</a>.  PE Checksum Calculation Algorithm</span>

   When an ENRP server (server A) calculates an internal PE checksum for
   a peer (server B), it MUST use the following algorithm.

   Let us assume that in server A's internal handlespace, there are
   currently 'M' PEs that are owned by server B.  Each of the 'M' PEs
   will then contribute to the checksum calculation with the following
   byte block:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :  Pool handle string of the pool the PE belongs (padded with   :
      :  zeros to next 32-bit word boundary, if needed)               :
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        PE Id (4 octets)                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Note, these are not TLVs.  This byte block gives each PE a unique
   byte pattern in the scope.  The 16-bit PE checksum for server B
   "pe_checksum_prB" is then calculated over the byte blocks contributed
   by the 'M' PEs one by one.  The PE checksum calculation MUST use the
   Internet algorithm described in [<a href="rfc1071.html" title='"Computing the Internet checksum"'>RFC1071</a>].

   Server A MUST calculate its own PE checksum (i.e., "pe_checksum_pr0")
   in the same fashion, using the byte blocks of all the PEs owned by
   itself.




<span class="grey">Xie, et al.                   Experimental                     [Page 26]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-27" id="page-27" name="page-27"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   Note, whenever an ENRP finds that its internal handlespace has
   changed (e.g., due to PE registration/de-registration, receiving peer
   updates, removing failed PEs, downloading handlespace pieces from a
   peer, etc.), it MUST immediately update all its internal PE checksums
   that are affected by the change.

   Implementation Note: when the internal handlespace changes (e.g., a
   new PE added or an existing PE removed), an implementation need not
   re-calculate the affected PE checksum; it can instead simply update
   the checksum by adding or subtracting the byte block of the
   corresponding PE from the previous checksum value.

<span class="h4"><a class="dashAnchor" name="//apple_ref/Section/3.6.3.%20%20Re-Synchronization%20Procedures"></a><a class="selflink" href="#section-3.6.3" name="section-3.6.3">3.6.3</a>.  Re-Synchronization Procedures</span>

   If an ENRP server determines that there is inconsistency between its
   local handlespace data and a peer's handlespace data with regard to
   the PEs owned by that peer, it MUST perform the following steps to
   re-synchronize the data:

   1.  The ENRP server SHOULD first "mark" every PE it knows about that
       is owned by the peer in its local handlespace database;

   2.  The ENRP server SHOULD then send an ENRP_HANDLE_TABLE_REQUEST
       message with the W flag set to '1' to the peer to request a
       complete list of PEs owned by the peer;

   3.  Upon reception of the ENRP_HANDLE_TABLE_REQUEST message with the
       W flag set to '1', the peer server SHOULD immediately respond
       with an ENRP_HANDLE_TABLE_RESPONSE message listing all PEs
       currently owned by the peer.

   4.  Upon reception of the ENRP_HANDLE_TABLE_RESPONSE message, the
       ENRP server SHOULD transfer the PE entries carried in the message
       into its local handlespace database.  If a PE entry being
       transferred already exists in its local database, the ENRP server
       MUST replace the entry with the copy found in the message and
       remove the "mark" from the entry.

   5.  After transferring all the PE entries from the received
       ENRP_HANDLE_TABLE_RESPONSE message into its local database, the
       ENRP server SHOULD check whether there are still PE entries that
       remain "marked" in its local handlespace.  If so, the ENRP server
       SHOULD silently remove those "marked" entries.

   Note, similar to what is described in <a href="#section-3.2.3">Section 3.2.3</a>, the peer may
   reject the ENRP_HANDLE_TABLE_REQUEST or use more than one
   ENRP_HANDLE_TABLE_RESPONSE message to respond.




<span class="grey">Xie, et al.                   Experimental                     [Page 27]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-28" id="page-28" name="page-28"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/3.7.%20%20Handling%20Unrecognized%20Messages%20or%20Unrecognized%20Parameters"></a><a class="selflink" href="#section-3.7" name="section-3.7">3.7</a>.  Handling Unrecognized Messages or Unrecognized Parameters</span>

   When an ENRP server receives an ENRP message with an unknown message
   type or a message of known type that contains an unknown parameter,
   it SHOULD handle the unknown message or the unknown parameter
   according to the unrecognized message and parameter handling rules
   defined in Sections <a href="#section-3">3</a> and <a href="#section-4">4</a> in [<a href="rfc5354.html" title='"Aggregate Server Access Protocol (ASAP) and Endpoint Handlespace Redundancy Protocol (ENRP) Parameters"'>RFC5354</a>].

   According to the rules, if an error report to the message sender is
   needed, the ENRP server that discovered the error SHOULD send back an
   ENRP_ERROR message with a proper error cause code.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/4.%20%20Variables%20and%20Thresholds"></a><a class="selflink" href="#section-4" name="section-4">4</a>.  Variables and Thresholds</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.1.%20%20Variables"></a><a class="selflink" href="#section-4.1" name="section-4.1">4.1</a>.  Variables</span>

   peer_last_heard -  The local time that a peer server was last heard
      (via receiving either a group-cast or point-to-point message from
      the peer).

   pe_checksum_pr -  The internal 16-bit PE checksum that an ENRP server
      keeps for a peer.  A separate PE checksum is kept for each of its
      known peers as well as for itself.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/4.2.%20%20Thresholds"></a><a class="selflink" href="#section-4.2" name="section-4.2">4.2</a>.  Thresholds</span>

   PEER-HEARTBEAT-CYCLE -  The period for an ENRP server to announce a
      heartbeat message to all its known peers.  (Default=30 secs.)

   MAX-TIME-LAST-HEARD -  Pre-set threshold for how long an ENRP server
      will wait before considering a silent peer server potentially
      dead.  (Default=61 secs.)

   MAX-TIME-NO-RESPONSE -  Pre-set threshold for how long a message
      sender will wait for a response after sending out a message.
      (Default=5 secs.)

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/5.%20%20IANA%20Considerations"></a><a class="selflink" href="#section-5" name="section-5">5</a>.  IANA Considerations</span>

   This document (<a href="rfc5353.html">RFC 5353</a>) is the reference for all registrations
   described in this section.  All registrations have been listed on the
   RSerPool Parameters page.









<span class="grey">Xie, et al.                   Experimental                     [Page 28]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-29" id="page-29" name="page-29"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.1.%20%20A%20New%20Table%20for%20ENRP%20Message%20Types"></a><a class="selflink" href="#section-5.1" name="section-5.1">5.1</a>.  A New Table for ENRP Message Types</span>

   ENRP Message Types are maintained by IANA.  Ten initial values have
   been assigned by IANA, as described in Figure 1.  IANA created a new
   table, "ENRP Message Types":

   Type       Message Name                 Reference
   -----      -------------------------    ---------
   0x00       (Reserved by IETF)           <a href="rfc5353.html">RFC 5353</a>
   0x01       ENRP_PRESENCE                <a href="rfc5353.html">RFC 5353</a>
   0x02       ENRP_HANDLE_TABLE_REQUEST    <a href="rfc5353.html">RFC 5353</a>
   0x03       ENRP_HANDLE_TABLE_RESPONSE   <a href="rfc5353.html">RFC 5353</a>
   0x04       ENRP_HANDLE_UPDATE           <a href="rfc5353.html">RFC 5353</a>
   0x05       ENRP_LIST_REQUEST            <a href="rfc5353.html">RFC 5353</a>
   0x06       ENRP_LIST_RESPONSE           <a href="rfc5353.html">RFC 5353</a>
   0x07       ENRP_INIT_TAKEOVER           <a href="rfc5353.html">RFC 5353</a>
   0x08       ENRP_INIT_TAKEOVER_ACK       <a href="rfc5353.html">RFC 5353</a>
   0x09       ENRP_TAKEOVER_SERVER         <a href="rfc5353.html">RFC 5353</a>
   0x0a       ENRP_ERROR                   <a href="rfc5353.html">RFC 5353</a>
   0x0b-0xff  (Available for assignment)   <a href="rfc5353.html">RFC 5353</a>

   Requests to register an ENRP Message Type in this table should be
   sent to IANA.  The number must be unique.  The "Specification
   Required" policy of [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>] MUST be applied.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.2.%20%20A%20New%20Table%20for%20Update%20Action%20Types"></a><a class="selflink" href="#section-5.2" name="section-5.2">5.2</a>.  A New Table for Update Action Types</span>

   Update Types are maintained by IANA.  Two initial values have been
   assigned by IANA.  IANA created a new table, "Update Action Types":

   Type           Update Action              Reference
   -------------  --------------------       ---------
   0x0000         ADD_PE                      <a href="rfc5353.html">RFC 5353</a>
   0x0001         DEL_PE                      <a href="rfc5353.html">RFC 5353</a>
   0x0002-0xffff  (Available for assignment)  <a href="rfc5353.html">RFC 5353</a>

   Requests to register an Update Action Type in this table should be
   sent to IANA.  The number must be unique.  The "Specification
   Required" policy of [<a href="rfc5226.html" title='"Guidelines for Writing an IANA Considerations Section in RFCs"'>RFC5226</a>] MUST be applied.












<span class="grey">Xie, et al.                   Experimental                     [Page 29]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-30" id="page-30" name="page-30"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.3.%20%20Port%20Numbers"></a><a class="selflink" href="#section-5.3" name="section-5.3">5.3</a>.  Port Numbers</span>

   The references for the already assigned port numbers

      enrp-udp 9901/udp

      enrp-sctp 9901/sctp

      enrp-sctp-tls 9902/sctp

   have been updated to <a href="rfc5353.html">RFC 5353</a>.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/5.4.%20%20SCTP%20Payload%20Protocol%20Identifier"></a><a class="selflink" href="#section-5.4" name="section-5.4">5.4</a>.  SCTP Payload Protocol Identifier</span>

   The reference for the already assigned ENRP payload protocol
   identifier 12 have been updated to <a href="rfc5353.html">RFC 5353</a>.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/6.%20%20Security%20Considerations"></a><a class="selflink" href="#section-6" name="section-6">6</a>.  Security Considerations</span>

   We present a summary of the threats to the RSerPool architecture and
   describe security requirements in response to mitigate the threats.
   Next, we present the security mechanisms, based on TLS, that are
   implementation requirements in response to the threats.  Finally, we
   present a chain-of-trust argument that examines critical data paths
   in RSerPool and shows how these paths are protected by the TLS
   implementation.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.1.%20%20Summary%20of%20RSerPool%20Security%20Threats"></a><a class="selflink" href="#section-6.1" name="section-6.1">6.1</a>.  Summary of RSerPool Security Threats</span>

   "Threats Introduced by Reliable Server Pooling (RSerPool) and
   Requirements for Security in Response to Threats" [<a href="rfc5355.html" title='"Threats Introduced by Reliable Server Pooling (RSerPool) and Requirements for Security in Response to Threats"'>RFC5355</a>] describes
   the threats to the RSerPool architecture in detail and lists the
   security requirements in response to each threat.  From the threats
   described in this document, the security services required for the
   RSerPool protocol are enumerated below.

   Threat 1) PE registration/de-registration flooding or spoofing
   -----------
   Security mechanism in response: ENRP server authenticates the PE.

   Threat 2) PE registers with a malicious ENRP server
   -----------
   Security mechanism in response: PE authenticates the ENRP server.

   Threats 1 and 2, taken together, result in mutual authentication of
   the ENRP server and the PE.





<span class="grey">Xie, et al.                   Experimental                     [Page 30]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-31" id="page-31" name="page-31"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   Threat 3) Malicious ENRP server joins the ENRP server pool
   -----------
   Security mechanism in response: ENRP servers mutually authenticate.

   Threat 4) A PU communicates with a malicious ENRP server for handle
   resolution
   -----------
   Security mechanism in response: The PU authenticates the ENRP server.

   Threat 5) Replay attack
   -----------
   Security mechanism in response: Security protocol that has protection
   from replay attacks.

   Threat 6) Corrupted data that causes a PU to have misinformation
   concerning a pool handle resolution
   -----------
   Security mechanism in response: Security protocol that supports
   integrity protection

   Threat 7) Eavesdropper snooping on handlespace information
   -----------
   Security mechanism in response: Security protocol that supports data
   confidentiality.

   Threat 8) Flood of ASAP_ENDPOINT_UNREACHABLE messages from the PU to
   ENRP server
   -----------

   Security mechanism in response: ASAP must control the number of ASAP
   endpoint unreachable messages transmitted from the PU to the ENRP
   server.

   Threat 9) Flood of ASAP_ENDPOINT_KEEP_ALIVE messages to the PE from
   the ENRP server
   -----------
   Security mechanism in response: ENRP server must control the number
   of ASAP_ENDPOINT_KEEP_ALIVE messages to the PE.

   To summarize, threats 1-7 require security mechanisms that support
   authentication, integrity, data confidentiality, and protection from
   replay attacks.

   For RSerPool, we need to authenticate the following:

      PU &lt;----  ENRP server (PU authenticates the ENRP server)
      PE &lt;----&gt; ENRP server (mutual authentication)
      ENRP server &lt;-----&gt; ENRP server (mutual authentication)



<span class="grey">Xie, et al.                   Experimental                     [Page 31]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-32" id="page-32" name="page-32"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.2.%20%20Implementing%20Security%20Mechanisms"></a><a class="selflink" href="#section-6.2" name="section-6.2">6.2</a>.  Implementing Security Mechanisms</span>

   We do not define any new security mechanisms specifically for
   responding to threats 1-7.  Rather, we use an existing IETF security
   protocol, specifically [<a href="rfc3237.html" title='"Requirements for Reliable Server Pooling"'>RFC3237</a>], to provide the security services
   required.  TLS supports all these requirements and MUST be
   implemented.  The TLS_RSA_WITH_AES_128_CBC_SHA ciphersuite MUST be
   supported, at a minimum, by implementers of TLS for RSerPool.  For
   purposes of backwards compatibility, ENRP SHOULD support
   TLS_RSA_WITH_3DES_EDE_CBC_SHA.  Implementers MAY also support any
   other IETF-approved ciphersuites.

   ENRP servers, PEs, and PUs MUST implement TLS.  ENRP servers and PEs
   MUST support mutual authentication using PSK.  ENRP servers MUST
   support mutual authentication among themselves using PSK.  PUs MUST
   authenticate ENRP servers using certificates.

   TLS with PSK is mandatory to implement as the authentication
   mechanism for ENRP to ENRP authentication and PE to ENRP
   authentication.  For PSK, having a pre-shared-key constitutes
   authorization.  The network administrators of a pool need to decide
   which nodes are authorized to participate in the pool.  The
   justification for PSK is that we assume that one administrative
   domain will control and manage the server pool.  This allows for PSK
   to be implemented and managed by a central security administrator.

   TLS with certificates is mandatory to implement as the authentication
   mechanism for PUs to the ENRP server.  PUs MUST authenticate ENRP
   servers using certificates.  ENRP servers MUST possess a site
   certificate whose subject corresponds to their canonical hostname.
   PUs MAY have certificates of their own for mutual authentication with
   TLS, but no provisions are set forth in this document for their use.
   All RSerPool elements that support TLS MUST have a mechanism for
   validating certificates received during TLS negotiation; this entails
   possession of one or more root certificates issued by certificate
   authorities (preferably, well-known distributors of site certificates
   comparable to those that issue root certificates for web browsers).

   In order to prevent man-in-the-middle attacks, the client MUST verify
   the server's identity (as presented in the server's Certificate
   message).  The client's understanding of the server's identity
   (typically the identity used to establish the transport connection)
   is called the "reference identity".  The client determines the type
   (e.g., DNS name or IP address) of the reference identity and performs
   a comparison between the reference identity and each subjectAltName
   value of the corresponding type until a match is produced.  Once a
   match is produced, the server's identity has been verified, and the
   server identity check is complete.  Different subjectAltName types



<span class="grey">Xie, et al.                   Experimental                     [Page 32]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-33" id="page-33" name="page-33"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   are matched in different ways.  The client may map the reference
   identity to a different type prior to performing a comparison.
   Mappings may be performed for all available subjectAltName types to
   which the reference identity can be mapped; however, the reference
   identity should only be mapped to types for which the mapping is
   either inherently secure (e.g., extracting the DNS name from a URI to
   compare with a subjectAltName of type dNSName) or for which the
   mapping is performed in a secure manner (e.g., using DNS Security
   (DNSSEC), or using user- or admin-configured host-to-address/
   address-to-host lookup tables).

   If the server identity check fails, user-oriented clients SHOULD
   either notify the user or close the transport connection and indicate
   that the server's identity is suspect.  Automated clients SHOULD
   close the transport connection and then return or log an error
   indicating that the server's identity is suspect, or both.  Beyond
   the server identity check described in this section, clients should
   be prepared to do further checking to ensure that the server is
   authorized to provide the service it is requested to provide.  The
   client may need to make use of local policy information in making
   this determination.

   If the reference identity is an internationalized domain name,
   conforming implementations MUST convert it to the ASCII Compatible
   Encoding (ACE) format, as specified in <a href="rfc3490.html#section-4">Section 4 of [RFC3490]</a>, before
   comparison with subjectAltName values of type dNSName.  Specifically,
   conforming implementations MUST perform the conversion operation
   specified in <a href="rfc3490.html#section-4">Section 4 of [RFC3490]</a> as follows: * in step 1, the
   domain name SHALL be considered a "stored string"; * in step 3, set
   the flag called "UseSTD3ASCIIRules"; * in step 4, process each label
   with the "ToASCII" operation; and * in step 5, change all label
   separators to U+002E (full stop).

   After performing the "to-ASCII" conversion, the DNS labels and names
   MUST be compared for equality according to the rules specified in
   <a href="rfc3490.html#section-3">Section 3 of RFC 3490</a>.  The '*' (ASCII 42) wildcard character is
   allowed in subjectAltName values of type dNSName, and then, only as
   the left-most (least significant) DNS label in that value.  This
   wildcard matches any left-most DNS label in the server name.  That
   is, the subject *.example.com matches the server names a.example.com
   and b.example.com, but does not match example.com or a.b.example.com.

   When the reference identity is an IP address, the identity MUST be
   converted to the "network byte order" octet string representation <a href="rfc791.html">RFC</a>
   <a href="rfc791.html">791</a> [<a href="https://tools.ietf.org/html/rfc0791" title='"Internet Protocol"'>RFC0791</a>] and <a href="rfc2460.html">RFC 2460</a> [<a href="rfc2460.html" title='"Internet Protocol, Version 6 (IPv6) Specification"'>RFC2460</a>].  For IP version 4, as specified
   in <a href="rfc791.html">RFC 791</a>, the octet string will contain exactly four octets.  For
   IP version 6, as specified in <a href="rfc2460.html">RFC 2460</a>, the octet string will contain
   exactly sixteen octets.  This octet string is then compared against



<span class="grey">Xie, et al.                   Experimental                     [Page 33]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-34" id="page-34" name="page-34"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   subjectAltName values of type iPAddress.  A match occurs if the
   reference identity octet string and value octet strings are
   identical.

   After a TLS layer is established in a session, both parties are to
   independently decide whether or not to continue based on local policy
   and the security level achieved.  If either party decides that the
   security level is inadequate for it to continue, it SHOULD remove the
   TLS layer immediately after the TLS (re)negotiation has completed
   (see <a href="rfc4511.html">RFC 4511</a>)[<a href="rfc4511.html" title='"Lightweight Directory Access Protocol (LDAP): The Protocol"'>RFC4511</a>].  Implementations may re-evaluate the
   security level at any time and, upon finding it inadequate, should
   remove the TLS layer.

   Implementations MUST support TLS with SCTP, as described in [<a href="rfc3436.html" title='"Transport Layer Security over Stream Control Transmission Protocol"'>RFC3436</a>]
   or TLS over TCP, as described in [<a href="rfc5246.html" title='"The Transport Layer Security (TLS) Protocol Version 1.2"'>RFC5246</a>].  When using TLS/SCTP we
   must ensure that RSerPool does not use any features of SCTP that are
   not available to a TLS/SCTP user.  This is not a difficult technical
   problem, but simply a requirement.  When describing an API of the
   RSerPool lower layer, we also have to take into account the
   differences between TLS and SCTP.

   Threat 8 requires the ASAP protocol to limit the number of
   ASAP_ENDPOINT_UNREACHABLE messages (see <a href="rfc5352.html#section-3.5">Section 3.5 of RFC 5352</a>) to
   the ENRP server.

   Threat 9 requires the ENRP protocol to limit the number of
   ASAP_ENDPOINT_KEEP_ALIVE messages from the ENRP server to the PE.

   There is no security mechanism defined for the multicast
   announcements.  Therefore, a receiver of such an announcement cannot
   consider the source address of such a message to be a trustworthy
   address of an ENRP server.  A receiver must also be prepared to
   receive a large number of multicast announcements from attackers.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/6.3.%20%20Chain%20of%20Trust"></a><a class="selflink" href="#section-6.3" name="section-6.3">6.3</a>.  Chain of Trust</span>

   Security is mandatory to implement in RSerPool and is based on TLS
   implementation in all three architecture components that comprise
   RSerPool -- namely PU, PE, and the ENRP server.  We define an ENRP
   server that uses TLS for all communication and authenticates ENRP
   peers and PE registrants to be a secured ENRP server.

   Here is a description of all possible data paths and a description of
   the security.







<span class="grey">Xie, et al.                   Experimental                     [Page 34]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-35" id="page-35" name="page-35"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   PU &lt;---&gt; secured ENRP server (authentication of ENRP server;
            queries over TLS)
   PE &lt;---&gt; secured ENRP server (mutual authentication;
            registration/de-registration over TLS)
   secured ENRP server &lt;---&gt; secured ENRP server (mutual authentication;
            database updates using TLS)

   If all components of the system authenticate and communicate using
   TLS, the chain of trust is sound.  The root of the trust chain is the
   ENRP server.  If that is secured using TLS, then security will be
   enforced for all ENRP and PE components that try to connect to it.

   Summary of interaction between secured and unsecured components: If
   the PE does not use TLS and tries to register with a secure ENRP
   server, it will receive an error message response indicated as an
   error due to security considerations and the registration will be
   rejected.  If an ENRP server that does not use TLS tries to update
   the database of a secure ENRP server, then the update will be
   rejected.  If a PU does not use TLS and communicates with a secure
   ENRP server, it will get a response with the understanding that the
   response is not secure, as the response can be tampered with in
   transit even if the ENRP database is secured.

   The final case is the PU sending a secure request to ENRP.  It might
   be that ENRP and PEs are not secured and this is an allowable
   configuration.  The intent is to secure the communication over the
   Internet between the PU and the ENRP server.

   Summary:

   RSerPool architecture components can communicate with each other to
   establish a chain of trust.  Secured PE and ENRP servers reject any
   communications with unsecured ENRP or PE servers.

   If the above is enforced, then a chain of trust is established for
   the RSerPool user.

<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/7.%20%20Acknowledgments"></a><a class="selflink" href="#section-7" name="section-7">7</a>.  Acknowledgments</span>

   The authors wish to thank John Loughney, Lyndon Ong, Walter Johnson,
   Thomas Dreibholz, Frank Volkmer, and many others for their invaluable
   comments and feedback.









<span class="grey">Xie, et al.                   Experimental                     [Page 35]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-36" id="page-36" name="page-36"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


<span class="h2"><a class="dashAnchor" name="//apple_ref/Section/8.%20%20References"></a><a class="selflink" href="#section-8" name="section-8">8</a>.  References</span>

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.1.%20%20Normative%20References"></a><a class="selflink" href="#section-8.1" name="section-8.1">8.1</a>.  Normative References</span>

   [<a id="ref-RFC0791" name="ref-RFC0791">RFC0791</a>]     Postel, J., "Internet Protocol", STD 5, <a href="rfc791.html">RFC 791</a>,
                 September 1981.

   [<a id="ref-RFC1071" name="ref-RFC1071">RFC1071</a>]     Braden, R., Borman, D., Partridge, C., and W. Plummer,
                 "Computing the Internet checksum", <a href="rfc1071.html">RFC 1071</a>,
                 September 1988.

   [<a id="ref-RFC2119" name="ref-RFC2119">RFC2119</a>]     Bradner, S., "Key words for use in RFCs to Indicate
                 Requirement Levels", <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>, <a href="rfc2119.html">RFC 2119</a>, March 1997.

   [<a id="ref-RFC2460" name="ref-RFC2460">RFC2460</a>]     Deering, S. and R. Hinden, "Internet Protocol, Version
                 6 (IPv6) Specification", <a href="rfc2460.html">RFC 2460</a>, December 1998.

   [<a id="ref-RFC3237" name="ref-RFC3237">RFC3237</a>]     Tuexen, M., Xie, Q., Stewart, R., Shore, M., Ong, L.,
                 Loughney, J., and M. Stillman, "Requirements for
                 Reliable Server Pooling", <a href="rfc3237.html">RFC 3237</a>, January 2002.

   [<a id="ref-RFC3436" name="ref-RFC3436">RFC3436</a>]     Jungmaier, A., Rescorla, E., and M. Tuexen, "Transport
                 Layer Security over Stream Control Transmission
                 Protocol", <a href="rfc3436.html">RFC 3436</a>, December 2002.

   [<a id="ref-RFC3490" name="ref-RFC3490">RFC3490</a>]     Faltstrom, P., Hoffman, P., and A. Costello,
                 "Internationalizing Domain Names in Applications
                 (IDNA)", <a href="rfc3490.html">RFC 3490</a>, March 2003.

   [<a id="ref-RFC4511" name="ref-RFC4511">RFC4511</a>]     Sermersheim, J., "Lightweight Directory Access Protocol
                 (LDAP): The Protocol", <a href="rfc4511.html">RFC 4511</a>, June 2006.

   [<a id="ref-RFC5226" name="ref-RFC5226">RFC5226</a>]     Narten, T. and H. Alvestrand, "Guidelines for Writing
                 an IANA Considerations Section in RFCs", <a href="https://tools.ietf.org/html/bcp26">BCP 26</a>,
                 <a href="rfc5226.html">RFC 5226</a>, May 2008.

   [<a id="ref-RFC5246" name="ref-RFC5246">RFC5246</a>]     Dierks, T. and E. Rescorla, "The Transport Layer
                 Security (TLS) Protocol Version 1.2", <a href="rfc5246.html">RFC 5246</a>,
                 August 2008.

   [<a id="ref-RFC5354" name="ref-RFC5354">RFC5354</a>]     Stewart, R., Xie, Q., Stillman, M., and M. Tuexen,
                 "Aggregate Server Access Protocol (ASAP) and Endpoint
                 Handlespace Redundancy Protocol (ENRP) Parameters",
                 <a href="rfc5354.html">RFC 5354</a>, September 2008.

   [<a id="ref-RFC5352" name="ref-RFC5352">RFC5352</a>]     Stewart, R., Xie, Q., Stillman, M., and M. Tuexen,
                 "Aggregate Server Access Protocol (ASAP)", <a href="rfc5352.html">RFC 5352</a>,
                 September 2008.



<span class="grey">Xie, et al.                   Experimental                     [Page 36]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-37" id="page-37" name="page-37"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   [<a id="ref-RFC5355" name="ref-RFC5355">RFC5355</a>]     Stillman, M., Ed., Gopal, R., Guttman, E., Holdrege,
                 M., and S. Sengodan, "Threats Introduced by Reliable
                 Server Pooling (RSerPool) and Requirements for Security
                 in Response to Threats", <a href="rfc5355.html">RFC 5355</a>, September 2008.

<span class="h3"><a class="dashAnchor" name="//apple_ref/Section/8.2.%20%20Informative%20References"></a><a class="selflink" href="#section-8.2" name="section-8.2">8.2</a>.  Informative References</span>

   [<a id="ref-RFC4086" name="ref-RFC4086">RFC4086</a>]     Eastlake, D., Schiller, J., and S. Crocker, "Randomness
                 Requirements for Security", <a href="https://tools.ietf.org/html/bcp106">BCP 106</a>, <a href="rfc4086.html">RFC 4086</a>,
                 June 2005.

   [<a id="ref-SCTPSOCKET" name="ref-SCTPSOCKET">SCTPSOCKET</a>]  Stewart, R., Poon, K., Tuexen, M., Yasevich, V., and P.
                 Lei, "Sockets API Extensions for Stream Control
                 Transmission Protocol (SCTP)", Work in Progress,
                 July 2008.

Authors' Addresses

   Qiaobing Xie
   The Resource Group
   1700 Pennsylvania Ave NW
   Suite 560
   Washington, D.C.,   20006
   USA

   Phone: +1 224-465-5954
   EMail: Qiaobing.Xie@gmail.com


   Randall R. Stewart
   The Resource Group
   1700 Pennsylvania Ave NW
   Suite 560
   Washington, D.C.,   20006
   USA

   Phone:
   EMail: randall@lakerest.net


   Maureen Stillman
   Nokia
   1167 Peachtree Ct.
   Naperville, IL  60540
   US

   Phone:
   EMail: maureen.stillman@nokia.com



<span class="grey">Xie, et al.                   Experimental                     [Page 37]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-38" id="page-38" name="page-38"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


   Michael Tuexen
   Muenster Univ. of Applied Sciences
   Stegerwaldstr. 39
   48565 Steinfurt
   Germany

   EMail: tuexen@fh-muenster.de


   Aron J. Silverton
   Sun Microsystems, Inc.
   10 S. Wacker Drive
   Suite 2000
   Chicago, IL 60606
   USA

   Phone:
   EMail: ajs.ietf@gmail.com

































<span class="grey">Xie, et al.                   Experimental                     [Page 38]</span></pre>
<hr align="left" class="noprint" style="width: 96ex;"/><!--NewPage--><pre class="newpage"><a class="invisible" href="#page-39" id="page-39" name="page-39"> </a>
<span class="grey"><a href="rfc5353.html">RFC 5353</a>            Endpoint Handlespace Redundancy       September 2008</span>


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a>, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in <a href="https://tools.ietf.org/html/bcp78">BCP 78</a> and <a href="https://tools.ietf.org/html/bcp79">BCP 79</a>.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   <a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.












Xie, et al.                   Experimental                     [Page 39]

</pre><br/>
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.126, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>




</body><!-- Mirrored from tools.ietf.org/html/rfc5353 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Mar 2018 23:18:35 GMT --></html>